Lyte.Component.register("crm-besttime-new",{_template:'<template tag-name="crm-besttime-new"> <template is="if" value="{{besttimeshow}}"><template case="true"> <div class="dIBestTimeContainer{{viewType}} dIBestTimetoCallContainer w100p {{if(ifNotEquals(viewType,\'DetailsPage\'),\'schedule\',\'\')}}"> <div id="dIBestTime" class="dIB dIBestTime w100p dIBestTime{{viewType}}"> <div class="crm-font-bold besttimetitlefontcolor besttimetitlefontsize mL2 fL mB5 ">{{getI18n("crm.besttime.detailview.help.best")}} {{getI18n("crm.inv.mail.label.time")}} {{getI18n("crm.label.for")}} <lyte-popover lt-prop-wrapper-class="besttimedropinlyte" lt-prop-scrollable="true" lt-prop-auto-align="true" lt-prop-origin-elem="#bestTimeDayDropDown" lt-prop-max-width="400px" id="BestTimeDayDrop" lt-prop-duration="0" lt-prop-show-close-button="false" lt-prop-freeze="false" on-close="{{method(\'closeBestTimeDropDownPopover\')}}"> <template is="registerYield" yield-name="popover"> <lyte-popover-content> <template is="if" value="{{calendarshow}}"><template case="true"> <div id="BestTimelyteCalendar" class="lyteCalenderInBesttime"> <lyte-calendar lt-prop-header-type="dropdown" lt-prop-yield="true" lt-prop-format="YYYY/MM/DD" on-date-selected="{{method(\'changeDate\')}}" id="BestTimelyteCalendar" lt-prop-min-date="{{minimumDate}}"> </lyte-calendar> </div> </template></template> <template is="if" value="{{dropdownshow}}"><template case="true"> <div id="BestTimeDropDown" class="dIBestTimeDropdown"> <ul class="m0 p0"> <template is="for" items="{{dropDownDisplayDates}}" item="item" index="index"> <li class="m0 {{if(checkComparison(label,inputDate,\'=\'),proximas,\'\')}}" data-zcqa="bt_dd_{{viewType}}_{{index}}" onclick="{{action(\'changeDateForViewType\',item.date,viewType)}}">{{dropDownDisplayDates[index].label}}</li> </template> </ul> <div class="dIBestTimeToOpenCalendar dIB pT10 cP w100p proxima pB10" onclick="{{action(\'showCalendar\',this)}}"> <span class="dIOpenCalendarText pR" id="bestTimeCal">{{getI18n("crm.best.time.open.calendar")}}</span> </div> </div> </template></template> </lyte-popover-content> </template> </lyte-popover> </div> <div class="fR"> <template is="if" value="{{expHandlers(showDetailedToday,\'!\')}}"><template case="true"> <div class="ico-undo svgIcons dIB vam cP op08" onclick="{{action(\'reloadBesettime\')}}"></div> </template></template> <template is="if" value="{{isDetailsPage}}"><template case="true"> <span id="bestTimeDayDropDown" class="crm-font-regular besttimelabelfontsize mL5 besttimelinkcolor dIB vam cP" data-zcqa="bt_{{viewType}}_date" onclick="{{action(\'showDayDropDownPopUp\',this,viewType)}}"> {{inputDate}} </span> </template><template case="false"> <span class="crm-font-regular besttimelabelfontsize besttimelinkcolor dIB mL5 vam cP" data-zcqa="bt_{{viewType}}_date"> {{inputDate}} </span> </template></template> </div> </div> <template is="if" value="{{expHandlers(mailonly,\'!\')}}"><template case="true"> <div class="dIB vtop mT20 clearfix"> <div class="dIB vtop w100p"> <div class="dIB w100p besttimelabelfontcolor besttimelabelfontsize crm-font-regular mB10 mL2" data-value="Call"> {{getI18n("Call")}} </div> <template is="if" value="{{showDetailedToday}}"><template case="true"> <template is="if" value="{{allTimesLapsedCall}}"><template case="true"> <div class="dIBestTimeLabel dIB mL2"> <span id="tryTomorrow" class="dIB col666" data-zcqa="bt_{{viewType}}_trynext">{{getI18n("crm.best.time.no.besttime")}}</span> </div> </template><template case="false"> <div class="dIB besttimelinksizebig mL2 crm-font-light vam besttimelinkcolor mB8 pL25"> <span id="remindmepopcall" class="besttimelinkcolor dIB vam cP ico-starForEle lev{{bestTimeToShowCallLevel}} pR" data-zcqa="zia_setReminder" onclick="{{action(\'showRemindMePopupCall\',this,true)}}"> {{bestTimeToShowCall}} </span> <span class="besttimelabelfontcolor besttimeminsagodiv crm-font-regular lh20 besttimelabel2fontsize" id="dIBestTimeMins" mints="{{diffTimeCall}}">{{bestTimeToShowEtaaCall}}</span> </div> </template></template> </template><template case="false"> <template is="if" value="{{expHandlers(reminderTimeCall.length,\'>\',0)}}"><template case="true"> <div class="dIB w100p"> <template is="for" items="{{reminderTimeCall}}" item="item" index="index"> <span id="BestTimeValueCall_{{index}}" class="timeDi cP crm-font-medium besttimevaluecolor mR3 starredIcon pR lev{{item.level}}" onclick="{{action(\'showDetailsPagePopOver\',index,item.bestTime,item.dateTime,\'Call\')}}"><i></i>{{item.bestTime}}</span> </template> </div> </template><template case="false"> <div class="dIBestTimeLabel mL2 w100p dIB"> <span id="tryTomorrow" class="dIB crm-font-regular col666" data-zcqa="bt_{{viewType}}_trynext">{{getI18n("crm.best.time.no.besttime")}}</span> </div> </template></template> </template></template> </div> </div> </template></template> <template is="if" value="{{expHandlers(callonly,\'!\')}}"><template case="true"> <div class="dIB vtop mT22 clearfix"> <div class="dIB vtop w100p"> <div class="dIB w100p besttimelabelfontcolor besttimelabelfontsize crm-font-regular mL2 mB10" data-value="Text"> {{getI18n("Email")}} </div> <template is="if" value="{{showDetailedToday}}"><template case="true"> <template is="if" value="{{allTimesLapsedText}}"><template case="true"> <div class="dIBestTimeLabel mL2 dIB"> <span id="tryTomorrow" class="dIB col666" data-zcqa="bt_{{viewType}}_trynext">{{getI18n("crm.best.time.no.besttime")}}</span> </div> </template><template case="false"> <div class="dIB besttimelinksizebig mL2 crm-font-light vam besttimelinkcolor pL25"> <span id="remindmepoptext" class="besttimelinkcolor dIB vam cP ico-starForEle lev{{bestTimeToShowTextLevel}} pR" data-zcqa="zia_setReminder" onclick="{{action(\'showRemindMePopupText\',this,true)}}"> {{bestTimeToShowText}} </span> <span class="besttimelabelfontcolor besttimeminsagodiv lh20 crm-font-regular besttimelabel2fontsize" id="dIBestTimeMins" mints="{{diffTimeText}}">{{bestTimeToShowEtaaText}}</span> </div> </template></template> </template><template case="false"> <template is="if" value="{{expHandlers(reminderTimeText.length,\'>\',0)}}"><template case="true"> <div class="dIB w100p"> <template is="for" items="{{reminderTimeText}}" item="item" index="index"> <span id="BestTimeValueText_{{index}}" class="timeDi crm-font-medium mR3 cP starredIcon besttimevaluecolor pR lev{{item.level}}" onclick="{{action(\'showDetailsPagePopOver\',index,item.bestTime,item.dateTime,\'Text\')}}"><i></i>{{item.bestTime}}</span> </template> </div> </template><template case="false"> <div class="dIBestTimeLabel dIB mL2"> <span id="tryTomorrow" class="dIB crm-font-regular col666" data-zcqa="bt_{{viewType}}_trynext">{{getI18n("crm.best.time.no.besttime")}}</span> </div> </template></template> </template></template> </div> </div> </template></template> <lyte-popover lt-prop-wrapper-class="besttimedropinlyte zianewDetailView" lt-prop-scrollable="true" lt-prop-origin-elem="#remindmepopcall" id="BestTimeRemindeMeCall" lt-prop-duration="0" lt-prop-show-close-button="false" lt-prop-freeze="false"> <template is="registerYield" yield-name="popover"> <lyte-popover-content class="remindMeTime"> <div class="w100p dIB mT10 mB10"> <template is="for" items="{{reminderTimeCall}}" item="item" index="index"> <template is="if" value="{{getUserDetail(\'isZiaReminderEnabled\')}}"><template case="true"> <div id="reminderTime" class="proxima fL cB w100p mB5 listElements lev{{item.level}} {{if(item.reminder,\'liSelected\',\'\')}} {{if(ifEquals(index,0),\'mT5\',\'\')}}"> <div class="mR10 vam svgIcons dIB besttimestaricon"></div> <div class="dIB vam bstTimeForGray">{{item.bestTime}}</div> <div class="mL10 dIB svgIcons besttimeclockicon vam" data-zcqa="remindTime_{{index}}" onclick="{{action(\'onReminderIntiated\',index,item.bestTime,\'Call\')}}" lt-prop-title="{{getI18n(\'crm.best.time.set.reminder\')}}"></div> </div> </template><template case="false"> <div id="reminderTime" class="disableReminder proxima fL cB w100p mB5 listElements lev{{item.level}} {{if(item.reminder,\'liSelected\',\'\')}} {{if(ifEquals(index,0),\'mT5\',\'\')}}" data-zcqa="remindTime_{{index}}"> <div class="mR10 vam svgIcons dIB besttimestaricon"></div> <div class="dIB bstTimeForGray">{{item.bestTime}}</div> <div class="mL10 dIB hide col666"></div> </div> </template></template> </template> </div> </lyte-popover-content> </template> </lyte-popover> <lyte-popover lt-prop-wrapper-class="besttimedropinlyte zianewDetailView" lt-prop-scrollable="true" lt-prop-origin-elem="#remindmepoptext" id="BestTimeRemindeMeText" lt-prop-duration="0" lt-prop-show-close-button="false" lt-prop-freeze="false"> <template is="registerYield" yield-name="popover"> <lyte-popover-content class="remindMeTime"> <div class="w100p dIB mT10 mB10"> <template is="for" items="{{reminderTimeText}}" item="item" index="index"> <template is="if" value="{{getUserDetail(\'isZiaReminderEnabled\')}}"><template case="true"> <div id="reminderTime" class="proxima fL cB w100p mB5 listElements lev{{item.level}} {{if(item.reminder,\'liSelected\',\'\')}} {{if(ifEquals(index,0),\'mT5\',\'\')}}"> <div class="mR10 svgIcons vam dIB besttimestaricon"></div> <div class="dIB bstTimeForGray vam">{{item.bestTime}}</div> <div class="mL10 dIB svgIcons besttimeclockicon vam" data-zcqa="remindTime_{{index}}" onclick="{{action(\'onReminderIntiated\',index,item.bestTime,\'Text\')}}" lt-prop-title="{{getI18n(\'crm.best.time.set.reminder\')}}"></div> </div> </template><template case="false"> <div id="reminderTime" class="disableReminder proxima fL cB w100p mB5 listElements lev{{item.level}} {{if(item.reminder,\'liSelected\',\'\')}} {{if(ifEquals(index,0),\'mT5\',\'\')}}" data-zcqa="remindTime_{{index}}"> <div class="mR10 svgIcons vam dIB besttimestaricon"></div> <div class="dIB bstTimeForGray">{{item.bestTime}}</div> <div class="mL10 dIB besttimeclockicon hide"></div> </div> </template></template> </template> </div> </lyte-popover-content> </template> </lyte-popover> <lyte-popover lt-prop-wrapper-class="besttimedropinlyte" lt-prop-content-padding="0px" lt-prop-scrollable="true" id="BestTimeActivitiesOptionCall" lt-prop-duration="0" lt-prop-show-close-button="false" lt-prop-freeze="false"> <template is="registerYield" yield-name="popover"> <lyte-popover-content> <div class="activitesOptionPop"> <ul class="pB10 pT10 pL0 pR0 m0"> <li id="Zia_CreateTaskCall" data-zcqa="Zia_CreateTask" onclick="{{action(\'triggerCreateTask\',event,this)}}"> {{getI18n("crm.button.create.task")}}</li> <li id="Zia_CreateCall" data-zcqa="Zia_CreateCall" onclick="{{action(\'triggerCreateCall\',event,this)}}">{{getI18n("crm.button.create")}} {{getI18n("Call")}}</li> </ul> </div> </lyte-popover-content> </template> </lyte-popover> <lyte-popover lt-prop-content-padding="0px" lt-prop-wrapper-class="besttimedropinlyte" lt-prop-scrollable="true" id="BestTimeActivitiesOptionText" lt-prop-duration="0" lt-prop-show-close-button="false" lt-prop-freeze="false"> <template is="registerYield" yield-name="popover"> <lyte-popover-content> <div class="activitesOptionPop"> <ul class="pB10 pT10 pL0 pR0 m0"> <li id="Zia_CreateTaskMail" data-zcqa="Zia_CreateTask" onclick="{{action(\'triggerCreateTask\',event,this)}}"> {{getI18n("crm.button.create.task")}}</li> <li id="Zia_ScheduleMail" data-zcqa="Zia_ScheduleMail" href="javascript:;" onclick="{{action(\'schedulemail\')}}">{{getI18n("crm.reportschedule")}} {{getI18n("crm.label.premium.email")}}</li> </ul> </div> </lyte-popover-content> </template> </lyte-popover> </div> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"text",position:[1,1,1,0]},{type:"text",position:[1,1,1,2]},{type:"text",position:[1,1,1,4]},{type:"attr",position:[1,1,1,6]},{type:"registerYield",position:[1,1,1,6,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]}]}},default:{}},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},{type:"attr",position:[1,3]},{type:"text",position:[1,3,1,0]}]}},default:{}},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1,1,6]},{type:"attr",position:[1,1,3,1]},{type:"if",position:[1,1,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"attr",position:[1,1,3,3]},{type:"if",position:[1,1,3,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]}},default:{}},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,1,1]},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,1]},{type:"attr",position:[1,3]},{type:"text",position:[1,3,0]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,5]},{type:"if",position:[1,5],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,1,1]},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,1]},{type:"attr",position:[1,3]},{type:"text",position:[1,3,0]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"registerYield",position:[1,7,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,3,0]},{type:"attr",position:[1,5]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,3,0]}]}},default:{}}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,7]},{type:"registerYield",position:[1,9,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,3,0]},{type:"attr",position:[1,5]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,3,0]}]}},default:{}}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,9]},{type:"registerYield",position:[1,11,1],dynamicNodes:[{type:"attr",position:[1,1,1,1]},{type:"text",position:[1,1,1,1,1]},{type:"attr",position:[1,1,1,3]},{type:"text",position:[1,1,1,3,0]},{type:"text",position:[1,1,1,3,2]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,11]},{type:"registerYield",position:[1,13,1],dynamicNodes:[{type:"attr",position:[1,1,1,1]},{type:"text",position:[1,1,1,1,1]},{type:"attr",position:[1,1,1,3]},{type:"text",position:[1,1,1,3,0]},{type:"text",position:[1,1,1,3,2]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,13]}]}},default:{}}],_observedAttributes:["viewType","dropDownDisplayDates","inputDate","diffTimeCall","diffTimeText","reminderTimeCall","reminderTimeText","showReminder","bestTimeToShowCall","bestTimeToShowCallLevel","bestTimeToShowText","bestTimeToShowTextLevel","bestTimeToShowEtaaCall","bestTimeToShowEtaaText","allTimesLapsedCall","allTimesLapsedText","showDetailedToday","seid","module","type","gmtTime","reminderTimeSetCall","reminderTimeSetText","besttimecomp","dueDate","minimumDate","besttimeshow","isDetailsPage","interval","calendarshow","dropdownshow","dateinMS","dateForMail","calltextdrop","callTextDropDown","callonly","mailonly","storedata","days","months"],data:function(){return{viewType:Lyte.attr("string"),dropDownDisplayDates:Lyte.attr("array"),inputDate:Lyte.attr("string"),diffTimeCall:Lyte.attr("number"),diffTimeText:Lyte.attr("number"),reminderTimeCall:Lyte.attr("array"),reminderTimeText:Lyte.attr("array"),showReminder:Lyte.attr("boolean"),bestTimeToShowCall:Lyte.attr("string"),bestTimeToShowCallLevel:Lyte.attr("string"),bestTimeToShowText:Lyte.attr("string"),bestTimeToShowTextLevel:Lyte.attr("string"),bestTimeToShowEtaaCall:Lyte.attr("string"),bestTimeToShowEtaaText:Lyte.attr("string"),allTimesLapsedCall:Lyte.attr("boolean",{default:!1}),allTimesLapsedText:Lyte.attr("boolean",{default:!1}),showDetailedToday:Lyte.attr("boolean",{default:!1}),seid:Lyte.attr("string"),module:Lyte.attr("string"),type:Lyte.attr("string"),gmtTime:Lyte.attr("object"),reminderTimeSetCall:Lyte.attr("string"),reminderTimeSetText:Lyte.attr("string"),besttimecomp:Lyte.attr("object"),dueDate:Lyte.attr("object"),minimumDate:Lyte.attr("string"),besttimeshow:Lyte.attr("boolean",{default:!1}),isDetailsPage:Lyte.attr("boolean",{default:!1}),interval:Lyte.attr("number"),calendarshow:Lyte.attr("boolean",{default:!1}),dropdownshow:Lyte.attr("boolean",{default:!0}),dateinMS:Lyte.attr("number"),dateForMail:Lyte.attr("number"),calltextdrop:Lyte.attr("array",{default:["Call","Text"]}),callTextDropDown:Lyte.attr("boolean",{default:!1}),callonly:Lyte.attr("boolean",{default:!1}),mailonly:Lyte.attr("boolean",{default:!1}),storedata:Lyte.attr("object"),days:Lyte.attr("array",{default:["crm.best.time.day.short.sunday","crm.best.time.day.short.monday","crm.best.time.day.short.tuesday","crm.best.time.day.short.wednesday","crm.best.time.day.short.thursday","crm.best.time.day.short.friday","crm.best.time.day.short.saturday"]}),months:Lyte.attr("array",{default:["crm.best.time.month.short.january","crm.best.time.month.short.february","crm.best.time.month.short.march","crm.best.time.month.short.april","crm.best.time.month.short.may","crm.best.time.month.short.june","crm.best.time.month.short.july","crm.best.time.month.short.august","crm.best.time.month.short.september","crm.best.time.month.short.october","crm.best.time.month.short.november","crm.best.time.month.short.december"]})}},init:function(){if(Crm.userDetails.isBestTimeEnabledCall||Crm.userDetails.isBestTimeEnabledMail){Crm.userDetails.isBestTimeEnabledCall&&Crm.userDetails.isBestTimeEnabledMail?(this.setData("callTextDropDown",!0),this.setData("type","CALLTEXT")):Crm.userDetails.isBestTimeEnabledCall&&Crm.userDetails.permissions.Crm_Implied_Create_Calls?(this.setData("callonly",!0),this.setData("type","Call")):Crm.userDetails.isBestTimeEnabledMail&&(this.setData("mailonly",!0),this.setData("type","Text")),"Potentials"===this.getData("module")&&this.setData("module","Contacts"),this.getData("viewType")&&"DetailsPage"!==this.getData("viewType")||(this.setData("dueDate",new Date),this.setDropDownDateDetails(),this.setMinimumDate()),this.getData("type")||this.setData("type","Call");var e=store.findAll("besttime_zia_new",{id:this.getData("seid"),module:this.getData("module"),type:this.getData("type"),reqDate:this.getData("dueDate").getTime()}),t=this;e.then((function(){var e=store.peekRecord("besttime_zia_new",t.getData("seid"));t.setData("storedata",e),t.setDataToThisComponent(e),"DetailsPage"===t.getData("viewType")&&(crmBstTime.setPosition(),t.startInterval())}))}else $("#bestTimeToContactDiv").hide()},actions:{showCalendar:function(){this.setData("calendarshow",!0),this.setData("dropdownshow",!1)},showRemindMePopupCall:function(){document.getElementById("BestTimeRemindeMeCall").ltProp("show",!0)},showRemindMePopupText:function(){document.getElementById("BestTimeRemindeMeText").ltProp("show",!0)},showDetailsPagePopOver:function(e,t,i,a){if("DetailsPage"===this.getData("viewType")){var s="Call"===a;s?this.setData("dateForMail",this.getData("gmtTimeCall")[t]):this.setData("dateForMail",this.getData("gmtTimeText")[t]),crmBstTime.detailsPageDate=i,crmBstTime.detailsPageTime=t.match(new RegExp("(\\d+):(\\d+) ?("+I18n.getMsg("AM")+"|"+I18n.getMsg("PM")+"|)"));var o=s?document.getElementById("BestTimeActivitiesOptionCall"):document.getElementById("BestTimeActivitiesOptionText");s?o.ltProp("originElem","#BestTimeValueCall_"+e):o.ltProp("originElem","#BestTimeValueText_"+e),o.ltProp("show",!0)}else{if("CreateTask"===this.getData("viewType")){var l=$("#Crm_Tasks_RemindAt_Start_Date1_TimeOption");l.val(t).effect("highlight",{},1e3);var m=l.val().split(" ")[0].split(":"),r=m[0],n=m[1];r="PM"===Utils.getMeridiem(l.timeEntry("getTime")).toUpperCase()?parseInt(r)+12:r;var p=crmCalendar.getDateObjectFromGivenDateString($("#Crm_Tasks_RemindAt_Start_Date1").val());p.setHours(r),p.setMinutes(n),$("#Tasks_fldRow_RemindAt_Start_Date1 #Crm_Tasks_RemindAt_Start_Date1").data("dateObj",p)}else"CreateCall"===this.getData("viewType")&&$("#Crm_Calls_CALLSTARTDATETIME_TimeOption").val(t).effect("highlight",{},1e3);Crm.client_tracking("BestTime - Usage",{Module:this.getData("module"),viewType:this.getData("viewType"),BestTimeTo:this.getData("type"),DateCri:crmBstTime.getDateCri(p)})}},triggerCreateCall:function(e,t){var i=this.getData("dateForMail");document.getElementById("BestTimeActivitiesOptionCall").ltProp("show",!1),$L(t).addClass("BT"),isNewCallView?Crm.globalCreate(e,"relatedlist_new",t,i):crmRelatedList.logCall(e,t),Crm.client_tracking("BestTime - Usage",{Module:this.getData("module"),viewType:"DetailsPage",BestTimeTo:this.getData("type"),DateCri:crmBstTime.getDateCri(crmBstTime.detailsPageDate)})},triggerCreateTask:function(e,t){document.getElementById("BestTimeActivitiesOptionCall").ltProp("show",!1),document.getElementById("BestTimeActivitiesOptionText").ltProp("show",!1),$L(t).addClass("BT"),crmRelatedList.newTask(e,t),Crm.client_tracking("BestTime - Usage",{Module:this.getData("module"),viewType:"DetailsPage",BestTimeTo:this.getData("type"),DateCri:crmBstTime.getDateCri(crmBstTime.detailsPageDate)})},schedulemail:function(){var e=new Date(this.getData("dateForMail")),t=e.getFullYear(),i=(1+e.getMonth()).toString();i=i.length>1?i:"0"+i;var a=e.getDate().toString(),s=i+"/"+(a=a.length>1?a:"0"+a)+"/"+t+"##"+crmBstTime.detailsPageTime[1]+":"+crmBstTime.detailsPageTime[2]+"##"+crmBstTime.detailsPageTime[3];Crm.client_tracking("BestTime - Usage",{Module:this.getData("module"),viewType:"Schedule Mail-DetailsPage",BestTimeTo:"Text",DateCri:crmBstTime.getDateCri(crmBstTime.detailsPageDate)}),EntSendMail(this.getData("module"),this.getData("seid"),"BestTimeMail",this.getData("module").slice(0,-1),"","","","","",this.getData("dateForMail"),encodeURIComponent(s))},showDayDropDownPopUp:function(){"DetailsPage"===this.getData("viewType")&&(this.setData("dropdownshow",!0),document.getElementById("BestTimeDayDrop").ltProp("show",!0))},onReminderIntiated:function(e,t,i){var a="Call"===i,s=store.peekRecord("besttime_zia_new",this.getData("seid")),o=a?s.$.get("bestTime_call")[e].reminder:s.$.get("bestTime_text")[e].reminder;a?s.$.set("bestTime_call["+e+"].reminder",!o):s.$.set("bestTime_text["+e+"].reminder",!o),crmui.hideTooltip(),this.setData("storedata",s);var l=a?this.getData("gmtTimeCall"):this.getData("gmtTimeText"),m="Contacts"===this.getData("module")?"-1":"-2",r={seId:this.getData("seid"),reminderTime:a?this.getData("gmtTimeCall")[t]:this.getData("gmtTimeText")[t],viewId:m,seModule:this.getData("module")},n=a?this.getData("reminderTimeSetCall"):this.getData("reminderTimeSetText"),p=a?s.$.get("bestTime_call").length:s.$.get("bestTime_text").length;if(o)r.operation="remove",a?this.setData("reminderTimeSetCall",void 0):this.setData("reminderTimeSetText",void 0),this.setData("reminderTimeSet",void 0);else{n&&(r.oldReminderTime=a?this.getData("gmtTimeCall")[n]:this.getData("gmtTimeText")[n]);for(var d=0;d<p;d++)d!=e&&(a?s.$.set("bestTime_call["+d+"].reminder",!1):s.$.set("bestTime_text["+d+"].reminder",!1));for(var c in r.reminderTime=l[t],r.operation="add",Crm.client_tracking("BestTime - Usage",{Module:this.getData("module"),viewType:"DetailsPage",BestTimeTo:this.getData("type"),DateCri:"Today"}),r.userTZ=Crm.userDetails.USER_TIME_ZONE,r.timeFormat=Crm.userDetails.TIME_FORMAT,l)l[c]===r.reminderTime&&(a?this.setData("reminderTimeSetCall",c):this.setData("reminderTimeSetText",c),this.setData("reminderTimeSet",c))}this.sendBestTimeReminderRequest(r);var T=document.getElementById("BestTimeRemindeMeCall"),y=document.getElementById("BestTimeRemindeMeText");T&&y&&(T.ltProp("show",!1),y.ltProp("show",!1))},changeDateForViewType:function(e){document.getElementById("BestTimeDayDrop").ltProp("show",!1),e.setHours(0),e.setMinutes(0),e.setSeconds(0);var t=store.peekRecord("besttime_zia_new",this.getData("seid"));t&&t.$.deleteRecord(),this.getRecordForEmptyStore(e)},reloadBesettime:function(){this.getRecordForEmptyStore(new Date)}},methods:{closeBestTimeDropDownPopover:function(){this.setData("calendarshow",!1),document.getElementById("BestTimeDayDrop").ltProp("show",!1)},changeType:function(e){var t=e.ltProp("selected");this.setData("type",t.trim());var i=new Date(this.getData("dateinMS"));(new Date).getDate()===i.getDate()&&(new Date).getMonth()===i.getMonth()&&(new Date).getYear()===i.getYear()&&(i=new Date);var a="Call"===t,s=store.peekRecord("besttime_zia_new",this.getData("seid"));s?a?s.bestTime_call?this.getRecord():this.getRecordForEmptyStore(i):s.bestTime_text?this.getRecord():this.getRecordForEmptyStore(i):this.getRecordForEmptyStore(i)},getDiffTime:function(e){(e=crmBstTime.component)&&(e.getMethods().getDiffTimeNewOne(e,"call"),e.getMethods().getDiffTimeNewOne(e,"text"))},getDiffTimeNewOne:function(e,t){var i="call"===t,a=i?e.getData("gmtTimeCall"):e.getData("gmtTimeText"),s=i?e.getData("bestTimeToShowCall"):e.getData("bestTimeToShowText");if(s){var o=a[s],l=-(new Date-new Date(o))/6e4,m=Math.ceil(Math.ceil(l)%60),r=Math.ceil(Math.ceil(l)/60);i?e.setData("diffTimeCall",l):e.setData("diffTimeText",l);var n="";0===r?n=0===m?I18n.getMsg("crm.Now"):1===m?I18n.getMsg("crm.best.time.nl.str.minute.only",m):I18n.getMsg("crm.best.time.nl.str.minutes.only",m):1===r?(r-=1,n=1===m?I18n.getMsg("crm.best.time.nl.str.minute.only",m):I18n.getMsg("crm.best.time.nl.str.minutes.only",m)):r>1&&r<24&&(r-=1,n=0===m?I18n.getMsg("crm.best.time.nl.str.hours.only",r):1===m?I18n.getMsg("crm.best.time.nl.str.both.hours.and.minute",[r,m]):I18n.getMsg("crm.best.time.nl.str.both.hours.and.minutes",[r,m])),i?e.setData("bestTimeToShowEtaaCall",n):e.setData("bestTimeToShowEtaaText",n)}else clearTimeout(e.getData("interval")),crmBstTime.component=void 0},changeDate:function(){var e=(a=arguments[1]).split("/"),t=e[0],i=e[1]-1,a=e[2],s=new Date(t,i,a),o=store.peekRecord("besttime_zia_new",this.getData("seid"));o&&o.$.deleteRecord(),this.getRecordForEmptyStore(s),this.setData("calendarshow",!1),document.getElementById("BestTimeDayDrop").ltProp("show",!1)}},setDataToThisComponent:function(e){if(void 0!==e&&(void 0!==e.bestTime_all||void 0!==e.bestTime_call||void 0!==e.bestTime_text)){var t=$L("#bestTimeToContactDiv"),i=$L("#BestTimeDetailsPage");if(0!==t.length&&t.removeClass("dN"),0!==i.length&&i.removeClass("dN"),"CALLTEXT"===this.getData("type"))this.setData("reminderTimeCall",e.bestTime_call),this.setData("reminderTimeText",e.bestTime_text);else{var a="Call"===this.getData("type");a?(this.setData("reminderTimeCall",e.bestTime_call),this.setData("reminderTimeText",[])):(this.setData("reminderTimeCall",[]),this.setData("reminderTimeText",e.bestTime_text)),this.setData("reminderTime",a?e.bestTime_call:e.bestTime_text)}this.setData("inputDate",e.inputDate),this.setData("dateinMS",e.dateInMS),this.getData("viewType")||this.setData("viewType","DetailsPage"),"DetailsPage"===this.getData("viewType")&&this.setData("isDetailsPage",!0);for(var s=this.getData("reminderTimeCall"),o=this.getData("reminderTimeText"),l=!(s&&s.length>0),m=!(o&&o.length>0),r=e.inputDate===I18n.getMsg("Today")&&"DetailsPage"===this.getData("viewType"),n={},p=void 0!==s?s.length:0,d=0;d<p;d++)n[s[d].bestTime]=s[d].dateTime.getTime();this.setData("gmtTimeCall",n),n={},p=void 0!==o?o.length:0;for(d=0;d<p;d++)n[o[d].bestTime]=o[d].dateTime.getTime();if(this.setData("gmtTimeText",n),s&&s.length>0&&r){crmBstTime.detailsPageDate=s[0].dateTime,this.setData("bestTimeToShowCall",s[0].bestTime),this.setData("bestTimeToShowCallLevel",s[0].level);for(p=s.length,d=0;d<p;d++)s[d].reminder&&(this.setData("reminderTimeSetCall",s[d].bestTime),this.setData("reminderTimeSet",s[d].bestTime))}if(o&&o.length>0&&r){crmBstTime.detailsPageDate=o[0].dateTime,this.setData("bestTimeToShowText",o[0].bestTime),this.setData("bestTimeToShowTextLevel",o[0].level);for(p=o.length,d=0;d<p;d++)o[d].reminder&&(this.setData("reminderTimeSetText",o[d].bestTime),this.setData("reminderTimeSet",o[d].bestTime))}this.setData("allTimesLapsedCall",l),this.setData("allTimesLapsedText",m),this.setData("showDetailedToday",r),this.setData("besttimeshow",!0),"DetailsPage"===this.getData("viewType")&&r&&(crmBstTime.component=this,this.getMethods().getDiffTime(this))}},startInterval:function(){var e=new Date;e.setMinutes(e.getMinutes()+1),e.setSeconds(0);var t=this;this.setData("interval",setTimeout((function(){crmBstTime.component=t,t.callIntervalUpdate(t)}),e-new Date))},callIntervalUpdate:function(e){e?e.getData("inputDate")===I18n.getMsg("Today")&&(e.getData("gmtTimeCall")||e.getData("gmtTimeText"))&&(setInterval(e.getMethods().getDiffTime,6e4),e.getMethods().getDiffTime(e)):clearTimeout(e.getData("interval"))},setMinimumDate:function(){var e=new Date,t=e.getFullYear(),i=(1+e.getMonth()).toString();i=i.length>1?i:"0"+i;var a=e.getDate().toString();a=a.length>1?a:"0"+a,this.setData("minimumDate",t+"/"+i+"/"+a)},setDropDownDateDetails:function(){for(var e=[],t=0,i=0;i<7;i++){var a=new Date;a.setDate(a.getDate()+t++);var s={date:a};s.label=I18n.getMsg(this.getData("days")[a.getDay()])+", "+I18n.getMsg(this.getData("months")[a.getMonth()])+" "+a.getDate(),e.push(s)}e[0].label=I18n.getMsg("Today"),e[1].label=I18n.getMsg("Tommorow"),this.setData("dropDownDisplayDates",e)},getRecord:function(){var e=store.peekRecord("besttime_zia_new",this.getData("seid"));this.setDataToThisComponent(e)},getRecordForEmptyStore:function(e){var t=this;store.findAll("besttime_zia_new",{id:this.getData("seid"),type:this.getData("type").toUpperCase(),module:this.getData("module"),reqDate:e.getTime()}).then((function(){t.getRecord()}))},changeDate:function(e){document.getElementById("BestTimeDayDrop").ltProp("show",!1);var t=e.split("/"),i=t[0],a=t[1]-1,s=(e=t[2],new Date(i,a,e)),o=store.peekRecord("besttime_zia_new",this.getData("seid"));o&&o.$.deleteRecord(),this.getRecordForEmptyStore(s)},changeDateForCreateTask:function(e){$L($("crm-besttime-new")[0]).show();var t=store.peekRecord("besttime_zia_new",this.getData("seid"));t&&t.$.deleteRecord(),this.getRecordForEmptyStore(e)},sendBestTimeReminderRequest:function(e){var t=store.findAll("zia_reminder",e),i=this;t.then((function(){if("remove"!==e.operation){var t=store.peekRecord("zia_reminder",i.getData("seid"));t&&("Call"===i.getData("type")?i.setData("reminderTimeSetCall",t.reminderTime):i.setData("reminderTimeSetText",t.reminderTime),i.setData("reminderTimeSet",t.reminderTime))}}))}});
