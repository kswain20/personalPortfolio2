
<!-- saved from url=(0081)https://tipengine.zoho.com/analytics/stacked.jsp?frameorigin=https://crm.zoho.com -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<script src="./babel-polyfill.js"></script>
<script src="./vue.min.js"></script>
<script src="./vuetify-v1.2.1.js"></script>
<link href="./vuetify-v1.2.1.css" rel="stylesheet">
<script src="./axios.min.js"></script>
<script src="./standardMessageTemplates.js"></script>
<script src="./newbieMessageTemplates.js"></script>
<script src="./primaryPanelTemplate.js"></script>
<script src="./secondaryPanelTemplate.js"></script>
<link href="./mics.css" rel="stylesheet" type="text/css">
<link rel="preload" as="font" href="https://tipengine.zoho.com/tp/materialIcons/MaterialIcons-Regular.woff2" type="font/ttf" crossorigin="anonymous">
<link href="./micon.css" rel="stylesheet" type="text/css">
<style>

.stacked{
  transition: all 1s;
}
.list-complete-enter, .list-complete-leave-to
{
  opacity: 0;
  transform: translateX(50px);
}
.list-complete-leave-active {
  position: absolute;
}

html,body{
 height:100%;
 overflow:hidden;
}

</style>
<style>tcxspan{text-decoration: underline;cursor: pointer;}</style><style type="text/css" id="vuetify-theme-stylesheet">a { color: #1976d2; }
.primary {
  background-color: #1976d2 !important;
  border-color: #1976d2 !important;
}
.primary--text {
  color: #1976d2 !important;
  caret-color: #1976d2 !important;
}
.primary.lighten-5 {
  background-color: #c7fdff !important;
  border-color: #c7fdff !important;
}
.primary--text.text--lighten-5 {
  color: #c7fdff !important;
  caret-color: #c7fdff !important;
}
.primary.lighten-4 {
  background-color: #a8e0ff !important;
  border-color: #a8e0ff !important;
}
.primary--text.text--lighten-4 {
  color: #a8e0ff !important;
  caret-color: #a8e0ff !important;
}
.primary.lighten-3 {
  background-color: #8ac5ff !important;
  border-color: #8ac5ff !important;
}
.primary--text.text--lighten-3 {
  color: #8ac5ff !important;
  caret-color: #8ac5ff !important;
}
.primary.lighten-2 {
  background-color: #6aaaff !important;
  border-color: #6aaaff !important;
}
.primary--text.text--lighten-2 {
  color: #6aaaff !important;
  caret-color: #6aaaff !important;
}
.primary.lighten-1 {
  background-color: #488fef !important;
  border-color: #488fef !important;
}
.primary--text.text--lighten-1 {
  color: #488fef !important;
  caret-color: #488fef !important;
}
.primary.darken-1 {
  background-color: #005eb6 !important;
  border-color: #005eb6 !important;
}
.primary--text.text--darken-1 {
  color: #005eb6 !important;
  caret-color: #005eb6 !important;
}
.primary.darken-2 {
  background-color: #00479b !important;
  border-color: #00479b !important;
}
.primary--text.text--darken-2 {
  color: #00479b !important;
  caret-color: #00479b !important;
}
.primary.darken-3 {
  background-color: #003180 !important;
  border-color: #003180 !important;
}
.primary--text.text--darken-3 {
  color: #003180 !important;
  caret-color: #003180 !important;
}
.primary.darken-4 {
  background-color: #001e67 !important;
  border-color: #001e67 !important;
}
.primary--text.text--darken-4 {
  color: #001e67 !important;
  caret-color: #001e67 !important;
}
.secondary {
  background-color: #424242 !important;
  border-color: #424242 !important;
}
.secondary--text {
  color: #424242 !important;
  caret-color: #424242 !important;
}
.secondary.lighten-5 {
  background-color: #c1c1c1 !important;
  border-color: #c1c1c1 !important;
}
.secondary--text.text--lighten-5 {
  color: #c1c1c1 !important;
  caret-color: #c1c1c1 !important;
}
.secondary.lighten-4 {
  background-color: #a6a6a6 !important;
  border-color: #a6a6a6 !important;
}
.secondary--text.text--lighten-4 {
  color: #a6a6a6 !important;
  caret-color: #a6a6a6 !important;
}
.secondary.lighten-3 {
  background-color: #8b8b8b !important;
  border-color: #8b8b8b !important;
}
.secondary--text.text--lighten-3 {
  color: #8b8b8b !important;
  caret-color: #8b8b8b !important;
}
.secondary.lighten-2 {
  background-color: #727272 !important;
  border-color: #727272 !important;
}
.secondary--text.text--lighten-2 {
  color: #727272 !important;
  caret-color: #727272 !important;
}
.secondary.lighten-1 {
  background-color: #595959 !important;
  border-color: #595959 !important;
}
.secondary--text.text--lighten-1 {
  color: #595959 !important;
  caret-color: #595959 !important;
}
.secondary.darken-1 {
  background-color: #2c2c2c !important;
  border-color: #2c2c2c !important;
}
.secondary--text.text--darken-1 {
  color: #2c2c2c !important;
  caret-color: #2c2c2c !important;
}
.secondary.darken-2 {
  background-color: #171717 !important;
  border-color: #171717 !important;
}
.secondary--text.text--darken-2 {
  color: #171717 !important;
  caret-color: #171717 !important;
}
.secondary.darken-3 {
  background-color: #000000 !important;
  border-color: #000000 !important;
}
.secondary--text.text--darken-3 {
  color: #000000 !important;
  caret-color: #000000 !important;
}
.secondary.darken-4 {
  background-color: #000000 !important;
  border-color: #000000 !important;
}
.secondary--text.text--darken-4 {
  color: #000000 !important;
  caret-color: #000000 !important;
}
.accent {
  background-color: #82b1ff !important;
  border-color: #82b1ff !important;
}
.accent--text {
  color: #82b1ff !important;
  caret-color: #82b1ff !important;
}
.accent.lighten-5 {
  background-color: #ffffff !important;
  border-color: #ffffff !important;
}
.accent--text.text--lighten-5 {
  color: #ffffff !important;
  caret-color: #ffffff !important;
}
.accent.lighten-4 {
  background-color: #f8ffff !important;
  border-color: #f8ffff !important;
}
.accent--text.text--lighten-4 {
  color: #f8ffff !important;
  caret-color: #f8ffff !important;
}
.accent.lighten-3 {
  background-color: #daffff !important;
  border-color: #daffff !important;
}
.accent--text.text--lighten-3 {
  color: #daffff !important;
  caret-color: #daffff !important;
}
.accent.lighten-2 {
  background-color: #bce8ff !important;
  border-color: #bce8ff !important;
}
.accent--text.text--lighten-2 {
  color: #bce8ff !important;
  caret-color: #bce8ff !important;
}
.accent.lighten-1 {
  background-color: #9fccff !important;
  border-color: #9fccff !important;
}
.accent--text.text--lighten-1 {
  color: #9fccff !important;
  caret-color: #9fccff !important;
}
.accent.darken-1 {
  background-color: #6596e2 !important;
  border-color: #6596e2 !important;
}
.accent--text.text--darken-1 {
  color: #6596e2 !important;
  caret-color: #6596e2 !important;
}
.accent.darken-2 {
  background-color: #467dc6 !important;
  border-color: #467dc6 !important;
}
.accent--text.text--darken-2 {
  color: #467dc6 !important;
  caret-color: #467dc6 !important;
}
.accent.darken-3 {
  background-color: #2364aa !important;
  border-color: #2364aa !important;
}
.accent--text.text--darken-3 {
  color: #2364aa !important;
  caret-color: #2364aa !important;
}
.accent.darken-4 {
  background-color: #004c90 !important;
  border-color: #004c90 !important;
}
.accent--text.text--darken-4 {
  color: #004c90 !important;
  caret-color: #004c90 !important;
}
.error {
  background-color: #ff5252 !important;
  border-color: #ff5252 !important;
}
.error--text {
  color: #ff5252 !important;
  caret-color: #ff5252 !important;
}
.error.lighten-5 {
  background-color: #ffe4d5 !important;
  border-color: #ffe4d5 !important;
}
.error--text.text--lighten-5 {
  color: #ffe4d5 !important;
  caret-color: #ffe4d5 !important;
}
.error.lighten-4 {
  background-color: #ffc6b9 !important;
  border-color: #ffc6b9 !important;
}
.error--text.text--lighten-4 {
  color: #ffc6b9 !important;
  caret-color: #ffc6b9 !important;
}
.error.lighten-3 {
  background-color: #ffa99e !important;
  border-color: #ffa99e !important;
}
.error--text.text--lighten-3 {
  color: #ffa99e !important;
  caret-color: #ffa99e !important;
}
.error.lighten-2 {
  background-color: #ff8c84 !important;
  border-color: #ff8c84 !important;
}
.error--text.text--lighten-2 {
  color: #ff8c84 !important;
  caret-color: #ff8c84 !important;
}
.error.lighten-1 {
  background-color: #ff6f6a !important;
  border-color: #ff6f6a !important;
}
.error--text.text--lighten-1 {
  color: #ff6f6a !important;
  caret-color: #ff6f6a !important;
}
.error.darken-1 {
  background-color: #df323b !important;
  border-color: #df323b !important;
}
.error--text.text--darken-1 {
  color: #df323b !important;
  caret-color: #df323b !important;
}
.error.darken-2 {
  background-color: #bf0025 !important;
  border-color: #bf0025 !important;
}
.error--text.text--darken-2 {
  color: #bf0025 !important;
  caret-color: #bf0025 !important;
}
.error.darken-3 {
  background-color: #9f0010 !important;
  border-color: #9f0010 !important;
}
.error--text.text--darken-3 {
  color: #9f0010 !important;
  caret-color: #9f0010 !important;
}
.error.darken-4 {
  background-color: #800000 !important;
  border-color: #800000 !important;
}
.error--text.text--darken-4 {
  color: #800000 !important;
  caret-color: #800000 !important;
}
.info {
  background-color: #2196f3 !important;
  border-color: #2196f3 !important;
}
.info--text {
  color: #2196f3 !important;
  caret-color: #2196f3 !important;
}
.info.lighten-5 {
  background-color: #d4ffff !important;
  border-color: #d4ffff !important;
}
.info--text.text--lighten-5 {
  color: #d4ffff !important;
  caret-color: #d4ffff !important;
}
.info.lighten-4 {
  background-color: #b5ffff !important;
  border-color: #b5ffff !important;
}
.info--text.text--lighten-4 {
  color: #b5ffff !important;
  caret-color: #b5ffff !important;
}
.info.lighten-3 {
  background-color: #95e8ff !important;
  border-color: #95e8ff !important;
}
.info--text.text--lighten-3 {
  color: #95e8ff !important;
  caret-color: #95e8ff !important;
}
.info.lighten-2 {
  background-color: #75ccff !important;
  border-color: #75ccff !important;
}
.info--text.text--lighten-2 {
  color: #75ccff !important;
  caret-color: #75ccff !important;
}
.info.lighten-1 {
  background-color: #51b0ff !important;
  border-color: #51b0ff !important;
}
.info--text.text--lighten-1 {
  color: #51b0ff !important;
  caret-color: #51b0ff !important;
}
.info.darken-1 {
  background-color: #007cd6 !important;
  border-color: #007cd6 !important;
}
.info--text.text--darken-1 {
  color: #007cd6 !important;
  caret-color: #007cd6 !important;
}
.info.darken-2 {
  background-color: #0064ba !important;
  border-color: #0064ba !important;
}
.info--text.text--darken-2 {
  color: #0064ba !important;
  caret-color: #0064ba !important;
}
.info.darken-3 {
  background-color: #004d9f !important;
  border-color: #004d9f !important;
}
.info--text.text--darken-3 {
  color: #004d9f !important;
  caret-color: #004d9f !important;
}
.info.darken-4 {
  background-color: #003784 !important;
  border-color: #003784 !important;
}
.info--text.text--darken-4 {
  color: #003784 !important;
  caret-color: #003784 !important;
}
.success {
  background-color: #4caf50 !important;
  border-color: #4caf50 !important;
}
.success--text {
  color: #4caf50 !important;
  caret-color: #4caf50 !important;
}
.success.lighten-5 {
  background-color: #dcffd6 !important;
  border-color: #dcffd6 !important;
}
.success--text.text--lighten-5 {
  color: #dcffd6 !important;
  caret-color: #dcffd6 !important;
}
.success.lighten-4 {
  background-color: #beffba !important;
  border-color: #beffba !important;
}
.success--text.text--lighten-4 {
  color: #beffba !important;
  caret-color: #beffba !important;
}
.success.lighten-3 {
  background-color: #a2ff9e !important;
  border-color: #a2ff9e !important;
}
.success--text.text--lighten-3 {
  color: #a2ff9e !important;
  caret-color: #a2ff9e !important;
}
.success.lighten-2 {
  background-color: #85e783 !important;
  border-color: #85e783 !important;
}
.success--text.text--lighten-2 {
  color: #85e783 !important;
  caret-color: #85e783 !important;
}
.success.lighten-1 {
  background-color: #69cb69 !important;
  border-color: #69cb69 !important;
}
.success--text.text--lighten-1 {
  color: #69cb69 !important;
  caret-color: #69cb69 !important;
}
.success.darken-1 {
  background-color: #2d9437 !important;
  border-color: #2d9437 !important;
}
.success--text.text--darken-1 {
  color: #2d9437 !important;
  caret-color: #2d9437 !important;
}
.success.darken-2 {
  background-color: #00791e !important;
  border-color: #00791e !important;
}
.success--text.text--darken-2 {
  color: #00791e !important;
  caret-color: #00791e !important;
}
.success.darken-3 {
  background-color: #006000 !important;
  border-color: #006000 !important;
}
.success--text.text--darken-3 {
  color: #006000 !important;
  caret-color: #006000 !important;
}
.success.darken-4 {
  background-color: #004700 !important;
  border-color: #004700 !important;
}
.success--text.text--darken-4 {
  color: #004700 !important;
  caret-color: #004700 !important;
}
.warning {
  background-color: #ffc107 !important;
  border-color: #ffc107 !important;
}
.warning--text {
  color: #ffc107 !important;
  caret-color: #ffc107 !important;
}
.warning.lighten-5 {
  background-color: #ffffae !important;
  border-color: #ffffae !important;
}
.warning--text.text--lighten-5 {
  color: #ffffae !important;
  caret-color: #ffffae !important;
}
.warning.lighten-4 {
  background-color: #ffff91 !important;
  border-color: #ffff91 !important;
}
.warning--text.text--lighten-4 {
  color: #ffff91 !important;
  caret-color: #ffff91 !important;
}
.warning.lighten-3 {
  background-color: #ffff74 !important;
  border-color: #ffff74 !important;
}
.warning--text.text--lighten-3 {
  color: #ffff74 !important;
  caret-color: #ffff74 !important;
}
.warning.lighten-2 {
  background-color: #fff956 !important;
  border-color: #fff956 !important;
}
.warning--text.text--lighten-2 {
  color: #fff956 !important;
  caret-color: #fff956 !important;
}
.warning.lighten-1 {
  background-color: #ffdd37 !important;
  border-color: #ffdd37 !important;
}
.warning--text.text--lighten-1 {
  color: #ffdd37 !important;
  caret-color: #ffdd37 !important;
}
.warning.darken-1 {
  background-color: #e0a600 !important;
  border-color: #e0a600 !important;
}
.warning--text.text--darken-1 {
  color: #e0a600 !important;
  caret-color: #e0a600 !important;
}
.warning.darken-2 {
  background-color: #c18c00 !important;
  border-color: #c18c00 !important;
}
.warning--text.text--darken-2 {
  color: #c18c00 !important;
  caret-color: #c18c00 !important;
}
.warning.darken-3 {
  background-color: #a27300 !important;
  border-color: #a27300 !important;
}
.warning--text.text--darken-3 {
  color: #a27300 !important;
  caret-color: #a27300 !important;
}
.warning.darken-4 {
  background-color: #855a00 !important;
  border-color: #855a00 !important;
}
.warning--text.text--darken-4 {
  color: #855a00 !important;
  caret-color: #855a00 !important;
}</style></head><body>
<div id="app"><div id="app"><div data-app="true" class="application theme--light" id="app"><div class="application--wrap"><nav class="title v-toolbar v-toolbar--fixed theme--light" data-booted="true" style="margin-top: 0px; padding-right: 0px; padding-left: 0px; transform: translateY(0px); background-color: rgb(51, 140, 240); color: rgb(255, 255, 255); font-size: 20px !important; font-family: Lato, sans-serif !important; z-index: 101; box-shadow: rgb(187, 195, 202) 1px 0px 1px; font-weight: 700;"><div class="v-toolbar__content" style="height: 56px;">Announcements from Zoho CRM <div class="spacer"></div> <div class="v-toolbar__items"><button type="button" class="v-btn v-btn--icon theme--light" style="display: block;"><div class="v-btn__content"><i aria-hidden="true" class="v-icon material-icons theme--light" style="color: rgb(255, 255, 255);">close</i></div></button></div></div></nav><main class="v-content align-center" data-booted="true" style="padding: 56px 0px 0px; height: 100%; background-color: rgb(246, 249, 252);"><div class="v-content__wrap"><!----><div class="layout subheading  blue-grey--text text--lighten-1 text-xs-center column justify-center align-center fill-height" style="overflow: auto;"><div><i aria-hidden="true" class="v-icon blue-grey--text text--lighten-1  material-icons theme--light" style="font-size: 60px; color: rgb(97, 110, 136) !important;"> question_answer </i></div><div class="py-1" style="color: rgb(49, 57, 73); font-size: 18px !important; font-family: Lato, sans-serif !important; font-weight: 600;"></div><div class="pa-2 caption" style="color: rgb(49, 57, 73); font-size: 20px !important; font-family: Lato, sans-serif !important; font-weight: 700 !important;">You have no new notifications.</div><!----></div></div></main></div></div></div> <b>[]</b></div>

<script>

var version=4465607
var csrfParamName = "iamcsrcoo";

var parent = window.parent || window ;

var restart=false;

var focus=false;

if (!window.location.origin) {
     window.location.origin = window.location.protocol + "//" + window.location.hostname + (window.location.port ? ':' + window.location.port: '');
}

function checkVersion(curVersion){
    if(version!==+curVersion){
          restart=true;
	  return restart;
    }     
}

function getCSRFCookie(name) {    
     var cookie_name = name + "="; var ca = document.cookie.split(';');
     for (var i = 0; i < ca.length; i++) {
         var c = ca[i].trim();
             if (c.indexOf(cookie_name) === 0) {  
                 return c.substring(cookie_name.length, c.length);
          }
      } 
  return "";
}

function checkNreload(){
	var oldTime=localStorage.getItem("micsRestartTime")||0;
	var time=new Date().getTime()-oldTime > 60000*10;
	if(restart&&!focus&&time){
	       	localStorage.setItem("micsRestartTime",new Date().getTime());
		app.parentSource.postMessage({type:"reload",value:{"unviewedMessages":app.newPidValid.length,"notclickedMessages":app.notClickedPidValid.length},panelId:app.panelId},app.url);
               	location.reload();
	}
}


var app=new Vue({
  	el: '#app',
  	data: function() {
    	   return {
      		loading:true,
		reset: false,
		styleReset: false,
		markViewed:false,
		zuid:-1,
		styles:{},
      		templateName:"stacked-panel-template-default",
      		allItems:[],
      		items:[],
      		oldItems:[],
      		pid:[],
      		activePid:[],
      		viewedPid:[],
      		oldPid:[],
		newPid:[],
		notClickedPid:[],
		newPidValid:[],
		notClickedPidValid:[]
    	   }
      },
      methods:{
	init:function(){
	        this.getData(true);
	        this.loading=true;
	},
	getData:function(iterate){
	        var templateURL='/Stacked?ORGID='+this.orgID+'&ServiceID='+this.serviceID;
        	var handle=this;
        	axios.get(templateURL).then(function (response) {
        	        handle.loading = false;
			handle.zuid = response.data.ZUID;
			if(checkVersion(response.data.version)){  checkNreload(); return; }
			handle.formatPids(response);
			var unviewedPid = handle.pid.filter(function(val){ return !handle.viewedPid.includes(val) && !handle.oldPid.includes(val)});
			handle.getNotification( handle.pid.filter(function(d){ return handle.activePid.indexOf(d.toString()) < 0; }) );
			if(iterate){
				setTimeout(function(){ return handle.getData(true);},900000)
			}
        	}).catch(function (error) {
			
			if(error.response.status != 501)
			{
				setTimeout(function(){ return handle.getData(true);},900000);
			}
        		handle.loading = false;
       		});
	},
	getNotification:function(pid){
		var handle = this;
		if(pid.length===0){
			handle.formatItems();
			return;
		}
                var templateURL='/Stacked?ORGID='+this.orgID+'&ServiceID='+this.serviceID+'&Pidentifier='+pid.toString();
                axios.get(templateURL).then(function (response) {
                        if(checkVersion(response.data.version)){  checkNreload(); return; }
			handle.allItems = response.data.notification.map(function(d){var obj=handle.decodeData(JSON.parse(d.message_json)); obj.PID=d.PID; return obj;  }).concat(handle.allItems);
			handle.activePid=response.data.notification.map(function(d){  return d.PID; }).concat(handle.activePid);
                        handle.activePid=Array.from(new Set(handle.activePid));
			handle.formatItems();
                }).catch(function (response) {
                        handle.loading = false;
                });
	},
	markNewPids:function(){
		var handle = this;
		handle.newPid = handle.pid.filter(function(val){return !handle.viewedPid.includes(val) && !handle.oldPid.includes(val)});
		handle.notClickedPid= handle.pid.filter(function(val){return !handle.oldPid.includes(val)});
	},
	validNewPids:function(validPids){
		var handle = this;
		handle.newPidValid = validPids.notViewed;
		handle.notClickedPidValid = validPids.notClicked;
		if(handle.markViewed)
		{
			handle.viewedWin();
			handle.markViewed = false;
		}
		else
		{
			handle.parentSource.postMessage({type:"notification",value:{"unviewedMessages":handle.newPidValid.length,"notclickedMessages":handle.notClickedPidValid.length},panelId:handle.panelId},handle.url);
		}
	},
	viewedWin:function(){
		var handle=this;
                if(handle.newPidValid.length > 0)
                {
                        handle.feedbackViewed({"PID":handle.newPidValid.join()});
                }
		handle.newPidValid.forEach(function(d){
			handle.viewedPid.push(d);
		});
		handle.newPid = [];
	},
	feedbackViewed:function(data){
                var templateURL='/Stacked?ORGID='+this.orgID+'&ServiceID='+this.serviceID+'&Feedback=2&Pidentifier='+data.PID;
                var bodyFormData = new FormData();
                bodyFormData.append(csrfParamName,getCSRFCookie("iamcsr"));
                axios.post(templateURL,bodyFormData);
        },
        feedbackOpen:function(data){
                var templateURL='/Stacked?ORGID='+this.orgID+'&ServiceID='+this.serviceID+'&Feedback=3&Pidentifier='+data.PID;
                var bodyFormData = new FormData();
                bodyFormData.append(csrfParamName,getCSRFCookie("iamcsr"));
                axios.post(templateURL,bodyFormData);
        },
	openWin:function(data){
                var handle = this;
                var newData = handle.formatClickData(data);
                handle.parentSource.postMessage({type:"open",value:newData,panelId:this.panelId},this.url);
                handle.feedbackOpen(data);
                handle.oldPid.push(data.PID);
		handle.notClickedPid = handle.notClickedPid.filter(function(val){return data.PID != val});
                handle.items = handle.allItems.filter(function(d){ return handle.pid.includes(d.PID) && !handle.oldPid.includes(d.PID)});
                handle.oldItems = handle.allItems.filter(function(d){ return handle.oldPid.includes(d.PID)});
        },
        formatClickData:function(data){
                var handle = this;
                var newData = JSON.parse(JSON.stringify(data));
                if(newData.sdk==true || newData.sdk=="true")
                {
                        var newCTA = newData.cta + "?orgID=" + handle.orgID + "&zuid=" + handle.zuid;
                        newData.cta = newCTA;
                }
                return newData;
        },
	
        closeWin:function(){
		var handle = this;
		handle.parentSource.postMessage({type:"close",panelId:this.panelId},this.url);
		focus=false;
		checkNreload();
	},
	formatPids: function(response){
		var handle = this;
		var pid=response.data.message_types ? (response.data.message_types.reduce(function(acc,a,b){ if(a.active_messages_pid){ return  acc.concat(a.active_messages_pid.split(","));} else{ return ; } },[])) : [];
                pid=Array.from(new Set(pid));
                var viewedPid=response.data.message_types ? (response.data.message_types.reduce(function(acc,a,b){ if(a.viewed_messages_pid){return  acc.concat(a.viewed_messages_pid.split(","));} else {return ;} },[])) : [];
                viewedPid=Array.from(new Set(viewedPid));
                var oldPid=response.data.message_types ? (response.data.message_types.reduce(function(acc,a,b){if(a.clicked_messages_pid){return  acc.concat(a.clicked_messages_pid.split(","));} else {return ;} },[])) : [];
                oldPid=Array.from(new Set(oldPid));

		var pidsAlreadyViewed = pid.filter(function(val){return handle.viewedPid.includes(val) && !viewedPid.includes(val) && !oldPid.includes(val)});
                var pidsAlreadyClicked = pid.filter(function(val){return handle.oldPid.includes(val) && !oldPid.includes(val)});
                if(pidsAlreadyViewed.length > 0)
                {
                        handle.feedbackViewed({"PID":pidsAlreadyViewed.join()});
                }
                if(pidsAlreadyClicked.length > 0)
                {
                        handle.feedbackOpen({"PID":pidsAlreadyClicked.join()});
                }

                handle.pid = pid;
                handle.viewedPid = viewedPid.concat(pidsAlreadyViewed);
                handle.oldPid = oldPid.concat(pidsAlreadyClicked);
	},
	formatItems: function(){
		var handle = this;
		handle.activePid = handle.activePid.filter(function(val){ return handle.pid.includes(val)});
		handle.allItems = handle.allItems.filter(function(d){return handle.pid.includes(d.PID)});
		handle.items = handle.allItems.filter(function(d){ return handle.pid.includes(d.PID) && !handle.oldPid.includes(d.PID)});
		handle.oldItems = handle.allItems.filter(function(d){ return handle.oldPid.includes(d.PID)});
		setTimeout(function(){return handle.markNewPids()},2000);
		if(focus && document.visibilityState == "visible")
                {
			handle.markViewed = true;
                }
	},
	decodeData:function(data){
		var decodedData = JSON.parse(JSON.stringify(data));
		for(key in data){	
			if(key !== "component")
			{
				decodedData[key]=decodeURI(data[key]);
			}
		}
		return decodedData;
	},
	resetFunc:function(){
		this.reset = false;
	},
	stylesUpdatedFunc:function(){
		this.styleReset = false;	
	},
	stylesUpdate: function(styleJSON){
		this.styles = JSON.parse(JSON.stringify(styleJSON));
		this.styleReset = true;
	},
	orgUpdate: function(orgID){
		this.orgID = orgID;
		this.getData(false);
	},
      }
});

    window.addEventListener("message", function(event,a,b){
        switch(event.data.type)
        {
                case "init": 
			start(event.data.serviceID,event.data.orgID,event.data.url,event.data.panelId,event.data.panelTemplateName,event.data.styles,event.source);
                break;
		case "backdrop": app.reset=true;
			focus=false;
			checkNreload();
		break;
                case "focus":focus=true;
			app.markNewPids();
			app.markViewed = true;
                break;
		case "styleUpdate":
			app.stylesUpdate(event.data.styles);
		break;
		case "orgUpdate":
			app.orgUpdate(event.data.orgID);
		break;
        }
    });

function start(serviceID,orgID,url,panelId,panelTemplateName,styles,parentSource){
	app.serviceID=serviceID;
	app.orgID=orgID;
	app.url=url;
	app.panelId=panelId;
	app.templateName = panelTemplateName;
	if(Object.keys(styles).length==0)
        {
                styles={"emptyStyles":"placeHolder"};
        }
	app.styles = JSON.parse(JSON.stringify(styles));
	app.parentSource = parentSource;
	app.init();
}

</script>

</body></html>