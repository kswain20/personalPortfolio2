!function(e){var t=null,i=null;function r(e){e=e||10;for(var t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;)t+=i.charAt(Math.floor(Math.random()*i.length)),r++;return t}function n(n){if(!e.localStorage)throw new Error("localStorage not available");var o="BroadcastChannelPoly_"+n,s=null===t;return this.channelId=o,i=i||r(),(t=t||{})[o]=t[o]||[],t[o].push(this),this.name=o+"::::"+r()+(new Date).getTime(),s&&e.addEventListener("storage",a.bind(this),!1),this}function a(r){var n=r.key,a=r.newValue,o=!a,s=null;if(n.indexOf("eomBCmessage_")>-1&&!o){try{s=JSON.parse(a)}catch(e){throw new Error("Unable to parse JsonString")}if(s.tabId!==i&&s.channelId&&t&&t[s.channelId]){var d=t[s.channelId];for(var c in d)!d[c].closed&&d[c].onmessage&&d[c].onmessage(s.message);e.localStorage.removeItem(n)}}}n.prototype.postMessage=function(t){if(t={data:t},this.closed)throw new Error("This BroadcastChannel is closed.");var n={channelId:this.channelId,bcId:this.name,tabId:i,message:t};try{var a=JSON.stringify(n),o="eomBCmessage_"+r()+"_"+this.channelId;e.localStorage.setItem(o,a)}catch(e){throw new Error("Unable to parse msgObj")}setTimeout((function(){e.localStorage.removeItem(o)}),1e3)},n.prototype.close=function(){this.closed=!0;var i=t[this.channelId].indexOf(this);i>-1&&t[this.channelId].splice(i,1),t[this.channelId].length||delete t[this.channelId],function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(t)&&e.removeEventListener("storage",a.bind(this))},e.BroadcastChannel=e.BroadcastChannel||n}(window.self),function(){function e(e,t,i,n){n.forEach((function(n){n in i.prototype&&(e.prototype[n]=function(){return r(this[t],n,arguments)})}))}function t(e,t,i){i.forEach((function(i){Object.defineProperty(e.prototype,i,{get:function(){return this[t][i]},set:function(e){this[t][i]=e}})}))}function i(e,t,i,r){r.forEach((function(r){r in i.prototype&&(e.prototype[r]=function(){return this[t][r].apply(this[t],arguments)})}))}function r(e,t,i){var r,n=new Promise((function(n,a){(function(e){return new Promise((function(t,i){e.onsuccess=function(){t(e.result)},e.onerror=function(){i(e.error)}}))})(r=e[t].apply(e,i)).then(n,a)}));return n.request=r,n}function n(e){this._name=e.name,this._version=e.version,this._objectStoreNames=e.objectStoreNames,this._db=e}function a(e){this._tx=e,this.complete=new Promise((function(t,i){e.oncomplete=function(){t()},e.onerror=function(){i(e.error)},e.onabort=function(){i(e.error)}}))}function o(e){this._store=e}function s(e){this._index=e}n.prototype.createObjectStore=function(){return new o(this._db.createObjectStore.apply(this._db,arguments))},n.prototype.transaction=function(){return new a(this._db.transaction.apply(this._db,arguments))},t(n,"_db",["name","version","objectStoreNames"]),i(n,"_db",IDBDatabase,["close"]),a.prototype.objectStore=function(){return new o(this._tx.objectStore.apply(this._tx,arguments))},t(a,"_tx",["objectStoreNames","mode"]),i(a,"_tx",IDBTransaction,["abort"]),o.prototype.createIndex=function(){return new s(this._store.createIndex.apply(this._store,arguments))},o.prototype.index=function(){return new s(this._store.index.apply(this._store,arguments))},t(o,"_store",["name","keyPath","indexNames","autoIncrement"]),e(o,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),t(s,"_index",["name","keyPath","multiEntry","unique"]),e(s,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),self.idbHandler={open:function(e,t,i){return new Promise((function(r,a){var o=indexedDB.open(e,t);o.onupgradeneeded=function(e){if(i){var t=new n(e.target.result);i(t)}},o.onerror=function(e){a(e.target.result)},o.onsuccess=function(e){var t=new n(e.target.result);r(t)}}))}}}(),function(e){var t={Threads:4,Timeout:0,Worker:function(e,t){console.log("finished : "+e.data),t()}};e.ZReqPool=function(i){var r=e.extend({},t,i),n={ready:r.Threads,assign:function(){n.ready--},free:function(){n.ready++,o.process()},available:function(){return n.ready>0}},a=[],o={add:function(e){e&&(a.push(e),o.process())},next:function(){return a.shift()},flush:function(e){e&&(a=a.filter((function(t){return!e(t)})))},flushAll:function(){var e=a;return a=[],e},process:function(){if(n.available()){var e=o.next();if(e){n.assign();setTimeout((function(){r.Worker(e,(function(){n.free()}))}),r.Timeout)}}}};return o}}(jQuery);var ZAppUtil=function(e){var t;function i(){}return i.prototype.Info=function(){(e.isDevMode()||e.isLogEnabled())&&console.info.apply(window.console,arguments)},i.prototype.Error=function(){(e.isDevMode()||e.isLogEnabled())&&console.error.apply(window.console,arguments)},e.getPatchedString=function(e,t){if(!e||"string"!=typeof e)throw new Error("Invalid String");if(!t||"object"!=typeof t)throw new Error("Invalid Params object");return e.replace(/\$\{\w{1,}\}/g,(function(e){var i=e.replace(/[${}]/g,"");return t[i]}))},e.getURLOrigin=function(e){var t=e||document.location.href,i=document.createElement("a");return i.setAttribute("href",t),i.protocol+"//"+i.host},e.getQueryParams=function(e){var t={};e=e||window.location.href;var i=document.createElement("a");i.setAttribute("href",e);var r="string"==typeof i.search?i.search.substr(1):e.substr(e.indexOf("?")+1);return(r.length>1?r.split("&"):[]).forEach((function(e,i){var r=e.split("=");t[r[0]]=r[1]})),t},e.isURL=function(e){return-1!==e.indexOf("http")},e.isDevMode=function(){return localStorage&&!!localStorage.getItem("isDevMode")},e.isLogEnabled=function(){return localStorage&&!!localStorage.getItem("isLogEnabled")},e.getLogger=function(){return t&&t instanceof i||(t=new i),t},e.constructQueryParamsString=function(e){var t=[];for(var i in e)i&&e[i]&&t.push(i+"="+e[i]);return t.join("&")},e}(window.ZAppUtil||{}),MessageManager=function(e){var t,i=ZAppUtil.getLogger();function r(e){try{var r="string"==typeof e.data?JSON.parse(e.data):e.data}catch(t){r=e.data}var c=r.type;if("SDK.EVENT"==c){var g="SDK.EVENT"===c?r.eventName:void 0;try{if(-1!==["REGISTER","DEREGISTER"].indexOf(g)||function(e,i){var r=t.GetAppInstance(i.uniqueID),n=document.getElementById(r.uniqueID),a=n&&n.contentWindow,o=l(r.resolvedURL),s=r.uniqueID,d=e.source,c=i.uniqueID,g=l(decodeURIComponent(i.appOrigin));if(a!==d||o!==g||s!==c)throw new Error("Message from UnAuthorized Source");return!0}(e,r))if("SDK.EVENT"===c)!function(e,r){var c={REGISTER:n,DEREGISTER:a,HTTP_REQUEST:d}[r.eventName];c&&"function"==typeof c?c(e,r):function(e,r){var n,a,d=r.eventName,c=r.promiseid,l=r.data,g=r.uniqueID,u=t.GetAppInstance(g),p=t.GetPanelReference(g),m=p&&p.getConfig();u.extension_id;if(c){var f=document.getElementById(u.location).contentWindow;n=o.bind(null,f,u.origin,c,d),a=s.bind(null,f,u.origin,c,d)}i.Info("Event from SDK => Eventname : ",d,", Time : ",r.time,", Eventpayload : ",l);var h={data:l,config:m,callback:n,callbackFailure:a,iframe:document.getElementById(u.location)};t.TriggerEventListeners(d,h)}(0,r)}(e,r);else t.InterceptMessage(e,r)}catch(e){i.Error("[MessageHandler] => ",e.stack)}}}function n(e,r){for(var n,a=e.source,o=e.origin,s=t.GetModelStore(),d=document.getElementsByTagName("iframe"),c=0;c<d.length;c++)d[c].contentWindow===a&&(n=d[c].id);var g=t.GetAppInstance(n);if(g){if(l(g.resolvedURL)!==l(decodeURIComponent(r.appOrigin)))throw new Error("Message from Un-Authorized App");var u=g.extensionID;g.state="REGISTERED",g.origin=o,i.Info("App Registered: "+g.location);var p=t.GetExtensionInstance(u),m={model:s,locale:p&&p.Locale?p.Locale:"en",localeResource:p&&p.localeResource,uniqueID:g.uniqueID},f=t.GetPanelReference(g.uniqueID);f.initialized=g.initialized=!0,f.SendEvent("SET_CONTEXT",m),"function"==typeof g.onload&&setTimeout(g.onload.bind(null,[g.config]),window.AppOnLoadDelay||0)}else i.Error("Message from UnAuthorized window arrived.")}function a(e,r){var n=r.uniqueID,a=t.GetPanelReference(n),o=t.GetAppInstance(n);o?(o.initialized=a.initialized=!1,i.Info("App["+n+"] DeRegistered successfully"),"function"==typeof o.onunload&&setTimeout(o.onunload.bind(null,[o.config]),window.AppOnUnLoadDelay||0)):i.Info("Coult not find App Instance to De-Register.")}function o(e,t,i,r,n){var a={type:"FRAMEWORK.EVENT",eventName:"EVENT_RESPONSE",promiseid:i,time:(new Date).getTime(),data:n};e.postMessage(a,t)}function s(e,t,i,r,n){var a={type:"FRAMEWORK.EVENT",eventName:"EVENT_RESPONSE_FAILURE",promiseid:i,time:(new Date).getTime(),data:n};e.postMessage(a,t)}function d(e,i){var r=i.data,n=i.promiseid,a=i.uniqueID;t.ProcessGetRequest(n,a,r).then((function(t){c(e.source,e.origin,n,t,!0)})).catch((function(t){c(e.source,e.origin,n,t,!1)}))}function c(e,t,i,r,n){var a={type:"FRAMEWORK.EVENT",eventName:"EVENT_RESPONSE",data:r,time:(new Date).getTime(),promiseid:i,isSuccess:n};e.postMessage(a,t)}function l(e){var t=document.createElement("a");return t.setAttribute("href",e),t.protocol+"//"+t.host+t.pathname}return e.Init=function(i,n){if(!i||"object"!=typeof i)throw Error("Invalid Context object passed");if(n&&"object"!=typeof n)throw Error("Invalid Configuration Passed to MessageHandler");return t=i,r.bind(e)},e.GetMessenger=function(e){return{SendEvent:function(r,n){!function(r){if(void 0!==r){var n=t.GetAppInstance(e),a=n&&n.resolvedURL,o=document.getElementById(e)&&document.getElementById(e).contentWindow;o&&o.postMessage(r,a)}else i.Error("Invalid Message.")}({type:"FRAMEWORK.EVENT",eventName:r,data:n,time:(new Date).getTime(),uniqueID:e})}}},e.BroadcastEvent=function(e,r){var n=t.GetAllAppInstance();for(var a in n){var o=t.GetPanelReference(a);o&&o.initialized?o.SendEvent(e,r):i.Error("App reference could not be found.")}},e}(window.MessageManager||{}),DefaultPluginManager=function(e){return e.RenderPanel=function(e){var t,i=e.location,r=e.resolvedURL;return i&&"string"==typeof i&&(i=t=document.getElementById(i)),i instanceof HTMLIFrameElement&&((t=i).setAttribute("src",r),t.setAttribute("id",e.uniqueID)),t},e}(window.DefaultPluginManager||{}),ZApp=function(e){var t=ZAppUtil.getLogger();try{var i,r,n,a,o=!1,s={},d={devHost:"http://127.0.0.1:5000",zappsHost:"http://zapps.zohousercontent/appfiles/"},c={},l={},g={},u={};function p(e){return l[e]}function m(){return l}function f(e){return g[e]}function h(e){return c[e]}function C(e){var a,o;try{var s={},c=e?e.uniqueID:void 0;c&&l[c]?s=l[c]:(c=e.uniqueID||(o=(new Date).getTime(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=(o+16*Math.random())%16|0;return o=Math.floor(o/16),("x"==e?t:3&t|8).toString(16)}))),s.uniqueID=c,s.url=e.url,s.config=e.config||{},s.location=e.location,s.extension_id=e.extension_id,s.extension_version=e.extension_version,s.frame_origin=e.frame_origin,s.service_origin=e.service_origin,s.resolvedURL=function(e){var t,i=e.url,r=ZAppUtil.isDevMode()?d.devHost:d.zappsHost,n=ZAppUtil.getURLOrigin(),a={serviceOrigin:encodeURIComponent(e.service_origin||n),frameorigin:encodeURIComponent(e.frame_origin||n),isDevMode:ZAppUtil.isDevMode(),isLogEnabled:ZAppUtil.isLogEnabled()},o=ZAppUtil.constructQueryParamsString(a),s=e.extension_id,c=e.extension_version;!ZAppUtil.isDevMode()&&s&&c&&(r+="/"+s+"/"+c);t=ZAppUtil.isURL(i)?i:r+i;return t+=-1===t.indexOf("?")?"?":"&",t+=o}(s)),s.ondemand=e.ondemand,s.onload=e.onload,s.onunload=e.onunload,I(i,s);var u=n.RenderPanel(s);u?u instanceof HTMLIFrameElement&&(l[c]=s,(a=MessageManager.GetMessenger(c)).getConfig=function(){return e.config},g[c]=a,I(r,s)):s.initialized=!1}catch(e){t.Error(e)}return a}function I(e,t){if(e&&"function"==typeof e)return e(t)}function E(e){try{if("string"==typeof e&&(e=JSON.parse(e)),"object"!=typeof e)return void t.Error("Invalid extension config passed");var i=e.modules,r={version:e.version,locale:e.locale,modules:(i,void 0),widgets:i?i.widgets:void 0,connectors:i?i.connectors:void 0,id:e.id,params:e.params};delete r.modules,function(e){if(e){for(var i=e.widgets||[],r=[],n=0;n<i.length;n++){var a=i[n];a.extension_id=e.id,a.extension_version=e.version;var o=C(a);o&&r.push(o)}return e.panelRefs=r,r}t.Error("Invalid Extension data passed.")}(r),c[e.id]=r}catch(e){t.Error("Error in Loading App Data ",e)}}function v(e,t){0}var A={};function y(){return s}function R(e,i,r){return new Promise((function(n,o){try{t.Info("ProcessGetRequest : PromiseID: ",e,", Options: ",r);var s=r.url,d=r.type,c=r.data,l=r.postBody,g=r.headers,u=r.contentType||"application/text",m=r.dataType||"text",f=p(i),C=h(f&&f.extension_id);if("object"==typeof C){var I=function(e){if(!Array.isArray(e))throw new Error("Invalid params array");for(var t={},i=0;i<e.length;i++){var r=e[i].name,n=e[i].value;t[r]=n}return t}(C.params);s=ZAppUtil.getPatchedString(s,I),c=c?function(e,t){if(!e||"object"!=typeof e)return;if(!t||"object"!=typeof t)throw new Error("Invalid Params object");return JSON.parse(ZAppUtil.getPatchedString(JSON.stringify(e),t))}(c,I):void 0}var E="";c&&"object"==typeof c&&(E=Object.keys(c).map((function(e){return e+"="+c[e]})).join("&"));var v={requestURL:s,requestType:d,queryParams:E,headers:g,postBody:l||"",contentType:u,dataType:m};if("function"!=typeof a)throw new Error("Provide Request handler implementation in the Bootstrap.");a(v,n,o)}catch(e){t.Error("ProcessGetRequest : Error => ",e),o(e)}}))}function W(e){return ZAppUtil.isDevMode(),{}}return e.Bootstrap=function(s){var c,l,g;t.Info("Running in Dev Mode : ",ZAppUtil.isDevMode());try{if(!s||"object"!=typeof s)throw new Error("Invalid configurations passed to Bootstrap.");n=s.PluginManager||DefaultPluginManager,a=s.RequestHandler,i=s.preRenderApp,r=s.postRenderApp,$.extend(d,s.serverConfig),u.ProcessGetRequest=R,u.Logger=t,u.GetLocaleResource=W,u.GetAppInstance=p,u.GetAllAppInstance=m,u.GetPanelReference=f,u.GetExtensionInstance=h,u.GetModelStore=y,u.InterceptMessage=v,u.TriggerEventListeners=function(e,t){var i=A[e];if(Array.isArray(i))for(var r=0;r<i.length;r++)i[r](t)};var C=s.EventListeners||{};for(var I in C)l=I,g=C[I],A.hasOwnProperty(l)||(A[l]=[]),A[l].push(g);return c=MessageManager.Init(u),window.addEventListener("message",c),o=!0,ZAppUtil.isDevMode()&&new Promise((function(e,i){var r=d.devHost+"/plugin-manifest.json";$.support.cors=!0,$.ajax({type:"GET",url:r,dataType:"json",success:function(t){e(t)},error:function(e){var r;r=e,t.Error("Error occured while trying to Get plugin-manifest.json : ",r),i(e)}})})).then((function(e){var t=e.modules;E({locale:e.locale,modules:t,widgets:t?t.widgets:void 0,connectors:t?t.connectors:void 0,id:e.id||"00000000",params:e.params})})).catch((function(e){t.Error("Error occured while loading Meta data. Error: ",e.message)})),e}catch(e){t.Error("Error occured while Initiating Framework : ",e.message)}},e.isInitialized=function(){return o},e.LoadExtension=function(e){if(!ZAppUtil.isDevMode())return E(e);t.Info("Running in Dev mode so can't Load the Extension.")},e.LoadApp=function(e){if(t.Info("Load App : [ "+e.url+","+e.location+"]"),!ZAppUtil.isDevMode())return function(e){return C(e)}(e);t.Info("Running in Dev mode so can't Load the app.")},e.RenderApps=function(e,i){for(var r in t.Info("Render Apps with LocationID => ",e),"string"==typeof e&&(e=[e]),l)try{var n=l[r],a=n.location,o=n.ref;if(e&&-1===e.indexOf(a))continue;if(o&&o.initialized)continue;C(n)}catch(e){t.Error("Exception while Rendering Panel ==> ",r,".",e)}},e.GetAppInstance=p,e.GetAllAppInstance=m,e.isDevMode=ZAppUtil.isDevMode,e.SetModel=function(e){return s=e,!0},e.UpdateModel=function(e){return s},e.GetModel=function(e){return s[e]},e.BroadcastEvent=function(e,t){MessageManager.BroadcastEvent(e,t)},e.getLogger=ZAppUtil.getLogger,e.version="0.7.0",e}catch(e){t.Error("Error Occured ",e.message)}}(window.ZApp||{}),CrmWidgets=function(){var e,t={},i={},r={NAME:"WIDGET_DB",OBJECT_STORE_NAME:"WIDGET_REQUEST_TRACKER"},n={CLEANUP_DELAY:1e4,HASHING_METHOD:"SHA-256"},a={CHANNEL:"WIDGET_TELEPHONY_RESULT_CHANNEL",REPETITION:4,INTRAVEL:400},o=idbHandler.open(r.NAME,1,(function(e){e.createObjectStore(r.OBJECT_STORE_NAME)}));function s(e){var i=e.requestHash,r=t[i];r&&r instanceof Array&&(r.each((function(t){var i=t.cachedPromise;"DONE"===e.status?i.done(e.response):i.fail(e.response),clearTimeout(t.setTimeoutID)})),delete t[i])}var d=new BroadcastChannel(a.CHANNEL);function c(e,t){var i,r=function(e){if(window.TextEncoder)return new TextEncoder("utf-8").encode(e);for(var t=unescape(encodeURIComponent(e)),i=new Uint8Array(t.length),r=t.length,n=0;n<r;n++)i[n]=t.charCodeAt(n);return i}(t);if(window.crypto)i=window.crypto.subtle.digest(e,r);else if(window.msCrypto){var n;i=new Promise((function(e){n=e})),window.msCrypto.subtle.digest(e,r).oncomplete=function(e){n(e.target.result)}}return i.then((function(e){return Array.from(new Uint8Array(e)).map((function(e){return("00"+e.toString(16)).slice(-2)})).join("")}))}function l(e,t){if(e instanceof Object){var i={"x-ratelimit-remaining":t.getResponseHeader("x-ratelimit-remaining"),"x-ratelimit-limit":t.getResponseHeader("x-ratelimit-limit"),"x-ratelimit-reset":t.getResponseHeader("x-ratelimit-reset")};e.$responseHeaders=i}}function g(e){this.postMessage({action:"mimicResponse",data:e}),s(e)}function u(e){return CrmWidgets.Utils.isMobileWidget()||"21"!=e.context.TYPE?Promise.resolve(e):o.then((function(n){return t=n.transaction(r.OBJECT_STORE_NAME,"readwrite"),(i=t.objectStore(r.OBJECT_STORE_NAME)).get(e.requestHash)})).then((function(r){var a=(new Date).getTime();return!r||Math.abs(a-r)>n.CLEANUP_DELAY+1e3?(i.put(a,e.requestHash),e.broadcastResult=!0):e.handlerType="DEFER",t.complete})).then((function(){return e}));var t,i}d.onmessage=function(e){var t=e.data;if(t&&t.action&&"mimicResponse"===t.action)s(t.data)};function p(t){var i=function(e,t){var i=new CrmWidgets.Exceptions.InternalServerException;if(400===t.status||403===t.status){i=t.responseJSON||t.responseText;var r=alert;CrmWidgets.Utils.isMobileWidget()&&i&&i.constructor==={}.constructor&&i.code&&"REQUIRED_HEADER_MISSING"===i.code&&r("Kindly update your app for the feature to work")}else 401===t.status?i=new CrmWidgets.Exceptions.AuthorizationException:429===t.status&&(i=new CrmWidgets.Exceptions.LimitException);l(i,t),e(i,!0)};return{setKeySpec:function(t){if(!(t&&t instanceof Object&&t.iv&&t.secret))throw new CrmWidgets.Exceptions.InvalidKeySpec;e={iv:CryptoJS.enc.Hex.parse(t.iv),key:CryptoJS.enc.Hex.parse(t.secret),handShake:t.handShake,orgId:t["X-CRM-ORG"]}},getHandShakeToken:function(){if(e&&e instanceof Object&&e.handShake)return e.handShake},makeRequest:function(r,n,a,o,s){var d=a instanceof FormData,c={widget_id:t.ID,widget_name:encodeURIComponent(t.NAME)},g={"X-ZOHO-SERVICE":"widget","X-ZOHO-SERVICE-DETAILS":JSON.stringify(c)};if("undefined"!=typeof Crm&&void 0!==Crm.userDetails.CLIENT_PORTAL_NAME&&(g["X-CRMPORTAL"]=Crm.userDetails.CLIENT_PORTAL_NAME),"undefined"!=typeof csrfToken)g["X-ZCSRF-TOKEN"]=csrfParamName+"="+csrfToken;else if(CrmWidgets.Utils.isMobileWidget()){g.Authorization=CrmWidgets.Utils.getDeviceToken(e);var u=CrmWidgets.Utils.getMDMToken(e);u&&(g["X-MDM-TOKEN"]=u),e&&e.orgId&&(g["X-CRM-ORG"]=e.orgId)}var p={};a&&"stream"===a.RESPONSE_TYPE&&(p.responseType="blob",delete a.RESPONSE_TYPE);var m={type:r,url:n,data:a,headers:g,contentType:!d&&void 0,processData:!d&&void 0,xhrFields:p,cachedPromise:{done:o,fail:s},success:function(e,t,i){var r,n;if("string"==typeof e)try{r=jQuery.parseJSON(e)}catch(t){r=e}else r=e;if(200===i.status||201===i.status||202===i.status)n=r;else if(204===i.status){n={status:i.status,statusText:i.statusText}}n&&(l(n,i),o(n))},error:i.bind(null,s)};CrmWidgets.APIHelper.RequestPool.add({category:t.ID,context:t,obj:m})},makeAjax:function(r,n,a,o,s){var d={widget_id:t.ID,widget_name:encodeURIComponent(t.NAME)},c={"X-ZOHO-SERVICE":"widget","X-ZOHO-SERVICE-DETAILS":JSON.stringify(d)};if("undefined"!=typeof Crm&&void 0!==Crm.userDetails.CLIENT_PORTAL_NAME&&(c["X-CRMPORTAL"]=Crm.userDetails.CLIENT_PORTAL_NAME),"undefined"!=typeof csrfToken)c["X-ZCSRF-TOKEN"]=csrfParamName+"="+csrfToken;else if(CrmWidgets.Utils.isMobileWidget()){c.Authorization=CrmWidgets.Utils.getDeviceToken(e);var l=CrmWidgets.Utils.getMDMToken(e);l&&(c["X-MDM-TOKEN"]=l),e&&e.orgId&&(c["X-CRM-ORG"]=e.orgId)}var g={};a&&"stream"===a.RESPONSE_TYPE&&(g.responseType="blob",delete a.RESPONSE_TYPE);var u={type:r,url:n,data:JSON.stringify(a),processData:!1,contentType:"application/json",headers:c,xhrFields:g,success:function(e){o(e)},error:i.bind(null,s)};CrmWidgets.APIHelper.RequestPool.add({category:t.ID,context:t,obj:u})},get:function(e,t){var i=this;return new Promise((function(r,n){i.makeRequest("GET",e,t,r,n)}))},put:function(e,t){var i=this;return new Promise((function(r,n){i.makeRequest("PUT",e,t,r,n)}))},post:function(e,t){var i=this;return new Promise((function(r,n){i.makeRequest("POST",e,t,r,n)}))},del:function(e,t){var i=this;return new Promise((function(r,n){i.makeRequest("DELETE",e,t,r,n)}))},ajax:function(e,t,i){var r=this;return new Promise((function(n,a){r.makeAjax(e,t,i,n,a)}))}}}return{Exceptions:{PermissionException:function(e){this.message="Permission Denied for widget",this.code="403",this.detail=e},AuthorizationException:function(e){this.message="Authorization Exception",this.code="403",this.detail=e},LimitException:function(e){this.message="API Limit  Exception",this.code="429",this.detail=e},InternalServerException:function(e){this.message="Internal Server Error",this.code="500",this.detail=e},InvalidKeySpec:function(e){this.message="Invalid Key Sepc provided",this.code="400",this.detail=e},invalidTokenReceived:function(e){this.message="Invalid Token received",this.code="400",this.detail=e},widgetInterfaceException:function(e){this.code=e,this.Message={200:"Success",401:"Authentication Failure",404:"Invalid Module API Name",403:"Permission Denied"}[e]}},Utils:{getFrameOrigin:function(){if("undefined"!=typeof CrmPlusLib&&CrmPlusLib.isLoadedInCrmplusFrame&&CrmPlusLib.getFrameOriginForURL)return CrmPlusLib.getFrameOriginForURL()+","+window.location.origin},getCrmBasePath:function(){return Crm&&Crm.getCrmBasePath instanceof Function?Crm.getCrmBasePath():"/crm"},isMobileWidget:function(){return!!CrmWidgets.Utils.getJSInterface()},getJSInterface:function(){if("undefined"!=typeof WidgetJSInterface)return WidgetJSInterface;if(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.WidgetJSInterface){var e=prompt;return{getMDMToken:function(){var t={action:"getMDMToken",handShake:arguments[0]};return e(JSON.stringify(t))},getOauthToken:function(){var t={action:"getOauthToken",handShake:arguments[0]};return e(JSON.stringify(t))},openDetailsView:function(){var t={action:"openDetailsView",handShake:arguments[0],Entity:arguments[1],RecordID:arguments[2]};return e(JSON.stringify(t))},editRecord:function(){var t={action:"editRecord",handShake:arguments[0],Entity:arguments[1],RecordID:arguments[2]};return e(JSON.stringify(t))},addRecord:function(){var t={action:"addRecord",handShake:arguments[0],Entity:arguments[1]};return e(JSON.stringify(t))},openWebTabWidget:function(){var t={action:"openWebTabWidget",handShake:arguments[0],webTabSysRefName:arguments[1],customPageLoadData:arguments[2]};return e(JSON.stringify(t))},blueprintProceed:function(){var t={action:"blueprintProceed",handShake:arguments[0]};return e(JSON.stringify(t))},popupClose:function(){var t={action:"popupClose",handShake:arguments[0]};return e(JSON.stringify(t))},popupCloseReload:function(){var t={action:"popupCloseReload",handShake:arguments[0]};return e(JSON.stringify(t))}}}},PermissionHandler:function(e){return{authorize:function(t){if(-1===e.indexOf(t))throw new CrmWidgets.Exceptions.PermissionException({OperationPerformed:t,OperationsAllowed:e})}}},VersionHandler:function(e){return{isBeta:function(){return!e}}},DeepFreeze:function(e){return Object.getOwnPropertyNames(e).forEach((function(t){var i=e[t];null!==i&&"object"==typeof i&&CrmWidgets.Utils.DeepFreeze(i)})),Object.freeze(e)},GetTabNameFromSysRef:function(e){if(!this.SysRefVSTabName){this.SysRefVSTabName={};var t=Crm.userDetails.MODULE_LIST;for(module in t)this.SysRefVSTabName[t[module].api_name]=module}var i=this.SysRefVSTabName[e];if(i)return i},GetSysRefFromTabName:function(e){var t=Crm.userDetails.MODULE_LIST[e];if(t)return t.api_name},GetTabIDFromTabName:function(e){var t=Crm.userDetails.MODULE_LIST[e];if(t)return t.id},requestFlusher:function(e){CrmWidgets.APIHelper.RequestPool.flush((function(t){if(t.category===e)return!0}))},hideLoading:function(){$(this).removeClass("widget_Frame_loading")},forceLoadStartupWidget:function(){WidgetHandler.CustomButtons.render(WidgetHandler.WidgetConfig.Startup,{ButtonPosition:"startup"},"startup",!0)},resolveConnectorAuthorize:function(e){var t=i[e];t&&t.resolve()},rejectConnectorAuthorize:function(e){var t=i[e];t&&(t.reject("authorize failed"),delete i[e])},addConnectorAuthorizePromise:function(e,t){i[e]=t},getDeviceToken:function(e){var t;try{var i=CrmWidgets.Utils.getJSInterface().getOauthToken(e.handShake);if(!e)throw new CrmWidgets.Exceptions.InvalidKeySpec("Key Spec missing");if(!i)throw new CrmWidgets.Exceptions.invalidTokenReceived("Device Token not received");var r=CryptoJS.AES.decrypt(i,e.key,{iv:e.iv,padding:CryptoJS.pad.Pkcs7,mode:CryptoJS.mode.CBC});if(r){var n=r.toString(CryptoJS.enc.Utf8);if(n&&""!=n)return"Zoho-oauthtoken "+n}t="Device Token Decryption Failure"}catch(e){t="Device Token Decryption Failure"}throw new CrmWidgets.Exceptions.invalidTokenReceived(t)},getMDMToken:function(e){if("function"==typeof CrmWidgets.Utils.getJSInterface().getMDMToken){var t;try{var i=CrmWidgets.Utils.getJSInterface().getMDMToken(e.handShake);if(!e)throw new CrmWidgets.Exceptions.InvalidKeySpec("Key Spec missing");if(!i)return;var r=CryptoJS.AES.decrypt(i,e.key,{iv:e.iv,padding:CryptoJS.pad.Pkcs7,mode:CryptoJS.mode.CBC});if(r){var n=r.toString(CryptoJS.enc.Utf8);if(n)return n}t="Device Token Decryption Failure"}catch(e){t="Device Token Decryption Failure"}throw new CrmWidgets.Exceptions.invalidTokenReceived(t)}},GetCustomSettingsIDbyAPI:function(e){if(!this.CustomSettingsApiVsId){this.CustomSettingsApiVsId={};var t=WidgetHandler.WidgetConfig.Setup;for(widget in t)this.CustomSettingsApiVsId[t[widget].API_NAME]=widget}var i=this.CustomSettingsApiVsId[e];if(i)return i},openWebTab:function(e,t,i,r){return CrmWidgets.Utils.lyteTransitTo(t,i,"crm.tab.module.index-module",r),!0},lyteTransitTo:function(e,t,i,r){var n={route:i,dynamicParams:[e],queryParams:{widgetparams:JSON.stringify(t)}};if("_blank"===r){var a=Lyte.Router.getURL(n);networkUtils.openUrl(a,"_blank")}else Lyte.Router.transitionTo(n)},deleteEntityFromCache:function(e){if(!CrmWidgets.Utils.isMobileWidget()){var t=this.GetTabNameFromSysRef(e);crmTab.deleteFromCache(t)}},refreshNotesInUI:function(e,t){CrmWidgets.Utils.isMobileWidget()||Notes.loadNotes(t,void 0,e,"")},getAudioNotifier:function(){return this.AudioNotifier||(this.AudioNotifier=new Audio("/Platform/audio/Bell.wav")),this.AudioNotifier},getDimensionCss:function(e,t){var i={},r=/^[0-9\s]*[\s]?%/,n=t.ALLOWED_PROP;return isNaN(e.height)&&isNaN(e.width)?(r.test(e.height)||r.test(e.width))&&(-1!==n.indexOf("HEIGHT")&&r.test(e.height)&&(i.height=parseInt(e.height.replace("%"))/100,i.height*=window.innerHeight),-1!==n.indexOf("WIDTH")&&r.test(e.width)&&(i.width=parseInt(e.width.replace("%"))/100,i.width*=window.innerWidth)):(-1!==n.indexOf("HEIGHT")&&(void 0!==t.MAX_HEIGHT?i.height=e.height<=t.MAX_HEIGHT?e.height:t.MAX_HEIGHT:i.height=e.height),-1!==n.indexOf("WIDTH")&&(void 0!==t.MAX_WIDTH?i.width=e.width<=t.MAX_WIDTH?e.width:t.MAX_WIDTH:i.width=e.width)),i}},APIHelper:{APISpec:{AddNotes:"/crm/v2/{0}/{1}/Notes",AttachFileToNotes:"/crm/v2/Notes/{2}/Attachments",AddAttachment:"/crm/v2/{0}/{1}/Attachments",InsertRecord:"/crm/v2/{0}",UpsertRecord:"/crm/v2/{0}/upsert",GetRecordById:"/crm/v2/{0}/{1}",GetAllRecord:"/crm/v2/{0}",GetMultipleRecord:"/crm/v2/{0}",UpdateRecord:"/crm/v2/{0}",DeleteRecord:"/crm/v2/{0}/{1}",DeleteRecords:"/crm/v2/{0}",queryRecord:"/crm/v2/coql",roles:"/crm/v2/settings/roles",specificRole:"/crm/v2/settings/roles/{0}",SearchRecord:"/crm/v2/{0}/search",InvokeConnector:"/market/api/connectorAPI/execute.do?nameSpace={0}",InvokeCrmConnection:"/crm/v2/connections/{0}/actions/invoke",ExecuteFunction:"/crm/v2/functions/{0}/actions/execute",GetOrgVariable:"/market/api/getOrgVariable.do?orgVariable={0}",GetUsers:"/crm/v2/users",GetUser:"/crm/v2/users/{0}",GetOrgInfo:"/crm/v2/org",GetRelatedRecords:"/crm/v2/{0}/{1}/{2}",GetRelatedRecords_email:"/crm/v2/{0}/{1}/{2}/{3}",UpdateRelatedList:"/crm/v2/{0}/{1}/{2}/{3}",UpdateRelatedList_photo:"/crm/v2/{0}/{1}/{2}",GetFields:"/crm/v2/settings/fields?module={0}",GetModuleList:"/crm/v2/settings/modules",GetAssignmentRules:"/crm/v2/settings/assignment_rules/{0}",GetLayouts:"/crm/v2/settings/layouts?module={0}",GetLayout:"/crm/v2/settings/layouts/{0}?module={1}",GetRelatedList:"/crm/v2/settings/related_lists?module={0}",GetCustomViews:"/crm/v2/settings/custom_views?module={0}",GetCustomView:"/crm/v2/settings/custom_views/{0}?module={1}",GetEmailFromAliases:"/crm/v2/settings/emails/from_aliases",GetAllProfiles:"/crm/v2/settings/profiles",GetProfile:"/crm/v2/settings/profiles/{0}",UpdateProfile:"/crm/v2/settings/profiles/{0}",EnableAccountAccess:"/crm/enableAccountAccess.do",Blueprint:"/crm/v2/{0}/{1}/actions/blueprint",ZfsFile:"/crm/v2/files",ViewAllActions:"/crm/v2/{0}/{1}/actions",GetApprovalRecords:"/crm/v2/Approvals",GetApprovalActions:"/crm/v2/{0}/{1}/actions/approvals?action={2}",GetAuthorizeUrl:"/market/getConnectorAuthorizeMap.do?connectorNS={0}",GetRevokeUrl:"/market/revokeAuthToken.do?connectorNS={0}",GetSendmailUrl:"/crm/v2/{0}/{1}/actions/send_mail",UpdateVoiceURL:"/crm/v2/phonebridge/voiceurl?callactivityid={0}&voiceurl={1}"},generatorURL:function(){for(var e=arguments[0],t=arguments.length,i=0;i<t-1;i+=1){var r=new RegExp("\\{"+i+"\\}","gm");e=e.replace(r,arguments[i+1])}return e},RequestPool:new $.ZReqPool({Worker:function(e,i){var s,l=e.obj;s=e&&e.context&&e.context.CONFIG&&"21"==e.context.CONFIG.TYPE?function(e){var t,i=JSON.stringify({data:e.data,type:e.type,url:e.url});if("SHA-256"===n.HASHING_METHOD)t=c("SHA-256",i);else{var r=0,a=i.length,o=0;if(a>0)for(;o<a;)r=(r<<5)-r+i.charCodeAt(o++)|0;t=Promise.resolve(r)}return t}(l):Promise.resolve(void 0),s.then((function(t){var i=e.obj;return i.beforeSend=function(){"undefined"!=typeof Crm&&Crm.REQUEST_QUEUE&&delete Crm.REQUEST_QUEUE[this.url+"---"+this.data]},{handlerType:"REG",broadcastResult:!1,request:i,context:e.context.CONFIG,requestHash:t,WBC:d}})).then(u).then((function(e){var s=e.handlerType,d=e.broadcastResult,c=e.request,l=e.requestHash,u=e.WBC;if("REG"===s){var p=c.success,m=c.error;c.success=void 0,c.error=void 0;var f=$.ajax(c);if(f.done(p).fail(m).always((function(){i()})),d){var h,C=g.bind(u);f.done((function(){var e=arguments[0],t=arguments[2];204===t.status&&(e={status:t.status,statusText:t.statusText}),h={status:"DONE",requestHash:l,response:e}})).fail((function(){h={status:"FAIL",requestHash:l,response:arguments[0].responseJSON}})).always((function(){var e,t,i;(e=function(){C(h)},t=a.REPETITION,i=a.INTRAVEL,new Promise((function(r,n){var a,o=1;a=setInterval((function(){try{o>t&&(clearInterval(a),r()),o++,e()}catch(e){n(e)}}),i)}))).then((function(){var e=h;o.then((function(e){var t=e.transaction(r.OBJECT_STORE_NAME,"readwrite");return t.objectStore(r.OBJECT_STORE_NAME).delete(l),t.complete})).then((function(){C(e)}))}))}))}}else if("DEFER"===s){var I=(new Date).getTime(),E={cachedPromise:c.cachedPromise,timeStamp:I};t[l]=t[l]||[],t[l].push(E);var v=setTimeout((function(){t[l]=t[l].filter((function(e){return e.timeStamp!==I||(e.cachedPromise.fail({Error:"Request Timed Out"}),!1)}))}),n.CLEANUP_DELAY);E.setTimeoutID=v,i()}}))}}),getRequester:function(e){return new p(e)},Requester:function(e){return p(e)}}}}();function loadRecordTransition(e,t){var i=window.location.pathname,r=Lyte.Router.getRoute(i),n=r.dynamicParams;n.length>0&&null!=n[1]&&n[1]==e.RecordID&&r.route===t.route?Lyte.Router.getRouteInstance().refresh():Lyte.Router.transitionTo(t)}function makeAPIDataJson(e,t){var i="users"===e?"users":"data",r={},n=t.trigger;return n&&(delete t.trigger,r.trigger=n),t instanceof Array||(t=[t]),r[i]=t,r}CrmWidgets.Utils.DeepFreeze(CrmWidgets.APIHelper),Object.defineProperties(window,{CrmWidget:{enumerable:!0,value:{Telephony:void 0,Detail:void 0,RelatedList:void 0}}}),Object.defineProperties(window,{WidgetHandler:{enumerable:!0,value:{WidgetConfig:void 0,SetConfig:function(e){Object.defineProperty(WidgetHandler,"WidgetConfig",{value:e,writable:!1,enumerable:!0,configurable:!1}),CrmWidgets.Utils.DeepFreeze(WidgetHandler.WidgetConfig)},getWidget:function(e,t){if(WidgetHandler&&WidgetHandler.WidgetConfig&&WidgetHandler.WidgetConfig[e]){var i=WidgetHandler.WidgetConfig[e];return t?i[t]:i}},getWidgetById:function(e,t){if(WidgetHandler&&WidgetHandler.WidgetConfig&&WidgetHandler.WidgetConfig[e]){var i=WidgetHandler.WidgetConfig[e];for(key in i)if(i[key].ID===t)return i[key]}},loadWidgets:function(e){var t=e.moduleID,i=e.paramsID,r=e.urlModule,n="undefined"!=typeof WidgetHandler?WidgetHandler.getWidget("RecordViewBC",t):void 0;if(n){var a={Entity:CrmWidgets.Utils.GetSysRefFromTabName(r),EntityId:i};WidgetHandler.Record.render(n,a)}}}}}),WidgetHandler.Telephony={render:function(){var e=WidgetHandler.getWidget("Telephony"),t="widgetTelephony";if(e&&(CrmWidget.Telephony=ZApp.LoadApp({uniqueID:t,location:t,url:e.START_URL,config:e,frame_origin:CrmWidgets.Utils.getFrameOrigin(),onload:function(){WidgetHandler.EventNotifier.pageLoad(CrmWidget.Telephony,{})},onunload:function(){CrmWidgets.Utils.requestFlusher(e.ID)}}),$("#chatBarIcons").length>0)){$("#chatBarIcons tr:first").prepend("<td id='widgetIcon'><div style='border-left: 1px solid #ddd;padding: 2px 3px;' class='cP widgetIcon' onmouseenter='crmui.toolTip_show(this,\"center\",\"Telephony\")' onmouseleave='crmui.hideTooltip(this)' onclick='WidgetHandler.Telephony.toggle()' data-title='Telephony'><div class='telephony_Dialer_icon'></div></td>")}},hide:function(){$("#widget_Panel").hide()},show:function(){CrmWidget.Telephony&&$("#widget_Panel").show()},toggle:function(e){$("#widget_Panel").is(":visible")?this.hide():(CrmWidget.Telephony.SendEvent("DialerActive",e||{}),this.show())}},WidgetHandler.StandAlone={render:function(){var e=WidgetHandler.getWidget("StandAlone"),t="widgetStandAlone";e&&(CrmWidget.StandAlone=ZApp.LoadApp({uniqueID:t,location:t,url:e.START_URL,config:e,frame_origin:CrmWidgets.Utils.getFrameOrigin(),onunload:function(){CrmWidgets.Utils.requestFlusher(e.ID)}}))}},WidgetHandler.CustomAction={render:function(e,t){var i="Widget_Frame_CustomAction"+e.ID,r=document.createElement("iframe");(r=$(r)).addClass("widget_Frame_CustomAction"),r.attr("id",i),r.attr("allow","geolocation; microphone; camera; midi; encrypted-media"),$("#actionOption").html(r[0]).show(),crmui.showPopup("commonActionPage"),CrmWidget.CustomActions=ZApp.LoadApp({uniqueID:i,location:i,url:e.START_URL,config:e,frame_origin:CrmWidgets.Utils.getFrameOrigin(),onload:function(){WidgetHandler.EventNotifier.pageLoad(CrmWidget.CustomActions,t)},onunload:function(){CrmWidgets.Utils.requestFlusher(e.ID)}})}},WidgetHandler.SalesSignals={show:function(e,t){var i=e.signal,r=e.id,n=i.id,a=crmNTCGlobal.getPageLoadDataForWidget(e,t),o=WidgetHandler.WidgetConfig.SalesSignals[n];if(o.ISACTIVE){var s="signalPlatformIframeContent_"+r,d=$(s);d.attr("id",s),d.load(CrmWidgets.Utils.hideLoading),CrmWidget.SalesSignals||(CrmWidget.SalesSignals={}),CrmWidget.SalesSignals[n]=ZApp.LoadApp({uniqueID:s,location:s,url:o.START_URL,config:o,frame_origin:CrmWidgets.Utils.getFrameOrigin(),onload:function(){WidgetHandler.EventNotifier.pageLoad(CrmWidget.SalesSignals[n],a)},onunload:function(){CrmWidgets.Utils.requestFlusher(o.ID)}})}else $("#ntcPlatformIframeWrap_"+r).html('<table class="borderCollapse h100p w100p"><tr><td class="vam txt-ctr color7">'+I18n.getMsg("crm.label.widgets.error.feature.unsupported")+"</td></tr></table>").addClass("h150").css("border","1px solid #e9e9e9")},render:function(e,t,i){if(e.ISACTIVE){$("#SignalWidgetPopup").css({"z-index":249}),freezeBackground(),$("#FreezeLayer").css({display:"block",opacity:".1","z-index":31});var r="signalWidgetPopFrame_"+e.ID,n=document.createElement("iframe");(n=$(n)).addClass("signal_Widget_Frame_Popup"),n.addClass("widget_Frame_loading"),n.attr("id",r),n.attr("allow","geolocation; microphone; camera; midi; encrypted-media"),$("#signalWidgetPopupTitle").text(e.NAME),$("#SignalWidgetPopUpRespContent").html(n[0]),n.load(CrmWidgets.Utils.hideLoading),CrmWidget.SalesSignals||(CrmWidget.SalesSignals={}),CrmWidget.SalesSignals[i]=ZApp.LoadApp({uniqueID:r,location:r,url:e.START_URL,config:e,frame_origin:CrmWidgets.Utils.getFrameOrigin(),onload:function(){WidgetHandler.EventNotifier.pageLoad(CrmWidget.SalesSignals[i],t)},onunload:function(){CrmWidgets.Utils.requestFlusher(e.ID)}})}else{var a=$("#SignalWidgetPopUpRespContent");$("#SignalWidgetPopup .popup-model-header.f21").text(e.NAME),a.html('<table class="borderCollapse h100p w100p"><tr><td class="vam txt-ctr color7">'+I18n.getMsg("crm.label.widgets.error.feature.unsupported")+"</td></tr></table>"),a.addClass("widget_Frame_Popup").css({position:"absolute","min-height":"160px",background:"#fff"})}setTimeout((function(){var e=$("#SignalWidgetPopup");e.addClass("zcrm-show"),freezeBackground(),e.show()}),150)},close:function(){var e=$("#SignalWidgetPopup");e.removeClass("zcrm-show"),e.hide(),$("#SignalWidgetPopUpRespContent").empty(),removeFreezeLayer()}},WidgetHandler.Popup={render:function(e,t,i,r){if(e.ISACTIVE){var n="widget_popup_"+e.ID,a=document.createElement("iframe");a=$(a),r?a.addClass("popup_flyout_dim widget_Frame_loading"):a.addClass("popup_widget_dim widget_Frame_loading"),a.attr({id:n,allow:"geolocation; microphone; camera; midi; encrypted-media"}),a.load(CrmWidgets.Utils.hideLoading),i.height&&a.css("height",i.height),i.width&&a.css("width",i.width),$(r?".CSflyoutCont":".CSwidgetCont").html(a[0]),CrmWidget.Popup=ZApp.LoadApp({uniqueID:n,location:n,url:e.START_URL,config:Object.assign({_type:r?"CScriptFlyout":"CScriptWidget"},e),frame_origin:CrmWidgets.Utils.getFrameOrigin(),onload:function(){WidgetHandler.EventNotifier.pageLoad(CrmWidget.Popup,t)},onunload:function(){CrmWidgets.Utils.requestFlusher(e.ID)}});var o=document.querySelector("crm-cscript").component;o.widget(r).apply(Object.assign({header:e.NAME},i,{id:n})),o.widget(r).display()}},close:function(e,t){var i=document.querySelector("crm-cscript").component;if(i.widget(t).applyDefaults(),i.widget(t).display(!1),$(t?".CSflyoutCont":".CSwidgetCont").html(""),e){var r=Lyte.Router.getRouteInstance().transition.info.route;["crm.tab.module.entity.detail","crm.tab.module.entity.canvas"].includes(r)?reloadCurrentEntityView():["crm.tab.module.custom-view.list","crm.tab.module.custom-view.kanban","crm.tab.module.custom-view.canvas"].includes(r)&&crmListView.reloadCurrentListView()}}},WidgetHandler.CustomButtons={render:function(e,t,i,r){if(e.ISACTIVE||"0"===e.TYPE){if(!e.ISACTIVE&&!r)return;var n,a="widgetPopFrame"+e.ID,o=document.createElement("iframe");if((o=$(o)).addClass("widget_Frame_Popup"),o.addClass("widget_Frame_loading"),o.attr("id",a),o.attr("allow","geolocation; microphone; camera; midi; encrypted-media"),CrmWidgets.Utils.isMobileWidget()&&o.attr("sandbox","allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts allow-top-navigation-by-user-activation"),$("#CBWidgetPopUpRespContent").html(o[0]),$("#CBWidgetPopUp .popup-model-header.f21").text(e.NAME),$("#CBWidgetExecutedPage").val(i),o.load(CrmWidgets.Utils.hideLoading),e.dimensionSpec){var s=CrmWidgets.Utils.getDimensionCss(e,e.DIMENSION);o.css(s)}switch(i){case"eachRecord":n="ListViewEachRecord";break;case"listView":n="ListView";break;case"withoutRecord":n="ListViewWithoutRecord";break;case"view":case"viewEntity":n="DetailView";break;case"edit":case"cbedit":n="EditView";break;case"create_clone":case"createclone":n="CreateOrCloneView";break;case"startup":n="StartUp",$("#CBWidgetPopUp .widgetPopup").addClass("startupWidget"),$(".startupWidget .newPopupCloseIcon").hide()}t.ButtonPosition=n,CrmWidget.CustomButton=ZApp.LoadApp({uniqueID:a,location:a,url:e.START_URL,config:e,frame_origin:CrmWidgets.Utils.getFrameOrigin(),onload:function(){WidgetHandler.EventNotifier.pageLoad(CrmWidget.CustomButton,t)},onunload:function(){CrmWidgets.Utils.requestFlusher(e.ID)}})}else{$("#CBWidgetPopUp .popup-model-header.f21").text(e.NAME);var d=$("#CBWidgetPopUpRespContent");d.html('<table class="borderCollapse h100p w100p"><tr><td class="vam txt-ctr color7">'+I18n.getMsg("crm.label.widgets.error.feature.unsupported")+"</td></tr></table>"),d.addClass("widget_Frame_Popup").css({position:"absolute","min-height":"160px",background:"#fff"})}setTimeout((function(){if(!CrmWidgets.Utils.isMobileWidget()){var e=$("#CBWidgetPopUp"),t=renderingUtils.windowHeight;e.addClass("zcrm-show"),e.css("max-height",t-30+"px"),freezeBackground(),"startup"!==i&&($("#CBWidgetPopUp .widgetPopup").removeClass("startupWidget"),$("#CBWidgetPopUp .newPopupCloseIcon").show()),e.show()}}),150)},close:function(e){if($("#multipleFieldsEditPop").is(":visible"))return ProcessFlow.validateAndClosePopUp(),removeFreezeLayer(),void(e&&reloadCurrentEntityView());var t=$("#CBWidgetPopUp");if(t.removeClass("zcrm-show"),t.hide(),$("#CBWidgetPopUpRespContent").empty(),removeFreezeLayer(),e){var i=null,r=$("#CBWidgetExecutedPage");r&&(i=r.val()),"viewEntity"===i||"relatedlist"===i?("undefined"!=typeof CustomButtonJSObjectInit&&(CustomButtonJSObjectInit.checkBox={}),reloadCurrentEntityView()):"eachRecord"!==i&&"listView"!==i||crmListView.reloadCurrentListView()}}},WidgetHandler.Settings={render:function(e,t){var i=WidgetHandler.getWidget("Settings",t);if(i){var r=$("#settingWidgetContainer"),n="settingsWidget_"+i.ID,a=document.createElement("iframe");if(a.id=n,1===i.SOURCE){var o=renderingUtils.windowHeight-r.offset().top-28;a.setAttribute("style","background: #fff; width: 100%; border: none; height: "+o+"px"),a.setAttribute("class","widget_Frame_settings widget_Frame_loading"),$(a).load(CrmWidgets.Utils.hideLoading)}else a.setAttribute("class","widget_Frame_settings");$("#ExtensionName").html(e+" - Settings"),a.setAttribute("allow","geolocation; microphone; camera; midi; encrypted-media"),r.html(a),setTimeout((function(){crmLayout.Resize.Setup()}),0),CrmWidget.Settings=ZApp.LoadApp({uniqueID:n,location:n,url:i.START_URL,config:i,frame_origin:CrmWidgets.Utils.getFrameOrigin(),onload:function(){WidgetHandler.EventNotifier.pageLoad(CrmWidget.Settings,{})},onunload:function(){CrmWidgets.Utils.requestFlusher(i.ID)}}),$(".pluginMainDiv #pluginPageContent").hide(),$("#setUp_widget_Panel").show()}else crmui.showMsgBand("error",I18n.getMsg("crm.label.creator.noaccess"),4e3,""),Utils.windowLocationHref(CrmWidgets.Utils.getCrmBasePath()+"/settings/index")},close:function(){$("#myPluginList, #componentTable").length>=1?($("#setUp_widget_Panel").hide(),$(".pluginMainDiv #pluginPageContent").show(),$("#setupWidget").attr("src","")):backToExtensionListOldFlow()}},WidgetHandler.Record={render:function(e,t){var i,r;"29"===e.TYPE?(i="#fullInfoDiv",r="widget_Frame_RecordView"):"28"===e.TYPE||"27"===e.TYPE?(i="#show",r="widget_Frame_RecordEdit"):"27"===e.TYPE?(i="#bcWraperDiv",r="widget_Frame_RecordBC"):"30"===e.TYPE&&(i="#widget_businessCard",r="widget_businessCard");var n=document.createElement("iframe"),a=r+"_"+e.ID;if(n.id=a,"28"===e.TYPE||"27"===e.TYPE){var o=renderingUtils.windowHeight,s=$("#mainMenuTabDiv").height(),d=$("#wms-chatwindowcontainer").height(),c=o-(s+(d||0));n.setAttribute("style","height:"+c+"px;")}return n.setAttribute("class",r),n.setAttribute("allow","geolocation; microphone; camera; midi; encrypted-media"),$(i).html(n),commonUtils.showHideLoadingDiv(),CrmWidget.Record||(CrmWidget.Record={}),CrmWidget.Record[a]=ZApp.LoadApp({uniqueID:a,location:a,url:e.START_URL,config:e,frame_origin:CrmWidgets.Utils.getFrameOrigin(),onload:function(){WidgetHandler.EventNotifier.pageLoad(CrmWidget.Record[a],t)},onunload:function(){CrmWidgets.Utils.requestFlusher(e.ID)}}),$("#widget_Record").show(),n},close:function(){$("#widget_Record").hide(),$("#widgetRecord").attr("src","")}},WidgetHandler.RelatedList={render:function(e,t,i,r){if(e.ISACTIVE){var n="RelatedList_"+t,a=document.createElement("iframe");(a=$(a)).attr("id",n),r?a.addClass("widget_Frame_relatedList_canvas"):a.addClass("widget_Frame_relatedList"),a.addClass("widget_Frame_loading"),a.attr("allow","geolocation; microphone; camera; midi; encrypted-media"),CrmWidgets.Utils.isMobileWidget()&&a.attr("sandbox","allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts allow-top-navigation-by-user-activation");var o=$("#customRelatedListDiv_"+t);if(r?o.html(a[0]):o.html(a[0]).css({"max-height":"700px"}),a.load(CrmWidgets.Utils.hideLoading),e.dimensionSpec&&!r){var s=CrmWidgets.Utils.getDimensionCss(e,e.DIMENSION);a.css(s)}CrmWidget.RelatedList||(CrmWidget.RelatedList={}),CrmWidget.RelatedList[t]=ZApp.LoadApp({uniqueID:n,location:n,url:e.START_URL,config:e,frame_origin:CrmWidgets.Utils.getFrameOrigin(),onload:function(){WidgetHandler.EventNotifier.pageLoad(CrmWidget.RelatedList[t],i)},onunload:function(){CrmWidgets.Utils.requestFlusher(e.ID)}})}else $("#customRelatedListDiv_"+t).html('<table class="borderCollapse h100p w100p"><tr><td class="vam txt-ctr color7">'+I18n.getMsg("crm.label.widgets.error.feature.unsupported")+"</td></tr></table>").addClass("h150").css("border","1px solid #e9e9e9")}},WidgetHandler.Wizard={render:function(e,t,i){var r=$("#"+t),n="undefined"!=typeof WidgetHandler?WidgetHandler.getWidget("Wizard",e):void 0,a=n.ID;if(n)if(n.ISACTIVE){var o="WidgetFrame_"+a,s=document.createElement("iframe");(s=$(s)).attr({id:o,frameborder:"0",height:"100%",allow:"geolocation; microphone; camera; midi; encrypted-media",width:"100%"}),s.addClass("widget_Frame_Wizard widget_Frame_loading"),r.html(s[0]),s.load(CrmWidgets.Utils.hideLoading),CrmWidget.Wizard||(CrmWidget.Wizard={}),CrmWidget.Wizard[a]=ZApp.LoadApp({uniqueID:o,location:o,url:n.START_URL,config:n,frame_origin:CrmWidgets.Utils.getFrameOrigin(),onload:function(){WidgetHandler.EventNotifier.pageLoad(CrmWidget.Wizard[a],i||{})},onunload:function(){CrmWidgets.Utils.requestFlusher(a)}})}else r.html('<table class="borderCollapse h100p w100p"><tr><td class="vam txt-ctr color7">'+I18n.getMsg("crm.label.widgets.error.feature.unsupported")+"</td></tr></table>")}},WidgetHandler.Blueprint={render:function(e,t,i,r){var n,a=$("#"+t),o=(n=r||("undefined"!=typeof WidgetHandler?WidgetHandler.getWidget("Blueprint",e):void 0)).ID;if(n)if(n.ISACTIVE){var s="WidgetFrame_"+o,d=document.createElement("iframe");(d=$(d)).attr({id:s,frameborder:"0",height:"100%",allow:"geolocation; microphone; camera; midi; encrypted-media",width:"100%"}),d.addClass("widget_Frame_Blueprint widget_Frame_loading"),a.html(d[0]),d.load(CrmWidgets.Utils.hideLoading),CrmWidget.Blueprint||(CrmWidget.Blueprint={}),CrmWidget.Blueprint[o]=ZApp.LoadApp({uniqueID:s,location:s,url:n.START_URL,config:n,frame_origin:CrmWidgets.Utils.getFrameOrigin(),onload:function(){WidgetHandler.EventNotifier.pageLoad(CrmWidget.Blueprint[o],i||{})},onunload:function(){CrmWidgets.Utils.requestFlusher(o)}})}else a.html('<table class="borderCollapse h100p w100p"><tr><td class="vam txt-ctr color7">'+I18n.getMsg("crm.label.widgets.error.feature.unsupported")+"</td></tr></table>")}},WidgetHandler.HomePage={render:function(e){var t=$("#widget_"+e);t.attr("style","width:98%;height:88%;");var i="undefined"!=typeof WidgetHandler?WidgetHandler.getWidgetById("HomePage",e):void 0;if(i)if(i.ISACTIVE){var r="WidgetFrame_"+e,n=document.createElement("iframe");(n=$(n)).attr("id",r),n.attr("frameborder","0"),n.attr("height","100%"),n.attr("width","100%"),n.addClass("widget_Frame_homePage"),n.addClass("widget_Frame_loading"),n.attr("allow","geolocation; microphone; camera; midi; encrypted-media"),t.html(n[0]),n.load(CrmWidgets.Utils.hideLoading),CrmWidget.HomePage||(CrmWidget.HomePage={}),CrmWidget.HomePage[e]=ZApp.LoadApp({uniqueID:r,location:r,url:i.START_URL,config:i,frame_origin:CrmWidgets.Utils.getFrameOrigin(),onload:function(){WidgetHandler.EventNotifier.pageLoad(CrmWidget.HomePage[e])},onunload:function(){CrmWidgets.Utils.requestFlusher(i.ID)}})}else t.html('<table class="borderCollapse h100p w100p"><tr><td class="vam txt-ctr color7">'+I18n.getMsg("crm.label.widgets.error.feature.unsupported")+"</td></tr></table>")}},WidgetHandler.WebTab={render:function(e,t,i){if(!0===e.FREEZE){var r=$("#crmPopContent");r[0].src?WidgetHandler.EventNotifier.pageLoad(CrmWidget.FreezeWidget,i||{}):CrmWidget.FreezeWidget=ZApp.LoadApp({uniqueID:"crmPopContent",location:"crmPopContent",url:e.START_URL,config:e,frame_origin:CrmWidgets.Utils.getFrameOrigin(),onload:function(){CrmWidget.currentWidget="FreezeWidget",i=i||WidgetHandler.Utils.fetchHistoryStateParam(),WidgetHandler.EventNotifier.pageLoad(CrmWidget.FreezeWidget,i||{})},onunload:function(){CrmWidgets.Utils.requestFlusher(e.ID),delete CrmWidget.currentWidget}}),r[0].allow||r[0].setAttribute("allow","geolocation; microphone; camera; midi; encrypted-media"),r.removeClass("hide")}else{var n="externalIframe_"+e.ID;1!==e.SOURCE&&isNaN(t)||(t="");var a="#"+n;$(a).load(CrmWidgets.Utils.hideLoading);var o=$(a)[0];o.allow||o.setAttribute("allow","geolocation; microphone; camera; midi; encrypted-media");var s=e.START_URL+t;CrmWidget.WebTab=ZApp.LoadApp({uniqueID:n,location:n,url:s,config:e,frame_origin:CrmWidgets.Utils.getFrameOrigin(),onload:function(){CrmWidget.currentWidget="WebTab",i=i||WidgetHandler.Utils.fetchHistoryStateParam(),WidgetHandler.EventNotifier.pageLoad(CrmWidget.WebTab,i||{})},onunload:function(){CrmWidgets.Utils.requestFlusher(e.ID),delete CrmWidget.currentWidget}})}}},WidgetHandler.SetupWidget={render:function(e,t){var i=WidgetHandler.getWidget("Settings",t);if(i){var r=$("#settingWidgetContainer"),n="settingsWidget_"+i.ID,a=document.createElement("iframe");a.id=n,a.setAttribute("style","border: none;width: 100%;height:100%;float:left;"),a.setAttribute("allow","geolocation; microphone; camera; midi; encrypted-media"),r.html(a),setTimeout((function(){crmLayout.Resize.Setup()}),0),CrmWidget.Setup=ZApp.LoadApp({uniqueID:n,location:n,url:i.START_URL,config:i,frame_origin:CrmWidgets.Utils.getFrameOrigin(),onload:function(){CrmWidget.currentWidget="Setup";var e=WidgetHandler.Utils.fetchHistoryStateParam();WidgetHandler.EventNotifier.pageLoad(CrmWidget.Setup,e||{})},onunload:function(){CrmWidgets.Utils.requestFlusher(i.ID),delete CrmWidget.currentWidget}}),$("#setUp_widget_Panel").show()}else crmui.showMsgBand("error",I18n.getMsg("crm.label.creator.noaccess"),4e3,""),Utils.windowLocationHref(CrmWidgets.Utils.getCrmBasePath()+"/settings/index")}},WidgetHandler.Utils={getRequestParams:function(e){var t=[],i={},r=location.search;if(r&&""!==r)for(var n=r.substr(1).split("&"),a=n.length,o=0;o<a;o++){var s=(t=n[o].split("="))[0],d=decodeURIComponent(t[1]);if(e){if(s===e)return d}else i[s]=d}return i},readForm:function(){var e=Lyte.registeredMixins["crm-create-mixin"].getLyteCreateComponentForCscript();if(e){var t=Lyte.registeredMixins["crm-create-mixin"].cscriptReadFormClientHandler(e);for(var i in t=(t=t?t.Data:t)||{})null===t[i]&&(t[i]=void 0);return{Data:t}}var r=$("form[name='createEntityNewForm']")[0],n=$(r).find("[data-sysRefName]").not(".subformTabl [data-sysRefName]"),a=WidgetHandler.Utils.fieldData(n),o=$(r).find(".subformTabl");o.length>0&&$.each(o,(function(e,t){var i=t.getAttribute("sub-data"),r=$(t).find("tbody tr"),n="true"===$(t).attr("islineitemsf"),o=[];$.each(r,(function(){var e=$(this).find("[data-sysRefName]"),t=WidgetHandler.Utils.fieldData(e);n&&t&&t.Product_Name&&t.Product_Name.name&&(t.Product_Id=t.Product_Name.id,t.Product_Name=t.Product_Name.name),o.push(t)})),a[i]=o}));var s={hdnProductId:"ID",txtProduct:"Name",itemDescription:"Description",txtListPrice:"ListPrice",hdnUnitPrice:"UnitPrice",txtQty:"NewQuantity",hdnOldQty:"OldQuantity",hdnQtyStock:"InStock",discount:"Discount",discPc:"DiscountPerItem",discount:"Discount",tax:"Tax",prdTaxDet:"TaxDetection",netTotal:"Total"},d=$("#linesTbody tr"),c=[];$.each(d,(function(e,t){var i=(t=$(t)).attr("id").replace("hrow",""),r=t.find("input"),n={};$.each(r,(function(e,t){var r=(t=$(t)).attr("id").replace(i,""),a=s[r],o=t.val();a&&(n[a]=o)})),c.push(n)}));var l={Data:a};return c&&c.length>0&&(l.LineItems=c),l},fieldData:function(e){var t={};return $.each(e,(function(e,i){var r,n=(i=$(i)).attr("data-sysRefName");if(i){var a=i.prop("type"),o=i.attr("data-content-type");switch(a){case"text":case"textarea":if("Lookup"===o){var s=i.val(),d=i.data("id");s&&""!==s&&d&&""!==d&&((r={}).name=s,r.id=d)}else r=i.val();break;case"checkbox":r=i.is(":checked");break;default:r=i.val()}}r=""===r?void 0:r,t[n]=r})),t},populateForm:function(e){var t,i,r=["First_Name"];if(e.$data){if(t=e.$data,(i=e.$lineItems)&&i.length>0&&Crm.isInventoryModule(Lyte.Router.getRouteInstance("crm.tab.module").getDynamicParam())){var n=i[0],a=$("[islineitemsf=true]");a.length>0&&(t[a.eq(0).attr("sub-data")]=[{Product_Name:{id:n.PRODUCTID,name:n.PRODUCTNAME},Quantity:n.QUANTITY,Product_Code:n.PRODUCTCODE,List_Price:n.UNITPRICE,Discount:n.DISCOUNT,Qty_in_Stock:n.QUANTITY_IN_STOCK}])}}else t=e;var o=Lyte.registeredMixins["crm-create-mixin"].getLyteCreateComponentForCscript();if(o)Lyte.registeredMixins["crm-create-mixin"].formHandlerWrapperForLyteConversion(o,t);else if(t){var s=$("#subFrmaddRowBtn");jQuery.each(t,(function(e,t){var i=$("table[sub-data='"+e+"']");if(i.length>0){var n=i.attr("id").split("_")[1];crmTemplate.resetSubformRows(n);for(var a=crmCommonModule.createEditJson.module,o=t.length,d="true"===i.attr("islineitemsf"),c=1;c<o;c++)crmTemplate.addSubFromRow(s,n,a,"2");var l=i.find("tbody tr");$.each(l,(function(i,r){for(objKey in t[i]){var n=$(r).find("[data-sysRefName='"+objKey+"']")[0];d&&"Product_Name"===objKey&&(productDetails.setPrdDetailsForWidget(n,t[i]),t[i].Product_Name.name=$(n).data("lineitemprodcode")&&t[i].Product_Code?t[i].Product_Name.name+" ("+t[i].Product_Code+")":t[i].Product_Name.name),WidgetHandler.Utils.addFieldValues(e,t[i][objKey],n)}}))}else{var g;(g=r.includes(e)?$("[data-sysRefName='"+e+"'][data-content-type='Text']")[0]:$("[data-sysRefName='"+e+"']")[0])&&WidgetHandler.Utils.addFieldValues(e,t,g)}}))}},addFieldValues:function(e,t,i){var r=(i=$(i)).prop("type"),n=i.attr("data-content-type");switch(r){case"text":if("Lookup"===n){if(t.constructor===Object){var a=t.id,o=t.name;i.data("id",a),i.val(o)}}else if("DateTime"===n){var s=new CrmDate(t);i.val(s.getDateInUserPattern()),$("#"+i.attr("id")+"_TimeOption").val(s.getTimeInUserPattern())}else i.val(t),renderingUtils.triggerEvent("change",i);break;case"textarea":"Lookup"===n?t.constructor===Object&&(i.data("id",t.id),i.val(t.name),renderingUtils.triggerEvent("change",i)):i.val(t);break;case"checkbox":"boolean"==typeof t&&i.prop("checked",t);break;case"select-multiple":Array.isArray(t)&&(populatePicklist(i,t),i.val(t),renderingUtils.triggerEvent("change",i));break;case"select-one":"string"==typeof t&&(populatePicklist(i,[t]),i.val(t),renderingUtils.triggerEvent("change",i))}},resize:function(e,t,i){e=e instanceof HTMLElement?$(e):$("#"+e.id);var r=t.height,n=t.width,a=t.hideParent;e.css({transition:"all .8s ease","-webkit-transition":"all .8s ease"});var o=function(t,i,r){var n={};void 0!==t&&(n.width=t+"px"),void 0!==i&&(n.height=i+"px"),r&&(t>0?(freezeBackground(),n.display="block"):($("#FreezeLayer").remove(),n.display="none")),e.css(n)}.bind(void 0,n,r,i);if(void 0!==a){var s=e.parent();a?s.slideUp("slow","swing",o):(o(),s.slideDown("slow","swing"))}else o()},playSound:function(){CrmWidgets.Utils.getAudioNotifier().play()},loadDetailPage:function(e){if(e.Entity&&e.RecordID){var t={route:"crm.tab.module.entity.detail",dynamicParams:[e.Entity,e.RecordID]};if("Calls"!==e.Entity&&"Tasks"!==e.Entity&&"Events"!==e.Entity||(t.dynamicParams=["Activities",e.RecordID],t.queryParams={sub_module:e.Entity}),e.target&&"_blank"===e.target){var i=Lyte.Router.getURL(t);networkUtils.openUrl(i,"_blank")}else loadRecordTransition(e,t);WidgetHandler.CustomButtons.close()}},loadEditPage:function(e){if(e.Entity&&e.RecordID){var t={route:"crm.tab.module.entity.edit",dynamicParams:[e.Entity,e.RecordID]};if(e.target&&"_blank"===e.target){var i=Lyte.Router.getURL(t);networkUtils.openUrl(i,"_blank")}else loadRecordTransition(e,t);WidgetHandler.CustomButtons.close()}},loadCreatePage:function(e){if(e.Entity){var t={route:"crm.tab.module.create",dynamicParams:[e.Entity]};if(e.target&&"_blank"===e.target){var i=Lyte.Router.getURL(t);networkUtils.openUrl(i,"_blank")}else{var r=window.location.pathname,n=Lyte.Router.getRoute(r),a=n.dynamicParams;a.length>0&&null!=a[0]&&a[0]==e.Entity&&n.route===t.route?Lyte.Router.getRouteInstance().refresh().data={refreshPage:!0}:Lyte.Router.transitionTo(t)}WidgetHandler.CustomButtons.close()}},fetchHistoryStateParam:function(){if(history.state&&history.state.meta&&history.state.meta.matched&&history.state.meta.matched.queryParams){var e=history.state.meta.matched.queryParams;if(e instanceof Object)try{return e.widgetparams?JSON.parse(e.widgetparams):{}}catch(e){return}}}},WidgetHandler.EventNotifier={pageLoad:function(e,t){e&&e.SendEvent("PageLoad",t||{})},historyPopState:function(e){var t=WidgetHandler.Utils.fetchHistoryStateParam();e&&t&&e.SendEvent("HistoryPopState",t)},dial:function(e,t,i,r){var n=CrmWidgets.Utils.GetSysRefFromTabName(t);if(CrmWidget.Telephony){var a={Number:e,EntityType:n,EntityID:i,CallActivityID:r};return CrmWidget.Telephony.SendEvent("Dial",a||{}),!1}return!0},pageUnload:function(e,t){e.SendEvent("PageUnload",t||{})},notify:function(e,t){e.SendEvent("notify",t||{})}},CrmWidgets.Utils.messageHandler=function(e){var t=(T=e.data).sdkVersion,i=e.config,r=e.callback,n=e.callbackFailure,a=e.iframe;if(r&&"function"==typeof r){var o=new CrmWidgets.APIHelper.getRequester({ID:i.ID,EMBEDDED_APP_ID:i.EMBEDDED_APP_ID,NAME:i.NAME,CONFIG:i}),s=new CrmWidgets.Utils.PermissionHandler(i.PERMISSIONS),d=new CrmWidgets.Utils.VersionHandler(t);if("CREATE"===T.category){if(s.authorize("CREATE"),"NOTES"===T.type){var c=T.APIData;c=JSON.stringify(c);var l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.AddNotes,T.Entity,T.RelatedID);o.post(l,c).then((function(e){var t=e;return e.data&&(CrmWidgets.Utils.refreshNotesInUI(T.Entity,T.RelatedID),d.isBeta()&&(t=e.data[0])),t})).then(r).catch(n)}else if("ATTACHMENT"===T.type){var g=(c=T.APIData).FileData,u=c.FileName;(N=new FormData).append("file",g,u);l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.AddAttachment,T.Entity,T.RelatedID);o.post(l,N).then((function(e){var t=e;return e.data&&(CrmWidgets.Utils.refreshNotesInUI(T.Entity,T.RelatedID),d.isBeta()&&(t=e.data[0])),t})).then(r).catch(n)}else if("RECORD"===T.type){c=T.APIData,l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.InsertRecord,T.Entity);"UPSERT"===c.action&&(l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.UpsertRecord,T.Entity),delete c.action),(Array.isArray(c)||"object"==typeof c)&&(c=makeAPIDataJson(T.Entity,c)),c=JSON.stringify(c),o.post(l,c).then((function(e){return CrmWidgets.Utils.deleteEntityFromCache(T.Entity),d.isBeta()&&e.data||e})).then(r).catch(n)}}else if("READ"===T.category){if(s.authorize("READ"),(c=T.APIData).RelatedList){l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetRelatedRecords,c.Entity,c.RecordID,c.RelatedList);"photo"===c.RelatedList?c.RESPONSE_TYPE="stream":"Emails"===c.RelatedList&&c.RelatedRecordID&&(l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetRelatedRecords_email,c.Entity,c.RecordID,c.RelatedList,c.RelatedRecordID),delete c.RelatedRecordID),delete c.Entity,delete c.RecordID,delete c.RelatedList,o.get(l,c).then((function(e){return d.isBeta()&&e.data||e})).then(r).catch(n)}else{var p=(c=T.APIData).RecordID;if(p){p instanceof Array?(O={ids:p.join(",")},l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetMultipleRecord,c.Entity)):l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetRecordById,c.Entity,c.RecordID),o.get(l,O).then((function(e){return d.isBeta()&&e.data?e.data[0]:e})).then(r).catch(n)}else{l="";if(c.criteria){var m=encodeURIComponent(c.criteria);l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetAllRecord,c.Entity)+"?filters="+m}else l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetAllRecord,c.Entity);delete c.Entity,o.get(l,c).then((function(e){return d.isBeta()&&e.data||e})).then(r).catch(n)}}}else if("UPDATE"===T.category){if(s.authorize("UPDATE"),"RECORD"===T.type){c=T.APIData;(Array.isArray(c)||"object"==typeof c)&&(c=makeAPIDataJson(T.Entity,c)),c=JSON.stringify(c);l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.UpdateRecord,T.Entity);o.put(l,c).then((function(e){return CrmWidgets.Utils.deleteEntityFromCache(T.Entity),d.isBeta()&&e.data&&e.data||e})).then(r).catch(n)}else if("NOTES"===T.type){g=(c=T.APIData).FileData,u=c.FileName;(N=new FormData).append("file",g,u);l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.AttachFileToNotes,T.Entity,T.RecordID,T.RelatedRecordID);o.post(l,N).then((function(e){var t=e;return e.data&&(CrmWidgets.Utils.refreshNotesInUI(T.Entity,T.RelatedID),d.isBeta()&&(t=e.data[0])),t})).then(r).catch(n)}else if("RELATED_RECORD"===T.type){var f;if(T.APIData instanceof File){l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.UpdateRelatedList_photo,T.Entity,T.RecordID,T.RelatedList);(N=new FormData).append("file",T.APIData,T.APIData.name),f=o.post(l,N)}else{c={data:[T.APIData]};c=JSON.stringify(c);l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.UpdateRelatedList,T.Entity,T.RecordID,T.RelatedList,T.RelatedRecordID);f=o.put(l,c)}f.then((function(e){return CrmWidgets.Utils.deleteEntityFromCache(T.RelatedList),d.isBeta()&&e.data||e})).then(r).catch(n)}else if("PROFILE"===T.type){c=T.APIData;c=JSON.stringify(c);l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.UpdateProfile,T.ID);o.put(l,c).then((function(e){return e.data||e})).then(r).catch(n)}else if("VOICE_URL"===T.type){(c=T.APIData).VoiceURL=encodeURIComponent(c.VoiceURL);l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.UpdateVoiceURL,c.RecordID,c.VoiceURL);o.put(l,c).then((function(e){return e.data||e})).then(r).catch(n)}}else if("DELETE"===T.category){if(s.authorize("DELETE"),"RECORD"===T.type){var h={};T.RecordID instanceof Array?(h={ids:T.RecordID.join()},l=(l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.DeleteRecords,T.Entity)).concat("?").concat(jQuery.param(h))):l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.DeleteRecord,T.Entity,T.RecordID),o.del(l).then((function(e){return CrmWidgets.Utils.deleteEntityFromCache(T.Entity),d.isBeta()&&e.data||e})).then(r).catch(n)}else if("RELATED_RECORD"===T.type){l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.UpdateRelatedList,T.Entity,T.RecordID,T.RelatedList,T.RelatedRecordID);o.del(l,c).then((function(e){return CrmWidgets.Utils.deleteEntityFromCache(T.RelatedList),d.isBeta()&&e.data?e.data[0]:e})).then(r).catch(n)}}else if("SEARCH"===T.category){if(s.authorize("READ"),T.APIData){var C=(c=T.APIData).Entity,I=c.Type,E=c.Query;delete c.Entity,delete c.Type,delete c.Query,c[I]=E}else{C=T.Entity,I=T.Type,E=T.Query;(c={})[I]=E,T.page&&(c.page=T.page),T.per_page&&(c.per_page=T.per_page),T.hasOwnProperty("delay")&&(c.delay=T.delay)}l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.SearchRecord,C);o.get(l,c).then(r).catch(n)}else if("PAGEINFO"===T.category){s.authorize("READ");var v=detailView.currentModule,A=detailView.entityId;if(v&&Crm.userDetails.MODULE_LIST){var y=Crm.userDetails.MODULE_LIST[v];if(y)if(C=y.api_name){l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetRecordById,C,A);o.get(l,c).then((function(e){var t=void 0!==e.data?e.data[0]:e;return{entity:C,data:t}})).then(r).catch(n)}}}else if("FUNCTIONS_EXECUTE"===T.category){s.authorize("READ");l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.ExecuteFunction,T.customFunctionName);(W=T.data)&&o.post(l,W.data,"",W.headers).then(r).catch(n)}else if("CRM_CONNECTION"===T.category){s.authorize("CONNECTOR");l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.InvokeCrmConnection,T.connectionName);(W=T.data)&&o.post(l,W.data,"").then(r).catch(n)}else if("CRM_WIZARD"===T.category)wizardWidgetHandler.receiver(JSON.parse(T.data));else if("CRM_BLUEPRINT"===T.category){var R="200";CrmWidgets.Utils.isMobileWidget()?R=CrmWidgets.Utils.getJSInterface().blueprintProceed(o.getHandShakeToken()):ProcessFlow.proceedWidget(),"200"==R?r(!0):n(new CrmWidgets.Exceptions.widgetInterfaceException(M))}else if("CONNECTOR"===T.category)if(s.authorize("CONNECTOR"),T.type&&"CONNECTOR_API"!==T.type){if("CONNECTOR_AUTHORIZE"===T.type){P=T.nameSpace,l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetAuthorizeUrl,P);o.get(l,N).then((function(e){if(void 0!==e.RESULT&&"SUCCESS"===e.RESULT){var t=e.AUTHORIZEURL;networkUtils.openUrl(t,"widgetConnectorAuthorize","width=600, height=600, top=200, left=400")}var i,r,n=new Promise((function(e,t){i=e,r=t})),a=e.NAMESPACE,o={resolve:i,reject:r};return CrmWidgets.Utils.addConnectorAuthorizePromise(a,o),setTimeout((function(){if(connectorAuthorizePromiseMap){var e=connectorAuthorizePromiseMap[a];e&&(e.reject("Timeout"),delete connectorAuthorizePromiseMap[a])}}),3e5),n})).then(r).catch(n)}else if("CONNECTOR_REVOKE"===T.type){P=T.nameSpace,l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetRevokeUrl,P);o.post(l,N).then(r).catch(n)}}else{var W=T.data,P=T.nameSpace;W.invokeType&&"ISAUTHORIZE"===W.invokeType&&(P="isAuthorized_"+P);var l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.InvokeConnector,P);if(W){var S=W.CONTENT_TYPE,w=W.RESPONSE_TYPE;if(S&&"multipart"===S){var T=new FormData;if(W.FORWARD_TYPE&&"data-binary"===W.FORWARD_TYPE?T.append("forwardType","data-binary"):T.append("forwardType","multi"),W.FILE){var U=W.FILE.fileParam,D=W.FILE.file,L=new File([D],D.name,{type:D.type});T.append(U,L)}var _=W.VARIABLES;!_&&W.url&&(_={url:W.url,Header:W.Header});var b={parts:W.PARTS,partBoundary:W.PARTS_BOUNDARY},H=JSON.stringify(b);T.append("partContents",H),T.append("VARIABLES",JSON.stringify(_)),void 0!==w&&T.append("resultType",w),o.post(l,T).then(r).catch(n)}else{var O={VARIABLES:W};w&&(l=l.concat("&resultType=").concat(w),O.RESPONSE_TYPE=w),o.ajax("POST",l,O).then(r).catch(n)}}}else if("FILES"===T.category){if("UPLOAD_FILE"===T.type){s.authorize("CREATE");const e=(c=T).FileData instanceof File;if(e||c.FileData&&c.FileData.FILE&&c.FileData.FILE.file instanceof File){var N=new FormData;e?N.append("file",c.FileData,c.FileData.name):N.append("file",c.FileData.FILE.file,c.FileData.FILE.file.name),o.post(CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.ZfsFile),N).then((e=>e)).then(r).catch(n)}else n("Input is not of type 'File'")}else if("DOWNLOAD_FILE"===T.type){c={id:T.id,RESPONSE_TYPE:"stream"};s.authorize("READ");l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.ZfsFile);o.get(l,c).then((function(e){return d.isBeta()&&e.data||e})).then(r).catch(n)}}else if("BLUEPRINT"===T.category){if("GET_BLUEPRINT_STATUS"===(c=T).action){s.authorize("READ");l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.Blueprint,c.Entity,c.RecordID);o.get(l).then((function(e){return d.isBeta()&&e.data||e})).then(r).catch(n)}else if("UPDATE_BLUEPRINT_STATUS"===c.action){s.authorize("UPDATE");l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.Blueprint,c.Entity,c.RecordID);c=JSON.stringify(c.BlueprintData),o.put(l,c).then((function(e){return d.isBeta()&&e.data&&e.data||e})).then(r).catch(n)}}else if("APPROVALS"===T.category){if("GET_ALL_ACTIONS"===(c=T).action){s.authorize("READ");l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.ViewAllActions,c.Entity,c.RecordID);o.get(l).then((function(e){return d.isBeta()&&e.data||e})).then(r).catch(n)}else if("GET_APPROVAL_RECORDS"===c.action){s.authorize("READ");l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetApprovalRecords);c.type&&(l=l+"?type="+c.type),o.get(l).then((function(e){return d.isBeta()&&e.data||e})).then(r).catch(n)}else if("GET_APPROVALBYID"===c.action){s.authorize("READ");l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetApprovalRecords);c.id&&(l=l+"/"+c.id),o.get(l).then((function(e){return d.isBeta()&&e.data||e})).then(r).catch(n)}else if("GET_APPROVALS_HISTORY"===c.action){s.authorize("READ");l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetApprovalRecords)+"/history";o.get(l).then((function(e){return d.isBeta()&&e.data||e})).then(r).catch(n)}else if("UPDATE_APPROVAL"===c.action){s.authorize("UPDATE");l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetApprovalActions,c.Entity,c.RecordID,c.actionType);c.comments&&(l=l+"&comments="+c.comments),c.user&&(l=l+"&user="+c.user),o.post(l).then((function(e){return d.isBeta()&&e.data||e})).then(r).catch(n)}}else if("MAIL"===T.category){s.authorize("CREATE");l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetSendmailUrl,T.APIData.Entity,T.APIData.RecordID);var x=T.APIData.APIData;o.post(l,JSON.stringify(x)).then((function(e){return e})).then(r).catch(n)}else if("QUERY"===T.category)T.APIData&&o.post(CrmWidgets.APIHelper.APISpec.queryRecord,JSON.stringify(T.APIData)).then(r).catch(n);else if("ROLES"===T.category){l=void 0===T.roleId?CrmWidgets.APIHelper.APISpec.roles:CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.specificRole,T.roleId);o.get(l).then(r).catch(n)}else if("UI"===T.category){if(T.action.telephony){if("MAXIMIZE"===T.action.telephony)WidgetHandler.Telephony.show();else if("MINIMIZE"===T.action.telephony)WidgetHandler.Telephony.hide();else{if("NOTIFY"!==T.action.telephony)return;WidgetHandler.Utils.playSound()}r(!0)}else if(T.action.record){var F=T.data;F.Entity=CrmWidgets.Utils.GetTabNameFromSysRef(F.Entity);var M="200";"OPEN"===T.action.record?CrmWidgets.Utils.isMobileWidget()?M=CrmWidgets.Utils.getJSInterface().openDetailsView(o.getHandShakeToken(),F.Entity,F.RecordID):WidgetHandler.Utils.loadDetailPage(F):"EDIT"===T.action.record?CrmWidgets.Utils.isMobileWidget()?M=CrmWidgets.Utils.getJSInterface().editRecord(o.getHandShakeToken(),F.Entity,F.RecordID):WidgetHandler.Utils.loadEditPage(F):"CREATE"===T.action.record?CrmWidgets.Utils.isMobileWidget()?M=CrmWidgets.Utils.getJSInterface().addRecord(o.getHandShakeToken(),F.Entity):WidgetHandler.Utils.loadCreatePage(F):"POPULATE"===T.action.record&&WidgetHandler.Utils.populateForm(T.data),"200"==M?r(!0):n(new CrmWidgets.Exceptions.widgetInterfaceException(M))}else if(T.action.setting){if("OPEN"===T.action.setting){var k=T.data,B=k.target,G=k.APIName;if(G.includes("__")){(ee=CrmWidgets.Utils.GetCustomSettingsIDbyAPI(G))&&CrmWidgets.Utils.lyteTransitTo(ee,k.Message,"crm.settings.section.widget",B)}else{var z=Lyte.Router.getRoute(CrmWidgets.Utils.getCrmBasePath()+"/settings/"+G);Lyte.Router.transitionTo(z)}}}else if(T.action.popup){if("CLOSE"===T.action.popup){if(CrmWidgets.Utils.isMobileWidget())return void("200"==(M=CrmWidgets.Utils.getJSInterface().popupClose(o.getHandShakeToken()))?r(!0):n(new CrmWidgets.Exceptions.widgetInterfaceException(M)));WidgetHandler.CustomButtons.close()}if("CLOSE_RELOAD"===T.action.popup){if(CrmWidgets.Utils.isMobileWidget())return void("200"==(M=CrmWidgets.Utils.getJSInterface().popupCloseReload(o.getHandShakeToken()))?r(!0):n(new CrmWidgets.Exceptions.widgetInterfaceException(M)));WidgetHandler.CustomButtons.close(!0)}r(!0)}else if("RESIZE"===T.action){if(CrmWidgets.Utils.isMobileWidget())return void r(!0);var q=i.DIMENSION,V=(q.ALLOWED_PROP,T.data),j=CrmWidgets.Utils.getDimensionCss(V,q),J=!1;"30"===i.TYPE?0===j.height?j.hideParent=!0:j.hideParent=!1:"55"===i.TYPE&&(a=$("#widget_StandAlone_Panel")[0],J=!0),WidgetHandler.Utils.resize(a,j,J),r(!0)}else if(T.action.webTab){if("OPEN"===T.action.webTab){var Z=(te=T.data).Entity,Y=te.Message,K=te.target;M="200";if(CrmWidgets.Utils.isMobileWidget()){var Q=JSON.stringify({data:JSON.stringify(Y),dataType:typeof Y});return void("200"==(M=CrmWidgets.Utils.getJSInterface().openWebTabWidget(o.getHandShakeToken(),Z,Q))?r(!0):n(new CrmWidgets.Exceptions.widgetInterfaceException(M)))}if(v=CrmWidgets.Utils.GetTabNameFromSysRef(Z)){var X=Crm.userDetails.MODULE_LIST[v];if(X){var ee=X.id;if(WidgetHandler.WidgetConfig&&WidgetHandler.WidgetConfig.WebTab&&WidgetHandler.WidgetConfig.WebTab[ee])return CrmWidgets.Utils.openWebTab(ee,v,Y,null,K),void r(!0)}}r(!1)}else if("HISTORY"===T.action.webTab){c=T.data;new Promise((function(e){var t=Lyte.Router.getRouteInstance().transition.info.route,i=Lyte.Router.getRouteInstance().transition.info.dynamicParams;Lyte.Router.transitionTo({route:t,dynamicParams:i,queryParams:{widgetparams:JSON.stringify(c)}}),e(!0)})).then(r).catch(n)}}else if(T.action.StandAlone){if("OPEN"===T.action.StandAlone){var te,ie=(te=T.data).Message;CrmWidgets.Utils.isMobileWidget()||WidgetHandler.WidgetConfig&&WidgetHandler.WidgetConfig.StandAlone&&(CrmWidget.StandAlone?WidgetHandler.EventNotifier.pageLoad(CrmWidget.StandAlone,ie||{}):WidgetHandler.StandAlone.render(ie),r(!0)),r(!1)}"CLOSE"===T.action.StandAlone&&(WidgetHandler.StandAlone.hide(),r(!0))}}else if("CONFIG"===T.category){if(s.authorize("READ"),"CURRENT_USER"===T.type){l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetUsers),c={type:"CurrentUser"};o.get(l,c).then((function(e){return d.isBeta()&&e.users?e.users:e})).then(r).catch(n)}else if("ORG_LEVEL_INFO"===T.type){var re=Crm.userDetails,ne={deployment:re.DEPLOYMENT,zgid:re.ZGID,zuid:re.ZUID};(Crm.isVertical||Crm.isSolution)&&(ne.appDetails={url:window.location.protocol+"//"+window.location.hostname,name:Crm.Vertical.appName}),new Promise((function(e){return e(ne)})).then(r).catch(n)}else if("CREATEUSER"===T.type){s.authorize("CREATE");c=T.APIData,l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetUsers);var ae=JSON.stringify(c);o.post(l,ae).then((function(e){return d.isBeta()&&e.users?e.users:e})).then(r).catch(n)}else if("EDITUSER"===T.type){s.authorize("UPDATE");c=T.APIData,l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetUser,c.id),ae=JSON.stringify(c.userobject);o.put(l,ae).then((function(e){return d.isBeta()&&e.users?e.users:e})).then(r).catch(n)}else if("DELETEUSER"===T.type){s.authorize("DELETE");c=T.APIData,l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetUser,c.id);o.del(l).then((function(e){return d.isBeta()&&e.users?e.users:e})).then(r).catch(n)}else if("VARIABLE"===T.type){var oe=T.nameSpace;"object"==typeof oe&&(oe=oe.apiKeys.toString());l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetOrgVariable,oe);o.get(l,c).then(r).catch(n)}else if("ORG"===T.type){l=CrmWidgets.APIHelper.APISpec.GetOrgInfo;o.get(l,void 0).then((function(e){return d.isBeta()&&e.org?e.org[0]:e})).then(r).catch(n)}}else if("ACTION"===T.category){if("CUSTOM_ACTION_SAVE_CONFIG"===T.type&&wfCustomActions.selectedAction&&wfCustomActions.selectedAction.widgetId===i.ID&&(wfCustomActions.SavedConfig=T.object,wfCustomActions.validateCustomAction()?(wfCustomActions.saveCustomAction(),r(!0)):n(!1)),"ENABLE_ACCOUNT_ACCESS"===T.type){l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.EnableAccountAccess);o.post(l).then((function(){WidgetHandler.CustomButtons.close()})).then(r).catch(n)}}else if("USER"===T.category){if(s.authorize("READ"),T.ID){l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetUser,T.ID);o.get(l,void 0).then((function(e){return d.isBeta()&&e.users?e.users[0]:e})).then(r).catch(n)}else if(T.Type){l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetUsers),c={type:T.Type};T.page&&(c.page=T.page),T.per_page&&(c.per_page=T.per_page),o.get(l,c).then((function(e){return d.isBeta()&&e.users||e})).then(r).catch(n)}}else if("META"===T.category){if("FIELD_LIST"===T.type){l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetFields,T.Entity);o.get(l,void 0).then(r).catch(n)}else if("MODULE_LIST"===T.type){l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetModuleList);o.get(l,void 0).then(r).catch(n)}else if("ASSIGNMENT_RULES"===T.type){l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetAssignmentRules,T.Entity);o.get(l,void 0).then(r).catch(n)}else if("LAYOUTS"===T.type){l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetLayouts,T.Entity);o.get(l,void 0).then(r).catch(n)}else if("LAYOUT"===T.type){l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetLayout,T.Id,T.Entity);o.get(l,void 0).then(r).catch(n)}else if("RELATED_LIST"===T.type){l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetRelatedList,T.Entity);o.get(l,void 0).then(r).catch(n)}else if("CUSTOM_VIEWS"===T.type){l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetCustomViews,T.Entity);o.get(l,void 0).then(r).catch(n)}else if("CUSTOM_VIEW"===T.type){l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetCustomView,T.Id,T.Entity);o.get(l,void 0).then(r).catch(n)}else if("EMAIL"===T.type&&"GET_ALIAS"===T.subType){l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetEmailFromAliases);o.get(l,void 0).then(r).catch(n)}}else if("PROFILES"===T.category)if("GET_ALL_PROFILES"===T.type){l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetAllProfiles);o.get(l,void 0).then((function(e){return e})).then(r).catch(n)}else if("GET_PROFILE"===T.type){l=CrmWidgets.APIHelper.generatorURL(CrmWidgets.APIHelper.APISpec.GetProfile,T.ID);o.get(l,void 0).then((function(e){return e.users?e.users[0]:e})).then(r).catch(n)}}},$(document).ready((function(){ZApp.Bootstrap({EventListeners:{CRM_EVENT:CrmWidgets.Utils.messageHandler}})})),window.addEventListener("message",(function(e){"string"==typeof e.data&&e.data.indexOf("CONNECTOR_SUCCESS")>-1&&CrmWidgets.Utils.resolveConnectorAuthorize(e.data.replace("CONNECTOR_SUCCESS_","")),"string"==typeof e.data&&e.data.indexOf("CONNECTOR_ERROR")>-1&&CrmWidgets.Utils.rejectConnectorAuthorize(e.data.replace("CONNECTOR_ERROR_",""))})),window.addEventListener("popstate",(function(){CrmWidget&&CrmWidget.currentWidget&&WidgetHandler.EventNotifier.historyPopState(CrmWidget[CrmWidget.currentWidget])}));