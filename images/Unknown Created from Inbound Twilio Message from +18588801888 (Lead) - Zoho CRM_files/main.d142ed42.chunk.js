(this["webpackJsonpcreate-react-app-with-typescript"]=this["webpackJsonpcreate-react-app-with-typescript"]||[]).push([[0],{1e3:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return rm})),a.d(t,"renderTwilioExtension",(function(){return Sm}));var n=a(3),r=a.n(n),o=a(11),s=a(5),i=a(23),l=a(24),c=a(27),u=a(26),d=a(1112),m=a(1077),p=a(133),h=a(1),g=a.n(h),f=a(25),v=a(378),b=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function y(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?t&&t.onUpdate&&t.onUpdate(e):t&&t.onSuccess&&t.onSuccess(e))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var S=a(14),w=a(18),_=a(13),x=a(1060),C=a(1114),k=a(1120),E=a(1006),T=a(1065),N=a(1012),I=a(1013),O=a(1078),M=a(1079),P=a(1080),A=a(296),D=a.n(A),j=a(550),R=a.n(j),F=a(150),U=a.n(F),L=a(209),V=a.n(L),B=a(205),q=a.n(B);function W(e,t,a){var n,r=null===t||void 0===t||null===(n=t.value)||void 0===n?void 0:n.replace("whatsapp:","");if(r){var o=q()(r);o.length||r.match(/([A-Za-z])/)||(o=q()("".concat(a).concat(r)));var s=e.map((function(e){return{original:e,parsed:q()(e.value)}})).find((function(e){return e.parsed[1]===o[1]}));return null===s||void 0===s?void 0:s.original}}var z=a(134),H={launchChecklist:function(){var e;(null===(e=window.userGuiding)||void 0===e?void 0:e.launchChecklist)&&window.userGuiding.launchChecklist(11793,{itemsShown:!0})&&window.userGuiding.expandChecklist()},hideChecklist:function(){var e,t;(null===(e=window.userGuiding)||void 0===e?void 0:e.hideChecklist)&&(null===(t=window.userGuiding)||void 0===t||t.hideChecklist(11793))},identify:function(e,t){var a,n;(null===(a=window.userGuiding)||void 0===a?void 0:a.identify)&&(null===(n=window.userGuiding)||void 0===n||n.identify(e,t))},track:function(e,t){var a,n;(null===(a=window.userGuiding)||void 0===a?void 0:a.track)&&(null===(n=window.userGuiding)||void 0===n||n.track(e,t))},getChecklistInfo:function(){try{var e,t,a=null===(e=window.userGuiding)||void 0===e?void 0:e.getChecklistCompletionInfo(),n=0,r=0,o=0,s=Object(z.a)(a);try{for(s.s();!(t=s.n()).done;){var i,l,c,u=t.value;n+=null!==(i=null===u||void 0===u?void 0:u.completedItems.length)&&void 0!==i?i:0,r+=null!==(l=null===u||void 0===u?void 0:u.incompleteItems.length)&&void 0!==l?l:0,o+=null!==(c=null===u||void 0===u?void 0:u.items.length)&&void 0!==c?c:0}}catch(d){s.e(d)}finally{s.f()}return{completedItems:n,incompleteItems:r,items:o}}catch(m){return{completedItems:0,incompleteItems:0,items:1}}},hideHelpGuidesSidebar:function(){var e,t;null===(e=window.userGuiding)||void 0===e||null===(t=e.hideResourceCenter)||void 0===t||t.call(e)}},Y=a(139),G=a(1056),Q=a(1058),J=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this.props.value;return g.a.createElement(G.a,{position:"relative",display:"inline-flex"},g.a.createElement(Q.a,{variant:"determinate",value:e}),g.a.createElement(G.a,{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},g.a.createElement(Y.a,{variant:"caption",color:"textSecondary"},"".concat(Math.round(e),"%"))))}}]),a}(g.a.Component),K=Object(S.a)((function(){return{progress:{position:"fixed!important",top:"0",left:"0",right:"0",width:"100%",backgroundColor:"#e0e0e0"},inprogress:{backgroundColor:"#2196f3"}}}))(J),Z=a(33),X=a.n(Z),$=a(286),ee=a(1108),te="https://api.smooth.tel/",ae=!te.includes("-prod")&&!te.includes("api.smooth.tel"),ne="owner_of_each_record",re="current_user",oe=[{label:"Owner of each record",value:"owner_of_each_record"},{label:"Me",value:"current_user"}],se={startTime:"08:00",endTime:"18:00",weekDays:{monday:!0,tuesday:!0,wednesday:!0,thursday:!0,friday:!0,saturday:!1,sunday:!1},defaultCountryCode:""},ie=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],le={TEMPLATED:"Templated",BlankState:"Blank"},ce=[{value:"SMS/MMS",label:"SMS / MMS"},{value:"Whatsapp",label:"Whatsapp"}],ue="SMS/MMS",de="Whatsapp",me=[{value:"TWILIO_AUTH_TOKEN",label:"TWILIO_AUTH_TOKEN"}],pe="TWILIO_AUTH_TOKEN",he=/[`~!@#$%^&*()_|\-=?;:'",<>\{\}\[\]\\\/]/gi,ge="0f860d00d0bd2d8f3e73",fe="us2",ve=a(1116),be=a(1059),ye=function(e,t){var a=function(e){var t=e.replace("+","");return Object(ve.a)().find((function(e){return Object(be.a)(e)===t}))}(t),n=Object(ee.a)(e,a);return null===n||void 0===n?void 0:n.number};function Se(e,t,a){return e.flatMap((function(e){var n,r;if(!e||!e.value)return[];var o=_e(e.value,a.value,t.defaultCountryCode),s=null===(n=Object(ee.a)(o||""))||void 0===n?void 0:n.format("E.164");s||(s="");var i=Object($.getLocalInfo)(s),l=(null===i||void 0===i||null===(r=i.time)||void 0===r?void 0:r.display)||X()().format("HH:mm");return xe(l,t)?Object(_.a)(Object(_.a)({},e),{},{currentTime:null===i||void 0===i?void 0:i.time}):[]}))}var we=function(e){return Object.keys(e).reduce((function(t,a){return e[a]?t:[].concat(Object(w.a)(t),[a.substring(0,3)])}),[])},_e=function(e,t,a){var n=Ce(e),r=Ce(t),o="";if(!n.startsWith("+")){var s;if(r.startsWith("+"))(o=null===(s=Object(ee.a)(r))||void 0===s?void 0:s.countryCallingCode)&&(o="+".concat(o));n=ye(n,o||a)}return n},xe=function(e,t,a){var n=t.weekDays,r=t.startTime,o=t.endTime;return!function(e,t){var a=t?X()(t).get("d"):(new Date).getDay();return e[ie[a]]}(n,a)||(e>o||e<r)},Ce=function(e){return(null===e||void 0===e?void 0:e.includes("whatsapp:"))?e.replace("whatsapp:",""):e},ke=function(e){var t=e.fromNumber,a=e.workingHoursSettingsFromBackend,n=e.toNumbers,r=e.multiple,o=void 0!==r&&r,s=e.onConfirmCritical,i=e.isSMSCritical,l=e.onRemoveNumbersOutsideBusinessHours,c=e.classes,u=e.filterDuplicates,m=Object(h.useMemo)((function(){return we(a.weekDays).join(", ")}),[a]),p=Object(h.useMemo)((function(){return"".concat(o?"Some of the people":"The person"," you are messaging are in a timezone where it is\n  currently outside your organisation's approved sending hours (\n  ").concat(X()(a.startTime,"hh:mm:ss").format("LT")," -"," ","\n  ").concat(X()(a.endTime,"hh:mm:ss").format("LT"),"\n  ").concat(m?"on any day except ".concat(m.toUpperCase()):"",").\n  ")}),[a,o,m]),f=Object(h.useMemo)((function(){var e=Se(n,a,t);return u?e:e.filter((function(e,t,a){return a.findIndex((function(t){return(null===t||void 0===t?void 0:t.value)===(null===e||void 0===e?void 0:e.value)&&(null===t||void 0===t?void 0:t.name)===(null===e||void 0===e?void 0:e.name)}))===t}))}),[n,a,t,u]);return f.length?g.a.createElement(d.a,{severity:"warning"},g.a.createElement("div",{style:{textAlign:"left"}}," ",p),g.a.createElement("div",{className:c.checkboxContainer},o&&g.a.createElement("ul",{className:c.outsideHoursList},f.map((function(e,t){var a,n,r,o;return(null===e||void 0===e||null===(a=e.currentTime)||void 0===a?void 0:a.hour)&&(null===e||void 0===e||null===(n=e.currentTime)||void 0===n?void 0:n.mins)?g.a.createElement("li",{key:t},"".concat(null===e||void 0===e?void 0:e.label," : ").concat(X()((null===e||void 0===e||null===(r=e.currentTime)||void 0===r?void 0:r.hour)||X()().format("HH"),"hh:mm:ss").add((null===e||void 0===e||null===(o=e.currentTime)||void 0===o?void 0:o.mins)||X()().format("mm"),"minutes").format("LLLL"),".")):g.a.createElement("li",{key:t},null===e||void 0===e?void 0:e.label,": Unknown Timezone")}))),g.a.createElement(x.a,{control:g.a.createElement(C.a,{checked:i,onChange:function(e){return s()},name:"termsCheckbox",color:"primary",size:"small",inputProps:{"data-test-id":"businessHoursCheckbox"}}),label:g.a.createElement("p",{className:c.checkboxLabel},"Please confirm the message is critical and must be sent now.")}),o&&l&&g.a.createElement("span",{onClick:function(){return l(f)}},g.a.createElement("br",null),g.a.createElement("u",{style:{cursor:"pointer"}},"Click here to remove them from this outbound campaign.")))):null},Ee=function(e,t){if(!e)return"";var a=t.from_number,n=t.message,r=t.to_number,o=t.deliveryMethod,s=e.message,i=e.sending_channel,l=e.status,c=e.error_message,u=s||n,d=e.from_number||a,m=e.to_number||Array.isArray(r)?r.join(", "):r,p=i||o;return"fail"===l||"Failed"===l?'Fail: The message "'.concat(u,'" from "').concat(d,'" to "').concat(m,'" with "').concat(p,'" delivery method failed to send. Reason: "').concat(c,'"'):""},Te=a(127),Ne=a.n(Te),Ie=a(38),Oe=a.n(Ie),Me=a(537),Pe=function(e,t){return'<a href="'.concat(e,'" target="_blank" rel="noreferrer">').concat(t||e,"</a>")},Ae='<a href="mailto:team@smooth.tel" target="_blank" rel="noreferrer">team@smooth.tel</a>',De='There was an issue communicating with the server.You can try again by clicking "Do a fresh reload" or contact us '+"at ".concat(Ae," if the issue still occur."),je="It looks like the extension hasn't finished installing yet. Please wait 5 minutes and click the refresh button. "+"If you still have problems afterwards, please ".concat(Ae,". ")+"We apologise for the delay - this is a limitation at Zoho's end.",Re="Uh oh this looks like a permission issue. If you see this error, you need to ask your superadmin to grant access to the extension for you. "+"Here's how ".concat(Pe("https://youtu.be/4OhK4px-0I8"),". ")+"If the issue persists, please follow the instructions in this video "+"".concat(Pe("http://somup.com/cYjU1HXfMz")," ")+"and send the screenshots to ".concat(Ae),Fe="Ignore button click",Ue="No record found while preloading data of conversation list";function Le(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];try{return JSON.parse(e)}catch(s){var r=s,o=new Error(s);return o.message="".concat(r.message).concat(t," ").concat(JSON.stringify(e)),n&&window.Sentry.captureException(o),a}}var Ve=function(e){var t={};e.forEach((function(e){var a="inbound"===e.messageType?e.entity_id:e.owner_id,n=t[e.messageType];t[e.messageType]=Object(w.a)(new Set([].concat(Object(w.a)(n||[]),[a])))}));var a=Object.values(t);return 2===a.length&&1===a[0].length&&1===a[1].length},Be=function(e){return e.filter((function(e){var t;return e.message||(null===(t=e.mmsContent)||void 0===t?void 0:t.length)&&Boolean(e.mmsContent)&&"[]"!==e.mmsContent})).sort((function(e,t){var a=new Date(e.timestamp),n=new Date(t.timestamp);return a.valueOf()-n.valueOf()}))};function qe(e){var t="string"===typeof e?parseInt(e,10):e;if(t===1/0)throw new Error("Default timestamp value should be minus Infinity");return(Date.now()-t)/6e4}function We(e){var t="string"===typeof e?parseInt(e,10):e;if(t===1/0)throw new Error("Default timestamp value should be minus Infinity");return(Date.now()-t)/36e5}function ze(e){return He.apply(this,arguments)}function He(){return(He=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){setTimeout(e,1e3*t)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ye=function(e){var t=X()().format("YYYY-MM-DDTHH:mm");return X()(e).isBefore(t)},Ge=function(e){return"inbox_".concat(e)},Qe=function(e){return!!((null===e||void 0===e?void 0:e.fromData)&&(null===e||void 0===e?void 0:e.messages)&&(null===e||void 0===e?void 0:e.toArray)&&Array.isArray(null===e||void 0===e?void 0:e.fromData)&&Array.isArray(null===e||void 0===e?void 0:e.messages)&&Array.isArray(null===e||void 0===e?void 0:e.toArray)&&(null===e||void 0===e?void 0:e.timestamp))},Je=function(e){if(!function(e){return!!rt(Ge(e))}(e))return null;var t=Le(rt(Ge(e)),"loaded inbox data ".concat(e),null);return Qe(t)?t:(st(Ge(e)),null)},Ke=function(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(a){var n=Be(t.messages);t.messages=n}ot(Ge(e),JSON.stringify(t))},Ze=function(e,t){var a=Je(e);a&&Ke(e,Object(_.a)(Object(_.a)({},a),{},{fromData:t,timestamp:Date.now()}))},Xe=function(e,t){var a=Je(e);a&&Ke(e,Object(_.a)(Object(_.a)({},a),{},{toArray:t,timestamp:Date.now()}))},$e=function(e,t){var a=Je(e);a&&Ke(e,Object(_.a)(Object(_.a)({},a),{},{messages:t,timestamp:Date.now()}))},et=function(e,t,a){var n=Je(e);if(!n||"RelatedList"===a)return Ke(e,t);var r=n.messages,o=Object(_.a)(Object(_.a)({},t),{},{messages:r});Ke(e,o)},tt=function(){try{var e=/^messages_(.+)$/g,t=/^inbox_(.+)$/g;Object.keys(localStorage).forEach((function(a){if(a.match(e)&&localStorage.removeItem(a),a.match(t)){var n=a.split("_")[1],r=Le(localStorage.getItem(a),"loaded inbox data when Quota",null);if(Qe(r))if(We(r.timestamp)>3)localStorage.removeItem(a);else if(r.toArray.length){if(r.messages.length>50){var o=r.messages.splice(-50);r.messages=o,Ke(n,r,!1)}}else localStorage.removeItem(a)}}))}catch(a){console.log(a)}};function at(){var e;try{e=window.localStorage;var t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(a){return a instanceof DOMException&&(22===a.code||1014===a.code||"QuotaExceededError"===a.name||"NS_ERROR_DOM_QUOTA_REACHED"===a.name)&&e&&0!==e.length}}function nt(){at()&&(localStorage.clear(),sessionStorage.clear())}function rt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{debug:!1};at()||it("reload_window_count");try{return t&&t.debug?sessionStorage.getItem(e):localStorage.getItem(e)}catch(a){}}function ot(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{debug:!1};at()||it("reload_window_count");try{return a&&a.debug?sessionStorage.setItem(e,t):localStorage.setItem(e,t)}catch(o){if("QuotaExceededError"===o.name||"NS_ERROR_DOM_QUOTA_REACHED"===o.name)try{tt(),localStorage.setItem(e,t)}catch(s){if(e.includes("inbox_")&&t.includes("messages"))try{var n=Le(t,"loaded inbox data when Quota 2nd times",null),r=n.messages.splice(-50);n.messages=r,localStorage.setItem(e,JSON.stringify(r))}catch(s){}}}}function st(){at()||it("reload_window_count");try{for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];t.forEach((function(e){Array.isArray(e)?e.forEach((function(e){localStorage.removeItem(e),sessionStorage.removeItem(e)})):(localStorage.removeItem(e),sessionStorage.removeItem(e))}))}catch(n){}}function it(){if(at()){for(var e={},t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];try{a.forEach((function(t){Array.isArray(t)?t.forEach((function(t){e[t]=rt(t)||void 0})):e[t]=rt(t)||void 0})),localStorage.clear(),Object.entries(e).forEach((function(e){var t=Object(o.a)(e,2),a=t[0],n=t[1];n&&ot(a,n)}))}catch(r){console.error("Something went wrong during safelyClearLocalStorageItemExcept",a,r)}}}function lt(){return ct.apply(this,arguments)}function ct(){return(ct=Object(s.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=document.createElement("p")).innerHTML=Re,e.next=4,Oe()({title:"Error",content:{element:t},icon:"error"});case 4:return e.abrupt("return");case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ut(e){return dt.apply(this,arguments)}function dt(){return(dt=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Oe()({title:"Error",text:"Uh oh something went wrong. Please check you are on the latest version of the extension by following the instructions here https://screencast-o-matic.com/watch/cYlXrp813O. If you are on the latest version, please follow the instructions in this video http://somup.com/cYjU1HXfMz and send the screenshots to team@smooth.tel ".concat((null===t||void 0===t?void 0:t.apiName)||""," ").concat(t.message," ").concat(t.stack),icon:"error"});case 2:return e.abrupt("return");case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function mt(e){try{return Me.find((function(t){return t.code===Number(e)}))}catch(t){return null}}function pt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,a=JSON.stringify({hasReloaded:!0});if(window.sessionStorage.getItem("reload_on_error_count")===a)return window.sessionStorage.clear(),Oe()({title:"Error",text:"Sorry an error has occurred. Please check you are on the latest version of the extension by following the instructions here https://screencast-o-matic.com/watch/cYlXrp813O. If you are on the latest version, please email team@smooth.tel with a screenshot of this error. ".concat(e," ").concat(t.message," ").concat(t.stack),icon:"error"});window.sessionStorage.setItem("reload_on_error_count",a),it("reload_window_count"),window.location.reload()}var ht=a(17);function gt(){return ft.apply(this,arguments)}function ft(){return(ft=Object(s.a)(r.a.mark((function e(){var t,a,n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=rt("crm_organisation_info"))){e.next=7;break}if(a=Le(t,"crm_organisation_info",{}),o=(null===(n=a)||void 0===n?void 0:n.timestamp)||0,!(We(o)<1)){e.next=7;break}return e.abrupt("return",a);case 7:return e.next=9,ht.a.CRM.CONFIG.getOrgInfo();case 9:return(a=e.sent).timestamp=Date.now(),ot("crm_organisation_info",JSON.stringify(a)),e.abrupt("return",a);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function vt(){return bt.apply(this,arguments)}function bt(){return(bt=Object(s.a)(r.a.mark((function e(){var t,a,n,o,s,i,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=rt("crm_organisation_id"))){e.next=7;break}if(n=Le(a,"getCRMOrgId",{}),s=(null===(o=n)||void 0===o?void 0:o.timestamp)||0,!(We(s)<1)){e.next=7;break}return e.abrupt("return",null===(i=n)||void 0===i||null===(l=i.org[0])||void 0===l?void 0:l.zgid);case 7:return e.next=9,ht.a.CRM.CONFIG.getOrgInfo();case 9:return(n=e.sent).timestamp=Date.now(),ot("crm_organisation_id",JSON.stringify(n)),e.abrupt("return",null===(t=n.org[0])||void 0===t?void 0:t.zgid);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var yt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ne.a.create({baseURL:te,headers:e});return t.interceptors.request.use(function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t,e.next=3,St();case 3:return n=e.sent,a.headers=Object(_.a)(Object(_.a)({},n),a.headers),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){return Promise.reject(e)})),t.interceptors.response.use((function(e){return e}),(function(e){if(!e.response)return Promise.reject(e);if(503===e.response.status){var t=document.createElement("p");return t.innerHTML=["We are performing maintenance on our system.",'Please check <a href="https://smooth.tel/status" rel="noreferrer" target="_blank">https://smooth.tel/status</a>',"for the expected completion time."].join(" "),Oe()({title:"Sorry!",content:{element:t},icon:"warning"})}return window.Sentry.captureException(e),Promise.reject(e)})),t};function St(){return wt.apply(this,arguments)}function wt(){return(wt=Object(s.a)(r.a.mark((function e(){var t,a,n,s,i,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([vt(),_t()]);case 2:return t=e.sent,a=Object(o.a)(t,2),n=a[0],s=a[1],i=null===s||void 0===s?void 0:s.z_api_key,l={"Content-Type":"application/json",crm_org_id:n,z_api_key:i},e.abrupt("return",l);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _t(){return xt.apply(this,arguments)}function xt(){return(xt=Object(s.a)(r.a.mark((function e(){var t,a,n,o,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Le(rt("data_for_extension"),"getDataForRecord",null),a=(null===t||void 0===t?void 0:t.timestamp)||-1/0,n=qe(a),!(t&&n<60)){e.next=7;break}o=t,e.next=19;break;case 7:return e.prev=7,e.next=10,ht.a.CRM.FUNCTIONS.execute("twiliosmsextension0__get_data_for_extension",{});case 10:s=e.sent,o=Le(s.details.output,"get_data_for_extension",{}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),pt("(In initial render app, after clear cached)",e.t0);case 17:o.timestamp=Date.now(),ot("data_for_extension",JSON.stringify(o));case 19:return e.abrupt("return",o);case 20:case"end":return e.stop()}}),e,null,[[7,14]])})))).apply(this,arguments)}var Ct=a(1061);function kt(){var e={},t=["#f4f4f8","#003D4C","#FF8727","#FFCC42"];return function(a,n){if(e[a])return e[a];if(a===n)return"#007aff";var r=t.filter((function(t){return!Object.values(e).includes(t)}));return e[a]=r[0],e[a]}}var Et,Tt,Nt=function(e){return"#f4f4f8"===e?"#000":"#fff"},It=Object(Ct.a)((function(){return{root:{fontFamily:"'Roboto', sans-serif",fontWeight:400,borderRadius:"50%",textAlign:"center",color:function(e){return"".concat(e.uniqueForeGroundColor)},textTransform:"uppercase",verticalAlign:"middle",backgroundColor:function(e){return"".concat(e.color)},width:function(e){return"".concat(e.size,"px")},fontSize:function(e){return"".concat(Math.round(e.size/3),"px")},height:function(e){return"".concat(e.size,"px")},lineHeight:function(e){return"".concat(e.size,"px")}}}})),Ot=function(e){var t=e.id,a=e.name,n=e.size,r=e.color,o=e.currentUserId,s=(0,e.getUniqueColor)(t,o),i=Nt(s),l=It({size:n,color:r||s,uniqueForeGroundColor:i}),c=(null===a||void 0===a?void 0:a.match(/\b\w/g))||[];return g.a.createElement("div",{className:l.root},c.slice(0,2))},Mt=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return g.a.createElement("div",null,g.a.createElement(Q.a,{className:this.props.classes.progress}))}}]),a}(g.a.Component),Pt=Object(S.a)((function(e){return{progress:{margin:e.spacing(40),color:"#2196f3"}}}))(Mt),At=a(1062),Dt=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return this.props.loading&&g.a.createElement(At.a,{classes:{root:this.props.classes.progress,bar1Indeterminate:this.props.classes.inprogress,bar2Indeterminate:this.props.classes.inprogress},variant:"indeterminate"})}}]),a}(g.a.Component),jt=Object(S.a)((function(){return{progress:{position:"fixed!important",top:"0",left:"0",right:"0",width:"100%",backgroundColor:"#e0e0e0",zIndex:999},inprogress:{backgroundColor:"#2196f3"}}}))(Dt),Rt=a(1117),Ft=a(57),Ut=a.n(Ft),Lt=a(76),Vt=a.n(Lt),Bt=a(122),qt=a.n(Bt),Wt=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={open:!1,message:"",component:void 0},e.openSnackbar=function(t){var a=t.message,n=t.component;e.setState({open:!0,message:a,component:n})},e.handleSnackbarClose=function(){e.setState({open:!1,message:"",component:void 0})},e}return Object(l.a)(a,[{key:"componentDidMount",value:function(){Et=this.openSnackbar,Tt=this.handleSnackbarClose}},{key:"render",value:function(){var e,t=g.a.createElement("span",{id:"snackbar-message-id"},"Authenticate"===this.state.message?"It looks like your Twilio account is low on credit.".concat(" ","\n        Log into the console and top up your balance. If you\u2019ve\n        done this and still see this message, please send a\n        screenshot to team@delugeonaluge.com"):this.state.message);return g.a.createElement(Rt.a,{anchorOrigin:{vertical:"top",horizontal:"right"},message:t,onClose:this.handleSnackbarClose,open:this.state.open,action:[g.a.createElement(E.a,{key:"close","aria-label":"close",color:"inherit",className:this.props.classes.close,onClick:this.handleSnackbarClose},g.a.createElement(qt.a,null))]},null===(e=this.state)||void 0===e?void 0:e.component)}}]),a}(g.a.Component);function zt(e){var t=e.message,a=e.component;Et({message:t,component:a})}var Ht=Vt()((function(e){return Ut()({close:{padding:e.spacing(.5)}})}))(Wt),Yt=a(288),Gt=a.n(Yt);function Qt(e,t){return Jt.apply(this,arguments)}function Jt(){return(Jt=Object(s.a)(r.a.mark((function e(t,a){var n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={id:a},["Leads","Contacts","Deals"].includes(t)?(n.twiliosmsextension0__We_Sent_Them_An_SMS_and_They_Haven_t_Replied=!1,n.twiliosmsextension0__They_sent_an_SMS_and_we_haven_t_replied=!1):(n.We_Sent_Them_An_SMS_and_They_Haven_t_Replied=!1,n.They_sent_an_SMS_and_we_haven_t_replied=!1),o={Entity:t,APIData:n,Trigger:["workflow"]},e.next=6,ht.a.CRM.API.updateRecord(o);case 6:return e.next=8,Kt(a);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Kt=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={entity_id:t},n={zoho_contact_id:t},e.next=4,Promise.all([yt().post("api/v1/close_conversation/",a).catch((function(e){return console.log(e)})),Ne.a.post("".concat("https://delugeonaluge.com/mobile-app/","dev/public/api/mark-conversation-closed"),n).catch((function(e){return console.log(e)})),Ne.a.post("".concat("https://delugeonaluge.com/mobile-app/","prod/public/api/mark-conversation-closed "),n).catch((function(e){return console.log(e)}))]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function Zt(){return Xt.apply(this,arguments)}function Xt(){return(Xt=Object(s.a)(r.a.mark((function e(){var t,a,n,o,s,i,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=rt(a="activeUsers"))){e.next=8;break}if(o=Le(n,a,{}),i=(null===(s=o)||void 0===s?void 0:s.timestamp)||0,!(We(i)<1)){e.next=8;break}return e.abrupt("return",null===(l=o)||void 0===l?void 0:l.users);case 8:return e.next=10,ht.a.CRM.API.getAllUsers({Type:"ActiveUsers"});case 10:return(o=e.sent).timestamp=Date.now(),ot(a,JSON.stringify(o)),e.abrupt("return",null===(t=o)||void 0===t?void 0:t.users);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var $t=a(44),ea=function(e){return"boolean"===typeof e?e:!!e&&"true"===e.toLowerCase()},ta="api/v1/from_numbers/",aa=function(){var e=Object(s.a)(r.a.mark((function e(){var t,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,yt().get(ta);case 3:return t=e.sent,a=null===t||void 0===t?void 0:t.data.map((function(e){return{id:e.id,phoneNumber:e.number,enabled:ea(e.is_enabled),description:e.description,teamId:e.team_id,crm_owner_id:e.crm_owner_id,criteria:e.criteria_for_when_to_use,available_to_all_users:ea(e.available_to_all_users),gateway_phone_number_id:e.gateway_phone_number_id,webhook_url_correct:ea(e.webhook_url_correct)}})),e.abrupt("return",a);case 8:return e.prev=8,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",[]);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),na=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,o,s,i,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Yn();case 3:return a=e.sent,n=a.twilio_account_sid,o=a.twilio_auth_token,s={number:t.phoneNumber,crm_owner_id:t.crm_owner_id,separate_twilio_account_sid:n,separate_twilio_auth_token:o,is_enabled:t.enabled,description:t.description,criteria_for_when_to_use:t.criteria,team_id:t.teamId,id:null===t||void 0===t?void 0:t.id,available_to_all_users:t.available_to_all_users,gateway_credential_id:t.gateway_id},e.next=9,yt().post(ta,[s]);case 9:return i=e.sent,l=null===i||void 0===i?void 0:i.data.map((function(e){return{id:e.id,phoneNumber:e.number,enabled:ea(e.is_enabled),description:e.description,teamId:e.team_id,crm_owner_id:e.crm_owner_id,criteria:e.criteria_for_when_to_use,available_to_all_users:ea(e.available_to_all_users),gateway_phone_number_id:e.gateway_phone_number_id}})),e.abrupt("return",l[0]);case 14:throw e.prev=14,e.t0=e.catch(0),console.error(e.t0),e.t0;case 18:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t){return e.apply(this,arguments)}}(),ra=function(){try{return yt().post("api/v1/sync_from_numbers/")}catch(e){throw console.error(e),e}},oa=function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,yt().post(ta,t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}();function sa(){return ia.apply(this,arguments)}function ia(){return(ia=Object(s.a)(r.a.mark((function e(){var t,a,n,o,s,i,l,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ae){e.next=6;break}return e.next=3,aa();case 3:return n=e.sent,o=n.reduce((function(e,t){return e[t.phoneNumber]?e:Object(_.a)(Object(_.a)({},e),{},Object($t.a)({},t.phoneNumber,t))}),{}),e.abrupt("return",Object.values(o));case 6:return e.next=8,ht.a.CRM.FUNCTIONS.execute("twiliosmsextension0__get_from_numbers_from_twilio",{});case 8:return s=e.sent,i=(null===s||void 0===s||null===(t=s.details)||void 0===t?void 0:t.output)?Le(null===s||void 0===s||null===(a=s.details)||void 0===a?void 0:a.output,"getfromnumbers",[]):[],l=i.reduce((function(e,t){return e[t.phone_number]?e:Object(_.a)(Object(_.a)({},e),{},Object($t.a)({},t.phone_number,t))}),{}),c=Object.values(l),e.abrupt("return",c);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var la=function(){var e=Object(s.a)(r.a.mark((function e(){var t,a,n,o,s,i,l,c,u,d,m,p,h,g;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=rt(t="twiliosmsextension0__Twilio_From_Numbers"))){e.next=8;break}if(n=Le(a,t,{}),o=n.timestamp||-1/0,!(qe(o)<60)){e.next=8;break}return e.abrupt("return",n.allFromNumbers);case 8:if(s=[],i=!0,l=0,e.prev=11,!ae){e.next=19;break}return e.next=15,aa();case 15:c=e.sent,s=c.map(ca),e.next=27;break;case 19:if(!i){e.next=27;break}return e.next=22,ht.a.CRM.API.getAllRecords({Entity:t,sort_order:"asc",page:l,per_page:200});case 22:d=e.sent,Array.isArray(null===d||void 0===d?void 0:d.data)&&(s=[].concat(Object(w.a)(s),Object(w.a)(d.data)),l+=1),i=null===d||void 0===d||null===(u=d.info)||void 0===u?void 0:u.more_records,e.next=19;break;case 27:e.next=43;break;case 29:if(e.prev=29,e.t0=e.catch(11),p=e.t0,p=Object(_.a)(Object(_.a)({},p),{},{apiName:"From numbers records API"}),h=(null===(m=p.message)||void 0===m?void 0:m.toLowerCase())||"",!(h.includes("permission denied")||h.includes("module name seems to be invalid"))){e.next=40;break}return e.next=38,lt();case 38:e.next=42;break;case 40:return e.next=42,ut(p);case 42:throw p;case 43:return g={allFromNumbers:s,timestamp:Date.now()},ot(t,JSON.stringify(g)),e.abrupt("return",s);case 46:case"end":return e.stop()}}),e,null,[[11,29]])})));return function(){return e.apply(this,arguments)}}(),ca=function(e){return{id:e.id,twiliosmsextension0__Do_Not_Use_in_CRM:!e.enabled,twiliosmsextension0__Criteria_For_When_Number_Should_Be_Used:e.criteria,Name:e.phoneNumber,twiliosmsextension0__Description_of_number:e.description,twiliosmsextension0__Accessible_To_All_Users:e.available_to_all_users,Owner:{id:e.crm_owner_id,name:"",email:""},twiliosmsextension0__Phone_Number_SID:e.gateway_phone_number_id}},ua=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Number";return e.map((function(e){var n;return{label:"".concat(e.twiliosmsextension0__Description_of_number||a," (").concat(e.Name,")"),name:"".concat(e.twiliosmsextension0__Description_of_number||a," (").concat(e.Name,")"),value:e.Name||"",completeRecordData:e,isMine:(null===(n=e.Owner)||void 0===n?void 0:n.id)===t}}))},da=function(e,t,a,n){try{var r=[],o=a.users[0].id,s=a.users[0].email,i=t.map((function(e){return e.completeRecordData})),l=Le(e.twiliosmsextension0__Criteria_For_When_Number_Should_Be_Used,"criteriaForFromNumber",{});return Object.keys(l).every((function(t){var a;if("user_email"===t)return(l[t]||"").split(",").includes(s);if("from_number_owner_id"===t)return(l[t]||"").split(",").includes(null===e||void 0===e||null===(a=e.Owner)||void 0===a?void 0:a.id);if("record_owner_id"===t){var r=(l[t]||"").split(",");return n.some((function(e){var t;return r.includes((null===e||void 0===e||null===(t=e.completeRecordData)||void 0===t?void 0:t.Owner).id)}))}if("user_id"===t)return(l[t]||"").split(",").includes(o.toString());if("defaultForEveryone"===t)return!0;var c=(l[t]||"").split(",");return i.some((function(e){return c.includes(e[t])}))}))&&r.unshift({label:"Matched Number (".concat(e.Name,")"),name:"Matched Number (".concat(e.Name,")"),value:e.Name||"",completeRecordData:e,hasCriteria:!0}),r}catch(u){var c={};return c.message="Criteria for number to be used ".concat(u.message),c.extraInfo=e.twiliosmsextension0__Criteria_For_When_Number_Should_Be_Used,window.Sentry.captureException(c),[]}},ma=function(){var e=Object(s.a)(r.a.mark((function e(t,a,n,o){var s,i,l,c,u,d,m,p,h,g,f,v,b;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,la();case 2:return l=e.sent,c={},u=t.users[0].id,d="Administrator"===(null===(s=t.users[0])||void 0===s||null===(i=s.profile)||void 0===i?void 0:i.name),m=[],p=[],h=[],d&&l.length?(g=l.filter((function(e){return!e.twiliosmsextension0__Do_Not_Use_in_CRM})),h=g.map((function(e){return e.twiliosmsextension0__Criteria_For_When_Number_Should_Be_Used?da(e,a,t,o):ua([e],u)})).flat()):l.length&&l.forEach((function(e){var r;if(e.Name===n&&(c=e),!e.twiliosmsextension0__Do_Not_Use_in_CRM){if(e.twiliosmsextension0__Criteria_For_When_Number_Should_Be_Used){var s=da(e,a,t,o);m.push.apply(m,Object(w.a)(s))}if((null===e||void 0===e||null===(r=e.Owner)||void 0===r?void 0:r.id)===u){var i=ua([e],u);m.push.apply(m,Object(w.a)(i))}else if(e.twiliosmsextension0__Accessible_To_All_Users){var l=ua([e],u,"Organization Number");p.push.apply(p,Object(w.a)(l))}}})),f=c.twiliosmsextension0__Description_of_number||"Default Twilio Number",v=[].concat(m,[{label:"".concat(f," (").concat(n,")"),value:n,name:"".concat(f," (").concat(n,")"),completeRecordData:c}],p,Object(w.a)(h)).filter((function(e){return e&&e.value&&e.value.length>2})),b=Object(w.a)(new Map(v.map((function(e){return[e.value,e]}))).values()),e.abrupt("return",b);case 14:case"end":return e.stop()}}),e)})));return function(t,a,n,r){return e.apply(this,arguments)}}();function pa(e){return ha.apply(this,arguments)}function ha(){return(ha=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={Entity:"twiliosmsextension0__Twilio_From_Numbers",APIData:Object(_.a)({},t),Trigger:["workflow"]},e.next=3,ht.a.CRM.API.updateRecord(a);case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ga="locked_from_number",fa=function(){return Le(rt(ga),"getLockedFromNumber",null)},va=function(){st(ga)},ba=function(e){var t=fa();t&&e&&(e.find((function(e){return e.value===t.value}))||va())},ya=a(289),Sa=a.n(ya),wa=a(135),_a=a.n(wa);function xa(e){return Ca.apply(this,arguments)}function Ca(){return(Ca=Object(s.a)(r.a.mark((function e(t){var a,n,o,s,i,l,c,u=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=u.length>1&&void 0!==u[1]&&u[1],e.prev=1,t){e.next=4;break}return e.abrupt("return",{fields:[]});case 4:if(o=Le(rt(n="fields_"+t),"getfields",null),s=(null===o||void 0===o?void 0:o.timestamp)||-1/0,i=We(s),!(o&&i<1)){e.next=12;break}l=o,e.next=17;break;case 12:return e.next=14,ht.a.CRM.META.getFields({Entity:t});case 14:(l=e.sent).timestamp=Date.now(),ot(n,JSON.stringify(l));case 17:return e.abrupt("return",l);case 20:if(e.prev=20,e.t0=e.catch(1),a){e.next=27;break}return c=_a()(e.t0,{apiName:"getFields API for module ".concat(t)}),e.next=26,ut(c);case 26:throw c;case 27:return e.abrupt("return",{fields:[]});case 28:case"end":return e.stop()}}),e,null,[[1,20]])})))).apply(this,arguments)}function ka(e){return Ea.apply(this,arguments)}function Ea(){return(Ea=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xa(t,!0);case 2:return a=e.sent,e.abrupt("return",Ta(a.fields));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ta=function(e){return e?e.filter((function(e){return"phone"===e.data_type})).map((function(e){return e.api_name})):[]},Na=a(539),Ia=a.n(Na);function Oa(e,t){return Ma.apply(this,arguments)}function Ma(){return(Ma=Object(s.a)(r.a.mark((function e(t,a){var n,o,s,i,l,c,u,d,m,p=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=p.length>2&&void 0!==p[2]?p[2]:1,o=t.map((function(e){var t;return{id:null===e||void 0===e||null===(t=e.data[0].Contact_Name)||void 0===t?void 0:t.id}})),s=Math.exp(n)+2*Math.random(),i=[],l=Pa(o),c=l.idsNotInCache,u=l.recordsFromCache,!c.length){e.next=23;break}return e.prev=6,e.next=9,Aa(a,c);case 9:d=e.sent,i=[].concat(Object(w.a)(i),Object(w.a)(d)),e.next=23;break;case 13:if(e.prev=13,e.t0=e.catch(6),!(n>5)){e.next=20;break}return m=_a()(e.t0,{apiName:"get linked contact by getRecords API"}),e.next=19,ut(m);case 19:throw m;case 20:return e.next=22,ze(s);case 22:return e.abrupt("return",Oa(t,a,n+1));case 23:return i=[].concat(Object(w.a)(i),Object(w.a)(u)),e.abrupt("return",i);case 25:case"end":return e.stop()}}),e,null,[[6,13]])})))).apply(this,arguments)}var Pa=function(e){var t=[],a=[];return e.forEach((function(e){var n=e.id,r=Le(rt("numbers_for_contact_".concat(n.toString())),"getNumbersForContact",null),o=We(null===r||void 0===r?void 0:r.timestamp);r&&o<1?a.push(r.data):t.push(n)})),{idsNotInCache:t,recordsFromCache:a}},Aa=function(){var e=Object(s.a)(r.a.mark((function e(t,a){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(a.map(function(){var e=Object(s.a)(r.a.mark((function e(a){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ht.a.CRM.API.getRecord({Entity:"Contacts",RecordID:a});case 2:return n=e.sent,e.abrupt("return",Ia()(n.data[0],[].concat(Object(w.a)(t),["id"])));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:return(n=e.sent).flat().forEach((function(e){ot("numbers_for_contact_".concat(e.id.toString()),JSON.stringify({data:e,timestamp:Date.now()}))})),e.abrupt("return",n.flat());case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),Da=function(){var e=Object(s.a)(r.a.mark((function e(t,a){var n,i,l,c,u,d,m,p,h,g;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Sa()(t||[],(function(e){var t,a;return null===(t=e.data[0])||void 0===t||null===(a=t.Contact_Name)||void 0===a?void 0:a.id})),i=Object(o.a)(n,2),l=i[0],c=i[1],u=ja(c,a),d=[],!l.length){e.next=13;break}return e.next=6,xa("Contacts",!0);case 6:return m=e.sent,p=Ta(m.fields),h=Gt()(l,25),e.next=11,Promise.all(h.map(function(){var e=Object(s.a)(r.a.mark((function e(t){var n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Oa(t,p);case 2:return n=e.sent,o=Ra(n,l,a),e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:g=e.sent,d=g.flat();case 13:return e.abrupt("return",[].concat(Object(w.a)(d),Object(w.a)(u)));case 14:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();function ja(e,t){return e.map((function(e){var a=e.data[0];return{completeRecordData:Object(_.a)(Object(_.a)({},a),{},{entity:t}),entity:t}}))}var Ra=function(e,t,a){return e.map((function(e){var n=t.find((function(t){var a;return(null===(a=t.data[0].Contact_Name)||void 0===a?void 0:a.id)===(null===e||void 0===e?void 0:e.id)}));return{completeRecordData:Object(_.a)(Object(_.a)({},null===n||void 0===n?void 0:n.data[0]),{},{contactData:e,entity:a}),entity:a}}))},Fa="reload_window_count",Ua=function(e,t){var a=e.maxReload,n=void 0===a?5:a,r=e.message,o=void 0===r?De:r,s=rt(Fa)||"0",i=parseInt(s,10);if(i<n&&(i+=1,t&&"function"===typeof t&&t(),ot(Fa,i.toString()),setTimeout((function(){window.location.reload()}),500)),i>=n){var l=document.createElement("p");l.innerHTML=o+"Error: try reloading (".concat(i," times) at ").concat(e.functionName," ")+"".concat(e.data&&JSON.stringify(e.data,null,2)),Oe()({icon:"warning",content:{element:l},buttons:["Cancel","Do a fresh reload"]}).then((function(t){t?(nt(),i=0):i+=1,ot(Fa,i.toString()),i>=n+1&&(window.Sentry.captureException(new Error("".concat(e.functionName,": Infinite reload loop on settings page for ").concat(JSON.stringify(e.data)))),ot(Fa,"0")),window.location.reload()}))}};function La(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";if(!e)return[];var s=Va(t,n);try{var i=e.Full_Name||e.Name||e.Deal_Name||"",l=e.id,c=e.twiliosmsextension0__Whatsapp_Number&&"whatsapp:".concat(e.twiliosmsextension0__Whatsapp_Number),u=e.contactData?Object.keys(e.contactData).filter((function(e){return!e.includes("id")})).reduce((function(t,a){var n;return t[a]=null===e||void 0===e||null===(n=e.contactData)||void 0===n?void 0:n[a],t}),{}):null,d=u?Object.values(u):[],m=s.map((function(t){return t?e[t.replaceAll(",","").trim()]:null})).filter(Boolean),p=[e.Mobile,e.Phone,c].concat(Object(w.a)(m),Object(w.a)(d)),h=[];r||(h=[e[a]]),"Mobile"===a&&(h=[e[a]]),e[a]&&(h=[e[a]]),"Whatsapp Number"===a&&(h=[c]),(null===a||void 0===a?void 0:a.includes("Contact_Name"))&&u&&(h=[u[a]]),"Numbers From Contact"===a&&(h=Object(w.a)(d)),"API Names Specified In Settings"===a&&(h=Object(w.a)(m)),(0===h.filter((function(e){return Boolean(e)})).length&&r||"All Possible Numbers"===a)&&(h=p);var g=h.filter((function(e){return Boolean(e)})).map((function(t){var a;return{label:"".concat(i," (").concat(t,")"),value:t,name:i,lookupID:l,entity:null!==(a=e.entity)&&void 0!==a?a:o,completeRecordData:e,phoneNumberFields:n}}));return Object(w.a)(new Set(g))}catch(v){var f=Object(_.a)({},v);return f.apiName="phone_number_api_names with ".concat(s.toString()),ut(f),[]}}var Va=function(e,t){var a=e;return a&&"{}"!==JSON.stringify(a)||(a=[]),Array.isArray(a)||(a=a.includes("[")?Le(a,"phone_number_api_names",[]):(a.toString()||"").split(",").concat(t)),a};function Ba(e,t,a,n){return qa.apply(this,arguments)}function qa(){return(qa=Object(s.a)(r.a.mark((function e(t,a,n,s){var i,l,c,u,d,m,p,h,g,f,v,b,y,S,w,x,C,k,E,T,N=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=N.length>4&&void 0!==N[4]?N[4]:0,e.prev=1,e.next=4,Xa(["twiliosmsextension0__Twilio_auth","twiliosmsextension0__Account_SID","twiliosmsextension0__Phone_Number_API_Names","twiliosmsextension0__Default_Twilio_From_Number","twiliosmsextension0__Field_to_use_for_bulk_SMS"]);case 4:return l=e.sent,c=Object(o.a)(l,5),u=c[0],d=c[1],m=c[2],p=c[3],h=c[4],g={authtoken:u,accountSID:d},e.next=14,Da(a,n);case 14:return f=e.sent,e.next=17,ka(n);case 17:return v=e.sent,b=sn(f,m,h,v),e.next=21,ma(s,f,p,b);case 21:if(y=e.sent,ba(y),S=[],w=[],"RelatedList"!==t){e.next=32;break}if(!(f.length>0)){e.next=30;break}return e.next=29,wn(f[0]);case 29:S=e.sent;case 30:e.next=35;break;case 32:return e.next=34,Pn(n);case 34:w=e.sent;case 35:return e.abrupt("return",{fromData:y,templatesForThisEntity:w,toArray:b,authValue:g,messages:S,defaultFromNumberValue:p,phoneNumberAPINamesData:m,currentSelectedModule:n});case 38:if(e.prev=38,e.t0=e.catch(1),C=e.t0,k=Object(_.a)(Object(_.a)({},C),{},{apiName:"getDataFromZohoApi"}),E="429"===C.code,!(i<5||E)){e.next=48;break}return console.error(C),e.next=47,ze(i+1);case 47:return e.abrupt("return",Ba(t,a,n,s,i+1));case 48:if(T=(null===(x=C.message)||void 0===x?void 0:x.toLowerCase())||"",!(T.includes("permission denied")||T.includes("module name seems to be invalid"))){e.next=55;break}return e.next=53,lt();case 53:e.next=57;break;case 55:return e.next=57,ut(k);case 57:throw k;case 58:case"end":return e.stop()}}),e,null,[[1,38]])})))).apply(this,arguments)}var Wa="Unknown CRM User",za=/error_code["|']\s*:\s*(\d{5})/g,Ha=/error_message["|']\s*:\s*["|']([\w|\s|\\"|\\']*)["|']/g;function Ya(){return Ga.apply(this,arguments)}function Ga(){return(Ga=Object(s.a)(r.a.mark((function e(){var t,a,n,o,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Le(rt("data_for_extension"),"getDataForRecord",null),a=(null===t||void 0===t?void 0:t.timestamp)||-1/0,n=qe(a),!(t&&n<60)){e.next=7;break}o=t,e.next=19;break;case 7:return e.prev=7,e.next=10,ht.a.CRM.FUNCTIONS.execute("twiliosmsextension0__get_data_for_extension",{});case 10:s=e.sent,o=Le(s.details.output,"get_data_for_extension",{}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),pt("(In initial render app, after clear cached)",e.t0);case 17:o.timestamp=Date.now(),ot("data_for_extension",JSON.stringify(o));case 19:return e.abrupt("return",o);case 20:case"end":return e.stop()}}),e,null,[[7,14]])})))).apply(this,arguments)}function Qa(){return Ja.apply(this,arguments)}function Ja(){return(Ja=Object(s.a)(r.a.mark((function e(){var t,a,n,o,s,i,l,c,u,d;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Le(rt("current_user_data"),"getCurrentUserData",null),a=(null===t||void 0===t?void 0:t.timestamp)||-1/0,n=We(a),!(t&&n<1)){e.next=7;break}o=t,e.next=16;break;case 7:return e.next=9,ht.a.CRM.CONFIG.getCurrentUser();case 9:if(o=e.sent,(null===(s=o.users)||void 0===s||null===(i=s[0])||void 0===i?void 0:i.phone)||(null===(l=o.users)||void 0===l||null===(c=l[0])||void 0===c?void 0:c.mobile)){e.next=14;break}return e.next=13,ht.a.CRM.API.getUser({ID:null===(u=o.users)||void 0===u||null===(d=u[0])||void 0===d?void 0:d.id});case 13:o=e.sent;case 14:o.timestamp=Date.now(),ot("current_user_data",JSON.stringify(o));case 16:return e.abrupt("return",o);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ka(e){return Za.apply(this,arguments)}function Za(){return(Za=Object(s.a)(r.a.mark((function e(t){var a,n,o,s,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Le(rt(a="userData_"+t),"getUserData",null),o=(null===n||void 0===n?void 0:n.timestamp)||-1/0,s=We(o),!(n&&s<1)){e.next=8;break}i=n,e.next=13;break;case 8:return e.next=10,ht.a.CRM.API.getUser({ID:t});case 10:(i=e.sent).timestamp=Date.now(),ot(a,JSON.stringify(i));case 13:return e.abrupt("return",i);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xa(e,t){return $a.apply(this,arguments)}function $a(){return($a=Object(s.a)(r.a.mark((function e(t,a){var n,o,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=[],o={},Array.isArray(t)&&t.forEach((function(e){var t=Le(rt("orgVariable_".concat(e)),"getOrgVar",null),r=We((null===t||void 0===t?void 0:t.timestamp)||0),s=!a&&t&&r<=1;s&&e.includes("twiliosmsextension0__Accepted_Terms_and_Conditions")&&(s=JSON.stringify(t).includes("true")),s&&(e.includes("twiliosmsextension0__Twilio_auth")||e.includes("twiliosmsextension0__Account_SID"))&&(s=!JSON.stringify(t).includes('"value":""')||((null===t||void 0===t?void 0:t.value)||"").length<6),s&&e.includes("twiliosmsextension0__Block_Access")&&(s=JSON.stringify(t).includes("false")),s?o[e]=t:n.push(e)})),s=null,!n.length){e.next=13;break}return e.next=8,ht.a.CRM.API.getOrgVariable({apiKeys:n});case 8:if((s=e.sent)&&s.Success){e.next=11;break}return e.abrupt("return",[]);case 11:1===n.length?o[n[0]]={timestamp:Date.now(),value:s.Success.Content}:n.forEach((function(e){o[e]=Object(_.a)({timestamp:Date.now()},s.Success.Content[e])})),n.forEach((function(e){ot("orgVariable_".concat(e),JSON.stringify(o[e]))}));case 13:return e.abrupt("return",t.map((function(e){var t;return null===(t=o[e])||void 0===t?void 0:t.value})));case 16:e.prev=16,e.t0=e.catch(0),console.error(e.t0),window.Sentry.captureException(e.t0);case 21:return e.abrupt("return",[]);case 22:case"end":return e.stop()}}),e,null,[[0,16]])})))).apply(this,arguments)}function en(){return tn.apply(this,arguments)}function tn(){return(tn=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){ht.a.embeddedApp.on("PageLoad",function(){var t=Object(s.a)(r.a.mark((function t(a){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e(a);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),ht.a.embeddedApp.init()})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function an(){return nn.apply(this,arguments)}function nn(){return(nn=Object(s.a)(r.a.mark((function e(){var t,a,n,s,i,l,c,u,d,m,p,h,g,f,v,b,y,S,w,_,x,C,k,E;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=["twiliosmsextension0__Twilio_auth","twiliosmsextension0__Account_SID","twiliosmsextension0__Phone_Number_API_Names","twiliosmsextension0__Default_Twilio_From_Number","twiliosmsextension0__Field_to_use_for_bulk_SMS","twiliosmsextension0__Default_international_phone_prefix","twiliosmsextension0__Create_tasks_for_inbound_messages","twiliosmsextension0__Automatically_create_leads_for_unknown_numbers","twiliosmsextension0__Custom_Modules_Linked_To_Twilio","twiliosmsextension0__Support_Person_Email_Address","twiliosmsextension0__Send_hourly_digest","twiliosmsextension0__Use_Separate_Twilio_Credentials_For_Every_User","twiliosmsextension0__API_Names_for_Record_Owner_for_inbox","twiliosmsextension0__Accepted_Terms_and_Conditions","twiliosmsextension0__Onboarding_Completed","twiliosmsextension0__SMS_to_Email","twiliosmsextension0__Link_inbound_messages_to_all_possible_contacts","twiliosmsextension0__Use_inbound_fetcher","twiliosmsextension0__Allow_users_to_see_each_others_messages"],e.next=3,Xa(t,!0);case 3:return a=e.sent,n=Object(o.a)(a,19),s=n[0],i=n[1],l=n[2],c=n[3],u=n[4],d=n[5],m=n[6],p=n[7],h=n[8],g=n[9],f=n[10],v=n[11],b=n[12],y=n[13],S=n[14],w=n[15],_=n[16],x=n[17],C=n[18],k={authtoken:s,accountSID:i},e.next=27,Qa();case 27:return E=e.sent,e.abrupt("return",{authtokenData:s,accountSIDData:i,authValue:k,phoneNumberAPINamesData:l,defaultFromNumber:c,globalFieldToUseForNumber:u,defaultInternationalPrefix:d,createTasksInbound:m,createLeadsContacts:p,customModules:h,supportPersonEmail:g,sendHourlyDigest:f,supportMultipleTwilioAccounts:v,apiNamesForRecordOwner:b,termsAccepted:y,isOnboardingComplete:S,smsToEmail:w,currentUserData:E,linkInboundMessages:_,useInboundFetcher:x,seeEachOtherMessages:C,orgVariableList:t});case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rn(e){return on.apply(this,arguments)}function on(){return(on=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=Object(s.a)(r.a.mark((function e(a){var n,i,l,c,u,d,m,p,h,g,f,v,b,y,S,w,x,C,k,E,T,N,I,O,M,P,A,D,j,R,F,U,L,V,B,q,W,z,H,Y,G,Q,J;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.Entity){e.next=5;break}return e.next=3,an();case 3:return window.settingsData=e.sent,e.abrupt("return",a(window.settingsData));case 5:return n=t.EntityId,i=t.Entity,e.next=9,Promise.all([ln(i),Qa(),Xa(["twiliosmsextension0__Field_to_use_for_bulk_SMS","twiliosmsextension0__Phone_Number_API_Names"])]);case 9:for(l=e.sent,c=Object(o.a)(l,3),u=c[0],d=c[1],m=Object(o.a)(c[2],2),p=m[0],h=m[1],g=t.ButtonPosition?t.EntityId[0]:t.EntityId,f=t.ButtonPosition?t.ButtonPosition:"RelatedList",v=[],b=Array.isArray(n)?n:[n],50,y=[],S=0;S<b.length;S+=50)w=b.slice(S,S+50),y.push(w);return e.next=25,Promise.all(y.flatMap(function(){var e=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Rn(i,t,"");case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 25:return x=e.sent,C=x.flat(),k=C,Array.isArray(n)||(k=C[0]),E=Le(h,"phone number api names",[]),e.next=32,xn(u);case 32:if(T=e.sent,N=[],I=[],!T.find((function(e){return"Contacts"===(null===e||void 0===e?void 0:e.moduleName)}))){e.next=48;break}return e.next=38,xa("Contacts",!0);case 38:if(!(null===(M=e.sent)||void 0===M||null===(O=M.fields)||void 0===O?void 0:O.length)){e.next=47;break}if(I=Ta(M.fields),!(P=C.filter((function(e){var t;return null===(t=e.data[0].Contact_Name)||void 0===t?void 0:t.id}))).length){e.next=47;break}return A=Gt()(P,25),e.next=46,Promise.all(A.map(function(){var e=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Oa(t,I);case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 46:N=e.sent;case 47:N=N.flat();case 48:if(v=C.map((function(e){var t=N.find((function(t){var a;return t.id===(null===(a=e.data[0].Contact_Name)||void 0===a?void 0:a.id)}))||{};return sn([{completeRecordData:Object(_.a)(Object(_.a)({},e.data[0]),{},{contactData:t,entity:i})}],E,p,I||[])})).flat(),j=[],!(R=Je(g))||"RelatedList"!==f){e.next=67;break}return e.next=54,Promise.all([Xa(["twiliosmsextension0__Default_Twilio_From_Number"]),Da(C,i)]);case 54:return F=e.sent,U=Object(o.a)(F,2),L=Object(o.a)(U[0],1),V=L[0],B=U[1],e.next=61,ma(d,B,V,v);case 61:q=e.sent,Ze(q),Xe(v),D=Object(_.a)(Object(_.a)({},R),{},{fromData:q,toArray:v}),e.next=74;break;case 67:return e.next=69,Ba(f,C,i,d);case 69:D=e.sent,z=(W=D).fromData,H=W.toArray,Y=W.messages,"ListView"!==f&&et(g,{fromData:z,toArray:H,messages:Y,timestamp:Date.now()},f),j=D.templatesForThisEntity,ot(i,JSON.stringify({templatesForThisEntity:D.templatesForThisEntity}),{debug:!0});case 74:if(G=D.fromData,ba(G),v.length||(v=D.toArray),Q=D.messages,J=k,ot("twilio_settings",JSON.stringify({phoneNumberAPINames:E}),{debug:!0}),ot("messages_"+g,JSON.stringify({messages:Be(Q)}),{debug:!0}),!window.location.href.includes("powerCall.html")){e.next=85;break}return window.initData={fromData:G,templatesForThisEntity:j,toArray:v,messages:Q,widgetType:f,currentRecordDetails:J,currentSelectedModule:i,moduleFields:u,currentUserData:d,globalFieldToUseForNumber:p,phoneNumberAPINamesData:h},a(window.initData),e.abrupt("return");case 85:a({fromData:G,templatesForThisEntity:j,toArray:v,messages:Q,widgetType:f,currentRecordDetails:J,currentSelectedModule:i,moduleFields:u,currentUserData:d,globalFieldToUseForNumber:p,phoneNumberAPINamesData:h});case 86:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function sn(e,t,a,n){return e.map((function(e){var r=e.completeRecordData.twiliosmsextension0__Number_to_Use_for_Twilio_Messages||e.completeRecordData.twiliosmsextension0__Number_Field_to_Use_for_Twilio_Messages;return(!r||r.length<2)&&(r=a),La(e.completeRecordData,t,r,n,!0)})).flat()}function ln(e){return cn.apply(this,arguments)}function cn(){return(cn=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xa(t);case 2:return a=e.sent,e.abrupt("return",null===a||void 0===a?void 0:a.fields);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function un(){return dn.apply(this,arguments)}function dn(){return(dn=Object(s.a)(r.a.mark((function e(){var t,a,n,o,s,i=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!(i.length>0&&void 0!==i[0])||i[0],e.prev=1,a=Le(rt("onboarding_data"),"onboardingData",null),n=(null===a||void 0===a?void 0:a.timestamp)||-1/0,o=We(n),!(a&&o<1&&t)){e.next=9;break}s=a,e.next=14;break;case 9:return e.next=11,ht.a.CRM.FUNCTIONS.execute("twiliosmsextension0__get_onboarding_data",{});case 11:(s=e.sent).timestamp=Date.now(),ot("onboarding_data",JSON.stringify(s));case 14:return e.abrupt("return",Le(s.details.output,"onboardingDataFunction",{}));case 17:return e.prev=17,e.t0=e.catch(1),e.abrupt("return",{error:"Could not execute function for onboarding screen"});case 20:case"end":return e.stop()}}),e,null,[[1,17]])})))).apply(this,arguments)}function mn(){return pn.apply(this,arguments)}function pn(){return(pn=Object(s.a)(r.a.mark((function e(){var t,a,n,o,s,i,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=Le(rt(a="orgVariable_twiliosmsextension0__Onboarding_Completed"),"onboardingcomplete",null),o=(null===n||void 0===n?void 0:n.timestamp)||-1/0,s=We(o),i={},!(n&&s<1&&(null===(t=n.value)||void 0===t?void 0:t.toString().includes("true")))){e.next=10;break}i=n,e.next=16;break;case 10:return e.next=12,Xa(["twiliosmsextension0__Onboarding_Completed"]);case 12:l=e.sent,i.timestamp=Date.now(),i.value=l[0],ot(a,JSON.stringify(i));case 16:return e.abrupt("return","true"===i.value);case 19:return e.prev=19,e.t0=e.catch(0),e.abrupt("return",{error:"Could not execute function for onboarding screen"});case 22:case"end":return e.stop()}}),e,null,[[0,19]])})))).apply(this,arguments)}function hn(e){return gn.apply(this,arguments)}function gn(){return(gn=Object(s.a)(r.a.mark((function e(t){var a,n,s,i,l,c,u,d,m,p,h,g,f,v,b;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=null===t||void 0===t?void 0:t.entity,e.next=4,Promise.all([Zt(),Qa()]);case 4:return s=e.sent,i=Object(o.a)(s,2),l=i[0],c=i[1],u=null===(a=c.users)||void 0===a?void 0:a[0],d=null===t||void 0===t?void 0:t.completeRecordData,e.next=12,Xa(["twiliosmsextension0__Custom_Modules_Linked_To_Twilio"]);case 12:return m=e.sent,p=Object(o.a)(m,1),h=p[0],g="?entity_id=".concat(null===d||void 0===d?void 0:d.id),"Accounts"!==n||(null===h||void 0===h?void 0:h.includes("Accounts"))||(g="?parent_entity_id=".concat(null===d||void 0===d?void 0:d.id)),e.next=19,yt().get("api/v1/get_messages/".concat(g)).catch((function(e){return[]}));case 19:return f=e.sent,v=[],Array.isArray(f.data)&&(v=f.data.flatMap((function(e){var t,a;if(!e)return[];var n=null;if(e.scheduled_time_to_send)n=X()(e.scheduled_time_to_send).toISOString();else{var r=e.timestamp;r.includes(" ")&&(r="".concat(r.replace(" ","T"),"Z")),n=new Date(r).toISOString()}var o=Le(e.message_webhook_data,"webhookContents",{}),s=Le(e.mms_content,"mmsContent",e.mms_content);za.lastIndex=0,Ha.lastIndex=0;var i=za.exec(e.message_webhook_data),c=i&&i[1],m=Ha.exec(e.message_webhook_data),p=m&&m[1];if(!p&&c){var h=mt(c);p=Boolean(h)?h.secondary_message||h.message:null}return"incoming"===e.message_type||"inbound"===e.message_type?{id:e.message_sid||"unknown",author:e.record_name||(null===d||void 0===d?void 0:d.Full_Name)||"unknown",from:e.from_number||"unknown",to:e.to||"unknown",ownerName:(null===u||void 0===u?void 0:u.full_name)||Wa,message:e.message||"",timestamp:n,mmsContent:s,messageType:"inbound",messageSource:e.message_source||e.twiliosmsextension0__Message_Source,status:e.status||"",errorMessage:e.twiliosmsextension0__Error||(null===o||void 0===o?void 0:o.message)||p||"",entity_id:e.linked_entity_id,owner_id:e.crm_owner_id,sender_user_id:e.sender_user_id||e.crm_owner_id,scheduledTimeToSend:e.scheduled_time_to_send||"",senderName:""}:{id:e.message_sid||"unknown",author:e.sender_user_id||Wa,from:e.from_number||"unknown",to:e.to||"unknown",ownerName:(null===l||void 0===l||null===(t=l.find((function(t){return t.id===e.crm_owner_id})))||void 0===t?void 0:t.full_name)||Wa,message:e.message||"",timestamp:n,mmsContent:s,messageType:"outbound",messageSource:e.message_source||e.twiliosmsextension0__Message_Source,status:e.status||"",errorMessage:e.twiliosmsextension0__Error||(null===o||void 0===o?void 0:o.message)||p||"",entity_id:e.linked_entity_id,owner_id:e.crm_owner_id,sender_user_id:e.sender_user_id||e.crm_owner_id,scheduledTimeToSend:e.scheduled_time_to_send||"",senderName:(null===l||void 0===l||null===(a=l.find((function(t){return t.id===e.sender_user_id})))||void 0===a?void 0:a.full_name)||Wa}}))),e.abrupt("return",v);case 25:return e.prev=25,e.t0=e.catch(0),b=Object.assign(e.t0,{apiName:"getMessagesFromBackend"}),e.next=30,ut(b);case 30:throw b;case 31:case"end":return e.stop()}}),e,null,[[0,25]])})))).apply(this,arguments)}var fn=[];function vn(){return bn.apply(this,arguments)}function bn(){return(bn=Object(s.a)(r.a.mark((function e(){var t,a,n,o,s=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!(s.length>0&&void 0!==s[0])||s[0],a="lastTimeSyncedWithBackend",e.prev=2,!t){e.next=9;break}if(n=Le(rt(a),a,null),!(qe(n||-1/0)<5)){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,ht.a.CRM.FUNCTIONS.execute("twiliosmsextension0__sync_to_backend",{});case 11:o=Date.now(),ot(a,JSON.stringify(o)),e.next=17;break;case 15:e.prev=15,e.t0=e.catch(2);case 17:case"end":return e.stop()}}),e,null,[[2,15]])})))).apply(this,arguments)}function yn(){return Sn.apply(this,arguments)}function Sn(){return(Sn=Object(s.a)(r.a.mark((function e(){var t,a,n,s,i,l,c,u,d,m,p;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t="allMessagesSynced",e.next=4,Yn();case 4:if(!(null===(a=e.sent)||void 0===a?void 0:a.always_use_backend_as_source_of_truth)){e.next=7;break}return e.abrupt("return",!0);case 7:if(!(n=rt(t))){e.next=14;break}if(s=Le(n,t,{}),i=s.timestamp||-1/0,!(qe(i)<5)){e.next=14;break}return e.abrupt("return",s.allMessagesSynced);case 14:return"select id from twiliosmsextension0__Sent_SMS where twiliosmsextension0__Synced='false'",e.next=17,Promise.all([ht.a.CRM.API.getAllRecords({Entity:"twiliosmsextension0__Sent_SMS",sort_order:"asc",sort_by:"twiliosmsextension0__Synced",page:1,per_page:50}),qn("select id from twiliosmsextension0__Sent_SMS where twiliosmsextension0__Synced='false'",0,[],0,!0,!0)]);case 17:return l=e.sent,c=Object(o.a)(l,2),u=c[0],d=c[1],m=((null===u||void 0===u?void 0:u.data)||[]).every((function(e){return e.twiliosmsextension0__Synced||"inbound"!==e.Message_Type}))&&0===(d||[]).length,p={allMessagesSynced:m,timestamp:Date.now()},ot(t,JSON.stringify(p)),e.abrupt("return",m);case 27:return e.prev=27,e.t0=e.catch(0),e.abrupt("return",!0);case 30:case"end":return e.stop()}}),e,null,[[0,27]])})))).apply(this,arguments)}function wn(e){return _n.apply(this,arguments)}function _n(){return(_n=Object(s.a)(r.a.mark((function e(t){var a,n,o,i,l,c,u,d,m,p,h,g,f=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=f.length>1&&void 0!==f[1]?f[1]:0,t){e.next=3;break}return e.abrupt("return",[]);case 3:if(null===t||void 0===t||null===(a=t.completeRecordData)||void 0===a?void 0:a.id){e.next=5;break}return e.abrupt("return",Ua({functionName:"getNewMessages",data:t,message:"no id found in currentRecordData",maxReload:1},(function(){it("reload_window_count")})));case 5:if(e.prev=5,o=function(){var e=Object(s.a)(r.a.mark((function e(a){var n,o,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!fn.includes(t.entity)){e.next=3;break}throw new Error("Related list not valid");case 3:return e.next=5,ht.a.CRM.API.getRelatedRecords({Entity:t.entity,RecordID:t.completeRecordData.id,RelatedList:l,page:a,per_page:200});case 5:if((n=e.sent).data){e.next=8;break}return e.abrupt("return",[]);case 8:return e.abrupt("return",n.data);case 11:return e.prev=11,e.t0=e.catch(0),fn.push(t.entity),o="".concat(t.entity.substring(0,t.entity.length-1),"Name"),e.next=17,ht.a.CRM.API.searchRecord({Entity:"twiliosmsextension0__Sent_SMS",Type:"criteria",Query:"(".concat(o,":equals:").concat(t.completeRecordData.id,")"),page:a,per_page:200});case 17:if((s=e.sent).data){e.next=20;break}return e.abrupt("return",[]);case 20:return e.abrupt("return",s.data);case 21:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}(),0!==n){e.next=22;break}return e.next=10,yn();case 10:if(!e.sent){e.next=21;break}return e.next=14,hn(t);case 14:if(!((i=e.sent).length>0)){e.next=17;break}return e.abrupt("return",i);case 17:if("Accounts"!==t.entity||0!==i.length){e.next=19;break}return e.abrupt("return",[]);case 19:e.next=22;break;case 21:vn();case 22:return l="Leads"===(null===t||void 0===t?void 0:t.entity)||"Contacts"===(null===t||void 0===t?void 0:t.entity)?"SMS_Messages":"Twilio_Messages",e.next=25,Gn("twiliosmsextension0__Sent_SMS");case 25:return c=e.sent,u=function(){var e=Object(s.a)(r.a.mark((function e(t,a){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o(t);case 2:if(0!==(n=e.sent).length){e.next=5;break}return e.abrupt("return",a);case 5:return e.abrupt("return",u(t+1,a.concat(n)));case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),e.next=29,u(1,[]);case 29:return d=e.sent,m=d.reverse().map((function(e){var t,a,n,r,o,s=null;s=e.twiliosmsextension0__Scheduled_time_to_send?new Date(e.twiliosmsextension0__Scheduled_time_to_send):"Invalid Date"===new Date(e.Message_Date).toString()||new Date(e.Message_Date).toString().includes("1970")?new Date(e.Created_Time):new Date(e.Message_Date);var i=Le(e.twiliosmsextension0__Twilio_Webhook_Contents,"webhookContents",{}),l=Le(e.MMS_content||e.twiliosmsextension0__MMS_content,"mmsContent",e.MMS_content||e.twiliosmsextension0__MMS_content);za.lastIndex=0,Ha.lastIndex=0;var u=za.exec(e.message_webhook_data),d=u&&u[1],m=Ha.exec(e.message_webhook_data),p=m&&m[1];if(!p&&d){var h=mt(d);p=Boolean(h)?h.secondary_message||h.message:null}var g,f,v,b=c.flatMap((function(t){return e[t.api_name]||[]}))[0];return"incoming"===e.Message_Type||"inbound"===e.Message_Type?{id:e.Sid||"unknown",author:(null===b||void 0===b?void 0:b.name)||"unknown",from:e.From||"unknown",to:e.To||"unknown",ownerName:(null===(g=e.Owner)||void 0===g?void 0:g.name)||Wa,message:e.Message||"",timestamp:s,mmsContent:l,messageType:"inbound",messageSource:e.twiliosmsextension0__Message_Source,status:e.twiliosmsextension0__Status||"",errorMessage:e.twiliosmsextension0__Error||(null===i||void 0===i?void 0:i.message)||p||"",owner_id:null===(f=e.Owner)||void 0===f?void 0:f.id,entity_id:(null===b||void 0===b?void 0:b.id)||b,sender_user_id:e.sender_user_id||(null===(v=e.Owner)||void 0===v?void 0:v.id),scheduledTimeToSend:e.twiliosmsextension0__Scheduled_time_to_send||"",senderName:""}:{id:e.Sid||"unknown",author:(null===(t=e.Owner)||void 0===t?void 0:t.name)||Wa,from:e.From||"unknown",to:e.To||"unknown",ownerName:(null===(a=e.Owner)||void 0===a?void 0:a.name)||Wa,message:e.Message||"",timestamp:s,mmsContent:l,messageType:"outbound",status:e.twiliosmsextension0__Status||"",errorMessage:e.twiliosmsextension0__Error||(null===i||void 0===i?void 0:i.message)||p||"",owner_id:null===(n=e.Owner)||void 0===n?void 0:n.id,entity_id:(null===b||void 0===b?void 0:b.id)||b,sender_user_id:e.sender_user_id||(null===(r=e.Owner)||void 0===r?void 0:r.id),scheduledTimeToSend:e.twiliosmsextension0__Scheduled_time_to_send||"",senderName:null===(o=e.Owner)||void 0===o?void 0:o.name}})),e.abrupt("return",m);case 34:if(e.prev=34,e.t0=e.catch(5),p=Object.assign(e.t0,{apiName:"getMessages API"}),!(n<5)){e.next=44;break}return console.error(p),e.next=41,ze(n+1);case 41:return e.abrupt("return",wn(t,n+1));case 44:if(g=(null===(h=p.message)||void 0===h?void 0:h.toLowerCase())||"",!(g.includes("permission denied")||g.includes("module name seems to be invalid"))){e.next=51;break}return e.next=49,lt();case 49:e.next=53;break;case 51:return e.next=53,ut(p);case 53:throw p;case 54:case"end":return e.stop()}}),e,null,[[5,34]])})))).apply(this,arguments)}function xn(e){return Cn.apply(this,arguments)}function Cn(){return(Cn=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null===t||void 0===t?void 0:t.filter((function(e){return"lookup"===e.data_type.toLowerCase()})).map((function(e){return{fieldName:e.api_name,moduleName:e.lookup.module.api_name}})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function kn(e,t){return e?t.sort((function(e,t){return Date.parse(t.createdTime)-Date.parse(e.createdTime)})):t.sort((function(e,t){return Date.parse(e.createdTime)-Date.parse(t.createdTime)}))}function En(e){return Tn.apply(this,arguments)}function Tn(){return(Tn=Object(s.a)(r.a.mark((function e(t){var a,n,o,s,i=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.length>1&&void 0!==i[1]?i[1]:"",n=[],o=t?"they_not_replied=true":"we_not_replied=true",a&&"noTeam"!==a&&(o+="&team_id=".concat(a)),e.next=6,yt().get("api/v1/get_contacts/?".concat(o)).catch((function(){return[]}));case 6:return s=e.sent,Array.isArray(s.data)&&(n=s.data.filter((function(e){return e.module_name&&e.crm_owner_id&&(e.last_time_we_sent_them_a_message||e.last_time_they_sent_us_a_message)&&("noTeam"===a?""===e.team_id:e.team_id===a)})).map((function(e){return{createdTime:t?e.last_time_we_sent_them_a_message:e.last_time_they_sent_us_a_message,moduleName:e.module_name,name:e.record_name,recordId:e.entity_id,ownerId:e.crm_owner_id,allowSendMessage:!0,teamId:e.team_id}}))),e.abrupt("return",n);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Nn(){return In.apply(this,arguments)}function In(){return(In=Object(s.a)(r.a.mark((function e(){var t,a,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ht.a.CRM.API.getAllRecords({Entity:"twiliosmsextension0__Sent_SMS",sort_by:"twiliosmsextension0__Synced",sort_order:"asc",per_page:2,page:1});case 2:return t=e.sent,a=(null===t||void 0===t?void 0:t.data)||[],n=a[0],e.abrupt("return",!(null===n||void 0===n?void 0:n.twiliosmsextension0__Synced));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function On(e){return Mn.apply(this,arguments)}function Mn(){return(Mn=Object(s.a)(r.a.mark((function e(t){var a,n,i,l,c,u,d,m,p,h,g,f,v,b,y,S,_,x=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=x.length>1&&void 0!==x[1]&&x[1],n=x.length>2&&void 0!==x[2]&&x[2],i=x.length>3&&void 0!==x[3]&&x[3],l=x.length>4&&void 0!==x[4]?x[4]:"",c=[],!!0){e.next=32;break}return e.next=9,Nn();case 9:if(u=e.sent,d=[],u){e.next=15;break}return e.next=14,En(a,l);case 14:d=e.sent;case 15:if(!d.length&&""===l){e.next=19;break}c=d,e.next=32;break;case 19:return vn(),m=["Leads","Contacts","Deals"],e.next=23,Xa(["twiliosmsextension0__Custom_Modules_Linked_To_Twilio","twiliosmsextension0__API_Names_for_Record_Owner_for_inbox"]);case 23:return p=e.sent,h=Object(o.a)(p,2),g=h[0],f=h[1],v=(null===f||void 0===f?void 0:f.split(","))||["Owner"],b=(null===g||void 0===g?void 0:g.split(","))||[],y=[].concat(m,Object(w.a)(b)),e.next=32,Promise.all(y.map(function(){var e=Object(s.a)(r.a.mark((function e(t){var n,o,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("None"!==t){e.next=2;break}return e.abrupt("return");case 2:n=!0,o=0,s="",m.includes(t)?(s=a?"(twiliosmsextension0__We_Sent_Them_An_SMS_and_They_Haven_t_Replied:equals:true)":"(twiliosmsextension0__They_sent_an_SMS_and_we_haven_t_replied:equals:true)",s+=" and (twiliosmsextension0__Twilio_SMS_Message_Opt_Out:equals:false)"):(s=a?"(We_Sent_Them_An_SMS_and_They_Haven_t_Replied:equals:true)":"(They_sent_an_SMS_and_we_haven_t_replied:equals:true)",s+=" and (twiliosmsextension0_Twilio_SMS_Message_Opt_Out:equals:false)");case 6:if(!n){e.next=18;break}return e.prev=7,e.delegateYield(r.a.mark((function e(){var a,i,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=[],e.next=3,ht.a.CRM.API.searchRecord({Entity:t,Type:"criteria",Query:"(".concat(s,")"),page:++o,per_page:200});case 3:l=e.sent,Array.isArray(l.data)&&v.forEach((function(e){var a=l.data.filter((function(t){return t[e]})).map((function(a){return{createdTime:a.twiliosmsextension0__Last_Time_They_Replied_To_Twilio_Message||a.Last_Time_They_Replied_To_Twilio_Message,moduleName:t,name:a.Full_Name||a.Deal_Name||a.Name,recordId:a.id,ownerId:a[e].id,allowSendMessage:!0,teamId:void 0}}));i=[].concat(Object(w.a)(i),Object(w.a)(a))})),c=[].concat(Object(w.a)(c),Object(w.a)(i)),n=(null===(a=l.info)||void 0===a?void 0:a.more_records)||!1;case 7:case"end":return e.stop()}}),e)}))(),"t0",9);case 9:e.next=16;break;case 11:e.prev=11,e.t1=e.catch(7),n=!1,console.error("Error fetching records with unreplied messages. ".concat(e.t1)),console.error(e.t1);case 16:e.next=6;break;case 18:case"end":return e.stop()}}),e,null,[[7,11]])})));return function(t){return e.apply(this,arguments)}}()));case 32:return S=c,(i||t)&&"all"!==t&&(S=c.filter((function(e){return e.ownerId===t}))),_=kn(n,S),e.abrupt("return",_);case 36:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pn(e){return An.apply(this,arguments)}function An(){return(An=Object(s.a)(r.a.mark((function e(t){var a,n,o,i,l,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=function(){return(n=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ht.a.CRM.API.getAllRecords({Entity:"twiliosmsextension0__SMS_Templates",sort_order:"asc",page:t,per_page:200});case 2:if((a=e.sent).data){e.next=5;break}return e.abrupt("return",[]);case 5:return e.abrupt("return",a.data);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)},a=function(e){return n.apply(this,arguments)},o=function(){var e=Object(s.a)(r.a.mark((function e(t,n){var s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a(t);case 2:if(0!==(s=e.sent).length){e.next=5;break}return e.abrupt("return",n);case 5:return e.abrupt("return",o(t+1,n.concat(s)));case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),e.next=5,o(1,[]);case 5:return i=e.sent,l=i.map((function(e){var t=Le(e.twiliosmsextension0__Media_URLs,"media-urls",[e.twiliosmsextension0__Media_URLs]);return{label:e.Name||e.CustomModule_Name,value:e.Message||e.twiliosmsextension0__Message,relatedModule:e.twiliosmsextension0__Related_Module,template_id:e.id,mediaURLs:t}})),c=l.filter((function(e){var a;return null===(a=e.relatedModule)||void 0===a?void 0:a.includes(t)})),e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Dn(e){return jn.apply(this,arguments)}function jn(){return(jn=Object(s.a)(r.a.mark((function e(t){var a,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=Object(ee.a)(t.mobile||t.phone||"",t.country_locale))&&(t.phone=a.formatInternational()),n={arguments:JSON.stringify({extra_data:{currentUserData:t}})},e.next=5,ht.a.CRM.FUNCTIONS.execute("twiliosmsextension0__log_stats_rest",n);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Rn(e,t,a){return Fn.apply(this,arguments)}function Fn(){return(Fn=Object(s.a)(r.a.mark((function e(t,a,n){var o,s,i,l,c,u,d,m,p,h,g,f,v,b=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=!(b.length>3&&void 0!==b[3])||b[3],s=b.length>4&&void 0!==b[4]?b[4]:0,e.prev=2,e.next=5,ht.a.CRM.API.getRecord({Entity:t,RecordID:a,params:{approval:"both"}});case 5:if(204!==(null===(i=e.sent)||void 0===i?void 0:i.status)){e.next=36;break}return c={arguments:JSON.stringify({lead_id:null===a||void 0===a?void 0:a[0]})},e.next=10,ht.a.CRM.FUNCTIONS.execute("twiliosmsextension0__convert_lead_to_backend_rest",c);case 10:if(u=e.sent,d=null===u||void 0===u||null===(l=u.details)||void 0===l?void 0:l.output,m=Le(d,"convertContactData",{}),!(p=null===m||void 0===m?void 0:m.contact_id)){e.next=21;break}if(!o){e.next=18;break}return e.next=18,Oe()("This lead, ".concat(n,", was recently converted to a contact so some of the messages might not be visible yet. If you can tell some are missing, wait 15 minutes and check again."));case 18:return e.abrupt("return",Rn("Contacts",[p],n,o,s+1));case 21:if(!o){e.next=34;break}return e.next=24,Oe()("We can\u2019t find data for this record. The record name is ".concat(n," and the module is ").concat(t,". Try searching for this record (maybe it was deleted or converted) and replying directly there if you can. If you can\u2019t find the record anymore, you can close the conversation by clicking on the button below or just ignore it (you will still see the conversation when you reload)."),{buttons:["Ignore","Close Conversation"]});case 24:if(!e.sent){e.next=31;break}return e.next=28,Qt(t,null===a||void 0===a?void 0:a[0]);case 28:window.location.reload(),e.next=32;break;case 31:throw new Error(Fe);case 32:e.next=36;break;case 34:throw ot("unfound_".concat(a[0]),JSON.stringify({recordName:n,moduleName:t}),{debug:!0}),new Error(Ue);case 36:return e.abrupt("return",i.data.map((function(e){return{data:[e]}})));case 39:if(e.prev=39,e.t0=e.catch(2),![Fe,Ue].includes(e.t0.message)){e.next=43;break}throw e.t0;case 43:return h=Object.assign(e.t0,{apiName:"getRecords API for module ".concat(t)}),e.next=46,ze(s+1);case 46:if(!(s<5)){e.next=50;break}return e.abrupt("return",Rn(t,a,n,o,s+1));case 50:if(f=(null===(g=h.message)||void 0===g?void 0:g.toLowerCase())||"",v=f.includes("permission denied")||f.includes("module name seems to be invalid"),!f.includes("the module name given seems to be invalid")){e.next=58;break}return Oe()({title:"Error",text:"We can\u2019t find data for this record because the module (".concat(t,") is no longer active in your CRM. You can re-enable the module by following the instructions here: https://www.youtube.com/watch?v=3P4RN7kqDZ0"),icon:"error",button:"I've restored the module"}).then((function(e){e&&st("visible_modules"),window.location.reload()})),e.abrupt("return");case 58:if(!v){e.next=63;break}return e.next=61,lt();case 61:e.next=65;break;case 63:return e.next=65,ut(h);case 65:throw h;case 66:case"end":return e.stop()}}),e,null,[[2,39]])})))).apply(this,arguments)}function Un(e,t,a,n){return Ln.apply(this,arguments)}function Ln(){return(Ln=Object(s.a)(r.a.mark((function e(t,a,n,i){var l,c,u,d,m,p,h,g,f,v,b,y,S,w;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([Qa()]);case 2:return h=e.sent,g=Object(o.a)(h,1),f=g[0],e.next=7,Ba("DetailView",a,i,f);case 7:v=e.sent,b=v.fromData,y=v.toArray,S=v.templatesForThisEntity,w=v.phoneNumberAPINames||"",(null===(l=t.fromNumbers)||void 0===l||null===(c=l[0])||void 0===c?void 0:c.value)===(null===b||void 0===b||null===(u=b[0])||void 0===u?void 0:u.value)&&(null===(d=t.toNumbers)||void 0===d||null===(m=d[0])||void 0===m?void 0:m.value)===(null===y||void 0===y||null===(p=y[0])||void 0===p?void 0:p.value)&&JSON.stringify(t.smsTemplates)===JSON.stringify(S)||n({fromNumbers:b,toNumbers:y,smsTemplates:S,loading:!1},Object(s.a)(r.a.mark((function e(){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=y.reduce((function(e,t){return e[t.lookupID]?e[t.lookupID].numbers.push(t):e[t.lookupID]={numbers:[t]},e}),{}),Object.entries(a).forEach((function(e){var t=Object(o.a)(e,2),a=t[0],n=t[1];ot(a.toString(),JSON.stringify({toArray:n}))})),ot(t.currentSelectedModule,JSON.stringify({templatesForThisEntity:S}),{debug:!0}),ot("twilio_settings",JSON.stringify({fromData:b,phoneNumberAPINames:w}),{debug:!0});case 4:case"end":return e.stop()}}),e)}))));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Vn(e){return Bn.apply(this,arguments)}function Bn(){return(Bn=Object(s.a)(r.a.mark((function e(t){var a,n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=rt("twilio_auth_headers"),!((n=Le(a,"twilio_auth_headers",null))&&qe(null===n||void 0===n?void 0:n.timestamp)<60)){e.next=5;break}return e.abrupt("return",n);case 5:return e.next=7,ht.a.CRM.FUNCTIONS.execute("twiliosmsextension0__get_twilio_auth_header_rest_api",{arguments:t});case 7:return(o=e.sent).timestamp=Date.now(),ot("twilio_auth_headers",JSON.stringify(o)),e.abrupt("return",o);case 13:return e.prev=13,e.t0=e.catch(0),e.abrupt("return",null);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}function qn(e,t,a){return Wn.apply(this,arguments)}function Wn(){return(Wn=Object(s.a)(r.a.mark((function e(t,a,n){var o,s,i,l,c,u,d,m=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=m.length>3&&void 0!==m[3]?m[3]:0,s=m.length>4&&void 0!==m[4]&&m[4],i=m.length>5&&void 0!==m[5]&&m[5],e.prev=3,e.next=6,ht.a.CRM.API.coql({select_query:"".concat(t," LIMIT ").concat(200*a,", 200")});case 6:if(204!==(l=e.sent).status&&l.info.more_records&&!s){e.next=9;break}return e.abrupt("return",n.concat(l.data||[]));case 9:return e.abrupt("return",qn(t,a+1,n.concat(l.data)));case 12:if(e.prev=12,e.t0=e.catch(3),!i){e.next=16;break}return e.abrupt("return",[]);case 16:if("429"!==e.t0.code){e.next=21;break}return e.next=19,new Promise((function(e){setTimeout(e,1e3*o)}));case 19:if(!(o<9)){e.next=21;break}return e.abrupt("return",qn(t,a,n,o+1));case 21:if(u=Object.assign(e.t0,{apiName:"COQL query API"}),d=(null===(c=u.message)||void 0===c?void 0:c.toLowerCase())||"",!(d.includes("permission denied")||d.includes("module name seems to be invalid"))){e.next=29;break}return e.next=27,lt();case 27:e.next=32;break;case 29:return u.message+=". Query: ".concat(t),e.next=32,ut(u);case 32:throw u;case 33:case"end":return e.stop()}}),e,null,[[3,12]])})))).apply(this,arguments)}function zn(){return Hn.apply(this,arguments)}function Hn(){return(Hn=Object(s.a)(r.a.mark((function e(){var t,a,n,o,s,i,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=Le(rt(t="twiliosmsextension0__webhook_url_for_mobile_app"),"getWebHookUrl",null),n=(null===a||void 0===a?void 0:a.timestamp)||-1/0,o=We(n),s={},!(a&&o<1)){e.next=9;break}s=a,e.next=15;break;case 9:return e.next=11,ht.a.CRM.FUNCTIONS.execute(t,{});case 11:l=e.sent,s.timestamp=Date.now(),s.url=null===l||void 0===l||null===(i=l.details)||void 0===i?void 0:i.output,ot(t,JSON.stringify(s));case 15:return e.abrupt("return",s.url);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Yn=function(){var e=Object(s.a)(r.a.mark((function e(){var t,a,n,o,s,i,l,c,u;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=Le(rt(a="twilio_org_settings_from_backend"),"getWebHookUrl",null),o=(null===n||void 0===n?void 0:n.timestamp)||-1/0,s=We(o),i={},!(n&&s<1)){e.next=10;break}i=n,e.next=16;break;case 10:return e.next=12,yt().get("api/v1/twilio_org_settings/");case 12:c=e.sent,i.data=null===(l=c.data)||void 0===l?void 0:l[0],i.timestamp=Date.now(),ot(a,JSON.stringify(i));case 16:return e.abrupt("return",null===(t=i)||void 0===t?void 0:t.data);case 19:if(e.prev=19,e.t0=e.catch(0),401!==(null===(u=e.t0.response)||void 0===u?void 0:u.status)){e.next=24;break}return it("reload_window_count"),e.abrupt("return",!1);case 24:throw Object.assign(e.t0,{apiName:"twilio_org_settings"});case 26:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(){return e.apply(this,arguments)}}();function Gn(e){return Qn.apply(this,arguments)}function Qn(){return(Qn=Object(s.a)(r.a.mark((function e(t){var a,n,o,s,i,l,c,u,d,m;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="".concat(a="twiliosmsextension0__get_lookup_fields_including_all_data_for_module_rest","_").concat(t),o=Le(rt(n),"getWebHookUrl",null),s=(null===o||void 0===o?void 0:o.timestamp)||-1/0,i=We(s),l={},!(o&&i<1)){e.next=10;break}l=o,e.next=18;break;case 10:return u={arguments:JSON.stringify({module_name:t})},e.next=13,ht.a.CRM.FUNCTIONS.execute(a,u);case 13:d=e.sent,l.timestamp=Date.now(),m=Le(null===d||void 0===d||null===(c=d.details)||void 0===c?void 0:c.output,"fields",[]),l.fields=m.map((function(e){return Object(_.a)(Object(_.a)({},e),{},{fieldName:e.api_name,moduleName:e.module})})),ot(n,JSON.stringify(l));case 18:return e.abrupt("return",l.fields);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Jn=function(){var e=Object(s.a)(r.a.mark((function e(){var t,a,n,o,s,i,l,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=Le(rt(a="check_credentials_in_backend"),"getWebHookUrl",null),o=(null===n||void 0===n?void 0:n.timestamp)||-1/0,s=We(o),i={},!(n&&s<1)){e.next=10;break}i=n,e.next=16;break;case 10:return e.next=12,yt().get("api/v1/check_twilio_credentials/");case 12:l=e.sent,i.data=l.data,i.timestamp=Date.now(),ot(a,JSON.stringify(i));case 16:return e.abrupt("return",null===(t=i)||void 0===t?void 0:t.data);case 19:if(e.prev=19,e.t0=e.catch(0),401!==(null===(c=e.t0.response)||void 0===c?void 0:c.status)){e.next=24;break}return it("reload_window_count"),e.abrupt("return",!1);case 24:throw Object.assign(e.t0,{apiName:"check_credentials_in_backend"});case 26:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(){return e.apply(this,arguments)}}();function Kn(e,t,a){var n={Entity:a,APIData:{id:e.lookupID,twiliosmsextension0__Number_Field_to_Use_for_Twilio_Messages:t,twiliosmsextension0__Number_to_Use_for_Twilio_Messages:t},Trigger:["workflow"]};ht.a.CRM.API.updateRecord(n)}var Zn=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={opted_out:t.optedOut,module_name:t.moduleName,entity_id:t.recordId,crm_org_id:t.crmOrganisationID,crm_record_id:t.recordId},e.next=3,yt().post("api/v1/sync_entity/",a);case 3:return 200===(n=e.sent).status&&(st(t.recordId,"inbox_".concat(t.recordId)),Xn(t.moduleName,t.recordId)),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Xn=function(){var e=Object(s.a)(r.a.mark((function e(t,a){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={Entity:t,APIData:{id:a,twiliosmsextension0__Twilio_SMS_Message_Opt_Out:!0},Trigger:["workflow"]},e.next=3,ht.a.CRM.API.updateRecord(n);case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();function $n(e,t,a){var n=e.completeRecordData.twiliosmsextension0__Number_to_Use_for_Twilio_Messages,r=e.completeRecordData.twiliosmsextension0__Number_Field_to_Use_for_Twilio_Messages,o=e.completeRecordData.twiliosmsextension0__Mobile_Twilio_SMS_Number_to_Use,s=n||r||o||t;return s||(s="Deals"===a||"Invoices"===a?"Numbers From Contact":"Phone"),[{value:s,label:s.toString().replace(/_/g," ").replace("Contact Name.","Contact - ")}]}function er(e,t,a,n,r,s,i){try{var l=[];return n.length&&n.forEach((function(t){if(t){var n=t.completeRecordData.contactData,r=t.completeRecordData;Object.entries(r).forEach((function(e){var t=Object(o.a)(e,2),a=t[0],n=t[1];a.includes("Phone")&&n&&l.push({value:a,label:"".concat(a.replaceAll("_"," ")," ").concat(s?"- ".concat(r[a]):"")})}));var c=l.map((function(e){return e.value})),u=nr(e,c);l=l.filter((function(e){var t=e.value;return!!u.find((function(e){return e===t}))})),(null===i||void 0===i?void 0:i.length)&&(null===i||void 0===i||i.forEach((function(e){e&&null!==r[e]&&l.push({value:e,label:"".concat(e.replaceAll("_"," ")," ").concat(s?"- ".concat(r[e]):"")})}))),r.Mobile&&l.push({value:"Mobile",label:"Mobile ".concat(s?"- ".concat(r.Mobile):"")}),a&&a.length&&Array.isArray(a)&&a.forEach((function(e){(null===r||void 0===r?void 0:r[e])&&l.push({value:e,label:"".concat(e," ").concat(s?"- ".concat(r[e]):"")})})),n&&(Object.entries(n).forEach((function(e){var t=Object(o.a)(e,2),a=t[0],r=t[1];if(a.includes("Phone")&&r){var i="Contact - ".concat(a.replace("Contact_Name.",""));l.push({value:a,label:"".concat(i.replaceAll("_"," ")," ").concat(s?"- ".concat(n[a]):"")})}})),n["Contact_Name.Mobile"]&&l.push({value:"Contact_Name.Mobile",label:"Contact - Mobile ".concat(s?"- ".concat(n["Contact_Name.Mobile"]):"")}))}})),t&&l.unshift({value:"All Possible Numbers",label:"All Possible Numbers"}),Object(p.uniqBy)(l,(function(e){return e.value}))}catch(u){var c="An error occurred in getNumberToUseFieldOptions. Please check you are on the latest version of the extension by following the instructions here https://screencast-o-matic.com/watch/cYlXrp813O. If you are on the latest version, please email team@smooth.tel with a screenshot of this error message:\n      ".concat(u.message,"\n      ").concat(u.stack,"\n      Parameters:\n      selectedModule: ").concat(e,",\n      sendMsgPopup: ").concat(t,",\n      phoneNumberAPINames: ").concat(JSON.stringify(a),"\n      toNumbers: ").concat(JSON.stringify(n),"\n      currentRecordDetails?: ").concat(JSON.stringify(r),"\n      showNumberInLabel?: ").concat(s,"\n      modulePhoneFields?: ").concat(JSON.stringify(i),"\n    ");return Oe()({title:"Error",text:c,icon:"error"}),[]}}function tr(e,t,a){var n=e.flatMap((function(e){return t.flatMap((function(t){return La(t.completeRecordData,a,e)}))})),r=[];return n.forEach((function(e){var t;if(e.value){var a=null===(t=e.value)||void 0===t?void 0:t.replace("whatsapp:","");r.some((function(e){var t=e.value.replace("whatsapp:","");return a===t}))||r.push(e)}})),r}function ar(e,t){return"Whatsapp"===e?t.map((function(e){var t="string"===typeof e.value?e.value:e.value[1];return t.startsWith("whatsapp:")||(e.value="whatsapp:".concat(t),e.label="".concat(e.name," (").concat(e.value,")")),e})):t.map((function(e){var t="string"===typeof e.value?e.value:e.value[1];return t.startsWith("whatsapp:")&&(e.value=t.replace("whatsapp:",""),e.label="".concat(e.name," (").concat(e.value,")")),e}))}var nr=function(e,t){var a=Le(rt("fields_".concat(e)),"getfields",null);return((null===a||void 0===a?void 0:a.fields)||[]).filter((function(e){return"phone"===e.data_type&&t.find((function(t){return t===e.api_name}))})).map((function(e){return e.api_name}))},rr=a(149),or=a.n(rr);function sr(e,t){return ir.apply(this,arguments)}function ir(){return(ir=Object(s.a)(r.a.mark((function e(t,a){var n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ht.a.CRM.API.getRecord({Entity:t,RecordID:a});case 2:return n=e.sent,o=n.data,e.abrupt("return",o?o[0]:{});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function lr(e,t,a){return cr.apply(this,arguments)}function cr(){return(cr=Object(s.a)(r.a.mark((function e(t,a,n){var o,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return","");case 2:return o=[],t.replace(a,(function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];var s=n.apply(void 0,[e].concat(a));o.push(s)})),e.next=6,Promise.all(o);case 6:return s=e.sent,e.abrupt("return",t.replace(a,(function(){return s.shift()})));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ur(e,t,a,n){return dr.apply(this,arguments)}function dr(){return(dr=Object(s.a)(r.a.mark((function e(t,a,n,o){var i,l,c,u,d,m,p,h,g,f,v;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=function(){return(f=Object(s.a)(r.a.mark((function e(t,o){var s,c,u,d,p,g,f,v,b,y,S,w,_,x,C,k,E,T,N,I,O;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((c=(s=o||"").startsWith("url("))&&(s=s.replace(/url\(/,"").replace(/\)/,"")),u=(s||"").split("."),d=u[0],p=u[1],g="".concat(d,".").concat(p),f=a[d]||"",v=m[d],"Owner_Phone_Number"!==d){e.next=11;break}return e.abrupt("return",h(s.replace(d,i),c));case 11:if("Owner.First_Name"!==g){e.next=13;break}return e.abrupt("return",h(s.replace(g,l),c));case 13:if(!JSON.stringify(f).includes("{")||"object"!==typeof f||!p){e.next=26;break}if(y=f.id||"",S=null===(b=n.find((function(e){return e.fieldName===d})))||void 0===b?void 0:b.moduleName,w="".concat(S,"_").concat(y),!(_=rt(w))){e.next=21;break}return x=Le(_,"merge_fields",{}),e.abrupt("return",h(s.replace(g,x[p]||""),c));case 21:return e.next=23,sr(S||"",y.toString());case 23:return C=e.sent,ot(w,JSON.stringify(C)),e.abrupt("return",h(s.replace(g,C[p]||""),c));case 26:if("object"!==typeof v||!(null===v||void 0===v?void 0:v.name)){e.next=28;break}return e.abrupt("return",h(s.replace(d,(null===v||void 0===v?void 0:v.name)||""),c));case 28:if(k=(null===v||void 0===v?void 0:v.toString())||"",E=/^(-?(?:[1-9][0-9]*)?[0-9]{4})-(1[0-2]|0[1-9])-(3[01]|0[1-9]|[12][0-9])T(2[0-3]|[01][0-9]):([0-5][0-9]):([0-5][0-9])(\\.[0-9]+)?(Z|\+)?(\d){2}?(:)?(\d){2}$/,T=/^\d{4}[- /.]([0|1][0-2])[- /.]([12]\d|0[1-9]|3[01])$/,!k.match(E)&&!k.match(T)){e.next=44;break}if(e.prev=32,!k.match(T)){e.next=37;break}return N=new Date(k+" 00:00"),I=N.toLocaleDateString(window.navigator.language),e.abrupt("return",h(s.replace(d,I),c));case 37:return O=new Date(k),e.abrupt("return",h(s.replace(d,O.toLocaleString(window.navigator.language)),c));case 41:e.prev=41,e.t0=e.catch(32),console.error("Error parsing date string",e.t0);case 44:return e.abrupt("return",h(s.replace(d,k),c));case 45:case"end":return e.stop()}}),e,null,[[32,41]])})))).apply(this,arguments)},g=function(e,t){return f.apply(this,arguments)},h=function(e,t){return t?encodeURIComponent(e):e},t){e.next=5;break}return e.abrupt("return","");case 5:return i="",l="","object"===typeof a.Owner&&(i=(null===o||void 0===o||null===(c=o.users[0])||void 0===c?void 0:c.phone)||"",l=(null===o||void 0===o||null===(u=o.users[0])||void 0===u?void 0:u.first_name)||""),d={today:(new Date).toLocaleDateString(),tomorrow:X()().add(1,"days").toDate().toLocaleDateString()},m=Object(_.a)(Object(_.a)({},a),d),e.next=13,lr(t,/#([A-Za-z\d_.()]+)/g,g);case 13:return p=e.sent,v=p.replace(/[ ]{2,}/g," "),e.abrupt("return",v);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function mr(e){return(null===e||void 0===e?void 0:e.replace(/[^+\d]/g,""))||""}function pr(e){return hr.apply(this,arguments)}function hr(){return(hr=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){setTimeout(e,1e3*t)}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function gr(e,t){return fr.apply(this,arguments)}function fr(){return(fr=Object(s.a)(r.a.mark((function e(t,a){var n,o,s,i,l,c=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>2&&void 0!==c[2]?c[2]:0,e.prev=1,e.next=4,ht.a.CRM.FUNCTIONS.execute(t,{arguments:a});case 4:if(s=e.sent,(i=null===s||void 0===s||null===(o=s.details)||void 0===o?void 0:o.output)&&!i.toLowerCase().includes("error")){e.next=14;break}if(!(n<5)){e.next=11;break}return e.next=10,pr(5*n);case 10:return e.abrupt("return",gr(t,a,n+1));case 11:throw l=new Error("Error executing CRM function ".concat(t," with args ").concat(a," ").concat(JSON.stringify(i))),window.Sentry.captureException(l),l;case 14:return e.abrupt("return",i);case 17:throw e.prev=17,e.t0=e.catch(1),new Error("Error executing CRM function ".concat(t," with args ").concat(a," ").concat(e.t0));case 21:case"end":return e.stop()}}),e,null,[[1,17]])})))).apply(this,arguments)}var vr=function(){var e=Object(s.a)(r.a.mark((function e(t,a){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null===a||void 0===a?void 0:a.find((function(e){return e.id===t.id})))){e.next=3;break}return e.abrupt("return",t);case 3:return e.abrupt("return",null);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),br=function(){var e=document.createElement("p");return e.innerHTML='It looks like you have run out of API calls. Please check Setup > Developer Space > APIs. If the high API call usage is caused by Smooth Messenger, please email <a href="mailto:team@smooth.tel">team@smooth.tel</a> Otherwise, you might need to purchase more API calls.',Oe()({icon:"error",content:{element:e}})},yr=a(540),Sr=a.n(yr);function wr(e,t){try{window.$zoho.salesiq.visitor.customaction(e),window.userlist("track",e,t)}catch(a){console.error(a)}}function _r(e){try{e()}catch(t){console.error(t)}}function xr(e,t,a){return Cr.apply(this,arguments)}function Cr(){return(Cr=Object(s.a)(r.a.mark((function e(t,a,n){var s,i,l,c,u,d;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([gt(),Ya()]);case 3:i=e.sent,l=Object(o.a)(i,2),c=l[0],u=l[1],d=null===c||void 0===c||null===(s=c.org)||void 0===s?void 0:s[0].company_name,_r((function(){window.userlist("identify",{email:t.email,properties:{first_name:t.first_name,last_name:t.last_name,role:t.role.name,profile:t.profile.name,extension_version:u.current_version},relationships:[{company:"".concat(n,"-").concat(d),properties:{role:t.role.name,profile:t.profile.name}}]})})),_r((function(){H.identify(t.id,{crmOrgId:n,firstName:t.first_name,role:t.role.name,profile:t.profile.name,extension_version:u.current_version,company:"".concat(n,"-").concat(d)})})),_r((function(){window.$zoho.salesiq.visitor.name("".concat(t.full_name," - ").concat(d)),window.$zoho.salesiq.visitor.email(t.email),window.$zoho.salesiq.visitor.contactnumber(a.mobile||a.phone),window.$zoho.salesiq.visitor.info({Company:d,Role:t.role.name,Profile:t.profile.name})})),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.error(e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}var kr=function(){return Sr()({title:"",content:g.a.createElement("span",null,"Hi, we've recently updated our end user license agreement (EULA). To continue using Smooth Messenger, you'll need to agree to it. Please review"," ",g.a.createElement("a",{href:"https://smooth.tel/eula/",target:"_blank",rel:"noreferrer"},"the EULA")," ","and the"," ",g.a.createElement("a",{href:"https://smooth.tel/privacy/",target:"_blank",rel:"noreferrer"},"privacy policy")," ","and click agree to accept the agreement. If you have any concerns, please contact ",g.a.createElement("a",{href:"mailto:team@smooth.tel"},"team@smooth.tel"),"."),button:"Agree"}).then(Object(s.a)(r.a.mark((function e(){var t,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return wr("accepted-eula"),e.next=3,St();case 3:return t=e.sent,a={accepted_eula:!0,crm_org_id:t.crm_org_id,z_api_key:t.z_api_key},e.next=7,yt().post("api/v1/twilio_org_settings/",a).catch((function(e){window.Sentry.captureException(e)}));case 7:it("reload_window_count"),window.location.reload();case 9:case"end":return e.stop()}}),e)}))))},Er=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,o,s,i,l,c,u,d,m,p;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t){e.next=3;break}return e.abrupt("return",!0);case 3:if(!(o=rt("available_modules"))){e.next=11;break}if(a=Le(o,"available_modules",{}),!(We(a.timestamp)<1&&(null===(s=a)||void 0===s||null===(i=s.availableModules)||void 0===i?void 0:i.includes(t)))){e.next=9;break}return e.abrupt("return",!0);case 9:e.next=12;break;case 11:a={availableModules:[],timestamp:Date.now()};case 12:return e.next=14,ht.a.CRM.API.getRecord({Entity:t});case 14:if(204!==(null===(l=e.sent)||void 0===l?void 0:l.status)){e.next=17;break}return e.abrupt("return",!0);case 17:if(429!==(null===l||void 0===l?void 0:l.status)){e.next=19;break}return e.abrupt("return",br());case 19:if(!(null===(n=l.data)||void 0===n?void 0:n.length)){e.next=24;break}return a.availableModules=Object(w.a)(new Set([].concat(Object(w.a)((null===(c=a)||void 0===c?void 0:c.availableModules)||[]),[t]))),a.timestamp=Date.now(),ot("available_modules",JSON.stringify(a)),e.abrupt("return",!0);case 24:return a.availableModules=a.availableModules.filter((function(e){return e!==t})),a.timestamp=Date.now(),ot("available_modules",JSON.stringify(a)),e.abrupt("return",!1);case 30:if(e.prev=30,e.t0=e.catch(0),429!==(null===(d=e.t0)||void 0===d||null===(u=d.response)||void 0===u?void 0:u.status)){e.next=35;break}return e.abrupt("return",br());case 35:return(m=rt("available_modules"))&&((p=Le(m,"available_modules",{})).availableModules=p.availableModules.filter((function(e){return e!==t})),p.timestamp=Date.now(),ot("available_modules",JSON.stringify(p))),e.abrupt("return",!1);case 38:case"end":return e.stop()}}),e,null,[[0,30]])})));return function(t){return e.apply(this,arguments)}}(),Tr=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,o,s,i,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],n=[],o=Object(w.a)(new Set(t)),s=Object(z.a)(o),e.prev=4,s.s();case 6:if((i=s.n()).done){e.next=14;break}return l=i.value,e.next=10,Er(l);case 10:e.sent?a.push(l):n.push(l);case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),s.e(e.t0);case 19:return e.prev=19,s.f(),e.finish(19);case 22:return e.abrupt("return",{availableModules:a,unavailableModules:n});case 23:case"end":return e.stop()}}),e,null,[[4,16,19,22]])})));return function(t){return e.apply(this,arguments)}}(),Nr=function(){var e=rt("available_modules");return e?Le(e,"available_modules",{}).availableModules:[]},Ir=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",Nr());case 4:return e.prev=4,e.t0=e.catch(0),e.next=8,Tr(t);case 8:return a=e.sent,n=a.availableModules,e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,null,[[0,4]])})));return function(t){return e.apply(this,arguments)}}(),Or=function(){function e(t,a){Object(i.a)(this,e),this.serverName=void 0,this.authorizationKey=void 0,this.baseHeaders=void 0,this.companyId=void 0,this.serverName=t,this.authorizationKey=a,this.baseHeaders={mode:"cors","Content-Type":"application/json",Authorization:"Bearer ".concat(this.authorizationKey)},this.companyId=void 0}return Object(l.a)(e,[{key:"buildRequestParams",value:function(e,t){var a=e.map((function(e){return{original_url:e,sms_record_id:t}}));return{method:"POST",headers:Object(_.a)({},this.baseHeaders),body:JSON.stringify(a)}}},{key:"fetchShorterUrls",value:function(){var e=Object(s.a)(r.a.mark((function e(t,a){var n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.serverName+"/api/shorten",this.buildRequestParams(t,a));case 2:if(200===(n=e.sent).status){e.next=5;break}throw new Error("Could not substitute the URLs");case 5:return e.next=7,n.json();case 7:return o=e.sent,e.abrupt("return",o.map((function(e){return e.shortened_url})));case 9:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"fetchShorterURLsWithCustomSlug",value:function(){var e=Object(s.a)(r.a.mark((function e(t,a,n){var o,s,i,l,c,u;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.companyId){e.next=3;break}return console.error("The company id is undefined when trying to authenticate the customSlug"),e.abrupt("return",[]);case 3:return o=this.serverName+"/api/shorten/custom",s=t.map((function(e){return{sms_record_id:a,original_url:e}})),i={custom_url:n,custom_url_token:this.companyId,urls_to_shorten:s},l={method:"POST",headers:Object(_.a)({},this.baseHeaders),body:JSON.stringify(i)},e.next=9,fetch(o,l);case 9:if(200===(c=e.sent).status){e.next=13;break}throw console.error("The response status code is not 200. Check the error ".concat(c.status)),new Error("Could not substitute the URLs");case 13:return e.next=15,c.json();case 15:return u=e.sent,e.abrupt("return",u.map((function(e){return e.shortened_url})));case 17:case"end":return e.stop()}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"fetchReservedSlugs",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t.companyId&&(this.companyId=t.companyId),void 0!==this.companyId){e.next=4;break}throw console.error("Company id cannot be undefined when reserving"),Error("Could not find the company when reserving the ");case 4:return a=new URLSearchParams({companyId:this.companyId}),n=this.serverName+"/api/slugs?"+a,e.next=8,fetch(n,{method:"GET",headers:Object(_.a)({},this.baseHeaders)});case 8:if(200===(o=e.sent).status){e.next=12;break}throw console.error("the /slugs request has failed. with the status-code: ".concat(o.status)),Error("The service is down or cannot handle the request");case 12:return e.abrupt("return",o.json());case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkSlugAvailability",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t.companyId&&(this.companyId=t.companyId),void 0!==this.companyId){e.next=4;break}return console.error("the value of company id is undefined when the method is called"),e.abrupt("return",!1);case 4:return a=this.serverName+"/api/reserve-slug",n={companyId:this.companyId,slug:t.slug},e.next=8,fetch(a,{method:"POST",headers:Object(_.a)({},this.baseHeaders),body:JSON.stringify(n)});case 8:if(204!==e.sent.status){e.next=11;break}return e.abrupt("return",!0);case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Mr=function(){function e(t){Object(i.a)(this,e),this.apiClient=void 0,this.splits=void 0,this.apiClient=t,this.splits=[]}return Object(l.a)(e,[{key:"detectURLsInMessage",value:function(t){return this.splits=e.splitMessageToUrls(t),this.splits.length>1}},{key:"processMessage",value:function(t){var a=this,n=e.splitMessageToUrls(t.message),r=e.extractUrls(n),o=t.slug;return new Promise(void 0!==o?function(s,i){a.apiClient.fetchShorterURLsWithCustomSlug(r,t.sms_record_id,o).then((function(t){var a=e.substituteWithShorterURLs(n,t).join("");s(a)})).catch((function(e){i(e)}))}:function(o,s){a.apiClient.fetchShorterUrls(r,t.sms_record_id).then((function(t){o(e.substituteWithShorterURLs(n,t).join(""))})).catch((function(e){s(e)}))})}}],[{key:"envConfigured",value:function(){var t="https://smth.li/",a="1a6ae5ec529c4574b55b72246c0a6967";return new e(new Or(t,a))}},{key:"splitMessageToUrlsByRegex",value:function(e){return e.split(/(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]+\.[^\s]{2,}|www\.[a-zA-Z0-9]+\.[^\s]{2,})/g)}},{key:"moveCommasFromUrls",value:function(e){for(var t=e.slice(),a=1;a<t.length;a+=2)t[a].endsWith(",")&&(t[a+1]=","+t[a+1],t[a]=t[a].substring(0,t[a].length-1));return t}},{key:"splitMessageToUrls",value:function(t){return e.moveCommasFromUrls(e.splitMessageToUrlsByRegex(t))}},{key:"extractUrls",value:function(e){return e.filter((function(e,t){return t%2===1}))}},{key:"substituteWithShorterURLs",value:function(e,t){return e.map((function(e,a){return a%2===1?"https://smth.li//"+t[a/2|0]:e}))}}]),e}(),Pr=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,o,s,i,l,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a={},n={},o=Object(z.a)(t),e.prev=3,o.s();case 5:if((s=o.n()).done){e.next=19;break}if(i=s.value,l=i.completeRecordData.Owner.id,n[l]){e.next=16;break}return e.next=11,Ka(l);case 11:c=e.sent,a[i.value]={hasValue:!0,ownerData:c},n[l]=c,e.next=17;break;case 16:a[i.value]=n[l];case 17:e.next=5;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(3),o.e(e.t0);case 24:return e.prev=24,o.f(),e.finish(24);case 27:return e.abrupt("return",a);case 28:case"end":return e.stop()}}),e,null,[[3,21,24,27]])})));return function(t){return e.apply(this,arguments)}}(),Ar=function(){var e=Object(s.a)(r.a.mark((function e(t,a,n){var o,s,i,l,c,u,d,m,p,h,g,f,v;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ht.a.CRM.API.insertRecord({Entity:"twiliosmsextension0__Sent_SMS",APIData:t});case 3:return s=e.sent,i=null!==(o=null===s||void 0===s?void 0:s.data)&&void 0!==o?o:[],l=i.map((function(e,n){var r,o=e.status,s=t[n],i=s.Message;return{messageStatus:o,messageDate:e.Created_Time,messageRecordId:null===(r=e.details)||void 0===r?void 0:r.id,messageText:i,messageTo:s.Name,messageToNumber:s.To,lookupID:s.Entity_Id,entity:s.Entity_Type,campaignId:a,originalMessage:s}})),e.abrupt("return",l);case 9:if(e.prev=9,e.t0=e.catch(0),d=e.t0,m="429"===d.code,p=null===(c=d.data)||void 0===c?void 0:c[0],h=_a()(e.t0,{retry:!1,location:"insertRecordsWithRetries in bulk SMS",message:JSON.stringify(d.data)}),"INVALID_DATA"!==(null===p||void 0===p?void 0:p.code)&&"207"!==(null===p||void 0===p||null===(u=p.code)||void 0===u?void 0:u.toString())){e.next=19;break}throw(null===p||void 0===p||null===(g=p.details)||void 0===g||null===(f=g.api_name)||void 0===f?void 0:f.includes("twiliosmsextension0__Campaign"))&&(h=_a()(h,{isCampaignError:!0})),h;case 19:if(!(n<5||m)){e.next=24;break}return v=Math.pow(n+1,2)+Math.random(),e.next=23,ze(v);case 23:return e.abrupt("return",Ar(t,a,n+1));case 24:throw h;case 25:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,a,n){return e.apply(this,arguments)}}(),Dr=function(){var e=Object(s.a)(r.a.mark((function e(t,a){var n,o,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,yt().post("api/v1/bulk_messages/",t);case 3:return n=e.sent,e.abrupt("return",null===n||void 0===n?void 0:n.data);case 7:if(e.prev=7,e.t0=e.catch(0),!(a<5)){e.next=15;break}return console.error(e.t0),o=Math.pow(a+1,2)+Math.random(),e.next=14,ze(o);case 14:return e.abrupt("return",Dr(t,a+1));case 15:throw s=_a()(e.t0,{retry:!1,payload:t}),window.Sentry.captureException(s),s;case 18:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,a){return e.apply(this,arguments)}}(),jr=function(e){var t,a=Object($.getLocalInfo)(e.value);return null===a||void 0===a||null===(t=a.time)||void 0===t?void 0:t.zone},Rr=function(){var e=Object(s.a)(r.a.mark((function e(t,a,n){var o,s,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={"custom-security-token":"ZP0Fe76hnVP7qiLSqeiv2VF7Fq5ZzZdEbXokP23H","crm-org-id":a},e.prev=1,e.next=4,Ne.a.post("".concat("https://delugeonaluge.com/mobile-app/","prod/public/api/sync-messages"),t,{headers:o});case 4:e.next=17;break;case 6:if(e.prev=6,e.t0=e.catch(1),!(n<2)){e.next=14;break}return console.error(e.t0),s=Math.pow(n+1,2)+Math.random(),e.next=13,ze(s);case 13:return e.abrupt("return",Rr(t,a,n+1));case 14:throw i=_a()(e.t0,{retry:!1,payload:t}),window.Sentry.captureException(i),i;case 17:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,a,n){return e.apply(this,arguments)}}();function Fr(e){return Ur.apply(this,arguments)}function Ur(){return(Ur=Object(s.a)(r.a.mark((function e(t){var a,n,i,l,c,u,d,m,p,h,g,f,v,b,y,S,w,x,C,k,E,T,N,I,O,M,P,A,D,j,R,F,U,L,V,B,q,W,H,Y,G,Q,J,K,Z,$,ee,te,ae,re,oe,se,ie,le,ce,ue,de;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.sendImmediately,l=t.sendType,c=t.fromNumber,u=t.fromNumbers,d=t.toNumbers,m=t.templatedMessageText,p=t.mediaUrls,h=t.templateName,g=t.lookupFieldsForSMSMessagesModule,f=t.updateCampaignId,v=t.checkRecordMessageSentStatus,b=t.lookupFieldsForCurrentEntity,y=t.whoShouldBeNotified,S=t.createCampaign,w=t.updateMessageSentStatus,x=t.scheduledTimeToSend,C=t.deliveryMethod,k=t.email,E=t.messageNamePrefix,T=t.module,N=t.bypass_duplicate_check,I=t.shortenUrls,O=t.customSlug,M=t.notifyUrlShorteningFailed,e.next=3,Qa();case 3:return P=e.sent,e.next=6,St();case 6:return A=e.sent,D=A.z_api_key,j=A.crm_org_id,R=((null===P||void 0===P?void 0:P.users)||[])[0],e.next=12,Xa(["twiliosmsextension0__Default_international_phone_prefix","twiliosmsextension0__Use_Separate_Twilio_Credentials_For_Every_User","twiliosmsextension0__Default_Twilio_From_Number","twiliosmsextension0__Account_SID"]);case 12:return F=e.sent,U=Object(o.a)(F,4),L=U[0],V=U[1],B=U[2],q=U[3],e.next=20,Zt();case 20:return W=e.sent,H={},Y=u.filter((function(e){return e.value===B})),e.next=25,zn();case 25:return G=e.sent,e.next=28,Pr(d);case 28:return Q=e.sent,e.next=31,Er("Campaigns");case 31:if(K=e.sent,!S||!K){e.next=41;break}return Z=JSON.stringify({Campaign_Name:"Twilio campaign using ".concat(h||""," template sent at ").concat((new Date).toLocaleString()," to ").concat(d.length," recipients"),Type:"Twilio campaign",Status:"Sent",Owner:null===R||void 0===R?void 0:R.id}),e.next=36,gr("twiliosmsextension0__create_campaign_for_bulk_sms",Z);case 36:$=e.sent,ee=Le($,"getCampaignData",{}),J=ee.id,e.next=42;break;case 41:J=null;case 42:if(te={},"Send Later"!==l||"record_owner_number"===c.value){e.next=49;break}return re=JSON.stringify({from_number_id:c.completeRecordData.id}),e.next=47,Vn(re);case 47:oe=e.sent,te=null===oe||void 0===oe||null===(ae=oe.details)||void 0===ae?void 0:ae.output;case 49:return se={},e.next=52,Promise.all(d.map(function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,o,s,i,d,f,v,S,w,_,C,k,N,I,O,M,P,A,F,U,z,G,K,Z,$,ee,ae,re,oe,ie;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S=c.value,w=null===(a=Q[t.value])||void 0===a?void 0:a.ownerData,"record_owner_number"!==S){e.next=17;break}if(null===(S=w.users[0].mobile)&&(S=w.users[0].phone),I=u.filter((function(e){var a;return(null===(a=e.completeRecordData.Owner)||void 0===a?void 0:a.id)===t.completeRecordData.Owner.id})),O=null===(_=null!==(C=null===I||void 0===I||null===(k=I[0])||void 0===k?void 0:k.completeRecordData.id)&&void 0!==C?C:null===Y||void 0===Y||null===(N=Y[0])||void 0===N?void 0:N.completeRecordData.id)||void 0===_?void 0:_.toString(),se[O]){e.next=16;break}return P=JSON.stringify({from_number_id:O}),e.next=11,Vn(P);case 11:A=e.sent,te=null===A||void 0===A||null===(M=A.details)||void 0===M?void 0:M.output,se[O]=te,e.next=17;break;case 16:te=se[O];case 17:return e.next=19,ur(m,t.completeRecordData,b,w);case 19:if(F=e.sent,U=t.value.includes("whatsapp:"),z=null===(n=t.completeRecordData)||void 0===n?void 0:n.Owner,G=H[null===z||void 0===z?void 0:z.id.toString()]){e.next=29;break}return e.next=26,vr(z,W);case 26:(G=e.sent)||(G=R),H[null===z||void 0===z?void 0:z.id.toString()]=G;case 29:if(K=null===(o=g.find((function(e){return e.moduleName===t.entity})))||void 0===o?void 0:o.fieldName){e.next=32;break}return e.abrupt("return",null);case 32:return Z="Send Later"===l?jr(t):0,"",ee=X()().format("Z"),Z&&x&&(ee=X()().utcOffset(Z).format("Z")),$=X()(x).format("YYYY-MM-DDTHH:mm:ss")+ee,ae="".concat("Send Now"===l?E:"Scheduled SMS for"," ").concat(t.name," ").concat("Send Now"===l?"at ".concat($):"scheduled at ".concat($)),119,v={Name:ae.substring(0,119),From:U&&!(null===(s=S)||void 0===s?void 0:s.includes("whatsapp"))?"whatsapp:".concat(S):S,To:U?"whatsapp:".concat(mr(t.value)):mr(t.value)},Object($t.a)(v,K,t.lookupID),Object($t.a)(v,"Message",F),Object($t.a)(v,"Message_Date",$),Object($t.a)(v,"Owner",y===ne?null===(i=G)||void 0===i?void 0:i.id:null===R||void 0===R?void 0:R.id),Object($t.a)(v,"twiliosmsextension0__Scheduled_time_to_send","Send Now"===l?"":$),Object($t.a)(v,"twiliosmsextension0__MMS_content",p),Object($t.a)(v,"twiliosmsextension0__Campaign",J),Object($t.a)(v,"To_Name",t.name),Object($t.a)(v,"Entity_Id",t.lookupID),Object($t.a)(v,"Entity_Type",t.entity),Object($t.a)(v,"crm_owner_id",null===(d=G)||void 0===d?void 0:d.id),Object($t.a)(v,"Message_Type","outbound"),Object($t.a)(v,"twiliosmsextension0__Message_Reporting_Tag",h),Object($t.a)(v,"twiliosmsextension0__Message_Source",Lr(l,E)),Object($t.a)(v,"owner_id",y===ne?null===(f=G)||void 0===f?void 0:f.id:null===R||void 0===R?void 0:R.id),Object($t.a)(v,"twiliosmsextension0__Metadata_for_sending_SMS_later","Send Later"===l?JSON.stringify({default_international_prefix:L,twiliosmsextension0__Use_Separate_Twilio_Credentials_For_Every_User:V,twiliosmsextension0__Account_SID:q,twiliosmsextension0__Default_Twilio_From_Number:B,crm_org_id:j,z_api_key:D,headers:te}):""),re=v,"Deals"===T&&(re.ContactName=null===(oe=t.completeRecordData)||void 0===oe||null===(ie=oe.Contact_Name)||void 0===ie?void 0:ie.id),e.abrupt("return",re);case 42:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())).then((function(e){return e.filter((function(e){return!!e}))}));case 52:ie=e.sent,f(null!==(a=null===(n=J)||void 0===n?void 0:n.toString())&&void 0!==a?a:""),le=25,ce=0,ue=r.a.mark((function e(){var t,a,n,o,c,u,d;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=ce,a=Math.exp(t)+2*Math.random(),e.prev=2,console.log("Sending using batch size ",le),n=[],o=0;o<ie.length;o+=le)c=ie.slice(o,o+le),n.push(c);return e.next=8,Promise.all(n.map(function(){var e=Object(s.a)(r.a.mark((function e(a){var n,o,s,c,u,d,m,h,g;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a,"Send Now"===l&&(n=a.filter((function(e){return!v(e.Entity_Id)}))),e.next=4,Ar(n,J,t);case 4:if(o=e.sent,!I){e.next=34;break}s=Object(z.a)(o),e.prev=7,s.s();case 9:if((c=s.n()).done){e.next=26;break}if(u=c.value,(d=Mr.envConfigured()).apiClient.companyId=j,!d.detectURLsInMessage(u.messageText)){e.next=24;break}return e.prev=14,e.next=17,d.processMessage({message:u.messageText,sms_record_id:u.messageRecordId,slug:O});case 17:u.messageText=e.sent,e.next=24;break;case 20:e.prev=20,e.t0=e.catch(14),console.error("Could not shorten the URLs"),M();case 24:e.next=9;break;case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(7),s.e(e.t1);case 31:return e.prev=31,s.f(),e.finish(31);case 34:return m={sendImmediately:i,campaign_id:J,status_callback_url:G,user_email_id:k,mediaUrls:p,bypass_duplicate_check:Boolean(N),sendBatchedStatusUpdates:!i,messages:o.map((function(e){var t,a,n="Whatsapp"===C?"whatsapp":"sms";return{from_number:(null===(t=e.originalMessage.From)||void 0===t?void 0:t.replace("whatsapp:",""))||"",to_number:(null===(a=e.originalMessage.To)||void 0===a?void 0:a.replace("whatsapp:",""))||"",message:e.messageText,sms_record_id:e.messageRecordId,crm_record_id:e.lookupID,entity_id:e.lookupID,status:e.messageStatus,crm_owner_id:e.originalMessage.owner_id,sender_user_id:null===R||void 0===R?void 0:R.id,sending_channel:n,additional_linked_entity_id:"Deals"===T?e.originalMessage.ContactName:null,message_source:e.originalMessage.twiliosmsextension0__Message_Source,scheduled_time_to_send:"Send Now"===l?null:e.originalMessage.twiliosmsextension0__Scheduled_time_to_send}}))},e.next=37,Dr(m,t);case 37:return h=e.sent,g=o.map((function(e){return Object(_.a)(Object(_.a)({},e.originalMessage),{},{Owner:{id:e.originalMessage.owner_id},ContactName:{id:e.originalMessage.ContactName},id:e.messageRecordId})})),"Send Now"===l&&w&&w(h),e.prev=40,e.next=43,Rr(g,j,t);case 43:e.next=48;break;case 45:return e.prev=45,e.t2=e.catch(40),e.abrupt("return",h);case 48:return e.abrupt("return",h);case 49:case"end":return e.stop()}}),e,null,[[7,28,31,34],[14,20],[40,45]])})));return function(t){return e.apply(this,arguments)}}()));case 8:return u=e.sent,e.abrupt("return",{v:{outputMessage:u.flat(),campaignId:J}});case 12:if(e.prev=12,e.t0=e.catch(2),(null===(d=e.t0)||void 0===d?void 0:d.retry)&&!(ce>5)){e.next=17;break}throw new Error("Unable to send SMS - error from backend ".concat(JSON.stringify(e.t0)));case 17:if(1!==le){e.next=21;break}throw e.t0;case 21:2===le?le=1:le<=5?le=2:le<=10?le=5:le-=10;case 22:return e.next=24,ze(a);case 24:ce+=1,console.log("new batch size",le);case 26:case"end":return e.stop()}}),e,null,[[2,12]])}));case 57:if(!(le>0)){e.next=64;break}return e.delegateYield(ue(),"t0",59);case 59:if("object"!==typeof(de=e.t0)){e.next=62;break}return e.abrupt("return",de.v);case 62:e.next=57;break;case 64:return e.abrupt("return",{outputMessage:[],campaignId:J});case 65:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Lr=function(e,t){return"Outbound SMS for"===t?"message-list":"Send Later"===e?"bulk-sms-scheduled":"bulk-sms"};function Vr(e,t){return Br.apply(this,arguments)}function Br(){return(Br=Object(s.a)(r.a.mark((function e(t,a){var n,o,s,i,l,c,u,d,m,p,h;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=rt(o="recordUrlPrefix"),i={timestamp:Date.now(),urlPrefix:""},!s){e.next=9;break}if(i=Le(s,"recordUrlPrefix",{}),c=(null===(l=i)||void 0===l?void 0:l.timestamp)||"",!(We(c)<1)){e.next=9;break}return e.abrupt("return","".concat(null===(u=i)||void 0===u?void 0:u.urlPrefix).concat(a,"/").concat(t));case 9:return d=JSON.stringify({record_id:t,module_name:a}),e.next=12,ht.a.CRM.FUNCTIONS.execute("twiliosmsextension0__get_link_to_record_rest",{arguments:d});case 12:if(m=e.sent,p=null===m||void 0===m||null===(n=m.details)||void 0===n?void 0:n.output){e.next=16;break}return e.abrupt("return","");case 16:return h=p.split(a),i.timestamp=Date.now(),i.urlPrefix=h[0],ot(o,JSON.stringify(i)),e.abrupt("return","".concat(h[0]).concat(a,"/").concat(t));case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var qr=a(583),Wr=a(312),zr=function(e){var t=e.handleSkipDuplicates,a=h.useState(!1),n=Object(o.a)(a,2),i=n[0],l=n[1];return h.createElement(qr.a,{style:{padding:"10px",backgroundColor:Wr.a[900],color:"white"}},"This message was blocked as you sent a duplicate message to this person recently. We have this feature to avoid you accidentally spamming your contacts. Click"," ",h.createElement("button",{style:{backgroundColor:"inherit",padding:0,color:"red",border:"none",cursor:i?"not-allowed":"pointer"},onClick:Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l(!0),t(),e.next=4,ze(1.5);case 4:Tt();case 5:case"end":return e.stop()}}),e)}))),disabled:i},"here")," ","if you want to send it anyway even though it is a duplicate message.")},Hr=function(e){return(null===e||void 0===e?void 0:e.includes("whatsapp:"))?e.replace("whatsapp:",""):e},Yr=function(){var e=Object(s.a)(r.a.mark((function e(t,a){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={Entity:t,APIData:{id:a,twiliosmsextension0__Address_For_Email_To_SMS:"".concat(a,"@emailtosms.delugeonaluge.com")},Trigger:["workflow"]},e.next=3,ht.a.CRM.API.updateRecord(n);case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),Gr="filter_preferences",Qr=function(e){ot(Gr,JSON.stringify(e))};function Jr(e,t){return Kr.apply(this,arguments)}function Kr(){return(Kr=Object(s.a)(r.a.mark((function e(t,a){var n,o,s,i,l,c,u=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(u.length>2&&void 0!==u[2])||u[2],o=null===t||void 0===t?void 0:t.recordId,s=null===t||void 0===t?void 0:t.moduleName,e.prev=3,e.t0=a,e.t0){e.next=9;break}return e.next=8,Qa();case 8:e.t0=e.sent;case 9:return i=e.t0,e.next=12,Rn(s,[o],null===t||void 0===t?void 0:t.name,n);case 12:return l=e.sent,e.next=15,Ba("RelatedList",l,s,i);case 15:return c=e.sent,e.abrupt("return",c);case 19:if(e.prev=19,e.t1=e.catch(3),e.t1.message!==Fe){e.next=23;break}return e.abrupt("return",{messages:[],fromData:[],toArray:[]});case 23:throw e.t1;case 24:case"end":return e.stop()}}),e,null,[[3,19]])})))).apply(this,arguments)}var Zr=Object(h.createContext)(null),Xr=function(e){var t=e.children,a=e.fromNumbers,n=e.toNumbers,i=e.currentRecordDetails,l=e.messages,c=e.moduleName,u=e.currentUserData,d=Object(h.useState)(l),m=Object(o.a)(d,2),p=m[0],f=m[1],v=Object(h.useState)({fromNumbers:a,toNumbers:n,currentRecordDetails:i}),b=Object(o.a)(v,2),y=b[0],S=b[1],w=Object(h.useCallback)(Object(s.a)(r.a.mark((function e(){var t,a,n,o,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i){e.next=9;break}return t={name:i.Full_Name||"",moduleName:c,recordId:i.id},e.next=4,Jr(t,u);case 4:a=e.sent,n=a.fromData,o=a.toArray,s=a.messages,S((function(e){return Object(_.a)(Object(_.a)({},e),{},{fromNumbers:n,toNumbers:o})})),f(s),Ke(i.id,{fromData:n,toArray:o,messages:s,timestamp:Date.now()});case 9:case"end":return e.stop()}}),e)}))),[i,c,u]);return g.a.createElement(Zr.Provider,{value:Object(_.a)({triggerReload:w,messages:p},y)},t)},$r=a(586),eo=a(1010),to=a(35),ao=function(){var e=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yt().post("api/v1/team/",t);case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),no=function(){var e=Object(s.a)(r.a.mark((function e(){var t,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yt().get("api/v1/team/");case 2:return t=e.sent,a=null===t||void 0===t?void 0:t.data.map((function(e){var t,a;return{teamId:e.id,teamName:e.name,members:(null===e||void 0===e||null===(t=e.members)||void 0===t?void 0:t.map((function(e){var t;return{id:e.id,name:null===(t=e.user)||void 0===t?void 0:t.name,userId:e.user_id}})))||[],fromNumbers:(null===e||void 0===e||null===(a=e.from_numbers)||void 0===a?void 0:a.map((function(e){return{crm_record_id:e.crm_record_id,owner_id:e.crm_owner_id,phone_number:e.number,Owner:{id:e.crm_owner_id}}})))||[]}})),e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ro=function(){var e=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=yt().delete("api/v1/team/".concat(t,"/")),e.abrupt("return",a);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),oo=function(){var e=Object(s.a)(r.a.mark((function e(t,a){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yt().put("api/v1/team/".concat(a,"/"),t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),so=function(){var e=Object(s.a)(r.a.mark((function e(t,a,n){var o,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={crm_record_id:t,team_id:a,team_member_id:n},e.prev=1,e.next=4,yt().post("api/v1/reassign_conversation/",o);case 4:return s=e.sent,e.abrupt("return",s);case 8:e.prev=8,e.t0=e.catch(1),Oe()({title:"Error",text:"Failed to reassign conversation",icon:"error"});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,a,n){return e.apply(this,arguments)}}(),io=Object(Ct.a)((function(){return{root:{position:"absolute",top:"30%",left:"50%",transform:"translate(-50%, -50%)",width:800,backgroundColor:"#fff"},stack:{padding:30,display:"flex",flexDirection:"column",gap:"16px"},spread:{display:"flex",alignItems:"center",gap:"10px"},selectField:{width:"75%"}}})),lo=function(e){var t=e.open,a=e.handleCloseModal,n=e.teams,i=e.recordId,l=e.userCurrentTeam,c=Object(h.useState)([]),u=Object(o.a)(c,2),m=u[0],p=u[1],f=Object(h.useState)(null),v=Object(o.a)(f,2),b=v[0],y=v[1],S=Object(h.useState)([]),w=Object(o.a)(S,2),_=w[0],x=w[1],C=Object(h.useState)(null),k=Object(o.a)(C,2),E=k[0],T=k[1],N=Object(h.useState)(""),I=Object(o.a)(N,2),O=I[0],M=I[1],P=io();Object(h.useEffect)((function(){if(n){x(n.map((function(e){return{label:e.teamName,value:e.teamId}})).filter((function(e){return"noTeam"!==e.value})));var e=n.flatMap((function(e){return e.members.map((function(e){return{label:e.name,value:e.id}}))}));p(e)}}),[n]),Object(h.useEffect)((function(){l&&T({value:l.teamId,label:l.teamName})}),[l]),Object(h.useEffect)((function(){if(E){var e=n.find((function(e){return e.teamId===E.value})).members.map((function(e){return{label:e.name,value:e.id}}));p(e),y(null)}}),[E,n]);var A=function(e,t){if(e){var a=e;"team"===(null===t||void 0===t?void 0:t.name)?(T(a),M("")):"teamMember"===(null===t||void 0===t?void 0:t.name)&&y(a)}},D=function(){var e=Object(s.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!j){e.next=2;break}return e.abrupt("return");case 2:if("noTeam"!==(null===E||void 0===E?void 0:E.value)&&(null===E||void 0===E?void 0:E.value)){e.next=5;break}return M("Please select a team"),e.abrupt("return");case 5:return e.next=7,so(i,null===E||void 0===E?void 0:E.value,null===b||void 0===b?void 0:b.value);case 7:200===(null===(t=e.sent)||void 0===t?void 0:t.status)?a(!1,i.toString()):(R(),Oe()({icon:"error",text:["Sorry there was an error when reassigning the conversation.","Please email team@smooth.tel with a screenshot of this error message:","".concat(JSON.stringify(null===t||void 0===t?void 0:t.data))].join(" ")}));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),j=!(null===E||void 0===E?void 0:E.value)||"noTeam"===(null===E||void 0===E?void 0:E.value),R=function(){a(!1)};return g.a.createElement($r.a,{open:t,onClose:R},g.a.createElement(qr.a,{className:P.root,square:!0,elevation:0},g.a.createElement(G.a,{className:P.stack},g.a.createElement(G.a,null,g.a.createElement(Y.a,{variant:"h5"},"Reassign Conversation")),!!O&&g.a.createElement(d.a,{severity:"error"},O),g.a.createElement(G.a,{className:P.spread},g.a.createElement(Y.a,{variant:"body1",component:"p"},"Team:"),g.a.createElement(to.a,{name:"team",className:P.selectField,options:_,value:E,onChange:A})),g.a.createElement(G.a,{className:P.spread},g.a.createElement(Y.a,{variant:"body1",component:"p"},"Team Member:"),g.a.createElement(to.a,{name:"teamMember",className:P.selectField,options:m,value:b,onChange:A})),g.a.createElement(G.a,{className:P.spread},g.a.createElement(eo.a,{variant:"contained",color:"primary",onClick:D,disabled:j},"Reassign")))))},co=(a(259),a(576)),uo=function(e){var t=e.value,a=(e.cols,e.onChange),n=e.style,r=e.placeholder,s=e.maxLength,i=void 0===s?0:s,l=e.onClick,c=e.disabled,u=e.onKeyDown,d=e.containerStyle,m=e.className,p=e.inputRef,h=g.a.useState(1),f=Object(o.a)(h,2),v=f[0],b=f[1];g.a.useEffect((function(){var e=(t.match(/\n/g)||[]).length+1;b(Math.min(e,3))}),[t]);return g.a.createElement("div",{style:d},g.a.createElement(co.a,{style:n,placeholder:r,maxRows:3,rows:v,value:t,onChange:function(e){0!==i&&e.target.value.length>i||c||a(e)},onClick:l,onKeyDown:u,ref:p,className:m,"data-test-id":"messageInput"}))},mo=Object(Ct.a)((function(){return{fileNameList:{listStyleType:"none"}}})),po=function(e){var t=mo(),a=e.removeImage,n=e.uploadedImageFileNames;return g.a.createElement("ul",{className:t.fileNameList},n.map((function(e,t){return g.a.createElement("li",{key:e,style:{display:"flex",alignItems:"center"}},g.a.createElement(E.a,{"aria-label":"delete",size:"small",onClick:function(){return a(t)},style:{marginRight:"5px"}},g.a.createElement(qt.a,null)),e)})))},ho=Object(h.memo)(po),go=a(201),fo=a(192),vo=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Object(h.useState)(e),a=Object(o.a)(t,2),n=a[0],r=a[1],s=Object(h.useCallback)((function(){return r((function(e){return!e}))}),[]),i=Object(h.useCallback)((function(){return r(!0)}),[]),l=Object(h.useCallback)((function(){return r(!1)}),[]),c=Object(h.useCallback)((function(e){return r(e)}),[]);return[n,s,c,i,l]},bo={search:"Search",categories:{search:"Search Results",recent:"Frequently Used",smileys:"Smileys & Emotion",people:"People & Body",nature:"Animals & Nature",foods:"Food & Drink",activity:"Activity",places:"Travel & Places",objects:"Objects",symbols:"Symbols",flags:"Flags",custom:"Custom"}},yo=Object(Ct.a)((function(){return{emojiContainer:{position:"absolute",bottom:50,right:10,zIndex:2},clickOutSideContainer:{position:"fixed",inset:0,width:"100%",height:"100%",zIndex:1}}})),So=function(e){var t=e.handleChosenEmoji,a=yo(),n=vo(!1),r=Object(o.a)(n,2),s=r[0],i=r[1];return g.a.createElement("div",{style:{position:"relative"}},g.a.createElement(E.a,{style:{marginRight:"5px"},onClick:i},g.a.createElement(fo.a,null)),s&&g.a.createElement("div",{onClick:i,className:a.clickOutSideContainer}),s&&g.a.createElement("div",{className:a.emojiContainer},g.a.createElement(go.a,{onSelect:t,showSkinTones:!1,showPreview:!1,i18n:bo})))},wo=Object(h.memo)(So),_o=a(575);function xo(e){var t=Object(h.useState)(!1),a=Object(o.a)(t,2),n=a[0],r=a[1];return g.a.createElement(_o.a,{onDrop:function(t){!function(e,t,a,n,r){var o=e.map((function(e){var t=new FormData;return t.append("file",e),t.append("tags","twilio"),t.append("upload_preset","twilio"),t.append("api_key","173952541553444"),t.append("timestamp",Date.now().toString()),Ne.a.post("https://api.cloudinary.com/v1_1/lktvgsltz/image/upload",t,{headers:{"X-Requested-With":"XMLHttpRequest"}}).then((function(e){return e.data.url}))}));a(!0),Ne.a.all(o).then((function(o){var s=e.map((function(e){return e.name}));n&&n.map((function(e){return o.unshift(e)})),r&&r.map((function(e){return s.unshift(e)})),t(o,s),a(!1)}))}(t,e.handleImageUpload,r,e.mediaURLs,e.fileNames)},multiple:!0,accept:"image/*"},(function(t){var a=t.getRootProps,r=t.getInputProps;return g.a.createElement("section",null,g.a.createElement("div",a(),g.a.createElement("input",Object.assign({},r(),{"data-test-id":"attachment-button"})),g.a.createElement(eo.a,null,"Attachments:",g.a.createElement("span",{role:"img","aria-label":"Attachment",style:{fontSize:"16px"}},"\ud83d\udcce")),g.a.createElement("ul",null,e.uploadedImageFileNames.map((function(e){return g.a.createElement("li",{key:e},e)}))),g.a.createElement(jt,{loading:n})))}))}var Co=Object(Ct.a)((function(){return{container:{width:"100%",display:"flex"},composeInput:{flex:1,fontSize:14,height:30,background:"none",padding:"10px",border:"0px",outline:"none",width:"100%","&::placeholder":{opacity:1},"&:focus":{outline:"none"}}}})),ko=function(e){var t=Co(),a=e.mediaURLs,n=e.uploadedImageFileNames,r=e.handleImageUpload,o=e.removeImage,s=e.isSendingDisabled,i=e.handleSendSMSonKeyDown,l=e.handleInputChange,c=e.handleInputClick,u=e.messageValue,d=e.handleChosenEmoji,m=e.handleSendSMSonClick,p=e.inputRef;return g.a.createElement("div",{className:t.container},g.a.createElement("div",null,g.a.createElement(xo,{mediaURLs:a,fileNames:n,handleImageUpload:r,uploadedImageFileNames:[]}),g.a.createElement(ho,{removeImage:o,uploadedImageFileNames:n})),g.a.createElement(uo,{containerStyle:{width:"90%"},maxLength:1500,inputRef:p,className:t.composeInput,placeholder:"Type your message here",onKeyDown:function(e){return!s&&i(e)},onChange:l,onClick:c,value:u}),g.a.createElement(wo,{handleChosenEmoji:d}),g.a.createElement("div",{style:{paddingRight:"1rem"}},g.a.createElement(eo.a,{variant:"contained",color:"primary",size:"large",onClick:m,disabled:s,"data-test-id":"sendMessageButton"},"Send")))},Eo=a(542),To=a.n(Eo),No=Object(Ct.a)((function(){return{drawer:{minWidth:"25%"},drawerHeader:{display:"flex",alignItems:"center",justifyContent:"flex-start",paddingLeft:"10px",gap:"10px"},drawerContainer:{padding:"10px"}}})),Io=function(e){var t=No(),a=e.children,n=e.open,r=e.style,o=e.onClose,s=e.title,i=e.sendingToDropdownWidth;return g.a.createElement(k.a,{variant:"persistent",anchor:"right",open:n,classes:{paper:t.drawer}},g.a.createElement("div",{style:r,className:t.drawerHeader},g.a.createElement("div",null,g.a.createElement(E.a,{onClick:o},g.a.createElement(To.a,null))),g.a.createElement(Y.a,{variant:"h5",component:"h2"},s)),g.a.createElement(T.a,null),g.a.createElement("div",{className:t.drawerContainer},g.a.createElement("div",{style:{width:"".concat(8*i+60,"px")}},a)))},Oo=Object(Ct.a)((function(){return{fieldLabel:{marginTop:"1em",marginBottom:0}}})),Mo=function(e){var t=Oo(),a=e.fromNumbers,n=e.fromNumberValue,r=e.handleChangedFromNumber,s=e.alternateToNumbers,i=e.handleSendingToChange,l=e.sendingToValue,c=e.deliveryMethod,u=e.handleDeliveryMethodChange,d=e.whoShouldBeNotified,m=e.handleNotifyReplyChange,p=vo(!1),f=Object(o.a)(p,3),v=f[0],b=f[1],y=f[2];Object(h.useEffect)((function(){var e=fa();y(!!e)}),[]);return g.a.createElement(g.a.Fragment,null,g.a.createElement("p",{className:t.fieldLabel},"From"),g.a.createElement(to.a,{options:a,value:n,onChange:r,menuPlacement:"auto",isDisabled:v}),g.a.createElement(x.a,{control:g.a.createElement(C.a,{checked:v,onChange:function(e){var t;e.target.checked?(t=n,ot(ga,JSON.stringify(t))):va(),b()},color:"primary",size:"small"}),label:g.a.createElement("span",{style:{fontSize:"14px"}},"Always use this from number")}),g.a.createElement("p",{style:{fontSize:12}},"(This setting only applies for this computer and does not affect other users)"),g.a.createElement("p",{className:t.fieldLabel},"Sending to"),g.a.createElement(to.a,{options:s,value:l,onChange:i,menuPlacement:"auto"}),g.a.createElement("p",{className:t.fieldLabel},"Delivery Method"),g.a.createElement(to.a,{options:ce,value:c,onChange:u,menuPlacement:"auto"}),g.a.createElement("p",{className:t.fieldLabel},"Who should be notified of replies?"),g.a.createElement(to.a,{options:oe,value:oe.find((function(e){return e.value===d})),onChange:m,getOptionLabel:function(e){return e.label}}))},Po=function(e){var t=e.fromNumbers,a=e.bySender,n=e.handleChangeFilterSender,r=e.ownerArray,o=e.byAuthor,s=e.handleChangeFilterAuthor,i=e.onClickClearFilter;return g.a.createElement(g.a.Fragment,null,g.a.createElement("p",null,"From Number"),g.a.createElement(to.a,{options:t,value:a,onChange:n,menuPlacement:"auto"}),g.a.createElement("p",null,"CRM User"),g.a.createElement(to.a,{options:r,value:o,onChange:s,menuPlacement:"auto"}),g.a.createElement(eo.a,{size:"small",style:{marginTop:15},color:"primary",onClick:i},"Clear"))},Ao=a(1066),Do=a(1109),jo=a(1067),Ro=a(1071),Fo=a(1072),Uo=function(e){var t=e.handleSearchField,a=e.isSearching,n=e.searchIndex,r=e.messagesMatched,o=e.handleSearchIcon;return g.a.createElement(Ao.a,{container:!0,spacing:1,alignItems:"flex-end",style:{width:"100%"}},g.a.createElement(Ao.a,{item:!0},g.a.createElement(jo.a,null)),g.a.createElement(Ao.a,{item:!0,sm:6},g.a.createElement(Do.a,{label:"Search",style:{width:"100%"},onChange:t,inputProps:{"data-test-id":"messageSearch"}})),g.a.createElement(Ao.a,{item:!0,style:a?{display:"",color:"gray"}:{display:"none"}},g.a.createElement("p",{style:{fontSize:12}},r.length>0?n+1:0,"/",r.length)),g.a.createElement(E.a,{size:"small",onClick:function(){return o("up")},disabled:0===n||r.length<=1},g.a.createElement(Ro.a,null)),g.a.createElement(E.a,{size:"small",onClick:function(){return o("down")},disabled:r.length-1===n||r.length<=1},g.a.createElement(Fo.a,null)))},Lo=a(1073),Vo=a(1074),Bo=a(1075),qo=Object(Ct.a)((function(){return{senderContainer:{display:"flex",alignItems:"center",paddingRight:10,gap:"10px"},senderNameContainer:{margin:"10px 0 0 10px",display:"flex",flexDirection:"column",flex:"1",width:1e3},senderName:{color:"black",textDecoration:"none",fontWeight:"bold",fontSize:20,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},moduleName:{margin:0,padding:0,color:"gray"},topButtonWrap:{display:"flex",justifyContent:"center",alignItems:"center",gap:"5px"}}})),Wo=function(e){var t=qo(),a=e.optedOut,n=e.recordUrl,i=e.selectedConversation,l=e.handleReassignClick,c=e.handleClickOptOut,u=e.handleCloseConversation,d=e.teams,m=Object(h.useState)(n||""),p=Object(o.a)(m,2),f=p[0],v=p[1];return Object(h.useEffect)((function(){(function(){var e=Object(s.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}v(n),e.next=8;break;case 4:return e.next=6,Vr(i.recordId,i.moduleName);case 6:t=e.sent,v(t);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[n,i]),g.a.createElement("div",{className:t.senderContainer},g.a.createElement("div",{className:t.senderNameContainer},g.a.createElement("a",{className:t.senderName,target:"_blank",rel:"noreferrer",href:f,title:i.name},i.name),g.a.createElement("p",{className:t.moduleName},i.moduleName)),g.a.createElement("div",{className:t.topButtonWrap},!a&&Boolean(n)&&g.a.createElement(g.a.Fragment,null,d.length>0&&g.a.createElement(eo.a,{variant:"contained",color:"default",size:"small",onClick:function(){return l(!0)},startIcon:g.a.createElement(Lo.a,null),title:"Reassign"},"Reassign"),g.a.createElement(eo.a,{variant:"contained",color:"default",size:"small",onClick:c,startIcon:g.a.createElement(Vo.a,null),title:"Opt out this contact"},"Opt Out")),g.a.createElement(eo.a,{variant:"contained",color:"default",size:"small",onClick:function(){return u(null===i||void 0===i?void 0:i.moduleName,null===i||void 0===i?void 0:i.recordId)},startIcon:g.a.createElement(Bo.a,null),title:"Close Conversation"},"Close Conversation")))},zo=(a(427),a(543)),Ho=a.n(zo),Yo=a(544),Go=(a(432),a(8)),Qo=a.n(Go),Jo=a(1122),Ko=a(1069),Zo=a(1064),Xo=a(1070),$o=a(1076),es=function(e){var t=e.anchorEl,a=e.handleClose,n=e.handleSelectSpeed,r=e.speed;return g.a.createElement(Ko.a,{open:Boolean(t),anchorEl:t,onClose:a,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"right"}},g.a.createElement(qr.a,null,g.a.createElement(Zo.a,{onClickAway:a},g.a.createElement(Xo.a,{autoFocusItem:Boolean(t),id:"menu-list-grow"},[2,1.5,1,.5].map((function(e){return g.a.createElement($o.a,{key:e,onClick:function(){return n(e),void a()},selected:r===e},e.toFixed(1),"x speed")}))))))},ts=a(547),as=a.n(ts),ns=a(546),rs=a.n(ns),os=Object(Ct.a)((function(){return{audioMessageWrap:{display:"flex",flexDirection:"row",alignItems:"center",background:"rgba(22, 24, 35, 0.06)",borderRadius:"92px",position:"relative",overflow:"hidden",width:"250px"},button:{padding:"11px 16px 11px 12px",fontSize:0,cursor:"pointer",outline:"none",border:"none",background:"transparent","&:hover":{backgroundColor:"transparent"}},divider:{width:"1px",height:"28px",margin:"3px 0",background:"rgba(22, 24, 35, 0.12)"},slider:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",paddingRight:"30px",position:"relative"},timer:{bottom:"-10px",left:0,position:"absolute"},moreIcon:{cursor:"pointer"}}})),ss=function(e){var t=e.src,a=Object(h.useRef)(null),n=Object(h.useRef)(null),r=Object(h.useState)(0),s=Object(o.a)(r,2),i=s[0],l=s[1],c=Object(h.useState)(0),u=Object(o.a)(c,2),d=u[0],m=u[1],p=Object(h.useState)(!1),f=Object(o.a)(p,2),v=f[0],b=f[1],y=Object(h.useState)(null),S=Object(o.a)(y,2),w=S[0],_=S[1],x=Object(h.useState)(1),C=Object(o.a)(x,2),k=C[0],T=C[1],N=os();Object(h.useEffect)((function(){var e=rt("audio_playback_speed")||"1";T(parseFloat(e))}),[]);return t&&"[]"!==JSON.stringify(t)?g.a.createElement(g.a.Fragment,null,g.a.createElement("div",{className:N.audioMessageWrap},g.a.createElement(E.a,{size:"small",onClick:function(){a.current&&(v?a.current.pause():a.current.play(),b((function(e){return!e})))},className:N.button,disableFocusRipple:!0,disableRipple:!0},v?g.a.createElement(rs.a,null):g.a.createElement(as.a,null)),g.a.createElement("span",{className:N.divider}),g.a.createElement("div",{className:N.slider},g.a.createElement(Jo.a,{value:i,onChange:function(e,t){a.current&&(a.current.currentTime=t,l(t),v||(b(!0),a.current.play()))},max:d,disabled:!d}),g.a.createElement("span",{className:N.timer},X()(i,"ss").format("mm:ss"),"Invalid date"!==X()(d,"ss").format("mm:ss")?" : ".concat(X()(d,"ss").format("mm:ss")):null)),g.a.createElement("audio",{style:{display:"none"},ref:a,src:t,onLoadedMetadata:function(){a.current&&(m(a.current.duration),v&&a.current.play())},onTimeUpdate:function(){var e;return l((null===(e=a.current)||void 0===e?void 0:e.currentTime)||0)},onEnded:function(){return b(!1)}})),g.a.createElement(Y.a,{ref:n,className:N.moreIcon,onClick:function(e){_(e.currentTarget)},title:"current speed"},k.toFixed(1),"x"),g.a.createElement(es,{anchorEl:w,handleClose:function(){_(null)},handleSelectSpeed:function(e){a.current&&(T(e),ot("audio_playback_speed",e.toString()),a.current.playbackRate=e)},speed:k})):null},is=a(242),ls=a(548),cs=a(549),us=function(e){var t,a,n,r,o,s=e.message,i=e.inbound,l=e.isOneOnOneSMS,c=(null===(t=s.from)||void 0===t||null===(a=t.split(":")[1])||void 0===a?void 0:a.trim())||s.from||"",u=(null===(n=s.to)||void 0===n||null===(r=n.split(":")[1])||void 0===r?void 0:r.trim())||s.to||"",d=(i?s.author:s.senderName)||"unknown",m=null===s||void 0===s||null===(o=s.status)||void 0===o?void 0:o.toLowerCase(),p="unknown"===s.id&&""!==s.scheduledTimeToSend,h="unknown"===u||!u;return(["failed","undelivered"].includes(m)||"unknown"===s.id)&&!p||h?g.a.createElement("p",{className:"errorMessage"},s.errorMessage||"Failed to send message"):g.a.createElement("p",{className:Qo()("sender_info",{sender_info_outbound:!i})},l&&d," ",c," to ",u)},ds=function(e){var t,a,n,r=e.message,o=e.isWhatsapp,s="Voicemail Message"===r.messageSource,i=(null===(t=r.to)||void 0===t||null===(a=t.split(":")[1])||void 0===a?void 0:a.trim())||r.to||"",l=null===r||void 0===r||null===(n=r.status)||void 0===n?void 0:n.toLowerCase(),c="unknown"===r.id&&""!==r.scheduledTimeToSend,u="unknown"===i||!i,d=(["failed","undelivered"].includes(l)||"unknown"===r.id)&&!c||u,m=g.a.createElement(g.a.Fragment,null),p=g.a.createElement(g.a.Fragment,null);return u||(m=o?g.a.createElement(is.d,null):g.a.createElement(ls.a,null)),"delivered"===l||"sent"===l?p=g.a.createElement(is.b,null):"read"===l?p=g.a.createElement(is.a,null):"pending"!==l&&"queued"!==l||(p=g.a.createElement(Q.a,{size:8})),d||"unknown"===r.id||s?c?g.a.createElement("div",{className:"icon"},g.a.createElement(cs.a,null)):d?g.a.createElement("div",{className:"errorIcon"},g.a.createElement(is.c,null)):null:g.a.createElement("div",{className:"icon"},p,m)},ms=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={isImageExpanded:!1,lightboxDisplay:!1,imageToShow:""},e}return Object(l.a)(a,[{key:"render",value:function(){var e=this,t=this.state,a=t.isImageExpanded,n=t.lightboxDisplay,r=this.props,o=r.data,s=r.showTimestamp,i=r.whatsapp,l=r.inbound,c=r.toHighlight,u=r.currentSearchId,d=r.showSender,m=r.currentUserId,p=r.isOneOnOneSMS,h=["Voicemail Message","Phone Call"].includes(o.messageSource||""),f="Invalid date"===X()(o.timestamp).toString()||X()(o.timestamp).isBefore("2020-01-01"),v=X()(o.timestamp).format("LLLL"),b="unknown"===o.id&&""!==o.scheduledTimeToSend,y=function(t){if(t.length>1){var a=t.replace(/\[["']/,"").replace(/["']\]/,"");if(t.includes("<img")){var r;a=(null===(r=a.match(/<img.*?src=['|"](.*?)['|"][^>]/))||void 0===r?void 0:r[1])||""}return g.a.createElement("div",{key:a},g.a.createElement("img",{src:a,alt:"alternative",onClick:function(){return t=a,void e.setState({imageToShow:t,lightboxDisplay:!0});var t}}),n&&g.a.createElement("div",null,g.a.createElement(Yo.a,{mainSrc:e.state.imageToShow,onCloseRequest:function(){return e.setState({lightboxDisplay:!1})},enableZoom:!1,imageCaption:g.a.createElement("div",{style:{textAlign:"center"}},g.a.createElement("a",{href:a,style:{fontSize:"17px",color:"white"},rel:"noopener noreferrer",target:"_blank"},"Open in new tab"))})),g.a.createElement("br",null))}},S=(l?o.author:o.senderName)||"unknown",w=l?o.entity_id:o.sender_user_id,_=this.props.getUniqueColor(w,m);return g.a.createElement("div",{id:o.id},s&&!f&&g.a.createElement("div",{className:"timestamp"},v),g.a.createElement("div",{className:Qo()("wrapper",{wrapper_outbound:!l})},!p&&g.a.createElement("div",{className:"avatar"},d&&g.a.createElement(Ot,{name:S,id:w,size:36,currentUserId:m,getUniqueColor:this.props.getUniqueColor})),g.a.createElement("div",{className:"message-body"},g.a.createElement("div",{className:Qo()("header",{header_outbound:!l})},d&&!p&&g.a.createElement("div",{className:"sender"},S),g.a.createElement("div",{className:"timeSent"},"".concat(b?"Scheduled to send at ":"").concat(v))),g.a.createElement("div",{className:Qo()("message",{message_outbound:!l,center_message_icon:h})},h&&function(e){if("Voicemail Message"!==e.messageSource)return null;var t;if(Array.isArray(e.mmsContent))t=e.mmsContent[0];else{if("string"!==typeof e.mmsContent)return null;t=Le(e.mmsContent,"parse mms to display","")}return g.a.createElement(ss,{src:t})}(o),g.a.createElement("div",{className:Qo()("content",{content_outbound:!l}),style:{background:_,color:Nt(_),minWidth:h?"calc(100% - 280px)":"unset"}},g.a.createElement(g.a.Fragment,null,function(e,t,a,n){var r;return g.a.createElement(Ho.a,{highlightStyle:n.id===e?{backgroundColor:t}:{backgroundColor:"yellow"},searchWords:[a],autoEscape:!0,textToHighlight:n.message||"",className:(null===(r=o.message)||void 0===r?void 0:r.includes("no message included"))?"blank-mms-content":""})}(u,"#EBAE34",c,o),!h&&g.a.createElement("div",{className:a?"":"mms-content"},function(e){if(e&&"[]"!==e&&"[]"!==JSON.stringify(e))return Array.isArray(e)?e.map(y):(e.match(/src/g)||[]).length>1?e.split(">").map(y):y(e)}(o.mmsContent)))),g.a.createElement(ds,{message:o,isOneOnOneSMS:p,inbound:l,isWhatsapp:i})),g.a.createElement(us,{message:o,isOneOnOneSMS:p,inbound:l,isWhatsapp:i}))))}}]),a}(h.Component),ps=function(e){var t=e.bySender,a=e.byAuthor,n=e.messagesToRender,r=e.textToHighlight,o=e.isOneOnOneSMS,s=e.currentSearchId,i=e.currentUserId,l=e.getUniqueColor,c={},u=null===n||void 0===n?void 0:n[0],d="inbound"===(null===u||void 0===u?void 0:u.messageType)?null===u||void 0===u?void 0:u.author:(null===u||void 0===u?void 0:u.sender_user_id)||(null===u||void 0===u?void 0:u.owner_id),m=n.map((function(e,n,u){var m,p,h,f=u[n-1],v=e;if(!v||!(null===(m=v.message)||void 0===m?void 0:m.length)&&!(null===(p=v.mmsContent)||void 0===p?void 0:p.length))return null;var b=X()(v.timestamp),y=null===(h=v.to)||void 0===h?void 0:h.includes("whatsapp"),S="inbound"===v.messageType,w=!0,_=!0,x=!1;if(t&&(_=t.value===Hr(v.from)||t.value===Hr(v.to)),a&&(_=_&&a.value===v.owner_id),f){var C=X()(f.timestamp);X.a.duration(b.diff(C)).as("hours")<1&&(w=!1)}if(f){var k=S?v.author:v.sender_user_id||v.owner_id;x=d===k}return _&&(void 0===c[v.id]||"pending"===v.status||v.scheduledTimeToSend)?(c[v.id]=v,d=S?v.author:v.sender_user_id||v.owner_id,g.a.createElement(ms,{key:"".concat(v.id,"_").concat(n),showTimestamp:w,data:v,whatsapp:y,inbound:S,toHighlight:r,currentSearchId:s,showSender:!x||w,currentUserId:i.toString(),isOneOnOneSMS:o,getUniqueColor:l})):null}));return m.filter(Boolean).length?g.a.createElement(g.a.Fragment,null,m.filter(Boolean)):null},hs=function(e){return e.find((function(e){return!!e.isMine}))},gs=function(e){return e.find((function(e){return!!e.hasCriteria}))},fs=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n,o,l,c;Object(i.a)(this,a),(c=t.call(this,e)).context=void 0,c.handleMessageInput=g.a.createRef(),c.prevMessageValue="",c.messagesToRender=[],c.messagesMatched=[],c.searchIndex=0,c.optedOut=!1,c.getFromNumberFromInbound=function(e){var t,a=Be(e.filter((function(e){return"inbound"===e.messageType}))).pop(),n=null===a||void 0===a||null===(t=a.to)||void 0===t?void 0:t.replace("whatsapp:","");return c.props.fromNumbers.find((function(e){return e.value===n}))},c.focusMessageInput=function(e){c.handleMessageInput&&c.handleMessageInput.current&&(c.handleMessageInput.current.focus(),c.handleMessageInput.current.value=e),c.setState({messageValue:e})},c.scrollListener=function(e){var t=document.getElementById("message-list"),a=(null===t||void 0===t?void 0:t.scrollTop)||document.body.scrollTop;a>0&&c.state.scrollPosition<=a?c.setState({isScrollingUp:!1}):c.setState({isScrollingUp:!0}),c.setState({scrollPosition:a})},c.setOptedOut=function(){var e=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:yt().put("api/v1/update_entity/".concat(null===(a=c.props.selectedConversation)||void 0===a?void 0:a.recordId),{opted_out:!0,crm_record_id:t}).catch((function(){return[]}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.updateEmailToSMS=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=((null===t||void 0===t?void 0:t.twiliosmsextension0__Address_For_Email_To_SMS)||"").split("@")[0],!(t&&null===t.twiliosmsextension0__Address_For_Email_To_SMS||n!==(null===t||void 0===t||null===(a=t.id)||void 0===a?void 0:a.toString()))){e.next=4;break}return e.next=4,Yr(c.props.moduleName,t.id);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.initializePusher=Object(s.a)(r.a.mark((function e(){var t,a,n,o,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new or.a(ge,{cluster:fe}),a=t.subscribe(c.props.crmOrganisationID),n=c.props.currentRecordDetails?c.props.currentRecordDetails.id:"",o=c.props.moduleName,a.bind("inbound_sms",(function(e){var t,a="string"===typeof e?Le(e,"inbound_sms",{}):Object(_.a)({},e);(null===a||void 0===a?void 0:a.record_id)&&(a.record_id=null===(t=a.record_id)||void 0===t?void 0:t.replace("str",""),o===a.module_name&&n.toString()===a.record_id.toString()&&c.addNewMessage(a))})),e.next=7,Vr(c.props.selectedConversation.recordId,c.props.selectedConversation.moduleName);case 7:s=e.sent,c.setState({recordUrl:s});case 9:case"end":return e.stop()}}),e)}))),c.addNewMessage=function(e){var t,a,n={author:e.record_name,message:e.message_body,timestamp:e.Message_Date,messageType:e.direction,id:e.sid,mmsContent:e.mms_content,from:e.from,to:e.to,ownerName:e.owner_name,status:e.status,errorMessage:e.error,owner_id:null===(t=e.owner_id)||void 0===t?void 0:t.toString(),sender_user_id:e.sender_user_id,senderName:"",entity_id:e.record_id,scheduledTimeToSend:""},o=c.state.messages.find((function(t){return t.id===e.sid})),i="queued"===n.status,l=c.getDeliveryMethod(n),u=[];if(o||i){var d=!1,m=c.state.messages.map((function(t){if(d=i?t.message===e.message_body&&"pending"===t.status:t.id===e.sid){var a=n.messageType||t.messageType;return a.toLowerCase()!==t.messageType.toLowerCase()&&(a=i?"outbound":t.messageType),Object(_.a)(Object(_.a)({},n),{},{sender_user_id:t.sender_user_id,senderName:t.senderName,id:n.id,messageType:a,message:n.message||t.message,timestamp:"read"===n.status?new Date(t.timestamp):new Date(n.timestamp||t.timestamp),author:a.toLowerCase().startsWith("out")?n.ownerName:n.author})}return t}));d||!n.message&&!n.mmsContent||m.push(Object(_.a)(Object(_.a)({},n),{},{timestamp:new Date(n.timestamp),messageType:"outbound",author:n.ownerName,status:"pending"})),u=Be(m)}else u=Be([].concat(Object(w.a)(c.state.messages),[n]));c.setState((function(e){return Object(_.a)(Object(_.a)({},e),{},{messages:u,newMessage:!o,deliveryMethod:l})}),Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ze(.3);case 2:c.scrollToBottomIfNeeded();case 3:case"end":return e.stop()}}),e)}))));var p=c.getFromNumberFromInbound(c.state.messages);p&&"inbound"===(null===(a=n.messageType)||void 0===a?void 0:a.toLowerCase())&&c.setState({fromNumber:p.value,fromNumberValue:p})},c.fetchNewMessages=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.setState({loader:!t&&!0}),e.next=3,wn({completeRecordData:c.props.currentRecordDetails,entity:c.props.moduleName});case 3:a=e.sent,n=Be(a),c.setState({loader:!1}),c.props.messages.length!==n.length&&(c.setState({newMessage:!0}),c.setState({messages:n,deliveryMethod:c.getDeliveryMethod(n.slice(-1)[0])})),c.scrollToBottomIfNeeded();case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.getMessages=function(e){var t=Be(c.props.messages),a=t.length?t[t.length-1]:null;c.messagesToRender=t,c.setState((function(e){return Object(_.a)(Object(_.a)({},e),{},{messages:t,deliveryMethod:c.getDeliveryMethod(t.slice(-1)[0])})}),Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.scrollToBottomIfNeeded(),e.next=3,c.setNumberInitialValue(a);case 3:case"end":return e.stop()}}),e)}))))},c.scrollAnchor=null,c.isFilterEnabled=function(){return Object.values(c.state.filters).some(Boolean)},c.checkSwearWords=function(e){V.a.remove("xx"),"7000789776"===c.props.crmOrganisationID&&V.a.remove(["breast","nipple","breasts","nipples"]),V.a.check(e)?c.setState({messageWithSwearWords:!0}):c.setState({messageWithSwearWords:!1})},c.sendInvestigationMail=Object(s.a)(r.a.mark((function e(){var t,a,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ya();case 2:return a=e.sent,n={to_number:null===(t=c.state.toNumber)||void 0===t?void 0:t.value,from_number:c.state.fromNumber,message:c.state.messageValue,super_admin_email:null===a||void 0===a?void 0:a.superadmin_email,crm_org_id:c.props.crmOrganisationID,rectified_message:V.a.clean(c.state.messageValue)},e.next=6,yt().post("api/v1/investigate/",n).catch((function(e){return console.log(e)}));case 6:case"end":return e.stop()}}),e)}))),c.handleInputChange=function(e){c.setState({messageValue:e.target.value,selectionIndex:e.target.selectionStart}),c.checkSwearWords(e.target.value)},c.handleSendSMSonClick=function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,c.handleSendSMS();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.handleSendSMSonKeyDown=function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==t.key||t.shiftKey){e.next=5;break}return t.preventDefault(),"\n"===c.state.messageValue[c.state.messageValue.length-1]&&c.setState({messageValue:c.state.messageValue.slice(0,c.state.messageValue.length-1)}),e.next=5,c.handleSendSMS();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.updateCampaignIdParameter=function(e){},c.checkRecordMessageSentStatusParameter=function(e){return""},c.updateMessageSentStatus=function(e){var t=e[0],a=c.state.messages;if("fail"===(null===t||void 0===t?void 0:t.status)||"Failed"===(null===t||void 0===t?void 0:t.status)){var n;a.pop();var r={message:c.prevMessageValue||t.message,from_number:c.state.fromNumberValue.value,to_number:(null===(n=c.state.toNumber)||void 0===n?void 0:n.value)||"",deliveryMethod:c.state.deliveryMethod.value};zt({message:Ee(t,r)})}else if(null===t||void 0===t?void 0:t.duplicate_message)a.pop(),zt({component:g.a.createElement(zr,{handleSkipDuplicates:function(){c.setState({messageValue:t.message},(function(){return c.handleSendSMS(!0)}))}})});else{var o=a[a.length-1];o.id=null===t||void 0===t?void 0:t.sid,o.status=null===t||void 0===t?void 0:t.status}c.prevMessageValue="",c.setState({isSendingMessage:!1,mediaURLs:[],uploadedImageFileNames:[],loader:!1,messages:a})},c.handleSendSMS=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,o,i,l,u,d,m,p,h,g,f,v,b,y,S,_,x,C,k,E;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.state.messageValue&&c.state.messageValue.length>0&&c.state.messageWithSwearWords&&c.state.acceptMessageWithSwearWords&&c.sendInvestigationMail(),i=c.state.messages[c.state.messages.length-1],c.prevMessageValue=c.state.messageValue,l=!(null===(a=c.state.messageValue)||void 0===a?void 0:a.length)&&c.state.mediaURLs.length,(null===(n=c.state.messageValue)||void 0===n||null===(o=n.trim())||void 0===o?void 0:o.length)||c.state.mediaURLs.length){e.next=6;break}return e.abrupt("return");case 6:if(c.state.messageValue!==(null===i||void 0===i?void 0:i.message)||l){e.next=9;break}return zt({message:"This message was blocked as it is the same as the last message you sent. We have this feature to avoid you accidentally spamming your contacts. You can add a reference ID or slightly tweak the message to make it unique."}),e.abrupt("return");case 9:return e.prev=9,f=new Date,v=ar(c.state.deliveryMethod.value,c.state.toNumber?[c.state.toNumber]:[]),b=c.props,y=b.currentUserName,S=b.currentUserId,_=b.currentRecordDetails,x=c.state.whoShouldBeNotified===re,C={author:x?y:(null===_||void 0===_?void 0:_.Owner).name||"owner",authorId:x?y:null===_||void 0===_||null===(u=_.Owner)||void 0===u||null===(d=u.id)||void 0===d?void 0:d.toString(),owner_id:x?S.toString():null===_||void 0===_||null===(m=_.Owner)||void 0===m||null===(p=m.id)||void 0===p?void 0:p.toString(),messageBody:c.state.messageValue},c.setState({loader:!0,isSendingMessage:!0,messages:[].concat(Object(w.a)(c.state.messages),[{id:"",author:C.authorId,sender_user_id:S.toString(),message:c.state.messageValue,from:c.state.fromNumber,to:v[0].value,ownerName:C.author,messageSource:"message-list",messageType:"outbound",timestamp:f.toISOString(),mmsContent:c.state.mediaURLs.map((function(e){return"<img src='".concat(e,"' />")})).join("\n"),status:"pending",errorMessage:"",owner_id:C.owner_id,entity_id:null===(h=c.state.toNumber)||void 0===h||null===(g=h.completeRecordData.Owner)||void 0===g?void 0:g.id.toString(),scheduledTimeToSend:"",senderName:y}]),mediaURLs:[],uploadedImageFileNames:[],hasScrolledToBottom:!1,messageValue:"",messageWithSwearWords:!1,acceptMessageWithSwearWords:!1},Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.focusMessageInput(""),e.next=3,ze(.3);case 3:c.scrollToBottomIfNeeded();case 4:case"end":return e.stop()}}),e)})))),k={sendImmediately:!0,sendType:"Send Now",fromNumber:c.state.fromNumberValue,fromNumbers:c.props.fromNumbers,toNumbers:v,templatedMessageText:C.messageBody,mediaUrls:c.state.mediaURLs,templateName:"",lookupFieldsForSMSMessagesModule:c.props.lookupFieldsForSMSMessagesModule,updateCampaignId:c.updateCampaignIdParameter,checkRecordMessageSentStatus:c.checkRecordMessageSentStatusParameter,lookupFieldsForCurrentEntity:c.state.lookupFieldsForCurrentEntity,whoShouldBeNotified:c.state.whoShouldBeNotified,createCampaign:!1,updateMessageSentStatus:c.updateMessageSentStatus,deliveryMethod:c.state.deliveryMethod.value,email:c.props.currentUserEmail,messageNamePrefix:"Outbound SMS for",module:c.props.moduleName,bypass_duplicate_check:t,shortenUrls:!1,customSlug:void 0,notifyUrlShorteningFailed:function(){return 0}},wr("messagelist-send",{numToNumbers:v.length,sendImmediately:!0,messageLength:C.messageBody.length}),e.next=20,Fr(k);case 20:e.next=28;break;case 22:if(e.prev=22,e.t0=e.catch(9),!(E=e.t0).message.includes("NO_PERMISSION")){e.next=27;break}return e.abrupt("return",lt());case 27:Oe()({title:"Error",text:"There was an error sending the SMS. Please check you are on the latest version of the extension by following the instructions here https://screencast-o-matic.com/watch/cYlXrp813O. If you are on the latest version, please follow the instructions in this video http://somup.com/cYjU1HXfMz and send the screenshots to team@smooth.tel ".concat(E.message," ").concat(E.stack),icon:"error"});case 28:case"end":return e.stop()}}),e,null,[[9,22]])})));return function(t){return e.apply(this,arguments)}}(),c.getMsgAfterInsertEmoji=function(e,t,a){var n=a;return"undefined"===typeof a&&(n=""),t.slice(0,e)+n+t.slice(e)},c.handleChosenEmoji=function(e){if(c.handleMessageInput.current){var t=c.handleMessageInput.current.value,a=c.getMsgAfterInsertEmoji(c.state.selectionIndex,t,e.native);c.setState({messageValue:a,selectionIndex:c.state.selectionIndex+e.native.length})}},c.handleInputClick=function(e){var t=0;c.handleMessageInput.current&&(t=c.handleMessageInput.current.selectionStart),c.setState({selectionIndex:t||e.currentTarget.selectionStart})},c.handleSendingToChange=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&(a=Object.values(t),n=La(c.props.currentRecordDetails,c.props.phoneNumberAPINames,a[0],c.props.phoneFields,!0),o=ar(c.state.deliveryMethod.value,n),c.setState({toNumber:o[0],sendingToValue:t},(function(){Kn(c.state.toNumber,a[0],c.props.moduleName)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.handleNotifyReplyChange=function(e){if(e){var t=e;c.setState({whoShouldBeNotified:t.value},(function(){ot("notifyOption",JSON.stringify(t))}))}},c.handleDeliveryMethodChange=function(e){e&&c.setState({deliveryMethod:e})},c.handleSearchField=function(e){var t=e.currentTarget.value;if(t){var a=Object(p.uniqBy)(Be(c.state.messages.filter((function(e){var a;return null===(a=e.message)||void 0===a?void 0:a.toLowerCase().includes(t.toLowerCase())}))),"id");c.messagesToRender=a,c.messagesMatched=a,c.setState({isSearching:!0},(function(){return c.goToSearchedItem()}))}else c.messagesToRender=c.state.messages,c.messagesMatched=[],c.searchIndex=0,c.setState({isSearching:!1});c.setState({textToHighlight:t})},c.handleSearchIcon=function(e){"up"===e?c.searchIndex-=1:"down"===e&&(c.searchIndex+=1),c.goToSearchedItem()},c.goToSearchedItem=function(){var e=c.messagesMatched[c.searchIndex],t=document.getElementById("message-list");if(c.messagesMatched.length>0&&(null===e||void 0===e?void 0:e.hasOwnProperty("id"))){var a=document.getElementById(e.id);c.setState({currentSearchId:e.id}),a&&t&&(t.scrollTop=a.offsetTop)}},c.handleChangedFromNumber=function(e){var t=e;t&&c.setState({fromNumber:t.value,fromNumberValue:t})},c.handleChangeFilterSender=function(e){var t=e;if(t){var a=Object(_.a)(Object(_.a)({},c.state.filters),{},{bySender:t});Qr(a),c.setState({filters:a})}},c.handleChangeFilterAuthor=function(e){var t=e;if(t){var a=Object(_.a)(Object(_.a)({},c.state.filters),{},{byAuthor:t});Qr(a),c.setState({filters:a})}},c.removeImage=function(e){var t=Object(w.a)(c.state.mediaURLs),a=Object(w.a)(c.state.uploadedImageFileNames);t.splice(e,1),a.splice(e,1),c.setState({mediaURLs:t,uploadedImageFileNames:a})},c.handleCloseConversation=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";c.props.handleCloseConversation&&c.props.handleCloseConversation(e,t)},c.messageContainer=null,c.onClickClearFilter=function(){Qr({bySender:null,byAuthor:null}),c.setState({filters:{bySender:null,byAuthor:null}})},c.toggleStartConversation=function(){c.setState({startConversation:!c.state.startConversation})},c.handleClickOptOut=Object(s.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={optedOut:!0,moduleName:c.props.moduleName,recordId:c.props.selectedConversation.recordId,crmOrganisationID:c.props.crmOrganisationID},e.next=3,Oe()("Are you sure you want to opt this person out? You will not be able to send them any more messages.",{buttons:["No","Yes"]});case 3:if(!e.sent){e.next=8;break}return e.next=7,Zn(t);case 7:c.handleCloseConversation(t.moduleName,t.recordId);case 8:case"end":return e.stop()}}),e)}))),c.handleReassignClick=function(e,t){var a,n;t&&(null===(a=(n=c.props).handleAfterReassign)||void 0===a||a.call(n,t));c.setState({showReassignModal:e})},c.handleCheckboxChangeForOutsideBusinessHours=function(){c.setState({isTimeCriticalMessage:!c.state.isTimeCriticalMessage})},c.handleShowMembers=function(){c.setState({showMembers:!c.state.showMembers})},c.handleImageUpload=function(e,t){c.setState({mediaURLs:e,uploadedImageFileNames:t})},c.renderMessageComposer=function(e){return"Accounts"===c.props.moduleName?g.a.createElement(d.a,{severity:"warning"},"This is a read only view of all messages sent to/received from contacts and deals linked to this account. To send a message, open a linked contact or deal."):c.optedOut?g.a.createElement(d.a,{severity:"error",style:{width:"100%"}},g.a.createElement(m.a,null,"This person has opted out of SMS communication with you."),"You won't be able to SMS them any more."):c.state.toNumber?g.a.createElement(ko,{mediaURLs:c.state.mediaURLs,uploadedImageFileNames:c.state.uploadedImageFileNames,handleImageUpload:c.handleImageUpload,removeImage:c.removeImage,isSendingDisabled:e,handleSendSMSonKeyDown:c.handleSendSMSonKeyDown,handleInputChange:c.handleInputChange,handleInputClick:c.handleInputClick,messageValue:c.state.messageValue,handleChosenEmoji:c.handleChosenEmoji,handleSendSMSonClick:c.handleSendSMSonClick,inputRef:c.handleMessageInput}):g.a.createElement(d.a,{severity:"error",style:{width:"100%"}},"This record doesn't have a phone number. Try to click on the record name to update or find it in your CRM")};var u=er(c.props.moduleName,!1,c.props.phoneNumberAPINames,c.props.toNumbers,c.props.currentRecordDetails,!0,c.props.phoneFields),h=Le(rt(Gr),"getFilterPreference",null),f=fa(),v=gs(e.fromNumbers);return c.optedOut=!!(null===(n=c.props.currentRecordDetails)||void 0===n?void 0:n.twiliosmsextension0__Twilio_SMS_Message_Opt_Out),c.state={fromNumber:(null===v||void 0===v?void 0:v.value)||(null===f||void 0===f?void 0:f.value)||(null===(o=e.fromNumbers[0])||void 0===o?void 0:o.value),fromNumberValue:v||f||e.fromNumbers[0],currentUserName:(null===v||void 0===v?void 0:v.name)||(null===f||void 0===f?void 0:f.name)||(null===(l=e.fromNumbers[0])||void 0===l?void 0:l.name),toNumber:e.toNumbers[0],loader:!1,messages:Be(c.props.messages),messageValue:"",hasScrolledToBottom:!1,useRapidAutoRefresh:!0,timeOfLastNewMessages:new Date,errorMessage:"",mediaURLs:[],uploadedImageFileNames:[],scrollPosition:0,isScrollingUp:!1,isSearching:!1,newMessage:!1,textToHighlight:"",currentSearchId:"",circularLoader:!1,sendingToValue:{value:"",label:""},isSendingMessage:!1,isDrawerOpen:!1,isFilterDrawerOpen:!1,filters:{bySender:(null===h||void 0===h?void 0:h.bySender)||null,byAuthor:(null===h||void 0===h?void 0:h.byAuthor)||null},alternateToNumbers:u,deliveryMethod:ce[0],startConversation:!1,acceptMessageWithSwearWords:!1,messageWithSwearWords:!1,whoShouldBeNotified:re,isTimeCriticalMessage:!1,showMembers:!1,members:[c.props.selectedConversation],recordUrl:"",lookupFieldsForCurrentEntity:[],isOneOnOneSMS:Ve(c.props.messages),getUniqueColor:kt(),selectionIndex:0,showReassignModal:!1},c}return Object(l.a)(a,[{key:"setNumberInitialValue",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,o,s,i,l,c,u,d,m,p,h,g,f,v,b,y,S,w=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(l=(null===t||void 0===t?void 0:t.messageType.toLocaleLowerCase().startsWith("out"))?null===t||void 0===t?void 0:t.to:null===t||void 0===t?void 0:t.from)&&l.match(/whatsapp:(\+)?\d+/g)&&(l=l.replace("whatsapp:","")),c=this.state.alternateToNumbers.map((function(e){var t=La(w.props.currentRecordDetails,w.props.phoneNumberAPINames,e.value,w.props.phoneFields,!0);return{defaultSendingToValue:e.value,selectedPhoneNumber:t}})),e.next=5,Yn();case 5:u=e.sent,d=u.country_code,m=c.find((function(e){var t;return null===e||void 0===e||null===(t=e.selectedPhoneNumber)||void 0===t?void 0:t.find((function(e){var t=null===e||void 0===e?void 0:e.value;return!(!Boolean(t)||!Boolean(d))&&(t=ye(t,d))===l}))})),p=(null===m||void 0===m?void 0:m.selectedPhoneNumber)||[],(h=(null===m||void 0===m?void 0:m.defaultSendingToValue)||"")||(h=this.props.currentRecordDetails.twiliosmsextension0__Number_to_Use_for_Twilio_Messages||this.props.currentRecordDetails.twiliosmsextension0__Number_Field_to_Use_for_Twilio_Messages||this.props.globalDefaultFieldToUse,p=La(this.props.currentRecordDetails,this.props.phoneNumberAPINames,h,this.props.phoneFields,!0)),(!h||h.toString().length<2||!p.length)&&(g=c.find((function(e){return null===e||void 0===e?void 0:e.selectedPhoneNumber.length}))||c[0],p=(null===g||void 0===g?void 0:g.selectedPhoneNumber)||[],h=(null===g||void 0===g?void 0:g.defaultSendingToValue)||""),v=fa(),(b=gs(this.props.fromNumbers))?f=b:v?f=v:((f=this.props.fromNumbers.find((function(e){return e.value===Hr((null===t||void 0===t?void 0:t.from)||"")})))||(f=this.getFromNumberFromInbound(this.props.messages)),f||(f=this.props.fromNumbers.find((function(e){return e.name.toLowerCase().includes("matched number")}))),f||(f=W(this.props.fromNumbers,p[0],this.props.defaultPhonePrefix))),y=this.state.alternateToNumbers.find((function(e){return e.value===h})),S=y||{value:h.toString(),label:"".concat(h.toString().replace(/_/g," ").replace("Contact Name.","Contact - ")," - ").concat(null===(a=p)||void 0===a||null===(n=a[0])||void 0===n?void 0:n.value)},this.setState({sendingToValue:S,toNumber:(null===(o=p)||void 0===o?void 0:o[0])||this.state.toNumber,fromNumber:(null===(s=f)||void 0===s?void 0:s.value)||(null===(i=this.props.fromNumbers[0])||void 0===i?void 0:i.value),fromNumberValue:f||this.props.fromNumbers[0]});case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(s.a)(r.a.mark((function e(){var t,a,n,o,s,i,l,c,u=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=document.getElementById("message-list"),(null===(t=this.props.currentRecordDetails)||void 0===t?void 0:t.id)&&(this.updateEmailToSMS(this.props.currentRecordDetails),this.getMessages(),this.initializePusher(),(null===(n=this.context)||void 0===n?void 0:n.triggerReload)?this.context.triggerReload().then((function(){u.handleRefresh()})):this.props.triggerReloadFromInbox&&this.handleRefresh()),this.optedOut&&this.setOptedOut((null===(o=this.props.currentRecordDetails)||void 0===o?void 0:o.id)||(null===(s=this.props.selectedConversation)||void 0===s?void 0:s.recordId)),a&&a.addEventListener("scroll",this.scrollListener),e.next=6,xa(this.props.moduleName);case 6:return i=e.sent,e.next=9,xn(null===i||void 0===i?void 0:i.fields);case 9:l=e.sent,c=Le(rt("notifyOption"),"notifyOption",null),this.setState({lookupFieldsForCurrentEntity:l,whoShouldBeNotified:(null===c||void 0===c?void 0:c.value)||re}),setTimeout((function(){var e=H.getChecklistInfo();u.setState({checkList:e},(function(){u.props.fromInboxView||H.hideHelpGuidesSidebar()}))}),1e3);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"scrollToBottomIfNeeded",value:function(){var e=document.getElementById("message-list");if(e){var t=e.scrollHeight||0,a=t-(e.scrollTop||0),n=!this.state.hasScrolledToBottom||a>500,r=document.getElementById("scroll-anchor");r&&(n&&!this.state.isScrollingUp&&!this.state.isSearching||this.state.newMessage)&&(e.scrollTop=r.offsetTop),t>100&&a<500&&this.setState({hasScrolledToBottom:!0})}}},{key:"componentWillUnmount",value:function(){var e=document.getElementById("message-list");e&&e.removeEventListener("scroll",this.scrollListener)}},{key:"getDeliveryMethod",value:function(e){var t,a=null===e||void 0===e||null===(t=e.from)||void 0===t?void 0:t.includes("whatsapp"),n=ce.filter((function(e){return a?e.value===de:e.value===ue}));return null===n||void 0===n?void 0:n[0]}},{key:"componentDidUpdate",value:function(){var e=Object(s.a)(r.a.mark((function e(t,a){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.messages!==this.state.messages&&(n=this.props.currentRecordDetails?this.props.currentRecordDetails.id:"",$e(n,this.state.messages),this.messagesToRender=this.state.messages,this.setState({loader:!1}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"renderMessages",value:function(){var e=this,t=g.a.createElement(ps,{key:"message-list",messagesToRender:this.messagesToRender,bySender:this.state.filters.bySender,byAuthor:this.state.filters.byAuthor,textToHighlight:this.state.textToHighlight,currentSearchId:this.state.currentSearchId,currentUserId:this.props.currentUserId.toString(),isOneOnOneSMS:this.state.isOneOnOneSMS,getUniqueColor:this.state.getUniqueColor});return!t&&this.isFilterEnabled()?g.a.createElement("div",null,g.a.createElement("p",{style:{fontWeight:700,fontSize:20,textAlign:"center"}},"All messages have been filtered out. Click the",g.a.createElement("i",{style:{color:"red",margin:"0 5px"},className:"".concat(this.props.classes.toolbarButton," ion-ios-funnel")})," ","icon to change the filter.")):[t,g.a.createElement("div",{key:"scroll-anchor",id:"scroll-anchor",style:{float:"left",clear:"both",marginTop:"10px"},ref:function(t){e.scrollAnchor=t}})]}},{key:"handleCheckboxChangeForSwearWords",value:function(){this.setState({acceptMessageWithSwearWords:!this.state.acceptMessageWithSwearWords})}},{key:"handleRefresh",value:function(){this.fetchNewMessages()}},{key:"render",value:function(){var e,t,a=this;if(this.state.errorMessage)return g.a.createElement("div",null,g.a.createElement("h1",null,this.state.errorMessage));var n=this.state.alternateToNumbers,r=n.map((function(e){return Object.values(e)[0].length})),o=this.props.fromNumbers.map((function(e){return e.name.length})),s=Math.max.apply(Math,r),i=Math.max.apply(Math,o),l=Math.max(s,i),c=null===(e=document.getElementById("toolbar"))||void 0===e?void 0:e.getBoundingClientRect().height,u=!!this.props.selectedConversation&&!this.props.selectedConversation.allowSendMessage,m=this.state.messageWithSwearWords&&!this.state.acceptMessageWithSwearWords,p="Accounts"!==this.props.moduleName&&Se(this.state.toNumber?[this.state.toNumber]:[],this.props.workingHoursSettingsFromBackend,this.state.fromNumberValue).length>0&&!this.state.isTimeCriticalMessage,h=u||m||p||!(this.state.messageValue.length||this.state.mediaURLs.length);return g.a.createElement("div",{id:"message-list",className:this.props.classes.container,style:{height:this.props.fromInboxView?"calc(100vh - 50px)":"100vh"}},this.props.teams.length>0&&g.a.createElement(lo,{open:this.state.showReassignModal,teams:this.props.teams,handleCloseModal:this.handleReassignClick,recordId:null===(t=this.props.selectedConversation)||void 0===t?void 0:t.recordId,userCurrentTeam:this.props.selectedTeam}),g.a.createElement("div",null,g.a.createElement("div",{className:this.props.classes.toolbarSenderName,style:{zIndex:1}},this.props.fromInboxView&&g.a.createElement(Wo,{optedOut:this.optedOut,recordUrl:this.state.recordUrl,selectedConversation:this.props.selectedConversation,handleReassignClick:this.handleReassignClick,handleClickOptOut:this.handleClickOptOut,handleCloseConversation:this.handleCloseConversation,teams:this.props.teams}),g.a.createElement("div",{id:"toolbar",className:this.props.classes.toolbar,style:this.state.isSearching?{zIndex:1}:{}},g.a.createElement(Uo,{handleSearchField:this.handleSearchField,isSearching:this.state.isSearching,searchIndex:this.searchIndex,messagesMatched:this.messagesMatched,handleSearchIcon:this.handleSearchIcon}),this.props.showUserGuiding&&this.state.checkList&&g.a.createElement("div",{className:"".concat(this.props.classes.toolbarIcon)},g.a.createElement("span",{onClick:H.launchChecklist,title:"Checklist progress"},g.a.createElement(K,{value:this.state.checkList.completedItems/this.state.checkList.items*100}))),this.state.toNumber&&g.a.createElement("div",{className:this.props.classes.toolbarIcon},g.a.createElement("a",{href:"tel:".concat(Hr(this.state.toNumber.value)),title:"tel:".concat(Hr(this.state.toNumber.value))},g.a.createElement("i",{className:"".concat(this.props.classes.toolbarButton," ion-ios-call")}))),g.a.createElement("div",{className:this.props.classes.toolbarIcon},g.a.createElement("span",{onClick:function(){return a.setState({isFilterDrawerOpen:!0})},title:this.isFilterEnabled()?"Your messages are filtered, click to change filter":"Filter messages"},g.a.createElement("i",{style:{color:this.isFilterEnabled()?"red":""},className:"".concat(this.props.classes.toolbarButton," ion-ios-funnel")}))),g.a.createElement("div",{className:this.props.classes.toolbarIcon},g.a.createElement("span",{onClick:function(){return a.handleRefresh()},title:"Refresh messages"},g.a.createElement("i",{className:"".concat(this.props.classes.toolbarButton," ion-ios-refresh")}))),this.state.isDrawerOpen?"":g.a.createElement("div",{className:this.props.classes.toolbarIcon},g.a.createElement("span",{onClick:function(){return a.setState({isDrawerOpen:!0})}},g.a.createElement("i",{className:"".concat(this.props.classes.toolbarButton," ion-ios-menu")}))))),g.a.createElement("div",null,g.a.createElement(jt,{loading:this.state.loader}),g.a.createElement(Ht,null)),g.a.createElement("div",{className:this.props.classes.messageListContainer,ref:function(e){a.messageContainer=e}},this.state.circularLoader?g.a.createElement("div",{className:this.props.classes.circularProgress},g.a.createElement(Pt,{loading:this.state.circularLoader})):this.state.isSearching?g.a.createElement("div",{style:{height:"80%",position:"relative",bottom:0}},this.renderMessages()):this.renderMessages()),g.a.createElement("div",{className:this.props.classes.compose,style:{width:this.props.fromInboxView?"74.19%":"99.19%"}},(this.state.messageValue.length>0||this.state.mediaURLs.length>0)&&!this.state.isTimeCriticalMessage&&this.state.toNumber&&g.a.createElement(ke,{fromNumber:this.state.fromNumberValue,workingHoursSettingsFromBackend:this.props.workingHoursSettingsFromBackend,toNumbers:[this.state.toNumber],multiple:!0,filterDuplicates:!0,onConfirmCritical:this.handleCheckboxChangeForOutsideBusinessHours,isSMSCritical:this.state.isTimeCriticalMessage,classes:this.props.classes}),this.state.messageWithSwearWords&&g.a.createElement(d.a,{severity:"warning"},"Are you sure you want to send this message? It seems to contain profanity words '",V.a.clean(this.state.messageValue),"' which is generally not appropriate in business communication. If you do send it, a copy of the message will be sent to the developer and if the message is deemed to be against the terms and conditions, your access to the extension will be disabled and your subscription cancelled.",g.a.createElement("div",{className:this.props.classes.checkboxContainer},g.a.createElement(x.a,{control:g.a.createElement(C.a,{checked:this.state.acceptMessageWithSwearWords,onChange:function(e){return a.handleCheckboxChangeForSwearWords()},name:"termsCheckbox",color:"primary",size:"small",inputProps:{"data-test-id":"profanityCheckbox"}}),label:g.a.createElement("p",{className:this.props.classes.checkboxLabel},"Please confirm you want to send this message.")}))),this.renderMessageComposer(h)),g.a.createElement(Io,{open:this.state.isDrawerOpen,onClose:function(){return a.setState({isDrawerOpen:!1})},title:"",style:{height:"".concat(c,"px")},sendingToDropdownWidth:l},g.a.createElement(Mo,{fromNumbers:this.props.fromNumbers,fromNumberValue:this.state.fromNumberValue,handleChangedFromNumber:this.handleChangedFromNumber,alternateToNumbers:n,handleSendingToChange:this.handleSendingToChange,sendingToValue:this.state.sendingToValue,deliveryMethod:this.state.deliveryMethod,handleDeliveryMethodChange:this.handleDeliveryMethodChange,whoShouldBeNotified:this.state.whoShouldBeNotified,handleNotifyReplyChange:this.handleNotifyReplyChange})),g.a.createElement(Io,{open:this.state.isFilterDrawerOpen,onClose:function(){return a.setState({isFilterDrawerOpen:!1})},title:"Filter",style:{height:"".concat(c,"px")},sendingToDropdownWidth:l},g.a.createElement(Po,{fromNumbers:this.props.fromNumbers,bySender:this.state.filters.bySender,handleChangeFilterSender:this.handleChangeFilterSender,ownerArray:this.props.ownerArray,byAuthor:this.state.filters.byAuthor,handleChangeFilterAuthor:this.handleChangeFilterAuthor,onClickClearFilter:this.onClickClearFilter})),g.a.createElement(k.a,{variant:"persistent",anchor:"left",open:this.state.showMembers,classes:{paper:this.props.classes.drawer}},g.a.createElement("div",{style:{height:"".concat(c,"px"),justifyContent:"space-between"},className:this.props.classes.drawerHeader},g.a.createElement("h2",null,"Members"),g.a.createElement("div",null,g.a.createElement(E.a,null,g.a.createElement(D.a,null)),g.a.createElement(E.a,{onClick:this.handleShowMembers},g.a.createElement(R.a,null)))),g.a.createElement(T.a,null),g.a.createElement("div",{className:this.props.classes.drawerContainer},g.a.createElement("div",{style:{width:"".concat(8*l+60,"px")}},g.a.createElement(N.a,{component:"nav","aria-label":"secondary mailbox folders"},this.state.members.map((function(e){return g.a.createElement(I.a,{key:e.recordId},g.a.createElement(O.a,{className:a.props.classes.avatar},g.a.createElement(Ot,{name:e.name,id:e.recordId,size:36,currentUserId:a.props.currentUserId.toString(),getUniqueColor:a.state.getUniqueColor})),g.a.createElement(M.a,{primary:e.name}),g.a.createElement(P.a,null,g.a.createElement(E.a,{edge:"end","aria-label":"delete"},g.a.createElement(U.a,null))))}))))))))}}]),a}(h.Component);fs.contextType=Zr;var vs=Object(S.a)((function(){return{container:{overflow:"scroll",height:"100vh",zIndex:-1},messageListContainer:{padding:10,paddingBottom:80},toolbarSenderName:{position:"sticky",top:0,background:"white",paddingTop:"5px"},toolbar:{padding:5,display:"flex",alignItems:"center",justifyContent:"flex-end",fontWeight:500,borderBottom:"1px solid #eeeef1",border:"none",backgroundColor:"rgba(255, 255, 255, 0.8)",backdropFilter:"blur(20px)"},compose:{padding:10,display:"flex",flexWrap:"wrap",alignItems:"center",background:"white",borderTop:"1px solid #eeeef1",position:"fixed",width:"100%",bottom:0,border:"none",backgroundColor:"rgba(255, 255, 255, 0.8)",backdropFilter:"blur(20px)"},toolbarIcon:{flexDirection:"row-reverse",marginRight:10,padding:5,display:"flex",cursor:"pointer"},toolbarButton:{color:"#007aff",fontSize:28,transition:"all 0.1s",margin:0,"&:hover":{cursor:"pointer",color:"#0063ce"},"&:active":{color:"#007aff",opacity:.25}},circularProgress:{position:"fixed",bottom:"1rem"},drawer:{minWidth:"25%"},drawerHeader:{display:"flex",alignItems:"center",justifyContent:"flex-start",paddingLeft:"10px"},drawerContainer:{padding:"10px"},closeConversation:{margin:"10px",display:"flex",justifyContent:"flex-end"},avatar:{width:36,height:36},checkboxLabel:{margin:0}}}))(fs),bs=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e,t,a,n,r,o=null===(e=this.props.currentRecordDetails)||void 0===e?void 0:e.Owner,s={createdTime:null===(t=this.props.currentRecordDetails)||void 0===t?void 0:t.last_time_they_sent_us_a_message,name:null===(a=this.props.currentRecordDetails)||void 0===a?void 0:a.Full_Name,moduleName:null===(n=this.props.currentRecordDetails)||void 0===n?void 0:n.entity,recordId:null===(r=this.props.currentRecordDetails)||void 0===r?void 0:r.id,ownerId:null===o||void 0===o?void 0:o.id.toString(),allowSendMessage:!0};return h.createElement("div",{className:this.props.classes.messenger},h.createElement("div",{id:"message-wrapper",className:this.props.classes.content},h.createElement(vs,{fromNumbers:this.props.fromNumbers,toNumbers:this.props.toNumbers,messages:this.props.messages,currentRecordDetails:this.props.currentRecordDetails,moduleName:this.props.moduleName,globalDefaultFieldToUse:this.props.globalDefaultFieldToUse,crmOrganisationID:this.props.crmOrganisationID,phoneNumberAPINames:this.props.phoneNumberAPINames,currentUserName:this.props.currentUserName,currentUserId:this.props.currentUserId,ownerArray:this.props.ownerArray,defaultPhonePrefix:this.props.defaultPhonePrefix,showUserGuiding:!0,selectedConversation:s,fromInboxView:!1,lookupFieldsForSMSMessagesModule:this.props.lookupFieldsForSMSMessagesModule,phoneFields:this.props.phoneFields,currentUserEmail:this.props.currentUserEmail,workingHoursSettingsFromBackend:this.props.workingHoursSettingsFromBackend,teams:[]})))}}]),a}(h.Component),ys=Object(S.a)((function(){return{messenger:{display:"grid",width:"100%",height:"100vh",background:"#eeeef1"},content:{position:"relative",background:"white"}}}))(bs),Ss="userSelectedId",ws="userSelectedFullName",_s="teamSelectedId",xs="sortFromLatestToOldest",Cs=function(e,t){ot(e,t)},ks=function(e){return rt(e)||""},Es=function(e){Cs(Ss,e)},Ts=function(){return ks(Ss)},Ns=function(e){Cs(_s,e)},Is=function(){return ks(_s)},Os=function(){return"true"===ks(xs)},Ms=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!a)return{currentFilterTeamId:"",currentFilterUserId:t};var n=Ts(),r=Is();if("noTeam"===r){var o=n||t;return{currentFilterTeamId:r,currentFilterUserId:o}}var s=e.find((function(e){return e.teamId===r}));if(s){Ns(s.teamId);var i=s.members.find((function(e){return e.userId===n}));if(i)return Es(i.userId),{currentFilterTeamId:s.teamId,currentFilterUserId:i.userId};var l=s.members.some((function(e){return e.userId===t})),c=l?t:"all";return Es(c),{currentFilterTeamId:s.teamId,currentFilterUserId:c}}var u=e[0];if(!u){var d=n||t;return Es(d),{currentFilterTeamId:"",currentFilterUserId:d}}var m=u.members.some((function(e){return e.userId===n}));if(m)return Ns(u.teamId),{currentFilterTeamId:u.teamId,currentFilterUserId:n};var p=u.members.some((function(e){return e.userId===t})),h=p?t:"all";return Ns(u.teamId),Es(h),{currentFilterTeamId:u.teamId,currentFilterUserId:h}},Ps=a(1081),As=a(1082),Ds=a(551),js=(a(775),a(552)),Rs=a.n(js),Fs=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleSelectConversation=function(t){t.recordId===e.props.currentConversationId&&e.props.conversations.length>1||e.props.selectConversation(t)},e}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return h.createElement("div",{className:"conversation-list-container"},h.createElement("div",{className:"toggle-container"},h.createElement("div",null,h.createElement(Ps.a,{variant:"contained","aria-label":"outlined primary button group"},h.createElement(eo.a,{color:this.props.showRecordsWhoDidNotReplyToUs?"default":"primary",onClick:function(){return e.props.handleConversationListToggle(!1)}},"Needs Reply"),h.createElement(eo.a,{color:this.props.showRecordsWhoDidNotReplyToUs?"primary":"default",onClick:function(){return e.props.handleConversationListToggle(!0)}},"Follow Up"))),h.createElement(x.a,{control:h.createElement(E.a,{"aria-label":"delete",color:this.props.sortFromLatestToOldest?"primary":"default",onClick:function(){return e.props.handleSortOrderToggle(!e.props.sortFromLatestToOldest)}},h.createElement(Ds.a,null)),label:h.createElement(G.a,{component:"div",fontSize:13},this.props.sortFromLatestToOldest?"Latest to Oldest":"Oldest to Latest")})),this.props.isOwnerFilterEnabled&&h.createElement(h.Fragment,null,this.props.teamData.length>0&&h.createElement("div",{className:"select-container"},h.createElement(to.a,{value:this.props.selectedTeam,options:this.props.teamData,getOptionLabel:function(e){return e.teamName},getOptionValue:function(e){return e.teamId},placeholder:"Select Team",onChange:this.props.handleChangeTeam})),h.createElement("div",{className:"select-container"},h.createElement(to.a,{value:this.props.selectedActiveUser,options:this.props.activeUsers,getOptionLabel:function(e){return e.full_name},getOptionValue:function(e){return e.id},placeholder:"Select User",onChange:this.props.handleActiveUserChange}))),h.createElement("div",{className:"conversation-list"},this.props.conversations?this.props.conversations.map((function(t){var a=new Date(t.createdTime),n=Number.isNaN(a.valueOf())?"":a.toLocaleDateString(),r=["".concat(t.name," (").concat(t.moduleName,")"),"".concat(e.props.unavailableModules.includes(t.moduleName)?h.createElement("span",{className:"error-info"},"- module deactivated"):"")].join(" ");return h.createElement("div",{key:"".concat(t.recordId),className:Qo()("conversation-list-item",{active:t.recordId===e.props.currentConversationId}),onClick:function(){return e.handleSelectConversation(t)},title:r},h.createElement("div",{className:"conversation-info"},h.createElement("h1",{className:"conversation-title"},r),h.createElement("p",{className:"conversation-snippet"},n)),t.isNewArrival&&h.createElement("div",{title:"New unread messages",style:{flex:1}},h.createElement(As.a,{color:"secondary",badgeContent:"New"},h.createElement(Rs.a,{fontSize:"small"}))))})):""))}}]),a}(h.Component),Us=a(1083),Ls=a(1086),Vs=a(1085),Bs=a(1084),qs=a(553),Ws=a.n(qs),zs=function(e,t){return t.map((function(t){return"".concat(t," like '%").concat(e,"%'")})).join(" or ")},Hs=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,o,s,i,l,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=["First_Name","Last_Name"],n=["Mobile","Phone"],s=[],i="select ".concat((o=["Owner","Full_Name","twiliosmsextension0__Last_Time_They_Replied_To_Twilio_Message"]).join(", "),", ").concat([].concat(a,n).join(", ")," from Contacts where (").concat(zs(t,a),") or (").concat(zs(t,n),")"),e.next=7,qn(i,0,[]);case 7:return l=e.sent,s.push.apply(s,Object(w.a)(l.map((function(e){return{createdTime:e.twiliosmsextension0__Last_Time_They_Replied_To_Twilio_Message,moduleName:"Contacts",name:e.Full_Name,recordId:e.id,ownerId:e.Owner.id}})))),i="select ".concat(o.join(", "),", ").concat([].concat(a,n).join(", ")," from Leads where (").concat(zs(t,a),") or (").concat(zs(t,n),")"),e.next=12,qn(i,0,[]);case 12:return c=e.sent,s.push.apply(s,Object(w.a)(c.map((function(e){return{createdTime:e.twiliosmsextension0__Last_Time_They_Replied_To_Twilio_Message,moduleName:"Leads",name:e.Full_Name,recordId:e.id,ownerId:e.Owner.id}})))),e.abrupt("return",s);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ys=function(){var e=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yt().get('api/v1/get_matching_contacts/?numbers=["%'.concat(t,'%"]')).catch((function(){return{data:[]}}));case 2:if(a=e.sent,!Array.isArray(null===a||void 0===a?void 0:a.data)){e.next=5;break}return e.abrupt("return",a.data);case 5:return e.abrupt("return",[]);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function Gs(e){return Qs.apply(this,arguments)}function Qs(){return(Qs=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],e.next=3,Ys(t);case 3:if((a=e.sent).length){e.next=8;break}return e.next=7,Hs(t);case 7:a=e.sent;case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Js(e){return Ks.apply(this,arguments)}function Ks(){return(Ks=Object(s.a)(r.a.mark((function e(t){var a,n,o,s=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>1&&void 0!==s[1]?s[1]:"Contacts",n=Object(_.a)({},t),e.next=4,ht.a.CRM.API.insertRecord({Entity:a,APIData:n,Trigger:["workflow"]});case 4:return o=e.sent,e.abrupt("return",null===o||void 0===o?void 0:o.data);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Zs=/[a-zA-Z]+/g,Xs=Object(Ct.a)((function(e){return{dialogContainer:{width:"100%"},title:{display:"flex",justifyContent:"space-between",alignItems:"center",fontWeight:"bold",paddingBottom:e.spacing(0)},menuList:{maxHeight:200,overflowY:"auto"}}})),$s=function(e){var t=Xs(),a=Object(h.useState)(""),n=Object(o.a)(a,2),i=n[0],l=n[1],c=Object(h.useState)(!1),u=Object(o.a)(c,2),d=u[0],m=u[1],p=Object(h.useState)(!1),f=Object(o.a)(p,2),v=f[0],b=f[1],y=Object(h.useState)([]),S=Object(o.a)(y,2),w=S[0],x=S[1],C=Object(h.useState)(!1),k=Object(o.a)(C,2),T=k[0],N=k[1],I=Object(h.useState)(""),O=Object(o.a)(I,2),M=O[0],P=O[1],A=Object(h.useState)(""),D=Object(o.a)(A,2),j=D[0],R=D[1],F=function(){var e=Object(s.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.trim()){e.next=2;break}return e.abrupt("return");case 2:return b(!0),e.next=5,Gs(i.trim().replace(/[^+a-zA-Z0-9]/g,""));case 5:(t=e.sent).length?x(t):m(!0),b(!1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),U=function(t){e.selectConversation&&e.selectConversation(Object(_.a)(Object(_.a)({},t),{},{allowSendMessage:!0}))},L=function(){var t=Object(s.a)(r.a.mark((function t(){var a,n,o,s,l;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Js({Phone:i.trim(),Last_Name:j,First_Name:M,id:""},e.moduleName);case 2:n=t.sent,o=null===n||void 0===n||null===(a=n[0])||void 0===a?void 0:a.details.id,s=!0,(l=i.trim().match(Zs))&&l.length>0&&(s=!1),U({name:i.trim(),createdTime:(new Date).toDateString(),moduleName:e.moduleName,ownerId:e.currentUserId.toString(),recordId:o,allowSendMessage:s});case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return g.a.createElement(Us.a,{open:e.open,"aria-labelledby":"form-dialog-title",fullWidth:!0},g.a.createElement(Bs.a,{id:"form-dialog-title",className:t.title,disableTypography:!0},"Start a new conversation",g.a.createElement(E.a,{onClick:function(){e.handleClose()}},g.a.createElement(qt.a,null))),g.a.createElement(Vs.a,null,g.a.createElement(Ao.a,{container:!0,spacing:2,alignItems:"flex-end"},g.a.createElement(Ao.a,{item:!0,xs:10},g.a.createElement(Do.a,{autoFocus:!0,margin:"dense",label:"Contact Name or Phone Number",type:"text",fullWidth:!0,value:i,onChange:function(e){l(e.target.value),d&&m(!d),w.length&&x([]),T&&N(!1)},onKeyUp:function(e){e.preventDefault(),i.trim()&&"Enter"===e.key&&F()}})),g.a.createElement(Ao.a,{item:!0},v?g.a.createElement(Q.a,{size:25}):g.a.createElement(E.a,{onClick:F,disabled:!i.trim()},g.a.createElement(Ws.a,null)))),w.length>0?g.a.createElement(Xo.a,{className:t.menuList},w.map((function(e){return g.a.createElement($o.a,{key:e.recordId,onClick:function(){return U(e)}},e.name)}))):null,d&&g.a.createElement(g.a.Fragment,null,g.a.createElement(G.a,{mt:1,px:1},"No Records Found."),g.a.createElement(G.a,{mt:1},g.a.createElement(eo.a,{onClick:function(){m(!1),N(!0)}},"Create a new Record"))),T&&g.a.createElement(Ao.a,{container:!0,spacing:2,alignItems:"flex-end"},g.a.createElement(Ao.a,{item:!0,xs:6},g.a.createElement(Do.a,{autoFocus:!0,margin:"dense",label:"First Name",type:"text",fullWidth:!0,value:M,onChange:function(e){return P(e.target.value)}})),g.a.createElement(Ao.a,{item:!0,xs:6},g.a.createElement(Do.a,{margin:"dense",label:"Last Name",type:"text",fullWidth:!0,value:j,onChange:function(e){return R(e.target.value)}})),g.a.createElement(Ao.a,{item:!0},g.a.createElement(eo.a,{onClick:L},"Create")))),g.a.createElement(Ls.a,null))},ei=a(305),ti=a.n(ei),ai=a(564),ni=a.n(ai),ri=a(1111),oi=a(1098),si=a(1123),ii=a(1087),li=a(1115),ci=a(240),ui=a(1107),di=(a(433),a(1106)),mi=a(1105),pi=a(1110),hi=a(581),gi=a(203),fi=a(1125),vi=function(e){return he.test(e)},bi=function(e){var t=Number.parseFloat(e);return!Number.isNaN(t)},yi=function(e){return/^[0-9]+$/.test(e)},Si=function(e){return vi(e)?e.replace(he,""):e},wi=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).input=void 0,e.editInput=void 0,e.state={inputVisible:!1,inputValue:"",editInputIndex:-1,editInputValue:"",error:""},e.handleClose=function(t){var a=e.props.tags.filter((function(e){return e!==t}));e.props.handleTagChange(a)},e.showInput=function(){e.setState({inputVisible:!0},(function(){return e.input.focus()}))},e.handleValidateField=function(t){if(!t)return e.setState({error:""}),e.props.updateHasErrorStatus(Object($t.a)({},e.props.rowIndex,!1)),!0;var a=e.props.dataType;return"integer"===a&&!yi(t)||"currency"===a&&!bi(t)?(e.setState({inputValue:t,editInputValue:t,error:"Please enter a valid number"}),e.props.updateHasErrorStatus(Object($t.a)({},e.props.rowIndex,!0)),!1):vi(t)?(e.setState({inputValue:t,editInputValue:t,error:"Special characters are not supported by Zoho CRM search"}),e.props.updateHasErrorStatus(Object($t.a)({},e.props.rowIndex,!0)),!1):(e.props.updateHasErrorStatus(Object($t.a)({},e.props.rowIndex,!1)),!0)},e.handleInputChange=function(t){e.handleValidateField(t.target.value)&&e.setState({inputValue:t.target.value,editInputValue:"",error:""})},e.handleInputConfirm=function(){var t=e.state.inputValue,a=Si(t),n=e.props.tags;a&&-1===n.indexOf(a)&&(n=[].concat(Object(w.a)(n),[a])),e.setState({inputVisible:!1,inputValue:""}),e.props.handleTagChange(n)},e.handleEditInputChange=function(t){e.handleValidateField(t.target.value)&&e.setState({editInputValue:t.target.value,inputValue:"",error:""})},e.handleEditInputConfirm=function(){var t=e.state,a=t.editInputIndex,n=t.editInputValue,r=Si(n),o=Object(w.a)(e.props.tags);o[a]=r,e.props.handleTagChange(o),e.setState({editInputIndex:-1,editInputValue:""})},e.handleBlurInput=function(t){e.state.error?t.preventDefault():e.handleInputConfirm()},e.handleBlurEditInput=function(t){e.state.error?t.preventDefault():e.handleEditInputConfirm()},e.saveInputRef=function(t){e.input=t},e.saveEditInputRef=function(t){e.editInput=t},e}return Object(l.a)(a,[{key:"render",value:function(){var e=this,t=this.state,a=t.inputVisible,n=t.inputValue,r=t.editInputIndex,o=t.editInputValue,s=this.props.tags;return g.a.createElement(g.a.Fragment,null,s.map((function(t,a){if(r===a)return g.a.createElement(h.Fragment,{key:t},g.a.createElement(pi.a,{ref:e.saveEditInputRef,size:"small",className:"tag-input",value:o,onChange:e.handleEditInputChange,onBlur:e.handleBlurEditInput,onPressEnter:e.handleBlurEditInput,disabled:!e.props.hasError&&!!e.state.error}),e.state.error&&g.a.createElement("span",{style:{color:"red",fontSize:"12px"}},e.state.error));var n=t.length>20,s=g.a.createElement(hi.a,{className:"edit-tag",key:t,closable:!0,onClose:function(){return e.handleClose(t)}},g.a.createElement("span",{onDoubleClick:function(n){e.state.error||e.props.hasError||e.setState({editInputIndex:a,editInputValue:t},(function(){e.editInput.focus()})),n.preventDefault()}},n?"".concat(t.slice(0,20),"..."):t));return n?g.a.createElement(gi.a,{title:t,key:t},s):s})),a&&g.a.createElement(g.a.Fragment,null,g.a.createElement(pi.a,{ref:this.saveInputRef,type:"text",size:"small",className:"tag-input",value:n,onChange:this.handleInputChange,onBlur:this.handleBlurInput,onPressEnter:this.handleBlurInput,disabled:!this.props.hasError&&!!this.state.error}),this.state.error&&g.a.createElement("span",{style:{color:"red",fontSize:"12px"}},this.state.error)),!a&&!this.props.disabledAddNew&&(!this.state.error||!this.props.hasError)&&(this.props.allowMultiple||0===s.length)&&g.a.createElement(hi.a,{className:"site-tag-plus",onClick:this.showInput},g.a.createElement(fi.a,null)," New Value"))}}]),a}(g.a.Component),_i={text:[{label:"Not Equal",value:"!="},{label:"Equals",value:"="},{label:"Contains",value:"like"},{label:"Does not Contain",value:"not like"}],lookup:[{label:"Not Equal",value:"!="},{label:"Equals",value:"="}],boolean:[{label:"Equals",value:"="}],others:[{label:"Not Equal",value:"!="},{label:"Equals",value:"="},{label:"Greater than or Equal",value:">="},{label:"Greater than",value:">"},{label:"Less than or Equal",value:"<="},{label:"Less than",value:"<"}]};_i.phone=_i.text,_i.email=_i.text,_i.website=_i.text,_i.picklist=_i.text,_i.multiselectpicklist=_i.text;var xi=_i,Ci=[{label:"True",value:!0},{label:"False",value:!1}],ki=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).isValidFilter=function(e){return n.getFiltersWithFullData(e).length>0},n.updateHasErrorStatus=function(e){n.setState({hasError:Object(_.a)(Object(_.a)({},n.state.hasError),e)})},n.state={selectedApiNameFields:[],conditionState:"",hasError:{}},n}return Object(l.a)(a,[{key:"handleAddFilter",value:function(){this.props.addFilters([].concat(Object(w.a)(this.props.filters),[{key:this.props.filters.length}]))}},{key:"editFilterTable",value:function(e,t,a){var n=this.props.filters.map((function(n){return n.key===e?("field"===t&&(n.comparisonType=null,n.value=null),n[t]=a,n):n}));if("comparisonType"!==t){var r=function(e){var t=0,a=0;return e.forEach((function(e){var n,r=(null===e||void 0===e||null===(n=e.value)||void 0===n?void 0:n.length)||0;r>1&&(a+=r-1),r&&(t+=1)})),(t=t>0?t-1:t)+a}(n);if(25===r?this.setState({conditionState:"MAX"}):r<25&&this.setState({conditionState:""}),r>25)return void this.setState({conditionState:"EXCEED"})}if(this.props.addFilters(n),"field"===t&&a.api_name){var o=Object(w.a)(this.state.selectedApiNameFields);this.state.selectedApiNameFields[e]?o[e]=a.api_name:o.push(a.api_name),this.setState({selectedApiNameFields:o})}}},{key:"getFiltersWithFullData",value:function(e){return e.filter((function(e){var t;return!!(null===e||void 0===e?void 0:e.field)&&!!(null===e||void 0===e?void 0:e.comparisonType)&&!!(null===e||void 0===e?void 0:e.value)&&!!(null===e||void 0===e||null===(t=e.value)||void 0===t?void 0:t.length)}))}},{key:"deleteFilter",value:function(e){var t=Sa()(this.props.filters,(function(t){return t.key!==e})),a=Object(o.a)(t,2),n=a[0],r=Object(o.a)(a[1],1)[0],s=this.getFiltersWithFullData(n);s=s.map((function(e,t){return Object(_.a)(Object(_.a)({},e),{},{key:t})})),this.props.addFilters(s);var i=Object(_.a)({},this.state.hasError);delete i[e];var l=Object(w.a)(this.state.selectedApiNameFields);l.splice(e,1),this.setState({selectedApiNameFields:l,conditionState:"",hasError:i});var c=Object.values(i).filter((function(e){return e})).length>0,u=this.props.filters.length-1;r&&!this.isValidFilter([r])?u!==e&&s.length&&!c&&this.props.searchRecords(this.props.selectedModule,s):s.length&&!c&&this.props.searchRecords(this.props.selectedModule,s)}},{key:"render",value:function(){var e=this,t=[{title:"Field Name",dataIndex:"field.api_name",editable:!0,width:"30%",render:function(t,a,n){var r=e.props.fields.filter((function(e){var t;return"textarea"!==e.data_type&&"profileimage"!==e.data_type&&"jsonarray"!==e.json_type&&!(null===(t=Object.keys(e.multiselectlookup))||void 0===t?void 0:t.length)&&!e.subform}));return g.a.createElement(to.a,{style:{width:200},placeholder:"Field Name",value:a.field,options:r.filter((function(t){return!e.state.selectedApiNameFields.includes(t.api_name)})),getOptionLabel:function(e){return e.field_label},getOptionValue:function(e){return e.api_name},onChange:function(t){return e.editFilterTable(n,"field",t)},isDisabled:e.state.hasError[n]})}},{title:"Comparison Type",dataIndex:"comparisonType",editable:!0,width:"30%",render:function(t,a,n){var r,o,s,i=null===a||void 0===a||null===(r=a.field)||void 0===r?void 0:r.data_type;return(null===(o=i)||void 0===o?void 0:o.includes("lookup"))&&(i="lookup"),g.a.createElement(to.a,{style:{width:200},options:null!==(s=xi[i])&&void 0!==s?s:xi.others,value:a.comparisonType,placeholder:"Comparison Type",onChange:function(t){return e.editFilterTable(n,"comparisonType",t)},isDisabled:e.state.hasError[n]})}},{title:"Value",dataIndex:"value",width:"30%",editable:!0,render:function(t,a,n){var r,o,s,i,l;if("ownerlookup"===(null===(r=a.field)||void 0===r?void 0:r.data_type)){var c,u=null===a||void 0===a||null===(c=a.value)||void 0===c?void 0:c[0];return g.a.createElement(to.a,{value:u?u.id:null,placeholder:"",options:e.props.activeUsers,onChange:function(t){return e.editFilterTable(n,"value",[t.id])},getOptionLabel:function(e){return e.full_name},getOptionValue:function(e){return e.id},disabled:e.state.hasError[n]})}if("boolean"===(null===(o=a.field)||void 0===o?void 0:o.data_type))return g.a.createElement(to.a,{placeholder:"",value:Ci.filter((function(e){var t;return e.value===(null===(t=a.value)||void 0===t?void 0:t[0])})),options:Ci,onChange:function(t){return e.editFilterTable(n,"value",[null===t||void 0===t?void 0:t.value])},disabled:e.state.hasError[n]});if(null===(s=a.field)||void 0===s?void 0:s.data_type.includes("date")){var d,m,p="date"===(null===(d=a.field)||void 0===d?void 0:d.data_type),h=null===a||void 0===a||null===(m=a.value)||void 0===m?void 0:m[0];return g.a.createElement(di.a,{value:h?X()(h):null,onChange:function(t){return e.editFilterTable(n,"value",[p?null===t||void 0===t?void 0:t.format("YYYY-MM-DD"):null===t||void 0===t?void 0:t.format()])},disabled:e.state.hasError[n]})}return g.a.createElement(wi,{tags:null!==(i=a.value)&&void 0!==i?i:[],allowMultiple:!0,handleTagChange:function(t){return e.editFilterTable(n,"value",t)},dataType:null===(l=a.field)||void 0===l?void 0:l.data_type,disabledAddNew:!!e.state.conditionState,rowIndex:n,updateHasErrorStatus:e.updateHasErrorStatus,hasError:e.state.hasError[n]})}},{dataIndex:"remove",width:"5%",render:function(t,a,n){return g.a.createElement(E.a,{"aria-label":"delete",onClick:function(){return e.deleteFilter(n)},disabled:Object.values(e.state.hasError).some((function(e){return e}))},g.a.createElement(U.a,null))}}],a=this.props,n=a.filters,r=a.isSearchingRecords,o=a.searchRecords,s=a.selectedModule,i=n.reduce((function(e,t){var a;return e&&!!t.field&&!!t.comparisonType&&!!t.value&&!!(null===(a=t.value)||void 0===a?void 0:a.length)}),!!n.length),l=n.length?n[n.length-1]:null,c=!l||this.isValidFilter([l]),u="MAX"===this.state.conditionState,m="EXCEED"===this.state.conditionState,p=Object.values(this.state.hasError).filter((function(e){return e})).length>0;return g.a.createElement("div",null,g.a.createElement(eo.a,{variant:"outlined",color:"primary",size:"small",onClick:function(){return e.handleAddFilter()},style:{marginBottom:"5px"},disabled:!c||u||m||p},"Add Filter"),g.a.createElement(mi.a,{size:"small",dataSource:n,columns:t,pagination:!1}),"EXCEED"===this.state.conditionState&&g.a.createElement(d.a,{severity:"warning",style:{margin:" 0.2rem"}},"You've chosen too many filter conditions. The Zoho APIs restrict you to a maximum of 25 possible options when searching. Please remove some in order to unblock search."),"MAX"===this.state.conditionState&&g.a.createElement(d.a,{severity:"warning",style:{margin:" 0.2rem"}},"Hey ho! You've just reached your last filter condition. The Zoho APIs have a cap of 25 filter conditions per search and you've hit that limit now. If you need to add more conditions, you'll need to remove some from other rows first."),g.a.createElement(eo.a,{variant:r?"text":"contained",color:"primary",size:"small",disabled:r||!i||m||p,onClick:function(){return o(s,n)},style:{marginTop:"5px"}},r?"Searching...":"Search"))}}]),a}(g.a.Component),Ei=a(559),Ti=a(90);function Ni(e){var t=e.columns,a=e.scroll,n=Object(h.useState)(0),r=Object(o.a)(n,2),s=r[0],i=r[1],l=t.filter((function(e){return!e.width})).length,c=t.map((function(e){return e.width?e:Object(_.a)(Object(_.a)({},e),{},{width:Math.floor(s/l)})})),u=Object(h.useRef)(),d=Object(h.useState)((function(){var e={};return Object.defineProperty(e,"scrollLeft",{get:function(){return null},set:function(e){u.current&&u.current.scrollTo({scrollLeft:e})}}),e})),m=Object(o.a)(d,1)[0],p=function(){u.current.resetAfterIndices({columnIndex:0,shouldForceUpdate:!1})};Object(h.useEffect)((function(){return p}),[s]);return g.a.createElement(Ti.a,{onResize:function(e){var t=e.width;i(t)}},g.a.createElement(mi.a,Object.assign({},e,{size:"small",className:"virtual-table",columns:c,pagination:{defaultPageSize:50},components:{body:function(e,t){var n=t.scrollbarSize,r=t.ref,o=t.onScroll;r.current=m;var i=54*e.length;return g.a.createElement(Ei.a,{ref:u,className:"virtual-grid",columnCount:c.length,columnWidth:function(e){var t=c[e].width;return i>a.y&&e===c.length-1?t-n-1:t},height:a.y,rowCount:e.length,rowHeight:function(){return 54},width:s,onScroll:function(e){var t=e.scrollLeft;o({scrollLeft:t})}},(function(t){var a=t.columnIndex,n=t.rowIndex,r=t.style;return g.a.createElement("div",{className:Qo()("virtual-table-cell",{"virtual-table-cell-last":a===c.length-1}),style:Object(_.a)(Object(_.a)({},r),{},{paddingLeft:"1rem"})},e[n][c[a].dataIndex])}))}},loading:e.loading})))}function Ii(e){return g.a.createElement(Ni,{columns:e.columns,dataSource:e.data,loading:e.loading,scroll:{y:300,x:"100vw"}})}var Oi=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e,a=[];if(t.includes(" AND "))a=Pi(t," AND ");else{if(!t.includes(" OR "))return"(".concat(e.trim(),")");a=Pi(t," OR ")}if(a.length<2)return"(".concat(e.trim(),")");var n=Ai(a,t);return n},Mi=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=Pi(e," _AND ");if(t.length<2)return"(".concat(e,")");var a=Ai(t,e);return a},Pi=function(e,t){for(var a=[],n=e.indexOf(t);n>-1;)a.push(n),n=e.indexOf(t,n+1);return a},Ai=function(e,t){var a="";return e.forEach((function(e,n,r){var o=n+1;if(0===n)a="(".concat(t.slice(0,r[o]),")");else if(n===r.length-1){var s=t.slice(e);a="(".concat(a," ").concat(s.trim(),")")}else{var i=t.slice(e,r[o]);a="(".concat(a," ").concat(i.trim(),")")}})),a},Di=ci.a.Option,ji=["Leads","Contacts","Deals"],Ri=function(e){return e.map((function(e){return e.split(" ")[0]}))},Fi=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).handleNextStep=Object(s.a)(r.a.mark((function e(){var t,a,o,i,l,c,u;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.state.activeStep+1,a=Ta(n.state.fields),o=n.state.filteredData.map((function(e){return[{data:[e]}]})),e.next=5,Promise.all(o.map(function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Da(t,n.state.selectedModule));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:return i=e.sent,l=i.flat().map((function(e){return La(e.completeRecordData,n.props.phoneNumberAPINames,"",["Phone","Mobile"].concat(Object(w.a)(a)),!0,n.state.selectedModule)})).flat(),e.next=9,xn(n.state.fields);case 9:c=e.sent,u=null===l||void 0===l?void 0:l.filter((function(e){var t;return e.value&&"Undelivered"===(null===(t=n.props.deliverabilityData)||void 0===t?void 0:t[e.value])})),n.setState({activeStep:t,toNumbers:l,lookupFieldsForCurrentEntity:c,undeliverableToNumbers:u});case 12:case"end":return e.stop()}}),e)}))),n.addFilters=function(e){n.setState({filters:e})},n.getPossibleNameKey=function(){if(ji.includes(n.state.selectedModule))return"Deals"===n.state.selectedModule?"Deal_Name":"Full_Name";var e=/Name/gi,t=n.state.filteredData.map((function(t){return Object.entries(t).filter((function(t){var a=Object(o.a)(t,2),n=a[0],r=a[1];return e.test(n)&&r})).map((function(e){return null===e||void 0===e?void 0:e[0]}))}));return Object(w.a)(new Set(t.flat()))[0]},n.state={selectedModule:ji[0],activeStep:0,filteredData:[],isSearchingRecords:!1,fields:[],toNumbers:[],lookupFieldsForCurrentEntity:[],undeliverableToNumbers:[],filters:[],messageModules:ji},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=Object(s.a)(r.a.mark((function e(){var t,a,n,s,i,l,c,u;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Xa(["twiliosmsextension0__Custom_Modules_Linked_To_Twilio"]);case 2:return t=e.sent,a=Object(o.a)(t,1),n=a[0],s=(s=(null===n||void 0===n?void 0:n.split(","))||[]).filter((function(e){return","!==e})).map((function(e){return e.trim()})),e.next=9,Tr(s);case 9:return i=e.sent,l=i.availableModules,c=[].concat(ji,Object(w.a)(l)),e.next=14,xa(this.state.selectedModule);case 14:u=e.sent,this.setState({fields:u.fields,messageModules:c});case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getStepContent",value:function(e){switch(e){case 0:return this.stepOne();case 1:return this.stepTwo();default:return"Unknown stepIndex"}}},{key:"handlePreviousStep",value:function(){var e=this.state.activeStep-1;this.setState({activeStep:e})}},{key:"handleModuleChange",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ln(t);case 2:a=e.sent,this.setState({selectedModule:t,filteredData:[],fields:a,filters:[]});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"searchRecords",value:function(){var e=Object(s.a)(r.a.mark((function e(t,a){var n,o,i,l,c,u,d,m,p;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.length){e.next=3;break}return this.setState({filteredData:[]}),e.abrupt("return");case 3:return n=a.filter((function(e){var t;return!!(null===e||void 0===e?void 0:e.field)&&!!(null===e||void 0===e?void 0:e.comparisonType)&&!!(null===e||void 0===e?void 0:e.value)&&!!(null===e||void 0===e||null===(t=e.value)||void 0===t?void 0:t.length)})),this.setState({isSearchingRecords:!0}),e.next=7,Promise.all(n.map(function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,o,s,i,l,c,u,d,m,p,h,g,f;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.value,i=s[0],l=null===(a=t.comparisonType)||void 0===a?void 0:a.value,c=null===(n=t.field)||void 0===n?void 0:n.api_name,!(null===(u=null===(o=t.field)||void 0===o?void 0:o.data_type)||void 0===u?void 0:u.includes("lookup"))||"ownerlookup"===u){e.next=12;break}return e.next=8,ln(null===t||void 0===t||null===(d=t.field)||void 0===d||null===(m=d.lookup)||void 0===m?void 0:m.module.api_name);case 8:h=e.sent,g=h.filter((function(e){return e.api_name.includes("Name")&&"text"===e.data_type})),f=null!==(p=g.find((function(e){return"Name"===e.api_name})))&&void 0!==p?p:null===g||void 0===g?void 0:g[0],c+="."+(null===f||void 0===f?void 0:f.api_name);case 12:if(!Array.isArray(s)){e.next=19;break}if("!="!==l){e.next=18;break}i="".concat(s.join(", ")),l="not in",e.next=19;break;case 18:return e.abrupt("return",s.map((function(e){var t=e;return"like"!==l&&"not like"!==l||(t="%".concat(e,"%")),"".concat(c," ").concat(l," '").concat(t,"'")})).join("not like"===l?" AND ":" OR "));case 19:return e.abrupt("return","".concat(c," ").concat(l," '").concat(i,"'"));case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 7:return o=e.sent,i=Ri(o),l=(l=o.reduce((function(e,t,a){var n=Oi(t);return e+"".concat(n," ").concat(a===o.length-1?"":"_AND ")}),"")).trim(),2===o.length?l="(".concat(l,")"):o.length>2&&(l=Mi(l)),l=l.replace(/ _AND /gi," AND "),c="select ".concat(i.join(", "))+" from ".concat(t," where ").concat(l),e.prev=14,e.next=17,qn(c,0,[]);case 17:for(u=e.sent,200,d=[],m=0;m<u.length;m+=200)d.push(u.slice(m,m+200).map((function(e){return e.id})));return e.next=23,Promise.all(d.map(function(){var e=Object(s.a)(r.a.mark((function e(a){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ht.a.CRM.API.getRecord({Entity:t,RecordID:a});case 2:return n=e.sent,e.abrupt("return",(null===n||void 0===n?void 0:n.data)||[]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 23:p=e.sent,this.setState({isSearchingRecords:!1,filteredData:p.flat()}),e.next=30;break;case 27:e.prev=27,e.t0=e.catch(14),this.setState({isSearchingRecords:!1});case 30:case"end":return e.stop()}}),e,this,[[14,27]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"stepOne",value:function(){var e,t=this,a=[{title:"Record Name",dataIndex:this.getPossibleNameKey(),width:650},{dataIndex:"remove",width:5}];return g.a.createElement("div",{className:this.props.classes.stepContainer},g.a.createElement(ui.a,{labelCol:{span:4}},g.a.createElement(ui.a.Item,{label:"Module",labelAlign:"left",wrapperCol:{span:7}},g.a.createElement(ci.a,{value:this.state.selectedModule,onChange:function(e){return t.handleModuleChange(e)}},this.state.messageModules.map((function(e){return g.a.createElement(Di,{value:e,key:e},e)})))),g.a.createElement(ui.a.Item,{label:"Filter records:",labelAlign:"left"},g.a.createElement("div",{key:this.state.selectedModule},g.a.createElement(ki,{selectedModule:this.state.selectedModule,isSearchingRecords:this.state.isSearchingRecords,searchRecords:function(e,a){return t.searchRecords(e,a)},fields:this.state.fields,addFilters:this.addFilters,filters:this.state.filters,activeUsers:this.props.activeUsers}))),(null===(e=this.state.filteredData)||void 0===e?void 0:e.length)?g.a.createElement(d.a,{severity:"warning"},"It\u2019s possible that not all these records have phone numbers so you might not see all of them on the next screen."):null,g.a.createElement(ui.a.Item,{label:"Records",labelAlign:"left"},g.a.createElement(Ii,{data:this.state.filteredData,columns:a,loading:this.state.isSearchingRecords}),g.a.createElement("small",null,g.a.createElement("strong",null,"No. of Records: "),this.state.filteredData.length))))}},{key:"stepTwo",value:function(){return g.a.createElement("div",{style:{width:"70%"}},g.a.createElement(rm,{fromNumbers:this.props.fromNumbers,toNumbers:this.state.toNumbers,smsTemplates:this.props.smsTemplates,widgetType:"ListView",currentSelectedModule:this.state.selectedModule,onboardingScreenData:this.props.onboardingScreenData,lookupFieldsForCurrentEntity:this.state.lookupFieldsForCurrentEntity,lookupFieldsForSMSMessagesModule:this.props.lookupFieldsForSMSMessagesModule,undeliverableToNumbers:this.state.undeliverableToNumbers,currentUserId:this.props.currentUserId,defaultPhonePrefix:this.props.defaultPhonePrefix,crmOrganisationID:this.props.crmOrganisationID,currentUserEmail:this.props.currentUserEmail,workingHoursSettingsFromBackend:this.props.workingHoursSettingsFromBackend}))}},{key:"render",value:function(){var e=this,t=["Choose a module and filter records","Send the message"];return g.a.createElement("div",{className:this.props.classes.container},g.a.createElement("div",{className:this.props.classes.subContainer},g.a.createElement(si.a,{activeStep:this.state.activeStep,alternativeLabel:!0},t.map((function(e){return g.a.createElement(ii.a,{key:e},g.a.createElement(li.a,null,e))})))),g.a.createElement("div",{className:this.props.classes.subContainer},this.getStepContent(this.state.activeStep)),g.a.createElement("div",{className:this.props.classes.subContainer},g.a.createElement(eo.a,{disabled:0===this.state.activeStep,onClick:function(){return e.handlePreviousStep()}},"Back"),this.state.activeStep!==t.length-1&&g.a.createElement(eo.a,{color:"primary",onClick:this.handleNextStep,disabled:0===this.state.filteredData.length},"Next")))}}]),a}(g.a.Component),Ui=Object(S.a)((function(){return{container:{width:"100%"},subContainer:{display:"flex",justifyContent:"center"},stepper:{maxWidth:"50%"},stepContainer:{width:"70%"},labelAndContent:{paddingBottom:"2rem"}}}))(Fi),Li=a(1089),Vi=a(1090),Bi=a(1124),qi=a(1014),Wi=a(1093),zi=a(1094),Hi=a(1095),Yi=a(1096),Gi=a(199),Qi=a.n(Gi),Ji=a(1088),Ki=a(1091),Zi=Object(Ct.a)((function(){return{root:{position:"absolute",top:"30%",left:"50%",transform:"translate(-50%, -50%)",width:800,backgroundColor:"#fff"},stack:{padding:30,display:"flex",flexDirection:"column",gap:"16px"},spread:{display:"flex",alignItems:"center",gap:"10px"},selectField:{width:"100%"}}})),Xi=function(e){var t=e.open,a=e.handleCloseModal,n=e.openType,i=e.editData,l=e.getTeamData,c=e.fromNumbersInUse,u=e.activeUsers,d=Object(h.useState)(""),m=Object(o.a)(d,2),p=m[0],f=m[1],v=Object(h.useState)([]),b=Object(o.a)(v,2),y=b[0],S=b[1],w=Object(h.useState)([]),_=Object(o.a)(w,2),x=_[0],C=_[1],k=Object(h.useState)([]),E=Object(o.a)(k,2),T=E[0],N=E[1],I="edit"===n,O=Object(h.useMemo)((function(){return u.map((function(e){return{label:e.full_name,value:e.id}}))}),[u]),M=Zi(),P=function(e,t){if(e){var a=Object.values(e);"fromNumber"===(null===t||void 0===t?void 0:t.name)?N(a):"teamMember"===(null===t||void 0===t?void 0:t.name)&&S(a)}},A=function(){var e=Object(s.a)(r.a.mark((function e(){var t,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={name:p,members:y.map((function(e){return{user_name:e.label,user_id:e.value}})),from_numbers:T.map((function(e){var t;return{number:e.label,crm_record_id:e.value,crm_owner_id:null===e||void 0===e||null===(t=e.Owner)||void 0===t?void 0:t.id}}))},e.prev=1,!I){e.next=7;break}return e.next=5,oo(t,null===i||void 0===i?void 0:i.teamId);case 5:e.next=9;break;case 7:return e.next=9,ao(t);case 9:N([]),S([]),l(),a(),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(1),n=e.t0,Oe()({title:"Error",text:n.message,icon:"error"});case 19:case"end":return e.stop()}}),e,null,[[1,15]])})));return function(){return e.apply(this,arguments)}}();return Object(h.useEffect)((function(){if(I&&i){var e,t;f(i.teamName);var a=null===i||void 0===i||null===(e=i.fromNumbers)||void 0===e?void 0:e.map((function(e){return{label:e.phone_number,value:e.crm_record_id,Owner:{id:e.owner_id}}}));N(a),S(null===i||void 0===i||null===(t=i.members)||void 0===t?void 0:t.map((function(e){return{label:e.name,value:e.userId}})))}else I||(f(""),S([]),N([]),la().then((function(e){var t=e.filter((function(e){return!!e.Name&&!!e.id&&!e.twiliosmsextension0__Do_Not_Use_in_CRM})).map((function(e){var t;return{label:e.Name,value:e.id,Owner:{id:null===(t=e.Owner)||void 0===t?void 0:t.id}}}));C(t.filter((function(e){return!c.includes(e.label)})))})).catch((function(e){C([])})))}),[I,i,c]),g.a.createElement($r.a,{open:t,onClose:a},g.a.createElement(qr.a,{className:M.root,square:!0,elevation:0},g.a.createElement(G.a,{className:M.stack},g.a.createElement(Y.a,{variant:"h5",component:"h2"},I?"Edit Team":"Add New Team"),g.a.createElement(G.a,{className:M.spread},g.a.createElement(Y.a,{variant:"body1",component:"p"},"Team Name:"),g.a.createElement(Do.a,{variant:"outlined",autoFocus:!0,margin:"dense",label:"Team Name",type:"text",style:{width:"50%"},value:p,onChange:function(e){f(e.target.value)}})),g.a.createElement(G.a,{className:M.spread},g.a.createElement(Y.a,{variant:"body1",component:"p"},"Team Members:"),g.a.createElement(to.a,{name:"teamMember",className:M.selectField,isMulti:!0,options:O,value:y,onChange:P})),g.a.createElement(G.a,{className:M.spread},g.a.createElement(Y.a,{variant:"body1",component:"p"},"From Numbers:"),g.a.createElement(to.a,{name:"fromNumber",className:M.selectField,isMulti:!0,options:x,value:T,onChange:P})),g.a.createElement(G.a,{className:M.spread},g.a.createElement(eo.a,{variant:"contained",color:"primary",onClick:A},"Save")))))},$i=Object(Ct.a)((function(){return{table:{background:"#fff","& thead":{"& th":{borderBottom:"1px solid"}},"& tbody tr":{"&:nth-child(odd)":{backgroundColor:"#f8f8f8"}}},noData:{textAlign:"center",padding:"30px",background:"#fff"},addNewButton:{marginTop:"20px"}}})),el=Object(S.a)((function(){return{avatar:{width:"28px",height:"28px",fontSize:"1em !important","&.MuiAvatar-circle":{"&:nth-child(3n + 0)":{background:"#003D4C"},"&:nth-child(3n + 1)":{background:"#FF8727"},"&:nth-child(3n + 2)":{background:"#FFCC42"},"&:last-child":{color:"#000",background:"#BDBDBD"}}}}}))(Ji.a),tl=function(e){var t=e.teamData,a=e.getTeamData,n=e.activeUsers,i=$i(),l=Object(h.useState)(!1),c=Object(o.a)(l,2),u=c[0],d=c[1],m=Object(h.useState)(""),f=Object(o.a)(m,2),v=f[0],b=f[1],y=Object(h.useState)(),S=Object(o.a)(y,2),w=S[0],_=S[1],x=Object(h.useMemo)((function(){return Object(p.flatMap)(t.map((function(e){var t;return null===e||void 0===e||null===(t=e.fromNumbers)||void 0===t?void 0:t.map((function(e){return e.phone_number}))})))}),[t]),C=Object(h.useCallback)((function(){return b("")}),[]),k=function(e,t){return function(a){b(e),t&&_(t)}},T=function(){var e=Object(s.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,d(!0),e.next=4,ro(t);case 4:a(),d(!1),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),n=e.t0,Oe()({title:"Error",text:"Failed to delete team. Error: "+(null===n||void 0===n?void 0:n.message),icon:"error"});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}();return g.a.createElement(g.a.Fragment,null,g.a.createElement(Wi.a,{style:{maxHeight:450,overflow:"auto"}},g.a.createElement(zi.a,{stickyHeader:!0,size:"small",className:i.table},g.a.createElement(Hi.a,null,g.a.createElement(Li.a,null,g.a.createElement(Vi.a,{component:"th"},"Team Name"),g.a.createElement(Vi.a,{component:"th",style:{zIndex:100}},"Members"),g.a.createElement(Vi.a,{component:"th"},"From Numbers"),g.a.createElement(Vi.a,{align:"center",component:"th",style:{width:"10%"}},"Actions"))),g.a.createElement(Yi.a,null,u?[1,2,3].map((function(e){return g.a.createElement(Li.a,{key:e},g.a.createElement(Vi.a,null,g.a.createElement(Ki.a,{variant:"text"})),g.a.createElement(Vi.a,null,g.a.createElement(Ki.a,{variant:"text"})),g.a.createElement(Vi.a,null,g.a.createElement(Ki.a,{variant:"text"})),g.a.createElement(Vi.a,{align:"center",style:{width:"10%"}},g.a.createElement(Ki.a,{variant:"text"})))})):g.a.createElement(g.a.Fragment,null,(null===t||void 0===t?void 0:t.length)?t.filter(Boolean).map((function(e){var t,a;if("noTeam"===e.teamId)return null;var n,r,o=null===(t=e.members)||void 0===t?void 0:t.map((function(e){return e.name})),s=null===(a=e.fromNumbers)||void 0===a?void 0:a.map((function(e){return e.phone_number}));return g.a.createElement(Li.a,{key:e.teamId},g.a.createElement(Vi.a,null,e.teamName),g.a.createElement(Vi.a,null,function(e){return!e||e.length<=0?null:(e.forEach((function(e){t=t?"".concat(t,"<br/>").concat(e):e})),g.a.createElement(Bi.a,{arrow:!0,title:g.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}})},g.a.createElement(el,{max:6,style:{paddingRight:8}},e.map((function(e,t){var a=(null===e||void 0===e?void 0:e.match(/\b\w/g))||[];return g.a.createElement(qi.a,{key:t},a.slice(0,2))})))));var t}(o)),g.a.createElement(Vi.a,null,(n=(null===s||void 0===s?void 0:s.join(", "))||"",r=100,n.length<=r?n:"".concat(n.substr(0,r),"..."))),g.a.createElement(Vi.a,{align:"center",style:{width:"10%"}},g.a.createElement(E.a,{size:"small",title:"Edit",onClick:k("edit",e)},g.a.createElement(Qi.a,{color:"primary"})),g.a.createElement(E.a,{size:"small",title:"Delete",onClick:function(){return T(e.teamId)}},g.a.createElement(U.a,{color:"secondary"}))))})):g.a.createElement(Li.a,{className:i.noData},g.a.createElement(Vi.a,{colSpan:5},"No team data")))))),g.a.createElement(eo.a,{onClick:k("new"),className:i.addNewButton,variant:"contained",color:"primary"},"Add New Team"),g.a.createElement(Xi,{open:""!==v,handleCloseModal:C,openType:v,editData:w,getTeamData:a,fromNumbersInUse:x,activeUsers:n}))};function al(e){return nl.apply(this,arguments)}function nl(){return(nl=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yt().post("api/v1/user_settings/",t);case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var rl=function(e){var t=e.children,a=g.a.useState(null),n=Object(o.a)(a,2),r=n[0],s=n[1],i=Boolean(r),l=i?"help-popover":void 0;return g.a.createElement(g.a.Fragment,null,g.a.createElement(E.a,{onClick:function(e){s(e.currentTarget)},size:"small",disableRipple:!0},g.a.createElement(ti.a,{color:"secondary"})),g.a.createElement(Ko.a,{id:l,open:i,anchorEl:r,onClose:function(){s(null)},anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"left"}},g.a.createElement(qr.a,{style:{maxWidth:300,padding:15}},t)))},ol=Object(Ct.a)((function(){return{settingItem:{marginTop:"20px"},checkContainer:{marginTop:"5px",display:"flex",alignContent:"center"}}})),sl=function(e){var t=e.label,a=e.option,n=e.onOptionChange,r=e.disabled,o=e.disableReason,s=ol();return g.a.createElement("div",{className:s.settingItem},g.a.createElement("div",{style:{color:r?"grey":"inherit"}},g.a.createElement("b",null,t)),g.a.createElement("div",{className:s.checkContainer},r?null:g.a.createElement(C.a,{color:"primary",checked:a,onChange:n,disabled:r,id:t}),g.a.createElement("label",{htmlFor:t,style:{marginTop:"15px",color:r?"grey":"inherit",cursor:"pointer"}},r?"Not Available":"Yes, Please.",Boolean(o)&&g.a.createElement("span",{style:{marginLeft:"10px",color:"grey"}},o))))},il=function(e){var t,a,n,i,l=e.currentUserId,c=e.isAdmin,u=e.userEmail,m=e.setUserSettings,p=e.userSettings,f=e.settingsOptions,v=e.handleCloseModal,b=ol(),y=Object(h.useState)(null),S=Object(o.a)(y,2),w=S[0],x=S[1],C=Object(h.useState)(!1),k=Object(o.a)(C,2),E=k[0],T=k[1],N=Object(h.useState)(!1),I=Object(o.a)(N,2),O=I[0],M=I[1],P=function(){var e=Object(s.a)(r.a.mark((function e(){var t,a,n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=p.receive_notification,a=p.receive_team_notification,x(!1),T(!1),M(!0),e.next=7,al({receive_notification:t,receive_team_notification:a,crm_user_id:l,email_address:u});case 7:if(n=e.sent,M(!1),200!==n.status){e.next=20;break}return e.next=12,St();case 12:o=e.sent,T(!0),v(),st("crm_user_settings"),Oe()("A new tab will open to activate notifications. If it doesn't, check your popup blocker"),window.open("./initializeNotification.html?crm_org_id=".concat(o.crm_org_id,"&z_api_key=").concat(o.z_api_key,"&crm_user_id=").concat(l)),e.next=21;break;case 20:x(!0);case 21:e.next=27;break;case 23:e.prev=23,e.t0=e.catch(0),x(e.t0),M(!1);case 27:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(){return e.apply(this,arguments)}}();return g.a.createElement(g.a.Fragment,null,w?g.a.createElement(d.a,{severity:"error"}," ","An error occurred. Please check you are on the latest version of the extension by following the instructions here https://screencast-o-matic.com/watch/cYlXrp813O. If you are on the latest version, please email team@smooth.tel with a screenshot of this error message: ".concat(w.message," ").concat(w.stack)):E?g.a.createElement(d.a,{severity:"success"},"Saved!"):null,g.a.createElement("div",null,g.a.createElement(sl,{label:"Receive push notifications when people reply to my messages",option:null===p||void 0===p?void 0:p.receive_notification,onOptionChange:function(e){m(Object(_.a)(Object(_.a)({},p),{},{receive_notification:e.target.checked}))},disabled:null===f||void 0===f||null===(t=f.receive_notification)||void 0===t?void 0:t.disabled,disableReason:null===f||void 0===f||null===(a=f.receive_notification)||void 0===a?void 0:a.disableReason}),g.a.createElement(sl,{label:"Receive push notifications when people reply to my colleague's messages",option:null===p||void 0===p?void 0:p.receive_team_notification,onOptionChange:function(e){m(Object(_.a)(Object(_.a)({},p),{},{receive_team_notification:e.target.checked}))},disabled:!c&&((null===f||void 0===f||null===(n=f.receive_team_notification)||void 0===n?void 0:n.disabled)||!(null===p||void 0===p?void 0:p.receive_notification)),disableReason:c?"":null===f||void 0===f||null===(i=f.receive_team_notification)||void 0===i?void 0:i.disableReason})),g.a.createElement("div",{className:b.settingItem},g.a.createElement(eo.a,{title:"Clear app caching then reload",onClick:function(){nt(),window.location.reload()},variant:"outlined",color:"secondary"},"Clear app cache"),g.a.createElement(rl,null,"Normally you'll only use this if a Smooth support rep asks you to. Use this to clear your local cache when some data is not updating correctly. ",g.a.createElement("br",null),"This ",g.a.createElement("b",null,"will not")," reset any setting data.")),g.a.createElement("hr",null),g.a.createElement(eo.a,{variant:"contained",color:"primary",onClick:P},O?g.a.createElement(Q.a,{style:{color:"white"},size:"24px"}):"Save"))},ll=Object(Ct.a)((function(){return{root:{position:"absolute",top:"40%",left:"50%",transform:"translate(-50%, -50%)",width:800,backgroundColor:"#fff"},stack:{padding:30,display:"flex",flexDirection:"column",gap:"16px"},spread:{display:"flex",alignItems:"center",gap:"10px"},selectField:{width:"100%",flex:1}}})),cl=function(e){var t=e.open,a=e.handleCloseModal,n=e.openType,i=e.editData,l=e.teamData,c=e.currentUserId,u=e.updateFromNumberList,d=e.gateways,m=vo(!0),p=Object(o.a)(m,3),f=p[0],v=p[1],b=p[2],y=vo(!0),S=Object(o.a)(y,3),w=S[0],_=S[1],x=S[2],k=Object(h.useState)(""),E=Object(o.a)(k,2),T=E[0],N=E[1],I=Object(h.useState)(""),O=Object(o.a)(I,2),M=O[0],P=O[1],A=Object(h.useState)(""),D=Object(o.a)(A,2),j=D[0],R=D[1],F=Object(h.useState)(null),U=Object(o.a)(F,2),L=U[0],V=U[1],B=Object(h.useState)(null),q=Object(o.a)(B,2),W=q[0],z=q[1],H="edit"===n,Q=ll(),J=Object(h.useMemo)((function(){return d.map((function(e){return{value:e.id,label:"".concat(e.gateway,"-").concat(e.description)}}))}),[d]),K=Object(h.useMemo)((function(){return null===l||void 0===l?void 0:l.filter((function(e){return"noTeam"!==e.teamId})).map((function(e){return{value:e.teamId,label:e.teamName}}))}),[l]),Z=Object(h.useMemo)((function(){var e=!T||!L;return H?e:e||!W}),[T,W,L,H]),X=function(e,t){if(e){var a=e;"team"===(null===t||void 0===t?void 0:t.name)?V(a):"gateway"===(null===t||void 0===t?void 0:t.name)&&z(a)}},$=function(){var e=Object(s.a)(r.a.mark((function e(){var t,n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Z){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,t={id:H?null===i||void 0===i?void 0:i.id:void 0,phoneNumber:T,enabled:w,crm_owner_id:c,description:M,criteria:j,teamId:L.value,available_to_all_users:f,gateway_id:H?null:W.value},e.next=6,na(t);case 6:n=e.sent,u(n,H),a(),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(2),o=e.t0,Oe()({title:"Error",text:"".concat(o.message,". Payload: ").concat(JSON.stringify({id:H?null===i||void 0===i?void 0:i.id:void 0,phoneNumber:T,enabled:w,crm_owner_id:c,description:M,criteria:j,teamId:L.value,available_to_all_users:f,gateway_id:H?null:W.value},null,2)),icon:"error"});case 15:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(){return e.apply(this,arguments)}}();return Object(h.useEffect)((function(){H&&i?(b(i.available_to_all_users),x(i.enabled),N(i.phoneNumber),P(i.description||""),R(i.criteria),V({label:i.teamName,value:i.teamId})):H||(b(!0),x(!0),N(""),P(""),R(""),V(null),z(null))}),[H,i,x,b]),g.a.createElement($r.a,{open:t,onClose:a},g.a.createElement(qr.a,{className:Q.root,square:!0,elevation:0},g.a.createElement(G.a,{className:Q.stack},g.a.createElement(Y.a,{variant:"h5",component:"h2"},H?"Edit From Number":"Add New Number"),g.a.createElement(G.a,{className:Q.spread},g.a.createElement(G.a,{className:Q.spread},g.a.createElement(Y.a,{variant:"body1",component:"p"},"Enable this number:"),g.a.createElement(C.a,{color:"primary",checked:w,onClick:_})),g.a.createElement(G.a,{className:Q.spread},g.a.createElement(Y.a,{variant:"body1",component:"p"},"Available to all users:"),g.a.createElement(C.a,{color:"primary",checked:f,onClick:v}))),g.a.createElement(G.a,{className:Q.spread},g.a.createElement(Y.a,{variant:"body1",component:"p"},"Phone number*:"),g.a.createElement(Do.a,{variant:"outlined",autoFocus:!0,margin:"dense",label:"Phone number",type:"text",style:{width:"50%"},value:T,onChange:function(e){N(e.target.value)}})),g.a.createElement(G.a,{className:Q.spread},g.a.createElement(Y.a,{variant:"body1",component:"p"},"Description:"),g.a.createElement(Do.a,{variant:"outlined",margin:"dense",label:"Description",type:"text",style:{width:"50%"},value:M,onChange:function(e){P(e.target.value)}})),g.a.createElement(G.a,{className:Q.spread},g.a.createElement(Y.a,{variant:"body1",component:"p"},"Criteria for when to use:"),g.a.createElement(Do.a,{variant:"outlined",margin:"dense",label:"Criteria for when to use",type:"text",style:{width:"50%"},value:j,onChange:function(e){R(e.target.value)}}),g.a.createElement(rl,null,"Use if you want to make this number available to certain users or certain leads."," ",g.a.createElement("a",{href:"https://www.youtube.com/watch?v=Pd5wgYNuAAw",target:"_blank",rel:"noreferrer"},"Refer to this video")," ","for more details")),!H&&g.a.createElement(G.a,{className:Q.spread},g.a.createElement(Y.a,{variant:"body1",component:"p"},"Gateway to use*:"),g.a.createElement(to.a,{name:"gateway",className:Q.selectField,options:J,value:W,onChange:X})),g.a.createElement(Y.a,{variant:"body1",component:"p"},"Assign to:"),g.a.createElement(G.a,{className:Q.spread},g.a.createElement(Y.a,{variant:"body1",component:"p"},"Team*:"),g.a.createElement(to.a,{name:"team",className:Q.selectField,options:K,value:L,onChange:X})),g.a.createElement(G.a,{className:Q.spread},g.a.createElement(eo.a,{variant:"contained",color:"primary",onClick:$,disabled:Z},"Save")))))},ul="/api/v1/gateway/",dl=function(){var e=Object(s.a)(r.a.mark((function e(){var t,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,yt().get(ul);case 3:return t=e.sent,a=null===t||void 0===t?void 0:t.data.map((function(e){return{id:e.id,description:e.description,authToken:"",gateway:e.gateway,accountSID:e.auth_metadata.account_sid}})),e.abrupt("return",a);case 8:return e.prev=8,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",[]);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),ml=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a={id:t.id,auth_secret:t.gatewayAccountSecret,api_key:t.gatewayAccountId,gateway:t.gateway,description:t.description},e.next=4,yt().post(ul,a);case 4:return n=e.sent,o={id:n.data.id,description:n.data.description,authToken:"",gateway:n.data.gateway,accountSID:n.data.auth_metadata.account_sid},e.abrupt("return",o);case 9:throw e.prev=9,e.t0=e.catch(0),console.error(e.t0),e.t0;case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),pl=function(){var e=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=yt().delete("".concat(ul).concat(t,"/")),e.abrupt("return",a);case 5:throw e.prev=5,e.t0=e.catch(0),console.error(e.t0),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),hl=a(1097),gl=a(562),fl=a.n(gl),vl=a(563),bl=a.n(vl),yl=function(e){var t=e.classes,a=e.onUpdateField,n=e.setIsFormHasFullData,r=e.defaultValues,s=vo(),i=Object(o.a)(s,2),l=i[0],c=i[1],u=Object(h.useState)(r.accountSID),d=Object(o.a)(u,2),m=d[0],p=d[1],f=Object(h.useState)(r.authToken),v=Object(o.a)(f,2),b=v[0],y=v[1],S=function(e){var t=e.target,r=t.name,o=t.value;a(r,o),n(!(!m||!b))};return g.a.createElement(g.a.Fragment,null,g.a.createElement(G.a,{className:t.spread},g.a.createElement(Y.a,{variant:"body1",component:"p"},"Account SID*:"),g.a.createElement(Do.a,{variant:"outlined",margin:"dense",placeholder:"Enter your Account SID",type:"text",style:{width:"50%"},value:m,onChange:function(e){p(e.target.value)},onBlur:S,name:"accountSID",autoComplete:"off"})),g.a.createElement(G.a,{className:t.spread},g.a.createElement(Y.a,{variant:"body1",component:"p"},"Auth Token*:"),g.a.createElement("input",{type:"password",hidden:!0,style:{display:"none"}}),g.a.createElement(Do.a,{variant:"outlined",margin:"dense",placeholder:"Enter your Auth Token",type:l?"text":"password",style:{width:"50%"},value:b,onChange:function(e){y(e.target.value)},onBlur:S,name:"authToken",InputProps:{endAdornment:g.a.createElement(hl.a,{position:"end"},g.a.createElement(E.a,{"aria-label":"toggle password visibility",onClick:c},l?g.a.createElement(fl.a,null):g.a.createElement(bl.a,null)))}})))},Sl=Object(Ct.a)((function(){return{root:{position:"absolute",top:"30%",left:"50%",transform:"translate(-50%, -50%)",width:800,backgroundColor:"#fff"},stack:{padding:30,display:"flex",flexDirection:"column",gap:"16px"},spread:{display:"flex",alignItems:"center",gap:"10px"},selectField:{width:"100%"}}})),wl=function(e){var t=e.open,a=e.handleCloseModal,n=e.openType,i=e.editData,l=(e.currentUserId,e.updateGateway),c=Object(h.useState)(""),u=Object(o.a)(c,2),d=u[0],m=u[1],p=Object(h.useState)(null),f=Object(o.a)(p,2),v=f[0],b=f[1],y=Object(h.useState)({}),S=Object(o.a)(y,2),w=S[0],x=S[1],C=Object(h.useState)(!1),k=Object(o.a)(C,2),E=k[0],T=k[1],N="edit"===n,I=Sl(),O=Object(h.useMemo)((function(){return!d||!v||!E}),[d,v,E]),M=function(){var e=Object(s.a)(r.a.mark((function e(){var t,n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!O){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,t={id:N?null===i||void 0===i?void 0:i.id:void 0,description:d,gateway:v.value,gatewayAccountSecret:"",gatewayAccountId:""},(null===v||void 0===v?void 0:v.value)===pe&&(t.gatewayAccountId=w.accountSID,t.gatewayAccountSecret=w.authToken),e.next=7,ml(t);case 7:n=e.sent,l(n,N),a(),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),o=e.t0,Oe()({title:"Error",text:"".concat(o.message,". Payload: ").concat(JSON.stringify({description:d,gateway:v.value},null,2)),icon:"error"});case 16:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(){return e.apply(this,arguments)}}();return Object(h.useEffect)((function(){t&&(N&&i?(m(i.description),b({value:i.gateway,label:i.gateway})):N||(m(""),b(null)))}),[N,i,t]),g.a.createElement($r.a,{open:t,onClose:a},g.a.createElement(qr.a,{className:I.root,square:!0,elevation:0},g.a.createElement(G.a,{className:I.stack},g.a.createElement(Y.a,{variant:"h5",component:"h2"},N?"Edit Gateway":"Add New Gateway"),g.a.createElement(G.a,{className:I.spread},g.a.createElement(Y.a,{variant:"body1",component:"p"},"Gateway type*:"),g.a.createElement(to.a,{name:"gateway",className:I.selectField,options:me,value:v,onChange:function(e,t){if(e){var a=e;"gateway"===(null===t||void 0===t?void 0:t.name)&&b(a)}}})),g.a.createElement(G.a,{className:I.spread},g.a.createElement(Y.a,{variant:"body1",component:"p"},"Gateway Account Description*:"),g.a.createElement(Do.a,{variant:"outlined",margin:"dense",placeholder:"Gateway account description",type:"text",style:{width:"50%"},value:d,onChange:function(e){m(e.target.value)}})),(null===v||void 0===v?void 0:v.value)===pe&&g.a.createElement(yl,{classes:I,onUpdateField:function(e,t){x((function(a){return Object(_.a)(Object(_.a)({},a),{},Object($t.a)({},e,t))}))},setIsFormHasFullData:T,defaultValues:{accountSID:N&&(null===i||void 0===i?void 0:i.accountSID)||"",authToken:""}}),g.a.createElement(G.a,{className:I.spread},g.a.createElement(eo.a,{variant:"contained",color:"primary",onClick:M,disabled:O},"Save")))))},_l=Object(Ct.a)((function(){return{table:{background:"#fff","& thead":{"& th":{borderBottom:"1px solid"}},"& tbody tr":{"&:nth-child(odd)":{backgroundColor:"#f8f8f8"}}},noData:{textAlign:"center",padding:"30px",background:"#fff"},addNewButton:{marginTop:"20px"},footerButtons:{display:"flex",justifyContent:"space-between",alignItems:"center"}}})),xl=function(e){var t=e.teamData,a=e.currentUserId,n=e.fromNumbersBackend,r=e.updateFromNumberList,s=e.gateways,i=e.updateGateway,l=_l(),c=Object(h.useState)(""),u=Object(o.a)(c,2),d=u[0],m=u[1],p=Object(h.useState)(),f=Object(o.a)(p,2),v=f[0],b=f[1],y=vo(!1),S=Object(o.a)(y,2),w=S[0],x=S[1],k=Object(h.useCallback)((function(){return m("")}),[]),T=function(e,t){return function(a){m(e),t&&b(t)}};return g.a.createElement(g.a.Fragment,null,g.a.createElement(Wi.a,{style:{maxHeight:450,overflow:"auto"}},g.a.createElement(zi.a,{stickyHeader:!0,size:"small",className:l.table},g.a.createElement(Hi.a,null,g.a.createElement(Li.a,null,g.a.createElement(Vi.a,{component:"th"},"Enabled"),g.a.createElement(Vi.a,{component:"th",style:{zIndex:100}},"From Number"),g.a.createElement(Vi.a,{component:"th"},"Description"),g.a.createElement(Vi.a,{component:"th"},"Assigned to"),g.a.createElement(Vi.a,{align:"center",component:"th",style:{width:"10%"}},"Actions"))),g.a.createElement(Yi.a,null,(null===n||void 0===n?void 0:n.length)?n.map((function(e){var a=e.enabled,n=function(e,t){var a,n;return null!==(a=null===(n=function(e,t){return t.find((function(t){return t.teamId===e}))}(e,t))||void 0===n?void 0:n.teamName)&&void 0!==a?a:"Unknown Team Name"}(e.teamId,t);return g.a.createElement(Li.a,{key:e.id},g.a.createElement(Vi.a,null,g.a.createElement(C.a,{color:"primary",checked:a,readOnly:!0,disableRipple:!0})),g.a.createElement(Vi.a,null,e.phoneNumber),g.a.createElement(Vi.a,null,e.description),g.a.createElement(Vi.a,null,n),g.a.createElement(Vi.a,{align:"center",style:{width:"10%"}},g.a.createElement(E.a,{size:"small",title:"Edit",onClick:T("edit",Object(_.a)(Object(_.a)({},e),{},{teamName:n}))},g.a.createElement(Qi.a,{color:"primary"}))))})):g.a.createElement(Li.a,{className:l.noData},g.a.createElement(Vi.a,{colSpan:5},"No data"))))),g.a.createElement("div",{className:l.footerButtons},g.a.createElement(eo.a,{onClick:T("new"),className:l.addNewButton,variant:"contained",color:"primary"},"Add New From Number"),g.a.createElement(eo.a,{onClick:x,className:l.addNewButton,variant:"contained",color:"secondary"},"Add New Gateway")),g.a.createElement(cl,{open:""!==d,handleCloseModal:k,openType:d,editData:v,teamData:t,currentUserId:a,updateFromNumberList:r,gateways:s}),g.a.createElement(wl,{open:w,handleCloseModal:x,openType:"new",currentUserId:a,updateGateway:i}))},Cl=Object(Ct.a)((function(){return{table:{background:"#fff","& thead":{"& th":{borderBottom:"1px solid"}},"& tbody tr":{"&:nth-child(odd)":{backgroundColor:"#f8f8f8"}}},noData:{textAlign:"center",padding:"30px",background:"#fff"},addNewButton:{marginTop:"20px"},footerButtons:{display:"flex",justifyContent:"space-between",alignItems:"center"}}})),kl=function(e){var t=e.currentUserId,a=e.gateways,n=e.updateGateway,i=Cl(),l=Object(h.useState)(""),c=Object(o.a)(l,2),u=c[0],d=c[1],m=Object(h.useState)(),p=Object(o.a)(m,2),f=p[0],v=p[1],b=Object(h.useCallback)((function(){return d("")}),[]),y=function(e,t){return function(a){d(e),t&&v(t)}},S=function(){var e=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,pl(t);case 3:n(t),e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),a=e.t0,Oe()({title:"Error",text:"Failed to delete gateway. Error: "+(null===a||void 0===a?void 0:a.message),icon:"error"});case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}();return g.a.createElement(g.a.Fragment,null,g.a.createElement(Wi.a,{style:{maxHeight:450,overflow:"auto"}},g.a.createElement(zi.a,{stickyHeader:!0,size:"small",className:i.table},g.a.createElement(Hi.a,null,g.a.createElement(Li.a,null,g.a.createElement(Vi.a,{component:"th",style:{zIndex:100}},"Gateway type"),g.a.createElement(Vi.a,{component:"th"},"Gateway Account Description"),g.a.createElement(Vi.a,{align:"center",component:"th",style:{width:"10%"}},"Actions"))),g.a.createElement(Yi.a,null,(null===a||void 0===a?void 0:a.length)?a.map((function(e){return g.a.createElement(Li.a,{key:e.id},g.a.createElement(Vi.a,null,e.gateway),g.a.createElement(Vi.a,null,e.description),g.a.createElement(Vi.a,{align:"center",style:{width:"10%"}},g.a.createElement(E.a,{size:"small",title:"Edit",onClick:y("edit",e)},g.a.createElement(Qi.a,{color:"primary"})),g.a.createElement(E.a,{size:"small",title:"Delete",onClick:function(){return S(e.id)}},g.a.createElement(U.a,{color:"secondary"}))))})):g.a.createElement(Li.a,{className:i.noData},g.a.createElement(Vi.a,{colSpan:3},"No data"))))),g.a.createElement("div",{className:i.footerButtons},g.a.createElement(eo.a,{onClick:y("new"),className:i.addNewButton,variant:"contained",color:"primary"},"Add New Gateway")),g.a.createElement(wl,{open:""!==u,handleCloseModal:b,openType:u,editData:f,currentUserId:t,updateGateway:n}))};function El(e){return Tl.apply(this,arguments)}function Tl(){return(Tl=Object(s.a)(r.a.mark((function e(t){var a,n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!((a=Le(rt("crm_user_settings"),"crm user settings",null))&&We(a.timestamp)<60)){e.next=4;break}return e.abrupt("return",a);case 4:return e.next=6,yt().get("api/v1/user_settings/?crm_user_id=".concat(t));case 6:if(200===(n=e.sent).status){e.next=9;break}return e.abrupt("return",{});case 9:return(o=null===n||void 0===n?void 0:n.data[0]).timestamp=Date.now(),ot("crm_user_settings",JSON.stringify(o)),e.abrupt("return",o);case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",{});case 18:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)}var Nl=Object(Ct.a)((function(){return{root:{backgroundColor:"#fff"},body:{padding:"0 30px 30px"}}})),Il=function(e){var t=e.open,a=e.handleCloseModal,n=e.currentUserId,i=e.isAdmin,l=e.userEmail,c=e.teamData,u=e.getTeamData,d=e.activeUsers,m=Nl(),p=Object(h.useState)("settingView"),f=Object(o.a)(p,2),v=f[0],b=f[1],y=Object(h.useState)({}),S=Object(o.a)(y,2),x=S[0],C=S[1],k=Object(h.useState)({}),E=Object(o.a)(k,2),T=E[0],N=E[1],I=Object(h.useState)([]),O=Object(o.a)(I,2),M=O[0],P=O[1],A=Object(h.useState)([]),D=Object(o.a)(A,2),j=D[0],R=D[1],F=Object(h.useState)(!1),U=Object(o.a)(F,2),L=U[0],V=U[1],B=Object(h.useCallback)(Object(s.a)(r.a.mark((function e(){var t,a,o,s,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,El(n);case 2:return s=e.sent,C(Object(_.a)(Object(_.a)({},s),{},{receive_notification:"true"===(null===s||void 0===s||null===(t=s.receive_notification)||void 0===t?void 0:t.toLowerCase()),receive_team_notification:"true"===(null===s||void 0===s||null===(a=s.receive_team_notification)||void 0===a?void 0:a.toLowerCase()),crm_user_id:n})),e.next=6,Yn();case 6:l=e.sent,i||"true"===(null===l||void 0===l||null===(o=l.allow_anyone_to_see_all_sms)||void 0===o?void 0:o.toLowerCase())||N((function(e){return Object(_.a)(Object(_.a)({},e),{},{receive_team_notification:{disabled:!0,disableReason:"(Your organization has disabled users from seeing colleagues' messages.)"}})})),V(!1);case 9:case"end":return e.stop()}}),e)}))),[n,i]);Object(h.useEffect)((function(){V(!0),B()}),[i,n]),Object(h.useEffect)((function(){i&&(V(!0),aa().then((function(e){P(e),V(!1)})),dl().then((function(e){R(e)})))}),[i]);var q=function(e,t){"string"===typeof e?R((function(t){return t.filter((function(t){return t.id!==e}))})):e&&R(t?function(t){return t.map((function(t){return t.id===e.id?Object(_.a)(Object(_.a)({},t),e):t}))}:function(t){return[e].concat(Object(w.a)(t))})};return L?g.a.createElement("div",null,g.a.createElement(Q.a,null)):g.a.createElement(Us.a,{open:t,onClose:a,"aria-labelledby":"modal-modal-title","aria-describedby":"modal-modal-description",fullWidth:"settingView"!==v,maxWidth:"settingView"!==v?"lg":"md",PaperProps:{style:{maxHeight:590,minWidth:700}}},g.a.createElement(qr.a,{className:m.root,square:!0,elevation:0},g.a.createElement("div",{className:m.body},g.a.createElement(ri.a,{value:v,onChange:function(e,t){b(t)},indicatorColor:"primary",textColor:"primary",centered:!0},g.a.createElement(oi.a,{label:"CRM User Settings",value:"settingView"}),i&&g.a.createElement(oi.a,{label:"Teams",value:"teamsView"}),ae&&i&&g.a.createElement(oi.a,{label:"From Numbers",value:"fromNumberSettings"}),ae&&i&&g.a.createElement(oi.a,{label:"Gateways",value:"gatewaySettings"})),"settingView"===v&&g.a.createElement(il,{currentUserId:n,isAdmin:i,userEmail:l,setUserSettings:C,userSettings:x,settingsOptions:T,handleCloseModal:a}),"teamsView"===v&&g.a.createElement(tl,{activeUsers:d,teamData:c,getTeamData:u}),ae&&"fromNumberSettings"===v&&g.a.createElement(xl,{currentUserId:n.toString(),teamData:c,fromNumbersBackend:M,updateFromNumberList:function(e,t){e&&P(t?function(t){return t.map((function(t){return t.id===e.id?e:t}))}:function(t){return[e].concat(Object(w.a)(t))})},gateways:j,updateGateway:q}),ae&&"gatewaySettings"===v&&g.a.createElement(kl,{currentUserId:n.toString(),gateways:j,updateGateway:q}))))};function Ol(e,t){return Ml.apply(this,arguments)}function Ml(){return(Ml=Object(s.a)(r.a.mark((function e(t,a){var n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"twiliosmsextension0__handle_close_conversation",n={arguments:JSON.stringify({variables:JSON.stringify({record_id:a,module_name:t})})},e.next=4,ht.a.CRM.FUNCTIONS.execute("twiliosmsextension0__handle_close_conversation",n);case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Pl=a(580),Al=Object(h.createContext)(null),Dl=function(e,t,a){return e.filter((function(e){return e.recordId!==a&&!!t.find((function(t){return t===e.moduleName}))}))},jl=function(e,t){var a,n=Object(z.a)(e);try{var r=function(){var e=a.value;Jr(e,t,!1).then((function(t){var a=t.fromData,n=t.toArray,r=t.messages;Rl[e.recordId]={fromData:a,toArray:n,messages:r,timestamp:Date.now()},Ke(e.recordId,Rl[e.recordId])}))};for(n.s();!(a=n.n()).done;)r()}catch(o){n.e(o)}finally{n.f()}},Rl={},Fl=function(e){var t=e.children,a=e.unrepliedConversations,n=e.availableModules,i=e.indexOfFirstConversationHasAvailableModule,l=e.currentUserData,c=e.firstDataForInbox,u=Object(h.useRef)(null),d=Object(h.useState)([]),m=Object(o.a)(d,2),p=m[0],f=m[1];Object(h.useEffect)((function(){if(a.length&&n.length){var e=a[i],t=Dl(a,n,e.recordId),r=function(){var e=/^inbox_(.+)$/g,t=Object.keys(localStorage),a=[];return t.forEach((function(t){if(t.match(e)){var n=t.split("_")[1],r=Je(n);Qe(r)&&n&&a.push(n)}})),a}(),o=v(r,5),s=t.filter((function(e){return!o.includes(e.recordId)}));jl(s,l),Rl[e.recordId]=Object(_.a)(Object(_.a)({},c),{},{timestamp:Date.now()})}}),[a,n,i,l,c]);var v=function(e,t){var a=[];return e.forEach((function(e){var n=Je(e);n&&qe(n.timestamp)<t&&(Rl[e]=n,a.push(e))})),a};Object(h.useEffect)((function(){(function(){var e=Object(s.a)(r.a.mark((function e(){var t,a,n,o,s,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!p.length||!u.current){e.next=9;break}return t=u.current,a=t.loadedRecordId,n=t.data,Rl[a]=Object(_.a)(Object(_.a)({},n),{},{timestamp:Date.now()}),o=p.map((function(e){return e.moduleName})),e.next=6,Ir(o);case 6:s=e.sent,i=Dl(p,s,a),jl(i);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[p]);var b=Object(h.useCallback)((function(e,t){if(e.length){u.current=t;var a=e.filter((function(e){return void 0===Rl[e.recordId]}));f(a)}}),[]),y=Object(h.useCallback)((function(e,t){if(void 0!==Rl[e.recordId]){var a=Rl[e.recordId];a.timestamp;t(Object(Pl.a)(a,["timestamp"]))}else t(null)}),[]);return g.a.createElement(Al.Provider,{value:{onSelectConversation:y,handleUpdatedConversationList:b,updateCacheAfterRetrievingDataFromApi:function(e){var t=e.loadedRecordId,a=e.data;Rl[t]=Object(_.a)(Object(_.a)({},a),{},{timestamp:Date.now()}),Ke(t,Rl[t])}}},t)},Ul={full_name:"All Users",id:"all"},Ll=function(e,t){return t&&e.length>0?[{teamName:"No Team Assigned",teamId:"noTeam",fromNumbers:[],members:[]}].concat(Object(w.a)(e)):e},Vl=function(e){return[Ul].concat(Object(w.a)(e))},Bl=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n,o;Object(i.a)(this,a),(o=t.call(this,e)).context=void 0,o.getTeamData=Object(s.a)(r.a.mark((function e(){var t,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,no();case 2:t=e.sent,a=null===t||void 0===t?void 0:t.find((function(e){var t;return e.teamId===(null===(t=o.state.selectedTeam)||void 0===t?void 0:t.teamId)})),o.setState({teamData:Ll(t,o.props.isAdminUser),selectedTeam:a?o.state.selectedTeam:null===t||void 0===t?void 0:t[0]}),!a&&(null===t||void 0===t?void 0:t[0])&&o.onSelectedTeamChange(t[0]);case 6:case"end":return e.stop()}}),e)}))),o.onSelectedTeamChange=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,s,i,l,c,u,d=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=d.length>1&&void 0!==d[1]&&d[1],t){e.next=3;break}return e.abrupt("return");case 3:if(Ns(t.teamId),n="noTeam"===t.teamId,s=t.members.map((function(e){return{id:e.userId,full_name:e.name}})),i=s.find((function(e){var t;return e.id===(null===(t=o.state.selectedActiveUser)||void 0===t?void 0:t.id)})),l=i||Ul,c=n?o.state.selectedActiveUser:l,!a){e.next=13;break}o.setState({activeUsers:Vl(n?o.props.activeUsers:s),selectedActiveUser:c,selectedTeam:t}),e.next=18;break;case 13:return o.setState({activeUsers:Vl(n?o.props.activeUsers:s),selectedActiveUser:c,selectedTeam:t,messages:[],isMessagesLoading:!0,isInboxZero:!1}),e.next=16,On(c.id,o.state.showRecordsWhoDidNotReplyToUs,o.state.sortFromLatestToOldest,o.props.isOwnerFilterEnabled,n?"":t.teamId);case 16:u=e.sent,o.reloadConversation(u);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o.initializePusher=Object(s.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=new or.a(ge,{cluster:fe}),t.subscribe(o.props.crmOrganisationID).bind("inbound_sms",(function(e){o.addNewRecord(e)}));case 3:case"end":return e.stop()}}),e)}))),o.addNewRecord=function(e){var t;if("inbound"===e.direction&&function(e,t,a,n){if(!n)return e.owner_id===t||"all"===a;var r;return("string"!==typeof e.team_id&&void 0===e.team_id&&"noTeam"===n||(n===(null===e||void 0===e||null===(r=e.team_id)||void 0===r?void 0:r.toString())||"noTeam"===n))&&(a===e.owner_id||"all"===a)}(e,o.props.currentUserId,o.state.selectedActiveUser.id,null===(t=o.state.selectedTeam)||void 0===t?void 0:t.teamId)){var a=o.state.unrepliedConversations.find((function(t){return t.recordId===e.record_id}));if(a){if(a&&o.state.selectedConversation&&a.recordId!==o.state.selectedConversation.recordId){var n=o.state.unrepliedConversations.map((function(t){return t.recordId!==e.record_id?t:Object(_.a)(Object(_.a)({},t),{},{isNewArrival:!0})}));o.setState(Object(_.a)(Object(_.a)({},o.state),{},{unrepliedConversations:n}))}}else{var r,s={createdTime:e.Message_Date,name:e.record_name,moduleName:e.module_name,recordId:e.record_id,ownerId:null===(r=e.owner_id)||void 0===r?void 0:r.toString(),teamId:e.team_id?e.team_id.toString():void 0,allowSendMessage:!0,isNewArrival:!0};o.setState((function(e){return Object(_.a)(Object(_.a)({},e),{},{availableModules:Object(w.a)(new Set([].concat(Object(w.a)(o.state.availableModules),[s.moduleName]))),unrepliedConversations:kn(o.state.sortFromLatestToOldest,[].concat(Object(w.a)(o.state.unrepliedConversations),[s]))})}))}}},o.handleAfterReassign=function(e){var t=o.state.unrepliedConversations.filter((function(t){return t.recordId!==e}));o.setState({messages:[],isMessagesLoading:!0}),o.reloadConversation(t)},o.handleErrorWithConversation=function(){var e=Object(s.a)(r.a.mark((function e(t,a){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.fromData.length||t.toArray.length||t.messages.length){e.next=3;break}return o.setState({isMessagesLoading:!1,unrepliedConversations:o.state.unrepliedConversations.filter((function(e){return e.recordId!==a.recordId}))}),e.abrupt("return",!1);case 3:if(t.fromData&&t.fromData.length){e.next=7;break}return Oe()("You don't have any from numbers set up currently. Set the default from number or add records to the Smooth From Numbers module."),o.setState({isMessagesLoading:!1}),e.abrupt("return",!1);case 7:if(t.toArray&&t.toArray.length){e.next=18;break}return e.next=10,Oe()('This record "'.concat(a.name,"\" doesn't have any phone numbers. Do you want to update them?"),{buttons:["Forget about it","Open the record in a new tab"]});case 10:if(!e.sent){e.next=16;break}return e.next=14,Vr(a.recordId,a.moduleName);case 14:n=e.sent,window.open(n,"_blank");case 16:return o.setState({isMessagesLoading:!1}),e.abrupt("return",!1);case 18:return e.abrupt("return",!0);case 19:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),o.selectConversation=function(){var e=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(a=o.context)||void 0===a?void 0:a.onSelectConversation){e.next=2;break}throw new Error("Context require");case 2:o.setState({isMessagesLoading:!0,startConversation:!1,isInboxZero:!1}),o.context.onSelectConversation(t,function(){var e=Object(s.a)(r.a.mark((function e(a){var n,s,i,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.state.unrepliedConversations.map((function(e){return e.recordId!==t.recordId?e:Object(_.a)(Object(_.a)({},e),{},{isNewArrival:!1})})),a){e.next=48;break}if(e.prev=2,!!o.state.unavailableModules.includes(t.moduleName)){e.next=17;break}return e.next=7,Jr(t);case 7:return s=e.sent,e.next=10,o.handleErrorWithConversation(s,t);case 10:if(e.sent){e.next=13;break}return e.abrupt("return",o.setState({isMessagesLoading:!1,triggerReloadFromInbox:!1}));case 13:i=s.toArray[0].completeRecordData,o.setState({unrepliedConversations:n,selectedConversation:o.mapCRMDataToBackend(Object(_.a)(Object(_.a)({},t),{},{isNewArrival:!1}),i),fromNumbers:s.fromData,toNumbers:s.toArray,messages:s.messages,currentRecordDetails:i,moduleName:t.moduleName,triggerReloadFromInbox:!1},(function(){var e,a;null===(e=o.context)||void 0===e||null===(a=e.updateCacheAfterRetrievingDataFromApi)||void 0===a||a.call(e,{loadedRecordId:t.recordId,data:{fromData:s.fromData,toArray:s.toArray,messages:s.messages}}),o.setState({isMessagesLoading:!1})})),e.next=38;break;case 17:return o.setState({isMessagesLoading:!1}),e.next=20,Oe()({text:"We can't find data for this record because the module (".concat(t.moduleName,") is no longer active in your CRM. You can re-enable the module by following the instructions here: https://www.youtube.com/watch?v=3P4RN7kqDZ0 If you don't want to use this module anymore, click Close Conversation."),buttons:["Close Conversation","I've restored the module"]});case 20:if(!e.sent){e.next=26;break}st("visible_modules","available_modules"),window.location.reload(),e.next=38;break;case 26:return e.next=28,Oe()({text:"Are you sure you want to close this conversation? You won't see it in the inbox view anymore.",buttons:["Cancel","Yes"]});case 28:if(!e.sent){e.next=37;break}return e.next=32,Ol(t.moduleName,t.recordId);case 32:return e.next=34,Kt(t.recordId);case 34:window.location.reload(),e.next=38;break;case 37:window.location.reload();case 38:e.next=43;break;case 40:e.prev=40,e.t0=e.catch(2),console.error(e.t0);case 43:return e.prev=43,o.setState({isMessagesLoading:!1}),e.finish(43);case 46:e.next=55;break;case 48:return e.next=50,o.handleErrorWithConversation(a,t);case 50:if(e.sent){e.next=53;break}return e.abrupt("return",o.setState({isMessagesLoading:!1,triggerReloadFromInbox:!1}));case 53:l=a.toArray[0].completeRecordData,o.setState({unrepliedConversations:n,selectedConversation:o.mapCRMDataToBackend(Object(_.a)(Object(_.a)({},t),{},{isNewArrival:!1}),l),fromNumbers:a.fromData,toNumbers:a.toArray,messages:a.messages,currentRecordDetails:l,moduleName:t.moduleName,triggerReloadFromInbox:!0},(function(){o.setState({isMessagesLoading:!1})}));case 55:case"end":return e.stop()}}),e,null,[[2,40,43,46]])})));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o.handleCloseConversation=function(){var e=Object(s.a)(r.a.mark((function e(t,a){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Qt(t,a),Ol(t,a),n=o.state.unrepliedConversations.filter((function(e){return e.recordId!==a})),o.setState({messages:[],isMessagesLoading:!0}),o.reloadConversation(n);case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),o.handleActiveUserChange=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=9;break}return Es((n=t).id),r=n.full_name,Cs(ws,r),o.setState({messages:[],isMessagesLoading:!0,selectedActiveUser:n,isInboxZero:!1}),e.next=7,On(n.id,o.state.showRecordsWhoDidNotReplyToUs,o.state.sortFromLatestToOldest,o.props.isOwnerFilterEnabled,null===(a=o.state.selectedTeam)||void 0===a?void 0:a.teamId);case 7:s=e.sent,o.reloadConversation(s);case 9:case"end":return e.stop()}var r}),e)})));return function(t){return e.apply(this,arguments)}}(),o.handleChangeTeam=function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.onSelectedTeamChange(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o.toggleStartConversation=function(){o.setState({startConversation:!o.state.startConversation})},o.handleTabChange=function(e,t){o.setState({activeTab:t})},o.handleCloseUserSettings=function(){o.setState({showUserSettings:!1})};var l=e.unrepliedConversations[e.indexOfFirstConversationHasAvailableModule],c=!!e.unavailableModules.length&&!e.availableModules.length;return o.state={showAlertWithInactiveModules:c,availableModules:e.availableModules,unavailableModules:e.unavailableModules,unrepliedConversations:c?[]:e.unrepliedConversations,selectedConversation:o.mapCRMDataToBackend(l,e.currentRecordDetails),fromNumbers:e.fromNumbers,toNumbers:e.toNumbers,messages:e.messages,currentRecordDetails:e.currentRecordDetails,moduleName:null===(n=e.unrepliedConversations[e.indexOfFirstConversationHasAvailableModule])||void 0===n?void 0:n.moduleName,isInboxZero:0===e.messages.length,isMessagesLoading:!1,showRecordsWhoDidNotReplyToUs:!1,sortFromLatestToOldest:Os(),activeUsers:Vl(o.props.activeUsers),selectedActiveUser:{full_name:o.props.currentUserName,id:o.props.currentUserId},startConversation:!1,activeTab:"inbox",showUserSettings:!1,teamData:Ll(o.props.teams,o.props.isAdminUser),selectedTeam:void 0,triggerReloadFromInbox:!1},o}return Object(l.a)(a,[{key:"mapCRMDataToBackend",value:function(e,t){if(!t)return e;var a=t.Full_Name,n=t.Deal_Name,r=t.Name;return Object(_.a)(Object(_.a)({},e),{},{name:a||r||n||e.name})}},{key:"componentDidMount",value:function(){var e=Object(s.a)(r.a.mark((function e(){var t,a,n,o=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.initializePusher(),this.props.isOwnerFilterEnabled){e.next=3;break}return e.abrupt("return");case 3:t=this.getInitFilterSelected(this.props.currentFilterUserId,this.props.currentFilterTeamId),a=t.selectedActiveUser,n=t.selectedTeam,this.setState({selectedActiveUser:a,selectedTeam:n},(function(){o.onSelectedTeamChange(o.state.selectedTeam,!0)}));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getInitFilterSelected",value:function(e,t){var a={id:"",full_name:""},n=this.state.teamData.find((function(e){return e.teamId===t})),r=this.state.activeUsers.find((function(t){return t.id===e}));return r&&(a=r),{selectedTeam:n,selectedActiveUser:a}}},{key:"handleConversationListToggle",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({showRecordsWhoDidNotReplyToUs:t,unrepliedConversations:[],messages:[],isMessagesLoading:!0}),e.next=3,On(this.state.selectedActiveUser.id,t,this.state.sortFromLatestToOldest,this.props.isOwnerFilterEnabled,null===(a=this.state.selectedTeam)||void 0===a?void 0:a.teamId);case 3:n=e.sent,this.reloadConversation(n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleSortOrderToggle",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t,Cs(xs,JSON.stringify(n)),a=kn(t,this.state.unrepliedConversations),this.setState({sortFromLatestToOldest:t,unrepliedConversations:a});case 3:case"end":return e.stop()}var n}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"reloadConversation",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,o,s,i,l,c,u,d,m=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.length){e.next=20;break}return n=t.map((function(e){return e.moduleName})),e.next=4,Tr(n);case 4:if(o=e.sent,s=o.availableModules,i=o.unavailableModules,-1!==(l=t.findIndex((function(e){return e.moduleName===m.state.availableModules[0]||e.moduleName===s[0]})))){e.next=11;break}return i.length>0&&this.setState({isInboxZero:!0,unrepliedConversations:[],showAlertWithInactiveModules:!0}),e.abrupt("return");case 11:return e.next=13,Jr(t[l]);case 13:c=e.sent,u=c.toArray[0],a=null===u||void 0===u?void 0:u.completeRecordData,d=t[l],this.setState({isInboxZero:!1,unrepliedConversations:t,selectedConversation:this.mapCRMDataToBackend(d,a),fromNumbers:c.fromData,toNumbers:c.toArray,messages:c.messages,currentRecordDetails:a,moduleName:t[l].moduleName,availableModules:Object(w.a)(new Set([].concat(Object(w.a)(this.state.availableModules),Object(w.a)(s)))),unavailableModules:i},(function(){var e;(null===(e=m.context)||void 0===e?void 0:e.handleUpdatedConversationList)&&m.context.handleUpdatedConversationList(t,{loadedRecordId:t[l].recordId,data:c}),m.setState({isMessagesLoading:!1})})),e.next=21;break;case 20:this.setState({isInboxZero:!0,unrepliedConversations:[]});case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"openSalesIQChat",value:function(){window.$zoho.salesiq.floatwindow.visible("show")}},{key:"inboxZero",value:function(){return g.a.createElement(g.a.Fragment,null,g.a.createElement("div",{className:this.props.classes.inboxZero},this.state.showAlertWithInactiveModules&&this.state.unavailableModules.length&&g.a.createElement(d.a,{severity:"warning"},"You have some conversations but we can't display them since they're for records in modules which have been deactivated. Please refer to"," ",g.a.createElement("a",{href:"https://www.youtube.com/watch?v=3P4RN7kqDZ0"},"https://www.youtube.com/watch?v=3P4RN7kqDZ0")," ","to enable the modules. Inactive Modules:"," ",this.state.unavailableModules.join(", ")),g.a.createElement("h1",null,"Inbox Zero \ud83d\udcaa")))}},{key:"render",value:function(){var e,t,a=this;return g.a.createElement("div",{className:this.props.classes.root},g.a.createElement(qr.a,{square:!0,elevation:0},g.a.createElement(ri.a,{value:this.state.activeTab,onChange:this.handleTabChange,indicatorColor:"primary",textColor:"primary",centered:!0},g.a.createElement(oi.a,{label:"Inbox",value:"inbox"}),this.props.isAdminUser&&g.a.createElement(oi.a,{label:"Send bulk campaign",value:"smsCampaign"}),g.a.createElement(E.a,{onClick:this.openSalesIQChat,className:this.props.classes.helpIcon},g.a.createElement(ti.a,null)),g.a.createElement(E.a,{onClick:function(){return a.setState({showUserSettings:!0})},className:this.props.classes.settingIcon},g.a.createElement(ni.a,null)),g.a.createElement(E.a,{onClick:this.toggleStartConversation,className:this.props.classes.addIcon},g.a.createElement(D.a,null)))),"inbox"===this.state.activeTab&&g.a.createElement(g.a.Fragment,null,g.a.createElement("div",{className:this.props.classes.messenger},g.a.createElement("div",{className:this.props.classes.conversationList},g.a.createElement(Fs,{unavailableModules:this.state.unavailableModules,currentConversationId:(null===(e=this.state.selectedConversation)||void 0===e?void 0:e.recordId)||"",conversations:this.state.unrepliedConversations,selectConversation:function(e){return a.selectConversation(e)},handleConversationListToggle:function(e){return a.handleConversationListToggle(e)},showRecordsWhoDidNotReplyToUs:this.state.showRecordsWhoDidNotReplyToUs,handleSortOrderToggle:function(e){return a.handleSortOrderToggle(e)},sortFromLatestToOldest:this.state.sortFromLatestToOldest,isOwnerFilterEnabled:this.props.isOwnerFilterEnabled,activeUsers:this.state.activeUsers,handleActiveUserChange:this.handleActiveUserChange,selectedActiveUser:this.state.selectedActiveUser,teamData:this.state.teamData,selectedTeam:this.state.selectedTeam,handleChangeTeam:this.handleChangeTeam})),g.a.createElement("div",{id:"message-wrapper",className:this.props.classes.content},this.state.isInboxZero?this.inboxZero():this.state.isMessagesLoading?g.a.createElement(Pt,{loading:!0}):g.a.createElement(vs,{fromNumbers:this.state.fromNumbers,toNumbers:this.state.toNumbers,messages:this.state.messages,currentRecordDetails:this.state.currentRecordDetails,moduleName:this.state.moduleName,globalDefaultFieldToUse:this.props.globalDefaultFieldToUse,selectedConversation:this.state.selectedConversation,crmOrganisationID:this.props.crmOrganisationID,handleCloseConversation:this.handleCloseConversation,phoneNumberAPINames:this.props.phoneNumberAPINames,currentUserName:this.props.currentUserName,currentUserId:this.props.currentUserId,ownerArray:this.props.ownerArray,defaultPhonePrefix:this.props.defaultPhonePrefix,showUserGuiding:!0,fromInboxView:!0,lookupFieldsForSMSMessagesModule:this.props.lookupFieldsForSMSMessagesModule,phoneFields:this.props.phoneFields,currentUserEmail:this.props.currentUserEmail,workingHoursSettingsFromBackend:this.props.workingHoursSettingsFromBackend,teams:this.state.teamData,selectedTeam:this.state.selectedTeam,handleAfterReassign:this.handleAfterReassign,triggerReloadFromInbox:this.state.triggerReloadFromInbox})))),"smsCampaign"===this.state.activeTab&&g.a.createElement(Ui,{fromNumbers:this.props.fromNumbers,smsTemplates:this.props.smsTemplates,onboardingScreenData:this.props.onboardingScreenData,crmOrganisationID:this.props.crmOrganisationID,defaultPhonePrefix:this.props.defaultPhonePrefix,currentUserId:this.props.currentUserId,lookupFieldsForSMSMessagesModule:this.props.lookupFieldsForSMSMessagesModule,deliverabilityData:this.props.deliverabilityData,currentUserEmail:this.props.currentUserEmail,activeUsers:this.props.activeUsers,workingHoursSettingsFromBackend:this.props.workingHoursSettingsFromBackend,phoneNumberAPINames:this.props.phoneNumberAPINames}),g.a.createElement(Il,{currentUserId:this.props.currentUserId,isAdmin:this.props.isAdminUser,userEmail:this.props.currentUserEmail,open:this.state.showUserSettings,handleCloseModal:this.handleCloseUserSettings,teamData:this.state.teamData,getTeamData:this.getTeamData,activeUsers:this.props.activeUsers}),g.a.createElement($s,{open:this.state.startConversation,handleClose:this.toggleStartConversation,selectConversation:this.selectConversation,moduleName:null!==(t=this.state.moduleName)&&void 0!==t?t:"Contacts",currentUserId:this.props.currentUserId}))}}]),a}(g.a.Component);Bl.contextType=Al;var ql=Object(S.a)((function(){return{root:{flexGrow:1,backgroundColor:"#ffffff"},messenger:{display:"grid",gridTemplateColumns:"1fr 3fr",height:"100%",background:"#eeeef1"},content:{position:"relative",background:"white",height:"100%"},conversationList:{borderRight:"1px solid #eeeef1",background:"white",height:"100%"},inboxZero:{padding:"50px"},helpIcon:{right:"50px",top:"5px",position:"absolute"},settingIcon:{right:"100px",top:"5px",position:"absolute"},addIcon:{right:"150px",top:"5px",position:"absolute"}}}))(Bl),Wl=a(1118),zl=a(376),Hl=a.n(zl),Yl=a(565),Gl=a.n(Yl),Ql=a(1099),Jl=a(573),Kl=a(1063),Zl=Object(Jl.a)({palette:{primary:Gl.a,secondary:Hl.a}});var Xl=function(e){return function(t){return h.createElement(Kl.a,{theme:Zl},h.createElement(Ql.a,null),h.createElement(e,t))}},$l=a(200);function ec(e){return tc.apply(this,arguments)}function tc(){return(tc=Object(s.a)(r.a.mark((function e(t){var a,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xa(t);case 2:return a=e.sent,n=a.fields.map((function(e){return{apiName:e.api_name,label:e.field_label}})),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ac=[{label:"Leads",value:"Leads"},{label:"Contacts",value:"Contacts"},{label:"Deals",value:"Deals"}],nc=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=t.call.apply(t,[this].concat(o))).state={crmModuleValue:e.props.selectedModule?e.props.selectedModule:""},e.loadOptions=function(t,a){var n=ac;n.map((function(e){return e.label})).includes(e.props.selectedModule)||n.push({label:e.props.selectedModule,value:e.props.selectedModule});var r=n.filter((function(e){return e.label.toLowerCase().includes(t.toLowerCase())}));if(e.props.selectedModule){var o={label:e.props.selectedModule,value:e.props.selectedModule};e.handleChange(o)}a(r)},e.handleChange=function(){var t=Object(s.a)(r.a.mark((function t(a){var n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.props.setLoading(!0),e.setState({crmModuleValue:a}),e.props.handleChangeModule(a.label),t.next=5,ec(a.label);case 5:n=t.sent,e.props.setSelectedModuleMergeFields(n),e.props.setLoading(!1);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e}return Object(l.a)(a,[{key:"render",value:function(){return g.a.createElement($l.a,{className:this.props.classes.crm,cacheOptions:!0,defaultInputValue:this.state.crmModuleValue,loadOptions:this.loadOptions,defaultOptions:!0,onChange:this.handleChange})}}]),a}(g.a.Component),rc=Xl(Vt()((function(){return Ut()({root:{textAlign:"center",paddingTop:"10px"},crm:{marginBottom:10,fontFamily:'"ProximaNovaRegular",sans-serif'}})}))(nc)),oc=a(82),sc={root:{width:"100%",fontFamily:'"ProximaNovaRegular",sans-serif',margin:"auto",fontSize:"12pt",textAlign:"left"},editor:{borderRadius:4,minHeight:212,padding:10,background:"#ffffff",color:"#5c5c5c",border:"1px #CCCCCC solid"},suggestions:{borderRadius:3,margin:0,padding:0,background:"#333333",listStyleType:"none",height:"254px",width:"232px",overflow:"auto"},person:{margin:0,padding:"16px 24px",color:"white"},selectedPerson:{margin:0,padding:"16px 24px",background:"#5c5c5c",color:"white",borderRadius:3},link:{color:"#333333"}},ic=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e=this.props,t=e.autocompleteState,a=e.renderSuggestion;if(!t)return null;var n=t.left,r=t.top,o=Object(_.a)(Object(_.a)({},sc.suggestions),{},{position:"absolute",left:n,top:r}),s=t.searchText;return g.a.createElement("ul",{style:o}," ",this.props.mergeFields.filter((function(e){return e.label.toLowerCase().substring(0,s.length)===s.toLowerCase()})).map((function(e){return g.a.createElement("li",{key:e.apiName,style:sc.person,onMouseDown:function(){return a(e.apiName)}}," ",e.label)}),this)," ")}}]),a}(g.a.Component);function lc(e){return"#"===e.key?"myeditor-save":Object(oc.getDefaultKeyBinding)(e)}var cc=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).autocompleteState=void 0,e.state={editorState:e.props.handleUpdateMessage&&e.props.handleUpdateMessage.value?oc.EditorState.createWithContent(oc.ContentState.createFromText(e.props.handleUpdateMessage.value)):oc.EditorState.createEmpty(),autocompleteState:null},e.textInput=Object(h.createRef)(),e.focusInput=function(){e.textInput.current.focus()},e.handleKeyCommand=function(t,a){if("myeditor-save"===t){var n=a.getSelection(),r=a.getCurrentContent(),o=oc.Modifier.insertText(r,n,"#"),s=oc.EditorState.push(a,o,"insert-hashtag");return e.setState({editorState:s},(function(){var t=e.getAutocompleteState(!0,"#");e.setState({autocompleteState:{searchText:t.text.slice(1,t.text.length),selectedIndex:0,left:t.left,top:t.top}})})),"handled"}return"not-handled"},e.onChange=function(t){e.setState({editorState:t},(function(){if(null!==e.state.autocompleteState){var t=e.getAutocompleteState(!0,"#");if(!t)return void e.setState({autocompleteState:null});e.setState({autocompleteState:{searchText:t.text.slice(1,t.text.length),selectedIndex:0,left:t.left,top:t.top}})}}));var a=e.state.editorState.getCurrentContent(),n=Object(oc.convertToRaw)(a).blocks.map((function(e){return e.text}));e.props.handlerFromMessage(n.join("\n"))},e.getTriggerRange=function(e){var t=window.getSelection();if(!t||0===t.rangeCount)return null;var a=t.getRangeAt(0),n=a.startContainer.textContent;if(n=n.substring(0,a.startOffset),/\s+$/.test(n))return null;var r=n.lastIndexOf(e);return-1===r?null:{text:n.substring(r),start:r,end:a.startOffset}},e.addHashTag=function(t,a,n){var r=e.getInsertState(a,t),o=r.start,s=r.end,i=t.getSelection().merge({anchorOffset:o,focusOffset:s}),l=t.getCurrentContent().createEntity("HASHTAG","IMMUTABLE",{hashtag:n}),c=l.getLastCreatedEntityKey(),u=oc.Modifier.replaceText(l,i,"#".concat(n),["link","BOLD"],c),d=i.getAnchorKey();t.getCurrentContent().getBlockForKey(d).getLength()===s&&(u=oc.Modifier.insertText(u,u.getSelectionAfter()," "));var m=oc.EditorState.push(t,u,"insert-hashtag");return oc.EditorState.forceSelection(m,u.getSelectionAfter())},e.renderSuggestion=function(t){var a=e.state,n=a.editorState,r=a.autocompleteState;e.onChange(e.addHashTag(n,r,t)),e.setState({autocompleteState:null})},e}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.props.handleUpdateMessage&&this.textInput&&this.textInput.current&&(this.props.handleUpdateMessage.value?(this.setState({autocompleteState:null}),this.textInput.current.focus(),this.setState({editorState:oc.EditorState.moveFocusToEnd(oc.EditorState.createWithContent(oc.ContentState.createFromText(this.props.handleUpdateMessage.value)))})):this.setState({editorState:oc.EditorState.createEmpty()}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getInsertState",value:function(e,t){var a=t.getSelection(),n=a.getAnchorOffset(),r=a.getAnchorKey();return{start:t.getCurrentContent().getBlockForKey(r).getText().substring(0,n).lastIndexOf("#"),end:n}}},{key:"getAutocompleteState",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;if(!e)return this.autocompleteState;var a=this.getTriggerRange(t);if(!a)return this.autocompleteState=null,null;var n=null;(n=a)||(n=a.start?a:null);var r=window.getSelection().getRangeAt(0).cloneRange();r.setStart(r.startContainer,n.start);var o=r.getBoundingClientRect(),s=[o.left,o.bottom],i=s[0],l=s[1];return this.autocompleteState={triggers:t,left:i,top:l,text:n.text,selectedIndex:0},this.autocompleteState}},{key:"render",value:function(){var e=this,t=this.state,a=t.autocompleteState,n=t.editorState;return g.a.createElement("div",{style:sc.root},g.a.createElement("div",{style:sc.editor,onClick:this.focusInput},g.a.createElement(oc.Editor,{customStyleMap:sc,editorState:n,keyBindingFn:lc,handleKeyCommand:this.handleKeyCommand,onChange:this.onChange,ref:this.textInput}),g.a.createElement(ic,{autocompleteState:a,mergeFields:[].concat(Object(w.a)(this.props.mergeFields),[{apiName:"Owner_Phone_Number",label:"Owner Phone Number"},{apiName:"Owner.First_Name",label:"Owner First Name"}]),renderSuggestion:function(t){return e.renderSuggestion(t)}})))}}]),a}(g.a.Component),uc=function(){var e=Object(s.a)(r.a.mark((function e(t,a,n,s){var i,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={Name:t,CustomModule_Name:t,Message:a,twiliosmsextension0__Message:a,Related_Module:n,twiliosmsextension0__Related_Module:n,twiliosmsextension0__Media_URLs:JSON.stringify(s)},l=Object(_.a)(Object(_.a)({},i),Object.entries(i).reduce((function(e,t){var a=Object(o.a)(t,2),n=a[0],r=a[1];return Object(_.a)(Object(_.a)({},e),{},Object($t.a)({},"twiliosmsextension0__".concat(n),r))}),{})),e.next=4,ht.a.CRM.API.insertRecord({Entity:"twiliosmsextension0__SMS_Templates",APIData:l});case 4:return e.abrupt("return");case 5:case"end":return e.stop()}}),e)})));return function(t,a,n,r){return e.apply(this,arguments)}}(),dc="#eff0f4",mc="#53c7f0",pc=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=t.call.apply(t,[this].concat(o))).state={templateName:"",relatedModule:e.props.currentModuleName,templateText:"",selectedMergeFields:[],loading:!0,uploadedImageFileNames:[],mediaURLs:[]},e.handleCreateTemplate=function(){var t=Object(s.a)(r.a.mark((function t(a){var n,o,s,i,l;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.preventDefault(),n=e.state.templateName,o=e.state.templateText,s=e.state.relatedModule,i=e.state.mediaURLs,e.setState({loading:!0}),t.next=8,uc(n,o,s,i);case 8:return t.next=10,Pn(s);case 10:l=t.sent,e.setState({loading:!1}),e.props.updateListOfTemplates(l),e.props.changeView("ListView"===e.props.widgetType?"bulk_sms":"send_sms");case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleChangeMessageText=function(t){e.setState({templateText:t})},e.handleBackToSMSTemplate=function(){var t=Object(s.a)(r.a.mark((function t(a){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a.preventDefault(),e.props.changeView("ListView"===e.props.widgetType?"bulk_sms":"send_sms");case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleChangeTemplateName=function(t){e.setState({templateName:t.currentTarget.value})},e.handleCrmModule=function(t){e.setState({relatedModule:t})},e.handleMergeFields=function(t){e.setState({selectedMergeFields:t})},e}return Object(l.a)(a,[{key:"render",value:function(){var e=this,t=!this.state.templateName.length;return h.createElement("div",{className:this.props.classes.root},h.createElement(jt,{loading:this.state.loading}),h.createElement("div",null,h.createElement("form",null,h.createElement("pre",{className:this.props.classes.fieldLabel},"Template Name\xa0*"),h.createElement(Wl.a,{labelWidth:0,className:this.props.classes.templateName,inputProps:{className:this.props.classes.input},value:this.state.templateName,name:"template",onChange:this.handleChangeTemplateName,error:t}),t&&h.createElement("pre",{className:this.props.classes.error},"Template Name is required"),h.createElement("pre",{className:this.props.classes.fieldLabel},"CRM Module"),h.createElement(rc,{selectedModule:this.state.relatedModule,handleChangeModule:this.handleCrmModule,setSelectedModuleMergeFields:this.handleMergeFields,setLoading:function(t){return e.setState({loading:t})}}),h.createElement("pre",{className:this.props.classes.fieldLabel},"Message"),h.createElement("p",null,"Press # to choose merge fields"),h.createElement(cc,{handlerFromMessage:this.handleChangeMessageText,mergeFields:this.state.selectedMergeFields}),h.createElement(xo,{handleImageUpload:function(t,a){e.setState({mediaURLs:t,uploadedImageFileNames:a})},uploadedImageFileNames:this.state.uploadedImageFileNames}),h.createElement("div",{className:this.props.classes.buttonSubmit},h.createElement(eo.a,{className:this.props.classes.backButton,variant:"contained",href:"",onClick:this.handleBackToSMSTemplate},"Back"),h.createElement(eo.a,{className:this.props.classes.addButton,variant:"contained",href:"",type:"submit",onClick:this.handleCreateTemplate,disabled:t},"Add")))))}}]),a}(h.Component),hc=Xl(Vt()((function(e){return Ut()({root:{textAlign:"center",paddingTop:e.spacing(2),marginLeft:e.spacing(5),marginRight:e.spacing(5)},backButton:{background:dc,fontSize:16,width:"17%",textTransform:"capitalize",marginRight:e.spacing(.5),fontFamily:'"ProximaNovaRegular",sans-serif'},addButton:{background:mc,fontSize:16,width:"17%",textTransform:"capitalize",marginLeft:e.spacing(.5),fontFamily:'"ProximaNovaRegular",sans-serif'},buttonSubmit:{paddingTop:e.spacing(3),paddingBottom:e.spacing(3)},message:{textAlign:"left",padding:e.spacing(.5),fontFamily:'"ProximaNovaRegular",sans-serif'},templateName:{width:"100%",focused:"blue",fontFamily:'"ProximaNovaRegular",sans-serif'},input:{padding:"8px"},cssFocused:{},cssLabel:{"&$cssFocused":{color:"blue"}},error:{color:"red",fontSize:12,fontFamily:'"ProximaNovaRegular",sans-serif'},fieldLabel:{marginTop:"1em",marginBottom:0,textAlign:"left",fontFamily:'"ProximaNovaRegular",sans-serif'}})}))(pc)),gc=function(){var e=Object(s.a)(r.a.mark((function e(t,a,n,o,s){var i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={Entity:"twiliosmsextension0__SMS_Templates",APIData:{id:o,Name:t,Message:a,twiliosmsextension0__Related_Module:n,twiliosmsextension0__Media_URLs:JSON.stringify(s)},Trigger:["workflow"]},e.next=3,ht.a.CRM.API.updateRecord(i);case 3:return e.abrupt("return",{label:t,template_id:o,relatedModule:n,value:a,mediaURLs:s});case 4:case"end":return e.stop()}}),e)})));return function(t,a,n,r,o){return e.apply(this,arguments)}}(),fc=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=t.call.apply(t,[this].concat(o))).state={templateId:"",templateName:"",relatedModule:"Leads",msgValue:"",moduleValue:"",selectedMergeFields:[],loading:!0,mediaURLs:[]},e.handleEditTemplate=function(){var t=Object(s.a)(r.a.mark((function t(a){var n,o,s,i,l,c,u;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.preventDefault(),n=e.state.templateName,o=e.state.msgValue,s=e.state.relatedModule,i=e.state.templateId,l=e.state.mediaURLs,e.setState({loading:!0}),t.next=9,gc(n,o,s,i,l);case 9:return c=t.sent,t.next=12,Pn(s);case 12:u=t.sent,e.setState({loading:!1}),e.props.changeSelectedTemplate(c),e.props.updateListOfTemplates(u),e.props.changeView("ListView"===e.props.widgetType?"bulk_sms":"send_sms");case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleChangeMessageText=function(t){e.setState({msgValue:t})},e.handleBackToSMSTemplate=function(t){t.preventDefault(),e.props.changeView("ListView"===e.props.widgetType?"bulk_sms":"send_sms")},e.handleChangeTemplateName=function(t){e.setState({templateName:t.currentTarget.value})},e.handleCrmModule=function(t){e.setState({relatedModule:t})},e.handleMergeFields=function(t){e.setState({selectedMergeFields:t})},e}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=Object(s.a)(r.a.mark((function e(){var t,a,n=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ht.a.CRM.API.getRecord({Entity:"twiliosmsextension0__SMS_Templates"}).then((function(e){return e.data.filter((function(e){return e.id===n.props.selectedTemplate.template_id}))}));case 2:t=e.sent,a=Le(t[0].twiliosmsextension0__Media_URLs,"mediaUrls",[]),this.setState({templateName:this.props.selectedTemplate.label,templateId:this.props.selectedTemplate.template_id,relatedModule:this.props.selectedTemplate.relatedModule,msgValue:this.props.selectedTemplate.value,mediaURLs:a});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeImage",value:function(e){var t=this.state.mediaURLs;t.splice(e,1),this.setState({mediaURLs:t})}},{key:"displayImage",value:function(){var e,t=this;return null===(e=this.state.mediaURLs)||void 0===e?void 0:e.map((function(e,a){return g.a.createElement("div",{key:a,style:{display:"inline",position:"relative"}},g.a.createElement(E.a,{"aria-label":"delete",size:"small",onClick:function(){return t.removeImage(a)},className:t.props.classes.xIcon},g.a.createElement(qt.a,null)),g.a.createElement("img",{src:e,alt:"template",style:{height:"100px",margin:"5px"}}))}))}},{key:"render",value:function(){var e=this,t=this.state.loading;return g.a.createElement("div",{className:this.props.classes.root},g.a.createElement(jt,{loading:t}),g.a.createElement("div",null,g.a.createElement("form",null,g.a.createElement("pre",{className:this.props.classes.fieldLabel},"Template Name"),g.a.createElement(Wl.a,{labelWidth:0,className:this.props.classes.templateName,inputProps:{className:this.props.classes.input},value:this.state.templateName,name:"template",onChange:this.handleChangeTemplateName}),g.a.createElement("pre",{className:this.props.classes.fieldLabel},"CRM Module"),g.a.createElement(rc,{selectedModule:this.props.selectedTemplate.relatedModule,handleChangeModule:this.handleCrmModule,setSelectedModuleMergeFields:this.handleMergeFields,setLoading:function(t){return e.setState({loading:t})}}),g.a.createElement("pre",{className:this.props.classes.fieldLabel},"Message"),g.a.createElement("p",null,"Press # to enter merge fields"),g.a.createElement(cc,{handleUpdateMessage:this.props.selectedTemplate,handlerFromMessage:this.handleChangeMessageText,mergeFields:this.state.selectedMergeFields}),g.a.createElement(xo,{mediaURLs:this.state.mediaURLs,handleImageUpload:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.state.mediaURLs;e.setState({mediaURLs:t})},uploadedImageFileNames:[]}),this.displayImage(),g.a.createElement("div",{className:this.props.classes.buttonSubmit},g.a.createElement(eo.a,{className:this.props.classes.backButton,variant:"contained",href:"",onClick:this.handleBackToSMSTemplate},"Back"),g.a.createElement(eo.a,{className:this.props.classes.addButton,variant:"contained",href:"",type:"submit",onClick:this.handleEditTemplate},"Update")))))}}]),a}(g.a.Component),vc=Vt()((function(e){return Ut()({root:{textAlign:"center",paddingTop:e.spacing(2),marginLeft:e.spacing(5),marginRight:e.spacing(5)},backButton:{background:dc,fontSize:16,width:"17%",textTransform:"capitalize",marginRight:e.spacing(.5),fontFamily:'"ProximaNovaRegular",sans-serif'},addButton:{background:mc,fontSize:16,width:"17%",textTransform:"capitalize",marginLeft:e.spacing(.5),fontFamily:'"ProximaNovaRegular",sans-serif'},buttonSubmit:{paddingTop:e.spacing(3),paddingBottom:e.spacing(3)},message:{textAlign:"left",padding:e.spacing(.5),fontFamily:'"ProximaNovaRegular",sans-serif'},templateName:{width:"100%",focused:"blue",fontFamily:'"ProximaNovaRegular",sans-serif'},input:{padding:"8px"},cssFocused:{},cssLabel:{"&$cssFocused":{color:"blue"}},xIcon:{position:"absolute",color:"black",backgroundColor:"white",right:0,zIndex:2},fieldLabel:{marginTop:"1em",marginBottom:0,textAlign:"left",fontFamily:'"ProximaNovaRegular",sans-serif'}})}))(fc),bc=a(1103),yc=a(243),Sc=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleChange=function(t){t&&(e.setState({fromNumber:t}),e.props.handleChangedFromNumber(t))},e.getOptions=function(t,a){a((e.props.fromNumbers||[]).filter((function(e){return e.name.toLowerCase().includes(t.toLowerCase())})))},e}return Object(l.a)(a,[{key:"render",value:function(){return h.createElement($l.a,{className:this.props.classes.crm,loadOptions:this.getOptions,defaultOptions:!0,defaultValue:this.props.selectedFromNumber,onChange:this.handleChange})}}]),a}(h.Component),wc=Xl(Vt()((function(){return Ut()({root:{textAlign:"center",paddingTop:"10px"},crm:{marginBottom:10,fontFamily:'"ProximaNovaRegular",sans-serif'}})}))(Sc)),_c=a(566),xc=a.n(_c),Cc=a(567),kc=a.n(Cc),Ec=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).Row=function(t){var a=t.index,n=t.style,r=t.key;return h.createElement("div",{key:r,style:n,className:e.props.classes.row},h.createElement("p",null,e.props.selectedNumbers[a].label))},e}return Object(l.a)(a,[{key:"render",value:function(){var e=this,t=this.props.selectedNumbers;return h.createElement("div",{className:this.props.classes.root},h.createElement(xc.a,{disableHeight:!0},(function(a){var n=a.width;return h.createElement(kc.a,{rowCount:t.length,width:n,height:t.length<=10?25*t.length:250,rowHeight:function(e){var a=e.index;return t[a].label&&t[a].label.length>65?50:25},rowRenderer:e.Row})})))}}]),a}(h.Component),Tc=Xl(Vt()((function(){return Ut()({root:{background:"#fff",border:"1px solid hsl(0,0%,80%)",borderRadius:5},row:{display:"flex",alignItems:"center",padding:"4px 10px","& > p":{margin:0,textAlign:"left"}}})}))(Ec)),Nc=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=t.call.apply(t,[this].concat(o))).state={smsTextContent:""},e.loadOptions=function(t,a){a((e.props.smsTemplates||[]).filter((function(e){var a,n;return null===(a=e.label)||void 0===a||null===(n=a.toLowerCase())||void 0===n?void 0:n.includes(t.toLowerCase())})).sort((function(e,t){return e.label.localeCompare(t.label)})))},e.handleSelectTemplate=function(){var t=Object(s.a)(r.a.mark((function t(a){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.setState({smsTextContent:a}),a&&e.props.handleChangeTemplate(a);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e}return Object(l.a)(a,[{key:"render",value:function(){return h.createElement(h.Fragment,null,h.createElement($l.a,{className:this.props.classes.crm,cacheOptions:!0,loadOptions:this.loadOptions,defaultOptions:!0,defaultValue:this.props.selectedTemplate,onChange:this.handleSelectTemplate}))}}]),a}(h.Component),Ic=Xl(Vt()((function(){return Ut()({root:{textAlign:"center",paddingTop:10},crm:{background:dc,fontSize:16,width:"81%",marginRight:"15px",fontFamily:"ProximaNovaRegular"},editTemplate:{lineHeight:"1.429rem",display:"inline",textTransform:"none",marginBottom:"2px",color:"#a2a2a2",fontSize:".857rem","&:hover":{color:"#333",backgroundColor:"none!important"}},editLabel:{marginLeft:"10px"}})}))(Nc)),Oc=["${"],Mc=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"showMergeFieldError",value:function(){var e=this;return Oc.some((function(t){var a;return-1!==((null===(a=e.props)||void 0===a?void 0:a.messageText)||"").indexOf(t)}))?["It looks like you're trying to use merge fields","in your message but you have not used the correct format.","Please click add template/edit template and press # to add merge fields."].join(" "):""}},{key:"render",value:function(){return h.createElement(h.Fragment,null,h.createElement("p",{className:this.props.classes.errorMessage},this.showMergeFieldError()),h.createElement(Do.a,{required:!0,value:this.props.messageText,onChange:this.props.onMessageChange,multiline:!0,rows:2,rowsMax:4,variant:"outlined",className:this.props.classes.editor,inputProps:{className:this.props.classes.textArea},InputProps:{className:this.props.classes.texting}}))}}]),a}(h.Component),Pc=Xl(Vt()((function(e){return Ut()({root:{textAlign:"center",paddingTop:e.spacing(10)},textArea:{height:"165px!important",backgroundColor:"white"},texting:{backgroundColor:"white"},editor:{minWidth:"100%"},errorMessage:{color:"red",fontSize:12.5,marginTop:10,textAlign:"left"}})}))(Mc));function Ac(){return Dc.apply(this,arguments)}function Dc(){return(Dc=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ht.a.CRM.UI.Popup.close().then((function(e){return e}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function jc(){return Rc.apply(this,arguments)}function Rc(){return(Rc=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ht.a.CRM.UI.Popup.closeReload().then((function(e){return e}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Fc=a(568),Uc=[{value:"+93",label:"+93 Afghanistan",hasSmsSupport:!1,hasVoiceSupport:!1,code:"AFG",price:.0995},{value:"+358",label:"+358 Aland Islands",hasSmsSupport:!1,hasVoiceSupport:!1,code:"ALA",price:0},{value:"+355",label:"+355 Albania",hasSmsSupport:!1,hasVoiceSupport:!1,code:"ALB",price:.08667},{value:"+213",label:"+213 Algeria",hasSmsSupport:!1,hasVoiceSupport:!0,code:"DZA",price:.0995},{value:"+685",label:"+685 Samoa",hasSmsSupport:!1,hasVoiceSupport:!1,code:"WSM",price:.04983},{value:"+376",label:"+376 Andorra",hasSmsSupport:!1,hasVoiceSupport:!1,code:"AND",price:.0995},{value:"+244",label:"+244 Angola",hasSmsSupport:!1,hasVoiceSupport:!1,code:"AGO",price:.06067},{value:"+1264",label:"+1264 Anguilla",hasSmsSupport:!1,hasVoiceSupport:!1,code:"AIA",price:.048},{value:"+672",label:"+672 Antarctica",hasSmsSupport:!1,hasVoiceSupport:!1,code:"ATA",price:0},{value:"+1268",label:"+1268 Antigua and Barbuda",hasSmsSupport:!1,hasVoiceSupport:!1,code:"ATG",price:.045},{value:"+54",label:"+54 Argentina",hasSmsSupport:!1,hasVoiceSupport:!0,code:"ARG",price:.0691},{value:"+374",label:"+374 Armenia",hasSmsSupport:!1,hasVoiceSupport:!1,code:"ARM",price:.0792},{value:"+297",label:"+297 Aruba",hasSmsSupport:!1,hasVoiceSupport:!1,code:"ABW",price:.0595},{value:"+61",label:"+61 Australia",hasSmsSupport:!0,hasVoiceSupport:!0,code:"AUS",price:.055},{value:"+43",label:"+43 Austria",hasSmsSupport:!0,hasVoiceSupport:!0,code:"AUT",price:.09317},{value:"+994",label:"+994 Azerbaijan",hasSmsSupport:!1,hasVoiceSupport:!1,code:"AZE",price:.143},{value:"+1242",label:"+1242 Bahamas",hasSmsSupport:!1,hasVoiceSupport:!1,code:"BHS",price:.05},{value:"+973",label:"+973 Bahrain",hasSmsSupport:!1,hasVoiceSupport:!1,code:"BHR",price:.0235},{value:"+880",label:"+880 Bangladesh",hasSmsSupport:!1,hasVoiceSupport:!1,code:"BGD",price:.0995},{value:"+1-246",label:"+1-246 Barbados",hasSmsSupport:!1,hasVoiceSupport:!0,code:"BRB",price:.03467},{value:"+375",label:"+375 Belarus",hasSmsSupport:!1,hasVoiceSupport:!1,code:"BLR",price:.1295},{value:"+32",label:"+32 Belgium",hasSmsSupport:!1,hasVoiceSupport:!0,code:"BEL",price:.1},{value:"+501",label:"+501 Belize",hasSmsSupport:!1,hasVoiceSupport:!1,code:"BLZ",price:.0845},{value:"+229",label:"+229 Benin",hasSmsSupport:!1,hasVoiceSupport:!0,code:"BEN",price:.05417},{value:"+1441",label:"+1441 Bermuda",hasSmsSupport:!1,hasVoiceSupport:!1,code:"BMU",price:.051},{value:"+975",label:"+975 Bhutan",hasSmsSupport:!1,hasVoiceSupport:!1,code:"BTN",price:.1095},{value:"+591",label:"+591 Bolivia, Plurinational State of Bolivia",hasSmsSupport:!1,hasVoiceSupport:!1,code:"BOL",price:.0591},{value:"+387",label:"+387 Bosnia and Herzegovina",hasSmsSupport:!1,hasVoiceSupport:!0,code:"BIH",price:.08},{value:"+267",label:"+267 Botswana",hasSmsSupport:!1,hasVoiceSupport:!1,code:"BWA",price:.095},{value:"+47",label:"+47 Bouvet Island",hasSmsSupport:!1,hasVoiceSupport:!1,code:"BVT",price:0},{value:"+55",label:"+55 Brazil",hasSmsSupport:!1,hasVoiceSupport:!0,code:"BRA",price:.057},{value:"+91",label:"+91 India",hasSmsSupport:!1,hasVoiceSupport:!0,code:"IND",price:.0175},{value:"+673",label:"+673 Brunei Darussalam",hasSmsSupport:!1,hasVoiceSupport:!1,code:"BRN",price:.019},{value:"+359",label:"+359 Bulgaria",hasSmsSupport:!1,hasVoiceSupport:!0,code:"BGR",price:.08},{value:"+226",label:"+226 Burkina Faso",hasSmsSupport:!1,hasVoiceSupport:!1,code:"BFA",price:.03467},{value:"+257",label:"+257 Burundi",hasSmsSupport:!1,hasVoiceSupport:!1,code:"BDI",price:.081},{value:"+855",label:"+855 Cambodia",hasSmsSupport:!1,hasVoiceSupport:!1,code:"KHM",price:.0695},{value:"+237",label:"+237 Cameroon",hasSmsSupport:!1,hasVoiceSupport:!1,code:"CMR",price:.07583},{value:"+1-246",label:"+1-246 Canada",hasSmsSupport:!0,hasVoiceSupport:!0,code:"CAN",price:.0075},{value:"+238",label:"+238 Cape Verde",hasSmsSupport:!1,hasVoiceSupport:!1,code:"CPV",price:.07367},{value:"+1-345",label:"+1-345 Cayman Islands",hasSmsSupport:!1,hasVoiceSupport:!0,code:"CYM",price:.049},{value:"+236",label:"+236 Central African Republic",hasSmsSupport:!1,hasVoiceSupport:!1,code:"CAF",price:.019},{value:"+235",label:"+235 Chad",hasSmsSupport:!1,hasVoiceSupport:!1,code:"TCD",price:.08},{value:"+56",label:"+56 Chile",hasSmsSupport:!0,hasVoiceSupport:!0,code:"CHL",price:.058},{value:"+86",label:"+86 China",hasSmsSupport:!1,hasVoiceSupport:!1,code:"CHN",price:.028},{value:"+61",label:"+61 Christmas Island",hasSmsSupport:!1,hasVoiceSupport:!1,code:"CXR",price:0},{value:"+61",label:"+61 Cocos (Keeling) Islands",hasSmsSupport:!1,hasVoiceSupport:!1,code:"CCK",price:0},{value:"+57",label:"+57 Colombia",hasSmsSupport:!1,hasVoiceSupport:!0,code:"COL",price:.05},{value:"+269",label:"+269 Comoros",hasSmsSupport:!1,hasVoiceSupport:!1,code:"COM",price:.0695},{value:"+242",label:"+242 Congo",hasSmsSupport:!1,hasVoiceSupport:!1,code:"COG",price:.05},{value:"+243",label:"+243 Congo, The Democratic Republic of the Congo",hasSmsSupport:!1,hasVoiceSupport:!1,code:"COD",price:.03},{value:"+682",label:"+682 Cook Islands",hasSmsSupport:!1,hasVoiceSupport:!1,code:"COK",price:.0445},{value:"+506",label:"+506 Costa Rica",hasSmsSupport:!1,hasVoiceSupport:!0,code:"CRI",price:.04},{value:"+225",label:"+225 Cote d'Ivoire",hasSmsSupport:!1,hasVoiceSupport:!1,code:"CIV",price:0},{value:"+385",label:"+385 Croatia",hasSmsSupport:!1,hasVoiceSupport:!1,code:"HRV",price:.0494},{value:"+53",label:"+53 Cuba",hasSmsSupport:!1,hasVoiceSupport:!1,code:"CUB",price:.08},{value:"+357",label:"+357 Cyprus",hasSmsSupport:!1,hasVoiceSupport:!0,code:"CYP",price:.08233},{value:"+420",label:"+420 Czech Republic",hasSmsSupport:!0,hasVoiceSupport:!0,code:"CZE",price:.049},{value:"+45",label:"+45 Denmark",hasSmsSupport:!0,hasVoiceSupport:!0,code:"DNK",price:.0275},{value:"+253",label:"+253 Djibouti",hasSmsSupport:!1,hasVoiceSupport:!1,code:"DJI",price:.1},{value:"+1767",label:"+1767 Dominica",hasSmsSupport:!1,hasVoiceSupport:!1,code:"DMA",price:.048},{value:"+1-809, 1-829, 1-849",label:"+1-809, 1-829, 1-849 Dominican Republic",hasSmsSupport:!1,hasVoiceSupport:!0,code:"DOM",price:.057},{value:"+593",label:"+593 Ecuador",hasSmsSupport:!1,hasVoiceSupport:!0,code:"ECU",price:.09},{value:"+20",label:"+20 Egypt",hasSmsSupport:!1,hasVoiceSupport:!0,code:"EGY",price:.0845},{value:"+503",label:"+503 El Salvador",hasSmsSupport:!1,hasVoiceSupport:!0,code:"SLV",price:.0433},{value:"+240",label:"+240 Equatorial Guinea",hasSmsSupport:!1,hasVoiceSupport:!1,code:"GNQ",price:.02},{value:"+291",label:"+291 Eritrea",hasSmsSupport:!1,hasVoiceSupport:!1,code:"ERI",price:.1},{value:"+372",label:"+372 Estonia",hasSmsSupport:!0,hasVoiceSupport:!0,code:"EST",price:.0845},{value:"+268",label:"+268 Eswatini",hasSmsSupport:!1,hasVoiceSupport:!1,code:"SWZ",price:0},{value:"+251",label:"+251 Ethiopia",hasSmsSupport:!1,hasVoiceSupport:!1,code:"ETH",price:.0651},{value:"+500",label:"+500 Falkland Islands (Malvinas)",hasSmsSupport:!1,hasVoiceSupport:!1,code:"FLK",price:.1295},{value:"+298",label:"+298 Faroe Islands",hasSmsSupport:!1,hasVoiceSupport:!1,code:"FRO",price:.01625},{value:"+679",label:"+679 Fiji",hasSmsSupport:!1,hasVoiceSupport:!1,code:"FJI",price:.1},{value:"+358",label:"+358 Finland",hasSmsSupport:!1,hasVoiceSupport:!0,code:"FIN",price:.082},{value:"+33",label:"+33 France",hasSmsSupport:!0,hasVoiceSupport:!0,code:"FRA",price:.076},{value:"+594",label:"+594 French Guiana",hasSmsSupport:!1,hasVoiceSupport:!1,code:"GUF",price:.14733},{value:"+689",label:"+689 French Polynesia",hasSmsSupport:!1,hasVoiceSupport:!1,code:"PYF",price:.17117},{value:"+241",label:"+241 Gabon",hasSmsSupport:!1,hasVoiceSupport:!1,code:"GAB",price:.1045},{value:"+220",label:"+220 Gambia",hasSmsSupport:!1,hasVoiceSupport:!1,code:"GMB",price:.0295},{value:"+995",label:"+995 Georgia",hasSmsSupport:!1,hasVoiceSupport:!1,code:"GEO",price:.115},{value:"+49",label:"+49 Germany",hasSmsSupport:!0,hasVoiceSupport:!0,code:"DEU",price:.0895},{value:"+233",label:"+233 Ghana",hasSmsSupport:!1,hasVoiceSupport:!0,code:"GHA",price:.0545},{value:"+350",label:"+350 Gibraltar",hasSmsSupport:!1,hasVoiceSupport:!1,code:"GIB",price:.03},{value:"+30",label:"+30 Greece",hasSmsSupport:!1,hasVoiceSupport:!0,code:"GRC",price:.059},{value:"+299",label:"+299 Greenland",hasSmsSupport:!1,hasVoiceSupport:!1,code:"GRL",price:.039},{value:"+1-473",label:"+1-473 Grenada",hasSmsSupport:!1,hasVoiceSupport:!0,code:"GRD",price:.055},{value:"+590",label:"+590 Guadeloupe",hasSmsSupport:!1,hasVoiceSupport:!1,code:"GLP",price:.092},{value:"+1671",label:"+1671 Guam",hasSmsSupport:!1,hasVoiceSupport:!1,code:"GUM",price:.051},{value:"+502",label:"+502 Guatemala",hasSmsSupport:!1,hasVoiceSupport:!1,code:"GTM",price:.04983},{value:"+44",label:"+44 Guernsey",hasSmsSupport:!1,hasVoiceSupport:!1,code:"GGY",price:.03},{value:"+224",label:"+224 Guinea",hasSmsSupport:!1,hasVoiceSupport:!1,code:"GIN",price:.1105},{value:"+245",label:"+245 Guinea-Bissau",hasSmsSupport:!1,hasVoiceSupport:!1,code:"GNB",price:.15},{value:"+592",label:"+592 Guyana",hasSmsSupport:!1,hasVoiceSupport:!1,code:"GUY",price:.047},{value:"+509",label:"+509 Haiti",hasSmsSupport:!1,hasVoiceSupport:!1,code:"HTI",price:.0645},{value:"+672",label:"+672 Heard Island and Mcdonald Islands",hasSmsSupport:!1,hasVoiceSupport:!1,code:"HMD",price:0},{value:"+379",label:"+379 Holy See (Vatican City State)",hasSmsSupport:!1,hasVoiceSupport:!1,code:"VAT",price:0},{value:"+504",label:"+504 Honduras",hasSmsSupport:!1,hasVoiceSupport:!1,code:"HND",price:.0502},{value:"+852",label:"+852 Hong Kong",hasSmsSupport:!0,hasVoiceSupport:!1,code:"HKG",price:.0545},{value:"+36",label:"+36 Hungary",hasSmsSupport:!0,hasVoiceSupport:!0,code:"HUN",price:.09},{value:"+354",label:"+354 Iceland",hasSmsSupport:!1,hasVoiceSupport:!0,code:"ISL",price:.055},{value:"+62",label:"+62 Indonesia",hasSmsSupport:!1,hasVoiceSupport:!0,code:"IDN",price:.0714},{value:"+98",label:"+98 Iran, Islamic Republic of Persian Gulf",hasSmsSupport:!1,hasVoiceSupport:!1,code:"IRN",price:.0445},{value:"+964",label:"+964 Iraq",hasSmsSupport:!1,hasVoiceSupport:!1,code:"IRQ",price:.0445},{value:"+353",label:"+353 Ireland",hasSmsSupport:!1,hasVoiceSupport:!1,code:"IRL",price:.07},{value:"+44-1624",label:"+44-1624 Isle of Man",hasSmsSupport:!1,hasVoiceSupport:!0,code:"IMN",price:0},{value:"+972",label:"+972 Israel",hasSmsSupport:!0,hasVoiceSupport:!0,code:"ISR",price:.0475},{value:"+39",label:"+39 Italy",hasSmsSupport:!0,hasVoiceSupport:!1,code:"ITA",price:.0883},{value:"+1-876",label:"+1-876 Jamaica",hasSmsSupport:!1,hasVoiceSupport:!0,code:"JAM",price:.0511},{value:"+81",label:"+81 Japan",hasSmsSupport:!1,hasVoiceSupport:!0,code:"JPN",price:.08},{value:"+44",label:"+44 Jersey",hasSmsSupport:!1,hasVoiceSupport:!1,code:"JEY",price:.039},{value:"+962",label:"+962 Jordan",hasSmsSupport:!1,hasVoiceSupport:!1,code:"JOR",price:.1195},{value:"+77",label:"+77 Kazakhstan",hasSmsSupport:!1,hasVoiceSupport:!1,code:"KAZ",price:.115},{value:"+254",label:"+254 Kenya",hasSmsSupport:!1,hasVoiceSupport:!0,code:"KEN",price:.0645},{value:"+686",label:"+686 Kiribati",hasSmsSupport:!1,hasVoiceSupport:!1,code:"KIR",price:.08},{value:"+850",label:"+850 Korea, Democratic People's Republic of Korea",hasSmsSupport:!1,hasVoiceSupport:!1,code:"PRK",price:0},{value:"+383",label:"+383 Kosovo",hasSmsSupport:!1,hasVoiceSupport:!1,code:"XKX",price:.09},{value:"+965",label:"+965 Kuwait",hasSmsSupport:!1,hasVoiceSupport:!1,code:"KWT",price:.0545},{value:"+996",label:"+996 Kyrgyzstan",hasSmsSupport:!1,hasVoiceSupport:!1,code:"KGZ",price:.1195},{value:"+856",label:"+856 Laos",hasSmsSupport:!1,hasVoiceSupport:!1,code:"LAO",price:.0545},{value:"+371",label:"+371 Latvia",hasSmsSupport:!1,hasVoiceSupport:!1,code:"LVA",price:.0715},{value:"+961",label:"+961 Lebanon",hasSmsSupport:!1,hasVoiceSupport:!1,code:"LBN",price:.0595},{value:"+266",label:"+266 Lesotho",hasSmsSupport:!1,hasVoiceSupport:!1,code:"LSO",price:.082},{value:"+231",label:"+231 Liberia",hasSmsSupport:!1,hasVoiceSupport:!1,code:"LBR",price:.07},{value:"+218",label:"+218 Libyan Arab Jamahiriya",hasSmsSupport:!1,hasVoiceSupport:!1,code:"LBY",price:.0995},{value:"+423",label:"+423 Liechtenstein",hasSmsSupport:!1,hasVoiceSupport:!1,code:"LIE",price:.03033},{value:"+370",label:"+370 Lithuania",hasSmsSupport:!0,hasVoiceSupport:!0,code:"LTU",price:.041},{value:"+352",label:"+352 Luxembourg",hasSmsSupport:!1,hasVoiceSupport:!1,code:"LUX",price:.0845},{value:"+853",label:"+853 Macau",hasSmsSupport:!1,hasVoiceSupport:!0,code:"MAC",price:.031},{value:"+389",label:"+389 Macedonia",hasSmsSupport:!1,hasVoiceSupport:!1,code:"MKD",price:.08667},{value:"+261",label:"+261 Madagascar",hasSmsSupport:!1,hasVoiceSupport:!0,code:"MDG",price:.045},{value:"+265",label:"+265 Malawi",hasSmsSupport:!1,hasVoiceSupport:!1,code:"MWI",price:.0645},{value:"+60",label:"+60 Malaysia",hasSmsSupport:!0,hasVoiceSupport:!1,code:"MYS",price:.049},{value:"+960",label:"+960 Maldives",hasSmsSupport:!1,hasVoiceSupport:!1,code:"MDV",price:.0295},{value:"+223",label:"+223 Mali",hasSmsSupport:!1,hasVoiceSupport:!0,code:"MLI",price:.1},{value:"+356",label:"+356 Malta",hasSmsSupport:!1,hasVoiceSupport:!1,code:"MLT",price:.0495},{value:"+692",label:"+692 Marshall Islands",hasSmsSupport:!1,hasVoiceSupport:!1,code:"MHL",price:.12},{value:"+596",label:"+596 Martinique",hasSmsSupport:!1,hasVoiceSupport:!1,code:"MTQ",price:.1},{value:"+222",label:"+222 Mauritania",hasSmsSupport:!1,hasVoiceSupport:!1,code:"MRT",price:.09},{value:"+230",label:"+230 Mauritius",hasSmsSupport:!1,hasVoiceSupport:!0,code:"MUS",price:.065},{value:"+262",label:"+262 Reunion",hasSmsSupport:!1,hasVoiceSupport:!1,code:"REU",price:.13433},{value:"+52",label:"+52 Mexico",hasSmsSupport:!0,hasVoiceSupport:!0,code:"MEX",price:.049},{value:"+691",label:"+691 Micronesia, Federated States of Micronesia",hasSmsSupport:!1,hasVoiceSupport:!1,code:"FSM",price:.07},{value:"+373",label:"+373 Moldova",hasSmsSupport:!1,hasVoiceSupport:!0,code:"MDA",price:.06},{value:"+377",label:"+377 Monaco",hasSmsSupport:!1,hasVoiceSupport:!1,code:"MCO",price:.15167},{value:"+976",label:"+976 Mongolia",hasSmsSupport:!1,hasVoiceSupport:!1,code:"MNG",price:.0695},{value:"+382",label:"+382 Montenegro",hasSmsSupport:!1,hasVoiceSupport:!1,code:"MNE",price:.043},{value:"+1664",label:"+1664 Montserrat",hasSmsSupport:!1,hasVoiceSupport:!1,code:"MSR",price:.048},{value:"+212",label:"+212 Morocco",hasSmsSupport:!1,hasVoiceSupport:!1,code:"MAR",price:.078},{value:"+258",label:"+258 Mozambique",hasSmsSupport:!1,hasVoiceSupport:!1,code:"MOZ",price:.03},{value:"+95",label:"+95 Myanmar",hasSmsSupport:!1,hasVoiceSupport:!1,code:"MMR",price:.10833},{value:"+264",label:"+264 Namibia",hasSmsSupport:!1,hasVoiceSupport:!1,code:"NAM",price:.04},{value:"+674",label:"+674 Nauru",hasSmsSupport:!1,hasVoiceSupport:!1,code:"NRU",price:0},{value:"+977",label:"+977 Nepal",hasSmsSupport:!1,hasVoiceSupport:!1,code:"NPL",price:.105},{value:"+31",label:"+31 Netherlands",hasSmsSupport:!0,hasVoiceSupport:!0,code:"NLD",price:.1},{value:"+599",label:"+599 Netherlands Antilles",hasSmsSupport:!1,hasVoiceSupport:!1,code:"ANT",price:.0645},{value:"+687",label:"+687 New Caledonia",hasSmsSupport:!1,hasVoiceSupport:!1,code:"NCL",price:.14},{value:"+64",label:"+64 New Zealand",hasSmsSupport:!1,hasVoiceSupport:!0,code:"NZL",price:.1},{value:"+505",label:"+505 Nicaragua",hasSmsSupport:!1,hasVoiceSupport:!0,code:"NIC",price:.059},{value:"+227",label:"+227 Niger",hasSmsSupport:!1,hasVoiceSupport:!1,code:"NER",price:.0645},{value:"+234",label:"+234 Nigeria",hasSmsSupport:!1,hasVoiceSupport:!1,code:"NGA",price:.0995},{value:"+683",label:"+683 Niue",hasSmsSupport:!1,hasVoiceSupport:!1,code:"NIU",price:.01},{value:"+672",label:"+672 Norfolk Island",hasSmsSupport:!1,hasVoiceSupport:!1,code:"NFK",price:.02817},{value:"+1670",label:"+1670 Northern Mariana Islands",hasSmsSupport:!1,hasVoiceSupport:!1,code:"MNP",price:.051},{value:"+47",label:"+47 Norway",hasSmsSupport:!1,hasVoiceSupport:!1,code:"NOR",price:.062},{value:"+968",label:"+968 Oman",hasSmsSupport:!1,hasVoiceSupport:!1,code:"OMN",price:.05},{value:"+92",label:"+92 Pakistan",hasSmsSupport:!1,hasVoiceSupport:!1,code:"PAK",price:.0545},{value:"+680",label:"+680 Palau",hasSmsSupport:!1,hasVoiceSupport:!1,code:"PLW",price:.095},{value:"+970",label:"+970 Palestinian Territory, Occupied",hasSmsSupport:!1,hasVoiceSupport:!1,code:"PSE",price:.1195},{value:"+507",label:"+507 Panama",hasSmsSupport:!1,hasVoiceSupport:!0,code:"PAN",price:.059},{value:"+675",label:"+675 Papua New Guinea",hasSmsSupport:!1,hasVoiceSupport:!1,code:"PNG",price:.04},{value:"+595",label:"+595 Paraguay",hasSmsSupport:!1,hasVoiceSupport:!1,code:"PRY",price:.016},{value:"+51",label:"+51 Peru",hasSmsSupport:!1,hasVoiceSupport:!1,code:"PER",price:.044},{value:"+63",label:"+63 Philippines",hasSmsSupport:!0,hasVoiceSupport:!0,code:"PHL",price:.0495},{value:"+64",label:"+64 Pitcairn",hasSmsSupport:!1,hasVoiceSupport:!1,code:"PCN",price:0},{value:"+48",label:"+48 Poland",hasSmsSupport:!0,hasVoiceSupport:!1,code:"POL",price:.041},{value:"+351",label:"+351 Portugal",hasSmsSupport:!0,hasVoiceSupport:!1,code:"PRT",price:.045},{value:"+1-787, 1-939",label:"+1-787, 1-939 Puerto Rico",hasSmsSupport:!1,hasVoiceSupport:!1,code:"PRI",price:.04},{value:"+974",label:"+974 Qatar",hasSmsSupport:!1,hasVoiceSupport:!1,code:"QAT",price:.061},{value:"+40",label:"+40 Romania",hasSmsSupport:!1,hasVoiceSupport:!0,code:"ROU",price:.068},{value:"+7",label:"+7 Russia",hasSmsSupport:!1,hasVoiceSupport:!1,code:"RUS",price:.0495},{value:"+250",label:"+250 Rwanda",hasSmsSupport:!1,hasVoiceSupport:!1,code:"RWA",price:.0545},{value:"+590",label:"+590 Saint Barthelemy",hasSmsSupport:!1,hasVoiceSupport:!1,code:"BLM",price:0},{value:"+290",label:"+290 Saint Helena, Ascension and Tristan Da Cunha",hasSmsSupport:!1,hasVoiceSupport:!1,code:"SHN",price:0},{value:"+1869",label:"+1869 Saint Kitts and Nevis",hasSmsSupport:!1,hasVoiceSupport:!1,code:"KNA",price:.055},{value:"+1758",label:"+1758 Saint Lucia",hasSmsSupport:!1,hasVoiceSupport:!1,code:"LCA",price:.051},{value:"+590",label:"+590 Saint Martin",hasSmsSupport:!1,hasVoiceSupport:!1,code:"MAF",price:0},{value:"+508",label:"+508 Saint Pierre and Miquelon",hasSmsSupport:!1,hasVoiceSupport:!1,code:"SPM",price:.12},{value:"+1784",label:"+1784 Saint Vincent and the Grenadines",hasSmsSupport:!1,hasVoiceSupport:!1,code:"VCT",price:.055},{value:"+378",label:"+378 San Marino",hasSmsSupport:!1,hasVoiceSupport:!1,code:"SMR",price:.08667},{value:"+239",label:"+239 Sao Tome and Principe",hasSmsSupport:!1,hasVoiceSupport:!1,code:"STP",price:.03},{value:"+966",label:"+966 Saudi Arabia",hasSmsSupport:!1,hasVoiceSupport:!1,code:"SAU",price:.0445},{value:"+221",label:"+221 Senegal",hasSmsSupport:!1,hasVoiceSupport:!1,code:"SEN",price:.1095},{value:"+381",label:"+381 Serbia",hasSmsSupport:!1,hasVoiceSupport:!1,code:"SRB",price:.0395},{value:"+248",label:"+248 Seychelles",hasSmsSupport:!1,hasVoiceSupport:!1,code:"SYC",price:.11483},{value:"+232",label:"+232 Sierra Leone",hasSmsSupport:!1,hasVoiceSupport:!1,code:"SLE",price:.05},{value:"+65",label:"+65 Singapore",hasSmsSupport:!0,hasVoiceSupport:!0,code:"SGP",price:.0395},{value:"+421",label:"+421 Slovakia",hasSmsSupport:!0,hasVoiceSupport:!0,code:"SVK",price:.0975},{value:"+386",label:"+386 Slovenia",hasSmsSupport:!1,hasVoiceSupport:!0,code:"SVN",price:.047},{value:"+677",label:"+677 Solomon Islands",hasSmsSupport:!1,hasVoiceSupport:!1,code:"SLB",price:.079},{value:"+252",label:"+252 Somalia",hasSmsSupport:!1,hasVoiceSupport:!1,code:"SOM",price:.0995},{value:"+27",label:"+27 South Africa",hasSmsSupport:!1,hasVoiceSupport:!0,code:"ZAF",price:.027},{value:"+500",label:"+500 South Georgia and the South Sandwich Islands",hasSmsSupport:!1,hasVoiceSupport:!1,code:"SGS",price:0},{value:"+82",label:"+82 South Korea",hasSmsSupport:!1,hasVoiceSupport:!1,code:"KOR",price:.047},{value:"+211",label:"+211 South Sudan",hasSmsSupport:!1,hasVoiceSupport:!1,code:"SSD",price:.06},{value:"+34",label:"+34 Spain",hasSmsSupport:!1,hasVoiceSupport:!1,code:"ESP",price:.0833},{value:"+94",label:"+94 Sri Lanka",hasSmsSupport:!1,hasVoiceSupport:!0,code:"LKA",price:.06},{value:"+249",label:"+249 Sudan",hasSmsSupport:!1,hasVoiceSupport:!0,code:"SDN",price:.075},{value:"+597",label:"+597 Suriname",hasSmsSupport:!1,hasVoiceSupport:!1,code:"SUR",price:.025},{value:"+47",label:"+47 Svalbard and Jan Mayen",hasSmsSupport:!1,hasVoiceSupport:!1,code:"SJM",price:0},{value:"+46",label:"+46 Sweden",hasSmsSupport:!0,hasVoiceSupport:!0,code:"SWE",price:.055},{value:"+41",label:"+41 Switzerland",hasSmsSupport:!0,hasVoiceSupport:!0,code:"CHE",price:.069},{value:"+963",label:"+963 Syrian Arab Republic",hasSmsSupport:!1,hasVoiceSupport:!1,code:"SYR",price:.129},{value:"+886",label:"+886 Taiwan",hasSmsSupport:!1,hasVoiceSupport:!1,code:"TWN",price:.054},{value:"+992",label:"+992 Tajikistan",hasSmsSupport:!1,hasVoiceSupport:!1,code:"TJK",price:.1195},{value:"+255",label:"+255 Tanzania, United Republic of Tanzania",hasSmsSupport:!1,hasVoiceSupport:!1,code:"TZA",price:.0795},{value:"+66",label:"+66 Thailand",hasSmsSupport:!1,hasVoiceSupport:!0,code:"THA",price:.029},{value:"+670",label:"+670 Timor-Leste",hasSmsSupport:!1,hasVoiceSupport:!1,code:"TLS",price:.08667},{value:"+228",label:"+228 Togo",hasSmsSupport:!1,hasVoiceSupport:!1,code:"TGO",price:.055},{value:"+690",label:"+690 Tokelau",hasSmsSupport:!1,hasVoiceSupport:!1,code:"TKL",price:0},{value:"+676",label:"+676 Tonga",hasSmsSupport:!1,hasVoiceSupport:!1,code:"TON",price:.07},{value:"+1-868",label:"+1-868 Trinidad and Tobago",hasSmsSupport:!1,hasVoiceSupport:!0,code:"TTO",price:.02},{value:"+216",label:"+216 Tunisia",hasSmsSupport:!1,hasVoiceSupport:!0,code:"TUN",price:.0995},{value:"+90",label:"+90 Turkey",hasSmsSupport:!1,hasVoiceSupport:!1,code:"TUR",price:.029},{value:"+993",label:"+993 Turkmenistan",hasSmsSupport:!1,hasVoiceSupport:!1,code:"TKM",price:.1045},{value:"+1649",label:"+1649 Turks and Caicos Islands",hasSmsSupport:!1,hasVoiceSupport:!1,code:"TCA",price:.044},{value:"+688",label:"+688 Tuvalu",hasSmsSupport:!1,hasVoiceSupport:!1,code:"TUV",price:.1},{value:"+256",label:"+256 Uganda",hasSmsSupport:!1,hasVoiceSupport:!0,code:"UGA",price:.065},{value:"+380",label:"+380 Ukraine",hasSmsSupport:!1,hasVoiceSupport:!1,code:"UKR",price:.087},{value:"+971",label:"+971 United Arab Emirates",hasSmsSupport:!1,hasVoiceSupport:!1,code:"ARE",price:.031},{value:"+44",label:"+44 United Kingdom",hasSmsSupport:!0,hasVoiceSupport:!0,code:"GBR",price:.04},{value:"+1",label:"+1 United States",hasSmsSupport:!0,hasVoiceSupport:!0,code:"USA",price:.0075},{value:"+598",label:"+598 Uruguay",hasSmsSupport:!1,hasVoiceSupport:!0,code:"URY",price:.067},{value:"+998",label:"+998 Uzbekistan",hasSmsSupport:!1,hasVoiceSupport:!1,code:"UZB",price:.11},{value:"+678",label:"+678 Vanuatu",hasSmsSupport:!1,hasVoiceSupport:!1,code:"VUT",price:.07},{value:"+58",label:"+58 Venezuela",hasSmsSupport:!1,hasVoiceSupport:!0,code:"VEN",price:.048},{value:"+84",label:"+84 Vietnam",hasSmsSupport:!1,hasVoiceSupport:!0,code:"VNM",price:.0599},{value:"+1284",label:"+1284 Virgin Islands, British",hasSmsSupport:!1,hasVoiceSupport:!1,code:"VGB",price:.05417},{value:"+1340",label:"+1340 Virgin Islands, U.S.",hasSmsSupport:!1,hasVoiceSupport:!1,code:"VIR",price:.02},{value:"+681",label:"+681 Wallis and Futuna",hasSmsSupport:!1,hasVoiceSupport:!1,code:"WLF",price:.11},{value:"+967",label:"+967 Yemen",hasSmsSupport:!1,hasVoiceSupport:!1,code:"YEM",price:.09},{value:"+260",label:"+260 Zambia",hasSmsSupport:!1,hasVoiceSupport:!1,code:"ZMB",price:.1045},{value:"+263",label:"+263 Zimbabwe",hasSmsSupport:!1,hasVoiceSupport:!1,code:"ZWE",price:.0195}];function Lc(e){return new RegExp("^[A-Za-z0-9 \\r\\n@\xa3$\xa5\xe8\xe9\xf9\xec\xf2\xc7\xd8\xf8\xc5\xe5\u0394_\u03a6\u0393\u039b\u03a9\u03a0\u03a8\u03a3\u0398\u039e\xc6\xe6\xdf\xc9!\"#$%&amp;'()*+,\\-./:;<>&lt;=&gt;?\xa1\xc4\xd6\xd1\xdc\xa7\xbf\xe4\xf6\xf1\xfc\xe0^{}\\\\\\[~\\]|\u20ac]*$").test(e)}var Vc,Bc=a(377).default.span(Vc||(Vc=Object(Fc.a)(["\n  background-color: #0a59b2;\n  padding: 2px 2px;\n  color: #fff;\n"])));var qc=g.a.memo((function(e){var t=e.segments,a=e.toNumbers,n=e.messageText,r=e.deliveryMethodValue,s=Object(h.useState)([]),i=Object(o.a)(s,2),l=i[0],c=i[1],u=Object(h.useState)(0),m=Object(o.a)(u,2),p=m[0],f=m[1],v=Object(h.useState)({segmentLengthForMessages:"",segmentLengthForMessagesLabel:"",messageWithSpecialCharactersHighlighted:[],specialCharacters:!1}),b=Object(o.a)(v,2),y=b[0],S=b[1];Object(h.useEffect)((function(){var e=function(e,t){var a=e.map((function(e){return q()(Hr(e.value))})).map((function(e){return e[1]})),n=Uc.filter((function(e){return a.includes(e.code)}));if("Whatsapp"===t)return{cost:0,selectedCountries:n};var r=a.reduce((function(e,t){return"undefined"===typeof e[t]?e[t]=1:e[t]+=1,e}),{});return{cost:n.reduce((function(e,t){return e+t.price*r[t.code]}),0),selectedCountries:n}}(a,r),t=e.cost,o=e.selectedCountries;f(t),c(o),S(function(e){var t="",a="",n=!1,r=[];return e.length>0&&(r=Array.from(e).map((function(e,t){return Lc(e)?e:g.a.createElement(Bc,{key:t},e)}))),Lc(e)?(t="153",a="without special characters",n=!1):(t="67",a="with special characters",n=!0),{segmentLengthForMessages:t,segmentLengthForMessagesLabel:a,messageWithSpecialCharactersHighlighted:r,specialCharacters:n}}(n||""))}),[a,n,r]);var w=p*t;return g.a.createElement(g.a.Fragment,null,g.a.createElement("div",null,"Estimated cost: $",w.toFixed(2)," USD. "),g.a.createElement("div",null,"This campaign has ",t," ",t>1?"segments":"segment","."),g.a.createElement("div",null,"Unique phone numbers in campaign: ",a.length),l.map((function(e){var t=["US","USA","UK"].includes(e.code)?"in the ".concat(e.code):"in ".concat(e.code);return g.a.createElement("div",{style:{fontSize:12,paddingBottom:20},key:e.code},"Twilio charges $",e.price," per"," ",y.segmentLengthForMessages," characters for messages"," ",t," ",y.segmentLengthForMessagesLabel)})),y.specialCharacters&&g.a.createElement(d.a,{severity:"warning"},g.a.createElement("div",{className:"messageTextError"},g.a.createElement("div",{className:"messageTextError-text"},g.a.createElement("p",null,g.a.createElement("strong",null,"FYI this message costs double the normal amount to send because you have included special characters (highlighted in blue below). To get a deeper understanding,"," ",g.a.createElement("a",{href:"https://www.youtube.com/watch?v=cSEiiiO-rkc"},"here's a 3 minute video")," ","explaining why special characters cost you more.")),g.a.createElement("p",null,y.messageWithSpecialCharactersHighlighted)))))})),Wc=a(569),zc=a.n(Wc),Hc=a(570),Yc=a.n(Hc),Gc=a(1008),Qc=a(1092),Jc=a(1100),Kc=["Send Now","Send Later"],Zc=Object(Ct.a)((function(e){return Object(Jc.a)({container:{display:"center",flexWrap:"wrap"},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:300},button:{backgroundColor:"#55C6EC",color:"Black",textTransform:"capitalize"},sendButton:{background:"#55C6EC",fontSize:16,textTransform:"capitalize",fontFamily:'"ProximaNovaRegular",sans-serif'},buttonDropDown:{background:"#55C6EC"},buttonGroup:{marginLeft:e.spacing(.5),"& button:hover":{background:"#55C6EC",color:"#ffffff"}},buttonSubmit:{paddingTop:e.spacing(2),paddingBottom:e.spacing(2),display:"flex",justifyContent:"center",alignItems:"center"},cancelButton:{background:dc,fontSize:16,width:"17%",marginRight:e.spacing(.5),textTransform:"capitalize",fontFamily:'"ProximaNovaRegular",sans-serif'},errorMessage:{color:"red",fontSize:12,marginTop:10}})})),Xc="The sending time you chose is in the past. Please choose a time in the future.",$c=function(e){var t=e.workingHoursSettingsFromBackend,a=g.a.useState(!1),n=Object(o.a)(a,2),i=n[0],l=n[1],c=g.a.useRef(null),u=g.a.useState(0),m=Object(o.a)(u,2),p=m[0],f=m[1],v=g.a.useState(!1),b=Object(o.a)(v,2),y=b[0],S=b[1],w=g.a.useState(X()().format("YYYY-MM-DDTHH:mm")),_=Object(o.a)(w,2),x=_[0],C=_[1],k=g.a.useState(""),E=Object(o.a)(k,2),T=E[0],N=E[1],I=g.a.useState(!1),O=Object(o.a)(I,2),M=O[0],P=O[1],A=function(){var t=Object(s.a)(r.a.mark((function t(a){var n,o,s;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.preventDefault(),n=Kc[p],(o="Send Now"===n)||!j){t.next=5;break}return t.abrupt("return");case 5:if(o||!Ye(x)){t.next=8;break}return N(Xc),t.abrupt("return");case 8:P(!0),s={sendType:n,scheduledTimeToSend:o?X()().format("YYYY-MM-DDTHH:mm"):x},e.handleSms(s).finally((function(){P(!1)}));case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();Object(h.useEffect)((function(){y||C(X()().format("YYYY-MM-DDTHH:mm"))}),[y]);var D=function(e){c.current&&c.current.contains(e.target)||l(!1)},j=Object(h.useMemo)((function(){var e=x.split("T")[1];return xe(e,t,x)}),[t,x]),R=we(t.weekDays).join(", "),F=Zc();return g.a.createElement("div",null,y&&g.a.createElement("div",null,g.a.createElement("pre",null,"Timezone "),g.a.createElement(d.a,{color:"info"},"Messages will be sent at"," ",g.a.createElement("strong",null,X()(x).format("dddd, MMMM Do YYYY, h:mm:ss a"))," ","in the recipients' timezone - e.g. if you have recipients in Australia and the US, the messages will be sent at the appropriate time in those countries."),g.a.createElement("pre",null,"Date and Time"),g.a.createElement("div",{className:F.container},g.a.createElement(Do.a,{id:"datetime-local",type:"datetime-local",value:x,className:F.textField,InputLabelProps:{shrink:!0},inputProps:{min:X()().format("YYYY-MM-DDTHH:mm")},onChange:function(e){return t=e.target.value,Ye(t)?N(Xc):N(""),void C(t);var t}})),j&&g.a.createElement("p",{className:F.errorMessage},"Your scheduled message's time is outside the organisation's sending hours"," ",X()(t.startTime,"hh:mm:ss").format("LT")," ","- ",X()(t.endTime,"hh:mm:ss").format("LT"),R.length?", on any day except ".concat(R.toUpperCase()):""),!!T&&g.a.createElement("p",{className:F.errorMessage},T)),g.a.createElement("div",{className:F.buttonSubmit},g.a.createElement(eo.a,{color:"inherit",variant:"contained",className:F.cancelButton,onClick:e.handleCancel},"Cancel"),g.a.createElement(Ps.a,{className:F.buttonGroup,variant:"contained",ref:c,"aria-label":"button",disabled:e.disabled},g.a.createElement(eo.a,{className:F.sendButton,onClick:A,disabled:e.disabled&&0===p||j&&1===p||!!T||M,style:{borderRight:"none"},startIcon:M?g.a.createElement(Q.a,{size:20}):void 0,"data-test-id":"sendMessageButton"},Kc[p]),g.a.createElement(eo.a,{size:"small",className:F.buttonDropDown,"aria-controls":i?"split-button-menu":void 0,"aria-expanded":i?"true":void 0,"aria-label":"Select sending time",title:"Select sending time","aria-haspopup":"menu",onClick:function(){l((function(e){return!e}))},disabled:e.disabled&&0===p},g.a.createElement(Yc.a,null))),g.a.createElement(Qc.a,{open:i,anchorEl:c.current,role:void 0,transition:!0,disablePortal:!0},(function(t){var a=t.TransitionProps,n=t.placement;return g.a.createElement(Gc.a,Object.assign({},a,{style:{transformOrigin:"bottom"===n?"center top":"center bottom"}}),g.a.createElement(qr.a,null,g.a.createElement(Zo.a,{onClickAway:D},g.a.createElement(Xo.a,{id:"split-button-menu"},Kc.map((function(t,a){return g.a.createElement($o.a,{key:t,disabled:0===a&&e.disabled,selected:a===p,onClick:function(){return function(t){f(t),1===t?(S(!0),e.setIsSelectSendLater(!0)):(S(!1),e.setIsSelectSendLater(!1)),l(!1)}(a)}},t)}))))))}))))},eu="send_message_form_preferences";function tu(){return Le(rt(eu),"getSendMessageFormPreferences",null)}function au(e){ot(eu,JSON.stringify(e))}var nu=a(1101),ru=a(1119),ou=function(e){var t=e.labels,a=e.exclusive,n=e.onChangeValue,r=e.selectedValue;return(null===t||void 0===t?void 0:t.length)?g.a.createElement(ru.a,{value:r,exclusive:a,onChange:function(e,t){null!==t&&n&&n(t)}},t.map((function(e){return g.a.createElement(nu.a,{key:e,value:e,selected:r===e},g.a.createElement(g.a.Fragment,null,e))}))):null};ou.defaultProps={exclusive:!0};var su=ou,iu=a(536),lu=a(1068),cu=a(1102),uu=Object(iu.a)((function(e){return g.a.createElement(Wl.a,e)}))((function(){return{"&.Mui-focused > fieldset":{borderColor:"#2684ff !important"}}})),du=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).availabilityTimeout=void 0,n.AVAILABILITY_DELAY=1e3,n.EXAMPLE_ENDING="A8fs9i",n.state={currentSlug:"none",wantsNewSlug:!1,newSlug:void 0,newSlugAvailable:void 0},n.availabilityTimeout=void 0,n}return Object(l.a)(a,[{key:"buildOptionList",value:function(){return Object(w.a)(this.props.existingSlugs).map((function(e){return{label:e,value:e}}))}},{key:"displayNewSlugInterface",value:function(){var e,t=this;switch(this.state.newSlugAvailable){case void 0:e=g.a.createElement(g.a.Fragment,null);break;case!0:e=g.a.createElement(cu.a,{className:this.props.classes.availableIcon});break;default:e=g.a.createElement(qt.a,{color:"error"})}return g.a.createElement(lu.a,{fullWidth:!0},g.a.createElement("div",{className:this.props.classes.customSlugRow},g.a.createElement(uu,{id:"new-slug-input",onChange:function(e){return t.handleNewSlugChange(e)},labelWidth:0,name:"newSlug",value:this.state.newSlug,className:this.props.classes.newSlugInputContainer,inputProps:{className:this.props.classes.newSlugInput},endAdornment:g.a.createElement(hl.a,{position:"end"},e)}),g.a.createElement(eo.a,{variant:"contained",className:this.props.classes.customSlugButton,onClick:function(){return t.cancelNewSlug()}},"Cancel")))}},{key:"displayURLPreview",value:function(){var e="https://smth.li/";return this.state.wantsNewSlug&&this.state.newSlug?"".concat(e,"/").concat(this.state.newSlug,"/").concat(this.EXAMPLE_ENDING):"none"===this.state.currentSlug?"".concat(e,"/").concat(this.EXAMPLE_ENDING):"".concat(e,"/").concat(this.state.currentSlug,"/").concat(this.EXAMPLE_ENDING)}},{key:"withRowHeader",value:function(e){var t;t=this.state.wantsNewSlug&&!1===this.state.newSlugAvailable?g.a.createElement("p",null,"The shortcode is unavailable"):!this.state.wantsNewSlug||""!==this.state.newSlug&&void 0!==this.state.newSlug?[g.a.createElement("p",{key:"url-preview"},"Your urls will look like ",g.a.createElement("b",null,this.displayURLPreview())),g.a.createElement("p",{key:"url-explanation"},"The last bit (",g.a.createElement("b",null,this.EXAMPLE_ENDING),") will be randomized for each url in the message so you can track how many times the url has been opened")]:g.a.createElement("p",null,"Type in a url shortcode to check its availability and see a preview of the url.");var a=g.a.createElement("div",{className:this.props.formClasses.fieldLabel+" "+this.props.classes.customSlugExample},t);return g.a.createElement("div",null,g.a.createElement("pre",{className:this.props.formClasses.fieldLabel},"URL Shortcode"),e,a)}},{key:"render",value:function(){var e=this;return this.props.displayable?this.state.wantsNewSlug?this.withRowHeader(this.displayNewSlugInterface()):this.withRowHeader(g.a.createElement("div",{className:this.props.classes.customSlugRow},g.a.createElement("div",{className:this.props.classes.customSlugSelectContainer},g.a.createElement(to.a,{options:this.buildOptionList(),onChange:function(t){return e.handleSelectChange(t)}})),g.a.createElement(eo.a,{className:this.props.classes.customSlugButton,variant:"contained",onClick:function(){return e.handleNewSlugButton()}},"New"))):g.a.createElement(g.a.Fragment,null)}},{key:"handleNewSlugButton",value:function(){this.setState({currentSlug:"",wantsNewSlug:!0})}},{key:"handleSelectChange",value:function(e){if(e){var t=e.value;this.setState({currentSlug:t}),this.props.handleSlugChange(t)}}},{key:"cancelNewSlug",value:function(){this.availabilityTimeout&&clearTimeout(this.availabilityTimeout),this.setState({newSlugAvailable:void 0,newSlug:void 0,wantsNewSlug:!1,currentSlug:"none"})}},{key:"checkRemoteAvailability",value:function(){var e=Object(s.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.newSlug){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.props.apiClient.checkSlugAvailability({slug:this.state.newSlug});case 4:(t=e.sent)&&this.props.handleSlugChange(this.state.newSlug),this.setState({newSlugAvailable:t});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleNewSlugChange",value:function(e){var t,a=this,n=e.target.value.toLocaleLowerCase();["none","add"].includes(n)&&(t=!1,clearTimeout(this.availabilityTimeout)),this.props.existingSlugs.includes(n)&&(t=!0,clearTimeout(this.availabilityTimeout)),void 0===t&&(this.availabilityTimeout&&clearTimeout(this.availabilityTimeout),this.availabilityTimeout=window.setTimeout((function(){return a.checkRemoteAvailability()}),this.AVAILABILITY_DELAY)),this.setState({newSlug:n,newSlugAvailable:t})}}]),a}(g.a.Component),mu=Object(S.a)((function(e){return Object(Jc.a)({root:{paddingTop:e.spacing(2)},customSlugRow:{display:"flex",flexDirection:"row"},customSlugSelectContainer:{width:"81%",marginRight:15},customSlugButton:{width:80,fontFamily:'"ProximaNovaRegular",sans-serif',fontSize:16,height:38,textTransform:"capitalize"},newSlugInputContainer:{width:"81%",marginRight:15,focused:"blue"},newSlugInput:{width:"100%",fontFamily:'"ProximaNovaRegular",sans-serif',paddingTop:6,paddingBottom:7,focused:"blue"},availableIcon:{color:"rgb(0, 230, 118)"}})}))(du),pu=null,hu="The URL shortening service has encountered an error. Your URLs will be left unchanged",gu=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n,o,l,c,u,d,m,p;Object(i.a)(this,a),(p=t.call(this,e)).urlShortener=void 0,p.initializePusher=Object(s.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=new or.a(ge,{cluster:fe}),t.subscribe(p.props.crmOrganisationID).bind("inbound_sms",(function(e){p.updateProgress(e)}));case 3:case"end":return e.stop()}}),e)}))),p.getToNumbers=function(e){return tr(e,p.props.toNumbers,p.props.phoneNumberAPINames).filter((function(e){return!e.completeRecordData.twiliosmsextension0__Twilio_SMS_Message_Opt_Out}))},p.handleEditTemplate=function(){p.state.selectedTemplate&&(p.props.selectTemplateToEdit(p.state.selectedTemplate),p.props.changeView("EditTemplate"))},p.handleChangeTemplate=function(e){var t;if(null===e||void 0===e?void 0:e.value){var a=(null===(t=e.value.match(/(#)\w+/g))||void 0===t?void 0:t.length)||0;p.setState({selectedTemplate:e,messageText:null===e||void 0===e?void 0:e.value,mediaURLs:null===e||void 0===e?void 0:e.mediaURLs,containsMergeFields:a>0})}},p.handleCancel=function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,Ac();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p.handleMessageChange=function(e){var t=e.target.value;p.setState({messageText:t,hasUrls:p.urlShortener.detectURLsInMessage(t)})},p.handleChangedFromNumber=function(e){p.setState({fromNumber:e})},p.handleAddTemplate=function(e){e.preventDefault(),p.props.changeView("createtemplate")},p.closePopup=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,jc();case 2:case"end":return e.stop()}}),e)}))),p.updateProgress=function(e){e.status&&p.state.campaignId===e.campaign_id&&p.setState((function(t){var a;return Object(_.a)(Object(_.a)({},t),{},{sentMessagesIds:Object(_.a)(Object(_.a)({},t.sentMessagesIds),{},Object($t.a)({},null!==(a=e.sms_record_id)&&void 0!==a?a:e.sid,e.status)),recordsMessageStatus:Object(_.a)(Object(_.a)({},t.recordsMessageStatus),{},Object($t.a)({},e.record_id,e.status))})}))},p.checkRecordMessageSentStatus=function(e){return p.state.recordsMessageStatus[e]},p.updateMessageSentStatus=function(e){var t=e.reduce((function(e,t){return t.status&&(e[t.sms_record_id]=(null===t||void 0===t?void 0:t.duplicate_message)?"duplicate*":"fail"===t.status?"Failed ".concat(null===t||void 0===t?void 0:t.error_message):t.status),e}),{}),a=e.reduce((function(e,t){return e[t.entity_id]=t.status,e}),{});p.setState((function(e){return{recordsMessageStatus:Object(_.a)(Object(_.a)({},e.recordsMessageStatus),a),sentMessagesIds:Object(_.a)(Object(_.a)({},e.sentMessagesIds),t)}}))},p.updateCampaignId=function(e){p.setState({campaignId:e})},p.handleSms=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,o,s,i,l,c,u,d,m,h,g;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.sendType,n=t.scheduledTimeToSend,p.setState({loader:!0}),(o=p.state.fromNumber).name.toLowerCase().includes("whatsapp")&&!o.value.includes("whatsapp:")&&p.setState({fromNumber:{value:"whatsapp:".concat(o.value),name:o.name,completeRecordData:o.completeRecordData}}),e.prev=4,i={sendImmediately:!1,sendType:a,fromNumber:p.state.fromNumber,fromNumbers:p.props.fromNumbers,toNumbers:p.state.toNumbers,templatedMessageText:p.state.messageText,mediaUrls:p.state.mediaURLs,templateName:p.state.templateView===le.BlankState?"no_template":null===(s=p.state.selectedTemplate)||void 0===s?void 0:s.label,lookupFieldsForSMSMessagesModule:p.props.lookupFieldsForSMSMessagesModule,updateCampaignId:p.updateCampaignId,checkRecordMessageSentStatus:p.checkRecordMessageSentStatus,lookupFieldsForCurrentEntity:p.props.lookupFieldsForCurrentEntity,whoShouldBeNotified:p.state.whoShouldBeNotified,createCampaign:!0,deliveryMethod:p.state.deliveryMethod.value,email:p.props.currentUserEmail,updateMessageSentStatus:p.updateMessageSentStatus,scheduledTimeToSend:n,messageNamePrefix:"Bulk SMS for",module:p.props.moduleName,shortenUrls:p.state.wantsToShortenUrls&&p.state.hasUrls,customSlug:p.state.customURLSlug,notifyUrlShorteningFailed:p.handleUrlShorteningFailed},wr("bulk-message-send",{numToNumbers:p.state.toNumbers.length,sendImmediately:!1,messageLength:p.state.messageText.length}),e.next=9,Fr(i);case 9:if(l=e.sent,!(c=l.campaignId)){e.next=16;break}return e.next=14,Vr(c.toString(),"Campaigns");case 14:u=e.sent,p.setState({campaignId:c.toString(),currentURL:u});case 16:au({fromNumber:p.state.fromNumber,numberToUseField:p.state.numberToUseField,deliveryMethod:p.state.deliveryMethod,whoShouldBeNotified:p.state.whoShouldBeNotified,selectedTemplate:p.state.selectedTemplate,templateView:p.state.templateView}),zt({message:"All messages have been queued to send"}),d="Your bulk SMS campaign was sent successfully.","Send Later"===a&&(d="Your bulk SMS campaign has been scheduled for sending at".concat(" ","\n          ",n," in the recipient's timezone.")),p.showCampaignDialog(d),e.next=32;break;case 23:throw e.prev=23,e.t0=e.catch(4),m=e.t0,h=null===m||void 0===m?void 0:m.isCampaignError,zt({message:"An error occurred"}),g="An error occurred. Please check you are on the latest version of the extension by following the instructions here https://screencast-o-matic.com/watch/cYlXrp813O. If you are on the latest version, please email team@smooth.tel with a screenshot of this error message: ".concat(m.message," ").concat(m.stack),h&&(g="It looks like your user might not have access to the campaigns module. Please check with your CRM administrator. If you definitely do have access to the campaigns module, please email a screenshot of this message to team@smooth.tel ".concat(JSON.stringify(m.message),'"')),Oe()({title:"Error",text:g,icon:"error"}),m;case 32:case"end":return e.stop()}}),e,null,[[4,23]])})));return function(t){return e.apply(this,arguments)}}(),p.handleNumberToUseChange=function(e){if(e){var t=Object.values(e);if(t.length){var a=t.map((function(e){return e.value.trim()})),n=p.getToNumbers(a),r=ar(p.state.deliveryMethod.value,n);p.setState({toNumbers:r,numberToUseField:t})}else p.setState({toNumbers:[],numberToUseField:[]})}},p.handleDeliveryMethodChange=function(e){if(e){var t=p.state.toNumbers,a=e;p.setState({toNumbers:[]},(function(){var e=ar(a.value,t);p.setState({deliveryMethod:a,toNumbers:e})}))}},p.handleChangeTemplateView=function(e){e===le.BlankState?p.setState({templateView:e,messageText:""}):(p.setState({templateView:e}),p.handleChangeTemplate(p.state.selectedTemplate))},p.updateToNumbers=function(){p.setState({toNumbers:[].concat(Object(w.a)(p.state.toNumbers),Object(w.a)(p.state.undeliverableToNumbers)),undeliverableToNumbers:[]})},p.handleChosenEmoji=function(e){p.setState({messageText:p.state.messageText+e.native})},p.handleEmojiButton=function(e){p.setState({anchorEl:e.currentTarget})},p.handleClose=function(){p.setState({anchorEl:null})},p.setIsSelectSendLater=function(e){p.setState({isSelectSendLater:e})},p.removeNumbersOutsideBusinessHours=function(e){var t=e.map((function(e){return null===e||void 0===e?void 0:e.value})),a=p.state.toNumbers.filter((function(e){return!t.includes(e.value)}));p.setState({toNumbers:a})},p.handleShortenURLsChanges=function(){p.setState({wantsToShortenUrls:!p.state.wantsToShortenUrls})},p.handleUrlShorteningFailed=function(){p.setState({urlShorteningErrorMessage:hu})},p.handleAcceptableTimeCheckboxChange=function(){p.setState({acceptableTimeForMessaging:!p.state.acceptableTimeForMessaging})},p.handleNotifyReplyChange=function(e){if(e){var t=e;p.setState({whoShouldBeNotified:t.value})}},p.showCampaignDialog=function(e){p.setState({dialogToCampaign:!0,campaignMessage:e})};var h=tu(),g=fa(),f=gs(e.fromNumbers),v=hs(e.fromNumbers),b=p.props.selectedTemplate||(null===h||void 0===h?void 0:h.selectedTemplate)||p.props.smsTemplates&&p.props.smsTemplates[0];(null===(n=p.props.smsTemplates)||void 0===n?void 0:n.some((function(e){return e.template_id===b.template_id})))||(b=p.props.smsTemplates[0]);var y=$n(e.toNumbers[0],e.globalDefaultFieldToUse,e.moduleName);(null===h||void 0===h?void 0:h.numberToUseField)&&Array.isArray(h.numberToUseField)&&(y=h.numberToUseField);var S=p.getToNumbers([null===(o=y[0])||void 0===o||null===(l=o.value)||void 0===l?void 0:l.toString()]),x=p.getToNumbers(["All Possible Numbers"]),C=(null===(c=b)||void 0===c||null===(u=c.value)||void 0===u||null===(d=u.match(/(#)\w+/g))||void 0===d?void 0:d.length)||0;return p.state={fromNumber:f||g||(null===h||void 0===h?void 0:h.fromNumber)||v||e.fromNumbers[0],toNumbers:S.length?S:x,messageText:(null===h||void 0===h?void 0:h.templateView)===le.TEMPLATED&&(null===(m=b)||void 0===m?void 0:m.value)||"",loader:!1,selectedTemplate:b,mediaURLs:[],uploadedImageFileNames:[],numberToUseField:S.length?y:{value:"All Possible Numbers",label:"All Possible Numbers"},dialogToCampaign:!1,campaignId:"",currentURL:"",hasAcceptedTerms:!1,containsMergeFields:C>0,undeliverableToNumbers:e.undeliverableToNumbers,acceptableTimeForMessaging:!1,progress:0,anchorEl:null,deliveryMethod:(null===h||void 0===h?void 0:h.deliveryMethod)||ce[0],sentMessagesIds:{},recordsMessageStatus:{},whoShouldBeNotified:(null===h||void 0===h?void 0:h.whoShouldBeNotified)||ne,campaignMessage:"",templateView:(null===h||void 0===h?void 0:h.templateView)||le.TEMPLATED,isSelectSendLater:!1,hasUrls:!1,wantsToShortenUrls:!1,previouslyUsedURLSlugs:void 0,customURLSlug:void 0,urlShorteningErrorMessage:void 0},p.urlShortener=Mr.envConfigured(),p}return Object(l.a)(a,[{key:"handleCustomSlugChange",value:function(e){this.setState({customURLSlug:e})}},{key:"displayImage",value:function(){var e=this.state.mediaURLs;return null===e||void 0===e?void 0:e.map((function(e){return h.createElement("img",{key:e,src:e,alt:"template",style:{height:"100px",padding:"5px"}})}))}},{key:"closeCampaignDialog",value:function(){Ac(),this.setState({dialogToCampaign:!1})}},{key:"displayDialogToCampaign",value:function(){var e=this;return h.createElement("div",null,h.createElement(Us.a,{open:this.state.dialogToCampaign,onClose:function(){return e.closeCampaignDialog()}},h.createElement(Bs.a,null,"Bulk SMS Sent"),h.createElement(Vs.a,null,h.createElement(bc.a,null,this.state.campaignMessage," ",h.createElement("a",{target:"_blank",rel:"noreferrer",href:this.state.currentURL},"Click here")," ","to view the campaign where you can see deliverability and reply analytics")),h.createElement(Ls.a,null,h.createElement(eo.a,{onClick:function(){return e.closeCampaignDialog()},color:"primary"},"CLOSE"))))}},{key:"handleCheckboxChange",value:function(e){this.setState({hasAcceptedTerms:!this.state.hasAcceptedTerms})}},{key:"componentDidMount",value:function(){var e=this;this.initializePusher();var t=this.state.selectedTemplate,a=this.state.templateView===le.TEMPLATED;t&&a&&this.handleChangeTemplate(t),Mr.envConfigured().apiClient.fetchReservedSlugs({companyId:this.props.crmOrganisationID}).then((function(t){e.setState({previouslyUsedURLSlugs:t})})).catch((function(t){e.setState({urlShorteningErrorMessage:pu})}))}},{key:"displayUndeliverableNumberWarning",value:function(){return this.state.undeliverableToNumbers.length?h.createElement(d.a,{severity:"warning"},h.createElement("span",{className:this.props.classes.link,onClick:this.updateToNumbers},"Click here"),"to include numbers which were previously undeliverable"):null}},{key:"displayUrlShorteningHasFailedAlert",value:function(){return this.state.urlShorteningErrorMessage?h.createElement(d.a,{severity:"warning"},this.state.urlShorteningErrorMessage):null}},{key:"displayUrlShorteningCheckbox",value:function(){return this.state.hasUrls&&void 0===this.state.urlShorteningErrorMessage?h.createElement(x.a,{control:h.createElement(C.a,{checked:this.state.wantsToShortenUrls,onChange:this.handleShortenURLsChanges}),label:h.createElement("p",{className:this.props.classes.checkboxLabel},"Track opens and clicks with our URL shortening service")}):""}},{key:"displayCustomSlug",value:function(){var e=this;return void 0===this.state.previouslyUsedURLSlugs?null:(this.urlShortener.apiClient.companyId=this.props.crmOrganisationID,h.createElement(mu,{formClasses:this.props.classes,displayable:this.state.wantsToShortenUrls&&this.state.hasUrls,existingSlugs:this.state.previouslyUsedURLSlugs,handleSlugChange:function(t){return e.handleCustomSlugChange(t)},apiClient:this.urlShortener.apiClient}))}},{key:"render",value:function(){var e,t=this,a=[].concat(Object(w.a)(this.props.fromNumbers),[{value:"record_owner_number",name:"Record owner's phone number",label:"Record owner's phone number",completeRecordData:{}}]),n=er(this.props.moduleName,!0,this.props.phoneNumberAPINames,this.props.toNumbers),r=Boolean(this.state.anchorEl),s=zc()(Object.values(this.state.sentMessagesIds)),i=Object.values(s).reduce((function(e,t){return e+t}),0),l=Math.max(0,this.state.toNumbers.length-i),c=1*l;0===l&&i&&zt({message:"Message Sent"});var u=(null===(e=this.state.messageText)||void 0===e?void 0:e.length)&&Math.ceil(this.state.messageText.length/(Lc(this.state.messageText)?153:67))||0;return h.createElement("div",{className:this.props.classes.root},h.createElement("div",null,h.createElement(jt,{loading:this.props.loader}),this.state.loader&&h.createElement(d.a,{severity:"info",icon:!1,className:this.props.classes.progress},h.createElement("div",null,"Preparing to send: ".concat(l)),Object.entries(s).map((function(e){var t,a=Object(o.a)(e,2),n=a[0],r=a[1];"sent"===n&&(r+=null!==(t=null===s||void 0===s?void 0:s.delivered)&&void 0!==t?t:0);return"delivered"===n?null:h.createElement("div",{key:n},"".concat(n,": ").concat(r))})),"Estimated time remaining"," ",X.a.duration(c,"seconds").humanize(),(null===s||void 0===s?void 0:s["duplicate*"])>0?h.createElement("div",null,"* Duplicate messages were not sent because an identical message was sent to the contact in the last 14 days. You will receive an email shortly with details of which messages were duplicates."):null),h.createElement(Ht,null),this.displayUndeliverableNumberWarning(),this.displayUrlShorteningHasFailedAlert(),this.displayDialogToCampaign(),h.createElement("form",null,h.createElement("pre",{className:this.props.classes.fieldLabel},"From"),h.createElement(wc,{selectedFromNumber:this.state.fromNumber,fromNumbers:a,handleChangedFromNumber:this.handleChangedFromNumber}),h.createElement("pre",{className:this.props.classes.fieldLabel},"Number to use"),h.createElement(to.a,{isMulti:!0,options:n,value:this.state.numberToUseField,onChange:this.handleNumberToUseChange}),h.createElement("pre",{className:this.props.classes.fieldLabel},"Delivery Method"),h.createElement(to.a,{options:ce,value:this.state.deliveryMethod,onChange:this.handleDeliveryMethodChange}),h.createElement("pre",{className:this.props.classes.fieldLabel},"Who should be notified of replies?"),h.createElement(to.a,{options:oe,value:oe.find((function(e){return e.value===t.state.whoShouldBeNotified})),onChange:this.handleNotifyReplyChange,getOptionLabel:function(e){return e.label}}),h.createElement("pre",{className:this.props.classes.fieldLabel},"To"),h.createElement(Tc,{selectedNumbers:this.state.toNumbers}),h.createElement("div",{style:{display:"flex",marginTop:"1em"}},h.createElement(su,{labels:Object.values(le),selectedValue:this.state.templateView,onChangeValue:this.handleChangeTemplateView})),this.state.templateView===le.TEMPLATED&&h.createElement(h.Fragment,null,h.createElement("pre",{className:this.props.classes.fieldLabel},"Template"),h.createElement("div",{style:{display:"flex",flexDirection:"row"}},h.createElement(Ic,{smsTemplates:this.props.smsTemplates,selectedNumbers:this.props.toNumbers,handleChangeTemplate:this.handleChangeTemplate,selectedTemplate:this.state.selectedTemplate}),h.createElement(eo.a,{variant:"contained",color:"default",className:this.props.classes.editTemplate,onClick:this.handleEditTemplate},"Edit")),h.createElement(yc.a,{className:this.props.classes.addTemplate,onClick:this.handleAddTemplate},"+ Add New Template")),h.createElement("pre",{className:this.props.classes.fieldLabel},"Message"),h.createElement("p",{style:{textAlign:"left",padding:0,margin:0}},"Note: merge fields will be populated when you send the message"),h.createElement(Pc,{messageText:this.state.messageText,onMessageChange:this.handleMessageChange}),h.createElement("div",{className:this.props.classes.buttonContainer},h.createElement(E.a,{className:this.props.classes.emojiButton,onClick:this.handleEmojiButton},h.createElement(fo.a,null)),h.createElement(Ko.a,{open:r,anchorEl:this.state.anchorEl,onClose:this.handleClose,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"}},h.createElement(go.a,{onSelect:this.handleChosenEmoji,showSkinTones:!1,showPreview:!1,i18n:{search:"Search",categories:{search:"Search Results",recent:"Frequently Used",smileys:"Smileys & Emotion",people:"People & Body",nature:"Animals & Nature",foods:"Food & Drink",activity:"Activity",places:"Travel & Places",objects:"Objects",symbols:"Symbols",flags:"Flags",custom:"Custom"}}}))),this.displayUrlShorteningCheckbox(),this.displayCustomSlug(),h.createElement(xo,{mediaURLs:this.state.mediaURLs,handleImageUpload:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.state.mediaURLs,a=arguments.length>1?arguments[1]:void 0;t.setState({mediaURLs:e,uploadedImageFileNames:a})},uploadedImageFileNames:[]}),this.displayImage(),h.createElement("div",{className:this.props.classes.buttonSubmit},this.state.containsMergeFields?"":h.createElement(d.a,{severity:"warning",style:{textAlign:"left",marginTop:"5px"}},"The message you are about to send has no personalisation. It is likely to be blocked by carriers. We suggest adding merge fields to the template to make each message unique."),h.createElement("div",{className:this.props.classes.checkboxContainer},h.createElement(x.a,{control:h.createElement(C.a,{checked:this.state.hasAcceptedTerms,onChange:function(e){return t.handleCheckboxChange(e)},name:"termsCheckbox",color:"primary",size:"small",inputProps:{"data-test-id":"businessHoursCheckbox"}}),label:h.createElement("p",{className:this.props.classes.checkboxLabel},"Please confirm that all of the contacts you are about to send to have explicitly opted in and that the message you are sending is not likely to be flagged as spam/harassment.")})),h.createElement("div",{className:this.props.classes.estimatedPriceLabel},h.createElement(qc,{segments:u,toNumbers:this.state.toNumbers,messageText:this.state.messageText,deliveryMethodValue:this.state.deliveryMethod.value})),h.createElement("div",{style:{display:this.state.isSelectSendLater?"none":"block"}},h.createElement(ke,{fromNumber:this.state.fromNumber,workingHoursSettingsFromBackend:this.props.workingHoursSettingsFromBackend,toNumbers:this.state.toNumbers,multiple:!0,onConfirmCritical:this.handleAcceptableTimeCheckboxChange,isSMSCritical:this.state.acceptableTimeForMessaging,onRemoveNumbersOutsideBusinessHours:this.removeNumbersOutsideBusinessHours,classes:this.props.classes})),h.createElement("div",{className:this.props.classes.buttonSubmit},h.createElement($c,{handleSms:this.handleSms,handleCancel:this.handleCancel,disabled:!this.state.hasAcceptedTerms||Se(this.state.toNumbers,this.props.workingHoursSettingsFromBackend,this.state.fromNumber).length>0&&!this.state.acceptableTimeForMessaging,workingHoursSettingsFromBackend:this.props.workingHoursSettingsFromBackend,setIsSelectSendLater:this.setIsSelectSendLater}))))))}}]),a}(h.Component),fu=Xl(Vt()((function(e){return Ut()({root:{textAlign:"center",paddingTop:e.spacing(2),marginLeft:e.spacing(5),marginRight:e.spacing(5)},cancelButton:{background:dc,fontSize:16,width:"17%",marginRight:e.spacing(.5),textTransform:"capitalize",fontFamily:'"ProximaNovaRegular",sans-serif'},sendButton:{background:mc,fontSize:16,width:"17%",textTransform:"capitalize",marginLeft:e.spacing(.5),fontFamily:'"ProximaNovaRegular",sans-serif'},buttonSubmit:{paddingTop:e.spacing(2),paddingBottom:e.spacing(2)},addTemplate:{lineHeight:"1.429rem",textTransform:"capitalize",width:"45%",marginTop:"5px",marginRight:"485px",display:"inline",color:"#2d7bd1",fontSize:15,textAlign:"left",fontFamily:'"ProximaNovaRegular",sans-serif',"&:hover":{textDecoration:"underline",color:"#333"}},editTemplate:{height:"38px",fontSize:16,width:"80px",textTransform:"capitalize",fontFamily:'"ProximaNovaRegular",sans-serif'},orgUrl:{color:"#2d7bd1"},checkboxContainer:{textAlign:"left",paddingBottom:"20px"},outsideHoursList:{maxHeight:"150px",paddingInlineStart:0,marginBlockStart:"1rem",marginBlockEnd:0,overflow:"auto"},checkboxLabel:{fontSize:"14px",margin:0},warning:{width:"fit-content",padding:e.spacing(2),textAlign:"left",background:"#fff3cd",borderRadius:5},link:{textDecoration:"underline",cursor:"pointer"},progress:{position:"fixed !important",top:"0",left:"0",right:"0",width:"100%",zIndex:100,textAlign:"left",textTransform:"capitalize"},estimatedPriceLabel:{textAlign:"left",paddingBottom:"20px"},buttonContainer:{width:"100%",display:"flex",alignItems:"flex-end",justifyContent:"flex-end"},emojiButton:{marginTop:-50},fieldLabel:{marginTop:"1em",marginBottom:0,textAlign:"left",fontFamily:'"ProximaNovaRegular",sans-serif'}})}))(gu)),vu={multiValueRemove:function(){return{display:"none"}}},bu=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={receiverName:e.props.toNumbers[0]},e}return Object(l.a)(a,[{key:"render",value:function(){return h.createElement(to.a,{value:this.props.toNumbers,isMulti:!0,isClearable:!1,isSearchable:!1,components:{DropdownIndicator:function(){return null},IndicatorSeparator:function(){return null},Menu:function(){return null}},styles:vu})}}]),a}(h.Component),yu=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n,o,l,c;Object(i.a)(this,a),(c=t.call(this,e)).timeoutId=void 0,c.getToNumbers=function(e){return tr(e,c.props.toNumbers,c.props.phoneNumberAPINames)},c.handleEditTemplate=function(){c.state.selectedTemplate&&(c.props.selectTemplateToEdit(c.state.selectedTemplate),c.props.changeView("EditTemplate"))},c.handleChangeTemplate=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=c.props.toNumbers[0].completeRecordData.Owner.id,e.next=3,Ka(a);case 3:return n=e.sent,e.next=6,ur((null===t||void 0===t?void 0:t.value)||"",c.props.toNumbers[0].completeRecordData,c.props.lookupFieldsForCurrentEntity,n);case 6:o=e.sent,c.handleChangeMessageText(o),c.setState({selectedTemplate:t,mediaURLs:(null===t||void 0===t?void 0:t.mediaURLs)||[],uploadedImageFileNames:[]});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.handleChangeTemplateView=function(e){e===le.BlankState?c.setState({templateView:e,messageText:""}):(c.setState({templateView:e}),c.handleChangeTemplate(c.state.selectedTemplate))},c.handleCancel=function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,Ac();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.setIsSelectSendLater=function(e){c.setState({isSelectSendLater:e})},c.handleChangeMessageText=function(e){c.setState({messageText:e})},c.handleMessageChange=function(e){c.setState({messageText:e.target.value})},c.handleChangedFromNumber=function(e){c.setState({fromNumber:e})},c.handleChangedToNumber=function(e){c.setState({toNumbers:e})},c.handleTemplate=function(e){e.preventDefault(),c.props.changeView("createtemplate")},c.updateCampaignIdParameter=function(e){},c.checkRecordMessageSentStatusParameter=function(e){return""},c.updateMessageSentStatus=function(e){},c.handleSms=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,o,s,i,l,u,d,m,p,g,f,v,b;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.sendType,n=t.scheduledTimeToSend,o=t.bypass_duplicate_check,c.setState({loader:!0}),(s=Object(_.a)({},c.state.fromNumber)).name.toLowerCase().includes("whatsapp")&&!s.value.includes("whatsapp:")&&(s.value="whatsapp:".concat(s.value),c.setState({fromNumber:s})),e.prev=4,m={sendImmediately:"Send Now"===a,sendType:a,fromNumber:s,fromNumbers:c.props.fromNumbers,toNumbers:c.state.toNumbers,templatedMessageText:c.state.messageText,mediaUrls:c.state.mediaURLs,templateName:c.state.templateView===le.BlankState?"no_template":null===(i=c.state.selectedTemplate)||void 0===i?void 0:i.label,lookupFieldsForSMSMessagesModule:c.props.lookupFieldsForSMSMessagesModule,updateCampaignId:c.updateCampaignIdParameter,checkRecordMessageSentStatus:c.checkRecordMessageSentStatusParameter,lookupFieldsForCurrentEntity:c.props.lookupFieldsForCurrentEntity,whoShouldBeNotified:c.state.whoShouldBeNotified,createCampaign:!1,deliveryMethod:c.state.deliveryMethod.value,email:c.props.currentUserEmail,updateMessageSentStatus:c.updateMessageSentStatus,scheduledTimeToSend:n,bypass_duplicate_check:o,messageNamePrefix:"Templated SMS for",module:c.props.moduleName,shortenUrls:!1,customSlug:void 0,notifyUrlShorteningFailed:function(){return 0}},wr("single-message-send",{numToNumbers:c.state.toNumbers.length,sendImmediately:"Send Now"===a,messageLength:c.state.messageText.length}),e.next=9,Fr(m);case 9:p=e.sent,g=p.outputMessage,au({fromNumber:c.state.fromNumber,numberToUseField:c.state.numberToUseField,deliveryMethod:c.state.deliveryMethod,whoShouldBeNotified:c.state.whoShouldBeNotified,selectedTemplate:c.state.selectedTemplate,templateView:c.state.templateView}),f="queued"===(null===g||void 0===g?void 0:g[0].messageStatus)||"queued"===(null===g||void 0===g?void 0:g[0].status)||"success"===(null===g||void 0===g?void 0:g[0].messageStatus)||"success"===(null===g||void 0===g?void 0:g[0].status)||"processing in backend"===(null===g||void 0===g||null===(l=g[0])||void 0===l||null===(u=l.status)||void 0===u?void 0:u.toLowerCase()),"fail"===(null===g||void 0===g?void 0:g[0].status)||"Failed"===(null===g||void 0===g?void 0:g[0].status)?(v={message:c.state.messageText,from_number:c.state.fromNumber.value,to_number:c.state.toNumbers.map((function(e){return e.value})),deliveryMethod:c.state.deliveryMethod.value},zt({message:Ee(null===g||void 0===g?void 0:g[0],v)})):(null===g||void 0===g||null===(d=g[0])||void 0===d?void 0:d.duplicate_message)?(f=!1,zt({component:h.createElement(zr,{handleSkipDuplicates:function(){return c.handleSms({sendType:a,scheduledTimeToSend:n,bypass_duplicate_check:!0})}})})):zt({message:"Send Now"===a?"Messages have been queued with Twilio and will be sent out":"Messages have been scheduled"}),c.setState({loader:!1}),f&&(c.timeoutId=window.setTimeout((function(){Ac()}),3e3)),e.next=24;break;case 18:throw e.prev=18,e.t0=e.catch(4),b=e.t0,zt({message:"An error occurred"}),Oe()({title:"Error",text:"An error occurred. Please check you are on the latest version of the extension by following the instructions here https://screencast-o-matic.com/watch/cYlXrp813O. If you are on the latest version, please email team@smooth.tel with a screenshot of this error message: ".concat(b.message," ").concat(b.stack),icon:"error"}),b;case 24:case"end":return e.stop()}}),e,null,[[4,18]])})));return function(t){return e.apply(this,arguments)}}(),c.handleNumberToUseChange=function(e){if(e){var t=Object.values(e);if(t.length){var a=t.map((function(e){return e.value})),n=c.getToNumbers(a),r=ar(c.state.deliveryMethod.value,n);c.setState({toNumbers:r,numberToUseField:t})}else c.setState({toNumbers:[],numberToUseField:[]})}},c.handleNotifyReplyChange=function(e){if(e){var t=e;c.setState({whoShouldBeNotified:t.value})}},c.handleDeliveryMethodChange=function(e){if(e){var t=e,a=ar(t.value,c.state.toNumbers);c.setState({deliveryMethod:t,toNumbers:a})}},c.handleChosenEmoji=function(e){c.setState({messageText:c.state.messageText+e.native})},c.handleEmojiButton=function(e){c.setState({anchorEl:e.currentTarget})},c.handleClose=function(){c.setState({anchorEl:null})},c.handleCheckboxChange=function(){c.setState({acceptableTimeForMessaging:!c.state.acceptableTimeForMessaging})},c.getFriendlyErrorMessage=function(e){return e?e.includes("is not a valid phone number")&&e.includes("'From'")?"There seems to be an issue with the From number you chose.\n      If you chose the number associated with your user profile, make sure you have updated it with a Twilio number.\n      Refer to <a href=\"https://delugeonaluge.com/twilio-extension-userguide.html>the user guide</a> for more details. Here's the full error from Twilio: ".concat(e):e.includes("The requested resource")?"There seems to be an error with the auth token/account SID for your Twilio account.\n      This often happens if you accidentally paste the account SID in the auth token field and vice versa.\n      Refer to <a href=\"https://delugeonaluge.com/twilio-extension-userguide.html>the user guide</a> for more details. Here's the full error from Twilio: ".concat(e):e:""};var u=tu(),d=fa(),m=gs(e.fromNumbers),p=hs(e.fromNumbers),g=c.props.selectedTemplate||(null===u||void 0===u?void 0:u.selectedTemplate)||c.props.smsTemplates&&c.props.smsTemplates[0];(null===(n=c.props.smsTemplates)||void 0===n?void 0:n.some((function(e){return e.template_id===g.template_id})))||(g=c.props.smsTemplates[0]);var f=$n(e.toNumbers[0],e.globalDefaultFieldToUse,e.moduleName);(null===u||void 0===u?void 0:u.numberToUseField)&&(f=u.numberToUseField);var v=c.getToNumbers([null===(o=f[0])||void 0===o||null===(l=o.value)||void 0===l?void 0:l.toString()]),b=c.props.toNumbers,y=W(e.fromNumbers,e.toNumbers[0],e.defaultPhonePrefix);return c.state={fromNumber:m||d||(null===u||void 0===u?void 0:u.fromNumber)||p||y||e.fromNumbers[0],toNumbers:v.length?v:b,messageText:"",loader:!1,selectedTemplate:g,uploadedImageFileNames:[],mediaURLs:[],acceptableTimeForMessaging:!1,hideDateTimeMenu:!1,numberToUseField:v.length?f:{value:"All Possible Numbers",label:"All Possible Numbers"},disabled:e.toNumbers[0].completeRecordData.twiliosmsextension0__Twilio_SMS_Message_Opt_Out,anchorEl:null,deliveryMethod:(null===u||void 0===u?void 0:u.deliveryMethod)||ce[0],whoShouldBeNotified:(null===u||void 0===u?void 0:u.whoShouldBeNotified)||ne,templateView:(null===u||void 0===u?void 0:u.templateView)||le.TEMPLATED,isSelectSendLater:!1},c}return Object(l.a)(a,[{key:"displayImage",value:function(){var e=this.state.mediaURLs;return null===e||void 0===e?void 0:e.map((function(e){return h.createElement("img",{key:e,src:e,alt:"template",style:{height:"100px",padding:"5px"}})}))}},{key:"componentDidMount",value:function(){this.state.templateView===le.TEMPLATED&&this.handleChangeTemplate(this.state.selectedTemplate)}},{key:"componentWillUnmount",value:function(){this.timeoutId&&clearTimeout(this.timeoutId)}},{key:"render",value:function(){var e=this,t=er(this.props.moduleName,!0,this.props.phoneNumberAPINames,this.props.toNumbers,this.props.currentRecordDetails,void 0,this.props.phoneFields),a=Boolean(this.state.anchorEl);return h.createElement("div",{className:this.props.classes.root},this.state.disabled?h.createElement(d.a,{severity:"error",style:{textAlign:"left"}},h.createElement(m.a,null,"This person has opted out of SMS communication with you."),"You won't be able to SMS them any more."):"",h.createElement("div",{className:this.state.disabled?this.props.classes.disabled:""},h.createElement(jt,{loading:this.props.loader||this.state.loader}),h.createElement(Ht,null),h.createElement("form",null,h.createElement("pre",{className:this.props.classes.fieldLabel},"From"),h.createElement(wc,{selectedFromNumber:this.state.fromNumber,fromNumbers:this.props.fromNumbers,handleChangedFromNumber:this.handleChangedFromNumber}),h.createElement("pre",{className:this.props.classes.fieldLabel},"Number to use"),h.createElement(to.a,{isMulti:!0,options:t,value:this.state.numberToUseField,onChange:this.handleNumberToUseChange}),h.createElement("pre",{className:this.props.classes.fieldLabel},"Delivery Method"),h.createElement(to.a,{options:ce,value:this.state.deliveryMethod,onChange:this.handleDeliveryMethodChange}),h.createElement("pre",{className:this.props.classes.fieldLabel},"Who should be notified of replies?"),h.createElement(to.a,{options:oe,value:oe.find((function(t){return t.value===e.state.whoShouldBeNotified})),onChange:this.handleNotifyReplyChange,getOptionLabel:function(e){return e.label}}),h.createElement("pre",{className:this.props.classes.fieldLabel},"To"),h.createElement(bu,{toNumbers:this.state.toNumbers,handleChangedToNumber:this.handleChangedToNumber}),h.createElement("div",{style:{display:"flex",marginTop:"1em"}},h.createElement(su,{labels:Object.values(le),selectedValue:this.state.templateView,onChangeValue:this.handleChangeTemplateView})),this.state.templateView===le.TEMPLATED&&h.createElement(h.Fragment,null,h.createElement("pre",{className:this.props.classes.fieldLabel},"Template"),h.createElement("div",{style:{display:"flex",flexDirection:"row"}},h.createElement(Ic,{smsTemplates:this.props.smsTemplates,handleChangeTemplate:this.handleChangeTemplate,currentRecordDetails:this.props.toNumbers[0].completeRecordData,selectedTemplate:this.state.selectedTemplate}),h.createElement(eo.a,{variant:"contained",color:"default",className:this.props.classes.editTemplate,onClick:this.handleEditTemplate},"Edit")),h.createElement(yc.a,{className:this.props.classes.addTemplate,onClick:this.handleTemplate},"+ Add New Template")),h.createElement("pre",{className:this.props.classes.fieldLabel},"Message"),h.createElement(Pc,{onMessageChange:this.handleMessageChange,messageText:this.state.messageText}),h.createElement("div",{className:this.props.classes.buttonContainer},h.createElement(E.a,{className:this.props.classes.emojiButton,onClick:this.handleEmojiButton},h.createElement(fo.a,null)),h.createElement(Ko.a,{open:a,anchorEl:this.state.anchorEl,onClose:this.handleClose,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"}},h.createElement(go.a,{onSelect:this.handleChosenEmoji,showSkinTones:!1,showPreview:!1,i18n:{search:"Search",categories:{search:"Search Results",recent:"Frequently Used",smileys:"Smileys & Emotion",people:"People & Body",nature:"Animals & Nature",foods:"Food & Drink",activity:"Activity",places:"Travel & Places",objects:"Objects",symbols:"Symbols",flags:"Flags",custom:"Custom"}}}))),h.createElement(xo,{mediaURLs:this.state.mediaURLs,handleImageUpload:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.state.mediaURLs,a=arguments.length>1?arguments[1]:void 0;e.setState({mediaURLs:t,uploadedImageFileNames:a})},uploadedImageFileNames:[]}),this.displayImage(),h.createElement("div",{style:{display:this.state.isSelectSendLater?"none":"block"}},h.createElement(ke,{fromNumber:this.state.fromNumber,workingHoursSettingsFromBackend:this.props.workingHoursSettingsFromBackend,toNumbers:this.state.toNumbers,onConfirmCritical:this.handleCheckboxChange,isSMSCritical:this.state.acceptableTimeForMessaging,classes:this.props.classes})),h.createElement("div",{className:this.props.classes.buttonSubmit},h.createElement($c,{handleSms:this.handleSms,handleCancel:this.handleCancel,disabled:Se(this.state.toNumbers,this.props.workingHoursSettingsFromBackend,this.state.fromNumber).length>0&&!this.state.acceptableTimeForMessaging,workingHoursSettingsFromBackend:this.props.workingHoursSettingsFromBackend,setIsSelectSendLater:this.setIsSelectSendLater})))))}}]),a}(h.Component),Su=Xl(Vt()((function(e){return Ut()({root:{textAlign:"center",paddingTop:e.spacing(2),marginLeft:e.spacing(5),marginRight:e.spacing(5)},cancelButton:{background:dc,fontSize:16,width:"17%",marginRight:e.spacing(.5),textTransform:"capitalize",fontFamily:'"ProximaNovaRegular",sans-serif'},sendButton:{background:mc,fontSize:16,width:"17%",textTransform:"capitalize",marginLeft:e.spacing(.5),fontFamily:'"ProximaNovaRegular",sans-serif'},buttonSubmit:{paddingTop:e.spacing(2),paddingBottom:e.spacing(2)},addTemplate:{lineHeight:"1.429rem",textTransform:"capitalize",width:"45%",marginTop:"5px",marginRight:"485px",display:"inline",color:"#2d7bd1",fontSize:15,textAlign:"left",fontFamily:'"ProximaNovaRegular",sans-serif',"&:hover":{textDecoration:"underline",color:"#333"}},editTemplate:{height:"38px",fontSize:16,width:"80px",textTransform:"capitalize",fontFamily:'"ProximaNovaRegular",sans-serif'},orgUrl:{color:"#2d7bd1"},formControl:{marginTop:e.spacing(3),backgroundColor:"white"},select:{textAlign:"left"},disabled:{display:"none"},buttonContainer:{width:"100%",display:"flex",alignItems:"flex-end",justifyContent:"flex-end"},emojiButton:{marginTop:-50},fieldLabel:{marginTop:"1em",marginBottom:0,textAlign:"left",fontFamily:'"ProximaNovaRegular",sans-serif'},checkboxLabel:{margin:0}})}))(yu)),wu=function(){var e=/orgVariable_(.+)/,t=Object.keys(localStorage),a=["twilio_settings","onboarding_data","twilio_org_settings_from_backend","twiliosmsextension0__Twilio_From_Numbers","check_credentials_in_backend"];t.forEach((function(t){(t.match(e)||a.includes(t))&&st(t)}))};function _u(e){return xu.apply(this,arguments)}function xu(){return(xu=Object(s.a)(r.a.mark((function e(t){var a,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"twiliosmsextension0__update_settings",a={arguments:JSON.stringify({variables:t})},e.next=4,ht.a.CRM.FUNCTIONS.execute("twiliosmsextension0__update_settings",a);case 4:return n=e.sent,e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Cu=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){var e;return g.a.createElement("div",null,this.props.circularLoader?g.a.createElement(Pt,{loading:!0}):g.a.createElement("div",null,g.a.createElement("h2",null,null===(e=this.props.code)||void 0===e?void 0:e.replace("_"," ")),g.a.createElement("p",null,this.props.errorMessage,".")))}}]),a}(g.a.Component),ku=function(e){var t=e.map((function(e){return e.replaceAll(",","")}));return Object(w.a)(new Set(t))},Eu=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).checkCustomAndAPIFields=Object(s.a)(r.a.mark((function e(){var t,a,o,s,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xa(n.props.moduleName);case 2:t=e.sent,a=t.fields.filter((function(e){return e.custom_field})).map((function(e){return{label:e.display_label,apiName:e.api_name,value:e.display_label}})),o=Array.isArray(n.props.phoneNumberAPINames)?n.props.phoneNumberAPINames:[],s=o.map((function(e){var t=a.find((function(t){return t.apiName===e}));return(null===t||void 0===t?void 0:t.label)||""})),i=a.filter((function(e){return!s.includes(e.label)})),n.setState({unusedFieldNames:i,apiFields:s.filter(Boolean)});case 8:case"end":return e.stop()}}),e)}))),n.handleSelectFieldChange=function(e){if(e){var t=e;n.setState({selectedField:t.apiName})}},n.handleButtonSave=Object(s.a)(r.a.mark((function e(){var t,a,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.state.selectedField){e.next=2;break}return e.abrupt("return");case 2:return n.setState({submitting:!0}),t=n.props.phoneNumberAPINames,a=t.concat(n.state.selectedField),a=ku(a),e.next=8,_u(JSON.stringify({twiliosmsextension0__Phone_Number_API_Names:JSON.stringify(a)}));case 8:o=e.sent,n.setState({submitting:!1}),"success"===o.code.toLowerCase()?n.props.hideHelpScreen():n.setState({code:o.code,errorMessage:o.message,circularLoader:!0},(function(){setInterval((function(){return n.setState({circularLoader:!1})}),2e3)}));case 11:case"end":return e.stop()}}),e)}))),n.state={unusedFieldNames:[],selectedField:"",apiFields:[],code:"success",errorMessage:"",circularLoader:!1,submitting:!1},n}return Object(l.a)(a,[{key:"displayHelpScreen",value:function(){var e;return g.a.createElement("div",null,g.a.createElement("h2",null,"I couldn't find any phone numbers for this record."),g.a.createElement("p",null,"I looked in these fields: "),g.a.createElement(G.a,{m:3},g.a.createElement("p",null,"- Phone"),g.a.createElement("p",null,"- Mobile"),g.a.createElement("p",null,"- Whatsapp Number for Twilio"),"Deals"===this.props.moduleName&&null!==(null===(e=this.props.currentRecordDetails.data)||void 0===e?void 0:e[0].Contact_Name)?g.a.createElement("p",null,"- Numbers From Contact"):"",this.state.apiFields.map((function(e){return"-"===e||void 0!==e?g.a.createElement("p",{key:e},"- ",e):""}))),g.a.createElement("p",null,"Do you store phone numbers in a different field? If so, choose the field from this dropdown and click save."),g.a.createElement(to.a,{className:this.props.classes.select,options:this.state.unusedFieldNames,onChange:this.handleSelectFieldChange,menuPlacement:"auto",isDisabled:this.state.submitting}),g.a.createElement("div",{className:this.props.classes.buttonSubmit},g.a.createElement(eo.a,{className:this.props.classes.backButton,variant:"contained",onClick:this.handleButtonSave,disabled:!this.state.selectedField||this.state.submitting},this.state.submitting?g.a.createElement(Q.a,{size:25}):"Save")))}},{key:"componentDidMount",value:function(){this.checkCustomAndAPIFields()}},{key:"render",value:function(){return g.a.createElement("div",{className:this.props.classes.root},"success"===this.state.code.toLowerCase()?this.displayHelpScreen():g.a.createElement(Cu,{circularLoader:this.state.circularLoader,code:this.state.code,errorMessage:"The receiver number was not updated, ".concat(this.state.errorMessage)}))}}]),a}(g.a.Component),Tu=Object(S.a)((function(e){return Ut()({root:{textAlign:"left",paddingTop:e.spacing(9),marginLeft:e.spacing(5),marginRight:e.spacing(5)},select:{minWidth:"40%",maxWidth:"50%",marginBottom:"2rem"}})}))(Eu),Nu=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).handleTextFieldChange=function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.setState({fromNumber:t.target.value});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.handleButtonSave=Object(s.a)(r.a.mark((function e(){var t,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_u(JSON.stringify({twiliosmsextension0__Default_Twilio_From_Number:n.state.fromNumber}));case 2:"success"===(a=e.sent).code.toLowerCase()&&"error"!==(null===(t=a.status)||void 0===t?void 0:t.toLowerCase())?n.props.hideHelpScreen():n.setState({code:a.code,errorMessage:a.message,circularLoader:!0},(function(){setInterval((function(){return n.setState({circularLoader:!1})}),2e3)}));case 4:case"end":return e.stop()}}),e)}))),n.state={fromNumber:"",code:"success",errorMessage:"",circularLoader:!1},n}return Object(l.a)(a,[{key:"displayHelpScreen",value:function(){return"-"===this.props.defaultFromNumber?g.a.createElement("div",null):g.a.createElement("div",null,g.a.createElement("h2",null,"There is no default number set in your account."),g.a.createElement("p",null,"I could not find any default from number in your account."),g.a.createElement("p",null,"Please enter the number that you want to share amongst all users with the + at the start (e.g. +61411123455) and click save."),g.a.createElement("p",null,"If you want each user to have their own number, set up records in the"," ",g.a.createElement("a",{href:"https://crm.zoho.com/crm/org".concat(this.props.onboardingScreenData.organisationID,"/tab/CustomModule4")},"Twilio From Numbers module"),"."),g.a.createElement(Do.a,{className:this.props.classes.MuiTextField_root,onChange:this.handleTextFieldChange,placeholder:"+61411123455",variant:"outlined",margin:"normal"}),g.a.createElement("div",{className:this.props.classes.buttonSubmit},g.a.createElement(eo.a,{className:this.props.classes.backButton,variant:"contained",onClick:this.handleButtonSave},"Save")))}},{key:"render",value:function(){return g.a.createElement("div",{className:this.props.classes.root},"success"===this.state.code.toLowerCase()?this.displayHelpScreen():g.a.createElement(Cu,{circularLoader:this.state.circularLoader,code:this.state.code,errorMessage:"Your default from number was not updated, ".concat(this.state.errorMessage)}))}}]),a}(g.a.Component),Iu=Object(S.a)((function(e){return Ut()({root:{textAlign:"left",paddingTop:e.spacing(9),marginLeft:e.spacing(5),marginRight:e.spacing(5)},MuiTextField_root:{width:"25%"}})}))(Nu),Ou=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).handleFieldChange=function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"authToken"===t.target.id?n.setState({authTokenValue:t.target.value}):n.setState({accountSIDValue:t.target.value});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.handleButtonSave=Object(s.a)(r.a.mark((function e(){var t,a,o,s,i,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.state.valuesToUpdate,o=n.state.authTokenValue,s=n.state.accountSIDValue,"both"===a?i={twiliosmsextension0__Twilio_auth:o,twiliosmsextension0__Account_SID:s}:"accountSID"===a?i={twiliosmsextension0__Account_SID:s}:"authToken"===a&&(i={twiliosmsextension0__Twilio_auth:o}),e.next=6,_u(JSON.stringify(i));case 6:"success"===(l=e.sent).code.toLowerCase()&&"error"!==(null===(t=l.status)||void 0===t?void 0:t.toLowerCase())?n.props.hideHelpScreen():n.setState({code:l.code,errorMessage:l.message,circularLoader:!0},(function(){setInterval((function(){return n.setState({circularLoader:!1})}),2e3)}));case 8:case"end":return e.stop()}}),e)}))),n.state={authTokenValue:"",accountSIDValue:"",valuesToUpdate:"",code:"success",errorMessage:"",circularLoader:!1},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this.props.authToken,t=this.props.accountSID;""!==e||t.startsWith("AC")&&""!==t?""!==t&&t.startsWith("AC")?""===e&&this.setState({valuesToUpdate:"authToken"}):this.setState({valuesToUpdate:"accountSID"}):this.setState({valuesToUpdate:"both"})}},{key:"authTokenField",value:function(){return g.a.createElement(Do.a,{id:"authToken",className:this.props.classes.MuiTextField_root,onChange:this.handleFieldChange,placeholder:"***",variant:"outlined",margin:"normal",type:"password",label:"AuthToken"})}},{key:"accountSIDField",value:function(){return g.a.createElement(Do.a,{id:"accountSID",className:this.props.classes.MuiTextField_root,onChange:this.handleFieldChange,placeholder:"AC...",variant:"outlined",margin:"normal",label:"Account SID"})}},{key:"updateBothDisplay",value:function(){return g.a.createElement("div",null,g.a.createElement("h2",null,"The AuthToken and Account SID are currently empty or incorrect."),g.a.createElement("p",null,"You can get the AuthToken and Account SID from your Twilio console."),g.a.createElement("p",null,"Please enter your AuthToken and Account SID in their corresponding text fields and click save."),this.authTokenField(),this.accountSIDField())}},{key:"updateAuthTokenDisplay",value:function(){return g.a.createElement("div",null,g.a.createElement("h2",null,"The AuthToken is currently empty."),g.a.createElement("p",null,"You can get the AuthToken from your Twilio console."),g.a.createElement("p",null,"Please enter your AuthToken below and click save."),this.authTokenField())}},{key:"updateAccountSIDDisplay",value:function(){return g.a.createElement("div",null,g.a.createElement("h2",null,"The Account SID is currently"," ",""===this.props.accountSID?" empty":" incorrect"),g.a.createElement("p",null,"You can get the Account SID from your Twilio console. It normally starts with AC."),g.a.createElement("p",null,"Please enter your Account SID below and click save."),this.accountSIDField())}},{key:"displayHelpScreen",value:function(){return g.a.createElement("div",null,"both"===this.state.valuesToUpdate&&this.updateBothDisplay(),"authToken"===this.state.valuesToUpdate&&this.updateAuthTokenDisplay(),"accountSID"===this.state.valuesToUpdate&&this.updateAccountSIDDisplay(),g.a.createElement("div",{className:this.props.classes.buttonSubmit},g.a.createElement(eo.a,{className:this.props.classes.backButton,variant:"contained",onClick:this.handleButtonSave},"Save")))}},{key:"render",value:function(){return g.a.createElement("div",{className:this.props.classes.root},"success"===this.state.code.toLowerCase()?this.displayHelpScreen():g.a.createElement(Cu,{circularLoader:this.state.circularLoader,code:this.state.code,errorMessage:"The AuthToken and Account SID was not updated, ".concat(this.state.errorMessage)}))}}]),a}(g.a.Component),Mu=Object(S.a)((function(e){return Ut()({root:{textAlign:"left",paddingTop:e.spacing(12),marginLeft:e.spacing(5),marginRight:e.spacing(5)},MuiTextField_root:{width:"30%",marginRight:"20px"}})}))(Ou);function Pu(e){return Au.apply(this,arguments)}function Au(){return(Au=Object(s.a)(r.a.mark((function e(t){var a,n,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"twiliosmsextension0__log_onboarding_data",a={arguments:JSON.stringify({onboardingData:t})},e.next=4,ht.a.CRM.FUNCTIONS.execute("twiliosmsextension0__log_onboarding_data",a);case 4:return n=e.sent,o=n.details.output,e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Du=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,St();case 2:return a=e.sent,n=Object(_.a)(Object(_.a)({},t),{},{crm_org_id:a.crm_org_id,z_api_key:a.z_api_key}),e.next=6,yt().post("api/v1/twilio_org_settings/",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ju=function(){var e=Object(s.a)(r.a.mark((function e(){var t,a=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:"",e.next=3,_u(JSON.stringify({twiliosmsextension0__Support_Person_Email_Address:t}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ru=function(){var e=Object(s.a)(r.a.mark((function e(){var t,a=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:"false",e.next=3,_u(JSON.stringify({twiliosmsextension0__Allow_users_to_see_each_others_messages:t}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Fu=function(){var e=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_u(JSON.stringify({twiliosmsextension0__Accepted_Terms_and_Conditions:"false",twiliosmsextension0__Block_Access:"true"}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Uu=function(){var e=Object(s.a)(r.a.mark((function e(){var t,a=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:"true",e.next=3,_u(JSON.stringify({twiliosmsextension0__Accepted_Terms_and_Conditions:t,twiliosmsextension0__Onboarding_Completed:"true"}));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Lu=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,o,s,i,l,c,u,d,m,p;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p={What_are_you_hoping_to_achieve_with_the_extension:Array.isArray(null===(a=t.useCase)||void 0===a?void 0:a.value)?null===(n=t.useCase)||void 0===n?void 0:n.value.join(", "):"",Industry:Array.isArray(null===(o=t.service)||void 0===o?void 0:o.value)?null===(s=t.service)||void 0===s?void 0:s.value.join(", "):"",Country:(null===(i=t.country)||void 0===i?void 0:i.value)?null===(l=JSON.stringify(null===(c=t.country)||void 0===c?void 0:c.value))||void 0===l?void 0:l.substring(0,100):"",Agreed_to_only_SMS_opted_in_people:"true"===(null===(u=t.agreeTerms)||void 0===u?void 0:u.value),Agreed_to_not_send_SMS_outside_business_hours:"true"===(null===(d=t.agreeSendTime)||void 0===d?void 0:d.value),Agreed_to_send_appropriate_MMS:"true"===(null===(m=t.agreeContent)||void 0===m?void 0:m.value)},e.next=3,Pu(JSON.stringify(p));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Vu=function(){var e=Object(h.useCallback)((function(e,t){sessionStorage.setItem(e,JSON.stringify(t||!0))}),[]);return{isStepCompleted:Object(h.useCallback)((function(e){return!!sessionStorage.getItem(e)}),[]),markStepComplete:e}},Bu=[],qu="",Wu="",zu="",Hu=function(e){var t,a,n,i=e.steps,l=e.triggerNextStep,c=e.trigger,u=e.stepId,d=Object(h.useState)(!1),m=Object(o.a)(d,2),p=m[0],f=m[1],v=Object(h.useState)(!1),b=Object(o.a)(v,2),y=b[0],S=b[1],x=Object(h.useState)([]),k=Object(o.a)(x,2),E=k[0],T=k[1],N=Object(h.useState)([]),I=Object(o.a)(N,2),O=I[0],M=I[1],P=Object(h.useState)({}),A=Object(o.a)(P,2),D=A[0],j=A[1],R=Vu(),F=R.markStepComplete,U=R.isStepCompleted;i&&(qu=null===(t=i.accountSID)||void 0===t?void 0:t.value,Wu=null===(a=i.authToken)||void 0===a?void 0:a.value,zu=null===(n=i.saveTokens)||void 0===n?void 0:n.value);if(Object(h.useEffect)((function(){function e(){return(e=Object(s.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Zt();case 2:t=e.sent,T([{full_name:"Available for All Users",id:"all_users"}].concat(Object(w.a)(t)));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(h.useEffect)((function(){ae&&(qu&&Wu&&!Bu.length&&zu&&(f(!0),function(){var e=Object(s.a)(r.a.mark((function e(){var t,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,aa();case 2:t=e.sent,a={},t.length?(Bu=t.map((function(e){return a[e.phoneNumber]={full_name:"Available for All Users",id:"all_users"},e})),M(t.map((function(e){return e.phoneNumber}))),j(a),f(!1)):l&&(qu="",Wu="",l({value:"",trigger:"retryCredentialsQuestion"}));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()))}),[zu]),Object(h.useEffect)((function(){ae||qu&&Wu&&!Bu.length&&(f(!0),function(){var e=Object(s.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_u(JSON.stringify({twiliosmsextension0__Twilio_auth:Wu,twiliosmsextension0__Account_SID:qu}));case 2:try{Du({twilio_account_sid:qu,twilio_auth_token:Wu})}catch(a){sessionStorage.setItem("updateBackendOrgSettings","false")}return e.next=5,sa();case 5:(t=e.sent).length?((Bu=t.map((function(e){return{crm_record_id:e.crm_record_id,owner_id:e.owner_id,phone_number:e.phone_number}}))).forEach((function(e){var t=e;t.twiliosmsextension0__Accessible_To_All_Users=!0,t.id=t.crm_record_id,pa(t)})),M(Bu.map((function(e){return e.phone_number}))),f(!1)):l&&(qu="",Wu="",l({value:"",trigger:"retryCredentialsQuestion"}));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()())}),[]),p)return g.a.createElement("span",null,"Fetching From numbers");var L=function(){var e=Object(s.a)(r.a.mark((function e(){var t,a,n,o,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!u||!U(u)){e.next=2;break}return e.abrupt("return");case 2:if(!ae){e.next=28;break}if(S(!0),t=[],a=[],Bu.forEach((function(e){O.includes(e.phoneNumber)?t.push(e):a.push(e)})),n=t.map((function(e){var t=D[e.phoneNumber];return{id:e.id,is_enabled:!0,number:e.phoneNumber,crm_owner_id:e.crm_owner_id,available_to_all_users:"all_users"===t.id,crm_record_id:"all_users"===t.id?null:t.id}})),o=a.map((function(e){var t=D[e.phoneNumber];return{id:e.id,is_enabled:!1,number:e.phoneNumber,crm_owner_id:e.crm_owner_id,available_to_all_users:"all_users"===t.id,crm_record_id:"all_users"===t.id?null:t.id}})),oa(n.concat(o)),!l){e.next=26;break}if(t.length){e.next=16;break}S(!1),l({value:[],trigger:"noFromNumberMessage"}),e.next=25;break;case 16:if(1!==t.length){e.next=23;break}return e.next=19,_u(JSON.stringify({twiliosmsextension0__Default_Twilio_From_Number:t[0].phoneNumber}));case 19:S(!1),l({value:t[0].phoneNumber,trigger:"tweakSettings"}),e.next=25;break;case 23:S(!1),l({value:t,trigger:c});case 25:u&&F(u);case 26:e.next=47;break;case 28:if(S(!0),s=[],Bu.forEach((function(e){O.includes(e.phone_number)?s.push(e):pa({twiliosmsextension0__Do_Not_Use_in_CRM:!0,id:e.crm_record_id})})),!l){e.next=47;break}if(s.length){e.next=37;break}S(!1),l({value:[],trigger:"noFromNumberMessage"}),e.next=46;break;case 37:if(1!==s.length){e.next=44;break}return e.next=40,_u(JSON.stringify({twiliosmsextension0__Default_Twilio_From_Number:s[0].phone_number}));case 40:S(!1),l({value:s[0].phone_number,trigger:"tweakSettings"}),e.next=46;break;case 44:S(!1),l({value:s,trigger:c});case 46:u&&F(u);case 47:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return g.a.createElement(Wi.a,null,g.a.createElement(zi.a,null,g.a.createElement(Hi.a,null,g.a.createElement(Li.a,null,g.a.createElement(Vi.a,null,"Use in CRM"),g.a.createElement(Vi.a,null,"Number"),g.a.createElement(Vi.a,null,"User"))),g.a.createElement(Yi.a,null,Bu.map((function(e){var t=ae?e.phoneNumber:e.phone_number,a=function(e){return O.includes(e)}(t);return g.a.createElement(Li.a,{key:t},g.a.createElement(Vi.a,null,g.a.createElement(C.a,{checked:a,onClick:function(e){return function(e,t){var a=O.indexOf(t),n=[];-1===a?n=n.concat(O,t):a>=0&&(n=n.concat(O.slice(0,a),O.slice(a+1))),M(n)}(0,t)}})),g.a.createElement(Vi.a,null,t),g.a.createElement(Vi.a,null,g.a.createElement(G.a,{width:200},g.a.createElement(to.a,{options:E,value:D[t],defaultValue:null===E||void 0===E?void 0:E[0],getOptionLabel:function(e){return e.full_name},getOptionValue:function(e){return e.id},onChange:function(t){return function(e,t){if(ae){var a=t,n=e;j((function(e){return Object(_.a)(Object(_.a)({},e),{},Object($t.a)({},a.phoneNumber,n))}))}else{var r=t,o=e;j((function(e){return Object(_.a)(Object(_.a)({},e),{},Object($t.a)({},r.phone_number,o))})),"all_users"===o.id?r.twiliosmsextension0__Accessible_To_All_Users=!0:r.Owner=o.id,r.id=r.crm_record_id,pa(r)}}(t,e)}}))))})),g.a.createElement(Li.a,null,g.a.createElement(Vi.a,{colSpan:3},g.a.createElement(eo.a,{onClick:L,disabled:y},y?"Updating...":"Ok"))))))},Yu=a(1113),Gu=Object(Ct.a)((function(){return{control:{display:"flex",alignItems:"center"},label:{fontSize:"18px",lineHeight:1.8}}})),Qu=function(e){var t=e.triggerNextStep,a=e.trigger,n=e.steps,i=e.stepId,l=Gu(),c=n.fromNumberSelect,u=Object(h.useState)(""),d=Object(o.a)(u,2),m=d[0],p=d[1],f=Object(h.useState)(!1),v=Object(o.a)(f,2),b=v[0],y=v[1],S=Vu(),w=S.markStepComplete,_=S.isStepCompleted,x=function(){var e=Object(s.a)(r.a.mark((function e(){var o,s,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i||!_(i)){e.next=2;break}return e.abrupt("return");case 2:y(!0),_u(JSON.stringify({twiliosmsextension0__Default_Twilio_From_Number:m})),l={Ok_with_pricing:"true"===(null===(o=n.agreePricing)||void 0===o?void 0:o.value),Have_You_Used_Twilio_Before:"true"===(null===(s=n.hasAccount)||void 0===s?void 0:s.value)},Pu(JSON.stringify(l)),y(!1),t&&(i&&w(i,m),t({value:m,trigger:a}));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),C=function(e){p(e)};return g.a.createElement(G.a,{display:"flex",flexDirection:"column"},g.a.createElement(G.a,{className:l.control,onClick:function(){return C("-")}},g.a.createElement(Yu.a,{checked:"-"===m}),g.a.createElement("span",{className:l.label},"No default number - assign each user a phone number and users without a number cannot use the extension")),c.value.map((function(e){var t=ae?e.phoneNumber:e.phone_number;return g.a.createElement(G.a,{key:t,onClick:function(){return C(t)},className:l.control},g.a.createElement(Yu.a,{checked:m===t}),g.a.createElement("span",{className:l.label},t))})),g.a.createElement(eo.a,{onClick:x,disabled:""===m||b,startIcon:b&&g.a.createElement(Q.a,{size:20})},b?"Updating...":"Ok"))},Ju=function(e){var t=e.loading,a=e.msg;return g.a.createElement(g.a.Fragment,null,t?g.a.createElement("div",{style:{display:"flex",gap:8,marginTop:10}},g.a.createElement(Q.a,{size:20}),g.a.createElement(Y.a,{variant:"caption"},a)):null)},Ku=function(e){var t=e.triggerNextStep,a=e.trigger,n=e.steps,i=e.displayText,l=(e.step,e.type),c=e.replace,u=e.updater,d=e.crmOrganisationID,m=Object(h.useState)(!0),p=Object(o.a)(m,2),f=p[0],v=p[1],b=Object(h.useRef)(!1);return Object(h.useEffect)((function(){(function(){var e=Object(s.a)(r.a.mark((function e(){var o,s,i,m,p,h,g,f,y,S,w,_,x,C;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||!n){e.next=38;break}e.t0=l,e.next="saveAgreements"===e.t0?4:"saveSeeEachOtherMessages"===e.t0?10:"saveNewEmail"===e.t0?14:"saveAcceptEula"===e.t0?17:"saveTokens"===e.t0?19:36;break;case 4:return y=!!(null===(o=n.agreeTerms)||void 0===o?void 0:o.value)&&!!(null===(s=n.agreeSendTime)||void 0===s?void 0:s.value)&&!!(null===(i=n.agreeContent)||void 0===i?void 0:i.value),Uu(null===y||void 0===y?void 0:y.toString()),"true"!==(null===y||void 0===y?void 0:y.toString())&&Fu(),Lu(n),t({trigger:a,value:""}),e.abrupt("break",38);case 10:Ru(null===(m=n.seeEachOtherMessages)||void 0===m?void 0:m.value);try{Du({allow_anyone_to_see_all_sms:null===(S=n.seeEachOtherMessages)||void 0===S?void 0:S.value})}catch(r){sessionStorage.setItem("updateBackendOrgSettings","false")}return t({trigger:a,value:""}),e.abrupt("break",38);case 14:return void 0===(null===(p=n.getEmailId)||void 0===p?void 0:p.value)&&""===(null===(h=n.getEmailId)||void 0===h?void 0:h.value)||ju(null===(w=n.getEmailId)||void 0===w?void 0:w.value),t({trigger:a,value:""}),e.abrupt("break",38);case 17:try{Du({accepted_eula:!0}),wr("accepted-eula"),t({trigger:a,value:""})}catch(r){sessionStorage.setItem("updateBackendOrgSettings","false")}return e.abrupt("break",38);case 19:if(_=null===(g=n.accountSID)||void 0===g?void 0:g.value,x=null===(f=n.authToken)||void 0===f?void 0:f.value,e.prev=21,b.current){e.next=30;break}return b.current=!0,C=new or.a(ge,{cluster:fe}),C.subscribe(d).bind("from_number_sync",(function(e){(null===e||void 0===e?void 0:e.synced)&&t&&t({trigger:a,value:!0})})),e.next=29,Du({twilio_account_sid:_,twilio_auth_token:x});case 29:ra();case 30:e.next=35;break;case 32:e.prev=32,e.t1=e.catch(21),sessionStorage.setItem("updateBackendOrgSettings","false");case 35:return e.abrupt("break",38);case 36:return u&&(_u(JSON.stringify(u)),t({trigger:a,value:""})),e.abrupt("break",38);case 38:c||v(!1);case 39:case"end":return e.stop()}}),e,null,[[21,32]])})));return function(){return e.apply(this,arguments)}})()()}),[]),f?g.a.createElement(Ju,{loading:f,msg:i}):!f&&c||f||c?null:g.a.createElement("div",null,g.a.createElement("p",null,i||"Saved ".concat(l," \ud83d\udc4c")))},Zu=a(1104),Xu=a(307),$u=a.n(Xu),ed=a(306),td=a.n(ed);function ad(e){return nd.apply(this,arguments)}function nd(){return(nd=Object(s.a)(r.a.mark((function e(t){var a,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ht.a.CRM.API.searchRecord({Entity:"Leads",Type:"phone",Query:t});case 2:if(!(a=e.sent).data){e.next=5;break}return e.abrupt("return",{module:"Leads",searchResults:a.data});case 5:return e.next=7,ht.a.CRM.API.searchRecord({Entity:"Contacts",Type:"phone",Query:t});case 7:if(!(n=e.sent).data){e.next=10;break}return e.abrupt("return",{module:"Contacts",searchResults:n.data});case 10:return e.abrupt("return",{module:"",searchResults:[]});case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rd(e,t,a,n,r,o){return od.apply(this,arguments)}function od(){return(od=Object(s.a)(r.a.mark((function e(t,a,n,i,l,c){var u,d,m,p,h,g,f,v,b,y,S,w,_,x,C,k,E,T;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p="",e.next=3,Xa(["twiliosmsextension0__Default_international_phone_prefix","twiliosmsextension0__Use_Separate_Twilio_Credentials_For_Every_User","twiliosmsextension0__Default_Twilio_From_Number","twiliosmsextension0__Account_SID"]);case 3:return h=e.sent,g=Object(o.a)(h,4),f=g[0],v=g[1],b=g[2],y=g[3],S=null===a||void 0===a||null===(u=a[0])||void 0===u||null===(d=u.completeRecordData)||void 0===d?void 0:d.Owner,w=a.map((function(e){var r=e.value,o=r.includes("whatsapp:");return{arguments:JSON.stringify({From:o&&!t.includes("whatsapp")?"whatsapp:".concat(t):t,To:o?"whatsapp:".concat(mr(r)):mr(r),Message:n,MediaURLs:i,Entity_Type:a[0].entity,To_Name:a[0].name,Entity_Id:a[0].lookupID,owner_id:c===ne?null===S||void 0===S?void 0:S.id:l,allow_duplicates:!1,default_international_prefix:f,twiliosmsextension0__Use_Separate_Twilio_Credentials_For_Every_User:v,twiliosmsextension0__Account_SID:y,twiliosmsextension0__Default_Twilio_From_Number:b})}})),"twiliosmsextension0__twiliosms",e.next=14,Promise.all(w.map(function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,o,s,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ht.a.CRM.FUNCTIONS.execute("twiliosmsextension0__twiliosms",t);case 3:i=e.sent,e.next=8;break;case 6:e.prev=6,e.t0=e.catch(0);case 8:if(null===(a=i)||void 0===a||null===(n=a.details)||void 0===n?void 0:n.output){e.next=12;break}return e.next=11,ht.a.CRM.FUNCTIONS.execute("twiliosmsextension0.twiliosms",t);case 11:i=e.sent;case 12:p=null===(o=i)||void 0===o||null===(s=o.details)||void 0===s?void 0:s.output;case 13:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()));case 14:return _=Le(p,"smsResult",{message:"Something went wrong"}),x=_.duplicate_record,C=_.status,k=x?"This message was blocked as you sent a duplicate message to this person recently. We have this feature to avoid you accidentally spamming your contacts. Contact team@smooth.tel if this is a problem for you.":_.message,((null===C||void 0===C?void 0:C.includes("Undelivered"))||(null===(m=_.more_info)||void 0===m?void 0:m.includes("error")))&&(k=C),E=_.date_created,T=_.sid,e.abrupt("return",{messageStatus:C,result:k,messageDate:E,messageSid:T,duplicateMessage:x});case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var sd="rsc_cache",id={color:"yellow",textDecoration:"underline",fontStyle:"italic"},ld="",cd=function(e){var t=e.options,a=e.triggerNextStep,n=e.trigger,r=e.step,s=Object(h.useState)({}),i=Object(o.a)(s,2),l=i[0],c=i[1];Object(h.useEffect)((function(){var e={};t.forEach((function(t){return e[t]=!1})),c(e)}),[t]);var u=function(e){c(Object(_.a)(Object(_.a)({},l),{},Object($t.a)({},e.target.name,e.target.checked)))},d=0===Object.values(l).filter((function(e){return e})).length;return g.a.createElement(G.a,{display:"flex",flexDirection:"column"},g.a.createElement(lu.a,null,g.a.createElement(Zu.a,null,Object.entries(l).map((function(e,t){var a=Object(o.a)(e,2),n=a[0],r=a[1];return g.a.createElement(x.a,{key:t,control:g.a.createElement(C.a,{name:n,onChange:u,checked:r}),label:n})})))),g.a.createElement(eo.a,{onClick:function(){var e=Object.entries(l).filter((function(e){var t=Object(o.a)(e,2);t[0];return t[1]})).map((function(e){var t=Object(o.a)(e,2),a=t[0];t[1];return a}));a&&n&&(r&&"service"===r.id&&!e.includes("None of these")?a({value:e,trigger:"reConfirmServiceOptions"}):a({value:e,trigger:n}))},disabled:d},"Ok"))},ud=function(e){var t=e.triggerNextStep,a=e.steps,n=Object(h.useState)(!1),i=Object(o.a)(n,2),l=i[0],c=i[1],u=function(){var e=Object(s.a)(r.a.mark((function e(n){var o,s,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n,s="",!t||!a){e.next=10;break}return i=a.messageType,c(!0),s=!i.value.toString().includes("Whatsapp")||o.hasSmsSupport||o.hasVoiceSupport?i.value.toString().includes("Whatsapp")&&(o.hasSmsSupport||o.hasVoiceSupport)||i.value.toString().includes("SMS")&&o.hasSmsSupport?"useCaseQuestion":"twilioCountryNotEnabled":"selectOtherCountryMessage",e.next=8,_u(JSON.stringify({twiliosmsextension0__Default_international_phone_prefix:o.value}));case 8:c(!1),t({value:o,trigger:s});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return g.a.createElement(g.a.Fragment,null,g.a.createElement(G.a,{width:300},g.a.createElement(to.a,{options:Uc,onChange:u,placeholder:"Select Country",isDisabled:l}),g.a.createElement(Ju,{loading:l,msg:"Noted. We're checking to make sure we can provide good service to you."})))},dd=function(){return g.a.createElement("div",null,g.a.createElement("p",null,"What is your Twilio Account SID? (Grab it from\xa0",g.a.createElement("a",{href:"https://www.twilio.com/console/project/settings",target:"_blank",style:id,rel:"noreferrer"},"https://www.twilio.com/console/project/settings"),")"),g.a.createElement("img",{src:"https://delugeonaluge.com/images/credentials.png",alt:"credentials",style:{height:"150px",borderRadius:"5px"}}))},md=function(){return g.a.createElement("div",null,g.a.createElement("p",null,"We may be able to offer a discount if you are in one of the following industries:"),g.a.createElement("ul",null,g.a.createElement("li",null,"Renewable energy"),g.a.createElement("li",null,"Charity"),g.a.createElement("li",null,"Social enterprise")),g.a.createElement("p",null,"Reach out to team@smooth.tel to discuss"))},pd=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,o,s,i,l,c,u,d,m,p,h=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.steps,l=!(h.length>1&&void 0!==h[1])||h[1],c={},void 0===(null===(a=i.seeEachOtherMessages)||void 0===a?void 0:a.value)&&"true"===(null===(n=i.seeEachOtherMessages)||void 0===n?void 0:n.value)||(c.allow_anyone_to_see_all_sms=null===(u=i.seeEachOtherMessages)||void 0===u?void 0:u.value),d=null===(o=i.accountSID)||void 0===o?void 0:o.value,m=null===(s=i.authToken)||void 0===s?void 0:s.value,!d||!m){e.next=12;break}if("false"!==sessionStorage.getItem("updateBackendOrgSettings")){e.next=12;break}return p=Object(_.a)({twilio_account_sid:d,twilio_auth_token:m},c),sessionStorage.removeItem("updateBackendOrgSettings"),e.next=12,Du(p);case 12:l&&localStorage.removeItem(sd);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),hd=function(e){var t=e.hideSetupBot,a=e.playVideo,n=e.steps,i=Object(h.useState)(!0),l=Object(o.a)(i,2),c=l[0],u=l[1];Object(h.useEffect)((function(){(function(){var e=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}return e.next=3,pd({steps:n});case 3:u(!1);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]);var d=function(){var e=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t();case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return g.a.createElement("div",{style:{display:"flex",flexDirection:"column",columnGap:"20px"}},a&&g.a.createElement("div",null,g.a.createElement("h3",null,"You're done! Just a quick video explaining how to use the extension."),g.a.createElement("iframe",{width:"600",height:"400",title:"Finished Setup",src:"https://www.youtube.com/embed/auSd9dX-txQ?autoplay=1",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})),g.a.createElement("div",{style:{marginTop:"20px"}},c?g.a.createElement("div",null,"Saving data ..."):g.a.createElement(eo.a,{variant:"contained",color:"primary",endIcon:g.a.createElement($u.a,null),onClick:d},"Start Sending SMS")))},gd=function(e){var t,a,n,i=e.steps,l=e.currentSelectedModule,c=e.currentUserId,u=e.triggerNextStep;i&&(ld=null===(n=i.phoneNumberInput)||void 0===n?void 0:n.value);var d="";i&&(null===(t=i.defaultNumberSelect)||void 0===t?void 0:t.value)?d=i.defaultNumberSelect.value:i&&(null===(a=i.fromNumberSelect)||void 0===a?void 0:a.value)&&(d=i.fromNumberSelect.value);var m=Object(h.useState)(!1),p=Object(o.a)(m,2),f=p[0],v=p[1],b=Object(h.useState)(""),y=Object(o.a)(b,2),S=y[0],w=y[1];return Object(h.useEffect)((function(){function e(){return(e=Object(s.a)(r.a.mark((function e(){var t,a,n,o,s,i,l,m,p,h,g;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(ld&&d&&u)){e.next=27;break}return v(!0),o={Phone:ld,Last_Name:"Smooth SMS Test ".concat(ld),id:""},e.next=5,ad(ld);case 5:if(s=e.sent,i=s.module,(l=s.searchResults).length){e.next=16;break}return e.next=11,Js(o);case 11:p=e.sent,i="Contacts",o.id=null===p||void 0===p||null===(m=p[0])||void 0===m?void 0:m.details.id,e.next=17;break;case 16:o=null===l||void 0===l?void 0:l[0];case 17:return"Hi, this is a demonstration message from the Smooth Messenger CRM extension.",h={value:ld,name:null===(t=o)||void 0===t?void 0:t.Last_Name,lookupID:null===(a=o)||void 0===a?void 0:a.id,entity:i,completeRecordData:o,phoneNumberFields:[]},e.next=21,rd(d,[h],"Hi, this is a demonstration message from the Smooth Messenger CRM extension.",[],c);case 21:return e.next=23,Vr(null===(n=o)||void 0===n?void 0:n.id,i);case 23:g=e.sent,w(g),v(!1),u({value:[],trigger:"betaTesterQuestion"});case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[l,d,c,u]),f?g.a.createElement("div",null,"Sending message"):g.a.createElement("div",null,"This message was sent. Now let's make sure you're getting replies."," ",g.a.createElement("a",{target:"_blank",rel:"noreferrer",href:S,style:Object(_.a)(Object(_.a)({},id),{},{fontWeight:"bold"})},"Click here")," ",'to open the CRM record for your phone number and then scroll down to the "Smooth Messaging" section. You should see replies come in there if you reply from your phone.')},fd=function(e){var t,a,n=e.steps,r=e.triggerNextStep,o=Object(h.useRef)(!1),s="";n&&!o.current&&(o.current=!0,(null===(t=n.defaultNumberSelect)||void 0===t?void 0:t.value)?s=n.defaultNumberSelect.value:(null===(a=n.fromNumberSelect)||void 0===a?void 0:a.value)&&(s=n.fromNumberSelect.value),!s.length&&r?r({value:"",trigger:"allSorted"}):r&&r({value:"",trigger:"phoneNumberQuestion"}));return g.a.createElement("div",null,"Awesome you've finished setting it up! Check out the user guide if you need tips on using the extension:\xa0",g.a.createElement("a",{href:"https://delugeonaluge.com/twilio-extension-userguide.html",target:"_blank",style:id,rel:"noreferrer"},"https://delugeonaluge.com/twilio-extension-userguide.html"))},vd={"Receive an email":g.a.createElement(g.a.Fragment,null,"Here\u2019s a video showing how the email to SMS feature works:"," ",g.a.createElement("a",{href:"https://youtu.be/sIryvyBx61U",target:"_blank",rel:"noreferrer",style:Object(_.a)(Object(_.a)({},id),{},{fontWeight:"bold"})},"https://youtu.be/sIryvyBx61U")),"Get notified via our mobile app":g.a.createElement(g.a.Fragment,null,"We have developed a standalone mobile app which allows you to receive/send SMS from your phone and make phone calls. There is a separate cost ($5/user/month or $50/org/month) for this as app development is very complicated. Contact"," ",g.a.createElement("a",{href:"mailto:team@smooth.tel",style:Object(_.a)(Object(_.a)({},id),{},{fontWeight:"bold"})},"team@smooth.tel")," ","if you\u2019d like a license."),"Get push notifications on your computer":g.a.createElement(g.a.Fragment,null,"Here's a video showing how to get push notifications"," ",g.a.createElement("a",{href:"https://www.youtube.com/watch?v=7M2Y2NpdcNc",target:"_blank",rel:"noreferrer",style:Object(_.a)(Object(_.a)({},id),{},{fontWeight:"bold"})},"https://youtu.be/7M2Y2NpdcNc")),"Check the Smooth Inbox tab in your own time":g.a.createElement(g.a.Fragment,null,"Here\u2019s a video showing how to use the Smooth Inbox tab"," ",g.a.createElement("a",{href:"https://youtu.be/I5ZlfS1wXwE",target:"_blank",rel:"noreferrer",style:Object(_.a)(Object(_.a)({},id),{},{fontWeight:"bold"})},"https://youtu.be/I5ZlfS1wXwE"))},bd=function(e){var t=e.steps,a=e.trigger,n=e.triggerNextStep,r=(t?t.notificationOptions:{value:[]}).value;return Object(h.useEffect)((function(){setTimeout((function(){a&&n&&n({value:"",trigger:"finishSetup"})}),r.length>0?3e3:1e3),r.includes("Receive an email")&&_u(JSON.stringify({twiliosmsextension0__SMS_to_Email:"true"}))}),[a,n,r]),g.a.createElement(G.a,null,r.map((function(e){var t=vd[e];return g.a.createElement(G.a,{key:e,mb:2},t)})))},yd=function(e){var t=e.totalSteps,a=Object(h.useState)(0),n=Object(o.a)(a,2),r=n[0],s=n[1];return Object(h.useEffect)((function(){var e=setInterval((function(){var e=rt(sd);if(e){var a,n,r=Le(e,sd,[]),o=null!==(a=null===r||void 0===r?void 0:r[3].length)&&void 0!==a?a:0,i=null!==(n=null===r||void 0===r?void 0:r[5])&&void 0!==n?n:"";t&&s("allSorted"===i?100:o/t*100)}}),1e3);return function(){clearInterval(e)}}),[t]),g.a.createElement(G.a,{display:"flex",alignItems:"center",mx:2,style:{backgroundColor:"#fff"}},g.a.createElement(G.a,{width:"100%",mr:1},g.a.createElement(At.a,{variant:"determinate",value:r})),g.a.createElement(G.a,{minWidth:35},g.a.createElement(Y.a,{variant:"body2",color:"textSecondary"},"".concat(Math.round(r),"%"))))},Sd=function(){var e=Object(s.a)(r.a.mark((function e(){var t,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,St();case 2:return t=e.sent,a={is_beta_tester:!0,crm_org_id:t.crm_org_id,z_api_key:t.z_api_key},e.next=6,yt().post("api/v1/twilio_org_settings/",a).catch((function(e){window.Sentry.captureException(e)}));case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),wd=function(){var e=Object(h.useState)(!0),t=Object(o.a)(e,2),a=t[0],n=t[1];return Object(h.useEffect)((function(){function e(){return(e=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Sd();case 2:e.sent&&n(!1);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),a?g.a.createElement("div",null,"Saving data ..."):g.a.createElement("div",null,g.a.createElement("p",null,"Congrats, you are a Beta Tester. We'll email you with new versions to test."))},_d=function(e){e.steps;var t=e.triggerNextStep,a=e.trigger,n=Object(h.useState)(""),i=Object(o.a)(n,2),l=i[0],c=i[1],u=function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c(t.target.value);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return g.a.createElement("div",null,g.a.createElement("p",null,"Please enter your email id."),g.a.createElement(Do.a,{id:"emailID",onChange:u,type:"text",value:l,inputProps:{style:{color:"#fff"}}}),g.a.createElement(eo.a,{style:{color:"#fff"},onClick:function(){t&&t({value:l,trigger:a})}},"Submit"))},xd=function(e){e.steps;var t=e.triggerNextStep,a=Object(h.useState)(""),n=Object(o.a)(a,2),i=n[0],l=n[1],c=Object(h.useState)(!0),u=Object(o.a)(c,2),d=u[0],m=u[1];return Object(h.useEffect)((function(){(function(){var e=Object(s.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,un(!1);case 2:t=e.sent,l(null===t||void 0===t?void 0:t.currentTimeInDelugeTimeZone),m(!1);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[t]),d?g.a.createElement("div",null,"Fetching CRM timezone data"):g.a.createElement("div",null,"Let's check that your CRM timezone is set up correctly. Is this the current time in your location ",i," ?")},Cd=function(e){var t=e.termsAccepted,a=e.hideSetupBot,n=function(e){var t=e.hasCredentials,a=e.termsAccepted,n=e.currentSelectedModule,r=e.currentUserId,o=e.hideSetupBot,s=e.onboardingData,i=e.supportPersonEmailAddress,l=e.onlyStandardAndAdminUsers,c=e.hasNotAcceptedEula,u=e.orgUsersCount,d=e.crmOrganisationID;return[{id:"welcomeScreen",message:t?"Hi there, we've recently updated our terms and conditions. We have a few questions to make sure you're using the extension the way it's intended to be used.":"Thanks for installing Smooth Messenger. I just need to gather a few details before you can start using it.",trigger:"messageTypeQuestion"},{id:"messageTypeQuestion",message:"What type of message are you going to send?",trigger:"messageType"},{id:"messageType",component:g.a.createElement(cd,{options:["SMS","Whatsapp"],trigger:t?"useCaseQuestion":"countryQuestion"})},{id:"countryQuestion",message:"What country are you wanting to send SMS to?",trigger:"country"},{id:"country",component:g.a.createElement(ud,null)},{id:"selectOtherCountryMessage",message:"Hi, unfortunately Twilio does not offer phone numbers in your country. You will not be able to send SMS or Whatsapp from a local number. In your situation, Twilio recommends that you use a number from a different country (e.g. a US based phone number). Following this approach, you\u2019ll be able to use this extension to send/receive Whatsapp messages to your contacts from an international number. If a local number is important to your business, you'll need to look at an alternative provider like MessageBird.",trigger:"selectOtherCountryQuestion"},{id:"selectOtherCountryQuestion",message:"Would this work for you?",trigger:"cotinueWithCountry"},{id:"cotinueWithCountry",options:[{value:"true",label:"Yes",trigger:"useCaseQuestion"},{value:"false",label:"No",trigger:"tryOtherPlugins"}]},{id:"twilioCountryNotEnabled",message:"Sorry it looks like Twilio won't work well in your country because they don't allow you to use local numbers. The only option available is to use a number from another country but that's not optimal because people won't easily be able to reply. Do you want to continue anyway?",trigger:"cotinueWithCountry"},{id:"tryOtherPlugins",component:g.a.createElement("div",null,"Ok sorry we couldn't help. Try some of the other plugins on Zoho Marketplace\xa0",g.a.createElement("a",{href:"https://marketplace.zoho.com/gsearch?searchTerm=sms",target:"_blank",style:id,rel:"noreferrer"},"https://marketplace.zoho.com/gsearch?searchTerm=sms")),asMessage:!0,end:!0},{id:"useCaseQuestion",message:"What are you hoping to achieve with this extension?",trigger:"useCase"},{id:"useCase",component:g.a.createElement(cd,{options:["Customer service via SMS","Automated SMS (e.g. appointment reminders)","SMS chatbots","SMS marketing after obtaining opt-in"],trigger:"guidelines"})},{id:"guidelines",message:"Twilio has messaging guidelines which you must follow. In addition, Smooth Messenger, the developer of this extension has restrictions on what organisations can use our software. Please answer the following questions truthfully to make sure you will adhere to the terms of service.",trigger:"serviceQuestion"},{id:"serviceQuestion",message:"Does your business primarily operate in any of the following industries?",trigger:"serviceOptions",delay:3e3},{id:"serviceOptions",component:g.a.createElement(Ao.a,{item:!0,xs:12,md:6},g.a.createElement("ul",{style:{width:"70vh"}},["Fossil fuel production","Tobacco/Alcohol/Other drugs","Gambling","Military/Weapons manufacturing","Religious organisations","Political lobbying","Industrial Livestock Production","Multi Level Marketing","Exploitative lending products (e.g. payday lending)","Debt collection"].map((function(e){return g.a.createElement("li",{key:e},e)})))),asMessage:!0,trigger:"serviceYesNo"},{id:"serviceYesNo",options:[{value:"true",label:"Yes",trigger:"reConfirmService"},{value:"false",label:"No",trigger:"agreeTermsQuestion"}]},{id:"reConfirmService",message:"Are you sure you meant this? Your use of the extension will be blocked as we cannot support this use case.",trigger:"reConfirmServiceOptions"},{id:"reConfirmServiceOptions",options:[{value:"true",label:"No it was a mistake",trigger:"serviceQuestion"},{value:"false",label:"Yup I understand I cannot use the extension",trigger:"serviceNotAllowed"}]},{id:"serviceNotAllowed",message:"Sorry it looks like you're planning on using SMS for a purpose we cannot support. The extension is now locked. If you want to discuss this, please contact team@smooth.tel",end:!0},{id:"agreeTermsQuestion",message:"Do you agree to only send SMS to people who have explicitly opted in to receive SMS from you? According to Twilio's terms and conditions, you cannot buy lead lists and do SMS blasts to people who have not given you permission.",trigger:"agreeTerms"},{id:"agreeTerms",options:[{value:"true",label:"Yes",trigger:"agreeMMSQuestion"},{value:"false",label:"No",trigger:"reConfirmAgreeTerms"}]},{id:"reConfirmAgreeTerms",message:"Are you sure you meant this? Your use of the extension will be blocked.",trigger:"reConfirmAgreeTermsOptions"},{id:"reConfirmAgreeTermsOptions",options:[{value:"true",label:"No it was a mistake",trigger:"agreeTermsQuestion"},{value:"false",label:"Yup I understand I cannot use the extension",trigger:"serviceNotAllowed"}]},{id:"agreeMMSQuestion",message:"Do you agree not to send MMS messages containing Not Safe For Work imagery (pornography/sexualised imagery/violent content)? Images you send may be monitored and your usage will be terminated if you breach this condition.",trigger:"agreeContent"},{id:"agreeContent",options:[{value:"true",label:"Yes",trigger:"agreeSendTimeQuestion"},{value:"false",label:"No",trigger:"reConfirmAgreeContent"}]},{id:"reConfirmAgreeContent",message:"Are you sure you meant this? Your use of the extension will be blocked.",trigger:"reConfirmAgreeContentOptions"},{id:"reConfirmAgreeContentOptions",options:[{value:"true",label:"No it was a mistake",trigger:"agreeMMSQuestion"},{value:"false",label:"Yup I understand I cannot use the extension",trigger:"serviceNotAllowed"}]},{id:"agreeSendTimeQuestion",message:"Do you agree not to message people outside standard business hours/send messages that are likely to be viewed as harassment?",trigger:"agreeSendTime"},{id:"agreeSendTime",options:[{value:"true",label:"Yes",trigger:"agreeNotToSendIllegalMessage"},{value:"false",label:"No",trigger:"reConfirmAgreeSendTime"}]},{id:"reConfirmAgreeSendTime",message:"Are you sure you meant this? Your use of the extension will be blocked.",trigger:"reConfirmAgreeSendTimeOptions"},{id:"reConfirmAgreeSendTimeOptions",options:[{value:"true",label:"No it was a mistake",trigger:"agreeSendTimeQuestion"},{value:"false",label:"Yup I understand I cannot use the extension",trigger:"serviceNotAllowed"}]},{id:"agreeNotToSendIllegalMessage",message:"Do you agree not to send messages that would be illegal in the recipient's country? For example, messages about cannabis/CBD are illegal in the US.",trigger:"agreeNotToSend"},{id:"agreeNotToSend",options:[{value:"true",label:"Yes",trigger:"agreeMessagePolicy"},{value:"false",label:"No",trigger:"reConfirmNotToSendIllegalMessage"}]},{id:"reConfirmNotToSendIllegalMessage",message:"Are you sure you meant this? Your use of the extension will be blocked.",trigger:"reConfirmagreeNotToSend"},{id:"reConfirmagreeNotToSend",options:[{value:"true",label:"No it was a mistake",trigger:"agreeNotToSendIllegalMessage"},{value:"false",label:"Yup I understand I cannot use the extension",trigger:"serviceNotAllowed"}]},{id:"agreeMessagePolicy",component:g.a.createElement("div",null,"Please confirm you have read\xa0",g.a.createElement("a",{href:"https://www.twilio.com/legal/messaging-policy",target:"_blank",style:id,rel:"noreferrer"},"Twilio's messaging policy"),"\xa0and will adhere to it."),asMessage:!0,trigger:"agreePolicy"},{id:"agreePolicy",options:[{value:"true",label:"Yes",trigger:"saveAgreements"},{value:"false",label:"No",trigger:"reConfirmagreeMessagePolicy"}]},{id:"reConfirmagreeMessagePolicy",message:"Are you sure you meant this? Your use of the extension will be blocked.",trigger:"reConfirmagreePolicy"},{id:"reConfirmagreePolicy",options:[{value:"true",label:"No it was a mistake",trigger:"agreeMessagePolicy"},{value:"false",label:"Yup I understand I cannot use the extension",trigger:"serviceNotAllowed"}]},{id:"saveAgreements",component:g.a.createElement(Ku,{trigger:c?"askAcceptEula":"continueSetup",type:"saveAgreements",displayText:"Great to hear that! We're setting up the extension for you...",replace:!0,crmOrganisationID:d}),replace:!0},{id:"askAcceptEula",component:g.a.createElement("span",null,"Finally please review"," ",g.a.createElement("a",{href:"https://smooth.tel/eula/",target:"_blank",rel:"noreferrer",style:id},"the Smooth Messenger end user license agreement")," ","and"," ",g.a.createElement("a",{href:"https://smooth.tel/privacy/",target:"_blank",style:id,rel:"noreferrer"},"the privacy policy")," ","and click agree to accept the agreement."),trigger:"acceptEulaAgree",asMessage:!0},{id:"acceptEulaAgree",options:[{value:"true",label:"Agree",trigger:"saveAcceptEula"}]},{id:"saveAcceptEula",component:g.a.createElement(Ku,{trigger:"continueSetup",type:"saveAcceptEula",displayText:"Thanks, we're updating your agreements...",replace:!0,crmOrganisationID:d}),replace:!0},{id:"continueSetup",message:"Great it looks like you are planning to use the extension in a way both Twilio and Smooth Messenger approve of. Because you fall into our target market, you can expect to receive enthusiastic, helpful and speedy customer service from us. If you ever have any issues, questions or suggestions, email team@smooth.tel",trigger:t?"allSorted":"pricing"},{id:"allSorted",component:g.a.createElement(hd,{hideSetupBot:o}),end:t||a},{id:"pricing",component:g.a.createElement("div",null,"You might be wondering about pricing. This extension costs $39 USD/month or $280/year for unlimited CRM users. In addition, you need to pay for your own Twilio costs (check out\xa0",g.a.createElement("a",{href:"https://www.twilio.com/sms/pricing/us",target:"_blank",style:id,rel:"noreferrer"},"https://www.twilio.com/sms/pricing/us"),"\xa0- in the US, it's $1/month per phone number and less than 1 cent per SMS). If you are a one person operation, the features of this extension may be more than you need and you might be better off going with another option on the Zoho Marketplace. If you have a team or you need advanced automation requirements, this extension is the one for you."),asMessage:!0,trigger:u<5?"discountContent":"pricingQuestion",delay:4e3},{id:"discountContent",component:g.a.createElement("p",null,g.a.createElement("i",null,"Special Discount:")," We've noticed you only have a few users in your CRM. As such, we are happy to offer a small business price: $20 USD/month or $180/year. Please contact us at"," ",g.a.createElement("a",{href:"mailto:team@smooth.tel",target:"_blank",style:id,rel:"noreferrer"},"team@smooth.tel")," ","to access the discounted price."),asMessage:!0,trigger:"pricingQuestion",delay:4e3},{id:"pricingQuestion",message:"Are you ok with the pricing?",trigger:"agreePricing",delay:5e3},{id:"agreePricing",options:[{value:"true",label:"Yes",trigger:"accountSetup"},{value:"false",label:"No",trigger:"priceDiscount"}]},{id:"priceDiscount",component:g.a.createElement(md,null),asMessage:!0,end:a,trigger:"accountSetup"},{id:"accountSetup",message:"Let's get this set up for you",trigger:"hasAccountQuestion"},{id:"hasAccountQuestion",message:"Do you have a Twilio account set up already?",trigger:"hasAccount"},{id:"hasAccount",options:[{value:"true",label:"Yes",trigger:"accountSIDQuestion"},{value:"false",label:"No",trigger:"setupNewAccount"}]},{id:"setupNewAccount",component:g.a.createElement("div",null,"Ok no problem - please set up a Twilio trial account following the instructions here\xa0",g.a.createElement("a",{href:"https://www.youtube.com/watch?v=9saDzvC6wWk",target:"_blank",style:id,rel:"noreferrer"},"https://www.youtube.com/watch?v=9saDzvC6wWk")),asMessage:!0,trigger:"accountSIDQuestion"},{id:"accountSIDQuestion",component:g.a.createElement(dd,null),asMessage:!0,trigger:"accountSID"},{id:"accountSID",user:!0,trigger:"authTokenQuestion",validator:function(e){return!!e.startsWith("AC")||"It looks like you might have entered the wrong value for Account SID. Account SID should start with AC. If you need help, please email team@smooth.tel "}},{id:"authTokenQuestion",component:g.a.createElement("div",null,"What is your Twilio Auth Token (Grab it from\xa0",g.a.createElement("a",{href:"https://www.twilio.com/console/project/settings",target:"_blank",style:id,rel:"noreferrer"},"https://www.twilio.com/console/project/settings"),")"),asMessage:!0,trigger:"authToken"},{id:"authToken",user:!0,trigger:ae?"saveTokens":"fromNumberQuestion",validator:function(e){return e.startsWith("AC")?"It looks like you might have entered the wrong value for auth token. You have entered a value starting with AC which is generally the account SID not the auth token. If you need help, please email team@smooth.tel":!(e.length<20)||"That auth token looks a bit short. Can you check it again? They're normally 32 characters long"}},{id:"saveTokens",component:g.a.createElement(Ku,{trigger:"fromNumberQuestion",type:"saveTokens",displayText:"Getting data from your tokens ...",replace:!0,crmOrganisationID:d}),replace:!0},{id:"retryCredentialsQuestion",message:"We couldn\u2019t find any from numbers using those credentials. Please verify that the auth token and account sid are correct and that you have set up phone numbers in your twilio account.",trigger:"retryCredentials"},{id:"retryCredentials",options:[{value:"true",label:"I definitely entered it correctly",trigger:"noFromNumberMessage"},{value:"false",label:"Oops let me enter the credentials again",trigger:"accountSIDQuestion"}]},{id:"fromNumberQuestion",message:"Which Twilio phone numbers do you want to use in your CRM?",trigger:"fromNumberSelect"},{id:"fromNumberSelect",waitAction:!0,component:g.a.createElement(Hu,{trigger:"defaultNumberQuestion"}),delay:0},{id:"noFromNumberMessage",component:g.a.createElement("div",null,"You don\u2019t have any Twilio numbers available. You won\u2019t be able to send any messages unless you plan on using alphanumeric sender IDs. If you are a new user, you should make sure you have set up a number in the twilio console. Refer to\xa0",g.a.createElement("a",{href:"https://www.youtube.com/watch?v=9saDzvC6wWk",target:"_blank",style:id,rel:"noreferrer"},"https://www.youtube.com/watch?v=9saDzvC6wWk"),"."),asMessage:!0,trigger:"noFromNumber"},{id:"noFromNumber",options:[{value:"true",label:"Continue without any numbers",trigger:"tweakSettings"},{value:"false",label:"Oops I have set up numbers now",trigger:"fromNumberQuestion"}]},{id:"defaultNumberQuestion",message:"Which number do you want to use by default?",trigger:"defaultNumberSelect"},{id:"defaultNumberSelect",component:g.a.createElement(Qu,{trigger:"tweakSettings"}),delay:0},{id:"tweakSettings",message:"Great we're nearly there. Now you'll need to tweak a few settings.",trigger:"".concat(l?"seeEachOtherMessageQuestion":"extensibilityQuestion")},{id:"extensibilityQuestion",component:g.a.createElement("div",null,"Have you enabled Manage Extensibility for all users? Watch this video for instructions \xa0",g.a.createElement("a",{href:"https://somup.com/cYl1Vb2F8P",target:"_blank",style:id,rel:"noreferrer"},"https://somup.com/cYl1Vb2F8P")),asMessage:!0,trigger:"manageExtensibility"},{id:"manageExtensibility",options:[{value:"true",label:"Yes",trigger:"seeEachOtherMessageQuestion"}]},{id:"seeEachOtherMessageQuestion",message:"Do you want users to be able to see each other's messages? (Helpful if you might have group conversations)",trigger:"seeEachOtherMessages"},{id:"seeEachOtherMessages",options:[{value:"true",label:"Yes",trigger:"changeSharingSettings"},{value:"false",label:"No",trigger:"telephonyQuestion"}]},{id:"changeSharingSettings",component:g.a.createElement(Ku,{displayText:"Thanks I've saved that in your settings",trigger:"telephonyQuestion",type:"saveSeeEachOtherMessages",crmOrganisationID:d}),asMessage:!0},{id:"telephonyQuestion",message:"Would you like to be able to make and receive phone calls using your Twilio numbers? We have a telephony integration available as part of our mobile app package. It costs $5/month/user.",trigger:"interestedInTelephony"},{id:"interestedInTelephony",options:[{value:"true",label:"Yes",trigger:"wantsTelephony"},{value:"false",label:"No",trigger:"timezone"}]},{id:"wantsTelephony",message:"Ok great. We would love to onboard you in our telephony program. Please email team@smooth.tel",trigger:"timezone"},{id:"timezone",component:g.a.createElement(xd,null),asMessage:!0,trigger:"timezoneCorrect"},{id:"timezoneCorrect",options:[{value:"true",label:"Yes",trigger:"notificationQuestion"},{value:"false",label:"No",trigger:"confirmTimezone"}]},{id:"confirmTimezone",component:g.a.createElement("p",null,"If this is wrong, your messages won't appear in the correct order."," ",g.a.createElement("a",{style:id,href:"mailto:partner-support@zohocorp.com?cc=team@smooth.tel&subject=Deluge%20timezone%20incorrect%20for%20".concat(s.adminEmail,"&body=Hi%20Zoho%2C%0D%0ACan%20you%20please%20fix%20the%20deluge%20timezone%20for%20my%20organisation%20").concat(s.organisationID,".%20It%20should%20be%20set%20to%20...%0D%0A%0D%0AThanks!")},"Click here to send an email to Zoho to correct it"),"."),asMessage:!0,trigger:"notificationQuestion"},{id:"finishSetup",component:g.a.createElement(fd,null),asMessage:!0,waitAction:!0},{id:"notificationQuestion",message:"How do you want to be notified of inbound SMS?",trigger:"notificationOptions"},{id:"notificationOptions",component:g.a.createElement(cd,{options:["Receive an email","Get notified via our mobile app","Get push notifications on your computer","Check the Smooth Inbox tab in your own time"],trigger:"notificationsSelected"})},{id:"notificationsSelected",component:g.a.createElement(bd,{trigger:"phoneNumberQuestion"}),asMessage:!0,waitAction:!0},{id:"phoneNumberQuestion",message:"Let's test this out. What's your phone number so we can send a test message from your CRM?",trigger:"phoneNumberInput"},{id:"phoneNumberInput",user:!0,trigger:"sendTestMessage"},{id:"sendTestMessage",component:g.a.createElement(gd,{currentSelectedModule:n,currentUserId:r}),asMessage:!0},{id:"betaTesterQuestion",message:"Would you like to be a beta tester and get early access to new features?",trigger:"betaTester"},{id:"betaTester",options:[{value:"true",label:"Yes",trigger:"betaTestingAccepted"},{value:"false",label:"No",trigger:"betaTestingDecline"}]},{id:"betaTestingAccepted",component:g.a.createElement(wd,null),asMessage:!0,trigger:"confirmEmailForBetaTester"},{id:"betaTestingDecline",message:"No worries. We'll let you know when there is a new version which has been thoroughly tested by beta testers",trigger:"allDone"},{id:"confirmEmailForBetaTester",message:"We currently have your email address down as "+i+". Is that correct?",trigger:"confirmEmail"},{id:"confirmEmail",options:[{value:"true",label:"Yes",trigger:"allDone"},{value:"false",label:"No",trigger:"getEmailId"}]},{id:"getEmailId",component:g.a.createElement(_d,{trigger:"saveNewEmail"}),asMessage:!0},{id:"saveNewEmail",component:g.a.createElement(Ku,{type:"saveNewEmail",displayText:"Saving email...",trigger:"allDone",replace:!0,crmOrganisationID:d}),replace:!0},{id:"allDone",component:g.a.createElement(hd,{hideSetupBot:o,playVideo:!0})},{id:"allSorted",component:g.a.createElement(hd,{hideSetupBot:o})}]}({hasCredentials:e.hasCredentials,termsAccepted:t,currentSelectedModule:e.currentSelectedModule,currentUserId:e.currentUserId,hideSetupBot:a,onboardingData:e.onboardingData,supportPersonEmailAddress:e.supportPersonEmailAddress,onlyStandardAndAdminUsers:e.onlyStandardAndAdminUsers,hasNotAcceptedEula:e.hasNotAcceptedEula,orgUsersCount:e.orgUsersCount,crmOrganisationID:e.crmOrganisationID}),r=window.location.href.includes("settings.html");return g.a.createElement(g.a.Fragment,null,g.a.createElement(td.a,{width:"100%",hideBotAvatar:!0,handleEnd:pd,headerComponent:g.a.createElement(yd,{totalSteps:n.length}),userDelay:500,cache:!0,bubbleStyle:{fontSize:"18px",lineHeight:1.8},style:{height:"80%"},contentStyle:r?{height:"89%"}:{},customStyle:{width:"fit-content",justifyContent:"flex-start"},steps:n}))},kd=function(e){var t=e.options,a=e.triggerNextStep,n=e.trigger,r=e.stepId,s=Object(h.useState)({}),i=Object(o.a)(s,2),l=i[0],c=i[1],u=Vu(),d=u.markStepComplete,m=u.isStepCompleted;Object(h.useEffect)((function(){var e={};t.forEach((function(t){return e[t]=!1})),c(e)}),[t]);var p=function(e){c(Object(_.a)(Object(_.a)({},l),{},Object($t.a)({},e.target.name,e.target.checked)))},f=0===Object.values(l).filter((function(e){return e})).length;return g.a.createElement(G.a,{display:"flex",flexDirection:"column"},g.a.createElement(lu.a,null,g.a.createElement(Zu.a,null,Object.entries(l).map((function(e,t){var a=Object(o.a)(e,2),n=a[0],r=a[1];return g.a.createElement(x.a,{key:t,control:g.a.createElement(C.a,{name:n,onChange:p,checked:r}),label:n})})))),g.a.createElement(eo.a,{onClick:function(){if(!m(r)){var e=Object.entries(l).filter((function(e){var t=Object(o.a)(e,2);t[0];return t[1]})).map((function(e){var t=Object(o.a)(e,2),a=t[0];t[1];return a}));a&&n&&(d(r,e),a({value:e,trigger:n}))}},disabled:f||m(r)},"Ok"))},Ed=function(e){var t=e.triggerNextStep,a=e.steps,n=e.stepId,i=Object(h.useState)(!1),l=Object(o.a)(i,2),c=l[0],u=l[1],d=Vu(),m=d.markStepComplete,p=d.isStepCompleted,f=function(){var e=Object(s.a)(r.a.mark((function e(o){var s,i,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!p(n)){e.next=2;break}return e.abrupt("return");case 2:if(s=o,i="",!t||!a){e.next=13;break}return l=a.messageType,u(!0),i=!l.value.toString().includes("Whatsapp")||s.hasSmsSupport||s.hasVoiceSupport?l.value.toString().includes("Whatsapp")&&(s.hasSmsSupport||s.hasVoiceSupport)||l.value.toString().includes("SMS")&&s.hasSmsSupport?"useCaseQuestion":"twilioCountryNotEnabled":"selectOtherCountryMessage",e.next=10,_u(JSON.stringify({twiliosmsextension0__Default_international_phone_prefix:s.value}));case 10:u(!1),m(n,s),t({value:s,trigger:i});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return g.a.createElement(g.a.Fragment,null,g.a.createElement(G.a,{width:300},g.a.createElement(to.a,{options:Uc,onChange:f,placeholder:"Select Country",isDisabled:c||p(n)}),g.a.createElement(Ju,{loading:c,msg:"Noted. We're checking to make sure we can provide good service to you."})))},Td=function(e){var t=e.style;return"apiKeyQuestion"===e.type?g.a.createElement("div",null,g.a.createElement("p",null,"What is your MessageMedia's API Key? (Grab it from\xa0",g.a.createElement("a",{href:"https://hub.messagemedia.com/api-settings",target:"_blank",style:t,rel:"noreferrer"},"https://hub.messagemedia.com/api-settings"),")"),g.a.createElement("img",{src:"https://delugeonaluge.com/images/credentials.png",alt:"credentials",style:{height:"150px",borderRadius:"5px"}})):g.a.createElement("div",null,"What is your MessageMedia's Secret Auth (Grab it from\xa0",g.a.createElement("a",{href:"https://hub.messagemedia.com/api-settings",target:"_blank",style:t,rel:"noreferrer"},"https://hub.messagemedia.com/api-settings"),")")},Nd=function(e){var t=e.triggerNextStep,a=Object(h.useState)(""),n=Object(o.a)(a,2),i=n[0],l=n[1],c=Object(h.useState)(!0),u=Object(o.a)(c,2),d=u[0],m=u[1];return Object(h.useEffect)((function(){(function(){var e=Object(s.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,un(!1);case 2:t=e.sent,l(null===t||void 0===t?void 0:t.currentTimeInDelugeTimeZone),m(!1);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[t]),d?g.a.createElement("div",null,"Fetching CRM timezone data"):g.a.createElement("div",null,"Let's check that your CRM timezone is set up correctly. Is this the current time in your location ",i," ?")},Id={color:"yellow",textDecoration:"underline",fontStyle:"italic"},Od={"Receive an email":g.a.createElement(g.a.Fragment,null,"Here\u2019s a video showing how the email to SMS feature works:"," ",g.a.createElement("a",{href:"https://youtu.be/sIryvyBx61U",target:"_blank",rel:"noreferrer",style:Object(_.a)(Object(_.a)({},Id),{},{fontWeight:"bold"})},"https://youtu.be/sIryvyBx61U")),"Get notified via our mobile app":g.a.createElement(g.a.Fragment,null,"We have developed a standalone mobile app which allows you to receive/send SMS from your phone and make phone calls. There is a separate cost ($5/user/month or $50/org/month) for this as app development is very complicated. Contact"," ",g.a.createElement("a",{href:"mailto:team@smooth.tel",style:Object(_.a)(Object(_.a)({},Id),{},{fontWeight:"bold"})},"team@smooth.tel")," ","if you'd like a license."),"Get push notifications on your computer":g.a.createElement(g.a.Fragment,null,"Here's a video showing how to get push notifications"," ",g.a.createElement("a",{href:"https://www.youtube.com/watch?v=7M2Y2NpdcNc",target:"_blank",rel:"noreferrer",style:Object(_.a)(Object(_.a)({},Id),{},{fontWeight:"bold"})},"https://youtu.be/7M2Y2NpdcNc")),"Check the Smooth Inbox tab in your own time":g.a.createElement(g.a.Fragment,null,"Here's a video showing how to use the Smooth Inbox tab"," ",g.a.createElement("a",{href:"https://youtu.be/I5ZlfS1wXwE",target:"_blank",rel:"noreferrer",style:Object(_.a)(Object(_.a)({},Id),{},{fontWeight:"bold"})},"https://youtu.be/I5ZlfS1wXwE"))},Md=function(e){var t=e.steps,a=e.trigger,n=e.triggerNextStep,r=(t?t.notificationOptions:{value:[]}).value;return Object(h.useEffect)((function(){setTimeout((function(){a&&n&&n({value:"",trigger:"finishSetup"})}),r.length>0?3e3:1e3),r.includes("Receive an email")&&_u(JSON.stringify({twiliosmsextension0__SMS_to_Email:"true"}))}),[a,n,r]),g.a.createElement(G.a,null,r.map((function(e){var t=Od[e];return g.a.createElement(G.a,{key:e,mb:2},t)})))},Pd={color:"yellow",textDecoration:"underline",fontStyle:"italic"},Ad="",Dd=function(e){var t,a,n,i=e.steps,l=e.currentSelectedModule,c=e.currentUserId,u=e.triggerNextStep;i&&(Ad=null===(n=i.phoneNumberInput)||void 0===n?void 0:n.value);var d="";i&&(null===(t=i.defaultNumberSelect)||void 0===t?void 0:t.value)?d=i.defaultNumberSelect.value:i&&(null===(a=i.fromNumberSelect)||void 0===a?void 0:a.value)&&(d=i.fromNumberSelect.value);var m=Object(h.useState)(!1),p=Object(o.a)(m,2),f=p[0],v=p[1],b=Object(h.useState)(""),y=Object(o.a)(b,2),S=y[0],w=y[1];return Object(h.useEffect)((function(){function e(){return(e=Object(s.a)(r.a.mark((function e(){var t,a,n,o,s,i,l,m,p,h,g;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Ad&&d&&u)){e.next=27;break}return v(!0),o={Phone:Ad,Last_Name:"Smooth SMS Test ".concat(Ad),id:""},e.next=5,ad(Ad);case 5:if(s=e.sent,i=s.module,(l=s.searchResults).length){e.next=16;break}return e.next=11,Js(o);case 11:p=e.sent,i="Contacts",o.id=null===p||void 0===p||null===(m=p[0])||void 0===m?void 0:m.details.id,e.next=17;break;case 16:o=null===l||void 0===l?void 0:l[0];case 17:return"Hi, this is a demonstration message from the Smooth Messenger CRM extension.",h={value:Ad,name:null===(t=o)||void 0===t?void 0:t.Last_Name,lookupID:null===(a=o)||void 0===a?void 0:a.id,entity:i,completeRecordData:o,phoneNumberFields:[]},e.next=21,rd(d,[h],"Hi, this is a demonstration message from the Smooth Messenger CRM extension.",[],c);case 21:return e.next=23,Vr(null===(n=o)||void 0===n?void 0:n.id,i);case 23:g=e.sent,w(g),v(!1),u({value:[],trigger:"betaTesterQuestion"});case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[l,d,c,u]),f?g.a.createElement("div",null,"Sending message"):g.a.createElement("div",null,"This message was sent. Now let's make sure you're getting replies."," ",g.a.createElement("a",{target:"_blank",rel:"noreferrer",href:S,style:Object(_.a)(Object(_.a)({},Pd),{},{fontWeight:"bold"})},"Click here")," ",'to open the CRM record for your phone number and then scroll down to the "Smooth Messaging" section. You should see replies come in there if you reply from your phone.')},jd=function(){var e=Object(s.a)(r.a.mark((function e(){var t,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,St();case 2:return t=e.sent,a={is_beta_tester:!0,crm_org_id:t.crm_org_id,z_api_key:t.z_api_key},e.next=6,yt().post("api/v1/twilio_org_settings/",a).catch((function(e){window.Sentry.captureException(e)}));case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Rd=function(){var e=Object(h.useState)(!0),t=Object(o.a)(e,2),a=t[0],n=t[1];return Object(h.useEffect)((function(){function e(){return(e=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,jd();case 2:e.sent&&n(!1);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),a?g.a.createElement("div",null,"Saving data ..."):g.a.createElement("div",null,g.a.createElement("p",null,"Congrats, you are a Beta Tester. We'll email you with new versions to test."))},Fd=function(e){var t=e.triggerNextStep,a=e.trigger,n=Object(h.useState)(""),i=Object(o.a)(n,2),l=i[0],c=i[1],u=function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c(t.target.value);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return g.a.createElement("div",null,g.a.createElement("p",null,"Please enter your email id."),g.a.createElement(Do.a,{id:"emailID",onChange:u,type:"text",value:l,inputProps:{style:{color:"#fff"}}}),g.a.createElement(eo.a,{style:{color:"#fff"},onClick:function(){t&&t({value:l,trigger:a})}},"Submit"))},Ud=[{value:"consulting",label:"Consulting"},{value:"realEstate",label:"Real Estate"},{value:"construction",label:"Construction"},{value:"other",label:"Other"}],Ld=function(e){var t=e.triggerNextStep,a=e.stepId,n=Object(h.useState)(!1),i=Object(o.a)(n,2),l=i[0],c=i[1],u=Vu(),d=u.markStepComplete,m=u.isStepCompleted,p=function(){var e=Object(s.a)(r.a.mark((function e(n){var o,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!m(a)){e.next=2;break}return e.abrupt("return");case 2:o=n,t&&(c(!0),s="other"===o.value?"serviceOtherInput":"agreeTermsQuestion",c(!1),d(a,o),t({value:o,trigger:s}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return g.a.createElement(g.a.Fragment,null,g.a.createElement(G.a,{width:300},g.a.createElement(to.a,{options:Ud,onChange:p,placeholder:"Select Your Industry",isDisabled:l||m(a)}),g.a.createElement(Ju,{loading:l,msg:"Noted. We're checking to make sure we can provide good service to you."})))},Vd=function(e){var t=e.open,a=e.onClose,n=e.onConfirm,r=e.children,o=e.content,s=e.title;return g.a.createElement(Us.a,{maxWidth:"xs",open:t,onClose:a},s&&g.a.createElement(Bs.a,null,s),g.a.createElement(Vs.a,null,o?g.a.createElement(bc.a,null,o):r),g.a.createElement(Ls.a,null,a&&g.a.createElement(eo.a,{onClick:a,color:"primary"},"Close"),n&&g.a.createElement(eo.a,{onClick:n,color:"primary",variant:"contained"},"Confirm")))},Bd="rsc_cache",qd=function(e){var t=e.totalSteps,a=Object(h.useState)(0),n=Object(o.a)(a,2),r=n[0],s=n[1],i=vo(),l=Object(o.a)(i,2),c=l[0],u=l[1];Object(h.useEffect)((function(){var e=setInterval((function(){var e=rt(Bd);if(e){var a,n,r=Le(e,Bd,[]),o=null!==(a=null===r||void 0===r?void 0:r[3].length)&&void 0!==a?a:0,i=null!==(n=null===r||void 0===r?void 0:r[5])&&void 0!==n?n:"";t&&s("allSorted"===i?100:o/t*100)}}),1e3);return function(){clearInterval(e)}}),[t]);return g.a.createElement(G.a,{display:"flex",alignItems:"center",mx:2,style:{backgroundColor:"#fff"}},g.a.createElement(G.a,{width:"100%",mr:1},g.a.createElement(At.a,{variant:"determinate",value:r})),g.a.createElement(G.a,{minWidth:35},g.a.createElement(Y.a,{variant:"body2",color:"textSecondary"},Math.round(r),"%")),g.a.createElement(G.a,null,g.a.createElement(eo.a,{title:"Restart the setup bot",variant:"text",color:"secondary",size:"small",onClick:u},"Reset")),g.a.createElement(Vd,{open:c,onClose:u,onConfirm:function(){nt(),window.location.reload()},title:"Are you sure?",content:"This will start the chatbot from the beginning."}))},Wd="rsc_cache",zd={color:"yellow",textDecoration:"underline",fontStyle:"italic"},Hd=function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,o,s,i,l,c,u,d,m,p,h=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.steps,l=!(h.length>1&&void 0!==h[1])||h[1],c={},void 0===(null===(a=i.seeEachOtherMessages)||void 0===a?void 0:a.value)&&"true"===(null===(n=i.seeEachOtherMessages)||void 0===n?void 0:n.value)||(c.allow_anyone_to_see_all_sms=null===(u=i.seeEachOtherMessages)||void 0===u?void 0:u.value),d=null===(o=i.accountSID)||void 0===o?void 0:o.value,m=null===(s=i.authToken)||void 0===s?void 0:s.value,!d||!m){e.next=12;break}if("false"!==sessionStorage.getItem("updateBackendOrgSettings")){e.next=12;break}return p=Object(_.a)({twilio_account_sid:d,twilio_auth_token:m},c),sessionStorage.removeItem("updateBackendOrgSettings"),e.next=12,Du(p);case 12:l&&localStorage.removeItem(Wd);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Yd=function(e){var t=e.hideSetupBot,a=e.playVideo,n=e.steps,i=Object(h.useState)(!0),l=Object(o.a)(i,2),c=l[0],u=l[1];Object(h.useEffect)((function(){(function(){var e=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=4;break}return e.next=3,Hd({steps:n});case 3:u(!1);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]);var d=function(){var e=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t();case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return g.a.createElement("div",{style:{display:"flex",flexDirection:"column",columnGap:"20px"}},a&&g.a.createElement("div",null,g.a.createElement("h3",null,"You're done! Just a quick video explaining how to use the extension."),g.a.createElement("iframe",{width:"600",height:"400",title:"Finished Setup",src:"https://www.youtube.com/embed/auSd9dX-txQ?autoplay=1",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})),g.a.createElement("div",{style:{marginTop:"20px"}},c?g.a.createElement("div",null,"Saving data ..."):g.a.createElement(eo.a,{variant:"contained",color:"primary",endIcon:g.a.createElement($u.a,null),onClick:d},"Start Sending SMS")))},Gd=function(e){var t,a,n=e.steps,r=e.triggerNextStep,o=Object(h.useRef)(!1),s="";n&&!o.current&&(o.current=!0,(null===(t=n.defaultNumberSelect)||void 0===t?void 0:t.value)?s=n.defaultNumberSelect.value:(null===(a=n.fromNumberSelect)||void 0===a?void 0:a.value)&&(s=n.fromNumberSelect.value),!s.length&&r?r({value:"",trigger:"allSorted"}):r&&r({value:"",trigger:"phoneNumberQuestion"}));return g.a.createElement("div",null,"Awesome you've finished setting it up! Check out the user guide if you need tips on using the extension:\xa0",g.a.createElement("a",{href:"https://delugeonaluge.com/twilio-extension-userguide.html",target:"_blank",style:zd,rel:"noreferrer"},"https://delugeonaluge.com/twilio-extension-userguide.html"))},Qd=function(e){var t=e.termsAccepted,a=e.hideSetupBot,n=function(e){var t=e.hasCredentials,a=e.termsAccepted,n=e.currentSelectedModule,r=e.currentUserId,o=e.hideSetupBot,s=e.onboardingData,i=e.supportPersonEmailAddress,l=e.onlyStandardAndAdminUsers,c=e.hasNotAcceptedEula,u=e.orgUsersCount,d=e.crmOrganisationID;return[{id:"welcomeScreen",message:t?"Hi there, we've recently updated our terms and conditions. We have a few questions to make sure you're using the extension the way it's intended to be used.":"Thanks for installing Smooth Messenger. I just need to gather a few details before you can start using it.",trigger:"messageTypeQuestion"},{id:"messageTypeQuestion",message:"What type of message are you going to send?",trigger:"messageType"},{id:"messageType",component:g.a.createElement(kd,{stepId:"messageType",options:["SMS","Whatsapp"],trigger:t?"useCaseQuestion":"countryQuestion"})},{id:"countryQuestion",message:"What country are you wanting to send SMS to?",trigger:"country"},{id:"country",component:g.a.createElement(Ed,{stepId:"country"})},{id:"selectOtherCountryMessage",message:"Hi, unfortunately MessageMedia does not offer phone numbers in your country. You will not be able to send SMS or Whatsapp from a local number. In your situation, MessageMedia recommends that you use a number from a different country (e.g. a US based phone number). Following this approach, you'll be able to use this extension to send/receive Whatsapp messages to your contacts from an international number. If a local number is important to your business, you'll need to look at an alternative provider like Twilio/MessageBird.",trigger:"selectOtherCountryQuestion"},{id:"selectOtherCountryQuestion",message:"Would this work for you?",trigger:"continueWithCountry"},{id:"continueWithCountry",options:[{value:"true",label:"Yes",trigger:"useCaseQuestion"},{value:"false",label:"No",trigger:"tryOtherPlugins"}]},{id:"twilioCountryNotEnabled",message:"Sorry it looks like MessageMedia won't work well in your country because they don't allow you to use local numbers. The only option available is to use a number from another country but that's not optimal because people won't easily be able to reply. Do you want to continue anyway?",trigger:"continueWithCountry"},{id:"tryOtherPlugins",component:g.a.createElement("div",null,"Ok sorry we couldn't help. Try some of the other plugins on Zoho Marketplace\xa0",g.a.createElement("a",{href:"https://marketplace.zoho.com/gsearch?searchTerm=sms",target:"_blank",style:zd,rel:"noreferrer"},"https://marketplace.zoho.com/gsearch?searchTerm=sms")),asMessage:!0,end:!0},{id:"useCaseQuestion",message:"What are you hoping to achieve with this extension?",trigger:"useCase"},{id:"useCase",component:g.a.createElement(kd,{stepId:"useCase",options:["Customer service via SMS","Automated SMS (e.g. appointment reminders)","SMS chatbots","SMS marketing after obtaining opt-in"],trigger:"guidelines"})},{id:"guidelines",message:"MessageMedia has messaging guidelines which you must follow. In addition, Smooth Messenger, the developer of this extension has restrictions on what organisations can use our software. Please answer the following questions truthfully to make sure you will adhere to the terms of service.",trigger:"serviceQuestion"},{id:"serviceQuestion",message:"What is your business industry?",trigger:"serviceSelection",delay:3e3},{id:"serviceSelection",component:g.a.createElement(Ld,{stepId:"serviceSelection"})},{id:"serviceOtherInput",user:!0,trigger:"agreeTermsQuestion"},{id:"serviceYesNo",options:[{value:"true",label:"Yes",trigger:"reConfirmService"},{value:"false",label:"No",trigger:"agreeTermsQuestion"}]},{id:"reConfirmService",message:"Are you sure you meant this? Your use of the extension will be blocked as we cannot support this use case.",trigger:"reConfirmServiceOptions"},{id:"reConfirmServiceOptions",options:[{value:"true",label:"No it was a mistake",trigger:"serviceQuestion"},{value:"false",label:"Yup I understand I cannot use the extension",trigger:"serviceNotAllowed"}]},{id:"serviceNotAllowed",message:"Sorry it looks like you're planning on using SMS for a purpose we cannot support. The extension is now locked. If you want to discuss this, please contact team@smooth.tel",end:!0},{id:"agreeTermsQuestion",message:"Do you agree to only send SMS to people who have explicitly opted in to receive SMS from you? According to MessageMedia's terms and conditions, you cannot buy lead lists and do SMS blasts to people who have not given you permission.",trigger:"agreeTerms"},{id:"agreeTerms",options:[{value:"true",label:"Yes",trigger:"agreeMMSQuestion"},{value:"false",label:"No",trigger:"reConfirmAgreeTerms"}]},{id:"reConfirmAgreeTerms",message:"Are you sure you meant this? Your use of the extension will be blocked.",trigger:"reConfirmAgreeTermsOptions"},{id:"reConfirmAgreeTermsOptions",options:[{value:"true",label:"No it was a mistake",trigger:"agreeTermsQuestion"},{value:"false",label:"Yup I understand I cannot use the extension",trigger:"serviceNotAllowed"}]},{id:"agreeMMSQuestion",message:"Do you agree not to send MMS messages containing Not Safe For Work imagery (pornography/sexualised imagery/violent content)? Images you send may be monitored and your usage will be terminated if you breach this condition.",trigger:"agreeContent"},{id:"agreeContent",options:[{value:"true",label:"Yes",trigger:"agreeSendTimeQuestion"},{value:"false",label:"No",trigger:"reConfirmAgreeContent"}]},{id:"reConfirmAgreeContent",message:"Are you sure you meant this? Your use of the extension will be blocked.",trigger:"reConfirmAgreeContentOptions"},{id:"reConfirmAgreeContentOptions",options:[{value:"true",label:"No it was a mistake",trigger:"agreeMMSQuestion"},{value:"false",label:"Yup I understand I cannot use the extension",trigger:"serviceNotAllowed"}]},{id:"agreeSendTimeQuestion",message:"Do you agree not to message people outside standard business hours/send messages that are likely to be viewed as harassment?",trigger:"agreeSendTime"},{id:"agreeSendTime",options:[{value:"true",label:"Yes",trigger:"agreeNotToSendIllegalMessage"},{value:"false",label:"No",trigger:"reConfirmAgreeSendTime"}]},{id:"reConfirmAgreeSendTime",message:"Are you sure you meant this? Your use of the extension will be blocked.",trigger:"reConfirmAgreeSendTimeOptions"},{id:"reConfirmAgreeSendTimeOptions",options:[{value:"true",label:"No it was a mistake",trigger:"agreeSendTimeQuestion"},{value:"false",label:"Yup I understand I cannot use the extension",trigger:"serviceNotAllowed"}]},{id:"agreeNotToSendIllegalMessage",message:"Do you agree not to send messages that would be illegal in the recipient's country? For example, messages about cannabis/CBD are illegal in the US.",trigger:"agreeNotToSend"},{id:"agreeNotToSend",options:[{value:"true",label:"Yes",trigger:"agreeMessagePolicy"},{value:"false",label:"No",trigger:"reConfirmNotToSendIllegalMessage"}]},{id:"reConfirmNotToSendIllegalMessage",message:"Are you sure you meant this? Your use of the extension will be blocked.",trigger:"reConfirmAgreeNotToSend"},{id:"reConfirmAgreeNotToSend",options:[{value:"true",label:"No it was a mistake",trigger:"agreeNotToSendIllegalMessage"},{value:"false",label:"Yup I understand I cannot use the extension",trigger:"serviceNotAllowed"}]},{id:"agreeMessagePolicy",component:g.a.createElement("div",null,"Please confirm you have read\xa0",g.a.createElement("a",{href:"https://www.twilio.com/legal/messaging-policy",target:"_blank",style:zd,rel:"noreferrer"},"MessageMedia's messaging policy"),"\xa0and will adhere to it."),asMessage:!0,trigger:"agreePolicy"},{id:"agreePolicy",options:[{value:"true",label:"Yes",trigger:"saveAgreements"},{value:"false",label:"No",trigger:"reConfirmAgreeMessagePolicy"}]},{id:"reConfirmAgreeMessagePolicy",message:"Are you sure you meant this? Your use of the extension will be blocked.",trigger:"reConfirmAgreePolicy"},{id:"reConfirmAgreePolicy",options:[{value:"true",label:"No it was a mistake",trigger:"agreeMessagePolicy"},{value:"false",label:"Yup I understand I cannot use the extension",trigger:"serviceNotAllowed"}]},{id:"saveAgreements",component:g.a.createElement(Ku,{trigger:c?"askAcceptEula":"continueSetup",type:"saveAgreements",displayText:"Great to hear that! We're setting up the extension for you...",replace:!0,crmOrganisationID:d}),replace:!0},{id:"askAcceptEula",component:g.a.createElement("span",null,"Finally please review"," ",g.a.createElement("a",{href:"https://smooth.tel/eula/",target:"_blank",rel:"noreferrer",style:zd},"the Smooth Messenger end user license agreement")," ","and"," ",g.a.createElement("a",{href:"https://smooth.tel/privacy/",target:"_blank",style:zd,rel:"noreferrer"},"the privacy policy")," ","and click agree to accept the agreement."),trigger:"acceptEulaAgree",asMessage:!0},{id:"acceptEulaAgree",options:[{value:"true",label:"Agree",trigger:"saveAcceptEula"}]},{id:"saveAcceptEula",component:g.a.createElement(Ku,{trigger:"continueSetup",type:"saveAcceptEula",displayText:"Thanks, we're updating your agreements...",replace:!0,crmOrganisationID:d}),replace:!0},{id:"continueSetup",message:"Great it looks like you are planning to use the extension in a way both MessageMedia and Smooth Messenger approve of. Because you fall into our target market, you can expect to receive enthusiastic, helpful and speedy customer service from us. If you ever have any issues, questions or suggestions, email team@smooth.tel",trigger:t?"allSorted":"pricing"},{id:"allSorted",component:g.a.createElement(Yd,{hideSetupBot:o}),end:t||a},{id:"pricing",component:g.a.createElement("div",null,"You might be wondering about pricing. This extension costs"," ",g.a.createElement("strong",null,"$39 USD/month "),"or ",g.a.createElement("strong",null,"$280/year")," for unlimited CRM users. In addition, you need to pay for your own MessageMedia costs (check out\xa0",g.a.createElement("a",{href:"https://www.twilio.com/sms/pricing/us",target:"_blank",style:zd,rel:"noreferrer"},"https://www.twilio.com/sms/pricing/us"),"\xa0- in the US, it's $1/month per phone number and less than 1 cent per SMS). If you are a one person operation, the features of this extension may be more than you need and you might be better off going with another option on the Zoho Marketplace. If you have a team or you need advanced automation requirements, this extension is the one for you."),asMessage:!0,trigger:u<5?"discountContent":"pricingQuestion",delay:4e3},{id:"discountContent",component:g.a.createElement("p",null,g.a.createElement("i",null,"Special Discount:")," We've noticed you only have a few users in your CRM. As such, we are happy to offer a small business price: $20 USD/month or $180/year. Please contact us at"," ",g.a.createElement("a",{href:"mailto:team@smooth.tel",target:"_blank",style:zd,rel:"noreferrer"},"team@smooth.tel")," ","to access the discounted price."),asMessage:!0,trigger:"pricingQuestion",delay:4e3},{id:"pricingQuestion",message:"Are you ok with the pricing?",trigger:"agreePricing",delay:5e3},{id:"agreePricing",options:[{value:"true",label:"Yes",trigger:"accountSetup"},{value:"false",label:"No",trigger:"priceDiscount"}]},{id:"priceDiscount",component:g.a.createElement("div",null,g.a.createElement("p",null,"We may be able to offer a discount if you are in one of the following industries:"),g.a.createElement("ul",null,g.a.createElement("li",null,"Renewable energy"),g.a.createElement("li",null,"Charity"),g.a.createElement("li",null,"Social enterprise")),g.a.createElement("p",null,"Reach out to team@smooth.tel to discuss")),asMessage:!0,end:a,trigger:"accountSetup"},{id:"accountSetup",message:"Let's get this set up for you",trigger:"hasAccountQuestion"},{id:"hasAccountQuestion",message:"Do you have a MessageMedia account set up already?",trigger:"hasAccount"},{id:"hasAccount",options:[{value:"true",label:"Yes",trigger:"apiKeyQuestion"},{value:"false",label:"No",trigger:"setupNewAccount"}]},{id:"setupNewAccount",component:g.a.createElement("div",null,"Ok no problem - please set up a MessageMedia trial account following the instructions here\xa0",g.a.createElement("a",{href:"https://www.youtube.com/watch?v=9saDzvC6wWk",target:"_blank",style:zd,rel:"noreferrer"},"https://www.youtube.com/watch?v=9saDzvC6wWk")),asMessage:!0,trigger:"apiKeyQuestion"},{id:"apiKeyQuestion",component:g.a.createElement(Td,{style:zd,type:"apiKeyQuestion"}),asMessage:!0,trigger:"accountSID"},{id:"accountSID",user:!0,trigger:"authSecretQuestion",validator:function(e){return!!e.startsWith("AC")||"It looks like you might have entered the wrong value for Account SID. Account SID should start with AC. If you need help, please email team@smooth.tel "}},{id:"authSecretQuestion",component:g.a.createElement(Td,{style:zd,type:"authSecretQuestion"}),asMessage:!0,trigger:"authToken"},{id:"authToken",user:!0,trigger:ae?"saveTokens":"fromNumberQuestion",validator:function(e){return e.startsWith("AC")?"It looks like you might have entered the wrong value for auth token. You have entered a value starting with AC which is generally the account SID not the auth token. If you need help, please email team@smooth.tel":!(e.length<20)||"That auth token looks a bit short. Can you check it again? They're normally 32 characters long"}},{id:"saveTokens",component:g.a.createElement(Ku,{trigger:"fromNumberQuestion",type:"saveTokens",displayText:"Getting data from your tokens ...",replace:!0,crmOrganisationID:d}),replace:!0},{id:"retryCredentialsQuestion",message:"We couldn't find any from numbers using those credentials. Please verify that the auth token and account sid are correct and that you have set up phone numbers in your twilio account.",trigger:"retryCredentials"},{id:"retryCredentials",options:[{value:"true",label:"I definitely entered it correctly",trigger:"noFromNumberMessage"},{value:"false",label:"Oops let me enter the credentials again",trigger:"apiKeyQuestion"}]},{id:"fromNumberQuestion",message:"Which MessageMedia phone numbers do you want to use in your CRM?",trigger:"fromNumberSelect"},{id:"fromNumberSelect",waitAction:!0,component:g.a.createElement(Hu,{trigger:"defaultNumberQuestion"}),delay:0},{id:"noFromNumberMessage",component:g.a.createElement("div",null,"You don't have any MessageMedia numbers available. You won't be able to send any messages unless you plan on using alphanumeric sender IDs. If you are a new user, you should make sure you have set up a number in the MessageMedia console. Refer to\xa0",g.a.createElement("a",{href:"https://www.youtube.com/watch?v=9saDzvC6wWk",target:"_blank",style:zd,rel:"noreferrer"},"https://www.youtube.com/watch?v=9saDzvC6wWk"),"."),asMessage:!0,trigger:"noFromNumber"},{id:"noFromNumber",options:[{value:"true",label:"Continue without any numbers",trigger:"tweakSettings"},{value:"false",label:"Oops I have set up numbers now",trigger:"fromNumberQuestion"}]},{id:"defaultNumberQuestion",message:"Which number do you want to use by default?",trigger:"defaultNumberSelect"},{id:"defaultNumberSelect",component:g.a.createElement(Qu,{trigger:"tweakSettings",stepId:"defaultNumberSelect"}),delay:0},{id:"tweakSettings",message:"Great we're nearly there. Now you'll need to tweak a few settings.",trigger:"".concat(l?"seeEachOtherMessageQuestion":"extensibilityQuestion")},{id:"extensibilityQuestion",component:g.a.createElement("div",null,"Have you enabled Manage Extensibility for all users? Watch this video for instructions \xa0",g.a.createElement("a",{href:"https://somup.com/cYl1Vb2F8P",target:"_blank",style:zd,rel:"noreferrer"},"https://somup.com/cYl1Vb2F8P")),asMessage:!0,trigger:"manageExtensibility"},{id:"manageExtensibility",options:[{value:"true",label:"Yes",trigger:"seeEachOtherMessageQuestion"}]},{id:"seeEachOtherMessageQuestion",message:"Do you want users to be able to see each other's messages? (Helpful if you might have group conversations)",trigger:"seeEachOtherMessages"},{id:"seeEachOtherMessages",options:[{value:"true",label:"Yes",trigger:"changeSharingSettings"},{value:"false",label:"No",trigger:"callForwardingQuestion"}]},{id:"changeSharingSettings",component:g.a.createElement(Ku,{displayText:"Thanks I've saved that in your settings",trigger:"callForwardingQuestion",type:"saveSeeEachOtherMessages",crmOrganisationID:d}),asMessage:!0},{id:"callForwardingQuestion",message:"Do you want to set up call forwarding for your MessageMedia numbers?",trigger:"callForwarding"},{id:"callForwarding",options:[{value:"true",label:"Yes",trigger:"callForwardingVideo"},{value:"false",label:"No",trigger:"timezone"}]},{id:"callForwardingVideo",component:g.a.createElement("div",null,g.a.createElement("iframe",{width:"600",height:"400",title:"Call forwarding",src:"https://www.youtube.com/embed/pDh9eV7SdRc?list=PLFi5sfhuunfaWcJasVOepyp_boKUprnNM",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})),trigger:"timezone"},{id:"timezone",component:g.a.createElement(Nd,null),asMessage:!0,trigger:"timezoneCorrect"},{id:"timezoneCorrect",options:[{value:"true",label:"Yes",trigger:"notificationQuestion"},{value:"false",label:"No",trigger:"confirmTimezone"}]},{id:"confirmTimezone",component:g.a.createElement("p",null,"If this is wrong, your messages won't appear in the correct order."," ",g.a.createElement("a",{style:zd,href:"mailto:partner-support@zohocorp.com?cc=team@smooth.tel&subject=Deluge%20timezone%20incorrect%20for%20".concat(s.adminEmail,"&body=Hi%20Zoho%2C%0D%0ACan%20you%20please%20fix%20the%20deluge%20timezone%20for%20my%20organisation%20").concat(s.organisationID,".%20It%20should%20be%20set%20to%20...%0D%0A%0D%0AThanks!")},"Click here to send an email to Zoho to correct it"),"."),asMessage:!0,trigger:"notificationQuestion"},{id:"finishSetup",component:g.a.createElement(Gd,null),asMessage:!0,waitAction:!0},{id:"notificationQuestion",message:"How do you want to be notified of inbound SMS?",trigger:"notificationOptions"},{id:"notificationOptions",component:g.a.createElement(kd,{stepId:"notificationOptions",options:["Receive an email","Get notified via our mobile app","Get push notifications on your computer","Check the Smooth Inbox tab in your own time"],trigger:"notificationsSelected"})},{id:"notificationsSelected",component:g.a.createElement(Md,{trigger:"phoneNumberQuestion"}),asMessage:!0,waitAction:!0},{id:"phoneNumberQuestion",message:"Let's test this out. What's your phone number so we can send a test message from your CRM?",trigger:"phoneNumberInput"},{id:"phoneNumberInput",user:!0,trigger:"sendTestMessage"},{id:"sendTestMessage",component:g.a.createElement(Dd,{currentSelectedModule:n,currentUserId:r}),asMessage:!0},{id:"betaTesterQuestion",message:"Would you like to be a beta tester and get early access to new features?",trigger:"betaTester"},{id:"betaTester",options:[{value:"true",label:"Yes",trigger:"betaTestingAccepted"},{value:"false",label:"No",trigger:"betaTestingDecline"}]},{id:"betaTestingAccepted",component:g.a.createElement(Rd,null),asMessage:!0,trigger:"confirmEmailForBetaTester"},{id:"betaTestingDecline",message:"No worries. We'll let you know when there is a new version which has been thoroughly tested by beta testers",trigger:"allDone"},{id:"confirmEmailForBetaTester",message:"We currently have your email address down as "+i+". Is that correct?",trigger:"confirmEmail"},{id:"confirmEmail",options:[{value:"true",label:"Yes",trigger:"allDone"},{value:"false",label:"No",trigger:"getEmailId"}]},{id:"getEmailId",component:g.a.createElement(Fd,{trigger:"saveNewEmail"}),asMessage:!0},{id:"saveNewEmail",component:g.a.createElement(Ku,{type:"saveNewEmail",displayText:"Saving email...",trigger:"allDone",replace:!0,crmOrganisationID:d}),replace:!0},{id:"allDone",component:g.a.createElement(Yd,{hideSetupBot:o,playVideo:!0})},{id:"allSorted",component:g.a.createElement(Yd,{hideSetupBot:o})}]}({hasCredentials:e.hasCredentials,termsAccepted:t,currentSelectedModule:e.currentSelectedModule,currentUserId:e.currentUserId,hideSetupBot:a,onboardingData:e.onboardingData,supportPersonEmailAddress:e.supportPersonEmailAddress,onlyStandardAndAdminUsers:e.onlyStandardAndAdminUsers,hasNotAcceptedEula:e.hasNotAcceptedEula,orgUsersCount:e.orgUsersCount,crmOrganisationID:e.crmOrganisationID}),r=window.location.href.includes("settings.html");return g.a.createElement(td.a,{width:"100%",hideBotAvatar:!0,handleEnd:Hd,headerComponent:g.a.createElement(qd,{totalSteps:n.length}),userDelay:500,cache:!0,bubbleStyle:{fontSize:"18px",lineHeight:1.8},style:{height:"80%"},contentStyle:r?{height:"89%"}:{},customStyle:{width:"fit-content",justifyContent:"flex-start"},steps:n})};function Jd(e,t){return Kd.apply(this,arguments)}function Kd(){return(Kd=Object(s.a)(r.a.mark((function e(t,a){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ht.a.CRM.API.updateRecord({Entity:a,APIData:{id:t.id,twiliosmsextension0__Twilio_Deliverability_Data:""},Trigger:["workflow"]});case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Zd=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(i.a)(this,a);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return(e=t.call.apply(t,[this].concat(o))).handleButtonSave=Object(s.a)(r.a.mark((function t(){var a,n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Jd(null===(a=e.props.currentRecordDetails)||void 0===a||null===(n=a.data)||void 0===n?void 0:n[0],e.props.currentSelectedModule);case 2:window.location.reload();case 3:case"end":return t.stop()}}),t)}))),e}return Object(l.a)(a,[{key:"render",value:function(){return g.a.createElement("div",{className:this.props.classes.root},g.a.createElement("div",{className:this.props.classes.buttonSubmit},g.a.createElement(eo.a,{className:this.props.classes.backButton,variant:"contained",onClick:this.handleButtonSave},"Clear Deliverability Data")))}}]),a}(g.a.Component),Xd=Object(S.a)((function(e){return Ut()({root:{textAlign:"left",paddingTop:e.spacing(16),marginLeft:e.spacing(5),marginRight:e.spacing(5)}})}))(Zd),$d=a(571),em=a.n($d);function tm(e,t,a){try{var n={kid:t,alg:"HS256"},r=function(e,t,a,n){var r={sub:e,exp:a};return em.a.sign(r,t,{header:n})}(e,a,Date.now()+2592e6,n),o=document.createElement("script");o.setAttribute("src","https://js.userlist.com/v1"),o.async=!0,o.setAttribute("data-userlist",r),document.head.appendChild(o)}catch(i){var s=Object.assign(i,{context:"Trying to add userlist script"});window.Sentry.captureException(s)}}function am(){return nm.apply(this,arguments)}function nm(){return(nm=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ht.a.CRM.FUNCTIONS.execute("twiliosmsextension0__sync_org_settings_to_backend_rest",{});case 3:return e.abrupt("return","synced");case 6:e.prev=6,e.t0=e.catch(0),console.error(e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}var rm=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).timeoutId=void 0,n.updateListOfTemplates=function(e){n.setState({smsTemplates:e}),n.loadDataFromZohoAPIAndUpdateLocalStorage(!0)},n.changeView=function(e){n.setState({view:e})},n.selectTemplateToEdit=function(e){n.setState({selectedTemplate:e})},n.state={fromNumbers:e.fromNumbers,toNumbers:e.toNumbers,smsTemplates:e.smsTemplates,widgetType:e.widgetType,view:"ListView"===e.widgetType?"bulk_sms":"send_sms",loading:!0,phoneNumberAPINames:[],globalDefaultFieldToUse:""},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){this.loadDataFromZohoAPIAndUpdateLocalStorage(),this.timeoutId=window.setTimeout((function(){H.hideHelpGuidesSidebar()}),1e3)}},{key:"componentWillUnmount",value:function(){this.timeoutId&&clearTimeout(this.timeoutId)}},{key:"loadDataFromZohoAPIAndUpdateLocalStorage",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var a,n,s,i,l,c,u,d,m;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t||this.setState({loading:!0}),n=(null===(a=this.state)||void 0===a?void 0:a.toNumbers)||this.props.toNumbers,s=n.map((function(e){return{data:[e.completeRecordData],entity:e.entity}})),e.next=5,Promise.all([Un(this.props,s,this.setState.bind(this),this.props.currentSelectedModule),Xa(["twiliosmsextension0__Phone_Number_API_Names","twiliosmsextension0__Field_to_use_for_bulk_SMS"])]);case 5:i=e.sent,l=Object(o.a)(i,2),c=Object(o.a)(l[1],2),u=c[0],d=c[1],m=Le(u,"phoneNumberAPINames",[]),this.setState({loading:!1,phoneNumberAPINames:m,globalDefaultFieldToUse:d});case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){if(this.state.loading)return h.createElement(Pt,{loading:!0});var e=this.state.view;return"createtemplate"===e?(wr("template-create"),h.createElement(hc,{changeView:this.changeView,widgetType:this.state.widgetType,updateListOfTemplates:this.updateListOfTemplates,currentModuleName:this.props.currentSelectedModule})):"EditTemplate"===e&&this.state.selectedTemplate?(wr("template-edit"),h.createElement(vc,{selectedTemplate:this.state.selectedTemplate,changeView:this.changeView,widgetType:this.state.widgetType,updateListOfTemplates:this.updateListOfTemplates,changeSelectedTemplate:this.selectTemplateToEdit})):"send_sms"===e&&this.state.toNumbers.length>0?(wr("single-message-open"),h.createElement(Su,{changeView:this.changeView,selectTemplateToEdit:this.selectTemplateToEdit,fromNumbers:this.state.fromNumbers,toNumbers:this.state.toNumbers,smsTemplates:this.state.smsTemplates||this.props.smsTemplates,loader:this.state.loading,widgetType:this.state.widgetType,phoneFields:this.props.phoneFields,selectedTemplate:this.state.selectedTemplate,phoneNumberAPINames:this.state.phoneNumberAPINames,globalDefaultFieldToUse:this.state.globalDefaultFieldToUse,moduleName:this.props.currentSelectedModule,lookupFieldsForCurrentEntity:this.props.lookupFieldsForCurrentEntity,currentUserId:this.props.currentUserId,defaultPhonePrefix:this.props.defaultPhonePrefix,currentRecordDetails:this.props.currentRecordDetails,lookupFieldsForSMSMessagesModule:this.props.lookupFieldsForSMSMessagesModule,currentUserEmail:this.props.currentUserEmail,workingHoursSettingsFromBackend:this.props.workingHoursSettingsFromBackend})):"bulk_sms"===e&&this.state.toNumbers.length?(wr("bulk-message-open"),h.createElement(fu,{changeView:this.changeView,selectTemplateToEdit:this.selectTemplateToEdit,fromNumbers:this.state.fromNumbers,toNumbers:this.state.toNumbers,smsTemplates:this.state.smsTemplates||this.props.smsTemplates,loader:this.state.loading,selectedTemplate:this.state.selectedTemplate,phoneNumberAPINames:this.state.phoneNumberAPINames,globalDefaultFieldToUse:this.state.globalDefaultFieldToUse,moduleName:this.props.currentSelectedModule,onboardingScreenData:this.props.onboardingScreenData,lookupFieldsForCurrentEntity:this.props.lookupFieldsForCurrentEntity,undeliverableToNumbers:this.props.undeliverableToNumbers,crmOrganisationID:this.props.crmOrganisationID,lookupFieldsForSMSMessagesModule:this.props.lookupFieldsForSMSMessagesModule,currentUserEmail:this.props.currentUserEmail,workingHoursSettingsFromBackend:this.props.workingHoursSettingsFromBackend})):"bulk_sms"!==e||this.state.toNumbers.length?"spinner"===e?h.createElement(Pt,{loading:!0}):null:h.createElement(h.Fragment,null,h.createElement("h1",null,"No phone numbers found"),h.createElement("p",null,"None of the records you selected for bulk SMS have phone numbers. Click back to search again"))}}]),a}(h.Component);function om(e){return sm.apply(this,arguments)}function sm(){return(sm=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:f.render(h.createElement(h.Fragment,null,h.createElement(Ht,null)),document.querySelector("#root")),zt({message:t});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function im(e,t,a){return lm.apply(this,arguments)}function lm(){return(lm=Object(s.a)(r.a.mark((function e(t,a,n){var s,i,l,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Xa(["twiliosmsextension0__Phone_Number_API_Names"]);case 2:s=e.sent,i=Object(o.a)(s,1),l=i[0],c=Le(l,"phoneNumberAPINames",[]),f.render(h.createElement(h.Fragment,null,h.createElement(Ht,null),h.createElement(Tu,{phoneNumberAPINames:c,moduleName:a,hideHelpScreen:function(){window.location.reload()},currentRecordDetails:n})),document.querySelector("#root")),zt({message:t});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function cm(e){return um.apply(this,arguments)}function um(){return(um=Object(s.a)(r.a.mark((function e(t){var a,n,s,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([un(),Xa(["twiliosmsextension0__Default_Twilio_From_Number"])]);case 2:a=e.sent,n=Object(o.a)(a,2),s=n[0],i=n[1],f.render(h.createElement(h.Fragment,null,h.createElement(Ht,null),h.createElement(Iu,{hideHelpScreen:function(){window.location.reload()},onboardingScreenData:s,defaultFromNumber:i[0]})),document.querySelector("#root")),zt({message:t});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function dm(e,t,a){return mm.apply(this,arguments)}function mm(){return(mm=Object(s.a)(r.a.mark((function e(t,a,n){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:f.render(h.createElement(h.Fragment,null,h.createElement(Ht,null),h.createElement(Mu,{hideHelpScreen:function(){window.location.reload()},authToken:a,accountSID:n})),document.querySelector("#root")),zt({message:t});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pm(e,t,a){return hm.apply(this,arguments)}function hm(){return(hm=Object(s.a)(r.a.mark((function e(t,a,n){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:f.render(h.createElement(h.Fragment,null,h.createElement(Ht,null),h.createElement(Xd,{currentRecordDetails:a,currentSelectedModule:n})),document.querySelector("#root")),zt({message:t});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function gm(){return fm.apply(this,arguments)}function fm(){return(fm=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:f.render(h.createElement(d.a,{severity:"error",style:{margin:"0 2rem"}},"Your browser does not support accessing local storage. We need access in order for the Twilio SMS extension to work. To fix this, please use the app in a normal browser rather than an incognito window. If you are using a privacy centric browser like Brave, you can allow access to cookies for this URL ",window.location.href,". If none of this makes sense, please contact team@smooth.tel and we'll help you."),document.querySelector("#root"));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function vm(e){return bm.apply(this,arguments)}function bm(){return(bm=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:f.render(h.createElement(d.a,{severity:"error",style:{margin:"0 2rem"}},"The Twilio extension has not been enabled for this user. Please ask your admin to update the permissions. Contact team@smooth.tel if you need help."," ",t.message),document.querySelector("#root"));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ym(e){e||f.render(h.createElement(Pt,{loading:!0}),document.querySelector("#root"))}function Sm(e){return wm.apply(this,arguments)}function wm(){return(wm=Object(s.a)(r.a.mark((function e(t){var a,n,s,i,l,c,u,g,v,b,y,S,w,_,x,C,k,E,T,N,I,O,M,P,A,D,j,R,F,U,L,V,B,q,W,z,Y,G,Q,J,K,Z,X,$,ee,te,ne,re,oe,ie,le,ce,ue,de,me,pe,he,ge,fe,ve,be,ye,Se,we,_e,xe,Ce,ke,Ee,Te,Ne,Ie,Oe,Me,Pe,Ae,De,Re,Fe,Ue,Ve,Be,qe,We,ze,He,Ye,Ge,Qe,Je,Ke,Ze,Xe,$e,et,tt,at,rt;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c=window.location.href.includes("settings.html"),u=window.location.href.includes("powerCall.html"),st("orgVariable_twiliosmsextension0__Default_Twilio_From_Number","twiliosmsextension0__Twilio_From_Numbers"),ym(c||u),g=se,e.next=8,Promise.all([rn(t),vt(),Yn()]);case 8:if(v=e.sent,b=Object(o.a)(v,3),y=b[0],S=b[1],w=b[2],_=!ea(null===w||void 0===w?void 0:w.accepted_eula),(null===w||void 0===w?void 0:w.start_time)&&(null===w||void 0===w?void 0:w.end_time)&&(x=Le(w.acceptable_weekdays,"acceptableWeekdays",se.weekDays),g={startTime:w.start_time,endTime:w.end_time,weekDays:x,defaultCountryCode:w.country_code}),null===w||void 0===w?void 0:w.id){e.next=20;break}return f.render(h.createElement(d.a,{severity:"info"},"Please wait..syncing with the backend"),document.querySelector("#root")),e.next=19,am();case 19:return e.abrupt("return",Ua({functionName:"syncOrgSettingsWithBackend",data:w,message:je},(function(){st("twilio_org_settings_from_backend","crm_organisation_info","crm_organisation_id","data_for_extension")})));case 20:if(st("reload_window_count"),C="",k="",!ae){e.next=31;break}return e.next=26,Jn();case 26:N=e.sent,C=null!==(E=null===N||void 0===N?void 0:N.auth_token)&&void 0!==E?E:"",k=null!==(T=null===N||void 0===N?void 0:N.account_sid)&&void 0!==T?T:"",e.next=33;break;case 31:C=null!==(I=null===w||void 0===w?void 0:w.twilio_auth_token)&&void 0!==I?I:"",k=null!==(O=null===w||void 0===w?void 0:w.twilio_account_sid)&&void 0!==O?O:"";case 33:return M=y.currentSelectedModule,P=y.phoneNumberAPINamesData,A=y.globalFieldToUseForNumber,D=Le(P,"phoneNumberAPINames",[]),e.next=39,ka(M);case 39:return j=e.sent,R=y.currentUserData,F=((null===R||void 0===R?void 0:R.users)||[])[0],U=["Administrator","Manager","Madministrator"].includes((null===F||void 0===F||null===(a=F.profile)||void 0===a?void 0:a.name)||""),L=F.email||"",e.next=46,Er(M);case 46:if(e.sent){e.next=49;break}return e.abrupt("return",om("The ".concat(M," module is currently disabled.\n      Please refer to https://www.youtube.com/watch?v=3P4RN7kqDZ0 to enable the module.")));case 49:return e.next=51,Promise.all([mn(),Xa(["twiliosmsextension0__Accepted_Terms_and_Conditions","twiliosmsextension0__Block_Access"])]);case 51:if(V=e.sent,B=Object(o.a)(V,2),q=B[0],W=Object(o.a)(B[1],2),z=W[0],Y=W[1],G=Boolean(k)&&Boolean(C),Q=ea(null===z||void 0===z?void 0:z.toString()),J=(!q||!G||!Q)&&U){e.next=71;break}if(Boolean(C)){e.next=66;break}return wr("error-incorrect-auth-token"),dm("AuthToken is empty or incorrect. Please update the value in the extension settings and try again.",C,k),nt(),e.abrupt("return");case 66:if(Boolean(k)){e.next=71;break}return wr("error-incorrect-account-sid"),dm("AccountSID is empty or incorrect. Please update the value in the extension settings and try again.",C,k),nt(),e.abrupt("return");case 71:return K=Object(p.compact)(Object(p.uniqBy)((y.messages||[]).map((function(e){return"outbound"===e.messageType?{value:e.owner_id,label:e.ownerName}:null})),"value")),e.next=74,Promise.all([Xa(["twiliosmsextension0__Default_international_phone_prefix","twiliosmsextension0__Allow_users_to_see_each_others_messages","twiliosmsextension0__Create_tasks_for_inbound_messages"]),un(),Gn("twiliosmsextension0__Sent_SMS"),Zt()]);case 74:if(Z=e.sent,X=Object(o.a)(Z,4),$=Object(o.a)(X[0],2),ee=$[0],te=$[1],ne=X[1],re=X[2],oe=X[3],xr(F,R,S),ie=y.fromData,le=y.templatesForThisEntity,ce=y.currentRecordDetails,ue=Le(null===ce||void 0===ce||null===(n=ce.data)||void 0===n||null===(s=n[0])||void 0===s?void 0:s.twiliosmsextension0__Twilio_Deliverability_Data,"deliverability_data",{}),M||c){e.next=135;break}if(de=U||ea(te),me=oe,pe=[],de){e.next=96;break}st(_s,Ss,ws),me=[],e.next=99;break;case 96:return e.next=98,no();case 98:pe=e.sent;case 99:return he=Ms(pe,F.id,de),ge=he.currentFilterUserId,fe=he.currentFilterTeamId,ve=Os(),e.next=103,On(ge,!1,ve,de,fe);case 103:return be=e.sent,ye={fromData:[],toArray:[],messages:[]},Se=[],we=[],_e=0,e.next=110,Xa(["twiliosmsextension0__Default_Twilio_From_Number"]);case 110:if(xe=e.sent,Ce=Object(o.a)(xe,1),ke=Ce[0],!be.length){e.next=129;break}return Te=be.filter((function(e){return e.moduleName})).map((function(e){return e.moduleName})),e.next=117,Tr(Te);case 117:if(Ne=e.sent,Ie=Ne.availableModules,Oe=Ne.unavailableModules,we=Ie,Se=Oe,!(Me=be.find((function(e,t){return _e=t,e.moduleName===we[0]})))){e.next=129;break}return e.next=126,Jr(Me,R);case 126:ye=e.sent,Pe=ye.toArray[0],Ee=null===Pe||void 0===Pe?void 0:Pe.completeRecordData;case 129:if(!be.length||ye.fromData.length||"-"!==ke&&ke){e.next=133;break}return wr("error-no-from-numbers"),nt(),e.abrupt("return",cm("You don't have any from numbers set up currently. Set the default from number or add records to the Twilio From Numbers module."));case 133:return wr("inbox-open"),e.abrupt("return",f.render(h.createElement(Fl,{unrepliedConversations:be,indexOfFirstConversationHasAvailableModule:_e,currentUserData:R,availableModules:we,firstDataForInbox:ye},h.createElement(ql,{currentUserId:F.id,currentUserName:F.full_name,currentFilterUserId:ge,currentFilterTeamId:fe,unrepliedConversations:be,globalDefaultFieldToUse:A,fromNumbers:ye.fromData,toNumbers:ye.toArray,phoneFields:j,messages:ye.messages,crmOrganisationID:S,currentRecordDetails:Ee,phoneNumberAPINames:D,ownerArray:K,defaultPhonePrefix:ee,isOwnerFilterEnabled:de,activeUsers:me,smsTemplates:le,onboardingScreenData:ne,lookupFieldsForSMSMessagesModule:re,deliverabilityData:ue,isAdminUser:U,currentUserEmail:F.email,workingHoursSettingsFromBackend:g,unavailableModules:Se,availableModules:we,indexOfFirstConversationHasAvailableModule:_e,teams:pe})),document.querySelector("#root")));case 135:if(!ea(Y)){e.next=138;break}return wr("error-access-blocked"),e.abrupt("return",f.render(h.createElement(d.a,{severity:"error",style:{margin:"0 2rem"}},"Your access to the Twilio SMS/MMS plugin has been blocked as you have not agreed to the terms and conditions. If you feel this is incorrect, please contact team@smooth.tel"),document.querySelector("#root")));case 138:if(!J){e.next=149;break}return Fe=oe.every((function(e){var t;return["Standard","Administrator"].includes(null===e||void 0===e||null===(t=e.profile)||void 0===t?void 0:t.name)})),wu(),wr("setup-bot-start"),Dn(F),e.next=145,gt();case 145:return Ue=e.sent,Ve=(null===Ue||void 0===Ue||null===(Ae=Ue.org)||void 0===Ae||null===(De=Ae[0])||void 0===De||null===(Re=De.license_details)||void 0===Re?void 0:Re.users_license_purchased)||6,Be=ae?Qd:Cd,e.abrupt("return",f.render(h.createElement(Be,{termsAccepted:Q,hasCredentials:G,currentSelectedModule:M,hideSetupBot:function(){wr("setup-bot-finished"),wu(),window.location.reload(),H.launchChecklist()},currentUserId:F.id,onboardingData:ne,supportPersonEmailAddress:L,onlyStandardAndAdminUsers:Fe,hasNotAcceptedEula:_,orgUsersCount:Ve,crmOrganisationID:S}),document.querySelector("#root")));case 149:if(!_){e.next=151;break}return e.abrupt("return",kr());case 151:if(!c&&!u){e.next=153;break}return e.abrupt("return");case 153:if(!ne.error){e.next=156;break}return wr("error-manage-extensibility-disabled"),e.abrupt("return",f.render(h.createElement(d.a,{severity:"error",style:{margin:"0 2rem"}},h.createElement(m.a,null,"It looks like Manage Extensibility is currently disabled."),"Please enable it in Setup > Security Control > Profiles.",h.createElement("br",null),"You can also refer to the"," ",h.createElement("a",{href:"https://delugeonaluge.com/twilio-extension-userguide.html"},"user guide")," ","for instructions."),document.querySelector("#root")));case 156:try{window.$zoho.salesiq.floatwindow.visible("hide")}catch(r){console.error(r)}if(qe=null===(i=y.toArray)||void 0===i?void 0:i.filter((function(e){return e.value&&"Undelivered"===(null===ue||void 0===ue?void 0:ue[e.value])})),We=null===(l=y.toArray)||void 0===l?void 0:l.filter((function(e){return e.value&&"Undelivered"!==(null===ue||void 0===ue?void 0:ue[e.value])})),ze=y.messages,He=y.widgetType,Ye=ie.length>0&&ie[ie.length-1].value,Ge=We.length>0&&We[We.length-1].value,Ye){e.next=169;break}wr("error-no-from-numbers"),cm("You don't have any from numbers set up currently. Set the default from number or add records to the Twilio From Numbers module."),nt(),e.next=197;break;case 169:if(We.length||!qe.length||!ue){e.next=174;break}wr("error-undeliverable-to-numbers"),pm("Note that the numbers ".concat(qe.map((function(e){return e.value})).join(", ")," can not be used as previous attempts to send failed. If this seems incorrect, please delete the contents of the Twilio Deliverability Data field"),ce,M),e.next=197;break;case 174:if(Ge||"Accounts"===M){e.next=182;break}wr("error-no-to-numbers"),Qe=y.globalFieldToUseForNumber,Je=Array.isArray(ce)?(null===(Ke=ce[0])||void 0===Ke||null===(Ze=Ke.data[0])||void 0===Ze?void 0:Ze.twiliosmsextension0__Number_to_Use_for_Twilio_Messages)||Qe:(null===ce||void 0===ce||null===(Xe=ce.data[0])||void 0===Xe?void 0:Xe.twiliosmsextension0__Number_to_Use_for_Twilio_Messages)||Qe,$e=(Je||"").length>0?"has nothing set in the ".concat(Je," field. Change the Number to use for Twilio Messages if needed"):"has nothing set in the Phone/Mobile/Whatsapp fields",im("This record ".concat($e,". Update the details and try again."),M,ce),e.next=197;break;case 182:if(!We.every((function(e){return null===e.value}))||"Accounts"===M){e.next=187;break}wr("error-no-to-numbers"),om("A 'To' phone number is missing."),e.next=197;break;case 187:if("RelatedList"!==He){e.next=192;break}wr("chat-widget-open"),f.render(h.createElement(Xr,{messages:ze,toNumbers:We,fromNumbers:ie,moduleName:M,currentRecordDetails:null===(et=We[0])||void 0===et?void 0:et.completeRecordData,currentUserData:R},h.createElement(ys,{fromNumbers:ie,toNumbers:We,messages:ze,currentRecordDetails:null===(tt=We[0])||void 0===tt?void 0:tt.completeRecordData,moduleName:M,globalDefaultFieldToUse:A,crmOrganisationID:S,phoneFields:j,phoneNumberAPINames:D,currentUserName:F.full_name,currentUserId:F.id,ownerArray:K,defaultPhonePrefix:ee,lookupFieldsForSMSMessagesModule:re,currentUserEmail:F.email,workingHoursSettingsFromBackend:g})),document.querySelector("#root")),e.next=197;break;case 192:return at=y.moduleFields,e.next=195,xn(at);case 195:rt=e.sent,f.render(h.createElement(rm,{fromNumbers:ie,toNumbers:We,smsTemplates:le,widgetType:He,phoneFields:j,currentSelectedModule:M,onboardingScreenData:ne,lookupFieldsForCurrentEntity:rt,lookupFieldsForSMSMessagesModule:re,undeliverableToNumbers:qe,currentUserId:F.id,defaultPhonePrefix:ee,currentRecordDetails:We[0].completeRecordData,crmOrganisationID:S,currentUserEmail:F.email,workingHoursSettingsFromBackend:g}),document.querySelector("#root"));case 197:e.next=202;break;case 199:e.prev=199,e.t0=e.catch(0),Mm(e.t0);case 202:case"end":return e.stop()}}),e,null,[[0,199]])})))).apply(this,arguments)}function _m(){return xm.apply(this,arguments)}function xm(){return(xm=Object(s.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.gtag){e.next=11;break}return e.next=3,vt();case 3:return t=e.sent,e.next=6,Qa();case 6:tm(e.sent.users[0].id,"pk_XaWmZhbCaS187mOYVBLEd1OSdmkqIqSm","sk_N0HV1t7o1L4nVd4MsVb9oZlpmYQLJKz5"),window.gtag("set",{user_id:t}),window.profitwell("start",{user_email:t}),window.profitwell("user_email",t);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Cm(e){return km.apply(this,arguments)}function km(){return(km=Object(s.a)(r.a.mark((function e(t){var a,n,s,i,l,c,u,d;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new v.a({instanceId:"8759c423-7b7c-44ac-93ad-cc2e4b422a9e",serviceWorkerRegistration:t}),e.prev=1,e.next=4,Promise.all([vt(),Qa(),St()]);case 4:return n=e.sent,s=Object(o.a)(n,3),i=s[0],l=s[1],c=s[2],e.next=11,El(null===l||void 0===l?void 0:l.users[0].id);case 11:if(u=e.sent,ea(null===u||void 0===u?void 0:u.receive_notification)){e.next=14;break}return e.abrupt("return");case 14:return e.next=16,a.start();case 16:if(!ea(null===u||void 0===u?void 0:u.receive_team_notification)){e.next=19;break}return e.next=19,a.addDeviceInterest(i);case 19:return d=new v.b({url:"".concat(te,"/api/v1/pusher_user"),headers:c}),e.next=22,a.setUserId(null===l||void 0===l?void 0:l.users[0].id,d);case 22:e.next=29;break;case 24:return e.prev=24,e.t0=e.catch(1),console.error(e.t0),e.next=29,a.stop();case 29:return e.abrupt("return",a);case 30:case"end":return e.stop()}}),e,null,[[1,24]])})))).apply(this,arguments)}function Em(){return Tm.apply(this,arguments)}function Tm(){return(Tm=Object(s.a)(r.a.mark((function e(){var t,a,n,o,s,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={twiliosmsextension0__Twilio_From_Numbers:"Twilio From Number",twiliosmsextension0__SMS_Templates:"Twilio SMS Template",twiliosmsextension0__Sent_SMS:"Twilio SMS Message"},a=Object.keys(t),e.next=4,Tr(a);case 4:return n=e.sent,o=n.unavailableModules,(s=o.length>0)&&(i=o.map((function(e){return t[e]})),om("The ".concat(i.join("s, "),"s module is currently disabled.\n     Please refer to https://www.youtube.com/watch?v=3P4RN7kqDZ0 to enable the module.")),nt()),e.abrupt("return",s);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Nm(){return Im.apply(this,arguments)}function Im(){return(Im=Object(s.a)(r.a.mark((function e(){var t,a,n,o,s,i,l,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qa();case 2:return a=e.sent,n=a.users[0],o=/\b[0-9a-f]{5,40}\b/,s=null===(t=window.location.href.match(o))||void 0===t?void 0:t[0],window.Sentry.setUser({email:null===n||void 0===n?void 0:n.email}),e.next=9,vt();case 9:return i=e.sent,e.next=12,Ya();case 12:l=e.sent,c=l.current_version,window.Sentry.setTag("app_version",c),window.Sentry.setTag("crm_org_id",i),window.Sentry.setTag("environment","production"),s&&window.Sentry.setTag("frontend_commit_hash",s),window.Sentry.setContext("app",{app_version:c}),ot("app_version",c);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Om(){return(Om=Object(s.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return H.hideChecklist(),e.next=3,en();case 3:return t=e.sent,e.next=6,Em();case 6:if(e.sent){e.next=10;break}return e.next=10,Sm(t);case 10:return e.next=12,_m();case 12:return e.next=14,Nm();case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Mm(e){return Pm.apply(this,arguments)}function Pm(){return(Pm=Object(s.a)(r.a.mark((function e(t){var a,n,o,s,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.error(t),a=t.message.toLowerCase(),n=a.includes("permission denied"),o=a.includes("getitem")||a.includes("localstorage"),n?vm(t):o?gm():(s=rt("errorCount"),(i=Number(Le(s,"errorCount",0)))>1?Oe()({title:"Error",text:"Sorry an error has occurred. Please check you are on the latest version of the extension by following the instructions here https://screencast-o-matic.com/watch/cYlXrp813O. If you are on the latest version, please email team@smooth.tel with a screenshot of this error. (In initial render) ".concat(t.message," ").concat(t.stack),icon:"error"}):(ot("errorCount","".concat(i+1)),window.location.reload()));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}try{!function(){Om.apply(this,arguments)}()}catch(Am){Mm(Am)}!function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;var t="".concat(window.location.origin,"/service-worker.js");b?(!function(e,t){fetch(e).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):y(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){}))):y(t,e)}}({onSuccess:function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Cm(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})},17:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return ZOHO}));var jquery__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(538),jquery__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__),ZSDKUtil=function(e){var t,a=r();function n(e){}function r(e){var t={};return(e=e||window.location.href).substr(e.indexOf("?")+1).split("&").forEach((function(e,a){var n=e.split("=");t[n[0]]=n[1]})),t.hasOwnProperty("serviceOrigin")&&(t.serviceOrigin=decodeURIComponent(t.serviceOrigin)),t}return n.prototype.Info=function(){(e.isDevMode()||e.isLogEnabled())&&window.console.info.apply(null,arguments)},n.prototype.Error=function(){(e.isDevMode()||e.isLogEnabled())&&window.console.error.apply(null,arguments)},e.GetQueryParams=r,e.isDevMode=function(){return a&&a.isDevMode},e.isLogEnabled=function(){return a&&a.isLogEnabled},e.getLogger=function(){return t&&t instanceof n||(t=new n),t},e.Sleep=function(e){for(var t=(new Date).getTime();t+e>(new Date).getTime(););},e}(window.ZSDKUtil||{}),ZSDKMessageManager=function(e){var t,a,n,r=ZSDKUtil.getLogger(),o=100,s={};new RegExp("^https?://[a-zA-Z0-9-_]*.(sandbox.crm-oem.com|csez.zohocorpin.com|zoho.com|zoho.eu|zohoplatform.com|zohosandbox.com)(:[0-9]{0,4})?$");function i(e){try{var o="string"===typeof e.data?JSON.parse(e.data):e.data}catch(m){o=e.data}var s=o.type,i=o.eventName;try{if("SET_CONTEXT"===i||function(e){var r=e.source,o=e.origin;return!(!t.isAppRegistered()||a!==r||n!==o)||new Error("Un-Authorized Message.")}(e))switch(s){case"FRAMEWORK.EVENT":!function(e,a){a.data;var n={SET_CONTEXT:l,UPDATE_CONTEXT:c,EVENT_RESPONSE:u,EVENT_RESPONSE_FAILURE:d}[a.eventName];n&&"function"===typeof n?n(e,a):function(e,a){ZSDKEventManager.NotifyEventListeners(t.AppContext,a.eventName,a.data)}(0,a)}(e,o);break;default:t.MessageInterceptor(e,o)}}catch(m){r.Error("[SDK.MessageHandler] => ",m.stack)}}function l(e,r){e.origin;a=window.parent,n=t.QueryParams.serviceOrigin,t.SetContext(r.data),t.ExecuteLoadHandler()}function c(e,t){}function u(e,t){m(t.promiseid,!0,t.data)}function d(e,t){m(t.promiseid,!1,t.data)}function m(e,t,a){s.hasOwnProperty(e)&&(t?s[e].resolve(a):s[e].reject(a),s[e]=void 0,delete s[e])}function p(){return"Promise"+o++}function h(e){return new Promise((function(t,a){s[e]={resolve:t,reject:a,time:(new Date).getTime()}}))}function g(e){if("object"===typeof e&&(e.appOrigin=encodeURIComponent(f())),!a)throw new Error("Parentwindow reference not found.");a.postMessage(e,t.QueryParams.serviceOrigin)}function f(){return window.location.protocol+"//"+window.location.host+window.location.pathname}return e.Init=function(a,n){if(!a||"object"!==typeof a)throw Error("Invalid Context object passed");if(n&&"object"!==typeof n)throw Error("Invalid Configuration Passed to MessageManager");return t=a,i.bind(e)},e.RegisterApp=function(){var e={type:"SDK.EVENT",eventName:"REGISTER",appOrigin:encodeURIComponent(f())};window.parent.postMessage(e,t.QueryParams.serviceOrigin)},e.DERegisterApp=function(){g({type:"SDK.EVENT",eventName:"DEREGISTER",uniqueID:t.getUniqueID()})},e.SendRequest=function(e){if(!e||"object"!==typeof e)throw new Error("Invalid Options passed");return function(e,a,n){if(!e)throw new Error("Invalid Eventname : ",e);var r=n?p():void 0;if(g({type:"SDK.EVENT",eventName:e,uniqueID:t.getUniqueID(),time:(new Date).getTime(),promiseid:r,data:a}),n)return h(r)}("HTTP_REQUEST",e,!0)},e.TriggerEvent=function(e,a,n){if(!e)throw new Error("Invalid Eventname : ",e);var r=n?p():void 0;if(g({type:"SDK.EVENT",eventName:e,uniqueID:t.getUniqueID(),time:(new Date).getTime(),promiseid:r,data:a}),n)return h(r)},e}(window.ZSDKMessageManager||{}),ZSDKEventManager=function(e){var t=ZSDKUtil.getLogger(),a={};return e.AttachEventListener=function(e,t){"function"===typeof t&&(Array.isArray(a[e])||(a[e]=[]),a[e].push(t))},e.NotifyEventListeners=function(e,n,r){var o=n.match(/^\__[A-Za-z_]+\__$/gi),s=(Array.isArray(o)&&o.length,a[n]);if(s&&Array.isArray(s))for(var i=0;i<s.length;i++){s[i].call(e,r)}else t.Info("Cannot find EventListeners for Event : ",n)},e.NotifyInternalEventHandler=function(e,t){var a=t.eventName;"__APP_INIT__"===a?(e.SetContext(t.data),e.ExecuteLoadHandler()):"__APP_CONTEXT_UPDATE__"===a&&(e.UpdateContext(t.data),e.ExecuteContextUpdateHandler())},e}(window.ZSDKEventManager||{});function ZSDK(){var that=this,AppCode,ContextUpdateHandler,connectors,QueryParams,uniqueID,paramsObj={},localeResource={},version="0.7.0",Logger=ZSDKUtil.getLogger(),_isAppRegistered=!1,isOnLoadTriggered=!1;this.isContextReady=!1,this.HelperContext={},this.isDevMode=!1,this.getContext=function(){return AppContext};var AppContext={};function ExecuteLoadHandler(){"function"===typeof AppCode?isOnLoadTriggered?Logger.Error("OnLoad event already triggered."):(AppCode.call(AppContext,AppContext),isOnLoadTriggered=!0):Logger.Error("No OnLoad Handler provided to execute.")}function ExecuteContextUpdateHandler(){ContextUpdateHandler.call(AppContext,AppContext)}function isAppRegistered(){return _isAppRegistered}function GetRequest(e){return ZSDKMessageManager.SendRequest(e)}function TriggerEvent(e,t,a){return ZSDKMessageManager.TriggerEvent(e,t,a)}function RegisterClient(){ZSDKMessageManager.RegisterApp()}function SetContext(e){Logger.Info("Setting AppContext data");var t=e&&e.model||{};e&&e.locale,e&&e.localeResource;if(window.isDevMode&&e.locale&&e.localeResource&&0===Object.keys(e.localeResource).length&&e.localeResource.constructor===Object&&e.locale&&LoadLocaleResource(e.locale),"undefined"!==typeof ZSDKModelManager){for(var a in t)window.ZSDKModelManager.AddModel(a,t[a]);AppContext.Model=window.ZSDKModelManager.GetModelStore()}uniqueID=e.uniqueID,connectors=e.connectors,Logger.Info("App Connectors ",connectors),_isAppRegistered=!0}function getUniqueID(){return uniqueID}function UpdateContext(e){}function AttachEventListener(e,t){ZSDKEventManager.AttachEventListener(e,t)}function GetConnectors(){return connectors}function LoadLocaleResource(e){_loadJSON("/app-translations/"+e+".json",(function(e){localeResource=JSON.parse(e),InitI18n()}))}function _loadJSON(e,t){var a=new XMLHttpRequest;a.open("GET",e,!1),a.onreadystatechange=function(){4==a.readyState&&"200"==a.status&&t(a.responseText)},a.send(null)}function Translate(key,options){var valStr="";if(key&&(valStr=_getKeyByString(localeResource,key)),!valStr)return!1;if(options){var key,translateOptions=JSON.parse(JSON.stringify(eval(options))),keysArr=Object.keys(translateOptions);for(key in keysArr)valStr=_replaceString(valStr,"${"+keysArr[key]+"}",translateOptions[keysArr[key]])}return valStr}function _replaceString(e,t,a){for(var n="";n!=e;)n=e,e=e.replace(t,a);return e}function _getKeyByString(e,t){for(var a=(t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),n=0,r=a.length;n<r;++n){var o=a[n];if(!(o in e))return;e=e[o]}return e}function InitI18n(){var all=document.querySelectorAll("[data-i18n]");for(var i in all)if(all.hasOwnProperty(i)){var valStr=_getKeyByString(localeResource,all[i].getAttribute("data-i18n"));if(!valStr)return!1;if(all[i].hasAttribute("data-options")){var options=JSON.parse(JSON.stringify(eval("("+all[i].getAttribute("data-options")+")"))),keysArr=Object.keys(options),key;for(key in keysArr)valStr=_replaceString(valStr,"${"+keysArr[key]+"}",options[keysArr[key]])}all[i].innerHTML=valStr}}function Bootstrap(){QueryParams=ZSDKUtil.GetQueryParams(),window.isDevMode=!!QueryParams.isDevMode;var e={};e.isDevMode=window.isDevMode,e.ExecuteLoadHandler=ExecuteLoadHandler,e.SetContext=SetContext,e.UpdateContext=UpdateContext,e.QueryParams=QueryParams,e.GetConnectors=GetConnectors,e.TriggerEvent=TriggerEvent,e.ExecuteContextUpdateHandler=ExecuteContextUpdateHandler,e.getUniqueID=getUniqueID,e.isAppRegistered=isAppRegistered;var t=ZSDKMessageManager.Init(e);window.addEventListener("message",t),window.addEventListener("unload",(function(){ZSDKMessageManager.DERegisterApp()})),"undefined"!==typeof ZSDKModelManager&&window.ZSDKModelManager.Init(e),RegisterClient()}AppContext.Model={},AppContext.Event={},AppContext.Event.Listen=AttachEventListener,AppContext.Event.Trigger=TriggerEvent,AppContext.GetRequest=GetRequest,AppContext.QueryParams=QueryParams,AppContext.Translate=Translate,this.OnLoad=function(e){if("function"!==typeof e)throw new Error("Invalid Function value is passed");AppCode=e,_isAppRegistered&&ExecuteLoadHandler()},this.OnUnLoad=function(e){},this.OnContextUpdate=function(e){ContextUpdateHandler=e},Bootstrap()}var ZOHO=function(){var e,t={},a=!1,n=void 0;return{embeddedApp:{on:function(e,a){t[e]=a},init:function(){var r;if(!a)for(var o in a=!0,e=new ZSDK,n=new Promise((function(e,t){r=e})),e.OnLoad((function(){r()})),t)e.getContext().Event.Listen(o,t[o]);return n}},CRM:function(){function t(t){return t.sdkVersion="1",e.getContext().Event.Trigger("CRM_EVENT",t,!0)}function a(e){var t=e;return new File([t],t.name,{type:t.type})}function n(e,n,r,o){if(n.FileData){var s=a(n.FileData);n.FileData=s}var i={category:"CREATE",Entity:e,RelatedID:r,APIData:n};return i.type=o||"RECORD",t(i)}function r(e){return e.category="BLUEPRINT",t(e)}function o(e){return e.category="APPROVALS",t(e)}function s(e,n,r){if(n.FILE){var o=a(n.FILE.file);n.FILE.file=o}var s=void 0;if(r)s=n;else{var i=n.url,l=n.params,c=n.headers,u=n.body,d=n.PARTS,m=n.PART_BOUNDARY,p=n.CONTENT_TYPE,h=n.RESPONSE_TYPE,g=n.FILE;if(!i)throw{Message:"Url missing"};if(l){var f=function(e){var t=[];for(var a in e)t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return t.join("&")}(l);i+=(i.indexOf("?")>-1?"&":"?")+f}s={url:i,Header:c,Body:u,CONTENT_TYPE:p,RESPONSE_TYPE:h,PARTS:d,PARTS_BOUNDARY:m,FILE:g}}return t({category:"CONNECTOR",nameSpace:e,data:s,type:r})}function i(e){return jquery__WEBPACK_IMPORTED_MODULE_0__.extend(e,{category:"UI"}),t(e)}function l(e,a,n){return t({category:"CONFIG",type:e,nameSpace:a,APIData:n})}function c(e,a){return t({category:"ACTION",type:e,object:a})}function u(e){var a={category:"USER"};return e.ID?a.ID=e.ID:e.Type&&(a.Type=e.Type,e.page&&(a.page=e.page),e.per_page&&(a.per_page=e.per_page)),t(a)}function d(e){return t({category:"META",type:e.type,Entity:e.Entity,Id:e.Id})}var m="wget.post",p="wget.get",h="wget.put",g="wget.patch",f="wget.delete";return{ACTION:{setConfig:function(e){return c("CUSTOM_ACTION_SAVE_CONFIG",e)},enableAccountAccess:function(e){return c("ENABLE_ACCOUNT_ACCESS",e)}},FUNCTIONS:{execute:function(e,a){var n={};return a.auth_type="oauth",n.data=a,t({category:"FUNCTIONS_EXECUTE",customFunctionName:e,data:n})}},CONFIG:{getOrgInfo:function(e){return l("ORG")},getCurrentUser:function(){return l("CURRENT_USER")},GetCurrentEnvironment:function(){return l("ORG_LEVEL_INFO")}},META:{getFields:function(e){return e.type="FIELD_LIST",d(e)},getModules:function(){return d({type:"MODULE_LIST"})},getAssignmentRules:function(e){return e.type="ASSIGNMENT_RULES",d(e)},getLayouts:function(e){return e.id=e.id?e.id:e.LayoutId,e.type=e.Id?"LAYOUT":"LAYOUTS",d(e)},getRelatedList:function(e){return e.type="RELATED_LIST",d(e)},getCustomViews:function(e){return e.type=e.Id?"CUSTOM_VIEW":"CUSTOM_VIEWS",d(e)}},API:{addNotes:function(e){var t=e.Entity,a=e.RecordID;return n(t,{data:[{Note_Title:e.Title,Note_Content:e.Content}]},a,"NOTES")},addNotesAttachment:function(e){return function(e,a,n,r){return t({category:"UPDATE",type:"NOTES",Entity:e,RecordID:a,RelatedRecordID:n,APIData:r})}(e.Entity,e.RecordID,e.RelatedRecordID,{Files:{FileName:File.Name,FileData:File.Content}})},coql:function(e){return t({category:"QUERY",APIData:e})},insertRecord:function(e){var t=e.Entity,a=e.APIData;return a.trigger=e.Trigger,n(t,a)},upsertRecord:function(e){var t=e.Entity,a=e.APIData;return a.trigger=e.Trigger,a.action="UPSERT",e.duplicate_check_fields&&e.duplicate_check_fields instanceof Array&&(a.duplicate_check_fields=e.duplicate_check_fields.join(",")),n(t,a)},getRecord:function(e){return function(e,a,n){return t({category:"READ",APIData:{Entity:e,RecordID:a,RelatedList:n}})}(e.Entity,e.RecordID)},getBluePrint:function(e){return r({Entity:e.Entity,RecordID:e.RecordID,action:"GET_BLUEPRINT_STATUS"})},updateBluePrint:function(e){return r({Entity:e.Entity,RecordID:e.RecordID,BlueprintData:e.BlueprintData,action:"UPDATE_BLUEPRINT_STATUS"})},uploadFile:function(e){return function(e){if(e.FILE){var n=a(e.FILE.file);e.FILE.file=n}return t({FileData:e,category:"FILES",type:"UPLOAD_FILE"})}(e)},getFile:function(e){return(a=e).category="FILES",a.type="DOWNLOAD_FILE",t(a);var a},getAllRecords:function(e){return t({category:"READ",APIData:e})},updateRecord:function(e){var a=e.Entity,n=e.APIData;return n.trigger=e.Trigger,function(e,a){return t({category:"UPDATE",type:"RECORD",Entity:e,APIData:a})}(a,n)},deleteRecord:function(e){return function(e,a){return t({category:"DELETE",type:"RECORD",Entity:e,RecordID:a})}(e.Entity,e.RecordID)},searchRecord:function(e){return function(e,a,n,r,o,s){return t({category:"SEARCH",Entity:e,Type:a,Query:n,page:r,per_page:o,delay:s})}(e.Entity,e.Type,e.Query,e.page,e.per_page,e.delay)},getAllActions:function(e){return e.action="GET_ALL_ACTIONS",o(e)},getApprovalRecords:function(e){var t={};return e?e.action="GET_APPROVAL_RECORDS":(t.action="GET_APPROVAL_RECORDS",e=t),o(e)},getApprovalById:function(e){return e.action="GET_APPROVALBYID",o(e)},getApprovalsHistory:function(){var e={action:"GET_APPROVALS_HISTORY"};return o(e)},approveRecord:function(e){return e.action="UPDATE_APPROVAL",o(e)},getAllUsers:function(e){return u({Type:e.Type,page:e.page,per_page:e.per_page})},getUser:function(e){return u({ID:e.ID})},getRelatedRecords:function(e){return t({category:"READ",APIData:e})},updateRelatedRecords:function(e){return function(e,a,n,r,o){return t({category:"UPDATE",type:"RELATED_RECORD",Entity:e,RecordID:a,RelatedList:n,RelatedRecordID:r,APIData:o})}(e.Entity,e.RecordID,e.RelatedList,e.RelatedRecordID,e.APIData)},delinkRelatedRecord:function(e){return function(e,a,n,r){return t({category:"DELETE",type:"RELATED_RECORD",Entity:e,RecordID:a,RelatedList:n,RelatedRecordID:r})}(e.Entity,e.RecordID,e.RelatedList,e.RelatedRecordID)},attachFile:function(e){var t=e.Entity,a=e.RecordID,r=e.File;return n(t,e={FileName:r.Name,FileData:r.Content},a,"ATTACHMENT")},getAllProfiles:function(e){return t({category:"PROFILES",type:"GET_ALL_PROFILES"})},getProfile:function(e){return function(e,a,n){return t({category:e,type:a,ID:n})}("PROFILES","GET_PROFILE",e.ID)},updateProfile:function(e){return function(e,a,n,r){return t({category:e,type:a,ID:n,APIData:r})}("UPDATE","PROFILE",e.ID,e.APIData)},getOrgVariable:function(e){return l("VARIABLE",e)}},UI:{Resize:function(e){return i(e={action:"RESIZE",data:{width:e.width,height:e.height}})},Dialer:{maximize:function(){return i({action:{telephony:"MAXIMIZE"}})},minimize:function(){return i({action:{telephony:"MINIMIZE"}})},notify:function(){return i({action:{telephony:"NOTIFY"}})}},Record:{open:function(e){return i(e={action:{record:"OPEN"},data:{Entity:e.Entity,RecordID:e.RecordID,target:e.Target}})},edit:function(e){return i(e={action:{record:"EDIT"},data:{Entity:e.Entity,RecordID:e.RecordID,target:e.Target}})},create:function(e){return i(e={action:{record:"CREATE"},data:{Entity:e.Entity,RecordID:e.RecordID,target:e.Target}})},populate:function(e){return i({action:{record:"POPULATE"},data:e})}},Popup:{close:function(){return i({action:{popup:"CLOSE"}})},closeReload:function(){return i({action:{popup:"CLOSE_RELOAD"}})}},Widget:{open:function(e){return i(e={action:{webTab:"OPEN"},data:e})}}},HTTP:{get:function(e){return s(p,e)},post:function(e){return s(m,e)},put:function(e){return s(h,e)},patch:function(e){return s(g,e)},delete:function(e){return s(f,e)}},CONNECTOR:{invokeAPI:function(e,t){return s(e,t,"CONNECTOR_API")},authorize:function(e){return s(e,{},"CONNECTOR_AUTHORIZE")}},CONNECTION:{invoke:function(e,a){var n={},r={};return r.url=a.url,r.method=a.method,r.param_type=a.param_type,r.parameters=JSON.stringify(a.parameters),r.headers=JSON.stringify(a.headers),n.data=r,t({category:"CRM_CONNECTION",connectionName:e,data:n})}}}}()}}()},427:function(e,t,a){},537:function(e){e.exports=JSON.parse('[{"code":13000,"message":"Conference Noun cannot be mixed with Number nouns","secondary_message":"The Conference noun can only be used once inside a Dial verb","product":null},{"code":30111,"message":"Url is blacklisted","secondary_message":"The URL provided is blocked.","product":"Programmable SMS"},{"code":50304,"message":"Programmable Chat: Attributes not valid JSON","secondary_message":"Specified Channel\'s Attributes are not valid JSON.","product":"Programmable Chat"},{"code":21616,"message":"The \'From\' number matches multiple numbers for your account","secondary_message":"You have attempted to send a SMS with a \'From\' number that matches more than one number belonging to your account. Please submit the \'From\' number in E.164 format to resolve the ambiguity.","product":null},{"code":13612,"message":"Record: Invalid maxLength value","secondary_message":"The maxLength attribute must be a positive integer in seconds. See the <a href=\'/docs/api/twiml/record#maxLength\'>Record Verb</a> API Reference for more information.","product":null},{"code":19023,"message":"Invalid channel type","secondary_message":null,"product":null},{"code":57016,"message":"\'Topic\' is empty","secondary_message":null,"product":"Programmable SMS"},{"code":30118,"message":"Unable to parse private key","secondary_message":null,"product":"Programmable SMS"},{"code":51109,"message":"Twilsock: Service instance is under legal hold","secondary_message":"Specified service instance is under legal hold.","product":null},{"code":21227,"message":"Headers portion of SIP URI must be fewer than 1024 chars","secondary_message":"The headers you are sending must be fewer than 1024 characters.","product":null},{"code":21504,"message":"RecordingSid is required.","secondary_message":"You POSTed to the /Accounts/{AccountSid}/Transcriptions resource, but you did not include a RecordingSid.","product":null},{"code":21406,"message":"Cannot set SmsFallbackUrl without setting SmsUrl","secondary_message":"You cannot set a fallback URL without specifying a primary URL","product":null},{"code":51106,"message":"Twilsock: Active product doesn\'t match with service instance product","secondary_message":"Passed service instance belongs to another product.","product":null},{"code":13241,"message":"Dial->SIP: Invalid method value","secondary_message":"The method attribute of Number must be GET or POST","product":null},{"code":21602,"message":"Message body is required","secondary_message":"You must specify content (text or media) for your message.","product":null},{"code":30006,"message":"Landline or unreachable carrier","secondary_message":"The destination number is unable to receive this message. Potential reasons could include trying to reach a landline or, in the case of short codes, an unreachable carrier.","product":"Programmable SMS"},{"code":50412,"message":"Participant proxy address is empty","secondary_message":"The provided participant proxy address parameter must not be empty.","product":"Programmable Chat"},{"code":30117,"message":"Unable to parse certificate","secondary_message":null,"product":"Programmable SMS"},{"code":21477,"message":"Unable to update Status for parent accounts","secondary_message":"Unable to update Status for parent accounts, status updates restricted to subaccounts only","product":null},{"code":50417,"message":"Participants limit exceeded","secondary_message":"The total number of participants in this conversation exceeds the allowed limit.","product":"Programmable Chat"},{"code":30107,"message":"Domain private certificate has not been uploaded","secondary_message":"The private certificate required for Twilio to process shortening requests through this domain has not been uploaded","product":"Programmable SMS"},{"code":70156,"message":"Request Hash Is Invalid","secondary_message":null,"product":null},{"code":19041,"message":"Invalid or missing Custom Field input","secondary_message":null,"product":null},{"code":21235,"message":"IP Access Control List Validation Error","secondary_message":"One of the parameters passed when creating or updating an IP Access Control List was incorrect.","product":null},{"code":57013,"message":"\'Topic\' is absent","secondary_message":null,"product":"Programmable SMS"},{"code":21222,"message":"Invalid SipAuthUsername. Illegal chars","secondary_message":"The SipAuthUsername you specified contained characters not allowed in SIP.","product":null},{"code":91203,"message":"Method Not Allowed","secondary_message":null,"product":null},{"code":57020,"message":"Authorization failed","secondary_message":"Authorization failed","product":"Programmable SMS"},{"code":21237,"message":"Maximum IP Addresses Reached for List","secondary_message":"IP Access control lists cannot contain more than 25 Addresses.","product":null},{"code":30019,"message":"Content size exceeds carrier limit","secondary_message":"Message failed because the size of the content associated with the message exceeded carrier limit","product":"Programmable SMS"},{"code":50208,"message":"Programmable Chat: User channel limit exceeded","secondary_message":null,"product":"Programmable Chat"},{"code":21229,"message":"Invalid SIP Header. Illegal chars in header value","secondary_message":"The header value you passed has characters not allowed in SIP.","product":null},{"code":13234,"message":"Dial->Conference: Invalid waitMethod","secondary_message":"placeholder","product":null},{"code":50052,"message":"Programmable Chat: Invalid consumption interval format","secondary_message":"Request does not contain valid consumption interval.","product":"Programmable Chat"},{"code":15002,"message":"Call Progress: Queue Timeout","secondary_message":"A callback request timed out in the callback queue.","product":null},{"code":50205,"message":"Programmable Chat: User unauthorized to set role","secondary_message":"Specified User does not have Role or Permissions to set the Role.","product":"Programmable Chat"},{"code":50207,"message":"Programmable Chat: Identity too long","secondary_message":"Specified User\'s Identity parameter is too long","product":"Programmable Chat"},{"code":51108,"message":"Twilsock: Service instance disabled","secondary_message":"Service instance is disabled.","product":null},{"code":50054,"message":"Programmable Chat: Invalid webhook format","secondary_message":"Request does not contain correctly formatted parameters for webhooks.","product":"Programmable Chat"},{"code":90009,"message":"The message SID already exists.","secondary_message":null,"product":"Programmable SMS"},{"code":50074,"message":"Global actions per second limit exceeded","secondary_message":"Service instance global actions per second limit exceeded.","product":"Programmable Chat"},{"code":94403,"message":"Transcriptions: Invalid encryption credentials","secondary_message":null,"product":null},{"code":20011,"message":"Invalid TLS version","secondary_message":"Service requires TLSv1.2 ","product":null},{"code":51113,"message":"Twilsock: Product usage is not enabled","secondary_message":"Product usage is not enabled.","product":null},{"code":90007,"message":"Invalid validity period value","secondary_message":null,"product":"Programmable SMS"},{"code":21402,"message":"Invalid Url","secondary_message":"You attempted to update the URL handler associated with a phone number, but the URL you specified was not valid.  You must specify a valid URL, beginning with http or https, such as http://mycompany.com/callHandler","product":null},{"code":13616,"message":"Record: playBeep must be true or false","secondary_message":"The playBeep attribute must have a value of \\"true\\" or \\"false\\"","product":null},{"code":70252,"message":"Bad Saml Response","secondary_message":null,"product":null},{"code":14220,"message":"Enqueue: Provided Workflow was not a valid sid","secondary_message":"Provided workflow sid was not valid.","product":null},{"code":50384,"message":"Initial state can\'t be \'closed","secondary_message":"It\'s not allowed to set \'closed\' state for newly created converastion","product":"Programmable Chat"},{"code":70105,"message":"Invalid Type Specified in the Request","secondary_message":null,"product":null},{"code":50434,"message":"Participant projected address not provided","secondary_message":"No Projected Address provided for this participant the group conversation.","product":"Programmable Chat"},{"code":50509,"message":"Programmable Chat: Media message body cannot be updated","secondary_message":"Media message body cannot be updated","product":"Programmable Chat"},{"code":13618,"message":"Record: Recording not available for transcription","secondary_message":"The recording was not available when Twilio fetched the recording for transcription","product":null},{"code":94400,"message":"Transcriptions: transcription internal error","secondary_message":null,"product":null},{"code":21475,"message":"Unable to update Status, invalid Status.","secondary_message":"The Status you specified must be one of the following strings: \'active\', \'suspended\', or \'closed\'.","product":null},{"code":63016,"message":"Failed to send freeform message because you are outside the allowed window. If you are using WhatsApp, please use a Message Template.","secondary_message":null,"product":"Programmable SMS"},{"code":13310,"message":"Gather: Invalid finishOnKey value","secondary_message":"The value of the finishOnKey attribute must be one of the following characters \\"0123456789#*\\". See the <a href=\'/docs/api/twiml/gather#finishOnKey\'>Gather Verb</a> API Reference for more information.","product":null},{"code":19035,"message":"Invalid page size, it must be between 1 and 25 if specified","secondary_message":null,"product":null},{"code":50451,"message":"One user identifier parameter for lookup at a time is allowed. Please, use either Identity or Address.","secondary_message":"Request should contain either Identity or Address parameter, not both.","product":"Programmable Chat"},{"code":21702,"message":"The Messaging Service is not available to send new messages","secondary_message":"The Messaging Service is not available to send new messages","product":null},{"code":19026,"message":"Maximum number of channels allowed reached","secondary_message":null,"product":null},{"code":21456,"message":"Invalid CallbackUrl","secondary_message":"CallbackUrl must be a valid URL using the HTTP or HTTPS protol.","product":null},{"code":30409,"message":"This message cannot be canceled","secondary_message":null,"product":"Programmable SMS"},{"code":63036,"message":"The specified phone number cannot be reached by RBM at this time.","secondary_message":null,"product":"Programmable SMS"},{"code":32017,"message":"PSTN: Carrier blocked call due to calling number (caller ID)","secondary_message":null,"product":null},{"code":30119,"message":"Private key and certificate mismatch","secondary_message":null,"product":"Programmable SMS"},{"code":50059,"message":"Programmable Chat: Notification sound name too long","secondary_message":"Specified notification sound parameter is too long","product":"Programmable Chat"},{"code":51107,"message":"Twilsock: Service can\'t be used","secondary_message":"Service can\'t be used","product":null},{"code":21606,"message":"The \'From\' phone number provided is not a valid message-capable Twilio phone number.","secondary_message":"You can only send SMS messages from a phone number provided by Twilio, and that phone number must be SMS enabled. Visit the phone numbers page on your account portal to view a list of phone numbers that you own, and whether or not they are enabled for SMS.","product":"Programmable SMS"},{"code":63031,"message":"Channels message cannot have same From and To","secondary_message":null,"product":"Programmable SMS"},{"code":13111,"message":"Annotate: Annotate must contain only one of element X","secondary_message":"Annotate must contain only one of element X","product":null},{"code":21233,"message":"Domain still has subdomains","secondary_message":"You cannot delete a domain while subdomains of it exist.","product":null},{"code":19033,"message":"Location validation error","secondary_message":null,"product":null},{"code":50431,"message":"Participant SID not provided","secondary_message":"Conversation participant SID parameter is required but was not provided.","product":"Programmable Chat"},{"code":50375,"message":"TimeToInactive should be greater or equal to 1 minute","secondary_message":"Duration to transfer channel to inactive state can\'t be shorter than 1 minute.","product":"Programmable Chat"},{"code":94402,"message":"Transcriptions: Encryption failed and transcription result files deleted","secondary_message":null,"product":null},{"code":23004,"message":"Message Redaction Incompatible Configuration: Advanced Opt-Out","secondary_message":null,"product":"Programmable SMS"},{"code":80403,"message":"Interaction Sid Invalid","secondary_message":"Invalid Interaction Sid","product":null},{"code":11751,"message":"Media Message - Media exceeds messaging provider size limit","secondary_message":"The total size of the media message request exceeds the maximum size limit for the channel.","product":"Programmable SMS"},{"code":19028,"message":"Channel value can not be updated","secondary_message":null,"product":null},{"code":50380,"message":"TimeToClosed format is invalid","secondary_message":"\'TimeToClosed\' parameter format should be ISO8601 duration","product":"Programmable Chat"},{"code":21623,"message":"Number of media files exceeds allowed limit","secondary_message":"The number of media URLs exceeds the maximum allowed. You may send up to 10 media files in a single message.","product":null},{"code":19012,"message":"When updating a contact at least one field should be updated","secondary_message":null,"product":null},{"code":61001,"message":"Add-ons: Request timed out","secondary_message":" The Add-on Provider failed to respond in the allotted time. The request was terminated and no further processing was attempted.","product":null},{"code":21242,"message":"Maximum Credentials Reached for List","secondary_message":"Credential Lists cannot contain more than 1000 Credentials.","product":null},{"code":32102,"message":"SIP: Bad SDP","secondary_message":"The SDP is not correctly formatted.","product":null},{"code":90015,"message":"Body and Template (Body, Sid, Language, Args) are provided","secondary_message":null,"product":null},{"code":21611,"message":"This \'From\' number has exceeded the maximum number of queued messages","secondary_message":"You have attempted to enqueue too many messages for a given \'From\' number.","product":"Programmable SMS"},{"code":51110,"message":"Twilsock: Token contains multiple grants of same product","secondary_message":"Duplication of grants for the same product.","product":null},{"code":13420,"message":"Play: Invalid Content-Type","secondary_message":"Play requires an audio Content-Type","product":null},{"code":63008,"message":"Could not execute the request because the channel module has been misconfigured. Please check the Channel configuration in Twilio","secondary_message":null,"product":"Programmable SMS"},{"code":30112,"message":"Account is not found","secondary_message":null,"product":null},{"code":23002,"message":"Message Redaction Incompatible Configuration: Short code \\"STOP\\" filtering","secondary_message":null,"product":"Programmable SMS"},{"code":30011,"message":"Incoming MMS not supported by the receiving phone number in this region","secondary_message":null,"product":"Programmable SMS"},{"code":51114,"message":"Twilsock: Invalid access token header","secondary_message":"The token has an invalid header.","product":null},{"code":21407,"message":"This Phone Number type does not support SMS","secondary_message":"This phone number type does not support SMS.  You cannot set SmsUrl, SmsMethod, SmsFallbackUrl, or SmsFallbackMethod","product":null},{"code":21627,"message":"Max Price must be a valid float","secondary_message":"Max Price must be a valid positive float","product":"Programmable SMS"},{"code":21457,"message":"AreaCode Parameter not Supported","secondary_message":"The AreaCode parameter for provisioning numbers is not supported on the IncomingPhoneNumbers/Local & IncomingPhoneNumbers/TollFree sub-resources.","product":null},{"code":23005,"message":"Phone Number Redaction Incompatible Configuration: Fallback to Long Code","secondary_message":null,"product":"Programmable SMS"},{"code":90014,"message":"Validity Period should be positive integer","secondary_message":"Validity Period should be positive integer","product":"Programmable SMS"},{"code":80607,"message":"Session Closed","secondary_message":"Session is closed and cannot be updated","product":null},{"code":51004,"message":"Client Connection: endpoint_id too long","secondary_message":"error","product":null},{"code":50449,"message":"Conflicting channel modification","secondary_message":"The requested channel is already being added or removed by a concurrent API request.","product":"Programmable Chat"},{"code":94303,"message":"Transcriptions Configurations: Language is required","secondary_message":null,"product":null},{"code":21408,"message":"Permission to send an SMS has not been enabled for the region indicated by the \'To\' number","secondary_message":null,"product":"Programmable SMS"},{"code":51118,"message":"Twilsock: Invalid claim set","secondary_message":"Claim set provided in token is invalid.","product":null},{"code":21607,"message":"The \'from\' phone number must be the sandbox phone number for trial accounts.","secondary_message":"You can only send SMS messages from the sandbox phone number while your account is in the free trial.  Upgrade your account to a Full Twilio account to send and receive from your own phone numbers.","product":null},{"code":21204,"message":"Call already initiated","secondary_message":"You should never receive this error","product":null},{"code":21712,"message":"Phone Number or Short Code is associated with another Messaging Service.","secondary_message":"You have tried to assign a Twilio phone number or short code to a Messaging Service, but the number is already associated with a different Messaging Service.","product":"Programmable SMS"},{"code":19029,"message":"When updating a channel at least one field should be updated","secondary_message":null,"product":null},{"code":13230,"message":"Dial->Conference: Invalid muted value","secondary_message":"placeholder","product":null},{"code":13222,"message":"Dial->Number: Invalid sendDigits value","secondary_message":"sendDigits attribute may only contain the following characters \\"0123456789*#w\\". See the <a href=\'/docs/api/twiml/dial\'>Dial Verb</a> API Reference for more information.","product":null},{"code":50057,"message":"Programmable Chat: Webhook call failed to execute successfully","secondary_message":"The event triggered webhook call failed to execute successfully","product":"Programmable Chat"},{"code":57006,"message":"\'EventType\' is empty","secondary_message":null,"product":"Programmable SMS"},{"code":32112,"message":"SIP: Invalid header value","secondary_message":null,"product":null},{"code":57007,"message":"\'EventType\' is absent","secondary_message":null,"product":"Programmable SMS"},{"code":20004,"message":"Method not allowed","secondary_message":"The resource you accessed is valid, but the HTTP method you attempted to use is not supported for the resource.  For example, you cannot DELETE your own account.","product":null},{"code":13617,"message":"Record: Recording length is out of range for transcription","secondary_message":"Twilio could not process the transcription because the duration of the recording is either too short or too long. The recording itself will not be affected.","product":null},{"code":30108,"message":"Twilio account does not belong to an organization","secondary_message":"Domains are managed at the Organization level. Please attach this account to an organization and proceed with setup for Click Tracking prior to use.","product":"Programmable SMS"},{"code":10003,"message":"Incoming call rejected due to inactive account","secondary_message":"An incoming call was made to your application, but was not answered because your account was not active at the time.","product":null},{"code":19014,"message":"Can fetch contact either by unique_customer_provided_id or channel ","secondary_message":null,"product":null},{"code":50340,"message":"Messaging service SID not provided","secondary_message":"Messaging service SID parameter is required but was not provided with an API request.","product":"Programmable Chat"},{"code":21403,"message":"Invalid Method","secondary_message":"You attempted to update the HTTP method that Twilio uses when somebody calls your phone number, but the <span class=\'rest-attribute\'>Method</span> you supplied was not valid.  Valid <span class=\'rest-attribute\'>Method</span> values are GET or POST.","product":null},{"code":21473,"message":"AccountSid you are transferring to is not related to the originating owner of the phone number","secondary_message":"The AccountSid you specified is neither parent nor child of the originating Account owner.  Please make sure that the subaccount or parent account is related to the current owner you are transferring from or to.","product":null},{"code":90030,"message":"Broadcast \'CorrelationId\' is too long","secondary_message":null,"product":null},{"code":19022,"message":"Invalid channel","secondary_message":null,"product":null},{"code":14213,"message":"Dial->Queue: queue name too long","secondary_message":"The name of the queue must be shorter than 64 characters.","product":null},{"code":21478,"message":"Unable to update Status for subaccount, subaccount has been suspended by Twilio","secondary_message":"Unable to update Status for subaccounts that have been suspended externally by Twilio.  Please contact customer support: http://www.twilio.com/help","product":null},{"code":50377,"message":"Can\'t update conversation as it\'s in final closed state","secondary_message":"Conversation is in closed state and can\'t be used anymore","product":"Programmable Chat"},{"code":30016,"message":"\'To\' and \'From\' channel types are incompatible","secondary_message":null,"product":null},{"code":50506,"message":"Programmable Chat: Media SID not provided","secondary_message":"Request does not contain required Media SID parameter.","product":"Programmable Chat"},{"code":20422,"message":"Invalid Parameter","secondary_message":null,"product":null},{"code":50101,"message":"Programmable Chat: Channel role not found","secondary_message":"Specified Channel Role does not exist.","product":"Programmable Chat"},{"code":57009,"message":"\'EventType\' is too long","secondary_message":null,"product":"Programmable SMS"},{"code":50332,"message":"Programmable Chat: Channel webhook url too long","secondary_message":"Channel webhook url provided in request is too long","product":"Programmable Chat"},{"code":30022,"message":"US A2P 10DLC - Rate Limits Exceeded","secondary_message":"Your messages to this particular carrier has exceeded the maximum allowable limits for your phone number and/or campaign.","product":"Programmable SMS"},{"code":21218,"message":"Invalid ApplicationSid","secondary_message":"You attempted to initiate an outbound phone call with an invalid ApplicationSid. The application may not exist anymore or may not be available within your account.","product":null},{"code":20021,"message":"Phone number rejected by T-Mobile SDG Service Provisioning API","secondary_message":null,"product":null},{"code":30100,"message":"Domain SID is invalid","secondary_message":"The Domain SID included in your request is not a valid Domain for your Twilio Organization.","product":"Programmable SMS"},{"code":90027,"message":"Broadcast \'FriendlyName\' is too long","secondary_message":null,"product":null},{"code":30002,"message":"Account suspended","secondary_message":"Your account was suspended between the time of message send and delivery. Please contact Twilio.","product":"Programmable SMS"},{"code":80606,"message":"Proxy Identifier Not Owned By Account","secondary_message":"Proxy identifier not owned by account.","product":null},{"code":14204,"message":"Enqueue: Queue name too short","secondary_message":"The queue name must be at least one character long.","product":null},{"code":50436,"message":"Participant limit exceeded for group conversation","secondary_message":"The maximum of participants allowed in a group conversation has been exceeded.","product":"Programmable Chat"},{"code":94304,"message":"Transcriptions Configurations: Language is invalid","secondary_message":null,"product":null},{"code":13252,"message":"Dial: Invalid header name","secondary_message":"You named your header something invalid.","product":null},{"code":50374,"message":"\'State\' field can\'t be empty","secondary_message":"\'State\' field can\'t be empty or removed from channel.","product":"Programmable Chat"},{"code":21207,"message":"Invalid IfMachine","secondary_message":"You attempted to initiate an outbound phone call, but you sent an invalid <span class=\'rest-attribute\'>IfMachine</span> parameter.  Twilio can determine if an answering machine or voicemail has answered the call, and behave differently if it has.  Valid options for <span class=\'rest-attribute\'>IfMachine</span> are \\"Continue\\" (continue with the call, progressing after the beep), \\"Hangup\\" (immediately hangup the call) or \\"False\\" (don\'t determine if a machine has answered).","product":null},{"code":80904,"message":"Expired Session","secondary_message":"Expired Session","product":null},{"code":21503,"message":"Invalid transcription type","secondary_message":"The transcription type you provided is not a valid choice.  You may use one of: fast, accurate or all.","product":null},{"code":30009,"message":"Missing inbound segment","secondary_message":"One or more segments associated with your multi-part inbound message was not received.","product":"Programmable SMS"},{"code":50330,"message":"Programmable Chat: Channel webhook filter not provided","secondary_message":"Request does not contain parameter for webhook filter","product":"Programmable Chat"},{"code":70004,"message":"Unauthorized","secondary_message":null,"product":null},{"code":50382,"message":"Timer can\'t be set without state","secondary_message":"You are trying to set \'TimeToInactive\' and/or \'TimeToClosed\' without \'State\' parameter in request","product":"Programmable Chat"},{"code":13212,"message":"Dial: Invalid timeout value","secondary_message":"timeout must be a positive integer, in seconds.  See the <a href=\'/docs/api/twiml/dial#timeout\'>Dial Verb</a> API Reference for more information.","product":null},{"code":63028,"message":"Number of parameters provided does not match the expected number of parameters","secondary_message":null,"product":"Programmable SMS"},{"code":21472,"message":"Account is not active","secondary_message":"The AccountSid you specified is not an active Twilio Account.  To transfer the account, you must supply an Active 34 character AccountSid .","product":null},{"code":21203,"message":"International calling not enabled","secondary_message":"You attempted to initiate an outbound phone call to an international phone number, which is not currently supported.","product":null},{"code":51105,"message":"Twilsock: Token doesn\'t contain identity","secondary_message":"The token doesn\'t have an identity specified.","product":null},{"code":50418,"message":"Non-Chat participants limit exceeded","secondary_message":"The total number of SMS, WhatsApp, or other non-Chat participants in this conversation exceeds the allowed limit.","product":"Programmable Chat"},{"code":21701,"message":"The Messaging Service does not exist","secondary_message":"The Messaging Service resource you are referencing does not exist","product":null},{"code":21239,"message":"Maximum Credential Lists Reached","secondary_message":"An account cannot have more than 100 IP Access Control Lists.","product":null},{"code":50378,"message":"\'State\' parameter value is invalid","secondary_message":"\'State\' parameter value is set to some not supported value","product":"Programmable Chat"},{"code":51201,"message":"Twilsock : CPS, Init per Account","secondary_message":"Too many connection requests for this account.","product":null},{"code":50438,"message":"Group conversation with given participant list already exists","secondary_message":"There is an existing (open) group conversation with the same participant list.","product":"Programmable Chat"},{"code":30116,"message":"Invalid certificate format","secondary_message":"Please use PEM format for uploaded certificates","product":"Programmable SMS"},{"code":20423,"message":"Invalid SID","secondary_message":null,"product":null},{"code":14221,"message":"Enqueue: Provided Attributes JSON was not valid","secondary_message":"Provided Attributes is not valid JSON.","product":null},{"code":11243,"message":"HTTP retry policy is invalid","secondary_message":"One or more retry policies specified in the \u2018rp\u2019 parameter of your connection settings are invalid.","product":null},{"code":13611,"message":"Record: Invalid timeout value","secondary_message":"timeout must be a positive integer, in seconds.  See the <a href=\'/docs/api/twiml/record#timeout\'>Record Verb</a> API Reference for more information.","product":null},{"code":20012,"message":"Invalid TLSv1.2 Cipher Suite","secondary_message":"Request is not configured with a PCI compliant cipher suite","product":null},{"code":32101,"message":"SIP: Invalid phone number","secondary_message":"The called number is not a valid E.164 number. Make sure that any phone number sent via SIP to Twilio is always E.164-formatted.","product":null},{"code":90016,"message":"\'Template\' or \'TemplateSid\'/\'TemplateLanguage\' is required to send a Template Message","secondary_message":null,"product":null},{"code":50107,"message":"Programmable Chat: User not authorized for command","secondary_message":"Specified User is not authorized for this command due to his Role or Permissions set.","product":"Programmable Chat"},{"code":63001,"message":"Channel could not authenticate the request. Please see Channel specific error message for more information","secondary_message":null,"product":"Programmable SMS"},{"code":50201,"message":"Programmable Chat: User already exists","secondary_message":"Specified User already exists for this Service.","product":"Programmable Chat"},{"code":21501,"message":"Resource not available","secondary_message":"The resource you requested is not (yet) available.","product":null},{"code":57018,"message":"\'Event\' value type must be Map","secondary_message":null,"product":"Programmable SMS"},{"code":50328,"message":"Programmable Chat: Channel webhook type not provided","secondary_message":"Request does not contain parameter for webhook type","product":"Programmable Chat"},{"code":57003,"message":"\'Secret id\' is invalid for this Partner","secondary_message":null,"product":"Programmable SMS"},{"code":19010,"message":"Invalid contact search request","secondary_message":null,"product":null},{"code":32209,"message":"SIP: Secure transport required","secondary_message":"When secure calling is enabled, Twilio cannot accept calls made using UDP or TCP. Please use TLS.","product":null},{"code":12301,"message":"Invalid Upload Content-Type","secondary_message":null,"product":null},{"code":50104,"message":"Programmable Chat: Permission not found","secondary_message":"Specified Permission does not exist.","product":"Programmable Chat"},{"code":50309,"message":"Programmable Chat: Invalid Date Updated parameter","secondary_message":"Request does not contain correctly formatted parameter for Date Updated","product":"Programmable Chat"},{"code":80602,"message":"Non Unique Service Name","secondary_message":"Service UniqueName must be unique.","product":null},{"code":20500,"message":"Internal Server Error","secondary_message":null,"product":null},{"code":90013,"message":"\'Template\' or \'TemplateSid\'&\'TemplateLanguage\' or \'MediaUrls\' is required","secondary_message":null,"product":null},{"code":21620,"message":"Invalid media URL(s)","secondary_message":"One or more media URL you provided is invalid. Please use only valid HTTP and HTTPS URLs.","product":null},{"code":51003,"message":"Client Connection: identity too long","secondary_message":"error","product":null},{"code":80903,"message":"Unknown Participant","secondary_message":"Unknown Participant","product":null},{"code":21608,"message":"The \'to\' phone number provided is not yet verified for this account.","secondary_message":"While your account is in Trial Mode, you may only send SMS messages to verified numbers.  Upgrade to a Full Twilio account to send to any phone number.","product":null},{"code":57004,"message":"\'Category\' is empty","secondary_message":null,"product":"Programmable SMS"},{"code":50363,"message":"Invalid conversation webhook SID","secondary_message":"An invalid conversation webhook SID was supplied.","product":"Programmable Chat"},{"code":21220,"message":"Invalid call state","secondary_message":"You attempted a realtime operation on a Call that was not in-progress.  Calls that have completed cannot be recorded or redirected.","product":null},{"code":503,"message":"Internal Error","secondary_message":null,"product":null},{"code":50414,"message":"Participant address type does not match proxy address type","secondary_message":"The provided participant address mismatches the proxy address channel type.","product":"Programmable Chat"},{"code":70052,"message":"Public Key Client Validation Required For Account","secondary_message":null,"product":null},{"code":21614,"message":"\'To\' number is not a valid mobile number","secondary_message":null,"product":"Programmable SMS"},{"code":13233,"message":"Dial->Conference: Invalid waitUrl","secondary_message":"placeholder","product":null},{"code":21613,"message":"PhoneNumber Requires Certification","secondary_message":"To purchase this phone number, you must certify that you or your customer has a business or personal address within the local country. To certify that you have an address in this country for this account, please purchase this phone number via the [buy a phone number](/user/account/phone-numbers/search) page in the account portal.  You will only need to certify your address once for each country.  Alternatively, you can provision a phone number that does not require certification.","product":null},{"code":63023,"message":"Channel generic error","secondary_message":null,"product":"Programmable SMS"},{"code":21502,"message":"Invalid callback url","secondary_message":"The callback url provided is not a valid URL.","product":null},{"code":21231,"message":"Domain Validation Error","secondary_message":"One of the parameters passed when creating or updating a SIP domain was incorrect.  Please see the response body for more details.","product":null},{"code":51130,"message":"Twilsock: Token is invalid!","secondary_message":"Token is invalid!","product":null},{"code":51116,"message":"Twilsock: Invalid access token grants","secondary_message":"Provided token has invalid grants.","product":null},{"code":50310,"message":"Programmable Chat: Author parameter is too long","secondary_message":"Author parameter is too long.","product":"Programmable Chat"},{"code":51006,"message":"Client Connection: Connection expired","secondary_message":"warning","product":null},{"code":21101,"message":"Subaccounts cannot contain subaccounts","secondary_message":"A subaccount cannot contain nested subaccounts.  Only a root account may contain subaccounts.","product":null},{"code":70104,"message":"Invalid Public Key","secondary_message":null,"product":null},{"code":13313,"message":"Gather: Invalid timeout value","secondary_message":"timeout must be a positive integer, in seconds.  See the <a href=\'/docs/api/twiml/gather#timeout\'>Gather Verb</a> API Reference for more information.","product":null},{"code":20007,"message":"Page size too large","secondary_message":"You\u2019ve requested a page size that is too large. The maximum page size is 1000.","product":null},{"code":90017,"message":"\'Template\' and \'TemplateSid\'/\'TemplateLanguage\' must not be specified together","secondary_message":null,"product":null},{"code":50371,"message":"Conversation webhook trigger not provided","secondary_message":"Scoped webhook trigger keywords are required but were not provided.","product":"Programmable Chat"},{"code":21709,"message":"Alpha Sender ID is Invalid or Not Authorized for this Messaging Service","secondary_message":null,"product":"Programmable SMS"},{"code":11202,"message":"TCP connection refused","secondary_message":"Twilio cannot establish a TCP connection to your web server. Your web server rejected our two connection attempts.","product":null},{"code":14101,"message":"Invalid \\"To\\" attribute","secondary_message":"The To attribute does not appear to be a phone number that you can SMS","product":null},{"code":50373,"message":"No Messaging Service assigned to Conversation","secondary_message":"This Conversation does not have an assigned Messaging Service, therefore cannot accept non-chat participants.","product":"Programmable Chat"},{"code":30012,"message":"TTL is too small","secondary_message":"Message Time To Live is too small","product":null},{"code":50442,"message":"Failed to remove the projected address of a participant.","secondary_message":"The participant should have a projected address in order to remove it.","product":"Programmable Chat"},{"code":94200,"message":"Transcriptions Settings: Invalid encryptionEnabled value","secondary_message":null,"product":null},{"code":21201,"message":"No Called number specified","secondary_message":"You attempted to initiate an outbound phone call, but you did not specify what number to call in the <span class=\'rest-attribute\'>Called</span> POST parameter","product":null},{"code":13227,"message":"Geo Permission configuration is not permitting call","secondary_message":null,"product":null},{"code":50370,"message":"Conversation webhook filter not provided","secondary_message":"Scoped webhook filter parameter is required but was not provided.","product":"Programmable Chat"},{"code":13510,"message":"Say: Invalid loop value","secondary_message":"The value of the loop attribute must be an integer greater or equal to zero. See the <a href=\'/docs/api/twiml/say#loop\'>Play Verb</a> API Reference for more information.","product":null},{"code":50511,"message":"Invalid message media content type","secondary_message":"An invalid multimedia attachment content type was supplied.","product":"Programmable Chat"},{"code":50327,"message":"Programmable Chat: Invalid channel webhook flow sid","secondary_message":"Request does not contain correct parameter for webhook flow sid","product":"Programmable Chat"},{"code":50211,"message":"Identity parameter not acceptable for this Participant","secondary_message":"Participants on SMS, WhatsApp or other non-Chat channels cannot have Identities.","product":"Programmable Chat"},{"code":90010,"message":"Account is not active","secondary_message":null,"product":null},{"code":50602,"message":"Programmable Chat: Cannot decline invite when already channel member.","secondary_message":"Specified user is already member of this channel so his invitation is not present.","product":"Programmable Chat"},{"code":13614,"message":"Record: Invalid transcribe value","secondary_message":"The transcribe attribute of Record must be FAST or ACCURATE. See the <a href=\'/docs/api/twiml/record#transcribe\'>Record Verb</a> API Reference for more information.","product":null},{"code":50437,"message":"Group Participant already exists","secondary_message":"Participant already exists in the group conversation.","product":"Programmable Chat"},{"code":50051,"message":"Programmable Chat: Service SID not provided","secondary_message":"Request does not contain required Service SID parameter.","product":"Programmable Chat"},{"code":63038,"message":"Account exceeded the daily messages limit","secondary_message":"Account exceeded the maximum amount of messages per 24 hours","product":"Programmable SMS"},{"code":50408,"message":"Invalid participant proxy address","secondary_message":"An invalid participant proxy address was supplied.","product":"Programmable Chat"},{"code":50440,"message":"Failed to remove the proxy address of a participant.","secondary_message":"The participant should have a proxy address in order to remove it.","product":"Programmable Chat"},{"code":70155,"message":"Request Is Missing Required HTTP Headers","secondary_message":null,"product":null},{"code":50351,"message":"Conversation SID not provided","secondary_message":"Conversation SID parameter is required but was not provided.","product":"Programmable Chat"},{"code":50213,"message":"Conflicting user modification","secondary_message":"The requested user is already being added or removed from this channel by a concurrent API request.","product":"Programmable Chat"},{"code":90037,"message":"Broadcast has too many \'CorrelationId\' items","secondary_message":null,"product":null},{"code":57002,"message":"\'Secret id\' is too long","secondary_message":null,"product":"Programmable SMS"},{"code":63020,"message":"Twilio encountered a Business Manager account error","secondary_message":null,"product":"Programmable SMS"},{"code":50100,"message":"Programmable Chat: Role not found","secondary_message":"Specified Role does not exist.","product":"Programmable Chat"},{"code":21226,"message":"SIP calling not enabled for this account","secondary_message":"Your account is not enabled for SIP calling.","product":null},{"code":50369,"message":"Conversation webhook URL not provided","secondary_message":"Conversation webhook URL parameter is required but was not provided.","product":"Programmable Chat"},{"code":21255,"message":"Maximum IP Access Control Lists reached","secondary_message":"You cannot have more than 1000 IP Access Control Lists.","product":null},{"code":80206,"message":"No Available Proxy","secondary_message":"This Service has no compatible Proxy numbers for this Participant. Failed to find a proxy number for +1415555XXXX. Either you have no numbers meeting your service\'s GeoMatchLevel for the target number, or the numbers you do have are already in use by the participant in other Sessions.","product":null},{"code":19011,"message":"When updating a contact, invalid JSON syntax or invalid field that cannot be updated by this endpoint","secondary_message":null,"product":null},{"code":19031,"message":"Maximum number of locations allowed reached ","secondary_message":null,"product":null},{"code":94401,"message":"Transcriptions: audio processing error","secondary_message":null,"product":null},{"code":70001,"message":"Validation Failed","secondary_message":null,"product":null},{"code":63035,"message":"This operation is blocked because the RBM agent has not launched and the recipient has not been invited and accepted the invitation to become a tester.","secondary_message":null,"product":"Programmable SMS"},{"code":90041,"message":"Broadcast \'MediaUrl\' field is too long","secondary_message":null,"product":null},{"code":50516,"message":"Programmable Chat: Message index is not a number","secondary_message":"Programmable Chat: Message index is not a number","product":"Programmable Chat"},{"code":80906,"message":"Interaction Not Open","secondary_message":"Received interaction completion event for an Interaction that is already complete","product":null},{"code":50204,"message":"Programmable Chat: Identity not provided","secondary_message":"Request does not contain required \\"Identity\\" parameter.","product":"Programmable Chat"},{"code":51125,"message":"Twilsock: Too many updates","secondary_message":"Number of updates for this account is higher than expected!","product":null},{"code":13226,"message":"Dial: Invalid country code","secondary_message":"The country code of the provided phone number is unknown","product":null},{"code":70251,"message":"Bad SSO Settings","secondary_message":null,"product":null},{"code":63011,"message":"Invalid Request: Twilio encountered an error while processing your request","secondary_message":null,"product":"Programmable SMS"},{"code":35112,"message":"OptimizeStartAt timestamp is missing","secondary_message":null,"product":"Programmable SMS"},{"code":11100,"message":"Invalid URL format","secondary_message":"The format of the provided URL is invalid.","product":null},{"code":21409,"message":"VoiceCallerIdLookup cannot be set for this phone number","secondary_message":"You attempted to set the VoiceCallerIdLookup for a phone number using the REST API, but the number does not support this feature.","product":null},{"code":21422,"message":"PhoneNumber is not available","secondary_message":"You tried to purchase a phone number that is not available for purchase.  This error can be triggered in a few ways:  - Twilio does not own the phone number in question. - Twilio owns the number, but it is reserved for another account.","product":null},{"code":51126,"message":"Twilsock: DNC limit has been reached","secondary_message":"DNC limit has been reached","product":null},{"code":32006,"message":"SIP: Too many hops","secondary_message":"The request was rejected because its \'Max-Forward\' header had reached zero. Ensure your infrastructure will send a minimum value of 20 for \'Max-Forward\' to ensure your call is processed successfully.","product":null},{"code":50416,"message":"Participant and proxy address pair is already in use","secondary_message":"The requested participant and proxy address pair is already registered in the system.","product":"Programmable Chat"},{"code":19027,"message":"Invalid Channel Description","secondary_message":null,"product":null},{"code":21720,"message":"A2P Use Case is Invalid","secondary_message":null,"product":"Programmable SMS"},{"code":13615,"message":"Record: maxLength too high for transcription","secondary_message":"If maxLength must be less than or equal to 120 seconds (2 minutes) if transcribe or transcribeCallback attributes are specified, otherwise transcription is disabled.  See the <a href=\'/docs/api/twiml/record#transcribe\'>Record Verb</a> API Reference for more information.","product":null},{"code":11242,"message":"HTTP connection over Twilio Interconnect is not allowed","secondary_message":"Your account has not been enabled for HTTP connections over Twilio Interconnect.","product":null},{"code":19021,"message":"Only one channel can be set as primary","secondary_message":null,"product":null},{"code":57011,"message":"Unsupported Partner name","secondary_message":null,"product":"Programmable SMS"},{"code":50053,"message":"Programmable Chat: Invalid typing indicator format","secondary_message":"Request does not contain valid typing indicator timeout.","product":"Programmable Chat"},{"code":50513,"message":" Message author should be among Group MMS participants.","secondary_message":"Author identity or address not found among Group MMS participants","product":"Programmable Chat"},{"code":21211,"message":"Invalid \'To\' Phone Number","secondary_message":"You attempted to initiate an outbound phone call or message, but the <span class=\'rest-attribute\'>Called</span> phone number you supplied was not a valid phone number.  Twilio accepts only 10 digit US domestic and Canadian phone numbers, with or without a leading \\"1\\" or \\"+1\\", with any combination of character separators.  For example, these are all valid: 415-867-5309, 4158675309, +1 (415) 867 5309.","product":null},{"code":50419,"message":"Conflicting member modification","secondary_message":"The requested member is already being added or removed from this channel by a concurrent API request.","product":"Programmable Chat"},{"code":50413,"message":"Account is not authorized to use proxy address","secondary_message":"Your account is not authorized to use the requested proxy address.","product":"Programmable Chat"},{"code":21705,"message":"The Messaging Service is invalid","secondary_message":"The Messaging Service Sid you are using is not valid","product":null},{"code":52004,"message":"Credential SID not specified","secondary_message":"Credential SID not specified in binding, token or service","product":null},{"code":13610,"message":"Record: Invalid method value","secondary_message":"The method attribute of Record must be GET or POST. See the <a href=\'/docs/api/twiml/record#method\'>Record Verb</a> API Reference for more information.","product":null},{"code":21703,"message":"The Messaging Service does not have a phone number available to send a message","secondary_message":null,"product":"Programmable SMS"},{"code":50362,"message":"Too many conversation webhook triggers","secondary_message":"The number of keywords used to trigger the webhook configured for this conversation exceeds the limit.","product":"Programmable Chat"},{"code":21236,"message":"IP Access Control List Dependencies Violation","secondary_message":"You cannot delete an IP Access Control List that is still mapped to a SIP Domain.","product":null},{"code":21604,"message":"The destination \'To\' phone number is required to send an SMS","secondary_message":"Make sure to specify a valid phone number as the recipient of the SMS.","product":null},{"code":50320,"message":"Programmable Chat: Channel webhook not found","secondary_message":"Specified channel webhook does not exist","product":"Programmable Chat"},{"code":19030,"message":"Invalid location type","secondary_message":null,"product":null},{"code":30400,"message":"Parameters are not valid ","secondary_message":null,"product":"Programmable SMS"},{"code":32216,"message":"SIP: Address blacklisted","secondary_message":"This address is blacklisted.","product":null},{"code":19032,"message":"Invalid location input","secondary_message":null,"product":null},{"code":80105,"message":"Short Code Already In Service","secondary_message":"ShortCode has already been added to Service","product":null},{"code":32016,"message":"PSTN PDD timeout","secondary_message":null,"product":null},{"code":13910,"message":"Pause: Invalid length value","secondary_message":"The length attribute must be a positive integer, in seconds. See the <a href=\'/docs/api/twiml/pause#length\'>Pause Verb</a> API Reference for more information.","product":null},{"code":21605,"message":"Maximum body length is 160 characters (old API endpoint)","secondary_message":"You are using the deprecated /SMS/Messages API endpoint, which supports up to 160 characters per message. To send up to 1600 characters per message, switch to our upgraded /Messages endpoint.","product":"Programmable SMS"},{"code":80407,"message":"Phone Number Sid Invalid","secondary_message":"Invalid Phone Number Sid","product":null},{"code":13246,"message":"Dial: SIP dialing not enabled for this account","secondary_message":"Your account is not enabled for SIP dialing.","product":null},{"code":21612,"message":"The \'To\' phone number is not currently reachable via SMS","secondary_message":"You have attempted to send to a number that is not currently reachable via Twilio SMS. If the number provided is a properly formatted E.164, it is most likely that Twilio does not yet have service with the carrier you are trying to reach.  We have logged the carrier you are attempting to reach and will monitor these failures when adding new carriers.","product":null},{"code":32103,"message":"SIP: Empty body","secondary_message":"The body of the request was empty, which is not allowed in this context.","product":null},{"code":70102,"message":"Unsupported Public Key Length","secondary_message":null,"product":null},{"code":57017,"message":"\'Topic\' is too long","secondary_message":null,"product":"Programmable SMS"},{"code":90032,"message":"Broadcast recipient\'s \'to\' is invalid","secondary_message":null,"product":null},{"code":50202,"message":"Programmable Chat: User SID not provided","secondary_message":"Request does not contain required User SID parameter.","product":"Programmable Chat"},{"code":11236,"message":"Certificate Invalid - Certificate Expired","secondary_message":"Twilio tried to validate your SSL certificate but your certificate has expired.","product":null},{"code":14202,"message":"Enqueue: Invalid waitUrl","secondary_message":"The waitUrl for the Enqueue verb is invalid.  #### Possible Solutions  Make sure you submit a fully qualified URL including:  *   protocol (http:// or https://) *   hostname *   file path *   properly url-encoded query parameters  Twilio must be able to reach this URL over the public Internet.","product":null},{"code":21619,"message":"Unable to create record","secondary_message":"A text message body or media urls must be specified","product":"Programmable SMS"},{"code":50105,"message":"Programmable Chat: Invalid role type","secondary_message":"Specified Role Type does not exist.","product":"Programmable Chat"},{"code":30007,"message":"Message filtered","secondary_message":"Your message content was flagged as going against carrier guidelines.","product":"Programmable SMS"},{"code":50058,"message":"Programmable Chat: Notification template too long","secondary_message":"Specified notification template parameter is too long","product":"Programmable Chat"},{"code":14111,"message":"Invalid To phone number for Trial mode","secondary_message":"To field must be a validated caller ID while in Trial mode","product":null},{"code":63006,"message":"Could not format given content for the channel. Please see Channel specific error message for more information","secondary_message":null,"product":"Programmable SMS"},{"code":63029,"message":"The receiver failed to download the template","secondary_message":null,"product":"Programmable SMS"},{"code":70051,"message":"Authorization Failed","secondary_message":null,"product":null},{"code":21210,"message":"\'From\' phone number not verified","secondary_message":null,"product":null},{"code":80303,"message":"Not Found Short Code Sid","secondary_message":"Short Code Sid is not associated with your Account.","product":null},{"code":80905,"message":"Unknown Scenario","secondary_message":"No valid proxy scenario for handling inbound call or message","product":null},{"code":61004,"message":"Add-ons: No results","secondary_message":" The Add-on Provider returned a successful response but the Response Validation Schema indicated there was no usable data.","product":null},{"code":35111,"message":"SendAt timestamp is missing","secondary_message":null,"product":"Programmable SMS"},{"code":13217,"message":"Dial: Invalid record value","secondary_message":"record must be \\"true\\" or \\"false\\".","product":null},{"code":80503,"message":"No Records Updated","secondary_message":"Record to be updated was not found. It may have been deleted.","product":null},{"code":50003,"message":"Programmable Chat: Friendly name too long","secondary_message":"Specified friendly name is too long","product":"Programmable Chat"},{"code":30103,"message":"Links not shortened due to shortener application failure","secondary_message":"Twilio was unable to shorten the links included in your message due to an application error in the shortening service.","product":"Programmable SMS"},{"code":11320,"message":"Invalid template unclosed brackets","secondary_message":"The provided URL template has an invalid format. Please check to see if you have unclosed brackets.","product":null},{"code":13242,"message":"Dial->SIP: Invalid sendDigits value","secondary_message":"sendDigits attribute may only contain the following characters \\"0123456789*#w\\"","product":null},{"code":13245,"message":"Dial: Not allowed in this API version","secondary_message":"Your version of the API does not support this feature.","product":null},{"code":30105,"message":"Shortened link not found and no fallback URL found","secondary_message":"We returned a 404 to this user action as we could not find a valid url or fallback url to redirect them to.","product":"Programmable SMS"},{"code":51104,"message":"Twilsock: Token doesn\'t contain service instance","secondary_message":"The token doesn\'t have a service instance.","product":null},{"code":51122,"message":"Twilsock: Authentication failed","secondary_message":"Authentication failed.","product":null},{"code":20020,"message":"No update/state change is observed for the data entered","secondary_message":null,"product":null},{"code":21710,"message":"Phone Number Already Exists in Messaging Service","secondary_message":null,"product":"Programmable SMS"},{"code":57005,"message":"\'Category\' is too long","secondary_message":null,"product":"Programmable SMS"},{"code":19042,"message":"Custom Field validation error","secondary_message":null,"product":null},{"code":12101,"message":"Invalid Twilio Markup XML version","secondary_message":"The version attribute of the Response root element is not valid.","product":null},{"code":14211,"message":"Dial->Queue: Invalid whisper url","secondary_message":"The whisper url is invalid.  #### Possible Solutions  Make sure you submit a fully qualified URL including:  *   protocol (http:// or https://) *   hostname *   file path *   properly url-encoded query parameters  Twilio must be able to reach this URL over the public Internet.","product":null},{"code":21452,"message":"No phone numbers found in area code","secondary_message":"You attempted to get a phone number for your account, but Twilio couldn\'t find any numbers in the area you specified.  You may try again with a different <span class=\'rest-attribute\'>AreaCode</span> or contact us to request a number in a certain area.  We can usually accommodate such requests within a few days.","product":null},{"code":50324,"message":"Invalid channel webhook type","secondary_message":"Request does not contain correctly formatted parameter for channel webhook type","product":"Programmable Chat"},{"code":61000,"message":"Add-ons: Internal server error","secondary_message":"This is generic catch all error for Add-on related conditions that were not caught by a more specific error.","product":null},{"code":21421,"message":"Phone Number is invalid","secondary_message":"You tried to purchase a phone number for your account that was an invalid number. Please specify a valid phone number in E.164 format.","product":null},{"code":50361,"message":"Too many conversation webhooks","secondary_message":"The number of webhooks configured for this conversation exceeds the limit.","product":"Programmable Chat"},{"code":21902,"message":"InvoiceTag length must be between 0 and 32","secondary_message":null,"product":"Programmable SMS"},{"code":13312,"message":"Gather: Invalid method value","secondary_message":"The method attribute of Number must be GET or POST. See the <a href=\'/docs/api/twiml/gather#method\'>Gather Verb</a> API Reference for more information.","product":null},{"code":20429,"message":"Too Many Requests","secondary_message":"Your account is sending too many concurrent Rest API requests to Twilio servers.","product":null},{"code":50364,"message":"Invalid conversation webhook type","secondary_message":"An invalid conversation webhook target was supplied.","product":"Programmable Chat"},{"code":13521,"message":"Say element cannot exceed 4096 characters","secondary_message":"The maximum text length inside a Say verb is 4096 characters","product":null},{"code":50068,"message":"Programmable Chat: Service instance unique name invalid","secondary_message":"Request does not contain correctly formatted service instance unique name","product":null},{"code":51202,"message":"Twilsock : CPS, Too many requests","secondary_message":"Too many requests","product":null},{"code":50415,"message":"Proxy address is not WhatsApp enabled sender","secondary_message":"The requested participant proxy address is not a correctly configured WhatsApp number.","product":"Programmable Chat"},{"code":50212,"message":"Programmable Chat: User already invited","secondary_message":"User with specified Identity already invited to this Channel","product":"Programmable Chat"},{"code":50600,"message":"Programmable Chat: Invite SID not provided","secondary_message":"Request does not contain required Invite SID parameter.","product":"Programmable Chat"},{"code":21471,"message":"Account does not exist","secondary_message":"The AccountSid you specified does not exist. AccountSids are 34 character strings that represent the Twilio Account.  For example, AC44CE4123947237834573457345347567.","product":null},{"code":70253,"message":"Invalid User Grants","secondary_message":null,"product":null},{"code":90012,"message":"\'Recipients\' list has too many items","secondary_message":null,"product":null},{"code":21601,"message":"Phone number is not a valid SMS-capable inbound phone number","secondary_message":"The phone number you provided as the FROM field to initiate an outbound SMS is not an incoming phone number assigned to your account.  Only phone numbers that you buy from Twilio can be used for outgoing SMSes.  In particular, 3rd party phone numbers such as validated CallerIDs cannot be used to send SMSs.","product":null},{"code":13221,"message":"Dial->Number: Invalid method value","secondary_message":"The method attribute of Number must be GET or POST. See the <a href=\'/docs/api/twiml/dial\'>Dial Verb</a> API Reference for more information.","product":null},{"code":14212,"message":"Dial->Queue: queue name too short","secondary_message":"The name of the queue must be at least 1 character long.","product":null},{"code":21910,"message":"Invalid From and To pair. From and To should be of the same channel.","secondary_message":null,"product":"Programmable SMS"},{"code":13251,"message":"Dial: Too many headers passed","secondary_message":"You sent too many header elements.","product":null},{"code":50203,"message":"Programmable Chat: Identity reserved","secondary_message":"Specified identity is reserved for internal use.","product":"Programmable Chat"},{"code":51127,"message":"Twilsock: PNC limit has been","secondary_message":"N/A","product":null},{"code":13299,"message":"2010 Conference API feature requested using 2008 API","secondary_message":"A feature added to the 2010 Conference API was requested via the 2008 Twilio API. Please upgrade to the latest version of the conference API.","product":null},{"code":50056,"message":"Programmable Chat: Webhook disabled processing of command","secondary_message":"Defined webhook returned other than \\"200 OK\\" HTTP code and Programmable Chat Service disabled processing of command.","product":"Programmable Chat"},{"code":50403,"message":"Programmable Chat: Channel member limit exceeded","secondary_message":"Channel has too many members","product":"Programmable Chat"},{"code":57019,"message":"\'Authorization\' header is missing or is invalid","secondary_message":"\'Authorization\' header is missing or is invalid","product":"Programmable SMS"},{"code":63025,"message":"Media already exists","secondary_message":null,"product":"Programmable SMS"},{"code":35116,"message":"Scheduling does not support this timestamp","secondary_message":null,"product":"Programmable SMS"},{"code":30021,"message":"Internal Failure with messaging service orchestrator","secondary_message":null,"product":"Programmable SMS"},{"code":50321,"message":"Programmable Chat: Too many channel webhooks","secondary_message":"Webhooks limit exceeded for given channel","product":"Programmable Chat"},{"code":13231,"message":"Dial->Conference: Invalid endConferenceOnExit value","secondary_message":"placeholder","product":null},{"code":50502,"message":"Programmable Chat: Message index not provided","secondary_message":"Request does not contain required Message Index parameter.","product":"Programmable Chat"},{"code":13120,"message":"Annotate->BillingReferenceTag cannot be over 128 characters","secondary_message":"BillingReferenceTag cannot be over 128 characters","product":null},{"code":21653,"message":"There are more recipient addresses than allowed","secondary_message":null,"product":null},{"code":12300,"message":"Invalid Content-Type","secondary_message":"Twilio is unable to process the Content-Type of the provided URL. Please see Twilio\'s <a href=\\"https://www.twilio.com/docs/sms/accepted-mime-types\\"> documentation on accepted content types </a> for more information on valid Content-Types.","product":null},{"code":51215,"message":"Twilsock: Unauthorized","secondary_message":"Auth failure","product":null},{"code":80604,"message":"Proxy Identifier In Use","secondary_message":"Proxy identifier already in use with requested identifier.","product":null},{"code":32113,"message":"SIP: Header name is not allowed","secondary_message":null,"product":null},{"code":21453,"message":"Phone number already validated on another account","secondary_message":"You attempted to validate your phone number to activate your Twilio Free Trial Account, but that phone number is already associated with another Free Trial Account.  You can only open one Free Trial Account per phone number.","product":null},{"code":35113,"message":"OptimizeEndAt timestamp is missing","secondary_message":null,"product":"Programmable SMS"},{"code":19024,"message":"Invalid channel input","secondary_message":null,"product":null},{"code":63022,"message":"Invalid vname certificate","secondary_message":null,"product":"Programmable SMS"},{"code":11235,"message":"Certificate Invalid - Domain Mismatch","secondary_message":"Twilio tried to validate your SSL certificate but your certificate has a domain name that does not match the domain we requested.","product":null},{"code":90025,"message":"Template body has unsupported tag type","secondary_message":null,"product":null},{"code":50401,"message":"Programmable Chat: Member SID not provided","secondary_message":"Request does not contain required Member SID parameter.","product":"Programmable Chat"},{"code":70106,"message":"Invalid AWS credentials","secondary_message":null,"product":null},{"code":10001,"message":"Account is not active","secondary_message":"This account has been disabled and may not be used until it is reactived.","product":null},{"code":50507,"message":"Programmable Chat: Media not found","secondary_message":"Media with specified SID does not exist. ","product":"Programmable Chat"},{"code":80605,"message":"Proxy Identifier Not In Service","secondary_message":"Proxy identifier not associated with service.","product":null},{"code":30024,"message":"Numeric Sender ID Not Provisioned on Carrier","secondary_message":null,"product":"Programmable SMS"},{"code":50206,"message":"Programmable Chat: Identity should not match user SID pattern","secondary_message":"Specified User\'s Identity matches User SID Pattern \\"US[0-9a-f]{32}\\"","product":"Programmable Chat"},{"code":13112,"message":"Annotate: Invalid nested element","secondary_message":"You may only nest BillingReferenceTag elements in Annotate","product":null},{"code":50435,"message":"Group MMS activation failed.","secondary_message":"Group MMS activation with the new list of participants has failed.","product":"Programmable Chat"},{"code":94100,"message":"Transcriptions: status callback response error","secondary_message":null,"product":null},{"code":63009,"message":"Channel provider returned an internal service error (HTTP 5xx). Please see Channel specific error message for more information","secondary_message":null,"product":"Programmable SMS"},{"code":90039,"message":"Broadcast \'MessageStatusCallbackUrl\' is invalid","secondary_message":null,"product":null},{"code":30114,"message":"Specified date is not available yet","secondary_message":null,"product":"Programmable SMS"},{"code":30003,"message":"Unreachable destination handset","secondary_message":"The destination handset you are trying to reach is switched off or otherwise unavailable.","product":"Programmable SMS"},{"code":50303,"message":"Programmable Chat: Attributes too long","secondary_message":"Specified Channel\'s Attributes parameter is too long.","product":"Programmable Chat"},{"code":21209,"message":"Invalid Method","secondary_message":"You attempted to initiate an outbound phone call, but you sent a <span class=\'rest-attribute\'>Method</span> paramter that was invalid.  <span class=\'rest-attribute\'>Method</span> specifies what HTTP method Twilio should use in contacting your web server.  Possible values are GET and POST.","product":null},{"code":11203,"message":"HTTP communication total time out triggered","secondary_message":"All attempts to communicate with your web server were timed out.","product":null},{"code":63003,"message":"Channel could not find To address","secondary_message":null,"product":"Programmable SMS"},{"code":12100,"message":"Document parse failure","secondary_message":"Twilio was unable to parse the provided XML Document.","product":null},{"code":61008,"message":"Add-ons:  HTTP too many redirects","secondary_message":"Add-on Provider returned too many HTTP redirects. To prevent getting stuck in a redirect loop only 5 redirects will be followed. After that the request will be terminated and this error code will be returned.","product":null},{"code":61005,"message":"Add-ons: Bad request","secondary_message":" The Vendor provided an HTTP Status Code in the 400 range. This indicates that the Add-on Provider received the request but was unable to processes it due to validation or authorization issue.","product":null},{"code":14106,"message":"Document retrieval limit reached","secondary_message":"Your SMS Reply session has requested too many documents. The limit is 50","product":null},{"code":50379,"message":"TimeToInactive format is invalid","secondary_message":"\'TimeToInactive\' parameter format should be ISO8601 duration","product":"Programmable Chat"},{"code":13248,"message":"Dial: Invalid callerID, too long","secondary_message":"Your callerID contains too many characters.","product":null},{"code":50350,"message":"Conversation not found","secondary_message":"The requested conversation SID was not found.","product":"Programmable Chat"},{"code":13244,"message":"Dial: No SIP Authorization","secondary_message":"Your account is not authorized to make SIP calls","product":null},{"code":50060,"message":"Programmable Chat: Invalid user channels limit format","secondary_message":"Request does not contain correctly formatted parameter for user channels limit","product":"Programmable Chat"},{"code":13223,"message":"Dial: Invalid phone number format","secondary_message":"Phone Numbers must be in the format XXXXXXXXXX, or 1XXXXXXXXXX, +1international","product":null},{"code":51131,"message":"Twilsock: Authentication failed","secondary_message":"N/A","product":null},{"code":50331,"message":"Programmable Chat: Channel webhook trigger not provided","secondary_message":"Request does not contain parameter for webhook trigger","product":"Programmable Chat"},{"code":50329,"message":"Programmable Chat: Channel webhook url not provided","secondary_message":"Request does not contain parameter for webhook url","product":"Programmable Chat"},{"code":80902,"message":"No Active Session","secondary_message":"You received a call to your Proxy Number from a caller who is not a participant in an active session. ","product":null},{"code":50441,"message":"Failed to add a proxy address to a participant.","secondary_message":"The participant should have an address in order to add a proxy address.","product":"Programmable Chat"},{"code":21420,"message":"ApplicationSid is not accessible","secondary_message":"You specified a VoiceApplicationSid or SmsApplicationSid for a new phone number that is not controlled by your account, or is invalid. Please specify an ApplicationSid that you\'ve created in your [Account Dashboard](/user/account/apps).","product":null},{"code":11237,"message":"Certificate Invalid - Could not find path to certificate","secondary_message":"Twilio tried to validate your SSL certificate but was unable to find it in our certificate store.","product":null},{"code":61003,"message":"Add-ons: Requirements to invoke AddOns have not been met","secondary_message":" A parameter required to complete the request was missing or is not supported. As a result the Add-on Request can not be completed.","product":null},{"code":90022,"message":"One of \'TemplateArgs\' dictionary value is too long","secondary_message":null,"product":null},{"code":14108,"message":"From phone number not SMS capable","secondary_message":"The From phone number does not appear to be a phone number that you can SMS from","product":null},{"code":0,"message":"OK","secondary_message":null,"product":null},{"code":50106,"message":"Programmable Chat: Channel creator role not found","secondary_message":"Valid Channel Creator Role does not exist in this service deployment.","product":"Programmable Chat"},{"code":20002,"message":"Invalid FriendlyName","secondary_message":"Many Twilio resources take descriptive names to help you remember what they are.  However, such \\"FriendlyNames\\" must be between 1 and 64 characters long.","product":null},{"code":80406,"message":"Phone Number Did Invalid","secondary_message":"Invalid Phone Number Did","product":null},{"code":50368,"message":"Conversation webhook type not provided","secondary_message":"Conversation webhook target parameter is required but was not provided.","product":"Programmable Chat"},{"code":63007,"message":"Twilio could not find a Channel with the specified From address","secondary_message":null,"product":"Programmable SMS"},{"code":21618,"message":"The message body cannot be sent","secondary_message":"You have attempted to send a message with content that is being filtered by all of our carriers.  We have logged the carrier you are attempting to reach and will monitor these failures when adding new carriers. If we add a new carrier in the future that does not filter the content you are trying to send, Twilio will automatically route your message through the new carrier.","product":null},{"code":13238,"message":"Dial->Conference: Invalid Verb used in waitUrl TwiML","secondary_message":"placeholder","product":null},{"code":61007,"message":"Add-ons: Response body too large","secondary_message":" The Add-on Provider returned a response payload that exceeded 64 kilobytes. As a result the payload was removed and this error was returned instead.","product":null},{"code":30104,"message":"Shortened link not found. Click redirected to fallback Url","secondary_message":"Twilio was unable to find a record of the shortened link that this request was sent to.","product":"Programmable SMS"},{"code":19034,"message":"Invalid country code","secondary_message":null,"product":null},{"code":11770,"message":"Empty response body","secondary_message":"Twilio received a HTTP response with Transfer-encoding: chunked but an empty body.  #### Possible Causes  *   Server misconfiguration *   Network disruptions   #### Possible Solutions  *   Verify that the server is serving a non-empty HTTP response *   Verify that the network connection is stable","product":null},{"code":11300,"message":"Invalid template URL","secondary_message":"The provided URL template has an invalid format. Please check to see if you have unclosed brackets.","product":null},{"code":80307,"message":"Record to be updated was not found in database.","secondary_message":null,"product":null},{"code":21241,"message":"Credential List Dependencies Violation","secondary_message":"You cannot delete a Credential List that is still mapped to a SIP Domain.","product":null},{"code":19050,"message":"Internal Server Error","secondary_message":null,"product":null},{"code":14105,"message":"Invalid statusCallback attribute","secondary_message":"The Sms Verb\'s statusCallback attribute must be a valid URL","product":null},{"code":50512,"message":"Message media size is too large","secondary_message":"The requested multimedia attachment size exceeds the allowed limit.","product":"Programmable Chat"},{"code":30020,"message":"Internal Failure with scheduler","secondary_message":null,"product":"Programmable SMS"},{"code":80409,"message":"Session Sid Invalid","secondary_message":"Invalid Session Sid","product":null},{"code":19025,"message":"Channel validation error","secondary_message":null,"product":null},{"code":404,"message":"Not Found","secondary_message":null,"product":null},{"code":13110,"message":"Annotate: Annotate must contain one valid nested element","secondary_message":"Annotate must contain one valid nested element","product":null},{"code":11200,"message":"HTTP retrieval failure","secondary_message":"There was a failure attempting to retrieve the contents of this URL.","product":null},{"code":51111,"message":"Twilsock: Service instance limit reached","secondary_message":"Service instance limit has been reached for the specified account.","product":null},{"code":21224,"message":"Invalid SipAuthPassword. Illegal chars","secondary_message":"The SipAuthUsername you specified contained characters not allowed in SIP.","product":null},{"code":50326,"message":"Programmable Chat: Invalid channel webhook trigger","secondary_message":"Request does not contain correct parameter for webhook trigger","product":"Programmable Chat"},{"code":50405,"message":"Programmable Chat: Invalid last consumption timestamp format","secondary_message":"Request does not contain correctly formatted parameter for last consumption timestamp","product":"Programmable Chat"},{"code":14203,"message":"Enqueue: Invalid Enqueue action url","secondary_message":"The action URL for the Enqueue verb is invalid.  #### Possible Solutions  Make sure you submit a fully qualified URL including:  *   protocol (http:// or https://) *   hostname *   file path *   properly url-encoded query parameters  Twilio must be able to reach this URL over the public Internet.","product":null},{"code":35121,"message":"OptimizeEndAt can only be used when ScheduleType is \'optimize\'","secondary_message":null,"product":"Programmable SMS"},{"code":21479,"message":"Unable to update Status for subaccount, subaccount has been closed.","secondary_message":"Unable to update Status for subaccount, subaccount is closed and can not be re-opened.","product":null},{"code":30010,"message":"Message price exceeds max price","secondary_message":null,"product":"Programmable SMS"},{"code":21610,"message":"Attempt to send to unsubscribed recipient","secondary_message":null,"product":"Programmable SMS"},{"code":21451,"message":"Invalid area code","secondary_message":"You attempted to get a phone number for your account, but the <span class=\'rest-attribute\'>AreaCode</span> parameter you specified was not a valid North American area code.  <span class=\'rest-attribute\'>AreaCode</span> is optional, and for Local phone numbers, may be any US or Canadian area code, or for TollFree numbers, may be one of 800,888,877 or 866.","product":null},{"code":50209,"message":"Programmable Chat: Invalid binding type","secondary_message":"Specified binding type does not exist.","product":"Programmable Chat"},{"code":90001,"message":"Message SID is invalid","secondary_message":null,"product":"Programmable SMS"},{"code":90011,"message":"MessageSid is invalid","secondary_message":null,"product":null},{"code":21480,"message":"Reached maximum number of subaccounts","secondary_message":"Reached maximum number of subaccounts, please contact [Twilio](/help) if you want to create more subaccounts.","product":null},{"code":13322,"message":"Gather->Say: Invalid loop value","secondary_message":"The value of the loop attribute must be an integer greater or equal to zero.  See the <a href=\'/docs/api/twiml/say#loop\'>Say Verb</a> API Reference for more information.","product":null},{"code":13254,"message":"Dial->Sip: SIP URI DNS does not resolve or resolves to an non-public IP address","secondary_message":"Please check your DNS record to ensure it is properly configured. Alternatively, you can use a specific public IP address in your URI rather than specifying a domain.","product":null},{"code":21717,"message":"Brand Registration SID for US A2P Campaign Use Case is Not Registered","secondary_message":null,"product":"Programmable SMS"},{"code":11251,"message":"Fatal protocol violation","secondary_message":"There was an HTTP protocol violation speaking to the target URL.","product":null},{"code":70103,"message":"Unsupported Public Key Exponent","secondary_message":null,"product":null},{"code":90034,"message":"\'BroadcastStatusCallbackUrl\' is too long","secondary_message":null,"product":null},{"code":50306,"message":"Programmable Chat: Unique name should not match channel SID pattern","secondary_message":"Specified Channel\'s Unique Name matches Channel SID Pattern \\"CH[0-9a-f]{32}\\".","product":"Programmable Chat"},{"code":50508,"message":"Programmable Chat: Media already sent with another message","secondary_message":"Media with specified SID is already sent with another Chat message","product":"Programmable Chat"},{"code":21212,"message":"Invalid From Number (caller ID)","secondary_message":null,"product":null},{"code":57001,"message":"\'Secret id\' is empty","secondary_message":null,"product":"Programmable SMS"},{"code":20161,"message":"Programmable Chat: Parameters are not specified for update request","secondary_message":null,"product":"Programmable Chat"},{"code":13210,"message":"Dial: Invalid method value","secondary_message":"You have provided an invalid value for the \\"method\\" attribute.  Valid values are GET or POST.  See the <a href=\'/docs/api/twiml/dial#method\'>Dial Verb</a> API Reference for more information.","product":null},{"code":50400,"message":"Programmable Chat: User not member of channel","secondary_message":"Specified User is not member of this Channel.","product":"Programmable Chat"},{"code":11201,"message":"TCP connection timed out","secondary_message":"Twilio cannot establish a TCP connection to your web server. The two attempts to connect to your web server were timed out. Each connection attempt has a 5 second timeout.","product":null},{"code":20413,"message":"Request Entity Too Large","secondary_message":"Request entity is larger than limits defined","product":null},{"code":13511,"message":"Say: Invalid voice value","secondary_message":"The value of the voice attribute must be \\"man\\" or \\"woman\\". See the <a href=\'/docs/api/twiml/say#voice\'>Say Verb</a> API Reference for more information.","product":null},{"code":50341,"message":"Invalid messaging service SID","secondary_message":"An invalid messaging service SID was supplied.","product":"Programmable Chat"},{"code":50407,"message":"Invalid messaging binding address","secondary_message":"An invalid participant public address was supplied.","product":"Programmable Chat"},{"code":50433,"message":"Participant already exists","secondary_message":"The requested Chat participant is already mapped to a conversation.","product":"Programmable Chat"},{"code":12102,"message":"The root element must be Response","secondary_message":"The root element of a Twilio Markup XML document *must* be <a href=\\"/docs/api/twiml/response\\">Response</a>","product":null},{"code":51001,"message":"Client Connection: Connections resource limit exceeded","secondary_message":"error","product":null},{"code":90029,"message":"Broadcast \'CorrelationId\' is empty","secondary_message":null,"product":null},{"code":90031,"message":"Broadcast \'Recipients\' list is empty","secondary_message":null,"product":null},{"code":19040,"message":"Custom Field provided is not defined","secondary_message":null,"product":null},{"code":63019,"message":"Media failed to download","secondary_message":null,"product":"Programmable SMS"},{"code":32111,"message":"SIP: Invalid header name","secondary_message":null,"product":null},{"code":30115,"message":"Date format is incorrect","secondary_message":null,"product":"Programmable SMS"},{"code":90018,"message":"\'Template\' field is too long","secondary_message":null,"product":null},{"code":13321,"message":"Gather->Say: Invalid voice value","secondary_message":"The value of the voice attribute must be \\"man\\" or \\"woman\\". See the <a href=\'/docs/api/twiml/say#voice\'>Say Verb</a> API Reference for more information.","product":null},{"code":21652,"message":"Maximum subject length is 40 characters","secondary_message":"Keep the subject text of your message to 40 characters or less.","product":"Programmable SMS"},{"code":94201,"message":"Transcriptions Settings: encryptionKeySid invalid or not found","secondary_message":null,"product":null},{"code":50200,"message":"Programmable Chat: User not found","secondary_message":"Specified User does not exist.","product":"Programmable Chat"},{"code":30008,"message":"Unknown error","secondary_message":null,"product":"Programmable SMS"},{"code":13253,"message":"Dial: Header is too long","secondary_message":"You sent a header that is too long.","product":null},{"code":19004,"message":"Invalid or missing Contact input","secondary_message":null,"product":null},{"code":19005,"message":"Contact validation error","secondary_message":null,"product":null},{"code":80201,"message":"No Available Voice Proxy","secondary_message":"This Service has no compatible Proxy numbers for this Participant. This Service has no available Proxy numbers having voice capabilities. This can happen if you attempted to create a participant in a session for which you did not specify a Mode in a country that does not support combined voice and sms capabilities.","product":null},{"code":90019,"message":"\'TemplateArgs\' dictionary size is too large","secondary_message":null,"product":null},{"code":400,"message":"Bad Request","secondary_message":null,"product":null},{"code":13520,"message":"Say: Invalid text","secondary_message":"The text of the Say verb was empty or un-parsable. See the <a href=\'/docs/api/twiml/say\'>Say Verb</a> API Reference for more information.","product":null},{"code":21609,"message":"Invalid \'StatusCallback\'","secondary_message":"StatusCallback must be a valid HTTP(s) URL.  The maximum length of the StatusCallback is 4000 characters.","product":null},{"code":51121,"message":"Twilsock: Token expiration time exceeds maximum","secondary_message":"Token expiration time exceeds max allowed amount.","product":null},{"code":63021,"message":"Channel invalid content error","secondary_message":null,"product":"Programmable SMS"},{"code":21624,"message":"Invalid validity period value","secondary_message":null,"product":"Programmable SMS"},{"code":11310,"message":"Invalid template token","secondary_message":"The provided URL template references a nonexistent token.","product":null},{"code":50402,"message":"Programmable Chat: Member not found","secondary_message":"Specified Member does not exist.","product":"Programmable Chat"},{"code":50432,"message":"Participant not found","secondary_message":"The requested conversation participant SID was not found.","product":"Programmable Chat"},{"code":94300,"message":"Transcriptions Configurations: Invalid callback configuration","secondary_message":null,"product":null},{"code":51112,"message":"Twilsock: Product usage disabled","secondary_message":"Product usage has been disabled for this instance.","product":null},{"code":50367,"message":"Invalid conversation webhook flow SID","secondary_message":"An invalid conversation webhook flow SID was supplied.","product":"Programmable Chat"},{"code":94301,"message":"Transcriptions Configurations: UniqueName is required","secondary_message":null,"product":null},{"code":20005,"message":"Account not active","secondary_message":"Your Twilio account is not active, potentially because you ran out of funds, or you have not yet activated your free trial.","product":null},{"code":50055,"message":"Programmable Chat: Invalid webhook method","secondary_message":"Request does not contain valid HTTP method for webhook.","product":"Programmable Chat"},{"code":32110,"message":"SIP: URI is formatted incorrectly","secondary_message":"Your SIP URI cannot be parsed unambiguously.","product":null},{"code":50061,"message":"Programmable Chat: Invalid channel members limit format","secondary_message":"Request does not contain correctly formatted parameter for channel members limit","product":"Programmable Chat"},{"code":51120,"message":"Twilsock: Token is not valid yet","secondary_message":"Token is not valid yet","product":null},{"code":50004,"message":"Programmable Chat: Unique Name too long","secondary_message":"Specified unique name is too long","product":"Programmable Chat"},{"code":50305,"message":"Programmable Chat: Channel SID not provided","secondary_message":"Request does not contain required Channel SID parameter.","product":"Programmable Chat"},{"code":21230,"message":"Maximum Domains Reached","secondary_message":"An account cannot have more than 100 domains.","product":null},{"code":90038,"message":"\'BroadcastStatusCallbackUrl\' is invalid","secondary_message":null,"product":null},{"code":21214,"message":"\'To\' phone number cannot be reached","secondary_message":"You attempted to initiate an outbound phone call to a phone number that cannot be reached. Please check the number and try again.","product":null},{"code":63034,"message":"Media exceeds size limit","secondary_message":null,"product":"Programmable SMS"},{"code":51007,"message":"Client Connection: Token authentication is rejected","secondary_message":"error","product":null},{"code":80603,"message":"Non Unique Session Name","secondary_message":null,"product":null},{"code":57014,"message":"\'Event\' data in payload is absent","secondary_message":null,"product":"Programmable SMS"},{"code":90026,"message":"Template body could not be parsed","secondary_message":null,"product":null},{"code":63018,"message":"Rate limit exceeded for Channel","secondary_message":null,"product":"Programmable SMS"},{"code":13224,"message":"Dial: Twilio does not support calling this number or the number is invalid","secondary_message":null,"product":null},{"code":35119,"message":"SendAt can only be used when ScheduleType is \'fixed\'","secondary_message":null,"product":"Programmable SMS"},{"code":14206,"message":"Enqueue: Invalid waitUrlMethod value","secondary_message":"The waitUrlMethod value is invalid. You must specify one of \'GET\' or \'POST\'.","product":null},{"code":30001,"message":"Queue overflow","secondary_message":null,"product":"Programmable SMS"},{"code":11241,"message":"HTTP connection edge location is not supported","secondary_message":null,"product":null},{"code":50322,"message":"Programmable Chat: Too many channel webhook triggers","secondary_message":"Triggers limit exceeded for given channel webhook","product":"Programmable Chat"},{"code":30113,"message":"Specified date is too old","secondary_message":null,"product":"Programmable SMS"},{"code":13237,"message":"Dial->Conference: Invalid Conference Name","secondary_message":"placeholder","product":null},{"code":21215,"message":"Geo Permission configuration is not permitting call","secondary_message":null,"product":null},{"code":80405,"message":"Participant Sid Invalid","secondary_message":"Invalid Participant Sid","product":null},{"code":21474,"message":"API User must be the parent account to transfer phone numbers.","secondary_message":"The API user can not be a subaccount, must be a parent account to transfer phone numbers between parent and child accounts.","product":null},{"code":13250,"message":"Dial: Too many URIs passed","secondary_message":"You specified too many URI elements.","product":null},{"code":13314,"message":"Gather: Invalid numDigits value","secondary_message":"The numDigits attribute must be a positive integer. See the <a href=\'/docs/api/twiml/gather#numDigits\'>Gather Verb</a> API Reference for more information.","product":null},{"code":30023,"message":"US A2P 10DLC - Daily Message Cap Reached","secondary_message":"Your messages to this particular carrier has exceeded the maximum allowable messages for the day.","product":"Programmable SMS"},{"code":50406,"message":"Programmable Chat: Invalid last consumed message index format","secondary_message":"Request does not contain correctly formatted parameter for last consumed message index","product":"Programmable Chat"},{"code":50069,"message":"Programmable Chat: Service instance with provided unique name already exists","secondary_message":"Request contains already existing service instance unique name","product":null},{"code":51119,"message":"Twilsock: Token expired","secondary_message":"The token has been expired.","product":null},{"code":63012,"message":"Channel provider returned an internal service error","secondary_message":null,"product":"Programmable SMS"},{"code":80610,"message":"Unauthorized Operation","secondary_message":"Unauthorized. You may be trying to use an invalid combination of sids.","product":null},{"code":21213,"message":"Caller phone number is required","secondary_message":"You attempted to initiate an outbound phone call, but you forgot to send a <span class=\'rest-attribute\'>Caller</span> parameter.  <span class=\'rest-attribute\'>Caller</span> is required, and tells Twilio what Caller ID to use for the phone call.","product":null},{"code":90036,"message":"Broadcast recipient\'s \'body\' is too long","secondary_message":null,"product":null},{"code":50050,"message":"Programmable Chat: Service Instance not found","secondary_message":"Specified Service Instance does not exist.","product":"Programmable Chat"},{"code":57008,"message":"\'EventType\' format must be String","secondary_message":null,"product":"Programmable SMS"},{"code":13211,"message":"Dial: Invalid ifMachine value","secondary_message":"ifMachine must be either \\"hangup\\",\\"continue\\", or \\"false\\".","product":null},{"code":51005,"message":"Client Connection: Command or keepalive acknowledgement not received","secondary_message":"warning","product":null},{"code":50349,"message":"Conflicting channel modification","secondary_message":"The requested channel is already being added or removed by a concurrent API request.","product":"Programmable Chat"},{"code":21719,"message":"Incompatible Messaging Service/A2P Use Cases","secondary_message":null,"product":"Programmable SMS"},{"code":63027,"message":"Template does not exist for a language and locale","secondary_message":null,"product":"Programmable SMS"},{"code":12400,"message":"Internal Failure","secondary_message":"An internal error has occurred that prevented Twilio from processing your response.","product":null},{"code":32114,"message":"SIP: Unsupported parameter value","secondary_message":"A URI parameter contains an unsupported value and will be ignored","product":null},{"code":21450,"message":"Phone number already validated on your account","secondary_message":"You attempted to add an Outgoing Caller ID to your account, but that number is already verified as an Outgoing Caller ID on your account.","product":null},{"code":21454,"message":"Invalid CallDelay","secondary_message":"Call delay specified must be an integer between 0 and 60, specifying the number of seconds to delay before initiating the validation call.","product":null},{"code":50503,"message":"Programmable Chat: Message body not provided","secondary_message":"Request does not contain required Message Body parameter.","product":"Programmable Chat"},{"code":21626,"message":"Invalid \'StatusCallbackEvent\'","secondary_message":"One or more of the StatusCallbackEvents provided were invalid.","product":null},{"code":63005,"message":"Channel did not accept given content. Please see Channel specific error message for more information","secondary_message":null,"product":"Programmable SMS"},{"code":63013,"message":"Channel policy violation","secondary_message":"This message send failed because it violates Channel provider\'s policy.","product":"Programmable SMS"},{"code":13410,"message":"Play: Invalid loop value","secondary_message":"The value of the loop attribute must be an integer greater or equal to zero. See the <a href=\'/docs/api/twiml/play#loop\'>Play Verb</a> API Reference for more information.","product":null},{"code":21401,"message":"Invalid Phone Number","secondary_message":"The phone number you specified was not a valid North American (US or Canadian) number.  Twilio accepts only 10 digit US domestic and Canadian phone numbers, with or without a leading \\"1\\" or \\"+1\\", with any combination of character separators.  For example, these are all valid: 415-867-5309, 4158675309, +1 (415) 867 5309.","product":null},{"code":70153,"message":"Public Key Specified Does Not Exist","secondary_message":null,"product":null},{"code":70152,"message":"Request Contains Invalid Flags","secondary_message":null,"product":null},{"code":80202,"message":"No Available Message Proxy","secondary_message":"This Service has no compatible Proxy numbers for this Participant. This Service has no available Proxy numbers having sms capabilities. This can happen if you attempted to create a participant in a session for which you did not specify a Mode in a country that does not support combined voice and sms capabilities, or if your only available proxy numbers do not have messaging capabilities.","product":null},{"code":30017,"message":"Carrier network congestion","secondary_message":"Message request was rejected because the carrier has high traffic.","product":"Programmable SMS"},{"code":20503,"message":"Service unavailable","secondary_message":"Service is unavailable","product":null},{"code":21713,"message":"Messaging Service Use Case is Invalid","secondary_message":null,"product":"Programmable SMS"},{"code":13232,"message":"Dial->Conference: Invalid startConferenceOnEnter value","secondary_message":"placeholder","product":null},{"code":21901,"message":"DltTemplateId is invalid","secondary_message":null,"product":null},{"code":50065,"message":"Programmable Chat: Invalid webhook retry count","secondary_message":"Request does not contain correctly formatted parameter for webhook retry count.","product":"Programmable Chat"},{"code":50443,"message":"Failed to add a projected address to a participant.","secondary_message":"The participant should not have a messaging binding in order to add a projected address.","product":"Programmable Chat"},{"code":21603,"message":"A \'From\' or \'MessagingServiceSid\' parameter is required to send a message","secondary_message":"Make sure to specify a valid Twilio Phone Number, Alpha Sender ID, or Messaging Service SID in your API requests","product":"Programmable SMS"},{"code":57010,"message":"\'PartnerName\' is absent","secondary_message":null,"product":"Programmable SMS"},{"code":19013,"message":"At least one of the following fields is required for a contact: first_name, middle_name, last_name, legal_name, preferred_name, unique_customer_provided_id or channel","secondary_message":null,"product":null},{"code":63030,"message":"Unsupported parameter for type of channels message","secondary_message":null,"product":"Programmable SMS"},{"code":10004,"message":"Call concurrency limit exceeded","secondary_message":null,"product":null},{"code":50342,"message":"Messaging service does not belong to account","secondary_message":"The requested messaging service SID does not belong to your account.","product":"Programmable Chat"},{"code":14107,"message":"SMS send rate limit exceeded","secondary_message":"Too many messages have been sent between two numbers within a short time period, possibly indicating a runaway job or infinite loop. There is a limit of 20 outbound replies between two phone numbers in a short period.","product":"Programmable SMS"},{"code":63002,"message":"Channel could not find the From address","secondary_message":null,"product":"Programmable SMS"},{"code":19037,"message":"When updating a location at least one field should be updated","secondary_message":null,"product":null},{"code":13213,"message":"Dial: Invalid hangupOnStar value","secondary_message":"hangupOnStar must be \\"true\\" or \\"false\\". See the <a href=\'/docs/api/twiml/dial#hangupOnStar\'>Dial Verb</a> API Reference for more information.","product":null},{"code":11205,"message":"HTTP connection failure","secondary_message":"There was a network failure attempting to connect to this URL","product":null},{"code":30109,"message":"Invalid URL provided for Click Tracking callback url","secondary_message":"The URL specific in your API request for Click Tracking is invalid","product":"Programmable SMS"},{"code":51102,"message":"Twilsock: Service instance SID not specified","secondary_message":"Service instance SID is not specified and couln\'t be generated.","product":null},{"code":50076,"message":"Webhook failed to execute successfully due to timeout","secondary_message":"Webhook\'s response isn\'t received in 5 seconds","product":"Programmable Chat"},{"code":57012,"message":"Signature invalid","secondary_message":null,"product":"Programmable SMS"},{"code":50376,"message":"TimeToClosed should be greater or equal to 10 minutes","secondary_message":"Duration to transfer channel to closed state can\'t be shorter than 10 minutes.","product":"Programmable Chat"},{"code":30102,"message":"Domain\'s certificate has expired","secondary_message":"The private certificate associated with Domain you specific has expired","product":"Programmable SMS"},{"code":63015,"message":"Channel Sandbox can only send messages to phone numbers that have joined the Sandbox","secondary_message":null,"product":"Programmable SMS"},{"code":51129,"message":"Twilsock: Too many messages per account","secondary_message":"Number of messages for this account is higher than expected!","product":null},{"code":14223,"message":"Enqueue: Unable to cleanup task","secondary_message":"Unable to cancel the task created by Enqueue upon a TwimL error or task hangup.","product":null},{"code":410,"message":"Unknown Error Code","secondary_message":null,"product":null},{"code":50366,"message":"Invalid conversation webhook trigger","secondary_message":"An invalid conversation webhook trigger keyword was supplied.","product":"Programmable Chat"},{"code":63032,"message":"We cannot send this message to this user because of a WhatsApp limitation. ","secondary_message":"User\'s number is part of an experiment.","product":"Programmable SMS"},{"code":20003,"message":"Permission Denied","secondary_message":"You lack permission to the resource and method you requested.","product":null},{"code":80701,"message":"Parameter Validation Failed","secondary_message":"\'<parameter name>\' is invalid. <parameter is invalid>","product":null},{"code":21217,"message":"Phone number does not appear to be valid","secondary_message":"You attempted to initiate an outbound phone call to an invalid phone number. Please check the phone number and try again.","product":null},{"code":21621,"message":"The \'From\' number has not been enabled for MMS","secondary_message":"The \'From\' phone number does not appear to be a phone number that you can send MMS messages from.","product":null},{"code":50500,"message":"Programmable Chat: Message not found","secondary_message":"Specified Message does not exist.","product":"Programmable Chat"},{"code":13249,"message":"Dial: Invalid username or password attribute","secondary_message":"Your username or password are invalid.","product":null},{"code":13215,"message":"Dial: Invalid nested element","secondary_message":"The only valid nested element for Dial is Number. See the <a href=\'/docs/api/twiml/dial\'>Dial Verb</a> API Reference for more information.","product":null},{"code":21202,"message":"Called number is a premium number","secondary_message":"You attempted to initiate an outboud phone call to a \\"premium\\" phone number, such as a toll 976 line.","product":null},{"code":50002,"message":"Programmable Chat: Resource is being deleted","secondary_message":"The resource your request relates to is currently being deleted.","product":"Programmable Chat"},{"code":21225,"message":"SipAuthPassword is required when providing SipAuthUsername","secondary_message":"You must specify a SipAuthPassword if you are also using SipAuthUsername.","product":null},{"code":21455,"message":"Invalid PlayUrl","secondary_message":"PlayUrl must be a valid URL using the HTTP or HTTPS protocol.","product":null},{"code":30005,"message":"Unknown destination handset","secondary_message":"The destination number you are trying to reach is unknown and may no longer exist.","product":"Programmable SMS"},{"code":94101,"message":"Transcriptions: status callback response timed out","secondary_message":null,"product":null},{"code":50308,"message":"Programmable Chat: Invalid Date Created parameter","secondary_message":"Request does not contain correctly formatted parameter for Date Created","product":"Programmable Chat"},{"code":13235,"message":"Dial->Conference: Invalid beep value","secondary_message":"placeholder","product":null},{"code":51128,"message":"Twilsock: Too many messages per connection","secondary_message":"Number of messages for one connection is higher than expected!","product":null},{"code":13236,"message":"Dial->Conference: Invalid Conference Sid","secondary_message":"placeholder","product":null},{"code":21405,"message":"Cannot set VoiceFallbackUrl without setting Url","secondary_message":"You cannot set a fallback URL without specifying a primary URL","product":null},{"code":30110,"message":"Domain is blocked","secondary_message":"The provided URL to resolve this link to is on a blocked domain.","product":"Programmable SMS"},{"code":14109,"message":"TwiML Reply message limit exceeded","secondary_message":"Too many messages have been sent in reply to an incoming message. The current is 10","product":"Programmable SMS"},{"code":70002,"message":"Bad request","secondary_message":null,"product":null},{"code":50103,"message":"Programmable Chat: Role SID not provided","secondary_message":"Request does not contain required Role SID parameter.","product":"Programmable Chat"},{"code":21223,"message":"Invalid SipAuthPassword. Must be fewer than 256 chars","secondary_message":"The SipAuthPassword you specified contained too many characters.","product":null},{"code":35114,"message":"Scheduling does not support this timestamp","secondary_message":null,"product":"Programmable SMS"},{"code":50504,"message":"Programmable Chat: Message body parameter is too long","secondary_message":"Message body parameter is too long","product":"Programmable Chat"},{"code":21900,"message":"DltPEId is invalid","secondary_message":null,"product":null},{"code":63024,"message":"Invalid message recipient","secondary_message":null,"product":"Programmable SMS"},{"code":15003,"message":"Call Progress: Warning Response to Callback URL","secondary_message":"Got an HTTP warning in response to the callback URL.","product":null},{"code":19003,"message":"Contact with the unique_customer_provided_id provided already exists","secondary_message":null,"product":null},{"code":15000,"message":"Call Progress: Internal Twilio Error","secondary_message":"An internal error has occurred that prevented Twilio from processing your Call Progress Event.","product":null},{"code":21240,"message":"Credential List Validation Error","secondary_message":"One of the parameters passed when creating or updating a Credential List was incorrect.","product":null},{"code":21206,"message":"Invalid SendDigits","secondary_message":"You attempted to initiate an outbound phone call, and you included a <span class=\'rest-attribute\'>SendDigits</span> parameter that wasn\'t valid. <span class=\'rest-attribute\'>SendDigits</span> is optional, and specifies that Twilio should simulate sending keypad digits when the party answers.  It is useful for navigating a phone tree, reaching an extension or entering a password in a voicemail system.  <span class=\'rest-attribute\'>SendDigits</span> may contain numbers, the # and * characters, as well as the \\"w\\" character to \\"wait\\" for half a second.","product":null},{"code":70053,"message":"Public Key Client Validation Not Enabled For Account","secondary_message":null,"product":null},{"code":80205,"message":"No Proxies For Service","secondary_message":"This Service has no compatible Proxy numbers for this Participant. This Service has no Proxy numbers configured.","product":null},{"code":21704,"message":"The Messaging Service contains no phone numbers","secondary_message":null,"product":"Programmable SMS"},{"code":50307,"message":"Programmable Chat: Channel with provided unique name already exists","secondary_message":"Specified Channel\'s Unique Name already exists in this Service deployment.","product":"Programmable Chat"},{"code":50300,"message":"Programmable Chat: Channel not found","secondary_message":"Specified Channel does not exist.","product":"Programmable Chat"},{"code":50409,"message":"Participant address equals proxy address","secondary_message":"The supplied participant address must not equal its proxy address.","product":"Programmable Chat"},{"code":21228,"message":"Invalid SIP Header. Illegal chars in header name","secondary_message":"The header you passed has characters not allowed in SIP.","product":null},{"code":50325,"message":"Programmable Chat: Invalid channel webhook filter","secondary_message":"Request does not contain correctly formatted parameter for webhook filter","product":"Programmable Chat"},{"code":21232,"message":"Invalid Domain","secondary_message":"The domain name requested is invalid, already in use or a subdomain of a domain you do not control.  Please see the response body for more details.","product":null},{"code":11206,"message":"HTTP protocol violation","secondary_message":"There was an error speaking HTTP to the target URL.","product":null},{"code":91202,"message":"Not Found","secondary_message":null,"product":null},{"code":51103,"message":"Twilsock: Token doesn\'t contain required grants section","secondary_message":"No grants section is specified in the token and grants section is required.","product":null},{"code":80908,"message":"Callback Error","secondary_message":"Error on Callback for http://www.yourdomain.com/callback","product":null},{"code":80601,"message":"Phone Number Not Available","secondary_message":"PhoneNumber is not available.  It may be bound to a number pool.","product":null},{"code":13710,"message":"Redirect: Invalid method value","secondary_message":"The method attribute of Number must be GET or POST. See the <a href=\'/docs/api/twiml/redirect#method\'>Redirect Verb</a> API Reference for more information.","product":null},{"code":23001,"message":"Message Redaction Incompatible Configuration: Long code STOP filtering","secondary_message":null,"product":"Programmable SMS"},{"code":14104,"message":"Invalid Method attribute","secondary_message":"method attribute may only be \\"GET\\" or \\"POST\\"","product":null},{"code":50404,"message":"Programmable Chat: Member already exists","secondary_message":"Member with specified Identity already exists in this Channel","product":"Programmable Chat"},{"code":80402,"message":"Identifier Proxy Pair Invalid","secondary_message":"Invalid Identifier and Proxy Identifier pair","product":null},{"code":90020,"message":"One of \'TemplateArgs\' dictionary key is blank","secondary_message":null,"product":null},{"code":21221,"message":"Invalid SipAuthUsername. Must be fewer than 256 chars","secondary_message":"The SipAuthUsername you specified was longer than 255 characters.","product":null},{"code":20001,"message":"Unknown parameters","secondary_message":"One or more parameters you sent the REST API were not recognized and were ignored.  No harm done, but make sure that you didn\'t mis-type the parameter you really wanted to send.","product":null},{"code":90028,"message":"Broadcast \'IdempotencyToken\' is too long","secondary_message":null,"product":null},{"code":13512,"message":"Gather element has an invalid \\"lang\\" parameter","secondary_message":"A Gather element cannot have a \\"lang\\" parameter setting","product":null},{"code":30014,"message":"\'To\' attributes are Invalid","secondary_message":null,"product":null},{"code":21100,"message":"Accounts Resource","secondary_message":"Errors related to the Accounts resource","product":null},{"code":50323,"message":"Programmable Chat: Invalid channel webhook sid","secondary_message":"Request does not contain correctly formatted parameter for channel webhook sid","product":"Programmable Chat"},{"code":21476,"message":"Unable to update Status for subaccount, parent account is suspended.","secondary_message":"Unable to update Status for subaccount, parent account is suspended.  The account needs to be in good standing to continue using the subaccount feature.","product":null},{"code":50063,"message":"Programmable Chat: Actions per second limit exceeded","secondary_message":"Service instance actions per second limit exceeded","product":"Programmable Chat"},{"code":20426,"message":"Upgrade Required","secondary_message":"The server refuses to perform the request using the current protocol but might be willing to do so after the client upgrades to a different protocol.","product":null},{"code":90033,"message":"Broadcast recipient\'s \'to\' is too long","secondary_message":null,"product":null},{"code":20009,"message":"Cannot delete this resource before it is complete","secondary_message":null,"product":null},{"code":94302,"message":"Transcriptions Configurations: UniqueName is invalid","secondary_message":null,"product":null},{"code":13613,"message":"Record: Invalid finishOnKey value","secondary_message":"The value of the finishOnKey attribute must be one of the following characters \\"0123456789#*\\".  See the <a href=\'/docs/api/twiml/record#maxLength\'>Record Verb</a> API Reference for more information.","product":null},{"code":11210,"message":"HTTP bad host name","secondary_message":null,"product":null},{"code":21219,"message":"\'To\' phone number not verified","secondary_message":"You attempted to initiate an outbound phone call from a trial account, but the \'To\' number you specified is not a verified number for your account. In order to make calls during a free trial, you must first verify your ownership of the phone number being called.  You can verify phone numbers from the [phone numbers section](/user/account/phone-numbers) of your account portal.","product":null},{"code":21404,"message":"Inbound Phone number not available to trial account","secondary_message":"You attempted to get a phone number using the REST API, but your Twilio Free Trial Account does not support having your own phone number.  Please upgrade to a Full Twilio Account in order to enable this feature.","product":null},{"code":21622,"message":"MMS has not been enabled for your account","secondary_message":"Your account has not been enabled for picture messaging. Please contact support to send picture messages.","product":null},{"code":61002,"message":"Add-ons: Provider could not complete request","secondary_message":"The Add-on Provider  provided a HTTP Status Code in the 500 range. This indicates an error processing the Add-on Request on the Vendors side.","product":null},{"code":20008,"message":"Test Credentials","secondary_message":"Currently only a handful of API resources can be tested with your test credentials. Trying to authenticate with your test credentials to other resources will return a Forbidden error message. For a full list of supported resources, please see our [Test Credentials](/docs/api/rest/test-credentials) page.","product":null},{"code":51115,"message":"Twilsock: Invalid access token subject","secondary_message":"Subject provided in the token is invalid.","product":null},{"code":50360,"message":"Conversation webhook not found","secondary_message":"The requested webhook SID was not found.","product":"Programmable Chat"},{"code":50444,"message":"Failed to add an identity to a participant.","secondary_message":"The participant should not have an identity in order to add an identity.","product":"Programmable Chat"},{"code":61006,"message":"Add-ons: Add-ons unavailable for GET callbacks","secondary_message":"Due to the size limitations of GET callbacks we do not include Add-on results in GET callbacks","product":null},{"code":20010,"message":"Action disabled for account","secondary_message":null,"product":null},{"code":63033,"message":"Recipient blocked to receive message","secondary_message":null,"product":"Programmable SMS"},{"code":21208,"message":"Invalid Timeout","secondary_message":"You attempted to initiate an outbound phone call, but you sent an invalid <span class=\'rest-attribute\'>Timeout</span> parameter.  The timeoutspecifes how long Twilio should let the phone ring before giving up, and is useful if you want to have Twilio hangup before an answering machine picks up.  You may specify any positive, whole integer for the <span class=\'rest-attribute\'>Timeout</span> parameter.","product":null},{"code":21200,"message":"Calls Resource","secondary_message":"Errors related to the Calls resource","product":null},{"code":90023,"message":"One of \'TemplateArgs\' dictionary value is null","secondary_message":null,"product":null},{"code":90035,"message":"Broadcast \'MessageStatusCallbackUrl\' is too long","secondary_message":null,"product":null},{"code":80609,"message":"Too Many Added Participants","secondary_message":"A Session may have at most 2 participants","product":null},{"code":23003,"message":"Message Redaction Incompatible Configuration: Sticky Sender","secondary_message":null,"product":"Programmable SMS"},{"code":51124,"message":"Twilsock: Too many connections","secondary_message":"Number of connections for this account is higher than expected!","product":null},{"code":50302,"message":"Programmable Chat: Unknown channel command","secondary_message":"Specified Channel Command does not exist.","product":"Programmable Chat"},{"code":70005,"message":"Failure Threshold Exceeded","secondary_message":null,"product":null},{"code":14205,"message":"Enqueue: Queue name too long","secondary_message":"The queue name must be less than 64 characters in length.","product":null},{"code":50102,"message":"Programmable Chat: Deployment role not found","secondary_message":"Specified Deployment Role does not exist.","product":"Programmable Chat"},{"code":63010,"message":"Twilio\'s platform encountered an internal error processing this message","secondary_message":null,"product":"Programmable SMS"},{"code":50411,"message":"Participant address is empty","secondary_message":"The provided participant public address parameter must not be empty.","product":"Programmable Chat"},{"code":80408,"message":"Service Sid Invalid","secondary_message":"Invalid Service Sid","product":null},{"code":50372,"message":"Conversation webhook URL is too long","secondary_message":"The length of provided conversation webhook URL exceeds the limit.","product":"Programmable Chat"},{"code":13243,"message":"Dial->SIP: Invalid SIP URI","secondary_message":"The provided SIP URI is not formatted properly.","product":null},{"code":21238,"message":"Address Validation Error","secondary_message":"One of the parameters passed when creating or updating an Address was incorrect.","product":null},{"code":50430,"message":"Participant is not a member of conversation","secondary_message":"The requested participant is not a member of this conversation.","product":"Programmable Chat"},{"code":13320,"message":"Gather: Invalid nested verb","secondary_message":"The only valid nested elements of the Gather Verb are Say and Play. See the <a href=\'/docs/api/twiml/gather\'>Gather Verb</a> API Reference for more information.","product":null},{"code":30015,"message":"Non-supported channel type is used","secondary_message":null,"product":null},{"code":50353,"message":"Conversation with provided unique name already exists","secondary_message":null,"product":null},{"code":50000,"message":"Programmable Chat: FriendlyName not provided","secondary_message":"Request does not contain required \\"FriendlyName\\" parameter.","product":"Programmable Chat"},{"code":21458,"message":"PhoneNumber Provisioning Type Mismatch","secondary_message":"The type of a PhoneNumber (toll-free or not) did not match the type of the IncomingPhoneNumbers sub-resource (Local or TollFree).  #### Possible Causes *  Make sure to provision toll-free numbers from the IncomingPhoneNumbers/TollFree resource or directly from the IncomingPhoneNumbers/ resource. *  Make sure to provision non-toll-free numbers from the IncomingPhoneNumbers/Local resource or directly from the IncomingPhoneNumbers/ resource.","product":null},{"code":14201,"message":"Enqueue: Invalid method value","secondary_message":"The method is invalid. You must specify one of \'GET\' or \'POST\'.","product":null},{"code":63017,"message":"Rate limit exceeded","secondary_message":null,"product":"Programmable SMS"},{"code":70101,"message":"Unsupported Public Key Algorithm","secondary_message":null,"product":null},{"code":50601,"message":"Programmable Chat: Invite not found","secondary_message":"Specified Invite does not exist.","product":"Programmable Chat"},{"code":21243,"message":"Credential Validation Error","secondary_message":"One of the parameters passed when creating or updating a Credential was incorrect.  Please see the response body for more details.","product":null},{"code":51123,"message":"Twilsock: Upstream not resolved","secondary_message":"Specified upstream couldn\'t be resolved.","product":null},{"code":20023,"message":"Phone number is not correct: it cannot be null or have non-decimal symbols","secondary_message":null,"product":null},{"code":70151,"message":"Maximum Number Of API Keys Exceeded","secondary_message":null,"product":null},{"code":51002,"message":"Client Connection: Request rate limit exceeded","secondary_message":"error","product":null},{"code":80102,"message":"Participant Already In Interaction","secondary_message":"Participant has already been added to Interaction","product":null},{"code":70003,"message":"Outdated Entity","secondary_message":null,"product":null},{"code":90024,"message":"Template body has tag which is not provided in \'TemplateArgs\'","secondary_message":null,"product":null},{"code":13255,"message":"Dialing .sip.twilio.com addresses is not currently allowed","secondary_message":"At this time internal routing of SIP calls within Twilio is not supported i.e. dialing .sip.twilio.com addresses from a Twilio number.","product":null},{"code":14215,"message":"Dial->Queue: Invalid ReservationSid. Unable to dequeue","secondary_message":"Provided ReservationSid is invalid.","product":null},{"code":63026,"message":"Channel sender content flagged as spam","secondary_message":null,"product":"Programmable SMS"},{"code":14102,"message":"Invalid \\"From\\" attribute","secondary_message":"The From phone number does not appear to be a phone number that you can SMS from","product":null},{"code":50439,"message":"Account is not authorized to use the projected address","secondary_message":"Address used as Projected Address does not belong to the account.","product":"Programmable Chat"},{"code":12200,"message":"Schema validation warning","secondary_message":"The provided XML does not conform to the Twilio Markup XML schema.  Please refer to the specific error and correct the problem.","product":null},{"code":23006,"message":"Message Redaction Incompatible Configuration: Inbound Webhook GET Requests","secondary_message":null,"product":"Programmable SMS"},{"code":50510,"message":"Invalid message media SID","secondary_message":"An invalid multimedia attachment SID was supplied for this message.","product":"Programmable Chat"},{"code":21714,"message":"Messaging Service Number Pool size limit reached","secondary_message":null,"product":"Programmable SMS"},{"code":80907,"message":"Open Interaction Not Found","secondary_message":"Received a call with no open interaction","product":null},{"code":50347,"message":"Parameters are missing for channel update request","secondary_message":"There are no parameters specified in this channel update request.","product":"Programmable Chat"},{"code":61009,"message":"Add-ons: Could not fulfill request with available data","secondary_message":" One of the request fields in the Add-ons specification could not be interpolated with the provided data. The result is an invalid URL, Header value or other parameter that makes the request impossible to execute.","product":null},{"code":50210,"message":"Programmable Chat: Invalid notification level","secondary_message":"Request contains unknown notification level value","product":"Programmable Chat"},{"code":35120,"message":"OptimizeStartAt can only be used when ScheduleType is \'optimize\'","secondary_message":null,"product":"Programmable SMS"},{"code":30004,"message":"Message blocked","secondary_message":"The destination number you are trying to reach is blocked from receiving this message.","product":"Programmable SMS"},{"code":20006,"message":"Access Denied","secondary_message":"You don\'t have sufficient privileges to access the requested resource. The user on whose behalf you are attempting to access the API may have revoked your privileges, or you may need to request greater privileges from the user.","product":null},{"code":50501,"message":"Programmable Chat: Message SID not provided","secondary_message":"Request does not contain required Message SID parameter.","product":"Programmable Chat"},{"code":63037,"message":"Channel Media Upload Error","secondary_message":null,"product":"Programmable SMS"},{"code":21715,"message":"Phone Number Does Not Have Correct Messaging Service Capabilities","secondary_message":null,"product":"Programmable SMS"},{"code":14110,"message":"Invalid Verb for SMS Reply","secondary_message":"An Invalid Verb has been passed back in an SMS reply.  Valid Verbs are Sms and Redirect","product":null},{"code":63039,"message":"Warning! Facebook says your page is engaging in behavior that may be considered bothersome or abusive by users. To avoid messaging restrictions being placed on your Page, Facebook requires you to immediately decrease the rate at which you are sending messages outside the 24-hour window to this person.","secondary_message":null,"product":"Programmable SMS"},{"code":50001,"message":"Programmable Chat: Account SID not provided","secondary_message":"Request does not contain required Account SID parameter.","product":"Programmable Chat"},{"code":80104,"message":"Phone Number Already In Service","secondary_message":"PhoneNumber has already been added to Service","product":null},{"code":11215,"message":"HTTP too many redirects","secondary_message":"this request has been redirected too many times and may be in a loop.","product":null},{"code":14210,"message":"Dial->Queue: Invalid whisper method","secondary_message":"The whisper method is invalid. You must specify one of \'GET\' or \'POST\'.","product":null},{"code":21205,"message":"Invalid URL","secondary_message":"You attempted to initiate an outbound phone call, but the URL you specified to handle the call was not a valid URL.","product":null},{"code":50505,"message":"Programmable Chat: Last Updated By parameter is too long","secondary_message":"Last Updated By parameter is too long","product":"Programmable Chat"},{"code":19036,"message":"Invalid page token","secondary_message":null,"product":null},{"code":70154,"message":"Public Key Is Invalid","secondary_message":null,"product":null},{"code":50365,"message":"Invalid conversation webhook filter","secondary_message":"An invalid conversation webhook filter was supplied.","product":"Programmable Chat"},{"code":14103,"message":"Invalid Body","secondary_message":"The SMS body does not contain valid text","product":null},{"code":13201,"message":"Dial: Cannot Dial out from a Dial Call Segment","secondary_message":"TwiML documents that execute on the called party\'s end (via the Dial->Number url attribute, before the parties are bridged) cannot issue a new Dial.","product":null},{"code":30106,"message":"Domain has not been setup for click tracking","secondary_message":"Domain has not been setup for click tracking","product":"Programmable SMS"},{"code":13311,"message":"Gather: Invalid finishOnKey value","secondary_message":"The value of the finishOnKey attribute must be a single character. See the <a href=\'/docs/api/twiml/gather#finishOnKey\'>Gather Verb</a> API Reference for more information.","product":null},{"code":11240,"message":"HTTP connection edge location is invalid","secondary_message":null,"product":null},{"code":11220,"message":"SSL/TLS Handshake Error","secondary_message":"During SSL/TLS negotiation, Twilio experienced a connection reset.","product":null},{"code":35115,"message":"Scheduling does not support this timestamp","secondary_message":null,"product":"Programmable SMS"},{"code":21470,"message":"Invalid AccountSid","secondary_message":"The AccountSid you specified was not a valid AccountSid identifier.  AccountSid\'s are 34 character strings that represent the Twilio Account .  For example, AC44CE4123947237834573457345347567.","product":null},{"code":19020,"message":"Contact with the provided channel value already exists","secondary_message":null,"product":null},{"code":30013,"message":"TTL is too big","secondary_message":"Message Time To Live is too big","product":null},{"code":30018,"message":"Destination carrier requires sender ID pre-registration","secondary_message":null,"product":"Programmable SMS"},{"code":51101,"message":"Twilsock: Service instance not found","secondary_message":"Service instance specified in the request does not exist.","product":null},{"code":50301,"message":"Programmable Chat: Channel key not provided","secondary_message":"Request does not contain required Channel SID or Channel\'s Unique Name parameters.","product":"Programmable Chat"},{"code":50385,"message":"Conversations are disabled in this region","secondary_message":"Conversations API is not supported in this Twilio region","product":"Programmable Chat"},{"code":51117,"message":"Twilsock: Invalid access token signature","secondary_message":"The token has an invalid signature.","product":null},{"code":21617,"message":"The concatenated message body exceeds the 1600 character limit","secondary_message":"The maximum allowable body text length is generally 1600 characters, but some glyphs such as Emoji, Emoticons or other special characters will be counted as multiple characters.","product":null},{"code":30101,"message":"Domain is unverified","secondary_message":"The domain specified by the Domain SID in use has not been verified and configured to work with Click Tracking.","product":"Programmable SMS"},{"code":90040,"message":"Broadcast \'MediaUrls\' list has too many items","secondary_message":null,"product":null},{"code":63014,"message":"Channel message blocked by user action","secondary_message":null,"product":"Programmable SMS"},{"code":90021,"message":"One of \'TemplateArgs\' dictionary key is too long","secondary_message":null,"product":null},{"code":80401,"message":"Account Sid Invalid","secondary_message":"Invalid Account Sid","product":null},{"code":13325,"message":"Gather->Play: Invalid Content-Type","secondary_message":"Play requires an audio Content-Type","product":null}]')},775:function(e,t,a){},888:function(e,t){},890:function(e,t){},901:function(e,t){},903:function(e,t){},931:function(e,t){},933:function(e,t){},934:function(e,t){},939:function(e,t){},941:function(e,t){},947:function(e,t){},949:function(e,t){},968:function(e,t){},980:function(e,t){},983:function(e,t){}},[[1e3,1,2]]]);
//# sourceMappingURL=main.d142ed42.chunk.js.map