var datefieldName,tkvajaxEdit=!1,tkvDetailsView=0,tkvMoreAction=0,size=0,showCacheObjtkv={},iskvFollowupTask=!1,iskvFollowupEdit=!1,ActivityMoreInfoContent="",TaskKanbanView={showEditClose:function(e){$("#div"+e).removeClass("hide")},hideEditClose:function(e){$("#div"+e).addClass("hide")},deleteEntity:function(e,t,a){var r="&deletemodule="+e+"&deleteEntityID="+t+"&action=deleteEntity";$("#recordid_"+t),$("#recordid_"+t).next();(r={}).id=t,r.module=e,r.iskanbanview="true",r.action="deleteEntity",r.crmcsrfparam=csrfToken;var i=networkUtils.constructUrl(Crm.getCrmBasePath()+"/TaskKanbanView.do",r);i=Crm.getCrmBasePath()+"/TaskKanbanView.do";var o="id="+t+"&module="+e+"&iskanbanview=true&action=deleteEntity&deleteEntityID="+t+"&isajax=true&crmcsrfparam="+csrfToken;httphandle.open("POST",i,!0),httphandle.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),httphandle.onreadystatechange=function(){if(4==httphandle.readyState){hideAnimatePopup("deletepopup");var e=httphandle.responseText;if(200==httphandle.status)if(e.indexOf("SECURITY::::")>-1){var a=e.split("SECURITY::::");divObj=getObj("ShowCustomViewDetails"),$(divObj).empty(),divObj.innerHTML=a[1]}else if(e.indexOf("DELETE::::")>-1){var r=e.split("DELETE::::");divObj=getObj("ShowCustomViewDetails"),$(divObj).empty(),divObj.innerHTML=r[1]}else if(e.indexOf("ASSOCIATED_PRODUCT_DEL_ERROR::::")>-1){r=e.split("ASSOCIATED_PRODUCT_DEL_ERROR::::");divObj=getObj("ShowCustomViewDetails"),$(divObj).empty(),divObj.innerHTML=r[1]}else{if(tkvMoreAction=0,$("#entitypopup").html(""),$("#tkventityDetails").html(""),0!==$("#recordid_"+t).next().length){var i=$("#recordid_"+t).next().attr("id");document.getElementById(i).click()}else if(0!==$("#recordid_"+t).prev().length){i=$("#recordid_"+t).prev().attr("id");document.getElementById(i).click()}else taskDetailsview.listAnimation("close");parentid=$("#recordid_"+t).parent().attr("id"),type=$("#recordid_"+t).parent().attr("id").split("_")[0]+"_inner_div",$("#recordid_"+t).remove(),0===$("#"+parentid).find("li").length&&$("#"+type).find("#norecordmsg").removeClass("hide")}else if(401==httphandle.status)return void renderingUtils.displayPermissionDenied(httphandle)}},httphandle.send(o)},viewEntity:function(e){showHideDetail(),$("#kanbanTaskDetailctn").scrollTop(0),document.getElementById("kvfieldvalue_Subject").scrollIntoView("true")},getentitypopup:function(e){document,getElemById("cvEditSave")&&document,"none"===getElemById("cvEditSave").style.display&&($("#cvparentspan1").addClass("hide"),listIndex=$(e).closest("li").index(),$(".leftContainerctn ul li .tkvPriority").removeClass("active"),targetID=$(e).closest("li").attr("id"),highlightID=$("#"+targetID).closest("li").find(".tkvPriority").attr("id"),"Call Duration"!==highlightID&&"End DateTime"!==highlightID&&$("#"+targetID).closest("li").find(".tkvPriority").addClass("active"),$(".leftContainerctn ul li").removeClass("ligraybackground").find(".rightbln").hide(),$(e).closest("li").addClass("ligraybackground"))},toggleTKView:function(){$("#tkvactive").hasClass("hide")?($("#tkvinactive").addClass("hide"),$("#tkvactive").removeClass("hide"),$("#iskanbanview").val("true"),TaskKanbanView.iskanbanview=0):($("#tkvinactive").removeClass("hide"),$("#tkvactive").addClass("hide"),$("#iskanbanview").val("false"))},setperfectScrollPopUp:function(){setTimeout((function(){initPerfectScroll()}),500)},setkanbanTaskHt:function(){var e="",t="",a=$("#taskKanbanViewContainer"),r=$(".centerContainerfooter"),i=a.height();if(null!=i){var o=$("#kanbanTaskDetailctn"),s=$(".kanbanTaskDetailRightContainer"),n=$("#kanbanTaskDetailRightCtn");t=s.height();e=a.outerHeight()-r.outerHeight();o.height(e),n.height(t)}else a.addClass("kanbanDetailview_rewamp")},initPerfectScroll:function(){setkanbanTaskHt(),$("#kanbanTaskDetailctn").removeClass("overflhidden"),thirdPartyUtils.bindPerfectScroll("#kanbanTaskDetailctn",{wheelSpeed:1,wheelPropagation:!0,suppressScrollX:!1}),$("#kanbanTaskDetailctn").addClass("overflhidden"),$("#kanbanTaskDetailRightCtn").removeClass("overflhidden"),thirdPartyUtils.bindPerfectScroll("#kanbanTaskDetailRightCtn",{wheelSpeed:1,wheelPropagation:!0,suppressScrollX:!1}),$("#kanbanTaskDetailRightCtn").addClass("overflhidden")},setlayoutHt:function(e){$("#spacerDiv_Btm").hide();var t=$("#taskKanbanViewContainer");if(t.length){var a=renderingUtils.windowHeight,r=t.offset().top;setTaskBoxHt1=a-(r+32),t.css("height",setTaskBoxHt1),$(".kvtlistbgheader").height(setTaskBoxHt1-11),$(e).each((function(){getScrollparentEl=$(this).closest(".innerdivCtn").attr("id"),scrollEl=$(this).attr("id"),document.getElementById(scrollEl).scrollHeight=document.getElementById(getScrollparentEl).scrollHeight;var e="#"+scrollEl;thirdPartyUtils.bindPerfectScrollUpdate(e)})),Crm.userDetails.detailView_newUI,$(e).outerHeight(setTaskBoxHt1-72),TaskKanbanView.setKvDetailslayout(setTaskBoxHt1)}$("#cvlist").length&&!$("#cvlist").hasClass("noPerfectScroll")&&thirdPartyUtils.bindPerfectScroll("#cvlist",{wheelSpeed:1})},socialHover:function(e){$(e).find(".stkv").addClass("active")},socialHoverOut:function(e){$(e).find(".stkv").removeClass("active")},closePopup:function(e){$("#"+e).addClass("hide"),$(".freezeLayer,.freezeLayerkv").addClass("hide"),"mailcompose"===e?$("#"+e).html(""):($(".mailConversationList").css("background","#ffffff"),$(".mailConversationList .tkvMailBubble").addClass("hide"),$(".thread td em").css("color","#7a7a7a")),$(".mailDetailFreeze").addClass("hide")},newshowHideoptions:function(e,t){$(e).hasClass("newStyleClose")?($(e).closest(".tempClose").addClass("hide"),$("#"+t).removeClass("hide"),taskDetailsview.selectAutoFocus()):($(e).addClass("hide"),$("#"+t).removeClass("hide")),void 0!==t&&"ceAddtemplate"===t&&emptyTemplate()},setCalenderScroll:function(e,t){void 0!==(t=t)&&$("#"+e).on("scroll",(function(){if(void 0!==$("#Calendar"))if($("#Calendar").css("top",parseInt(t.replace("px",""))-$("#"+e).scrollTop()+"px"),parseInt($("#Calendar").css("top").replace("px",""))<=129)$("#Calendar").css("display","none");else{var a=document.getElementById("textbox_Due Date");void 0!==a&&"none"!==a.parentNode.style.display&&$("#Calendar").css("display","block")}}))},resetRightBox:function(e,t){pageWidthReset=$("#kventitydetailspage").width()/3,$(".kanbanTaskDetailCenterContainer").css({width:Math.round(2*pageWidthReset)+"px"}),$(".kanbanTaskDetailRightContainer").css({width:Math.round(pageWidthReset)+"px"})}};function taskDetails(){}function taskDetailsview(){}TaskKanbanView.changeowner=0,TaskKanbanView.mailconvtitle=!0,TaskKanbanView.editperm=!0,TaskKanbanView.entityId=0,TaskKanbanView.tkvListWidth="",TaskKanbanView.KvListItemClickCount=0,TaskKanbanView.kvrecordid=0,TaskKanbanView.centerCtnWidthBefore="",TaskKanbanView.centerCtnWidthAfter="",TaskKanbanView.noteId="",TaskKanbanView.noteEdit=0,TaskKanbanView.setKvDetailslayout=function(e){var t=$("#taskKanbanViewContainer");TaskKanbanView.tkvListWidth=(t.outerWidth()-25)/4;var a=$(".kvtlistbgheader"),r=$(".kvtlistbgheader .kvtlistbg"),i=renderingUtils.windowWidth-350;if(0===TaskKanbanView.KvListItemClickCount?(r.css("width",TaskKanbanView.tkvListWidth-8+"px"),a.outerWidth(TaskKanbanView.tkvListWidth-7),$(".kanbanList_activities").width(TaskKanbanView.tkvListWidth-21),$("#kventitydetailspage").css({width:i-3,height:e+"px",left:$("#taskKanbanViewContainer").outerWidth()+12+"px"}),$("#cvEditSave").css({width:3*$(".kvtlistbgheader").outerWidth()+6+"px",height:e+"px"})):(1===$(".leftheaderBack:visible").length&&(i=renderingUtils.windowWidth-351),$("#kventitydetailspage").css({width:i-1,height:e+"px",left:$("#taskKanbanViewContainer").outerWidth()+12+"px"}),$("#cvEditSave").css("height",e+"px"),title=$(".editCVtitle").outerHeight()+$(".editCVfooter").outerHeight(),$("#cvEditSave").find(".preHTMLContainer").height($("#cvEditSave").height()-(title+30)),r.css("width",TaskKanbanView.tkvListWidth-4+"px")),a.length>1){if(1===$(".leftheaderBack:visible").length){t.addClass("kanbanDetailview_rewamp");var o=$(".kanbanDetailview_rewamp").find(".leftContainerctn");TaskKanbanView.tkvListWidth=350,thirdPartyUtils.bindPerfectScroll(o),o.css("height",e-49)}else $(".kanban_activities_rewamp").removeClass("kanbanDetailview_rewamp");"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()&&$(".notasks").addClass("notask_crmplus")}else{$(".kanban_activities_rewamp").addClass("kanbanDetailview_rewamp");o=$(".kanbanDetailview_rewamp").find(".leftContainerctn");a.outerWidth(TaskKanbanView.tkvListWidth-5),a.height(e),TaskKanbanView.tkvListWidth=350,r.css("width",TaskKanbanView.tkvListWidth-5+"px"),thirdPartyUtils.bindPerfectScroll(o),o.css("height",e-49)}},TaskKanbanView.centerAnimation=function(e,t){$("."+t).width($("."+t).width()),$("."+e).width($("."+e).width()),""===TaskKanbanView.centerCtnWidthBefore&&(TaskKanbanView.centerCtnWidthBefore=$("."+e).width(),TaskKanbanView.centerCtnWidthAfter=$("."+e).width()+$("."+t).width()),0===TaskKanbanView.KvCenterItem?$("."+e).animate({width:TaskKanbanView.centerCtnWidthAfter+2+"px"},200,(function(){TaskKanbanView.KvCenterItem=1,$(".expandView").addClass("collapseView"),$("#fullInfoDiv table.twoColumn td.label").css("width","150px")})):$("."+e).animate({width:TaskKanbanView.centerCtnWidthBefore+"px"},200,(function(){TaskKanbanView.KvCenterItem=0,$(".expandView").removeClass("collapseView"),$("#fullInfoDiv table.twoColumn td.label").css("width","25%")}))},taskDetails.toggleaddaction=function(){taskDetailsview.SlideUpDown("addAttachmentCtnNew",-$("#addAttachmentCtnNew").outerHeight()),$("#addactionmain").addClass("hide"),$("#FreezeLayer2").addClass("hide")},taskDetails.addHighlight=function(e){$(".footLink").removeClass("hilightLink"),$(e).addClass("hilightLink")},taskDetails.alignQCreate=function(e){var t=$("#qCreate").html();$("#qCreate").html(""),showCacheObj.qCreateHtml=t,$("#addactionmain").html(""),$("#addactionmain").html($("<div>",{class:"qCreate",id:"qCreate",html:t})),$("#addactionmain").removeClass("hide"),$("#addactionmain,#qCreate").height($(".qcontainer").height()),centerContainerfooterbottom=$(".centerContainerfooter").height()+34,centerContainerfooterLeft=$(e).offset().left,$("#addactionmain").css({left:centerContainerfooterLeft+"px",bottom:centerContainerfooterbottom-21+"px"})},taskDetails.Close=function(){$("#addactionmain").addClass("hide"),$("#FreezeLayer2").addClass("hide"),$(".footLink").removeClass("hilightLink"),removeFreezeLayer()},taskDetailsview.selectAction=function(e,t,a,r,i,o,s,n){renderingUtils.ShakeDivInfreeze("qCreate","left",20,100);var l="",d=i;d&&"rp"===i&&(i=void 0);var c,u,m=getObj("pmrlstact_d");m&&(m.style.display="none"),c=(u=$("input[name=relmodule]")).length?u.val():getObj("property(module)")?getObj("property(module)").value:getObj("module").value;var p=document.getElementById("entityid")?document.getElementById("entityid").value:null,h=document.getElementById("modid")?document.getElementById("modid").value:null,f=document.getElementById("modsel")?document.getElementById("modsel").value:null,v=document.getElementById("modname1")?document.getElementById("modname1").value:null;if("NewTask"===e){"recentMailView"===i&&(p=r,c=a,showLoadingImage="false");var g=Crm.getCrmBasePath()+"/QCreate.do?module=Tasks&id="+p+"&relmodule="+c+"&returnAnchor="+t+"&primmodule="+a+"&entityid="+r+"&iskanbanview=true&modid="+h+"&modsel="+f+"&modname="+encodeURIComponent(v);if(document.getElementById("cvid"))g=g+"&cvid="+document.getElementById("cvid").value;getObj("recordNum")&&(g=g+"&recordNum="+getObj("recordNum").value)}else if("BulkTask"===e){var C=getIdsAndNames();g="";o&&"undefined"!==o?(i="zcampaignView",l="secmod="+s+"&bulkCreate=bulkTask&actType=Tasks&idlist="+C.idList+"&namelist="+encodeURIComponent(C.nameList),g=Crm.getCrmBasePath()+"/QCreate.do?module=Tasks"):(i="ListView",l="secmod="+getObj("module").value+"&bulkCreate=bulkTask&actType=Tasks&idlist="+C.idList+"&namelist="+encodeURIComponent(C.nameList),g=Crm.getCrmBasePath()+"/QCreate.do?module=Tasks&cvid="+getObj("cvid").value)}else if("NewEvent"===e){var b="";d&&"rp"===d?b="&createdFrom=rightPanel":"RelatedList"===i&&(b="&createdFrom=relList");g=Crm.getCrmBasePath()+"/QCreate.do?module=Events&id="+p+b+"&relmodule="+c+"&returnAnchor="+t+"&primmodule="+a+"&entityid="+r+"&iskanbanview=true&modid="+h+"&modsel="+f+"&modname="+v}else if("NewCall"===e){var y=t;g=Crm.getCrmBasePath()+"/QCreate.do?module=Calls&id="+p+"&relmodule="+c+"&returnAnchor="+y+"&primmodule="+a+"&entityid="+r+"&iskanbanview=true&modid="+h+"&modsel="+f+"&modname="+encodeURIComponent(v)}Q.url=g,Q.anchor=t,Q.operation=e,Q.callFrom=i,l=l+"&crmcsrfparam="+csrfToken,taskDetailsview.mR(g+"&fromCreate=QuickCreate",Q.loadResponse,l,void 0,!0,!0,n)},taskDetailsview.mR=function(e,t,a,r,i,o,s){document.getElementById("ajax_load_tab")&&"false"!==i&&commonUtils.showHideLoadingDiv(!0);var n=void 0===o;jQuery.ajax({type:"POST",url:e,data:a,async:n,success:function(e){taskDetails.alignQCreate(s),"false"!==i&&commonUtils.showHideLoadingDiv(),t(e)}})};var globalfieldlabel="";taskDetailsview.Callonclickofbutton=function(e,t,a,r,i,o,s,n,l,d,c,u){void 0===c&&(c=document.getElementById("entityId").value);var m="";if(httphandle){if(786===n||14===n||333===n)dateid=t.substring(0,t.indexOf("*")),timeid=t.substring(t.indexOf("*")+1),dtime="textbox_"+i,htime="property("+i+"hour)",mtime="property("+i+"minute)","HH:mm"!==Crm.userDetails.TIME_FORMAT&&(atime="property("+i+"ampm)"),0!==document.getElementById(dtime).value.trim().length&&(m="HH:mm"!==Crm.userDetails.TIME_FORMAT?document.getElementById(dtime).value.trim()+" "+document.getElementById(htime).value.trim()+":"+document.getElementById(mtime).value.trim()+" "+document.getElementById(atime).value.trim():document.getElementById(dtime).value.trim()+" "+document.getElementById(htime).value.trim()+":"+document.getElementById(mtime).value.trim()),subs1="property("+i+"subs1)";else if(100===n)for(var p=0,h=0;h<getObj("comboValue"+comboCount).length;h++)!0===getObj("comboValue"+comboCount).options[h].selected?(m=0===p?getObj("comboValue"+comboCount).options[h].value:m+";"+getObj("comboValue"+comboCount).options[h].value,p++):0===p&&(m="");else if(300===n||301===n)m=getObj(globaltextboxpanid).checked;else{if("Priority"===i||"Status"===i||"Call Type"===i){var f=TaskKanbanView.pickfieldid;el=document.getElementById(i+"_"+f),m=$(el).html().trim(),m=$("<div/>").html(m).text()}else m="Venue"===i||"Due Date"===i||"Subject"===i?document.getElementById("textbox_"+i).value.trim():document.getElementById(t).innerHTML.trim();"string"==typeof m&&(m=m.trim())}if("TWITTER"===d&&("Contacts"===o||"Leads"===o)){if(m.trim().length>50)return alert(I18n.getMsg("crm.tw.err.max.twHandleName",I18n.getMsg(singularModule))),!1;if(m.trim().length<50&&m.trim().length>0){if(!/^[a-zA-Z0-9_]*$/.test(m))return alert(I18n.getMsg("crm.tw.err.twHandleName.patterenCheck",I18n.getMsg(singularModule))),!1;null!==getObj("twSmallIcon")&&(getObj("twSmallIcon").className="twalreadyassociated")}else null!==getObj("twSmallIcon")&&(getObj("twSmallIcon").className="twsmallicon")}if("Cases"===o&&-1!==r.indexOf("Case Origin")){var v=getObj("textbox_Case Origin");getObj("value_Case Origin")&&getObj("value_Case Origin").innerHTML;if("Email"===(v?v.options[v.options.selectedIndex].value:"")){var g=getObj("textbox_Email")?getObj("textbox_Email").value:getObj("subvalue_Email").innerHTML;if(""===trimBoth(g))return alert(I18n.getMsg("crm.field.empty.check",I18n.getMsg("Email"))),!1}}if("Cases"===o&&null!==i&&""!==i&&"Add Comment"===i&&null!==getObj("value_No of comments")){var C=Number(getObj("value_No of comments").innerHTML)+1;$("#value_No of comments").empty(),document.getElementById("value_No of comments").innerHTML=C}if("Campaigns"===o&&"Start Date"===i&&""!==getObj("value_End Date").innerHTML&&!dateComparison("textbox_Start Date","Start Date","textbox_End Date","End Date","LE"))return!1;if("Products"===o&&"Sales Start Date"===i&&""!==getObj("value_Sales End Date").innerHTML&&!dateComparison("textbox_Sales Start Date","Sales Start Date","textbox_Sales End Date","Sales End Date","LE"))return!1;if("Call Type"!==i)if(!formValidate1(i,m,n))return void(786===n||14===n||333===n?getObj(dateid)&&getObj(dateid).focus():getObj(t).focus());if("End DateTime"===i){var b=getObj("headervaluetkv_Start DateTime").innerHTML;if(""===(k=getObj("textbox_End DateTime").value))return;var y=$("[fldlabel='End DateTime']").val();if(k.indexOf("/")>-1)var w=k.split("/");else if(k.indexOf("-")>-1)w=k.split("-");if("dd/mm/yyyy"===(D=Crm.userDetails.DATE_PATTERN.toLowerCase())?k=w[1]+"/"+w[0]+"/"+w[2]:"yyyy/mm/dd"!==D&&"yyyy-mm-dd"!==D||(k=w[1]+"/"+w[2]+"/"+w[0]),$('[fldlabel="End DateTime"]').attr("time"))var I=$('[fldlabel="End DateTime"]').attr("time").split(":")[2];else{var R=globalfieldlabel+"_ampmSpan";if(document.getElementById(R))I=document.getElementById(R).getAttribute("ampm")}if(null!=(P=I))var T=k+" "+y+" "+P;else T=k+" "+y;var _=new Date(b),E=new Date(T);if(_.getTime()>=E.getTime()){var S=I18n.getMsg("Start DateTime"),L=I18n.getMsg("End DateTime");return tkveventajax=!0,void alert(I18n.getMsg("crm.custom.field.less.than.equalto",[S,L]))}tkveventajax=!1}else if("Start DateTime"===i){var D;T=getObj("headervaluetkv_End DateTime").innerHTML;if(""===(k=getObj("textbox_Start DateTime").value))return;if(k.indexOf("/")>-1)w=k.split("/");else if(k.indexOf("-")>-1)w=k.split("-");if("dd/mm/yyyy"===(D=Crm.userDetails.DATE_PATTERN.toLowerCase()))var k=w[1]+"/"+w[0]+"/"+w[2];else if("yyyy/mm/dd"===D||"yyyy-mm-dd"===D)k=w[1]+"/"+w[2]+"/"+w[0];var P;y=$("[fldlabel='Start DateTime']").val();if($('[fldlabel="Start DateTime"]').attr("time"))I=$('[fldlabel="Start DateTime"]').attr("time").split(":")[2];else{R=globalfieldlabel+"_ampmSpan";if(document.getElementById(R))I=document.getElementById(R).getAttribute("ampm")}if(null!=(P=I))b=k+" "+y+" "+P;else b=k+" "+y;_=new Date(b),E=new Date(T);if(_.getTime()>=E.getTime()){S=I18n.getMsg("Start DateTime"),L=I18n.getMsg("End DateTime");return tkveventajax=!0,void alert(I18n.getMsg("crm.custom.field.less.than.equalto",[S,L]))}tkveventajax=!1}itsonview=!1,loadAjaxTab(""),""!==m&&(m=trim(m+"")),32===n&&(m=m.replace(/\+/g,""));var A="fieldValue="+encodeURIComponent(m)+"&module="+o+"&fieldLabel="+encodeURIComponent(i)+"&moduleid="+c+"&uitype="+n+"&tableName="+l+"&columnName="+d+"&module="+o;if("Account Name"===i&&"Accounts"!==o&&(actNameDiv=getObj("actName"),A=A+"&accountID="+actNameDiv.value),25===n&&("Leads"===o||"Contacts"===o)){var O=getObj("subvalue_"+i).text;void 0!==O&&isValidEmail(O)||(O=""),A=A+"&oldEmailId="+encodeURIComponent(O)}if(A=A+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),httphandle.open("POST",e,!0),httphandle.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),httphandle.onreadystatechange=function(){if(4===httphandle.readyState){if(200===httphandle.status){var t=httphandle.responseText;if(t.indexOf("SECURITY::::")>-1){var l=t.split("SECURITY::::");return $("#show").empty(),void(getObj("show").innerHTML=l[1])}if(t.indexOf("NOT UNIQUE:::")>-1){l=t.split("NOT UNIQUE:::");return document.getElementById("unique").style.display="",$("#unique").empty(),document.getElementById("unique").innerHTML=l[1],commonUtils.showHideLoadingDiv(),void(itsonview=!0)}document.getElementById("unique").style.display="none";var d,p,h,f="",v="",g="",C="",y="";if("string"==typeof t)f=(h=t.split("AJAX::::"))[1].trim(),v=h[2],"Cases"===o&&"Add Comment"===i||(v=revertSplChrs(v)),d=h[3].trim(),recentContents=h[4].trim(),p=h[5].trim(),k=h[6],uiFormulaVals=h[7].trim(),g=h[8].trim(),C=h[9].trim(),y=h[14].trim(),salCycDur=h[10].trim(),overAllSalDur=h[11].trim();else{if("DUPLICATE"===resp.STATUS)return void displayUniqueFieldDuplicateError(resp,resp.INFO[0].COLUMNNAME,o);f=(h=t).isSuccess.trim(),v=h.outputValue,"Cases"===o&&"Add Comment"===i||(v=revertSplChrs(v)),d=h.isRecentItems.trim(),recentContents=null!=h.recentContents?h.recentContents.trim():"",p=h.modifiedby.trim(),k=null!=h.eventdate?h.eventdate:"",uiFormulaVals=null!=h.uiFormulaUpdateVals?h.uiFormulaUpdateVals.trim():"",g=null!=h.actualValue?h.actualValue.trim():"",C=null!=h.ExpectedRevenue?h.ExpectedRevenue.trim():"",y=null!=h.closedTime?h.closedTime.trim():"",salCycDur=null!=h.salesCycleDuration?h.salesCycleDuration.trim():"",overAllSalDur=null!=h.overAllSalesDuration?h.overAllSalesDuration.trim():""}786!==n&&14!==n&&333!==n||document.getElementById(subs1)&&(document.getElementById(subs1).value=k);for(var w=uiFormulaVals.split("||"),I=0;I<w.length;I++){var R=w[I].split("##"),_=R[0],E=R[1];getObj("value_"+_)&&($(getObj("value_"+_)).empty(),getObj("value_"+_).innerHTML=E)}if("true"===f){if(divObj=getObj(a),-1===getObj(a).id.indexOf("header")?(objid="header"+a,getObj(objid)?anotherdivObj=getObj(objid):anotherdivObj=divObj):(objid=a.replace("header",""),anotherdivObj=getObj(objid)),25===n){var S="";S=' <a class="link" href="mailto:'+m+'" id="'+s+'"/>'+v+"</a>",$(divObj).empty(),divObj.innerHTML=S,S=changeSubValueId(S,[divObj,anotherdivObj]),$(anotherdivObj).empty(),anotherdivObj.innerHTML=S;var L=new RegExp("CustomModule\\d+");if(("Leads"===o||"Contacts"===o||L.test(o))&&getObj("mailType")&&getObj("mailType")&&"ZMAIL"===getObj("mailType").value&&getObj("relatedPageContent")){if(getObj("zmailEmail")){var D="";if("Email"===i)""!==m&&(D=m),(P=getObj("subvalue_Secondary Email"))&&null!==P.href&&"mailto:"!==P.href&&(D=""!==D?D+","+getObj("subvalue_Secondary Email").href.replace("mailto:",""):getObj("subvalue_Secondary Email").href.replace("mailto:",""));else if("Secondary Email"===i){var P;""!==m&&(D=m),(P=getObj("subvalue_Email"))&&null!==P.href&&"mailto:"!==P.href&&(D=""!==D?getObj("subvalue_Email").href.replace("mailto:","")+","+D:getObj("subvalue_Email").href.replace("mailto:",""))}getObj("zmailEmail").value=D,""!==D&&(getObj("mailConfigType").value=D)}"undefined"!=typeof crmSocialInteraction&&crmSocialInteraction.fetchSocialRelatedList(),ZInvoice.loadRelatedList(),fetchCustomRelatedList(),loadMailListForRL(o)}}else if(300===n||301===n){var A,O;yesID="yes_"+i,noID="no_"+i,"true"===v?(A=getObj(yesID),O=getObj(noID)):(A=getObj(noID),O=getObj(yesID)),A.length?($.each(A,(function(e,t){t.style.display="block"})),$.each(O,(function(e,t){t.style.display="none"}))):(A.style.display="block",O.style.display="none")}else if(21===n||22===n){S="";if(21===n)S=0===m.toLowerCase().indexOf("http")?' <a class="link" href="'+m+'" target="_blank"  id="'+s+'"/>'+v+"</a>":' <a class="link" href="//'+m+'" target="_blank"  id="'+s+'"/>'+v+"</a>";else if(m.trim().length>0){var M={screen_name:m,mode:"get_twitter_name"};(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/socialIntegration.do",data:M,async:!1,success:function(e){if(null!==e&&"null"!==e&&e.trim().length>0){S='<a class="link" href="'+RebrandLinkUtil.getProperty("TW_URL")+"/"+e+'" target="_blank"  id="'+s+'">'+v+"</a>"}else S='<span id="'+s+'">'+v+"</span>"}})}else S=' <span id="'+s+'">'+v+"</span>";$(divObj).empty(),divObj.innerHTML=S,S=changeSubValueId(S,[divObj,anotherdivObj]),$(anotherdivObj).empty(),anotherdivObj.innerHTML=S}else if(33===n){$(divObj).empty(),$(anotherdivObj).empty();S="";if(!(m=0===(m=replace4Skype(m)).indexOf("+")?m.substring(1):m)||!0!==u&&"true"!==u){var F=document.createElement("SPAN");if(F.id=s,F.setAttribute("id",s),F.setAttribute("class","phoneRtl"),$(F).empty(),F.innerHTML=v,divObj.appendChild(F),divObj.id!==anotherdivObj.id){var x=document.createElement("SPAN");x.id=s,x.setAttribute("id",s.replace("subvalue_","subvalue1_")),$(x).empty(),x.innerHTML=v,anotherdivObj.appendChild(x)}S=m?"<a class='pH2 fL' title='"+I18n.getMsg("crm.phoneNo.Link.Title")+"' href='skype:+"+m+"?call' id='zti_"+s+"'></a>":""}else S="<a class='phoneRtl' title='"+I18n.getMsg("crm.phoneNo.Link.Title")+"' href='skype:+"+m+"?call' id='"+s+"'>"+v+"</a><a class='pH2 fL' id='zti_"+s+"' title='"+I18n.getMsg("crm.ZTI.Link.Title");divObj.innerHTML+=S,S=changeSubValueId(S,[divObj,anotherdivObj]),divObj.id!==anotherdivObj.id&&(anotherdivObj.innerHTML+=S)}else if(35===n){S='<span class="phoneRtl" id="'+s+'"/>'+v+"</span>";$(divObj).empty(),divObj.innerHTML=S,S=changeSubValueId(S,[divObj,anotherdivObj]),$(anotherdivObj).empty(),anotherdivObj.innerHTML=S}else if(37===n){S="";""!==m?(skypevalue=I18n.getMsg("crm.button.skypenow"),S='<a class="phoneRtl" href="skype:'+m+'" id="'+s+'">'+v+'<span class="skype dIB vam"  alt="'+skypevalue+'" title="'+skypevalue+'"></span> </a>'):S='<a class="phoneRtl" href="skype:'+m+'" id="'+s+'"/>'+v+"</a>",$(divObj).empty(),divObj.innerHTML=S,S=changeSubValueId(S,[divObj,anotherdivObj]),$(anotherdivObj).empty(),anotherdivObj.innerHTML=S}else if(4===n){var N=(H=v.split("|||"))[0],B=H[1],U="<a class='link' id='"+s+'\' data-zcqa=\'detailView\' data-cid=\'detailView\' data-params=\'{"module":"Accounts","id":"'+B+'"}\' href="'+Crm.getCrmBasePath()+"/EntityInfo.do?module=Accounts&amp;id="+B+"')\">"+N+"</a>";$(divObj).empty(),divObj.innerHTML=U,U=changeSubValueId(U,[divObj,anotherdivObj]),$(anotherdivObj).empty(),anotherdivObj.innerHTML=U}else if(36===n||143===n||145===n||144===n){$(divObj).empty(),divObj.innerHTML=v,$(anotherdivObj).empty(),anotherdivObj.innerHTML=v;var j=getObj("actualValue_"+i);j&&(j.value=g),"Amount"===i&&getObj("value_Expected Revenue")&&C&&""!==C&&($(getObj("value_Expected Revenue")).empty(),getObj("value_Expected Revenue").innerHTML=C,$("span[id='headervalue_Expected Revenue']").html(C))}else if(3===n)"Cases"===o&&"Add Comment"===i&&(v=populateCommentSection(v)),$(divObj).empty(),divObj.innerHTML=v,$(anotherdivObj).empty(),anotherdivObj.innerHTML=v;else if(26===n){var H,V="";if(1===(H=v.split(":")).length)V+=H[0];else for(J=1;J<H.length;J++)J===H.length-1?V+=H[J]:V=V+H[J]+":";if($(divObj).empty(),divObj.innerHTML=V,$(anotherdivObj).empty(),anotherdivObj.innerHTML=V,getObj("relatedPageContent")){for(var z,W=crmRelatedList.personalityArr.split("||"),q="potstagehistpersonality",J=0;J<W.length;J++){var Y=W[J].split("_");if(Y[0]===q){q=Y[0],z=Y[1];break}}if(void 0!==z){var G=Crm.getCrmBasePath()+"/NewRelatedList.do?action=getData&module="+getObj("module").value+"&id="+getObj("id").value+"&cvid="+getObj("cvid").value+"&pname="+q.toLocaleUpperCase();mR(G,(function(e){crmRelatedList.load(crmRelatedList.Module,crmRelatedList.EntityId,e)}))}}}else{var K=getObj("entity_name"),Q=o.slice(0,o.length-1);if(a==="value_"+Q+" Name"&&K&&(K.value=v),document.getElementById("iskanbanview")&&"true"===document.getElementById("iskanbanview").value&&("Call Type"===i||"Venue"===i||"Priority"===i||"Status"===i||"Due Date"===i||"End DateTime"===i||"Start DateTime"===i||"Subject"===i)){if("Due Date"===i){new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");if(v.indexOf("/")>-1)var Z=v.split("/");else if(v.indexOf("-")>-1)Z=v.split("-");var X=Crm.userDetails.DATE_PATTERN.toLowerCase();if("mm/dd/yyyy"===X)var ee=new Date(v);else if("dd/mm/yyyy"===X){var te=Z[1]+"/"+Z[0]+"/"+Z[2];ee=new Date(te)}else if("yyyy/mm/dd"===X||"yyyy-mm-dd"===X)te=Z[1]+"/"+Z[2]+"/"+Z[0],ee=new Date(te);var ae=new Date;if($.datepicker.formatDate("yyyy",ae)===$.datepicker.formatDate("yyyy",ee))var re=$.datepicker.formatDate("M dd",ee);else re=$.datepicker.formatDate("M dd, yy",ee);taskDetailsview.updaterecord(c,i,v,re)}else"End DateTime"===i||"Start DateTime"===i?(taskDetailsview.formatdatetime(b,T,c),"End DateTime"!==i&&"Start DateTime"!==i&&($(divObj).empty(),divObj.innerHTML=v),tkveventajax=!0):taskDetailsview.updaterecord(c,i,v);document.getElementById("value_"+i)&&(document.getElementById("value_"+i).innerText=v)}}if("Potentials"===o&&"Closing Date"===i&&$("#salesSummaryEnabled").length){$("#salesCycleDurationSpan").html(salCycDur),$("#overAllSalesDurationSpan").html(overAllSalDur),SalesSummaryInfo["Sales Cycle Duration"]=salCycDur,SalesSummaryInfo["Overall Sales Duration"]=overAllSalDur;var ie=$("#showSalesSummaryAlink");ie&&"none"===$("#salesSummaryEnabled").css("display")&&ie.show()}if("true"===d&&(recentDiv=getObj("h2"),recentDiv&&($(recentDiv).empty(),recentDiv.innerHTML=recentContents)),null!=getElemById("value_Modified By")&&($('[id="value_Modified By"]').html(p),$("[id='value_Modified By']").find("a").removeClass("bold")),"Tasks"==o&&"Status"==i&&""!=y&&$('[id="value_Closed Time"]').text(y),-1!==e.indexOf("/crm/v2/")&&("Leads"===o||"Contacts"===o||"Accounts"===o||"Potentials"===o)){Crm.getCrmBasePath();clearShowCacheObj("tab_"+o)}refreshFollowDiv()}else"false"===f?"Potentials"===o&&"Probability"===i?alert(I18n.getMsg("crm.create.pbty.check",I18n.getMsg(singularModule))):alert("Error:"+v):alert("Invalid response!!!!");$(getObj(r)).empty(),getObj(a).id.indexOf("header")>-1?"Start DateTime"===i||"End DateTime"===i?show("headerdisplayvalue_"+i):show(a,"inline"):"Venue"===i&&show(a)}else httphandle.status===crmConstants.errorStatusCode&&renderingUtils.displayPermissionDenied(http);httphandle.status===crmConstants.errorStatusCode&&(TaskKanbanView.editperm=!1,document.getElementById("iskanbanview")&&"true"===document.getElementById("iskanbanview").value&&(document.getElementById("headertextarea_Due Date")&&""!==document.getElementById("headertextarea_Due Date").innerHTML.trim()&&"none"===document.getElementById("headervaluetkv_Due Date").style.display&&($("#headertextarea_Due Date").empty(),document.getElementById("headervaluetkv_Due Date").style.display="inline-block"),document.getElementById("headertextarea_End DateTime")&&""!==document.getElementById("headertextarea_End DateTime").innerHTML.trim()&&($("#headertextarea_End DateTime").empty(),document.getElementById("headerdisplayvalue_End DateTime").style.display="inline"),document.getElementById("headertextarea_Call Start Time")&&""!==document.getElementById("headertextarea_Call Start Time").innerHTML.trim()&&($("#headertextarea_Call Start Time").empty(),document.getElementById("headervalue_Call Start Time").style.display="inline"),document.getElementById("headertextarea_Start DateTime")&&""!==document.getElementById("headertextarea_Start DateTime").innerHTML.trim()&&($("#headertextarea_Start DateTime").empty(),document.getElementById("headerdisplayvalue_Start DateTime").style.display="inline"))),itsonview=!1,commonUtils.showHideLoadingDiv(),fieldLabelObj=getObj(i)}},("Contacts"===o||"Leads"===o)&&"Email"===i){var M="false";null!==getObj("supportStatus")&&(M=getObj("supportStatus").value),"Enabled"===M&&getSupportLists(m,"1")}httphandle.send(A)}else alert("http does not exists")},taskDetailsview.updaterecord=function(e,t,a,r){""===a&&(r="");var i={STATUS:"Status",PRIORITY:"Priority",SUBJECT:"Subject",CALLTYPE:"Call Type",DUEDATE:"Due Date",LOCATION:"Venue",STARTDATETIME:"Start DateTime",ENDDATETIME:"End DateTime"},o=i[t]?i[t]:t;if("Priority"===o||"Status"===o||"Call Type"===o){document.getElementById("kvfieldvalue_"+o)&&($("#kvfieldvalue_"+o).empty(),document.getElementById("kvfieldvalue_"+o).innerHTML=a,$("#kvfieldvalue_"+o).attr("title",$("<div/>").html(a).text()));var s=TaskKanbanView.pickfieldid;el=document.getElementById(o+"_"+s),$(el).closest(".TaskStatusIn").find("li").removeClass("active"),targetFrmLi=$(el).closest(".TaskStatusIn"),targetFrmLi.siblings(".tasKUpdate").html($(el).html()),targetFrmLi.addClass("hide"),targetFrmLi.siblings(".pDown").removeClass("active"),document.getElementById(o+"_Id")&&(document.getElementById(o+"_Id").value=s)}else"Subject"===o?document.getElementById("headervaluetkv_"+o)&&($("#headervaluetkv_"+o).empty(),document.getElementById("headervaluetkv_"+o).innerHTML=a,$("#headervaluetkv_"+o).attr("title",$("<div/>").html(a).text()),$("#rItemDataSubDiv").find("#recentItemImg_"+e).find("div").html(a)):"Start DateTime"===o||"End DateTime"===o?document.getElementById("headerdisplayvalue_"+o)&&($("#headerdisplayvalue_"+o).empty(),document.getElementById("headerdisplayvalue_"+o).innerHTML=r):"Due Date"===o?(document.getElementById("headervaluetkv_"+o)&&($("#headervaluetkv_"+o).empty(),document.getElementById("headervaluetkv_"+o).innerHTML=a),crmCalendar.close()):"Venue"===o&&$("#headervaluetkv_"+o)&&($("#headervaluetkv_"+o).find("#venuetask").html(a),$("#headervaluetkv_"+o).find("#venuetask").attr("title",$("<div/>").html(a).text()));if("Due Date"===o){$("#recordid_"+e).find('[id="'+o+'"]')&&$("#recordid_"+e).find('[id="'+o+'"]').html(r);var n=new Date,l=new Date(a);$.datepicker.formatDate("ddMMyy",n),$.datepicker.formatDate("ddMMyy",l);if(l<n){I18n.getMsg("<fmt:message key='crm.label.no.attach.alert'/>"),n=new Date,l=new Date(a);var d=Math.round((n.getTime()-l.getTime())/864e5),c="<span class='overDueCtn'><span class='colorRed overDueTask' >"+r+"</span><span class='overdue hide' >late by "+(d+=d>1?" days":" day")+"</span></span>";$("#recordid_"+e).find("[id='"+o+"']").html(c)}}else $("#recordid_"+e).find('[id="'+o+'"]')&&($("#recordid_"+e).find('[id="'+o+'"]').html(a),$("#recordid_"+e).find('[id="'+o+'"]').attr("title",$("<div/>").html(a).text())),"Status"===o&&("Completed"===a?($("#recordid_"+e).find('[class="seperatorLine"]').hide(),$("#listViewClose_"+e).hide(),$("#completedValue").show(),$("#closeTaskTr").hide()):($("#recordid_"+e).find('[class="seperatorLine"]').show(),$("#listViewClose_"+e).show(),$("#completedValue").hide(),$("#closeTaskTr").show(),$("#completedTask").hide()));$("#upcoming")&&$("#upcoming").hasClass("liselected")&&$("#upcoming").click()},taskDetailsview.SlideUpDown=function(e,t){$("#"+e).animate({bottom:t+"px"},400,(function(){}))},taskDetailsview.formatdatetime=function(e,t,a,r){var i=Crm.userDetails.DATE_PATTERN.toUpperCase(),o=e,s=t;if(!e.getMonth&&e.indexOf(":")>-1){var n=Crm.userDetails.TIME_FORMAT;(e.indexOf("AM")>-1||e.indexOf("PM")>-1)&&(n=n.replace("a","A")),i+=" "+n,o=Utils.getDateObjFromDateStr(e,i),s=Utils.getDateObjFromDateStr(t,i)}var l=$.datepicker.formatDate("ddMMyy",o),d=$.datepicker.formatDate("ddMMyy",s),c=$.datepicker.formatDate("yy",s),u=$.datepicker.formatDate("yy",o),m="true"===$("#iskanbanview").val()?"M dd, yy":"M dd yy",p=$.datepicker.formatDate(m,o),h=$.datepicker.formatDate("M dd",o),f=$.datepicker.formatDate(m,s),v=$.datepicker.formatDate("M dd",s),g=($.datepicker.formatDate("DD M dd, yy",o),$.datepicker.formatDate("DD M dd",o),$.datepicker.formatDate("DD M dd, yy",s),$.datepicker.formatDate("DD M dd",s),$.datepicker.formatDate("mm/dd/yy",o),$.datepicker.formatDate("mm/dd/yy",s),o.getHours()),C=o.getMinutes();if("HH:mm"!==Crm.userDetails.TIME_FORMAT)var b=g>=12?"PM":"AM",y=g>=12?I18n.getMsg("PM"):I18n.getMsg("AM"),w=(g=(g%=12)||12)+":"+(C=C<10?"0"+C:C)+" "+y;else w=g+":"+(C=C<10?"0"+C:C),b=g>=12?"PM":"AM",y=g>=12?I18n.getMsg("PM"):I18n.getMsg("AM"),g=(g%=12)||12;if(g=s.getHours(),C=s.getMinutes(),"HH:mm"!==Crm.userDetails.TIME_FORMAT){b=g>=12?"PM":"AM",y=g>=12?I18n.getMsg("PM"):I18n.getMsg("AM");var I=(g=(g%=12)||12)+":"+(C=C<10?"0"+C:C)+" "+y}else{I=g+":"+(C=C<10?"0"+C:C);b=g>=12?"PM":"AM",y=g>=12?I18n.getMsg("PM"):I18n.getMsg("AM");g=(g%=12)||12}return l===d?Crm.requestParam["property(All day)"]?h:h+" "+w+" - "+I:c===u?Crm.requestParam["property(All day)"]?h+" - "+v:h+" "+w+" - "+v+" "+I:Crm.requestParam["property(All day)"]?p+" - "+f:p+" "+w+" - "+f+" "+I},taskDetailsview.setComposeWindow=function(){if(mailCtnloaded=$("#etUserDetailsWrpper").length,wH=$(window).height(),wW=$(window).width(),showH=$("#show").height(),showW=$("#show").width(),$("#mailcompose").css("width",(showW-60)/1.3),$("#mailcompose").css("height",showH-60),popW=$("#mailcompose").outerWidth(),popH=$("#mailcompose").outerHeight(),$("#mailcompose").css("left",(wW-popW)/2),$("#mailcompose").css("top","15px"),0!==mailCtnloaded)if(selectNewLook=$("#etUserDetailsWrpper .selectNewLook"),ze_area=$(".ze_area").attr("class"),void 0===ze_area)var e=setInterval((function(){ze_area=$(".ze_area").attr("class"),void 0!==ze_area&&(iframeHt=$("#mailcompose").height()-($("#etUserDetailsWrpper").outerHeight()+$("#ceContenteditOptionsCtn").outerHeight()),$("#emailEditor").removeAttr("height"),$(".ze_area").css("height",iframeHt-30),clearInterval(e))}),400);else iframeHt=$("#mailcompose").height()-($("#etUserDetailsWrpper").outerHeight()+$("#ceContenteditOptionsCtn").outerHeight()),$(".ze_area").removeAttr("height"),$(".ze_area").css("height",iframeHt-30)},taskDetailsview.addRemoveCcBcc=function(e,t){targetEl=$("#"+e),innerText=$(targetEl).html(),$(targetEl).hasClass("removeReply")?("ceReplyToAddr"===e?$(targetEl).html(i18edremovereplyto):"ceReplyToCc"===e?$(targetEl).html(i18edremovecc):"ceReplyToBcc"===e&&$(targetEl).html(i18edremovebcc),$("#"+t).removeClass("hide"),$(targetEl).removeClass("removeReply")):($("#"+t).addClass("hide"),"ceReplyToAddr"===e?($("#replyToAddress").val(""),$(targetEl).html(i18edaddreplyto)):"ceReplyToCc"===e?($("#ceCCAddr").val(""),$("#ccAddress").val(""),$(targetEl).html(i18edaddcc)):"ceReplyToBcc"===e&&($("#bccAddress").val(""),$(targetEl).html(i18edaddbcc)),$(targetEl).addClass("removeReply")),document.getElementById("isSendMail")&&"true"==document.getElementById("isSendMail").value||taskDetailsview.setComposeWindow()},taskDetailsview.selectAutoFocus=function(){setTimeout((function(){$("#emailTemplateId")[0].focus();var e=$("#emailTemplateId")[0];if(document.createEvent){var t=document.createEvent("MouseEvents");t.initMouseEvent("mousedown",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}else e.fireEvent&&e.fireEvent("onmousedown")}),1500)},taskDetailsview.ddTime=function(e,t){var a=void 0===t?"ddTime":t;$("#sdiv").css("top",$("."+a).offset().top+20),$("#"+e).on("scroll",(function(){$("#sdiv").hide()}))},taskDetailsview.refreshKV=!1,taskDetailsview.editOptions=function(e){if(document,getElemById("cvEditSave")&&document,"none"===getElemById("cvEditSave").style.display||iskvFollowupEdit){var t=$(e).closest(".kvtlistbgheader").attr("id");if($("#kvType").val(t),taskDetailsview.listAnimation("open"),$("#cvEditSave").show(),curVal=$(e).attr("val"),TaskKanbanView.kvrecordid=0,"refresh"!==curVal)e&&(params=JSON.parse($(e).attr("data-params"))),taskDetailsview.refreshKV=!1,activitytype=$("#activitytype").val(),activityid=$("#entityid").val(),ActivityMoreInfoContent=""!==$("#entitypopup").html()?$("#entitypopup").html():$("#moreinfodiv").html(),$("#entitypopup").html(""),Crm.editEntity(void 0,e,params);else{$(e).addClass("hide"),$(".editTkv").removeClass("hide"),taskDetailsview.refreshKV=!0,activityid=$("#entityid").val(),targetElem=$("#"+activityid+"_refresh"),targetElem&&(params=JSON.parse($(targetElem).attr("data-params")));params.kvmodule,params.kvmodule;var a=$("#"+params.kvmodule+"_startindex").val();params.startindex=a,doAjaxUpdate("tkvloadmorediv",Crm.getCrmBasePath()+"/ShowDetails.do",params,(function(e){setTimeout((function(){$("#mailcompose")&&$("#mailcompose").remove(),$("#recordid_"+activityid).click(),$("#recordid_"+activityid).find(".tkvPriority").addClass("active")}),1e3)}))}iskvFollowupEdit=!1}else{var r="stayonPageConfirmBox",i=$("#"+r);renderingUtils.dummyBackground(!1,r),mailsetCenter(r),i.find(".leavePage").off("click").click((function(){renderingUtils.removeDummyBackground(),i.hide(),iskvFollowupEdit=!0,taskDetailsview.editOptions(e),e&&(params=JSON.parse($(e).attr("data-params"))),activityid=params.id,targetElem=$("#recordid_"+activityid),iskvFollowupTask=!0})),i.find(".stayPage").off("click").click((function(){i.hide(),renderingUtils.removeDummyBackground()})),i.focus(),iskvFollowupTask=!0}0!==$(e).closest("li").length&&($(".leftContainerctn ul li").removeClass("ligraybackground").find(".rightbln").hide(),$(e).closest("li").addClass("ligraybackground"))};var columnlayout,kvdetailsContentHt=$("#kanbanTaskDetailctn div").eq(0).height();taskDetailsview.listAnimation=function(e){var t=$("#kvType").val(),a=e;$(".kvtlistbgheader").removeClass("kv_detailview"),TaskKanbanView.tkvListWidth=350;var r=TaskKanbanView.tkvListWidth-1,i=TaskKanbanView.tkvListWidth-2,o=(renderingUtils.windowWidth,TaskKanbanView.tkvListWidth);1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&(r=o,i=o+2);var s=renderingUtils.windowWidth-i;if($("#"+t).find(".leftheaderBack").show(),"open"===a&&1===$(".leftheaderBack:visible").length){"Closed_header"===t?($("#Closed_header").width(r).addClass("kv_detailview"),$("#taskKanbanViewContainer").addClass("kanbanDetailview_rewamp"),$("#Closed_outer_div").width(i),$("#Open_header").css({cssText:"width: 0px !important"}),$("#RelatedTo_header").css({cssText:"width: 0px !important"}),$("#other_header").css({cssText:"width: 0px !important"})):"Open_header"===t?($("#Open_header").width(r).addClass("kv_detailview"),$("#taskKanbanViewContainer").addClass("kanbanDetailview_rewamp"),$("#Open_outer_div").width(i),$("#RelatedTo_header").css({cssText:"width: 0px !important"}),$("#Closed_header").css({cssText:"width: 0px !important"}),$("#other_header").css({cssText:"width: 0px !important"})):"RelatedTo_header"===t?($("#RelatedTo_header").width(r).addClass("kv_detailview"),$("#taskKanbanViewContainer").addClass("kanbanDetailview_rewamp"),$("#RelatedTo_outer_div").width(i),$("#Open_header").css({cssText:"width: 0px !important"}),$("#Closed_header").css({cssText:"width: 0px !important"}),$("#other_header").css({cssText:"width: 0px !important"})):"other_header"===t&&($("#other_header").width(r).addClass("kv_detailview"),$("#taskKanbanViewContainer").addClass("kanbanDetailview_rewamp"),$("#other_outer_div").width(i),$("#Open_header").css({cssText:"width: 0px !important"}),$("#Closed_header").css({cssText:"width: 0px !important"}),$("#RelatedTo_header").css({cssText:"width: 0px !important"}));var n=$("#kventitydetailspage");1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&n.width(s),n.animate({left:i+"px"},0),TaskKanbanView.KvListItemClickCount=1,$(".kvtlistbgheader .kvtlistbg").addClass("lightbdr")}var l=$(".kanbanDetailview_rewamp").find(".leftContainerctn");thirdPartyUtils.bindPerfectScroll(l)},taskDetailsview.attachmentsAnimation=function(e){var t=$("#"+e).parent().find("ul");if(!0===attachON){var a=$("#"+e).outerWidth()+10;t.animate({left:a},400,(function(){attachON=!1})),$("#"+e).addClass("atatchSel")}else if(!1===attachON){var r=t.outerWidth()+6;t.animate({left:-r},400,(function(){attachON=!0})),$("#"+e).removeClass("atatchSel")}},taskDetailsview.editSave=function(e,t,a){editData=$(e);editData.find("#leContModSel > option"),editData.find('input[name="property(modname)"]')[0];editData.find('#leContModSel > option[value="'+a+'"]').prop("selected",!0);var r=$.trim(editData.find('input[name="property(module)"]').val()).toString();editData.find("select").each((function(){var e=$("<div>",{class:"newSelect"}),t=$("<div>",{class:"pR newSelectCtn dIB"}),a=$.trim($(this).attr("id")).toString(),i=$(this).attr("multiple");"modsel"!==a&&"leContModSel"!==a||"Calls"===r?void 0===i&&$(this).wrap(e):void 0===i&&$(this).wrap(t)})),editData.find("select").css("width","auto").removeClass("select"),editData.find("select[multiple]").css("width","70%");var i=$.trim(editData.find("#modselId select").val()),o=$.trim(editData.find("#leContModSelId select").val()),s=$("<div>",{class:"cDropDwn",html:i}),n=$("<div>",{class:"cDropDwn",html:o});editData.find("#modselId .newSelectCtn").append(s),editData.find("#leContModSelId .newSelectCtn").append(n),editData.find(".newlabel").next("td").addClass("callCVelement"),editData.find(".newlabel").closest("table").addClass("columnlayout"),editData.find(".label").closest("table").addClass("columnlayout"),columnlayout=editData.find(".columnlayout").find("tr").eq(2).find("td").eq(0).siblings("td").length,editData.find('input[name="property(Subject)"]').addClass("subjectCV"),editData.find('input[name="property(Call Purpose)"]').addClass("callpurposeCV"),editData.find('input[name="property(Call Result)"]').addClass("callResultCV"),editData.find('input[name="uiType_property(Call Start Time)"]').closest("td").prev().addClass("callDetailsCV"),editData.find(".callDetailsCV").next("td").addClass("callDetailsTimer"),editData.find('input[name="uiType_property(Call Purpose)"]').closest("td").addClass("uicallpurposeCV"),editData.find('input[name="property(Remind At)"]').parent("div").addClass("remindAtCalen").removeClass("mt5"),editData.find('input[name="property(Remind At)"]').addClass("remindAtCalenInput"),editData.find("#RemindAtdiv").closest("tr").addClass("remindAtCV"),editData.find('input[name="property(Recurring Activity)"]').closest("tr").addClass("rcurActivity"),editData.find('input[name="weeklyhidden"]').addClass("mL5 mR5"),editData.find('input[name="daily111"]').addClass("mL5 mR5"),editData.find('input[name="weekdays1"]').addClass("mR5"),editData.find('input[name="noMonths1"]').addClass("mR5"),editData.find('input[name="noMonths2"]').addClass("mR5"),editData.find('select[name="weekdays"]').closest(".newSelect").addClass("mR5"),editData.find('select[name="weekdays1"]').closest(".newSelect").addClass("mR5"),editData.find('select[name="monthly1select"]').closest(".newSelect").addClass("mR5"),editData.find("#call_duration_row").closest("table").addClass("cvCallDetailsNew"),editData.find("select").removeClass("select"),editData.find('input[onclick^="showCalen"]').width(75),editData.find("#remTime").parent("div").addClass("mB10"),editData.find('select[name="monthly1select"]').find("option").each((function(){$(this).html($(this).val())})),editData.find('select[name="yearlydays1select"]').find("option").each((function(){$(this).html($(this).val())})),1===columnlayout?($("#cvEditSave").addClass("onecolumnCV"),editData.find('input[name="property(Call Start Time)"]').width(75),editData.find('input[name="property(DurationInMinute)"]').width(25),editData.find('input[name="property(DurationInSecond)"]').width(25),editData.find('input[name="property(Call Owner)"]').width(375),editData.find('input[name="property(Task Owner)"]').width(375),editData.find('select[name="property(Currency)"]').width(399),editData.find(".task_lookup").prev("input").width(375),editData.find('input[name="uiType_property(Status)"]').next().find("select").attr("style","width: 399px !important;"),editData.find('input[name="uiType_property(Priority)"]').next().find("select").attr("style","width: 399px !important;"),editData.find('input[name="alertRadio"]').closest("table").addClass("alertTableCV")):($("#cvEditSave").addClass("twocolumnCV"),editData.find("select[multiple]").css("width","100%"),editData.find('select[name="property(Currency)"]').width(98),editData.find('input[name="property(Subject)"]').css("width","85%"),editData.find("#RemindAtdiv").find(".newtimefrmt").wrap('<div class="twoColumnRemindAt oH"></div>'),editData.find('input[name^="noMonths"]').addClass("mT10"),editData.find('select[name="yearmonths1"]').parent().addClass("mT10"),editData.find("#RemindAtdiv").contents().filter((function(){return 3===this.nodeType})).wrap("<span />"),editData.find(".twoColumnRemindAt").next("span").addClass("repeatCV")),editData.find('select[name="remTaskRepeat"]').width(100),editData.find('select[name="period"]').width(100),"Calls"!==r?editData.find('textarea[name="property(Description)"]').addClass("editCvDesc"):(editData.find('textarea[name="property(Description)"]').addClass("editCvDesc editCvDescCalls"),setTimeout((function(){$("#cvEditSave").addClass("callsModuleCV")}),300)),editData.find('input[readonly="readonly"]').addClass("readonlyCVinput"),editData.find('input[readonly="true"]').addClass("readonlyCVinput"),editData.find('textarea[name="property(Description)"]').css("width","69%");var l="input[value="+I18n.getMsg("crm.button.save")+"]";if(editData.find(l).addClass("editCVsave"),editData.find(l).closest("table").addClass("editCVfooter"),editData.find("textarea").css("width",""),editData.find("textarea").closest("td").prev("td").css("vertical-align","top"),editData.find("select[multiple]").closest("td").prev("td").css("vertical-align","top"),editData.find('textarea[name="property(Description)"]').css("width","69%"),editData.find('select[name^="property(TASKCF"]').css("min-width","80px"),editData.find('input[name="property(Due Date)"]').width(75),editData.find('input[type="checkbox"]').each((function(e){var t=$("<label>",{class:"newLbl checkCV uncheckCV",for:"check"+e});$("<span>",{class:"spanNew"});$(this).attr("id","check"+e),$(this).after(t)})),editData.find('input[type="radio"]').each((function(e){var t=$("<label>",{class:"newLblrd checkradioCV uncheckradioCV",for:"checkradio"+e}),a=($("<span>",{class:"spanNew"}),$(this).attr("id"));void 0!==a?($(this).attr("id",a+e),t.attr("for",a+e),"leContModSel"===a&&"none"===$(this).css("display")&&"Leads"===$(this).val()&&(t.attr("id","label"+a+e),t.attr("style","display:none")),$(this).after(t)):($(this).attr("id","checkradio"+e),$(this).after(t))})),editData.find(".mandatory").each((function(){$(this).html($(this).html().replace("*","<span>*</span>"))})),editData.find(".title.hline").closest("table").addClass("editCVtitle"),$("#"+t).html(editData),$("#"+t).find("table").eq(1).remove(),title=$(".editCVtitle").outerHeight()+$(".editCVfooter").outerHeight(),0!==$("#preHTMLContainer").length)var d="#preHTMLContainer";else d="#cacheLoadContainer";$(d).addClass("preHTMLContainer"),thirdPartyUtils.unbindPerfectScroll(".preHTMLContainer"),$(".preHTMLContainer").removeClass("oH"),$(".preHTMLContainer").wrapInner('<div class="innerPreContent"></div>'),$("#cvEditSave").find(".preHTMLContainer").width($("#cvEditSave").width()-60),$("#cvEditSave").find(".preHTMLContainer").height($("#cvEditSave").height()-140),setTimeout((function(){thirdPartyUtils.bindPerfectScroll(".preHTMLContainer",{wheelSpeed:1,wheelPropagation:!0}),$(".preHTMLContainer").addClass("oH"),$(".preHTMLContainer").scroll((function(){initialTop=$(this).scrollTop(),0!==initialTop?($(".editCVtitle").addClass("shadowpreHtml"),$(".editCVfooter").addClass("showFootShadow")):($(".editCVtitle").removeClass("shadowpreHtml"),$(".editCVfooter").removeClass("showFootShadow"))})),$('#leContModSel > option[value="'+a+'"]').prop("selected",!0),$("#modselId").find('#modsel > option[value="'+a+'"]').prop("selected",!0),$("#modselId").find("#modsel").next(".cDropDwn").html($("#modselId").find("#modsel").find(":selected").html()),$("#leContModSel").next(".cDropDwn").html($("#leContModSel").find(":selected").html())}),300)};var attachON=!0,calenderTargetElKv=null,KvListItemClickCount=0,mailtreeStructure="",setmsgID="",cv={init:function(){taskDetailsview.setComposeWindow()}};$((function(){cv.init()}));var changeOwner={relatedRecords:[],notifyOwner:[],massTransferRecords:"",massTransferNotify:!1,unconfirmedUsersList:[],isLoaded:!1,handleMassActionOk:function(){changeOwner.disabledButton();var e="<input type='button' data-zcqa='btn_MassChangeOwnerSave' value='"+I18n.getMsg("crm.mass.actions.ok.proceed")+"' class='primarybtn' id='buttonMassChangeOwner' name='buttonChangeOwner' onclick=\"changeOwner.handleMassTransferWorkFlowPopUpProceed()\">",t=crmListView.getObject().module,a=getWorkflowPopUpContent(e,"changeOwner.handleMassTransferWorkFlowPopUpCancel",t);$("#massActionWorkFlowPopUp").html(a)},disabledButton:function(){var e=$("#okBtn");e.css("opacity","0.7"),e.prop("disabled","disabled")},enableButton:function(){var e=$("#okBtn");e.prop("disabled",""),e.css("opacity","1")},catchEnter:function(e){if(13==e.keyCode)return!1},handleChangeOwnerFromListView:function(e,t,a,r){var i=!1,o=crmListView.getObject().cvId,s=crmListView.getObject().module;null==t&&(t=$("#changeOwnerPopUp").data("id"));var n=getIdsAndNames().idList,l=crmListView.getObject().fromIndex,d=crmListView.getObject().toIndex,c=objectUtils.getKeys(crmListView.startIndex).sort()[0];l=c,d=parseInt(c)+parseInt(crmListView.getObject().currentOption)-1;var u=crmListView.getObject().doMassActioninScheduler,m="";u?((m=crmListView.getObject().totalCount)>Crm.massOperationWorkflowLimit&&void 0===e?i=!0:(m<=Crm.massOperationWorkflowLimit||void 0!==e)&&(i=!1),(1==i||"true"==i||m<=Crm.massOperationWorkflowLimit)&&Crm.trackSpotLightAction("Mass Scheduler - Change Owner Confirmed",{Module:s})):null==(m=crmListView.getObject().selectedIds.length)&&(m=1);var p=crmListView.getObject().includeChild?1:0,h=crmListView.getObject().territoryId,f={id:n,fromIndex:l,toIndex:d},v=changeOwner.getChoosenRelatedRecords(s,a,r),g=$("#notifyOwner").find("input").is(":checked")?"true":"false",C=Crm.getCrmBasePath()+"/ChangeOwnership.do";"list"==Lyte.Router.getRouteInstance().routeName&&(f.from="listview"),f[csrfParamName]=csrfToken,f.module=s,f.cvid=o,f.target="showcvdetails",f.ajaxRequest="true",f.SalesManId=t,f.isMassJobScheduled=u,f.isWfTriggerCheck=i,f.territoryId=h,f.includechild=p,f.relatedRecords=v,f.notify=g,f.fetchOnlyBody="true",f.featureId="5",crmListView.getObject().isWorkFlowRequired=!1,changeOwner.doMassUpdateOwner(s,C,f,n.split(";"))},isConfirmedUser:function(e,t){var a=$("#"+e+"changeOwnerPopUp"+t),r=a.data("id");if(""!=changeOwner.unconfirmedUsersList&&null!=changeOwner.unconfirmedUsersList&&-1!=changeOwner.unconfirmedUsersList.indexOf(r)){var i=$("#alertMessage");freezeBackground(),$("#freezeBackGround").css("z-index","251");var o=a.attr("user-name").trim(),s=[];return s[0]=o,i.text(""),i.text(I18n.getMsg("crm.unconfirmed.user.notification",s)),$("#notifyOwner").find("input").prop("checked",""),!1}return!0},hideAlertPop:function(){removeFreezeLayer(),$("#freezeBackGround").css("z-index","22"),crmui.hidePopup("showAlertPopUp")},handleMassTransferWorkFlowPopUpProceed:function(){hideAnimatePopup("massActionWorkFlowPopUp");changeOwner.handleChangeOwnerFromListView(!1);var e=crmListView.getObject().module;Crm.trackSpotLightAction("Mass Scheduler - Change Owner Workflow Ok Proceed",{Module:e})},handleMassTransferWorkFlowPopUpCancel:function(e){hideAnimatePopup("massActionWorkFlowPopUp",!0),hideAnimatePopup("changeOwnerPopup"),Crm.trackSpotLightAction("Mass Scheduler - Change Owner Workflow Cancel",{Module:e})},checkRelatedRecordsPermission:function(e,t,a){for(var r=$("#recordViewPerm").val(),i=""!==r?JSON.parse(r):"",o=e.split(","),s=$("#"+t+"changeOwnerPopUp"+a),n=s.data("profileId"),l=s[0].hasAttribute("lyte-rendered")?s[0].component.data.userName.trim():s.text().trim(),d=o.length,c=$("#alertMessage"),u=0;u<d;u++){var m=o[u];if(!(""===i||i[m]&&i[m].contains(n))){var p=[];return p[0]=l,p[1]=m,c.text(""),c.text(I18n.getMsg("crm.change.owner.permission.alert",p)),crmui.showPopup("showAlertPopUp"),!1}}return!0},showRestrictionInfo:function(e,t,a){var r="#"+e+"_fldRow_SMOWNERID";"Products"===e&&(r="#"+e+"_fldRow_HANDLER"),this.getRestrictionInfo(e,t,a).then((function(t){if($("crm-threshold-grant").remove(),!1===t.allow){var a=document.createElement("crm-threshold-grant"),i=$(r+" .labelValCreate"),o=i.position().left,s=i.width();Crm.userDetails.RTL_ENABLED&&(o=-$(r+" .labelTabCreate").outerWidth());var n="position:relative;left:"+o+"px;width:"+s+"px;top:10px";return a.setData("rsGrantStyle",n),a.setData("moduleName",e),i.after(a),void commonUtils.showHideLoadingDiv()}}))},getRestrictionInfo:function(e,t,a){return Lyte.registeredMixins["crm-assignment-threshold-common"].restrictionGrantCheck(e,t,a)},changeEntityOwner:function(e,t,a,r,i,o,s,n){t="customview"===t?t="listview":t;var l=s,d=n,c=$("#"+l+"changeOwnerPopUp"+d),u=c.data("id"),m=$("#isDeletedUser");if(null==u){var p=$("[name=radiobtn]:checked");u=(u=p.attr("id")).substr(0,u.indexOf("_"))}var h="";h=c.attr("user-name")?c.attr("user-name").trim():c.text().trim();var f=changeOwner.getChoosenRelatedRecords(e,l,d);"true"==m.val()&&(f=changeOwner.getRelatedModulesList(e),f=changeOwner.checkRelatedrecordsPresence(f,l,d));var v=$("#"+l+"notifyOwner"+d).find("input").is(":checked")?"true":"false";if(""!=h||""!=u){if(changeOwner.isLoaded)return changeOwner.isLoaded=!1,changeOwner.isLoaded;if(""!=f&&"workflowconvert"!=t&&!changeOwner.checkRelatedRecordsPermission(f,l,d))return changeOwner.isLoaded=!0,!1;if("true"==v&&!changeOwner.isConfirmedUser(l,d))return void crmui.showPopup("showAlertPopUp");if(changeOwner.disabledButton(),Events.withMeetingTool&&-1!=JSON.stringify(Events.meetingConfZuid).indexOf(Events.meetingToolName)&&(Events.checkAuthorizeDone(Events.meetingToolName,"ChangeOwner"),Events.userChange))return Events.userChange=!1,!0;var g={},C=$L("#changeOwnerPopUp")[0],b=C?C.component:C;if(b&&b.getData()&&b.getData().isFieldLookup){var y=b.ajaxEditOwnerValue,w=b.editOwnerValue;_.isEmpty(y)?_.isEmpty(w)||Crm.setRefFieldValues(b,b.getData().dataId,w):g=y.folOwnerAjaxVal}if(("dealconvert"===t||"convert"===t||"workflowconvert"===t)&&Search.folUserRefValues.length>0){for(var I=c.data("fieldidfoldeal"),R={},T=Search.folUserRefValues,E=T.length,S=0;S<E;S++)if(T[S].seId===u){R.item=T[S];break}var L=R.item.refFieldsInfo;L&&R.item.parentFieldsColumnName&&(L=L||{},Crm.setRefFieldValues(I,"",L,1))}switch(t){case"listview":changeOwner.handleMassActionOk(),changeOwner.handleChangeOwnerFromListView(void 0,u,l,d);break;case"detailview":var D=$("#Crm_"+e+"_SMOWNERID"),k=D.find("span");k.text(h),k.attr("title",h),D.data("id",u),changeOwner.relatedRecords[a]=f,changeOwner.notifyOwner[a]=v,this.showRestrictionInfo(e,u,a);break;case"caseOwner":$("#ownerName").val(h),$("#ownerId").val(u),$("#cases_relatedRecords").val(f);break;case"caseEscalationOwner":$("#escUserName").val(h),$("#escUserId").val(u);break;case"massTransferTo":$("#transferto").val(h),$("#SalesManId").val(u),$("#relatedRecords").val(f),changeOwner.massTransferRecords=f,changeOwner.massTransferNotify=v,$("#notify").val(v),changeOwner.handleMassActionOk();break;case"massTransferFrom":$("#transferfrom").val(h),$("#fromUserId").val(u);break;case"convert":$L("#assignedto")[0].ltProp("value",h),(P=$L("crm-convert-lead")[0].component).setData("relatedRecords",f),P.setData("SalesManId",u),P.addRestrictionMsgOnConvertPage(u,null,"checkAll"),P.executeMethod("enableNotifyChkbx");break;case"dealconvert":document.getElementById("property(Potential Owner)").value=h,$("#smOwnerId").val(u),addRestrictionMsgOnConvertPage(["Deals"],u,null,"dealCreate"),$("#relRec").val(f);break;case"massconvert":var P;if("Leads"===e)(P=$L("crm-mass-convert")[0].component).setData("salesmanid",u),P.setData("relatedRecords",f),P.setData("ownerName",h),P.executeMethod("executeOwnerUpdateAction");else $("#convertownerName").text(h),$("#convertOwner").hide(),$(".changeownerrecord,#revertOwnerLink").show(),$("#relatedRecords").val(f),$("#convertownerId").val(u);changeOwner.handleMassActionOk();break;case"blueprint":var A=$("#relatedRecordsText"),O=$L("#arCheckbox").e;$("#fieldValue1").val(h),$("#ownerId").val(u),$("#relatedRecords").val(f),$("#notify").val(v),$("#isAssignmentRestricted").val(void 0!==O&&O.checked),A.text(""),""!=f&&(A.text(I18n.getMsg("crm.change.owner.relatedRecordsText",changeOwner.getRelatedRecordsText(f,h))),A.show());break;case"workflowconvert":changeOwner.enableNotifyChkbx(),$("#convertownerName").text(h),$("#defaultOwner").hide(),$(".changeownerrecord,#revertOwnerLink").show(),$("#convertownerId").val(u),$("#relatedRecords").val(f);break;case"macro":var M=$("[data-zcqa="+("Macro_FieldValue_Users_"+o)+"]").find(".textinmacro.normal.updatefield");M.attr("data-params",'{"USERID":"'+u+'"}'),$(".textinmacro.noneclass").hide(),M.show(),$("[data-zcqa="+("macro_ownerNameSpan_"+o)+"]").hide();var F=$("[data-zcqa="+("macro_ownerName_"+o)+"]");F.text(""),F.text(h).show(),$("[data-zcqa="+("macro_relatedRec_"+o)+"]").val(f),$("[data-zcqa="+("macro_notifyOwner_"+o)+"]").val(v);O=$L("#arCheckbox").e;$("[data-zcqa="+("macro_applyRestriction_"+o)+"]").val(void 0!==O&&O.checked);var x=$("[data-zcqa="+("relatedRecordsTxt_"+o)+"]");x.text(""),""!=f&&x.text(I18n.getMsg("crm.change.owner.relatedRecordsText",changeOwner.getRelatedRecordsText(f,h)));var N=x.outerHeight();$(".relatedRecordsTxt").closest(".Macro_droplistupdate").css({"margin-bottom":N});break;case"itsfromwebform":return changeOwner.handleMassActionOk(),changeOwner.handleChangeOwnerFromApprovalWeb(u);case"entityview":"crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route&&window.CScriptLib?CanvasDetailPageHandler.intercept_owner_field(u).then((function(){changeOwner.handleChangeOwnerFromEntityView(u,h,f,v,e,a,g)}),(function(){})):changeOwner.handleChangeOwnerFromEntityView(u,h,f,v,e,a,g);break;default:changeOwner.setownervalues(i)}if("listview"!=t){if(hideAnimatePopup("topBandPopup",!0),"massconvert"==t)$("#freezeBackGround").css("z-index","25");else{var B=document.querySelector("#multipleFieldsEditPop");(B=!!B&&"none"!=B.style.display)||"workflowconvert"==t||removeFreezeLayer()}Events.userChange=!1}return!0}return r?renderingUtils.showCustomAlert(I18n.getMsg("crm.manager.change.alert.noselect")):renderingUtils.showCustomAlert(I18n.getMsg("crm.owner.change.alert.noselect")),!1},enableNotifyChkbx:function(){var e=$("#changeOwnerPopUp").data("id"),t=$("#LeadOwnerId").val(),a=$("#loginUserId").val();t!=a?t!=e?$("#notifyEx").css("display",""):($("#notifyEx").css("display","none"),$("#notifyLeadOwner").prop("checked",!1)):t==e&&($("#notifyEx").css("display","none"),$("#notifyLeadOwner").prop("checked",!1)),a!=e?($("#notifyRecOwner").css("display",""),a!=t&&$("#notify").prop("checked",!0)):a==e&&($("#notifyRecOwner").css("display","none"),$("#notify").prop("checked",!1))},toggleCheckBox:function(e,t,a){var r=e,i=$("#"+r),o=a,s=t,n=$("#"+s+"RecordsSpan"+o);n.find(".coma").removeClass("removecoma");var l=i.attr("label");(changeOwner.toggleInputCheckBox(r),i.is(":checked"))?($("#"+l).show(),$("#"+s+"noneId"+o).hide()):($("#"+l).hide(),changeOwner.getSelectedRecords(s,o)&&$("#"+s+"noneId"+o).show());n.find(".coma:visible").last().addClass("removecoma")},toggleInputCheckBox:function(e){var t=$("#"+e);t.is(":checked")?t.prop("checked",!1):t.prop("checked",!0)},getRelatedRecordsText:function(e,t){var a=[];return e=(e=(e=(e=(e=(e=e.replace("Tasks","Open Tasks")).replace("Calls","Open Calls")).replace("Events","Open Events")).replace("Contacts","Open Contacts")).replace("Potentials","Open Potentials")).replace(/,/g,", "),a[0]=e,a[1]=t,a},getRelatedModulesList:function(e){var t="";switch(e){case"Accounts":t="Contacts,Potentials,Events,Tasks,Calls";break;case"Contacts":t="Potentials,Events,Tasks,Calls";break;case"Events":case"Calls":case"Tasks":case"Activities":t="";break;default:t="Events,Tasks,Calls"}return t},trackChangeOwnerCancel:function(){crmListView.getObject().doMassActioninScheduler&&Crm.trackSpotLightAction("Mass Scheduler - Change Owner Cancel",{Module:crmListView.getObject().module});var e=$L("crm-mass-convert");e.length>0&&(e[0].setData("buttonDisp",!1),e[0].setData("moveBackGroundFreeze",!1))},getSelectedRecords:function(e,t){var a=!0,r=e,i=t,o=$("#"+r+"Tasks"+i),s=$("#"+r+"Calls"+i),n=$("#"+r+"Events"+i),l=$("#"+r+"Contacts"+i),d=$("#"+r+"Potentials"+i);return a=o.length?"none"==o.css("display")&&a:a,a=s.length?"none"==s.css("display")&&a:a,a=n.length?"none"==n.css("display")&&a:a,a=l.length?"none"==l.css("display")&&a:a,a=d.length?"none"==d.css("display")&&a:a},checkRelatedrecordsPresence:function(e,t,a){var r=$("#"+t+"Tasks"+a),i=$("#"+t+"Calls"+a),o=$("#"+t+"Events"+a),s=$("#"+t+"Contacts"+a),n=$("#"+t+"Potentials"+a),l=$("#openRelatedRecords").val();return e=(e=r.length||-1!=l.indexOf("Tasks")?e:e.replace("Tasks","")).replace(",,",","),e=(e=i.length||-1!=l.indexOf("Calls")?e:e.replace("Calls","")).replace(",,",","),e=(e=o.length||-1!=l.indexOf("Events")?e:e.replace("Events","")).replace(",,",","),e=(e=s.length||-1!=l.indexOf("Contacts")?e:e.replace("Contacts","")).replace(",,",","),e=(e=(e=(e=n.length||-1!=l.indexOf("Potentials")?e:e.replace("Potentials","")).replace(",,",",")).endsWith(",")?e.slice(0,-1):e).startsWith(",")?e.slice(1,e.length):e},showRelatedRecords:function(e,t,a){var r=a,i=$(event.currentTarget),o=$("#"+t+"AvailableRecords"+r),s=o.css("display"),n=$(".filterDropdownElement"),l=$("#"+e).offset();$("#topBandPopup").after(n),"none"==s?(n.css({left:l.left,top:l.top+34}),o.show(),i.addClass("focusEleField")):(o.hide(),i.removeClass("focusEleField"))},getChoosenRelatedRecords:function(e,t,a){var r="";null==a&&(a="");var i=a,o=t;null==o&&(o="");var s=$("#"+o+"Contacts"+i),n=$("#"+o+"Potentials"+i),l=$("#"+o+"Tasks"+i),d=$("#"+o+"Calls"+i),c=$("#"+o+"Events"+i);return"Tasks"!=e&&l.length>0&&"none"!=l.css("display")&&(r+="Tasks,"),"Calls"!=e&&d.length>0&&"none"!=d.css("display")&&(r+="Calls,"),"Events"!=e&&c.length>0&&"none"!=c.css("display")&&(r+="Events,"),"Accounts"==e&&s.length&&"none"!=s.css("display")&&(r+="Contacts,"),"Accounts"!=e&&"Contacts"!=e||!n.length||"none"==n.css("display")||(r+="Potentials,"),r=r.endsWith(",")?r.slice(0,-1):r},constructFieldValueJson:function(e,t,a,r){var i={};return i.ownerId=e,i.notify=t,i.relatedRecords=a,r&&(i.applyRestriction=r),i},handleChangeOwnerFromEntityView:function(e,t,a,r,i,o,s){var n,l="true"===$("#iskanbanview").val(),d="&pfrom=entityview";if("none"==$("#detailPrevious").display&&"none"==$("#detailNext").display||(d+="&navig=true"),"crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route){var c=store.peekRecord(moduleRecordMapping[i].id,o);n=Crm.getCrmBasePath()+"/ChangeOwnership.do?target=viewentity&id="+o+"&module="+i+"&name="+encodeURIComponent(c.Full_Name)+"&SalesManId="+e+d+"&cvid=null&recordNum=null&relatedRecords="+a+"&notify="+r+"&featureId=5"}else n=Crm.getCrmBasePath()+"/ChangeOwnership.do?target=viewentity&id="+o+"&module="+i+"&name="+encodeURIComponent($("#entityName").val())+"&SalesManId="+e+d+"&cvid="+document.viewentityform.cvid.value+"&recordNum="+document.viewentityform.recordNum.value+"&relatedRecords="+a+"&notify="+r+"&featureId=5";"Tasks"===i&&$("#rightPanel").length&&(n+="&fromTaskDetailView=true"),void 0!==s&&(n+="&folAjaxValue="+encodeURIComponent(JSON.stringify(s))),(new crmRequestPool).initiate({action:n,type:"POST",data:$("#token").serialize(),success:function(r){if("crm.tab.module.entity.canvas"!==Lyte.Router.getRouteInstance().transition.info.route){if(null!=document.viewentityform&&crmTab.deleteFromCache(document.viewentityform.module.value),a){var s={};s.message=I18n.getMsg("crm.changeOwner.relatedRecord.scheduler.popup.message.progress"),crmSchedulerNotification.addOrUpdateStatus(s,I18n.getMsg("crm.changeOwner.relatedRecord.scheduler.popup.title"))}if("SUCCESS"===r&&"Tasks"===i)return updateTaskOwner(e,t,l),(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(i))&&Crm.downloadLayoutRules(Crm.getCrmBasePath()+"/ShowEntityInfo.do",{module:i,id:o,getLayoutRuleJSON:!0},"view",(function(){CFRExec.promptIfMandatory=!1,CFRExec.evalRules("view",!0)})),!1;$("#show").html(r),init(),(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(i))&&Crm.downloadLayoutRules(Crm.getCrmBasePath()+"/ShowEntityInfo.do",{module:i,id:o,getLayoutRuleJSON:!0},"view",(function(){CFRExec.promptIfMandatory=!1,CFRExec.evalRules("view",!0)}));var n=$("#recordNum"),d=n.length?parseInt(n.val()):"";d&&crmNavig.setNavigButtonState(d)}else Lyte.Router.getRouteInstance().refresh()},error:function(e){555==e.status&&renderingUtils.showCustomAlert(e.responseText)}})},setownervalues:function(e){changeOwner.enableNotifyChkbx();var t=$("#FreezeLayer");if(""!=val&&""!=id&&""!=actualVal){var a=$("input[name="+fldName+"]"),r=$("input[name="+fldId+"]");if(fldName.indexOf("searchtext")>-1)a.val(actualVal);else if(fldName.indexOf("searchusercv")>-1||fldName.indexOf("searchuser")>-1)if("is"!=condition&&"isnt"!=condition){var i=$("temp_"+fldName);a.value=id,","==actualVal[actualVal.length-1]?i.val(actualVal.substring(0,actualVal.length-1)):i.val(actualVal)}else{i=$("temp_"+fldName);a.val(id),i.val(val)}else if(fldName.indexOf("searchuser")>-1){i=$("temp_"+fldName);a.val(id),i.val(val)}else fldName.indexOf("changeOwner")>-1?Territory.changeManager(id,actualVal,fldName):fldName.indexOf("changeFCManager")>-1?Territory.changeFcOwner(id,actualVal,fldName):"callOwnerName"==fldName?(t.show(),t.css("zIndex","19"),$("#updateCallStatusDiv").css("zIndex","25"),a.val(val)):a.val(val);r&&("true"==e?$(a).data("id",id):r.val(id))}},doMassUpdateOwner:function(e,t,a,r){var i;if(i=isWFSchedulerUser()?r.splice(0,r.length):r.splice(0,crmConstants.maxRecOperCnt),a.id=i.join(";"),1===r.length&&""===r[0]||r.length<=0){a.lastPage="false";var o=crmListView.getObject();if(o.criteriaSearch&&1==o.criteriaSearch){var s=[];a.rowCount=Search.rowcnt;for(var n=1;n<=Search.rowcnt;n++){var l={text:o["searchfield"+n],type:o["searchfieldtype"+n],match:o["match"+n]};a["searchfield"+n]=o["searchfield"+n],1!=n&&(a["match"+n]=o["match"+n]),a["searchfieldtype"+n]=o["searchfieldtype"+n];var d=o["searchfieldtype"+n];"U"==d?(l={ptn:o["usercondition"+n],value:o["searchuser"+n]},a["searchuser"+n]=o["searchuser"+n],a["usercondition"+n]=o["usercondition"+n],Search.formUserConditionValues(l,n,"temp_value",l.value),a["temp_searchuser"+n]=l.temp_value):"T"==d?(l.ptn=a["textcondition"+n]=o["textcondition"+n],l.value=a["searchtext"+n]=o["searchtext"+n]):"picklist"==d?(l.value=a["searchpicklist"+n]=o["searchpicklist"+n],l.ptn=a["textpicklistcondition"+n]=o["textpicklistcondition"+n]):"N"==d?(l.value=a["searchnum"+n]=o["searchnum"+n],l.ptn=a["numcondition"+n]=o["numcondition"+n]):"B"==d?(l.value=a["searchboolean"+n]=o["searchboolean"+n],l.ptn=a["booleancondition"+n]=o["booleancondition"+n]):"CML"==d?(l.value=dataOb["searchcampcv"+n]=o["searchcampcv"+n],l.ptn=a["campcvcondition"+n]=o["campcvcondition"+n],l.temp_value=a["temp_searchcampcv"+n]=o["temp_searchcampcv"+n]):"D"==d?(l.ptn=a["datecondition"+n]=o["datecondition"+n],o["datecondition"+n]==Search.ageCrt||o["datecondition"+n]==Search.dueCrt?(l.ageindayscondition=a["ageindayscondition"+n]=o["ageindayscondition"+n],l.ageindays=a["ageindays"+n]=o["ageindays"+n]):(l.value=a["searchdate"+n]=o["searchdate"+n],l.edate=a["searchedate"+n]=o["searchedate"+n])):"DT"==d?(l.ptn=a["datetimecondition"+n]=o["datetimecondition"+n],o["datetimecondition"+n]==Search.ageCrt||o["datecondition"+n]==Search.dueCrt?(l.ageindayscondition=a["ageindayscondition"+n]=o["ageindayscondition"+n],l.ageindays=a["ageindays"+n]=o["ageindays"+n]):(l.value=a["searchdatedate"+n]=o["searchdatedate"+n],l.sthour=a["searchsthour"+n]=o["searchsthour"+n],l.stminute=a["searchstminute"+n]=o["searchstminute"+n],l.stampm=a["searchstampm"+n]=o["searchstampm"+n],l.enddate=a["searchenddate"+n]=o["searchenddate"+n],l.ethout=a["searchethour"+n]=o["searchethour"+n],l.etminute=a["searchetminute"+n]=o["searchetminute"+n],l.stime=a["searchstime"+n]=o["searchstime"+n],l.etime=a["searchetime"+n]=o["searchetime"+n],l.etampm=a["searchetampm"+n]=o["searchetampm"+n])):"territory"==d&&(l.ptn=a["territorycondition"+n]=o["territorycondition"+n],l.value=a["searchterritory"+n]=o["searchterritory"+n]),s.push(l)}a.patternVal=o.patternVal,a.criteriaSearch=!0,s.push(o.patternVal)}if("All"!=o.searchletter&&(a.searchletter=o.searchletter),o.filters||o.cross_filters){var c=Lyte.Router.getRouteInstance().routeName;"list"!=c&&"canvas"!=c&&"kanban"!=c||(a.isNewFilter=!0),o.filters&&(a.filters=JSON.stringify(o.filters)),o.cross_filters&&(a.cross_filters=JSON.stringify(o.cross_filters))}}var u=a;(new crmRequestPool).initiate({action:t,type:"POST",data:u,success:function(i){var o=crmListView.getObject().doMassActioninScheduler,s=crmListView.getObject().totalCount;if(a.relatedRecords&&(!1===o||"false"===o)||(!0===o||"true"===o)&&s<500){var n={};n.message=I18n.getMsg("crm.changeOwner.relatedRecord.scheduler.popup.message.progress"),crmSchedulerNotification.addOrUpdateStatus(n,I18n.getMsg("crm.changeOwner.relatedRecord.scheduler.popup.title"))}if(1===r.length&&""===r[0]||r.length<=0){if(i.body&&0!=i.body.length){for(var l=[],d=i.fromIndex-1,c=0;d<=i.toIndex;d++,c++)i.body[c]?l[d]=i.body[c]:l[d]=null;i.body=l}var m=crmTab.getFromCache(e);if(1==i.isWfTriggered&&1==i.approvalProcessTriggered){var p=I18n.getMsg("crm.mass.actions.rules.alert.content",[I18n.getMsg("crm.mass.actions.workflow.rules")])+" & "+I18n.getMsg("crm.mass.actions.rules.alert.content",[I18n.getMsg("crm.mass.actions.approval.process")]);return void showTransferRelatedRulesAlert(p)}if(1==i.isWfTriggered){p=I18n.getMsg("crm.mass.actions.rules.alert.content",[I18n.getMsg("crm.mass.actions.workflow.rules")]);return void showTransferRelatedRulesAlert(p)}if(1==i.approvalProcessTriggered){p=I18n.getMsg("crm.mass.actions.rules.alert.content",[I18n.getMsg("crm.mass.actions.approval.process")]);return void showTransferRelatedRulesAlert(p)}if(0==i.isWfTriggered)commonUtils.showHideLoadingDiv(),removeFreezeLayer();else{if(1==i.isScheduledMassOperation||"true"==i.isScheduledMassOperation){if(hideAnimatePopup("massActionWorkFlowPopUp"),hideAnimatePopup("topBandPopup"),removeFreezeLayer(),hideFreezeLayer(),$("#freezeBackGround").css({opacity:"0.0",background:"#ffffff",zIndex:"26"}),"listview"!=u.from?(crmListView.checkAll(),showHideListViewBtnFn(),crmListView.selectAllEntity("",$("#selectAllEntity"))):Lyte.registeredMixins["crm-view-utils"].clearSelection(),0==i.isValidInterval)return;if(1==i.success){var h=I18n.getMsg("crm.mass.actions.mass.transfer.job");h=i.isQueued?h+" "+I18n.getMsg("crm.mass.actions.scheduled.submit"):h+" "+I18n.getMsg("crm.mass.actions.scheduled.success"),crmui.showMsgBand("success",h,4e3,"");var f=$("#selectAllRecords");f.length>0&&(f.hide(),customViewObject.showSelectAll=!1,customViewObject.moreActions.push("hideSelectAllRecords")),crmListView.setHideActionInModule()}else if(1==i.jobRunningForCvid)crmui.showMsgBand("info",I18n.getMsg("crm.mass.actions.cv.running"),4e3,"");else{var v=I18n.getMsg("crm.mass.actions.transfer"),g=I18n.getMsg("crm.mass.actions.scheduled.fail",[v]);crmui.showMsgBand("error",g,18e4,"")}return}if("false"==i.error||"listview"==u.from){if(isWFSchedulerUser()&&!o&&i.isWFScheduler){var C=u.id.split(";").length,b=i.wfOffloadedJobid;detailView.currWFOffloadingJobIds.push(b);var y=automationActionsNotificationScheduler.setTimeoutForAutomationActionsOffload(C);return commonUtils.showHideLoadingDiv(!0),void setTimeout((function(){var e=$("#changeOwnerForm");e.length>0&&automationActionsNotificationScheduler.showNotificationInProgress(b,e)}),y)}1==m.isStageView?m.stageBoardDetails=i.stageBoardDetails:m.body=i.body,"listview"!=u.from&&(m.fromIndex=i.fromIndex,m.toIndex=i.toIndex,m.selectedIds=[]),customViewObject.isCustomizedView?crmListView.reloadCurrentListView():1==m.isStageView?($("#lv_stageview").html(Handlebars.templates.stageView(m)),crmListView.loadStageSummary(),crmListView.afterRenderStageView(m)):"listview"!=u.from?i.body&&0!=i.body.length?($(".fixedrowTd").html(Handlebars.templates.fixedColumnlistview(m)),$("#lvTred").html(Handlebars.templates.body(m)),renderingUtils.tableSorter("listViewTable","2","")):($("#listViewTable").trigger("destroy"),$("#lvTred").html(""),$(Handlebars.templates.noRecordsFound(m)).insertAfter("#lvTred"),renderingUtils.tableSorter("listViewTable","0","")):crmListView.reloadCurrentListView(),"listview"!=u.from&&(1!=m.isStageView&&(crmListView.getNavigationDiv(m),crmListView.checkAll()),showHideListViewBtnFn())}else m=i,crmListView.createTemplate(i)}if(crmHistory.getCurrentStateData().fromIndex&&crmHistory.getCurrentStateData().fromIndex!=i.fromIndex){var w=Lyte.Router.getRouteInstance(),I=w.getQueryParams();Lyte.Router.transitionTo({route:w.transition.info.route,dynamicParams:w.transition.info.dynamicParams,queryParams:I})}if("listview"!=u.from){crmTab.putInCache(e,m),crmTab.updateTabContent(e);var R=$("#checkAll");R.attr("class","customCheckBoxChecked")&&R.attr("class","customCheckBox"),setDataFetchDate()}hideAnimatePopup("topBandPopup",!0),removeFreezeLayer();s=0;if(o&&(s=crmListView.getObject().totalCount),!o||o&&s<Crm.massOperationUserThreadLimit){o&&overLayForSelectAllClick(!1);var T=$("#bulkUpdateSuccess");setCenter(T[0]),crmui.showMsgBand("success",I18n.getMsg("crm.massupdate.updatedsuccesfully"),"4000","")}}else changeOwner.doMassUpdateOwner(e,t,u,r);crmListView.startIndex={}},error:function(e){555==e.status&&renderingUtils.showCustomAlert(e.responseText)}})},handleChangeOwnerFromApprovalWeb:function(e){var t="",a=document.forms.namedItem("approvalForm"),r=a.elements.idlist.value,i=a.elements.startIndex.value,o=a.elements.endIndex.value,s=a.elements.approvalModule.value,n=document.forms.namedItem("approvalForm1"),l=n.elements.actionName.value,d=n.elements.showDuplicates.value;return d||(d=0),t=Crm.getCrmBasePath()+"/ConfirmApproval.do?idlist="+r+"&startIndex="+i+"&endIndex="+o+"&assignOwner="+e+"&approvalModule="+s+"&isfromApproval=yes","Contacts"==s?t=Crm.getCrmBasePath()+"/ConfirmContactApproval.do?idlist="+r+"&startIndex="+i+"&endIndex="+o+"&assignOwner="+e+"&approvalModule="+s+"&isfromApproval=yes":"Cases"==s?t=Crm.getCrmBasePath()+"/ConfirmCaseApproval.do?idlist="+r+"&startIndex="+i+"&endIndex="+o+"&assignOwner="+e+"&approvalModule="+s+"&isfromApproval=yes":-1!=s.indexOf("CustomModule")&&(t=Crm.getCrmBasePath()+"/WebRecordConfirmApproval.do?idlist="+r+"&startIndex="+i+"&endIndex="+o+"&assignOwner="+e+"&approvalModule="+s+"&isfromApproval=yes"),t=t+"&actionName="+l+"&showDuplicates="+d,document.deleteForm.action=t,document.deleteForm.method="post",doAjaxUpdateForm("show",document.deleteForm),closeownernamedialog(),!1}};$(window).unload((function(){CTIAPI.documentUnload()})),$(window).on("beforeunload",(function(){CTIAPI.documentBeforeunload()}));var qCreateCall={createUrl:Crm.getCrmBasePath()+"/QCreate.do",formData:null,entityId:null,entityModule:null,relId:null,relModule:null,desc:null,formOrder:{"Who Id":1,Subject:2,"Call Purpose":3,"What Id":4,"Call Type":5,"Call Start Time":6,"Call Duration":7,Description:8,"Call Result":9,Billable:10,"Call Owner":11,"Created By":12,"Modified By":13,getOrder:function(e){return this[e]?this[e]:-1},putElemInOrder:function(e){var t=this.getNextMaxElem(e);if(null!==t)t.before(e);else{var a=this.getLastElem(e,"left"),r=a.data()?a.data().order:0,i=this.getLastElem(e,"right");r>(i.data()?i.data().order:0)?a.after(e):i.after(e)}},getLastElem:function(e,t){return $("#sectioncontainerholder .ui-layout-"+t+" .liHolder").find("li:last")},getNextMaxElem:function(e){var t=e.data("order");if(t<=0)return null;var a=null;return $("ul.sortAllowed").find("li").each((function(){var e=$(this).data("order");e>t&&(null===a||e<a.data("order"))&&(a=$(this))})),a}},createQCForm:function(e,t,a,r,i,o){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else if(isNewCallView)Crm.globalCreate(e,t,a,r,i,o);else{var s={module:"Calls",recordNum:"1",fromCreate:"QuickCreate"};Q.url=this.createUrl,Q.anchor=null,Q.operation="NewCall",Q.callFrom="global",Q.formName="qCreate",networkUtils.setCsrfParam(s),(new crmRequestPool).initiate({action:this.createUrl,cache:!1,type:"POST",data:s,success:function(e){Q.loadResponse(e),$(".Crm_Calls_ISCALLBILLABLE").closest("div").remove()}}),"onboardSchedule"===t&&$("#whichCall3").click()}},get paramFormData(){return localStorage.getItem("callsFormData")},set paramFormData(e){localStorage.setItem("callsFormData",e)},get entityIdVal(){return this.entityId?this.entityId:localStorage.getObject("callDetails")?localStorage.getObject("callDetails").entityId:null},get entityModuleVal(){return this.entityModule?this.entityModule:localStorage.getObject("callDetails")?localStorage.getObject("callDetails").entityModule:null},get relModuleVal(){return this.relModule?this.relModule:localStorage.getObject("callDetails")?localStorage.getObject("callDetails").relModule:null},get callDescVal(){return this.desc?this.desc:localStorage.getObject("callDetails")?localStorage.getObject("callDetails").desc:null},setCallDetails:function(e,t,a,r,i){this.entityId=e,this.entityModule=validationUtils.isEmpty(e)?null:t,this.relId=a,this.relModule=validationUtils.isEmpty(a)?null:r,this.desc=i;var o={entityId:e,entityModule:t,relId:a,relModule:r,desc:i};SalesSignalsWrapper.isSignalIFrameOpen?localStorage.setItem("callDetails",o):localStorage.setObject("callDetails",o)},openCallPopup:function(e,t){if(t=t||quickCreateValidateAction("All","Calls",e.name)){if($("#startCurrCall").prop("disabled",!0).css("opacity","0.7"),Crm.userDetails.LITE.IS_LITE_USER)return;if(validationUtils.isNotEmpty(this.paramFormData)&&"quickCreate"===$("#popupFrom").val()&&"callhungup"===CTIAPI.get("callState")){this.saveCall(null,(function(){qCreateCall.openCallPopup(e,!0)})),1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&hideMenu()}else{this.paramFormData=this.getFormData(e);var a=$(getElm(e.name,"property(Description)")).val();a=a||"";var r=$(getElm(e.name,"leContModId")).val(),i=$(getElm(e.name,"leContModSel")).val(),o=$(getElm(e.name,"modid")).val(),s=$(getElm(e.name,"modsel")).val();validationUtils.isEmpty(r)&&(r=o,i=s,o=null,s=null),this.setCallDetails(r,i,o,s,a),Q.close(),networkUtils.loadFeatureScripts(["zohocrm_phonebridge_notifier.js"],(function(){qCreateCall.getPopup("calldialed")}))}1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&(hideMenu(),detailView.hideDetailviewMenu(!0))}},getFormData:function(e){var t=formData2QueryString(e);return t="module=Calls&property(module)=Calls&viewType=callQC&"+(t+="&ajax=true")},getPopup:function(e){var t={mode:"callFromQC",callState:e,recordId:this.entityIdVal,recModule:this.entityModuleVal,tabid:ctiApiNotifier.tabid};networkUtils.setCsrfParam(t),(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/CtiApiConfig.do",cache:!1,type:"POST",data:t,success:function(t){WebMessanger.systemdown&&ctiApiNotifier.ctiApiNotification(t),"callhungup"===e&&qCreateCall.updateCallDuration()}});var a=localStorage.getObject("crm-presentCallDetails");if(a){var r=e;if("callhungup"===e){var i=(new Date).getTime()-CTIAPI.CallTimer.callStartedTimeInMilliSeconds;i/=1e3,r=r+"_"+(i=Math.floor(i))}a.qcStatus=r,localStorage.setObject("crm-presentCallDetails",a)}},saveCall:function(e,t){qCreateCall.updateFormData(e);ctiApiNotifier.saveCalls(this.paramFormData,!0,this.getEntityInView(),(function(){t(),qCreateCall.destroy()}))},rejectCall:function(){isNewCallView?ctiApiNotifier.saveCallEntity(!1):(qCreateCall.updateFormData(),this.saveCall(null,ctiApiNotifier.closeNotify))},updateCallDuration:function(){var e=$("#ctiapi_calltimer_min").text(),t=$("#ctiapi_calltimer_sec").text(),a={"property(DurationInMinute)":e,"property(DurationInSecond)":t,"property(Call%20Duration)":e+encodeURIComponent(":")+t};this.paramFormData=CTIAPI.updateQueryParams(this.paramFormData,a)},updateFormData:function(e){var t="";2!==e&&3!==e&&(t=(t=$("#ctiapi_calldesc").val())||qCreateCall.callDescVal);var a={"property(Description)":encodeURIComponent(t)};if(ctiApiNotifier.isUnknownConverted()){var r=ctiApiNotifier.getCreatedOrAssocEntity();r&&(a["property(leContModSel)"]=r.entityModule,a["property(leContModName)"]=r.entityName,a["property(leContModId)"]=r.entityId,"Contacts"===r.entityModule&&r.relatedId&&(a["property(modsel)"]=r.relatedModule,a["property(modname)"]=r.relatedName,a["property(modid)"]=r.relatedId))}this.paramFormData=CTIAPI.updateQueryParams(this.paramFormData,a)},showOrHideCallFields:function(e){$("form[name='"+e+"'] #whichCall1").is(":checked")?($(getElm(e,"saveCall")).hide(),$(getElm(e,"startCurrCall")).show(),$(getElm(e,"selMoreFields")).addClass("dN")):($(getElm(e,"saveCall")).show(),$(getElm(e,"startCurrCall")).hide(),$(getElm(e,"selMoreFields")).removeClass("dN"))},isEntityAssociated:function(e,t){var a=$("#leContModName");if(0!==a.length&&""===a.val()){var r=-1===$("form[name='"+e+"']").get(0).action.indexOf("QuickCreate")?"crm.call.callto.empty.check":"CurrentCall"===t?"crm.call.callto.empty.check.qcreate.current":"crm.call.callto.empty.check.qcreate";return CTIAPI.customCtiApiConfirm(I18n.getMsg(r)),!1}return!0},destroy:function(){this.paramFormData=null,this.entityId=null,this.entityModule=null,this.desc=null,localStorage.setObject("callDetails",null)},getEntityInView:function(){var e=crmHistory.getState();return-1===(e.url?e.url:"").indexOf(crmRelatedList.EntityId)?null:(ctiApiNotifier.isUnknownConverted()&&this.setUnknownConvertedDetails(),this.entityId===crmRelatedList.EntityId||this.relId===crmRelatedList.EntityId?crmRelatedList.EntityId:null)},setUnknownConvertedDetails:function(){var e=ctiApiNotifier.getCreatedOrAssocEntity();e&&e.length&&(this.entityId=e.entityId,this.entityModule=e.entityModule,this.relId=e.relatedId,this.relModule=e.relatedModule)},onCallTypeChange:function(e){var t=$(e).closest("form").get("0").name,a=$("form[name='"+t+"']");if(a.find("#whichCall2").is(":checked")){var r=a.find("#Crm_Calls_CALLTYPE"),i=a.find("input[name='property(Call Duration)']").parent();"Missed"===r.children("option:selected").attr("actualvalue")?(a.find("input[name='property(DurationInMinute)']").val(""),a.find("input[name='property(DurationInSecond)']").val(""),i.css("display","none").parent().css("display","none")):i.css("display","inline-block").parent().css("display","inline-block")}}},CTIAPI={entitycreationresponse:{},zpbRecDetails:{},cti_obj:{debug:!1},CTI:{ctiname:""},set obj(e){for(var t in e)this.put(t,e[t])},get:function(e){var t=this.cti_obj;if(void 0!==e)return t[e]},put:function(e,t){this.cti_obj[e]=t},remove:function(e){return!!this.has(e)&&(delete this.cti_obj[e],!0)},has:function(e){return this.cti_obj.hasOwnProperty(e)},keys:function(){var e=this.cti_obj;return Object.keys(e)},updateDisplayStatusInClientStorage:function(e,t){var a=localStorage.getObject("crm-presentCallDetails");a?e===a.callRefId&&(a.displayStatus=t,localStorage.setObject("crm-presentCallDetails",a)):validationUtils.isNotEmpty(e)&&CTIAPI.storeInClientStorage(e,"PhoneBridge",0,0,t,null,Date.now())},updateAnsweredTimeInClientStorage:function(e,t){var a=localStorage.getObject("crm-presentCallDetails");!a||""!==e&&e!==a.callRefId||(a.answeredTimeMillis=t,a.displayStatus="",localStorage.setObject("crm-presentCallDetails",a))},updatePausedTimeInClientStorage:function(e,t){var a=localStorage.getObject("crm-presentCallDetails");!a||""!==e&&e!==a.callRefId||(a.pausedTimeInMillis=t,a.displayStatus="",localStorage.setObject("crm-presentCallDetails",a))},storeInClientStorage:function(e,t,a,r,i,o,s,n,l){var d={callRefId:e,callId:l,callSource:t=t||"PhoneBridge",answeredTimeMillis:a=a||0,pausedTimeInMillis:r,displayStatus:i=i||"crm.tpi.ctiapi.calling",qcStatus:o=o||"calldialed",callStartTime:s,isAnswerable:n};localStorage.setObject("crm-presentCallDetails",d)},removeClientStorage:function(e){var t=localStorage.getObject("crm-presentCallDetails");Crm.isHeadless||!t||""!==e&&e!==t.callRefId&&e!==t.callId||(localStorage.removeItem("crm-presentCallDetails"),isNewCallView&&localStorage.removeItem("callDetails"))},showCurrentCallPopup:function(){var e=localStorage.getObject("crm-presentCallDetails");if(validationUtils.isEmpty(e))return!1;if(Date.now()-e.callStartTime>36e5)return CTIAPI.removeClientStorage(""),!1;var t=Crm.getCrmBasePath()+"/CtiApiConfig.do",a={mode:"getNotificationDetails",callrefid:e.callRefId,callSource:e.callSource,ctiname:CTIAPI.CTI.ctiname,ctiapitype:CTIAPI.CTI.ctitype};if("quickCreate"===e.callSource){if(!localStorage.getObject("callDetails")||!e.qcStatus)return CTIAPI.removeClientStorage(""),!1;a={mode:"getNotificationDetails",callState:e.qcStatus,callId:e.callId,callSource:e.callSource,recordId:localStorage.getObject("callDetails").entityId,recModule:localStorage.getObject("callDetails").entityModule}}(new crmRequestPool).initiate({action:t,cache:!1,type:"GET",data:a,success:function(t){if(!validationUtils.isNotEmpty(t))return CTIAPI.removeClientStorage(""),!1;var a="",r="";localStorage.CTIAPI&&JSON.parse(localStorage.CTIAPI).call_desc&&(a=JSON.parse(localStorage.CTIAPI).call_desc),localStorage.getObject("crm-presentCallDetails")&&localStorage.getObject("crm-presentCallDetails").callStartTime&&(r=localStorage.getObject("crm-presentCallDetails").callStartTime),t.i18nCallState="CallingAgent"===e.displayStatus?I18n.getMsg("crm.tpi.ctiapi.calling.user",Crm.userDetails.DISPLAY_NAME):I18n.getMsg("crm.tpi.ctiapi.calling"),t.agentnumber=localStorage.getItem("login-username"),t.qcStatus=e.qcStatus,t.callStartTime=r,networkUtils.loadFeatureScripts(["zohocrm_phonebridge_notifier.js"],(function(){(ctiApiNotifier.setAllowedOperationKeys(t),t.isAnswerable=e.isAnswerable,ctiApiNotifier.showCallNotification(t),CTIAPI.put("callrefid",e.callRefId),CTIAPI.put("ctiname",CTIAPI.CTI.ctiname),"quickCreate"!==t.source)&&("Ringing"===t.presentState&&"outbound"===t.calltype&&"type4"===CTIAPI.CTI.ctitype?$("#ctiapi_call_endcall_button").show():"AWSlily"===CTIAPI.CTI.ctiname&&"Ringing"===t.presentState&&"inbound"===t.calltype&&$("#ctiapi_call_endcall_button").hide(),"twilio"===CTIAPI.CTI.ctiname&&(twilioNotifier.isBrowserMode()&&$("#ctiapi_twilio_call_ctrl_bts").show(),"inRinging"==CTIAPI.get("twiCurrentStatus")&&"true"==$("#ctinotifier").attr("is")&&twilioCallDetails.hasOwnProperty(e.callRefId)&&"ringing"==twilioCallDetails[e.callRefId].status?$("#ctiapi_inboundcall_answer_button").show():$("#ctiapi_inboundcall_answer_button").hide()));if("Answering"===t.presentState){var r=e.answeredTimeMillis,i=e.pausedTimeInMillis;if(i&&i>r){var o=parseInt(i-r),s=Math.floor(o/1e3);ctiApiNotifier.new_startTimer(r,i),ctiApiNotifier.holdNotify(),ctiApiNotifier.new_updateNotificationDuration(s)}else ctiApiNotifier.new_startTimer(r);"AWSlily"===CTIAPI.CTI.ctiname&&(lilyCallDetails[e.callRefId]={},lilyCallDetails[e.callRefId].callConnectedTime=r)}else"AfterCallWork"===t.presentState&&(CTIAPI.put("callState","quickCreate"===e.callSource?"callhungup":"completed"),$("#ctiapi_calldesc").text(a),ctiApiNotifier.new_updateNotificationDuration(t.callDuration),ctiApiNotifier.new_endCall());if(isNewCallView){$("#ctinotifier").attr("is","false").hide();var n={id:t.callRefID||t.callId,tabId:clienttab.browserTabId};WindowsCommunicator.notifyOtherTabs("get-call-back-param",n)}}))}})},IFrame:{Origin:void 0,sendMessagetoParent:function(e){if(null==this.Origin){var t=new URL(window.location.href).searchParams.get("frameorigin");this.Origin=t.split(",")[0]}window.parent.postMessage(e,this.Origin)},backToProviderList:function(){this.sendMessagetoParent({from:"DetailPage",to:"ListingPage"})}},Windows:{Lead:void 0,Contact:void 0,leadIntervalID:void 0,contactIntervalID:void 0,windowInfo:void 0,set changeWindowInfo(e){this.windowInfo=e},set leadInterval(e){this.leadIntervalID=e},set contactInterval(e){this.contactIntervalID=e},set childLead(e){this.Lead=e},set childContact(e){this.Contact=e},removeChildLead:function(){this.Lead&&(this.Lead.close(),this.Lead=null),this.leadIntervalID=void 0},removeChildContact:function(){this.Contact&&(this.Contact.close(),this.Contact=null),this.contactIntervalID=void 0}},LocalStorage:{hasStorage:!0,tempStorage:{},get cti_obj(){var e=localStorage.CTIAPI;return void 0===e?this.tempStorage:JSON.parse(e)},set CTIAPI(e){this.hasStorage?localStorage.CTIAPI=JSON.stringify(e):this.tempStorage=e},get:function(e){var t=this.cti_obj;if(void 0!==e)return t[e]},put:function(e,t){var a=this.cti_obj;a[e]=t,this.CTIAPI=a},remove:function(e){if(this.has(e)){var t=this.cti_obj;return delete t[e],this.CTIAPI=t,!0}return!1},has:function(e){return this.cti_obj.hasOwnProperty(e)},keys:function(){var e=this.cti_obj;return Object.keys(e)},reset:function(){var e=localStorage.CTIAPI;try{void 0!==e&&"undefined"!==e||(this.CTIAPI=this.cti_obj)}catch(e){this.hasStorage=!1}Object.freeze(this)}},CallTimer:{Minute:0,Second:0,TimerID:0,timerRun:!1,callStartedTimeInMilliSeconds:0,callPausedTimeInMilliSeconds:0,start:function(e,t,a,r){0===this.TimerID&&!1===this.timerRun&&(this.callStartedTimeInMilliSeconds=a||(new Date).getTime(),this.callPausedTimeInMilliSeconds=r||this.callPausedTimeInMilliSeconds,this.TimerID=setInterval(e,t),this.timerRun=!0)},increment:function(){this.setCurrentMinAndSecForTimer(),this.timerRun=!0},reset:function(){clearInterval(this.TimerID),this.callStartedTimeInMilliSeconds=this.callPausedTimeInMilliSeconds=this.Minute=this.Second=this.TimerID=0,this.timerRun=!1},pause:function(){0===this.callPausedTimeInMilliSeconds&&(this.callPausedTimeInMilliSeconds=(new Date).getTime()),clearInterval(this.TimerID),this.timerRun=!1},resume:function(e,t){if(0!==this.callPausedTimeInMilliSeconds&&!1===this.timerRun){var a=(new Date).getTime(),r=this.callPausedTimeInMilliSeconds-this.callStartedTimeInMilliSeconds;this.callStartedTimeInMilliSeconds=a-r,this.TimerID=setInterval(e,t),this.callPausedTimeInMilliSeconds=0,this.timerRun=!0}else 0===this.TimerID&&!1===this.timerRun&&(this.TimerID=setInterval(e,t))},toggleTimerRun:function(e,t,a){this.timerRun?(this.pause(),$(e).attr("title",I18n.getMsg("crm.button.start.call"))):(this.resume(t,a),$(e).attr("title",I18n.getMsg("crm.button.pause.call")))},getTotalSeconds:function(){return 60*this.Minute+this.Second},setCurrentMinAndSecForTimer:function(){var e=(new Date).getTime();if(0!==this.callStartedTimeInMilliSeconds){var t=e-this.callStartedTimeInMilliSeconds,a=Utils.getMillisecondsToBasicDateProperties(t);this.Minute=a.hours>0?a.mins+60*a.hours:a.mins,this.Second=a.secs}}},DisplayCallTimer:function(){CTIAPI.CallTimer.increment();var e=$("#ctiapi_calltimer_min");void 0!==e?(e.html((CTIAPI.CallTimer.Minute<=9?"0":"")+CTIAPI.CallTimer.Minute),$("#ctiapi_calltimer_sec").html((CTIAPI.CallTimer.Second<=9?"0":"")+CTIAPI.CallTimer.Second)):CTIAPI.CallTimer.reset()},audioControl:{gainNode:null,play:function(){context.createGain||(context.createGain=context.createGainNode),this.gainNode=context.createGain();var e=context.createBufferSource();e.buffer=audioLoader.loadedBuffer,e.connect(this.gainNode),this.gainNode.connect(context.destination),e.loop=!0,e.start||(e.start=e.noteOn),e.start(0),this.source=e},stop:function(){this.source.stop||(this.source.stop=source.noteOff),this.source.stop(0)},toggle:function(){this.playing?this.stop():this.play(),this.playing=!this.playing},changeVolume:function(e){var t=parseInt(e.value)/parseInt(e.max);this.gainNode.gain.value=t*t},toggleAudio:function(){this.isMuted?this.unMute():this.mute(),this.isMuted=!this.isMuted},mute:function(){audioControl.previousGain=this.gainNode.gain.value,this.gainNode.gain.value=0},unMute:function(){this.gainNode.gain.value=audioControl.previousGain}},audioLoader:{loadedBuffer:null,init:function(e,t,a){window.AudioContext=window.AudioContext||window.webkitAudioContext;var r=new AudioContext;$("#downloadAudio").attr({href:e,download:"MyName.mp3"}),this.loadBuffer(r,e,t,a)},loadBuffer:function(e,t,a,r){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){e.decodeAudioData(i.response,(function(e){audioLoader.loadedBuffer=e}))},r?(i.setRequestHeader("authtoken",a),i.send()):i.send("authtoken="+a)}},tabCountIncrease:function(){var e=CTIAPI.LocalStorage.get("noOfTabs");e=void 0!==e&&e>0?e:0,e+=1,CTIAPI.LocalStorage.put("noOfTabs",e),CTIAPI.tabCountIncrease=null},tabVisibilityStateChange:function(){$("#ctiapi_calldesc").val(CTIAPI.LocalStorage.has("call_desc")?CTIAPI.LocalStorage.get("call_desc"):""),CTIAPI.decideShowHide_CloseBT(),networkUtils.loadFeatureScripts(["zohocrm_callReminder.js"],(function(){updateRemindersTime()}))},getCtiNotifier:function(){return $("#ctinotifier").clone()},showaudiourl:function(){$("#audiourl").show()},documentReady:function(){try{if(Lyte.addEventListener("crm-quick-create",(function(e){e.messageType="crm-quick-create",notifyParentWindow(e)})),Lyte.addEventListener("crm-associate-search",(function(e){e.messageType="crm-associate-search",notifyParentWindow(e)})),isNewCallView&&(crmTemplate.arrayNewClass=["Events","Tasks"]),!window.performance||"1"!==window.top.performance.navigation.type&&1!==window.top.performance.navigation.type){if(!Crm.isHeadless){var e=CTIAPI.showCurrentCallPopup();if((!1===e||"false"===e)&&isConfiguredUser("twilio")){var t=twilioConfigDetails.currentStatus;"5"===t&&(t=1,ctiApiNotifier.ctiapiUpdateUserStatus(t,5,"twilio")),"7"===t&&(t=3,ctiApiNotifier.ctiapiUpdateUserStatus(t,7,"twilio")),TwilioConf.twilioUpdateUserStatus(t)}}}else CTIAPI.removeClientStorage(""),CTIAPI.CTI.ctiname&&ctiApiNotifier.logMessage("Refreshed",localStorage.getObject("crm-presentCallDetails"))}catch(e){}},pot_calcInverse:function(e,t){return e-t},documentUnload:function(){var e=CTIAPI.LocalStorage.get("noOfTabs");e=void 0!==e&&e>0?e:1,e-=1,CTIAPI.LocalStorage.put("noOfTabs",e)},documentBeforeunload:function(){var e=CTIAPI.get("ctiname"),t=CTIAPI.get("callState"),a=CTIAPI.LocalStorage.get("noOfTabs"),r="true"===$("#call_desc_mandatory").val(),i=validationUtils.isEmpty($("#ctiapi_calldesc").val()),o=$("#ctinotifier");if("twilio"===e){var s=twiOutgoingConn;if(Object.keys(twiIncomingConn).length>0&&(s=twiIncomingConn),""!==o.html()&&"completed"===t&&1===a||("in-progress"===t||"ringing"===t)&&validationUtils.isNotEmpty(s)&&"open"===s.status())return"completed"===t?r?i?I18n.getMsg("crm.tpi.ctiapi.msg.alert.notification.pagerefresh.complete.man.desc.empty"):I18n.getMsg("crm.tpi.ctiapi.msg.alert.notification.pagerefresh.complete.man.desc"):I18n.getMsg("crm.tpi.ctiapi.msg.alert.notification.pagerefresh.complete"):r?i?I18n.getMsg("crm.tpi.ctiapi.msg.alert.notification.pagerefresh.inprogress.man.desc.empty"):I18n.getMsg("crm.tpi.ctiapi.msg.alert.notification.pagerefresh.inprogress.man.desc"):I18n.getMsg("crm.tpi.ctiapi.msg.alert.notification.pagerefresh.inprogress")}else if("phonebridge"!==e&&""!==o.html()&&("callhungup"===t||"callended"===t)&&1===a||"callanswered"===t&&1===a)return r?I18n.getMsg("crm.tpi.ctiapi.msg.alert.notification.pagerefresh.complete.man.desc"):I18n.getMsg("crm.tpi.ctiapi.msg.alert.notification.pagerefresh.complete")},chatBarCheck:function(){var e=$("#ctinotifier"),t=$("#wmstoolbar"),a=t.is(":visible"),r=t.height();a?(e.css({bottom:r+"px"}),$("#ctireminder").css({bottom:r+"px"}),$("#ctiapi_multireminder_bussinessview").css({bottom:r+"px"})):(e.css({bottom:"0px"}),$("#ctireminder").css({bottom:"0px"}),$("#ctiapi_multireminder_bussinessview").css({bottom:"0px"}))},keypadShowHide:function(){var e=$("#ctiapi_dialpad_keypad");e.is(":visible")?(e.hide(),$("#ctiapi_dialpad_bt_keypad").removeClass("active"),$("#ctiapi_businesscard,#ctiapi_calldesc_div").show()):($("#ctiapi_businesscard,#ctiapi_calldesc_div").hide(),e.show(),$("#ctiapi_dialpad_bt_keypad").addClass("active"),renderingUtils.setEndToInputBox($("#ctiapi_dialpad_keypad_numbers").val("")))},keypadClick:function(e){CTIAPI.removeNotRequiredKeypadKeys(e),CTIAPI.ctiapiSendDigits(e)},removeNotRequiredKeypadKeys:function(e){var t=$("#ctiapi_dialpad_keypad_numbers"),a=t.val()+e;a=a.replace(/[^0-9*#]/g,""),t.val(a)},ctiapiSendDigits:function(e){renderingUtils.setEndToInputBox($("#ctiapi_dialpad_keypad_numbers"));var t=CTIAPI.get("ctiname"),a=$("#call_type").val(),r=CTIAPI.get("ctiapitype");if("twilio"===t)if(void 0!==twiOutgoingConn.sendDigits)twiOutgoingConn.sendDigits(e);else if(void 0!==twiIncomingConn.sendDigits)twiIncomingConn.sendDigits(e);else{var i=new crmRequestPool,o={mode:"Twiliodialpad",calltype:a,digit:e};networkUtils.setCsrfParam(o),i.initiate({action:Crm.getCrmBasePath()+"/CtiApiConfig.do",cache:!0,data:o,type:"POST",success:function(){}})}else"type4"===r?ctiApiNotifier.type4KeyPress(e):"AWSlily"===t&&lilyActions.sendDigit(e)},openUrl:function(e,t,a,r,i,o){validationUtils.isEmpty(a)&&(a=Crm.getCrmBasePath()+"/EntityInfo.do?id="+e+"&module="+t);var s=o||"_blank",n=r||"auto",l=i||"auto";"_blank"===s&&"auto"===l&&"auto"===n?networkUtils.openUrl(Crm.getOrgSpecificURL(a),s):networkUtils.openUrl(Crm.getOrgSpecificURL(a),s,"width="+n+",height="+l)},encodeForHTMLWithoutNull:function(e){var t=$ESAPI.encoder().encodeForHTML(e);return null===t?"":t},checkCTICallNotifed:function(e,t){var a=CTIAPI.get("ctiname"),r=Crm.userDetails.USER_ID;if(!1===t){var i=CTIAPI.LocalStorage.get("isCallNotified");if(CTIAPI.LocalStorage.put("isCallNotified",!0),!0!==i){var o=Crm.getCrmBasePath()+"/CtiApiConfig.do",s={mode:"updateCtiCallNotifyStatus",callrefid:e,answeruserid:r+""};networkUtils.setCsrfParam(s),(new crmRequestPool).initiate({action:o,cache:!1,type:"POST",data:s})}}else if(validationUtils.isNotEmpty(e)&&"twilio"!==a&&"phonebridge"!==a&&"AWSlily"!==a){var n=parseInt(1e3*Math.random())+parseInt(1e3*Math.random())+parseInt(1e3*Math.random())+parseInt(1e3*Math.random())+parseInt(1e3*Math.random());CTIAPI.LocalStorage.put("isCallNotified",!1),setTimeout((function(){CTIAPI.checkCTICallNotifed(e,!1)}),n)}},print:function(){if(this.get("debug")){var e=console;for(var t in arguments)e.log("%c"+arguments[t],"background: #222; color: #bada55")}},showHide_RevokeDiv:function(e,t){var a=$("#ctiapi_revoke");if(e)a.hide(),$("#ctiapiRevokeFreezeLayer").remove(),$("html").css("overflow","");else{CTIAPI.customCtiApiConfirm(I18n.getMsg("crm.tpi.ctiapi.revoke.confirmation.new",t),(function(){murphy.error(new Error("user clicked continue to revoke telephony")),CTIAPI.revokeProvider()}),(function(){CTIAPI.showHide_RevokeDiv(!0)}),I18n.getMsg("crm.button.continue"))}},customCtiApiConfirm:function(e,t,a,r,i){var o=$("#ctiapi_revoke"),s=$("#cti_okBt"),n=$("#cti_cancelBt"),l=$("#calBd");$("body").append('<div class="ctiapiFreezeLayer" id="ctiapiRevokeFreezeLayer"></div>');var d=$("#ctiapiRevokeFreezeLayer");l.is(":visible")&&d.css("z-index","40"),s.removeClass("ctidisablebtn"),null!=r?s.attr("value",r):s.attr("value",I18n.getMsg("crm.button.ok")),null!=i?n.attr("value",i):n.attr("value",I18n.getMsg("crm.button.cancel"));validationUtils.isEmpty(t)&&validationUtils.isEmpty(a)?n.hide():n.show(),s.click((function(){s.addClass("ctidisablebtn"),null!=t&&t(),o.hide(),$("#ctiapiRevokeFreezeLayer").remove(),$("html").css("overflow",""),s.prop("onclick",null).off("click"),n.prop("onclick",null).off("click")})),n.click((function(){o.hide(),$("#ctiapiRevokeFreezeLayer").remove(),$("html").css("overflow",""),s.prop("onclick",null).off("click"),n.prop("onclick",null).off("click"),null!=a&&a()})),$("#ctiapi_revoke_confirmation_msg").text(e);var c=$("#ctiapi_revoke .warning_icon");c.length||(c="<div class='mB15 aligncenter warning_icon'><img style='width:100px' src='"+networkUtils.getImageUrl("warning-illustration_5d44793_.png",ResourceConstants.CRMClient)+"'></div>",o.prepend(c)),o.show(),l.is(":visible")&&s.css({background:""}),setCenter(o.get(0)),$("#qCreate").hasClass("ziaForEmailsCheck")&&(d.css("z-index","315"),o.css("z-index","316")),$("html").css("overflow","hidden")},revokeProvider:function(){var e=$("#ctiapi_revoke_providername").val();if(""!==e){loadAjaxTab("");var t=Crm.getCrmBasePath()+"/CtiApiConfig.do",a={mode:"revokeTelephony",ctiname:e};networkUtils.setCsrfParam(a),(new crmRequestPool).initiate({action:t,cache:!1,type:"POST",data:a,success:function(){Lyte.Router.getRouteInstance().actions.changeToDisableView(),CTIAPI.showHide_RevokeDiv(!0)}})}},callThisFunctionOneTime:function(e,t,a,r){r=r||parseInt(3e3*Math.random()),!1===CTIAPI.LocalStorage.get(e)?(CTIAPI.LocalStorage.remove(e),a()):!0===t?setTimeout((function(e,t){CTIAPI.LocalStorage.put(e,!1),CTIAPI.callThisFunctionOneTime(e,!1,t)}),r):CTIAPI.print(e+" Already called")},getAvailPhnFlds:function(e,t,a,r){if(!validationUtils.isEmpty(e)){var i={mode:"getAvailablePhoneFieldMap",entityId:t,module:e};(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/CtiApiConfig.do",type:"GET",data:i,success:function(t){t.sort((function(e,t){return e.fieldValue||t.fieldValue?e.fieldValue?t.fieldValue&&!0===e.isPrimaryCol?-1:1:-1:!0===e.isPrimaryCol?-1:1})),t.length?a(e,t):r&&r()}})}},noFieldErrFn:function(){renderingUtils.showCustomAlert(I18n.getMsg("crm.calls.error.noassociate.field"),void 0,void 0,(function(){$("#crm_phnoconversion_freezeLayers").remove(),Crm.isHeadless&&"undefined"!=typeof WindowsCommunicator&&WindowsCommunicator.notifyParent("cancel-operation")}))},loadTelephonyHomePage:function(e,t){var a=Crm.getCrmBasePath()+"/CtiApiConfig.do",r="GET",i={mode:"telephony",view:2,isFromBack:!1};e&&(networkUtils.loadFeatureScripts(["zohocrm_phonebridge_notifier.js"],void 0),a=Crm.getCrmBasePath()+"/ZTIConfig.do",i={event:"buyNow"},t&&(i.from="creategroup"),r="POST",networkUtils.setCsrfParam(i)),(new crmRequestPool).initiate({action:a,type:r,data:i,success:function(e){var t=$("#otherApps"),r=t.html();$("#currentTab").html(r),a===Crm.getCrmBasePath()+"/CtiApiConfig.do"&&"object"==typeof e&&"providerList"===e.view?ctiApiConfig.renderProviderList(e):$("#result").html(e),JSEvalScript(document.getElementById("result")),commonUtils.showHideLoadingDiv(),t.addClass("sel")}})},setIE9Placeholder:function(e){if(navigator.appVersion.match(/MSIE [\d.]+/)){var t=(e=$(e)).attr("placeholder");e.blur((function(){""===e.val()&&e.val(t)})).focus((function(){e.val()===t&&e.val("")})).blur().val(t)}},checkOldCallSaved:function(e,t){var a=e.callrefid,r=CTIAPI.get("old_callrefid"),i=CTIAPI.get("old_callstate");if("true"!==$("#ctinotifier").attr("is")||r===a||"callhungup"!==i&&"callended"!==i&&"completed"!==i)$.isFunction(t)&&t(e);else{ctiApiNotifier.createCaid((function(a,r){if(CTIAPI.put("caid",a),$.isFunction(t)){ctiApiNotifier.saveCallWithCaid((function(){t(e)}),r,e)}else ctiApiNotifier.saveCallWithCaid()}),1,!0,e)}},setCallState:function(e){var t=CTIAPI.get("callState");CTIAPI.put("old_callstate",t),CTIAPI.put("callState",e)},setCallRefid:function(e){var t=CTIAPI.get("callrefid");CTIAPI.put("callrefid",e),CTIAPI.put("old_callrefid",t)},getFormatedName:function(e,t){var a=Crm.userDetails.NAME_FORMAT.split(",");return Crm.userDetails.NAME_FORMAT&&"Last Name"===a[2]?e+" "+t:t+" "+e},tabVisible_hiddenSet:function(){!function(){var e="hidden";function t(e){var t="visible",a="hidden",r={focus:t,focusin:t,pageshow:t,blur:a,focusout:a,pagehide:a},i=!1;(e=e||window.event).type in r?"visible"===r[e.type]&&(i=!0):this.hidden||(i=!0),i&&CTIAPI.tabVisibilityStateChange()}e in document?document.addEventListener("visibilitychange",t):(e="mozHidden")in document?document.addEventListener("mozvisibilitychange",t):(e="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",t):(e="msHidden")in document?document.addEventListener("msvisibilitychange",t):"onfocusin"in document?document.onfocusin=document.onfocusout=t:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=t,void 0!==document.hidden&&t({type:document[e]?"blur":"focus"})}()},getCtiApicsrfParam:function(){return csrfParamName+"="+encodeURIComponent(csrfToken)},showCallButtonlabel:function(e){$(e).children("#calllabel1").css({display:"inline"})},hideCallButtonlabel:function(e){$(e).children("#calllabel1").hide()},createFreezeLayer:function(){$("<div class='freezeLayer' id='freezelayer'></div>").appendTo("body")},ctiapisetCenter:function(e){document.getElementById(e).style.display="block";var t=$("#"+e);CTIAPI.createFreezeLayer();var a=$window.height()/2,r=t.innerHeight()/2,i=$window.width()/2,o=t.width()/2;t.css({top:a-r,left:i-o})},removeRCSpecialChars:function(e){if(""!==e&&null!=e)for(var t="~`!@#$^&%*()=-_[]/{}|:<>?. '\"\\",a=t.length,r=0;r<a;r++)e=e.split(t.charAt(r)).join("");return e},sendEmail:function(e){localStorage.setItem("pbxusernotified","true");var t={mode:"userNotify",ctiname:e};(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/CtiApiConfig.do",cache:!1,type:"POST",data:t})},showNumber:function(e,t){var a=$(e).closest("td"),r=a.offset(),i=$("#callButtonContainer");if(i.css("position","absolute").css("top",r.top+a.height()).css("left",r.left),""===$.trim(i.html())){var o=a.find("#entityPhDiv_"+t);o.css("display","block"),i.html(o.prop("outerHTML")),o.remove(),i.show()}else i.toggle()},createContact:function(e,t){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{loadAjaxTab(""),t&&$("#editActivity").val("true"),e=e.trim();var a=$("#ctiapi_entitys_create_contact");if("true"===a.attr("is")&&!t)CTIAPI.create_EditContactCallBack(!0);else{void 0!==e&&"null"!==e&&null!==e&&e!==I18n.getMsg("crm.tpi.ctiapi.label.notification.unknowncaller")||(e="");var r=Crm.getCrmBasePath()+"/QCreate.do",i={module:"Contacts",fromCreate:"QuickCreate",recordNum:1,ctiapi:!0,phoneno:e};networkUtils.setCsrfParam(i),(new crmRequestPool).initiate({action:r,cache:!1,type:"POST",data:i,success:function(t){if(-1!==t.indexOf("createEntityForm")){Crm.downloadValidationRules(Crm.getCrmBasePath()+"/QCreate.do?module="+i.module,i.module),a.html(t),CTIAPI.create_EditContactCallBack(!1),thirdPartyUtils.bindSelect2("#ctiapi_entitys_create_contact select");var r=$("form[name=createEntityFormctiapiContacts]"),o=r.find("input[name='property(Phone)']"),s=r.find("input[name='property(Mobile)']"),n=r.find("input[name='property(Other Phone)']");e!==I18n.getMsg("crm.tpi.ctiapi.label.notification.unknowncaller")&&(o.length>0?Crm.userDetails.isPhoneNoNewView?CrmPhoneNumberInput.setPhoneValue(o,e):o.val(e):s.length>0?Crm.userDetails.isPhoneNoNewView?CrmPhoneNumberInput.setPhoneValue(s,e):s.val(e):n.length>0?Crm.userDetails.isPhoneNoNewView?CrmPhoneNumberInput.setPhoneValue(n,e):n.val(e):$("#qcFieldsContent .labelValCreate").each((function(t,a){var r=$(a).find("input");if(r&&("33"===r.data("uitype")||33===r.data("uitype")))return Crm.userDetails.isPhoneNoNewView?CrmPhoneNumberInput.setPhoneValue(r,e):r.val(e),!1})))}else"noPhoneFields"===t?($("#editActivity").val("false"),CTIAPI.add_remove_cancelContactCallBack(),CTIAPI.noFieldErrFn()):CTIAPI.cancelContact()},error:function(){CTIAPI.cancelContact()}})}}},create_EditContactCallBack:function(e){$("#ctiapi_contact_freezeLayers").remove(),$("body").append("<div id='ctiapi_contact_freezeLayers' class='ctiapiFreezeLayer' style='opacity:0.1;z-index:30;'></div>"),(e=e||!1)&&$("#ctiapi_module_head_msg_Contact").text(I18n.getMsg("crm.module.edit",I18n.getMsg("Contact")));var t=$("#ctinotifier_center");t.show(),$("#ctiapi_entitys_create_contact").show();var a=t.outerHeight()/2;t.css("margin-top","-"+a+"px"),commonUtils.showHideLoadingDiv()},add_remove_cancelContactCallBack:function(){commonUtils.showHideLoadingDiv(),$("#ctinotifier_center,#ctiapi_entitys_create_contact").hide(),$("#ctiapi_contact_freezeLayers").remove()},cancelContact:function(){if(Crm.isHeadless)Lyte.triggerEvent("crm-quick-create",{message:"close"});else{var e=document.getElementsByClassName("errorMsgDesc"),t=e[0],a=document.getElementsByName("createEntityFormctiapiContacts")[0];a.contains(t)&&a.reset();for(var r=e.length,i=0;i<r;i++){var o=e[i];o.parentElement.removeChild(o)}}$("#editActivity").val("false"),CTIAPI.add_remove_cancelContactCallBack()},addContact:function(e){var t=$(e).closest("form").get(0).name;new Promise((function(e){e(CVRExec.evalRules("edit","Contacts"))})).then((function(e){if(e&&quickCreateValidateAction("All","Contacts",t)){$("#ctiapi_entitys_create_contact").attr("is","true");var a=formData2QueryString(document.createEntityFormctiapiContacts,"Contacts"),r=document.getElementsByName("property(Last Name)")[0].value,i=$("form[name=createEntityFormctiapiContacts] [name='property(First Name)']").val(),o=(void 0!==i?i+" ":"")+r,s=$("#is_contact_created"),n=!0===s.val()||"true"===s.val(),l=$("#editActivity"),d=l.val();if(n&&"true"!==d&&(a+="property(id)="+$("#Ctiapi_associated_contact_id").val()+"&",a+="ActionType=Edit"),CTIAPI.put("contactformDataTemp",a),"true"===l.val()){$("#Ctiapi_associated_contact_nameActivity").val(o.trim());var c=$("#callActivityId").val();CTIAPI.saveContact(c,"false")}else CTIAPI.saveContact()}return!1}))},createLead:function(e,t){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{loadAjaxTab(""),t&&$("#editActivity").val("true"),e=e.trim();var a=$("#ctiapi_entitys_create_lead");if("true"===a.attr("is")&&!t)CTIAPI.create_EditLeadCallBack(!0);else{void 0!==e&&"null"!==e&&null!==e&&e!==I18n.getMsg("crm.tpi.ctiapi.label.notification.unknowncaller")||(e="");var r=Crm.getCrmBasePath()+"/QCreate.do",i={module:"Leads",fromCreate:"QuickCreate",ctiapi:!0,phoneno:e};networkUtils.setCsrfParam(i),(new crmRequestPool).initiate({action:r,cache:!1,type:"POST",data:i,success:function(t){if(-1!==t.indexOf("createEntityForm")){Crm.downloadValidationRules(Crm.getCrmBasePath()+"/QCreate.do?module="+i.module,i.module),a.html(t),thirdPartyUtils.bindSelect2("#ctiapi_entitys_create_lead select"),CTIAPI.create_EditLeadCallBack(!1);var r=$("form[name=createEntityFormctiapiLeads]"),o=r.find("input[name='property(Phone)']"),s=r.find("input[name='property(Mobile)']");e!==I18n.getMsg("crm.tpi.ctiapi.label.notification.unknowncaller")&&(o.length>0?Crm.userDetails.isPhoneNoNewView?CrmPhoneNumberInput.setPhoneValue(o,e):o.val(e):s.length>0?Crm.userDetails.isPhoneNoNewView?CrmPhoneNumberInput.setPhoneValue(s,e):s.val(e):$("#qcFieldsContent .labelValCreate").each((function(t,a){var r=$(a).find("input");if(r&&("33"===r.data("uitype")||33===r.data("uitype")))return Crm.userDetails.isPhoneNoNewView?CrmPhoneNumberInput.setPhoneValue(r,e):r.val(e),!1})))}else"noPhoneFields"===t?($("#editActivity").val("false"),CTIAPI.add_remove_cancelLeadCallBack(),CTIAPI.noFieldErrFn()):CTIAPI.cancelLead()},error:function(){CTIAPI.cancelLead()}})}}},changeLayout:function(e,t){loadAjaxTab(""),void 0!==t&&"null"!==t&&null!==t&&t!==I18n.getMsg("crm.tpi.ctiapi.label.notification.unknowncaller")||(t="");var a=Crm.getCrmBasePath()+"/QCreate.do",r={module:e,fromCreate:"QuickCreate",layoutId:$("#layoutdetails").val(),ctiapi:!0,phoneno:t};networkUtils.setCsrfParam(r),(new crmRequestPool).initiate({action:a,cache:!1,type:"POST",data:r,success:function(a){if(-1!==a.indexOf("createEntityForm")){"Leads"===e?($("#ctiapi_entitys_create_lead").html(a).attr("is","true"),CTIAPI.create_EditLeadCallBack(!1)):"Contacts"===e&&($("#ctiapi_entitys_create_contact").html(a).attr("is","true"),CTIAPI.create_EditContactCallBack(!1));var r=$("form[name=createEntityFormctiapi"+e+"]"),i=r.find("input[name='property(Phone)']"),o=r.find("input[name='property(Mobile)']");t!==I18n.getMsg("crm.tpi.ctiapi.label.notification.unknowncaller")&&""!==t&&(i.length>0?Crm.userDetails.isPhoneNoNewView?CrmPhoneNumberInput.setPhoneValue(i,t):i.val(t):o.length>0?Crm.userDetails.isPhoneNoNewView?CrmPhoneNumberInput.setPhoneValue(o,t):o.val(t):$("#qcFieldsContent .labelValCreate").each((function(e,a){var r=$(a).find("input");if(r&&(33===r.data("uitype")||"33"===r.data("uitype")))return Crm.userDetails.isPhoneNoNewView?CrmPhoneNumberInput.setPhoneValue(r,t):r.val(t),!1})))}else"noPhoneFields"===a?($("#editActivity").val("false"),"Leads"===e?CTIAPI.add_remove_cancelLeadCallBack():"Contacts"===e&&CTIAPI.add_remove_cancelContactCallBack(),CTIAPI.noFieldErrFn()):CTIAPI.cancelLead()},error:function(){CTIAPI.cancelLead()}})},create_EditLeadCallBack:function(e){$("#ctiapi_lead_freezeLayers").remove(),$("body").append("<div id='ctiapi_lead_freezeLayers' class='ctiapiFreezeLayer' style='opacity:0.1;z-index:30;'></div>"),(e=e||!1)&&$("#ctiapi_module_head_msg_Lead").text(I18n.getMsg("crm.module.edit",I18n.getMsg("Lead")));var t=$("#ctinotifier_center");t.show(),$("#ctiapi_entitys_create_lead").show();var a=t.outerHeight()/2;t.css("margin-top","-"+a+"px"),commonUtils.showHideLoadingDiv()},add_remove_cancelLeadCallBack:function(){commonUtils.showHideLoadingDiv(),$("#ctinotifier_center,#ctiapi_entitys_create_lead").hide(),$("#ctiapi_lead_freezeLayers").remove()},cancelLead:function(){if(Crm.isHeadless)Lyte.triggerEvent("crm-quick-create",{message:"close"});else{var e=document.getElementsByClassName("errorMsgDesc"),t=e[0],a=document.getElementsByName("createEntityFormctiapiLeads")[0];a.contains(t)&&a.reset();for(var r=e.length,i=0;i<r;i++){var o=e[i];o.parentElement.removeChild(o)}}$("#editActivity").val("false"),CTIAPI.add_remove_cancelLeadCallBack()},addLead:function(e){var t=$(e).closest("form").get(0).name;new Promise((function(e){e(CVRExec.evalRules("edit","Leads"))})).then((function(e){if(e&&quickCreateValidateAction("All","Lead",t)){$("#ctiapi_entitys_create_lead").attr("is","true");var a=formData2QueryString(document.createEntityFormctiapiLeads,"Lead"),r=document.getElementsByName("property(Last Name)")[0].value,i=$("form[name=createEntityFormctiapiLeads] [name='property(First Name)']").val(),o=(void 0!==i?i+" ":"")+r,s=$("#is_lead_created"),n="true"===s.val()||!0===s.val(),l=$("#editActivity"),d=l.val();if(n&&"true"!==d&&(a+="property(id)="+$("#Ctiapi_associated_lead_id").val()+"&",a+="ActionType=Edit"),CTIAPI.put("leadformDataTemp",a),"true"===l.val()){$("#Ctiapi_associated_lead_nameActivity").val(o.trim());var c=$("#callActivityId").val();CTIAPI.saveLead(c,"false")}else CTIAPI.saveLead()}return!1}))},associateContact:function(e){if(Crm.userDetails.isStorageLimitReached)return Crm.showStorageExceedPopup(),!1;CTIAPI.Windows.changeWindowInfo="open",e&&$("#editActivity").val("true");var t=CTIAPI.Windows.Lead,a=CTIAPI.Windows.Contact,r=CTIAPI.Windows.contactIntervalID;if(a)a&&!a.closed&&a.focus();else{t&&CTIAPI.Windows.removeChildLead();var i=function(){if(e)var t=Crm.getCrmBasePath()+"/Search.do?searchmodule=Contacts&fldName=Ctiapi_associated_contact_nameActivity&fldId=Ctiapi_associated_contact_idActivity&targetForm=ctiapicontactsearchActivity";else t=Crm.getCrmBasePath()+"/Search.do?searchmodule=Contacts&fldName=Ctiapi_associated_contact_name&fldId=Ctiapi_associated_contact_id&targetForm=ctiapicontactsearch";var i=renderingUtils.windowWidth;commonUtils.openCustomLookup(t,void 0,"topBandPopup",i-300),window.clearInterval(r),r=window.setInterval(CTIAPI.checkContactChildWindow,1e3),CTIAPI.Windows.contactInterval=r,CTIAPI.Windows.childContact=a};$("#call_ctinumber").val()!==I18n.getMsg("crm.tpi.ctiapi.label.notification.unknowncaller")?CTIAPI.getAvailPhnFlds("Contacts",void 0,i,CTIAPI.noFieldErrFn):i()}},checkContactChildWindow:function(){var e=CTIAPI.Windows.contactIntervalID,t=$("#Ctiapi_associated_contact_id"),a=$("#editActivity");if("true"===a.val()&&(t=$("#Ctiapi_associated_contact_idActivity")),"closed"===CTIAPI.Windows.windowInfo||t.val())if(CTIAPI.Windows.changeWindowInfo=void 0,window.clearInterval(e),CTIAPI.Windows.removeChildContact(),validationUtils.isEmpty(t.val()))a.val("false"),$("#is_contact_associated").val("false"),Crm.isHeadless&&Lyte.triggerEvent("crm-associate-search",{message:"close"});else{var r=t.val();$("#call_ctinumber").val()!==I18n.getMsg("crm.tpi.ctiapi.label.notification.unknowncaller")?CTIAPI.getAvailPhnFlds("Contacts",r,CTIAPI.showAvailablePhnFields,CTIAPI.noFieldErrFn):CTIAPI.associateEntity("Contacts",r)}},associateContactName:function(e){if(e){var t=$(".ctiapi_unknownActivity");t.hide();var a=$("#Ctiapi_associated_contact_idActivity").val(),r=$("#Ctiapi_associated_contact_nameActivity").val();t.remove();var i='<a class="link" id="subvalue_CONTACTID" data-zcqa="value_CONTACTID" data-cid="detailView" ';i+='data-params="{&quot;lookback&quot;:&quot;true&quot;,&quot;module&quot;:&quot;Contacts&quot;,&quot;id&quot;:&quot;'+a+'&quot;}" ',i+='href="'+Crm.getCrmBasePath()+"/EntityInfo.do?module=Contacts&amp;id="+a+'">'+r+"</a>",$("#value_CONTACTID").append(i),$("#headervalue_CONTACTID").append(i)}else $(".ctiapi_unknown_added_associated,#ctiapi_unknown").hide(),$("#ctiapi_unknown_associated_contact_name").text($("#Ctiapi_associated_contact_name").val()),$("#ctiapi_unknown_associated_contact").show(),$("#is_contact_associated").val("true"),$("#is_lead_associated").val("false"),CTIAPI.decideShowHide_CloseBT()},openAssociateContact:function(){if(Crm.userDetails.isStorageLimitReached)return Crm.showStorageExceedPopup(),!1;var e=$("#Ctiapi_associated_contact_id");if(!validationUtils.isNotEmpty(e.val()))return!1;CTIAPI.openUrl(e.val(),"Contacts")},associateLead:function(e){if(Crm.userDetails.isStorageLimitReached)return Crm.showStorageExceedPopup(),!1;CTIAPI.Windows.changeWindowInfo="open",e&&$("#editActivity").val("true");var t=CTIAPI.Windows.Contact,a=CTIAPI.Windows.Lead,r=CTIAPI.Windows.leadIntervalID;if(a)a&&!a.closed&&a.focus();else{t&&CTIAPI.Windows.removeChildContact();var i=function(){if(e)var t=Crm.getCrmBasePath()+"/Search.do?searchmodule=Leads&fldName=Ctiapi_associated_lead_nameActivity&fldId=Ctiapi_associated_lead_idActivity&targetForm=ctiapileadsearchActivity";else t=Crm.getCrmBasePath()+"/Search.do?searchmodule=Leads&fldName=Ctiapi_associated_lead_name&fldId=Ctiapi_associated_lead_id&targetForm=ctiapileadsearch";var i=renderingUtils.windowWidth;commonUtils.openCustomLookup(t,void 0,"topBandPopup",i-300),window.clearInterval(r),r=window.setInterval(CTIAPI.checkLeadChildWindow,1e3),CTIAPI.Windows.leadInterval=r,CTIAPI.Windows.childLead=a};$("#call_ctinumber").val()!==I18n.getMsg("crm.tpi.ctiapi.label.notification.unknowncaller")?CTIAPI.getAvailPhnFlds("Leads",void 0,i,CTIAPI.noFieldErrFn):i()}},checkLeadChildWindow:function(){var e=CTIAPI.Windows.leadIntervalID,t=$("#Ctiapi_associated_lead_id"),a=$("#editActivity");if("true"===a.val()&&(t=$("#Ctiapi_associated_lead_idActivity")),"closed"===CTIAPI.Windows.windowInfo||t.val())if(CTIAPI.Windows.changeWindowInfo=void 0,window.clearInterval(e),CTIAPI.Windows.removeChildLead(),validationUtils.isEmpty(t.val()))a.val("false"),$("#is_lead_associated").val("false"),Crm.isHeadless&&Lyte.triggerEvent("crm-associate-search",{message:"close"});else{var r=t.val();$("#call_ctinumber").val()!==I18n.getMsg("crm.tpi.ctiapi.label.notification.unknowncaller")?CTIAPI.getAvailPhnFlds("Leads",r,CTIAPI.showAvailablePhnFields,CTIAPI.noFieldErrFn):CTIAPI.associateEntity("Leads",r)}},associateLeadName:function(e){if(e){var t=$(".ctiapi_unknownActivity");t.hide();var a=$("#Ctiapi_associated_lead_idActivity").val(),r=$("#Ctiapi_associated_lead_nameActivity").val();t.remove();var i='<a class="link" id="subvalue_CONTACTID" data-zcqa="value_CONTACTID" data-cid="detailView" ';i+='data-params="{&quot;lookback&quot;:&quot;true&quot;,&quot;module&quot;:&quot;Leads&quot;,&quot;id&quot;:&quot;'+a+'&quot;}" ',i+='href="'+Crm.getCrmBasePath()+"/EntityInfo.do?module=Leads&amp;id="+a+'">'+r+"</a>",$("#value_CONTACTID").append(i),$("#headervalue_CONTACTID").append(i)}else $(".ctiapi_unknown_added_associated,#ctiapi_unknown").hide(),$("#ctiapi_unknown_associated_lead_name").text($("#Ctiapi_associated_lead_name").val()),$("#ctiapi_unknown_associated_lead").show(),$("#is_contact_associated").val("false"),$("#is_lead_associated").val("true"),CTIAPI.decideShowHide_CloseBT()},openAssociateLead:function(){if(Crm.userDetails.isStorageLimitReached)return Crm.showStorageExceedPopup(),!1;var e=$("#Ctiapi_associated_lead_id");if(!validationUtils.isNotEmpty(e.val()))return!1;CTIAPI.openUrl(e.val(),"Leads")},showAvailablePhnFields:function(e,t){var a={};a.availFields=t,a.module=e,a.saveFn="CTIAPI.saveNumber()",a.cancelFn="CTIAPI.cancelSave()",CTIAPI.enableFreeze();var r=Handlebars.templates.show_available_phn_fields(a);$("#availField").html(r).show();var i=$("input:radio[name=availPhnField]");i.eq(0).siblings(".fieldValue").length<1?i.eq(0).attr("checked",!0):$("#save").attr("disabled",!0),i.on("change",CTIAPI.changePhoneField)},saveNumber:function(){var e=$("input[type=radio][name='availPhnField']:checked").siblings(".fieldValue");e.text()?CTIAPI.customCtiApiConfirm(I18n.getMsg("crm.phonebridge.overwriting.no",e.text()),CTIAPI.saveNumberToEntity,null,I18n.getMsg("crm.button.continue"),I18n.getMsg("crm.creator.cancelbutton")):CTIAPI.saveNumberToEntity()},associateEntityName:function(e,t){"Leads"===e?CTIAPI.associateLeadName(t):"Contacts"===e&&CTIAPI.associateContactName(t)},associateEntityInActivity:function(e,t){var a=$("#callActivityId").val();CTIAPI.associateEntityName(e,!0),CTIAPI.associateEntityWithCall(t,e,a,!1,null,"activity")},associateEntity:function(e,t){"true"===$("#editActivity").val()?CTIAPI.associateEntityInActivity(e,t):(CTIAPI.associateEntityName(e),ctiApiNotifier.showFollowUpCreate())},saveNumberToEntity:function(){var e=$("input[type=radio][name='availPhnField']:checked"),t=JSON.parse(e.attr("value")),a=$("#fldsModule").attr("value"),r=null,i=null;"true"===$("#editActivity").val()?("Leads"===a?r=$("#Ctiapi_associated_lead_idActivity").val():"Contacts"===a&&(r=$("#Ctiapi_associated_contact_idActivity").val()),i=$("#call_ctinumberActivity").val(),CTIAPI.updatePhnoInAssociatedEntity(a,r,i,t,(function(){CTIAPI.associateEntityInActivity(a,r)}))):("Leads"===a?r=$("#Ctiapi_associated_lead_id").val():"Contacts"===a&&(r=$("#Ctiapi_associated_contact_id").val()),i=$("#call_ctinumber").val(),Crm.isHeadless&&Lyte.triggerEvent("crm-quick-create",{message:"success",Details:{module:a,recordid:r}}),CTIAPI.updatePhnoInAssociatedEntity(a,r,i,t,(function(){CTIAPI.associateEntityName(a)})),ctiApiNotifier.showFollowUpCreate())},changePhoneField:function(){1===$(this).siblings(".fieldValue").length?$("#save").attr({disabled:!1,value:I18n.getMsg("crm.button.replace")}):$("#save").attr({disabled:!1,value:I18n.getMsg("Save")})},cancelSave:function(){Crm.isHeadless&&Lyte.triggerEvent("crm-quick-create",{message:"close"});var e=$("#fldsModule").attr("value"),t=$("#editActivity");"true"===t.val()?(t.val("false"),"Leads"===e?$("#Ctiapi_associated_lead_idActivity, #Ctiapi_associated_lead_nameActivity").attr("value",""):"Contacts"===e&&$("#Ctiapi_associated_contact_idActivity, #Ctiapi_associated_contact_nameActivity").attr("value","")):("Leads"===e?$("#Ctiapi_associated_lead_id, #Ctiapi_associated_lead_name").attr("value",""):"Contacts"===e&&$("#Ctiapi_associated_contact_id, #Ctiapi_associated_contact_name").attr("value",""),$("#is_lead_associated, #is_contact_associated").val("false")),$("#availField").empty().hide(),removeFreezeLayer()},updatePhnoInAssociatedEntity:function(e,t,a,r,i){if(!validationUtils.isEmpty(t)){var o="/crm/v2/",s={},n=[],l={};if(validationUtils.isNotEmpty(r)){o=o+e+"/"+t+"?affected_data=true",s[r.SYS_REF_NAME]=a,n.push(s),l.data=n;var d={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};clientPortalName&&(d["X-CRMPORTAL"]=window.clientPortalName),(new crmRequestPool).initiate({action:o,type:"PUT",data:JSON.stringify(l),contentType:"application/json",headers:d,success:function(){$("#availField").empty().hide(),removeFreezeLayer(),$.isFunction(i)&&i()},error:function(){CTIAPI.errorRCMessage("crm.privileges.restrict")}})}}},saveLead:function(e,t){var a=Crm.getCrmBasePath()+"/QuickCreateCommonModule.do?isload=true",r=CTIAPI.get("leadformDataTemp");(new crmRequestPool).initiate({action:a,type:"POST",data:r,success:function(e){CTIAPI.handleEntityCreationResponse(e,"leads")},error:function(){}})},associateEntityWithCall:function(e,t,a,r,i,o){var s=$("#editActivity");if(validationUtils.isNotEmpty(e)&&validationUtils.isNotEmpty(a)){commonUtils.showHideLoadingDiv(!0);var n=Crm.getCrmBasePath()+"/CtiApiConfig.do",l="activity"===o?detailView.changedBCJson.callStatus:"NonMissed",d={mode:"associateEntityWithCall",entityId:e+"",module:t,activityid:a+"",callrefid:i,isFrom:o,callstatus:l};networkUtils.setCsrfParam(d),(new crmRequestPool).initiate({action:n,cache:!1,type:"POST",data:d,success:function(a){if(commonUtils.showHideLoadingDiv(),"true"===s.val())return a.phoneNo&&Object.keys(a.phoneNo).length>0?$("#businessView").html(Handlebars.templates.CallButton(a)):$("#businessView").hide(),void s.val("false");ctiApiNotifier.saveTask(e,t,r)}})}else"true"!==s.val()&&ctiApiNotifier.saveTask(e,t,r)},saveContact:function(e,t){var a=Crm.getCrmBasePath()+"/QuickCreateCommonModule.do?isload=true",r=CTIAPI.get("contactformDataTemp");(new crmRequestPool).initiate({action:a,type:"POST",data:r,success:function(e){CTIAPI.handleEntityCreationResponse(e,"contacts")},error:function(){}})},decideShowHide_CloseBT:function(){var e=$("#ctiapi_calldesc"),t=$("#agentdisp option:selected"),a=validationUtils.isNotEmpty(e.val()),r=void 0!==t.val()&&"default"!==t.val(),i="true"===$("#is_task_created").val(),o="true"===$("#is_call_created").val(),s=validationUtils.isNotEmpty($("#ctiapi_folloup_event_list_subject").text()),n="true"===$("#is_contact_created").val()||"true"===$("#is_lead_created").val(),l="true"===$("#is_contact_associated").val()||"true"===$("#is_lead_associated").val();a||i||o||s||n||l||r?($("#ctiapi_close_bt").hide(),$("#ctiapi_save_bt,#ctiapi_cancel_bt").show()):($("#ctiapi_close_bt").show(),$("#ctiapi_save_bt,#ctiapi_cancel_bt").hide())},ctiapiUnknownAdd_associate:function(e,t){if(sE(event),t){$("#ctinotifier_center").html('<div class="ctiapi_activitys" id="ctiapi_entitys_create_contact"></div><div class="ctiapi_activitys" id="ctiapi_entitys_create_lead" style="display:none;" ></div>').hide();var a=$(e.target).closest(".ctiapi_unknownActivity"),r=a.offset(),i=a.height(),o=r.left,s=r.top,n=$("#addAssociateCont");if(n.css("position","absolute").css("left",o).css("top",s+i+5),""===$.trim(n.html())){var l=$("#ctiapi_unknown_add_associateActivity");l.css("display","block"),n.html(l.prop("outerHTML")),l.remove(),n.show()}else{n.toggle(),$("#addAssociateCont > .ctiAddRecord").show()}}else{var d=$("#ctiapi_unknown_add_associate_plus"),c=$("#ctiapi_unknown_add_associate"),u=d.position().top+25,m=d.position().left-c.outerWidth()/2;c.css({left:m+"px",top:u+"px"}).show(),Crm.userDetails.RTL_ENABLED&&c.css({left:"10px",top:u+"px"}).show()}},enableFreeze:function(){freezeBackground(),$(".freezeLayer").show(),$("html").css("overflow","hidden")},errorRCMessage:function(e){crmui.showMsgBand("error",I18n.getMsg(e),"infinity",null),$(".crm-msg").css({"max-width":"550px",padding:"0px 0px 0px 0px"}),$(".crm-msg-cnt").css({padding:"10px 40px 5px 60px","font-size":"13px"})},hideElem:function(e){if(e)return e instanceof jQuery||(e=$(e)),e.hide(),e},updateQueryParams:function(e,t){return"object"!=typeof t||Object.getOwnPropertyNames(t).forEach((function(a){var r=new RegExp("([?&])"+CTIAPI.escapeRegExp(a)+"=.*?(&|#|$)(.*)","gi");r.test(e)&&(e=e.replace(r,"$1"+a+"="+t[a]+"$2$3"))})),e},escapeRegExp:function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},getValueFromQuery:function(e,t){if(e&&t){var a=e.indexOf(t);if(-1===a)return null;if((0===a||"&"===e.charAt(a-1))&&"="===e.charAt(a+t.length)){var r=e.substring(a).indexOf("&");return r=-1!==r?a+r:e.length,e.substring(a+t.length+1,r)}}return null},isError:function(e){return!(!e||"string"!=typeof e||-1===e.indexOf(I18n.getMsg("crm.unable.to.process.request")))},trigger_event:function(e){try{if(clienttab.ismaster&&"twilioanswercall"===e.key){var t=JSON.parse(localStorage.getItem("twilioanswercall"));if(null!==t){var a=t.buttonid;$(a).click()}}else if(clienttab.ismaster&&"triggerclick2calltwilio"===e.key){var r=JSON.parse(localStorage.getItem("triggerclick2calltwilio"));null!==r&&(twilioNotifier.twilioMakeCallFinally(r.params,r.c2cEntityName,r.iter),localStorage.removeItem("triggerclick2calltwilio"))}else if(clienttab.ismaster||"showcallctrl"!==e.key)clienttab.ismaster||"resumecall"!==e.key||(twilioNotifier.holdNotify("unhold"),CTIAPI.put("twiCurrentStatus","inprogress"),localStorage.removeItem("resumecall"));else{var i=$("#callrefid").val();if("inRinging"===CTIAPI.get("twiCurrentStatus")&&"true"===$("#ctinotifier").attr("is")&&twilioCallDetails.hasOwnProperty(i)&&"ringing"===twilioCallDetails[i].status)$("#ctiapi_twilio_call_ctrl_bts").show();else{var o=localStorage.getItem("showcallctrl");null!==o&&twilioNotifier.twilioGetCallDetailsByAjax(o,null)}}}catch(e){murphy.error(e)}},makeConnection:function(){"undefined"!=typeof twilioNotifier&&twilioNotifier.twilioRegisterBrowser()},destroyConnection:function(){"undefined"!=typeof twilioNotifier&&(twilioNotifier.twilioDestroyBrowser(),twiIncomingConn={},twiOutgoingConn={})},handleEntityCreationResponse:function(e,t){if(null!=e.STATUS)for(var a=e.INFO,r=a.length,i=0;i<r;i++){var o="#Crm_";"leads"===t?o+="Leads_":"contacts"===t&&(o+="Contacts_");var s=a[i];o+=s.COLUMNNAME,$(o).parent().append('<span id="quickcreateerror_'+s.COLUMNNAME+'" class="errMsg errorMsgDesc" style="clear: both; color: rgb(221, 0, 0); font-size:1.1rem; display: block;">'+I18n.getMsg("crm.duplicate.value.not.allowed")+"</span>")}else if(null!=e.entityModule){var n=$("#editActivity").val(),l="true"===$("#is_task_created").val(),d=$("#callActivityId").val();if("Contacts"===e.entityModule)if(CTIAPI.add_remove_cancelContactCallBack(),"true"!==n&&($(".ctiapi_unknown_added_associated,#ctiapi_unknown").hide(),$("#ctiapi_unknown_added_contact").show(),$("#ctiapi_unknown_added_contact_name").text(e.entityName),$("#is_contact_created").val("true"),$("#removeContact_link").show(),CTIAPI.decideShowHide_CloseBT(),ctiApiNotifier.showFollowUpCreate()),Crm.isHeadless)Lyte.triggerEvent("crm-quick-create",{message:"success",Details:{module:e.entityModule,recordid:e.entityId}});else{var c=e.entityId;"true"===n?($("#Ctiapi_associated_contact_idActivity").val(c.trim()),CTIAPI.associateContactName(!0),CTIAPI.associateEntityWithCall(c,"Contacts",d,l,null,"activity"),$("#ctiapi_entitys_create_contact").html("")):$("#Ctiapi_associated_contact_id").attr("value",c)}else if("Leads"===e.entityModule)if(CTIAPI.add_remove_cancelLeadCallBack(),"true"!==n&&($(".ctiapi_unknown_added_associated,#ctiapi_unknown").hide(),$("#ctiapi_unknown_added_lead").show(),$("#ctiapi_unknown_added_lead_name").text(e.entityName),$("#is_lead_created").val("true"),$("#removeLead_link").show(),CTIAPI.decideShowHide_CloseBT(),ctiApiNotifier.showFollowUpCreate()),Crm.isHeadless)Lyte.triggerEvent("crm-quick-create",{message:"success",Details:{module:e.entityModule,recordid:e.entityId}});else{var u=e.entityId;"true"===n?($("#Ctiapi_associated_lead_idActivity").val(u.trim()),CTIAPI.associateLeadName(!0),CTIAPI.associateEntityWithCall(u,"Leads",d,l,null,"activity"),$("#ctiapi_entitys_create_lead").html("")):$("#Ctiapi_associated_lead_id").attr("value",u)}}},loadRecording:function(){CTIAPI.zpbRecDetails.loaded||"undefined"==typeof ZPB||(ZPB.loadRecording(),CTIAPI.zpbRecDetails.loaded=!0)},isTelephonyIntegrated:function(){return validationUtils.isNotEmpty(CTIAPI.CTI.ctiname)||"undefined"!=typeof PB&&PB.isIntegrationEnabled&&PB.isIntegrationEnabled()}};Object.freeze(CTIAPI),CTIAPI.LocalStorage.reset(),CTIAPI.tabCountIncrease();var callbackZPB=function(){CTIAPI.zpbRecDetails.required&&"undefined"!=typeof ZPB&&CTIAPI.loadRecording()},callbackZPBSuccess=function(){for(var e=$(".ZPBListnerCls"),t=e.length,a=Lyte.Component.registeredHelpers.whichPBService(),r=0;r<t;r++)e[r].component&&e[r].component.setData("pbServiceName",a)},CustomRelatedListObj={};function customRelatedListSubmit(){$("[name='rlContentChngd']").val("true");var e=getObj("relatedListNameTemp"),t=!1;if(""==e.value.trim())return alert(I18n.getMsg("crm.customRL.JSAlert.NameRequired")),e.focus(),t=!0,$("[name='rlContentChngd']").val("false"),!1;if(""!=e.value.trim()){if(t=!CustomRelatedListObj.validateRLName("relatedListNameTemp"))return alert(I18n.getMsg("crm.customRL.JSAlert.NoSplCharsInName")),e.focus(),$("[name='rlContentChngd']").val("false"),!1;if(t=validateFieldLength(e.value.trim(),"50"))return crmui.showMsgBand("error",I18n.getMsg("crm.label.newrelatedlist.relatedlistname.lengthexceeded","50"),"3000"),e.focus(),$("[name='rlContentChngd']").val("false"),!1}if(!t){getObj("relatedListName").value=e.value.trim();var a="",r="",i="",o="";try{for(var s=getObj("idxCount")?getObj("idxCount").value:1,n=1;n<s;n++){var l=$("#entityParamName"+n)[0].innerText,d=$("#confparamValue_"+n);if("entity"===d.attr("type")){var c=d.find(".mergespan").attr("value");"automation"!==customFunctionsObj.isFrom&&(c=c.split("&&&")[0]),""!==l&&(a+=","+l,r+=","+c)}else{if(""===(c=d[0].attributes.hasOwnProperty("placeholder")&&"true"===d[0].attributes.getNamedItem("placeholder").value?"":d[0].textContent))return crmui.showMsgBand("error",I18n.getMsg("crm.customRL.JSAlert.enterParamValue"),"3000"),!1;""!==l&&(i+=","+l,o+=","+c)}}}catch(e){alert(e)}return getObj("entParamName").value=a,getObj("entParamVal").value=r,getObj("custParamName").value=i,getObj("custParamVal").value=o,!0}}CustomRelatedListObj.fromModuleBuilder=!1,CustomRelatedListObj.operateRLFromCanvas=function(e,t){var a=$L("crm-tab").e[0].component.data.previouslySelectedModule;CustomRelatedListObj.doCustomRleatedList(e,t,a)},CustomRelatedListObj.reloadRL=function(e){var t=$L("#"+e+"_customRL");0!=t.length&&(CustomRelatedListObj.changeStatusOfRefreshIcon(e,!0),t[0].component.setData("resp_data",void 0),t[0].component.executeMethod("reloadRelatedList"))},CustomRelatedListObj.checkForCanvasMode=function(){return 0!=$L("crm-custom-rl").length},CustomRelatedListObj.changeStatusOfRefreshIcon=function(e,t){var a=$L("#customRLRef_"+e);0!=a.length&&(null==t?a.hasClass("ref_complete")?a.removeClass("ref_complete").addClass("ref_loading"):a.removeClass("ref_loading").addClass("ref_complete"):t?a.removeClass("ref_complete").addClass("ref_loading"):a.removeClass("ref_loading").addClass("ref_complete"))},CustomRelatedListObj.addNewRelatedList=function(){CustomRelatedListObj.downloadRLFunctionFiles((function(e){customFunctionsObj.isFrom="relatedlist","none"==$("#topBandPopup").css("display")&&$("[name='rlContentChngd']").length>0&&$("[name='rlContentChngd']").val("false"),"none"==$("#topBandPopup").css("display")&&loadAjaxTab("","lightblue");var t=detailView.currentModule;CustomRelatedListObj.fromModuleBuilder&&(t=CrmPageLayout.module),t||(t=e.moduleName);var a=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=addNewRelatedList&module="+t;CustomRelatedListObj.fromModuleBuilder&&(a+="&fromModuleBuilder=true",Crm.trackSpotLightAction("Add new RelatedList",{place:"ModuleBuilder"}),Crm.client_tracking("Add new RelatedList",{place:"ModuleBuilder"})),mR(a,(function(e){$("#topBandPopup").html(e),"none"==$("#topBandPopup").css("display")&&(commonUtils.showHideLoadingDiv(),showAnimatePopup("topBandPopup"),freezeBackground(),$("#thirdPartyRowTag").on("click",(function(){$("#thirdPartyRowTag").off("click")})))}))}))},CustomRelatedListObj.listCustomFunctions=function(e){if(("undefined"!=typeof zossearch&&zossearch.disbaleGSShortCutKey(!1),e)&&"widget"===JSON.parse(e).buttonType)return void CustomRelatedListObj.listWidgets();hideAnimatePopup("topBandPopup");var t="deluge";customFunctionsObj.listCustomFunctions("relatedlist",t),$("#cfLanguagesListDD").val(t)},CustomRelatedListObj.addCreatorRecord=function(e){var t=$("[name='module']").val(),a=$("[name='id']").val(),r=Crm.getCrmBasePath()+"/CustomRelatedList.do",i="action=addCreatorRecord&listRelationId="+e+"&module="+t+"&entityId="+a+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);mR(r,(function(e){var t=$("#topBandPopup");t.empty(),t[0].innerHTML=e,setDivWidthHeight("topBandPopup"),t.css({width:"910px"}),t.show(),getObj("creatorRecordFrame").height=parseInt(getObj("topBandPopup").style.height)+50+"px",$("#creatorRecordFrame").css({"max-height":"calc(100vh - 200px)"}),showAnimatePopup("topBandPopup"),EvalInnerScript($("#topBandPopup").get(0))}),i)},CustomRelatedListObj.editCreatorRecord=function(e,t){var a=$("[name='module']").val(),r=$("[name='id']").val(),i=Crm.getCrmBasePath()+"/CustomRelatedList.do",o="action=editCreatorRecord&recordId="+e+"&listRelationId="+t+"&module="+a+"&entityId="+r+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);mR(i,(function(e){var t=$("#topBandPopup");t.empty(),t[0].innerHTML=e,showAnimatePopup("topBandPopup"),setDivWidthHeight("topBandPopup"),t.css({width:"910px"}),t.show(),getObj("creatorRecordFrame").height=parseInt(getObj("topBandPopup").style.height)+50+"px",$("#creatorRecordFrame").css({"max-height":"calc(100vh - 200px)"}),EvalInnerScript($("#topBandPopup").get(0))}),o)},CustomRelatedListObj.togglerelatedlistmenu=function(e,t,a){hideMenu(e);var r="customRelatedListMenuDiv"+a,i=document.getElementById(r);"hide"!=t&&"none"==i.style.display?(i.style.display="block",$("#rlDropDown_"+a).css("visibility","visible"),$("#rlDropDown_"+a).removeClass("newRlEdit"),$("#rlDropDown_"+a).addClass("selectRlEdit")):(i.style.display="none",$("#rlDropDown_"+a).removeClass("selectRlEdit"),$("#rlDropDown_"+a).addClass("newRlEdit")),sE(e)},CustomRelatedListObj.showDeleteCustomFunctionAlertDiv=function(e){freezeBackground();var t="<div class='p30 f14'>"+I18n.getMsg("crm.label.newrelatedlist.customfunction.delete.confirmMsg")+"<br><br><input type='button' value='"+I18n.getMsg("crm.button.delete")+"' class='redbtn' onclick='CustomRelatedListObj.deleteCustomFunction(\""+e+"\")'>&nbsp;&nbsp;<input type='button' value='"+I18n.getMsg("crm.button.cancel")+"' class='newgraybtn' onclick='crmui.hidePopup(\"lookupdiv\")'></div>";$("#lookupdiv").html(t),$("#lookupdiv").css("zIndex",10002),$("#FreezeLayer").css("zIndex",10001),mailsetCenter("lookupdiv"),$("#lookupdiv").show()},CustomRelatedListObj.showCreatorRecord=function(e,t){var a=$("[name='module']").val(),r=$("[name='id']").val(),i=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=showCreatorRecord&recordId="+e+"&listRelationId="+t+"&module="+a+"&entityId="+r;mR(i,(function(e){var t=$("#topBandPopup");t.empty(),t[0].innerHTML=e,showAnimatePopup("topBandPopup"),setDivWidthHeight("topBandPopup"),t.css({width:"910px"}),t.show(),getObj("creatorRecordFrame").height=parseInt(getObj("topBandPopup").style.height)+50+"px",EvalInnerScript($("#topBandPopup").get(0))}))},CustomRelatedListObj.openFunction=function(e,t,a,r){var i=detailView.currentModule,o=$("[name="+("workflowLinkId_"+e)+"]").val(),s="";customFunctionsObj.langauge="deluge",customFunctionsObj.category="relatedlist";var n=a+"_insDiv";getObj(n)&&(s=getObj(n).value);var l=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=showCustomFunctionInfo&workflowLinkId="+o+"&currentModule="+i+"&frm="+t+"&install="+s;mR(l,(function(e){if("true"==r){var t=$("#newRelatedListPopUpDiv");$("#crl_customfunction_list").hide();var a=$("#newRelatedListPopUpDiv");t.hide().removeClass().addClass("newpopup p30 w720 newPopupStyleEle"),a.html(e),a.css("zIndex",200),commonUtils.showHideLoadingDiv(),a.css({padding:"0px",width:"1000px"}),crmui.showPopup({id:"newRelatedListPopUpDiv",escToClose:!1}),t.show()}else $("#topBandPopup").empty(),$("#topBandPopup")[0].innerHTML=e,showAnimatePopup("topBandPopup"),EvalInnerScript($("#topBandPopup").get(0))}))},CustomRelatedListObj.loadCustomRelatedListFunction=function(e,t,a,r){null==r&&(r="deluge"),"install"==t&&$("input[name='installButton']").prop("disabled",!0);var i=detailView.currentModule;!i&&CustomRelatedListObj.fromModuleBuilder&&(i=CrmPageLayout.module);var o=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=getCustomFunctionParams&workflowLinkId="+e+"&currentModule="+i+"&condition="+t+"&functionName="+a+"&language="+r;mR(o,(function(e){if("funcNameDuplicated"==e)alert(I18n.getMsg("crm.label.newrelatedlist.functionname.duplicate")),$("input[name='installButton']").prop("disabled",!1);else if("customRelatedListIncreasedCountExceeded"==e)alert(I18n.getMsg("crm.label.newrelatedlist.increasedcount.exceeded")),"install"==t&&$("input[name='installButton']").prop("disabled",!1);else if(-1!=e.toString().indexOf("customRelatedListCountExceeded")){var a=e.split(":")[1];alert(I18n.getMsg("crm.label.newrelatedlist.exceeded",a)),removeFreezeLayer(),"install"==t&&$("input[name='installButton']").prop("disabled",!1)}else{$("#topBandPopup").empty(),$("#topBandPopup")[0].innerHTML=e,crmui.hidePopup("newRelatedListPopUpDiv",!0),showAnimatePopup("topBandPopup");var r=0,i=$(".confParamRow").length;for(r=0;r<i;r++)ZohoDRE.addPlaceholder(r+1);freezeBackground()}}))},CustomRelatedListObj.getInfoToPublishCustomFunction=function(e,t){var a=Crm.getCrmBasePath()+"/CustomRelatedList.do";mR(a,(function(e){$("#topBandPopup").html(e)}),"action=getInfoToPublishCustomFunction&workflowLinkId="+e+"&functionName="+t)},CustomRelatedListObj.loadCreatorFunctionEdit=function(e,t,a){var r=$("[name='module']").val();!r&&CustomRelatedListObj.fromModuleBuilder&&(r=CrmPageLayout.module);var i=$("[name='relatedlistId']").val();if(null==i&&(i=0),customFunctionsObj.listRelationId=i,"update"==t)var o=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=showCustomFunctionDelugeEditor&module="+r+"&workflowLinkId="+e+"&condition=update&listRelationId="+i;else o=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=showCustomFunctionDelugeEditor&module="+r+"&workflowLinkId="+e+"&listRelationId="+i;if("true"==a){for(var s=$(".confParamRow").length,n="",l="",d=1;d<=s;d++){var c=$("#confparamValue_"+d),u=$("#entityParamName"+d),m=0===u.length?$("#customParamName"+d)[0].outerText:u[0].outerText;if("entity"===c.attr("type")){var p=c.find(".mergespan").attr("value");"automation"!==customFunctionsObj.isFrom&&(p=p.split("&&&")[0]),n=""===n?m+"="+p:n+","+m+"="+p}else{p=c[0].textContent;l=c.attr("placeholder")?m+"=":""==l?m+"="+p:l+","+m+"="+p}}o=o+"&crlEntityParams="+encodeURIComponent(n)+"&crlCustomParams="+encodeURIComponent(l)+"&relatedListName="+$("#relatedListNameTemp").val()}o=o+"&language="+$("#language").val(),mR(o,(function(e){$("#freezeBackGround").hide(),$("#topBandPopup").hide(),customFunctionsObj.listrelationid=i;var t=[],a=[];if((e=JSON.parse(e)).entityParams)for(var r=(n=e.entityParams.split(",")).length,o=0;o<r;o++){var s=n[o];(l={}).name=s.split("=")[0],l.value=s.split("=")[1],t.push(l)}if(e.customParams){var n;for(r=(n=e.customParams.split(",")).length,o=0;o<r;o++){var l;s=n[o];(l={}).name=s.split("=")[0],l.value=s.split("=")[1],a.push(l)}}customFunctionsObj.renderEditorView(JSON.stringify(e),t,a)}))},CustomRelatedListObj.showHideCustomField=function(e,t){if("txtbox"==e){var a="entityParamSelect"+t;getObj(a).style.display="none";var r="customParam"+t;getObj(r).style.display="",getObj("entityParamName"+t).id="customParamName"+t;var i="valType"+t;getObj(i).value="custom",$("#customParamVal"+t).focus()}else if("entity"==e){r="customParam"+t;getObj(r).style.display="none";a="entityParamSelect"+t;getObj(a).style.display="",getObj("customParamName"+t).id="entityParamName"+t;i="valType"+t;getObj(i).value="entity"}},CustomRelatedListObj.listGallery=function(){if($("#existingFunctionList, #existingCFBottom").hide(),null!=usernameNeeded&&"boolean"==typeof usernameNeeded&&1==usernameNeeded&&-1==jQuery.inArray("creator",usernameNotNeeded)){hideAnimatePopup("topBandPopup");commonUtils.checkUsernameNeeded((function(){CustomRelatedListObj.addNewRelatedList()}),"creator")}else{var e=$("[name='module']").val(),t=($("[name='id']").val(),Crm.getCrmBasePath()+"/CustomRelatedList.do?action=listGallery&module="+e);mR(t,(function(e){$("#topBandPopup").html(e),showAnimatePopup("topBandPopup"),commonUtils.showHideLoadingDiv()}))}},CustomRelatedListObj.addArgument=function(){var e=$("[name='index']").val(),t="clonedargument-tr"+e,a=$("#argument-body"),r=$("#dummyargument-tr"),i=r.clone();i.attr("id",t),a.append(i,r),i.show();var o="#clonedargument-tr"+e+" input",s="#clonedargument-tr"+e+" select";$(o).attr("id","argumentName"+e),$(o).attr("name","argumentName"+e),$(s).attr("id","argumentType"+e),$(s).attr("name","argumentType"+e),$(s).next(".select2").remove(),thirdPartyUtils.bindSelect2($(s));var n=parseInt(e)+1;$("[name='index']").val(n)},CustomRelatedListObj.deleteArgument=function(e){$(e).parent().parent().remove();var t=$("[name='index']").val();$("[name='index']").val(--t)},CustomRelatedListObj.loadCustomViews=function(){var e=$("#creatorFieldsSelect0").find(":selected").val(),t=$("#entityParamVal").find(":selected").val();"-1"!=e&&"-1"!=t?($("#viewAndFieldsDiv").css("visibility","visible"),loadViewsOfSelectedForm()):($("#viewAndFieldsDiv").css("visibility","hidden"),$("#columnSelectDiv").html(""))},CustomRelatedListObj.addCustomFunction=function(e){customFunctionsObj.constructCFBodyDiv(),$("#createfunctionpopdiv").html(""),crmui.hidePopup("newRelatedListPopUpDiv"),Lyte.Component.render("crm-createfunction-pop",{formdata:{name:"",description:"",category:"cf_select",language:customFunctionsObj.language,type:"editor"},disableNextBtn:!1,from:"relatedlist"},"#createfunctionpopdiv"),document.querySelector("#createNewFunction").ltProp("show",!0)},CustomRelatedListObj.deleteCustomRelatedList=function(e,t){$("[name='rlContentChngd']").val("true");var a=Crm.getCrmBasePath()+"/CustomRelatedList.do",r="action=delRelatedList&listRelationId="+e+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&module="+t;mR(a,(function(t){$("#lookupdiv").empty(),getObj("lookupdiv").style.display="none",removeFreezeLayer(),CustomRelatedListObj.fromModuleBuilder?$("#unUsedRelatedListsHolder").find("[relid='RL_"+e+"']").remove():reloadRelatedList(),Crm.userDetails.MPL_MIGRATION_COMPLETED&&$("#customRelListDelPop").remove(),store.unloadRecord("related_list",e)}),r)},CustomRelatedListObj.saveNewCreatorFunction=function(e){$("input[name='saveCreatorFunCButton']").prop("disabled",!0);var t=$("[name='functionName']").val(),a=$("#custom_rl_name").val(),r=$("#module").val(),i=$("#isDRE").val(),o=1;if(""==a)alert(I18n.getMsg("Related List Name cannot be empty")),$("#custom_rl_name").focus(),$("input[name='saveCreatorFunCButton']").prop("disabled",!1);else if(""==t)alert(I18n.getMsg("crm.label.newrelatedlist.functionempty")),$("[name='functionName']").focus(),$("input[name='saveCreatorFunCButton']").prop("disabled",!1);else{var s=CustomRelatedListObj.validateCustomRelatedListField(t,"name");if(s)alert(I18n.getMsg("crm.label.newrelatedlist.functionname.error")),$("[name='functionName']").focus(),$("input[name='saveCreatorFunCButton']").prop("disabled",!1);else if(s=validateIsNumberAsFirstChar(t))alert(I18n.getMsg("crm.label.newrelatedlist.functionname.number")),$("[name='functionName']").focus(),$("input[name='saveCreatorFunCButton']").prop("disabled",!1);else if(s=validateFieldLength(t,100))alert(I18n.getMsg("crm.label.newrelatedlist.functionname.lengthexceeded")),$("[name='functionName']").focus(),$("input[name='saveCreatorFunCButton']").prop("disabled",!1);else if(s=validateForForeignLanguage(t))alert(I18n.getMsg("crm.label.newrelatedlist.functionname.foreignlanguage.error")),$("[name='functionName']").focus(),$("input[name='saveCreatorFunCButton']").prop("disabled",!1);else{var n=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=validateCustomFunctionName&functionName="+t+"&relatedListName="+a+"&module="+r;mR(n,(function(e){if("Related List Name is duplicated"==e)return alert("Related List Name already exists"),$("#relatedListName").focus(),$("input[name='saveCreatorFunCButton']").prop("disabled",!1),!1;if("true"==e)return o=-1,alert(I18n.getMsg("crm.label.newrelatedlist.functionname.duplicate")),$("[name='functionName']").focus(),$("input[name='saveCreatorFunCButton']").prop("disabled",!1),!1;var r=$("[name='description']").val();if(s=validateFieldLength(r,2500))alert(I18n.getMsg("crm.label.description.exceeded")),$("input[name='saveCreatorFunCButton']").prop("disabled",!1);else{var n="",l="",d=$("[name='index']").val();if($("#argument-body tr input").each((function(e){if(e>=d)return $("input[name='saveCreatorFunCButton']").prop("disabled",!1),!1;if(""==$(this).val()&&-1!=o)return o=-1,alert(I18n.getMsg("crm.label.newrelatedlist.argempty")),$("input[name='saveCreatorFunCButton']").prop("disabled",!1),!1;var t=CustomRelatedListObj.validateCustomRelatedListField($(this).val());if(t&&-1!=o)return o=-1,alert(I18n.getMsg("crm.label.newrelatedlist.argempty.error")),$("input[name='saveCreatorFunCButton']").prop("disabled",!1),!1;if((t=validateIsNumberAsFirstChar($(this).val()))&&-1!=o)return o=-1,alert(I18n.getMsg("crm.label.newrelatedlist.argempty.number")),$("input[name='saveCreatorFunCButton']").prop("disabled",!1),!1;if((t=validateForForeignLanguage($(this).val()))&&-1!=o)o=-1,alert(I18n.getMsg("crm.label.newrelatedlist.argumentname.foreignlanguage.error")),$("[name='functionName']").focus(),$("input[name='saveCreatorFunCButton']").prop("disabled",!1);else{if((t=validateFieldLength($(this).val(),100))&&-1!=o)return o=-1,alert(I18n.getMsg("crm.label.newrelatedlist.argumentname.lengthexceeded")),$("input[name='saveCreatorFunCButton']").prop("disabled",!1),!1;n=0==e?$(this).val():n+"#sargn#"+$(this).val()}})),1==o){var c=n.split("#sargn#");c=c.sort();for(var u=new Array,m=0;m<c.length-1;m+=1)c[m+1]==c[0]&&u.push(c[0]);if(u.length>0)return o=-1,alert(I18n.getMsg("crm.label.newrelatedlist.argumentname.duplicate")),!1}if(1==o){$("#argument-body tr select").each((function(e){if(e>=d)return!1;l=0==e?$(this).val():l+"#sargt#"+$(this).val()}));var p=$("[name='module']").val(),h=($("[name='id']").val(),Crm.getCrmBasePath()+"/CustomRelatedList.do"),f="action=createCustomFunctionInZohoCreator&module="+p+"&functionName="+t+"&argName="+encodeURIComponent(n)+"&argType="+encodeURIComponent(l)+"&desc="+encodeURIComponent(r)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&relatedListName="+a;mR(h,(function(e){if("true"==i){var t=$("#newRelatedListPopUpDiv");t.hide().removeClass().addClass("newpopup p30 w720 newPopupStyleEle"),t.html(e),t.css("zIndex",200),t.css({padding:"0px",width:"1000px"}),crmui.showPopup({id:"newRelatedListPopUpDiv",escToClose:!1}),t.show()}else $("#topBandPopup").empty(),$("#topBandPopup")[0].innerHTML=e,showAnimatePopup("topBandPopup"),getObj("funcEditFrame").width="850px",getObj("funcEditFrame").height="500px",EvalInnerScript($("#topBandPopup").get(0));commonUtils.showHideLoadingDiv()}),f)}}}))}}},CustomRelatedListObj.showGalleryFunctionDesc=function(e,t,a){var r=$("[name='module']").val(),i=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=showCustomFunctionInfo&workflowLinkId="+e+"&currentModule="+r+"&frm=gallery&install="+a;mR(i,(function(e){$("#topBandPopup").empty(),$("#topBandPopup")[0].innerHTML=e,showAnimatePopup("topBandPopup"),EvalInnerScript($("#topBandPopup").get(0))}))},CustomRelatedListObj.addCustomAppAsRL=function(e,t){var a=$("[name='module']").val(),r=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=showFormsAndViewsOfAnCustomApp&module="+a+"&appLinkName="+e+"&appName="+t;CustomRelatedListObj.fromModuleBuilder&&(r+="&fromModuleBuilder=true"),mR(r,(function(e){"NoForms"==e?alert(I18n.getMsg("crm.newrelatedlist.label.customApps.noMappingField")):($("#topBandPopup").html(e),showAnimatePopup("topBandPopup"),commonUtils.showHideLoadingDiv())}))},CustomRelatedListObj.deleteCustomFunction=function(e){var t=$("[name='module']").val(),a=Crm.getCrmBasePath()+"/CustomRelatedList.do",r="action=deleteCustomFunction&module="+t+"&workflowLinkId="+e+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);mR(a,(function(e){$("#lookupdiv").hide(),CustomRelatedListObj.listCustomFunctions(),crmui.hidePopup("lookupdiv")}),r)},CustomRelatedListObj.viewCustomFunctionScript=function(e,t,a){var r=Crm.getCrmBasePath()+"/CustomRelatedList.do";mR(r,(function(e){$("#topBandPopup").html(e)}),"action=viewCustomFunctionScript&workflowLinkId="+e+"&functionName="+t+"&isInstalled="+a)},CustomRelatedListObj.publishCustomFunction=function(e,t,a,r){void 0===a&&(a=null),void 0===r&&(r=null);var i=$("[name='functionName']").val().trim();if(""==i)renderingUtils.displayErrorDiv("functionName","Name","crm.label.customfunction.publishgallery.functionNameempty"),$("[name='functionName']").focus();else{var o=getClrTxtPtnResChars(i);if(""!=o)functionNameErrorMsg=I18n.getMsg("crm.label.customfunction.publishgallery.functionName.error")+" "+o,alert(functionNameErrorMsg),$("[name='functionName']").focus();else if(validateFieldLength(i,100))renderingUtils.displayErrorDiv("functionName","Name","crm.label.newrelatedlist.functionname.lengthexceeded"),$("[name='functionName']").focus();else{var s=$("[name='funcDescription']").val().trim();if(""==s)renderingUtils.displayErrorDiv("functionDescription","Description","crm.label.customfunction.publishgallery.descriptionempty"),$("[name='funcDescription']").focus();else if(validateFieldLength(s,2500))renderingUtils.displayErrorDiv("functionDescription","Description","crm.label.description.exceeded"),$("[name='funcDescription']").focus();else{var n=$("[name='authorName']").val().trim();if(""==n)renderingUtils.displayErrorDiv("authorName","Name","crm.label.customfunction.publishgallery.authorNameempty"),$("[name='authorName']").focus();else if(""!=(o=getClrTxtPtnResChars(n)))authorNameErrorMsg=I18n.getMsg("crm.label.customfunction.publishgallery.authorName.error")+" "+o,alert(authorNameErrorMsg),$("[name='authorName']").focus();else if(validateFieldLength(n,100))renderingUtils.displayErrorDiv("authorName","Name","crm.label.customfunction.publishgallery.authorname.lengthexceeded"),$("[name='authorName']").focus();else{freezeBackground();var l="<div><div class='f21 bbd pB5'>"+I18n.getMsg("crm.label.confirmation")+"</div><br/><ul type='disc'><li class=pL10 mT10' style='list-style:square;'>"+I18n.getMsg("crm.label.customfunction.publish.message1")+"</li><li class='pL10 mT10' style='list-style:square;'>"+I18n.getMsg("crm.label.customfunction.publish.message2")+"</li><li class='pL10 mT10' style='list-style:square;'>"+I18n.getMsg("crm.label.customfunction.publish.message3")+"</li><li class='pL10 mT10' style='list-style:square;'>"+I18n.getMsg("crm.label.customfunction.publish.message4")+"</li></ul><br/><div class='mt15'><input type='button' value='"+I18n.getMsg("crm.button.customfunction.publish.message.understand")+"'class='primarybtn' onclick='CustomRelatedListObj.publishCustomFunctionToGallery(\""+e+'", '+t+', "'+a+'", "'+r+"\")'>&nbsp;&nbsp;<input type='button' value='"+I18n.getMsg("crm.button.cancel")+"' class='newgraybtn' onclick='crmui.hidePopup(\"lookupdiv\")'></div></div>";$("#lookupdiv").html(l),$("#lookupdiv").css("zIndex",1e4),crmui.showPopup("lookupdiv")}}}}},CustomRelatedListObj.publishCustomFunctionToGallery=function(e,t,a,r){functionName=$("[name='functionName']").val().trim(),authorName=$("[name='authorName']").val().trim(),desc=$("[name='funcDescription']").val().trim();var i=Crm.getCrmBasePath()+"/CustomRelatedList.do",o="action=publishCustomFunctionToGallery&functionDisplayName="+functionName+"&authorName="+authorName+"&workflowLinkId="+e+"&description="+encodeURIComponent(desc)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+(t?"&isWorkFlow=true":"");mR(i,(function(e){t?(showURLinPopup(Crm.getCrmBasePath()+"/WorkFlowDeluge.do?step=newWFDeluge1&fromSource="+a+"&relatedModule="+r,"800px","auto",void 0,void 0,!0,!1,!0),crmui.hidePopup("lookupdiv")):(CustomRelatedListObj.listCustomFunctions(),crmui.hidePopup("lookupdiv"))}),o)},CustomRelatedListObj.showDeleteCreatorRecordAlertDiv=function(e,t){freezeBackground();var a="<div class='p30 f14'>"+I18n.getMsg("crm.label.newrelatedlist.customapp.creatorrecord.delete.confirmMsg")+"<br><br><input type='button' value='"+I18n.getMsg("crm.button.delete")+"' class='redbtn' onclick='CustomRelatedListObj.deleteCreatorRecord(\""+e+'", "'+t+"\" )'>&nbsp;&nbsp;<input type='button' value='"+I18n.getMsg("crm.button.cancel")+"' class='newgraybtn' onclick='hide(\"lookupdiv\")'></div>";$("#lookupdiv").html(a),mailsetCenter("lookupdiv"),$("#lookupdiv").show()},CustomRelatedListObj.deleteCreatorRecord=function(e,t){var a=Crm.getCrmBasePath()+"/CustomRelatedList.do",r=$("[name='module']").val(),i="action=deleteCreatorRecord&recordId="+e+"&listRelationId="+t+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&module="+r,o=$("[name='id']").val();mR(a,(function(e){hide("lookupdiv"),0!=e.indexOf("success")&&alert(I18n.getMsg(e)),CustomRelatedListObj.checkForCanvasMode()?CustomRelatedListObj.reloadRL(t):CustomRelatedListObj.connectToCustomRelatedList(r,t,o)}),i)},CustomRelatedListObj.connectToCustomRelatedList=function(e,t,a){if(("undefined"!=typeof WidgetHandler?WidgetHandler.getWidget("RelatedList",t):void 0)||null==usernameNeeded||"boolean"!=typeof usernameNeeded||1!=usernameNeeded||-1!=jQuery.inArray("creator",usernameNotNeeded)){var r=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=getCustomRelatedListRecords&module="+e+"&listRelationId="+t+"&entityId="+a,i="#customRelatedListDiv_"+t;if(0!=$(i).length){var o="<table border='0' width='95%' cellspacing='0' cellpadding='0' align='center' class='norec'> <tbody><tr> <td class='p15'><center><img height='20' src='"+networkUtils.getImageUrl("moreloading1_81c3cbe_.gif",ResourceConstants.CRM)+"'></center></td> </tr> </tbody></table>";$(i).html(o)}mR(r,(function(e){0!=$(i).length?($(i).html(e),$("#newleft_"+t).length&&populateRLCount(t,!0)):getOpenerObj(t)&&($(getOpenerObj(t)).empty(),getOpenerObj(t).innerHTML=""+e)}),"",(function(){var e="<table border='0' width='100%' cellspacing='0' cellpadding='0' align='center' class='norec'><tbody><tr><td valign='center'><div class='pR30 italic fontsmooth'>"+I18n.getMsg("crm.label.xmlparseError")+"</div></td></tr></tbody></table>";0!=$(i).length?$(i).html(e):getOpenerObj(t)&&($(getOpenerObj(t)).empty(),getOpenerObj(t).innerHTML=""+e)}),"false")}else{commonUtils.checkUsernameNeeded((function(){CustomRelatedListObj.connectToCustomRelatedListAsCallback(e,t,a)}),"creator")}},CustomRelatedListObj.listCreatorApps=function(){var e=$("[name='module']").val(),t=($("[name='id']").val(),Crm.getCrmBasePath()+"/CustomRelatedList.do?action=listCreatorApps&module="+e);mR(t,(function(e){if("customRelatedListIncreasedCountExceeded"==e)alert(I18n.getMsg("crm.label.newrelatedlist.increasedcount.exceeded"));else if(-1!=e.toString().indexOf("customRelatedListCountExceeded")){var t=e.split(":")[1];alert(I18n.getMsg("crm.label.newrelatedlist.exceeded",t))}else $("#topBandPopup").html(e),showAnimatePopup("topBandPopup"),commonUtils.showHideLoadingDiv()}))},CustomRelatedListObj.saveCustomRelatedList=function(e){$("#language").val(customFunctionsObj.language);var t=$(e);return CustomRelatedListObj.fromModuleBuilder&&t.find("input[name='fromModuleBuilder']").length<=0?t.append("<input type='hidden' name='fromModuleBuilder' value='true'>"):!CustomRelatedListObj.fromModuleBuilder&&t.find("input[name='fromModuleBuilder']").length>0&&t.find("input[name='fromModuleBuilder']").remove(),"true"===Crm.userDetails.MPL_MIGRATION_COMPLETED&&!CustomRelatedListObj.fromModuleBuilder&&null!=$("#entityID").val()&&t.find("input[name='entityId']").length<=0&&t.append("<input type='hidden' name='entityId' value='"+$("#entityID").val()+"'>"),UpdateDetails(["customRelatedListSubmit"],e,"","",(function(e){if(CustomRelatedListObj.checkForCanvasMode()&&null!=CustomRelatedListObj.currentRLId){var t=$("#relatedListName").val(),a=$L(".customRLName_"+CustomRelatedListObj.currentRLId);a.length>0&&a.text(t),hideAnimatePopup("topBandPopup",!0),removeFreezeLayer(),CustomRelatedListObj.reloadRL(CustomRelatedListObj.currentRLId),CustomRelatedListObj.currentRLId=void 0}else if(CustomRelatedListObj.fromModuleBuilder)hideAnimatePopup("topBandPopup"),removeFreezeLayer(),CMB.showCustomRelatedList(e);else{t=$("#relatedListName").val();reloadRelatedList();var r=$("#clType").val();setTimeout((function(){CustomRelatedListObj.showRLSuccessDiv(t,r)}),2e3),$.scrollTo("#topBandPopup",{axis:"y",duration:1e3,offset:-50})}}))},CustomRelatedListObj.saveCustomAppAsRLCallback=function(e){if(CustomRelatedListObj.checkForCanvasMode()&&null!=CustomRelatedListObj.currentRLId){var t=$("#relatedListTemp").val(),a=$L(".customRLName_"+CustomRelatedListObj.currentRLId);a.length>0&&a.text(t),CustomRelatedListObj.reloadRL(CustomRelatedListObj.currentRLId),hideAnimatePopup("topBandPopup",!0),removeFreezeLayer(),CustomRelatedListObj.currentRLId=void 0}else CustomRelatedListObj.fromModuleBuilder?(hideAnimatePopup("topBandPopup"),removeFreezeLayer(),CMB.showCustomRelatedList(e)):(reloadRelatedList(),$.scrollTo("#topBandPopup",{axis:"y",duration:1e3,offset:-50}))},CustomRelatedListObj.loadCustomFunctionInCallBack=function(e,t,a,r){var i=$("[name='module']",parent.document).val();if("edit"!=t){var o=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=getCustomFunctionParams&workflowLinkId="+e+"&currentModule="+i+"&condition="+t+"&functionName="+a;mR(o,(function(e){$("#topBandPopup").empty(),$("#topBandPopup",parent.document)[0].innerHTML=e,EvalInnerScript($("#topBandPopup").get(0))}))}else{var s=r.substr(r.indexOf("_")+1,r.length);o=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=editCustomRelatedList&module="+i+"&listRelationId="+s;mR(o,(function(e){$("#topBandPopup").empty(),$("#topBandPopup",parent.document)[0].innerHTML=e,EvalInnerScript($("#topBandPopup").get(0))}))}},CustomRelatedListObj.connectToCustomRelatedListAsCallback=function(e,t,a){reloadRelatedList(""),CustomRelatedListObj.connectToCustomRelatedList(e,t,a)},CustomRelatedListObj.addNewCustomFuntion=function(){freezeBackground(),loadAjaxTab("","lightblue"),setDivWidthHeight("topBandPopup");var e=$("[name='modulelist']").val(),t=Crm.getCrmBasePath()+"/CustomButton.do?step=createNewButtonFunction&module="+e;mR(t,(function(e){if("customRelatedListIncreasedCountExceeded"==e)alert(I18n.getMsg("crm.label.newrelatedlist.increasedcount.exceeded"));else if(-1!=e.toString().indexOf("customRelatedListCountExceeded")){var t=e.split(":")[1];alert(I18n.getMsg("crm.label.newrelatedlist.exceeded",t))}else $("#topBandPopup").empty(),$("#topBandPopup")[0].innerHTML=e,showAnimatePopup("topBandPopup"),EvalInnerScript($("#topBandPopup").get(0))}))},CustomRelatedListObj.doCustomRleatedList=function(e,t,a){CustomRelatedListObj.downloadRLFunctionFiles((function(){customFunctionsObj.isFrom="relatedlist";var r,i=e.substr(e.indexOf("_")+1,e.length);r=null!=a&&null==detailView.currentModule?a:detailView.currentModule;var o=$("[name='id']").val();if($("#customRelatedListMenuDiv"+i).hide(),$("#rlDropDown_"+i).css("visibility","hidden"),!r&&CustomRelatedListObj.fromModuleBuilder&&(r=CrmPageLayout.module),"edit"==t)if(null!=usernameNeeded&&"boolean"==typeof usernameNeeded&&1==usernameNeeded&&-1==jQuery.inArray("creator",usernameNotNeeded)){commonUtils.checkUsernameNeeded((function(){CustomRelatedListObj.doCustomRleatedList(e,t)}),"creator")}else{loadAjaxTab("","lightblue");var s=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=editCustomRelatedList&module="+r+"&listRelationId="+i;CustomRelatedListObj.fromModuleBuilder&&(s+="&fromModuleBuilder=true"),mR(s,(function(e){$("#topBandPopup").empty(),$("#topBandPopup")[0].innerHTML=e,showAnimatePopup("topBandPopup"),freezeBackground(),commonUtils.showHideLoadingDiv(),EvalInnerScript($("#topBandPopup").get(0))}))}else if("hide"==t){s=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=hideRelatedList&module="+r+"&listRelationId="+i+"&entityId="+o;var n=csrfParamName+"="+encodeURIComponent(csrfToken);mR(s,(function(e){reloadRelatedList("reload")}),n)}else if("reorder"==t)showCustomizePopup("RelatedList",r);else if("del"==t)if(Crm.userDetails.MPL_MIGRATION_COMPLETED){var l=CustomRelatedListObj.fromModuleBuilder,d={};d.listrelationId=i,d.module=r,d.isFromModuleBuilder=l,l?d.layoutId=CrmPageLayout.layoutId:returnJson&&returnJson.layout_jsonarrayObj&&(d.layoutId=returnJson.layout_jsonarrayObj.currLayoutId);s=Crm.getCrmBasePath()+"/CustomRelatedList.do";(n={action:"validateDeleteCustomRL"}).cfInfoJson=JSON.stringify(d),n[csrfParamName]=encodeURIComponent(csrfToken),mR(s,(function(e){freezeBackground();var t=JSON.parse(e),a=$(Handlebars.templates.relatedListDeletePop()),o=a.find("#flddelmsg");if(a.find("#WrngTitle").text(I18n.getMsg("crm.label.relatedlist.delete.popup.heading",t.label)),o.html(""),t.layoutIds){for(var s=t.layoutIds,n="<b>"+s[0]+"</b>",l=s.length,d=1;d<l-1;d++)n=n+", <b>"+s[d]+"</b>";l>2?n=n+", "+I18n.getMsg("crm.label.lowercase.and")+" <b>"+s[s.length-1]+"</b>":l>1&&(n=n+" "+I18n.getMsg("crm.label.lowercase.and")+" <b>"+s[s.length-1]+"</b>"),o.append("<p>"+I18n.getMsg("crm.label.relatedlist.delete.popup.desc.msg",n)+"</p>")}o.append("<p>"+I18n.getMsg("crm.label.relatedlist.delete.popup.desc",n)+"</p>"),a.find(".redbtn").val(I18n.getMsg("crm.button.yes.delete.it")).attr("onclick",'CustomRelatedListObj.deleteCustomRelatedList("'+i+'","'+r+'")'),a.find(".newgraybtn").val(I18n.getMsg("crm.label.auto.enrich.deactivate.confirm.no")).attr("onclick","CustomRelatedListObj.closeRLDeleteAlartPopup()"),$("body").append(a)}),n)}else{freezeBackground();var c="<div class='p30 f14 delRelateListPop'>"+I18n.getMsg("crm.label.newrelatedlist.delete.confirmMsg")+"<br><br><input type='button' value='"+I18n.getMsg("crm.button.delete")+"' class='redbtn' onclick='CustomRelatedListObj.deleteCustomRelatedList(\""+i+'","'+r+"\")'>&nbsp;&nbsp;<input type='button' value='"+I18n.getMsg("crm.button.cancel")+"' class='newgraybtn' onclick='CustomRelatedListObj.closeWarningMessage(\"lookupdiv\")'></div>";$("#lookupdiv").html(c),mailsetCenter("lookupdiv"),$("#lookupdiv").css("zIndex",10001),$("#lookupdiv").show()}}))},CustomRelatedListObj.closeRLDeleteAlartPopup=function(){$("#customRelListDelPop").remove(),removeFreezeLayer()},CustomRelatedListObj.validateCustomRelatedListField=function(e,t){var a=!1;return"name"!=t?a=validateFields(e):(a=isFieldEmpty(e))||(a=validateSplCharInNameFields(e)),a||(a=validateWhiteSpace(e)),a},CustomRelatedListObj.checkSpecialChar=function(e){var t,a=new Array("`","~","!","#","^","*","[","]","{","}","|","\\",'"',";","'","&","+","%","(",")","@","?",":","<",">",":",".",",","$","=","/");for(t=0;t<a.length;t++)if(e.indexOf(a[t])>=0)return!0;return!1},CustomRelatedListObj.showRLSuccessDiv=function(e,t){"edit"?($("#DefaultRLSuccessMsg").html(I18n.getMsg("crm.newrelatedlist.label.releatedList.updated")),mailsetCenter("DefaultRLSuccessMsg"),show("DefaultRLSuccessMsg"),setTimeout((function(){$("#DefaultRLSuccessMsg").hide()}),2e3)):($("#DefaultRLSuccessMsg").html(I18n.getMsg("crm.newrelatedlist.label.releatedList.added")),mailsetCenter("DefaultRLSuccessMsg"),show("DefaultRLSuccessMsg"),setTimeout((function(){$("#DefaultRLSuccessMsg").hide()}),2e3))},CustomRelatedListObj.closeCreatorRecordDiv=function(e,t,a){hideAnimatePopup("topBandPopup"),CustomRelatedListObj.checkForCanvasMode()?CustomRelatedListObj.reloadRL(t):CustomRelatedListObj.connectToCustomRelatedList(e,t,a)},CustomRelatedListObj.deleteCustomRLFromCustomApps=function(e,t,a){var r=Crm.getCrmBasePath()+"/CustomRelatedList.do",i="action=delRelatedList&listRelationId="+e+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);mR(r,(function(){CrmCreatorCustomAppObj.showCustomAppsToRelatedList(t,a),CustomRelatedListObj.hideDeleteCustomRLFromCustomAppsAlertDiv("lookupdiv")}),i)},CustomRelatedListObj.hideDeleteCustomRLFromCustomAppsAlertDiv=function(e){getObj(e).style.display="none",$("#FreezeLayer").css("zIndex",30)},CustomRelatedListObj.showDeleteCustomRLFromCustomAppsAlertDiv=function(e,t,a){freezeBackground();var r="<div class='p30 f14'>"+I18n.getMsg("crm.label.newrelatedlist.delete.confirmMsg")+"<br><br><input type='button' value='"+I18n.getMsg("crm.button.delete")+"' class='redbtn' onclick='CustomRelatedListObj.deleteCustomRLFromCustomApps(\""+e+'","'+t+'","'+a+"\")'>&nbsp;&nbsp;<input type='button' value='"+I18n.getMsg("crm.button.cancel")+"' class='newgraybtn' onclick='CustomRelatedListObj.hideDeleteCustomRLFromCustomAppsAlertDiv(\"lookupdiv\")'></div>";$("#lookupdiv").html(r).css("zIndex",10002).show(),$("#FreezeLayer").css("zIndex",10001),mailsetCenter("lookupdiv")},CustomRelatedListObj.closeEditURL=function(){getObj("creatorFormDiv").style.display="none",$("#creatorFormDiv").empty();var e=$("#FreezeLayer");e.length>0?e.remove():Utils.windowLocationReload()},CustomRelatedListObj.closeWarningMessage=function(e){getObj(e).style.display="none",removeFreezeLayer()},CustomRelatedListObj.openWarningMessage=function(e,t,a){if(getObj("deleteTabName").value=t,"deleteTabGroup"==e)hideMenu(),showDeletePopup(I18n.getMsg("crm.tabgroup.deleteWarning"),"crm.button.delete","","",a);else{if(freezeBackground(),"deActivateCreator"==e)var r="CreatorDeactivationWarningDiv";else if("deleteCreatorTab"==e)r="CreatorDeleteCreatorWarningDiv";else if("creatorEditForm"==e)r="CreatorFormEditWarningDiv";else if("createCreatorAcc"==e)r="CreateCreatorAccWarningDiv";getObj(r).style.display="block",getObj(r).style.zIndex=10001,"deActivateCreator"!=e&&"deleteCreatorTab"!=e&&"createCreatorAcc"!=e||mailsetCenter(r)}},CustomRelatedListObj.cancelOperationInCustomFunction=function(){crmui.hidePopup("newRelatedListPopUpDiv"),$("#addCustomFunctionForm").hide(),removeFreezeLayer(),$("#freezeBackGround").hide(),"undefined"!=typeof zossearch&&zossearch.disbaleGSShortCutKey(!1)},CustomRelatedListObj.updateDRECustomFunction=function(e,t,a,r,i,o,s,n,l){var d={action:"updateDRECustomFunction"};d.functionName=e,d.functionDescription=t,d.workFlowLinkId=a,d.functionScript=r,d[csrfParamName]=encodeURIComponent(csrfToken),d.entityParamName=i,d.entityParamVal=o,d.customParamName=s,d.customParamVal=n,d.module=$("#module").val(),l||(l=0),d.listRelationId=l,d.relatedListName=$("#relatedListNameTemp").val();var c=customFunctionsObj.language;d.language=c;var u=new crmRequestPool,m=Crm.getCrmBasePath()+"/CustomRelatedList.do";u.initiate({data:d,action:m,success:function(e){if($(".functionBtn").removeClass("inActiveSec"),$(".clickSave").removeClass("inActiveSec"),(e=JSON.parse(e)).dreResponse){var t=$("crm-function-editor")[0];t.component.setData("error",""),t.component.setData("output",""),t.component.setData("info",""),$(".functionoutputCont").addClass("hide"),$(".cusFunctOutputCont").hasClass("openCusFunctOutputCont")||$(".ouputToggleHook").click(),$(".errorSaveTagClass").removeClass("hide"),$(".successTagClass").addClass("hide");var a=JSON.parse(e.dreResponse),r=a.errorMessage;return a.lineNumber&&(r=r+" Line Number: "+a.lineNumber),t.component.setData("error",r),!1}if(CustomRelatedListObj&&CustomRelatedListObj.fromModuleBuilder?$("#customizeModuleDiv").show():CustomRelatedListObj.checkForCanvasMode()?$("#show").show():$("#BodyContent").show(),$(".scartch-creation").removeClass("editorVisible").hide(),$("#tabLayer").show(),ZohoDRE.resetRequestData(),0==l||"null"==l){var i=Handlebars.templates.CustomRelatedListName(e),o=$("#newRelatedListPopUpDiv");o.hide().removeClass().addClass("newpopup p30 w720 newInputStyleEle newPopupStyleEle"),o.html(i),o.css("zIndex",200),commonUtils.showHideLoadingDiv(),o.css({padding:"0px",width:"600px"}),crmui.showPopup({id:"newRelatedListPopUpDiv",escToClose:!1})}else crmui.showMsgBand("success",I18n.getMsg("crm.label.relatedlist.save.success"),1e3),crmui.hidePopup("newRelatedListPopUpDiv"),$("#addCustomFunctionForm").hide(),CustomRelatedListObj&&CustomRelatedListObj.fromModuleBuilder?(hideFreezeLayer(),removeFreezeLayer()):CustomRelatedListObj.checkForCanvasMode()?CustomRelatedListObj.reloadRL(l):reloadRelatedList("reload");customFunctionsObj.listRelationId=null}})},CustomRelatedListObj.saveNewCustomRelatedList=function(e){var t=$("#crlRelatedListName").val();if(null!=t&&(t=t.trim()),""==t||!t.length)return crmui.showMsgBand("error",I18n.getMsg("crm.customRL.JSAlert.NameRequired"),"2000"),!1;if(!CustomRelatedListObj.validateRLName())return crmui.showMsgBand("error",I18n.getMsg("crm.customRL.JSAlert.NoSplCharsInName"),"2000"),!1;var a=CustomRelatedListObj.fromModuleBuilder,r=$("#module").val();if(a&&!r&&(r=CrmPageLayout.module),a&&CMB.usedLabels.relatedlistlabels[r].contains(t.toLowerCase()))return crmui.showMsgBand("error",I18n.getMsg("crm.mb.relatedlist.label.dplk"),"2000"),!1;var i=JSON.parse(e);i.relatedListName=t,i.module=r,i.isFromModuleBuilder=a,a?i.layoutId=CrmPageLayout.layoutId:returnJson&&returnJson.layout_jsonarrayObj&&(i.layoutId=returnJson.layout_jsonarrayObj.currLayoutId);var o=Crm.getCrmBasePath()+"/CustomRelatedList.do",s={action:"saveDRECustomRelatedList"};s.cfInfoJson=JSON.stringify(i),s[csrfParamName]=encodeURIComponent(csrfToken),(new crmRequestPool).initiate({data:s,action:o,success:function(e){if("DUPLICATED"==e)return crmui.showMsgBand("error",I18n.getMsg("crm.mb.relatedlist.label.dplk"),"2000"),!1;if(-1!=e.toString().indexOf("customRelatedListCountExceeded")){var t=e.split(":")[1];return crmui.showMsgBand("error",I18n.getMsg("crm.label.newrelatedlist.exceeded",t),"2000"),!1}if(a){var r=JSON.parse(e);CMB.showCustomRelatedList(r)}crmui.showMsgBand("success",I18n.getMsg("crm.label.relatedlist.save.success"),1e3),$("#addCustomFunctionForm").hide(),a?(hideFreezeLayer(),removeFreezeLayer()):"widget"==i.type?Utils.windowLocationHref(window.location.href):reloadRelatedList("reload"),$("#newRelatedListPopUpDiv").hide()}})},CustomRelatedListObj.listWidgets=function(){hideAnimatePopup("topBandPopup"),Lyte.injectResources([networkUtils.returnDependencyFiles(["crm-widget-container.js"],crmConstants.jsStaticPathForLyte)[0],networkUtils.returnDependencyFiles(["widget/crm-widget-container.css"],crmConstants.lessStaticPathForLyte)[0]],void 0,(function(){Lyte.registeredMixins["crm-widget-utils"].loadWidgetListViewPopup("RELATED_LIST",void 0,$("#module").val())}))},CustomRelatedListObj.saveWidgetInfo=function(e){var t=store.peekRecord("widgets",e);CustomRelatedListObj.widgetInfo={},CustomRelatedListObj.widgetInfo.id=e,CustomRelatedListObj.widgetInfo.name=t.name,CustomRelatedListObj.widgetInfo.description=t.description,CustomRelatedListObj.widgetInfo.type="widget",Handlebars.registerPartial("CustomRelatedListName",Handlebars.templates.CustomRelatedListName);var a=Handlebars.templates.CustomRelatedListName(CustomRelatedListObj.widgetInfo),r=$("#newRelatedListPopUpDiv");r.addClass("newpopup p30 newInputStyleEle newPopupStyleEle"),r.html(a),r.css("zIndex",200),r.find("td:first").remove(),commonUtils.showHideLoadingDiv(),r.css({padding:"0px"}),crmui.showPopup("newRelatedListPopUpDiv")},CustomRelatedListObj.validateRLName=function(e){var t=$("#crlRelatedListName").val();e&&(t=$("#"+e).val());var a=["`","~","!","#","^","*","[","]","{","}","|","\\",'"',";","'","&","+","%","(",")","@","?",":","<",">","=",",","-","$",".","/"],r=a.length,i=0;for(i=0;i<r;i++)if(t.indexOf(a[i])>=0)return!1;return!0},CustomRelatedListObj.downloadRLFunctionFiles=function(e){networkUtils.loadFeatureScripts([networkUtils.getI18nJSUrl("customfunctions"),"zcrm_custom_functions.min.js"],(function(){var t=networkUtils.returnDependencyFiles(["custom-function-editor.js","crm-function-components-wrapper.js","crm-functions-helper.js"],crmConstants.jsStaticPathForLyte),a=networkUtils.returnDependencyFiles(["custom-function-editor.css","crm-reviewprocess-customfunction.css","function-common.css"],crmConstants.cssStaticPathForLyte);Crm.userDetails.RTL_ENABLED&&(a=a.concat(networkUtils.returnDependencyFiles(["function-common-rtl.css"],crmConstants.cssStaticPathForLyte)));var r=networkUtils.returnDependencyFiles(["custom-function-model.js","function-model.js"],crmConstants.jsStaticPathForLyte),i=t.concat(a).concat(r);Lyte.injectResources(i,void 0,(function(){e()}))}),!1)};var crmModuleConstants={Cases:"Cases",Leads:"Leads",Accounts:"Accounts",Contacts:"Contacts",Tasks:"Tasks",Events:"Events",Calls:"Calls",PriceBooks:"PriceBooks"},crmConstants={init:function(){this.plusImg=networkUtils.getImageUrl("plus_c921379_.gif",ResourceConstants.CRM),this.minusImg=networkUtils.getImageUrl("minus_8bfc505_.gif",ResourceConstants.CRM),Search.spacerImg=networkUtils.getImageUrl("spacer_e17b417_.gif",ResourceConstants.CRM),Search.yesImg=networkUtils.getImageUrl("yes_cb0870e_.gif",ResourceConstants.CRM),this.helpUrl=[]},requestMethods:{GET:"GET",POST:"POST",PUT:"PUT",PATCH:"PATCH",DELETE:"DELETE"},adminProfileName:"Administrator",importNotSupportedModule:["Visits","Activities","Invoices","SalesOrders","PurchaseOrders","Quotes","Forecasts","Calls","Events","Tasks","Messages"],stdOptionFields:["CALLTYPE","OUTBOUNDCALLSTATUS"],text_operator:["contains","doesn't contain","is","isn't","starts with","ends with","Is empty","Is not empty"],date_operator:["contains","doesn't contain","is after","is before","Is empty","Is not empty"],arithmetic_operator:["=","<","<=",">",">=","Is empty","Is not empty"],boolean_operator:["","true","false"],maxSelectCount:100,moduleVsCrossModules:{Leads:["Campaigns","Visits"],Contacts:["Campaigns","Deals","Visits"],Accounts:["Deals"]},tagNotSupMod:["Activities","Visits","Messages","CustomModule5001","CustomModule5002","CustomModule5003","CustomModule5004"],moduleDisplayField:{Leads:["Full_Name","Last_Name"],Activities:["Subject"],Accounts:["Account_Name"],Contacts:["Full_Name","Last_Name"],Deals:["Deal_Name"],Potentials:["Deal_Name"],Campaigns:["Campaign_Name"],Cases:["Subject"],Solutions:["Solution_Title"],Products:["Product_Name"],Vendors:["Vendor_Name"],PriceBooks:["Price_Book_Name"],Quotes:["Subject"],SalesOrders:["Subject"],PurchaseOrders:["Subject"],Invoices:["Subject"],Visits:["Visited_Page"],Services:["Service_Name"],Appointments:["Appointment_Name"],Tasks:["Subject"],Events:["Event_Title"],Meetings:["Event_Title"],Calls:["Subject"],Attachments:["File_Name"],Competitors:["Competitor_Name"],Messages:["Message By"]},serviceHiddenFieldColName:["AVAILABLE_DATES","AVAILABLE_DAYS","UNAVAILABLE_TILL","AVAILABLE_CUSTOM_TIMING","STARTING_DATE","CLOSING_DATE","JOBSHEETLAYOUT","AVAILABLE_CUSTOM_TIMING","SERVICEAVAILABILITY","UNAVAILABLE_FROM"],appointmentsHiddenFieldColName:["APPOINTMENTID","SEID","APPOINTMENTFOR","RESCHEDULEDFROM","ENDTIME","ISJOBSHEETCREATED","JOBSHEETSECTION"],maxSelectCountforMassConvert:50,userPartialLoadCount:200,maxRecOperCnt:100,jsStaticPath:"/crm/javascript/",jsStaticPathForLyte:"/crm/CRMClient/javascript/",cssStaticPathForLyte:"/crm/CRMClient/css/",lessStaticPathForLyte:"/crm/CRMClient/css/compiled-css/default/ltr/",imagesStaticPathForLyte:"//img.zohocdn.com/crm/CRMClient/images/",cssStaticPath:"",livedeskURL:"",setupversion:"0",maxCrtCnt:25,maxCrtCntForListView:10,Z_Retrying:"ZPending",Z_Scheduled:"ZScheduled",ZFSDown:"true",WMS_STATUS:-1,EVENT_STATUS_PREPARED:"0",EVENT_STATUS_CONFIRMED:"1",EVENT_STATUS_CANCELED:"-1",EVENT_STATUS_LOC_CHANGED:"2",EVENT_STATUS_TIME_CHANGED:"3",EVENT_STATUS_TIMELOC_CHANGED:"4",executionDayFormula:"${EXECUTION_DAY}",executionTimeFormula:"${EXECUTION_TIME}",clientTemplatingSupported:{Leads:!0,Accounts:!0,Contacts:!0,Potentials:!0,Calls:!0,Events:!0,PurchaseOrders:!0,SalesOrders:!0,Quotes:!0,Invoices:!0,Tasks:!0,Campaigns:!0,Potentials:!0,Cases:!0,PriceBooks:!0,SalesOrders:!0,Solutions:!0,Invoices:!0,Quotes:!0,PurchaseOrders:!0,Products:!0,Vendors:!0,CustomModule1:!0,CustomModule2:!0,CustomModule3:!0,CustomModule4:!0,CustomModule5:!0},recurringEndDateLimit:{daily:365,weekly:730,monthly:1825,yearly:3650},imgStaticPath:"",errorStatusCode:401,limitExceedsCode:406,errorLabel:"X-errorLabel",enableCopyAddressForModules:{Accounts:!0,Contacts:!0,SalesOrders:!0,Quotes:!0,Invoices:!0,PurchaseOrders:!0},defaultHiddenFields:{SMCREATORID:!0,MODIFIEDBY:!0,CALLOWNER:!0,LASTACTIVITYTIME:!0,SALUTATION:!0,CALLDURATIONINSEC:!0},specialTextNode:{Tasks:{Subject:!0}},helpUrl:void 0,taskCompleted:"Completed",emailRegex:/^[a-zA-Z0-9]([\w\-.+']*)@([\w\-.]*)(\.[a-zA-Z]{2,22}(\.[a-zA-Z]{2}){0,2})$/,defaultWhatId:{},defaultWhoId:{Events:{},Calls:{},Tasks:{}},weekdaysArray:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],htmlElementsCache:{},contactsPhotoURL:"",hoursArray:[1,2,3,4,5,6,7,8,9,10,11,12],minutesArray:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59],dateArray:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],fullDaysArray:[],listViewMandatoryColumns:{Leads:"LASTNAME",Activities:"SUBJECT",Accounts:"ACCOUNTNAME",Contacts:"LASTNAME",Potentials:"POTENTIALNAME",Campaigns:"CAMPAIGNNAME",Cases:"CASESUBJECT",Solutions:"SOLUTIONTITLE",Products:"PRODUCTNAME",Vendors:"VENDORNAME",PriceBooks:"BOOKNAME",Quotes:"QUOTESUBJECT",SalesOrders:"SALESORDERSUBJECT",PurchaseOrders:"PURCHASEORDERSUBJECT",Invoices:"INVOICESUBJECT",Forecasts:"FORECASTNAME",Visits:"VISITEDPAGE",Services:"SERVICENAME",Appointments:"APPOINTMENTNAME",Tasks:"SUBJECT",Calls:"SUBJECT",Events:"SUBJECT"},uiRenderingDetails:{Calls:{sectionHeading:{style:"width: 70%"},sectionContent:{style:"width:580px",cellspacing:6,cellpadding:0},fieldLabel:{class:"labelTabCreate pL5"},field:{2:{style:"width:16px;"},26:{style:"width:"},4:{class:"textField nwrp tOE"}}},Tasks:{sectionHeading:{style:"width\t: 70%"},sectionContent:{style:"width:70%",cellspacing:0},field:{19:{class:"sFieldText",style:"width:20px"},2:{style:"width:50%"},28:{class:"taskSubSelect",style:"width:115px"},26:{style:"width:50%"},8:{style:"width:70%",class:"textField"},32:{class:"textField vmiddle",style:"width:"},1:{style:"width:60%"}}},Events:{field:{2:{class:"textField",style:"width:135px"},200:{class:"textField"},201:{class:"textField"},786:{class:"textField w110"},30:{class:"textField"},24:{class:"textField"},202:{class:"textField"},28:{class:" ",style:"width:115px"},301:{class:"textField"},300:{class:"textField"},39:{class:"select",style:"width:182px"},77:{class:"textField"},36:{class:"textField",style:"width:70%"},42:{class:" ",style:"width:115px"},4:{class:"textField",style:"width:182px"},5:{class:"textField nwrp tOE"},6:{class:"textField nwrp tOE",style:"width:160px"},7:{class:"textField nwrp tOE",style:"width:160px"},8:{nowrap:"nowrap",class:"customSel",style:"width:110px"},9:{class:"textField nwrp tOE",style:"width:160px"},10:{class:"textField nwrp tOE",style:"width:160px"},12:{class:"textField nwrp tOE",style:"width:160px"},13:{class:"textField nwrp tOE",style:"width:160px"},15:{class:"textField nwrp tOE",style:"width:160px"},132:{class:"textField",style:"width:160px"},133:{class:"textField",style:"width:160px"},135:{class:"textField",style:"width:160px"},444:{class:"textField",style:"width:160px"},25:{class:"textField",style:"width:182px"},26:{class:"select"},11:{style:"width:100%",colspan:"2"},1:{class:"textField sFieldText",style:"width:182px"},21:{class:"textField",style:"width:182px"},33:{class:"textField"},35:{class:"textField",style:"width:182px"},52:{class:"textField",style:"width:182px"},32:{class:"textField vmiddle",style:"width:"},3:{style:"width:100%",class:"textField"},110:{class:"textField",style:"width:100%"},14:{class:"textField"},60:{class:"textField",style:"width:182px"},19:{class:" ",style:"width: 182px"},22:{class:"textField",style:"width:182px;padding-left:20px"},27:{class:"textField"},34:{class:"textField",style:"width:182px"},38:{class:"textField",style:"width:182px"},37:{class:"textField",style:"width:182px"},16:{class:" "},116:{class:"textField"},117:{class:"textField"},50:{class:"textField"},51:{class:"textField"},91:{class:"textField"},100:{class:"multiSelect select",style:"width:115px"},111:{class:"textField"},123:{},143:{class:"textField",style:"width:182px"},144:{class:"textField",style:"width:182px"},145:{class:"textField",style:"width:182px"},127:{class:"textField",style:"width:182px"},99:{class:"textField",style:"width:182px"},333:{class:"textField w110"},1234:{},11:{style:"width:400px;position:relative; z-index:101; background: none;",class:"textField txtfld"},14:{style:"width:110px",class:"textField nobdr"}},htmlContainer:{id:"preHTMLContainer",class:""},sectionHeading:{style:"width:100%"},sectionContent:{style:"width:100%",class:" ",cellspacing:0},fieldLabel:{class:"labelTabCreate pL5"}},default:{htmlContainer:{id:"preHTMLContainer",class:"p30 lbox set_mw"},sectionHeading:{style:"width:100%",cellspacing:"0",cellpadding:"0"},sectionContent:{style:"width:100%",class:"secContent mT0",border:0,cellspacing:1,cellpadding:0},fieldLabel:{class:"labelTabCreate pL5 pR"},field:{1234:{style:"width:135px"},60:{class:"textField",style:"width:182px"},2:{class:"select",style:"width:120%"},555:{class:"select",style:"width:120%"},200:{class:"textField",style:"width:90px"},201:{class:"textField",style:"width:90px"},786:{class:"textField fL sFieldText"},30:{class:"textField",style:"width:90px"},24:{class:"textField",nowrap:"true",style:"width:85%"},202:{class:"textField",nowrap:"true",style:"width:85%"},28:{class:"",style:"width: 90px"},301:{},300:{},39:{class:"select",style:"width:90%"},77:{class:"textField",style:"width:90%"},36:{class:"textField",style:"width:77%"},42:{class:" "},4:{class:"textField nwrp tOE",style:"width:77%"},5:{class:"textField nwrp tOE",style:"width:77%"},6:{class:"textField nwrp tOE",style:"width:77%"},7:{class:"textField nwrp tOE",style:"width:77%"},8:{nowrap:"nowrap",style:"width:87%"},9:{class:"textField nwrp tOE",style:"width:77%"},10:{class:"textField nwrp tOE",style:"width:77%"},12:{class:"textField nwrp tOE",style:"width:77%"},13:{class:"textField nwrp tOE",style:"width:77%"},15:{class:"textField nwrp tOE",style:"width:77%"},132:{class:"textField nwrp tOE",style:"width:81%"},133:{class:"textField nwrp tOE",style:"width:81%"},135:{class:"textField nwrp tOE",style:"width:81%"},444:{class:"textField nwrp tOE",style:"width:81%"},25:{class:"textField",style:"width:100%"},26:{class:"select",style:"width:100%"},11:{style:"width:100%",colspan:"2",class:"textField  txtfld"},1:{class:"textField",style:"width:100%"},21:{class:"textField",style:"width:100%"},33:{class:"textField",style:"width:100%"},35:{style:"width:100%",class:"textField"},52:{class:"textField",style:"width:100%"},32:{class:"textField",style:"width:100%"},3:{class:"textField tAreaF",style:"width:100%;max-width:100%;"},110:{class:"textField",style:"width:100%"},14:{class:"textField",style:"width:100%"},19:{class:""},22:{style:"width:88%;padding-left:2px",class:"textField"},27:{class:"textField",style:"width:inherit"},34:{class:"textField",style:"width:100%"},38:{style:"width:100%",class:"textField"},37:{style:"width:100%",class:"textField"},16:{class:"textField nwrp tOE",style:"width:77%"},116:{class:"textField",style:"width:100%"},117:{class:"textField",style:"width:100%"},55:{class:"customSel",nowrap:"nowrap",style:"width:87%"},50:{class:"textField",style:"width:100%"},51:{class:"textField",style:"width:100%"},91:{class:"textField",style:"width:100%"},100:{class:"multiSelect select",style:"width:100%"},111:{class:"textField",style:"width:100%"},123:{},143:{class:"textField",style:"width:77%"},144:{class:"textField",style:"width:88%"},145:{class:"textField",style:"width:95%"},127:{class:"textField",style:"width:100%"},333:{class:"textField fL sFieldText"},1234:{},11:{style:"width:320px; padding-left: 10px; position:relative; z-index:101; background: none;",class:"textField txtfld"},14:{style:"width:100px",class:"textField sFieldText"}}}},moduleVsSingularNameMapping:{Leads:"Lead",Contacts:"Contact",Cases:"Case"},FileUploader:{accept:"application/json",cacheControl:"no-cache",xRequestedWith:"XMLHttpRequest",connection:"Keep-Alive",ContenType:"application/x-www-form-urlencoded",xStreammode:"1",charset:"utf-8",xDocConversion:!1,invoker:"crm",uploadServerPath:"webupload",uploadServerMethod:"POST",uploadMethod:{NORMAL:"normal",ZFS:"zfs",ZFSNG:"zfsng"},relatedListAttachments:{uploadLimit:10,uploadSizeLimit:100,uploadSizeFlex:0,parallelUpload:2,fileSizeBase:1024,progressratio:.9,acceptedfiles:".msg,.rar,.ics,.jar,.htm,.dat,.vcf,.class,.do,.map,.jsp,.java,.zip,.php,.kml,.txt,.html,.xml,.pdf,.jpeg,.jpg,.gif,.png,.webp,.bmp,.svg,.doc,.docx,.zdoc,.odt,.rtf,.csv,.xls,.xlsx,.ots,.xlsm,.ods,.numbers,.fcs,.bks,.rdf,.odp,.pps,.pot,.pptx,.ppt,.avi,.wmv,.mp4,.mpeg,.mpg,.mov,.flv,.mkv,.webm,.mp3,.ogg,.oga,.wma,.m4p,.m4a,.au,.3gp,.3ds,.dct,.dgn,.dwfx,.dwg,.dxf",previewtemplate:'<div class="dz-preview dz-file-preview cB"><div class="dz-details"><div class="dz-filename"><span data-dz-name></span></div><div class="dz-size"><span data-dz-size></span></div></div><div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div><div class="dz-error-message"><span class="virusAlert"></span>&nbsp;<span data-dz-errormessage></span></div><div class="dz-remove ico-close-small svgIcons" data-dz-remove></div>',action:"relatedlist",saveElement:"#file_attach",clickableElement:"#attachDropClick",previewElement:"#attachPreview",cancelElement:"#file_attach_cancel",mainformElement:"fileAttachForm",tabLoadElement:"#ajax_load_tab",targetAttachFrameElement:"#AttachmentFrame",popupName:"topBandPopup"},fileUploadFieldAttachments:{uploadLimit:5,uploadSizeLimit:20,uploadSizeFlex:0,parallelUpload:2,fileSizeBase:1024,progressratio:.9,acceptedfiles:".msg,.rar,.ics,.jar,.htm,.dat,.vcf,.class,.do,.map,.jsp,.java,.zip,.php,.kml,.txt,.html,.xml,.pdf,.jpeg,.jpg,.gif,.png,.webp,.bmp,.svg,.doc,.docx,.zdoc,.odt,.rtf,.csv,.xls,.xlsx,.ots,.xlsm,.ods,.numbers,.fcs,.bks,.rdf,.odp,.pps,.pot,.pptx,.ppt,.avi,.wmv,.mp4,.mpeg,.mpg,.mov,.flv,.mkv,.webm,.mp3,.ogg,.oga,.wma,.m4p,.m4a,.au,.3gp,.3ds,.dct,.dgn,.dwfx,.dwg,.dxf",previewtemplate:'<div class="dz-preview dz-file-preview cB"><div class="dz-details"><div class="dz-filename"><span data-dz-name></span></div><div class="dz-size"><span data-dz-size></span></div></div><div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div><div class="dz-error-message"><span class="virusAlert"></span>&nbsp;<span data-dz-errormessage></span></div><div class="dz-remove ico-close-small svgIcons" data-dz-remove></div>',action:"fileuploadfieldattachments",saveElement:"#file_attach",clickableElement:"#attachDropClick",previewElement:"#attachPreview",cancelElement:"#file_attach_cancel",mainformElement:"fileAttachForm",tabLoadElement:"#ajax_load_tab",targetAttachFrameElement:"#AttachmentFrame",popupName:"topBandPopup"}},Docs:{ResourceTypes:{COMPANY_LOGO:"CompanyLogo",VOICE_NOTES:"VoiceNotes",ENTITY_ATTACHMENTS:"EntityAttachments",TEMPLATE_ATTACHMENTS:"TemplateAttachments",MAIL_MERGE_TEMPLATES:"MailMergeTemplates",LEAD_PHOTO:"LeadPhoto",CONTACT_PHOTO:"ContactPhoto",GAMIFICATION:"Gamification",CAREERS_WEBSITE_IMAGES:"CareersWebsiteImages",EMAIL_TEMPLATES:"EmailTemplates",INVENTORY_TEMPLATES:"InventoryTemplates"},WorkSpace:{WS_ATTACHMENT_LIBRARY:"WS_ATTACHMENT_LIBRARY",WS_ATTACHMENT_MAIL_MERGE_LIBRARY:"WS_ATTACHMENT_MAIL_MERGE_LIBRARY"}},defaultUiTypeToCruxMapping:{2:"picklist",25:"email",33:"phone",8:"user",21:"website",301:"boolean",100:"picklist",22:"twitter",200:"date-time",786:"date-time",24:"date",202:"date",333:"date-time",209:"tag",3:"text-area",110:"text-area",300:"boolean",14:"date-time",1:"text",4:"lookup",111:"text",32:"number",36:"number",77:"number",208:"layout",143:"number",144:"number",145:"number",40:"number",34:"number",221:"user",55:"user"},Pipelines:{hideLayoutsEdition:["F","N","L","S","D","R","P","Y","I","B","X","R","E"],max_limit:{R:10,E:20,S:5,X:5,Y:5,P:10,A:20,C:50,Z:20,U:50,D:3,I:5,B:1,Trial:3},default_max_limit:20},forecastHierarchyObj:{Roles:"Role",Territory:"Territory",Reporting_To:"Reporting_To"},forecastHierarchyVsModel:{Role:"role",Territory:"territory",Reporting_To:"user"},forecastTypeVsKey:{Deal_Revenue:"Amount",Deal_Quantity:"Quantity"},wizardExcludedModules:["Calls","Tasks","Events","PriceBooks","Products","Quotes","Activities","Invoices","SalesOrders","PurchaseOrders","Solutions","Cases","Campaigns","Vendors","Messages"],wizardIncludedModules:["Leads","Contacts","Accounts","Deals","Potentials"],cachedModules:["Leads","Contacts","Accounts","Deals","Potentials"],defaultUiTypeToCruxMapping:{999:"layout",25:"email",33:"phone",8:"user",20:"user",21:"website",301:"boolean",100:"picklist",22:"twitter",200:"date-time",786:"date-time",24:"date",202:"date",333:"date-time",209:"tag",3:"text-area",110:"text-area",300:"boolean",14:"date-time",1:"text",4:"lookup",111:"text",32:"number",36:"number",77:"number",207:"layout",208:"layout",143:"number",144:"number",145:"number",40:"number",34:"number",221:"user",55:"user",2:"picklist",52:"number",38:"number",26:"picklist",39:"picklist",133:"lookup",5:"lookup"},uiTypeLookup:{4:!0,5:!0,6:!0,7:!0,9:!0,10:!0,12:!0,13:!0,15:!0,16:!0,42:!0,43:!0,44:!0,62:!0,133:!0,444:!0},dateTimeComparisonFieldsMapping:[{start:"STARTDATE",end:"ENDDATE"},{start:"SALES_START_DATE",end:"SALES_END_DATE"},{start:"SUPPORT_START_DATE",end:"SUPPORT_EXPIRY_DATE"}],entityjsonTypeMapping:{boolean:"boolean",jsonobject:"object",integer:"number",double:"number",jsonarray:"array"},entityuiTypeMapping:{221:"object",445:"array",555:"array",24:"date",202:"date",200:"datetime",786:"datetime",333:"datetime",14:"datetime",100:"multi-picklist",96:"tax",33:"phone",999:"territory",35:"phone",80:"time-in-hrs",445:"multi-user",47:"array",53:"millisec-to-time"},entityforumlaMapping:{datetime:"datetime",date:"date",jsonobject:"object",integer:"number",double:"number",jsonarray:"array"},entitycolumnMapping:{PARENT_CAMPAIGNID:"object",TOTALTIME:"millisec-to-time",TIMESPENT:"time-in-minutes",AVERAGETIMESPENT:"time-in-minutes",EXPECTEDREVENUE:"expected-revenue",LAYOUTID:"object",WIZARDID:"object"},cpqDashboardObject:{isCacheLoaded:!1},lyteCreatePartialModules:["Leads","Contacts","Accounts","Potentials","Products","Solutions","Vendors","Cases","Campaigns"],lyteCreateFullModules:[]},CustomButtonJSObjectInit={closeCBSuccessDiv:function(){var e=$("#cbExecutedPage");if(e&&(position=e.val()),$("#cbSuccessPopup").removeClass("zcrm-show"),setTimeout((function(){$("#cbSuccessPopup").hide()}),300),$("#cbSuccessPopupRespContent").html(""),removeFreezeLayer(),$("#cbSuccessPopup").remove(),"viewEntity"===position)"canvas"==Lyte.Router.getRouteInstance().routeName&&"entity"==Lyte.Router.getRouteInstance().parent.routeName?Lyte.Router.getRouteInstance().refresh():reloadCurrentEntityView();else if("eachRecord"===position||"listView"===position)crmListView.reloadCurrentListView();else if("relatedlist"===position){var t=Object.keys(CustomButtonJSObjectInit.checkBox)[0].split("_")[1],a={};a.id=detailView.entityId,a.module=detailView.currentModule,a.rid=t,a.isSortRequest=!1,networkUtils.makeRequest(Crm.getCrmBasePath()+"/NewRelatedList.do?action=getData","GET",{params:a,success_callback:function(e){crmRelatedList.load(detailView.currentModule,detailView.entityId,e)}})}},insertAtCaret:function(e,t){if(document.selection)e.focus(),document.selection.createRange().text=t;else if(e.selectionStart||"0"==e.selectionStart){startPosition=e.selectionStart;var a=e.selectionEnd;e.value=e.value.substring(0,startPosition)+t+e.value.substring(a,e.value.length)}else e.value+=t},closeDiv:function(e){crmui.hidePopup(e)},execute:function(e,t,a,r,i){if(CustomButtonJSObjectInit.update)return CustomButtonJSObjectInit.update=!1,!1;a=""===a?$("#entityIdEachRec").val():a;var o=Crm.getCrmBasePath()+"/CustomButton.do",s="step=executeCB&buttonId="+e+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&module="+i+"&pos="+t,n="";switch("webtab"==$("#opencbresponse :selected").val(),t){case"viewEntity":case"eachRecord":s=s+"&entityId="+a;break;case"listView":var l=crmListView.getObject().selectedIds;if(l.length<=0)return crmui.showMsgBand("warning",I18n.getMsg("crm.alert.select.one"),"5000"),!1;s=s+"&entityId="+l;break;case"relatedlist":var d="CB_"+r,c=CustomButtonJSObjectInit.checkBox[d];s=s+"&listRelationId="+r+"&relatedListIds="+c.toString()+"&entityId="+a}if(void 0!==t&&"cbedit"!=t&&"cbeditInv"!=t&&"create"!=t&&"clone"!=t&&"createclone"!=t&&""!=t){(new crmRequestPool).doAjax(o,(function(e){CustomButtonJSObjectInit.showButtonErrorMsg(e)&&CustomButtonJSObjectInit.buttonExecuteResp(e,t)}),s)}else{var u="",m=crmCommonModule.createEditJson.module;a="cbedit"===(t="cbeditInv"===t?"cbedit":t)?window[m].entityId:1;s="step=getCustomButtonInfo&module="+m+"&buttonId="+e+"&entityId="+a;(new crmRequestPool).doAjax(o,(function(r){var l=JSON.parse(r);if(l.paramMap&&(l.paramMap.userOrgCrmVar&&(u=l.paramMap.userOrgCrmVar),delete l.paramMap.userOrgCrmVar),l.isError){if(l.errorMsg&&l.errorMsg.startsWith("CIRCUITS_"))if(!CustomButtonJSObjectInit.showButtonErrorMsg(l.errorMsg))return!1;return alert(l.errorMsg),!1}if("url"===l.buttonType)switch(l.buttonDisplay){case"sametab":n="_self";break;case"newwindow":n="newWin";break;case"newtab":n="_blank"}else if("customfunctions"===l.buttonType)"Parent window"===l.openIn?n="_self":"Same window"===l.openIn&&(n="_blank");else{if("widget"===l.buttonType){var d={Entity:l.moduleName};if(a&&1!==a&&(d.EntityId=a),l.ButtonID){var c=l.ButtonID,p="undefined"!=typeof WidgetHandler?WidgetHandler.getWidget("CustomButtons",c):void 0;if(p){var h=WidgetHandler.Utils.readForm();d=jQuery.extend(d,h),WidgetHandler.CustomButtons.render(p,d,t)}}return}if("circuit"===l.buttonType)return void CustomButtonJSObjectInit.processCircuitResponse(l)}var f,v=[];if(l.paramMap.urlExpression){var g=l.paramMap.urlExpression;l.isWebTab&&(f=l.url,l.weburl=f),l.url=g,l.paramMap.returnValue&&(v=JSON.parse(l.paramMap.returnValue),l.returnValue=v),delete l.paramMap.urlExpression,delete l.paramMap.returnValue}if($.isEmptyObject(l.paramMap)&&!l.isWebTab){if("url"===l.buttonType)"newWin"===n?openPopUp("newWin","",Crm.getOrgSpecificURL(l.url),"newPopup",1e3,800,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes"):window.open(l.url,n),commonUtils.showHideLoadingDiv();else if("customfunctions"===l.buttonType){if(paramValuejsonObj=[],t="createclone"===t?"create":t,s="step=executeCB&buttonId="+e+"&cbParamValue="+encodeURIComponent(JSON.stringify(paramValuejsonObj))+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&module="+i+"&pos="+t,"cbedit"==t&&(s+="&entityId="+window[m].entityId),"customfunctions"===l.buttonType){var C=CustomButtonJSObjectInit.constructJsonForCreatePage(i);s=s+"&formFieldData="+encodeURIComponent(JSON.stringify(C))}commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).doAjax(o,(function(e){if(commonUtils.showHideLoadingDiv(!1),CustomButtonJSObjectInit.showButtonErrorMsg(e)){"TOO_MANY_REQUESTS"===JSON.parse(e).creator_error?crmui.showMsgBand("error",I18n.getMsg("crm.custombutton.function.limit.exceed"),5e3):"SOCKET_CLOSED"===JSON.parse(e).creator_error&&crmui.showMsgBand("warning",I18n.getMsg("crm.custombutton.function.time.exceed"),7e3),""!=(l=JSON.parse(e)).alertMessage&&networkUtils.loadFeatureScripts(["zohocrm_customButtonTemplate.js"],(function(){Handlebars.registerPartial("cbSuccessPopup",Handlebars.templates.cbSuccessPopup),$("body").append(Handlebars.templates.cbSuccessPopup()),$("#cbSuccessPopup").addClass("zcrm-show"),setTimeout((function(){$("#cbSuccessPopup").show()}),150),$("#cbSuccessPopupRespContent").text(l.alertMessage),$("#cbExecutedPage").val(t)}));var a=l.openURL,r=l.openIn;""!==a&&validationUtils.isValidWebUrl(a)&&("Popup window"===r?(width=l.width,height=l.height,leftPosition=window.screen.width/2-(width/2+10),topPosition=window.screen.height/2-(height/2+50),window.open(l.openURL,"Window2","status=no,height="+height+",width="+width+",resizable=yes,left="+leftPosition+",top="+topPosition+",screenX="+leftPosition+",screenY="+topPosition+",toolbar=no,menubar=no,scrollbars=1,location=no,directories=no")):"New window"===r?openPopUp("newWin","",Crm.getOrgSpecificURL(a),"newPopup",1e3,800,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes"):window.open(a,r))}}),s)}}else if($.isEmptyObject(l.paramMap)&&l.isWebTab)l.weburl&&(CustomButtonJSObjectInit.webtabparams=l.url,l.url=l.weburl),"newWin"===n?openPopUp("newWin","",Crm.getOrgSpecificURL(l.url),"newPopup",1e3,800,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes"):window.open(Crm.getOrgSpecificURL(l.url),n),commonUtils.showHideLoadingDiv();else if("url"===l.buttonType||"customfunctions"===l.buttonType){paramValuejsonObj=[];var b=!1,y="";$.each(l.paramMap,(function(e,r){paramValueitem={};var o=e.split("::::"),s=o[1],n="";e=o[0];var d=r.split("::::");if(r=d[0],2==s?(paramValueitem.param=e,y=e,n=r,2==d.length&&(paramValueitem.param=d[1])):(paramValueitem.param=r,y=r,n=e,2==d.length&&(paramValueitem.param=d[1])),100==s)paramValueitem.param=r,paramValueitem.value=a,2==d.length&&(paramValueitem.param=d[1]),paramValuejsonObj.push(paramValueitem);else if(200==s)paramValueitem.param=r,paramValueitem.value=$("#"+n).attr("data-id"),paramValuejsonObj.push(paramValueitem);else if("Layout"==r&&"cbedit"!=t)paramValueitem.value=$("#layoutDetails").val(),paramValuejsonObj.push(paramValueitem);else if(n.startsWith("Crm_")){var c=$("#"+n),m=c.val();"Crm_"+i+"_SMOWNERID"===n&&(m=c.text());var p=$("[name='property\\("+r+"\\)']").val();if(null==m&&""==p||""==m){var h={},f="${"+i+"."+d[1]+"}";g=(g=l.url).replace(f,""),l.url=g,h[i]=y,v.push(h),b=!0}else if(null==m&&""!=p)paramValueitem.value=p,paramValuejsonObj.push(paramValueitem);else{paramValueitem.value=m,paramValuejsonObj.push(paramValueitem);var g=l.url;f="${"+i+"."+d[1]+"}";g=g.replace(f,m),l.url=g,l.isWebTab&&(u=l.url)}}else if(""==$("#Crm_"+l.moduleName+"_"+n).val()&&"SMOWNERID"!=n){"Leads"==l.moduleName&&"Designation"==y&&(y="Title"),(h={})[i]=y,v.push(h),b=!0,paramValueitem.value="",paramValuejsonObj.push(paramValueitem)}else paramValueitem.value="SMOWNERID"===n?$("#Crm_"+l.moduleName+"_"+n).text():$("#Crm_"+l.moduleName+"_"+n).val(),paramValuejsonObj.push(paramValueitem)}));var w=CustomButtonJSObjectInit.processForLookupRecords(l.lookupFieldsDataMap,i),I=CustomButtonJSObjectInit.processForDefaultLookupRecords(l.defaultLookupFieldObject,i);if(l.isWebTab&&(l.webtabparams=u),0!=v.length&&(b=!0),b&&(l.returnValue=v,l.paramValuejsonObj=paramValuejsonObj,l.id=e,l.module=i,l.lookupRecordsMap=w,l.defaultLookupRecordsMap=I,CustomButtonJSObjectInit.processError(l,t)),!b){for(var R in paramValuejsonObj){var T=paramValuejsonObj[R].param;if("undefined"!=T&&null!=T&&null!=T&&T.indexOf("$map_")>-1){var _=(E=T.substring(5)).split("_$KEY$"),E=(_[0],_[1]);paramValuejsonObj[R].param=E}}if(t="createclone"===t?"create":t,s="step=executeCB&buttonId="+e+"&cbParamValue="+encodeURIComponent(JSON.stringify(paramValuejsonObj))+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&module="+i+"&pos="+t+"&entityId="+a+"&url="+encodeURIComponent(g)+"&lookupRecordsMap="+JSON.stringify(w)+"&defaultLookupRecordsMap="+JSON.stringify(I),"customfunctions"===l.buttonType){C=CustomButtonJSObjectInit.constructJsonForCreatePage(i);s=s+"&formFieldData="+encodeURIComponent(JSON.stringify(C))}(new crmRequestPool).doAjax(o,(function(e){CustomButtonJSObjectInit.showButtonErrorMsg(e)&&CustomButtonJSObjectInit.buttonExecuteResp(e,t,"executeCB")}),s)}}}),s)}},processForLookupRecords:function(e,t,a,r){var i={};if(e){var o,s=e.split(";"),n=s.length;for(o=0;o<n;o++){var l=s[o],d="#Crm_"+t+"_"+l.split("=")[0],c=l.split("=");if(c.length>=2){var u=c[1].split("::"),m=u[0],p=$(d).data();if(p){var h=null!=p.id&&null!=p.id?p.id:"";if(i[m]=[h,u[1],u[2],u[3]],!h&&null!=a){var f=t+" "+p.displaylabel;a.contains(f)||(r[t]&&r[t].push(p.displaylabel),a.push(f))}}}}}return null!=r?r:i},processForDefaultLookupRecords:function(e,t,a,r){var i={};if(e){var o,s=e.split(";"),n=s.length;for(o=0;o<n;o++){var l=s[o],d="#Crm_"+t+"_"+(l.split("=")[0]?l.split("=")[0].split("###")[0]:""),c=l.split("=");if(c.length>=2){var u=c[1].split("::"),m=u[0],p=$(d).data();if(p){var h=p.id&&null!=p.id?p.id:"";if(i[m]=[h,u[1],u[2],u[3]],!h&&null!=a){var f=t+" "+p.displaylabel;a.contains(f)||(r[t]&&r[t].push(p.displaylabel),a.push(f))}}}}}return null!=r?r:i},showHideMenu:function(e,t,a,r,i,o){$("#actionMenu").hide();var s=$("#"+r);if(s.is(":visible"))s.hide();else{var n=$("#customButtonDetails").offset(),l=s.width(),d=$(window).width(),c=$("span[id=customButtonDetails]:visible").eq(0).width();switch(e){case"listView":(u=$(".eachRecord")).is(":visible")&&u.hide(),s.css({padding:"0 16px 16px",top:n.top+33,right:d-(n.left+c+18)}).show();break;case"withoutRecord":var u;(u=$(".eachRecord")).is(":visible")&&u.hide(),n=$("#customButtonDetailsWithoutRec").offset(),c=$("#customButtonDetailsWithoutRec:visible").eq(0).width(),s.css({padding:"0 16px 16px",top:n.top+35,right:d-(n.left+c+18)}).show();break;case"create":case"cbedit":case"createclone":if("customButtonDetailsBottom"==o){n=$("#customButtonDetailsBottom").offset();var m=s.height();c=$("span[id=customButtonDetails]:visible").eq(0).width();s.css({padding:"0 16px 16px",top:n.top-m,right:d-(n.left+c)-16}).show(),"cbedit"==e&&s.css({padding:"0 16px 16px",top:n.top-145,right:d-(n.left+c)-16}).show()}else n=$(".customPluswithImpotBtnCon:visible").eq(0).offset(),s.css({top:n.top+33,right:d-(n.left+c+16)}).show();break;case"eachRecord":var p=$(".listView");p.is(":visible")&&p.hide();var h=$("#customButtonDetails_"+t);n=h.offset(),c=h.width();s.is(":visible")?s.hide():(l=s.width(),s.css({padding:"0 16px 16px",top:n.top+32,right:d-(n.left+c)-16}).show());break;default:$("#customButtonDetails").hasClass("btntoolsIdIsBottom")?s.addClass("btntoolsIdBottom").css({padding:"16px 16px 0",top:n.top-($("."+buttonId).outerHeight()+8),left:n.left-l+16}).show():s.css({padding:"0 16px 16px",top:n.top+33,right:d-(n.left+c+16)}).show()}CustomButtonJSObjectInit.sortable(a,r,i)}},timeoutId:null,relatedListDropDown:function(e,t,a,r,i,o,s){var n=$("#"+s);n.removeClass("customButtonDom"),$(".customButtonDom").show()&&($(".customButtonDom").hide(),n.addClass("customButtonDom"));var l=JSON.parse(e),d=l[0].listRelationId,c=r+"_"+d,u={};u.cbArray=l;var m=l.length;u.btnCount=m;var p={};if(p.module=r,p.entityId=t,p.position=a,p.buttonDetails=u,p.sorterId="sorterId_"+d,p.buttondivId=r+"_"+d,p.relatedListId=d,$("#"+c).is(":visible"))$("#"+c).hide();else{Handlebars.registerPartial("customButtonDropDown",Handlebars.templates.customButtonDropDown),$("#tabLayer").after(Handlebars.templates.customButtonDropDown(p));var h=$(window).width(),f=$("#custBtnRel_"+d),v=f.width(),g=f.offset();$("#"+c).css({padding:"0 16px 16px",display:"block !important",top:g.top+32,right:h-g.left-v-16}).show()}CustomButtonJSObjectInit.sortable(o,c,"sorterId_"+d)},showCusBtnDetTt:function(e,t,a,r,i){$("#"+r).addClass("ui-sortable-helper"),$(".cbBtnValue").removeClass("hide"),$(".ui-sortable-handle").removeClass("handCursorIcon"),CustomButtonJSObjectInit.timeoutId||(CustomButtonJSObjectInit.timeoutId=window.setTimeout((function(){if(CustomButtonJSObjectInit.timeoutId=null,""==a||"null"==a?$("#btnDesc,#btnToolTipDescDiv").hide():(a=a.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/<br>/g,"\n"),$("#btnDesc,#btnToolTipDescDiv").show()),pos=$(e).offset(),$("#btnToolTipNameDiv").text(t),$("#btnToolTipDescDiv").text(a),$(e).hasClass("customImportBtn"))Crm.userDetails.RTL_ENABLED?$(".cusBtnDetTt").addClass("cusBtnDetTtAct").css({top:pos.top-10,left:renderingUtils.windowWidth-(pos.left+$(e).outerWidth())-($(".cusBtnDetTt").outerWidth()+15)}).show():$(".cusBtnDetTt").addClass("cusBtnDetTtAct").css({top:pos.top-10,left:pos.left-($(".cusBtnDetTt").outerWidth()+15)}).show();else if(Crm.userDetails.RTL_ENABLED){$("#btntoolsId").hasClass("btntoolsIdBottom")?($(".cusBtnDetTt").addClass("cusBtnDetTtAct").css({top:pos.top-($(".cusBtnDetTt").outerWidth()-$(e).outerWidth()),right:renderingUtils.windowWidth-(pos.left+$(e).outerWidth())-($("#cusBtnDetTt").outerWidth()+15)}).show(),$(".yellowTopArw").css({top:"auto",bottom:"4px"})):($(".cusBtnDetTt").addClass("cusBtnDetTtAct").css({top:pos.top,right:renderingUtils.windowWidth-(pos.left+$(e).outerWidth())-($(".cusBtnDetTt").outerWidth()+15)}).show(),$(".yellowTopArw").css({top:"8px",bottom:"auto"}))}else $(e).closest("#btntoolsId").hasClass("btntoolsIdBottom")?($(".cusBtnDetTt").addClass("cusBtnDetTtAct").css({top:pos.top-($(".cusBtnDetTt").outerHeight()-$(e).outerHeight()),left:pos.left-($(".cusBtnDetTt").outerWidth()+15)}).show(),$(".yellowTopArw").css({top:"auto",bottom:"4px"})):($(".cusBtnDetTt").addClass("cusBtnDetTtAct").css({top:pos.top,left:pos.left-($(".cusBtnDetTt").outerWidth()+15)}).show(),$(".yellowTopArw").css({top:"8px",bottom:"auto"}))}),3e3))},hideCusBtnDetTt:function(e){$("#"+e).removeClass("ui-sortable-helper"),$(".cusBtnDetTt").removeClass("cusBtnDetTtAct"),CustomButtonJSObjectInit.timeoutId&&(window.clearTimeout(CustomButtonJSObjectInit.timeoutId),CustomButtonJSObjectInit.timeoutId=null)},createCustBtnPage:function(e,t){switch(store.clearCachedQuery("custom_button",{module:moduleRecordMapping[e].api_name}),t){case"eachRecord":t="listvieweachrecord";break;case"listView":t="listview";break;case"viewEntity":t="detail";break;case"withoutRecord":t="listviewwithoutrecord";break;case"":t="createclone"}var a='<input type="hidden" value="'+t+'" id="buttonPosition"/>';$("#tabLayer").after(a),$(".customButtonDom").hide(),window.createManageWindow=window.open(Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/ShowSetup.do?tab=customize&subTab=modules&innerTab=cusLink&action=createNewLink&module="+e+"&step=createCustomButton&component=button"))},manageCustBtn:function(e){$("#tabLayer").after('<input type="hidden" value="Buttons" id="buttonManage"/>'),$(".customButtonDom").hide(),window.location=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/ShowSetup.do?tab=customize&subTab=modules&innerTab=cusLink&module="+e)},sortable:function(e,t,a,r){var o="#"+a;0!==$("#"+a+"_semodule").length&&(o=o+",#"+a+"_semodule"),0!==$("#"+a+"_contactmodule").length&&(o=o+",#"+a+"_contactmodule"),$(o).sortable({axis:"y",start:function(e,t){t.item.on("click.prevent",(function(e){e.preventDefault()}));var a=$(t.item);a.addClass("handCursorIcon"),$(".cbBtnValue").addClass("hide");var r=a.attr("class");(r.indexOf("contactmodule")>=0||r.indexOf("semodule")>=0)&&crmui.showMsgBand("info",I18n.getMsg("crm.custombutton.sort.msg"),3e3),$("#listViewToolTipDiv").removeClass("cusBtnDetTtAct"),t.item.on("click.prevent",(function(e){e.preventDefault()}))},stop:function(e,t){setTimeout((function(){t.item.off("click.prevent")}),300),$(".ui-sortable-handle").removeClass("handCursorIcon")},update:function(t,r){r.item.on("click.prevent",(function(e){e.preventDefault()}));var o="#"+a;0!==$("#"+a+"_semodule").length&&(o=o+",#"+a+"_semodule"),0!==$("#"+a+"_contactmodule").length&&(o=o+",#"+a+"_contactmodule");for(var s=$(o).children(),n=s.length,l=[],d=0;d<n;d++){var c=JSON.parse($(s[d]).attr("data-params").replace(/\\x20/g," "));l.push(c.buttonId)}var u,m={},p=JSON.parse($(s[0]).attr("data-params").replace(/\\x20/g," ")),h=p.moduleName,f=p.position,v={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};(m.step="sortButtonOrder",m.position=f,m.moduleName=h,"relatedlist"===f&&(u=a.split("_")[1],m.listRelationId=u),l.length>1)&&(m.order=l.toString(),(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/CustomButton.do?",type:"POST",data:m,headers:v,success:function(e){}}));var g=p.buttonId,C=p.entityId,b=p.buttonName,y=decodeURIComponent(p.buttonDesc);$("."+e).val();if(onclickStr="return CustomButtonJSObjectInit.execute('"+g+"','"+f+"','"+C+"',"+u+",'"+h+"');",dataParamStr="{buttonId:'"+g+"',entityId:'"+C+"'}",mouseOverStr="$('#btntoolsId').hide(); CustomButtonJSObjectInit.showCusBtnDetTt(this,'"+b+"','"+y+"')",$("."+e).val(b).attr("data-params",dataParamStr).attr("onmouseover",mouseOverStr).attr("onclick",onclickStr),"listView"==f||"eachRecord"==f){var w=l.length,I={buttonDetails:[]};for(i=0;i<w;i++){var R=JSON.parse($(s[i]).attr("data-params").replace(/\\x20/g," "));g=R.buttonId,b=R.buttonName,y=decodeURIComponent(R.buttonDesc);I.buttonDetails.push({name:b,desc:y,key:g})}switch(f){case"listView":crmTab.cacheObj[h].customButtonMap.cbArray=I.buttonDetails,crmTab.cacheObj[h].customButtonMap.buttonCount=w;break;case"eachRecord":crmTab.cacheObj[h].customButtonListViewEachRecordMap.cbArray=I.buttonDetails,crmTab.cacheObj[h].customButtonListViewEachRecordMap.buttonCount=w}}CustomButtonJSObjectInit.update=!0}}),$(o).disableSelection()},getCustomButtonDtls:function(e,t,a,r,i,o,s){var n=t+a;$("#"+n).remove(),CustomButtonJSObjectInit.customButtonSearch($("#buttonSearch").val("").trigger("keyup")),$("#noButtonFound").hide(),hideMenu();if($("#entityIdEachRec").length)$("#entityIdEachRec").val(o);else{var l='<input type="hidden" value="'+o+'" id="entityIdEachRec"/>';$("#tabLayer").after(l)}var d=CustomButtonJSObjectInit[n];if("newWindow"==d||"SaveCB"==d||"deleteCB"==d){var c={};return CustomButtonJSObjectInit[n]="",c.step="getCustomButtonDetails",c.position=a,c.module=t,(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/CustomButton.do",data:c,success:function(e){var l=JSON.parse(e),d={};d.module=t,d.position=a,d.buttonDetails=l,d.buttondivId=n,d.sorterId=i,d.entityId=o,Handlebars.registerPartial("customButtonDropDown",Handlebars.templates.customButtonDropDown),$("#tabLayer").after(Handlebars.templates.customButtonDropDown(d)),1==l.cbArray.length&&$("#"+i).sortable("disable"),CustomButtonJSObjectInit.showHideMenu(a,o,r,n,i,s),$("#sortableListView").scrollTop(0)}}),!1}var u={};return u.module=t,u.position=a,u.buttonDetails=JSON.parse(e),u.buttonDetails=CustomButtonJSObjectInit.findOtherCBArray(u.buttonDetails),u.buttondivId=n,u.sorterId=i,u.entityId=o,Handlebars.registerPartial("customButtonDropDown",Handlebars.templates.customButtonDropDown),$("#tabLayer").after(Handlebars.templates.customButtonDropDown(u)),CustomButtonJSObjectInit.showHideMenu(a,o,r,n,i,s),CustomButtonJSObjectInit.showOrHideButtons(),$("#sortableListView").scrollTop(0),!1},showOrHideButtons:function(){var e=Crm.userDetails.LICENSE_TYPE;!!Crm.userDetails.permissions.hasOwnProperty("Crm_Implied_Customize_Zoho_CRM")&&Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM&&["E","A","Z","C","U","D"].contains(e)||($L("#createCustomButtonDiv").hide(),$L("#manageCustomButtonDiv").hide(),$L("#detailsCB").hide())},findOtherCBArray:function(e){for(var t=0;t<2;){if(e.hasOwnProperty("cbArray")){var a=e.cbArray.length-1;if(0!==e.cbArray.length&&e.cbArray[a].hasOwnProperty("dependentCBArray")){var r=e.cbArray.pop();e.dependentCBArray=r.dependentCBArray,a=e.cbArray.length-1}if(0!==e.cbArray.length&&e.cbArray[a].hasOwnProperty("dependentContactCBArray")){r=e.cbArray.pop();e.dependentContactCBArray=r.dependentContactCBArray,a=e.cbArray.length-1}}t+=1}return e.hasOwnProperty("cbArray")&&1===e.cbArray.length&&e.cbArray[0].hasOwnProperty("notInCurrentModule")&&e.cbArray[0].notInCurrentModule&&e.cbArray.pop(),e},customButtonSearch:function(e,t,a){var r,i=0;(s=$("#"+t)).sortable("enable"),r=$(e).length>0?$(e).val().toLowerCase():"";var o=$("."+a),s=$("#"+t),n=$("#noButtonFound");if(r.length>=1||""==r){for(var l=o.length,d=0;d<l;d++){var c=o[d],u=$(c);""==r||u.text().toLowerCase().indexOf(r)>-1?(u.addClass("active searchDisplay").removeClass("searchLbl").show(),i++,s.sortable("disable")):(u.removeClass("active searchDisplay").addClass("searchLbl").hide(),s.sortable("disable"))}0==i?(n.attr("style","color:#adadad; padding:10px 27px 0px !important;").show(),n.click(!1),s.hide()):(n.hide(),s.show())}""==r&&s.sortable("enable")},divDeletion:function(e,t){CustomButtonJSObjectInit[e]=t},moduleOnChange:function(){var e=$("#ModuleListUL :selected").val(),t=$L("crm-wizard-builder")[0];Lyte.Router.getRouteInstance().routeName.includes("wizard")&&(e=t.getData("primaryModule.module_name"));var a=$("#urlContent"),r=$("#createWhereSelect");if(-1==e)$("#trCreateWhere,#trButtonName,.viewPlace,#trDesc,#trCBOptions,.selectedactionsCtn,.viewBtnPlace,#trCBDisplay,#trCBProfile,#trCBLocationDetail").addClass("hide"),a.addClass("hide"),r.val("-1"),$("#buttonAction").val("-1").trigger("change.select2"),$("#expression,#buttonLabel,#description").val(""),$("#savebtn").addClass("inActiveSec");else if(null!=a.attr("class")&&-1===a.attr("class").indexOf("hide")||-1===$("#customFunctionNameDisp").attr("class").indexOf("hide")){if(confirm(I18n.getMsg("crm.custombutton.ChangeModuleConfirm"))){$("#expression").val("");e=$("#ModuleListUL :selected").val();Lyte.Router.getRouteInstance().routeName.includes("wizard")&&(e=t.getData("primaryModule.module_name")),$("#trCBDisplay,#trCBProfile,#trCBLocationDetail").addClass("hide"),$("#savebtn").addClass("inActiveSec"),$("#buttonAction").val("-1").trigger("change.select2"),null!=a.attr("class")&&-1===a.attr("class").indexOf("hide")&&a.addClass("hide"),-1===$("#customFunctionNameDisp").attr("class").indexOf("hide")&&($("#customFunctionNameDisp,#editCustomFunction,#remoteCustomFunction,#undoCustomFunctionChange").addClass("hide"),$("#workflowLinkId").val(""),$("#buttonActionSelect").removeClass("hide"))}}else $("#trButtonName,#trCreateWhere,#descLink").removeClass("hide")},customBtnMouseOver:function(e){if("eachRecord"!=e)return!1;var t="#customButtonDetails_"+$("#entityIdEachRec").val();$(t).attr("style","visibility:visible"),$(t).closest("tr").removeClass("tdout"),$(t).closest("tr").addClass("tdhover")},customBtnMouseOut:function(e){if("eachRecord"!=e)return!1;var t="#customButtonDetails_"+$("#entityIdEachRec").val();$(t).attr("style","visibility:hidden"),$(".customButtonDom").hide(),$(t).closest("tr").removeClass("tdhover"),$(t).closest("tr").addClass("tdout")},selectRecord:function(e,t){var a=$(e).attr("id"),r=a.split("_")[1],i=$(e).attr("class"),o=$(e).attr("value"),s=o.split("_")[1],n=$("#"+t).width();$("#"+a).closest(".component1").hasClass("pR")||$("#"+a).closest(".component1").addClass("pR");var l=$("#customButtonDetails_"+s);if(l.css("left",n+30),i.indexOf("customCheckBoxChecked")>-1){$(e).addClass("customCheckBox"),$(e).removeClass("customCheckBoxChecked"),$("#"+o).removeClass("customCheckBoxChecked"),$("#"+o).addClass("customCheckBox");var d=CustomButtonJSObjectInit.checkBox[o].indexOf(r);d>-1&&CustomButtonJSObjectInit.checkBox[o].splice(d,1);var c=$(".customCheckBoxChecked[data-cid=selectEntity_"+s+"]").length;$("#relatedListRecVal_"+o.split("_")[1]).text(CustomButtonJSObjectInit.checkBox[o].length),c>=1?1==Crm.userDetails.detailView_newUI?(l.animate({top:8},500).show(),l.addClass("dVHierarchyView")):l.animate({top:-5},500).show():(l.animate({top:40},500,(function(){l.hide()})),crmRelatedList.hideOnCheckRlActions(s))}else{if($(".customCheckBoxChecked[data-cid=selectEntity_"+s+"]").length===crmConstants.maxSelectCount)return void renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.records.alert",crmConstants.maxSelectCount));$(e).removeClass("customCheckBox"),$(e).addClass("customCheckBoxChecked");c=$(".customCheckBoxChecked[data-cid=selectEntity_"+s+"]").length;$(".customDom[data-cid=selectEntity_"+s+"]").length==c&&($("#"+o).removeClass("customCheckBox"),$("#"+o).addClass("customCheckBoxChecked")),CustomButtonJSObjectInit.checkBox||(CustomButtonJSObjectInit.checkBox={}),CustomButtonJSObjectInit.checkBox[o]||(CustomButtonJSObjectInit.checkBox[o]=new Array),CustomButtonJSObjectInit.checkBox[o].push(r),$("#relatedListRecVal_"+o.split("_")[1]).text(CustomButtonJSObjectInit.checkBox[o].length),1==Crm.userDetails.detailView_newUI?($("#customButtonDetails_"+s).addClass("dVHierarchyView"),$("#customButtonDetails_"+s).animate({top:8},500).show()):$("#customButtonDetails_"+s).animate({top:-5},500).show(),1===c&&crmRelatedList.showOnCheckRlActions(s)}},selectAllRecord:function(e,t){var a=$(e).attr("value"),r=$(e).attr("id"),o=r.split("_")[1];if($("#"+r).closest(".component1").hasClass("pR")||$("#"+r).closest(".component1").addClass("pR"),$("#customButtonDetails_"+o).css("left",$("#"+t).width()+30),$(e).attr("class").indexOf("customCheckBoxChecked")>-1){var s=$(".customDom[data-cid=selectEntity_"+o+"]");for(i=0;i<s.length;i++){(n=CustomButtonJSObjectInit.checkBox[a].indexOf(s[i].id.split("_")[1]))>-1&&CustomButtonJSObjectInit.checkBox[a].splice(n,1),$("#"+s[i].id+"[data-cid=selectEntity_"+o+"]").removeClass("customCheckBoxChecked").addClass("customCheckBox")}$("#"+r).removeClass("customCheckBoxChecked"),$("#"+r).addClass("customCheckBox"),$("#relatedListRecVal_"+a.split("_")[1]).text(CustomButtonJSObjectInit.checkBox[a].length),0==CustomButtonJSObjectInit.checkBox[a].length&&$("#customButtonDetails_"+o).animate({top:40},500,(function(){$("#customButtonDetails_"+o).hide()})),crmRelatedList.hideOnCheckRlActions(o)}else{null==CustomButtonJSObjectInit.checkBox?(CustomButtonJSObjectInit.checkBox={},CustomButtonJSObjectInit.checkBox[a]=new Array):null==CustomButtonJSObjectInit.checkBox[a]&&(CustomButtonJSObjectInit.checkBox[a]=new Array);s=$(".customDom[data-cid=selectEntity_"+o+"]");for(i=0;i<s.length;i++){var n=CustomButtonJSObjectInit.checkBox[a].indexOf(s[i].id.split("_")[1]);if(CustomButtonJSObjectInit.checkBox[a].length==crmConstants.maxSelectCount)return renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.records.alert",crmConstants.maxSelectCount)),void CustomButtonJSObjectInit.showRLCustomBtnActions(a,o);n>-1||CustomButtonJSObjectInit.checkBox[a].push(s[i].id.split("_")[1]),$("#"+s[i].id+"[data-cid=selectEntity_"+o+"]").removeClass("customCheckBox").addClass("customCheckBoxChecked")}$("#"+r).removeClass("customCheckBox"),$("#"+r).addClass("customCheckBoxChecked"),CustomButtonJSObjectInit.showRLCustomBtnActions(a,o)}},buttonExecuteResp:function(e,t,a){var r=$.parseJSON(e);t||(t=r.buttonPosition);var i=!0;if(r.empty_fields)return delete r.empty_fields,r.proceed_empty=!0,Lyte.registeredMixins["crm-view-utils"].executeCustomButtons(r),void crmui.hidePopup("customButtonPopUp");var o=r.returnValue;if(r.isError&&crmui.showMsgBand("warning",r.errorMsg,"2000"),o)return CustomButtonJSObjectInit.processError(r,t),!1;if("customfunctions"===r.buttonType&&!0===r.isErrorValue){i=!1,crmui.hidePopup("customButtonPopUp");var s={step:"executeCBAction"};delete r.isErrorValue,s.buttonDetailsMap=JSON.stringify(r),s[csrfParamName]=encodeURIComponent(csrfToken),(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/CustomButton.do",data:s,success:function(e){return r=$.parseJSON(e),CustomButtonJSObjectInit.buttonResponseToLoad(r,t),!1}})}if("viewEntity"===t&&"circuit"===r.buttonType)$L("crm-circuits-rl-body").length?Lyte.triggerEvent("cirRlLabel_reloadCircuits"):null!=detailView.currentModule&&null!=detailView.entityId&&r.module===detailView.currentModule&&(r.isRefreshOnProcess=!0,CustomButtonJSObjectInit.refreshPage(detailView.currentModule,detailView.entityId,(function(){r.isRefreshOnProcess=!1,CustomButtonJSObjectInit.processCircuitResponse(r)})));else if("customfunctions"===r.buttonType&&("createclone"===t||"cbedit"===t)&&"executeCB"!=a){i=!1,t="createclone"===t?"create":t;var n=r.id,l=r.paramValuejsonObj,d=r.lookupRecordsMap,c=r.defaultLookupRecordsMap,u=r.module,m=crmCommonModule.createEditJson.module,p="cbedit"===(t="cbeditInv"===t?"cbedit":t)?window[m].entityId:1,h="step=executeCB&buttonId="+n+"&cbParamValue="+encodeURIComponent(JSON.stringify(l))+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&module="+u+"&entityId="+p+"&pos="+t+"&lookupRecordsMap="+JSON.stringify(d)+"&defaultLookupRecordsMap="+JSON.stringify(c),f=Crm.getCrmBasePath()+"/CustomButton.do";(new crmRequestPool).doAjax(f,(function(e){CustomButtonJSObjectInit.showButtonErrorMsg(e),CustomButtonJSObjectInit.showButtonErrorMsg(e)&&CustomButtonJSObjectInit.buttonExecuteResp(e,t,"executeCB")}),h)}i&&CustomButtonJSObjectInit.buttonResponseToLoad(r,t)},refreshPage:function(e,t,a){"canvas"===Lyte.Router.getRouteInstance().routeName&&"entity"===Lyte.Router.getRouteInstance().parent.routeName?Lyte.Router.getRouteInstance().refresh():(crmTab.deleteFromCache(e),reloadCurrentEntityView(t,e,(function(){a&&a()})))},buttonResponseToLoad:function(e,t){var a="";if(e.isWebTab&&(CustomButtonJSObjectInit.webtabparams=e.webtabparams,"create"!=e.buttonPosition&&"cbedit"!==e.buttonPosition&&"createclone"!==e.buttonPosition||(CustomButtonJSObjectInit.webtabparams=e.webtabparams,e.url=e.weburl)),"url"===e.buttonType){switch(e.buttonDisplay){case"sametab":a="_top";break;case"newwindow":a="newWin";break;case"newtab":a="_blank"}"newWin"===a?openPopUp("newWin","",Crm.getOrgSpecificURL(e.url),"newPopup",1e3,800,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes"):window.open(Crm.getOrgSpecificURL(e.url),a)}else if("customfunctions"===e.buttonType){""!=e.alertMessage&&null!=e.alertMessage?networkUtils.loadFeatureScripts(["zohocrm_customButtonTemplate.js"],(function(){Handlebars.registerPartial("cbSuccessPopup",Handlebars.templates.cbSuccessPopup),$("body").append(Handlebars.templates.cbSuccessPopup()),$("#cbSuccessPopup").addClass("zcrm-show"),setTimeout((function(){$("#cbSuccessPopup").show()}),150),$("#cbSuccessPopupRespContent").text(e.alertMessage),$("#cbExecutedPage").val(t)})):removeFreezeLayer();var r=e.openURL;if(a=e.openIn,""!==r&&validationUtils.isValidWebUrl(r))switch(a){case"iframe":$("#"+e.frameElement).attr("src",r);break;case"Popup window":case"popup window":width=e.width,height=e.height,leftPosition=window.screen.width/2-(width/2+10),topPosition=window.screen.height/2-(height/2+50),window.winObj=window.open(Crm.getOrgSpecificURL(e.openURL),"Window2","status=no,height="+height+",width="+width+",resizable=yes,left="+leftPosition+",top="+topPosition+",screenX="+leftPosition+",screenY="+topPosition+",toolbar=no,menubar=no,scrollbars=1,location=no,directories=no");break;case"New window":openPopUp("newWin","",Crm.getOrgSpecificURL(r),"newPopup",1e3,800,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes");break;case"parent window":window.parent.location.href=Crm.getOrgSpecificURL(e.openURL);break;default:window.winObj=e.successiveTab?window.open(Crm.getOrgSpecificURL(r)):window.open(Crm.getOrgSpecificURL(r),a)}}else if("circuit"!==e.buttonType||e.isRefreshOnProcess){if("widget"===e.buttonType&&e.ButtonID){var i=e.WidgetData;if(e.relatedListId){var o=crmRelatedList.getPersonalityModuleObj(e.relatedListId);o&&(i.Entity=CrmWidgets.Utils.GetSysRefFromTabName(o.module))}var s=e.ButtonID,n="undefined"!=typeof WidgetHandler?WidgetHandler.getWidget("CustomButtons",s):void 0;n&&WidgetHandler.CustomButtons.render(n,i,t)}}else CustomButtonJSObjectInit.processCircuitResponse(e);crmui.hidePopup("customButtonPopUp"),commonUtils.showHideLoadingDiv()},isValidWebUrl:function(e){if(""==e)return!0;return new RegExp('^(http:\\/\\/www.|https:\\/\\/www.|ftp:\\/\\/www.|www.|http:\\/\\/|https:\\/\\/|ftp:\\/\\/|){1}[^\0-"-%\'-,.-/:@[-^`{-{}-]+(\\.[^\0-"$%\',.-/<>@[-^`{-{}-]+)+(/[^\0-"(-)<>^{-{}-]*)*$').test(e)},processError:function(e,t){for(var a={Message:[]},r={},i=[],o=e.returnValue,s=o.length,n=[],l=0;l<s;l++)for(var d in o[l]){var c=o[l][d],u=d+" "+c;n.contains(u)||(void 0===r[d]?(i[d]=[],i[d].push(c),r[d]=i[d]):(i[d].push(c),r[d]=i[d]),a.Message.push(u),n.push(u))}delete e.returnValue;var m={},p=e.moduleName;r=CustomButtonJSObjectInit.processForLookupRecords(e.lookupFieldsDataMap,p,n,r),r=CustomButtonJSObjectInit.processForDefaultLookupRecords(e.defaultLookupFieldObject,p,n,r),m.errorMessage=r,m.jsonResString=e,m.position=t,Handlebars.registerPartial("CustomButtonPopup",Handlebars.templates.CustomButtonPopup),$("#tabLayer").after(Handlebars.templates.CustomButtonPopup(m)),crmui.showPop("customButtonPopUp")},removeDisabledSaveOfLink:function(){var e=$("#create");e.prop("disabled",!1),e.css("opacity","")},setHeightForDelugeEditor:function(){var e=$("#delugeEditorArea"),t=$("#wfDelugeEditorDIV").find(".wf_newUi_form"),a=e.find("#dreTopBar"),r=$("#delugeLeftPane"),i=$("#delugeEditorCont"),o=i.find(".CodeMirror"),s=i.find("#codemirror_scroll"),n=$("#dreEditorFooter"),l=$("#wfDelugeEditorDIV").find(".pp-content").height()-(t.outerHeight()+15),d=l-a.outerHeight(),c=d-n.outerHeight();r.css({height:d}),o.css({height:c}),s.css({height:c}),i.css({height:d}),$("#wfDelugeEditorInnerDIV").css({height:l}),e.css({height:l})},setDelugeDivHeight:function(e){"true"==e&&setTimeout((function(){CustomButtonJSObjectInit.setHeightForDelugeEditor(),$("#wfDelugeEditorDIV .pp-footer").removeClass("box-sh")}),300)},showButtonErrorMsg:function(e){if("button_action_error"===e)return crmui.showMsgBand("warning",I18n.getMsg("crm.security.error.add.user"),1500),!1;if("CIRCUITS_EXECUTION_LIMIT_REACHED"===e)return crmui.showMsgBand("error",I18n.getMsg("crm.circuits.limit.exceeded"),5e3),!1;if("CIRCUITS_FEATURE_NOT_AVAILABLE"===e)return crmui.showMsgBand("error",I18n.getMsg("crm.circuits.button.feature.not.available",Crm.brandName),5e3),!1;if("CIRCUITS_ACCOUNT_FREEZED"===e)return Crm.userDetails.IS_ADMIN_ROLE?crmui.showMsgBand("error",I18n.getMsg("crm.circuits.accfreeze.button.admin",Crm.brandName),5e3):crmui.showMsgBand("error",I18n.getMsg("crm.circuits.accfreeze.button.nonadmin",Crm.brandName),5e3),!1;if("CIRCUITS_TYPE_NOT_ALLOWED"===e)return Crm.userDetails.IS_ADMIN_ROLE?crmui.showMsgBand("error",I18n.getMsg("crm.circuits.associate.non.payment",Crm.brandName),5e3):crmui.showMsgBand("error",I18n.getMsg("crm.circuits.associate.non.payment",Crm.brandName)+". "+I18n.getMsg("crm.circuits.contact.admin"),5e3),!1;try{var t=JSON.parse(e);if(t.creator_error){if("TOO_MANY_REQUESTS"===t.creator_error)return crmui.showMsgBand("error","Sorry, the action cant be performed as you have reached the allowed functions call limit that can be made in the last 24 hours",2500),!1;"SOCKET_CLOSED"===t.creator_error&&crmui.showMsgBand("warning","Sorry, Your Button's function takes more than 10s to execute. We will notify you once it completed",4e3)}}catch(e){return!0}return!0},unselectAllRecord:function(e,t){var a=$(e).attr("value");if(CustomButtonJSObjectInit.checkBox&&CustomButtonJSObjectInit.checkBox[a]&&0!==CustomButtonJSObjectInit.checkBox[a].length){var r=$(e).attr("id"),i=r.split("_")[1],o=$("#"+t).width()+10,s=$("#"+r);s.closest(".component1").addClass("pR");var n=$("#customButtonDetails_"+i);n.css("left",o);for(var l=$(".customDom[data-cid=selectEntity_"+i+"]"),d=l.length,c=0;c<d;c++){var u=CustomButtonJSObjectInit.checkBox[a].indexOf(l[c].id.split("_")[1]);u>-1&&CustomButtonJSObjectInit.checkBox[a].splice(u,1),$("#"+l[c].id).removeClass("customCheckBoxChecked").addClass("customCheckBox")}s.removeClass("customCheckBoxChecked"),s.addClass("customCheckBox"),$("#relatedListRecVal_"+a.split("_")[1]).text(CustomButtonJSObjectInit.checkBox[a].length),0==CustomButtonJSObjectInit.checkBox[a].length&&(n.animate({top:40},500,(function(){n.hide()})),crmRelatedList.hideOnCheckRlActions(i))}},clearDom:function(){$("#newRelatedListPopUpDiv").empty()},showModuleFields:function(e){var t=$(e),a=e.options[e.selectedIndex].value;$("#"+a+"_td").removeClass("dN"),$("#"+t.data("selectedModule")+"_td").addClass("dN"),t.data("selectedModule",a)},applySelectedFunctionCLNew:function(e){var t=e.options[e.selectedIndex].value;"-1"!==t&&CustomButtonJSObjectInit.insertAtCaret($("#txtarea_cl_url")[0],t),e.value="-1"},pushNotifyCx:function(e){var t="";try{var a=e.succeed_functions;if("functionsfailures"==Lyte.Router.getRouteInstance().routeName){for(var r=a.length,i=0;i<r;i++){var o=a[i];$("#failureRow_"+o).remove()}var s={};s.componentType=document.querySelector("#fail_function_category").ltProp("selected"),s.language=document.querySelector("#fail_function_lang").ltProp("selected"),s.start="1",s.limit="100",store.findAll("failures",s).then((function(e){$("crm-function-failureslist")[0].component.setData("functionFailures",e)}))}}catch(e){t=""}t=0!=e.successCount?I18n.getMsg("crm.functions.failures.alert.wms.few",[e.successCount,e.totalCount])+"<br>":I18n.getMsg("crm.functions.failures.alert.wms.none");var n='<div id="fin_notification" class="mig_notification dN" style="width:475px; bottom:28px;"><div class="migCardTitle"><div>'+(I18n.getMsg("Notification")+" - "+I18n.getMsg("crm.functions.heading"))+'</div><div class="pA svgIconsImg top15 right15 ico-close-white-small2 cP" onclick="$(\'#fin_notification\').slideUp(); $(\'#fin_notification\').remove();"></div></div><div class="pT20 pB10 pR15 pL15"><div class="aligncenter mB15 wwbw" onclick="$(\'#fin_notification\').slideUp(200)">'+t+"</div></div></div>";$("body").append(n),$("#fin_notification").slideDown()},constructJsonForCreatePage:function(e){var t={};try{for(var a=Crm.fieldsObj[e].length,r=0;r<a;r++)if(!Crm.fieldsObj[e][r].endsWith("SALUTATION")){var i=$("#"+Crm.fieldsObj[e][r]),o=i.attr("data-uitype"),s=i.attr("data-sysrefname"),n={column_name:i.attr("data-colname"),uitype:o};try{var l=CustomButtonJSObjectInit.getFieldValueforCF(!0,"edit",n,void 0,void 0,void 0,e);""!==(l=CustomButtonJSObjectInit.getValueBasedOnUIType(l,parseInt(o)))&&(t[s]=l)}catch(e){}}return t}catch(e){return t}},getFieldValueforCF:function(e,t,a,r,i,o,s){var n=null,l=a.column_name;"view"!=t||"FIRSTNAME"!=a.column_name&&"SALUTATION"!=a.column_name?"SALUTATION"==a.column_name&&(l="LASTNAME"):l="LASTNAME";var d=!1;i&&(null!=r?d=r==l:Crm.VR&&(Crm.VR.ajaxEditFailedFields&&Crm.VR.ajaxEditFailedFields.contains(l)||Crm.VR.ajaxEditFieldLabel&&Crm.VR.ajaxEditFieldLabel==l)&&(d=!0));var c=!0;o&&!d&&null!=Crm.VR.globalAjaxEditedFields&&Crm.VR.globalAjaxEditedFields.contains(l)&&(d=!0),(o&&Crm.VR.fieldsInPopup&&Crm.VR.fieldsInPopup.contains(l)||Crm.VR&&Crm.VR.fieldsInPopup&&Crm.VR.fieldsInPopup.contains(l))&&(d=!0,c=!1);var u=CustomButtonJSObjectInit.getElemId(d&&"print"!=t?"edit":t,l,s);c&&(o&&(null==Crm.VR.globalAjaxEditedFields||null!=Crm.VR.globalAjaxEditedFields&&!Crm.VR.globalAjaxEditedFields.contains(l))?n=getFieldVal(l):i&&!d&&null==r&&Crm.VR.globalAjaxEditedFields&&Crm.VR.globalAjaxEditedFields.contains(l)&&(n=Crm.VR.ajaxEditFailedFieldValues[l]));var m=$("#"+u),p=!1;if(void 0!==Crm.VR&&null!=Crm.VR){if(Crm.VR.IsQuickCreate&&"Tasks"==validationRuleModule&&"SUBJECT"==l)u="task_subject",m=$("#"+u);else if(Crm.VR.IsQuickCreate&&0==m.length){var h=$("."+u);1==h.length&&(m=h)}Crm.VR.quickCreateMoreFields&&Crm.VR.quickCreateMoreFields.contains(l)&&(p=!0),null!=Crm.VR.fromSC&&Crm.VR.fromSC&&(u=Crm.VR.SC_fieldsMap[l],m=$("[id='"+u+"']"))}if(m.length>0&&(m.is(":visible")||p)||null!=n){var f=null;null==n&&(d&&"view"==t||"edit"==t?300==a.uitype||301==a.uitype?n=m.is(":checked"):14==a.uitype||333==a.uitype||786==a.uitype||30==a.uitype?(n=m.val(),Crm.VR&&Crm.VR.fromSC||(f=$("#"+u+"_TimeOption").val()),null!=f&&""!=f||void 0===Crm.VR||null==Crm.VR||(Crm.VR.IsQuickCreate?f=$("#"+l+"dateTime").val()+" "+$("[id='property("+l+"ampm)']").val():Crm.VR.fromSC&&(f=$("."+l+"_timefrmhour").val()+":"+$("."+l+"_timefrmminute").val()+" "+$("."+l+"_timefrmampm").val())),""!=n&&""!=f&&(n=getDateObjectFromDateTimeStr(n,f))):(n=m.val(),void 0!==Crm.VR&&null!=Crm.VR&&"STAGE"==a.column_name&&null!=Crm.VR.fromSC&&Crm.VR.fromSC&&(n=m.find("option:selected").text().replace(/[\r\n\t]/g,"")),24==a.uitype&&""!=n&&(n=Utils.convertUsrtoDefaultDatePattern(n))):n="FIRSTNAME"==a.column_name?m.data("params").nameInfo.firstname:"LASTNAME"==a.column_name?m.data("params").nameInfo.lastname:"SALUTATION"==a.column_name?m.data("params").nameInfo.salutation:null!=m.data("params").plainValue?m.data("params").plainValue:m.data("params").defaultvalue,"STAGE"==a.column_name&&n.indexOf(":")>-1&&("Deals"==s||"Potentials"==s)&&(n=n.split(":")[1]))}return n},getValueBasedOnUIType:function(e,t){switch(t){case CrmField.UITYPES.ACCOUNT_NAME_LOOKUP:case CrmField.UITYPES.CAMPAIGN_NAME_LOOKUP:case CrmField.UITYPES.PRODUCT_NAME_LOOKUP:case CrmField.UITYPES.CONTACT_LOOKUP:case CrmField.UITYPES.OWNER:case CrmField.UITYPES.VENDOR_NAME_LOOKUP:case CrmField.UITYPES.POTENTIAL_ID:case CrmField.UITYPES.SALESORDER_ID:case CrmField.UITYPES.CONTACT_ID:case CrmField.UITYPES.QUOTE_ID:case 116:case CrmField.UITYPES.AGGREGATE_FIELD:case 123:case CrmField.UITYPES.LOOK_UP_ENTITY:case CrmField.UITYPES.CREATED_TIME:case CrmField.UITYPES.LAYOUT:case CrmField.UITYPES.TAGMODULEREFID:case CrmField.UITYPES.USERLOOKUP:case CrmField.UITYPES.MULTISELECT_LOOK_UP:case CrmField.UITYPES.CREATED_BY:case CrmField.UITYPES.RECORD_CURRENCY:case 51:case CrmField.UITYPES.PRODUCT_HANDLER:case 77:case CrmField.UITYPES.COMMENTCONTENTS:case CrmField.UITYPES.MULTI_PICK_LIST:case CrmField.UITYPES.MULTI_LINE_CF:case CrmField.UITYPES.AUTONUMBER:return"";case CrmField.UITYPES.DATE:if(!e)return"";var a=new Date(e),r="";return r=$.datepicker.formatDate("yy-mm-dd",a);case CrmField.UITYPES.DATE_TIME2:case CrmField.UITYPES.DATE_TIME1:case CrmField.UITYPES.DATE_TIME_LONG:case CrmField.UITYPES.DATETIME:if(!e)return"";a=new Date(e),r="";return r=$.datepicker.formatDate("yy-mm-ddT",a),r+=Utils.formatTimeVal(a.getHours())+":"+Utils.formatTimeVal(a.getMinutes())+":"+Utils.formatTimeVal(a.getSeconds()),Crm&&Crm.userDetails.TIME_ZONE&&(r+=Crm.userDetails.TIME_ZONE.replace(".",":")),r;case CrmField.UITYPES.BOOLEAN_DEF:case CrmField.UITYPES.BOOLEAN_DEF_NOT:return("true"===e||"1"===e||1==e)+"";case CrmField.UITYPES.PHONE:return e?commonUtils.getPlainPhoneNo(e):"";default:return void 0===e||""===e||null===e?"":e.trim()}},getElemId:function(e,t,a){if("edit"===e){if(!0===Crm.isCalendarSchedule)return t;var r="Crm_"+a+"_"+t;if(void 0!==Crm.VR&&Crm.VR.IsQuickCreate&&Crm.VR.IsSearchCreate){var i="createEntityForm #"+r;0==$("#"+i).length&&(i="createEntityForm ."+r),r=i}return r}return"view"===e?"mouseArea__"+t:"print"===e?"rowTR_"+t:void 0},showRLCustomBtnActions:function(e,t){$("#relatedListRecVal_"+e.split("_")[1]).text(CustomButtonJSObjectInit.checkBox[e].length),1==Crm.userDetails.detailView_newUI?($("#customButtonDetails_"+t).animate({top:8},500).show(),$("#customButtonDetails_"+t).addClass("dVHierarchyView")):$("#customButtonDetails_"+t).animate({top:-5},500).show(),crmRelatedList.showOnCheckRlActions(t)},sandboxDiffPageDifferenceCheck:function(){var e=$("#parent_buttonLabel"),t=$("#buttonLabel"),a=$("#parent_description"),r=$("#description"),i=$("#parent_buttonActionSelect :selected").val(),o=$("#buttonActionSelect :selected").val();if(e.val()!=t.val()&&t.css("background-color","#FAE3B1"),a.val()!=r.val()&&r.css("background-color","#FAE3B1"),i===o&&"url"===i){var s=$("#parent_expression"),n=$("#expression");s.val()!=n.val()&&n.css("background-color","#FAE3B1")}},processCircuitResponse:function(e){var t=Crm.userDetails.permissions.hasOwnProperty("Crm_Implied_Circuits_Access")&&Crm.userDetails.permissions.Crm_Implied_Circuits_Access;if(e.hasOwnProperty("circuitsInfo")&&e.circuitsInfo.hasOwnProperty("circuitId")&&!e.circuitsInfo.hasOwnProperty("scheduled")&&t)if(e.circuitsInfo.hasOwnProperty("executionUrl")){r=e.circuitsInfo.executionUrl;var a=e.circuitsInfo.name;crmui.showMsgBand("success",I18n.getMsg("crm.circuits.trigger.success")+'. <span class="link1" onClick="crmRelatedList.showCircuitPreview(\''+r+"','"+a+"')\">"+I18n.getMsg("crm.circuits.rl.view.execution")+"</span>",5e3)}else{var r=Crm.getCrmBasePath()+"/settings/extensions/zoho/circuits/executionLogs?circuit_id="+e.circuitsInfo.circuitId;Crm.userDetails.permissions.hasOwnProperty("Crm_Implied_Circuits_Access")&&Crm.userDetails.permissions.Crm_Implied_Circuits_Access?crmui.showMsgBand("success",I18n.getMsg("crm.circuits.trigger.success")+". <span class='link1' onClick='networkUtils.openUrl(\""+r+'", "_blank", "");\'>'+I18n.getMsg("crm.circuits.rl.view.execution")+"</span>",5e3):crmui.showMsgBand("success",I18n.getMsg("crm.circuits.trigger.success"))}else e.hasOwnProperty("circuitsInfo")&&e.circuitsInfo.hasOwnProperty("scheduled")&&t?crmui.showMsgBand("success",I18n.getMsg("crm.circuits.schedule.success"),4e3):crmui.showMsgBand("success",I18n.getMsg("crm.circuits.trigger.success"),4e3)},buttonWMSNotification:function(e){var t,a=$L("crm-create-buttons")[0];if(a&&a.component){var r=a.component.custombuttonWizardDetails;if(r&&r.buttonId===e.custombuttonid)return void a.component.fromCustomButtonWMS(a.component,e)}$("#fin_notification").remove(),t='<div id="fin_notification" class="mig_notification dN" style="width:475px; bottom:28px;"><div class="migCardTitle"><div>'+(I18n.getMsg("Notification")+" - "+I18n.getMsg("crm.custombutton.execution.result"))+'</div><div class="pA svgIconsImg top15 right15 ico-close-white-small2 cP" onclick="$(\'#fin_notification\').slideUp(); $(\'#fin_notification\').remove();"></div></div><div class="pT20 pB10 pR15 pL15"><div class="aligncenter mB15 wwbw">'+("success"===e.action?I18n.getMsg("crm.custombutton.execution.wms.success",e.execution_start_time)+I18n.getMsg("crm.custombutton.response")+"<b>"+e.data+"</b>":I18n.getMsg("crm.custombutton.execution.wms.failed",e.execution_start_time)+I18n.getMsg("crm.custombutton.response")+"<b>"+e.message+"</b>")+"</div></div></div>",$("#basic").append(t),$("#fin_notification").slideDown()},getAPINameFromMergeField:function(e){for(var t,a=[],r=new RegExp(/\$\{([^\}].*?)\}/g);t=r.exec(e);){var i=t[1].split("."),o={};o.module=i[0],o.module_field=i[1],i.length>2&&(o.lookup_field=i[2]),a.push(o)}return a}},crmCommonModule={createEditJson:"",moduleName:void 0,currentStatus:void 0,isApproved:void 0,setStatus:function(e){this.currentStatus=e},createFieldLabel:function(e,t){var a="Crm_"+this.moduleName+"_"+e.colname,r=$("#multipleFieldsEditPop").is(":visible");if(4==e.uitype&&"Who Id"==e.label&&("Tasks"!==this.moduleName||!r)){var i=this.moduleName,o=objectUtils.getKeys(crmConstants.defaultWhoId[i]);e.defaultid&&"null"!=e.defaultid&&""!=e.lookupmodule&&!crmConstants.defaultWhoId[this.moduleName][e.lookupmodule]&&o.push(e.lookupmodule);i=this.moduleName;var s=renderingUtils.createSelectBox((function(t){var a=moduleRecordMapping[o[t]]?moduleRecordMapping[o[t]].singular_label:crmConstants.defaultWhoId[i][o[t]];if(!a)return!1;var r={html:I18n.getMsg(a),value:o[t]};return 1!==t||e.defaultid?r.value==e.lookupmodule&&(r.defaultVal="true"):r.defaultVal="true",r})),n=$(s);n.removeClass("select"),n.css({width:"135px"}),n.attr({id:a+"_WhoId_select"}).data({displayLabel:I18n.getMsg("Related To"),uitype:e.uitype,mandate:e.mandate,name:t,maxlength:e.maxlength}),Crm.fieldsObj[this.moduleName].push(a+"_select");i=this.moduleName;n.change((function(){window[i].showRelatedToOptions(this,!0)})),t.append(s)}return t},createFieldContent:function(e,t){return"ADDCOMMENT"!==e.colname||"Solutions"!==this.moduleName&&"Cases"!==this.moduleName||!/create|clone/.test(this.currentStatus)||t.find("textarea").prop("disabled","true"),t},createTemplate:function(e,t,a,r){var i=this.moduleName;if(e=removeRFMSegmentationCustomFields(e,i),crmCommonModule.createEditJson=e,e[i]&&e[i].fieldDependency&&(Crm.fieldDependency[i]=JSON.parse(e[i].fieldDependency),"Potentials"==i&&e.entityMapJson&&e.entityMapJson.PIPELINE&&e.entityMapJson.STAGE&&Crm.fieldDependency[i].PIPELINE&&Crm.fieldDependency[i].PIPELINE.STAGE&&!Crm.fieldDependency[i].PIPELINE.STAGE[e.entityMapJson.PIPELINE.defaultvalue]&&e.entityMapJson.STAGE.defaultvalue.indexOf(":")>-1&&(Crm.fieldDependency[i].PIPELINE.STAGE[e.entityMapJson.PIPELINE.defaultvalue]=[e.entityMapJson.STAGE.defaultvalue.split(":")[1]])),e[i].subforms&&Crm.userDetails.isMapDepencySubFormSupported)for(var o=e[i].subforms.section.length,s=e[i].subforms.section,n=0;n<o;n++){var l=s[n].subFormName;s[n].fieldDependency&&(Crm.fieldDependency[l]=JSON.parse(s[n].fieldDependency))}if(e[i]&&(e[i].DatePattern&&(Crm.userDetails.DATE_PATTERN=e[i].DatePattern.toLowerCase()),e[i].calPreferences&&(Crm.calPreferences=e[i].calPreferences)),e.WhatId&&(window[i].whatIdModulesArr=e.WhatIdArr.split(":::"),crmConstants.defaultWhatId[i]=window[i].whatIdModulesArr),e.WhoId&&(window[i].whoIdModulesArr=[],""!=e.WhoIdArr.split(":::")&&(window[i].whoIdModulesArr=e.WhoIdArr.split(":::"))),e.currencyDetails&&(this.currencyDetails=e.currencyDetails),Crm.isInventoryModule(i)&&Crm.userDetails.isLineItemSubformMvmtDone!=e.isLineItemSubformMvmtDone&&(Crm.userDetails.isLineItemSubformMvmtDone=e.isLineItemSubformMvmtDone),Crm.isInventoryModule(i)&&Crm.userDetails.lineItemFormulaCalcFlow!=e.lineItemFormulaCalcFlow&&(Crm.userDetails.lineItemFormulaCalcFlow=e.lineItemFormulaCalcFlow),!e.isDataEnrichAvailable||"Leads"!==i&&"Contacts"!==i&&"Accounts"!==i)Crm.isDataEnrichAvailable=!1,Crm.autoEnrichJSONData={};else{e.entityId&&(CAEExec.currentEntityId=e.entityId),e.enrichId&&(CAEExec.enrichId=e.enrichId),e.enrichStatus&&(CAEExec.enrichStatusForRecord=e.enrichStatus),e.enrichLimitCount&&(CAEExec.enrichLimitCount=e.enrichLimitCount),e.enrichUsedCount&&(CAEExec.enrichUsedCount=e.enrichUsedCount),Crm.isDataEnrichAvailable=e.isDataEnrichAvailable,Crm.autoEnrichJSONData=e.autoEnrichJSONData;var d="Crm_Implied_Auto_Enrich_"+i;Crm.enrichPermission=Crm.userDetails.permissions[d]}if(e.businessJSON||e.holidays){Crm.businessJSON=e.businessJSON;var c=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];if(Crm.businessJSON.business_days){if((fe=Crm.businessJSON.business_days.length)>0&&fe<7){for(n=0;n<fe;n++)c.removeFirstOccurenceOfElement(Crm.businessJSON.business_days[n]);Crm.businessJSON.closedDay=c}}else Crm.businessJSON.business_days=c,Crm.businessJSON.closedDay=[];Crm.holidays=e.holidays,Crm.holidays.selectedDate=[]}e.appointmentPreferences&&(CSU.appointmentPreferences=e.appointmentPreferences);a=a||"show";var u=$("#"+a),m="Activities"===Crm.activityGrp[i]&&"edit"===window[i].currentStatus&&0===$("#gsearchparentdiv:visible").length;m&&("true"===$("#iskanbanview").val()?(ActivityMoreInfoContent=$("#entitypopup").html(),u=thirdPartyUtils.bindPerfectScrollUpdate("#cvEditSave"),u=$("#cvEditSave").show()):$("#taskDetailsPart").length?(u=$("#taskDetailsPart"),ActivityMoreInfoContent=u.html(),$("#rp_td").hide()):m=!1),"Appointments"===this.moduleName||"JobSheets"===this.moduleName||"Tasks"===this.moduleName&&e.isFromRelatedList||$(u).empty(),e.isClientAccount=Crm.userDetails.CLIENT_ACCOUNT;var p="create",h=40;if($("#moduleBuilderForm").is(":visible")&&(p="preview",h=20),-1===crmTemplate.arrayNewClass.indexOf(this.moduleName))var f=getDomWidthCalculation(e[this.moduleName].section,p);if(("relatedlist_new"===Events.createSource||"krp"===Events.createSource||"salessignals"===Events.createSource||"listview"===Events.createSource&&"kanban"===Lyte.Router.getRouteInstance().routeName)&&"Appointments"===this.moduleName){if(Events.appointmentParams&&("krp"===Events.createSource||"salessignals"===Events.createSource||"canvas"===Lyte.Router.getRouteInstance().routeName||"listview"===Events.createSource&&"kanban"===Lyte.Router.getRouteInstance().routeName||!crmRelatedList.getPersonalityModuleObj(Events.appointmentParams.listRelationId).isCustLookUp)){var v=e[this.moduleName].section[0];if("Appointment Information"===v.name){var g=Events.appointmentParams.relmodule,C=Events.appointmentParams.entityname,b=Events.appointmentParams.entityid,y=v.FL.length;for(o=0;o<y;o++){if("Services"===g&&"SERVICEID"===v.FL[o].colname&&v.FL[o].uitype===CrmField.UITYPES.SYSTEM_SINGLE_LOOK_UP_ENTITY.toString()){v.FL[o].defaultvalue=C,v.FL[o].defaultid=b;break}if("Services"!==g&&v.FL[o].uitype===CrmField.UITYPES.MULTI_MODULE_LOOK_UP_ENTITY.toString()){v.FL[o].lookupmodule=g;for(var w=v.FL[o].multiModuleLookup.length,I=0;I<w;I++){var R=v.FL[o].multiModuleLookup[I].id,T=store.peekRecord("module",R);if(T&&T.module_name==g){v.FL[o].defaultvalue1=T.plural_label;break}}v.FL[o].defaultvalue2=C,v.FL[o].defaultid=b;break}}}e[this.moduleName].section[0]=v}delete Events.appointmentParams}var _=crmTemplate.create(e,this.moduleName,e[this.moduleName].section,a);f!==[]&&-1===crmTemplate.arrayNewClass.indexOf(this.moduleName)&&(_.find(".columnCal1").css("width",f[0]+h+"px"),_.find(".columnCal2").css("width",f[1]+h+"px"));var E=$("#markPopups");if("Appointments"===this.moduleName&&"setup"!==this.currentStatus)if("calendar"==Events.createSource){var S=$("#qCreate");if(S.prop("onclick",null),S.is(":empty")||S.empty(),S.append("<span class='qcpopuparrow'></span>"),S.removeClass("newActivitesPopupStyleEle"),S.append(_),Crm.isAppAction&&"edit"===e.currentStatus){var L=Handlebars.templates.ServiceModuleUtils();E.html(L);var D=CSU.setAppMenu(e,null,this.moduleName);if(delete Crm.isAppAction,Events.entityId=e.entityId,!D)return;crmui.showPop(D,!1),thirdPartyUtils.bindSelect2($(".newChosenSel").find("select")),setTimeout((function(){$("#Calendar").hide()}),50)}else crmCommonModule.serviceLookupDisabled=!1,Events.isAppointmentReschedule=!1,S.append('<div class="appointment_cal_btn"><input type="button" data-zcqa="Lookup_Appointment_cancelAppointmentBtn" id="cancelAppointmentBtn" onclick="CSU.hideAppointment_calendar()" class="newgraybtn" value='+I18n.getMsg("crm.button.cancel")+'><input type="button" data-zcqa="Lookup_Appointment_saveEventsBtn" id="saveAppointmentsBtn"  class="primarybtn mR0" onclick="Events.saveEntity(event);" value='+I18n.getMsg("crm.button.save")+"></div>"),S.addClass("appointment_calendar").show(),CSU.setAppointmentScroll(),renderingUtils.positionArrow(Events.crntEleappointment,"qCreate",Events.evtappointment,"qcpopuparrow",Events.appointmentPos),thirdPartyUtils.bindSelect2("select"),$("#Crm_Appointments_APPOINTMENTNAME").data("autopopulate",!0).on("change",function(e){$(e.target).data("autopopulate",!1),this.observer&&this.observer.disconnect()}.bind(this)),freezeBackground()}else{var k='<div id="appointmentCreate" class="newPopup ppTop  is-scroll showPpTop" style="display: none;"> <div class="pp-content">    <form action="'+Crm.getCrmBasePath()+'/CreateCommonModule.do" method="POST" name="createAppointmentForm" onsubmit="return crmTemplate.submitCreate(\'Events\');"><div id="appointmentCreationInnerDiv" class="eventForm-ins bdrbox" style="width: 100%;"></div><input type="submit" style="display:none"/></form></div><div class="pp-footer "> <input type="button" data-zcqa="Lookup_Appointment_cancelAppointmentBtn" id="cancelAppointmentBtn" onclick="CSU.cancelAppointmentBTN()" class="newgraybtn" value='+I18n.getMsg("crm.button.cancel")+'><input type="button" data-zcqa="Lookup_Appointment_saveEventsBtn" id="saveAppointmentsBtn"  class="primarybtn mR0" onclick="Events.saveEntity(event);" value='+I18n.getMsg("crm.button.save")+"> </div></div>";$(".bodycontainer").append(k),$("#appointmentCreationInnerDiv").html(_);$("#secDiv_Appointment_Information"),$("#unAvailableSpan").text();thirdPartyUtils.bindSelect2($(".newChosenSel select")),Events.module="Appointments",Events.moduleName="Appointments",Events.currentStatus=e.currentStatus;g=getObj("module")?getObj("module").value:null;"relatedlist_new"===Events.createSource&&"Appointments"===this.moduleName?crmCommonModule.isAppointmentForModuleLooked=!0:crmCommonModule.isAppointmentForModuleLooked=!1,crmCommonModule.serviceModuleLooked=!1,Events.isAppointmentReschedule=!1,crmCommonModule.customerAddress=[];var P=$("#Crm_Appointments_APPOINTMENTNAME");"clone"==e.currentStatus&&(e.entityMapJson&&e.entityMapJson.SEID&&!e.entityMapJson.SEID.defaultvalue1&&$("#Crm_Appointments_SEID_RELATEDTO").val(""),P.data("autopopulate",!0).on("change",function(e){$(e.target).data("autopopulate",!1),this.observer&&this.observer.disconnect()}.bind(this)));var A=$("#Crm_Appointments_SERVICEID");if("create"==e.currentStatus){"salessignals"===Events.createSource&&crmNTC.positionAppointmentcreatePopup(),crmCommonModule.serviceLookupDisabled=!1,P.data("autopopulate",!0).on("change",function(e){$(e.target).data("autopopulate",!1),this.observer&&this.observer.disconnect()}.bind(this));var O=A.data().id;if(O)networkUtils.lyteInitiateRequest("/crm/v2.1/Services__s/"+O,"GET").then((function(e){if(e&&e.data&&e.data.length){crmCommonModule.serviceModuleLooked=!0,CSU.setAppointmentRelatedData(e.data[0]),CSU.setMemberDataForAppointment(),setTimeout((function(){var e=document.getElementById("Crm_Appointments_SMOWNERID");if(e&&e.hasChildNodes()>0){e.component.setData("dataId",""),e.component.setData("userRecord",void 0);var t=$("#Crm_Appointments_APPOINTMENTDATEANDTIME");CSU.checkServiceAvailabilityTime(t)}}),200),crmui.showPop("appointmentCreate",!1),CSU.setAppointmentScroll();var t=$("#checkDuplicateEvent"),a=t.prev();if(t.is(":visible")){var r=a.find(".labelValCreate").outerWidth(),i=a.find(".labelTabCreate").outerWidth();t.css({width:r,"margin-top":"-10px","margin-left":i})}}}));else{crmui.showPop("appointmentCreate",!1),CSU.setAppointmentScroll();var M=(U=$("#checkDuplicateEvent")).prev();if(U.is(":visible")){var F=M.find(".labelValCreate").outerWidth(),x=M.find(".labelTabCreate").outerWidth();U.css({width:F,"margin-top":"-10px","margin-left":x})}}}if("edit"==e.currentStatus||"clone"==e.currentStatus){if(Crm.isAppAction&&"edit"===e.currentStatus){L=Handlebars.templates.ServiceModuleUtils();E.html(L);D=CSU.setAppMenu(e,D,this.moduleName);if(delete Crm.isAppAction,!D)return;crmui.showPop(D,!1)}else if(crmui.showPop("appointmentCreate",!1),CSU.setAppointmentScroll(),CSU.setAppointmentRelatedData(e.Service_needed_Details,e.Service_needed_Details.Location.uservalue,"edit"==e.currentStatus,e.Service_needed_Details.Location.systemvalue,"clone"==e.currentStatus),CSU.setMemberDataForAppointment(),"edit"==e.currentStatus){var N=$("#Appointments_fldRow_SERVICEID");$("#Crm_Appointments_APPOINTMENTDATEANDTIME").attr("disabled","disabled"),$("#Crm_Appointments_APPOINTMENTDATEANDTIME_TimeOption").attr("disabled","disabled"),$("#Appointments_fldRow_APPOINTMENTDATEANDTIME").addClass("readonlyF"),N.find(".clear_lookupfield").hide(),N.addClass("readonlyF"),$("#Crm_Appointments_SERVICEID_loadimg").remove(),$("#Crm_Appointments_SERVICEID_img").attr("data-lookup-module",""),A.attr("disabled","disabled"),crmCommonModule.serviceModuleLooked=!0,crmCommonModule.isAppointmentForModuleLooked=!0,crmCommonModule.serviceLookupDisabled=!0}else{var B=$("#Crm_Appointments_APPOINTMENTDATEANDTIME");CSU.checkServiceAvailabilityTime(B)}Events.entityId=e.entityId;var U;M=(U=$("#checkDuplicateEvent")).prev();if(U.is(":visible")){F=M.find(".labelValCreate").outerWidth(),x=M.find(".labelTabCreate").outerWidth();U.css({width:F,"margin-top":"-10px","margin-left":x})}}$("#appointmentCreate .pp-content").on("scroll",(function(){$(".lookFieldSrcWrap,.eventActionsMenu").hide()})),crmTemplate.bindFldTooltip(),labelWidthFixed("secContent_Appointment_Information"),setTimeout((function(){$("#Calendar").hide()}),50)}else if("JobSheets"===this.moduleName&&"setup"!==this.currentStatus){if(!$("#jobSheetCreateDiv")[0]){L=Handlebars.templates.ServiceModuleUtils();E.html(L)}$("#jobSheetCreateDivFields").html(_),$(".JobSheets").addClass("newFormElement"),crmui.showPopup({id:"jobSheetCreateDiv",escToClose:!1,freezeLayer:!0}),thirdPartyUtils.bindSelect2($(".newChosenSel select")),$("#appointmentCreateDiv")&&!Events.createSource&&(Events.createSource="listview"),Events.module="JobSheets",Events.moduleName="JobSheets",setTimeout((function(){$("#Calendar").hide()}),300),$("#FreezeLayer").css("z-index","31")}else if("Tasks"===this.moduleName&&e.isFromRelatedList){$("#newRelatedListPopUpDiv").append(_),crmui.showPopup({id:"newRelatedListPopUpDiv",escToClose:!1}),$("#cancelTasksBtn_Bottom").attr("data-cid",""),$("#saveAndNewTasksBtn_Bottom").hide()}else u.append(_);"layoutPreview"===a&&$(".dvPhotoShadow").show();var j=$("#zCampIntegLayout");if(j.length>0)if("zCampIntegLayoutOffline"!=j.val()){var H=$L('input[data-sysrefname="Native__Backstage__Extn__Event_Name"]');H.length||(H=$L('input[data-sysrefname="Native__Campaigns__Extn__Campaign_Subject"]')),$("#changeDefLayout").addClass("hide"),H.length&&H.on("focusout",(function(){var e=$(this).val(),t=$('input[data-sysrefname="Campaign_Name"]');validationUtils.isNotEmpty(e)&&!t.val()&&t.val(e)}))}else $("#changeDefLayout").removeClass("hide");for(var V,z=e[this.moduleName].section.length,W=0;W<z;W++){var q=e[this.moduleName].section[W].FL.length;for(n=0;n<q;n++)if("555"===e[this.moduleName].section[W].FL[n].uitype&&"clone"!=this.currentStatus){var J=e[this.moduleName].section[W].FL[n].fieldid;if(e[this.moduleName].section[W].FL[n].defaultvalue!=I18n.getMsg("crm.tpi.ctiapi.config.choosefile")&&null!=e[this.moduleName].section[W].FL[n].defaultvalue&&""!=e[this.moduleName].section[W].FL[n].defaultvalue&&0!=e[this.moduleName].section[W].FL[n].defaultvalue.length){for(var Y=0,G=0,K=e[this.moduleName].section[W].FL[n].defaultvalue.length,Q=0;Q<K;Q++){1==e[this.moduleName].section[W].FL[n].defaultvalue[Q].link_Docs?!0:3==e[this.moduleName].section[W].FL[n].defaultvalue[Q].link_Docs&&!0;var Z=0,X=e[this.moduleName].section[W].FL[n].defaultvalue[Q].file_Size.split(" ");"KB"==X[1]?Z=1024*X[0]:"MB"==X[1]&&(Z=1024*X[0]*1024);var ee=e[this.moduleName].section[W].FL[n].defaultvalue[Q].file_Id;null==ee&&(ee=e[this.moduleName].section[W].FL[n].defaultvalue[Q].preview_Url),""!=e[this.moduleName].section[W].FL[n].defaultvalue[Q].file_Size&&null!=e[this.moduleName].section[W].FL[n].defaultvalue[Q].file_Size&&(G+=parseInt(Z),Y++)}$("#attachCount_"+J).val(Y),$("#attachSize_"+J).val(G)}}}if(/Tasks|Calls/.test(i)){var te=$("#Crm_"+i+"_CONTACTID"),ae=$("#Crm_"+i+"_SEID"),re=$("#Crm_"+i+"_CONTACTID_WhoId_select");""==te.val()&&""!=ae.val()&&re.val("Contacts"),$("#Crm_"+i+"_CONTACTID_WhoId_select").parent().addClass("newChosenSel"),window[i].showRelatedToOptions(re)}("Campaigns"===i&&e.isZohoSurvey&&"true"===e.isZohoSurvey&&networkUtils.loadFeatureScripts(["zsurvey_home-min.js","zsurvey_templates.js"],(function(){ZSurvey.handleCampaignSurveyFieldsData(e)})),"PurchaseOrders"===i&&"create"===this.currentStatus)&&((V=$("#"+crmTemplate.getElemIdByColname("PurchaseOrders","PODATE")))[0]&&V.val(Utils.getDateInUserDatePattern(new Date(e.currentDate))));"Invoices"===i&&"create"===this.currentStatus&&((V=$("#"+crmTemplate.getElemIdByColname("Invoices","INVOICEDATE")))[0]&&V.val(Utils.getDateInUserDatePattern(new Date(e.currentDate))));var ie=$("#Crm_"+this.moduleName+"_TERMSANDCONDITIONS");if(ie[0]&&"create"===this.currentStatus&&ie.val(e.TERMSANDCONDITIONS),u.find(".newInputStyleEle select, div.selectElementNew1").closest(".tabDivCreate").addClass("selectBoxSelect2"),u.find(".editParentSection").removeClass("pL30"),Crm.isInventoryModule(i)&&!Crm.userDetails.isLineItemSubformMvmtDone&&productDetails.init(e,i,void 0,void 0,r),"PriceBooks"==i){var oe=$("#"+crmTemplate.getElemIdByColname("PriceBooks","PRICINGMODEL")).val();"-None-"!=oe&&""!=oe&&null!=oe||$("#secDiv_Pricing_Details").hide()}if("setup"!=this.currentStatus&&setTimeout((function(){crmTemplate.setDependentFields(i,window[i].currentStatus)}),10),"Tasks"===i){crmTasks.init(),"edit"!=window[i].currentStatus&&"clone"!=window[i].currentStatus||(crmTasks.editTask=!0),!e||null==e.compDisplayVal&&""==e.compDisplayVal||(crmTasks.compDispVal=e.compDisplayVal);var se=$("#Crm_Tasks_DUEDATE"),ne=$("#Crm_Tasks_RECURRING"),le=$("#Crm_Tasks_REMINDAT"),de=$("#Crm_Tasks_STATUS"),ce=le.parent();if(se&&""!=se.val()&&!se.data("readonly")&&ne.prop("disabled",!1),ne.data()&&null!=ne.data().recdata&&(crmTasks.isRecurringSaved=!0),"true"==e.EditSeries&&ne.is(":checked")){crmTemplate.constructRecurringActivity(i,ne[0]);var ue=$("#TasksrecurringDiv");ue.addClass("sliderPop popClose").removeClass("popOpen").removeAttr("width"),ue.addClass("pA zI31 popup_shadow").css("width","500px").hide(),crmTasks.createRecurringSummmary("commonModule"),crmTasks.recDataBefEdit=crmTasks.recurringSummaryText,"clone"!==window.Tasks.currentStatus&&(crmTasks.handleRecurChange(ue.find("select")),crmTasks.handleRecurChange(ue.find("input"))),$("#taskEndPart input").off("change.recurEdit")}$("#"+crmTemplate.getElemIdByColname("Tasks","REMINDAT")).is(":checked")&&(crmTemplate.showRemindAt(i,$("#"+crmTemplate.getElemIdByColname("Tasks","REMINDAT"))[0],!0),crmTasks.createReminderSummary("commonModule"),$("#RemindAtdiv").hide()),se&&se.data("readonly")&&ne.prop("disabled",!0),se.length?""==se.val()||Utils.compareDate(new Date,new Date(se.data("dateObj")))||ne.is(":checked")||(crmTasks.freezeReminder(),ce.off("mouseenter.duedateinpast"),ce.off("mouseleave.duedateinpast"),ce.on("mouseenter.duedateinpast",(function(){crmui.toolTip_show(this,"left",I18n.getMsg("crm.task.reminder.tooltip1"))})),ce.on("mouseleave.duedateinpast",(function(){crmui.toolTip_hide()}))):(ne.prop("disabled",!0),($("#Crm_Tasks_RemindAt_remTime_Radio").is(":checked")||ne.is(":checked"))&&le.prop("disabled",!0)),de&&de.val()==crmTasks.compDispVal&&!ne.is(":checked")&&(crmTasks.freezeReminder(),ce.off("mouseenter.duedateinpast"),ce.off("mouseleave.duedateinpast"),ce.on("mouseenter.duedateinpast",(function(){crmui.toolTip_show(this,"left",I18n.getMsg("crm.task.reminder.tooltip2"))})),ce.on("mouseleave.duedateinpast",(function(){crmui.toolTip_hide()}))),"clone"==window.Tasks.currentStatus&&Crm.userDetails.USER_ID!=$("#Crm_Tasks_SMOWNERID").data().id&&($(".Tasks_Notify_Owner").show(),$("#Crm_Tasks_SENDNOTIFICATION").data("ownerChngd",!0))}if(m){var me=$(window).height()-u.find(".cvpadding").offset().top-u.find(".cvpadding").outerHeight()-u.find(".topband_graybg").outerHeight();isChatEnabled&&(me-=26);var pe=$("#preHTMLContainer_"+i);pe.before('<div id="forEditViewScroll" class="pR oH"></div>'),$("#forEditViewScroll").append(pe).css("max-height",me+"px"),thirdPartyUtils.bindPerfectScroll("#forEditViewScroll",{wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!1});var he=document.querySelectorAll(".cruxcomponent"),fe=he.length;for(n=0;n<fe;n++){var ve=he[n].querySelector("crm-user-wrapper");if(ve){e=ve.getData();var ge=ve.id;e.id=ge,e.dataLabel=ve.getAttribute("data-label"),e.dataColname=ve.getAttribute("data-colname"),e.dataCustomfield=ve.getAttribute("data-customfield"),e.dataField=ve.getAttribute("data-field"),ve.remove(),Lyte.Component.render("crm-user-wrapper",e,"#"+he[n].id)}}}"create"!==this.currentStatus&&"setup"!==this.currentStatus&&setTimeout((function(){$("#preHTMLContainer_"+this.moduleName).find("textarea.textField").each((function(){!function(e){var t=e.outerWidth(),a=$("<span>");a.attr({id:"span_tarea",class:"dIB newgraybtn"}).css({visiblity:"hidden","font-size":"1rem","overflow-y":"scroll","line-height":"18px"}),$("body").append(a);var r=$("#span_tarea");r.text(e.val()),r.css({width:t,"word-break":"break-word"});var i=18*parseInt(r.outerHeight()/18);i>361?(r.remove(),e.css({height:"360px"})):(i=0==i?18:i,e.css({height:i}),r.remove())}($(this))}))}),200),setTimeout((function(){crmTemplate.backUpFormVals("createEntityNewForm")}),200),$("#layoutDetails").length>0&&setTimeout((function(){thirdPartyUtils.bindSelect2("#layoutDetails, #zCampIntegLayout")}),50),this.renderSubformInSection(u,e),setTimeout((function(){crmTemplate.appendSubFrmSnOverLay()}),200),setTimeout((function(){thirdPartyUtils.bindSelect2(u.find(".newChosenSel select,.mlSelect select"))}),200),crmTemplate.bindFldTooltip(),"setup"!==this.currentStatus&&crmTemplate.contentLoaded(e,this.moduleName),crmTemplate.bindSubformScrollEvent()},renderSubformInSection:function(e,t,a,r){crmTemplate.canSetupFormulaDependencies=!0,crmTemplate.forSubformFormulaNewEpxTriggered=!1;for(var i=Object.keys(crmTemplate.subformContents).length,o=0;o<i;o++){var s=crmTemplate.subformContents["subFormRender"+(o+1)],n=(s.subFormSectionId,s.subFormTable),l=s.subFormContent,d=s.subFormTabId,c=s.subFormCreateJSON,u=s.moduleName,m=s.subFormAggContent,p=s.layout,h=s.subFormSecData;if(l.length>0){var f=$(n).find("tbody tr"),v=l.find(".subFrmTablWrapper");v.append(n);var g=$(n).find(".tableHeadBg .subFrmSnFld");g.length>0&&v.append("<div class='subFrmTablSerlNoOverlay' style='display: none;'><table cellpadding='0' cellspacing='0'><thead><tr class='tableHeadBg'><td class='subFrmSnFld textFld'>"+g.html()+"</td></tr></thead><tbody></tbody></table></div><div class='subFrmTablSerlNoheadOverlay' style='display: none;'><table cellpadding='0' cellspacing='0'><thead><tr class='tableHeadBg'><td class='subFrmSnFld textFld'>"+g.html()+"</td></tr></thead></table></div>");var C=f.length,b=$(n).data("data-max_rows"),y="<a href='javascript:;' id='subFrmaddRowBtn' class='outlineprimaryflat newbutton mT20 fL subFrmaddRowBtn",w=I18n.getMsg("crm.label.subform.allowedlimit",b);y+=C>=b?" subDisabledBtn' onmouseleave=\"crmTemplate.limitReachedHide('sfrmLimitReached');\" onmouseenter=\"crmTemplate.limitReached(this,'"+w+"','sfrmLimitReached');\"":"'",y+="' onclick=\"crmTemplate.addSubFromRow(this, '"+d+"','"+u+"','"+p+"')\">"+I18n.getMsg("crm.label.subform.addrows")+"</a>",l.find(".subFrmAggTablWrapper").append(y).append(crmTemplate.createSubFormAggr(m,c,u,h,a)),null==$(n).data("data-toolTip")?l.closest(".secContent").prev('[id^="secHead"]').find(".subformTooltip").css("display","none"):(l.closest(".secContent").prev('[id^="secHead"]').find(".subformTooltip").css("display","").attr("fldtooltip",$ESAPI.encoder().encodeForHTMLAttribute($(n).data("data-toolTip"))),crmTemplate.bindFldTooltip())}}crmTemplate.subformContents=[];var I=$(".aggTempClass");I.length>0&&I.each((function(){$(this).find(".subFrmAggTablWrapper").css({"max-width":$(this).find(".subFrmTablWrapper").width(),width:$(this).find(".subFrmTablWrapper table.subformTabl").width()}),$(this).removeClass("aggTempClass")}));$(".subFrmTablWrapper").each((function(){if($(this)[0].scrollWidth>$(this).width()){var e=$(this).find(".subformTabl").height(),t=$(this).closest(".subFrmLayout");t.addClass("pR").append('<div class="SubFrmScrolIn pA"></div>'),t.find(".SubFrmScrolIn").css("height",e)}})),$(".subformParentSection").on("mouseenter",(function(){$(".subformTabl").each((function(){var e=$(this).data("datasubformreorder"),t=$(this).find("tbody"),a=t.find("tr").length,r=$(this).closest(".subFrmLayout");"true"==e?(r.removeClass("reorderDisabled").addClass("reorderEnabled"),t.sortable({revert:!1,axis:"y",containment:$(this).closest(".subFrmLayout"),stop:function(e,t){var a=t.item.closest("table"),r=a.data("data-subformid"),i=a.data("data-parentmodule");crmTemplate.updateSubFormSerialNumber(i,r);var o=a.find("crm-entity-lookup");o.length>0&&o.remove()}}),1==a&&t.sortable("disable")):r.removeClass("reorderEnabled").addClass("reorderDisabled")})),$(".subformParentSection").off("mouseenter")})),Crm.isInventoryModule(u)&&"setup"!==this.currentStatus&&Crm.userDetails.isLineItemSubformMvmtDone?($("#discountPop,#grandTaxPop,#taxPop").click((function(e){sE(e)})),productDetails.initSFLineItem(t,u,a,r)):productDetails.isInited=!1,crmTemplate.productLineItemSettings()},edit:function(e,t,a){crmCommonModule.currentStatus="edit",this.entityId=e,t.entityId=e,"Potentials"==this.moduleName&&a&&a.layoutId&&(t.triggerPipelineChange=!0),t&&void 0!==t.Appointments&&(crmCommonModule.moduleName="Appointments"),this.createTemplate(t)},showRecurringActivity:function(e,t){crmTemplate.constructRecurringActivity(this.moduleName,t)},clone:function(e,t){crmCommonModule.currentStatus="clone",t.module?crmCommonModule.moduleName=t.module:t.hasOwnProperty("Appointments")&&(crmCommonModule.moduleName="Appointments",Events.createSource=void 0),this.createTemplate(t)},showRelatedToOptions:function(e,t){var a=$("#Crm_"+this.moduleName+"_CONTACTID"),r=$("#Crm_"+this.moduleName+"_SEID"),i=r.data("lookupModule"),o=a.data("lookupModule"),s=$("#Crm_"+this.moduleName+"_SEID_label_select");if(s.prop("disabled",!1),$("#Crm_"+this.moduleName+"_SEID").prop("disabled",!1).data("mandate",$("#Crm_"+this.moduleName+"_SEID").data("defMandate")),$("#Crm_"+this.moduleName+"_SEID_img").show(),e){$("#errorMsg_Crm_"+this.moduleName+"_CONTACTID").remove(),a.removeClass("errorHighlight").css({"border-color":""});var n=$(e).val();a.data("lookupModule",n);var l=store.peekAll("module").filterBy({module_name:"Accounts"});if("Leads"==n)$("#Crm_"+this.moduleName+"_CONTACTID_img").data("lookupModule",n),crmTab.tabList.contains(n)||$("#Crm_"+this.moduleName+"CONTACTID_img").hide(),$("#Crm_"+this.moduleName+"_SEID_label_select").prop("disabled",!0),$("#Crm_"+this.moduleName+"_SEID").prop("disabled",!0).data("mandate",!1),$("#Crm_"+this.moduleName+"_SEID_img").hide(),t&&(a.val("").data("id","").data("displaylabel",I18n.getMsg("crm.module.name",[moduleRecordMapping[n].singular_label])),r.val("").data("id",""),l[0]&&l[0].visible&&Crm.moduleInfo&&Crm.moduleInfo.Accounts&&"true"==Crm.moduleInfo.Accounts.isVisible&&$("#Crm_"+this.moduleName+"_SEID_label_select").val("Accounts").trigger("change.select2")),Crm.userDetails.TaskPopup&&$("#Tasks_fldRow_SEID .labelValCreate").addClass("disableTaskPopEle");else if("Contacts"==n){if($("#Crm_"+this.moduleName+"_CONTACTID_img").data("lookupModule",n),crmTab.tabList.contains(n)||$("#Crm_"+this.moduleName+"CONTACTID_img").hide(),t&&a.val("").data("id","").data("displaylabel",I18n.getMsg("crm.module.name",[moduleRecordMapping[n].singular_label])),""===r.attr("data-lookup-module")&&l[0]&&l[0].visible)Crm.moduleInfo&&Crm.moduleInfo.Accounts&&"true"==Crm.moduleInfo.Accounts.isVisible&&$("#Crm_"+this.moduleName+"_SEID_label_select").val("Accounts");else{var d=r.attr("data-lookup-module");s.val(d).trigger("change.select2"),i=d,r.val(r.attr("value"))}Crm.userDetails.TaskPopup&&$("#Tasks_fldRow_SEID .labelValCreate").removeClass("disableTaskPopEle")}thirdPartyUtils.bindSelect2("#Crm_"+this.moduleName+"_SEID_label_select"),thirdPartyUtils.bindSelect2("#Crm_"+this.moduleName+"_CONTACTID_WhoId_select")}if(t){if(a[0]){var c=a.data();o===e.value&&(a.val(c.oldValue),a.data("id",c.oldid))}if(r[0]){c=r.data();i===s.val()&&"Contacts"===n&&r.val(c.oldValue).data("id",c.oldid)}}},updateCreateEditJson:function(e){var t=(e=$(e))&&e.attr("id")?e.attr("id").split("_"):"",a="defaultvalue",r="";if(t.length>1){var i=e.attr("id").split("_")[1],o=e.data();"checkbox"==e.attr("type")?r=e.prop("checked")?e.prop("checked")+"":"":t[3]&&"TimeOption"==t[3]?(a="timeVal",r=e.val()):r=e.val(),r||(r="");var s=o.colname;window[i]&&window[i].createEditJson&&window[i].createEditJson.entityMapJson&&window[i].createEditJson.entityMapJson[s]&&(window[i].createEditJson.entityMapJson[s][a]=r)}}},UserModule={};function rolesList(){Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.roles.index-roles")}function setTextArea(e,t){if(t=void 0!==t?t:50,void 0!==e&&e.length>t){var a=e.substring(0,t);e=a+"..."}return e}function newRole(e){null!=e&&null!=e?Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.roles.create-role","",{reportsToId:encodeURIComponent(e)}):Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.roles.create-role")}function updateNewFCManagerInForm(){if($("#fcManagerDropdown")[0]){var e=$("#fcManagerDropdown")[0].component.getData("cxPropSelectedUser");e&&$("#forecastManagerId").val(e.id)}}function storevalue(e,t,a){this.firstvalue=String(t),this.originalvalue=String(e),this.replaceelement=getObj(a),this.checkchange=function(){null!=this.replaceelement&&this.firstvalue==this.replaceelement.value&&(this.replaceelement.value=this.originalvalue)}}function editRole(e){Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.roles.edit-role",e)}function deleteRole(e){Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.roles.delete-role",e)}function transDelRole(){var e=!0;if(getObj("transferToId").value=getObj("reportsToId").value,validationUtils.isFieldEmpty($(getObj("reportsTo"))))renderingUtils.displayErrorDiv("reportsTo","crm.security.role.transferTo","crm.field.empty.check"),e=!1;else if(!emptyCheck("reportsTo","crm.security.role.transferTo"))return!1;if(e)return!0}function rolesLookUp(e,t,a,r){var i=Crm.getCrmBasePath()+"/Role.do?action=rolesLookUp&operation="+t+"&transferId="+a+"&frmPage="+r,o={success_callback:function(e){var t;if("frmEditUser"===r){var a=$("#profileEditPopup");t=a.is(":visible")?a:null}else{var i=$("#topBandPopup");t=i.is(":visible")?i:null}t&&t.addClass("hideBehind"),$("#lookupPopup").html(e),showAnimatePopup("lookupPopup"),null!=$("#tpUsers")&&null!=$("#tpUsers").val()&&setTimeout((function(){$("#tpUsers").select2({allowClear:!1,matcher:function(e,t){return matchStart(e,t)},templateResult:tpuserName,templateSelection:tpuserName,placeholder:I18n.getMsg("crm.lar.rr.chooseUser"),escapeMarkup:function(e){return e}})}),10)}};networkUtils.makeRequest(i,"GET",o)}function setReportsTo(e,t){getElemById("reportsToId").value=e,getElemById("reportsTo").value=t,hideAnimatePopup("lookupPopup")}function setUserRole(e,t,a){var r;if("frmAddUser"===a){getElemById("roleId_Add").value=e,getElemById("roleName_Add").value=t;var i=$("#topBandPopup");r=i.is(":visible")?i:null}else if("frmEditUser"==a){$("#UserEditView #roleId").val(e),getElemById("Crm_Users_ROLEID").value=t;var o=$("#profileEditPopup");r=o.is(":visible")?o:null}else if(a.startsWith("searchrole")){var s="#"+a,n=$(s+" option:selected").map((function(){return this.value})).get();n.contains(e)||(n.push(e),$(s).val(n).trigger("change"))}else if(a.indexOf("::")>-1){var l=a.substr(a.indexOf("_")+1,a.length);getElemById("roleId_"+l).value=e,getElemById("roleName_"+l).value=t}else getElemById("roleId").value=e,getElemById("roleName").value=t;if("frmAddUser"===a){var d="";if(Crm.userDetails.isUserHierarchy&&"CEO"!==t){var c='{"role_id":'.concat('"').concat(e).concat('"').concat("}");d=d+'<td nowrap="nowrap">'+I18n.getMsg("crm.user.hierarchy.reportingto")+"</td>",d+='<td nowrap="nowrap" id="reportingDropdown" style="min-width:324px;">',d+="<div>",d+='<crux-user-dropdown id="reportingToDropdown" cx-prop-class="noDropdownStyle w100p" cx-prop-filterable="false" cx-prop-query-param='.concat(c).concat(" ").concat('cx-prop-filter-selected="ParentRoleUsers" cx-prop-forced-fetch=true></crux-user-dropdown>'),d+='<input type="hidden" id="reportingtoId" name="reporting" value="">',d+="</div>",d+="</td>"}$("#userReporting").html(d)}hideAnimatePopup("lookupPopup"),r&&r.removeClass("hideBehind")}function showRoleOptionImages(e,t){Territory.editMode||(jQuery("#mo"+e).css("visibility","visible"),t&&$(t).find("span").eq(0).addClass("link1"),t&&$(t).find("span").length>0&&$(t).addClass("hover"))}function hideRoleOptionImages(e,t){jQuery("#mo"+e).css("visibility","hidden"),t&&$(t).removeClass("hover"),$(t).find("span").eq(0).removeClass("link1")}function groupsList(e){if(getObj("backto")&&"zti"==getObj("backto").value){getObj("event").value,getObj("zti_id").value,csrfParamName,encodeURIComponent(csrfToken);urlToLoad=Crm.getCrmBasePath()+"/ZTIConfig.do",loadUrl("result",urlToLoad,params)}else Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.groups.index-groups")}function editGroup(e){Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.groups.edit-group",e)}function showCreateGroup(){Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.groups.create-group")}function valCreateGroup(){var e=$("#groupName");if(validationUtils.isFieldEmpty(e))return renderingUtils.displayErrorDiv("groupName","crm.security.group.name","crm.field.empty.check.alert"),!1;if(!checkSplChars("groupName","groupName"))return!1;if(!checkSplChars("groupDesc","groupDesc"))return!1;if($("#groupDesc").val().length>250)return alert(I18n.getMsg("DescMaxLen")),!1;e.val();var t="",a=$("#groupId");a.length>0&&(t=a.val()),$("#save").prop("disabled",!0);var r=new crmRequestPool,o=$("#selectedGroupSrc option"),s=$(o[0]).val();for(i=1;i<o.length;i++)s=s+",,,"+$(o[i]).val();$("#selectedGrpObj").val(s);var n=formData2QueryString(document.createEditGroupForm),l=$("#createEditGroupForm").attr("action");return commonUtils.showHideLoadingDiv(!0),r.initiate({data:n,action:l,success:function(e){if(commonUtils.showHideLoadingDiv(!1),"object"==typeof e&&null!=e.error)return alert(e.error),$("#save").prop("disabled",!1),!1;$("#feedsLookupDiv").is(":visible")&&($("#feedsLookupDiv").hide(),removeFreezeLayer(),$("#feedsGroupMembersDiv").hide(),Utils.windowLocationReload());var a=$("#result");(a.html(e),"undefined"!=typeof searchedGroupUsersJsonObj&&(searchedGroupUsersJsonObj=[]),"undefined"!=typeof groupUsersJsonObj&&(groupUsersJsonObj=[]),a.find("#groupid").length>0&&null!=a.find("#groupid").val()&&""!==a.find("#groupid").val()&&"null"!==a.find("#groupid").val())&&(Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.groups.view-group",$("#result").find("#groupid").val()).data={data:e});return""==t&&Crm.trackSpotLightAction("Group Created"),!1}}),!1}function changeAvilGroupSrc(e,t){var a=e.value;""==a&&(a="availEmailFieldPL");var r=null;if(a.indexOf(":")>-1){var i=a;a=i.split(":")[0],r=i.split(":")[1]}getObj("availGroupsPLDiv").style.display="none",getObj("availRolesPLDiv").style.display="none",getObj("availRolesubsPLDiv").style.display="none",getObj("availUsersPLDiv").style.display="none";var o=getElemById("availTerritoriesPLDiv");o&&(o.style.display="none");var s=getElemById("availTerrWithChildsPLDiv");s&&(s.style.display="none");var n=getObj("availEmailFieldPLDiv");n&&(n.style.display="none");var l=getObj("availRelEmailFieldPLDiv");if(l){var d;if(l.style.display="none",t){for(m=(c=$("#availRelEmailFieldPL")).children().length-1;m>=0;m--)c.empty(m);(u=$("#availRelEmailFieldPLTemp"))&&(d=u.children().length)}else{var c,u;for(m=(c=getElemById("availRelEmailFieldPL")).length-1;m>=0;m--)c.remove(m);(u=getElemById("availRelEmailFieldPLTemp"))&&(d=u.length)}if(u)for(var m=0;m<d;m++){if(t)var p=(h=u.children()[m]).attributes["data-value"].value;else{var h;p=(h=u.options[m]).value}if(p.indexOf(":"+r)>-1&&-1==p.indexOf(":"+r+"_")||null!=r&&0==r.indexOf("Lookup_")&&p.indexOf(r.substring(7)+":")>-1){if(t){var f=document.createElement("LI");if((b=document.createAttribute("data-value")).value=p,f.setAttributeNode(b),f.textContent=h.textContent,0==!h.textContent.indexOf("*")){f.setAttribute("data-onClick","addGroupItems(this);"),f.setAttribute("onmouseenter","showAddButton(this);"),f.setAttribute("onmouseleave","hideAddButton(this);");var v=document.createElement("INPUT");v.setAttribute("type","button"),v.setAttribute("class","addSelLi cP primarybtn bt-smallprimarybtn"),v.setAttribute("onClick","addGroupItems(this)"),v.setAttribute("value",I18n.getMsg("crm.label.add")),v.setAttribute("style","display:none"),f.appendChild(v)}c.append(f)}else{(f=document.createElement("OPTION")).value=p,f.text=h.text,c.add(f)}(p.indexOf("EF:")>-1||p.indexOf("REF:")>-1)&&"C"!==Crm.userDetails.LICENSE_TYPE&&"Z"!==Crm.userDetails.LICENSE_TYPE&&"A"!==Crm.userDetails.LICENSE_TYPE&&"E"!==Crm.userDetails.LICENSE_TYPE&&(f.disabled=!0)}}}callComboUnSelect("availGroupsPL"),callComboUnSelect("availRolesPL"),callComboUnSelect("availRolesubsPL"),callComboUnSelect("availUsersPL"),getElemById("availTerritoriesPL")&&callComboUnSelect("availTerritoriesPL"),getElemById("availTerrWithChildsPL")&&callComboUnSelect("availTerrWithChildsPL"),getObj("availEmailFieldPL")&&callComboUnSelect("availEmailFieldPL"),getObj("availRelEmailFieldPL")&&callComboUnSelect("availRelEmailFieldPL"),callComboUnSelect("selectedGroupSrc"),getObj(a+"Div").style.display="block";var g=$("#"+a),C=I18n.getMsg("crm.label.picklist.none");if(t){if(0==g.children("li").length){var b;f=document.createElement("LI");(b=document.createAttribute("data-value")).value="--None--",f.setAttributeNode(b),f.textContent=C;var y=document.createAttribute("class");y.value="wf_empty_li",f.setAttributeNode(y),g.append(f)}}else if(0==$("#"+a+" option").length){var w=document.createElement("OPTION");w.value="--None--",w.text=C,g.append(w)}}function buttonenable(){var e=$("#selectedGroupSrc option");e.length>=1&&"--None--"!=e[0].value&&$("#save").prop("disabled",!1)}function addGroupItems(e){blockContent("otherEmails",event);var t=I18n.getMsg("crm.label.picklist.none"),a=getObj("selectedGroupSrc");for(i=0;i<a.length;i++)a.options[i].selected=!1;var r=getElemById("groupSrcType").value;r=r.split(":")[0];var o=getObj(r),s=null;"availRelEmailFieldPL"==r&&(s=getElemById("availRelEmailFieldPLTemp"));var n,l=getGrpsrcType(r),d=new Array,c=0;for(i=0;i<o.length;i++){if(1==(n=o.options[i]).selected&&n.value!=t&&"--None--"!=n.value)d[c++]=i,(h=document.createElement("OPTION")).value=n.value,h.text=""!==l?l+": "+n.text:n.text,a.appendChild(h),h.selected=!0;n.selected=!1}if(e){var u=$(e).parent();if(u.data("value")!=t&&"--None--"!=u.data("value")){(h=document.createElement("LI")).setAttribute("data-value",u.data("value")),h.setAttribute("onmouseenter","showRmvButton(this);"),h.setAttribute("onmouseleave","hideRmvButton(this);"),h.setAttribute("data-onClick","delGroupItems(this);");var m=""!=l?"<span>"+l+": "+$ESAPI.encoder().encodeForHTML(u.text())+"</span>":"<span>"+$ESAPI.encoder().encodeForHTML(u.text())+"</span>";m+="<input type='button' class='rmvSelLi cP redbtn bt-smallredbtn' value='"+I18n.getMsg("crm.label.remove")+"' onClick='delGroupItems(this);' style='display: none;'>",$(h).empty(),h.innerHTML=m,a.appendChild(h);var p=h.parentNode.getElementsByClassName("wf_empty_li");p.length>0&&(p[0].style.display="none")}if(u.remove(),0==o.children.length){var h=' <li data-value="--None--" class="wf_empty_li">'+t+"</li>";$(o).empty(),o.innerHTML=h}"function"==typeof showHideFromAddress&&showHideFromAddress()}for(i=d.length-1;i>=0;i--){var f=o[d[i]].value;if(o.remove(d[i]),s)for(c=s.length-1;c>=0;c--)s[c].value==f&&s.remove(c)}0==o.length&&((h=document.createElement("OPTION")).value="--None--",h.text=t,o.appendChild(h));a.length>1&&"--None--"==a.options[0].value&&a.remove(0)}function getGrpsrcType(e){return"availGroupsPL"==e?G:"availRolesPL"==e?R:"availRolesubsPL"==e?RS:"availUsersPL"==e?U:"availTerritoriesPL"==e?T:"availTerrWithChildsPL"==e?TS:"availEmailFieldPL"==e||"availRelEmailFieldPL"==e?"":void 0}function delGroupItems(e){var t,a,r=I18n.getMsg("crm.label.picklist.none"),o=getObj("selectedGroupSrc"),s=new Array,n=0,l=/^[^:]+:[ ]?/g;for(i=0;i<o.length;i++){if("--None--"==(a=o.options[i]).value)a.selected=!1;else if(1==a.selected){var d=null;if(g=a.text,h=null,(t=a.value).indexOf("G:")>-1)h=getObj("availGroupsPL");else if(t.indexOf("R:")>-1)h=getObj("availRolesPL");else if(t.indexOf("RS:")>-1)h=getObj("availRolesubsPL");else if(t.indexOf("U:")>-1)h=getObj("availUsersPL");else if(t.indexOf("T:")>-1)h=getElemById("availTerritoriesPL");else if(t.indexOf("TS:")>-1)h=getElemById("availTerrWithChildsPL");else if(0==t.indexOf("EF:"))h=getObj("availEmailFieldPL");else if(t.indexOf("REF:")>-1)d=getElemById("availRelEmailFieldPLTemp"),(!(t.indexOf("Owner:")>-1||t.indexOf("Creator:")>-1||t.indexOf("Manager:")>-1)||t.split(":")[1]==getElemById("groupSrcType").value.split(":")[1]||t.indexOf(":"+getElemById("groupSrcType").value.split(":")[1]+":")>-1)&&(h=getObj("availRelEmailFieldPL"));else if(t.indexOf("Owner:")>-1||t.indexOf("Creator:")>-1||t.indexOf("Manager:")>-1){var c=t.split(":")[1];getElemById("groupSrcType").options[0].getAttribute("module")==c?h=getObj("availEmailFieldPL"):(d=getElemById("availRelEmailFieldPLTemp"),c==getElemById("groupSrcType").value.split(":")[1]&&(h=getObj("availRelEmailFieldPL")))}if(-1==t.indexOf("REF:")&&-1==t.indexOf("EF:")&&(g=g.replace(l,"")),(v=document.createElement("OPTION")).value=t,v.text=g,h&&h.appendChild(v),d){var u=document.createElement("OPTION");u.value=t,u.text=g,d.appendChild(u)}v.selected=!0,s[n++]=a}null!=h&&h.length>1&&"--None--"==h.options[0].value&&h.remove(0)}for(var m=0;m<s.length;m++)o.removeChild(s[m]);0==o.length&&((v=document.createElement("OPTION")).value="--None--",v.text=r,o.appendChild(v),$("#save").prop("disabled",!0));if(e){var p=$(e).parent();if(0==p.length)return;var h=null;(t=p.data("value")).indexOf("G:")>-1?h=getObj("availGroupsPL"):t.indexOf("R:")>-1?h=getObj("availRolesPL"):t.indexOf("RS:")>-1?h=getObj("availRolesubsPL"):t.indexOf("U:")>-1?h=getObj("availUsersPL"):t.indexOf("T:")>-1?h=getElemById("availTerritoriesPL"):t.indexOf("TS:")>-1?h=getElemById("availTerrWithChildsPL"):0==t.indexOf("EF:")?h=getObj("availEmailFieldPL"):t.indexOf("REF:")>-1?(d=getElemById("availRelEmailFieldPLTemp"),(!(t.indexOf("Owner:")>-1||t.indexOf("Creator:")>-1||t.indexOf("Manager:")>-1)||t.split(":")[1]==getElemById("groupSrcType").value.split(":")[1]||t.indexOf(":"+getElemById("groupSrcType").value.split(":")[1]+":")>-1)&&(h=getObj("availRelEmailFieldPL"))):(t.indexOf("Owner:")>-1||t.indexOf("Creator:")>-1||t.indexOf("Manager:")>-1)&&(c=p.data("value").split(":")[1]);var f=null;c=p.data("value").split(":")[1];getElemById("groupSrcType").options[0].getAttribute("module")==c?h=getObj("availEmailFieldPL"):(d=getElemById("availRelEmailFieldPLTemp"),c==getElemById("groupSrcType").value.split(":")[1]&&(h=getObj("availRelEmailFieldPL")));var v,g=p.text();if(-1==t.indexOf("REF:")&&-1==t.indexOf("EF:")&&(g=g.replace(l,"")),(v=document.createElement("LI")).setAttribute("data-value",p.data("value")),v.setAttribute("onmouseenter","showAddButton(this);"),v.setAttribute("onmouseleave","hideAddButton(this);"),v.setAttribute("data-onClick","addGroupItems(this);"),v.innerHTML="<span>"+$ESAPI.encoder().encodeForHTML(g)+"</span>",v.innerHTML+="<input type='button' class='addSelLi cP primarybtn bt-smallprimarybtn' value='"+I18n.getMsg("crm.label.add")+"' onClick='addGroupItems(this);' style='display: none' >",null!=h)h.appendChild(v),f=v.parentNode.getElementsByClassName("wf_empty_li");else{var C=document.createElement("LI");C.setAttribute("data-value",p.data("value")),C.setAttribute("onmouseenter","showAddButton(this);"),C.setAttribute("onmouseleave","hideAddButton(this);"),C.setAttribute("data-onClick","addGroupItems(this);"),$(C).empty(),C.innerHTML="<span>"+$ESAPI.encoder().encodeForHTML(g)+"</span>",C.innerHTML+="<input type='button' class='addSelLi cP primarybtn bt-smallprimarybtn' value='"+I18n.getMsg("crm.label.add")+"' onClick='addGroupItems(this);' style='display: none' >",d.appendChild(C),f=C.parentNode.getElementsByClassName("wf_empty_li")}if(f.length>0&&(f[0].style.display="none"),p.remove(),1==o.children.length)(f=o.getElementsByClassName("wf_empty_li")).length>0&&(f[0].style.display="");"function"==typeof showHideFromAddress&&showHideFromAddress()}}function showAddButton(e){$(e).find(".addSelLi").css({display:"inline"})}function hideAddButton(e){$(e).find(".addSelLi").hide()}function showRmvButton(e){$(e).find(".rmvSelLi").css({display:"inline"})}function hideRmvButton(e){$(e).find(".rmvSelLi").hide()}function showSharingRules(){Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.data-sharing.index-data-sharing")}function editOrgDefPer(e){var t=Crm.getCrmBasePath()+"/SharingSetting.do?action=editOrgDefPer&tabId="+encodeURIComponent(e);new AjaxAPI({id:"editOrgDefDiv",url:t,callbackfn:function(e){checkSessionExpired(e),setFocus("editOrgDefPer"),showAnimatePopup("editOrgDefDiv")}}).post()}function editAllDefSRPer(){Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.data-sharing.edit-default-data-sharing")}function updateOrgDefPer(e){var t=getObj("editOrgDefPer").value,a=Crm.getCrmBasePath()+"/SharingSetting.do?action=updateOrgDefPer&tabId="+encodeURIComponent(e)+"&permission="+t;document.deleteForm.action=a,UpdateDetails("",deleteForm,"")}function newSharingRule(e){var t=new RegExp("Leads|Accounts|Contacts|Services|Appointments|Potentials|Campaigns|Activities|Calls|Tasks|Events|Cases|Solutions|Products|Vendors|PriceBooks|Quotes|SalesOrders|PurchaseOrders|Invoices|CustomModule[1]?[1-9]|CustomModule10|CustomModule20|LinkingModule([1-9]|1[0-9]|2[0-9]|3[0-9]|4[0-9]|50|500[1-8])");e.match(t)&&Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.data-sharing.create-data-sharing","",{module:e})}function valNewShareRule(){if(!validateSharingRuleData(!0))return!1;var e=$("#createRule"),t=$("#updateRule"),a=e.length>0?e:t;return a.addClass("disabled"),doAjaxUpdateForm("result",document.shareruleform,(function(e){if($("#setup_new_ContentDiv").scrollTop(0),null!=e){switch(e.message){case"sharing_from_roleId_invalid":renderingUtils.displayErrorDiv("sharingSrc_R","crm.security.sharing.from","crm.security.sr.role.deleted");break;case"sharing_to_roleId_invalid":renderingUtils.displayErrorDiv("sharingTo_R","crm.security.sharing.to","crm.security.sr.role.deleted");break;case"sharing_from_groupId_invalid":renderingUtils.displayErrorDiv("sharingSrc_G","crm.security.sharing.from","crm.security.sr.group.deleted");break;case"sharing_to_groupId_invalid":renderingUtils.displayErrorDiv("sharingTo_G","crm.security.sharing.to","crm.security.sr.group.deleted");break;case"scheduler already running":crmui.showPopup("scheduler_Sharing_Rule"),commonUtils.showHideLoadingDiv();break;case"module_unavailable":crmui.showPopup("module_Sharing_Rule"),commonUtils.showHideLoadingDiv();break;case"Sharing Rule Name is duplicated":renderingUtils.displayErrorDiv("sharingRuleName",[],"crm.alert.sec.sharingrulename.duplicate");break;case"The given api_name seems to be invalid":crmui.showMsgBand("error",I18n.getMsg("crm.sharing.rules.field.invalid"),4e3);break;case"invalid_ruleid":crmui.showMsgBand("error",I18n.getMsg("crm.datasharingrules.save.error.unavailable"),4e3);break;case"exception in parsing filter":crmui.showMsgBand("error",I18n.getMsg("crm.sharing.rules.filter.error"),4e3);break;default:crmui.showMsgBand("error",I18n.getMsg("crm.sharing.rules.internal.error"),4e3)}a.removeClass("disabled")}})),!1}function validateSharingRuleData(e){var t=!0,a=!0,r=!1,i=document.getElementById("shareSrcType").value,o=document.getElementById("shareToType").value,s=document.getElementById("sharingSrc_G").value,n=document.getElementById("sharingTo_G").value,l=document.getElementById("share_criteria_editor"),d=document.getElementById("sharingRuleName");if(d){var c=d.value.trim();if(""===c)e&&renderingUtils.displayErrorDiv("sharingRuleName","crm.security.records.sharing.name","crm.field.empty.check"),t=!1;else if(e){var u=getClrTxtPtnResChars(c,/[^~`#,%^&*()+={}[\]|;"<>\\]/g).join(" ");if(""!==u){var m=I18n.getMsg("crm.security.records.sharing.name"),p=1===u.length?"crm.clearTextPattern.validationFail.alert":"crm.clearTextPattern.validationFail.alert.moreThanOneChar";renderingUtils.displayErrorDiv("sharingRuleName",[m,u],p),t=!1}}var h=document.getElementById("category_enable");h&&(a=h.checked);var f=document.getElementById("criteria_enable");f&&(r=f.checked)}if(r&&($("#share_criteria_editor .editPatternInput").length>0&&(t=!1),e)){var v=l.getCriteria();!0===r&&void 0===v&&e&&(renderingUtils.showCustomAlert(I18n.getMsg("crm.datasharing.criteria.empty")),t=!1),!0!==r||null!==v&&!1!==v||(t=!1)}return"G"!==i&&(s=document.getElementById("sharingSrc_R").value),"G"!==o&&"AU"!==o&&(n=document.getElementById("sharingTo_R").value),!0===a&&""===s&&(e&&("G"===i?renderingUtils.displayErrorDiv("sharingSrc_G","crm.security.sharing.from","crm.field.empty.check"):renderingUtils.displayErrorDiv("sharingSrc_R","crm.security.sharing.from","crm.field.empty.check")),t=!1),""===n&&"AU"!==o&&(e&&("G"===o?renderingUtils.displayErrorDiv("sharingTo_G","crm.security.sharing.to","crm.field.empty.check"):renderingUtils.displayErrorDiv("sharingTo_R","crm.security.sharing.to","crm.field.empty.check")),t=!1),document.getElementById("shareSrcId").value=s,document.getElementById("shareToId").value=n,t}function changeSRSrcType(e){var t=e.value;getObj("sharingSrcGDiv").style.display="none",getObj("sharingSrcRDiv").style.display="none",thirdPartyUtils.bindSelect2($(".newSelect").find("select")),"G"==t?getObj("sharingSrcGDiv").style.display="inline-block":(getObj("sharingSrcRDiv").style.display="inline-block",blockContent("sharingSrc_R"),blockContent("sharingSrc_G"),blockContent("sharingTo_G"),blockContent("sharingTo_R")),setTimeout((function(){$(".sharingTypeSelect").find("select").select2({placeholder:I18n.getMsg("crm.select")})}),10)}function changeSRToType(e){var t=e.value,a=$("#isSuperiorAllowedCheckBox"),r=$("#isSuperiorsAllowedLabel");a.attr("disabled",!1),r.removeClass("cD"),a.removeClass("cD"),r.removeAttr("onmouseleave onmouseenter"),getObj("sharingToGDiv").style.display="none",getObj("sharingToRDiv").style.display="none",thirdPartyUtils.bindSelect2($(".newSelect").find("select")),"G"==t?getObj("sharingToGDiv").style.display="inline-block":"AU"===t?($("sharingToGDiv").addClass("dN"),a.prop("checked",!1),a.attr("disabled",!0),r.addClass("cD"),a.addClass("cD"),r.attr("onmouseenter","crmui.showTooltip({content: '"+I18n.getMsg("crm.sharing.rules.allusers.note")+"',position: 'center'})").attr("onmouseleave","crmui.hideTooltip();")):getObj("sharingToRDiv").style.display="inline-block",setTimeout((function(){$(".sharingTypeSelect").find("select").select2({placeholder:I18n.getMsg("crm.select")})}),10)}function delShareRule(e,t){var a=Crm.getCrmBasePath()+"/SharingSetting.do?action=delRule&ruleId="+encodeURIComponent(e);document.deleteForm.action=a,UpdateDetails("",deleteForm,"","",(function(e){if(void 0===e){var a={status:"progress"};a.module=t;var r=$("#sharingRulesNew_"+a.module);a.id=r.attr("data-tabid");var i=I18n.getMsg(r.attr("data-zcqa").replace("security_dataSharing_newrule_",""));a.message=I18n.getMsg("crm.security.sharing.rules.in.progress",i),dsNotificationScheduler.addOrUpdateSchedulerStatus(a,I18n.getMsg("crm.security.sharing.rules.popup.title"))}else"deleted_role/group/DSR_selected"===e.error&&(crmui.showMsgBand("error",I18n.getMsg("com.datasharingrules.error.unavailable"),4e3),commonUtils.showHideLoadingDiv())}))}function editShareRule(e,t){Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.data-sharing.edit-data-sharing",e,{module:t})}function recalculateSR(){var e=document.getElementById("compute_Sharing_Rule").getAttribute("data-moduleid");e&&loadUrl("result",Crm.getCrmBasePath()+"/SharingSetting.do?action=recalculate&tabid="+e,"",!0)}function showPerTabSuccessMessage(e){getObj("loadingDiv").style.position="absolute",$(getObj("loadingDiv")).empty(),getObj("loadingDiv").innerHTML=e,getObj("loadingDiv").style.width="300px",getObj("loadingDiv").className="successMsg",mailsetCenter("loadingDiv"),$("#loadingDiv").fadeIn().delay(2e3).fadeOut("slow")}function clearLookupField(e,t){if(getObj(e).value="",getObj(t).value="",null!=t&&""!=t&&-1!=t.indexOf("_")){var a=t.substring(t.indexOf("_")+1,t.length),r=$("#clearLookupField_"+a);null!=r.attr("class")&&r.hasClass("show-close")&&r.removeClass("show-close"),"property(Campaign Source)"===fldName&&$("#clearCampaigns").addClass("vH")}}function checkSessionExpired(e){var t=e.responseText;(t.indexOf("Why does my session expire")>-1||t.indexOf("Affordable for Medium Business")>-1)&&(location.href="/crm/Reauth.sas")}function setFocus(e){getObj(e)&&getObj(e).focus()}function callComboUnSelect(e){$($("#"+e).find(":selected")).prop("selected",!1)}function showStatusMsg(e){""!=e&&($(getObj("statusMsgDiv")).empty(),getObj("statusMsgDiv").innerHTML=e,show("statusMsgDiv"),mailsetCenter("statusMsgDiv"),setTimeout((function(){hide("statusMsgDiv"),deSelectAll(),getObj("allcheck")&&(getObj("allcheck").checked=!1)}),2e3))}function zmailBackupReq(e,t){var a=Crm.getCrmBasePath()+"/ZMailConfig.do",r="action=ZmailBackupReq&userId="+e+"&zmail="+t+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);doAjaxUpdate("result",a,r)}function showBlockMsgDiv(e){"config_backup"==e?(freezeBackground(),mailsetCenter("configBackupDiv")):"config"==e?(freezeBackground(),mailsetCenter("configDiv")):"backup"==e&&(freezeBackground(),mailsetCenter("backupDiv"))}UserModule.getSaveParam=function(e){return{"First Name":"firstName","Last Name":"lastName",Email:"email",Role:"roleName",Alias:"alias",Phone:"phone",Mobile:"mobile",Website:"url",Fax:"fax",Profile:"profileId",Street:"street",City:"city",State:"state",Country:"country","Zip Code":"zip",Language:"langCode","Time Zone":"timeZone","Time Format":"userTimeFormat",Currency:"currencyISOCode","Date of Birth":"dob"}[e]},UserModule.enableSaveSharingRuleBtn=function(){var e=$("#createRule"),t=$("#updateRule"),a=e.length>0?e:t;validateSharingRuleData(!1)?(a.removeClass("disabled"),a.prop("disabled",!1)):(a.addClass("disabled"),a.prop("disabled",!0))},UserModule.showSharingRuleSuccessPopup=function(e){"createRule"===e?crmui.showMsgBand("success",I18n.getMsg("crm.security.sr.crt.success.message"),4e3):"updateRule"===e?crmui.showMsgBand("success",I18n.getMsg("crm.security.sr.upd.success.message"),4e3):"delRule"===e?crmui.showMsgBand("success",I18n.getMsg("crm.security.sr.del.success.message"),4e3):"recalculate"===e&&crmui.showMsgBand("success",I18n.getMsg("crm.security.sr.rerun.success.message"),4e3)},UserModule.setSharingRuleConditions=function(){return{date:[{system:"equal",display:_cruxUtils.getI18n("is")},{system:"not_equal",display:_cruxUtils.getI18n("isn't")},{system:"less_than",display:_cruxUtils.getI18n("is before")},{system:"greater_than",display:_cruxUtils.getI18n("is after")},{display:_cruxUtils.getI18n("between"),system:"between"},{display:_cruxUtils.getI18n("not between"),system:"not_between"},{system:"${EMPTY}",display:_cruxUtils.getI18n("is empty")},{system:"${NOTEMPTY}",display:I18n.getMsg("isnotempty")}]}},UserModule.focusInSharingRuleName=function(){$("#sharingRuleNameDiv").addClass("focusEleField")},UserModule.focusOutSharingRuleName=function(){$("#sharingRuleNameDiv").removeClass("focusEleField")},UserModule.showSharingRulePopUp=function(e,t){crmui.showPopup({id:"compute_Sharing_Rule"}),document.getElementById("sharingRuleHeading").innerText=I18n.getMsg("crm.security.sr.rerun.note1",t),document.getElementById("compute_Sharing_Rule").setAttribute("data-moduleid",e)};var allUserList=new Array;function setUserInfo(e,t,a){this.email=e,this.userid=t,this.zuid=a}function IntegrationService(){new Array,new Array,new Array,new Array,new Array;this.is_service_alert="N",this.allUserObjArr=allUserList}function getCurrentUserEmail(){var e=new Array;return e[0]=getObj("email").value,e}function compareSelectedEmailWithServiceEmail(e,t,a){var r="";if(null!=t)for(var i=0;i<t.length;i++)if(null!=t[i])for(var o=0;o<e.length;o++)if(null!=e[o]&&trimBoth(t[i])==trimBoth(e[o])){r+="ZTI"==a?'<b class="dim">'+$ESAPI.encoder().encodeForHTML(t[i])+" </b>":'<p><b class="dim">'+$ESAPI.encoder().encodeForHTML(t[i])+"</b></p>";break}return r}function getEmailByServiceUserId(e,t){for(var a=new Array,r=0,i=0;i<t.length;i++)if(null!=t[i]&&null!=e)for(prop in e)if(null!=e[prop]&&null!=e[prop].userid&&trimBoth(t[i])==trimBoth(e[prop].userid)){a[r++]=e[prop].email;break}return a}function getEmailByServiceZUID(e,t){for(var a=new Array,r=0,i=0;i<t.length;i++)if(null!=t[i]&&null!=e)for(prop in e)if(null!=e[prop]&&null!=e[prop].zuid&&trimBoth(t[i])==trimBoth(e[prop].zuid)){a[r++]=e[prop].email;break}return a}function getServiceResponse(e,t){new Array;return e[t].substring(1,e[t].length-1).split(",")}function checkDBStatusAndOpenZReports(e){var t=Crm.getCrmBasePath()+"/ZReportsConfig.do",a="mode=checkDBStatus&"+csrfParamName+"="+encodeURIComponent(csrfToken);mR(t,(function(t){"true"==t?window.open(e):document.location.href=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/ShowSetup.do?tab=webInteg&subTab=zohoApps&mode=showConfig")}),a)}function replaceSplChrs(e){return e.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#39;/g,"'").replace(/&amp;/g,"&")}function revertSplChrs(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;")}IntegrationService.isServiceAlerted="N",IntegrationService.pageName="VIEW_ALL_USER",IntegrationService.prototype.setIntegrationService=function(e){var t="zuids="+encodeURIComponent(this.getZUIDS()),a=Crm.getCrmBasePath()+"/License.do?actionType=checkUserService";mR(a,(function(t){var a="object"==typeof t?t:JSON.parse(t);if(IntegrationService.pageName=e,this.allUserEmail=(new IntegrationService).allUserEmails(),"VIEW_ALL_USER"==IntegrationService.pageName)this.selectedUserEmail=getSelectedUsersEmailList();else if("ACTIVATE_USER"==IntegrationService.pageName){var r=new Array;this.selectedUserEmail=r}else this.selectedUserEmail=getCurrentUserEmail();this.zti_reference_users_zuid=getServiceResponse(a,"ZTI"),this.project_users_email=getServiceResponse(a,"ZOHOPROJECT"),this.zti_reference_users_email=getEmailByServiceZUID((new IntegrationService).allUserObjArr,this.zti_reference_users_zuid)}),t)},IntegrationService.prototype.getZUIDS=function(){var e=(new IntegrationService).allUserObjArr,t="";for(prop in e)null!=e[prop].zuid&&"null"!=e[prop].zuid&&""!=e[prop].zuid&&(t+=e[prop].zuid+"###");return t},IntegrationService.prototype.allUserEmails=function(){var e=(new IntegrationService).allUserObjArr,t=new Array,a=0;for(prop in e)null!=e[prop].email&&(t[a++]=e[prop].email);return t},IntegrationService.prototype.doValidate=function(e){var t="";"VIEW_ALL_USER"==IntegrationService.pageName?selectedUserEmail=getSelectedUsersEmailList():"ACTIVATE_USER"==IntegrationService.pageName&&(selectedUserEmail=getEmailByServiceUserId(this.allUserObjArr,e)),""!==(t=compareSelectedEmailWithServiceEmail(selectedUserEmail,zti_reference_users_email,"ZTI"))&&getObj("ZTIservice")&&getObj("ZTIServiceEmail")&&(getObj("ZTIservice").style.display="block",$(getObj("ZTIServiceEmail")).empty(),getObj("ZTIServiceEmail").innerHTML=t,IntegrationService.isServiceAlerted="S"),t="",""!==(t=compareSelectedEmailWithServiceEmail(selectedUserEmail,project_users_email,"Project"))&&$("#projectService")&&$("#ProjectServiceEmail")&&($("#projectService").show(),$("#ProjectServiceEmail").html(t),IntegrationService.isServiceAlerted="S")};var clrTxtPtnRegex=/[^~`#%^&*()+={}[\]|\;"<>\\]/g,uNameEmail=/^(([A-Za-z0-9_.]+)|([A-Za-z0-9._%+\-]+@[A-Za-z0-9.\-]+\.[a-zA-Z]{2,6}))$/g,clrTxtPtnRegexWithSingleQuote=/[^~`#%^&*+=[\]|\;"<>\\]/g;function isClearTextPattern(e){if(""==e)return!0;var t=e.replace(clrTxtPtnRegex,"RV");return""==(t=replace(t,"RV",""))}function getClrTxtPtnResChars(e,t){return t=void 0===t?clrTxtPtnRegex:t,eliminateDuplicates(e.replace(t,"").split(""))}function eliminateDuplicates(e){var t,a=e.length,r=[],i={};for(t=0;t<a;t++)i[e[t]]=0;for(t in i)r.push(t);return r}function showOrHideUserDetail(e){null!=Crm.userDetails&&Crm.userDetails.CUSTOMIZE_INFO.ShowUserDV&&(e.hide(),e.find("#showHideDetail").addClass("hideDetailArrow").html(I18n.getMsg("crm.button.hide.details")),e.find("#UserInfoDiv").css({display:"block"}),setTimeout((function(){e.show()}),150))}function checkForWindowOpener(e,t,a){if("A"!=e.nodeName&&"AREA"!=e.nodeName)return!1;if(href=e.getAttribute("href"),!href)return!1;"http:"!=e.protocol&&"https:"!=e.protocol||(targetName=e.getAttribute("target"),(a||targetName&&"_top"!==targetName&&"_self"!==targetName&&"_parent"!==targetName)&&e.setAttribute("rel","noopener noreferrer"))}function updateReportingForBranchChange(e,t){var a={},r=Crm.getCrmBasePath()+"/Security.do";if(networkUtils.setCsrfParam(a),"roleChange"!=t&&"subordinates"!=t||(a.roleId=$("#roleIdForChange").val()),"roleChange"!=t&&(a.userId=$("#userIdForChange").val()),$("#subList").length>0){var i=[];$("#subList").children().each((function(){i.push($(this).attr("value"))})),a.subIdList=i}if("roleChangePopUp"==e){var o=$("#userDD");"None"!=o.val()&&(a.reportingToId=o.val())}else if("branchChangePopup"==e){var s=$("#subUserDD");"None"!=s.val()&&(a.reportingToId=s.val());var n=$("#userReportingDD");"None"!=n.val()&&(a.userReportingToId=n.val())}a.actionName="updateHierarchy",a.actionType=t,(new crmRequestPool).initiate({action:r,type:"POST",data:a,success:function(t){$("#reportingView").length>0&&($("#reportingView").text(t.reportingto),$("#subView").text(t.subordinates)),hideAnimatePopup(e);var a=$("#roleChangePopUp");if($("#rolesUserTable").length>0&&a.length>0){a.remove();for(var r=t.users,i=t.manager,o=0;o<r.length;o++)$("#reporting_"+r[o]).text(i)}a.remove(),$("#branchChangePopup").remove()}})}function updateReportingForRoleChange(e,t,a){var r={};if("roleChange"==t||"subordinates"==t?r.roleId=$("#roleIdForChange").val():r.userId=$("#userIdForChange").val(),"roleChangePopUp"==e){var i=$("#reportingToDropdown");if(void 0===(o=i[0].component.getData("cxPropSelectedUser").id))return renderingUtils.displayErrorDiv("Users",void 0,I18n.getMsg("crm.user.hierarchy.reporting.notempty"),i[0]),!1;r.reportingToId=o}else if("branchChangePopup"==e){var o,s=$("#subUserDropdown");if(void 0===(o=s[0].component.getData("cxPropSelectedUser").id))return renderingUtils.displayErrorDiv("Users",void 0,I18n.getMsg("crm.user.hierarchy.reporting.notempty"),$L(s[0].parentElement)),!1;r.reportingToId=o;var n=$("#managerDropdown"),l=n[0].component.getData("cxPropSelectedUser").id;if(void 0===l)return renderingUtils.displayErrorDiv("Users",void 0,I18n.getMsg("crm.user.hierarchy.reporting.notempty"),n),!1;r.userReportingToId=l}"roleChangeWithSub"===t&&(t="roleChange"),"roleChangeDeleteWithSub"===t&&(t="roleChangeDelete"),r.actionType=t;var d=$("#roleChangePopUp"),c=$("#branchChangePopup");if(d.length>0){var u=$("#RoleAction");u.length>0&&Territory.doUpdateForm("result",u[0],!0,!0,void 0,void 0,void 0,void 0,r);var m=$("#deleteRoleForm");m.length>0&&UpdateDetails(["transDelRole"],m[0],void 0,void 0,void 0,void 0,r)}"subordinates"!==t&&"manager"!==t&&"submanagerchange"!==t||addorupdateUsers("editUser",r,a),d.remove(),c.remove()}function setRoleToUserFilter(e,t){var a="subUserDD"===t?$("#subUserDropdown")[0].component:"managerDD"===t?$("#managerDropdown")[0].component:$("#reportingToDropdown")[0].component;a.setData("cxPropSelectedUser",{});var r='[{"comparator":"equal","field":"role.id","value":'.concat('"').concat(e).concat('"').concat("}]");a.setData("cxPropCriteria",r);var i='{"role_id":'.concat('"').concat(e).concat('"').concat("}");a.setData("cxPropQueryParam",i)}function userSelect(){if($("#roleChangePopUp").length>0){var e=$("#roleDD"),t=$("#userDD");thirdPartyUtils.bindSelect2(e,t),e.change((function(){var e=$("#userDD"),t=$(this).val(),a=0;e.children().each((function(){$(this).attr("data-group")!=t?($(this).attr("disabled","disabled").prop("selected",""),$(this).addClass("dN")):(0==a&&$(this).prop("selected","selected"),$(this).removeAttr("disabled"),$(this).removeClass("dN"),a+=1)})),thirdPartyUtils.bindSelect2(e)}))}else if($("#branchChangePopup").length>0){var a=$("#userRoleDD");thirdPartyUtils.bindSelect2(a,$("#userReportingDD")),a.change((function(){for(var e=$(this).val(),t=$("#userReportingDD"),a=t.children(),r=a.length,i=!0,o=0;o<r;o++){var s=$(a[o]);s.attr("data-group")!=e?(s.attr("disabled","disabled").prop("selected",!1),s.addClass("dN")):(i&&s.prop("selected",!0),s.removeAttr("disabled"),s.removeClass("dN"),i=!1)}thirdPartyUtils.bindSelect2(t)}));var r=$("#subRoleDD");thirdPartyUtils.bindSelect2(r,$("#subUserDD")),r.change((function(){for(var e=$(this).val(),t=$("#subUserDD"),a=t.children(),r=a.length,i=!0,o=0;o<r;o++){var s=$(a[o]);s.attr("data-group")!=e?(s.attr("disabled","disabled").prop("selected",!1),s.addClass("dN")):(i&&s.prop("selected",!0),s.removeAttr("disabled"),s.removeClass("dN"),i=!1)}thirdPartyUtils.bindSelect2(t)}))}}function checkHierarchyForRoleChange(e){var t=$("#oldRoleId");if(t.val()&&$("#roleId").val()!=t.val()){var a=Crm.getCrmBasePath()+"/Role.do",r={};r.oldRole=t.val(),r.action="checkHierarchy",r.type="userRoleChange",r.viewedUserId=e,networkUtils.setCsrfParam(r),(new crmRequestPool).initiate({action:a,type:"POST",data:r,success:function(e){"none"!=e.misMatchType&&networkUtils.loadFeatureScripts(["zohocrm_forecastTemplate.js"],(function(){Handlebars.registerPartial("role_change",Handlebars.templates.role_branch_change);var t=e.misMatchType;if($("#transfer").html(Handlebars.templates.role_branch_change(e)),"manager"==e.misMatchType||"subordinates"==e.misMatchType){var a=$("#roleDD"),r=[];a.children().each((function(){var e=$(this).val();r.contains(e)?$(this).remove():r.push(e)}))}else if("submanagerchange"==e.misMatchType){var i=$("#userRoleDD"),o=[];i.children().each((function(){var e=$(this).val();o.contains(e)?$(this).remove():o.push(e)}));var s=$("#subRoleDD"),n=[];s.children().each((function(){var e=$(this).val();n.contains(e)?$(this).remove():n.push(e)}))}"manager"==t||"subordinates"==t?showAnimatePopup("roleChangePopUp"):"submanagerchange"==t&&showAnimatePopup("branchChangePopup"),userSelect(),$("#roleDD").trigger("change")}))}})}}function branchChange(e,t,a,r){if(e.val())if(t.val()!=e.val()){var i=Crm.getCrmBasePath()+"/Role.do",o={};o.roleId=t.val(),o.oldRole=a.val(),o.action="checkHierarchy",o.type="roleChange",networkUtils.setCsrfParam(o),(new crmRequestPool).initiate({action:i,type:"POST",data:o,success:function(e){"none"!=e.misMatchType?networkUtils.loadFeatureScripts(["zohocrm_forecastTemplate.js"],(function(){Handlebars.registerPartial("role_change",Handlebars.templates.role_branch_change),$("#roleChangePopUp").length>0&&$("#roleChangePopUp").remove(),$("#show").append(Handlebars.templates.role_branch_change(e));var t=$("#roleDD"),a=[];t.children().each((function(){var e=$(this).val();a.contains(e)?$(this).remove():a.push(e)})),showAnimatePopup("roleChangePopUp"),userSelect(),$("#roleDD").trigger("change"),$("#subOrdinateList").hide()})):Territory.doUpdateForm("result",r,!0,!0)}})}else Territory.doUpdateForm("result",r,!0,!0)}function getDetailsForDelete(e){var t={},a=Crm.getCrmBasePath()+"/Security.do";t.actionName="getDeleteDetails",t.userId=e,networkUtils.setCsrfParam(t),commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({action:a,type:"POST",data:t,success:function(e){networkUtils.loadFeatureScripts(["zohocrm_forecastTemplate.js"],(function(){Handlebars.registerPartial("modifyHierarchy",Handlebars.templates.modifyHierarchy),$("#hierarchypopups").html(Handlebars.templates.modifyHierarchy(e)),commonUtils.showHideLoadingDiv();var t=$("#subs").text();$("#subs").text(t.substring(0,t.length-1)),$("#deleteUserAlertDiv").hide(),showAnimatePopup("transferAlertDiv")}))}})}function loadForecastSettings(e){var t={},a=Crm.getCrmBasePath()+"/ReportingForecast.do";t.actionName="forecastSettings",t.module="Forecasts",networkUtils.setCsrfParam(t),e&&(t.isEdit=!0),commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({action:a,type:"POST",data:t,success:function(e){$("#show").html(e),commonUtils.showHideLoadingDiv()}})}function loadForecastViewOrCreate(e){var t=$("#show");if(Handlebars.registerPartial("forecastUserList",Handlebars.templates.forecastUserList),Handlebars.registerPartial("forecastTitles",Handlebars.templates.forecastTitles),"forecastCreate"==e.type){Handlebars.registerPartial("create_forecast",Handlebars.templates.forecastCreate),1==e.duplicate&&t.html(Handlebars.templates.forecastCreate),t.html(Handlebars.templates.forecastCreate(e));var a='<img src="'+networkUtils.getImageUrl("spacer_e17b417_.gif",ResourceConstants.CRM)+'" class="mL10 backtoIcon" border="0" data-cid="back">';$("#back").html(a);var r=e.prevTargetDetails;r&&r.forEach((function(e){var t=e.isSuper,a="subs_"+e.id;t&&(a="userQuota"),$("#"+a).attr("data-info",JSON.stringify(e)),$("#fcName").text(e.fctName)})),$("#createForecast").show(),commonUtils.showHideLoadingDiv()}else"forecastView"==e.type&&(Handlebars.registerPartial("view_forecast",Handlebars.templates.ViewForecastDetails),t.html(Handlebars.templates.ViewForecastDetails(e)),$("#viewForecast").show(),commonUtils.showHideLoadingDiv());thirdPartyUtils.bindSelect2($("#forecastYear,#forecastMonth"))}function showPrevTargetDetails(e,t){stopEvent(t);var a=JSON.parse($("#"+e).attr("data-info")),r=$("#current_achieved").text().split(" ")[0];$("#current_achieved").text(r+" "+a.currentAchieved),$("#current_pipe").text(r+" "+a.currentPipeline),$("#previous_target").text(r+" "+a.target),$("#previous_achieved").text(r+" "+a.achieved),$("#previous_pipe").text(r+" "+a.pipeline);var i=$("#"+e).position(),o=i.left,s=i.top,n=getElemById("suggestDetails");n.style.display="",n.style.left=o+190+"px",n.style.top=s-26+"px"}function saveForecastSettings(){var e={},t=Crm.getCrmBasePath()+"/ReportingForecast.do";networkUtils.setCsrfParam(e),e.forecastField=$("#forecastField").val(),e.targetPeriod=$("#targetPeriod").val(),e.fiscalStart=$("#fiscalStart").val(),e.fYDisplay=$("input[name=fYDisplay]:checked","#fiscalYear").val(),e.actionName="saveSettings",commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({action:t,type:"POST",data:e,success:function(e){Territory.cancelTerritoryPopup("forecastsettingpopup"),networkUtils.loadFeatureScripts(["zohocrm_forecastTemplate.js"],(function(){loadForecastViewOrCreate(e)}))}})}function saveForecastOnCreate(){var e={},t=$("#forecastYear").val(),a=$("#forecastMonth").val(),r=Crm.getCrmBasePath()+"/ReportingForecast.do";e.fcQuarter=a,e.fcYear=t;var i="",o="";networkUtils.setCsrfParam(e),e.totalTarget=$("#userQuota").val(),e.actionName="saveOnCreate",$("#allTargets").find("[id*=subs]:visible").each((function(){i+=$(this).attr("id").split("_")[1]+";",o+=$(this).val()+";"})),e.userList=i,e.userTargets=o,commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({action:r,type:"POST",data:e,success:function(e){loadForecastViewOrCreate(e)}})}function viewUsersInForecast(e){var t=$("#forecastYear").val(),a=$("#forecastMonth").val(),r={};networkUtils.setCsrfParam(r),r.fcQuarter=a,r.fcYear=t,r.actionName="viewForecast";var i=Crm.getCrmBasePath()+"/ReportingForecast.do";r.id=""==e||null==e?Crm.userDetails.USER_ID:e;var o=$("#prevId");o.length>0&&(r.prevId=o.val()),commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({action:i,type:"GET",data:r,success:function(e){loadForecastViewOrCreate(e)},error:function(){Utils.windowLocationReload(!0)}})}function computeValuesForForecast(e){var t=$("#forecastYear").val(),a=$("#forecastMonth").val(),r={};networkUtils.setCsrfParam(r),r.fcQuarter=a,r.fcYear=t,e&&(r.computeForAll=!0),r.actionName="compute";var i=Crm.getCrmBasePath()+"/ReportingForecast.do";commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({action:i,type:"POST",data:r,success:function(e){loadForecastViewOrCreate(e)}})}function updateTargetForForecast(){var e=$("#forecastYear").val(),t=$("#forecastMonth").val(),a={};networkUtils.setCsrfParam(a),a.fcQuarter=t,a.fcYear=e,a.actionName="updateTarget";var r=Crm.getCrmBasePath()+"/ReportingForecast.do";a.id=$("#self").attr("value"),a.amount=$("#target").val(),commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({action:r,type:"POST",data:a,success:function(e){hideAnimatePopup("EditCEOForecast"),loadForecastViewOrCreate(e)}})}function viewPipeline(e,t,a){var r="",i="";$("#forecastYear").length>0?(r=$("#forecastYear").val(),i=$("#forecastMonth").val()):$("#fcYear").length>0&&(r=$("#fcYear").val(),i=$("#fcQuarter").val());var o={};o.ownerId=a,e&&(o.closed=!0),o.parModule="Forecasts",networkUtils.setCsrfParam(o),o.fcQuarter=i,o.fcYear=r,o.actiontype="viewPipeline";var s=Crm.getCrmBasePath()+"/ViewPipeline.do";commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({action:s,type:"POST",data:o,success:function(e){$("#show").html(e);var a=$("#backButton");a.attr("onclick",'viewUsersInForecast("'+t+'");'),a.data("backId",t),a.removeAttr("data-cid"),commonUtils.showHideLoadingDiv()}})}function deleteForecast(){var e=$("#forecastYear").val(),t=$("#forecastMonth").val(),a={};networkUtils.setCsrfParam(a),a.fcQuarter=t,a.fcYear=e,a.actionName="deleteForecast";var r=Crm.getCrmBasePath()+"/ReportingForecast.do";commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({action:r,type:"POST",data:a,success:function(e){removeFreezeLayer(),loadForecastViewOrCreate(e)}})}function updateDetailsForForecast(){var e=$("#forecastYear").val(),t=$("#forecastMonth").val(),a={};networkUtils.setCsrfParam(a),a.fcQuarter=t,a.fcYear=e,a.actionName="updateValues";var r=Crm.getCrmBasePath()+"/ReportingForecast.do",i="",o="";$("#EditTableForecast").find("[id*=val]:visible").each((function(){i+=$(this).attr("id").split("_")[1]+";",o+=$(this).val()+";"})),a.userList=i,a.userTargets=o,a.id=$("#self").attr("value"),commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({action:r,type:"POST",data:a,success:function(e){hideAnimatePopup("splitPop"),loadForecastViewOrCreate(e)}})}function editValues(e){var t=$("#EditTableForecast");t.html(""),$("#"+e).find("tr").each((function(){var e=$(this).attr("id"),a=$(this).find("td[data-attr=firstName]").find('a[data-zcqa="fc_'+e+'"]').text(),r=document.getElementById("liteuser_"+e).value,i=$(this).find("td[data-attr=role]").text(),o=$("#split_"+e).data("target"),s="<tr><td>"+a;"true"===r&&(o="",s+='<span class="normaltag dIB f12 mL3">Lite User</span>'),s=s+"</td><td>"+i+'</td><td valign="top"><input id="val_'+e+'" class="inputTxtBox floatL" type="text" value="'+o+'" maxlength="15" ',"true"===r&&(s+="readonly"),s+="></td></tr>",t.append(s)})),showAnimatePopup("splitPop")}function checkForecastForCreate(e){var t=$("#forecastYear").val(),a=$("#forecastMonth").val();if(isNaN(t)||isNaN(a))return!1;var r={};networkUtils.setCsrfParam(r),e?r.isEdit=!0:(r.fcQuarter=a,r.fcYear=t),r.actionName="createForecast";var i=Crm.getCrmBasePath()+"/ReportingForecast.do";commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({action:i,type:"GET",data:r,success:function(e){loadForecastViewOrCreate(e)}})}function showHideRoleList(e){e?(crmui.hideTooltip(),$("#confirmReporting").css("z-index","20"),mailsetCenter("roleNameList")):($("#roleNameList").hide(),$("#confirmReporting").css("z-index",""))}function hierarchySelect(e){var t=$("#user").val(),a=$("#strictly").val();e?($("#compliance").slideUp(),"true"==t?$("#EnaRepActions").removeClass("eventNone disable"):$("#EnaRepActions").addClass("eventNone disable")):($("#compliance").slideDown(),"false"==t?$("#EnaRepActions").removeClass("eventNone disable"):("false"==a?$("#nonStrict").click():$("#strict").click(),$("#EnaRepActions").addClass("eventNone disable")))}function complianceSelect(e){var t=$("#strictly").val();"true"==$("#user").val()&&(e&&"false"==t||!e&&"true"==t?$("#EnaRepActions").removeClass("eventNone disable"):$("#EnaRepActions").addClass("eventNone disable"))}function cancelHierarchy(){var e=$("#user").val(),t=$("#strictly").val();"false"==e?($("#roleHier").click(),$("#nonStrict").click()):"true"==e&&($("#repoHier").click(),"false"==t?$("#nonStrict").click():$("#strict").click())}function saveHierarchy(e,t,a){var r=$("#user").val(),i=$("#hierType input:checked").attr("id"),o=!1,s=!1,n=!1;if(e&&newForecastsEnabled&&!t&&"repoHier"===i){var l=$("#compliance input:checked").attr("id");l&&r&&("nonStrict"===l||"strict"===l)&&"true"===r&&(n=!0)}if(e&&newForecastsEnabled&&!t&&!n){crmui.hidePopup("confirmReporting");var d=document.querySelector("crm-forecast-hierarchy-popup"),c={errorMsgTitle:I18n.getMsg("crm.forecast.hierarchy.preference.title.warning"),errorMsg1:I18n.getMsg("crm.forecast.hierarchy.preference.confirmation.warning"),errorMsg5:I18n.getMsg("crm.forecast.hierarchy.preference.configuration.changes.warning"),fromConfig:!1};"repoHier"===i?(c.errorMsg2=I18n.getMsg("crm.forecast.hierarchy.preference.completed.period.warning",I18n.getMsg("crm.role.text")),c.errorMsg3=I18n.getMsg("crm.forecast.hierarchy.preference.current.upcoming.period.warning",I18n.getMsg("cob.role")),c.errorMsg4=I18n.getMsg("crm.forecast.hierarchy.preference.new.flow.warning",I18n.getMsg("crm.forecast.reporting.lower.case"))):(c.errorMsg2=I18n.getMsg("crm.forecast.hierarchy.preference.completed.period.warning",I18n.getMsg("crm.forecast.reporting.lower.case")),c.errorMsg3=I18n.getMsg("crm.forecast.hierarchy.preference.current.upcoming.period.warning",I18n.getMsg("crm.forecast.reporting.camel.case")),c.errorMsg4=I18n.getMsg("crm.forecast.hierarchy.preference.new.flow.warning",I18n.getMsg("crm.role.text"))),d?d.setData(c):Lyte.Component.render("crm-forecast-hierarchy-popup",c,"#basic"),document.querySelector("#forecast-hierarchy-popup").ltProp("show",!0)}else{if("repoHier"==i)o=!0,"strict"==$("#compliance input:checked").attr("id")&&(s=!0);if("roleHier"===i&&!a)return void showAssociationList(e,t);var u={},m=Crm.getCrmBasePath()+"/Role.do";u.userReporting=o,u.strictlyReporting=s,u.action="updateHierarchy",networkUtils.setCsrfParam(u),commonUtils.showHideLoadingDiv(!0),$("#EnaRepActions").addClass("eventNone disable"),(new crmRequestPool).initiate({action:m,type:"POST",data:u,success:function(e){var t=e;commonUtils.showHideLoadingDiv(),crmui.hidePopup("confirmReporting"),networkUtils.loadFeatureScripts(["zohocrm_forecastTemplate.js"],(function(){var e=document.querySelector("#forecast-hierarchy-popup");e&&e.ltProp("show",!1);var a=I18n.getMsg("crm.user.hierarchy.role.message");"true"==t.reporting&&(a=I18n.getMsg("crm.user.hierarchy.reporting.message")),renderHierarchyPage(t),o.toString()!=r&&(crmui.showMsgBand("success",a,4e3),"true"==t.reporting?Crm.userDetails.isUserHierarchy=!0:Crm.userDetails.isUserHierarchy=!1)}))}})}}var ReportingHierarchy={reportingTo:null,res:null,updateReportingDetailsForUser:function(e){var t={},a=Crm.getCrmBasePath()+"/Security.do";networkUtils.setCsrfParam(t);var r=$("#shareSubordinates");t.subordinate_ds=0!=r.length&&r.prop("checked"),t.reportingToId=ReportingHierarchy.reportingTo,t.subordinates=subordinates,t.userId=e,t.actionName="updateReportingDetails",commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({action:a,type:"POST",data:t,success:function(e){if(e.error)if(e.error.indexOf("invalid_reporting")>=0){var t=$("#reportingDropdown");renderingUtils.displayErrorDiv("Reporting Manager",void 0,e.error.indexOf("by_role_hierarchy")>=0?I18n.getMsg("crm.user.hierarchy.reporting.lowrolerp"):I18n.getMsg("crm.user.hierarchy.reporting.noselect"),$L(t[0].children))}else if(e.error.indexOf("invalid_subordinate")>=0){var a=$("#subordinateDropdown");renderingUtils.displayErrorDiv("Reporting Manager",void 0,e.error.indexOf("by_role_hierarchy")>=0?I18n.getMsg("crm.user.hierarchy.reporting.highrolesub"):I18n.getMsg("crm.user.hierarchy.reporting.noselect"),$L(a[0].children))}else crmui.showMsgBand("error",e.error,4e3);else{$("#reportingView").text(e.reportingto),$("#subView").text(e.subordinates),$("#subShareMsg").text(e.subShareMsg),$("#updateType").val("");var r,i,o=$("#transferbtn");if(ReportingHierarchy.res=e.details,""==e.subordinates){if(o.addClass("dN").removeClass("primarybtn fL"),$("#reportingToMsg").addClass("dN"),$("#deletebtn").val(I18n.getMsg("crm.delete.button.confirm")),(r=$("crm-userdelete-confirm")).length>0)"false"===(i=r[0].component).getData("isSubordinateEmpty")&&i.setData("isSubordinateEmpty","true")}else if(o.removeClass("dN").addClass("primarybtn fL"),$("#reportingToMsg").removeClass("dN"),$("#deletebtn").val(I18n.getMsg("crm.user.hierarchy.delete.button")),(r=$("crm-userdelete-confirm")).length>0)"true"===(i=r[0].component).getData("isSubordinateEmpty")&&i.setData("isSubordinateEmpty","false");hideAnimatePopup("showHierarchyDiv")}commonUtils.showHideLoadingDiv()}})}};function renderHierarchyPage(e){Handlebars.registerPartial("hierarchyDetails",Handlebars.templates.hierarchyPreference),$("#result").html(Handlebars.templates.hierarchyPreference(e));var t,a,r,i=e.count,o=e.roleList,s="";if(i>0&&(t="<link-to lt-prop-route='crm.settings.section.roles.view-role' lt-prop-target='_blank' lt-prop-dp='[\""+o[0].id+"\"]' data-zcqa='openRole_"+o[0].roleName+"'>"+o[0].roleName+"</link-to>",i>1&&(a="<link-to lt-prop-route='crm.settings.section.roles.view-role' lt-prop-target='_blank' lt-prop-dp='[\""+o[1].id+"\"]' data-zcqa='openRole_"+o[1].roleName+"'>"+o[1].roleName+"</link-to>"),i>2&&(r="<link-to lt-prop-route='crm.settings.section.roles.view-role' lt-prop-target='_blank' lt-prop-dp='[\""+o[2].id+"\"]' data-zcqa='openRole_"+o[2].roleName+"'>"+o[2].roleName+"</link-to>")),1==i)s=t;else if(2==i){var n=[t,a];s=I18n.getMsg("crm.user.hierarchy.role.two",n)}else if(3==i){n=[t,a,r];s=I18n.getMsg("crm.user.hierarchy.role.three",n)}else if(i>3){n=[t,a,r,i-3];s=I18n.getMsg("crm.user.hierarchy.role.many",n),s+=i-3==1?" "+I18n.getMsg("Other"):" "+I18n.getMsg("Others")}if($("#shareRoleList").html(s),i>3){var l=10,d="";i<10&&(l=i);for(var c=0;c<l;c++)d+=o[c].roleName+"<br />";if(i>10)d+=I18n.getMsg("crm.event.more.event.and",[i-10]);e='{content:"'+d+'",isHTML: true,position: "left"}';$("#tooltip").attr("onmouseover","crmui.showTooltip("+e+")")}"true"==e.reporting&&$("#compliance").removeClass("dN")}function formatState(e){if(!e.element||!e.element.value||"None"==e.element.value||!e.element.getAttribute("data-src")&&!e.element.getAttribute("data-email"))return e.text;var t=Crm.userDetails.contactServerUrl;return $('<span><img src="'+t+"/file?ID="+e.element.getAttribute("data-src")+'&fs=thumb" width="25" height="25" class="img-flag dIB vam fL" /><div class="dIB w200 mL10"><span title="'+$ESAPI.encoder().encodeForHTML(e.text)+'" class="ellipsistext dB"> '+$ESAPI.encoder().encodeForHTML(e.text)+"</span><label title="+e.element.getAttribute("data-email")+' class="dB ellipsistext">'+e.element.getAttribute("data-email")+"</label></div> </span>")}function loadGroupUsers(e,t,a,r){var i=e.length;if(t<=i)for(var o=0,s=t;o<a&&s<i;s++){var n=e[s];for(var l in n)if(!r||0===$('#selectedGroupSrc option[value="U:'+l+'"]').length){var d=document.createElement("option");d.value="U:"+l,d.text=n[l],getObj("availUsersPL").appendChild(d),o++}}}function availUsersPLDivScroll(){var e=$("#availUsersPL"),t=e[0].scrollHeight;if(e.outerHeight()-2==t-e.scrollTop()){var a=$("#availUsersPL option").length;loadGroupUsers(searchedGroupUsersJsonObj.length>0?searchedGroupUsersJsonObj:groupUsersJsonObj,a,a+loadingUsersLimit,!0)}}function searchGroupUser(e){searchedGroupUsersJsonObj=[],clearTimeout(userGroupSearch),userGroupSearch=setTimeout((function(){if(""!=e)for(var t=groupUsersJsonObj.length,a=new RegExp(e,"i"),r=0;r<t;r++){var i=groupUsersJsonObj[r];for(var o in i){var s=i[o];a.test(s)&&searchedGroupUsersJsonObj.push(i)}}else searchedGroupUsersJsonObj=groupUsersJsonObj;$("#availUsersPL").empty(),loadGroupUsers(searchedGroupUsersJsonObj,0,loadingUsersLimit,!0)}),300)}function showAssociationList(e,t){store.findAll("layout",{module:"users"}).then((function(a){for(var r=a[0].id,i=null,o=a[0].fields.length,s=0;s<o;s++){var n=a[0].fields[s];"Reporting_To"===n.api_name&&(i=n.id)}var l={success_callback:function(a){if(a.error)crmui.showMsgBand("error",I18n.getMsg("game.common.error"),3e3);else if(null!==a.fields_associations[0].associated){var r=constructAssociationData(a.fields_associations[0].associated);if(Object.keys(r).length>0){var i=networkUtils.returnDependencyFiles(["crm-hierarchypreference-modal.js"],crmConstants.jsStaticPathForLyte);Lyte.injectResources(i,void 0,(function(){Lyte.Component.render("crm-hierarchypreference-modal",{show:!0,deleteContent:r},"#hierarchyPreferenceChangePop")}))}}else saveHierarchy(e,t,!0)},failure_callback:function(){crmui.showMsgBand("error",I18n.getMsg("game.common.error"),3e3)},params:"ids="+i+"&module=Users&layout_id="+r};networkUtils.makeRequest("/crm/v2.2/settings/fields/actions/associated","GET",l)}))}function constructAssociationData(e){for(var t={},a=e.length,r=0;r<a;r++){var i=e[r],o=i.type;if("workflow_custom_function"===o||"workflow_tasks"===o){var s=o.split("_");i.action=s[s.length-1],o=i.feature_type}if("workflow"===o&&("create_record"!==i.action&&"function"!==i.action||(o=o+"_"+i.action),"webhooks"!==i.action&&"tasks"!==i.action||(o=i.action)),"orchestration"===o&&("create_record"!==i.action&&"webhooks"!==i.action&&"tasks"!==i.action&&"function"!==i.action||(o=o+"_"+i.action)),o in t)var n=t[o].items;else{n=[];t[o]={}}n.push(i),t[o].items=n}return a>0&&appendAssociationLinks(t),t}function appendAssociationLinks(e){for(var t={workflow_create_record:{topic:I18n.getMsg("crm.workflow.title")+" - "+I18n.getMsg("crm.workflow.actions.listing.CreateRecord"),route:"crm.settings.section.workflow-rules.view-workflow-rule",dynamicParam:[]},orchestration_create_record:{topic:I18n.getMsg("crm.setup.system.orchestration")+" - "+I18n.getMsg("crm.workflow.actions.listing.CreateRecord"),route:"crm.settings.section.orchestration.edit-orchestration",dynamicParam:[]},email_template:{topic:I18n.getMsg("crm.fielddelete.emailtemplate"),route:"crm.settings.section.crm-templates",dynamicParam:[],queryParam:{type:"email",step:"edit"}},dashboard_components:{topic:I18n.getMsg("crm.label.analytical.dashboard.components"),route:"crm.tab.dashboards.view",dynamicParam:[]},custom_button:{topic:I18n.getMsg("crm.custom.buttons.links"),route:"crm.settings.section.modules.module.links-and-buttons.index-links-and-buttons",dynamicParam:[]},Reports:{topic:I18n.getMsg("crm.report.reports"),route:"crm.tab.module.entity.detail",dynamicParam:["Reports"]},inventory:{topic:I18n.getMsg("crm.fielddelete.inventorytemplate"),route:"crm.settings.section.crm-templates",dynamicParam:[],queryParam:{type:"inventory",step:"edit"}},orchestration_add_log:{topic:I18n.getMsg("crm.setup.system.orchestration")+" - "+I18n.getMsg("crm.orchestration.state.action.instant.label.addlog"),route:"crm.settings.section.orchestration.edit-orchestration",dynamicParam:[]},workflow_function:{topic:I18n.getMsg("crm.auditlog.workflowdeluge"),route:"crm.settings.section.workflow-deluge",queryParam:{}},tasks:{topic:I18n.getMsg("crm.tasks.title"),route:"crm.settings.section.workflow-tasks.view-workflow-task",dyanamicParam:[]},webhooks:{topic:I18n.getMsg("workflow.label.webhooks"),route:"crm.settings.section.workflow-webhooks.view-workflow-webhook",dyanamicParam:[]},orchestration_function:{topic:I18n.getMsg("crm.setup.system.orchestration")+" - "+I18n.getMsg("crm.workflow.actions.listing.Deluge"),route:"crm.settings.section.workflow-deluge",queryParam:{}},orchestration_tasks:{topic:I18n.getMsg("crm.setup.system.orchestration")+" - "+I18n.getMsg("crm.workflow.actions.listing.Task"),route:"crm.settings.section.workflow-tasks.view-workflow-task",dyanamicParam:[]},orchestration_webhooks:{topic:I18n.getMsg("crm.setup.system.orchestration")+" - "+I18n.getMsg("workflow.label.webhooks"),route:"crm.settings.section.workflow-webhooks.view-workflow-webhook",dyanamicParam:[]}},a=Object.keys(e),r=a.length,i=0;i<r;i++){var o=a[i],s=e[o],n=e[o].items,l=n.length;switch(o){case"dashboard_components":for(var d=0;d<l;d++){(c=n[d]).dynamicParam=[],c.dynamicParam.push(c.id)}break;case"Reports":for(d=0;d<l;d++){(c=n[d]).dynamicParam=["Reports"],c.dynamicParam.push(c.id)}break;case"inventory":case"email_template":for(d=0;d<l;d++){(c=n[d]).queryParam={},c.queryParam=t[o].queryParam,c.queryParam.templateId=c.id}break;case"orchestration":case"logs":case"orchestration_create_record":for(d=0;d<l;d++){(c=n[d]).dynamicParam=[],c.dynamicParam.push(c.rule_id)}o="logs"===o?"orchestration_add_log":o;break;case"workflow_create_record":for(d=0;d<l;d++){(c=n[d]).dynamicParam=[],c.dynamicParam.push(c.rule_id)}break;case"webhooks":case"orchestration_webhooks":for(d=0;d<l;d++){(c=n[d]).dynamicParam=[],c.dynamicParam.push(c.id)}break;case"workflow_function":case"orchestration_function":for(d=0;d<l;d++){(c=n[d]).queryParam={},c.queryParam.delugeId=c.id}break;case"custom_button":for(d=0;d<l;d++){(c=n[d]).dynamicParam=[],c.dynamicParam.push(c.module)}break;case"tasks":case"orchestration_tasks":for(d=0;d<l;d++){var c;(c=n[d]).dynamicParam=[],c.dynamicParam.push(c.id)}}void 0!==t[o]?(s.topic=t[o].topic,s.route=t[o].route):delete e[o]}}function showCruxLookUp(e,t,a){var r=null,i=t.split("Manager");if("changeOwner"===e){var o=$("#cruxUserLookupComponentOutlet").find("crm-userlookup-wrapper-component")[0];o||(o=Lyte.Component.render("crm-userlookup-wrapper-component",{},"#cruxUserLookupComponentOutlet")),(r=o.component).setData("isTerritoryManagement",!0),r.setData("queryParams",{type:"ActiveUsers"})}else if("changeFCManager"===e){var s=$("#cruxRoleUserLookupComponentOutlet").find("crm-userlookup-wrapper-component")[0];s||(s=Lyte.Component.render("crm-userlookup-wrapper-component",{},"#cruxRoleUserLookupComponentOutlet")),(r=s.component).setData("isTerritoryManagement",!1),r.setData("queryParams",{type:"ActiveUsers",filters:'[{"comparator":"equal","field":"role.id","value":"'+i[1]+'"}]'})}var n=$("#"+t).data("ownerid"),l={cruxLookupId:"cruxLookup"+t,fldLabel:t,entityId:i[1],entityName:a};r.setData(l),n?r.setData("ownerId",n):r.setData("ownerId",""),r.setData("showPopup",!0)}Handlebars.registerHelper("isHelpNotPresent",(function(e,t){return Handlebars.helpers.canShowHelpVideo(t).length===t.fn(this).length&&-1===Crm.userDetails.LOCALE.indexOf("ja_JP")&&Handlebars.helpers.getHelpUrl(e)===crmConstants.helpUrl["help.domain.url"]+crmConstants.helpUrl[e]?t.fn(this):t.inverse(this)}));var crmLayout={};crmLayout.Resize=function(){function e(){$("#homePageView").length&&$("#homePageView").css("height",$(window).height()-($("#homePageView").position().top+26)),$("#cobouterdiv").length&&$("#cobouterdiv").css({height:$(window).outerHeight()-($("#tabLayer").offset().top+$("#tabLayer").outerHeight()+28),top:$("#tabLayer").offset().top+$("#tabLayer").outerHeight()}),$("#hd_inner_container").length&&$("#hd_inner_container").css({height:$("#helpdesk").outerHeight()-$("#tabLayer").offset().top-30}),$("#feedLeftMenuContainer").is(":visible")&&setfFeedsGroupContainerHeight(),CrmDashboard.populateVisibleComponents("homePageView")}function t(){if(1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI)crmLayout.Resize.DetailpageResizeRevamp();else{if(!$("#newLeftPanel").length||!$("#newInfoDiv").length)return;var e=renderingUtils.getHeightFromTabLayer();if("undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()){$("#leftPanel").css("min-height","initial");var t=$("#annoncement");e=t.length?e-t.outerHeight():e}if($("#newLeftPanel").length&&(thirdPartyUtils.unbindPerfectScroll("#newLeftPanel"),$("#newLeftPanel").removeClass("oH"),$("#newLeftPanel").css("height",e).addClass("oH pR"),thirdPartyUtils.bindPerfectScroll("#newLeftPanel",{wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!1})),$("#newInfoDiv").length){var a=$("#dvinner"),r=$("#newLeftPanel").outerWidth(),i=$(window).width(),o=i-r,s=($("#dvinner").offset().left,e),n=$("#newInfoDiv");n.css("overflow","hidden");var l=i-r;i<1040&&(l=1e3,n.css("overflow","auto")),n.css({height:s,width:o}),$("#detailViewButtonLayerDiv").css("width",l-50+"px"),e-=$("#detailViewButtonLayerDiv").outerHeight()+17,"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()&&(e-=37),a.css({width:l,height:e,overflow:"auto","box-sizing":"border-box"})}}var d=document.querySelector("crm-entityscores-view");d&&(d.component.getData("showTable")||crmRelatedList.showSrChart())}function a(){if(1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI){var e=$("#newLeftPanel");if(!e.length||!e.length)return;var t=$("#newHistoryDiv"),a=$("#newDataPrivacyDiv"),r=$("#newInfoDiv"),i=renderingUtils.getHeightFromTabLayer();detailView.tabsLayerHeight=i,e.length&&detailView.setDetailViewNewLeftPanelProp(),r.length&&detailView.setDetailViewNewInfoDivProp(),"block"==t.css("display")&&detailView.datatimeLineHeight(),"block"==a.css("display")&&detailView.dataPrivacyHeight(),crmLayout.Resize.setWidthHeightStage($("#stageContain"))}}function r(){if($("#reportIntegdiv").length){var e=$(window).height()-$("#dashboardList").offset().top;isChatEnabled&&(e-=26),$("#reportIntegdiv").length&&(e-=$("#reportIntegdiv").outerHeight()),$("#dashboardList").css("height",e),thirdPartyUtils.bindPerfectScroll("#dashboardList",{wheelSpeed:1,wheelPropagation:!0,suppressScrollX:!1})}$("#dashboardItems").length&&$("#dashboardItems").css("height",$(window).height()-($("#dashboardItems").offset().top+26))}function i(){$("#reportLookupDiv").length&&crmReports.setHeightWidth()}function o(){var e,t,a,r,i,o,s,n,l,d=$("#ImportedRecordsSummary"),c=$("crm-client-portal-tabs-configuration").is(":visible"),u=$("crm-client-portal-field-permissions").is(":visible"),m=$L("crm-client-portal-user-type-summary-header").is(":visible"),p=$L("#cpT_navCtn").is(":visible"),h=$(".cpT_listRow").length,f=$("crm-client-portal-user-type-users").is(":visible");if(d.length>0){var v="undefined"!=typeof importHistory&&null!=importHistory.recordType?importHistory.recordType:"undefined"!=typeof translationHistory&&null!=translationHistory.record_type?translationHistory.record_type:null;if(null!=v){var g=$("#importedlistview div.scrollElementDiv"),C=$("#"+v+"Table"),b=C.find(".itb-body-class"),y=d.outerHeight(),w=C.offset().top,I=g.outerHeight(),R=y-w;g.height(R-35),b.height(I-45)}}if($("#setupLinkDiv").length){var T=$("#setupLinkDiv").offset().top,_=$(window).height(),E=_-(T+=28)-15,S=_-($("#setup_new_leftmenuDiv").offset().top+28+16);if($("#setup_new_leftmenuDiv").css({height:S+"px"}),thirdPartyUtils.unbindPerfectScroll("#setupLinkDiv"),$(".crmsetup-sideMenu").css({"max-height":E+"px"}),1!==$("#builder_container").length){var L=_-($("#setup_new_ContentDiv").offset().top+28+16);$("#setup_new_ContentDiv").css({height:L+"px"});var D=$("#preferences"),k=$("#preferencesSaveCancel");D.is(":visible")&&D.css("height",L-k.outerHeight()-30).addClass("oA"),$("#availableCal").length>0&&$("#API_container").height(L-10)}setZiaVisionPageHeight()}if("undefined"!=typeof crmProfilePage&&(crmProfilePage.setInnerLeftPaneHeight(),$("#pfList_maincontent").length>0)){var P=$(window).width()-260;$("#pf_list_container").width(P)}if(c&&(e=$("#cpTabConfigScroll"),t=document.querySelector("crm-client-portal-tabs-configuration"),a=$(".cpBottomFreezeButton").outerHeight(),r=renderingUtils.windowHeight-(e.offset().top+a+28),i=renderingUtils.windowHeight-(a+28),o=e.offset().top,t.setData("dropdownBoundaryBottom",i),t.setData("dropdownBoundaryTop",o),e.css("height",r)),u&&(s=$("#customFieldProperties"),n=s.offset().top,l=renderingUtils.windowHeight-(n+$(".cpBottomFreezeButton").outerHeight()+28),s.css("height",l)),m&&p&&function(){var e=$L(".cpT_portalNameCtn").width()-($L(".cpT_modName").outerWidth()+$(".cpT_saveCancel").outerWidth()+80),t=$L("#cpT_navCtn"),a=renderingUtils.windowHeight-(t.offset().top+29+17);$L(".cpT_portalName").css("max-width",e),t.css("height",a+"px")}(),f&&h>0&&function(){var e=$L("#portalUsersTable"),t=$(".cpT_listRow"),a=$L("#portalUsersTable .lyteTableScroll"),r=a[0].scrollHeight,i=renderingUtils.windowHeight-(a.offset().top+29+17);e.css("height","auto"),a.scrollTop(0),r>i&&t.length>0&&e.css("height",i+"px")}(),1==$("#builder_container").length){var A=renderingUtils.windowWidth;$("#tabLayer").hasClass("newTopbar")?CML.layoutWidth=A-299:CML.layoutWidth=-320,CML.layoutResize()}if($("#layout_landing_left").is(":visible")&&CML.layoutLandingResize(),"undefined"!=typeof CMB&&$("#setupshow").is(":visible")&&CMB.organizeModuleFieldsListScroll(),$(".validation-rule-container-inner").length>0){var O=renderingUtils.windowHeight,M=$(".validation-rule-container-inner"),F=O-M.offset().top-30;M.css("height",F)}var x=$("#zbIntegrationSetupPage");x.length&&x.css("width",renderingUtils.windowWidth-320);var N=document.queryAll("crm-setup");N.length&&N[0].component.showSetupScrollBtn()}function s(){var e=$(".convFlowShapesActive").attr("data-attr");networkUtils.loadFeatureScripts(["zohocrm_attributions.js"],(function(){Attribution.setHeightForAttribution(),Attribution.widthUpdate(),Attribution.updateShapesAfterAddStage(e),"U_SHAPE"===e||"W_SHAPE"===e?(Attribution.svgWidthHeightUpdate(),Attribution.generateAndInitializeShape(e),Attribution.drawTopLine(),$(".convFlowAddActive").is(":visible")&&Attribution.addStagePositioning(".convFlowAddActive"),$(".convFlowEditModActive").is(":visible")&&Attribution.addStagePositioning(".convFlowEditModActive",!1)):"LINEAR"!==e&&"TIME_DECAY"!==e||(Attribution.linearDecaySvgWidth(),Attribution.generateLineShape(),Attribution.drawTopLineLinearDecay())}))}function n(){var e=$("#setup_new_ContentDiv").outerHeight(),t=$("#zso_setup"),a=$("#zso_importContainer"),r=$("#kso_adminSettings");t.length&&t.css("height",e),a.length&&a.css("height",e),r.length&&r.css("height",e),$("#socAddToCrmPop").children().length&&zsoEntity.setTopValueForAddToCrmPopup(),$("#socViewConvPopup .socViewConvoParent").length&&zsoTab.setHeightForConvoPopup("Convo"),$("#socViewConvPopup .socViewMsgParent").length&&zsoTab.setHeightForConvoPopup("Msg"),$("#socMonitorContentInner").length&&zsoTab.setMonitorContentWidth()}function l(){if($(".zcrm-show, .showPpTop").is(":visible")){var e,t,a=renderingUtils.windowHeight,r=$("#rItemDataDiv"),i=r.css("display"),o=$("#feedsPreferenceDiv").css("display"),s=$("#addAggFldPopup").css("display"),n=$(".entityNameLookupNew").length>0;if("block"===o&&(e=$("#feedsPreferenceDiv .feed_pref_info").outerHeight(),t=$("#feedsPreferenceDiv .notes_section").outerHeight()),"block"===s)var l=$("#addAggFldPopup .pp-header").outerHeight(),d=$("#addAggFldPopup .pp-footer").outerHeight();$("#popup-height-style,#popup-height-styles").remove();var c=a-175,u=a-230;if("block"===i){var m=a-100;r.css("max-height",m),$("#rItemDataSubDiv").css("max-height",m-95)}m=a-100;if($("#remainder-notifi").css("max-height",m),$("#remainderpopup").css("max-height",m-95),n)(c-=$("#entityLookupdiv .cvpadding").outerHeight())<120&&(c=120);if($('<style type="text/css" id="popup-height-style">.popup-model-content{ max-height:'+c+"px !important;}</style>").appendTo(document.head),"block"!==o)if("block"!==s){var p=$("#fieldtyperesult"),h=$(".zb-email-popup"),f=p.find(".picklistFieldFPPopup");if(f.length>0){var v=p.find(".pp-header").outerHeight(),g="0"!==$("#picklistMaindiv").css("opacity")?p.find(".pickListToHideBtn").outerHeight():p.find(".popup-model-footer:visible").outerHeight(),C=a-v-10;f.css({height:C+"px"});var b=f.outerHeight()-v-g;$('<style type="text/css" id="popup-height-styles">.pp-content.importDiv{ max-height:'+b+"px !important;min-height:"+b+"px !important;}</style>").appendTo(document.head)}else h.length>0?h.css({"max-height":renderingUtils.windowHeight-60,padding:"0",overflow:"hidden"}):$('<style type="text/css" id="popup-height-styles">.pp-content{ max-height:'+u+"px !important;}</style>").appendTo(document.head);var y=p.find("#masterPickList");if(y.length>0){var w=y.find(".importDiv"),I=w.next().outerHeight(),R=w.outerHeight();y.parent().height(R+I)}}else $("#addAggFldFPPopup").css({"max-height":a-(l+d+215)});else $("#feedsPreferenceDiv .feeds_content .table_wrapper").css({"max-height":a-(e+t+300)})}}function d(){var e=$("#stageContain:not(.crmStageNoResize)");if(e.length&&null!=e){var t=$("#stageContain").find(".lineStage .order-step"),a=e.find(".lineStage");setWidthHeightStageObject(e,t,a)}}function c(){$("li.subformList").each((function(){$(this).find(".subFormContainerInner").css("max-width",Math.round($(this).width()-($("#addSubFormFields").outerWidth()+20))),$(this).find(".subFormShadowAddedRght").css("left",Math.round($(this).find(".subFormContainerInner").outerWidth()-15)),$(this).addClass("subFrmAct"),CrmSubform.subFormFldShadow(),$(".subFrmAct").find(".subFormContainerInner").animate({scrollLeft:0},0),$(this).removeClass("subFrmAct")}))}function u(){$(".abFormCreate").length>0&&Lyte.registeredMixins.webform.leftPanelHghtCal()}function m(){var e=$("#abTestingViewHead");if(e.is(":visible")){var t=renderingUtils.windowWidth-$(".setupleftmenutd").width(),a=renderingUtils.getHeightFromTabLayer()-e.outerHeight()-2;$(".variantPrevListWrap").css("max-width",t),$("#abtesting_Preview, #abtesting_Analytics").css("height",a),$("#ABTestPreviewPart").css("height",renderingUtils.getHeightFromTabLayer()-2)}}function p(){var e=$("#webformPrevHead");if(e.is(":visible")){var t=renderingUtils.getHeightFromTabLayer()-e.outerHeight();$("#webF_Preview").css("height",t),$("#WebFormPreviewPart").css("height",renderingUtils.getHeightFromTabLayer()-36)}}function h(){var e=$("#tabLayer"),t=e.offset().top+e.outerHeight(),a=renderingUtils.windowHeight-(t+58),r=$("#pipelineHeaderDiv").outerHeight(),i=a-(r+$(".pipelineHeader").outerHeight()+$(".stageAddBtn").outerHeight()+55);$(".pipelineStagesList").css("max-height",i),$(".pipelineWraperInner").css("min-height",a-(r+15))}function f(){crmNTCGlobal.setNTCContainerHt(),crmNTCDetailView.SetSignalDetailHeight(),crmNTCGlobal.setNotificationHeight(),crmNTCDetailView.SetBcDivDetailHeight(),$("#signalPopupViewContent").is(":visible")&&$("#signalPopupViewContent").find("#feed_detail_outer_div").length&&crmNTCDetailView.socialDetailViewPopupHt(),$("#setupshow").is(":visible")&&$("#ntcSettingInnerScrollDiv").is(":visible")&&crmNTCSettings.resizeSignalSettings()}function v(){if($("#gamification").is(":visible")){var e=$(window).outerHeight()-($("#game").outerHeight()+$("#wmstoolbar").outerHeight()+40);$(".gameMiddleSection").height(e)}}function g(){var e=$("#importContainer");if(e.length&&$("#ITF-container").is(":visible")){var t=$(".ITF-container"),a=$(window).height()-t.offset().top-$(".footerTableCon").height();t.height(a),Import.FixedHeaderFunct("ITF-container"),$(".ITF-container .itb-body-class").height(a-$(".ITF-container .itb-header-class").outerHeight()),Import.importFieldContainer()}if(e.length&&$("#createNewFieldlist").is(":visible")){var r=$(window),i=$("#createNewFieldlist"),o=r.height(),s=350;o>470&&(s=o-120),i.css({height:s},"z-index","100");var n=r.height()/2,l=i.innerHeight()/2;i.css({top:n-l});var d=i.height()-(i.find(".popup-model-header").outerHeight()+i.find(".popup-model-footer").outerHeight()),c=$("#createFieldTableDiv");c.css("max-height",d),Import.FixedHeaderFunct("createFieldTableDiv"),c.css("height",d);var u=$("#createFieldTableDiv .itb-body-class");u.css("height",d),u.height(c.height()-$("#createFieldTableDiv .itb-header-class table").outerHeight())}}function C(){$("#cobouterdiv").css({height:$(window).outerHeight()-($("#tabLayer").offset().top+$("#tabLayer").outerHeight()+28),top:$("#tabLayer").offset().top+$("#tabLayer").outerHeight()}),$("#hd_inner_container").css({height:$("#helpdesk").outerHeight()-$("#cobouterdiv .mig_chatbar").outerHeight()-$("#tabLayer").offset().top-30})}function b(){if($("#customHome").is(":visible")){var e=$("#edit_section");if(1===e.length)return void e.css("height",$(window).height()-(e.offset().top+26));$("#customHome").css("height",$(window).height()-($("#customHome").offset().top+26)),CustomHomePage.setComponentSelectionDivHeight(!1),CrmDashboard.populateVisibleComponents("customHome")}}function y(){$("#analyticalPageContainer, #createDashboardPanel").length&&"block"===$("#analyticalPageContainer, #createDashboardPanel").css("display")&&CrmAnalytics.layoutResize()}function w(){if($("crm-home-blankpage:visible").length>0){if(Lyte.registeredMixins.onboarding.setOnboardingHomeHeight(),$("crm-onboarding-migration:visible").length>0)Lyte.registeredMixins.onboarding.setOnboardingMigrationHeight();else if($("onboarding-tour:visible").length>0){Lyte.registeredMixins.onboarding.setOnboardingTourHeight();var e=$(".showtourimage"),t=e.outerHeight();e.offset();$L("#img_container").css("height",t)}}else($("crm-leads-blankpage:visible").length>0||$("crm-contacts-blankpage:visible").length>0||$("crm-accounts-blankpage:visible").length>0||$("crm-deals-blankpage:visible").length>0||$("crm-activities-blankpage:visible").length>0||$("crm-activitysub-blankpage:visible").length>0)&&(Lyte.registeredMixins.onboarding.setHeight(),Lyte.registeredMixins.onboarding.setSameWidthtoBUttons(),Lyte.registeredMixins.onboarding.setSplitOrposition())}function I(){$L("crm-recommendation-gallery-comp .templateContainer").is(":visible")&&Lyte.registeredMixins["recommendation-util"].resizeGallaryPage(document.querySelector("crm-recommendation-gallery-comp"))}function R(){$L("crm-orchestration-builder").is(":visible")?(Lyte.registeredMixins.orchestration_builder.setBuilderHeight(),Lyte.registeredMixins.orchestration_builder.setTabBodyHeight()):$L("crm-orchestration-reports").is(":visible")&&(Lyte.registeredMixins.orchestration_report.setReportContainerHeight(),Lyte.registeredMixins.orchestration_report.reRenderCharts())}function T(){if($("#z_editor").is(":visible")){var e=editor.zEditor;e&&($(e.body[0]).trigger("click"),$(e.document).trigger("click"),$(e.z_doc).trigger("click"))}}function _(){var e=$L("#UsersMenuListDiv").closest("table").outerWidth()-90-($L("#adduserbutton").outerWidth()+$L("#importUsers").outerWidth());e<=230&&$L("#userlistCV").css({"min-width":e-35+"px","max-width":e+"px"})}function E(){$("#vocChartContainer")&&window.vocHelper&&vocHelper.layoutResize()}return{All:function(){var S,L,D,k;if(Crm.isHeadless||("crm.tab.module.custom-view.list"!==(Lyte&&Lyte.Router.getRouteInstance()&&Lyte.Router.getRouteInstance().transition?Lyte.Router.getRouteInstance().transition.info.route:void 0)&&(renderingUtils.resizeWindowHW(),renderingUtils.tableSorter("listViewTable","2",""),crmListView.bindPerfectScrollbar(),renderingUtils.windowHeight=$(window).height(),$("#stageViewContainer").length&&crmListView.setWHforStageView(),$("#taskKanbanViewContainer").length&&setTimeout((function(){TaskKanbanView.setlayoutHt(".leftContainerctn"),null!=$("#taskKanbanViewContainer").height()&&TaskKanbanView.setkanbanTaskHt(),taskDetailsview.setComposeWindow()}),500),renderingUtils.resizeWindowHW(),$(".sticky-notes-wrapper").length&&crmStickies.resizeLayoutPosition(),$("#merge-field-mapping-list").length&&crmDeduplicate.setheader(),$("#deduplicatemergefield").length&&crmDeduplicate.fixedHeaderDedpulicate(),$("#idForCV").length&&$("#columnListId").length&&$("#columnListId").css({"min-height":"0px","max-height":$(window).height()-($("#addColumn").offset().top+$("#wmstoolbar").outerHeight()+36+$("#addColumn").outerHeight())-120})),e(),t(),a(),i(),o(),l(),$("#setupadvancedfeatures").length>0&&crmSetup.resizeAdvFeatures(),$("#dayLeft").length&&(thirdPartyUtils.unbindFullcalendar($("#calendarBd").parent()),$("#calendarBd").html(""),crmCalendarReady()),n(),v(),$("#LDPOP").is(":visible")&&CrmTracking.popupState&&CrmTracking.initPerfectscroll(),C(),function(){if($("#processBuilderContain").length){var e=$("#tabLayer"),t=e[0].getBoundingClientRect().top,a=e.outerHeight();$("#annoncement").is(":visible")&&(a+=$("#annoncement").outerHeight());var r=$("#canvasContainer"),i=$("#pb_dragAndDropBox"),o=1==$("#wmstoolbar").is(":visible")?$("#wmstoolbar").outerHeight():28,s=$(window).height()-(a+o),n=$(window).outerWidth()-480,l=n/2-200,d=$("#pb_all_saveCancel"),c=(s-d.outerHeight())/2-200;$("#setup_new_ContentDiv").height(s),$("#processDropCanvas").css({height:s-1,width:n}),d.css({width:n}),r.css({height:s,width:n}),i.css({left:l,top:c}),$(".pb_property_toll").css({width:480,height:s,top:a+t+"px"});var u=s-51;$(".pb_transitionInfo, .pb_processInfo").css({height:u}),ProcessBuilder.setFieldDivHeight()}}(),f(),g(),1!=Crm.userDetails.detailView_newUI&&crmBstTime.setPosition(),b(),d(),"undefined"!=typeof sandbox&&sandbox.sandboxListResize(),function(){if($(".lookupListTable").is(":visible")){var e=renderingUtils.windowWidth/100*5;$(".lookupListTable .lyteModal").css({right:e,left:e,width:"auto"});var t=renderingUtils.windowHeight/2;$(".entityLookupTable").css("max-height",t),hideAnimatePopup("columnList"),sE()}}(),L=$("crm-image-preview"),$(".imagePreviewParent").is(":visible")&&!1===L[0].component.data.zoomConfiguration.imageZoomState?L[0].component.calculateInitialImageSize():$(".uploadPlatform").is(":visible")&&$("crm-image-upload-picker")[0].component.calculatePickUI(),s(),$("#dataPrivacyContainerDiv").is(":visible")&&DataPrivacy.privacyLayoutResizeDV(),w(),R(),T(),I(),u(),m(),p(),(S=(S=document.querySelector("crm-admin-email-sharing"))||document.querySelector("crm-admin-email-sharing-preference"))&&S.component.emailSharingHeight()),r(),y(),function(){var e=$("#analyticsResult"),t=1===document.querySelectorAll("crm-webform-analytics").length?e:$("#moreStats"),a=$("#webF_LV"),r=$("#webF_overallAnalytics"),i=r.find(".webF_chartDiv");if(a.length){if(Crm.userDetails.RTL_ENABLED?a.css("width",renderingUtils.windowWidth-$("#setup_new_leftmenuDiv").outerWidth()):a.css("width",renderingUtils.windowWidth-a.offset().left+1),Crm.webformAnalyticsEnabled&&i.length&&!Crm.isZohoChartsEnabled&&Lyte.registeredMixins["webform-analytics-util"].overallPrevWidth!==renderingUtils.windowWidth){Lyte.registeredMixins["webform-analytics-util"].overallPrevWidth=renderingUtils.windowWidth;var o=r.width();i.highcharts().setSize(o,175);var s=o/3;$("#webF_overallAnalytics .conversionRate").css("width",s)}}else if(e.length){var n=e.offset().top,l=renderingUtils.windowHeight-n;e.css("height",l-45+"px")}else t.length&&(n=t.offset().top,l=renderingUtils.windowHeight-n,t.css("height",l-51+"px"))}(),function(){if($("#cv_ctn").length){var e=$("#outerTable"),t=e.offset().top,a=$("#cvbutton").outerHeight(),r=renderingUtils.windowHeight-(t+a);e.height(r)}}(),function(){var e=$("#abT_analytics");if(e&&e.length){$("#setup_new_ContentDiv").scrollTop(0);var t=e.offset().top,a=renderingUtils.windowHeight-t;e.css("height",a-28+"px")}}(),(D=$L("crm-scoringrule-details")).is(":visible")&&D[0].component.calcTableHeight(),(k=$L("#zBSColumnChart")).length&&k.find(".d3container")[0].__data__.redraw(),E(),function(){var e=$L(".depLogsHistoryCont");if(e&&e.length){var t=e.offset().top,a=$L("#wmstoolbar").height(),r=document.querySelector("crm-sandbox-deploymentlogs"),i=renderingUtils.windowHeight-(t+a+17);r.setData("logsContentHeight",i)}}(),"function"==typeof template.setlistViewPage&&template.setlistViewPage(),"function"==typeof template.setEditorHtResize&&template.setEditorHtResize(),"function"==typeof template.setContainerHt&&template.setContainerHt("galleryCtn","templateGalleySection"),"function"==typeof template.listViewPreviewFrameHt&&$("#previewIframe").length>0&&template.listViewPreviewFrameHt(),"function"==typeof template.previewAttachPos&&template.previewAttachPos(),"function"==typeof editorHt&&editorHt(),$("#crmNewTemplate").length>0&&template.isTemplateEditorEnabled&&$("#emailEditor").length>0&&"function"==typeof $("#emailEditor")[0].contentWindow.elemPositionFunc&&$("#emailEditor")[0].contentWindow.elemPositionFunc(),$("#conditionalFieldContainer .conditionalFieldinner").length){var P=$(window).height()-$("#show").offset().top-30;$(".conditionalFieldinner").css("height",P)}$(".userLookup:visible")&&$(".userLookup:visible").length>0&&($(".userLookup").hide(),$(".popup-model-content,.pp-content").removeClass("oH")),$("li.subformList").length>0&&c(),$(".subFrmTablWrapper").length>0&&crmTemplate.subFrmLeftRightMask(),$(".fieldLeftCountDiv").length>0&&$(".fieldLeftCountDiv").css("max-height",renderingUtils.windowHeight-150),$("crm-templates-view").length&&$("crm-templates-view")[0].component.previewPopSetHt.call(this,"#galleryTemplatePreview"),$("crm-templates-view").length&&$("crm-templates-view")[0].component.setContainerHt.call(this,"galleryCtn","templateGalleySection");var A=$(".customUserDiv");A.is(":visible")&&A.hide(),(A=$(".customChannelDiv")).is(":visible")&&A.hide(),$(".pipelineWraperOuter").length&&h(),$L("#importUsers").length&&_()},Home:e,blankPageOnboardingResize:w,customHome:b,DetailpageResize:t,DetailpageResizeRevamp:a,Dashboard:r,ReportsResize:i,Setup:o,PopupHeightResize:l,socialResize:n,signalsResize:f,GamificationResize:v,importResize:g,COBresize:C,aDashboarResize:y,subFrmResize:c,setWidthHeightStage:d,marketingAttribution:s,orchestrationResize:R,recommendationResize:I,aBTestleftPanelHghtCal:u,aBTestingPreviewCal:m,webformPreviewCal:p,pipelineStagesHght:h,importUsersWidth:_,composeEditorResize:T,vocResize:E}}();var crmTab={redirectToSalesInbox:void 0,isMailClientActive:!1,isMailClientEnabled:!1,selectedTab:void 0,tabCount:void 0,tabList:void 0,tabVsSubTabs:{},li:void 0,liSelected:void 0,countCache:{},cacheObj:{},filterCache:{},isZBCustomModule:function(e){return["CustomModule5001","CustomModule5002","CustomModule5003","CustomModule5004","CustomModule5005"].indexOf(e)>=0},isZECustomModule:function(e){return["CustomModule5006","CustomModule5007","CustomModule5008"].indexOf(e)>=0},isZSCustomModule:function(e){return["CustomModule5009","CustomModule5010"].indexOf(e)>=0},isOrchestrationModule:function(e){return e.indexOf("Orchestration")>=0},isZCpqTab:function(e){return["Quotes","SalesOrders","PurchaseOrders","Invoices"].indexOf(e)>=0},isZCpqSubTab:function(e){return["Products","PriceBooks"].indexOf(e)>=0},getFirstZBModule:function(e){if(!moduleRecordMapping[e].viewable){var t=Object.values(moduleRecordMapping).filter((function(e){return crmTab.isZBCustomModule(e.module_name)&&e.viewable})).sort((function(e,t){return e.sequence_number-t.sequence_number}));t.length>0&&(e=t[0].module_name)}return e},isZBStatusColumn:function(e){return["COBJ5001CF5","COBJ5002CF5","COBJ5003CF5","COBJ5004CF5"].indexOf(e)>=0},isZInvoiceCustomModule:function(e){return["CustomModule5001","CustomModule5002","CustomModule5005"].indexOf(e)>=0},isBooksIntegrated:function(){return this.tabList.contains("Zoho Books")},isInvoiceIntegrated:function(){return this.tabList.contains("Zoho Invoice")},isZExpenseSubModule:function(e){return["CustomModule5006","CustomModule5007"].indexOf(e)>=0},isLinkingModule:function(e){return e&&e.indexOf("LinkingModule")>-1},removeOrShowZBTabLayer:function(e){var t=$("#zbModuleTabLayer");t.css("display",e?"inline-block":"none"),t.css({"margin-bottom":"-2px",width:"100%"})},removeOrShowZInvoiceTabLayer:function(e){var t=$("#zInvoiceModuleTabLayer");t.css("display",e?"inline-block":"none"),t.css({"margin-bottom":"-6px",width:"100%"})},removeOrShowZExpenseTabLayer:function(e){$("#zohoExpenseTabLayer").css("display",e?"block":"none")},putInCache:function(e,t){this.cacheObj[e]=t},putFiltersInCache:function(e,t){this.filterCache[e]=t},getFiltersFromCache:function(e){return this.filterCache[e]},getFromCache:function(e){return this.cacheObj[e]},checkPresenceInCache:function(e){return Crm.isActivitySplitDone||"Tasks"!=e&&"Calls"!=e&&"Events"!=e||(e="Activities"),!!this.cacheObj[e]},deleteFromCache:function(e){if("Tasks"!=e&&"Calls"!=e&&"Events"!=e||Lyte.Router&&Lyte.Router.getRouteInstance()&&Lyte.Router.getRouteInstance().parent.parent&&"Activities"===Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()&&(e="Activities"),delete this.cacheObj[e],moduleRecordMapping[e]){var t=moduleRecordMapping[e].id;store.modelFor(t)&&store.unloadAll(t)}},deleteFromCacheCount:function(e,t){this.countCache[e]&&delete this.countCache[e][t]},emptyCache:function(){this.cacheObj={}},clickEventIdVsMethodMapping:{sortingRecords:"crmListView.recordChange",navigate_previous:"Crm.lyteTransition",navigate_next:"Crm.lyteTransition",changeOption:"Crm.lyteTransition"},updateTabContent:function(e){!Crm.isActivitySplitDone&&Crm.activityGrp[e]&&(e=Crm.activityGrp[e]),moduleRecordMapping.ZohoCPQ&&moduleRecordMapping[e]&&moduleRecordMapping[e].parent_module&&moduleRecordMapping[e].parent_module.module_name===moduleRecordMapping.ZohoCPQ.module_name&&(e=moduleRecordMapping.ZohoCPQ.module_name),crmplusImplTriggerActions("selectEntity",["module",e])},getDisplayName:function(e,t){var a;"Zoho Finance"!=e&&"Zoho Books"!=e&&"Zoho Invoice"!=e||(crmTab.isBooksIntegrated()?(e="Zoho Books",a=I18n.getMsg("Zoho")):e="Zoho Invoice");var r=Crm.userDetails.MODULE_LIST[e];if(r)return r.modified_by?(t?r.singular_label:r.plural_label)||"":(t?I18n.getMsg(r.singular_label,a):I18n.getMsg(r.plural_label,a))||""},reloadTabMenu:function(e,t){var a,r="undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()&&"undefined"!=typeof CrmPlusLib,i=new Promise((function(e){var t=Crm.getCrmBasePath()+"/RefreshMenu.do";r&&(t+="?loadCrmPlusTabJSON=true"),(new crmRequestPool).doAjax(t,(function(t){var a=document.getElementById("tabLayer"),r=document.createElement("div");r.innerHTML=t,$("#createsubmenu").html(r.children.createsubmenu.innerHTML),EvalInnerScript(r,a),e(t)}))}));e&&(a=store.findAll("module")),store.unloadAll("tab_group"),Lyte.resolvePromises([i,a]).then((function(){if(store.findAll("tab_group").then((function(e){for(var a,r=e.length,i=0;i<r;i++)if(e[i].default){a=e[i].modules.sortBy("sequence_number");break}if(document.getElementsByTagName("crm-tab")[0].setData("tabModules",a),t){var o=document.getElementsByTagName("crm-tab-group");o[0].setData("tabGroupsName",e),o[0].setData("rendered",!0)}var s=document.querySelector("crm-menu");s&&(r>1?s.setData("showTabGroup",!0):s.setData("showTabGroup",!1))})),reloadMenuData(),r&&($("#mainMenuTabDiv").addClass("mainMenuTabDiv"),$("#ThemesContainer").hide(),"undefined"!=typeof crmPlusModule)){var e=["module",crmPlusModule];CrmPlusImpl.trigger("modifyUI",e);var a=["addrecordoption",crmPlusAddRecOption];CrmPlusImpl.trigger("modifyUI",a)}}))},clearAdwordCache:function(e){var t=!1,a=new Array("accId","campId","gid","zgid","kid","adid");for(obj in a)a[obj]==e&&(t=!0),t&&(adwordParams[a[obj]]="")}};function reloadMenuData(){for(var e=["isSandboxAcc","showEdition","cvPermission","showMailMagnet","newMailCount","isTrialEnable","zohoBundleOrgHasPermission","zohoBundleOrgPaymentLink","zohoBundleOrgResult","zorgHasPermission","zorgPaymentLink","zorgResult","isFreeEdtionWithAddon","isZohoOneUser","isCrmPlusUser","elseResult","logoutURL","isJiveSignup","trialCount","usersCount","firstTimeTrialFromSetup","notPbxVendor","isMultipleTrialProvisionDisabled"],t={},a=document.getElementsByTagName("crm-menu")[0],r=e.length,i=0;i<r;i++)t[e[i]]=window[e[i]];a.setData(t)}var Activities={moduleName:"Activities",isRequestSent:!1,currentStatus:void 0,selectedIds:0,reminderCount:0,reminderList:"",keyVsFieldLabel:void 0,init:function(){Handlebars.registerPartial("singleReminder",Handlebars.templates.singleReminder),Activities.reminderTemplate=Handlebars.templates.ActivityReminder,Activities.detaildivTemplate=Handlebars.compile('<div class="rmindrdet-type clearFix" style="display: none;"><span class="remLabel">{{{fieldLabel}}}</span>-<span class="remValue">{{{fieldvalue}}}</span></div>'),Activities.currentDiv=Handlebars.templates.singleReminder},makeRequest:function(e,t,a,r){Activities.isRequestSent=!0;var i=new crmRequestPool;t=csrfParamName+"="+encodeURIComponent(csrfToken);i.initiate({action:e,type:"POST",data:t,success:function(e){if(Activities.isRequestSent=!1,"show"===a){var t="",i=$(".remindertemp").length;null==Activities.reminderTemplate&&Activities.init(),Activities.keyVsFieldLabel=e.keyVsFieldLabel,e&&e.details&&(e=crmBstTime.populateActivityReminderBestTime(e.details)),t=Activities.reminderTemplate(e);for(var o=0,s=e.length,n=0;n<s;n++)o+=e[n].length;Activities.reminderCount=Activities.reminderCount+o;var l="#notificationCount";$(l).text(Activities.reminderCount).show(),Activities.notifyCountToCrmPlusFrame(Activities.reminderCount),o>=25&&($(l).text(Activities.reminderCount+"+").show(),t=t+'<div class="mT5 mB5 pT10 aligncenter cP" id="viewMoreAct"><div onclick="Activities.constructReminder(null)">'+I18n.getMsg("crm.nsocial.tab.view.more")+"</div></div>");var d="#viewMoreAct";$(d).length>0&&$(d).remove();var c=$("#reminderContent");if(c.append(t),$("#currentEvt").length>0){var u=$(".remainderList")[0],m=$(".remainderList")[1];for(n=1;n<u.children.length-1;n++)id=u.children[n].id,$(m).find($("li[id='"+id+"']")).remove(),$(m).children().length<3&&m.remove()}$(".remainder-notifi").slideDown(),0==$(".remindertemp").length&&($("#notificationCount").hide(),c.html("<div id='noReminder' class='pB20 pL20'>"+I18n.getMsg("crm.module.empty.message",I18n.getMsg("crm.activity.reminder"))+"</div>")),thirdPartyUtils.bindPerfectScroll("#remainderpopup",{wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!1}),$("#remainderpopup").addClass("oH");var p=$(".remindertemp");for(s=e.length,n=0;n<s;n++)for(var h=0;h<e[n].length;h++)Activities.reminderList=Activities.reminderList+e[n][h].activityId+";",p.eq(i).data("details",e[n][h]),i++;$("#reminder_notification").hide()}else"dismiss"===a?"success"==e&&(Activities.selectedIds=0,Activities.showHideReminderDetail()):"later"===a&&$("#errorMsg").text(e).show().fadeOut(4e3);null!=r&&"function"==typeof r&&r()},error:function(e){Activities.isRequestSent=!1,e.responseText&&(555==e.status?$("#errorMsg").text(e.responseText).show().fadeOut(4e3):550==e.status&&$(".timericon").css("display","none"))}})},constructReminder:function(e){var t=0,a=26;0!=Activities.reminderCount&&(a+=t=Activities.reminderCount+1);var r=Crm.getCrmBasePath()+"/ActivityReminder.do?actionName=showreminder&fromIndex="+t+"&toIndex="+a;this.makeRequest(r,null,"show",e)},showMoreDetails:function(e){if($(e).hasClass("remainderactive"))return $(e).removeClass("remainderactive"),!1;$(".remainder-notifi").show(),Activities.showHideReminderDetail(),$(e).addClass("remainderactive");var t="",a=$(e).data("details");$.each(a,(function(e,r){if(Activities.keyVsFieldLabel[e]){var i={fieldLabel:e=Activities.keyVsFieldLabel[e],fieldvalue:r};t+=Activities.detaildivTemplate(i)}else{var o=a.module;if("relatedTo"===e||"relatedCont"===e){var s=r.seModule;r='<a  class="crm-font-bold black"  href="'+Crm.getCrmBasePath()+"/EntityInfo.do?module="+r.seModule+"&id="+r.id+'" target="_blank">'+r.name+"</a>";i={fieldLabel:e=I18n.getMsg("crm.right.related.module",moduleRecordMapping[s].singular_label),fieldvalue:r};t+=Activities.detaildivTemplate(i)}else if("Events"!=o&&"Calls"!=o||"dueDate"!=e){if("Appointments"==o&&("serviceName"==e||"appointmentFor"==e||"HOSTNAMEVAL"==e||"appointmentLocation"==e)){"serviceName"==e?e=I18n.getMsg("crm.appointmentreminder.servicename"):"appointmentFor"==e?e=I18n.getMsg("crm.appointmentreminder.line5"):"HOSTNAMEVAL"==e?e=I18n.getMsg("crm.appointmentreminder.appointmentowner"):"appointmentLocation"==e&&(e=I18n.getMsg("crm.appointmentreminder.line7"));i={fieldLabel:e,fieldvalue:r};t+=Activities.detaildivTemplate(i)}}else{e="startTime",r=r.split("-")[0],o=a.sing_moduleName,e=I18n.getMsg("crm.label.call.start.time",I18n.getMsg(o)),"Appointment"==o&&(e=I18n.getMsg("crm.appointmentreminder.line3"));var i={fieldLabel:e,fieldvalue:r};t+=Activities.detaildivTemplate(i)}}})),$(t).addClass("remainderactive"),$(e).append(t).find(".rmindrdet-type").slideDown(200)},showHideRemainder:function(e){Crm.menu.globalHideMenu(),hideFeedBackPopup(),massActionNotification.hideMassOperationProgressDiv(),crmNTCGlobal.closeGlobalNotifications();var t=$("#reminderContent").html(),a=$("#remainder-notifi");if(a.is(":visible"))Activities.RemainderHideOnly(),Crm.sharedworker.makeRequest("trigger","trigger","Activities.RemainderHideOnly");else if(null!=t&&""==t.trim())$(".timericon").addClass("footIconActive timericonAct"),this.constructReminder((function(){$("#noReminder").length>0?$(".remainder-notifi").hide():setTimeout((function(){$(".timericon").addClass("footIconActive timericonAct"),$("#reminder_notification").hide()}),2e3),crmui.fromFooter("remainder-notifi")}));else if(document.getElementById("remainder-notifi")){var r=a[0].style.bottom;r||(r=a.outerHeight()-(isChatEnabled||Crm.userDetails.CLIENT_ACCOUNT?26:0),a.css({bottom:"-"+r+"px"})),crmui.fromFooter("remainder-notifi"),$(".timericon").addClass("footIconActive timericonAct"),null!=e&&"function"==typeof e&&e(),$("#reminder_notification").hide()}},RemainderHideOnly:function(){var e="#notificationCount";"0"!==$(e).text()&&$("#reminder_notification").text($(e).text()).show(),crmui.toFooter("remainder-notifi"),$(".timericon").removeClass("footIconActive timericonAct"),Activities.showHideReminderDetail()},showHideReminderDetail:function(){var e=".remainderdet-wrap";$(e).length>0&&$(e).is(":visible")&&($(e).remove(),$("ul li").removeClass("remainderactive")),$(".remainderactive").length>0&&$("ul li").removeClass("remainderactive"),$("#remainderpopup").find(".rmindrdet-type").length>0&&$(".rmindrdet-type").slideUp(200,(function(){$(this).remove()}))},dismissReminder:function(e){if(e||(e=Activities.getSelectedIds())){var t=Crm.getCrmBasePath()+"/ActivityReminder.do?actionName=dismiss&idList="+e;this.makeRequest(t,void 0,"dismiss",(function(){var t={id:e};Activities.removeDismissedActivities(e),Crm.sharedworker.makeRequest("trigger","trigger","Activities.removeDismissedActivities",t)}))}},laterReminder:function(e,t){var a=document.getElementById("laterRemind_"+e);if("Tasks"===t){var r=[{colname:"RemindLater_Start_Date1",customfield:"false",displaylabel:"Remind At",label:"Start Date",mandate:"false",maxlength:"120",readonly:"false",type:"Date",uitype:"786",defaultvalue:new Date}],i="#RemindLaterdiv";if($(i).length<=0){crmTemplate.createSubFields(t,a,"RemindLaterdiv",r),$("#Crm_Tasks_RemindLater_Start_Date1").data("mandate",!0);var o='<div class="p10 alignright"><button type="button" class="primarybtn" onclick="Activities.validateReminder(\''+e+"');sE(event);\">"+I18n.getMsg("crm.button.ok")+"</button>";o+='<button type="button" class="newgraybtn" onclick="Activities.cancelReminder();sE(event);">'+I18n.getMsg("crm.button.cancel")+"</button></div>",$(i).append(o)}else $(i).show();$("#actionButton").hide(),setTimeout((function(){$("#Crm_Tasks_RemindLater_Start_Date1_TimeOption_List").css("z-index","250"),$("#Crm_Tasks_RemindLater_Start_Date1").focus()}),1e3);var s=$(".remainderdet-wrap").offset().top;$(".remainderdet-wrap").css({top:s-55})}else{var n=Crm.getCrmBasePath()+"/ActivityReminder.do?actionName=later&id="+e+"&module="+t;this.makeRequest(n,void 0,"later",(function(){setTimeout((function(){var t={id:e};Activities.showHideReminderDetail(),Activities.removeDismissedActivities(e),Crm.sharedworker.makeRequest("trigger","trigger","Activities.laterReminderHide",t)}),1e3)}))}},cancelReminder:function(){$("#actionButton").show(),$("#RemindLaterdiv").hide();var e=$(".remainderdet-wrap").offset().top;$(".remainderdet-wrap").css({top:e+55})},validateReminder:function(e){var t="#Crm_Tasks_RemindLater_Start_Date1_TimeOption",a=$(t).val().split(" ")[0],r=Utils.getMeridiem($(t).timeEntry("getTime")).toUpperCase();Activities.laterReminder(e,"Tasks&Date="+Crm_Tasks_RemindLater_Start_Date1.value+"&Time="+a+" "+r)},showHideBulkDismiss:function(e){renderingUtils.stopEvent(event);var t="#checkAllRecord";$(e).prop("checked")?(Activities.selectedIds++,$(e).parent().addClass("remindSelctBg"),$("#reminder_bulkdismiss").show().find('input[value="Dismiss"]').show(),$(t).prop("checked",!1),$("#reminderContent").find('input[type="checkbox"]:checked').length==$("#reminderContent").find('input[type="checkbox"]').length&&$(t).prop("checked",!0)):(Activities.selectedIds--,$(e).parent().removeClass("remindSelctBg"),0===Activities.selectedIds&&$("#reminder_bulkdismiss").hide(),$(t).is(":checked")&&$(t).prop("checked",!1))},getSelectedIds:function(){var e=$("#reminderContent").find('input[type="checkbox"]:checked'),t=e.length,a="";if(0===t)return $("#reminder_bulkdismiss").hide(),a;a=e.eq(0).attr("id").replace("chk_","");for(var r=1;r<t;r++)a=a+","+e.eq(r).attr("id").replace("chk_","");return a},removeDismissedActivities:function(e){$("#reminder_bulkdismiss").hide();for(var t=0,a=(e=e.split(",")).length,r=0;r<a;r++){var i=$("li[id='"+e[r]+"']").closest("ul");$("li[id='"+e[r]+"']").length>0&&($("li[id='"+e[r]+"']").remove(),t++),i.children().length<3&&i.remove()}var o=Activities.reminderCount-t,s="#notificationCount",n="#reminder_notification";$(s).html().indexOf("+")>-1?$(s).html(o+"+"):($(s).html(o),$(n).html(o)),Activities.reminderCount=o,Activities.notifyCountToCrmPlusFrame(o),0===$(".remainderList").length&&0===$("#viewMoreAct").length?($(n).hide(),$(s).hide(),$("#reminderContent").html("<div id='noReminder' class='pB20 pL20'>"+I18n.getMsg("crm.module.empty.message",I18n.getMsg("crm.activity.reminder"))+"</div>")):0==$(".remainderList").length&&0!=$("#viewMoreAct").length&&this.constructReminder()},checkAll:function(){var e=$("#reminderContent").find('input[type="checkbox"]'),t=".remindertemp";$("#checkAllRecord").is(":checked")?($(t).addClass("remindSelctBg"),$("#reminder_bulkdismiss").find('input[value="Dismiss"]').show(),$(e).prop("checked",!0),this.selectedIds=$(e).length):($(t).removeClass("remindSelctBg"),$(e).prop("checked",!1),$("#reminder_bulkdismiss").find('input[value="Dismiss"]').hide(),this.selectedIds=0)},checkForReminderDate:function(e,t){var a=Crm.getCrmBasePath()+"/ActivityReminder.do?actionName=checkReminderDate";e[csrfParamName]=csrfToken,(new crmRequestPool).initiate({action:a,type:"POST",data:e,success:t})},checkForTaskReminderDate:function(e,t){var a=new Date(e.date),r=e.ampm,i=e.hour,o=e.minute,s=e.eventBefore;r&&r.includes("PM")&&(i=(parseInt(i)+12).toString());var n,l=Crm.userDetails.TIME_ZONE.substring(0,1)+6e4*(60*parseInt(Crm.userDetails.TIME_ZONE.substring(1).split(".")[0])+parseInt(Crm.userDetails.TIME_ZONE.substring(1).split(".")[1])),d=new Date,c=d.getTime()+6e4*d.getTimezoneOffset()+61e3,u=Utils.getDateInGivenPattern(a,"yyyy-mm-dd").split("-"),m=new Date(u[0],parseInt(u[1])-1,u[2],i,o,"00","000");if(""==s.trim())(n=m.getTime()-parseInt(l))<c;else{var p=s.split(" ")[0],h=s.split(" ")[1];if("days"==h){var f=24*parseInt(p)*60*60*1e3;n=m.getTime()-parseInt(l)-f}else if("weeks"==h){f=7*parseInt(p)*24*60*60*1e3;n=m.getTime()-parseInt(l)-f}else if("months"==h)if(Activities.monthLastDay(m)){var v=m.getMonth()-parseInt(p);n=new Date(m.getFullYear(),v+1,0,i,o,"00","000").getTime()}else m.setMonth(m.getMonth()-parseInt(p)),n=m.getTime()-parseInt(l)}t((n<c).toString())},resetReminderSection:function(){var e=$("#notificationCount").text();$("#reminder_notification").text(e).show(),$(".remainder-notifi").slideUp(),$(".timericon").removeClass("footIconActive timericonAct"),Activities.notifyCountToCrmPlusFrame(e),$("#reminderContent").empty(),Activities.reminderCount=0,Activities.reminderList=""},monthLastDay:function(e){return new Date(e.getYear(),e.getMonth()+1,0).getDate()==e.getDate()},notifyCountToCrmPlusFrame:function(e){isLoadedInCRMPlusIFrame()&&CrmPlusImpl.trigger("setNotificationCount",["reminder",e])}},CrmFieldConstants={OWNER_PHOTO:0,TEXTFIELD:1,WEBSITE:21,TWITTER:22,DATE:24,DATE1:14,DATE2:24,DATE_LONG:202,EMAIL:25,DATE3:333,TAGS:209,PHONE:33,DECIMAL:38,IMAGE:66,IMAGE1:67,IMAGE2:68,MULTIPICKLIST:100,DATETIME:200,BOOLEAN_YES:300,BOOLEAN_NO:301,FORMULA:116,DATETIME_EVENT_START:786,TEXTAREA:3,CUSTOMTEXTAREA:110,TERRITORY:999,LAYOUT:208,WIZARD:207,TEXTAREA1:110,TEXT:1e3,PICK_LIST:2,STAGE:26},CrmField=function(e,t){this.fromGallery=t,this.fieldMetaJson=e,this.fieldId=this.fieldMetaJson.id,this.defKey=this.fieldId+"_defaultvalue",this.defValString="{{"+this.fieldId+"_defaultvalue}}",this.defValEncodedForAttribute=this.getEncodedKey(this.defKey,2),this.defValEncodedForURL=this.getEncodedKey(this.defKey,3),this.defValEncodedForJS=this.getEncodedKey(this.defKey,4)};CrmField.prototype.getHTML=function(){var e="";switch(this.fieldMetaJson.UITYPE){case CrmFieldConstants.OWNER_PHOTO:e+=this.handleOwnerPhoto();break;case CrmFieldConstants.EMAIL:e+=this.handleEmailField();break;case CrmFieldConstants.WEBSITE:e+=this.handleWebsiteField();break;case CrmFieldConstants.TWITTER:e+=this.handleTwitterField();break;case CrmFieldConstants.PHONE:e+=this.handlePhoneField();break;case CrmFieldConstants.TAGS:e+=this.handleTagFields();break;case CrmFieldConstants.IMAGE:case CrmFieldConstants.IMAGE1:case CrmFieldConstants.IMAGE2:e+=this.handleImageFields();break;case CrmFieldConstants.BOOLEAN_YES:case CrmFieldConstants.BOOLEAN_NO:e+=this.handleBooleanFields();break;case CrmFieldConstants.FORMULA:e+=this.handleFormulaFields();break;case CrmFieldConstants.DATETIME:case CrmFieldConstants.DATETIME_EVENT_START:case CrmFieldConstants.DATE1:case CrmFieldConstants.DATE2:case CrmFieldConstants.DATE3:e+=this.handleDateTimeFields();break;case CrmFieldConstants.TEXTAREA:case CrmFieldConstants.CUSTOMTEXTAREA:e+=this.handleTextAreaField();break;case CrmFieldConstants.STAGE:case CrmFieldConstants.PICK_LIST:e+=this.handlePickListField();break;default:e+=this.handleTextField()}return e},CrmField.UITYPES={FILE_UPLOAD:555,IMAGE_UPLOAD:556,OWNER:8,USERLOOKUP:221,PRODUCT_HANDLER:55,SINGLE_LINE:1,DATE:24,DATE_LONG:202,DATETIME:786,DATE_TIME2:333,END_DATE_TIME:14,MULTI_LINE_CF:110,NUMERIC_FIELD:32,PHONE:33,PERCENT:34,PRICING_DETAILS:51,LONG_INTEGER:52,WEBSITE:21,EMAIL:25,FAX:35,CURRENCY:36,DECIMAL:38,MULTI_PICK_LIST:100,GLOBAL_TAX:96,PICK_LIST:2,SKYPE_FIELD:37,TEXT_FIELD:11,TWITTER:22,FIRST_NAME:27,LAST_NAME:127,TASK_SUBJECT:62,TEXT_AREA:3,DATE_TIME1:30,LONG_DATE_TIME:333,DATE_TIME2:14,DATE_TIME_LONG:333,CREATED_TIME:200,CREATED_BY:20,AGGREGATE_FIELD:117,BIG_DECIMAL:40,STAGE:26,RECORD_CURRENCY:39,ACCOUNT_NAME_LOOKUP:4,CAMPAIGN_NAME_LOOKUP:5,PRODUCT_NAME_LOOKUP:6,CONTACT_LOOKUP:7,VENDOR_NAME_LOOKUP:9,POTENTIAL_ID:10,SALESORDER_ID:12,CONTACT_ID:13,QUOTE_ID:15,ROLE_NAME:16,MULTI_MODULE_LOOK_UP_ENTITY:132,LOOK_UP_ENTITY:133,SYSTEM_SINGLE_LOOK_UP_ENTITY:135,MULTISELECT_LOOK_UP:444,MULTISELECT_USERLOOKUP:445,BOOLEAN_DEF:300,BOOLEAN_DEF_NOT:301,CURRENCY_ROUND_OFF:143,CURRENCY_ROUND_DOWN:144,CURRENCY_ROUND_UP:145,LAYOUT:208,WIZARD:207,TAGS:209,AUTONUMBER:111,SUBFORMS:500,OWNER_PHOTO:0,IMAGE:66,IMAGE1:67,IMAGE2:68,TEXTAREA:3,CUSTOMTEXTAREA:110,COMMENTCONTENTS:99,PHOTO_FILEID:66,PROFILE_PIC:67,PRODUCT_IMAGE:68,TAGMODULEREFID:209,SUBFORM:500,LINKINGMXN1:500,ADD_PARTICIPANT:41,FORMULA:116,LINE_ITEM_DOUBLE_CURRENCY:77,RECURRING_EVENTS:123,LAYOUT_LOOKUP:136,SERVICE_DURATION:80,SERVICE_TIMING:82,MULTI_DATE_SELECT:81,IMAGE_UPLOAD:556,LINETAX:47,INPUT_BOX:19,ADWORD_FIELDS:31,BIG_INTEGER:46,PRODUCT_DETAILS:50,PLAIN_TEXT_DYNAMIC_FIELDS:60,ADWORD_AD_FIELD:103,EVENT_REMINDER:104,DATA_PROCESSING_BASIS:134,MODULE_LIST:137},CrmField.wizardIncludedFieldUiTypes=[CrmField.UITYPES.OWNER,CrmField.UITYPES.USERLOOKUP,CrmField.UITYPES.PRODUCT_HANDLER,CrmField.UITYPES.SINGLE_LINE,CrmField.UITYPES.DATE,CrmField.UITYPES.DATE_LONG,CrmField.UITYPES.DATETIME,CrmField.UITYPES.DATE_TIME1,CrmField.UITYPES.DATE_TIME2,CrmField.UITYPES.DATE_TIME_LONG,CrmField.UITYPES.MULTI_LINE_CF,CrmField.UITYPES.NUMERIC_FIELD,CrmField.UITYPES.PHONE,CrmField.UITYPES.PERCENT,CrmField.UITYPES.FAX,CrmField.UITYPES.LONG_INTEGER,CrmField.UITYPES.WEBSITE,CrmField.UITYPES.EMAIL,CrmField.UITYPES.STAGE,CrmField.UITYPES.CURRENCY,CrmField.UITYPES.DECIMAL,CrmField.UITYPES.MULTI_PICK_LIST,CrmField.UITYPES.PICK_LIST,CrmField.UITYPES.SKYPE_FIELD,CrmField.UITYPES.TEXT_FIELD,CrmField.UITYPES.TWITTER,CrmField.UITYPES.FIRST_NAME,CrmField.UITYPES.LAST_NAME,CrmField.UITYPES.TASK_SUBJECT,CrmField.UITYPES.TEXT_AREA,CrmField.UITYPES.DATE_TIME1,CrmField.UITYPES.AGGREGATE_FIELD,CrmField.UITYPES.BIG_DECIMAL,CrmField.UITYPES.RECORD_CURRENCY,CrmField.UITYPES.ACCOUNT_NAME_LOOKUP,CrmField.UITYPES.CAMPAIGN_NAME_LOOKUP,CrmField.UITYPES.PRODUCT_NAME_LOOKUP,CrmField.UITYPES.CONTACT_LOOKUP,CrmField.UITYPES.VENDOR_NAME_LOOKUP,CrmField.UITYPES.POTENTIAL_ID,CrmField.UITYPES.CONTACT_ID,CrmField.UITYPES.QUOTE_ID,CrmField.UITYPES.ROLE_NAME,CrmField.UITYPES.LOOK_UP_ENTITY,CrmField.UITYPES.BOOLEAN_DEF,CrmField.UITYPES.BOOLEAN_DEF_NOT,CrmField.UITYPES.CURRENCY_ROUND_OFF,CrmField.UITYPES.CURRENCY_ROUND_DOWN,CrmField.UITYPES.CURRENCY_ROUND_UP,CrmField.UITYPES.LAYOUT,CrmField.UITYPES.AUTONUMBER,CrmField.UITYPES.SUBFORM,CrmField.UITYPES.STAGE,CrmField.UITYPES.FILE_UPLOAD,CrmField.UITYPES.IMAGE_UPLOAD],CrmField.UITYPEHINT={8:I18n.getMsg("crm.field.label.user.lookup"),221:I18n.getMsg("crm.field.label.user.lookup"),55:I18n.getMsg("crm.field.label.user.lookup"),1:I18n.getMsg("crm.field.label.single.line"),24:I18n.getMsg("crm.field.label.date"),202:I18n.getMsg("crm.field.label.date"),786:I18n.getMsg("crm.field.label.date.time"),30:I18n.getMsg("crm.field.label.date.time"),14:I18n.getMsg("crm.field.label.date.time"),333:I18n.getMsg("crm.field.label.date.time"),110:I18n.getMsg("crm.field.label.text.area"),32:I18n.getMsg("crm.field.label.integer"),33:I18n.getMsg("crm.field.label.phone"),34:I18n.getMsg("crm.field.label.percentage"),35:I18n.getMsg("crm.field.label.phone"),52:I18n.getMsg("crm.field.label.long.integer"),21:I18n.getMsg("crm.field.label.url"),25:I18n.getMsg("crm.field.label.email"),26:I18n.getMsg("crm.value.label.option1"),36:I18n.getMsg("crm.field.label.currency"),38:I18n.getMsg("crm.field.label.decimal"),100:I18n.getMsg("crm.value.label.option1"),2:I18n.getMsg("crm.value.label.option1"),37:I18n.getMsg("crm.field.label.single.line"),11:I18n.getMsg("crm.field.label.single.line"),22:I18n.getMsg("crm.field.label.single.line"),27:I18n.getMsg("crm.field.label.single.line"),127:I18n.getMsg("crm.field.label.single.line"),62:I18n.getMsg("crm.field.label.text.area"),3:I18n.getMsg("crm.field.label.text.area"),117:I18n.getMsg("crm.subform.aggregate"),40:I18n.getMsg("crm.field.label.decimal"),39:I18n.getMsg("crm.field.label.currency"),4:I18n.getMsg("crm.field.label.lookup"),5:I18n.getMsg("crm.field.label.lookup"),6:I18n.getMsg("crm.field.label.lookup"),7:I18n.getMsg("crm.field.label.lookup"),9:I18n.getMsg("crm.field.label.lookup"),10:I18n.getMsg("crm.field.label.long.integer"),13:I18n.getMsg("crm.field.label.lookup"),15:I18n.getMsg("crm.field.label.long.integer"),16:I18n.getMsg("crm.field.label.single.line"),133:I18n.getMsg("crm.field.label.lookup"),300:I18n.getMsg("crm.value.label.choice2"),301:I18n.getMsg("crm.value.label.choice2"),143:I18n.getMsg("crm.field.label.currency"),144:I18n.getMsg("crm.field.label.currency"),145:I18n.getMsg("crm.field.label.currency"),111:I18n.getMsg("crm.field.label.auto.number"),555:I18n.getMsg("crm.label.widgets.fileupload"),556:I18n.getMsg("crm.image.name")},CrmField.prototype.getEncodedKey=function(e,t){var a="{{"+e+"}}";return 2===t?a="{{encodeForHTMLAttribute "+e+"}}":3===t?a="{{encodeURL "+e+"}}":4===t&&(a="{{encodeJS "+e+"}}"),a},CrmField.prototype.handleTextField=function(){return"{{#unless "+this.fieldId+"_skipencoding}}"+this.defValString+"{{else}}{{{"+this.defKey+"}}}{{/unless}}"},CrmField.prototype.handleTextAreaField=function(){return"{{#canvasEmptyCheck this '"+this.fieldId+"'}}<pre style='word-wrap: break-word; white-space:pre-wrap;'>{{#unless "+this.fieldId+"_skipencoding}}"+this.defValString+"{{else}}{{{"+this.defKey+"}}}{{/unless}}</pre>{{/canvasEmptyCheck}}"},CrmField.prototype.handlePhoneField=function(){if(!0!==this.fieldMetaJson.donotshow||Crm.userDetails.CLIENT_ACCOUNT){var e="{{#canvasEmptyCheck this '"+this.fieldId+"'}}{{#if ISCALLALLOWED}}";if(!0===this.fieldMetaJson.outbound)e+="<span class='phoneRtl cd_style_inherit' style='min-width:100%'>"+this.defValString+"<a href='javascript:;' class='cd_style_inherit calliconOuter' onmouseover='CTIAPI.showCallButtonlabel(this)' onmouseout=\"CTIAPI.hideCallButtonlabel(this)\" onclick=\"sE();ctiApiNotifier.click2Call('"+this.defValEncodedForJS+"','"+Crm.userDetails.ZGID+"','"+Crm.userDetails.USER_ID+"','{{ENTITYID}}','','{{MODULE}}','{{ENTITYNAME}}')\"><i class='callIcon'></i><span id='calllabel1'>"+I18n.getMsg("Call")+"</span></a></span>";else if(Crm.userDetails.ZPBENABLED){e+="<span class='phoneRtl cd_style_inherit' style='min-width:100%'><zpb-phone number='"+this.defValString+"' module='{{MODULE}}' recordid='{{ENTITYID}}' callbackparamfn=asyncFn(crmCallsNew.getClick2CallPromise,'{{ENTITYID}}','{{MODULE}}','{{ENTITYNAME}}')>"+this.defValString+"</zpb-phone></span>"}else e+="<span onmouseover='editmouseover(this, \"phone\");' onmouseout='editmouseout(this, \"phone\");' class='phoneRtl cd_style_inherit' style='min-width:100%'>"+this.defValString+"<a style='visibility:hidden;' class='ico-call3 phoneRtl cd_style_inherit' title='"+I18n.getMsg("crm.phoneNo.Link.Title")+"' href='skype:"+this.defValEncodedForJS+"?call' onclick='sE();'></a></span>";return e+="{{else}}<span onmouseover='editmouseover(this, \"phone\");' onmouseout='editmouseout(this, \"phone\");' class='phoneRtl cd_style_inherit' style='min-width:100%'>"+this.defValString+"</span>{{/if}}{{/canvasEmptyCheck}}"}return"{{#canvasEmptyCheck this '"+this.fieldId+"'}}<span onmouseover='editmouseover(this, \"phone\");' onmouseout='editmouseout(this, \"phone\");' class='phoneRtl cd_style_inherit' style='min-width:100%'>"+this.defValString+"</span>{{/canvasEmptyCheck}}"},CrmField.prototype.handleEmailField=function(){var e="";return this.fromGallery||(e+='href="mailto:'+this.defValString+'" '),"{{#canvasEmptyCheck this '"+this.fieldId+"'}}<a class='cd_style_inherit'"+e+">"+this.defValString+"</a>{{/canvasEmptyCheck}}"},CrmField.prototype.handleWebsiteField=function(){var e='href ="'+this.getEncodedKey(this.fieldId+"_href",1)+'"';return"{{#canvasEmptyCheck this '"+this.fieldId+'\'}}<a class=\'cd_style_inherit\' data-cid="dummy" class="cd_style_inherit" '+e+' target="_blank">'+this.defValString+"</a>{{/canvasEmptyCheck}}"},CrmField.prototype.handleTwitterField=function(){var e=RebrandLinkUtil.getProperty("TW_URL");return"{{#canvasEmptyCheck this '"+this.fieldId+"'}}<a class='cd_style_inherit link' data-cid='dummy' href='"+e+"/"+this.defValEncodedForURL+"' target='_blank' >"+this.defValString+"</a>{{/canvasEmptyCheck}}"},Handlebars.registerHelper("processTags",(function(e,t){return e=""==e?[]:e,crmListView.displayTags(e,t,"p0")})),Handlebars.registerHelper("split_color",(function(e){return CrmTags.gettagname(e,"tagcolor")})),Handlebars.registerHelper("color_number",(function(e){var t=CrmTags.gettagname(e,"tagcolor");return CrmTags.color_number(t)})),Handlebars.registerHelper("split_name",(function(e){return CrmTags.gettagname(e,"tagname")})),CrmField.prototype.handleTagFields=function(){return Customization.isBuilder||customViewObject.fluidWidth?"<ul class='listview_taglists p0 m0 dIB'>{{#each "+this.fieldId+"_defaultvalue}}<li class='tagElementList f14 bR2 dIB bdr1px cxTagBgSpan cxTagCol{{color_number this}}' style='background-color:{{split_color this}}'> {{split_name this}}</li>{{/each}}</ul>":"{{{processTags "+this.fieldId+"_defaultvalue "+this.fieldMetaJson.ui.position.width+"}}}"},CrmField.prototype.handleDateTimeFields=function(){return"{{#canvasEmptyCheck this '"+this.fieldId+"'}}<span class='cd_style_inherit'>"+this.defValString+"</span>{{/canvasEmptyCheck}}"},CrmField.prototype.handleBooleanFields=function(){return" {{#ifEquals "+this.defKey+' "true"}}<img src="'+Search.spacerImg+'" class="yes"/>{{else}}<img src="'+Search.spacerImg+'" class="no-new" width="9" height="9"/>{{/ifEquals}}'},CrmField.prototype.handleFormulaFields=function(){return"boolean"===this.fieldMetaJson.RETURNTYPE?this.handleBooleanFields():"datetime"===this.fieldMetaJson.RETURNTYPE?this.handleDateTimeFields():this.handleTextField()},CrmField.prototype.handleImageFields=function(){return'{{#if hasZiaVisionApproval}}<img onerror="emptyImgRemove(this);" id="img_{{ENTITYID}}" lt-prop-title="{{getVisionTitle approveStatus}}" src="{{getVisionImgSrc approveStatus}}" class="cd_people_image h100p w100p"/>{{else}}<img onerror="emptyImgRemove(this);" id="img_{{ENTITYID}}" data-cvsrc="'+Crm.getCrmBasePath()+'/EntityImageAttach.do?action_module={{MODULE}}&entityId={{ENTITYID}}&actionName=readImage&encfileId=" data-fileid="'+this.defValString+'" class="cd_people_image entityImg"/>{{/if}}'},CrmField.prototype.handleOwnerPhoto=function(){return"<img onerror='emptyImgRemove(this);' data-cvsrc='"+Crm.getCrmBasePath()+"/EntityImageAttach.do?action_module=Users&entityId={{"+this.fieldId+"_USERID}}&actionName=readImage&fileid=' data-fileid='{{"+this.fieldId+"_USERID}}' class='cd_people_image'/>"},CrmField.prototype.handlePickListField=function(){if(this.fieldMetaJson.colorcode_enabled){var e={enable_colour_code:!0,pick_list_values:this.fieldMetaJson.picklistmap};return"{{#ifNotEquals "+this.defKey+' ""}}<span class="colorAppliedPicklist" data-zcqa="colorcode_value_{{ENTITYID}}_'+this.fieldId+'" style="{{getColorCodeStyleForPickList this \''+this.fieldId+"' '"+$ESAPI.encoder().encodeForHTML(JSON.stringify(e))+"'}}\">{{#unless "+this.fieldId+"_skipencoding}}"+this.defValString+"{{else}}{{{"+this.defKey+"}}}{{/unless}}</span>{{/ifNotEquals}}"}return"{{#unless "+this.fieldId+"_skipencoding}}"+this.defValString+"{{else}}{{{"+this.defKey+"}}}{{/unless}}"},Handlebars.registerHelper("getColorCodeStyleForPickList",(function(e,t,a){var r=store.peekRecord("field",t);if(r&&!0===r.enable_colour_code&&a)return getPicklistStyleObj(e[t+"_defaultvalue"],r.pick_list_values)})),CrmField.prototype.getContext=function(){return this.context},CrmField.prototype.setContext=function(e){this.context=e},CrmField.getDataType=function(e){var t="";switch(e){case 32:case 98:t="integer";break;case 24:case 202:t="date";break;case 300:case 301:t="boolean";break;case 34:t="percent";break;case 38:case 40:case 343:t="double";break;case 52:case 41:case 208:case 207:t="bigint";break;case 111:t="autonumber";break;case 21:t="website";break;case 1:case 11:case 22:case 27:case 50:case 127:case 35:case 37:case 51:case 123:case 1234:case 99:case 999:case 31:case 103:case 62:case 19:case 17:case 1e3:t="text";break;case 77:case 36:case 143:case 144:case 145:t="currency";break;case 33:t="phone";break;case 25:t="email";break;case 2:case 26:case 39:t="picklist";break;case 786:case 333:case 30:case 14:case 200:t="datetime";break;case 4:case 5:case 6:case 7:case 9:case 10:case 12:case 13:case 15:case 55:case 135:case 133:t="lookup";break;case 8:t="ownerlookup";break;case 100:case 18:t="multiselectpicklist";break;case 110:case 3:t="textarea";break;case 116:t="formula";break;case 221:t="userlookup";break;case 132:t="multi_module_lookup"}return t};var crmLookupAutoComplete={searchText:"",searchModule:"",fldName:"",openpopupclick:!1,searchResult:[],scrollEnd:!1,scrollPageIndex:0,listcount:0,searchModuleBCFields:[],fetchedAllItems:!1,gotResult:!1,filterConfigured:!1,currenctISOCode:"",matchingResultsFound:!1,initAutoCompletePlugin:function(e,t,a){var r=!0,i=0;if(a&&!1===a.scrollFocus&&(r=!1),"searchLookup"===t&&(i=3),0==$("#lookFieldSrcWrap").length){$("body").append('<div id="lookFieldSrcWrap" class="lookFieldSrcWrap vh dNImp" ><div id="lookupFieldULWrap" class="lookupFieldULWrap" ><div id="lookupPerfectScroll" onclick="sE(event)"></div></div><div id="lookupFieldAddNew"  class="lookupFieldAddNew p10 whiteBg zi29 pR bT cP"><span class="link1 pL10 dIB">+ new Button</span></div></div>')}e=$(e);var o="";e.autocomplete({minLength:i,delay:500,source:function(a,r){crmLookupAutoComplete.scrollPageIndex=1,crmLookupAutoComplete.scrollEnd=!1;var i=$("[id='"+e.attr("id")+"_img']");"createPageLookup"===t&&i.data()&&(Crm.moduleName=i.data().module);var o,s,n=$("select[id='"+e.attr("id")+"_label_select']");if(n[0]||(n=$("select[id='"+e.attr("id")+"_select']")),n[0]?o=n.val():(o=e.data("lookupModule"),e[0]&&e[0].id&&(s=e[0].id)),null==o&&(o=e.attr("data-lookup-module")),void 0!==e.data("searchModule")&&(o=e.data("searchModule")),o&&(!crmCommonModule.serviceLookupDisabled||1!=crmCommonModule.serviceLookupDisabled||!o||"Services"!=o)){var l=$("#portalPreview");if(!(Crm.userDetails.CLIENT_ACCOUNT&&Crm.userDetails.moduleVsCriteriaLookup[e[0].id.split("_")[1]]&&-1!==Crm.userDetails.moduleVsCriteriaLookup[e[0].id.split("_")[1]].toString().indexOf($(e[0]).attr("data-fieldid"))||1===l.length)){var d=a.term.trim();d||e.data("id","");var c=!1;if(crmLookupAutoComplete.searchModule===o&&crmLookupAutoComplete.gotResult)if(crmLookupAutoComplete.searchText===d)0===crmLookupAutoComplete.searchResult.length?(crmLookupAutoComplete.matchingResultsFound=!1,r(crmLookupAutoComplete.getEmptyItem(d,e.attr("id")))):(crmLookupAutoComplete.matchingResultsFound=!0,r(crmLookupAutoComplete.searchResult)),c=!0;else if(0===d.indexOf(crmLookupAutoComplete.searchText)&&crmLookupAutoComplete.fetchedAllItems){var u,m=Crm.isInventoryModule(Crm.moduleName)&&Crm.isLineItemSubFormModule(e.data().subformdisplaylabel)&&"Products"===o&&Crm.userDetails.isLineItemSubformMvmtDone&&e.attr("id").indexOf("PRODUCTID")>-1,p=$.ui.autocomplete.escapeRegex(d),h=new RegExp("^"+p,"i"),f=new RegExp(" "+p,"i");if(m){var v="";d.split(" ").forEach((function(e){v=v+"(?=.*"+$.ui.autocomplete.escapeRegex(e)+")"}));var g=new RegExp(v,"i");u=$.grep(crmLookupAutoComplete.searchResult,(function(e){var t=e.value;return e.productDetails&&e.productDetails["Product Code"]&&(t=e.value+" "+e.productDetails["Product Code"]),h.test(t)||f.test(t)||g.test(t)}))}else u=$.grep(crmLookupAutoComplete.searchResult,(function(e){return h.test(e.value)||f.test(e.value)}));0===u.length?(crmLookupAutoComplete.matchingResultsFound=!1,r(crmLookupAutoComplete.getEmptyItem(d,e.attr("id")))):(crmLookupAutoComplete.matchingResultsFound=!0,r(u)),c=!0}if(!c){if(crmLookupAutoComplete.fetchedAllItems=!1,crmLookupAutoComplete.listcount=0,crmLookupAutoComplete.searchModule=o,crmLookupAutoComplete.fldName=s,crmLookupAutoComplete.searchText=a.term.trim(),crmLookupAutoComplete.searchResult=[],crmLookupAutoComplete.gotResult=!1,!e.attr("disabled"))$("img[id='"+e.attr("id")+"_loadimg']").addClass("vVIm");crmLookupAutoComplete.searchForLookupValue(1,r,e.attr("id"),void 0,void 0,void 0,void 0,e)}}}},appendTo:"#lookupFieldULWrap",open:function(){var a=$("#VRAjaxEdit").is(":visible"),i=renderingUtils.windowHeight,s=$(".textField.ui-autocomplete-input.ui-autocomplete-loading"),n=$("#lookFieldSrcWrap");o=e._form()?e._form().attr("name"):"";var l,d=e.autocomplete("widget").find("li[data-value='001']"),c=$("#socAddToCrmPop"),u=$(this),m=$(document).scrollTop(),p=$(".accountCreateWarn").is(":visible"),h=u.closest(".subFrmTablWrapper").length;d[0]&&(l=d.data("ui-autocomplete-item").Id),n.removeClass("dNImp");var f=$("#lookupFieldAddNew");"searchLookup"===t&&f.addClass("dN"),"createPageLookup"===t&&"2"!==l&&f.removeClass("dN");var v,g=u.autocomplete("widget"),C=e.width(),b=e.parent(),y=b.outerHeight(),w=parseFloat(b.offset().top+y),I=parseFloat(e.offset().left),R=n.outerWidth(),T=renderingUtils.windowWidth-(I+C),_={},E=$("html,body"),S=$("html"),L=$("body"),D=0,k=S.scrollTop(),P=L.scrollTop();k>P?(D=k,v=S):P>k?(D=P,v=L):v=E;var A=L.height(),O=$("#wms-chatwindowcontainer").height();O||(O=0);var M=$(document).height(),F=$(window).scrollTop(),x="auto",N=e.closest(".ppTop");N.length||(N=e.closest(".zcrm-modal")),N.length>0&&(x=parseInt(N.css("z-index"))+1),(c.length>0&&!$("#searchCreateDiv").is(":visible")||$("#qCreate").hasClass("appointment_calendar"))&&n.addClass("zI100Imp"),g.css("width",C),I=h?T+20>R?parseFloat(e.offset().left):I-R/2:parseFloat(e.offset().left),_.width=C,_.left=I,_.top=w,n.css("z-index",x),n.removeClass("vh");var B=$("#lookupFieldAddNew .link1");f=$("#lookupFieldAddNew");if(crmTab.isZBCustomModule(crmLookupAutoComplete.searchModule))f.addClass("dN");else{f.attr("onmousedown","crmLookupAutoComplete.openSearchCreatePopUp('"+e.attr("id")+"','"+t+"')"),B.text("+ "+I18n.getMsg("crm.module.new",I18n.getMsg(moduleRecordMapping[crmLookupAutoComplete.searchModule]?moduleRecordMapping[crmLookupAutoComplete.searchModule].singular_label:"Record")));var U=$("#dvinner");f.removeClass("dN");var j=e.attr("id");("createPageLookup"!==t||crmLookupAutoComplete.isInventoryModule(crmLookupAutoComplete.searchModule)||"2"===l||"Crm_Services_JOBSHEETLAYOUT"===j||"Crm_Appointments_SERVICEID"===j||a)&&f.addClass("dN")}g.addClass("lookupFieldULlist");var H=n.outerHeight(),V=s[0].getBoundingClientRect().top+s.parent().outerHeight(),z=n.outerHeight(),W=i-V;if(w+H>A-O&&"viewentityform"!=o)$(".topband_tb").addClass("mT130"),v.animate({scrollTop:M});else if(renderingUtils.windowHeight<w+H-(F-28)&&"viewentityform"!==o)r?v.animate({scrollTop:H-(i-V)+D}):renderingUtils.windowHeight-(w-m)>H||H>w-m?_.top=w:_.top=w-H-y;else if("viewentityform"==o)if(W<=z){n.addClass("vH");var q=U.scrollTop()+(z-W)+20;U.animate({scrollTop:q},(function(){var e=parseFloat(b.offset().top+b.outerHeight());n.css("top",e).removeClass("vH")}))}else n.css("top",w).removeClass("vH");"viewentityform"!=o?($("#createEditCallPopup").addClass("oHImp"),n.removeClass("vh")):U.addClass("oHImp"),L.addClass("oH");var J=$("#searchCreatePopup .popup-model-content");$("#searchCreatePopup").is(":visible")?J.addClass("oHImp"):J.removeClass("oHImp"),"searchLookup"!==t||crmLookupAutoComplete.matchingResultsFound||e.autocomplete("instance").options.close(),n.css({top:_.top,width:_.width,left:_.left}),$("#appointmentCreate").is(":visible")&&$("#secContent_Appointment_Information").addClass("oHImp"),p||$(".lookupFieldULWrap").removeClass("accountCreateNote");u.data();n.removeClass("zI300Imp")},select:function(a,r){if("001"!=r.item.seId){var i=$(this);i.val(r.item.value);var s=i.data(),n=s.id,l=r.item.seId;i.data("id",l);var d=i.data("dependfield"),c=e.parent(),u="PRODUCTID"===s.colname&&Crm.isLineItemSubFormModule(s.subformdisplaylabel)?c.find("textarea"):c.find("input");if(d&&n!=l){var m=s.fieldid;ProcessFlow.getDuringTransitionDependentFields(l,m)}if(("searchCreateLookup"==t||"leadConvertLookup"==t)&&c&&u&&u.length>=2){var p=u[1];$(p).attr("value",r.item.seId)}var h=e.data().colname;if("createPageLookup"==t&&null!=h&&h.indexOf("CF")<0)if("Accounts"==crmLookupAutoComplete.searchModule&&"PARENTACCOUNTID"!=h){var f=r.item.addressInfo;Crm.fillAddressinfo(Crm.moduleName,JSON.stringify(f))}else if(crmLookupAutoComplete.searchModule===crmModuleConstants.Contacts){var v=e.attr("id").replace(h,"ACCOUNTID");v=$("#"+v);var g=!1;if(e.attr("id").startsWith("Crm_Tasks_")||e.attr("id").startsWith("Crm_Calls_")){g=!0;var C=e.attr("id").replace(h,"SEID");v=$("#"+C)}if(v&&v[0]&&(""===v.val()||""===v.data("id"))){if(g){var b=e.attr("id").replace(h,"SEID_label_select");(b=$("#"+b))[0]||(b=$("#"+e.attr("id").replace(h,"SEID_select"))),b.val("Accounts"),b.change()}var y=crmLookupAutoComplete.searchModuleBCFields[r.item.LAYOUTID][2],w=r.item[y.FIELDID],I=r.item.refInfo1;"ACCOUNTNAME"!=y.COLUMNNAME&&(I=""),I&&(v.val(unescape(w)).data("id",I),$("#multipleFieldsEditPop").is(":visible")&&v.data("dependfield")&&ProcessFlow.getDuringTransitionDependentFields(I,v.data("fieldid")))}if(v&&v[0]&&v.data()&&v.attr({"data-selectedlookupvalue":v.val(),"data-selectedid":v.data().id}),e.attr("id").startsWith("Crm_Cases_")){var R=r.item.refInfo2,T=r.item.refInfo3,_=$("#Crm_Cases_PHONE"),E=$("#Crm_Cases_EMAIL");"null"!==R&&_.length>0&&""===_.val()&&_.val(R),"null"!==T&&E.length>0&&""===E.val()&&E.val(T)}f=r.item.addressInfo;Crm.fillAddressinfo(Crm.moduleName,JSON.stringify(f))}else if("Products"===crmLookupAutoComplete.searchModule&&"PRODUCTDETAILS"===h){var S=r.item.productDetails;(j={}).Product_Name=S["Product Name"],j.id=l,j.Unit_Price=S["Unit Price"],j.Qty_in_Stock=S["Qty in Stock"],j.Qty_Ordered=S["Qty Ordered"],j.Product_Code=S["Product Code"],j.Taxable=S.Taxable;var L=S.Tax;if(""!=L&&null!=L&&"null"!=L){var D={};if(Crm.userDetails.TAX_MIGRATION_COMPLETED)D=JSON.parse(L);else for(var k=L.split(";"),P=JSON.parse(productDetails.allTaxes),A=k.length,O=0;O<A;O++){var M=k[O],F=P[M];D[M]=F}j.TaxDetails=D}j.Tax=S.hdnPrdSortedTaxs?S.hdnPrdSortedTaxs:[],productDetails.setValuesForAddedRowNew(s.rownumber,j)}else if("SalesOrders"===Crm.moduleName&&"Quotes"===crmLookupAutoComplete.searchModule||"Invoices"===Crm.moduleName&&("Quotes"===crmLookupAutoComplete.searchModule||"SalesOrders"===crmLookupAutoComplete.searchModule)){var x=i.attr("id");Crm.fillFormObject(r.item.value,l,crmLookupAutoComplete.searchModule,null,Crm.moduleName,x,$("#layoutDetails").val(),!0)}var N=r.item.refFieldsInfo,B=!!s.subformdisplaylabel,U=Crm.isLineItemSubFormModule(s.subformdisplaylabel);if(U&&Crm.userDetails.isLineItemSubformMvmtDone&&e.attr("id").indexOf("PRODUCTID")>-1){S=r.item.productDetails;var j,H=crmLookupAutoComplete.searchModuleBCFields[r.item.LAYOUTID];(j={}).Product_Name=S["Product Name"],j.id=l;for(var V,z=H.length,W=0;W<z;W++)"Qty in Stock"===H[W].FIELDLABEL&&(j.Qty_in_Stock=S["Qty in Stock"]),"Quantity in Stock"===H[W].FIELDLABEL&&(V=H[W].FIELDID);S["Qty in Stock"]&&S["Qty in Stock"].toString()===Search.reverseFormatNumber(r.item[V])&&(j.isNumberSeparatorEnabledForQInS=!0),j.Unit_Price=S["Unit Price"],j.Qty_Ordered=S["Qty Ordered"],j.Product_Code=S["Product Code"],j.Taxable=void 0!==S.Taxable&&0!==S.Taxable.length&&JSON.parse(S.Taxable),j.Tax=Crm.getPrdTaxDetails(S.Tax),j.LAYOUTID=r.item.LAYOUTID,e.attr("prdDetails",JSON.stringify(j)),S["Product Code"]&&""!==S["Product Code"]&&e.data("lineitemprodcode")?i.val(r.item.value.replace(/(\r\n|\n|\r)/gm," ")+" ("+S["Product Code"]+")"):i.val(r.item.value.replace(/(\r\n|\n|\r)/gm," ")),i.css({height:"18px"}),i.css({height:i[0].scrollHeight-8})}if(N&&(r.item.parentFieldsColumnName||B)){var q=$("#socAddToCrmPop");if("crm.tab.approvals.index"===Lyte.Router.getRouteInstance().transition.target||q.is(":visible"))Crm.setRefFieldValues(e,r.item.seId,N||{});else{var J,Y=$("#createEntityForm");Y.is(":visible")||(J=Lyte.Router.getRouteInstance("crm.tab.module").getDynamicParam());var G=$("#multipleFieldsEditPop"),K=$("#convertLeadForm");Y.is(":visible")||G.is(":visible")||K.is(":visible")||"view"!==window[J].currentStatus?(Y.is(":visible")||"create"===window[J].currentStatus||"clone"===window[J].currentStatus||"edit"===window[J].currentStatus||G.is(":visible")&&"view"===window[J].currentStatus||K.is(":visible"))&&(N=N||{},Crm.setRefFieldValues(e,r.item.seId,N),U&&e.attr("id").indexOf("PRODUCTID")>-1&&Crm.handleProductLineItemUpdate(e)):fieldOfLookup.participatingfieldsvalidationrule(r,h)}}if("convertlead"!=o&&"MassConvertForm"!=o&&"WFConvert"!=o||$("#"+this.parentElement.id).addClass("show-close"),"Services"===crmLookupAutoComplete.searchModule&&($(this).trigger("executeFormRules"),l&&networkUtils.lyteInitiateRequest("/crm/v2.1/Services__s/"+l,"GET").then((function(e){e&&e.data&&e.data.length&&(crmCommonModule.serviceModuleLooked=!0,setTimeout((function(){var t=document.getElementById("Crm_Appointments_SMOWNERID");if(t&&t.hasChildNodes()>0){t.component.setData("dataId",""),t.component.setData("userRecord",{}),CSU.setAppointmentRelatedData(e.data[0]),CSU.setMemberDataForAppointment();var a=$("#Crm_Appointments_APPOINTMENTDATEANDTIME");CSU.checkServiceAvailabilityTime(a)}}),400))}))),("Contacts"===crmLookupAutoComplete.searchModule||"Accounts"===crmLookupAutoComplete.searchModule||crmLookupAutoComplete.searchModule)&&"#appointmentCreationInnerDiv".length>0&&"Crm_Appointments_SEID_RELATEDTO"==this.id)if(crmCommonModule.isAppointmentForModuleLooked=!0,"Contacts"===crmLookupAutoComplete.searchModule||"Accounts"===crmLookupAutoComplete.searchModule)CSU.setAddressValueForAppointment(r.item.addressInfo);else if(crmLookupAutoComplete.searchModule.startsWith("CustomModule")){var Q=$("#Crm_Appointments_SERVICEID").val(),Z=$("#Crm_Appointments_APPOINTMENTNAME"),X=$("#Crm_Appointments_APPOINTMENTFOR_RELATEDTO").val();""!=Q&&"edit"!=Events.currentStatus&&Z.data("autopopulate")&&Z.val(Q+" - "+X)}if("Contacts"===Crm.moduleName&&"ACCOUNTID"===s.colname){var ee=$("#Contacts_fldRow_REPORTINGTOCONTACTID"),te=$("#Crm_Contacts_REPORTINGTOCONTACTID");te.prop("disabled",!1),te.autocomplete("enable"),ee.removeClass("noclick"),ee.unbind("mouseover"),ee.unbind("mouseout"),ee.removeAttr("onmouseenter onmouseleave")}i.attr({"data-selectedlookupvalue":i.val(),"data-selectedid":l})}return!1},close:function(){var e=$("#createEditCallPopup"),t=e.is(":visible");$("body").removeClass("oH"),e.removeClass("oHImp");var a=$("#searchCreatePopup .popup-model-content");a.is(":visible")&&a.removeClass("oH"),"viewentityform"==o&&$("#dvinner").removeClass("oHImp"),$(".oHImp").removeClass("oHImp"),crmLookupAutoComplete.searchText="",crmLookupAutoComplete.searchResult=[],crmLookupAutoComplete.searchModule="",t||(crmLookupAutoComplete.searchModuleBCFields=[]);var r=$("#lookFieldSrcWrap");r.removeClass("zI100Imp").addClass("dNImp vh"),r.css("z-index","inherit"),$(".topband_tb").removeClass("mT130")}}),thirdPartyUtils.bindPerfectScroll("#lookupPerfectScroll",{wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!1}),e.on("focus",(function(){crmLookupAutoComplete.scrollPageIndex=1}));var s=e.data("ui-autocomplete");s._renderMenu=function(e,t){$("#lookFieldSrcWrap").show(),$(e).unbind("scroll"),crmLookupAutoComplete.scrollMenu(e,t,s)},s._renderItem=function(a,r){if("searchLookup"!==t||"001"!==r.seId){var i,o='aria-selected="false"';r.seId==e.data("id")&&(o='aria-selected="true"');var s=Lyte.Router.getRouteInstance("crm.tab.module")?Lyte.Router.getRouteInstance("crm.tab.module").getDynamicParam():void 0;$("#multipleFieldsEditPop").is(":visible")&&(s=$("#multipleFieldsEditPop").find("li.sel").data("mod")),i=crmLookupAutoComplete.isInventoryModule(s)&&r.productDetails&&r.productDetails["Product Code"]&&e.data("lineitemprodcode")?r.value+" ("+r.productDetails["Product Code"]+")":r.value;var n='<a class="ui-corner-all lookupTxtOverflow" style="padding: 7px 20px 10px 27px !important;" '+o+"><span class='lookupTxtVal' onmouseenter='if(!$(this).hasClass(\"lookupDummyClass\")){crmLookupAutoComplete.titleToolTipForEllipsis(this,\""+$ESAPI.encoder().encodeForJavaScript(i)+"\");}' >"+$ESAPI.encoder().encodeForHTML(i)+" </span>",l="";"001"!=r.seId&&(l='<i class="icon_roundinfo infoIcoLookupAuto cP fR vh" onmouseenter="crmLookupAutoComplete.showBCDetails(\''+$ESAPI.encoder().encodeForJavaScript(JSON.stringify(r))+'\');" onmouseout="crmui.hideTooltip(); zctt.hidett();"></i>');var d=$("<li>"),c=d.data("ui-autocomplete-item",r).attr("data-value",r.seId).attr("class","lookupSearchLi").append(n+l+" </a>");try{var u=Lyte.Router.getRouteInstance().parent.parent.getDynamicParam();null!==u&&"Activities"===u&&d.attr("onclick","detailView.getEntityTaskSync('"+r.seId+"','"+crmLookupAutoComplete.searchModule+"')")}catch(e){murphy.error(e)}return $(".accountCreateWarn").remove(),c.appendTo(a)}$("#lookFieldSrcWrap").hide()}},getLoadingDiv:function(e){if(0==e.find("li[data-value='001']").length){var t='<a class="ui-corner-all lookupTxtOverflow" style="padding: 0px 20px 0px 20px !important;"><img style=\'margin-bottom: 6px;display: inline-block;\' src=\''+networkUtils.getImageUrl("loading_599c9b1_.gif",ResourceConstants.CRM)+"'></a>";$("<li>").attr("data-value","001").attr("class","lookupSearchLi lookupSvgLoader").append(t).appendTo(e)}thirdPartyUtils.bindPerfectScrollUpdate(e)},removeLoadingDiv:function(e){var t=e.find("li[data-value='001']");t.length>0&&(t.remove(),thirdPartyUtils.bindPerfectScrollUpdate(e))},titleToolTipForEllipsis:function(e,t){e.scrollWidth>e.clientWidth&&(e.title=t),$(e).addClass("lookupDummyClass")},getEmptyItem:function(e,t){var a=Lyte.Router.getRouteInstance()?Lyte.Router.getRouteInstance().parent.getQueryParams().sub_module:"";a=void 0===a&&Crm.isActivitySplitDone&&"Tasks"===Lyte.Router.getRouteInstance().parent.getDynamicParam()?"Tasks":a;var r=[];return 0===e.length?r.push({seId:"001",Id:"1",value:I18n.getMsg("crm.module.empty.message",I18n.getMsg(moduleRecordMapping[crmLookupAutoComplete.searchModule]?moduleRecordMapping[crmLookupAutoComplete.searchModule].singular_label:"Record"))}):r.push({seId:"001",Id:"3",value:I18n.getMsg("crm.template.listview.search.no.results")}),r},loadItemsToAutoCompleteWidget:function(e,t,a,r){var i=[];i=t.slice(a*crmLookupAutoComplete.scrollPageIndex,a*crmLookupAutoComplete.scrollPageIndex+a),++crmLookupAutoComplete.scrollPageIndex,i.length<a&&(crmLookupAutoComplete.fetchedAllItems=!0,crmLookupAutoComplete.scrollEnd=!0),i.each((function(t){null!=t&&(r._renderItem(e,t),thirdPartyUtils.bindPerfectScrollUpdate(e))})),r.menu.refresh(),e.show(),e.position($.extend({of:r.element},r.options.position)),e.css("top",e.position().top+8),r.options.autoFocus&&r.menu.next(new $.Event("mouseover"))},scrollMenu:function(e,t,a){var r=[];crmLookupAutoComplete.pages=Math.ceil(crmLookupAutoComplete.listcount/10),r=t.slice(0,10),(e=$(e)).scrollTop(0),crmLookupAutoComplete.pages>1?e.scroll((function(){var r=e;if(crmLookupAutoComplete.isScrollbarBottom(r)){if(crmLookupAutoComplete.scrollEnd)return null;if(crmLookupAutoComplete.scrollPageIndex>=crmLookupAutoComplete.pages){if(crmLookupAutoComplete.searchText.lenght>1)return crmLookupAutoComplete.listcount<1e3&&(crmLookupAutoComplete.fetchedAllItems=!0),null;var i=crmLookupAutoComplete.listcount+1;return crmLookupAutoComplete.getLoadingDiv(r),void crmLookupAutoComplete.searchForLookupValue(i,null,a.element.attr("id"),r,t,10,a,a.element)}crmLookupAutoComplete.loadItemsToAutoCompleteWidget(r,t,10,a)}})):(crmLookupAutoComplete.fetchedAllItems=!0,crmLookupAutoComplete.scrollEnd=!0),renderingUtils.scrollPrevent(e),r.each((function(t){null!=t&&a._renderItem(e,t)}))},isScrollbarBottom:function(e){var t=Math.round(e.outerHeight()),a=e[0].scrollHeight-9;return e.scrollTop()>=a-t},showBCDetails:function(e){for(var t='<div><table class="lookupAutocomBC f11 alignleft">',a=(e=JSON.parse(e)).LAYOUTID,r=crmLookupAutoComplete.searchModuleBCFields[a],i=r.length,o=2;o<i;o++){var s=r[o],n=s.FIELDLABEL,l=s.FIELDID;if(!(l.indexOf("addressInfo")>-1||n.indexOf("_refFieldsInfo")>-1||n.indexOf("_refInfo")>-1||l.indexOf("productDetails_")>-1)){var d,c=s.UITYPE;116==c&&(d=s.RETURNTYPE);var u=e[l];if(u){if("NOTALLOWED_LAYOUTRULE"==u)continue;if(786==c||14==c||333==c){var m=new Date(u);u=Utils.getDateTimeInUserFormat(m,!0)}else if(24==c||202==c||116==c&&null!=d&&"date"==d){var p=new Date(u);u=Utils.getDateInUserDatePattern(p,!0)}else if(96==c){var h=JSON.parse(u);for(var f in u="",h)u=u+f+";";-1!=u.indexOf(";")&&(u=u.substring(0,u.lastIndexOf(";")))}else s.COLUMNNAME&&s.TABLENAME&&"SERVICEDURATION"===s.COLUMNNAME&&"CrmServiceDetails"===s.TABLENAME?u=Handlebars.helpers.setServiceDuration(u):300!=c&&301!=c&&(u=$ESAPI.encoder().encodeForHTML(u.toString()))}else u="-";t+="<tr > <td> "+$ESAPI.encoder().encodeForHTML(n)+' </td><td  style="max-width: 266px;" class="tooltipInfoEllipsis"> '+u+" </td> </tr> "}}t+="</table></div>",crmui.showTooltip({content:t,isHTML:!0,position:"center",tooltipHover:!1,classList:"mW500Imp lookupACToolTip"})},searchForLookupValue:function(e,t,a,r,i,o,s,n){var l=$("img[id='"+a+"_loadimg']"),d=$("img[id='"+a+"_img']"),c=[],u="",m="",p="",h="",f=$("input[id='"+a+"']"),v=$("#socAddToCrmPop");f.length<1&&(f=!!(n&&n.length>0)&&(Crm.isLineItemSubFormModule(n.data("subformdisplaylabel"))&&"PRODUCTID"===n.data("colname"))?n:f);if(f.length&&"Services"===f.data().lookupModule){var g=$("#serviceDurationAndPrice");g.length&&""!==f.data().uiAutocomplete.previous&&f.data().uiAutocomplete.previous!==f.val()&&g.slideUp(100,(function(){$("#serviceDurationAndPrice").remove()}))}d&&d.data()?(u=d.data("module"),void 0===(m=$("#Crm_"+u+"_CURRENCYISOCODE").val())&&(m=$("#subvalue_CURRENCYISOCODE").html())):f._form()&&(u=f._form().data("module"),m=$("#Crm_"+u+"_CURRENCYISOCODE").val()),crmLookupAutoComplete.searchText=crmLookupAutoComplete.searchText.trim(),null==m&&(m=""),crmLookupAutoComplete.currenctISOCode=m;var C=!1;if(void 0!==f.data("subformsectionlabel")&&""!==f.data("subformsectionlabel")&&(C=!0),"Contacts"===crmLookupAutoComplete.searchModule&&"Crm_Contacts_REPORTINGTOCONTACTID"===crmLookupAutoComplete.fldName){var b=$("#Crm_Contacts_ACCOUNTID");b[0]&&(p=b.data("id")),""===p&&(b=$("#mouseArea__ACCOUNTID"))&&(p=b.data(I).params.defaultid),"edit"===window[crmLookupAutoComplete.searchModule].currentStatus&&(h=window[crmLookupAutoComplete.searchModule].entityId),""===h&&window.businessCardJson&&(h=window.businessCardJson.entityid)}var y=$("#multipleFieldsEditPop").is(":visible");if(Crm.userDetails.isLookupAdvancedSearchEnabled)if(null!=u&&null!=window[u].createEditJson)var w=null!=window[u].createEditJson.layout_jsonarrayObj?window[u].createEditJson.layout_jsonarrayObj.sysLayoutId:y&&window[u].createEditJson.LayoutId?window[u].createEditJson.LayoutId:returnJson.layout_jsonarrayObj.sysLayoutId;else w=$("#layoutdetails").val();var I={searchmodule:crmLookupAutoComplete.searchModule,fldValue:crmLookupAutoComplete.searchText,isAutoComplete:!0,offset:e,currencyISOCode:m,productId:p,fldName:crmLookupAutoComplete.fldName,entityId:h,fieldId:f.data("fieldid"),parentLayoutId:w,isSubFormField:C};if("PhoneNumbers"!==crmLookupAutoComplete.searchModule){if(crmLookupAutoComplete.searchModule!==crmModuleConstants.Accounts||u!==crmModuleConstants.Accounts||v.is(":visible")||"edit"!==window[u].currentStatus&&"view"!==window[u].currentStatus||(I.seId=window[u].entityId),I.parentModule=u,u&&window[u]&&window[u].createEditJson)window[u].createEditJson.layout_jsonarrayObj?R=window[u].createEditJson.layout_jsonarrayObj.sysLayoutId:returnJson.layout_jsonarrayObj&&(R=returnJson.layout_jsonarrayObj.sysLayoutId),"view"==window[u].currentStatus&&returnJson.layout_jsonarrayObj&&(R=returnJson.layout_jsonarrayObj.sysLayoutId);else var R=$("#layoutdetails").val();R&&"null"!=R&&"undefined"!=R&&(I.layoutId=R);var T,_=$("#createEntityForm");if(_.is(":visible"))(T=_.find("[name=layoutId]").val())&&(I.layoutId=T);if($("#convertLeadForm").is(":visible"))(T=Crm.VR.potLayoutId)&&(I.layoutId=T);(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/Search.do?",data:I,type:"POST",success:function(e){crmLookupAutoComplete.searchModuleBCFields=e.Field,c=e.Value,crmLookupAutoComplete.filterConfigured=e.filterConfigured,c&&(crmLookupAutoComplete.searchResult=crmLookupAutoComplete.searchResult.concat(c),crmLookupAutoComplete.listcount=crmLookupAutoComplete.listcount+c.length,crmLookupAutoComplete.matchingResultsFound=crmLookupAutoComplete.listcount>0),null!=t?(l.removeClass("vVIm"),0===crmLookupAutoComplete.listcount?t(crmLookupAutoComplete.getEmptyItem(crmLookupAutoComplete.searchText,a)):t(c)):(crmLookupAutoComplete.pages=Math.ceil(crmLookupAutoComplete.listcount/o),i.push.apply(i,c),crmLookupAutoComplete.removeLoadingDiv(r),crmLookupAutoComplete.loadItemsToAutoCompleteWidget(r,i,o,s)),l.removeClass("vVIm"),crmLookupAutoComplete.gotResult=!0},error:function(e){l.removeClass("vVIm"),e.status===crmConstants.errorStatusCode&&window.scrollTo({top:0})}})}},openSearchCreatePopUp:function(e,t,a){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var r=(e=$("[id='"+e+"']")).val(),i=crmLookupAutoComplete.searchModule;a&&(i=a);var o=e.attr("id"),s=[],n={accounts:[]};if(!crmLookupAutoComplete.isInventoryModule(i)){var l=Crm.getCrmBasePath()+"/QuickCreateAction.do?module="+encodeURIComponent(i)+"&searchmodule="+encodeURIComponent(i)+"&fldName="+encodeURIComponent(o)+"&fldId="+encodeURIComponent(o)+"&fldLabel="+encodeURIComponent(i)+"&fldValue="+encodeURIComponent(r)+"&newModel=true";""!=crmLookupAutoComplete.currenctISOCode&&(l=l+"&currencyISOCode="+crmLookupAutoComplete.currenctISOCode),"leadConvertLookup"===t&&(l=Crm.getCrmBasePath()+"/QuickCreateAction.do?targetForm=convertlead&module="+encodeURIComponent(i)+"&searchmodule="+encodeURIComponent(i)+"&fldName="+encodeURIComponent(o)+"&fldId="+encodeURIComponent(o)+"&fldLabel="+encodeURIComponent(i)+"&fldValue="+encodeURIComponent(r)+"&frmzc=false&newModel=false");var d,c=$("#"+o).data("fieldid");if(i&&window[i]&&window[i].createEditJson)window[i].createEditJson.layout_jsonarrayObj?u=window[i].createEditJson.layout_jsonarrayObj.sysLayoutId:returnJson.layout_jsonarrayObj&&(u=returnJson.layout_jsonarrayObj.sysLayoutId),"view"==window[i].currentStatus&&returnJson.layout_jsonarrayObj&&(u=returnJson.layout_jsonarrayObj.sysLayoutId);else var u=$("#layoutdetails").val();if(u&&"null"!=u&&"undefined"!=u?l+="&folLayoutId="+u:returnJson&&returnJson.relListLabelsJson&&returnJson.relListLabelsJson.module&&"view"==window[returnJson.relListLabelsJson.module].currentStatus&&(l+="&folLayoutId="+returnJson.layoutIdOfEntity),c&&"null"!=c&&"undefined"!=c&&(l+="&folLookupFieldId="+c),"Crm_Contacts_REPORTINGTOCONTACTID"===o)if(l=l+"&entityId="+window[i].entityId,"view"===window[i].currentStatus)(d=$("#subvalue_ACCOUNTID"))[0]&&null!=(m=JSON.parse(d[0].dataset.params).id)&&"null"!=m&&""!=m&&(s[0]=m,n.accounts[0]={},n.accounts[0].id=m,n.accounts[0].name=d[0].text,l=l+"&productId="+m+"&accDetails="+encodeURIComponent(JSON.stringify(n))+"&accountid="+m+"&accountname="+encodeURIComponent(d[0].text));else if((d=$("#Crm_Contacts_ACCOUNTID"))[0]){var m=d.data("id");null!=m&&"null"!=m&&""!=m&&(s[0]=m,n.accounts[0]={},n.accounts[0].id=m,n.accounts[0].name=d[0].value,l=l+"&productId="+m+"&accDetails="+encodeURIComponent(JSON.stringify(n))+"&accountid="+m+"&accountname="+encodeURIComponent(d[0].value))}$("#searchCreatePopup").addClass("fromAutoComplete"),l=Crm.getPortalURL(l),commonUtils.openCustomLookup(l,void 0,"searchCreatePopup",void 0,void 0,void 0,void 0,void 0,(function(){var e=$("#ac-recordname").children().find("input"),t=e.attr("maxlength");r.length>t&&(r=r.substring(0,t)),e.val(r)})),(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(i))&&Crm.downloadValidationRules(l,i)}}},isInventoryModule:function(e){return["Quotes","SalesOrders","PurchaseOrders","Invoices","PriceBooks"].contains(e)},openLearnMoreLink:function(){networkUtils.openUrl(RebrandLinkUtil.getProperty("ACCOUNT_LOOKUP_RESTRICT_LINK"))}};!function(){var e=Handlebars.template,t=Handlebars.templates=Handlebars.templates||{};t.ActivityReminder=e({1:function(e,t,a,r,i){var o;return' <ul class="remainderList"> <li class="dayseparation mL15 crm-font-bold"> <span class="daytext"> '+e.escapeExpression(e.lambda(null!=(o=null!=t?t[0]:t)?o.reminder:o,t))+' </span> <span class="seperator-line"></span> </li> '+(null!=(o=a.each.call(null!=t?t:{},t,{name:"each",hash:{},fn:e.program(2,i,0),inverse:e.noop,data:i}))?o:"")+' <li class="menu_sep" style="border: none"></li> </ul> '},2:function(e,t,a,r,i){var o;return" "+(null!=(o=e.invokePartial(r.singleReminder,t,{name:"singleReminder",data:i,helpers:a,partials:r,decorators:e.decorators}))?o:"")+" "},compiler:[7,">= 4.0.0"],main:function(e,t,a,r,i){var o;return(null!=(o=a.each.call(null!=t?t:{},t,{name:"each",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))?o:"")+" "},usePartial:!0,useData:!0}),t.CrmKanbanViewColumns=e({1:function(e,t,a,r,i){var o;return' <div id=\'norecordmsg\' class="p0 font15 notasks colorlightGray2 ht100per w100per"><span class="vmiddle" style="display: table-cell;">'+e.escapeExpression(e.lambda(null!=(o=null!=(o=null!=t?t.kvColumnObj:t)?o.jsonobj:o)?o.norecordmsg:o,t))+"</span></div> "},3:function(e,t,a,r,i,o,s){var n,l=e.lambda,d=e.escapeExpression,c=null!=t?t:{};return' <li  id="recordid_'+d(l(null!=t?t.ACTIVITYID:t,t))+'" class="pL5per pR5per pB0 positionRelative cursorpointer"  data-cid="kanbanviewentity" data-params=\'{"module":"'+d(l(null!=t?t.ACTIVITYTYPE:t,t))+'","fromDetailView":"true","activitytype":"'+d(l(null!=t?t.ACTIVITYTYPE:t,t))+'","id":"'+d(l(null!=t?t.ACTIVITYID:t,t))+'","view":"kanbanview","cvid":"'+d(l(null!=t?t.CVID:t,t))+'","relid":"'+d(l(null!=t?t.SEID:t,t))+'","conid":"'+d(l(null!=t?t.CONTACTID:t,t))+'","setype":"'+d(l(null!=t?t.SEMODULE:t,t))+'"'+(null!=(n=a.ifEquals.call(c,null!=t?t.isFromActivity:t,"true",{name:"ifEquals",hash:{},fn:e.program(4,i,0,o,s),inverse:e.noop,data:i}))?n:"")+" }' onclick=TaskKanbanView.getentitypopup(this) name='"+d(l(null!=t?t.columntype:t,t))+"' onmouseover='TaskKanbanView.showEditClose(\""+d(l(null!=t?t.ACTIVITYID:t,t))+"\")' onmouseout='TaskKanbanView.hideEditClose(\""+d(l(null!=t?t.ACTIVITYID:t,t))+'")\'> <div id="div'+d(l(null!=t?t.ACTIVITYID:t,t))+'" align="center" class="EditClose fontSmoothAntialiased hide"  > '+(null!=(n=a.if_nq.call(c,null!=t?t.RECORDAPPROVED:t,"2",{name:"if_nq",hash:{},fn:e.program(6,i,0,o,s),inverse:e.noop,data:i}))?n:"")+' </div> <div class="overflhidden"> '+(null!=(n=a.if_eq.call(c,null!=t?t.newCallView:t,!0,{name:"if_eq",hash:{},fn:e.program(24,i,0,o,s),inverse:e.program(26,i,0,o,s),data:i}))?n:"")+" </div> </li> "},4:function(e,t,a,r,i){return',"fromActivityListView":"true"'},6:function(e,t,a,r,i,o,s){var n,l=null!=t?t:{};return" "+(null!=(n=a.if_eq.call(l,null!=t?t.ACTIVITYTYPE:t,"Events",{name:"if_eq",hash:{},fn:e.program(7,i,0,o,s),inverse:e.program(9,i,0,o,s),data:i}))?n:"")+" "+(null!=(n=a.if_eq.call(l,null!=t?t.ACTIVITYTYPE:t,"Tasks",{name:"if_eq",hash:{},fn:e.program(18,i,0,o,s),inverse:e.noop,data:i}))?n:"")+" "},7:function(e,t,a,r,i){var o=e.lambda,s=e.escapeExpression;return' <a onclick="Crm.editEntity(undefined,this);sE(event);" class="color_313949 editMore" id="listViewEdit_'+s(o(null!=t?t.ACTIVITYID:t,t))+'" href="javascript:;" data-cid="editbtn" data-params=\'{"module":"Events","id":"'+s(o(null!=t?t.ACTIVITYID:t,t))+'","from":"detailView","calleeObj":"Crm","clickId":"editbtn"}\'>'+s(o(null!=t?t.EDIT:t,t))+"</a> "},9:function(e,t,a,r,i,o,s){var n;return" "+(null!=(n=a.if_eq.call(null!=t?t:{},null!=t?t.ACTIVITYTYPE:t,"Calls",{name:"if_eq",hash:{},fn:e.program(10,i,0,o,s),inverse:e.program(13,i,0,o,s),data:i}))?n:"")+" "},10:function(e,t,a,r,i){var o;return" "+(null!=(o=a.if_eq.call(null!=t?t:{},null!=t?t.showEditBtn:t,!0,{name:"if_eq",hash:{},fn:e.program(11,i,0),inverse:e.noop,data:i}))?o:"")+" "},11:function(e,t,a,r,i){var o=e.lambda,s=e.escapeExpression;return' <a onclick="Crm.editEntity(undefined,this);sE(event);" class="color_313949 editMore" id="listViewEdit_'+s(o(null!=t?t.ACTIVITYID:t,t))+'" href="javascript:;" data-cid="editbtn" data-params=\'{"module":"Calls","id":"'+s(o(null!=t?t.ACTIVITYID:t,t))+'","from":"detailView","calleeObj":"Crm","clickId":"editbtn"}\'>'+s(o(null!=t?t.EDIT:t,t))+"</a> "},13:function(e,t,a,r,i,o,s){var n;return" "+(null!=(n=a.if_eq.call(null!=t?t:{},null!=s[1]?s[1].isFromActivityModule:s[1],"true",{name:"if_eq",hash:{},fn:e.program(14,i,0,o,s),inverse:e.program(16,i,0,o,s),data:i}))?n:"")+" "},14:function(e,t,a,r,i){var o=e.lambda,s=e.escapeExpression;return' <link-to lt-prop-td=\'{"from":"kvlistview"}\' lt-prop-route="crm.tab.module.entity.edit" lt-prop-class="tkveditlist alignright" lt-prop-id="listViewEdit_'+s(o(null!=t?t.ACTIVITYID:t,t))+'" lt-prop-qp=\'{"sub_module":"'+s(o(null!=t?t.ACTIVITYTYPE:t,t))+'"}\' lt-prop-dp=\'["Activities","'+s(o(null!=t?t.ACTIVITYID:t,t))+'"]\' data-zcqa="editBtn" >'+s(o(null!=t?t.EDIT:t,t))+"</link-to> "},16:function(e,t,a,r,i){var o=e.lambda,s=e.escapeExpression;return' <link-to lt-prop-td=\'{"from":"kvlistview"}\' lt-prop-route="crm.tab.module.entity.edit" lt-prop-class="tkveditlist alignright" lt-prop-id="listViewEdit_'+s(o(null!=t?t.ACTIVITYID:t,t))+'" lt-prop-dp=\'["'+s(o(null!=t?t.ACTIVITYTYPE:t,t))+'","'+s(o(null!=t?t.ACTIVITYID:t,t))+'"]\' data-zcqa="editBtn" >'+s(o(null!=t?t.EDIT:t,t))+"</link-to> "},18:function(e,t,a,r,i){var o;return" "+(null!=(o=a.if_eq.call(null!=t?t:{},null!=t?t.isCloseTaskReq:t,!0,{name:"if_eq",hash:{},fn:e.program(19,i,0),inverse:e.noop,data:i}))?o:"")+" "},19:function(e,t,a,r,i){var o;return' \x3c!--span class="seperatorLine '+e.escapeExpression(e.lambda(null!=(o=null!=t?t.commonClasses:t)?o.taskCloseClass:o,t))+'">|</span--\x3e '+(null!=(o=a.if_eq.call(null!=t?t:{},null!=t?t.isFromActivityModule:t,"true",{name:"if_eq",hash:{},fn:e.program(20,i,0),inverse:e.program(22,i,0),data:i}))?o:"")+" "},20:function(e,t,a,r,i){var o,s=e.lambda,n=e.escapeExpression;return' <a class="smalledit tkvcancelLinklist mL5 mR5 '+n(s(null!=(o=null!=t?t.commonClasses:t)?o.taskCloseClass:o,t))+'" id="listViewClose_'+n(s(null!=t?t.ACTIVITYID:t,t))+'" href="javascript:;" onclick=\'javascript:closeTask("'+n(a.getCrmBasePath.call(null!=t?t:{},{name:"getCrmBasePath",hash:{},data:i}))+"/TaskKanbanView.do?action=CloseTask&taskid="+n(s(null!=t?t.ACTIVITYID:t,t))+"&id="+n(s(null!=t?t.ACTIVITYID:t,t))+"&module=Activities&iskanbanview=true\")'>"+n(s(null!=t?t.CLOSE:t,t))+"</a> "},22:function(e,t,a,r,i){var o,s=e.lambda,n=e.escapeExpression;return' <a class="smalledit tkvcancelLinklist mL5 mR5 '+n(s(null!=(o=null!=t?t.commonClasses:t)?o.taskCloseClass:o,t))+'" id="listViewClose_'+n(s(null!=t?t.ACTIVITYID:t,t))+'" href="javascript:;" onclick=\'javascript:closeTask("'+n(a.getCrmBasePath.call(null!=t?t:{},{name:"getCrmBasePath",hash:{},data:i}))+"/TaskKanbanView.do?action=CloseTask&taskid="+n(s(null!=t?t.ACTIVITYID:t,t))+"&id="+n(s(null!=t?t.ACTIVITYID:t,t))+"&module=Tasks&iskanbanview=true\")'>"+n(s(null!=t?t.CLOSE:t,t))+"</a> "},24:function(e,t,a,r,i){var o=e.lambda,s=e.escapeExpression;return' <calls-kanbancard activity-id="'+s(o(null!=t?t.ACTIVITYID:t,t))+'" call-type="'+s(o(null!=t?t.SYSREFCALLTYPE:t,t))+'" contact-name="'+s(o(null!=t?t.CONTACTNAME:t,t))+'" contact-id="'+s(o(null!=t?t.CONTACTID:t,t))+'" se-name="'+s(o(null!=t?t.ENTITYNAME:t,t))+'" se-id="'+s(o(null!=t?t.SEID:t,t))+'" se-module="'+s(o(null!=t?t.SEMODULE:t,t))+'" phone-id="'+s(o(null!=t?t.INDEXEDPHONENO:t,t))+'" phone-no="'+s(o(null!=t?t.PHONENO:t,t))+'" formatted-start-time="'+s(o(null!=t?t.CALLSTARTDATETIME:t,t))+'" status="'+s(o(null!=t?t.CALLSTATUS:t,t))+'" duration="'+s(o(null!=t?t.CALLDURATION:t,t))+'" owner-name="'+s(o(null!=t?t.USERNAME:t,t))+'" owner-id="'+s(o(null!=t?t.ACTIVITYOWNERID:t,t))+'"></calls-kanbancard> '},26:function(e,t,a,r,i,o,s){var n,l=e.lambda,d=e.escapeExpression,c=null!=t?t:{};return' <div class="pT20 pB20 tkInnerInfo dIB w100per"> <div class="dIB w100per mB4" id="kanban_'+d(l(null!=t?t.ACTIVITYID:t,t))+'"> '+(null!=(n=a.if_nq.call(c,null!=t?t.colorCode:t,"",{name:"if_nq",hash:{},fn:e.program(27,i,0,o,s),inverse:e.noop,data:i}))?n:"")+' <span class="fL kanbanviewImages mR10 '+d(l(null!=t?t.ACTIVITYTYPE:t,t))+'"><crmutil-icon icon-name="'+d(a.toLowerCase.call(c,null!=t?t.ACTIVITYTYPE:t,{name:"toLowerCase",hash:{},data:i}))+'" icon-class="zcicn-'+d(a.toLowerCase.call(c,null!=t?t.ACTIVITYTYPE:t,{name:"toLowerCase",hash:{},data:i}))+" crmBaseIcon \"></crmutil-icon></span> <span id='name' class=\"fL "+d(l(null!=(n=null!=t?t.commonClasses:t)?n.subjectClass:n,t))+' overflhidden" style="text-overflow: ellipsis;white-space:nowrap; '+d(l(null!=(n=null!=t?t.commonClasses:t)?n.subjectStyle:n,t))+'"> '+(null!=(n=a.if_eq.call(c,null!=s[1]?s[1].isFromActivityModule:s[1],"true",{name:"if_eq",hash:{},fn:e.program(29,i,0,o,s),inverse:e.program(31,i,0,o,s),data:i}))?n:"")+' <span id="Subject" title="'+d(l(null!=t?t.SUBJECT:t,t))+'">'+d(l(null!=t?t.SUBJECT:t,t))+"</span> </a> </span> "+(null!=(n=a.ifEquals.call(c,"Tasks",null!=t?t.ACTIVITYTYPE:t,{name:"ifEquals",hash:{},fn:e.program(33,i,0,o,s),inverse:e.noop,data:i}))?n:"")+" "+(null!=(n=a.if_eq.call(c,null!=t?t.RECORDAPPROVED:t,"2",{name:"if_eq",hash:{},fn:e.program(36,i,0,o,s),inverse:e.noop,data:i}))?n:"")+" "+(null!=(n=a.if_eq.call(c,null!=t?t.ACTIVITYTYPE:t,"Tasks",{name:"if_eq",hash:{},fn:e.program(38,i,0,o,s),inverse:e.program(43,i,0,o,s),data:i}))?n:"")+" </div> "+(null!=(n=a.if_nq.call(c,null!=t?t.RELATEDTITLE:t,"",{name:"if_nq",hash:{},fn:e.program(45,i,0,o,s),inverse:e.noop,data:i}))?n:"")+' <span id="relatedto" class="colorlightGray2 dIB fL  ellipsistext mW43per vmiddle"> '+(null!=(n=a.if_nq.call(c,null!=t?t.SEID:t,"null",{name:"if_nq",hash:{},fn:e.program(47,i,0,o,s),inverse:e.noop,data:i}))?n:"")+" </span> "+(null!=(n=a.if_nq.call(c,null!=t?t.SEID:t,"null",{name:"if_nq",hash:{},fn:e.program(49,i,0,o,s),inverse:e.noop,data:i}))?n:"")+' <span id="contactname" class="colorlightGray2 dIB fL ellipsistext vmiddle" style="width:40%;"> '+(null!=(n=a.if_nq.call(c,null!=t?t.CONID:t,"null",{name:"if_nq",hash:{},fn:e.program(52,i,0,o,s),inverse:e.noop,data:i}))?n:"")+" </span> "+(null!=(n=a.if_nq.call(c,null!=t?t.RELATEDTITLE:t,"",{name:"if_nq",hash:{},fn:e.program(54,i,0,o,s),inverse:e.noop,data:i}))?n:"")+' <span class="fR '+d(l(null!=(n=null!=t?t.commonClasses:t)?n.priorityDurationClass:n,t))+' tkvPriority color_616e88  ellipsistext cP crm-font-regular" title="'+d(l(null!=(n=null!=t?t.commonClasses:t)?n.priorityDurationTitle:n,t))+'">'+d(l(null!=(n=null!=t?t.commonClasses:t)?n.priorityDurationDisplay:n,t))+'</span> <div class="dIB w70per mB4 mT4"> <a href="'+d(a.getCrmBasePath.call(c,{name:"getCrmBasePath",hash:{},data:i}))+"/ShowSetup.do?tab=usersPermi&subTab=viewUser&userId="+d(l(null!=t?t.ACTIVITYOWNERID:t,t))+"\" id='taskOwner' target='_blank' class=\"color_313949 dIB fL mW42per fL ellipsistext  crm-font-regular\" title=\""+d(l(null!=t?t.USERNAME:t,t))+'">'+d(l(null!=t?t.USERNAME:t,t))+"</a> "+(null!=(n=a.if_nq.call(c,null!=(n=null!=t?t.commonClasses:t)?n.statusLocationType:n,"",{name:"if_nq",hash:{},fn:e.program(56,i,0,o,s),inverse:e.noop,data:i}))?n:"")+" <a id='Status' class=\"color_313949 dIB fL  mL7 "+d(l(null!=(n=null!=t?t.commonClasses:t)?n.statusLocationType:n,t))+" ellipsistext mW45per crm-font-regular\" title='"+d(l(null!=(n=null!=t?t.commonClasses:t)?n.statusLocationType:n,t))+"'>"+d(l(null!=(n=null!=t?t.commonClasses:t)?n.statusLocationType:n,t))+"</a> </div> "+(null!=(n=a.if_eq.call(c,null!=t?t.ispotvisibile:t,!0,{name:"if_eq",hash:{},fn:e.program(58,i,0,o,s),inverse:e.noop,data:i}))?n:"")+' <div class="clearB"></div> </div> '},27:function(e,t,a,r,i){var o=e.lambda,s=e.escapeExpression;return' <span class="activitesColor" data-zcqa="colorspankanban_'+s(o(null!=t?t.SUBJECT:t,t))+'" style="background: '+s(o(null!=t?t.colorCode:t,t))+'"></span> '},29:function(e,t,a,r,i){var o=e.escapeExpression,s=e.lambda;return' <a id=\'kvshowpopup\' class="kvsubtitle" href="'+o(a.getCrmBasePath.call(null!=t?t:{},{name:"getCrmBasePath",hash:{},data:i}))+"/tab/Activities/"+o(s(null!=t?t.ACTIVITYID:t,t))+"?sub_module="+o(s(null!=t?t.ACTIVITYTYPE:t,t))+'"> '},31:function(e,t,a,r,i){var o=e.escapeExpression,s=e.lambda;return' <a id=\'kvshowpopup\' class="kvsubtitle" href="'+o(a.getCrmBasePath.call(null!=t?t:{},{name:"getCrmBasePath",hash:{},data:i}))+"/tab/"+o(s(null!=t?t.ACTIVITYTYPE:t,t))+"/"+o(s(null!=t?t.ACTIVITYID:t,t))+'"> '},33:function(e,t,a,r,i){var o;return" "+(null!=(o=a.if.call(null!=t?t:{},null!=t?t.isProjectTask:t,{name:"if",hash:{},fn:e.program(34,i,0),inverse:e.noop,data:i}))?o:"")+" "},34:function(e,t,a,r,i){var o=null!=t?t:{},s=e.escapeExpression;return' <a style="margin-bottom: 2px; margin-left:3px;" class="task_syncIcon vam" onmouseover=\'zctt.showtt(" '+s(a.getI18n.call(o,"crm.schedules.prefix.in",{name:"getI18n",hash:{},data:i}))+" "+s(a.getI18n.call(o,"crm.integ.sync.message","crm.project.integration.title",{name:"getI18n",hash:{},data:i}))+'")\' onmouseout="zctt.hidett(1)"></a> '},36:function(e,t,a,r,i){return' <span class="dIB vam mL5"><crmutil-icon icon-name="lock-locked" icon-class="zcicn-lock-locked crmBaseIcon "></crmutil-icon></span> '},38:function(e,t,a,r,i){var o;return' <span class="fR date_act_kv colorKsmalltext  alignright positionRelative" > '+(null!=(o=a.ifCondLogic.call(null!=t?t:{},null!=t?t.ISDUEDATE:t,"=","true","&&",null!=t?t.ISCOMPLETED:t,"!=","true",{name:"ifCondLogic",hash:{},fn:e.program(39,i,0),inverse:e.program(41,i,0),data:i}))?o:"")+" </span> "},39:function(e,t,a,r,i){var o=e.lambda,s=e.escapeExpression;return' <span class="overDueCtn"> <span class="colorRed overDueTask" >'+s(o(null!=t?t.DUEDATE:t,t))+'</span> <span class="overdue hide" >'+s(o(null!=t?t.DUEDAYS:t,t))+"</span> </span> "},41:function(e,t,a,r,i){return" "+e.escapeExpression(e.lambda(null!=t?t.DUEDATE:t,t))+" "},43:function(e,t,a,r,i){var o,s=e.lambda,n=e.escapeExpression;return' <span class="fR '+n(s(null!=(o=null!=t?t.commonClasses:t)?o.dateClass:o,t))+' date_evtact_kv mT3 alignright " style="'+n(s(null!=(o=null!=t?t.commonClasses:t)?o.dateStyle:o,t))+"\" title='"+n(s(null!=(o=null!=t?t.commonClasses:t)?o.dateTitle:o,t))+"'> "+n(s(null!=(o=null!=t?t.commonClasses:t)?o.dateDisplayVal:o,t))+" </span> "},45:function(e,t,a,r,i){var o,s=e.lambda;return' <div class="overflhidden fL '+e.escapeExpression(s(null!=(o=null!=t?t.commonClasses:t)?o.relatedTitleClass:o,t))+'"  title="'+(null!=(o=s(null!=t?t.RELATEDTITLE:t,t))?o:"")+'"> '},47:function(e,t,a,r,i){var o=null!=t?t:{},s=e.escapeExpression,n=e.lambda;return" <a class=\"kt_smalltxt\"  id='kvshowpopup' href='"+s(a.getCrmBasePath.call(o,{name:"getCrmBasePath",hash:{},data:i}))+"/EntityInfo.do?module="+s(a.encodeURL.call(o,null!=t?t.SEMODULE:t,{name:"encodeURL",hash:{},data:i}))+"&id="+s(n(null!=t?t.SEID:t,t))+"' target='_blank'>"+s(n(null!=t?t.ENTITYNAME:t,t))+"</a> "},49:function(e,t,a,r,i){var o;return" "+(null!=(o=a.if_nq.call(null!=t?t:{},null!=t?t.CONID:t,"null",{name:"if_nq",hash:{},fn:e.program(50,i,0),inverse:e.noop,data:i}))?o:"")+" "},50:function(e,t,a,r,i){return" <span class='mL3 mR3 dIB fL vmiddle colorKsmalltext'>-</span> "},52:function(e,t,a,r,i){var o=e.escapeExpression,s=e.lambda;return' <a class="kt_smalltxt" href=\''+o(a.getCrmBasePath.call(null!=t?t:{},{name:"getCrmBasePath",hash:{},data:i}))+"/EntityInfo.do?module=Contacts&id="+o(s(null!=t?t.CONTACTID:t,t))+"'  target='_blank'>"+o(s(null!=t?t.CONTACTNAME:t,t))+"</a> "},54:function(e,t,a,r,i){return" </div> "},56:function(e,t,a,r,i){return' <span class="dIB grayFilledCircle fL mL7 mT8"></span> '},58:function(e,t,a,r,i){var o;return" "+(null!=(o=a.if.call(null!=t?t:{},null!=t?t.AMOUNT:t,{name:"if",hash:{},fn:e.program(59,i,0),inverse:e.noop,data:i}))?o:"")+" "},59:function(e,t,a,r,i){return' <br> <a  class="dIB  aligncenter ellipsistext dealAmount  mT4 crm-font-regular f14">'+e.escapeExpression(e.lambda(null!=t?t.AMOUNT:t,t))+"</a> "},61:function(e,t,a,r,i){var o;return" "+(null!=(o=a.if_eq.call(null!=t?t:{},null!=(o=null!=(o=null!=t?t.kvColumnObj:t)?o.jsonobj:o)?o.size:o,"20",{name:"if_eq",hash:{},fn:e.program(62,i,0),inverse:e.noop,data:i}))?o:"")+" "},62:function(e,t,a,r,i){var o,s=e.lambda,n=e.escapeExpression;return' <div id="'+n(s(null!=t?t.columntype:t,t))+'_tkvshowmore"  class="tkvshowmore" > <input type="hidden" id="'+n(s(null!=t?t.columntype:t,t))+'_startindex" name="'+n(s(null!=t?t.columntype:t,t))+'_startindex" value="20"> '+(null!=(o=a.if_eq.call(null!=t?t:{},null!=t?t.isFromActivityModule:t,"true",{name:"if_eq",hash:{},fn:e.program(63,i,0),inverse:e.program(65,i,0),data:i}))?o:"")+" </div> "},63:function(e,t,a,r,i){var o,s=e.lambda,n=e.escapeExpression;return' <a id=\'tkvshowmore1\' href="javascript:void(0)"  data-zcqa="tkvshowmore" data-cid="tkvshowmore" data-params=\'{"module":"Activities","kvmodule":"'+n(s(null!=t?t.columntype:t,t))+'","view":"kanbanview","kvstatus":"enable","isload":"true","startindex":"'+n(s(null!=(o=null!=(o=null!=t?t.kvColumnObj:t)?o.jsonobj:o)?o.startindex:o,t))+'","step":"loadmore"}\'>'+n(s(null!=(o=null!=(o=null!=t?t.kvColumnObj:t)?o.jsonobj:o)?o.ShowMoreLabel:o,t))+"</a> "},65:function(e,t,a,r,i){var o,s=e.lambda,n=e.escapeExpression;return' <a id=\'tkvshowmore1\' href="javascript:void(0)"  data-zcqa="tkvshowmore" data-cid="tkvshowmore" data-params=\'{"module":"'+n(s(null!=t?t.kvmodule:t,t))+'","kvmodule":"'+n(s(null!=t?t.columntype:t,t))+'","view":"kanbanview","kvstatus":"enable","isload":"true","startindex":"'+n(s(null!=(o=null!=(o=null!=t?t.kvColumnObj:t)?o.jsonobj:o)?o.startindex:o,t))+'","step":"loadmore"}\'>'+n(s(null!=(o=null!=(o=null!=t?t.kvColumnObj:t)?o.jsonobj:o)?o.ShowMoreLabel:o,t))+"</a> "},compiler:[7,">= 4.0.0"],main:function(e,t,a,r,i,o,s){var n,l=null!=t?t:{};return" <ul id='"+e.escapeExpression(e.lambda(null!=t?t.columntype:t,t))+'_Container\' class="p0 positionRelative kanbanList_activities"> '+(null!=(n=a.if_eq.call(l,null!=(n=null!=(n=null!=t?t.kvColumnObj:t)?n.jsonobj:n)?n.NORECORD:n,"true",{name:"if_eq",hash:{},fn:e.program(1,i,0,o,s),inverse:e.noop,data:i}))?n:"")+" "+(null!=(n=a.each.call(l,null!=(n=null!=t?t.kvColumnObj:t)?n.jsonarrayObj:n,{name:"each",hash:{},fn:e.program(3,i,0,o,s),inverse:e.noop,data:i}))?n:"")+" </ul> "+(null!=(n=a.if_eq.call(l,null!=t?t.isloadmore:t,"false",{name:"if_eq",hash:{},fn:e.program(61,i,0,o,s),inverse:e.noop,data:i}))?n:"")+" "},useData:!0,useDepths:!0}),t.EditionExpiryAlert=e({1:function(e,t,a,r,i){var o,s=e.lambda,n=e.escapeExpression;return' <div id="SubscriptionExpiryDiv" class="aligncenter"> <div class="headerBar fs p20 crm-font-bold"> <span class="dB"></span> '+n(s(null!=t?t.title:t,t))+' </div> <div class="p40 pL45 pR45 color_1"> <p class="crm-font-regular f18 pB30">'+n(s(null!=t?t.message:t,t))+"</p> "+(null!=(o=a.ifEquals.call(null!=t?t:{},null!=t?t.profileName:t,"Administrator",{name:"ifEquals",hash:{},fn:e.program(2,i,0),inverse:e.program(5,i,0),data:i}))?o:"")+" </div> </div> "},2:function(e,t,a,r,i){var o;return" "+(null!=(o=a.if.call(null!=t?t:{},null!=t?t.isOnlineStoreAvailable:t,{name:"if",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))?o:"")+' <a href="javascript:void(0)" class="col888 uline1" onclick="crmLicense.showMissingFeatures();Crm.trackSpotLightAction(\'Freeze Layer - Move to Free click\');">'+e.escapeExpression(e.lambda(null!=t?t.option3:t,t))+"</a> </div> "},3:function(e,t,a,r,i){var o=e.lambda,s=e.escapeExpression;return' <p class="f14 pB15">'+s(o(null!=t?t.question:t,t))+'</p> <a href="javascript:void(0)" class="primarybtn dIB" onclick="crmLicense.renewSubscription();Crm.trackSpotLightAction(\'Freeze Layer - Renew Subscription\');">'+s(o(null!=t?t.option1:t,t))+'</a> <div class="pT15 col888 f14 fs"> <a href="javascript:void(0)" class="col888 uline1" onclick="crmLicense.changeEdition();Crm.trackSpotLightAction(\'Freeze Layer - Choose other Edition\');">'+s(o(null!=t?t.option2:t,t))+'</a> <span class="pL5 pR5">('+s(o(null!=t?t.or:t,t))+")</span> "},5:function(e,t,a,r,i){return' <div class="aligncenter mT30"> <div><p>'+e.escapeExpression(e.lambda(null!=t?t.contactAdmin:t,t))+"</p></div> "},7:function(e,t,a,r,i){var o;return' <div id="trialExpiryDiv" class="newPopup" style="width: 600px; position: absolute; display: block; z-index: 40;"> <div class="p40"> \x3c!--div class="aligncenter"><span class="trialExpiryWarnIcon"></span></div--\x3e <div class="aligncenter crm-font-bold f24 mT20">'+e.escapeExpression(e.lambda(null!=t?t.title:t,t))+"</div> "+(null!=(o=a.ifEquals.call(null!=t?t:{},null!=t?t.profileName:t,"Administrator",{name:"ifEquals",hash:{},fn:e.program(8,i,0),inverse:e.program(13,i,0),data:i}))?o:"")+" </div> </div> "},8:function(e,t,a,r,i){var o,s=e.lambda,n=e.escapeExpression,l=null!=t?t:{};return' <div class="aligncenter mT20 col333 f16 crm-font-regular">'+n(s(null!=t?t.message:t,t))+'</div> <div class="aligncenter mT20"> '+(null!=(o=a.ifNotEquals.call(l,null!=t?t.deployment:t,"China",{name:"ifNotEquals",hash:{},fn:e.program(9,i,0),inverse:e.noop,data:i}))?o:"")+'</div> <div class="aligncenter mT20"> <input type="button" value="'+n(s(null!=t?t.option2:t,t))+'" class="outlineprimary newbutton" onclick="crmLicense.moveToActualEditionAfterExpiry()"></div> '+(null!=(o=a.ifEquals.call(l,null!=t?t.showExtendTrail:t,"true",{name:"ifEquals",hash:{},fn:e.program(11,i,0),inverse:e.noop,data:i}))?o:"")+" "},9:function(e,t,a,r,i){return' <input type="button" value="'+e.escapeExpression(e.lambda(null!=t?t.option1:t,t))+'" class="primarybtn" onclick="crmLicense.upgradeAfterExpiry()"> '},11:function(e,t,a,r,i){var o=e.lambda,s=e.escapeExpression;return' <div class="aligncenter mT20"> <p class="colBlue crm-font-bold f14 cP" style="color:#5aa6e5;" onclick="crmLicense.enableEditionTrial(\'extendYourTrail\',\''+s(o(null!=t?t.editionEvaluated:t,t))+"');Crm.trackSpotLightAction('Trial Expiry alert - Extend "+s(o(null!=t?t.editionEvaluated:t,t))+" trial');\">"+s(o(null!=t?t.option3:t,t))+"</p></div> "},13:function(e,t,a,r,i){return' <div class="aligncenter mT30"> <div><p>'+e.escapeExpression(e.lambda(null!=t?t.contactAdmin:t,t))+"</p> "},compiler:[7,">= 4.0.0"],main:function(e,t,a,r,i){var o;return" "+(null!=(o=a.ifEquals.call(null!=t?t:{},null!=t?t.action:t,"subscription",{name:"ifEquals",hash:{},fn:e.program(1,i,0),inverse:e.program(7,i,0),data:i}))?o:"")},useData:!0}),t.MissingFeatures=e({1:function(e,t,a,r,i){var o,s=null!=t?t:{};return" "+(null!=(o=a.ifEquals.call(s,i&&i.index,3,{name:"ifEquals",hash:{},fn:e.program(2,i,0),inverse:e.noop,data:i}))?o:"")+" "+(null!=(o=a.ifNotEquals.call(s,i&&i.index,3,{name:"ifNotEquals",hash:{},fn:e.program(4,i,0),inverse:e.noop,data:i}))?o:"")+" "+(null!=(o=a.each.call(s,t,{name:"each",hash:{},fn:e.program(6,i,0),inverse:e.noop,data:i}))?o:"")+" </div> "},2:function(e,t,a,r,i){return' <div class="keyFeatBox mR50 mB30 cb"> '},4:function(e,t,a,r,i){return' <div class="keyFeatBox mR50 mB30 "> '},6:function(e,t,a,r,i){var o;return' <h3 class="f12 col888 crm-font-bold uppercase fs">'+e.escapeExpression(e.lambda(i&&i.key,t))+'</h3> <ul class="f13 color_1 p0 m0 mT10"> '+(null!=(o=a.each.call(null!=t?t:{},t,{name:"each",hash:{},fn:e.program(7,i,0),inverse:e.noop,data:i}))?o:"")+" </ul> "},7:function(e,t,a,r,i){var o;return' <li class="pL0 pB5">'+e.escapeExpression(e.lambda(null!=t?t.displayFeatureName:t,t))+" "+(null!=(o=a.ifEquals.call(null!=t?t:{},null!=t?t.isUsed:t,"true",{name:"ifEquals",hash:{},fn:e.program(8,i,0),inverse:e.noop,data:i}))?o:"")+"</li> "},8:function(e,t,a,r,i){return'<span class="activFeat mL5 vam"></span>'},compiler:[7,">= 4.0.0"],main:function(e,t,a,r,i){var o,s=e.lambda,n=e.escapeExpression;return' <div id="editionChangePop" class="p30 pB0"> <h2 class="f22 pB25 nwrp">'+(null!=(o=s(null!=t?t.title:t,t))?o:"")+"</h2> "+(null!=(o=a.each.call(null!=t?t:{},null!=t?t.MissingFeatures:t,{name:"each",hash:{},fn:e.program(1,i,0),inverse:e.noop,data:i}))?o:"")+' <div class="cb pT20 pB30"> <div class="fL f13 col888 mT7"><span class="activFeat mR5 pR"></span> '+n(s(null!=t?t.usedFeatures:t,t))+' </div> <a href="javascript:void(0)" class="primarybtn fR mL20 mR0" onclick="crmLicense.moveToFree();Crm.trackSpotLightAction(\'Freeze Layer - Move to Free Edition click\');">'+n(s(null!=t?t.moveToFree:t,t))+'</a> <a href="javascript:void(0)" class="fR f13 color_5 uline1 mT7" onclick="crmLicense.hideMissingFeatures();Crm.trackSpotLightAction(\'Freeze Layer - Move to Free Go back\');">'+n(s(null!=t?t.goBack:t,t))+'</a> <div class="cb"></div> </div> </div> '},useData:!0}),t.callMoreOptionsMenu=e({1:function(e,t,a,r,i){var o,s=null!=t?t:{};return' <div id="appMoreOption" data-zcqa="appMoreOption" class="appMoreOptionNew pA"> <ul class="appMoreOptionBlk"> '+(null!=(o=a.ifEquals.call(s,null!=t?t.isEdit:t,!0,{name:"ifEquals",hash:{},fn:e.program(2,i,0),inverse:e.noop,data:i}))?o:"")+" "+(null!=(o=a.ifEquals.call(s,null!=t?t.isDelete:t,!0,{name:"ifEquals",hash:{},fn:e.program(6,i,0),inverse:e.noop,data:i}))?o:"")+" </ul> </div> "},2:function(e,t,a,r,i){var o,s=null!=t?t:{};return" "+(null!=(o=a.ifCondLogic.call(s,null!=t?t.isScheduled:t,"==","Scheduled","||",null!=t?t.isScheduled:t,"==","Overdue",{name:"ifCondLogic",hash:{},fn:e.program(3,i,0),inverse:e.noop,data:i}))?o:"")+' <li id="editAppRecordbtn" data-zcqa="editAppRecordbtn" class="crm-font-regular appMoreOptBlkList">'+e.escapeExpression(a.getI18n.call(s,"Edit",{name:"getI18n",hash:{},data:i}))+"</li> "},3:function(e,t,a,r,i){var o,s=null!=t?t:{},n=e.escapeExpression;return" "+(null!=(o=a.ifEquals.call(s,null!=t?t.isComp:t,!0,{name:"ifEquals",hash:{},fn:e.program(4,i,0),inverse:e.noop,data:i}))?o:"")+' <li id="rescheduleAppMoreOption" data-zcqa="rescheduleAppMoreOption" class="crm-font-regular appMoreOptBlkList">'+n(a.getI18n.call(s,"crm.appointments.status.markreschedule",a.getSingleUserModMap.call(s,"Appointments",{name:"getSingleUserModMap",hash:{},data:i}),{name:"getI18n",hash:{},data:i}))+'</li> <li id="cancelAppMoreOption" data-zcqa="cancelAppMoreOption" class="crm-font-regular appMoreOptBlkList optBotLine">'+n(a.getI18n.call(s,"crm.appointments.status.markcancel",a.getSingleUserModMap.call(s,"Appointments",{name:"getSingleUserModMap",hash:{},data:i}),{name:"getI18n",hash:{},data:i}))+"</li> "},4:function(e,t,a,r,i){return' <li id="completeAppMoreOption" data-zcqa="completeAppMoreOption" class="crm-font-regular appMoreOptBlkList">'+e.escapeExpression(a.getI18n.call(null!=t?t:{},"crm.appointments.status.markcompleted1",{name:"getI18n",hash:{},data:i}))+"</li> "},6:function(e,t,a,r,i){return' <li id="deleteAppRecordbtn" data-zcqa="deleteAppRecordbtn"  class="crm-font-regular appMoreOptBlkList">'+e.escapeExpression(a.getI18n.call(null!=t?t:{},"Delete",{name:"getI18n",hash:{},data:i}))+"</li> "},8:function(e,t,a,r,i){var o=null!=t?t:{},s=e.escapeExpression;return' <div id="callMoreOption" data-zcqa="callMoreOption" class="callMoreOptionNew pA"> <ul> <li id="completeCallMoreOption" data-zcqa="completeCallMoreOption" class="crm-font-regular">'+s(a.getI18n.call(o,"crm.label.mark.completed",{name:"getI18n",hash:{},data:i}))+'</li> <li id="scheduleCallMoreOption" data-zcqa="scheduleCallMoreOption" class="crm-font-regular">'+s(a.getI18n.call(o,"crm.label.reschedule.call",a.getSingleUserModMap.call(o,"Calls",{name:"getSingleUserModMap",hash:{},data:i}),{name:"getI18n",hash:{},data:i}))+'</li> <li id="cancelCallMoreOption" data-zcqa="cancelCallMoreOption"  class="crm-font-regular">'+s(a.getI18n.call(o,"crm.label.cancel.call",a.getSingleUserModMap.call(o,"Calls",{name:"getSingleUserModMap",hash:{},data:i}),{name:"getI18n",hash:{},data:i}))+"</li> </ul> </div> "},compiler:[7,">= 4.0.0"],main:function(e,t,a,r,i){var o;return null!=(o=a.ifEquals.call(null!=t?t:{},null!=t?t.module:t,"Appointments",{name:"ifEquals",hash:{},fn:e.program(1,i,0),inverse:e.program(8,i,0),data:i}))?o:""},useData:!0}),t.sandboxDeactivatedPage=e({1:function(e,t,a,r,i){var o=null!=t?t:{},s=e.escapeExpression;return' <div id="deactivatedWindow" class="reActivateWindow deactivatedWindow aligncenter pA"> <div class="reactivateData"> <img class="reactivateDataSbLogo" src="'+s(a.getCrmImageUrl.call(o,"sandbox-icon_b706c82_.png",{name:"getCrmImageUrl",hash:{},data:i}))+'"> <p class="f24 color_3 dB">'+s(a.getI18n.call(o,null!=t?t.headContent:t,{name:"getI18n",hash:{},data:i}))+'</p> <p class="f14 color_6">'+s(a.getI18n.call(o,null!=t?t.bodyContent:t,{name:"getI18n",hash:{},data:i}))+'</p> </div> </div> <div class="sBoxCustomFreezeLayer"></div> '},3:function(e,t,a,r,i){var o,s=null!=t?t:{},n=e.escapeExpression;return' <div class="refreshSandboxPop"> <div class="refreshsbContainer"> <img src="'+n(a.getCrmImageUrl.call(s,"sandbox-icon_b706c82_.png",{name:"getCrmImageUrl",hash:{},data:i}))+'" class="pB10"> <h2 class="refreshsbHeading crm-font-bold">'+(null!=(o=a.getI18n.call(s,null!=t?t.headContent:t,{name:"getI18n",hash:{},data:i}))?o:"")+'</h2> <p class="f14 refreshsbDesc pT40">'+n(a.getI18n.call(s,null!=t?t.bodyContent:t,{name:"getI18n",hash:{},data:i}))+"</p> </div> </div> "},compiler:[7,">= 4.0.0"],main:function(e,t,a,r,i){var o;return null!=(o=a.if.call(null!=t?t:{},null!=t?t.deactivate:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))?o:""},useData:!0}),t.singleReminder=e({1:function(e,t,a,r,i){return' <span class="reaminder-title w170 dIB pR"> '},3:function(e,t,a,r,i){return' <span class="reaminder-title w198 dIB pR"> '},5:function(e,t,a,r,i){var o=e.lambda,s=e.escapeExpression;return' <span class="activitesColor_remainder" data-zcqa="remaindercolor_'+s(o(null!=t?t.activityId:t,t))+'" style="background: '+s(o(null!=t?t.colorCode:t,t))+'"></span> '},7:function(e,t,a,r,i){var o;return" "+(null!=(o=a.if.call(null!=t?t:{},null!=t?t.showJoinMeeting:t,{name:"if",hash:{},fn:e.program(8,i,0),inverse:e.program(10,i,0),data:i}))?o:"")+" "},8:function(e,t,a,r,i){var o=null!=t?t:{},s=e.escapeExpression;return' <input type="button" class="remainder-start primarybtn bt-smallprimarybtn  fL" value="'+s(a.getI18n.call(o,"crm.event.join.meeting",{name:"getI18n",hash:{},data:i}))+'" onclick="Events.joinMeeting(\''+s(a.encodeJS.call(o,null!=t?t.meetingDetails:t,{name:"encodeJS",hash:{},data:i}))+'\')" ></input> <input type="hidden" id="meetingDetails" value="'+s(e.lambda(null!=t?t.meetingDetails:t,t))+'" ></input> '},10:function(e,t,a,r,i){var o=null!=t?t:{},s=e.escapeExpression;return' <input type="button" class="remainder-start primarybtn bt-smallprimarybtn  fL" value="'+s(a.getI18n.call(o,"crm.event.start.meeting",{name:"getI18n",hash:{},data:i}))+"\" onclick=\"Events.startMeeting('Reminder','"+s(a.encodeJS.call(o,null!=t?t.activityId:t,{name:"encodeJS",hash:{},data:i}))+"','"+s(a.encodeJS.call(o,null!=t?t.meetingDetails:t,{name:"encodeJS",hash:{},data:i}))+'\')" ></input> <input type="hidden" id="meetingDetails" value="'+s(e.lambda(null!=t?t.meetingDetails:t,t))+'" ></input> '},12:function(e,t,a,r,i){var o,s=null!=t?t:{},n=e.escapeExpression;return' <div class="cB"></div> <span class="remLabel">'+n(a.getI18n.call(s,"crm.best.time.next.best.time",{name:"getI18n",hash:{},data:i}))+'</span>- <span class="remValue">'+n(e.lambda(null!=(o=null!=t?t.best_times_result:t)?o.nextImmediateTime:o,t))+"</span> "+(null!=(o=a.ifCondLogic.call(s,null!=(o=null!=t?t.best_times_result:t)?o.oldTime:o,"!=",void 0,"||",null!=(o=null!=(o=null!=t?t.best_times_result:t)?o.nextTimes:o)?o.length:o,"!=","0",{name:"ifCondLogic",hash:{},fn:e.program(13,i,0),inverse:e.noop,data:i}))?o:"")+" "},13:function(e,t,a,r,i){var o,s=null!=t?t:{};return" <span onmouseover=\"crmui.toolTip_show(this,'right','<div class=\\'fL\\'>"+(null!=(o=a.if.call(s,null!=(o=null!=t?t.best_times_result:t)?o.oldTime:o,{name:"if",hash:{},fn:e.program(14,i,0),inverse:e.noop,data:i}))?o:"")+(null!=(o=a.each.call(s,null!=(o=null!=t?t.best_times_result:t)?o.nextTimes:o,{name:"each",hash:{},fn:e.program(16,i,0),inverse:e.noop,data:i}))?o:"")+'</div>\',true)" onmouseleave="crmui.hideTooltip(this)" class="iconTime dIB mL5 cP pR" style="top:2px"></span> '},14:function(e,t,a,r,i){var o;return"<span class=\\'crm-font-regular f14 bestTimeTag red\\'>"+e.escapeExpression(e.lambda(null!=(o=null!=t?t.best_times_result:t)?o.oldTime:o,t))+"</span>"},16:function(e,t,a,r,i){var o,s=null!=t?t:{};return(null!=(o=a.ifEquals.call(s,a.checkComparison.call(s,i&&i.index,0,"==",{name:"checkComparison",hash:{},data:i}),"true",{name:"ifEquals",hash:{},fn:e.program(17,i,0),inverse:e.program(19,i,0),data:i}))?o:"")+e.escapeExpression(e.lambda(t,t))+"</span>"},17:function(e,t,a,r,i){return"<span class=\\'crm-font-regular f14 fL mL5 bestTimeTag mT5\\'>"},19:function(e,t,a,r,i){var o,s=null!=t?t:{};return null!=(o=a.ifEquals.call(s,a.checkComparison.call(s,i&&i.index,1,"==",{name:"checkComparison",hash:{},data:i}),"true",{name:"ifEquals",hash:{},fn:e.program(17,i,0),inverse:e.program(17,i,0),data:i}))?o:""},compiler:[7,">= 4.0.0"],main:function(e,t,a,r,i){var o,s=e.lambda,n=e.escapeExpression,l=null!=t?t:{};return' <li id="'+n(s(null!=t?t.activityId:t,t))+'" class="pR remindertemp" onclick="Activities.showMoreDetails(this);"> <label class="re_check_box" onclick="sE(event);" for="chk_'+n(s(null!=t?t.activityId:t,t))+'"> <input type="checkbox" class="newcheckboxfilter" id="chk_'+n(s(null!=t?t.activityId:t,t))+'" data-zcqa="chk_'+n(s(null!=t?t.activityId:t,t))+'" onclick="Activities.showHideBulkDismiss(this);"> <span></span> </label> <span class="'+n(s(null!=t?t.moduleClass:t,t))+'"></span> '+(null!=(o=a.if.call(l,null!=t?t.showStartMeeting:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))?o:"")+" "+(null!=(o=a.if_nq.call(l,null!=t?t.colorCode:t,"",{name:"if_nq",hash:{},fn:e.program(5,i,0),inverse:e.noop,data:i}))?o:"")+' <a class="crm-font-bold black mod_sub" href="'+n(a.getCrmBasePath.call(l,{name:"getCrmBasePath",hash:{},data:i}))+"/EntityInfo.do?module="+n(a.encodeURIComponent.call(l,null!=t?t.module:t,{name:"encodeURIComponent",hash:{},data:i}))+"&id="+n(a.encodeURIComponent.call(l,null!=t?t.activityId:t,{name:"encodeURIComponent",hash:{},data:i}))+'" target="_blank">'+(null!=(o=s(null!=t?t.subject:t,t))?o:"")+'</a> </span> <div class="remainder-hover-menu clearfix"> <button type="button" class="remainder-dismiss-lnk fL outlineredlight bt-smalloutlineredlight redbtn" data-zcqa="rmd-disms'+n(s(null!=t?t.activityId:t,t))+'" onclick="Activities.dismissReminder(\''+n(a.encodeJS.call(l,null!=t?t.activityId:t,{name:"encodeJS",hash:{},data:i}))+"');sE(event);\">"+n(a.getI18n.call(l,"crm.eventreminder.dismiss",{name:"getI18n",hash:{},data:i}))+"</button> "+(null!=(o=a.if.call(l,null!=t?t.showStartMeeting:t,{name:"if",hash:{},fn:e.program(7,i,0),inverse:e.noop,data:i}))?o:"")+' </div> <div class="dB"><span class="remLabel">'+n(a.getI18n.call(l,null!=t?t.sing_moduleName:t,a.getSingularModuleLabel.call(l,null!=t?t.module:t,{name:"getSingularModuleLabel",hash:{},data:i}),{name:"getI18n",hash:{},data:i}))+'</span>-<span class="remValue">'+(null!=(o=s(null!=t?t.dueDate:t,t))?o:"")+"</span></div> "+(null!=(o=a.if.call(l,null!=(o=null!=t?t.best_times_result:t)?o.nextImmediateTime:o,{name:"if",hash:{},fn:e.program(12,i,0),inverse:e.noop,data:i}))?o:"")+" </li> "},useData:!0})}();var crmReports={exportReports:"ExportReports",downloadVCard:"DownloadVCard",newkey:0,scrollleft:0,dummyBPColumns:["CrmProcessLogs:RECORD_ENTERED_TIME_DUMMY","CrmProcessLogs:TRANS_OWNER_DUMMY","CrmProcessLogs:STATE_TIME_DUMMY","CrmProcessLogs:STATUS_DUMMY"],clickEventIdVsMethodMapping:{showContainer:"crmReports.manageChart",customizeChart:"crmReports.customizeChart",deleteChart:"crmReports.deleteChart",customizeReport:"Crm.lyteTransition",showChatNotification:"Crm.loadChatIntegrations",showSlackNotification:"Crm.loadChatIntegrations",showCiscoNotification:"Crm.loadChatIntegrations",getFolderReports:"crmReports.getFolderReports",newReport:"Crm.lyteTransition",scheduleReport:"Crm.addToHistory",newScheduler:"crmReports.createSchedule"},selectedModules:[],selectedCount:0,folderData:"",sharedData:"",orgTerritoryId:"",territoryEnabled:!1,isReportSchedulePage:!1,scheduledData:"",scheduledsharedData:"",disableMigrateBtn:!1,scheduledTime:"",tooltipMsgHeading:"",tooltipMsgContent:"",updatedTimeMsg:"",init:function(){if(crmReports.timerValue,crmReports.favouriteReports,crmReports.favouriteFolders,crmReports.currentFolder,crmReports.selectedFavReports,crmReports.removedFavReports,crmReports.timouttooltip,crmReports.timeoutstop,crmReports.defaultReports,crmReports.tmpRepName,crmReports.tmpRepId,crmReports.newwidth,crmReports.reqSent=!1,crmReports.currentFolderForChoose="ALLREPORTS",crmReports.madeRequest=!1,crmReports.sortColumn="",crmReports.sortOrder=!1,crmReports.constructedDiv=0,crmReports.isRepScrolled=!1,crmReports.scheduleStatus=1,crmReports.lastSelectedTab="",crmReports.reportTemplate=Handlebars.compile("{{#each objects}}<tr style='border-bottom:1px double #e5e5e5;height:26px;' id='tr_{{reportId}}' class='drappable mT20'><td align='middle' style='width:14px' valign='top' class='pB10 pT10'><input name='reportIds' type='checkbox' value='{{reportId}}' style='display:none'><label>{{#if customizable}}<div class='EditDeleteIcon cChecked mT3' onclick=\"$(this).toggleClass('EditDeleteIconchecked');crmReports.enableOptions(this);\"></div>{{else}}<div class='EditDeleteIcon cChecked mT3 checkDisabled'\"></div>{{/if}}</label></td><td class='crm-font-regular f14 NameClass pT10 pB10' width='34%' valign='top' onmouseenter=\"$(this).find('.rep_dropicon').css('visibility','visible')\" onmouseleave=\"$(this).find('.rep_dropicon').css('visibility','hidden')\"><span class='fL graystaricon' id='favIcon_{{reportId}}' onclick=\"crmReports.markAsFavorite('{{reportId}}',this,false);sE(event);\"></span><div class='NameDiv fL pR' id='report_{{reportId}}' title='{{{reportName}}}'><span class='NameText f14 crm-font-regular'>{{#if isStatsReport}}<link-to lt-prop-route='crm.tab.reports.view' lt-prop-class='emailStatsView' lt-prop-dp='[\"{{reportId}}\"]' lt-prop-qp='{{statsparams}}'>{{{reportName}}}</link-to></span><span class='rep_dropicon fR' onclick=\"crmReports.callRunReport(this,'{{reportId}}','{{folderId}}','{{reportType}}','{{customizable}}');sE(event)\"></span>{{else}}<link-to  lt-prop-route='crm.tab.reports.view' data-zcqa=\"{{reportType}}\" lt-prop-dp='[\"{{reportId}}\"]' lt-prop-qp='{\"folderId\":\"{{folderId}}\",\"repType\":\"{{reportType}}\"}'>{{{reportName}}}</link-to></span><span class='rep_dropicon fR' onclick=\"crmReports.callRunReport(this,'{{reportId}}','{{folderId}}','{{reportType}}','{{customizable}}');sE(event)\"></span>{{/if}}</div></td><td valign='top' class='crm-font-regular pT10 pB10 f14 descClass' width='50%'><span style='white-space:nowrap;display:inline-block;' class='descText fL f14 crm-font-regular {{#if description}}seemoreclass{{else}}Nodescription{{/if}}'>{{#if description}} {{{description}}} {{else}}-{{/if}}</span>{{#if_gt description.length 63}}<div class='fL hiddenTextArea' style='display:none;resize:none;width:462px;'>{{{description}}}</div><a class='fL seemorelink dN' style='cursor: pointer;' onclick='crmReports.showSeemore(this);sE(event);'>See More</a>{{/if_gt}}</td><td valign='top' class='crm-font-regular f13 descClass pT10 pB10' width='16%' style='white-space: nowrap;' title='{{accessedTime}}'>{{accessedTime_display}}</td></tr>{{/each}}"),crmReports.favReportTemplate=Handlebars.compile("{{#each objects}}<tr style='border-bottom:1px double #e5e5e5;height:26px;' id='tr_{{reportId}}' class='drappable mT20'><td class='crm-font-regular f14 NameClass pT10 pB10 pL30' width='34%' valign='top' onmouseenter=\"$(this).find('.rep_dropicon').css('visibility','visible')()\" onmouseleave=\"$(this).find('.rep_dropicon').css('visibility','hidden')\"><span class='fL iconarray DragIconArray' style='display: none;'></span><span class='fL graystaricon' id='favIcon_{{reportId}}' onclick=\"crmReports.markAsFavorite('{{reportId}}',this,true);sE(event);\"></span><div class='NameDiv fL pR' id='report_{{reportId}}' title='{{reportName}}'><span class='NameText f14 crm-font-regular'><a data-cid='customizeReport' href='"+Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=run&reportId={{reportId}}&folderId={{folderId}}&repType={{repType}}' data-params='{\"isload\":\"true\",\"actionItem\":\"run\",\"reportId\":\"{{reportId}}\",\"folderId\":\"{{folderId}}\",\"repType\":\"{{repType}}\",\"calleeObj\":\"crmReports\",\"clickId\":\"customizeReport\"}' onclick=\"crmReports.showReport('{{reportId}}','{{folderId}}');sE(event);\">{{{reportName}}}</a></span><span class='rep_dropicon fR' onclick=\"crmReports.callRunReport(this,'{{reportId}}','{{folderId}}','{{reportType}}');sE(event);\"></span></div></td><td valign='top' class='crm-font-regular pT10 pB10 f14 descClass' width='50%'><span style='white-space:nowrap;display:inline-block;' class='descText fL f14 crm-font-regular {{#if description}}seemoreclass{{else}}Nodescription{{/if}}'>{{#if description}} {{{description}}} {{else}}-{{/if}}</span></td><td valign='top' class='crm-font-regular f13 descClass pT10 pB10' width='16%' style='white-space: nowrap;' title='{{accessedTime}}'>{{accessedTime_display}}</td></tr>{{/each}}"),crmReports.chooseReportTmp=Handlebars.compile("{{#each objects}}<tr style='border-bottom:1px double #e5e5e5;height:26px;margin-top:20px;' id='tr_{{reportId}}' data-repType='{{reportType}}' ondblclick=\"crmReports.selectReport();\" onclick=\"$('#chooseRepBtn').prop('disabled',false);$('.elementRowselected').removeClass('elementRowselected');$(this).addClass('elementRowselected')\" class='cursorPointer'><td class='crm-font-regular f14 NameClass pT10 pB10' width='40%' valign='middle' onmouseover=\"$(this).find('.RunButtons').css('display','inline-block')\" onmouseout=\"$(this).find('.RunButtons').css('display','none')\"><div class='NameDiv fL pR'><span class='NameText f14 crm-font-regular' title='{{{reportName}}}' style='width:180px'>{{{reportName}}}</span></div></td><td valign='middle' class='crm-font-regular pT10 pB10 f14 descClass' width='40%'><span  style='white-space:nowrap;display:inline-block;'  class='descText fL f14 crm-font-regular {{#if description}}seemoreclass{{else}}Nodescription{{/if}}' style='width: 290px;' title='{{{description}}}'>{{#if description}} {{{description}}} {{else}}-{{/if}}</span></td></tr>{{/each}}"),crmReports.trashReportTmp=Handlebars.compile("{{#each objects}}<tr style='border-bottom:1px double #e5e5e5;height:26px;' id='tr_{{reportId}}' class='drappable mT20'><td align='middle' style='width:14px;' valign='top' class='pB10 pT10'><input type='checkbox' name='reportIds' value='{{reportId}}' style='display:none'><label><div class='EditDeleteIcon cChecked mT3' onclick=\"$(this).toggleClass('EditDeleteIconchecked');crmReports.enableOptions(this);\"></div></label></td><td class='crm-font-regular f14 NameClass pT10 pB10' width='34%' valign='top' onmouseover=\"$(this).find('.RunButtons').css('display','inline-block');\" onmouseout=\"$(this).find('.RunButtons').css('display','none');\"><div class='NameDiv fL pR' id='report_{{reportId}}' title='{{{reportName}}}'><span class='NameText f14 crm-font-regular cP lh18'><a href='"+Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=run&reportId={{reportId}}&folderId={{folderId}}&repType={{repType}}' data-cid='customizeReport' data-params='{\"isload\":\"true\",\"actionItem\":\"run\",\"reportId\":\"{{reportId}}\",\"folderId\":\"{{folderId}}\",\"repType\":\"{{repType}}\",\"calleeObj\":\"crmReports\",\"clickId\":\"customizeReport\"}'>{{{reportName}}}</a></span><div class='RunButtons pA TrashRunbtns' onclick='sE(event);' style='width: 120px; display: none;' onmouseenter='sE(event);'><div class='show_selectionDiv fL proxiSemi f13 mL10' style='padding:5px 10px;background-color:#a1c873;color:#fff;cursor:pointer;border-radius:2px; margin-top:-5px;' onclick=\"crmReports.restoreReport(this,'{{reportId}}','{{folderId}}');sE(event);\">Restore</div></div></div></td><td valign='top' class='crm-font-regular pT10 pB10 f14 descClass' width='50%'><span style='white-space:nowrap;display:inline-block;' class='descText fL f14 crm-font-regular {{#if description}}seemoreclass{{else}}Nodescription{{/if}}'>{{#if description}} {{{description}}} {{else}}-{{/if}}</span>{{#if_gt description.length 63}}<div class='fL hiddenTextArea' style='display:none;resize:none;width:462px;'>{{{description}}}</div><a class='fL seemorelink dN' style='cursor: pointer;' onclick='crmReports.showSeemore(this);sE(event);'>See More</a>{{/if_gt}}</td><td valign='top' class='crm-font-regular f13 descClass pT10 pB10' width='33%' style='white-space: nowrap;' title='{{daysToDelete}}'>{{daysToDelete}}</td></tr>{{/each}}"),crmReports.selectchartcon=Handlebars.compile("{{#each objects}}<div class='reportChartsampleCont dIB vat aligncenter mT20 mB5'  onclick=\"crmReports.selectChart(this);\"><div id='reportC' value='{{id}}' class='reportChartsample pR op5'>  {{#ifEquals chartType 'funnel'}}<div class = \" dIB mT35 add_Dashboardicons reports_add_dashboard_Funnelcharticon\"></div>{{/ifEquals}}{{#ifEquals chartType 'pie'}}<div class = \" dIB mT35 add_Dashboardicons reports_add_dashboard_Piecharticon\"></div>{{/ifEquals}}{{#ifEquals chartType 'donut'}}<div class = \" dIB mT35 add_Dashboardicons reports_add_dashboard_Donutcharticon\"></div>{{/ifEquals}}{{#ifEquals chartType 'areaspline'}}<div class = \" dIB mT35 add_Dashboardicons reports_add_dashboard_Areacharticon\"></div>{{/ifEquals}}{{#ifEquals chartType 'bar'}}<div class = \"  dIB mT35 add_Dashboardicons reports_add_dashboard_Horizontalcharticon\"></div>{{/ifEquals}}{{#ifEquals chartType 'column'}}<div class = \" dIB mT35 add_Dashboardicons reports_add_dashboard_Verticalcharticon\"></div>{{/ifEquals}}{{#ifEquals chartType 'tabular'}}<div class = \" dIB mT35 add_Dashboardicons reports_add_dashboard_Tablecharticon\"></div>{{/ifEquals}}{{#ifEquals chartType 'line'}}<div class = \" dIB mT35 add_Dashboardicons reports_add_dashboard_Linecharticon\"></div>{{/ifEquals}}{{#ifEquals chartType 'bar_stacked'}}<div class = \"dIB mT35 add_Dashboardicons reports_add_dashboard_Horizontalcharticon\"></div>{{/ifEquals}}{{#ifEquals chartType 'column_stacked'}}<div class = \" dIB mT35 add_Dashboardicons reports_add_dashboard_Verticalcharticon\"></div>{{/ifEquals}}{{#ifEquals chartType 'column_stacked_100per'}}<div class = \" dIB mT35 add_Dashboardicons reports_add_dashboard_Verticalcharticon\"></div>{{/ifEquals}}{{#ifEquals chartType 'column_grouping'}}<div class = \" dIB mT35 add_Dashboardicons reports_add_dashboard_Verticalcharticon\"></div>{{/ifEquals}}{{#ifEquals chartType 'bar_stacked_100per'}}<div class = \"dIB mT35 add_Dashboardicons reports_add_dashboard_Horizontalcharticon\"></div>{{/ifEquals}}{{#ifEquals chartType 'bar_grouping'}}<div class = \" dIB mT35 add_Dashboardicons reports_add_dashboard_Horizontalcharticon\"></div>{{/ifEquals}}<div style='display: table-cell' class='displayTableCell vmiddle'></div></div><p class='mt15 f14 crm-font-regular color_3'>{{{name}}}</p></div>{{/each}}"),crmReports.generateOthersList=Handlebars.compile("<div  class='reportDelTt f13 fontsmooth pA p10' style='display:none'>{{#each_upto_with_index othersSubList 10 1}}<div class='ellipsistext'>{{{this}}}</div>{{/each_upto_with_index}}{{#if this.moreCnt}}{{#ifCond this.moreCnt '=' 1}}<div>{{#getElementFromArrayByIndex 'last' othersSubList}}{{this}}{{/getElementFromArrayByIndex}} </div> {{else}} <div>{{getI18n 'and'}} {{moreCnt}} {{getI18n 'crm.login.more'}}</div>{{/ifCond}}{{/if}}</div>"),crmReports.generateReportDelPopup=Handlebars.compile("<div  class='reportDelListPop newpopup pA p20' style='display:none'><div class=\"bdr1px oH\"><div class=\"repListDivIn\">{{#each this}}<div title='{{{this}}}' class=\"repListDiv ellipsistext\">{{{this}}}</div>{{/each}}</div></div><div class='aligncenter mT20'><input type='button' value='Done' class='primarybtn cP' onclick='$(\".reportDelListPop\").remove();$(\"#repDeleteAlertDiv\").addClass(\"zi32\");' /></div></div>"),crmReports.recipientsTemplate=Handlebars.compile('<li class="pT15 pB15 pL0 w100per fL" id="{{id}}" for="{{id}}" style="border-top:1px solid #e3e3e3;" onclick="crmReports.countSelected(this)"><input type="checkbox" {{#ifEquals (getCurrentUserId) id}} checked {{else}} {{#ifEquals selected true}}  checked {{/ifEquals}}{{/ifEquals}} class="Checkboxes fL displayNone" value="U:{{id}}"><label class="w100per fL cursorPointer"><span class="fL {{#ifEquals (getCurrentUserId) id}}Iconchecked {{else}} {{#ifEquals selected true}} Iconchecked {{else}} Iconcheck {{/ifEquals}} {{/ifEquals}} checkboxmodel" style="margin-right:8px"></span><span class="User_nameinlist fL crm-font-bold f13 defColor">{{full_name}}</span><span class="User_emailinlist fL crm-font-regular f12 cB defColor" style="margin-left:22px;">{{email}}</span></label></li>'),crmReports.oldRecipientsTemplate=Handlebars.compile('<li class="pT15 pB15 pL0 w100per fL" id="{{id}}" for="{{id}}" style="border-top:1px solid #e3e3e3;" onclick="crmReports.countSelected(this)"><input type="checkbox" {{#ifEquals (getCurrentUserId) id}} checked {{else}} {{#ifEquals selected true}}  checked {{/ifEquals}}{{/ifEquals}} class="Checkboxes fL displayNone" value="U:{{id}}"><label class="w100per fL cursorPointer"><span class="fL {{#ifEquals (getCurrentUserId) id}}Iconchecked {{else}} {{#ifEquals selected true}} Iconchecked {{else}} Iconcheck {{/ifEquals}} {{/ifEquals}} checkboxmodel" style="margin-right:8px"></span><span class="User_nameinlist fL crm-font-bold f13 defColor">{{plainName}}</span><span class="User_emailinlist fL crm-font-regular f12 cB defColor" style="margin-left:22px;">{{email}}</span></label></li>'),crmReports.selectedRecipients={},crmReports.repDeleteAlertList={},crmReports.searchUserTimeOut,crmReports.scrollRecipientsDiv,crmReports.newkey=0,"undefined"!=typeof Storage){var e=localStorage.getItem(crmReports.exportReports);if(e){newReport=JSON.parse("{}"),e=JSON.parse(e);var t=(new Date).getTime();for(var a in e){var r=e[a];t-r.MODIFIEDTIME<=3e5&&(newReport[a]=r,crmReports.showCommonMsg(a,r))}localStorage.setItem(crmReports.exportReports,JSON.stringify(newReport))}try{for(var i in localStorage)i&&0==i.indexOf("ExportReports")&&0==!i.indexOf(crmReports.exportReports)&&localStorage.removeItem(i)}catch(e){}}},loadReports:function(e,t,a,r){a||(a=JSON.parse($(t).attr("data-params")));var i=a.clickId,o="";if("newReport"===i||"customizeReport"===i||"getFolderReports"===i||"customizeChart"===i)o=Crm.getCrmBasePath()+"/specific/CustomReport.do";else if("newReportFolder"===i||"customizeReportFolder"===i)o="CustomReportFolder.do";else if("scheduleReport"==i||"newScheduler"==i||"editScheduler"===i||"viewScheduler"===i)o="ScheduleReport.do";else{var s=window.location.href,n=networkUtils.parseUrl(s);o=s.indexOf("specific")>-1||!(s.indexOf("CustomReport.do")>-1)?n.action+".do":"specific/"+n.action+".do"}if(r)l=r;else{var l={isload:!0};for(var d in a)/clickId|calleeObj/.test(d)||(l[d]=a[d])}"getFolderReports"===i&&(crmReports.currentFolder=a.folderId?a.folderId:a.view,$("#folder_"+crmReports.currentFolder).is("[data-hiddenfolder]")||$(".folderListul .fL[data-hiddenFolder=true]").remove(),l.sortColumn=crmReports.sortColumn,l.folderName=$("#folder_"+crmReports.currentFolder).find(".listText").text(),l.sortOrder=crmReports.sortOrder),loadAjaxTab("");var c=new crmRequestPool,u=Crm.isPageLoad;if(1==Crm.isPageLoad&&"customize"!=l.actionItem&&"newReport"!=l.actionItem&&"run"!=l.actionItem){commonUtils.showHideLoadingDiv(!0);var m=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=getReportLeftPanel&isload=true";l&&l.fromDashboard?m+="&fromDashboard=true":l&&"newScheduler"==l.actionItem&&(m+="&subAction=newScheduler"),l.folderId&&(m+="&folderId="+l.folderId),c.initiate({action:m,type:"POST",data:"",complete:function(){},beforeSend:function(e){e.setRequestHeader("is-Page-Load","true"),Crm.isPageLoad=!1},success:function(e){$("#show").append(e),commonUtils.showHideLoadingDiv(),"getReports"===l.actionItem?crmReports.setHeightWidth(!0):"newScheduler"===l.actionItem&&(crmReports.doScheduleConf("U"),crmReports.setHeightWidth(!0))},error:function(e){commonUtils.showHideLoadingDiv(),555==e.status&&e.responseText&&(alert(e.responseText),$("#lookupdiv").hide(),removeFreezeLayer())}})}else c.initiate({action:o,type:"POST",data:l,complete:function(){commonUtils.showHideLoadingDiv()},beforeSend:function(e){1==Crm.isPageLoad&&(e.setRequestHeader("is-Page-Load","true"),Crm.isPageLoad=!1)},success:function(e){var t=$("#freezeBackGround");if("updateChartAndRun"===a.actionItem)crmReports.showChart(e);else if("addChart"===l.actionItem||"editChart"===l.actionItem)$("#lookupdiv").html(e),t.css("z-index","30"),showFreezeLayer(),crmReports.animatepopFromTop("lookupdiv"),$("#chartOptions").next("#dropDownMenu").hide();else if("addtoDashboard"===l.actionItem)$("#lookupdiv").html(e),t.css("z-index","30"),showFreezeLayer(),crmReports.animatepopFromTop("lookupdiv"),$("#chartOptions").next("#dropDownMenu").hide();else if("deleteChart"===l.actionItem&&"SUCCESS"===e)$("#chartdiv").html(""),$("#parentChartDiv").hide(),$("#addChart").css("display",""),$(".chartOptionsDummy").css("display","none");else if("updatedashboardsettings"!==a.actionItem&&"replacedashboarditem"!==a.actionItem||"SUCCESS"!==e)if("run"===l.actionItem)crmReports.isRepScrolled=!1,$("#show").html(e),setTimeout((function(){crmReports.setHeightWidth(!1,!0),u||(a.orgCalleeObj=a.calleeObj,a.calleeObj="crmDummy",Crm.addToHistory(void 0,void 0,a))}),200);else if("newScheduler"===a.clickId)$("#reportMain").html(e),crmReports.doScheduleConf("U"),crmReports.setHeightWidth(!1),u||(a.orgCalleeObj=a.calleeObj,a.calleeObj="crmDummy",Crm.addToHistory(void 0,void 0,a));else if("newReport"===a.clickId||"newReport"===l.actionItem)$("#show").html(e),crmReports.setHeightWidth(!1),u||(crmReports.currentFolder&&-1==crmReports.currentFolder.search("REPORTS")&&($("#selFolder").text($("#folder_"+crmReports.currentFolder).text()),$("#folder").val(crmReports.currentFolder)),a.orgCalleeObj=a.calleeObj,a.calleeObj="crmDummy",Crm.addToHistory(void 0,void 0,a)),thirdPartyUtils.bindSelect2($(".newSelect").find("select"));else if("getFolderReports"===a.clickId){$(".folderListul li").removeClass("ClickedFolder"),$("#folder_"+crmReports.currentFolder).addClass("ClickedFolder").children("div").append($("#selectedReport")),$(".ReportHeader").attr("rep-data",crmReports.currentFolder),$("#reportMain").html(e),$(".rep_centercontainer").addClass("pR20"),crmReports.setHeightWidth(!1),crmReports.selectFavReports();var r=$("#folder_"+crmReports.currentFolder).find(".listText").text();$(".ReportHeader").html($ESAPI.encoder().encodeForHTML(r)),$("#curSearchFolder").html($ESAPI.encoder().encodeForHTML(r)).attr("title",r),$("#searchReport").attr("placeholder",I18n.getMsg("crm.report.search.reports",r))}else"customize"===l.actionItem?($("#show").html(e),crmReports.setHeightWidth(!1),"summary"===l.repType||"tabular"===l.repType?$("#reportSelectColumns").show():$("#reportMatrixGrouping").show(),$("#repCriteria").show(),$("#selFolder").text($("#folder_"+$("#folder").val()).text()),$(".rep_borderavail,.report_tabforfilter").stop(),$(".rep_borderavail").width($("#tabForRepresentation").find(".tabforreportliactive").outerWidth()),setTimeout((function(){$("#reportMain").width(parseInt($(window).width())-parseInt($("#reportLeftPanel").outerWidth()))}),30),$(".rep_borderavail,.report_tabforfilter").stop(),$(".report_tabforfilter").css("left","0px").width($("#tabForFilter").find(".tabforreportliactive").outerWidth())):($("#show").html(e),$("[name=reportName]").length>0&&$("[name=reportName]").focus(),u||(a.orgCalleeObj=a.calleeObj,a.calleeObj="crmDummy",Crm.addToHistory(void 0,void 0,a)));else crmReports.animatepopFromTop("lookupdiv"),hideFreezeLayer(),crmui.showMsgBand("success",a.displayMsg,"2000","")},error:function(e){if(commonUtils.showHideLoadingDiv(),555==e.status&&e.responseText){var t=e.responseText.split("###");2===t.length?(renderingUtils.displayErrorDiv(t[1],void 0,t[0]),$("#"+t[1]).focus()):(alert(e.responseText),$("#lookupdiv").hide(),removeFreezeLayer())}}})},clickHandler:function(e,t,a){if(this.clickEventIdVsMethodMapping[a]){var r=JSON.parse($(t).attr("data-params"));return r.calleeObj="crmReports",r.clickId=a,$(t).attr("data-params",JSON.stringify(r)),Lyte.registeredMixins["crm-utilities"].executeFunctionByName(this.clickEventIdVsMethodMapping[a],window,e,t),!1}return!0},toggleReport:function(){var e=getObj("reportSideBar1"),t=getObj("reportSideBarOpen"),a=getObj("reportSideBarClose");"none"==t.style.display?(e.className="reportSideBarOpen",t.style.display="block",a.style.display="none"):(e.className="reportSideBarClose",t.style.display="none",a.style.display="block"),cookieUtils.updateCookie("rpo","none"),getObj("drillDownPtr")&&anchorObj&&(getObj("drillDownPtr").style.left=findPosX(anchorObj)-22)},getFolderReports:function(e,t){var a=JSON.parse($(t).attr("data-params"));crmReports.currentFolder=a.folderId?a.folderId:a.view,$("#folder_"+crmReports.currentFolder).is("[data-hiddenfolder]")||$(".folderListul .fL[data-hiddenFolder=true]").remove();var r={};r.sortColumn=crmReports.sortColumn,r.folderName=$("#folder_"+crmReports.currentFolder).find(".listText").text(),r.sortOrder=crmReports.sortOrder,Lyte.Router.transitionTo({route:"crm.tab.reports.index",queryParams:{folder:crmReports.currentFolder}}).data=r},renderReports:function(){$(".folderListul li").removeClass("ClickedFolder"),$("#folder_"+crmReports.currentFolder).addClass("ClickedFolder").children("div").append($("#selectedReport")),$(".ReportHeader").attr("rep-data",crmReports.currentFolder),$(".rep_centercontainer").addClass("pR20"),crmReports.setHeightWidth(!1),crmReports.selectFavReports();var e=$("#folder_"+crmReports.currentFolder).find(".listText").text();$(".ReportHeader").html($ESAPI.encoder().encodeForHTML(e)),$("#curSearchFolder").html($ESAPI.encoder().encodeForHTML(e)).attr("title",e),$("#searchReport").attr("placeholder",I18n.getMsg("crm.report.search.reports",e)),"REPORTNAME"===crmReports.sortColumn&&"SCHEDULEDREPORTS"!=crmReports.currentFolder&&"FAVOURITESREPORTS"!=crmReports.currentFolder&&crmReports.sortTable(crmReports.sortOrder,1)},setreportExpandCollapse:function(){var e=cookieUtils.getCookie("rpo"),t=getObj("reportSideBar1"),a=getObj("reportSideBarOpen"),r=getObj("reportSideBarClose");"none"===e?(t.className="reportSideBarClose",a.style.display="none",r.style.display="block"):(t.className="reportSideBarOpen",a.style.display="block",r.style.display="none")},processingImage:function(e){$("#"+e).find(".Downstatus").find("span").text(I18n.getMsg("crm.report.export.alert.h1")),$("#"+e).find(".Downstatus").find("img").remove(),$("#"+e).find(".cancellink").hide(),$("#"+e).find(".slidercontainer").show();var t=0;!function r(){setTimeout((function(){$("#"+e).find(".cancellink").text()!=a?($("#"+e).find(".slidercolor").css({width:"30px",left:t+"px"}),r(),160==t&&(t=0,1),t+=10):$("#"+e).find(".slidercolor").css({width:"inherit",left:"0px"})}),100)}();var a=I18n.getMsg("crm.view.attachment.download")},showDownloadlink:function(e,t){var a,r=I18n.getMsg("crm.view.attachment.download");"block"==$(".sumplusdiv").css("display")?((a=$("#EXPORTPOP1")).find(".chatContainer").show(300),a.find(".sumplusdiv").hide(),a.find(".summinusdiv").show(),$("#EXPORTPOP1 .ChatContains").css("overflow-y","scroll"),setTimeout((function(){$("#"+e).find(".slidercontainer").show("slow",(function(){$(this).find(".slidercolor").css("width","inherit"),$(this).find(".slidercolor").css("left","0")})),$("#"+e).find(".cancellink").text(r).show(),$("#"+e).find(".cancellink").attr("href",t),$("#"+e).find(".cancellink").addClass("downloadlink_report"),$("#"+e).find(".cancellink").removeClass("cancellink"),$("#"+e).find(".Downstatus").find(".slidercontainer").remove(),$("#"+e).find(".Downstatus").find("span").remove()}),200)):((a=$("#"+e).find(".Downstatus")).find("span").text(I18n.getMsg("crm.report.export.alert.h1")),a.find("img").remove(),setTimeout((function(){$("#"+e).find(".slidercontainer").show("slow",(function(){$(this).find(".slidercolor").css("width","inherit"),$(this).find(".slidercolor").css("left","0")})),$("#"+e).find(".cancellink").text(r).show(),$("#"+e).find(".cancellink").attr("href",t),$("#"+e).find(".cancellink").addClass("downloadlink_report"),$("#"+e).find(".cancellink").removeClass("cancellink"),a.find(".slidercontainer").remove(),a.find("span").remove()}),200))},showTrendsReport:function(){if(Lyte.Component.registeredComponents["crm-trends"])store.findAll("trend",{org:"false"},!1,!1).then((function(e){if(null!=e.trend[0]&&null!=e.trend[0].code)crmui.showMsgBand("error",I18n.getMsg("crm.massmail.triggeraction.tracking.message"),3e3);else{var t=0,a=0,r=!0,i=null;null!=e.meta&&"Yesterday"==(i=Utils.getDisplayDateTime(new Date(e.meta.last_synced_time),!0))&&(i=getFormattedDate(e.meta.last_synced_time)),(null==e.trend[0]&&null==e.trend[1]&&null==e.trend[2]||0==e.trend[0].word_trends.length&&0==e.trend[0].customer_trends.length&&0==e.trend[1].word_trends.length&&0==e.trend[1].customer_trends.length&&0==e.trend[2].word_trends.length&&0==e.trend[2].customer_trends.length)&&(r=!1),null!=e.trend[0]&&null!=e.trend[0].word_trends&&(t=e.trend[0].word_trends.length),null!=e.trend[0]&&null!=e.trend[0].customer_trends&&(a=e.trend[0].customer_trends.length),Lyte.Component.render("crm-trends",{finalResp:e.trend,templateData:e.trend[0],word_trends:t,customer_trends:a,isTrends:r,syncedTime:i},"#trendsData\t")}}));else{var e=networkUtils.returnDependencyFiles(["crm-trends.js"],crmConstants.jsStaticPathForLyte);if(Crm.userDetails.RTL_ENABLED)var t=networkUtils.returnDependencyFiles(["crm-trends.css","crm-trends-rtl.css"],crmConstants.cssStaticPathForLyte);else t=networkUtils.returnDependencyFiles(["crm-trends.css"],crmConstants.cssStaticPathForLyte);var a=["/crm/javascript/"+networkUtils.getI18nJSUrl("emailtrends")],r=e.concat(t).concat(a);Lyte.injectResources(r,void 0,(function(){store.findAll("trend",{org:"false"},!1,!1).then((function(e){if(null!=e.trend[0]&&null!=e.trend[0].code)crmui.showMsgBand("error",I18n.getMsg("crm.massmail.triggeraction.tracking.message"),3e3);else{var t=0,a=0,r=!0,i=null;null!=e.meta&&"Yesterday"==(i=Utils.getDisplayDateTime(new Date(e.meta.last_synced_time),!0))&&(i=getFormattedDate(e.meta.last_synced_time)),(null==e.trend[0]&&null==e.trend[1]&&null==e.trend[2]||0==e.trend[0].word_trends.length&&0==e.trend[0].customer_trends.length&&0==e.trend[1].word_trends.length&&0==e.trend[1].customer_trends.length&&0==e.trend[2].word_trends.length&&0==e.trend[2].customer_trends.length)&&(r=!1),null!=e.trend[0]&&null!=e.trend[0].word_trends&&(t=e.trend[0].word_trends.length),null!=e.trend[0]&&null!=e.trend[0].customer_trends&&(a=e.trend[0].customer_trends.length),Lyte.Component.render("crm-trends",{finalResp:e.trend,templateData:e.trend[0],word_trends:t,customer_trends:a,isTrends:r,syncedTime:i},"#trendsData\t")}}))}))}},reportaddChart:function(e){var t=$(e).find("option:selected").val(),a=$("#addC");if($("#displayContent_header").remove(),"none"==t)return $(".dashboardChart").hide(),$("#reportChartname").hide(),a.val("Add"),void a.prop("disabled",!0);var r=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=getCountOfDashboardItems&isload=true&dashbrdid="+t;mR(r,(function(e){if("SUCCESS"==e)$(".dashboardChart").fadeOut(0),$("#reportChartname").fadeIn(100),a.removeClass("op5").prop("disabled",!1),a.val("Add");else{a.val("Replace"),a.prop("disabled",!0);var t={objects:JSON.parse(e)};$("#replacechart").html(crmReports.selectchartcon(t)),$(".dashboardChart").fadeIn(200),$("#reportChartname").fadeIn(100)}}))},selectChart:function(e){$(".reportChartsample").removeClass("sel"),$(e).parent().children().find(".reportChartsample").removeClass("selectedChart").addClass("op5"),$(e).parent().children().find(".reportChartsample .chartselectedMark").remove(),$(e).children(".reportChartsample").addClass("selectedChart").removeClass("op5").append('<span class="chartselectedMark"></span>'),$("#addC").removeClass("op5").prop("disabled",!1),$("#reportChartname").fadeIn(100).find("input").select(),$(".popup-model-content").animate({scrollTop:$("#reportChartname").offset().top}),$(e).find(".reportChartsample").addClass("sel")},updatetodashboard:function(e){var t=$("#header"),a=$("#displayContent_header");if(a.length&&$(a.remove()),!t.attr("data-default")){var r=t.val();if(1==CrmDashboard.specialcharcheck(r))return $(document.addtodashboard.header).addClass("errFieldBdr_rep").focus(),renderingUtils.displayErrorDiv("header",void 0,I18n.getMsg("crm.alert.label.special.characters")),t.focus(),!1;if(!emptyCheck("header",I18n.getMsg("crm.component.name"),void 0,void 0,"inline"))return t.focus(),!1}if($(".reportChartsample").hasClass("selectedChart"))var i=$(".selectedChart").attr("value");var o=$("#addC").attr("value");"Replace"==o&&$("#action").val("replacedashboarditem");var s,n=formData2QueryString(e)+crmReports.csrf(),l="";"Add"==o?(s="updatedashboardsettings",l="Added to dashboard successfully",n+="&isload=true"):(n=n+"&dbitemid="+i+"&isload=true",s="replacedashboarditem",l="Added to dashboard successfully");var d={actionItem:s,clickId:"customizeReport",displayMsg:l};return crmReports.loadReports(void 0,void 0,d,n),!1},showExportReportProcess:function(e,t){var a;(crmReports.newkey++,"block"==$(".sumplusdiv").css("display")&&$("#EXPORTPOP1").find(".chatContainer").show("slow"),1!=crmReports.newkey)?((a=$(Handlebars.templates.ExportPopUp()).find(".chatContainer").clone()).css("border-top","1px solid #ddd"),a.attr("id",e),a.find(".ExportReportFileName").html(t),$("#EXPORTPOP1 .ChatContains").append(a)):((a=$(Handlebars.templates.ExportPopUp())).find(".chatContainer").attr("id",e),a.css("bottom","0px"),a.attr("id","EXPORTPOP"+crmReports.newkey),a.find(".ExportReportFileName").html(t),$("body").append(a),$("#EXPORTPOP1").slideToggle({direction:"up"},4e3))},showStatusBasedResult:function(e,t,a){if("string"==typeof e&&(e=JSON.parse(e)),t)e&&-1==e.UniqueID&&!e.EXPORT_STATUS&&exportReport("csv");else{var r=e.UniqueID;if("undefined"!=typeof Storage){var i=localStorage.getItem(crmReports.exportReports);i||(i="{}"),i=JSON.parse(i),e.MODIFIEDTIME=(new Date).getTime(),i[r]=e,localStorage.setItem(crmReports.exportReports,JSON.stringify(i))}crmReports.showCommonMsg(r,e)}},showCommonMsg:function(e,t){var a="chatcontain"+e,r=t.ReportName,i=getObj(a),o=null!=i&&i;if("EXPORT_CREATED"===t.EXPORT_STATUS){if(o)return;crmReports.showExportReportProcess(a,r)}else if("EXPORT_RUNNING"===t.EXPORT_STATUS)o||crmReports.showExportReportProcess(a,r),crmReports.processingImage(a);else if("EXPORT_FINISHED"===t.EXPORT_STATUS){o||(crmReports.showExportReportProcess(a,r),crmReports.processingImage(a));var s=Crm.getCrmBasePath()+"/downloadExportReport?parentId="+t.ReportID+"&fileType=csv&module=ExportReport&fileId="+t.UniqueID;t.isDownloadVCard&&(s=Crm.getCrmBasePath()+"/downloadVCard?moduleName="+t.ModuleName+"&fileType=vcf&module=DownloadVCard&fileId="+t.UniqueID),crmReports.showDownloadlink(a,s)}},clearAPopupDiv:function(e){if(crmReports.newkey>0?crmReports.newkey--:crmReports.newkey=0,"undefined"!=typeof Storage){var t=localStorage.getItem(crmReports.exportReports);t&&((t=JSON.parse(t))[e]="",localStorage.setItem(crmReports.exportReports,JSON.stringify(t)))}1==$("#EXPORTPOP1").find(".chatContainer").length?(crmReports.newkey=0,$("#EXPORTPOP1").remove()):$("#chatcontain"+e).remove()},deleteChart:function(e,t){var a=I18n.getMsg("crm.confirm.sure");if(window.confirm(a)){var r=JSON.parse($(t).attr("data-params"));r.clickId="customizeReport",r.crmcsrfparam=encodeURIComponent($('input[name="crmcsrfparam"]').val()),crmReports.loadReports(e,t,r),$("#addChart").show(),$("#chartOptions").hide().next("#dropDownMenu").hide()}},showChart:function(e){commonUtils.showHideLoadingDiv(),crmReports.animatepopFromTop("lookupdiv"),$("#parentChartDiv").show(),$("#chartdiv").length&&CrmDashboard.createChart("chartdiv",e,!0),$("#addChart").css("display","none");var t=$('[data-cid="deleteChart"]').eq(0),a=JSON.parse(t.attr("data-params"));a.chartId=e.chartId,t.attr("data-params",JSON.stringify(a))},saveChart:function(e){if(0===$('select[name="series"]:visible').length)$('select[name="series"]').val("");else if($('select[name="series"]:visible').val()===$('select[name="xaxis"]').val())return renderingUtils.displayErrorDiv("series",void 0,I18n.getMsg("crm.chart.similar.grouping.error"),$("#series").parent()[0]),!1;var t=$("#xAxisSel");if(!t.val())return renderingUtils.displayErrorDiv("xaxis",void 0,I18n.getMsg("crm.alert.valid.xaxis"),t.closest(".labelVal")[0]),!1;var a=formData2QueryString(e)+crmReports.csrf()+"&isload=true";return crmReports.loadReports(void 0,void 0,{actionItem:"updateChartAndRun",clickId:"customizeReport"},a),$("#addChart").hide(),$("#chartOptions").show(),!1},chooseSearch:function(e,t){var a=e.children;$("#isCurrentFolderSearch").val(t),$("#searchReport").attr("placeholder",I18n.getMsg("crm.report.search.reports",$(a[1]).text())),$("#searchRepFolder .selecttick").removeClass().addClass("unselecttick"),$(a[0]).removeClass().addClass("selecttick"),$("#searchRepFolder").hide()},initReportConf:function(e,t){crmReports.currentFolder=e,$(".folderListul #folder_"+e).addClass("ClickedFolder");var a=$(".folderListul #folder_"+e+" div .listText").html(),r=$(".ReportHeader");r.html(a),r.attr("data-zcqa",a),$("#curSearchFolder").html(a),$("#searchReport").attr("placeholder",I18n.getMsg("crm.report.search.reports",a)),crmReports.selectFavReports();var i=$("#repFolders").offset().top+$("#repFolders").height();$(".folderListul #folder_"+crmReports.currentFolder).offset().top>i?$("#repFolders").animate({scrollTop:$(".folderListul #folder_"+crmReports.currentFolder).offset().top-i+70},10):$("#repFolders").animate({scrollTop:75},10),0==$("#displayFolderReports tr").length&&$("#delRepChk").hide(),"REPORTNAME"===crmReports.sortColumn&&"FAVOURITESREPORTS"!==e&&"RECENTREPORTS"!==e&&crmReports.sortTable(crmReports.sortOrder,1)},getReports:function(e,t,a,r,i,o){if($(".notfromschedule").scrollTop()>0?($(".notfromschedule").scrollTop()+$(".notfromschedule").height()>=$(".notfromschedule")[0].scrollHeight-70?$("#reportsConta").css("height",parseInt($(window).height()-$("#tabLayer").offset().top)-235):($("#reportsConta").hasClass("noneedbrdr")?$("#reportsConta").css("height",parseInt($(window).height()-$("#tabLayer").offset().top)-235):$("#reportsConta").css("height",parseInt($(window).height()-$("#tabLayer").offset().top)-220),$(".notfromschedule").removeClass("pB30").addClass("pB50")),$("#scrollTopDiv").fadeIn(),$("#scrollTopDiv").find(".zc-scrollTop").addClass("active")):($("#scrollTopDiv").find(".zc-scrollTop").removeClass("active"),$("#scrollTopDiv").fadeOut()),a){if("FAVOURITESREPORTS"!==t&&"RECENTREPORTS"!==t){var s=$("#searchReport").val(),n=$("#displayFolderReports tr").length;!crmReports.madeRequest&&$("#displayFolderReports tr").length%200==0&&$(e).scrollTop()>=$(e).get(0).scrollHeight-$(e).get(0).clientHeight-200&&(clearTimeout(crmReports.timerValue),crmReports.timerValue=setTimeout((function(){crmReports.madeRequest=!0;var e=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=getReportsOnScroll&isload=true&searchText="+s+"&sortColumn="+crmReports.sortColumn+"&sortOrder="+crmReports.sortOrder+"&folderId=";e=-1!=t.search("REPORTS")?e+"&view="+t+"&fromRange="+n:e+t+"&view=FOLDER&fromRange="+n,mR(e,(function(e){var a={objects:JSON.parse(e)};r?$("#displayFolderReports tbody").append(crmReports.chooseReportTmp(a)):($("#delRepChk").show(),$("#displayFolderReports tbody").append(crmReports.reportTemplate(a)),"TRASHREPORTS"!=t&&0==$("#createRepBtn").length&&$(".EditDeleteIcon").remove(),crmReports.selectFavReports(),$(".rep_centercontainer").addClass("pR20"),crmReports.setHeightWidth(!1)),crmReports.madeRequest=!1}))}),200))}}else{crmReports.currentFolder=t;var l=Lyte.Router.getRouteInstance().getQueryParams();if(l&&l.folder==t)return Lyte.Router.getRouteInstance().refresh(),!1;$(".folderListul li").removeClass("ClickedFolder"),$(e).addClass("ClickedFolder"),$(e).children("div").append($("#selectedReport")),$(".ReportHeader").attr("rep-data",crmReports.currentFolder);var d={};d.sortColumn=crmReports.sortColumn,d.folderName=$(e).find(".listText").text(),d.sortOrder=crmReports.sortOrder,i&&(d.folderAcsrType=i),Lyte.Router.transitionTo({route:"crm.tab.reports.index",queryParams:{folder:crmReports.currentFolder}}).data=d}},markAsFavorite:function(e,t){Crm.getCrmBasePath();if(-1==$(t).attr("class").search("yellowStarIcon")){if(crmReports.favouriteReports.split(",").length+(crmReports.selectedFavReports&&""!=crmReports.selectedFavReports?crmReports.selectedFavReports.split(",").length:0)-(crmReports.removedFavReports&&""!=crmReports.removedFavReports?crmReports.removedFavReports.split(",").length:0)>=25)return void alert(I18n.getMsg("crm.alert.favorite.report.maxlimit"));$("#report_"+e+" .graystaricon").removeClass("graystaricon").addClass("yellowStarIcon"),-1==crmReports.favouriteReports.search(e)&&(crmReports.selectedFavReports=crmReports.selectedFavReports&&-1==crmReports.selectedFavReports.search(e)?crmReports.selectedFavReports+","+e:e),crmReports.removedFavReports=crmReports.removeReport(crmReports.removedFavReports,e)}else $("#report_"+e+" .yellowStarIcon").removeClass("yellowStarIcon").addClass("graystaricon"),-1!==crmReports.favouriteReports.search(e)&&(crmReports.removedFavReports=crmReports.removedFavReports&&-1==crmReports.removedFavReports.search(e)?crmReports.removedFavReports+","+e:e),crmReports.selectedFavReports=crmReports.removeReport(crmReports.selectedFavReports,e);clearTimeout(crmReports.timerValue),crmReports.timerValue=setTimeout((function(){crmReports.updateFavouriteReports()}),2e3)},searchReport:function(e,t,a){var r;9!=(r=t.which)&&91!=r&&17!=r&&16!=r&&18!=r&&20!=r&&(r<33||r>40)&&144!=r&&145!=r&&(clearTimeout(crmReports.timerValue),crmReports.timerValue=setTimeout((function(){var t=$(e).val();t=t.trim();var r=crmReports.searchDefaultReports(t),i=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=searchReports&isload=true&searchText="+encodeURIComponent(t)+"&sortColumn="+crmReports.sortColumn+"&sortOrder="+crmReports.sortOrder;i=r?i+"&searchrepIds="+r:i,"false"==$("#isCurrentFolderSearch").val()&&t.length>0?(a?$("#tmprepFolders li").removeClass("ClickedFolder"):$("#folderList li").removeClass("ClickedFolder"),i+="&currentView=ALLREPORTS"):(a?$("#tmprepFolders #folder_"+crmReports.currentFolderForChoose).addClass("ClickedFolder"):$("#folderList #folder_"+crmReports.currentFolder).addClass("ClickedFolder"),i=a?i+"&fromSchedule=true&currentView="+crmReports.currentFolderForChoose:i+"&currentView="+crmReports.currentFolder),mR(i,(function(e){var t=JSON.parse(e),r={objects:t};t&&0!=t.length?(a?$("#displayFolderReports tbody").html(crmReports.chooseReportTmp(r)):($("#delRepChk").show(),"FAVOURITESREPORTS"===crmReports.currentFolder?$("#displayFolderReports tbody").html(crmReports.favReportTemplate(r)):"TRASHREPORTS"===crmReports.currentFolder?$("#displayFolderReports tbody").html(crmReports.trashReportTmp(r)):($("#displayFolderReports tbody").html(crmReports.reportTemplate(r)),0==$("#createRepBtn").length&&$(".EditDeleteIcon").remove()),$("#reportsConta").scrollTop(0),crmReports.selectFavReports()),"REPORTNAME"===crmReports.sortColumn&&crmReports.sortTable(crmReports.sortOrder,a?0:1),$("#noreportsFound").hide()):($("#delRepChk").hide(),$("#displayFolderReports tbody").empty(),0==$("#displayFolderReports tbody tr").length?($("#delReportFrmList,#moveReportFrmList").addClass("deleteBtnforReportdisabled"),$("#noreportsFound").show()):($("#delReportFrmList,#moveReportFrmList").removeClass("deleteBtnforReportdisabled"),$("#noreportsFound").hide()))})),setTimeout((function(){crmReports.descSeemoreShow()}),400)}),300))},getReportsToChoose:function(e,t){$("#tmprepFolders .folderListul li").removeClass("ClickedFolder"),$(e).addClass("ClickedFolder"),crmReports.currentFolderForChoose=t,$(e).children("div").append($("#choose_selectedReport"));var a=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=getReports&isload=true&fromSchedule=true&sortColumn="+crmReports.sortColumn+"&sortOrder="+crmReports.sortOrder+"&folderId=";a=-1!=t.search("REPORTS")?a+"&view="+t:a+t+"&view=FOLDER",mR(a,(function(t){$("#chooseReportMain").html(t);var a=$(e).find(".listText").text();$("#chooseReportsTitle,#curSearchFolder").html($ESAPI.encoder().encodeForHTML(a))}))},reorderFavReport:function(){$("#displayFolderReports .DragIconArray").show(),$("#displayFolderReports").css({"table-layout":"auto"}),$("#reorderCancel,#saveFavReport").show(),$("#reorderBtn,.yellowStarIcon").hide(),$("#displayFolderReports").find("tbody").find("td").each((function(e){$(this).width($(this).width())})),$("#displayFolderReports td").removeAttr("onmouseenter onmouseleave data-cid").find("a").removeAttr("data-cid href data-params"),$("#displayFolderReports").find("tbody").sortable({start:function(e,t){$(this).find("td").each((function(e){$(this).width($(this).width())}))},axis:"y",stop:function(e,t){$(this).find("td").each((function(e){$(this).width($(this).width())}))}}),$("#displayFolderReports").css("border-collapse","collapse")},saveFavReportOrder:function(e){if($("#saveFavReport,#reorderCancel").hide(),$("#reorderBtn").show(),$("#displayFolderReports .DragIconArray").hide(),$(".yellowStarIcon").show(),$("#displayFolderReports").css("border-collapse","").find("tbody").sortable("destroy"),"cancel"!==e){for(var t="",a=$("#displayFolderReports tr .yellowStarIcon"),r=a.length,i=0;i<r;i++){var o=$(a[i]).attr("id").split("_")[1];t=0==i?o:t+","+o}var s=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=updFavSequence";t&&(s=s+"&favIds="+t);var n=crmReports.csrf()+"&isload=true";mR(s,(function(e){"limit exists"===e&&alert(I18n.getMsg("crm.alert.favorite.report.maxlimit")),crmReports.favouriteReports=e,crmReports.selectedFavReports="",crmReports.removedFavReports="",crmReports.selectFavReports()}),n,"","false")}else crmReports.getReports($("#folder_"+crmReports.currentFolder),crmReports.currentFolder,!1,!1,null)},updateFavouriteReports:function(){var e=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=updFavReport";e=crmReports.selectedFavReports?e+"&favIds="+crmReports.selectedFavReports:e,e=crmReports.removedFavReports?e+"&removedIds="+crmReports.removedFavReports:e;var t=crmReports.csrf()+"&isload=true";mR(e,(function(e){"limit exists"===e&&alert(I18n.getMsg("crm.alert.favorite.report.maxlimit")),crmReports.favouriteReports=e,crmReports.selectedFavReports="",crmReports.removedFavReports="",crmReports.selectFavReports()}),t,"","false")},sortReports:function(e,t,a){if("FAVOURITESREPORTS"===crmReports.currentFolder||"RECENTREPORTS"===crmReports.currentFolder)return!1;if(crmReports.sortColumn=e,$("#sort_"+e).length>0){$(".dropdownarr").hide();var r=$("#sort_"+e).attr("class");crmReports.sortOrder=!1,""==r||"dropdownarr"==r?($("#sort_"+e).addClass("dropdownarr dropdownarr180").show(),crmReports.sortOrder=!0):$("#sort_"+e).removeClass("dropdownarr180").addClass("dropdownarr").show()}var i=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=sortListView&isload=true&sortColumn="+crmReports.sortColumn+"&sortOrder="+crmReports.sortOrder;if("false"==$("#isCurrentFolderSearch").val()?(a?$("#tmprepFolders li").removeClass("ClickedFolder"):$("#folderList li").removeClass("ClickedFolder"),i+="&currentView=ALLREPORTS"):(a?$("#tmprepFolders #folder_"+crmReports.currentFolderForChoose).addClass("ClickedFolder"):$("#folderList #folder_"+crmReports.currentFolder).addClass("ClickedFolder"),i=a?i+"&fromSchedule=true&currentView="+crmReports.currentFolderForChoose:i+"&currentView="+crmReports.currentFolder),"TRASHREPORTS"!=crmReports.currentFolder){var o=$("#searchReport").val(),s=crmReports.searchDefaultReports(o);i=o?i+"&searchText="+o:i+"",i=s?i+"&searchrepIds="+s:i}mR(i,(function(e){var t={objects:JSON.parse(e)};a?$("#displayFolderReports tbody").html(crmReports.chooseReportTmp(t)):("TRASHREPORTS"===crmReports.currentFolder?$("#displayFolderReports tbody").html(crmReports.trashReportTmp(t)):($("#displayFolderReports tbody").html(crmReports.reportTemplate(t)),crmReports.selectFavReports()),"TRASHREPORTS"!=crmReports.currentFolder&&0==$("#createRepBtn").length&&$(".EditDeleteIcon").remove()),"REPORTNAME"===crmReports.sortColumn&&crmReports.sortTable(crmReports.sortOrder,a?0:1),setTimeout((function(){crmReports.descSeemoreShow()}),30)}),"","","false")},doRunConfChange:function(e){$("#reportLeftPanel").hide(),e||crmReports.setHeightWidth(!1,1),$(".rep_centercontainer").removeClass("pR20"),$(".rep_displayingReports").css("min-height",$(window).height()-($(".LeadsConverstaionmenu").outerHeight()+$(".reportTotalrecCount").outerHeight()+130))},doScheduleConf:function(e){0==$("#recipients"+e+" li").length?$("#recUnSelectedEmptyUL").show().css({"margin-left":$("#availableRecipients").width()/2-$("#recUnSelectedEmptyUL").width()/2,"margin-top":$("#availableRecipients").height()/2-$("#recUnSelectedEmptyUL").height()/2}):$("#recUnSelectedEmptyUL").hide(),6==$("#selectedRecipients li").length?$("#recipientsEmptyUL").show().css({"margin-left":$("#selectedRecipients").width()/2-$("#recipientsEmptyUL").width()/2,"margin-top":$("#selectedRecipients").height()/2-$("#recipientsEmptyUL").height()/2}):$("#recUnSelectedEmptyUL").hide(),1==$("#selectedRecipients"+e+" li").length&&$("#selectedRecipients"+e).hide()},csrf:function(){return csrfParamName+"="+encodeURIComponent(csrfToken)},selectFavReports:function(){if(crmReports.favouriteReports&&"null"!=crmReports.favouriteReports)for(var e=crmReports.favouriteReports.split(","),t=0;t<e.length;t++)$("#favIcon_"+e[t]).removeClass().addClass("fL yellowStarIcon")},removeReport:function(e,t){return e?e=-1!=e.search(","+t)?e.replace(","+t,""):-1!=e.search(t+",")?e.replace(t+",",""):e.replace(t,""):""},searchDefaultReports:function(e){var t="";e=e.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&");for(var a=0;a<crmReports.defaultReports.length;a++){var r=crmReports.defaultReports[a],i=r.reportName,o=r.description;(o&&-1!=o.toUpperCase().search(e.toUpperCase())||-1!=i.toUpperCase().search(e.toUpperCase()))&&(t=""!=t?t+","+r.reportId:r.reportId)}return t},sortTable:function(e,t){var a=$("#displayFolderReports tbody tr").get();a.sort((function(a,r){var i=$(a).children("td").eq(t).text().toUpperCase(),o=$(r).children("td").eq(t).text().toUpperCase();if(e){if(i<o)return-1;if(i>o)return 1}else{if(i<o)return 1;if(i>o)return-1}return 0})),$.each(a,(function(e,t){$("#displayFolderReports").children("tbody").append(t)}))},sortReportColumn:function(e){crmReports.reqSent||(crmReports.reqSent=!0,mR(e+="&isload=true",(function(e){$("#reportMain").html(e),crmReports.doRunConfChange(),crmReports.reqSent=!1}),crmReports.csrf()))},showOrHideDetails:function(e){document.NewReport.showDetails.value=e,document.NewReport.actionItem.value="run";var t=Crm.getCrmBasePath()+"/specific/CustomReport.do";t=t+"?"+formData2QueryString(document.NewReport),mR(t,(function(e){$("#reportMain").html(e),crmReports.doRunConfChange(),$(".reportHideRightside").css("display"," block")}),crmReports.csrf(),"","false")},navigateReport:function(e){e=-1==e.search("actionItem")?e+"&actionItem=run&isload=true":e,mR(e,(function(e){$("#reportMain").html(e),crmReports.isRepScrolled=!1,crmReports.doRunConfChange()}),crmReports.csrf())},checkDeleteReport:function(e,t){if(!t&&0==$(".EditDeleteIconchecked").length&&0!=$("#delRepChk").length&&!$("#delRepChk").hasClass("EditDeleteIconchecked"))return alert("select atleast one report"),!1;var a="";if($("#delRepChk")&&$("#delRepChk").hasClass("EditDeleteIconchecked"))a="&isAllReports=true&currentFolder="+crmReports.currentFolder;else if(e&&e.length>0||1==$(".EditDeleteIconchecked").length){var r=$("#NewReport #reportName").length>0?$("#reportName").val():$($(".EditDeleteIconchecked").closest("td").siblings()[0]).find("a").html();r=r&&""!=r?r:crmReports.tmpRepName,a="&reportName="+encodeURIComponent(r),a=null==e?a+"&"+formData2QueryString(document.ShowReportsForm):a+"&reportIds="+e}else a="&"+formData2QueryString(document.ShowReportsForm);var i=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=checkRepDeletion&isload=true"+a;(new crmRequestPool).doAjax(i,(function(e){if("object"==typeof e){if(freezeBackground(),$("#repDeleteAlertDiv").show(),$(".EditDeleteIconchecked").length>1?$("#repDeleteHeaderMsg").html(I18n.getMsg("crm.button.deleteReports")):$("#repDeleteHeaderMsg").html(I18n.getMsg("crm.button.deleteReport")),$("#repDeleteMsg").html(e.message),null!=e.othersList){e.othersList;var a=e.othersList.slice(1);e.othersSubList=a,a.length>10&&(e.moreCnt=a.length-10),$("body").append(crmReports.generateOthersList(e)),crmReports.repDeleteAlertList=e.othersList}2===e.code?($("#cancelRepAlertPop").val(I18n.getMsg("crm.button.ok")),$("#deleteRep").hide(),$("#repDeleteAlertDiv .delWarnMsg").removeClass("dN")):($("#repDeleteAlertDiv .delWarnMsg").addClass("dN"),$("#deleteRep").show(),$("#cancelRepAlertPop").val(I18n.getMsg("Cancel")))}"string"==typeof e&&crmReports.gettingReportsAfterDelete(e,t)}),crmReports.csrf(),"","false")},deleteReport:function(e,t,a){crmReports.lastSelectedTab="",removeFreezeLayer(),$(".reportDelTt").remove();var r=t;if(!t||0==t.length){var i=$("#reportId").val();$("#delRepChk")&&$("#delRepChk").hasClass("EditDeleteIconchecked")?r="&isAllReports=true&currentFolder="+crmReports.currentFolder:e&&e.length>0?r="&reportIds="+e:document.ShowReportsForm?r="&"+formData2QueryString(document.ShowReportsForm):i&&(r="&reportIds="+i),"&"===r&&(r="&reportIds="+crmReports.tmpRepId)}var o=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=delete&isload=true"+r;mR(o,(function(e){crmReports.gettingReportsAfterDelete(e,a)}),crmReports.csrf(),"","false")},gettingReportsAfterDelete:function(e,t){crmReports.favouriteReports=e,$("#repDeleteAlertDiv").hide(),t?crmReports.backToCurrentFolder():Lyte.Router.getRouteInstance().refresh(),$(".rep_successmsg span").html(I18n.getMsg("crm.report.delete.sucess")),$(".rep_successmsg").fadeIn(500,(function(){setTimeout((function(){$(".rep_successmsg").fadeOut(300)}),2e3)}))},enableOptions:function(e){var t=$(e);if(t.hasClass("EditDeleteHeaderIconChecked"))return $(".formovereportfolder,.forDeletereport").removeClass("deleteBtnforReportdisabled").prop("disabled",!1),"delRepChk"===t.attr("id")||"emptyTrash"===t.attr("id")?$(".cChecked").addClass("EditDeleteIconchecked").parent().siblings().prop("checked",!0):t.parent().siblings().prop("checked",!0),!1;"delRepChk"===t.attr("id")||"emptyTrash"===t.attr("id")?($(".cChecked").removeClass("EditDeleteIconchecked").prop("disabled",!1).parent().siblings().prop("checked",!1),$(".formovereportfolder,.forDeletereport").addClass("deleteBtnforReportdisabled").prop("disabled",!0)):($("#displayFolderReports .cChecked").length!=$("#displayFolderReports .EditDeleteIconchecked").length?$(".EditDeleteHeaderIcon").removeClass("EditDeleteHeaderIconChecked EditDeleteIconchecked"):$("#displayFolderReports .cChecked").length==$("#displayFolderReports .EditDeleteIconchecked").length&&$(".EditDeleteHeaderIcon").addClass("EditDeleteHeaderIconChecked"),t.hasClass("EditDeleteIcon")&&(t.hasClass("EditDeleteIconchecked")?(t.parent().siblings().prop("checked",!0),$(".formovereportfolder,.forDeletereport").removeClass("deleteBtnforReportdisabled").prop("disabled",!1)):($(".EditDeleteIconchecked").length>=1?$(".formovereportfolder,.forDeletereport").removeClass("deleteBtnforReportdisabled").prop("disabled",!1):$(".formovereportfolder,.forDeletereport").addClass("deleteBtnforReportdisabled").prop("disabled",!0),t.parent().siblings().prop("checked",!1))))},reloadReport:function(e,t){Lyte.Router.getRouteInstance().refresh()},folderOptions:function(e,t,a){if(zctt.hidett(!0),$("#folderList .gear_icon").css("display","none"),$(".menucontainer .gear_icon").removeClass("selectedGear"),$(e).css("display","inline-block").addClass("selectedGear").parents("li").attr("data-hiddenFolder"))$("#repFolderShow").attr("folderId",a).show(),$("#repFolderReorder,#repFolderRename,#repFolderDelete,#repFolderHide").hide(),crmReports.folderOptionsSubFun(e);else if($("#repFolderHide").show().attr("folderId",a),$("#repFolderShow").hide(),$("#repFolderRename").attr("folderId",a),$("#repFolderReorder").show(),t||"Zoho Expense Reports"===$("#folder_"+a).attr("title")||"Zoho Finance Reports"===$("#folder_"+a).attr("title"))$("#repFolderRename,#repFolderDelete").hide(),"ALLREPORTS"===a&&$("#repFolderHide").hide(),crmReports.folderOptionsSubFun(e);else{$("#repFolderRename,#repFolderHide").show();var r=Crm.getCrmBasePath()+"/CustomReportFolder.do?actionItem=checkRepFolderDeletion&isload=true&reportFolderId="+a;mR(r,(function(t){"true"===t?$("#repFolderDelete").show().attr("delFolderId",a):$("#repFolderDelete").hide(),crmReports.folderOptionsSubFun(e)}),crmReports.csrf(),"","false")}},folderOptionsSubFun:function(e){$(".menucontainer .folderOptpopup").show().css({top:$(e).offset().top-25-$("#tabLayer").offset().top,left:$(e).offset().left-20}),$(e).closest("li").addClass("activeRepOpt");var t=$(e).offset().top-30+$(".menucontainer .folderOptpopup").outerHeight();$(".rep_container").height()<t?$(".menucontainer .folderOptpopup").show().css({top:$(e).offset().top-100-$("#tabLayer").offset().top,left:$(e).offset().left+20}).removeClass("popTopleftArrow").addClass("popleftArrow"):$(".menucontainer .folderOptpopup").show().removeClass("popleftArrow").addClass("popTopleftArrow"),0==$("#displayFolderReports tbody tr").length?$("#deleteFolder").show().removeClass("hide"):$(e).parent().children().find(".deleteFolder").addClass("hide")},leftPanelAnimations:function(e){$(e).addClass("mouseOvered"),$(e).hasClass("activeRepOpt")||($("#reportLPFolOpt,.selectedGear").hide(),$(".selectedGear").removeClass("selectedGear"),$(".activeRepOpt").removeClass("activeRepOpt"))},deleteFolder:function(e){var t=e?$(e).attr("delFolderId"):$(".ReportHeader").attr("rep-data"),a=Crm.getCrmBasePath()+"/CustomReportFolder.do?actionItem=delReportFolder&isload=true&reportFolderId="+t;mR(a,(function(e){if($("#folderOptions").hide(),"Report Folder Deleted Successfully"==e){$("#folder_"+t).remove(),$("#folderList .folderListul li:first-child").addClass("ClickedFolder");var a=$("#folderList .folderListul li:first-child").attr("id");crmReports.getReports($("#folderList .folderListul li:first-child"),a.split("_")[1],!1,!1,null),$("#repFolders").scrollTop(0)}else alert(e)}),crmReports.csrf(),"","false")},editFolder:function(e){$("#folderOptions").hide();var t=$("#repFolderRename").attr("folderId"),a=Crm.getCrmBasePath()+"/CustomReportFolder.do?actionItem=editReportFolder&isload=true&reportFolderId="+t;mR(a,(function(e){""!==e?($("#reportLookupDiv").html(e),freezeBackground(),crmReports.animatepopFromTop("reportLookupDiv")):crmReports.displayCustomAlertForDeletedFolder()}),"","","false")},displayCustomAlertForDeletedFolder:function(){$("#custom_alert_popup_report").attr("data-show",!0),$("#custom_alert_msg_report").html(I18n.getMsg("crm.report.deletedFolderAccess.message",[$(".folderListul #folder_"+$("#repFolderRename").attr("folderId")+" div .listText").html()])),$("#alert_title_report").text(I18n.getMsg("crm.report.deletedFolderAccess.title")).show();var e=$("#custom_alert_button_report");showAnimatePopup("custom_alert_popup_report"),$("#custom_alert_button_report").unbind("click"),e.unbind("click").click((function(){Lyte.Router.getRouteInstance().refresh()}))},newFolder:function(e,t){$("#foldersListForMov").hide(),freezeBackground(),t&&$("#showSaveDialog").css("z-index","20"),$("#moveReportFrmList").removeClass("btnClicked");var a=Crm.getCrmBasePath()+"/CustomReportFolder.do?actionItem=newReportFolder&isload=true&fromMove="+e;0!=$("#dummyLiElm").length&&(a=a+"&searchFolderTxt="+$("#searchReportFolder").val()),mR(a,(function(e){$("#reportLookupDiv").html(e),crmReports.animatepopFromTop("reportLookupDiv"),$("#folderName").focus()}))},createFolder:function(e,t){if(removeFreezeLayer(),$("#showSaveDialog").css("z-index",""),"cancel"!==e){if(!emptyCheck("folderName",I18n.getMsg("crm.template.folder.name"))||!checkSplChars("folderName",I18n.getMsg("crm.template.folder.name")))return!1;var a=formData2QueryString(document.NewReportFolderForm);"moveAndCreate"===e&&(a=$("#delRepChk")&&$("#delRepChk").hasClass("EditDeleteIconchecked")?a+"&isAllReports=true&currentFolder="+crmReports.currentFolder:a+"&"+formData2QueryString(document.ShowReportsForm)),a=a+"&selectedAccessObj="+crmReports.folderData;var r=Crm.getCrmBasePath()+"/CustomReportFolder.do?actionItem="+e+"&isload=true&"+a;"updateReportFolder"===e&&(r=r+"&reportFolderId="+t),mR(r,(function(a){crmReports.animatepopFromTop("reportLookupDiv"),"updateReportFolder"===e?($(".ReportHeader").html($("#folderName").val()),$("#folder_"+t+" .listText").html($("#folderName").val()),$("#curSearchFolder").html($("#folderName").val()),crmReports.getReports($("#folder_"+crmReports.currentFolder),crmReports.currentFolder,!1,!1,null)):($("#reportLeftPanel").html(a).resizable("destroy"),crmReports.setHeightWidth(!1),"moveAndCreate"!=e?document.NewReport?($(".ReportHeadermenu1").append("<div id='tmpFolderDiv' style='display:none;'></div>"),$("#tmpFolderDiv").html(a),$("#selFolder").html($("#tmpFolderDiv #folderList .folderListul li:last-child div").html()),$("#folder").val($("#tmpFolderDiv #folderList .folderListul li:last-child div").closest("li").attr("id").split("_")[1]),$("#tmpFolderDiv").remove()):($("#folderList .folderListul li:last-child").addClass("ClickedFolder"),$("#repFolders").scrollTop($("#repFolders").get(0).scrollHeight)):($("#folder_"+crmReports.currentFolder).addClass("ClickedFolder"),$("#delRepChk")&&$("#delRepChk").hasClass("EditDeleteIconchecked")?($("#delRepChk").hide(),$("#displayFolderReports tr").remove(),0==$("#displayFolderReports tbody tr").length?($("#delReportFrmList,#moveReportFrmList").addClass("deleteBtnforReportdisabled"),$("#noreportsFound").show()):$("#noreportsFound").hide()):$(".EditDeleteIconchecked").closest("tr").remove(),$("#repFolders").animate({scrollTop:$(".folderListul #folder_"+crmReports.currentFolder).position().top+40},10)))}),crmReports.csrf(),"","false")}else crmReports.animatepopFromTop("reportLookupDiv")},saveFavFolders:function(e){var t=$(".Leftmenubtns").scrollTop();$(".editReportsLeftNav").hide(0),$(".reportsLeftNav").show(0),$(".rep_leftPar").removeClass("mT50");var a=$("#newReportsBand");if(a.length&&a.show(),"cancel"!==e){for(var r="",i=$("#folderList .Iconchecked"),o=i.length,s=0;s<o;s++){null!==(c=$(i[s]).attr("id"))&&"null"!==c&&""!==c&&(r=0==s?c:r+","+c)}$(".freezeLayer1").hide();var n="",l=$("#deletedFolders").val().split(","),d=l.length;for(s=0;s<d;s++){var c;null!=(c=l[s])&&"null"!==c&&""!==c&&(n=n+","+c)}r+=n;m=Crm.getCrmBasePath()+"/CustomReportFolder.do?actionItem=updFavFolders";var u=crmReports.csrf()+"&isload=true&favIds="+r;mR(m,(function(e){$("#reportLeftPanel").html(e),crmReports.favouriteFolders=r;var a="";a=0!=$("#folder_"+crmReports.currentFolder).length?crmReports.currentFolder:$("#folderList .folderListul li:first-child").attr("id").split("_")[1],$("#folder_"+a).addClass("ClickedFolder"),crmReports.getReports($("#folder_"+a),a,!1,!1,null),$("#reportLeftPanel").resizable("destroy"),$(".listText").css("max-width","90%"),crmReports.setHeightWidth(!1),$(".Leftmenubtns").scrollTop(t)}),u,"","false")}else{$(".freezeLayer1").hide();var m=Crm.getCrmBasePath()+"/CustomReportFolder.do?actionItem=cancelSettings&isload=true";mR(m,(function(e){$("#reportLeftPanel").html(e);var a="";a=0!=$("#folder_"+crmReports.currentFolder).length?crmReports.currentFolder:$("#folderList .folderListul li:first-child").attr("id").split("_")[1],$("#folder_"+a).addClass("ClickedFolder"),crmReports.getReports($("#folder_"+a),a,!1,!1,null),$("#reportLeftPanel").resizable("destroy"),$(".listText").css("max-width","90%"),crmReports.setHeightWidth(!1),$(".Leftmenubtns").scrollTop(t)}),"","","false")}},searchFolder:function(e,t,a){$("#dummyLiElm").remove();var r=$(e).val().toLowerCase();$("#"+t).find("."+a).each((function(e,t){-1!=$(this).text().trim().toLowerCase().indexOf(r)||-1!=$(this).text().trim().toUpperCase().indexOf(r)||-1!=$(this).text().trim().indexOf(r)?$(this).show():$(this).hide()})),0==$("#"+t+" li:visible").length?$("#"+t).append("<li id='dummyLiElm'  style='display: list-item;clear: both;'>"+I18n.getMsg("crm.module.matching.empty.message",I18n.getMsg("crm.template.folder"))+"</li>"):$("#dummyLiElm").remove()},showAllFolders:function(){$("#foldersListForMov").is(":visible")?$("#foldersListForMov").hide():($("#foldersListForMov").show(),$("#searchReportFolder").focus()),thirdPartyUtils.bindPerfectScroll(".movefldulCont",{wheelSpeed:1,wheelPropagation:!0,suppressScrollX:!1,scrollYMarginOffset:5}),$(".movefldulCont").css("overflow","hidden")},showFolders:function(e){var t=$("#folderList ul .repfolder").clone();$(e).addClass("btnClicked"),$.each(t,(function(){if($(this).hasClass("ClickedFolder"))$(this).remove();else{var e=$(this).removeAttr("onclick class").children("div").children("span").text();$(this).removeAttr("data-cid data-params").css("display","block").attr({onclick:"crmReports.moveToFolder(this);sE(event);",class:"crm-font-regular w100per alignleft"}),$(this).html($ESAPI.encoder().encodeForHTML(e))}})),$("#foldersListForMov .movetofolderul").html(t),$("#foldersListForMov .movetofolderul .ClickedFolder").remove(),"true"==Crm.isFeatureAvailable&&$("#rep_CreateFold").html("").append("<li onclick='crmReports.newFolder(true,false);sE(event);' class='crm-font-regular w100per cP alignleft' >"+I18n.getMsg("crm.label.create.folder")+"</li>"),$("#foldersListForMov").css({left:$("#moveReportFrmList").position().left,top:$("#moveReportFrmList").position().top+$("#moveReportFrmList").outerHeight()-1}),"none"==$("#foldersListForMov").css("display")?$("#foldersListForMov").css("display","block"):($(e).removeClass("btnClicked"),$("#foldersListForMov").css("display","none")),thirdPartyUtils.bindPerfectScroll(".movefldulCont",{wheelSpeed:1,wheelPropagation:!0,suppressScrollX:!1,scrollYMarginOffset:5}),$(".movefldulCont").css("overflow","hidden")},selectFolder:function(e){$("#foldersListForMov").hide(),$("#moveReportFrmList").removeClass("btnClicked");var t=$(e).attr("id").split("_")[1];$("#selFolder").html($(e).text()).addClass("defColor"),$("#folder").val(t)},moveToFolder:function(e){var t=$(e).attr("id").split("_")[1],a="";a=$("#delRepChk")&&$("#delRepChk").hasClass("EditDeleteIconchecked")?"&isAllReports=true&currentFolder="+crmReports.currentFolder:"&"+formData2QueryString(document.ShowReportsForm);var r=Crm.getCrmBasePath()+"/CustomReportFolder.do?actionItem=moveReports&toFolderId="+t+"&isload=true"+a;mR(r,(function(e){$("#foldersListForMov").hide(),$("#moveReportFrmList").removeClass("btnClicked"),$("#delRepChk")&&$("#delRepChk").hasClass("EditDeleteHeaderIconChecked")?($("#delRepChk").hide(),$("#displayFolderReports tr").remove(),$(".rep_successmsg span").html(I18n.getMsg("crm.report.move.success")),$(".rep_successmsg").fadeIn(500,(function(){setTimeout((function(){$(".rep_successmsg").fadeOut(300)}),3e3)})),0==$("#displayFolderReports tbody tr").length?($("#delReportFrmList,#moveReportFrmList").addClass("deleteBtnforReportdisabled"),$("#noreportsFound").show()):$("#noreportsFound").hide()):($(".EditDeleteIconchecked").closest("tr").remove(),$(".rep_successmsg span").html(I18n.getMsg("crm.report.move.success")),$(".rep_successmsg").fadeIn(500,(function(){setTimeout((function(){$(".rep_successmsg").fadeOut(300)}),3e3)}))),crmReports.backToCurrentFolder()}),crmReports.csrf())},sendMail:function(e){var t=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=showMailWindow&isload=true&reportId="+e;mR(t,(function(e){$(".freezeLayer2").show(),$("#sendMailPopUp").html(e),crmReports.animatepopFromTop("sendMailPopUp");var t=$("#selectRecpUsers"),a=$("#availableRecipients");if(t.append(crmReports.recipientsTemplate({id:Crm.userDetails.USER_ID,full_name:Crm.userDetails.DISPLAY_NAME,email:$("<div>").html(Crm.userDetails.EMAIL).text()})),crmReports.selectedRecipients["U:"+Crm.userDetails.USER_ID]=Crm.userDetails.USER_ID,$(".Rep_searchUser").append('<div id = "selectedUsersDiv" style="display:none"></div>'),$("#selectedUsersDiv").append(a.find('li[id="'+Crm.userDetails.USER_ID+'"]').clone()),"matrix"!=$("#repType").val()&&Crm.userDetails.isPrivacySettingEnabled&&Crm.userDetails.privacyExcludeExport){for(var r=Crm.userDetails.privacyPrefEnabledModules.length,i="",o=0;o<r;o++)i+=(0===o?"":", ")+I18n.getMsg(moduleRecordMapping[Crm.userDetails.privacyPrefEnabledModules[o]].plural_label);var s=I18n.getMsg("crm.field.label.personal"),n=I18n.getMsg("crm.privacy.export.report.private.data.alert",[s,i]);$("#privacyMailAlert").text(n),$("#privacyMailAlertDiv").show()}else $("#privacyMailAlertDiv").hide()}),"","","false")},countSelected:function(e){var t=$(e),a=$(e).find(".checkboxmodel"),r="block"===$("#showAllSelected").css("display")||"block"===$("#searchRecpUsers").css("display");if(a.hasClass("Iconcheck")?(a.removeClass("Iconcheck").addClass("Iconchecked"),$(e).find("input:checkbox").prop("checked",!0)):(a.removeClass("Iconchecked").addClass("Iconcheck"),$(e).find("input:checkbox").prop("checked",!1)),r){var i=$(e).attr("for"),o=$("#"+i);o.length&&o[0]!==t[0]&&(o.find(".checkboxmodel").hasClass("Iconcheck")?(o.find(".checkboxmodel").removeClass("Iconcheck").addClass("Iconchecked"),o.find("input:checkbox").prop("checked",!0)):(o.find(".checkboxmodel").removeClass("Iconchecked").addClass("Iconcheck"),o.find("input:checkbox").prop("checked",!1)))}var s=t.find("input:checkbox").val();if(t.parent().hasClass("users_listul")||s.startsWith("U:")){var n=$("#selectedUsersDiv");n.length||($(".Rep_searchUser").append('<div id = "selectedUsersDiv" style="display:none"></div>'),n=$("#selectedUsersDiv"));var l=t.attr("for");a.hasClass("Iconchecked")?(crmReports.selectedRecipients[s]=l,n.find('li[for="'+l+'"]').length||n.append(t.clone())):(delete crmReports.selectedRecipients[s],n.find('li[for="'+l+'"]').remove())}var d=$(".selectedCount"),c=JSON.parse(d.html());a.hasClass("Iconchecked")?d.text(c+1):d.text(c-1)},deleteFromTrash:function(e){var t=$("#emptyTrash").hasClass("EditDeleteHeaderIconChecked"),a=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=deleteFromTrash&isload=true&emptyTrash="+t;e?a=a+"&reportIds="+e:t||(a=a+"&"+formData2QueryString(document.ShowReportsForm)),mR(a,(function(e){"sucess"===e&&(crmReports.backToCurrentFolder(),$(".rep_successmsg span").html(I18n.getMsg("crm.report.delete.sucess")),$(".rep_successmsg").fadeIn(500,(function(){setTimeout((function(){$(".rep_successmsg").fadeOut(300)}),2e3)})))}),crmReports.csrf())},restoreReport:function(e,t,a){var r=$("#emptyTrash").hasClass("EditDeleteHeaderIconChecked"),i=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=restoreReport&isload=true&isAllReports="+r;t?i=i+"&reportIds="+t:r||(i=i+"&"+formData2QueryString(document.ShowReportsForm)),mR(i,(function(t){if(e){if($(e).closest("tr").remove(),0==$("#displayFolderReports tr").length){var a=$("#noreportsFound").clone().show();$("#reportsConta").html(a)}}else crmReports.backToCurrentFolder();$(".rep_successmsg span").html(I18n.getMsg("crm.report.restore.sucess")),$(".rep_successmsg").fadeIn(500,(function(){setTimeout((function(){$(".rep_successmsg").fadeOut(300)}),2e3)}))}),crmReports.csrf())},changeSchOption:function(e){"2"===e?$("#schStartDate").show():$("#schStartDate").hide()},showSchedulers:function(e,t){crmReports.scheduleStatus=t;var a=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=showSchedulers&schStatus="+t+"&isload=true";mR(a,(function(e){$("#reportMain").html(e),crmReports.setHeightWidth(!1),$(".ReportHeader").html($ESAPI.encoder().encodeForHTML($("#folder_SCHEDULEDREPORTS").find(".listText").text()))}),"","","false")},folderSettings:function(){var e=renderingUtils.windowHeight,t=$("#tabLayer").offset().top,a=$("#newReportsBand");a.length&&a.hide(),$("#reportLeftPanel .reb_foldersetting,.Btnsetting").hide(),$("#reportLeftPanel .Btncancel,.Btndone").show(),$("#recycleBin,.separatorShadow,.folderOptpopup").hide(),$("#repFolders .rep_searchIcon").addClass("disabled"),$("#repFolders .SearchBoxDiv").addClass("searchdisabled"),$("#repFolders .SearchInput").prop("disabled",!0),$("#reorderMsg, .freezeLayer1").show(),$(".editReportsLeftNav").show(),$(".reportsLeftNav").hide(0),$(".rep_leftPar").addClass("mT50");var r=Crm.getCrmBasePath()+"/CustomReportFolder.do?actionItem=folderSettings&isload=true";mR(r,(function(a){$("#folderList").html(a),$(".listText").css("max-width","71%"),$("#folderList").find("ul").sortable({helper:"clone",axis:"y",start:function(e,t){$(t.item).find(".checked").removeAttr("onClick")},stop:function(e,t){setTimeout((function(){$(t.item).find(".checked").attr("onClick","crmReports.checkUnCheck(this);sE(event);"),$("#folder_ALLREPORTS .checked").removeAttr("onClick"),$(t.item).removeClass("anim_sorting")}),300)}}),Utils.detachObjects.push($.ui.ddmanager.current),$("#repFolders").height(e-(94+t))}),"","","false")},optOutUser:function(e,t){var a=$("#instanceid").val(),r=$("#rowid").val();if(t){var i=Crm.getCrmBasePath()+"/ScheduleReport.do?actionItem=optingOutUsers&isload=true&instanceId="+a+"&optout=true";mR(i,(function(e){"SUCCESS"==e&&($(".rep_selectedRow").removeClass("rep_selectedRow"),$("#rep_runreportPop1").css("display","none"),$("#tr_"+r).remove())}),crmReports.csrf())}else{i=Crm.getCrmBasePath()+"/ScheduleReport.do?actionItem=optingOutUsers&isload=true&instanceId="+a+"&optout=false";mR(i,(function(e){"SUCCESS"==e&&($(".rep_selectedRow").removeClass("rep_selectedRow"),$("#rep_runreportPop1").css("display","none"),$("#tr_"+r).remove())}),crmReports.csrf())}},callScheduleReport:function(e,t,a,r,i,o,s,n,l){$("#rep_runreportPop1 li").hide(),null!==l&&$("#schStatus").val(l),null!==s&&$("#instanceid").val(s),null!==t&&$("#rowid").val(t);var d,c=!1;if($("#currentReport").val(t),$("#currentReportType").val(r),crmReports.tmpRepName=$(e).siblings(".NameText").children("a").text(),crmReports.reportId=t,"true"===o?null!=n&&("true"===n&&"1"==l?$("#repSchEdit ,#repSchStop").show():"false"===n&&"0"==l?$("#repSchEdit ,#repSchStart").show():"2"==l&&$("#repReschedule").show()):null!=n&&("true"===n?$("#repSchOptOut").show():"false"===n&&$("#repSchOptIn").show()),"SCHEDULEDREPORTS"===crmReports.currentFolder){if($(".rep_runreportnav").css("top","9px"),$("#rep_runreportPop1").css({left:parseInt($(e).offset().left)+27,top:parseInt($(e).offset().top)-12}),crmReports.currentFolder&&-1==crmReports.currentFolder.search("REPORTS")&&1==$(".ClickedFolder").length?$("#listViewShowIn").hide():$("#listViewShowIn").show(),i?$("#listViewEditRep, #listViewDelRep").show():$("#listViewEditRep, #listViewDelRep").hide(),"block"==$("#rep_runreportPop1").css("display"))if($(e).hasClass("rep_selectedRow"))$(".rep_selectedRow").removeClass("rep_selectedRow"),thirdPartyUtils.bindPerfectScroll("#reportsConta",{wheelSpeed:1}),$("#rep_runreportPop1").css("display","none"),$(".freezeLayerdrop").remove();else{$(".rep_selectedRow").removeClass("rep_selectedRow"),$(e).addClass("rep_selectedRow"),$("#rep_runreportPop1").css("display","block"),$("#reportsConta").remove(".freezeLayerdrop").append('<div class="freezeLayerdrop" onclick="$(this).hide();"></div>');var u=$(e).offset().top+$("#rep_runreportPop1").outerHeight(),m=$(e).offset().top-11;if(u-13>$("#reportMain").offset().top+$("#reportMain").outerHeight()-3){m=$(e).offset().top-3;$("#rep_runreportPop1").addClass("runpopupBotFix"),setTimeout((function(){var e=m-$("#rep_runreportPop1").offset().top;d=e+3,c=!0,$(".runpopupBotFix .rep_runreportnav").css({top:e})}),10)}else $("#rep_runreportPop1").removeClass("runpopupBotFix")}else{$(".rep_selectedRow").removeClass("rep_selectedRow"),$(e).addClass("rep_selectedRow"),$("#rep_runreportPop1").css("display","block"),$("#reportsConta").remove(".freezeLayerdrop").append('<div class="freezeLayerdrop" onclick="$(this).hide();"></div>'),thirdPartyUtils.unbindPerfectScroll("#reportsConta");u=$(e).offset().top+$("#rep_runreportPop1").outerHeight(),m=$(e).offset().top-11;if(u-13>$("#reportMain").offset().top+$("#reportMain").outerHeight()-3){m=$(e).offset().top-3;$("#rep_runreportPop1").addClass("runpopupBotFix"),setTimeout((function(){var e=m-$("#rep_runreportPop1").offset().top;d=e+3,c=!0,$(".runpopupBotFix .rep_runreportnav").css({top:e})}),10)}else $("#rep_runreportPop1").removeClass("runpopupBotFix")}setTimeout((function(){c?($("#rp-arr-pos").remove(),$("#rep_runreportPop1").addClass("rp-arr-pos"),$('<style type="text/css" id="rp-arr-pos">.rp-arr-pos:before{top: '+d+"px;} .rp-arr-pos:after{top: "+(d-1)+"px;}</style>").appendTo("#rep_runreportPop1"),c=!1):($("#rp-arr-pos").remove(),c=!1)}),10)}},changeScheduleStatus:function(e,t,a,r){if("null"==t)t=$("#instanceid").val();var i=$("#rowid").val();if(1==r){var o=$("#currentReportType").val(),s=$("#currentReport").val();if("matrix"===o&&(Crm.userDetails.isPrivacySettingEnabled&&Crm.userDetails.privacyExcludeExport||Crm.userDetails.isHipaaFeatureEnabled&&Crm.userDetails.isHipaaPrivacyEnabled&&Crm.userDetails.isHipaaExportRestricted)){var n=new crmRequestPool,l=Crm.getCrmBasePath()+"/specific/ExportReport.do?action=validateMatrixField&reportId="+s;n.initiate({action:l,type:"GET",success:function(){crmReports.startScheduleAfterValidation(e,t,a,i)},error:function(e){555===e.status&&"PRIVATE_FIELDS_PRESENCE"===e.responseText&&($(".freezeLayer2").hide(),crmReports.animatepopFromTop("sendMailPopUp"),setTimeout((function(){$('input[value="Schedule"]').prop("disabled","disabled");var e=I18n.getMsg("crm.field.label.personal"),t=I18n.getMsg("crm.matrix.schedule.report.alert",e);$("#matrixRptAlert").text(t),showAnimatePopup("alertsPop")}),1))}})}else crmReports.startScheduleAfterValidation(e,t,a,i)}else setTimeout((function(){var r=Crm.getCrmBasePath()+"/ScheduleReport.do?actionItem=changeScheduleStatus&isload=true&instanceId="+t+"&status="+a;mR(r,(function(t){t.startsWith("success")&&($(".rep_selectedRow").removeClass("rep_selectedRow"),$("#rep_runreportPop1").css("display","none"),$("#tr_"+i).remove(),$(e).closest("tr").remove(),0===$("#displayFolderReports").find("tr").length?$("#noreportsFound").show():$("#noreportsFound").hide(),crmReports.toggleReportScheduleElem(t))}),crmReports.csrf())}),500)},startScheduleAfterValidation:function(e,t,a,r){setTimeout((function(){var i=Crm.getCrmBasePath()+"/ScheduleReport.do?actionItem=changeScheduleStatus&isload=true&instanceId="+t+"&status="+a;mR(i,(function(t){if(t.startsWith("success")){$(".rep_selectedRow").removeClass("rep_selectedRow"),$("#rep_runreportPop1").css("display","none"),$("#tr_"+r).remove(),$(e).closest("tr").remove();var a=$("#displayFolderReports tr").length;$(e).closest("tr").remove(),0===a?$("#noreportsFound").show():$("#noreportsFound").hide(),crmReports.toggleReportScheduleElem(t)}else"LIMITEXCEEDED"===t&&crmReports.showSchedulers(this,"0")}),crmReports.csrf())}),500)},toggleReportScheduleElem:function(e){"true"===e.split("success:::")[1]?($("#repSchStart").addClass("pEvents"),$("#newSchedulerBtn").addClass("dN")):($("#repSchStart").removeClass("pEvents"),$("#newSchedulerBtn").removeClass("dN"))},showCalender:function(e){crmCalendar.showCalendar(e,void 0,void 0,void 0,void 0,e)},scheduleSettings:function(e,t,a){if("cancel"===e)crmReports.getReports($("#folder_SCHEDULEDREPORTS"),"SCHEDULEDREPORTS",!1,!1,null);else if("delete"===e){if(!window.confirm(I18n.getMsg("crm.warning.delete.dashboard","scheduler")))return;var r=Crm.getCrmBasePath()+"/ScheduleReport.do?actionItem=delRepSchedule&isload=true&instanceId="+t;mR(r,(function(e){crmReports.getReports($("#folder_SCHEDULEDREPORTS"),"SCHEDULEDREPORTS",!1,!1,null)}),crmReports.csrf())}else if("sendMail"===e){var i=$("#repType").val(),o=$("#repaddemailbyaddress");if(""!=o.val()){var s="<div class='rep_emailContainer'><span class=''>"+$ESAPI.encoder().encodeForHTML(o.val())+"</span><div class='closeicon ico-close-small svgIcons' onclick='crmReports.closeRepIcon(this)'></div></div>";$(s).insertBefore(o),o.val("")}if("matrix"===i&&(Crm.userDetails.isPrivacySettingEnabled&&Crm.userDetails.privacyExcludeExport||Crm.userDetails.isHipaaFeatureEnabled&&Crm.userDetails.isHipaaPrivacyEnabled&&Crm.userDetails.isHipaaExportRestricted)){var n=new crmRequestPool,l=Crm.getCrmBasePath()+"/specific/ExportReport.do?action=validateMatrixField&reportId="+a;n.initiate({action:l,type:"GET",success:function(){crmReports.scheduleMailAfterValidation(e,t,a)},error:function(e){555===e.status&&"PRIVATE_FIELDS_PRESENCE"===e.responseText&&($(".freezeLayer2").hide(),crmReports.animatepopFromTop("sendMailPopUp"),setTimeout((function(){$('input[value="Schedule"]').prop("disabled","disabled");var e=I18n.getMsg("crm.field.label.personal"),t=I18n.getMsg("crm.matrix.schedule.report.alert",e);$("#matrixRptAlert").text(t),showAnimatePopup("alertsPop")}),1))}})}else crmReports.scheduleMailAfterValidation(e,t,a)}else{var d=$("#srcReport");if(0==d.val().length)return alert(I18n.getMsg("crm.reportschedule.emptyreport")),void $("#rep_newSchedule").animate({scrollTop:0},100);if(!formValidate())return void $("#rep_newSchedule").animate({scrollTop:0},100);if("none"!=$("#repeatRate").val()){if(!$("input[name=repeatOn]").is(":checked"))return alert(I18n.getMsg("crm.reportscheduler.endtype")),void $("#rep_newSchedule").animate({scrollTop:0},100);if("ONDATE"==$("input[name=repeatOn]:checked").val()){if(!$("#repeatOnDate").val())return $("#repeatOnDate").focus(),void alert(I18n.getMsg("crm.reportschedule.endsondate"));var c=new Date,u=$("#startDate"),m=u.length?splitDateVal(u.val()):splitDateVal($("#newStartDate").val());c.setYear(m[2]),c.setMonth(m[1]-1),c.setDate(m[0]),c.setHours(0,0,0,0,0);var p=splitDateVal($("#repeatOnDate").val()),h=new Date;if(h.setYear(p[2]),h.setMonth(p[1]-1),h.setDate(p[0]),h.setHours(0,0,0,0,0),h<=c)return $("#repeatOnDate").focus(),void alert(I18n.getMsg("crm.reportschedule.enddategreater"))}else if("ONTIME"==$("input[name=repeatOn]:checked").val()&&(!$("#repeatOnTime").val()||parseInt($("#repeatOnTime").val())<=0))return $("#repeatOnTime").focus(),void alert(I18n.getMsg("crm.reportscheduler.valid.repeatontime"))}var f=$("#repeatOnTime").val();if(isNaN(f))return void alert(I18n.getMsg("crm.reportscheduler.valid.repeatontime"));if($("#notPersonalAccount").length>0)if("email"===crmReports.recipientType){if(getObj("selUserSources").value=crmReports.scheduledData,!crmReports.scheduledData&&0===$(".addbyemailaddress .rep_emailContainer").length&&""===$("#repaddemailbyaddress").val())return void renderingUtils.showCustomAlert(I18n.getMsg("crm.field.empty.check",I18n.getMsg("crm.workflow.recipients")),void 0,!1)}else{if(!crmReports.recipientType)return void renderingUtils.showCustomAlert(I18n.getMsg("crm.medium.report.select"));var v=document.getElementById("chatOptions");if(!v.component.optionsSelected())return void v.component.displayErrorMessages()}if(!crmReports.isValidAdditionalRecipientEmails())return;if((i=d.data("reptype"))||(i=$("#currentReportType").val()),"matrix"===i&&(Crm.userDetails.isPrivacySettingEnabled&&Crm.userDetails.privacyExcludeExport||Crm.userDetails.isHipaaFeatureEnabled&&Crm.userDetails.isHipaaPrivacyEnabled&&Crm.userDetails.isHipaaExportRestricted)){n=new crmRequestPool,l=Crm.getCrmBasePath()+"/specific/ExportReport.do?action=validateMatrixField&reportId="+d.val();n.initiate({action:l,type:"GET",success:function(a){crmReports.scheduleReportAfterValidation(e,t)},error:function(e){555===e.status&&"PRIVATE_FIELDS_PRESENCE"===e.responseText&&($('input[value="Schedule"]').prop("disabled","disabled"),setTimeout((function(){var e=I18n.getMsg("crm.field.label.personal"),t=I18n.getMsg("crm.matrix.schedule.report.alert",e);$("#matrixRptAlert").text(t),showAnimatePopup("alertsPop")}),1))}})}else crmReports.scheduleReportAfterValidation(e,t)}},scheduleMailAfterValidation:function(e,t,a){$("#showAllSelected").html("");var r,i=$(".addbyemailaddress .rep_emailContainer").length;if(getObj("selUserSources").value=crmReports.scheduledData,null!==crmReports.scheduledData&&""!==crmReports.scheduledData||0!=i){if((!(i>0)||crmReports.isValidAdditionalRecipientEmails())&&(r=crmReports.getAdditionalRecpEmails(),1==$("#scheduleType").val()||formValidate())){$("#srcReport").val(a);var o=formData2QueryString(document.newScheduler);o=""!=r?o+"&otherEmails="+encodeURIComponent(r):o;for(var s=["stdDateFilterField","stdDateFilter","startdate","enddate","stdageindayscondition","stdageindays"],n=(n=formData2QueryString(document.NewReport)).split("&"),l=0;l<n.length;l++)if(n[l].indexOf("=")>-1){var d=n[l].split("=");s.indexOf(d[0])>-1&&(o=o+"&"+n[l])}var c=Crm.getCrmBasePath()+"/ScheduleReport.do?actionItem=sendMail&isload=true&"+o+"&repeatRate=none";mR(c,(function(){$(".freezeLayer2").hide(),crmReports.animatepopFromTop("sendMailPopUp")}),crmReports.csrf())}}else renderingUtils.showCustomAlert(I18n.getMsg("crm.field.empty.check",I18n.getMsg("crm.workflow.recipients")),void 0,!1)},scheduleReportAfterValidation:function(e,t){var a=crmReports.getAdditionalRecpEmails(),r=formData2QueryString(document.newScheduler);if(crmReports.recipientType&&"email"!==crmReports.recipientType){var i=document.getElementById("chatOptions").component;if(i.preSaveOperationNeeded()&&!i.isPreSaveDone())return void i.preSaveOperation(crmReports.scheduleReportAfterValidation,this,[e,t]);var o=i.getOptionValues();r=r+"recipient_type="+crmReports.recipientType+"&chat_info="+encodeURIComponent(JSON.stringify(o))}r=""!=a?r+"&otherEmails="+encodeURIComponent(a):r;var s=Crm.getCrmBasePath()+"/ScheduleReport.do?actionItem="+e+"&isload=true&"+r;s=t?s+"&instanceId="+t:s,mR(s,(function(e){crmReports.getReports($("#folder_SCHEDULEDREPORTS"),"SCHEDULEDREPORTS",!1,!1,null)}),crmReports.csrf(),(function(e){if(555===e.status&&"INCORRECT_SCHEDULE_STARTTIME"==e.responseText)renderingUtils.showCustomAlert(I18n.getValueForFields("crm.custom.field.greater.than",[I18n.getMsg("crm.workflow.scheduler.start.date"),I18n.getMsg("currentDateTime")]));else if(400===e.status){"FEATURE_NOT_ENABLED"===e.responseText?renderingUtils.showCustomAlert("The medium is not active. Please choose a different medium"):renderingUtils.showMsgBox("Please try again later","error")}else renderingUtils.showMsgBox("Please try again later","error")}))},getAdditionalRecpEmails:function(){var e="",t=$(".addbyemailaddress .rep_emailContainer");for(i=0;i<t.length;i++){var a=$(t[i]).find("span").text().trim();e=""==e?a:(e+","+a).trim()}return e},isValidAdditionalRecipientEmails:function(){var e=$(".addbyemailaddress .rep_emailContainer"),t=new RegExp("^\\w+(([\\.!#$%&'\\*+=?^_`{|}~-]\\w+))*\\@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+$"),a=!1;""!=$("#repaddemailbyaddress").val()&&((r=$("#repaddemailbyaddress").val()).trim()&&(t.test(trimBoth(r))||(alert(I18n.getMsg("crm.participant.invalid.email.id",trimBoth(r))),a=!0)));for(i=0;i<e.length;i++){var r=$(e[i]).find("span").text();if(!t.test(trimBoth(r))){alert(I18n.getMsg("crm.participant.invalid.email.id",trimBoth(r))),a=!0,$("#selUserSources").focus();break}}return!a},sortScheduledReports:function(e,t,a,r){var i=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=sortListView&isload=true&status="+crmReports.scheduleStatus+"&sortColumn="+e+"&sortOrder="+r+"&currentView="+crmReports.currentFolder;mR(i,(function(e){$("#reportMain").html(e),crmReports.setHeightWidth(!1)}),"","","false")},showReports:function(){var e=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=showReportsToChoose&isload=true";mR(e,(function(e){$("#showReportsToChoose").html(e),crmReports.isRepScrolled=!1,crmReports.animatepopFromTop("showReportsToChoose"),$("#chooseReportsTitle").html($("#tmprepFolders .ClickedFolder").find(".listText").text()),$("#curSearchFolder").html($("#tmprepFolders .ClickedFolder").find(".listText").text()),$(".filechosenName").addClass("defColor"),$("#sort_REPORTNAME").addClass("dropdownarr"),crmReports.sortTable(!0,0)}))},selectReport:function(){$(".filechosenName").html($(".elementRowselected td .NameText").html()),$("#srcReport").val($(".elementRowselected").attr("id").split("_")[1]),$("#srcReport").attr("data-repType",$(".elementRowselected").attr("data-repType"));var e=$(".elementRowselected").attr("data-repType");if(null==e||"stats"!=e&&"email"!=e.substring(0,5)?($("#forcsvreport").prop("disabled",!1),$("#forxlsreport").prop("disabled",!1)):($("#forcsvreport").prop("disabled",!0),$("#forxlsreport").prop("disabled",!0)),$('input[value="Schedule"').removeAttr("disabled"),crmReports.animatepopFromTop("showReportsToChoose"),"matrix"!=e&&Crm.userDetails.isPrivacySettingEnabled&&Crm.userDetails.privacyExcludeExport){for(var t=Crm.userDetails.privacyPrefEnabledModules.length,a="",r=0;r<t;r++)a+=(0===r?"":", ")+I18n.getMsg(moduleRecordMapping[Crm.userDetails.privacyPrefEnabledModules[r]].plural_label);var i=I18n.getMsg("crm.field.label.personal"),o=I18n.getMsg("crm.privacy.export.report.private.data.alert",[i,a]);$("#privacyAlert").text(o),$("#privacyAlertDiv").show()}else $("#privacyAlertDiv").hide()},changeRepeatType:function(e){"none"===e?$(".hidablesec").hide():$(".hidablesec").show()},createSchedule:function(){var e=Crm.getCrmBasePath()+"/ScheduleReport.do?actionItem=newScheduler&isload=true";mR(e,(function(e){$("#reportMain").html(e),crmReports.doScheduleConf("U"),crmReports.setHeightWidth(!1)}),"","","false")},customizeChart:function(e,t){var a=JSON.parse($(t).attr("data-params"));(a=objectUtils.cloneObject(a)).isload=!0,crmReports.loadReports(void 0,void 0,a)},newScheduler:function(e,t,a,r){"null"==t&&(t=$("#instanceid").val()),"null"==a&&(a=$("#schStatus").val());var i=Crm.getCrmBasePath()+"/ScheduleReport.do?actionItem="+e+"&isload=true&schStatus="+a+"&instanceId="+t;mR(i,(function(t){if($("#reportMain").html(t),crmReports.setHeightWidth(!1),"editRepSchedule"===e)if(r||(r=$("#currentReportType").val()),"matrix"!==r&&Crm.userDetails.isPrivacySettingEnabled&&Crm.userDetails.privacyExcludeExport){for(var a=Crm.userDetails.privacyPrefEnabledModules.length,i="",o=0;o<a;o++)i+=(0===o?"":", ")+I18n.getMsg(moduleRecordMapping[Crm.userDetails.privacyPrefEnabledModules[o]].plural_label);var s=I18n.getMsg("crm.field.label.personal"),n=I18n.getMsg("crm.privacy.export.report.private.data.alert",[s,i]);$("#privacyAlert").text(n),$("#privacyAlertDiv").show()}else $("#privacyAlertDiv").hide()}),crmReports.csrf(),"","false")},showReport:function(e,t){var a=$("#currentReportType").val();if(null==a||"stats"!=a&&"email"!=a.substring(0,5))return Lyte.Router.transitionTo({route:"crm.tab.reports.view",dynamicParams:[e],queryParams:{folderId:t}}),!1;var r="emailanalytics";"email toptemplates"==a?r="toptemplates":"email topusers"==a&&(r="topusers");var i={type:"email",viewtype:r,isfrompopup:"true"};Lyte.Router.transitionTo({route:"crm.tab.reports.view",dynamicParams:[e],queryParams:i})},customizeReport:function(e){crmReports.lastSelectedTab&&""!=crmReports.lastSelectedTab&&crmReports.reportsTab($("#"+crmReports.lastSelectedTab),crmReports.lastSelectedTab),$(".rep_centercontainer").addClass("pR20"),crmReports.setHeightWidth(!1),"matrix"==e?$("#reportMatrixGrouping").show():$("#reportSelectColumns").show(),$("#repCriteria").show(),$("#selFolder").text($("#folder_"+$("#folder").val()).text()),$(".rep_borderavail,.report_tabforfilter").stop(),$(".rep_borderavail").width($("#tabForRepresentation").find(".tabforreportliactive").outerWidth()),$(".rep_borderavail,.report_tabforfilter").stop(),$(".report_tabforfilter").css("left","0px").width($("#tabForFilter").find(".tabforreportliactive").outerWidth()),thirdPartyUtils.bindSelect2(".newSelect select")},editReport:function(e,t,a,r,i){var o=$("#currentReportType").val();if(null==o||"stats"!=o&&"email"!=o.substring(0,5)){n={folderId:a,repType:t,isCopyReport:r};var s={};$("#isCopyReportRun")&&"undefined"!=$("#isCopyReportRun").val()&&(s.isCopyReportRun=$("#isCopyReportRun").val()),i&&(s.isFromListView=i),Lyte.Router.transitionTo({route:"crm.tab.reports.edit",dynamicParams:[e],queryParams:n}).data=s}else{var n;(n={type:"email",viewtype:"emailanalytics",isfrompopup:"true"}).repoption=r?"repClone":"repEdit",Lyte.Router.transitionTo({route:"crm.tab.reports.view",dynamicParams:[e],queryParams:n})}},showSaveDislog:function(){var e=$("#isSaved").val(),t=$("#reportName").val(),a=$("#repName");"false"==e&&0==t.length?(crmReports.lastSelectedTab="",$(".SelectSearchBox").removeClass("errFieldBdr_rep"),$("#repFolderEmptyWar").hide(),a.removeClass("errFieldBdr_rep"),a.next().hide(),$("#selFolder").html(I18n.getMsg("crm.report.select.folder")),$("#repDesc").val(""),a.focus().val("Untitled Report"),$("#repFolderId,#folder").val(""),$(".freezeLayer2").fadeIn(200),crmReports.animatepopFromTop("showSaveDialog"),crmReports.currentFolder&&-1==crmReports.currentFolder.search("REPORT")&&($("#showSaveDialog #selFolder").html($("#folder_"+crmReports.currentFolder).text()),$("#repFolderId,#folder").val(crmReports.currentFolder))):crmReports.changeRepStatus()},showSaveSucessMsg:function(){$(".rep_successmsg span").html(I18n.getMsg("crm.report.saved.success")),$(".rep_successmsg").fadeIn(500,(function(){setTimeout((function(){$(".rep_successmsg").fadeOut(300)}),3e3)}))},changeRepStatus:function(){var e=$("#folder").val(),t=$("#repName"),a=$("#repFolderEmptyWar");if($(".SelectSearchBox").removeClass("errFieldBdr_rep"),a.hide(),t.removeClass("errFieldBdr_rep"),$("#repNameEmptyMsg").hide(),0!=e.length)if(0!=t.val().replace(/^\s+/g,"").replace(/\s+$/g,"").length){var r=$("#repDesc").val(),i=$("#reportId").val(),o=Crm.getCrmBasePath()+"/specific/CustomReport.do?isload=true&actionItem=changeRepStatus&reportId="+i+"&reportName="+encodeURIComponent(t.val())+"&folderId="+e+"&reportDesc="+encodeURIComponent(r);mR(o,(function(e){$(".freezeLayer2").fadeOut(200),$("#reportMain").html(e),crmReports.doRunConfChange(),"block"==$("#showSaveDialog").css("display")&&crmReports.animatepopFromTop("showSaveDialog"),crmReports.showSaveSucessMsg(),crmReports.lastSelectedTab=""}),crmReports.csrf(),(function(e){if(555===e.status&&"Duplicate report Name"==e.responseText){if("none"==$("#showSaveDialog").css("display"))renderingUtils.showCustomAlert(I18n.getMsg("crm.label.name.already.exist"));else{var a=I18n.getMsg("crm.label.name.already.exist");t.addClass("errFieldBdr_rep").focus().next().removeClass("dN").text(a).show()}return!1}}))}else{s=I18n.getMsg(I18n.getMsg("crm.field.empty.check"),"Name");t.addClass("errFieldBdr_rep").next().focus().removeClass("dN").text(s).show()}else if($("#showSaveDialog .SelectSearchBox").addClass("errFieldBdr_rep"),a.removeClass("dN").show(),0==t.val().replace(/^\s+/g,"").replace(/\s+$/g,"").length){var s=I18n.getMsg(I18n.getMsg("crm.field.empty.check"),"Name");t.addClass("errFieldBdr_rep").next().focus().removeClass("dN").text(s).show()}},saveReport:function(e,t){if(formValidate()){getElemById("territories")&&Territory.setTerritoryValues();var a=$("#repFolderEmptyWar"),r=$("#reportName");$(".SelectSearchBox").removeClass("errFieldBdr_rep"),a.hide(),r.removeClass("errFieldBdr_rep"),$("#repNameEmptyMsg").hide();var o=$("input[name=reportType]:checked").val();if(("summary"===o||"tabular"===o)&&0==$("#selectedColumns option").length)return alert("Please select at least one column"),!1;if("matrix"===o){if($("#RowHeader1").val()==$("#ColHeader1").val())return alert(I18n.getMsg("crm.report.alert.duplicate.column")),void crmReports.showSubTab($("#groupingColLi"),"grouping");if(0==$("input[name=matx]:checked").length)return alert(I18n.getMsg("crm.report.alert.matrix")),void crmReports.showSubTab($("#colTotalLi"),"total")}if("saveReport"==e&&0==document.NewReport.folder.value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if($("#repFolderListNew").addClass("errFieldBdr_rep"),a.removeClass("dN").show(),0==r.val().replace(/^\s+/g,"").replace(/\s+$/g,"").length){var s=I18n.getMsg(I18n.getMsg("crm.field.empty.check"),"Name");r.addClass("errFieldBdr_rep").next().removeClass("dN").text(s).show()}return!1}if("saveReport"==e&&0==r.val().replace(/^\s+/g,"").replace(/\s+$/g,"").length){s=I18n.getMsg(I18n.getMsg("crm.field.empty.check"),"Name");return r.addClass("errFieldBdr_rep").focus().next().removeClass("dN").text(s).show(),!1}if("saveReport"==e&&r.val().replace(/^\s+/g,"").replace(/\s+$/g,"").length>100){s=I18n.getMsg(I18n.getMsg("crm.report.create.characters"),"Name");return r.addClass("errFieldBdr_rep").focus().next().removeClass("dN").text(s).show(),!1}if(crmReports.formSelectColumnString(),getElemById("tabForFilter")&&0===$("#reportFiltersTab").closest("li.disabled_tab").length&&!Search.validate())return!1;"saveReport"!=e&&crmReports.currentFolder&&-1==crmReports.currentFolder.search("REPORTS")&&$("#folder").val(crmReports.currentFolder);var n="";"runReport"===e?(crmReports.lastSelectedTab=$(".editReporttabActive").attr("id"),$("#reportId").val(null),t&&"true"===t&&(n="&isCopyReportRun=true")):crmReports.lastSelectedTab="";var l=formData2QueryString(document.NewReport)+n,d=l.indexOf("stdDateFilterField");if(d>-1){var c=l.substring(d+19),u=c.indexOf("&");c=c.substring(0,u),c=decodeURIComponent(c),c=encodeURIComponent(trimBoth(crmReports.escapeSplChars(c))),l=l.substring(0,d+19)+c+l.substring(d+19+u)}var m=$("#primarymodule").val(),p=$("#relatedModules .listelt_check1_checked");if(0==p.length&&$("#secondayModules").val())m=$("#secondayModules").val();else{var h="";for(i=0;i<p.length;i++){var f=p[i];h=$(f).attr("org-val")+":"+h}h.indexOf("Contact Roles:")>=0&&(h="Contact Roles:"+(h=h.replace("Contact Roles:",""))),m=m+":"+h}var v=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=updateAndRun&isload=true";return"saveReport"!=e&&(v+="&isSaved=false"),v=v+"&modulesString="+encodeURIComponent(m),mR(v,(function(t){$("#show").html(t);var a=$("#reportId").val(),r={};r.folderId=$("#folder").val(),r.repType=$("#repType").val(),Lyte.Router.transitionTo({route:"crm.tab.reports.view",dynamicParams:[a],queryParams:r}).cachedResponse=t,crmReports.doRunConfChange(!0),"runReport"!=e&&crmReports.showSaveSucessMsg()}),l+"&"+crmReports.csrf(),(function(e){if(555===e.status&&"Duplicate report Name"==e.responseText){var t=I18n.getMsg("crm.label.name.already.exist");return r.focus().next().removeClass("dN").text(t).show(),!1}if(555===e.status&&e.responseText.indexOf("Encrypted Fields cannot be used in grouping columns")>-1){var a=e.responseText.split("###")[1];t=I18n.getMsg("ear.error.message.grouping.not.allowed",a);return $("#matrixRptAlert").text(t),showAnimatePopup("alertsPop"),!1}555===e.status&&setTimeout((function(){var e=I18n.getMsg("crm.workflow.save.error");$("#matrixRptAlert").text(e),showAnimatePopup("alertsPop")}),1),setTimeout((function(){$("#popupnew input:button").removeAttr("onclick").attr({onclick:"hide('popupnew');removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30;crmReports.backToCurrentFolder()"})}),20)})),!1}return!1},escapeSplChars:function(e){var t=e.indexOf(":")?e.split(":"):[e];if(t.length>0){e=t[0].replace(/,/g,"\\,");for(var a=t.length,r=1;r<a;r++)t[r].indexOf(",")>-1&&(t[r]=t[r].replace(/,/g,"\\,")),e=e+":"+t[r]}return e},formSelectColumnString:function(){var e=document.getElementById("selectedColumns"),t="";for(i=0;i<e.options.length;i++)t+=e.options[i].value+";";document.NewReport.selectedColumnsString.value=t},showRelatedModules:function(){if($("#primarymodule").select2("close"),$("#relModuleWarning").hide(),"none"!=$("#chooseRepType").css("display")){if(!window.confirm("Are you sure? "))return;$("#showSelectColumns,#selectColumnAndFilter,#chooseRepType,#showSaveDialog,#saveReport,#runReport").hide(),$("#reportNextStep").show()}var e=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=getRelatedModules&isload=true&selectedModule="+$("#primarymodule").val();mR(e,(function(e){0===e.length?$(".Listmodule").hide():$(".Listmodule").show(),$("#relatedModules").html(e),crmReports.selectedModules=[],crmReports.selectedCount=0}),"","","false")},showNextStep:function(e){crmReports.hiddenModules=[];var t=$(e).attr("data-crntid");if("none"==$("#chooseRepType").css("display"))$("#chooseRepType").find(".typeofRep").show(),$("#basicInfo,#showSelectColumns,#chooseRepType,#showSaveDialog").removeClass("rep_activeSection"),$("#chooseRepType").show().addClass("rep_activeSection"),$(".formcontainer").on("mousedown wheel keyup touchmove",(function(){$(".formcontainer").stop()})),$(".formcontainer").animate({scrollTop:$(".formcontainer").scrollTop()+$("#"+t).offset().top},"slow",(function(){$(".formcontainer").off("mousedown wheel keyup touchmove")})),$(e).attr("data-crntid","showSelectColumns");else if("none"==$("#selectColumnAndFilter").css("display")){var a,r=$("input[name=reportType]:checked").val(),o="",s=$("#relatedModules .listelt_check1_checked");for($("#moduleSelFreez").show(),i=0;i<s.length;i++){var n=s[i];$(n).siblings("span").removeClass("listelttitle").parent("label").removeAttr("onclick"),o=""!=o?o+","+$(n).attr("val"):$(n).attr("val"),"Blueprints"===$(n).attr("val")&&(a=$(n).parents("div .listelt_check").find("#selectBP").val())}var l=$("#relatedModules .listelt_check1_check");for(i=0;i<l.length;i++){n=l[i];$(n).siblings("span").removeClass("listelttitle").parent("label").removeAttr("onclick")}var d=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=getSelectColumns&isload=true&primarymodule="+$("#primarymodule").val();d=""!=o?d+"&"+$("#primarymodule").val()+"relatedmodule="+encodeURIComponent(o):d,d=o.indexOf("Blueprints")>-1?d+"&bpId="+a:d,mR(d,(function(a){if($("#selectColumnAndFilter").html(a).show(),$("#availList option[data-zcqa='ISCALLBILLABLE']").remove(),$("#selectedColumns option[data-zcqa='ISCALLBILLABLE']").remove(),thirdPartyUtils.bindSelect2($("#selectColumnAndFilter").find(".newSelect select")),"matrix"==r?($("#reportSelectColumns").hide(),$("#selModColLi").hide(),$("#groupingColLi").addClass("tabforreportliactive").show(),$("#reportMatrixGrouping").show(),thirdPartyUtils.bindSelect2($(".newSelect").find("select"))):($("#reportSelectColumns").show(),"summary"==r&&$("#groupingColLi").show()),"matrix"!=r&&0==$("#selectedColumns option").length){var o=$("#availList option");for(i=0;i<o.length;i++){var s=$(o[i]),n=s.val();if(-1!=n.search(":2:")&&-1==n.search(":DESIGNATION:")&&-1==n.search(":LINKINGMXN1:")&&-1==n.search(":LINKINGMXN2:")&&-1==n.search("NewCF")){var l=$(s).clone();$("#selectedColumns").append(l)}}}$(".rep_borderavail,.report_tabforfilter").stop(),$(".rep_borderavail").width($("#tabForRepresentation").find(".tabforreportliactive").outerWidth()),$("#showSelectColumns").find(".rep_CommonClass").show(),$("#showSelectColumns,#chooseRepType,#showSaveDialog").removeClass("rep_activeSection"),$("#showSelectColumns").show().addClass("rep_activeSection"),$(e).attr("data-crntid","showRepFilters"),$(".formcontainer").on("mousedown wheel keyup touchmove",(function(){$(".formcontainer").stop()})),$(".formcontainer").animate({scrollTop:$(".formcontainer").scrollTop()+$("#"+t).offset().top},"slow",(function(){$(".formcontainer").off("mousedown wheel keyup touchmove")}))}),"","","false"),setTimeout((function(){$("#availList").height("300px")}),1e3)}else if("none"==$("#showRepFilters").css("display")){if("matrix"!=(r=$("input[name=reportType]:checked").val())&&0==$("#selectedColumns option").length)return alert(I18n.getMsg("crm.report.alert.column")),void crmReports.showSubTab($("#selModColLi"),"columns");if("matrix"==r){if("none"==$("#RowHeader1").val())return alert(I18n.getMsg("crm.report.alert.row.header")),void crmReports.showSubTab($("#groupingColLi"),"grouping");if("none"==$("#ColHeader1").val())return alert(I18n.getMsg("crm.report.alert.column.header")),void crmReports.showSubTab($("#groupingColLi"),"grouping");if($("#RowHeader1").val()==$("#ColHeader1").val())return alert(I18n.getMsg("crm.report.alert.duplicate.column")),void crmReports.showSubTab($("#groupingColLi"),"grouping");if(0==$("input[name=matx]:checked").length)return alert(I18n.getMsg("crm.report.alert.matrix")),void crmReports.showSubTab($("#colTotalLi"),"total")}$(".rep_borderavail,.report_tabforfilter").stop(),$(".report_tabforfilter").css("left","0px"),$("#showRepFilters").find(".rep_CommonClass").show(),$("#showSelectColumns,#chooseRepType,#showSaveDialog,#showRepFilters").removeClass("rep_activeSection"),$("#showRepFilters").show().addClass("rep_activeSection"),$("#runReport").show(),$(e).attr("data-crntid","showSaveDialog"),$(".formcontainer").on("mousedown wheel keyup touchmove",(function(){$(".formcontainer").stop()})),$(".formcontainer").animate({scrollTop:$(".formcontainer").scrollTop()+$("#"+t).offset().top},"slow",(function(){$(".formcontainer").off("mousedown wheel keyup touchmove")})),thirdPartyUtils.bindSelect2($(".wf_chosen_ui").find("select"))}else{if("matrix"===(r=$("input[name=reportType]:checked").val())&&$("#RowHeader1").val()==$("#ColHeader1").val())return alert(I18n.getMsg("crm.report.alert.duplicate.column")),void crmReports.showSubTab($("#groupingColLi"),"grouping");$("#showSaveDialog").find(".rep_CommonClass").show(),$("#tabForFilter").parent().find(".crHeader").removeClass("rep_activeSection").find(".mouseoverediconactive").removeClass("mouseoverediconactive").addClass("mouseoveredicon").css("display","block"),$(".basicInfoForm").parent().find(".crHeader").removeClass("rep_activeSection").find(".mouseoverediconactive").removeClass("mouseoverediconactive").addClass("mouseoveredicon").css("display","block"),$(".typeofRep").parent().find(".crHeader").removeClass("rep_activeSection").find(".mouseoverediconactive").removeClass("mouseoverediconactive").addClass("mouseoveredicon").css("display","block"),$("#tabForRepresentation").parent().find(".crHeader").removeClass("rep_activeSection").find(".mouseoverediconactive").removeClass("mouseoverediconactive").addClass("mouseoveredicon").css("display","block"),$("#showSaveDialog").show().find(".crHeader").addClass("rep_activeSection").find("span").css("display","none"),$("#reportNextStep").hide(),$(".formcontainer").on("mousedown wheel keyup touchmove",(function(){$(".formcontainer").stop()})),$(".formcontainer").animate({scrollTop:$(".formcontainer").scrollTop()+$("#"+t).offset().top},"slow",(function(){$(".formcontainer").off("mousedown wheel keyup touchmove")})),$("#runReport,#saveReport,#showSaveDialog").show(),$("#showRepFilters .chosen-drop .chosen-results").css("max-height","240px")}thirdPartyUtils.bindSelect2($(".newSelect").find("select"))},showSubTab:function(e,t){$(e).hasClass("tabforreportliactive")||("tabForRepresentation"==$(e).parent().parent().attr("id")?$(".rep_borderavail").animate({left:$(e).position().left},400,(function(){$(".rep_borderavail").width($(e).outerWidth()),$(".tabforreportliactive").removeClass("tabforreportliactive").addClass("tabforreportli"),$(e).addClass("tabforreportliactive");var a=$("input[name=reportType]:checked").val();$(".repwizard").each((function(){if("block"==$(this).css("display")){if("columns"!=t)return"grouping"==t?"matrix"==a?($(this).fadeOut(50),$("#reportMatrixGrouping").fadeIn(300),!1):($(this).fadeOut(50),$("#reportSummaryGrouping").fadeIn(300),!1):"matrix"==a?($(this).fadeOut(50),$("#reportMatrixColumnsToTotal").fadeIn(300),!1):($(this).fadeOut(50),$("#reportSummaryColumnsToTotal").fadeIn(300),!1);$(this).fadeOut(50),$("#reportSelectColumns").fadeIn(50)}}))})):$(".report_tabforfilter").animate({left:$(e).position().left},500,(function(){if($(".report_tabforfilter").width($(e).outerWidth()),$(".tabforreportliactive").removeClass("tabforreportliactive").addClass("tabforreportli"),$(e).addClass("tabforreportliactive").removeClass("tabforreportli"),"criteria"==t)return $("#territories_div").fadeOut(50),void $("#repCriteria").fadeIn(300);"territories_div"==t&&($("#repCriteria").fadeOut(50),$("#territories_div").fadeIn(300))})))},selectSecModule:function(e){if(!crmReports.checkedMxNModule(e)){var t=crmReports.selectedModules,a=t.filter((function(e){return["Tasks","Events","Calls"].includes(e)})).length,r=e.children[0],i=r.getAttribute("val");if(crmReports.selectedCount>=3&&0===$(e).find(".listelt_check1_checked").length&&(0===a||3===a||a>0&&!["Tasks","Events","Calls"].contains(i)&&!t.contains(i)))return;if($(e).find(".listelt_check1_check").toggleClass("listelt_check1_checked"),r.getAttribute("class").includes("listelt_check1_checked")&&!crmReports.selectedModules.contains(i)?(["Tasks","Events","Calls"].contains(i)?0===a&&["Tasks","Calls","Events"].contains(i)&&(crmReports.selectedCount=crmReports.selectedCount+1):crmReports.selectedCount=crmReports.selectedCount+1,crmReports.selectedModules.push(i)):(["Tasks","Events","Calls"].contains(i)?1===a&&["Tasks","Calls","Events"].contains(i)&&(crmReports.selectedCount=crmReports.selectedCount-1):crmReports.selectedCount=crmReports.selectedCount-1,crmReports.selectedModules.removeArrayElements([i])),a=t.filter((function(e){return["Tasks","Events","Calls"].includes(e)})).length,3===crmReports.selectedCount)if($("#relatedModules .Listboxreport_listelt").css("opacity","0.3"),$("#relatedModules .listelt_check1_checked").closest("li").css("opacity","1"),a<3&&a>0)for(var o=$("#relatedModules").children(),s=o.length,n=0;n<s;n++){var l=$(o[n]),d=$(o[n].children[0]).find("label")[0].children[0].getAttribute("val");["Tasks","Calls","Events"].contains(d)&&l.css("opacity","1")}else{var c=a?I18n.getMsg("crm.report.maximum.secmodule.act"):I18n.getMsg("crm.report.maximum.secmodule");$("#relModuleWarning #reportwaringalertmsg").html(c),$("#relModuleWarning").slideDown(100)}else $("#relModuleWarning").slideUp(100),$("#relatedModules .Listboxreport_listelt").closest("li").css("opacity","1")}},checkedMxNModule:function(e){var t=!1,a=new Array;0==$(e).find(".listelt_check1_checked").length&&(t=!0);var r=$(e).parent("div").find("#listelt_check1");if("true"==r.attr("mxn")){var i="#dl#"+$(e).find(".listelt_check1_check").attr("val").split("#dl#")[1];if($("#relatedModules .listelt_check1_check").each((function(e){$(this).attr("val").indexOf(i)>-1&&(a.push($(this)),$(this).toggleClass("listelt_check1_checked"),$("#relatedModules .listelt_check1_check").removeClass("listelt_check1_checked"),$.each(a,(function(e,t){$(t).toggleClass("listelt_check1_checked")})))})),t){var o=I18n.getMsg("crm.report.maximum.mxnmodule");return r.val().indexOf("User")>-1&&(o=I18n.getMsg("crm.report.maximum.multiusermodule")),$("#relModuleWarning #reportwaringalertmsg").html(o),$("#relModuleWarning").slideDown(100),$("#relatedModules .Listboxreport_listelt").css("opacity","0.3").addClass("eventNone"),$("#relatedModules .listelt_check1_checked").closest("li").css("opacity","1").removeClass("eventNone"),!0}if(!t)return $.each($("#relatedModules .listelt_check1_checked"),(function(e,t){$(t).toggleClass("listelt_check1_checked")})),$("#relModuleWarning").slideUp(100),$("#relatedModules .Listboxreport_listelt").closest("li").css("opacity","1").removeClass("eventNone"),!0}return!1},changeRepType:function(e){if($("#tabForRepresentation")){if("tabular"===e){if($("#groupingColLi, .repwizard").hide(),$("#tabForRepresentation .tabforreportliactive").removeClass("tabforreportliactive"),$("#selModColLi").addClass("tabforreportliactive").show(),$("#repModeuleColumns").height($("#reportSelectColumns").outerHeight()),$("#reportSelectColumns").show(),$("#reportSelectColumns").css("left",0),0==$("#selectedColumns option").length){var t=$("#availList option");for(i=0;i<t.length;i++){var a=$($(t[i])).clone();if($("#selectedColumns").append(a),4==i)break}}crmReports.updateReportColumns("tabular")}else if("summary"===e){$(".repwizard").hide(),$(".tabforreportul li").removeClass("tabforreportliactive"),$("#selModColLi").addClass("tabforreportliactive").show(),$("#groupingColLi, #reportSelectColumns").show();t=$("#availList option");if(0==$("#selectedColumns option").length)for(i=0;i<t.length;i++){a=$($(t[i])).clone();if($("#selectedColumns").append(a),4==i)break}crmReports.updateReportColumns("summary")}else $("#selModColLi, .repwizard").hide(),$(".tabforreportul li").removeClass("tabforreportliactive"),$("#groupingColLi").addClass("tabforreportliactive").show(),$("#groupingColLi, #reportMatrixGrouping").show(),crmReports.updateReportColumns("matrix");$(".tabforreportliactive").each((function(){"none"!=$(this).css("display")&&("selModColLi"==$(this).attr("id")?$(".rep_borderavail").css({left:"0",width:$("#selModColLi").outerWidth()}):$(".rep_borderavail").css({left:"0",width:$("#groupingColLi").outerWidth()}))}))}thirdPartyUtils.bindSelect2($(".newSelect").find("select"))},applyFilter:function(){if(!formValidate())return!1;$("#actionItem").val("run");var e=formData2QueryString(document.NewReport),t=objectUtils.parseURLParamString(e);null!==t.stdDateFilterField&&void 0!==t.stdDateFilterField&&(t.stdDateFilterField=crmReports.escapeSplChars(t.stdDateFilterField));Crm.getCrmBasePath();Lyte.Router.transitionTo({route:"crm.tab.reports.view",dynamicParams:[t.reportId],queryParams:t})},addColumn:function(){var e=document.getElementById("selectedColumns"),t=document.getElementById("availList");for(i=0;i<e.length;i++)e.options[i].selected=!1;for(i=0;i<t.length;i++)if(1==t.options[i].selected){for(j=0;j<e.length;j++)if(e.options[j].value==t.options[i].value){var a=!0,r=e.options[j];break}if(1!=a){var o=document.createElement("OPTION");o.value=t.options[i].value,o.text=t.options[i].text,e.appendChild(o),t.options[i].selected=!1,o.selected=!0}else r.selected=!0;a=!1}var s=document.getElementById("moveup_link"),n=document.getElementById("moveup_disabled"),l=document.getElementById("movedown_link"),d=document.getElementById("movedown_disabled");s.style.display=l.style.display="block",n.style.display=d.style.display="none"},delColumn:function(){var e=document.getElementById("selectedColumns"),t=e.options.length;for(i=0;i<=t;i++)e.options.selectedIndex>=0&&e.remove(e.options.selectedIndex)},moveUp:function(){var e=document.getElementById("selectedColumns"),t=e.options.selectedIndex;if(t>0){var a=e.options.selectedIndex-1;temp=e.options[a].text,e.options[a].text=e.options[t].text,e.options[t].text=temp,temp=e.options[a].value,e.options[a].value=e.options[t].value,e.options[t].value=temp,e.options[a].selected=!0,e.options[t].selected=!1}},moveDown:function(){var e=document.getElementById("selectedColumns"),t=e.options.selectedIndex;if(t>-1&&t<e.options.length-1){var a=e.options.selectedIndex+1;temp=e.options[a].text,e.options[a].text=e.options[t].text,e.options[t].text=temp,temp=e.options[a].value,e.options[a].value=e.options[t].value,e.options[t].value=temp,e.options[a].selected=!0,e.options[t].selected=!1}},executeReportOptins:function(e,t){if($("#rep_runreportPop").hide(),$(".rep_selectedRow").removeClass("rep_selectedRow"),"run"===e)crmReports.showReport($("#currentReport").val(),$("#currentReportFolder").val());else if("edit"===e)crmReports.editReport($("#currentReport").val(),$("#currentReportType").val(),$("#currentReportFolder").val(),!1,!0);else if("export"===e)crmReports.exportCurrentReport(t);else if("copy"===e)crmReports.editReport($("#currentReport").val(),$("#currentReportType").val(),$("#currentReportFolder").val(),!0,!0);else if("delete"===e)$(".folderListul li").removeClass("ClickedFolder"),$("#folder_"+crmReports.currentFolder).addClass("ClickedFolder"),crmReports.tmpRepId=$("#currentReport").val(),crmReports.checkDeleteReport($("#currentReport").val(),!0);else if("showInFolder"===e){var a=$("#currentReportFolder").val(),r=$(".folderListul #folder_"+a);0!=r.length?($("#repFolders").animate({scrollTop:r.position().top+40},10),crmReports.getReports($("#folder_"+a),a,!1,!1,"",!0)):crmReports.generateHiddenFolder(a)}},updateFolderVisbility:function(){var e=$("#repFolderShow").attr("folderId"),t=Crm.getCrmBasePath()+"/CustomReportFolder.do?actionItem=updateRepFolderVis&isload=true&favIds="+e;mR(t,(function(e){$(".menucontainer .folderOptpopup,.selectedGear").hide(),$("#folder_"+crmReports.currentFolder).removeAttr("data-hiddenfolder")}),crmReports.csrf(),"","false")},generateHiddenFolder:function(e){var t=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=getHiddenFolderDetails&isload=true&folderId="+e;(new crmRequestPool).doAjax(t,(function(t){if("object"==typeof t){var a=$("<li/>").addClass("f_list cB fL repfolder").attr("title","folderName").attr("id","folder_"+e).attr("data-cid","getFolderReports").attr("data-zcqa",t.folderName).attr("data-params",'{"view":"FOLDER","actionItem":"getReports","folderId":"'+e+'","folderAcsrType":"'+t.accessorType+'"}').attr("data-hiddenFolder","true").attr("onmouseenter","crmReports.leftPanelAnimations(this)").attr("onmouseleave","$(this).removeClass('mouseOvered')"),r=$("<div/>").addClass("f_listcontent");r.append('<span class="listText fL crm-font-regular f14">'+t.folderName+"</span>"),r.append('<span class="gear_icon fR dN mT2" onclick="crmReports.folderOptions(this,false,\''+e+"');sE(event);\"></span>"),r.append('<div class="cB"></div>'),a.append(r),$(".folderListul.fL").append(a),$("#repFolders").animate({scrollTop:$(".folderListul #folder_"+e).position().top+40},10),crmReports.getReports($("#folder_"+e),e,!1,!1,"",!0)}}))},exportCurrentReport:function(e,t){$("#dropDownMenu").hide();var a=$("#currentReport").val(),r=$("#report_"+a).data("reptype");if("matrix"===r&&(Crm.userDetails.isPrivacySettingEnabled&&Crm.userDetails.privacyExcludeExport||Crm.userDetails.isHipaaFeatureEnabled&&Crm.userDetails.isHipaaPrivacyEnabled&&Crm.userDetails.isHipaaExportRestricted)){var i=new crmRequestPool,o=Crm.getCrmBasePath()+"/specific/ExportReport.do?action=validateMatrixField&reportId="+a;i.initiate({action:o,type:"GET",success:function(a){crmReports.exportAfterFieldValidation(e,t,r)},error:function(e){555===e.status&&"PRIVATE_FIELDS_PRESENCE"===e.responseText&&setTimeout((function(){var e=I18n.getMsg("crm.field.label.personal"),t=I18n.getMsg("crm.matrix.reports.private.data.error",e);$("#matrixRptAlert").text(t),showAnimatePopup("alertsPop")}),1)}})}else crmReports.exportAfterFieldValidation(e,t,r)},exportAfterFieldValidation:function(e,t,a){document.exportReportNew.fileType.value=e;var r=$("#report_"+$("#currentReport").val()+" a").attr("data-params");if(r&&(r=JSON.parse(r),document.exportReportNew.viewtype.value=r.viewtype),$("#pid").html(I18n.getMsg("crm.report.export.alert.message",[$ESAPI.encoder().encodeForHTML(crmReports.tmpRepName),e])),"matrix"!==a&&Crm.userDetails.isPrivacySettingEnabled&&Crm.userDetails.privacyExcludeExport){for(var i=Crm.userDetails.privacyPrefEnabledModules.length,o="",s=0;s<i;s++)o+=(0===s?"":", ")+I18n.getMsg(moduleRecordMapping[Crm.userDetails.privacyPrefEnabledModules[s]].plural_label);var n=I18n.getMsg("crm.field.label.personal");$("#privacyFieldAlert").html('<span class="gdprInfoIcon svgIcons dIB vat mR5"></span><span class="dIB vat w95per">'+I18n.getMsg("crm.privacy.export.report.private.data.alert",[n,o])+"</span>")}else $("#privacyFieldAlert").empty();$top=$(window).height()/2,$contop=$("#exptRptInProgress").innerHeight()/2,$left=$(window).width()/2,$conleft=$("#exptRptInProgress").width()/2,$("#exptRptInProgress").css({top:$top-$contop,left:$left-$conleft}),show("exptRptInProgress"),setTimeout((function(){$("#exptRptInProgress").fadeOut("slow")}),5e3),document.exportReportNew.submit()},backToTab:function(){var e=$("#schStatus").val(),t=Crm.getCrmBasePath()+"/ScheduleReport.do?actionItem=returnToSameTab&isload=true&schStatus="+e;mR(t,(function(e){$("#reportMain").html(e)}),crmReports.csrf())},backToCurrentFolder:function(){crmReports.lastSelectedTab="","crm.tab.reports.index"==Lyte.Router.getRouteInstance().transition.info.route?Lyte.Router.getRouteInstance().refresh():Lyte.Router.transitionTo({route:"crm.tab.reports.index"})},disableMove:function(){var e=document.getElementById("moveup_link"),t=document.getElementById("moveup_disabled"),a=document.getElementById("movedown_link"),r=document.getElementById("movedown_disabled"),o=document.getElementById("selectedColumns"),s=0;for(i=0;i<o.options.length;i++)1==o.options[i].selected&&s++;s>1?(e.style.display=a.style.display="none",t.style.display=r.style.display="block"):(e.style.display=a.style.display="block",t.style.display=r.style.display="none")},CallShowTooltip:function(e){var t=$(e).attr("data-title");$(".rep_blackToolTip").attr("style","").hide(),$(e).hasClass("refreshIconforReport")?""!=t&&(crmReports.timouttooltip=setTimeout((function(){$(".rep_blackToolTip").find(".rep_tooltext").text(t);var a=$(e).offset().top+20;$(e).offset().left,$(".rep_blackToolTip").width();$(".rep_blackToolTip:after").css("left",$(e).parent().width()-23),Crm.userDetails.RTL_ENABLED?$(".rep_blackToolTip").css({top:a,right:"100px"}).show():$(".rep_blackToolTip").css({top:a,left:$(e).parent().offset().left,"white-space":"pre-line"}).show()}),500)):""!=t&&(crmReports.timouttooltip=setTimeout((function(){$(".rep_blackToolTip").find(".rep_tooltext").text(t);var a=$(e).offset().top+30;$(e).offset().left,$(".rep_blackToolTip").width();$(".rep_blackToolTip:after").css("left",17),Crm.userDetails.RTL_ENABLED?$(".rep_blackToolTip").css({top:a,left:$(e).outerWidth()-20}).show():$(".rep_blackToolTip").css({top:a,left:$(e).offset().left,"white-space":"pre-line"}).show()}),500))},CallhideTooltip:function(e){clearTimeout(crmReports.timouttooltip),$(".rep_blackToolTip").hide()},showStopbtn:function(e){$(e).find(".stopButton").css({display:"inline-block",opacity:"0"}).stop().animate({opacity:"1"},600)},hideStopbtn:function(e){$(e).find(".stopButton").css({display:"none",opacity:"0"})},setHeightWidth:function(e,t){var a=0,r=$(window).height(),i=$(window).width(),o=$("#tabLayer"),s=$("#subscriptionExpiryMsgband"),n=$("#newReportsBand");if(s.length)var l=o.outerHeight()-s.outerHeight(),d=s.outerHeight();else l=o.outerHeight(),d=o.offset().top;n.length&&(l+=n.outerHeight(),d+=n.outerHeight());var c=$("#wmstoolbar").length?$("#wmstoolbar").outerHeight():26;if($("#reportLeftPanel").length){crmReports.setResizable();var u=$("#reportLeftPanel");a=parseInt(u.outerWidth());u.css({height:r-(66+d)});var m=$("#repFolders");m.height(r-(178+d)),thirdPartyUtils.bindPerfectScroll("#repFolders",{wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!1}),m.scrollTop(0),m.css("overflow","hidden")}if($(".rep_container").length&&$(".rep_container").css({height:r-(70+d),width:i}),$("#reportMain").length){var p=$("#reportMain");t?p.css({width:i}):Crm.userDetails.RTL_ENABLED?p.css({"margin-right":a}):p.css({"margin-left":a})}if($("#rep_LineDivHeader").length&&$("#rep_LineDivHeader").width(i-(a+40)),$("#folderList .folderListul").hasClass("ui-sortable")?$("#repFolders").height(r-(75+d)):$("#repFolders").height(r-(130+d)),e||($(".reportTotalrecCountforbottom").css("width",parseInt(i)-(parseInt(a)+40)),$("#reportMain,#rep_newSchedule").height(parseInt(r)-(l+c+5+d))),$("#reportsConta").length){var h=$("#reportsConta");h.hasClass("noneedbrdr")?h.hasClass("noneedbrdr")?h.css("height",parseInt(r)-235):$("html").hasClass("firefox")?h.css("height",parseInt(r)-210):h.css("height",parseInt(r)-219):(h.css({"max-height":parseInt(r)-220}),thirdPartyUtils.bindPerfectScroll("#reportsConta",{wheelSpeed:1,wheelPropagation:!0,suppressScrollX:!1}),h.css("overflow","hidden"))}if($("#report_scrollingEntityDiv").length){var f=$("#report_scrollingEntityDiv");if(f.height($(".rep_centercontainer").height()-100),f.hasClass("eA_repScrDiv")){var v=0;$(".reportTotalrecCountforbottom").outerHeight()&&(v=$(".reportTotalrecCountforbottom").outerHeight()),f.height(r-($(".LeadsConverstaionmenu").outerHeight()+l+c+5+v))}}$("#ChartDivOuter").length&&$("#ChartDivOuter").width(i-(a+40)),$("#rep_displayingReports_inner").length&&($("#Report_Org_Data,#rep_displayingReports_inner").css({width:$("#Report_Org_Data table").width()+"px",height:$("#Report_Org_Data table").height()+"px"}),crmReports.setTableHeaderRowIndiv(),$("#report_scrollingEntityInnerDiv").css({width:$("#Report_Org_Data table").width()+"px",height:$("#Report_Org_Data table").height()+parseInt(75)+$("#ChartDivOuter").height()+"px"}),$("#report_scrollingEntityDiv").css({overflow:"auto"}),$("#parentChartDiv").is(":visible")&&$(".chartborderFix").show().css({width:$("#Report_Org_Data table").width()+40}),$("#report_scrollingEntityDiv").length||$("#reportMain").removeClass("p0")),$("#availableRecipients").length&&(thirdPartyUtils.bindPerfectScroll("#availableRecipients",{wheelSpeed:1,wheelPropagation:!0,suppressScrollX:!1}),$("#availableRecipients").css("overflow","hidden")),$(".formcontainer").length&&$(".formcontainer").css({width:i,height:r-(l+c)}),crmReports.disableMigrateBtn&&($(".newnormalgreenbtn").addClass("disableMigratebtn"),crmReports.tooltipMsgHeading=localStorage.getItem("reports_migration")?I18n.getMsg("crm.report.upgrade.tooltip.message.success1"):I18n.getMsg("crm.report.upgrade.tooltip.message.heading"),crmReports.tooltipMsgContent=localStorage.getItem("reports_migration")?I18n.getMsg("crm.report.upgrade.tooltip.message.success2"):I18n.getMsg("crm.report.upgrade.tooltip.message.content1"),crmReports.updatedTimeMsg=localStorage.getItem("reports_migration")?"":I18n.getMsg("crm.report.upgrade.tooltip.message.content2",crmReports.scheduledTime),crmReports.showMigrateTooltip())},reportScrollFixedHeader:function(e){(e=$(e)).scrollTop();var t=e.scrollLeft(),a=$("#Report_Org_Data").position(),r=a.top,i=a.left,o=crmReports.leftScrollAmount-t;0>=r?($("#Report_HeaderContainer").show(),Crm.userDetails.RTL_ENABLED?o>0?$("#Report_HeaderContainer").css("right","-"+o+"px"):$("#Report_HeaderContainer").css("right",Math.abs(o)+"px"):$("#Report_HeaderContainer").css("left",i+20-19),$("#reportbottomrigthnav").show(),$("#scrollTopDiv").fadeIn(),$("#scrollTopDiv").find(".zc-scrollTop").addClass("active")):($("#Report_HeaderContainer").hide(),Crm.userDetails.RTL_ENABLED?o>0&&$("#parentChartDiv,#report_filterSection").css("left","-"+o+"px"):o<0&&$("#parentChartDiv,#report_filterSection").css({left:t,position:"relative"}),$("#reportbottomrigthnav").hide(),$("#scrollTopDiv").find(".zc-scrollTop").removeClass("active"),$("#scrollTopDiv").fadeOut())},setResizable:function(){$("#reportLeftPanel").resizable({handles:"e, w",minWidth:220,maxWidth:350,alsoResizeReverse:".rep_centercontainer"})},callRunReport:function(e,t,a,r,i,o){var s,n=!1;if($("#currentReport").val(t),crmReports.tmpRepName=$(e).siblings(".NameText").children("link-to").children("a").text(),crmReports.reportId=t,$("#currentReportFolder").val(a),$("#currentReportType").val(r),$(".rep_runreportnav").css("top","9px"),$("#rep_runreportPop").css({left:parseInt($(e).offset().left)+27,top:parseInt($(e).offset().top)-12}),crmReports.currentFolder&&-1==crmReports.currentFolder.search("REPORTS")&&1==$(".ClickedFolder").length?$("#listViewShowIn").hide():$("#listViewShowIn").show(),i&&"false"!=i?$("#listViewEditRep, #listViewDelRep").show():$("#listViewEditRep, #listViewDelRep").hide(),$("#listViewEditRep.repEdit").toggle(i||o),"block"==$("#rep_runreportPop").css("display"))if($(e).hasClass("rep_selectedRow"))$(".rep_selectedRow").removeClass("rep_selectedRow"),thirdPartyUtils.bindPerfectScroll("#reportsConta",{wheelSpeed:1}),$("#rep_runreportPop").css("display","none"),$(".freezeLayerdrop").remove();else{$(".rep_selectedRow").removeClass("rep_selectedRow"),$(e).addClass("rep_selectedRow"),$("#rep_runreportPop").css("display","block"),$("#reportsConta").remove(".freezeLayerdrop").append('<div class="freezeLayerdrop" onclick="$(this).hide();"></div>');var l=$(e).offset().top+$("#rep_runreportPop").outerHeight(),d=$(e).offset().top-11;if(l-13>$("#reportMain").offset().top+$("#reportMain").outerHeight()-3){d=$(e).offset().top-3;$("#rep_runreportPop").addClass("runpopupBotFix"),setTimeout((function(){var e=d-$("#rep_runreportPop").offset().top;s=e+3,n=!0,$(".runpopupBotFix .rep_runreportnav").css({top:e})}),10)}else $("#rep_runreportPop").removeClass("runpopupBotFix")}else{$(".rep_selectedRow").removeClass("rep_selectedRow"),$(e).addClass("rep_selectedRow"),$("#rep_runreportPop").css("display","block"),$("#reportsConta").remove(".freezeLayerdrop").append('<div class="freezeLayerdrop" onclick="$(this).hide();"></div>'),thirdPartyUtils.unbindPerfectScroll("#reportsConta");l=$(e).offset().top+$("#rep_runreportPop").outerHeight(),d=$(e).offset().top-11;if(l-13>$("#reportMain").offset().top+$("#reportMain").outerHeight()-3){d=$(e).offset().top-3;$("#rep_runreportPop").addClass("runpopupBotFix"),setTimeout((function(){var e=d-$("#rep_runreportPop").offset().top;s=e+3,n=!0,$(".runpopupBotFix .rep_runreportnav").css({top:e})}),10)}else $("#rep_runreportPop").removeClass("runpopupBotFix")}setTimeout((function(){n?($("#rp-arr-pos").remove(),$("#rep_runreportPop").addClass("rp-arr-pos"),$('<style type="text/css" id="rp-arr-pos">.rp-arr-pos:before{top: '+s+"px;} .rp-arr-pos:after{top: "+(s-1)+"px;}</style>").appendTo("#rep_runreportPop"),n=!1):($("#rp-arr-pos").remove(),n=!1)}),10)},ShowFiltersSection:function(e){var t=$(e).find(".showFilter_rep");if(t.hasClass("upArr_rep"))t.removeClass("upArr_rep").addClass("downArr_rep"),$(e).css({"border-bottom":"1px solid #ddd","background-color":"#fbfbfb"}),$(".report_FilterSection").hide(),$("#noreportsFound").is(":visible")&&$("#noreportsFound").css({top:$("#noreportsFound").css("top")+$(".report_FilterSection").outerHeight()}),$("#parentChartDiv").is(":visible")&&$(".chartborderFix").css({bottom:"52px"});else{if(t.removeClass("downArr_rep").addClass("upArr_rep"),$(e).css({"border-bottom":"1px solid #fff","background-color":"#fff"}),$(".report_FilterSection").show(),$("#noreportsFound").is(":visible")){var a=parseInt($("#noreportsFound").css("top").replace("px",""));$("#noreportsFound").css({top:a+57})}$("#parentChartDiv").is(":visible")&&$(".chartborderFix").css({bottom:"111px"}),thirdPartyUtils.bindSelect2($(".newSelect").find("select"))}},animatepopFromTop:function(e){var t=0,a=$("#"+e);a.css("left",$(window).width()/2-a.outerWidth()/2),"none"==a.css("display")?(a.show(),a.find(".zcrm-content").css("max-height","none"),"sendMailPopUp"!=e&&a.find(".popup-model-content").css("max-height",$(window).height()-(a.find(".popup-model-header").outerHeight()+a.find(".popup-model-footer").outerHeight()+$("#wmstoolbar").outerHeight()+63)),t=a.outerHeight(),a.css("top","-"+t+"px"),a.animate({top:0},300)):(t=a.outerHeight(),a.animate({top:"-"+t},300,(function(){$(this).hide(),hideFreezeLayer()}))),"sendMailPopUp"===e&&(crmReports.selectedRecipients={},$("#selectedUsersDiv").remove())},callExportReport:function(e){var t=$(e).position().top+$(e).outerHeight()+1,a=$(e).position().left;"none"==$("#dropDownMenu").css("display")?($(".rep_runreportPop,#dropDownMenu").css("display","none"),$("#dropDownMenu").css({top:t+"px",left:a+"px"}).show()):$("#dropDownMenu").css("display","none")},showSeemore:function(e){$(".hiddenTextArea").each((function(e,t){$(this).is(":visible")&&$(this).hide().parent().find(".descText").show()})),crmReports.CallelementCheck(),$(e).hide(),$(e).parent().find(".descText").hide(),$(e).parent().find(".hiddenTextArea").show()},CallelementCheck:function(){$(".descText").each((function(e,t){(470==$(this).width()||$(this).width()>470||$(this).hasClass("seemoreclass"))&&0==$(this).parent().find(".hiddenTextArea").is(":visible")&&($(this).innerWidth()<$(this)[0].scrollWidth&&$(this).siblings(".seemorelink").show(),$(this).addClass("seemoreclass"))}))},addByEmailAddress:function(e,t){if(188==e.keyCode){var a=$(t).val();if($("#repaddemailbyaddress").val(""),""!=a){var r=a.indexOf(","),i=a;0==r&&(i=i.substr(1));var o=i.lastIndexOf(",");if(-1!=o){var s="<div class='rep_emailContainer'><span class=''>"+$ESAPI.encoder().encodeForHTML(i.slice(0,o))+"</span><div class='closeicon ico-close-small svgIcons' onclick='crmReports.closeRepIcon(this)'></div></div>",n=$(s).insertBefore($("#repaddemailbyaddress"));$(t).val("");var l=$("#selectedRecipients ul li").length-$("#selectedRecipients ul").length+$(".addbyemailaddress .rep_emailContainer").length;$(".selectedRecipientsCount").text(l);var d=n.outerWidth(),c=$(".selectedCount");if(c.length){var u=JSON.parse(c.html());c.text(u+1)}crmReports.newwidth=$(t).outerWidth()-d,crmReports.newwidth<112?($(t).width("177"),totwidth=0):$(t).width(crmReports.newwidth-10)}}}},constructAdditionalRecs:function(e){var t=e.split(",");for(i=0;i<t.length;i++){var a="<div class='rep_emailContainer'><span class=''>"+$ESAPI.encoder().encodeForHTML(t[i])+"</span><div class='closeicon ico-close-small svgIcons' onclick='crmReports.closeRepIcon(this)'></div></div>";$(a).insertBefore($("#repaddemailbyaddress"))}},closeRepIcon:function(e){crmReports.newwidth=crmReports.newwidth+$(e).parent().outerWidth(),$(e).parent().remove();var t=$("#selectedRecipients ul li").length-$("#selectedRecipients ul").length+$(".addbyemailaddress .rep_emailContainer").length;$(".selectedRecipientsCount").text(t);var a=$(".selectedCount");if(a.length){var r=JSON.parse(a.html());a.text(r-1)}},checkUnCheck:function(e){$(e).hasClass("Iconchecked")?$(e).addClass("Iconcheck").removeClass("Iconchecked"):$(e).addClass("Iconchecked").removeClass("Iconcheck")},showChartOption:function(e){var t=$(e).position().top+$(e).outerHeight(),a=parseInt($(e).position().left)+6;"none"==$(".rep_Exportoptiondiv").css("display")?($(".rep_runreportPop,#dropDownMenu").css("display","none"),$(".rep_Exportoptiondiv").css({left:a+"px",top:parseInt(t)+1+"px",display:"block"})):$(".rep_Exportoptiondiv").css("display","none")},setTableHeaderRowIndiv:function(){$(".Report_HeaderContainer").next().find("tr:nth-child(2)").find("td:first-child").hasClass("zrBl")?0===$(".summaryRep").length&&($(".Report_HeaderContainer").width($("#Report_Org_Data").width()-1),$(".Report_HeaderContainer").next().find("table").addClass("summaryTableRep"),$(".Report_HeaderContainer").next().find("tr:first-child").addClass("summaryRep"),$("#Report_HeaderContainer").find("tbody").append($(".Report_HeaderContainer").next().find("tr:first-child").clone()),$("#Report_HeaderContainer").find("tbody").append($(".Report_HeaderContainer").next().find("tr:nth-child(2)").clone()),$("#Report_Org_Data tr:nth-child(2)").find("td").each((function(e,t){$("#Report_HeaderContainer").find("td").eq(e).width($(this).width())})),$("#Report_Org_Data tr:first").find("td").each((function(e,t){$("#Report_HeaderContainer").find("td").eq(e).width($(this).width())}))):($(".Report_HeaderContainer").width($("#Report_Org_Data").width()-1),$("#Report_HeaderContainer").find("tbody").html($(".Report_HeaderContainer").next().find("tr:first-child").clone()),$("#Report_Org_Data tr:first").find("td").each((function(e,t){$("#Report_HeaderContainer").find("td").eq(e).width($(this).width())}))),$(".zcRT1 .zrBl a").click((function(){var e=$(this).attr("href");return crmReports.sortReportColumn(e),!1})),setTimeout((function(){crmReports.leftScrollAmount=$("#report_scrollingEntityDiv").scrollLeft()}),300)},showPopupDropdown:function(e,t){var a=$(e).position().top+$(e).outerHeight()+2,r=$(e).position().left;if("none"==$("#"+t).css("display")){$(".rep_runreportPop,#dropDownMenu").css("display","none"),$("#"+t).css({top:a+"px",left:r+"px",visibility:"hidden",display:"block"});var i=$("#"+t).offset().left+$("#"+t).outerWidth();$(window).width()<=i?$("#"+t).css({top:a+"px",left:r-$("#"+t).outerWidth()+$(e).outerWidth(),visibility:"visible"}).show():$("#"+t).css({top:a+"px",left:r+"px",visibility:"visible"}).show()}else $("#"+t).css("display","none")},descSeemoreShow:function(){var e=$(".seemorelink").width();$(".descText").each((function(t){$(this).css({width:$(this).parent().width()-30}),$(this).innerWidth()<$(this)[0].scrollWidth?($(this).closest("td").children(".seemorelink").removeClass("dN"),$(this).css({"white-space":"nowrap","text-overflow":"ellipsis",float:"left",width:$(this).parent("td").width()-(e+33)}),$(".hiddenTextArea").css({width:$(this).parent("td").width()-33})):$(this).parent("td").children(".seemorelink").remove()}))},hideFolders:function(){var e=$("#repFolderHide").attr("folderId"),t=Crm.getCrmBasePath()+"/CustomReportFolder.do?actionItem=hideRepFolder&isload=true&reportFolderId="+e;mR(t,(function(t){if($("#folder_"+e).remove(),$(".menucontainer .folderOptpopup,.selectedGear").hide(),e===crmReports.currentFolder){var a=$("#folderList .folderListul li:first-child");a.addClass("ClickedFolder");var r=a.attr("id");crmReports.getReports(a,r.split("_")[1],!1,!1,null),$("#repFolders").scrollTop(0)}}),crmReports.csrf(),"","false")},showGroupFunction:function(e,t){var a=e.split(":")[4];24!=a&&786!=a&&14!=a&&200!=a&&333!=a||t&&"true"===t?(document.getElementById("groupFnName").value="",document.getElementById("groupDateDiv").style.display="none",document.getElementById("groupFnNameDiv").style.display="none"):(24==a?crmReports.setOptValuesForGroup("groupFnName","D"):crmReports.setOptValuesForGroup("groupFnName","DT"),document.getElementById("groupFnNameDiv").style.display="",show("groupDateDiv"),document.getElementById("groupFnName").options[0].selected=!0,$("#groupFnName").trigger("change.select2"))},disableSortForEncFields:function(e,t,a){var r=document.getElementById(t),i=document.getElementById(a);"false"==e&&"hidden"==r.style.visibility?(r.style.visibility="visible",i.style.visibility="visible"):"true"!=e||""!=r.style.visibility&&"visible"!=r.style.visibility||(r.style.visibility="hidden",i.style.visibility="hidden")},setOptValuesForGroup:function(e,t){if("groupFnName"==e||"colHdrGpFnName"==e){var a=document.getElementById(e).options;"D"==t?(a[0].value="",a[1].value="CalendarMonth",a[2].value="CalendarYear"):"DT"==t&&(a[0].value="CalendarDate",a[1].value="TCalendarMonth",a[2].value="TCalendarYear")}},showColHdrGpFn:function(e,t){var a=e.split(":")[4];24!=a&&786!=a&&14!=a&&200!=a&&333!=a||t&&"true"===t?(document.getElementById("colHdrGpFnName").value="",document.getElementById("chGroupDateDiv").style.display="none",document.getElementById("colHdrGpFnNameDiv").style.display="none"):(24==a?crmReports.setOptValuesForGroup("colHdrGpFnName","D"):crmReports.setOptValuesForGroup("colHdrGpFnName","DT"),document.getElementById("colHdrGpFnNameDiv").style.display="",show("chGroupDateDiv"),document.getElementById("colHdrGpFnName").options[0].selected=!0)},checkAndShowGroupFn:function(e){if(document.getElementById("groupFnNameDiv").style.display="none",document.getElementById("groupDateDiv").style.display="none",null!=e&&"null"!=e){document.getElementById("groupFnNameDiv").style.display="",show("groupDateDiv");var t=document.getElementById("groupFnName");"CalendarYear"==e||"CalendarMonth"==e?(crmReports.setOptValuesForGroup("groupFnName","D"),"CalendarMonth"==e?t.options[1].selected=!0:"CalendarYear"==e?t.options[2].selected=!0:t.options[0].selected=!0):"TCalendarYear"!=e&&"TCalendarMonth"!=e&&"CalendarDate"!=e||(crmReports.setOptValuesForGroup("groupFnName","DT"),"TCalendarMonth"==e?t.options[1].selected=!0:"TCalendarYear"==e?t.options[2].selected=!0:t.options[0].selected=!0)}else{var a=document.getElementById("RowHeader1"),r=a.options[a.options.selectedIndex].value,i=a.options[a.options.selectedIndex].getAttribute("isEnc"),o=r.split(":")[4];24!=o&&786!=o&&14!=o&&333!=o&&200!=o||i&&"true"===i?(document.getElementById("groupFnNameDiv").style.display="none",document.getElementById("groupDateDiv").style.display="none"):(24==o?crmReports.setOptValuesForGroup("groupFnName","D"):crmReports.setOptValuesForGroup("groupFnName","DT"),document.getElementById("groupFnNameDiv").style.display="",show("groupDateDiv"),document.getElementById("groupFnName").options[0].selected=!0,$("#groupFnName").trigger("change.select2"))}},checkAndShowCHGroupFn:function(e){if(document.getElementById("colHdrGpFnNameDiv").style.display="none",document.getElementById("chGroupDateDiv").style.display="none",null!=e&&"null"!=e){document.getElementById("colHdrGpFnNameDiv").style.display="",show("chGroupDateDiv");var t=document.getElementById("colHdrGpFnName");"CalendarYear"==e||"CalendarMonth"==e?(crmReports.setOptValuesForGroup("colHdrGpFnName","D"),"CalendarMonth"==e?t.options[1].selected=!0:"CalendarYear"==e?t.options[2].selected=!0:t.options[0].selected=!0):"TCalendarYear"!=e&&"TCalendarMonth"!=e&&"CalendarDate"!=e||(crmReports.setOptValuesForGroup("colHdrGpFnName","DT"),"TCalendarMonth"==e?t.options[1].selected=!0:"TCalendarYear"==e?t.options[2].selected=!0:t.options[0].selected=!0)}else{var a=document.getElementById("ColHeader1"),r=a.options[a.options.selectedIndex].value,i=a.options[a.options.selectedIndex].getAttribute("isEnc"),o=r.split(":")[4];24!=o&&786!=o&&14!=o&&333!=o&&200!=o||i&&"true"===i?(document.getElementById("colHdrGpFnNameDiv").style.display="none",document.getElementById("chGroupDateDiv").style.display="none"):(24==o?crmReports.setOptValuesForGroup("colHdrGpFnName","D"):crmReports.setOptValuesForGroup("colHdrGpFnName","DT"),document.getElementById("colHdrGpFnNameDiv").style.display="",show("chGroupDateDiv"),document.getElementById("colHdrGpFnName").options[0].selected=!0)}},reportsTab:function(e,t){if("reportTypeTab"===t)$("#editReportType").show(),$("#tabForRepresentation,#editFilters,#editBasicInfo").hide();else if("reportRepTab"===t)$("#tabForRepresentation").show(),$("#editReportType,#editFilters,#editBasicInfo").hide();else if("reportFiltersTab"===t){if($("#tabForRepresentation,#editReportType,#editBasicInfo").hide(),$("#editFilters").show(),$("#reportMatrixGrouping").is(":visible")){var a=$("#reportMatrixGrouping .newSelect").find("select");a.select2("destroy"),thirdPartyUtils.bindSelect2(a)}}else $("#tabForRepresentation,#editReportType,#editFilters").hide(),$("#editBasicInfo").show();$(".editReporttab li a").removeClass("editReporttabActive"),$(e).addClass("editReporttabActive")},cancelDelPop:function(){removeFreezeLayer(),$("#repDeleteAlertDiv").hide(),$(".reportDelTt").remove()},drillDown:function(e,t,a,r,i,o,s,n){var l=networkUtils.parseUrl(e).params;a&&a.trim()||(a="${EMPTY}"),i&&i.trim()&&"__"!==i.trim()||(i="${EMPTY}"),-1!=a.indexOf(",")&&(a=a.replace(",","\\,")),-1!=i.indexOf(",")&&(i=i.replace(",","\\,")),l.criteria=[{api_name:t,comparator:"equal",value:a},"and",{api_name:r,comparator:"equal",value:i}],l.summaryCol=o,l.summaryValue=s,l.criteria=JSON.stringify(l.criteria),l.stdDateFilter&&"null"!==l.stdDateFilter&&(l.stdDateFilter=decodeURIComponent(l.stdDateFilter)),l.action="getDetails";e=Lyte.Router.getURL({route:"crm.tab.reports.records",dynamicParams:[n],queryParams:l});window.lookUpWin=window.open(e,"","")},validateJson:function(e){for(var t=e.length,a=0;a<t;a++){var r=e[a];"object"==typeof r&&(r[0]?crmReports.validateJson(r):void 0===r.value||r.value.trim()&&"__"!==r.value.trim()||(r.value="${EMPTY}"))}},showBluePrintOptions:function(e){(e=$(e)).find(".listelt_check1_checked").length>0?($("#selectBP").removeClass("hide"),thirdPartyUtils.bindSelect2("#selectBP")):(thirdPartyUtils.unbindSelect2($("#selectBP")),$("#selectBP").addClass("hide"))}};$.ui.plugin.add("resizable","alsoResizeReverse",{start:function(){var e=$(this).resizable("instance").options;$(e.alsoResizeReverse).each((function(){var e=$(this);e.data("ui-resizable-alsoresizeReverse",{marginLeft:parseInt($(e).css("margin-left"),10),height:parseInt($(e).outerHeight(),10)})}))},resize:function(e,t){var a=$(this).resizable("instance"),r=a.options,i=a.originalSize,o=(a.originalPosition,{height:a.size.height-i.height||0,marginLeft:a.size.width-i.width||0});$(r.alsoResizeReverse).each((function(){var e=$(this),a=$(this).data("ui-resizable-alsoresize-reverse"),r={},i=e.parents(t.originalElement[0]).length?["marginLeft","height"]:["width","height","top","left"];$.each(i,(function(e,t){var i=(a[t]||0)+(o[t]||0);i&&i>=0&&(r[t]=i||null)})),e.css(r)}))},stop:function(){$(this).removeData("resizable-alsoresize-reverse")}}),crmReports.updateReportColumns=function(e){crmReports.update($("#availList"),e,"availList"),crmReports.update($("#selectedColumns"),e,"selectedColumns")},crmReports.update=function(e,t,a){$.each(e.find("option"),(function(e,r){var i=(r=$(r)).val();try{var o=i.split(":");if(crmReports.dummyBPColumns.indexOf(o[0]+":"+o[1])>-1)switch(a){case"availList":"tabular"!==t?r.addClass("hide"):r.removeClass("hide");break;case"selectedColumns":"tabular"!==t&&r.remove()}}catch(e){}}))},crmReports.getShowFolderSharingDetails=function(e,t){var a={},r=[],i={};i.type=e?"ActiveConfirmedUsers":"ActiveUsers";var o={name:I18n.getMsg("crm.security.users"),model_name:"user",idSelector:"id",nameSelector:"full_name",prefix:"U",imageSelector:"image_link",descriptionSelector:"email",pagination:!0,setSearchCriteria:"",cxPropQueryParams:i,cxPropEmptyDataMsg:I18n.getMsg("crm.label.no.users.available")},s={name:I18n.getMsg("crm.security.public.groups"),model_name:"user_group",idSelector:"id",prefix:"G",nameSelector:"name",pagination:!1,cxPropEmptyDataMsg:I18n.getMsg("crm.label.no.groups.available")};if(e?(r.push(o),r.push(s)):(r.push(s),r.push(o)),r.push({name:I18n.getMsg("crm.security.roles"),model_name:"role",idSelector:"id",prefix:"R",nameSelector:"display_label",pagination:!1,cxPropEmptyDataMsg:I18n.getMsg("crm.label.no.roles.available")}),t&&r.push({name:I18n.getMsg("crm.security.roles.subordinates"),model_name:"role",idSelector:"id",prefix:"RS",nameSelector:"name",pagination:!1,cxPropEmptyDataMsg:I18n.getMsg("crm.label.no.roles.subordinates.available")}),crmReports.territoryEnabled){var n=[];""!==crmReports.orgTerritoryId&&n.push(crmReports.orgTerritoryId),r.push({name:I18n.getMsg("crm.territory.territories"),model_name:"territory",idselector:"id",prefix:"T",nameSelector:"name",pagination:!1,cxPropEmptyDataMsg:I18n.getMsg("crm.label.no.territory.available"),cxPropExclude:n}),t&&r.push({name:I18n.getMsg("crm.label.territories.and.subordinates"),model_name:"territory",idselector:"id",prefix:"TS",nameSelector:"name",pagination:!1,cxPropEmptyDataMsg:I18n.getMsg("crm.label.no.territory.subordinates.available"),cxPropExclude:n})}a.showSharingModels=r,a.selectedItems={},a.configType=e?"ReportRecipients":"ReportFolder",e&&null!=crmReports.scheduledsharedData&&""!=crmReports.scheduledsharedData&&(crmReports.isReportSchedulePage=e,a.selectedItems=crmReports.scheduledsharedData),e||null==crmReports.sharedData||""==crmReports.sharedData||(a.selectedItems=crmReports.sharedData),store.findAll("field",{module:"users"}).then((function(e){if(a.isFirstNameFieldAvailable=!1,e&&null!=e)for(var t=e.length,r=0;r<t;r++)if("first_name"===e[r].api_name){a.isFirstNameFieldAvailable=!0;break}var i=$("#folderSharingTemplate");null!=i&&i.length>0&&i[0].remove();var o=Lyte.Component.render("crm-folder-sharing",a,"body");o.id="folderSharingTemplate";var s=o.getElementsByTagName("crux-combo-box")[0];s.cxProp("maxLimit",500),s.cxProp("show",!0),crmReports.isReportSchedulePage?s.cxProp("headerMsg",I18n.getMsg("crm.workflow.selected.recipients")):s.cxProp("headerMsg",I18n.getMsg("crm.label.rejection.send.alert.users"))}))},crmReports.showSharedDetails=function(e,t,a,r,i){crmReports.isReportSchedulePage=r||!1;var o=$(e);$(".shareWithLabel").removeClass("selectshare"),o.closest(".shareWithLabel").addClass("selectshare");var s=$("#folderInfo").find("span");"allowedUsers-all"==t?s.removeClass("shareOnlyMeIcon").addClass("shareUserIcon"):"allowedUsers-noUsers"==t?s.removeClass("shareUserIcon").addClass("shareOnlyMeIcon"):"allowedUsers-selected"==t&&s.removeClass("shareOnlyMeIcon").addClass("shareUserIcon");var n=crmReports.isReportSchedulePage?$("#schedule_report_shared_details"):$("#shared_details");if(a){crmReports.isReportSchedulePage&&null!=crmReports.scheduledsharedData&&0!=crmReports.scheduledsharedData.length&&($("#recipientsChoose").hide(),n.css("display","inline-block")),crmReports.isReportSchedulePage||null==crmReports.sharedData||0==crmReports.sharedData.length||n.css("display","inline-block");var l=n.find("ul").find("li"),d=(1!=l.length||l.text()!==I18n.getMsg("crm.label.no.selected.users.available"))&&0!=l.length;crmReports.isReportSchedulePage||(d||null!=crmReports.sharedData)&&""!=crmReports.sharedData?crmReports.isReportSchedulePage&&(!d&&null==crmReports.scheduledsharedData||""==crmReports.scheduledsharedData)&&crmReports.getShowFolderSharingDetails(!0,i):crmReports.getShowFolderSharingDetails(!1,i)}else n.css("display","none")},crmReports.showNewReportsBanner=function(){var e=document.querySelector("crm-new-reports-popup"),t=!1;if((newReportsEnabled||!1||crmReports.disableMigrateBtn)&&(t=!0),e?(e.setData("disableMigrateBtn",crmReports.disableMigrateBtn),e.setData("scheduledTime",crmReports.scheduledTime),e.setData("tooltipMsgHeading",crmReports.tooltipMsgHeading),e.setData("tooltipMsgContent",crmReports.tooltipMsgContent),e.setData("updatedTimeMsg",crmReports.updatedTimeMsg),e.setData("showCloseIcon",t)):e=Lyte.Component.render("crm-new-reports-popup",{disableMigrateBtn:crmReports.disableMigrateBtn,scheduledTime:crmReports.scheduledTime,tooltipMsgHeading:crmReports.tooltipMsgHeading,tooltipMsgContent:crmReports.tooltipMsgContent,updatedTimeMsg:crmReports.updatedTimeMsg,showCloseIcon:t},".rep_container"),e&&e.component){var a=document.getElementById("newReportsPopup");a&&a.ltProp("show",!0)}},crmReports.enableNewReports=function(){if(!crmReports.disableMigrateBtn){var e=document.querySelector("crm-new-reports-popup");(e=e||Lyte.Component.render("crm-new-reports-popup",{},".rep_container"))&&(e=e.component).actions.migrateReports()}},crmReports.showMigrateTooltip=function(){var e=$(".tryNewTooltip");e&&(e.find(".tryNewtooltipHdr").text(crmReports.tooltipMsgHeading),e.find(".tryNewtooltipContent").text(crmReports.tooltipMsgContent),e.find(".tryNewtooltipTime").text(crmReports.updatedTimeMsg))},crmReports.convertDateToUserTime=function(e){var t="",a=new Date(e),r=(t=Crm.userDetails.TIME_FORMAT,a.getHours()),i=a.getMinutes();if("hh:mm a"===t){var o=r>=12?"PM":"AM";t=(r=(r=r>12?r-12:r)<10?"0"+r:r)+":"+(i=i<10?"0"+i:i)+" "+o}else t=(r=r<10?"0"+r:r)+":"+(i=i<10?"0"+i:i);return crmReports.scheduledTime=t,t},crmReports.onToggle=function(e){var t=e.options[e.selectedIndex].value,a=document.getElementById("chatOptions"),r=document.getElementById("emailRecpts");if(crmReports.recipientType="none"===t?void 0:t,r.classList.add("dN"),a.classList.add("dN"),"none"!==t)if("email"===t){var i=document.getElementsByTagName("crm-folder-sharing");i.length>0&&((i=i[0].component).methods.saveSelectedOptions.call(i,[]),i.methods.closeShareDetails.call(i)),r.classList.remove("dN")}else{if("cisco"===t&&"false"===cisco.isCiscoTeamsAuthorised)return crmReports.recipientType="none",void Lyte.injectResources(networkUtils.returnDependencyFiles(["zohocrm_chatIntegration.js"]),void 0,(function(){cisco.callback=function(){crmReports.recipientType=t,crmReports.renderChatOptions(t)},chatIntegration.authorise(t,"reports")}));crmReports.renderChatOptions(t)}},crmReports.handleRecptsNew=function(){var e=document.getElementById("repTypeSel");2===e.length?(e.classList.add("dN"),e.selectedIndex=1,crmReports.recipientType="email"):(crmReports.recipientType=void 0,document.getElementById("emailRecpts").classList.add("dN"))},crmReports.handleChatOptionsEdit=function(e,t){document.getElementById("emailRecpts").classList.add("dN"),crmReports.recipientType=e,crmReports.renderChatOptions(e,t)},crmReports.renderChatOptions=function(e,t){var a=networkUtils.returnDependencyFiles(["zohocrm_chatIntegration.js",networkUtils.getI18nJSUrl("chatintegrations")]).concat(networkUtils.returnDependencyFiles(["crm-chat-options.js","chat-integ-store.js","slack-setup-store.js","chat-setup-store.js"],crmConstants.jsStaticPathForLyte)).concat(networkUtils.returnDependencyFiles(["crm-chat-options.css"],crmConstants.cssStaticPathForLyte));Lyte.injectResources(a,void 0,(function(){var a=document.getElementById("chatOptions");a.component.setData("chatType",void 0),a.component.setData({chatType:e,savedOptions:t}),a.classList.remove("dN")}))},crmReports.goToReportsTab=function(){networkUtils.lyteInitiateRequest("/crm/v2/Reports/__internal/revamp_enabled","GET").then((function(e){-1!==Lyte.Router.getRouteInstance().transition.url.indexOf("/tab/Reports")?Utils.windowLocationHref(""):(e.enabled,newReportsEnabled?Lyte.Router.transitionTo({route:"crm.tab.newReports.index"}):Lyte.Router.transitionTo({route:"crm.tab.reports.index"}))}))},function(){var e=Handlebars.template;(Handlebars.templates=Handlebars.templates||{}).unsupport_mergefields=e({compiler:[7,">= 4.0.0"],main:function(e,t,a,r,i){return'<div id="unsupportedMergeFieldPop" style="display:none;background-color:white" class="nTpop zcrm-modal zcrm-effect mWid600 zi32"> <div class="zcrm-content p25"> <div id="unsupportedMergeFieldPopSub"></div> <div class="mT20 p20 bdre5e5e5 bgf7f7f7" style="overflow:auto;height:200px;"> <div  id="unsupportedSubjectMergeField" style="display:none;" class="f14 crm-font-regular"></div> <div  id="unsupportedBodyMergeField" style="display:none;" class="f14 crm-font-regular mT10"></div> <div  id="unsupportedFooterMergeField" style="display:none;" class="f14 crm-font-regular mT10"></div></div> <div id="unsupportedFieldMsg"></div> <div class="mT40"> <button class="newSaveBtn crm-font-regular" name="okTemplateBtn" id="okTemplateBtn" value="unsupportedField">'+e.escapeExpression(a.getI18n.call(null!=t?t:{},"crm.button.ok",{name:"getI18n",hash:{},data:i}))+"</button> </div> </div> </div>"},useData:!0})}();