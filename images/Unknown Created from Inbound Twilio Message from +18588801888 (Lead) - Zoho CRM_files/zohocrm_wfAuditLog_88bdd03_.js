var WFAuditLog={getCriteriaPoPUpDetails:function(e,i,t){var r=new crmRequestPool,a={};a.auditLogId=e,a[csrfParamName]=csrfToken,a.action="getWFCriteriaDetails",commonUtils.showHideLoadingDiv(!0),r.initiate({type:"POST",action:Crm.getCrmBasePath()+"/specific/AuditLog.do",data:a,success:function(e){var r=e;if(commonUtils.showHideLoadingDiv(),"Success"===r.Status)if($("#activeLogUserDiv").append("<div id='wfCriteriaDiffPopUp'></div>"),"updated"===i){var a=WFAuditLog.addCriteriaDetailsInfo(r,!1);WFAuditLog.showCriteriaDetailsPopUp(a,t)}else WFAuditLog.getRemovedOrAddedCriteriaPopUp(r,t);else renderingUtils.showCustomAlert(e.Error)}})},showCriteriaDetailsPopUp:function(e,i){var t=$(i),r=$("#wfCriteriaDiffPopUp"),a=t.offset(),l=a.top+t.outerHeight(),s=a.left,n=renderingUtils.windowOuterWidth-(s+t.outerWidth()),o=renderingUtils.windowOuterWidth-n;l>600?(r.html(e).css({right:n,"max-width":o,"min-width":620,opacity:"0"}).show(),setTimeout((function(){var i=a.top-r.outerHeight();r.html(e).css({top:i,opacity:"1"}).show()}),200)):r.html(e).css({right:n,top:l,"max-width":o,"min-width":620}).show(),freezeBackground()},addCriteriaDetailsInfo:function(e,i){var t=WFAuditLog.getCriteriaHTML(e.CriteriaDetails);return WFAuditLog.highlightTriggerDetails(e.OtherDetails),Handlebars.templates.wfCriteriaDiffAuditLog({Criterias:t,Data:e,DICases:i})},getRemovedOrAddedCriteriaPopUp:function(e,i){var t=e.CriteriaDetails,r="<div>";"All"===t[0].criteria?r+=I18n.getMsg("workflow.criteria.all.records",[t[0].criteriaChangeModulePlural]):r=t[0].criteria;var a="<div class='jarvisClosebtn svgIcons ico-close-small2' href='javascript:void(0)' onclick='WFAuditLog.closeWFCriteriaDiffPopUp();sE(event)'></div>";a+="<div class='crm-font-bold black pB3 ellipsisText w100p f15'>"+$ESAPI.encoder().encodeForHTML(e.OtherDetails.process_name)+"</div> <div class='wfCriteriaAddedBorder'> <div class='secNotEditCondText mT10'>"+I18n.getMsg("crm.wf.auditLog.condition")+" <span>"+(null!=e.OtherDetails.execution_order?e.OtherDetails.execution_order:1)+"</span></div>"+r+"</div></div>",WFAuditLog.showCriteriaDetailsPopUp(a,i)},getCriteriaHTML:function(e){for(var i={},t=$(e).get(0),r=$(t.old_criteria),a=$(t.criteria),l=r.filter(".maincriteria"),s=a.filter(".maincriteria"),n=r.filter(".relcriteria"),o=a.filter(".relcriteria"),d=l,c=s,u=n,g=o,p=$("<div>"),f=!1,v=e.length,m=0;m<v;m++){var h="",C="",L="",w="",T=!1,D=!1;0===m?(L="All"===t.old_criteria?t.old_criteria:d[0],w="All"===t.criteria?t.criteria:c[0]):(t=$(e).get(m),L=u[m-1],w=g[m-1]);var A=t.old_criteria_chages;null!=L&&("All"===L?(h+="<div class='secNotCondRow' style='font-size:1.4rem;'>"+I18n.getMsg("workflow.criteria.all.records",[t.criteriaChangeModulePlural])+"</div>",f=!0,T=!0):h+=WFAuditLog.addClassToCriteria(A,L.innerHTML));var E=t.criteria_chages;if(null!=w?"All"===w?(C+="<div style='font-size:1.4rem;'>"+I18n.getMsg("workflow.criteria.all.records",[t.criteriaChangeModulePlural])+"</div>",f=!0,D=!0):C+=WFAuditLog.addClassToCriteria(E,w.innerHTML):f=!0,"5"!==A[1]||T||D||(f=!0),f){var F=p.append($.parseHTML(h));$(F).each((function(){$(this).find(".secNotCondRow").addClass("secStrikeout")})),h=$(F).prop("innerHTML")}h=WFAuditLog.removeLiEle(h),C=WFAuditLog.removeLiEle(C);var M=t.old_logicalRepresentation,P=t.logicalRepresentation;"1"==P||"1"==M||T||D||(h+=t.hasOwnProperty("old_logicalRepresentation")?"<div class='secNotEditCondText mT5'>"+I18n.getMsg("crm.wf.auditLog.view.pattern")+"<span> "+M+"</span></div>":"<div class='secNotEditCondText mT5'></div> ",C+=t.hasOwnProperty("logicalRepresentation")?"<div class='secNotEditCondText mT5'>"+I18n.getMsg("crm.wf.auditLog.view.pattern")+"<span class='"+(P==M||f?"":"secEditFocus")+"'> "+$ESAPI.encoder().encodeForHTML(P)+"</span></div>":"<div class='secNotEditCondText mT5'></div> "),0===m?(null!=L&&("All"===L?d[0]=h:d[0].innerHTML=h),null!=w&&("All"===w?c[0]=C:c[0].innerHTML=C)):(null!=L&&("All"===L?u[m-1]=h:u[m-1].innerHTML=h),null!=w&&("All"===w?g[m-1]=C:g[m-1].innerHTML=C)),f=!1}return l.html(WFAuditLog.getArrayHTMLElement(d,!0)),n.html(WFAuditLog.getArrayHTMLElement(u,!0)),s.html(WFAuditLog.getArrayHTMLElement(c,!0)),o.html(WFAuditLog.getArrayHTMLElement(g,!0)),i.criterias1="All"===t.old_criteria?d[0]:WFAuditLog.getArrayHTMLElement(r,!1),i.criterias2="All"===t.criteria?c[0]:WFAuditLog.getArrayHTMLElement(a,!1),""==i.criterias1&&(i.criterias1=d[0]),""==i.criterias2&&(i.criterias2=c[0]),i.old_logicalRepresentation={},i.logicalRepresentation={},i},getArrayHTMLElement:function(e,i){var t="";return $(e).each((function(){t+=i?this.innerHTML:$(this).outerHTML()})),t},removeLiEle:function(e){return(e=e.replace(/<li>/g,"")).replace(/<\/li>/g,"")},addClassToCriteria:function(e,i){var t="";return i=i.replace(/li> <li>/g,"</li><li>"),i=$.parseHTML(i),$(i).each((function(r){var a=$(i[r]),l=e[r+1],s=a.find(".valueh");if(null!=l&&(1==l?a.find(".highlightTxt").addClass("secEditFocus"):2==l?s.addClass("secEditFocus"):3==l?(a.find(".highlightTxt").addClass("secEditFocus"),s.addClass("secEditFocus")):4==l&&(a=$(a.prop("innerHTML")).addClass("secStrikeout"))),s.hasClass("userTypeVl")){l=s.text();s.attr({onmouseenter:"crmui.showTooltip('"+l+"')",onmouseleave:"crmui.hideTooltip()"})}t+=a.prop("outerHTML")})),t},highlightTriggerDetails:function(e){var i=e.new_trigger_type,t=e.old_trigger_type;e.new_trigger_type=i!==t?'<span class="secNotContOpt secEditFocus crm-font-regular">'+i+"</span>":'<span class="secNotContOpt crm-font-regular">'+i+"</span>",e.old_trigger_type='<span class="secNotContOpt crm-font-regular">'+t+"</span>"},closeWFCriteriaDiffPopUp:function(){$("#wfCriteriaDiffPopUp").hide(),removeFreezeLayer()},getWorkflowLockedMessage:function(e,i,t,r){var a="<div class='jarvisClosebtn svgIcons ico-close pA' style='transform:scale(0.7);' href='javascript:void(0)' onclick='WFAuditLog.closeWFCriteriaDiffPopUp();sE(event)'></div>";a+="<div><div><a targe='blank' href='"+Crm.getCrmBasePath()+"/settings/users/"+t+"'>"+$ESAPI.encoder().encodeForHTML(e)+"</a> "+I18n.getMsg("crm.wf.auditLog.lock.info")+"</div><div class='popNote mT15'>"+$ESAPI.encoder().encodeForHTML(i)+"</div></div>",$("#activeLogUserDiv").append("<div id='wfCriteriaDiffPopUp'></div>"),WFAuditLog.showCriteriaDetailsPopUp(a,r)}};!function(){var e=Handlebars.template;(Handlebars.templates=Handlebars.templates||{}).wfCriteriaDiffAuditLog=e({1:function(e,i,t,r,a){return'<div data-zcqa="wfCriteriaPopClose" class="jarvisClosebtn svgIcons ico-close pA" style="transform:scale(0.7);" href="javascript:void(0)" onclick="WFAuditLog.closeWFCriteriaDiffPopUp();sE(event)"></div>'},3:function(e,i,t,r,a){var l;return' <div class="crm-font-bold black pB3 ellipsisText w100p f15" id="criteriaDiffRuleName">'+e.escapeExpression(e.lambda(null!=(l=null!=(l=null!=i?i.Data:i)?l.OtherDetails:l)?l.process_name:l,i))+"</div> "},5:function(e,i,t,r,a){return" secNotFirstPart "},7:function(e,i,t,r,a){return" criteriaFirstPart border0 "},9:function(e,i,t,r,a){return' <div class="secNotEditCondText dIB crm-font-regular"><span class="crm-font-regular w100p pL0">'+e.escapeExpression(t.getI18n.call(null!=i?i:{},"crm.wf.auditLog.view.before.modification.msg",{name:"getI18n",hash:{},data:a}))+",</span></div> "},11:function(e,i,t,r,a){return" secNotSecPart "},13:function(e,i,t,r,a){return" criteriaSecondPart border0"},15:function(e,i,t,r,a){return' <div class="secNotEditCondText dIB crm-font-regular"><span class="crm-font-regular w100p pL0">'+e.escapeExpression(t.getI18n.call(null!=i?i:{},"crm.wf.auditLog.view.after.modification.msg",{name:"getI18n",hash:{},data:a}))+",</span></div> "},compiler:[7,">= 4.0.0"],main:function(e,i,t,r,a){var l,s=null!=i?i:{},n=e.lambda,o=e.escapeExpression;return" "+(null!=(l=t.ifNotEquals.call(s,null!=i?i.DICases:i,"true",{name:"ifNotEquals",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?l:"")+' <div id="wfCriteriaDiffContents" class="wfCriteriaDiffContents w100p pB10"> '+(null!=(l=t.ifNotEquals.call(s,null!=i?i.DICases:i,"true",{name:"ifNotEquals",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a}))?l:"")+" <div class='"+(null!=(l=t.ifNotEquals.call(s,null!=i?i.DICases:i,"true",{name:"ifNotEquals",hash:{},fn:e.program(5,a,0),inverse:e.program(7,a,0),data:a}))?l:"")+"'> "+(null!=(l=t.ifNotEquals.call(s,null!=i?i.DICases:i,"true",{name:"ifNotEquals",hash:{},fn:e.program(9,a,0),inverse:e.noop,data:a}))?l:"")+' <div data-zcqa="wfCriteriaTrigger1" class="crm-font-regular secNotCont mT5">'+o(n(null!=(l=null!=(l=null!=i?i.Data:i)?l.OtherDetails:l)?l.triggerTypePrifix_old:l,i))+" <span>"+(null!=(l=n(null!=(l=null!=(l=null!=i?i.Data:i)?l.OtherDetails:l)?l.old_trigger_type:l,i))?l:"")+'</span></div> <div data-zcqa="wfCriteriaCondition1" class="secNotContconditions "> <div class="secNotEditCondText mT5"> '+o(t.getI18n.call(s,"crm.wf.auditLog.condition",{name:"getI18n",hash:{},data:a}))+" <span>"+o(n(null!=(l=null!=(l=null!=i?i.Data:i)?l.OtherDetails:l)?l.execution_order:l,i))+"</span></div> "+(null!=(l=n(null!=(l=null!=i?i.Criterias:i)?l.criterias1:l,i))?l:"")+" </div> </div> <div class='"+(null!=(l=t.ifNotEquals.call(s,null!=i?i.DICases:i,"true",{name:"ifNotEquals",hash:{},fn:e.program(11,a,0),inverse:e.program(13,a,0),data:a}))?l:"")+"'> "+(null!=(l=t.ifNotEquals.call(s,null!=i?i.DICases:i,"true",{name:"ifNotEquals",hash:{},fn:e.program(15,a,0),inverse:e.noop,data:a}))?l:"")+' <div data-zcqa="wfCriteriaTrigger2" class="crm-font-regular secNotCont mT5">'+o(n(null!=(l=null!=(l=null!=i?i.Data:i)?l.OtherDetails:l)?l.triggerTypePrifix_new:l,i))+" <span>"+(null!=(l=n(null!=(l=null!=(l=null!=i?i.Data:i)?l.OtherDetails:l)?l.new_trigger_type:l,i))?l:"")+'</span></div> <div data-zcqa="wfCriteriaCondition2" class="secNotContconditions "> <div class="secNotEditCondText mT5"> '+o(t.getI18n.call(s,"crm.wf.auditLog.condition",{name:"getI18n",hash:{},data:a}))+" <span>"+o(n(null!=(l=null!=(l=null!=i?i.Data:i)?l.OtherDetails:l)?l.execution_order:l,i))+"</span></div> "+(null!=(l=n(null!=(l=null!=i?i.Criterias:i)?l.criterias2:l,i))?l:"")+" </div> </div> </div> "},useData:!0})}();