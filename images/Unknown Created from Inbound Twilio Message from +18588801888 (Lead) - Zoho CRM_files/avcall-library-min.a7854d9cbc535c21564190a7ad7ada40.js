var ZCConfig;function isJQueryAvailable(){return void 0!==window.jQuery&&window.$==window.jQuery&&void 0!==jQuery.fn&&"function"==typeof jQuery.fn.on}function injectZCJQueryOverrides(){void 0===window.ZCJQuery&&(window.ZCJQuery=window.jQuery),ZCJQuery.fn.initDragContainer=function(e){var t,i,a,n,s,o=this,r="[dragitem]";void 0!==(e=ZCJQuery.extend({},e)).draggable_area&&(r=e.draggable_area),ZCJQuery(r).addClass("drag"),o.on("mousedown",r,(function(c){c.preventDefault(),t=ZCJQuery(this),"[dragitem]"!==r&&(t=ZCJQuery(this).closest("[dragitem]")),"function"==typeof e.ondragstart&&e.ondragstart(event),a=o.offset().top,n=a+o.height(),s=t.offset().top,i=c.pageY-s,o.on("mousemove",l).one("mouseup",d).off("mouseleave").one("mouseleave",d)}));var l=function(e){var o=e.pageY-i;if(o<a)t.offset({top:a}),t.prev().length>0&&t.insertBefore(t.prev());else if(o+t.height()>n)t.offset({top:n-t.height()}),t.next().length>0&&t.insertAfter(t.next());else{t.offset({top:o}),t.css("z-index","1");var r=parseInt(t.css("margin-top"))/2,l=!1;s-o>t.outerHeight()+r?(t.insertBefore(t.prev()),l=!0):o-s>t.outerHeight()+r&&(t.insertAfter(t.next()),l=!0),l&&(t.offset({top:o}),s=t.offset().top,o=e.pageY-i,i=e.pageY-s)}},d=function(i){o.off("mousemove",l).off("mouseup",d),t.animate({top:0},100,(function(){t.css("z-index","0")})),"function"==typeof e.ondragend&&e.ondragend(i)}},ZCJQuery.getImgStaticUrl=function(){return void 0!==MediaUtil&&void 0!==MediaUtil.BRIDGE?MediaUtil.BRIDGE.Constants._IMGSTATICURL:$zcg._IMGSTATICURL},ZCJQuery.fn.hasOnlyChildrenlike=function(e,t){return ZCJQuery(this[0].firstChild).attr(e)===t},function(){var e={noprefix:"animationend",Moz:"animationend",Webkit:"webkitAnimationEnd",O:"oAnimationEnd",ms:"MSAnimationEnd"},t={noprefix:"transitionend",Moz:"transitionend",Webkit:"webkitTransitionEnd",O:"oTransitionEnd",ms:"MSTransitionEnd"};function i(e){var t=["Webkit","Moz","O","ms"];if(void 0!==document.body.style.animationName)return e.noprefix;for(var i=0,a=t.length;i<a;i++)if(void 0!==document.body.style[t[i]+"AnimationName"])return e[t[i]]}function a(e,t,i,a){function n(e,t){"function"==typeof a?a(e,t):t.remove()}if(t){function s(e){n(e,ZCJQuery(this))}void 0!==i.selector?e.on(t,i.selector,s):e.off(t).on(t,s)}else n()}ZCJQuery.fn.handleAnimationEnd=function(t,n){var s=ZCJQuery.extend({},n);this.length&&a(this,i(e),s,t)},ZCJQuery.fn.handleTransitionEnd=function(e,n){var s=ZCJQuery.extend({},n);this.length&&a(this,i(t),s,e)}}(),ZCJQuery.fn.cssAnimation=function(e){Array.isArray(e)&&(e=e.join(" ")),this.addClass(e),this.handleAnimationEnd((function(t,i){i.removeClass(e)}))},ZCJQuery.fn.cssTransition=function(e){Array.isArray(e)&&(e=e.join(" ")),this.addClass(e),this.handleTransitionEnd((function(t,i){i.removeClass(e)}))},ZCJQuery.fn.setAsDraggable=function(e){var t=ZCJQuery(document),i=this,a=(e=ZCJQuery.extend({},{areaToBeVisible:{width:i.width(),height:i.height()}},e),!$WC.Util.isEmpty(e.draggablearea)&&e.draggablearea.length?e.draggablearea:i);if(0!==a.length){a.addClass("ZCdrag");var n={},s=!$WC.Util.isEmpty(e.dragboundary)&&e.dragboundary.length,o=s?e.dragboundary:ZCJQuery(window),r={left:0,top:0},l={},d=0,c=0,u=0,C=0,p=function(e){var t=e.clientX,i=e.clientY;(Math.abs(l.left-t)>5||Math.abs(l.top-i)>5)&&e.stopImmediatePropagation()},h=function(t){t.preventDefault();var a=Math.max(r.left-u+e.areaToBeVisible.width,t.clientX-n.left),s=Math.max(r.top-C+e.areaToBeVisible.height,t.clientY-n.top);a=Math.min(a,d+r.left-e.areaToBeVisible.width),s=Math.min(s,c+r.top-e.areaToBeVisible.height),i.length&&(i[0].style.top=s+"px",i[0].style.left=a+"px"),"function"==typeof e.ondrag&&e.ondrag(t),i.off("click",p).one("click",p)},m=function(i){i.preventDefault(),t.off("mousemove",h),"function"==typeof e.ondragend&&e.ondragend(i)};a.off("mousedown").on("mousedown",(function(a){if((a.stopImmediatePropagation(),"function"==typeof e.ondragstart)&&!e.ondragstart(a))return;if(u=i.width(),C=i.height(),d=o.width(),c=o.height(),s){var p=o[0].getBoundingClientRect();r={left:p.left,top:p.top}}var f=i.offset();n.left=a.clientX-f.left,n.top=a.clientY-f.top,l={left:a.clientX,top:a.clientY},t.on("mousemove",h),t.one("mouseup",m)}))}},ZCJQuery.fn.setAsNonDraggable=function(e){var t=void 0!==e&&!$WC.Util.isEmpty(e.draggablearea)&&e.draggablearea.length?e.draggablearea:this;0!==t.length&&(t.removeClass("ZCdrag"),t.off("mousedown"))},ZCJQuery.fn.setAsResizable=function(e){var t=ZCJQuery(document),i=ZCJQuery(window),a=ZCJQuery.extend({},{resizeBoundaryElem:i,aspectRatio:1,widthRange:{min:245,max:i.width()},heightRange:{min:154,max:i.height()},avoidResizeUsingBorders:!1},e),n=ZCJQuery(this),s=a.resizeBoundaryElem,o=1!==a.aspectRatio,r=a.callBack,l={},d={},c={},u=0,C={},p=(n[0],"top_left_corner");function h(e,t,i){return Math.min(Math.max(e,t),i)}function m(e){var t=e?1:-1;return{width:h(d.width+t*l.x,a.widthRange.min,a.widthRange.max),height:h(d.height+t*l.y,a.heightRange.min,a.heightRange.max),aspectRatioWidth:h(d.width+l.y*(t*a.aspectRatio),a.widthRange.min,a.widthRange.max),aspectRatioHeight:h(d.height+l.x/(t*a.aspectRatio),a.heightRange.min,a.heightRange.max)}}function f(e,t,i,a){if(function(e,t){return e+t<=s.height()}(a,t)&&function(e,t){return e+t<=s.width()}(i,e)){var o="",l="",d="",c="";a===C.top?o=C.top:l=C.bottom,i===C.left?d=C.left:c=C.right,function(e,t,i,a,s,o){n.css({width:e,height:t,top:i,bottom:a,left:s,right:o}),r(e,t)}(e,t,o,l,d,c)}}var g={top_left_corner:function(){var e=m(!1);f(e.aspectRatioWidth,e.height,C.right,C.bottom)},top_border:function(){var e=m(!1);f(o?e.aspectRatioWidth:d.width,e.height,C.right,C.bottom)},top_right_corner:function(){var e=m(!0);f(e.width,e.aspectRatioHeight,C.left,C.bottom)},right_border:function(){var e=m(!0);f(e.width,o?e.aspectRatioHeight:d.height,C.left,C.bottom)},bottom_right_corner:function(){var e=m(!0);f(e.aspectRatioWidth,e.height,C.left,C.top)},bottom_border:function(){var e=m(!0);f(o?e.aspectRatioWidth:d.width,e.height,C.left,C.top)},bottom_left_corner:function(){var e=m(!1);f(e.width,e.aspectRatioHeight,C.right,C.top)},left_border:function(){var e=m(!1);f(e.width,o?e.aspectRatioHeight:d.height,C.right,C.top)}},v=function(e){e.preventDefault(),l={x:e.pageX-c.x,y:e.pageY-c.y},g[p](e)},_=function(e){t.off("mousemove",v)};if(!n.find("[enable_resize]").length){var I=[{className:"zc-av-top-left-corner",keyName:"top_left_corner"},{className:"zc-av-top-right-corner",keyName:"top_right_corner"},{className:"zc-av-bottom-right-corner",keyName:"bottom_right_corner"},{className:"zc-av-bottom-left-corner",keyName:"bottom_left_corner"}],S=[{className:"zc-av-top-border",keyName:"top_border"},{className:"zc-av-right-border",keyName:"right_border"},{className:"zc-av-bottom-border",keyName:"bottom_border"},{className:"zc-av-left-border",keyName:"left_border"}].concat(I);a.avoidResizeUsingBorders&&(S=I);for(var M="",T=0;T<S.length;T++)M+='<div enable_resize class="zc-av-drag-handle '+S[T].className+'" position='+S[T].keyName+"></div>";n=n.append(M)}n.find("[enable_resize]").on("mousedown",(function(e){e.stopImmediatePropagation(),d={width:n.width(),height:n.height()},c={x:e.pageX,y:e.pageY},u=n.position(),C={right:i.width()-u.left-d.width,bottom:i.height()-u.top-d.height,left:u.left,top:u.top},p=e.target.getAttribute("position"),t.on("mousemove",v),t.one("mouseup",_)}))},ZCJQuery.fn.removeResizable=function(){ZCJQuery(this).find("[enable_resize]").remove()},ZCJQuery.fn.isScrolledToView=function(e,t,i){null!=t&&void 0!==t||(t=1),null!=i&&void 0!==i||(i=1);var a=e?ZCJQuery(e):ZCJQuery(window),n={top:a.offset().top,left:a.offset().left};n.right=n.left+a.width(),n.bottom=n.top+a.height();var s=this.outerHeight(),o=this.outerWidth();if(!o||!s)return!1;var r=this.offset();if(r.right=r.left+o,r.bottom=r.top+s,!!(n.right<r.left||n.left>r.right||n.bottom<r.top||n.top>r.bottom))return!1;var l=Math.min(1,(r.bottom-n.top)/s),d=Math.min(1,(n.bottom-r.top)/s);return Math.min(1,(r.right-n.left)/o)*Math.min(1,(n.right-r.left)/o)>=t&&l*d>=i},"function"!=typeof ZCJQuery.escapeSelector&&(ZCJQuery.escapeSelector=function(e){return"string"==typeof e&&e.length>0&&(e=e.replace(/([!"#$%&'()*+,-./:;<=>?@[\]^`{|}~])/g,"\\$1")),e});var e=ZCJQuery.fn.find;ZCJQuery.fn.find=function(t){return"#chatbody"!=t&&"#msgarea"!=t||1!=this.length?e.apply(this,arguments):e.apply(this,arguments).first()}}ZCConfig={mode:{library:"library",product:"product"},getMode:function(){return this.mode.product},isLibraryMode:function(){return this.getMode()===this.mode.library}},_defineReadOnlyProperty=function(e,t,i){Object.defineProperty(e,t,{value:i,writable:!1})},_defineReadOnlyProperties=function(e,t){for(var i in t)Object.defineProperty(e,i,{value:t[i],writable:!1})},isJQueryAvailable()&&(void 0===window.ZCJQuery&&(window.ZCJQuery=window.jQuery),injectZCJQueryOverrides()),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.substr(t,e.length)===e}),String.prototype.replaceBetween||(String.prototype.replaceBetween=function(e,t,i){return this.substring(0,e)+i+this.substring(t)}),Date.prototype.addDays||(Date.prototype.addDays=function(e){this.setDate(this.getDate()+e)}),Object.defineProperty(Array.prototype,"insert",{enumerable:!1,writable:!0,value:function(e,t){this.splice(e,0,t)}}),Object.defineProperty(Array.prototype,"removeElement",{enumerable:!1,writable:!0,value:function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)}}),void 0!==HTMLElement.prototype.scrollIntoView&&void 0===HTMLElement.prototype.scrollIntoViewIfNeeded?HTMLElement.prototype.scrollIntoViewIfNeeded=function(e){this.scrollIntoView({block:e?"start":"nearest"})}:void 0===HTMLElement.prototype.scrollIntoView&&void 0!==HTMLElement.prototype.scrollIntoViewIfNeeded&&(HTMLElement.prototype.scrollIntoView=function(e){var t="object"==typeof e&&"start"===e.block;this.scrollIntoViewIfNeeded(t)}),SessionTimers=function(){var e={},t=void 0,i={SECOND:1e3,MINUTE:6e4,HOUR:36e5},a={separator:":",interval:i.SECOND,stickyHour:!1,type:"+",allowPauseAndResume:!1},n=function(){for(var t in e){e[t].updateInUI()}},s=function(e,t){this.id=e,this.isPaused=!1,this.pausedTime=0,this.hourElem=null,this.minuteElem=null,this.secondElem=null,this.isHourElemHidden=!0,this.config=ZCJQuery.extend({},a,t),this.config.startTime=this.config.startTime||$ZCUtil.getSyncedCurrentTime();var i=ZCJQuery("#"+ZCJQuery.escapeSelector(e));if(i.length){var n=this.isHourTimer()?"hours":this.isMinuteTimer()?"minutes":"seconds";if(!i.find("["+n+"]").length){var s=$WC.template.replace("{{hours}}{{minutes}}{{seconds}}",{hours:'<span hours class="{{hour_display_class}}">{{hours_initial_value}}</span>',minutes:this.isHourTimer()?"":'<span separator class="{{hour_display_class}}">{{separator}}</span><span minutes>{{minutes_initial_value}}</span>',seconds:this.isSecondTimer()?"<span separator>{{separator}}</span><span seconds>{{seconds_initial_value}}</span>":""},"InSecureHTML"),o=this.getCurrentDuration();s=$WC.template.replace(s,{hour_display_class:this.isSecondTimer()?"dN zc-av-dN":"",separator:this.config.separator,hours_initial_value:o.hours,minutes_initial_value:o.minutes,seconds_initial_value:o.seconds}),i.append(s)}this.hourElem=i.find("[hours]"),this.minuteElem=i.find("[minutes]"),this.secondElem=i.find("[seconds]"),this.isHourElemHidden=this.hourElem.hasClass("dN")||this.hourElem.hasClass("zc-av-dN"),this.updateDurationVisibility(o)}};return s.prototype={updateInUI:function(){if(!this.isPaused){var e=this.getCurrentDuration();this.hourElem.text(e.hours),this.minuteElem.text(e.minutes),this.secondElem.text(e.seconds),this.updateDurationVisibility(e)}},getCurrentDuration:function(){var e={hours:"00",minutes:"00",seconds:"00"},t="function"==typeof this.config.getSessionCurrentTime?this.config.getSessionCurrentTime():$ZCUtil.getSyncedCurrentTime(),i="-"===this.config.type?(this.config.startTime-t)/1e3:(t-this.config.startTime)/1e3;return"undefined"==typeof $ZCDate&&(window.$ZCDate=window.$Date),i>0&&(e.hours=$ZCDate.append0(Math.floor(i/3600)),i%=3600,e.minutes=$ZCDate.append0(Math.floor(i/60)),e.seconds=$ZCDate.append0(Math.floor(i%60))),e},isHourTimer:function(){return this.config.interval==SessionTimers.intervals.HOUR},isMinuteTimer:function(){return this.config.interval==SessionTimers.intervals.MINUTE},isSecondTimer:function(){return this.config.interval==SessionTimers.intervals.SECOND},updateDurationVisibility:function(e){if(!this.config.stickyHour&&this.isSecondTimer()){var t=e.hours<=0;this.isHourElemHidden!==t&&(this.isHourElemHidden=t,this.hourElem.add(this.hourElem.next()).toggleClass("dN zc-av-dN",t))}},pause:function(){this.config.allowPauseAndResume&&!this.isPaused&&(this.isPaused=!0,this.pausedTime="function"==typeof this.config.getSessionCurrentTime?this.config.getSessionCurrentTime():$ZCUtil.getSyncedCurrentTime())},resume:function(){if(this.config.allowPauseAndResume&&this.isPaused){this.isPaused=!1;var e="function"==typeof this.config.getSessionCurrentTime?this.config.getSessionCurrentTime():$ZCUtil.getSyncedCurrentTime();this.config.startTime=this.config.startTime+(e-this.pausedTime),this.pausedTime=0}}},{intervals:i,setTimer:function(a,o){if(!e[a]){var r=new s(a,o);if(!r.hourElem&&!r.MinuteElem&&!r.secondElem)return;e[a]=r,void 0===t&&(t=setInterval(n,i.SECOND))}},pauseTimer:function(t){var i=e[t];i&&i.pause()},resumeTimer:function(t){var i=e[t];i&&i.resume()},clearTimer:function(i){e[i]&&(delete e[i],0===Object.keys(e).length&&(clearInterval(t),t=void 0))}}}(),Clickoutside={currentchain:[],data:{},bind:function(e){var t;if(e.closeOnClickSrc=void 0===e.closeOnClickSrc||e.closeOnClickSrc,void 0!==e.event&&(t=e.event,e.event.stopPropagation&&e.event.stopPropagation(),delete e.event),this.currentchain.length)if(this.isDuplicateSource(e.srcid)){if(e.closeOnClickSrc)return this.triggerCallback(e.destid,!0),!1}else this.triggerCallback(e.destid,void 0,t,e.srcid),"function"==typeof e.customShow?e.customShow(e):document.getElementById(e.destid).style.display="block",this.addData(e);else this.addData(e),"function"==typeof e.customShow?e.customShow(e):document.getElementById(e.destid).style.display="block";return!0},handleClick:function(e){"undefined"!=typeof ApplicationsUI&&ApplicationsUI.hasDeletePopupShown||this.triggerCallback(e.target,void 0,e)},handleEscape:function(){var e=this.currentchain.length,t=e-1;return!(!e||!0===this.data[this.currentchain[t]].ignoreesc||"undefined"!=typeof ApplicationsUI&&ApplicationsUI.hasDeletePopupShown)&&this.executeCallback(t,e,!0)},handleClickOnChild:function(e,t){e.stopPropagation(),void 0===t&&(t=e.target),this.triggerCallback(t,!0,e)},clearCurrentElement:function(e){var t=this.currentchain.indexOf(e);-1!==t&&(delete this.data[e],this.currentchain.splice(t,1))},clear:function(e){var t=this.currentchain.indexOf(e);-1!==t&&this.clearEntries(t,this.currentchain.length)},addData:function(e){this.currentchain.push(e.destid),this.data[e.destid]=e},isDuplicateSource:function(e){if(e)for(var t in this.data)if(this.data[t].srcid===e)return!0},triggerCallback:function(e,t,i,a){var n=this.currentchain.length,s=0,o=this.findLCA(e);void 0!==o&&(s=this.currentchain.indexOf(o),s=!0===t?s:s+1),s<n&&this.executeCallback(s,n,void 0,i,a)},findLCA:function(e){for("string"==typeof e&&(e=document.getElementById(e));e;){if(-1!==this.currentchain.indexOf(e.id))return e.id;e=e.parentNode}},executeCallback:function(e,t,i,a,n){for(var s=!1,o={},r=t-1;r>=e;r--){var l=document.getElementById(this.currentchain[r]);if(l){var d=Clickoutside.data[this.currentchain[r]],c=!1,u=!1;if("function"==typeof d.doNotClose&&(c=d.doNotClose(d,i,a,o,n)),!c){u=!0,s=!0,"function"==typeof d.customHide?d.customHide(d,a):l.style.display="none";var C=this.data[this.currentchain[r]];C&&"function"==typeof C.callback&&C.callback(C.srcid,C.destid),this.clear(this.currentchain[r])}d.isClosed=u,o[d.destid]=d}else this.clear(this.currentchain[r])}return s},clearEntries:function(e,t){for(var i=t-1;i>=e;i--)delete this.data[this.currentchain[i]];this.currentchain.splice(e)},clearAllChilds:function(e){for(var t=this.currentchain.length,i=0;i<t;i++)this.data[this.currentchain[i]].parent_id===e&&(delete this.data[this.currentchain[i]],this.currentchain.splice(i,1))}};var ZCMediaConstants={},MediaTemplates={},MediaUtil={},MediaAPI={},MediaManager={},MediaHandler={},MLBackgroundProcessor={},ZCMediaPreferences={},AdhocCallBridge={};if(ZCMediaConstants={ASPECT_RATIO:4/3,MAX_TITLE_LENGTH:30,FREQUENCY_BIN_RANGE:255,scopeTypes:{CHAT:"chat",ORG:"organization",TEAM:"team",PERSONAL:"personal",EVENT:"events"},defaultImageNames:{PT_HANDSHAKE:"pt-handshake.png",PT_ASSEMBLY:"pt-assembly.png",PT_ICON:"pt-icon.svg",HUDDLE_EXIT:"huddle-exit.svg"},triggerSource:{QUICK_ACTION:"quick action",CHAT_HEADER:"chat header",CALL_INCOMING_UI:"call incoming ui",INFO_MESSAGE_BUTTON:"info message button",LIVE_FEED:"live feed",REMOTE_WORK:"remote tools",CALL_HISTORY:"call history",PERMALINK:"permalink",CONTACT_HOVER:"contact_hover",BUTTON_SYSTEM_API:"button_system_api",CALL_END_UI:"call_end_ui"},sessionTypes:{CALLS:"calls",PRIMETIME:"primetime",CONFERENCE:"conference"},requestTypes:{DEVICES:"devices",START:"start",GET:"get",JOIN:"join"},endCases:{sessionEnd:0,fullRoom:1,leave:2,removedFromChat:3,sessionExpired:4,unsupportedBrowser:5,unsupportedBrowserVersion:6,kickedOut:7,assignHostAndLeave:8},mediaModules:{CONFERENCE:"conference",PRIMETIME:"primeTime",MEDIA_RECORDER:"media_recorder"},mediaDevices:{CAMERA:"camera",MICROPHONE:"microphone"},requests:{applySettingsPreviewVideoBackgroundEffect:0,setSettingsVideoFilterEffect:1,setSettingsVideoBackgroundEffect:2},devicePermissionStates:{PROMPT:"prompt",GRANTED:"granted",DENIED:"denied"},audioConstraints:{echoCancellation:!0,autoGainControl:!0,noiseSuppression:!0},minimizedWindowRange:{width:{min:250,max:800},height:{min:188,max:600},toggleWidth:322,visibleArea:{width:70,height:70},aspectRatio:1.6},miniVideoElemVisibleArea:{width:10,height:10},audioFormats:["mp3","mpeg","wav","aac","amr","flac","gsm","tta","wv","x-wav","x-m4a","mp4"],videoFormats:["webm","mkv","flv","ogg","avi","mov","qt","wmv","asf","mp4","3gp","quicktime"],defaultLogFileName:"media_logs",healthMeterStateText:{4:"excellent",3:"good",2:"low",1:"poor",0:"deadzone"},callRecordingConfigType:{general:0,advanced:1},callRecordingAdvancedConfigType:{org_channels:1,team_channels:2,private_channels:3,external_channels:4,adhoc_chats:5},callRecordingConfig:{user_choice:0,enabled:1,disabled:-1},callRecordingTypes:{AUDIO_CONFERENCE:"audio_conference",VIDEO_CONFERENCE:"video_conference",ASSEMBLY:"assembly"}},void 0===ZCConfig)var MediaConstants=ZCMediaConstants;MediaTemplates={userImageContainer:'<div class="usr-img-cnt zc-usr-img-cnt vhcenter zc-vhcenter bdrR100 zc-bdrR100 {{user_image_display_class}}" userimagecnt><div audiowaves class="touranim"></div><img class="bdrR100 zc-bdrR100 wh100 zc-wh100" {{user_image_onload}} user_image src="{{user_img}}"/></div>',bufferLoader:'<div class="bffr-ldr zc-bffr-ldr vhcenter zc-vhcenter {{class_name}}" bufferloadercnt></div>',permissionOverlay:'<div class="mcontent"><div class="zc-av-flexC">{{permission_overlay_icon}}</div><div class="zc-av-hdrline zc-av-font22 zc-av-mT20">{{header}}</div><div class="zc-av-font16 zc-av-mT20 zc-av-line26">{{permission}}</div><div class="zcl-btn zcl-btn--primary mT20 AV-call-btn AV-call-btn--primary zc-av-mT20" mediamodulebuttons="" purpose="closeMediaPermissionOverlay">{{ok}}</div><div class="zc-av-permsn-arrow {{class_name}}"></div></div>',permissionOverlayIcon:'<div class="zc-av-permsn-icon {{class_name}}"><span class="zcf-closeB zc-av-permsn-close"></span></div>',v2dropDownHtml:'<div id="{{device_kind}}dropdowncnt" class="flexC bcast-form" selecteddeviceid="{{selected_device_id}}" dropdowncnt devicekind="{{device_kind}}"><div class="bcast-form-label fshrink ellips">{{header}}</div><div class="bcast-form-control flexG"><div class="zcl-dropdown-wrp"><div class="zcl-dropdown-input" {{open_callback}}><span class="zcl-dropdown-label ellips" dropdowninput>{{label}}</span><span class="zcf-downArrow fon12 fshrink zcl-dropdown-icon"></span></div><div id="{{device_kind}}dropdown" class="zcl-menu-wrap no-pointer device-dropdown" dropdown align="top" style="display: none;">{{drop_down_list}}</div></div></div></div>',v2DropDownListItemHtml:'<div class="zcl-menu-item" deviceid="{{device_id}}" devicelabel="{{label}}" {{select_callback}}><div class="flexG ellips">{{label}}</div></div>',headerComponentHtml:'<div class="media-hdr flexC {{custom_class}}" component_header {{custom_attribute}}>{{back_opt}}<div class="media-hdr-cont flexC ellips" mediaheader><span class="{{component_icon_class}} font16 mR8" title_holder></span><div class="media-hdr-label ellips" title_header title="{{header}}">{{title}}</div><div class="media-timer h100"><span id="{{timer_id}}" class="media-onair flexC"></span></div>{{network_health_indicator}}</div>{{participants_count_cnt}}{{viewers_count_cnt}}{{recording_html}}</div>',participantsCountCntHtml:'<div  participantscount class="hudl-hdr-openrhs media-user-count pLR10 flexC tooltip-left" tooltip-title="{{title}}"><em class="zcf-users mR4 font15 mT2"></em><span class="mL5 font14" participants_count>{{participants_count}}</span></div>',viewersCountCntHtml:'<div class="media-viewers-count pLR10 flexC"><em class="zcf-visible mR4 font15 mT2"></em><span class="mL5 font14" viewers_count>{{viewers_count}}</span></div>',muteBanner:'<div class="zc-av-mute-banner zc-av-flexM zc-av-ellips" mutedInfoCnt><em class="zcf-mic-mute zc-av-mR10 zc-av-fshrink"></em><span class="zc-av-ellips">{{content}}</span><span class="zc-av-mute-banner-infotext zc-av-ellips">{{shortcut}}</span></div>',networkHealthIndicatorHtml:'<span class="AV-call-health-meter AV-health-meter-excellent {{custom_class}}" network_health_indicator {{custom_attribute}} title={{health_tooltip}}><span class="AV-call-health-meter-item health-meter-status" health="4"></span><span class="AV-call-health-meter-item" health="3"></span><span class="AV-call-health-meter-item" health="2"></span><span class="AV-call-health-meter-item" health="1"></span></span>',topBandHtml:'<div id="{{id}}" class="zc-av-topband zc-av-flexM zc-av-ellips {{custom_class}}" {{custom_attribute}}><span>{{icons}}</span><span topbandtitle class="zc-av-tb-content zc-av-ellips zc-av-mR8">{{content}}</span>{{short_content}}{{short_cut}}{{action_buttons}}{{close_opt}}</div>',topBandIcon:'<em class="zc-av-tb-icon {{class_name}}"></em>',topBandShortContent:'<span class="zc-av-tb-short-content zc-av-ellips zc-av-mR8">{{content}}</span>',topBandShortCut:'<span class="zc-av-tb-short-cut zc-av-ellips zc-av-mR8">{{content}}</span>',topBandAction:'<span class="zc-av-tb-link zc-av-mR8" {{custom_attribute}} purpose="{{purpose}}">{{content}}</span>',topBandCloseOpt:'<span class="zc-av-tb-close-opt zc-av-flexM tooltip-left" {{custom_attribute}} tooltip-title="{{title}}" purpose="{{purpose}}"><em class="zcf-closeB"></em></span>',v2HeaderComponentHtml:'<div id="{{id}}" class="zc-av-header zc-av-flexC fshrink {{custom_class}}" {{custom_attribute}}><div class="zc-av-header-title-cnt zc-av-flexC flx1">{{back_opt}}<div class="zc-av-header-title zc-av-flexC zc-av-ellips" title_cnt><span class="{{title_icon}} clrW-lite zc-av-mR8"></span><div class="posrel zc-av-mR10"><div id="{{title_id}}" class="{{title_class}} zc-av-font16 zc-av-fontB zc-av-ellips" title_header {{title_edit_params}}>{{title_content}}</div>{{title_edit_input}}</div>{{session_timer}}{{viewers_count}}{{recording_timer}}</div></div>{{screen_share_indicator}}{{header_options}}</div>',checkboxHtml:'<label class="flexIC curP w100" checkboxContainer><div class="zcl-checkbox"><input id="{{id}}" type="checkbox" {{input_attr}} purpose="{{purpose}}" {{checked}}><span class="zcf-tick flexM"></span></div>{{loader}}<div class="font14 line20">{{label}}</div></label>',groupCallPersonalSettingsHtml:'<div id="groupcall_personal_config_cnt" class="mB30"><div class="{{header_class}}" zc_running_title>{{settings_title}}</div><div class="zcmodal-right-row"><div class="clr-S mT8">{{settings_desc}}</div><div>{{options}}</div></div></div>',groupCallRecordingSettingsHtml:'<div id="groupcall_recording_config_cnt" class="mB30"><div class="{{header_class}}" zc_running_title>{{settings_main_header}}</div><div class="zcmodal-right-row mT20"><div class="flexC font14"><span class="pR30">{{settings_sub_header}}</span><div mediamoduleradiobuttons purpose="toggleRecordingConfig">{{options}}</div></div><div class="zcl-hint-box mT20"><b>{{note_header}}:</b> {{note_content}}</div></div></div>',videoEffectsSettingsHtml:'<div id="video_effects_config_cnt" class="settings-video-effects"><div class="zcmodal-right-title-lg" zc_running_title>{{settings_main_header}}</div>{{description}}<div class="flex mB30">{{effects_palet}}<div id="video_effects_config_preview" class="video-effects-preview-wrap {{bg_class}}"><span class="video-effects-preview-label clr-lp1 fontI font14">{{preview_header}}</span><div id="video_effect_preview_dom" class="video-effects-preview-video-cnt wh100 flexM"><video class="video-effects-preview-video wh100 dN"></video><img class="video-effects-preview-img wh100 dN" src="{{img_src}}"/><div class="zcl-rloader posabs sm hide" loader></div><div class="video-effects-preview-info flexM fdirC" request_video_box><div class="mT6 textC font12 line18">{{request_video}}</div><div class="clr-theme curP fontB mT4" mediamodulebuttons purpose="enableVideoForEffectsPreview">{{enable_video}}</div></div><div class="video-effects-preview-info flexM fdirC dN" blocked_video_box><span class="zcf-video posrel"><span class="zcf-closeB flexM video-effects-preview-info-blocked"></span></span><div class="mT6 textC font12 line18">{{blocked}}</div></div></div></div></div></div>',v2HeaderChatOptionHtml:'<span class="{{display_class}} zc-av-header-action flexM mL10" {{custom_attribute}} purpose="{{purpose}}" title="{{title}}"><em class="{{icon_class}} font15"></em><span class="msgnotify" {{unread_count_attribute}}></span></span>',linearAudioLevel:'<span class="audlvl-wrap low">\n\t\t\t<div class="audlvl-parent">'+'<div class="audlvl-bar"></div>'.repeat(10)+'</div>\n\t\t   \t<div audiolevel class="audiolevel-total"></div>\n\t\t</span>',videoEffectsLoader:'<div class="flexM alignM zcl-rloader-mask dN" loader><div class="zcl-rloader xs borderW"></div></div>',videoEffectsPalet:'<div id="{{id}}" class="{{custom_class}} zc-av-video-effects-cnt">{{seasonal_backgrounds}}<div class="zc-av-video-effects-title">{{bg_title}}</div><div class="zc-av-video-effects-list" background_list>{{bg_list}}</div><div class="zc-av-video-effects-title">{{filters_title}}</div><div class="zc-av-video-effects-list" filters_list>{{filters_list}}</div></div>',videoEffectsDefaultListItem:'<div class="zc-av-video-effects-list-item zc-av-video-effects-list-item-default {{active_class}} {{type_class}}" list_item {{custom_attribute}} purpose="{{purpose}}" type="{{type}}" value="{{type}}"><span class="flexM {{icon_class}}"></span>{{loader}}</div>',videoEffectsBgListItem:'<div class="zc-av-video-effects-list-item {{active_class}} {{type_class}}" list_item {{custom_attribute}} purpose="{{purpose}}" type="{{type}}" value="{{value}}"><img class="zc-av-video-effects-list-item-img" src="{{src}}"/>{{loader}}</div>',videoEffectsFilterListItem:'<div class="zc-av-video-effects-list-item {{active_class}} {{type_class}}" list_item {{custom_attribute}} purpose="{{purpose}}" type="{{type}}" value="{{value}}"><img class="zc-av-video-effects-list-item-img" src="{{src}}"/><div class="zc-av-video-effects-list-item-mask"></div>{{loader}}</div>',getSeasonalVideoBgEffectsPalet:function(e){var t=$WC.template.replace(this.videoEffectsBgListItem,{custom_attribute:e.background.customAttribute,purpose:e.background.purpose,type_class:"zc-av-video-effects-bg-image"});t=$WC.template.replace(t,{loader:this.videoEffectsLoader},"InSecureHTML");var i=MLBackgroundProcessor.backgroundTypes.NONE;void 0!==e.background.selectedType&&(i=e.background.selectedType);var a="",n=setActiveClass=!1,s=MLBackgroundProcessor.backgroundTypes.seasonalImages;for(var o of s)n||(setActiveClass=i===o),a+=$WC.template.replace(t,{type:MLBackgroundProcessor.backgroundTypes.IMAGE,value:o,src:MLBackgroundProcessor.backgroundTypes.getThumbNailUrl(o),original_src:MLBackgroundProcessor.backgroundTypes.getSrcUrl(o),active_class:!n&&setActiveClass?"zc-av-video-effects-list-item-active":""},"InSecureHTML"),n=setActiveClass;return a},getVideoBgEffectsPalet:function(e){var t=$WC.template.replace(this.videoEffectsDefaultListItem,{custom_attribute:e.background.customAttribute,purpose:e.background.purpose});t=$WC.template.replace(t,{loader:this.videoEffectsLoader},"InSecureHTML");var i=$WC.template.replace(this.videoEffectsBgListItem,{custom_attribute:e.background.customAttribute,purpose:e.background.purpose,seasonal_play_icon:"",original_img:"",type_class:"zc-av-video-effects-bg-image"});i=$WC.template.replace(i,{loader:this.videoEffectsLoader},"InSecureHTML");var a=MLBackgroundProcessor.backgroundTypes.NONE;void 0!==e.background.selectedType&&(a=e.background.selectedType);var n=MLBackgroundProcessor.backgroundTypes.hasNoBackground(a),s=n,o=$WC.template.replace(t,{type:MLBackgroundProcessor.backgroundTypes.NONE,type_class:"zc-av-video-effects-bg-none",icon_class:"zcf-blocked",active_class:n?"zc-av-video-effects-list-item-active":""});s||(n=MLBackgroundProcessor.backgroundTypes.isBlur(a)),o+=$WC.template.replace(t,{type:MLBackgroundProcessor.backgroundTypes.BLUR,type_class:"zc-av-video-effects-bg-blur",icon_class:"zcf-video-blur",active_class:!s&&n?"zc-av-video-effects-list-item-active":""}),s=n;var r=MLBackgroundProcessor.backgroundTypes.images;for(var l of r)s||(n=a===l),o+=$WC.template.replace(i,{type:MLBackgroundProcessor.backgroundTypes.IMAGE,value:l,src:MLBackgroundProcessor.backgroundTypes.getThumbNailUrl(l),active_class:!s&&n?"zc-av-video-effects-list-item-active":""},"InSecureHTML"),s=n;return o},getVideoFilterEffectsPalet:function(e){var t=MLBackgroundProcessor.backgroundTypes.NONE;"undefined"!==e.background.selectedType&&(t=e.background.selectedType),(MLBackgroundProcessor.backgroundTypes.hasNoBackground(t)||MLBackgroundProcessor.backgroundTypes.isBlur(t))&&(t=MLBackgroundProcessor.backgroundTypes.images[0]);var i=$WC.template.replace(this.videoEffectsDefaultListItem,{custom_attribute:e.filter.customAttribute,purpose:e.filter.purpose});i=$WC.template.replace(i,{loader:this.videoEffectsLoader},"InSecureHTML");var a=$WC.template.replace(this.videoEffectsFilterListItem,{custom_attribute:e.filter.customAttribute,purpose:e.filter.purpose,src:MLBackgroundProcessor.backgroundTypes.getThumbNailUrl(t)});a=$WC.template.replace(a,{loader:this.videoEffectsLoader},"InSecureHTML");var n=MLBackgroundProcessor.filterTypes.NONE;void 0!==e.filter.selectedType&&(n=e.filter.selectedType);var s=MLBackgroundProcessor.filterTypes.hasNoFilter(n),o=s,r=$WC.template.replace(i,{type:MLBackgroundProcessor.filterTypes.NONE,type_class:"zc-av-video-effects-filter-none",icon_class:"zcf-blocked",active_class:s?"zc-av-video-effects-list-item-active":""}),l=MLBackgroundProcessor.filterTypes.variants;for(var d of l)o||(s=n===d),r+=$WC.template.replace(a,{type:MLBackgroundProcessor.filterTypes.VARIANT,type_class:"zc-av-filter-"+d,value:d,active_class:!o&&s?"zc-av-video-effects-list-item-active":""},"InSecureHTML"),o=s;return r},getVideoEffectsPalet:function(e){var t="";MLBackgroundProcessor.isSeasonalVideoEffectsEnabled()&&(t=$WC.template.replace('<div class="zc-av-video-effects-title">{{seasonal_bg_title}}<span class="zc-av-video-effects-seasonal-ind zcf-newfeature mL5"></span></div>\n\t\t\t\t\t\t\t\t\t<div class="zc-av-video-effects-list" background_list>{{seasonal_bg_list}}</div>',{seasonal_bg_list:this.getSeasonalVideoBgEffectsPalet(e)},"InSecureHTML"),t=$WC.template.replace(t,{$seasonal_bg_title:"media.seasonal.effects.background.title"}));var i=$WC.template.replace(this.videoEffectsPalet,{bg_list:this.getVideoBgEffectsPalet(e),filters_list:this.getVideoFilterEffectsPalet(e),seasonal_backgrounds:t},"InSecureHTML");return $WC.template.replace(i,{id:e.id,custom_class:e.customClass||"",$filters_title:"media.effects.filters.title",$bg_title:"media.effects.background.title"})},getCallSettingsHtml:function(e){var t="";return Conference.isPersonalConfigEnabled()&&(t=this.getGroupCallPersonalSettingsHtml(e)),t+=this.getGroupCallRecordingSettingsHtml(e),Conference.isVideoEffectsEnabled()&&Conference.isVideoEffectsSettingsEnabled()&&e&&(t+=this.getVideoEffectsSettingHtml(e)),t},getGroupCallPersonalSettingsHtml:function(e){var t='<div class="mT20 line1">'+MediaTemplates.getCheckboxHtml("conf_chat_notify_toggle","cc.ps.chat.notification",Conference.isChatNotificationEnabledByUser(),"mediamodulecheckbox","toggleChatNotificationConfig",!0)+"</div>";t+='<div class="mT20 line1">'+MediaTemplates.getCheckboxHtml("conf_join_video_toggle","cc.ps.join.video.status",Conference.isVideoDisabledInJoinByUser(),"mediamodulecheckbox","toggleJoinVideoStatusConfig",!0)+"</div>",t+='<div class="mT20 line1">'+MediaTemplates.getCheckboxHtml("conf_sticky_info_toggle","cc.ps.sticky.info",Conference.isStickyInfoAllowedByUser(),"mediamodulecheckbox","toggleStickyInfoConfig",!0)+"</div>";var i=$WC.template.replace(this.groupCallPersonalSettingsHtml,{options:t},"InSecureHTML");return $WC.template.replace(i,{$settings_title:"cc.personal.settings",$settings_desc:"cc.personal.settings.desc",header_class:e?"zcmodal-right-title-lg":"zcl-win-subcategory conf-config pT10 pB10"})},getGroupCallRecordingSettingsHtml:function(e){var t=SecurityManager.getModuleConfig("group_call_recording","allowed_group_call_recording"),i=parseInt(Conference.getRecordingUserConfig()),a="media.recording.settings.note.user_choice";$WC.Util.isEmpty(t)||("general"===t.selected_configuration?a="media.recording.settings.note."+t.general_configuration:"advanced"===t.selected_configuration&&(a="media.recording.settings.note.advanced"));var n=RADIO_BUTTON.getHTML({name:"conference_recording",align:"HR",options:[{id:"enabled",value:ZCMediaConstants.callRecordingConfig.enabled,checked:i===ZCMediaConstants.callRecordingConfig.enabled,label:"media.recording.enabled"},{id:"disabled",value:ZCMediaConstants.callRecordingConfig.disabled,checked:i===ZCMediaConstants.callRecordingConfig.disabled,label:"media.recording.disabled"},{id:"user_choice",value:ZCMediaConstants.callRecordingConfig.user_choice,checked:i===ZCMediaConstants.callRecordingConfig.user_choice,label:"media.recording.user_choice"}]}),s=$WC.template.replace(this.groupCallRecordingSettingsHtml,{options:n},"InSecureHTML");return $WC.template.replace(s,{$note_header:"common.note",$settings_sub_header:"conference.recording.title",$settings_main_header:"media.recordings",$note_content:a,header_class:e?"zcmodal-right-title-lg":"zcl-win-subcategory conf-config pT10 pB10"})},getVideoEffectsSettingHtml:function(e){var t=ZCMediaPreferences.getPreferredVideoBackground(),i=MediaTemplates.getVideoEffectsPalet({id:"settings_video_effects_panel",background:{selectedType:t,customAttribute:"mediamodulebuttons",purpose:"setVideoBackground"},filter:{selectedType:ZCMediaPreferences.getPreferredVideoFilter(),customAttribute:"mediamodulebuttons",purpose:"setVideoFilter"}}),a="video-effects-has-bg-image",n=t;void 0===n&&(n=MLBackgroundProcessor.backgroundTypes.NONE),(MLBackgroundProcessor.backgroundTypes.hasNoBackground(n)||MLBackgroundProcessor.backgroundTypes.isBlur(n))&&(n=MLBackgroundProcessor.backgroundTypes.images[0],a="video-effects-has-default-bg-image");var s="";e&&(s=$WC.template.replace('<div class="zcmodal-right-row"><div class="clr-S mT8">{{desc}}</div></div>',{$desc:void 0!==MediaCall&&MediaCall.isVideoEffectsEnabled()?"media.effects.settings.hint":"media.meetings.effects.settings.hint"}));var o=$WC.template.replace(this.videoEffectsSettingsHtml,{effects_palet:i,description:s},"InSecureHTML");return $WC.template.replace(o,{$settings_main_header:"cc.video.effects",$preview_header:"common.preview",$blocked:"media.camera.denied.info",$enable_video:"common.allow",$request_video:"media.video.enable.hint",bg_class:a,img_src:MLBackgroundProcessor.backgroundTypes.getSrcUrl(n)})},getCheckboxHtml:function(e,t,i,a,n,s){void 0===n&&(a="",n="");var o=$WC.template.replace(this.checkboxHtml,{id:e,checked:i?"checked":"",$label:t,input_attr:a,purpose:n});return $WC.template.replace(o,{loader:s?'<span class="zcl-rloader configuration-loader mR7 dN"></span>':""},"InSecureHTML")},getV2HeaderComponentHtml:function(e){var t="",i="",a="",n="",s="",o="",r="",l="";e.backButtonParams&&(t=$WC.template.replace('<span class="{{icon_class}} zc-av-back-btn font12 cur zc-av-mR15 posrel tooltip-left0" {{custom_attribute}} purpose="{{purpose}}" tooltip-title="{{title}}"></span>',{icon_class:e.backButtonParams.iconClass,$title:e.backButtonParams.titleResourceParams,custom_attribute:e.backButtonParams.customAttribute,purpose:e.backButtonParams.purpose})),e.titleParams.allowEdit&&(i=$WC.template.replace('<input id="{{id}}" type="text" class="zc-av-title-input dN" title_input value="{{value}}" {{attribute}} keyup-purpose={{purpose}}><span id="{{id}}count" class="limit-txt" category="charcount" limit="{{input_limit}}"></span>',{id:e.titleParams.inputId,attribute:e.titleParams.inputAttribute,purpose:e.titleParams.inputPurpose,value:e.titleParams.content,input_limit:e.titleParams.inputLimit}),a=e.titleParams.titleAttribute+" purpose="+e.titleParams.titlePurpose),e.timerParams&&(n=$WC.template.replace('<div class="media-timer mR5"><span id="{{id}}" class="media-onair zc-av-flexC"></span></div>',{id:e.timerParams.id})),e.viewerCountParams&&(s=$WC.template.replace('<div class="zc-av-header-box zc-av-viewers-count zc-av-flexC mR5 tooltip-left"><span class="zcf-visible mT1"></span><span class="mL3" viewers_count>{{viewers_count}}</span></div>',{viewers_count:e.viewerCountParams.count}));var d="";if(e.networkHealthParams&&(d=this.getNetworkHealthIndicatorHtml(e.networkHealthParams)),e.recorderParams&&(o=$WC.template.replace('<div id="recording_indicator" class="zc-av-header-box zc-av-flexC mR5" recording_indicator style="{{display_style}}"><span class="AV-call-record-icon AV-call-record-icon-circle flexM animation"></span><span class="mL3 fontB">REC</span></div>',{display_style:void 0!==e.recorderParams.recordingIndex?"":"display:none"})),e.screenShareIndicatorParams){var c=e.screenShareIndicatorParams;r=$WC.template.replace('<div class="{{display_class}} fshrink flexC font13" screen_share_indicator><em class="zcf-sharescrn mR6"></em><span>{{content}}</span><span class="zc-av-stop-cnt mL10 posrel curP" tooltip-title="{{title}}"><span class="zc-av-stop-blink flexM" {{custom_attribute}} purpose="{{purpose}}"><span class="zc-av-stop-icon"></span></span></span></div>',{$content:"media.screen.sharing.you",$title:"media.sharing.stop",display_class:c.displayClass,custom_attribute:c.customAttribute,purpose:c.purpose})}if(e.options){var u="",C="",p="",h="";if(e.options.participantsParams){var m=e.options.participantsParams;u=$WC.template.replace('<span id="rhsparticipantsoption" class="zc-av-header-action flexM zc-av-flexC mL10" participantscount {{custom_attribute}} purpose="{{purpose}}" title="{{title}}"><em class="{{icon_class}} font15"></em><span class="font13 mL3" participants_count>{{content}}</span></span>',{$title:"common.participants",custom_attribute:m.customAttribute,purpose:m.purpose,icon_class:m.iconClass,content:m.content})}if(e.options.chatParams){var f=e.options.chatParams;C=$WC.template.replace(MediaTemplates.v2HeaderChatOptionHtml,{display_class:f.displayClass,$title:"common.chat",custom_attribute:f.customAttribute,purpose:f.purpose,icon_class:f.iconClass,unread_count_attribute:f.unreadCountAttribute})}if(e.options.townHallParams){var g=e.options.townHallParams;p=$WC.template.replace('<span  class="zc-av-header-action flexM zc-av-flexC mL10" {{custom_attribute}} purpose="{{purpose}}" title="{{title}}"><em class="{{icon_class}} font15"></em></span>',{$title:"conference.associatedresource.townhall.title",custom_attribute:g.customAttribute,purpose:g.purpose,icon_class:g.iconClass})}if(e.options.notesParams){var v=e.options.notesParams;h=$WC.template.replace('<span id="rhsnotesoption" class="zc-av-header-action flexM zc-av-flexC mL10" {{custom_attribute}} purpose="{{purpose}}" title="{{title}}"><em class="{{icon_class}} font15"></em></span>',{$title:"common.notes",custom_attribute:v.customAttribute,purpose:v.purpose,icon_class:v.iconClass})}l=$WC.template.replace('<div id="v2_header_opts" class="zc-av-flexC zc-av-flexG justifyE flx1">{{custom_opt}}{{chat_opt}}{{participants_opt}}{{townhall_opt}}{{notes_opt}}</div>',{custom_opt:e.options.customOptions?e.options.customOptions[0].html:"",participants_opt:u,chat_opt:C,townhall_opt:p,notes_opt:h},"InSecureHTML")}var _=$WC.template.replace(this.v2HeaderComponentHtml,{back_opt:t,title_edit_input:i,title_edit_params:a,session_timer:n,viewers_count:s,network_health_indicator:d,recording_timer:o,recording_indication:"",screen_share_indicator:r,header_options:l},"InSecureHTML");return $WC.template.replace(_,{id:e.id,custom_class:e.customClass||"",custom_attribute:e.customAttribute||"",title_id:e.titleParams.id,title_icon:e.titleParams.iconClass,title_content:e.titleParams.content,title_class:e.titleParams.allowEdit?"zc-av-header-title-editable":""})},alertPopupHeaderImg:'<div class="zc-av-flexM"><div class="AV-user-img-withborder"><div class="AV-user-img-wb-container"><img class="AV-user-img" src="{{curr_user_img}}"><div class="AV-user-img-ovrly posl"><span class="icon-item zcf-call zc-av-clr-R zc-call-end"></span></div></div></div><div class="AV-user-img-separator zc-av-fshrink clr-lp1">-</div><div class="AV-user-img-withborder zc-av-flex"><div class="AV-user-img-wb-container"><img class="AV-user-img" src="{{new_user_img}}"><div class="AV-user-img-ovrly posl"><span class="clr-green zc-av-fontB">{{new_user_text}}</span></div></div></div></div>',regordingIndicator:'<div class="media-user-count pLR10 flexC {{custom_class}}" recording_indicator data-title="{{title}}" style="display:none"><span class="AV-call-record-text zc-av-flexC"><span class="AV-call-record-icon animation mT2"></span><span class="mL3">REC</span></span></div>',getRecordingIndicator:function(e){return $WC.template.replace(this.regordingIndicator,{custom_class:e,$title:"mediarecorder.recording"})},getTopBandHtml:function(e){var t="",i="",a="",n="",s="";if(e.icons)for(var o of e.icons)t+=$WC.template.replace(this.topBandIcon,{class_name:o.className});if(e.shortContentResourceParams&&(i=$WC.template.replace(this.topBandShortContent,{$content:e.shortContentResourceParams})),e.shortCutResourceParams&&(a=$WC.template.replace(this.topBandShortCut,{$content:e.shortCutResourceParams})),e.actionButtons)for(var r of e.actionButtons)n+=$WC.template.replace(this.topBandAction,{$content:r.contentResourceParams,custom_attribute:r.customAttribute,purpose:r.purpose});e.closeOption&&(s=$WC.template.replace(this.topBandCloseOpt,{custom_attribute:e.closeOption.customAttribute,purpose:e.closeOption.purpose,$title:e.closeOption.titleResourceParams}));var l=$WC.template.replace(this.topBandHtml,{id:e.id||"",custom_class:e.customClass||"",custom_attribute:e.customAttribute||"",$content:e.contentResourceParams||""});return l=$WC.template.replace(l,{icons:t,short_content:i,short_cut:a,action_buttons:n,close_opt:s},"InSecureHTML")},getHeaderComponentHtml:function(e){var t=e.ignoreBackOption?"":'<span class="{{back_btn_class}} posrel media-back-btn tooltip-right" {{module}} purpose="{{back_btn_purpose}}" tooltip-title="{{back_btn_title}}"></span>',i="";if(e.showParticipantsCount){var a=void 0===e.participantsCount?"":e.participantsCount;i=$WC.template.replace(this.participantsCountCntHtml,{participants_count:a,module:e.module,$title:"common.participants"})}var n="";if(e.showViewersCount){var s=void 0===e.viewersCount?"":e.viewersCount;n=$WC.template.replace(this.viewersCountCntHtml,{viewers_count:s})}var o='<div id="recording_indicator" class="media-user-count pLR10 flexC" recording_indicator data-title="{{title}}" style="{{display_style}}">\n\t\t\t<span class="AV-call-record-text zc-av-flexC">\n\t\t\t\t<span class="AV-call-record-icon AV-call-record-icon-circle flexM animation mT1"></span>\n\t\t\t\t<span class="font11 mL3">REC</span>\n\t\t\t</span>\n\t\t</div>';o=$WC.template.replace(o,{display_style:void 0!==e.recordingIndex?"":"display:none",$title:"mediarecorder.recording"});var r="";e.showNetworkHealthIndicator&&(r=this.getNetworkHealthIndicatorHtml(e.networkHealthParams));var l=$WC.template.replace(this.headerComponentHtml,{back_opt:t,participants_count_cnt:i,viewers_count_cnt:n,recording_html:o,network_health_indicator:r},"InSecureHTML");return $WC.template.replace(l,{custom_class:e.customClass,custom_attribute:e.customAttribute,module:e.module,back_btn_class:e.backBtnClass,back_btn_purpose:e.backBtnPurpose,component_icon_class:e.componentIconClass,timer_id:e.timerId,title:e.title,header:e.header,$back_btn_title:e.backBtnTitle})},getNetworkHealthIndicatorHtml:function(e){return $WC.template.replace(this.networkHealthIndicatorHtml,{custom_class:e.customClass||"",custom_attribute:e.customAttribute||"",$health_tooltip:"network.strength.tooltip.excellent"})},_getDeviceDropDownHtml:function(e,t,i,a,n){if($WC.Util.isEmptyObject(a))return"";var s,o="",r=this.v2dropDownHtml,l=this.v2DropDownListItemHtml;for(var d in n&&(n.dropDownListItemHtml&&(l=n.dropDownListItemHtml),n.dropDownContainerHtml&&(r=n.dropDownContainerHtml)),a){var c=a[d];o+=$WC.template.replace(l,{device_id:d,label:c.label}),(d===t||$WC.Util.isEmpty(s)&&c.label===i)&&(s=c)}var u="";if(void 0===s&&void 0===t||""===s.deviceId)for(var d in a){s=c=a[d],t=d,""===c.label&&""===d&&("videoinput"===e?u=MediaUtil.getResource("media.camera.browser.blocked"):"audioinput"===e?u=MediaUtil.getResource("media.mic.blocked"):"audiooutput"===e&&(u=MediaUtil.getResource("media.audio.output.blocked")));break}var C="zcf-sound";ZCMediaDevices.isAudioInputDeviceKind(e)?C="zcf-mic":ZCMediaDevices.isVideoInputDeviceKind(e)&&(C="zcf-video");var p=$WC.template.replace(r,{$header:"media.setdevices."+e,device_kind:e,device_icon:C,selected_device_id:t,disable_drop_down:void 0===t||""===t?"zc-av-drp-dwn-disabled":"",label:$WC.Util.isEmpty(s)||$WC.Util.isEmptyObject(s)||""!==u?u:s.label});return $WC.template.replace(p,{drop_down_list:o,disable_device_icon:""!==u?'<span class="zcf-closeB smartconf-dropdown-close-icon flexM"></span>':""},"InSecureHTML")},getBufferLoader:function(e){return $WC.template.replace(this.bufferLoader,{class_name:void 0!==e?e:""})},getMutedBanner:function(e){return $WC.template.replace(this.muteBanner,{$content:"media.muted.info",$shortcut:[e?"media.muted.shortcut":"media.muted.additional.shortcut","mac"===$ZCUtil.getOS()?"Option":"Alt"]})},getAlertPopupHeaderImage:function(e,t){return $WC.template.replace(this.alertPopupHeaderImg,{$new_user_text:"common.new",curr_user_img:MediaCall.BRIDGE.Users.getImgUrlById(e),new_user_img:MediaCall.BRIDGE.Users.getImgUrlById(t)})}},MediaHandler={UIEvents:{closeMediaPermissionOverlay:function(){MediaManager.closePermissionOverlay()},enableVideoForEffectsPreview:function(e,t){var i=$("#video_effects_config_cnt").find("#video_effects_config_preview"),a=i.find("[loader]");a.removeClass("hide"),i.find("[request_video_box]").addClass("dN");var n={background:{type:ZCMediaPreferences.getPreferredVideoBackground()},filter:{type:ZCMediaPreferences.getPreferredVideoFilter()}};MediaManager.setAsStreamRequested(WebRTCUserMedia.streamTypes.VIDEO_ONLY),WebRTCUserMedia.requestNewStreamInstance(WebRTCUserMedia.streamInstanceIds.settings_video_effects_preview,WebRTCUserMedia.streamTypes.VIDEO_ONLY,(function(e){MediaManager.resetStreamRequested(),PersonalizeUI.setCallSettingsVideoPreviewStream(e),i.addClass("video-effects-has-video"),a.addClass("hide"),MediaUtil.setAndPlayStreamInMediaContainer(i,e,!0)}),(function(e){MediaManager.resetStreamRequested(),a.addClass("hide"),i.find("[blocked_video_box]").removeClass("dN")}),void 0,n)},setVideoBackground:function(e,t){if(!MediaManager.isCustomRequestPending(ZCMediaConstants.requests.setSettingsVideoBackgroundEffect)&&!MediaManager.isCustomRequestPending(ZCMediaConstants.requests.applySettingsPreviewVideoBackgroundEffect)){var i=t.find("[loader]");i.removeClass("dN");var a=$("#video_effects_config_cnt"),n=a.find("#video_effects_config_preview"),s=t.attr("value");MediaManager.setCustomRequestAsPending(ZCMediaConstants.requests.setSettingsVideoBackgroundEffect);var o=MLBackgroundProcessor.backgroundTypes.isSeasonalImage(s)?{seasonal_video_background:s}:{video_background:s,seasonal_video_background:MLBackgroundProcessor.backgroundTypes.NONE};Settings.update(o,(function(){MediaManager.setCustomRequestAsCompleted(ZCMediaConstants.requests.setSettingsVideoBackgroundEffect),a.find("[background_list] [list_item]").removeClass("zc-av-video-effects-list-item-active"),t.addClass("zc-av-video-effects-list-item-active"),i.addClass("dN");var e="video-effects-has-bg-image",o=s;(MLBackgroundProcessor.backgroundTypes.hasNoBackground(s)||MLBackgroundProcessor.backgroundTypes.isBlur(s))&&(o=MLBackgroundProcessor.backgroundTypes.images[0],e="video-effects-has-default-bg-image");var r=MLBackgroundProcessor.backgroundTypes.getThumbNailUrl(o);n.find("img").attr("src",MLBackgroundProcessor.backgroundTypes.getSrcUrl(o)),n.removeClass("video-effects-has-bg-image video-effects-has-default-bg-image").addClass(e),a.find("[filters_list] [list_item]").find("img").attr("src",r);var l=PersonalizeUI.getCallSettingsVideoPreviewStream();if(l){var d=a.find("#video_effects_config_preview"),c=d.find("[loader]");c.removeClass("hide"),i.removeClass("dN"),MediaManager.setCustomRequestAsPending(ZCMediaConstants.requests.applySettingsPreviewVideoBackgroundEffect),MLBackgroundProcessor.applyVideoBackground(l,s,(function(e){c.addClass("hide"),i.addClass("dN"),MediaManager.setCustomRequestAsCompleted(ZCMediaConstants.requests.applySettingsPreviewVideoBackgroundEffect),e&&(MediaUtil.setAndPlayStreamInMediaContainer(d,e,!0),PersonalizeUI.setCallSettingsVideoPreviewStream(e))}))}}),(function(){MediaManager.setCustomRequestAsCompleted(ZCMediaConstants.requests.setSettingsVideoBackgroundEffect),i.addClass("dN")}))}},setVideoFilter:function(e,t){if(!MediaManager.isCustomRequestPending(ZCMediaConstants.requests.setSettingsVideoFilterEffect)&&!MediaManager.isCustomRequestPending(ZCMediaConstants.requests.applySettingsPreviewVideoBackgroundEffect)){var i=t.find("[loader]");i.removeClass("dN");var a=$("#video_effects_config_cnt"),n=(a.find("#video_effects_config_preview"),t.attr("value"));MediaManager.setCustomRequestAsPending(ZCMediaConstants.requests.setSettingsVideoFilterEffect),Settings.update({video_filter:n},(function(){MediaManager.setCustomRequestAsCompleted(ZCMediaConstants.requests.setSettingsVideoFilterEffect),a.find("[filters_list] [list_item]").removeClass("zc-av-video-effects-list-item-active"),t.addClass("zc-av-video-effects-list-item-active"),i.addClass("dN");var e=PersonalizeUI.getCallSettingsVideoPreviewStream();if(e){var s=a.find("#video_effects_config_preview"),o=s.find("[loader]");o.removeClass("hide"),i.removeClass("dN"),MediaManager.setCustomRequestAsPending(ZCMediaConstants.requests.applySettingsPreviewVideoBackgroundEffect),MLBackgroundProcessor.applyVideoFilter(e,n,(function(e){o.addClass("hide"),i.addClass("dN"),MediaManager.setCustomRequestAsCompleted(ZCMediaConstants.requests.applySettingsPreviewVideoBackgroundEffect),e&&(MediaUtil.setAndPlayStreamInMediaContainer(s,e,!0),PersonalizeUI.setCallSettingsVideoPreviewStream(e))}))}}),(function(){MediaManager.setCustomRequestAsCompleted(ZCMediaConstants.requests.setSettingsVideoFilterEffect),i.addClass("dN")}))}}},UIToggleEvents:{toggleChatNotificationConfig:function(e,t){var i=t.is(":checked"),a=i?1:0,n=t.parents("[checkboxContainer]");n.addClass("media-requesting"),Settings.update({huddle_notify_msg:a},(function(){n.removeClass("media-requesting")}),(function(){n.removeClass("media-requesting"),t.prop("checked",!i)}))},toggleJoinVideoStatusConfig:function(e,t){var i=t.is(":checked"),a=i?1:0,n=t.parents("[checkboxContainer]");n.addClass("media-requesting"),Settings.update({huddle_join_video_muted:a},(function(){n.removeClass("media-requesting")}),(function(){n.removeClass("media-requesting"),t.prop("checked",!i)}))},toggleStickyInfoConfig:function(e,t){var i=t.is(":checked"),a=i?1:0,n=t.parents("[checkboxContainer]");n.addClass("media-requesting"),Settings.update({huddle_sticky_info:a},(function(){n.removeClass("media-requesting"),MediaManager.handleStickyInfoConfigUpdate(i)}),(function(){n.removeClass("media-requesting"),t.prop("checked",!i)}))},toggleRecordingConfig:function(e,t){Settings.update({conference_recording:t.val()})}},handleLogout:function(){void 0!==MediaCall.BRIDGE&&"function"==typeof MediaCall.BRIDGE.handleLogout&&MediaCall.BRIDGE.handleLogout()},handleChatWindowBeforeClose:function(e){ZCMediaRecorder.handleChatWindowBeforeClose(e),Conference.handleChatWindowBeforeClose(e)},handleWmsConnectionStatus:function(e){MediaCall.handleWmsConnectionStatus(e),PrimeTime.handleWmsConnectionStatus(e),Conference.handleWmsConnectionStatus(e)}},MediaUtil={BRIDGE:void 0,setClientBridge:function(e){this.BRIDGE=e,void 0!==MediaCall&&"function"==typeof MediaCall.setClientBridge&&MediaCall.setClientBridge(e)},getResource:function(){var e="undefined"!=typeof Resource?Resource:this.BRIDGE.Resource;return e.getRealValue.apply(null,arguments)},getCurrentUserId:function(){return void 0!==this.BRIDGE?this.BRIDGE.Constants.ZUID:$zcg._ZUID},isValidTitle:function(e){return e=e.trim(),!$WC.Util.isEmpty(e)&&!$WC.Matcher.check("invalid_textpattern_chars",e)&&e.length<=ZCMediaConstants.MAX_TITLE_LENGTH},setContainerPosition:function(e,t,i){var a=e.width(),n=e.height();t&&(a+=t),i&&(n+=i);var s=e.offset().left,o=e.offset().top,r=ZCJQuery(window),l=r.width(),d=r.height();s+a>l&&e.css("left",l-a),o+n>d&&e.css("top",d-n)},getBestFitWidth:function(e,t,i){if(e/i<=t)return e;var a=t*i;return a<=e?a:0},fitVideoContainer:function(e,t){var i=MediaUtil.getBestFitWidth(e.width(),e.height(),ZCMediaConstants.ASPECT_RATIO);t.css({width:i,height:i/ZCMediaConstants.ASPECT_RATIO})},getCriteriaForDrag:function(){return{areaToBeVisible:ZCMediaConstants.minimizedWindowRange.visibleArea}},getCriteriaForResize:function(e){return{aspectRatio:ZCMediaConstants.minimizedWindowRange.aspectRatio,widthRange:ZCMediaConstants.minimizedWindowRange.width,heightRange:ZCMediaConstants.minimizedWindowRange.height,callBack:function(t,i){"function"==typeof e&&e(t,i)}}},setStreamInContainer:function(e,t,i,a){var n=t.find("video");if(0!=n.length){var s=e===MediaUtil.getCurrentUserId();(n=n[0]).muted=s,n.setOrientation(s),i&&(t.find("[bufferloadercnt]").empty(),$ZCUtil.animateBufferLoader(t.find("[bufferloadercnt]"),9),n.setStream(i),n.playStream((function(){t.find("[bufferloadercnt]").empty(),"function"==typeof a&&a()})))}},getDeviceDropDownHtml:function(e,t,i){var a=e==ZCMediaDevices.kinds.VIDEO_INPUT,n=void 0,s=void 0;void 0!==t&&(n=a?t._getVideoDeviceId():t._getAudioDeviceId(),s=a?t._getVideoDeviceLabel():t._getAudioDeviceLabel());var o=a?ZCMediaDevices.getVideoInputDevices():ZCMediaDevices.getAudioInputDevices();return MediaTemplates._getDeviceDropDownHtml(e,n,s,o,i)},getAudioOutputDropDownHtml:function(e){var t=ZCMediaDevices.getAudioOutputDevices(),i=ZCMediaDevices.kinds.AUDIO_OUTPUT,a=t.default;if(ZCMediaDevices.hasPreferredAudioOutput()){var n=ZCMediaDevices.getPreferredDevices().audiooutput;void 0!==n&&ZCMediaDevices.isValidDevice(i,n.deviceId)&&(a=n)}if(void 0===a){var s=Object.keys(t);if(!s.length)return"";a=t[s[0]]}return""!==a.deviceId||e.includeDeviceDropDown?MediaTemplates._getDeviceDropDownHtml(i,a.deviceId,a.label,t,e):""},getNewDeviceInfoCntHtml:function(e,t,i){var a=e.kind==ZCMediaDevices.kinds.VIDEO_INPUT;return MediaTemplates.getTopBandHtml({id:"newDeviceInfoCnt",customClass:"AV-device-switch-banner "+t,contentResourceParams:["media.device.plugged.info",e.label],icons:[{className:a?"zcf-camera":"zcf-mic"}],actionButtons:[{customAttribute:i+" deviceId="+e.deviceId+" deviceKind="+e.kind,contentResourceParams:"videobroadcast.switch",purpose:"switchToNewDevice"}],closeOption:{customAttribute:i,purpose:"closeNewDeviceInfo",titleResourceParams:"common.hide"}})},removeNewDeviceInfoCnt:function(){var e=ZCJQuery("#newDeviceInfoCnt");e.length&&e.remove()},updateAVStatusInContainer:function(e,t,i,a){if(e.length)if("audio"!==t){e.find("[videoMutedStatus]").toggleClass("dN",!i);var n=ZCJQuery(e.find("video")[0]),s=e.find("[userimagecnt]");i?(n.addClass("dN"),s.removeClass("dN")):(n.removeClass("dN"),s.addClass("dN"))}else e.find("[audioMutedStatus]").toggleClass("dN",!i)},adjustAudioPulsesCnt:function(e,t){if(e&&e.length){var i=105*t/ZCMediaConstants.FREQUENCY_BIN_RANGE;i=i>50?i:0,e.css({width:i+"%",height:i+"%"})}},adjustLinearAudioLevel:function(e,t){if(e&&e.length){e.children().length||e.html(MediaTemplates.linearAudioLevel);var i=105*t/ZCMediaConstants.FREQUENCY_BIN_RANGE;i>=60?e.removeClass("audlvl-medium").addClass("audlvl-high"):i>=30?e.removeClass("audlvl-high").addClass("audlvl-medium"):e.removeClass("audlvl-medium audlvl-high"),e.find("[audiolevel]").css({width:100-i+"%"})}},setDarkMode:function(){var e="cliq-theme"+Settings.getFromObj("cthemes")+" cust_theme cliq-theme1 ";$WC.Util.isEmpty($zcg._CUSTOMTHEME)||$WC.Util.isEmpty($zcg._CUSTOMTHEME.theme_name)||(e+=" "+$zcg._CUSTOMTHEME.theme_name),ZCJQuery("body").removeClass(e).addClass("nite-mode")},resetDarkMode:function(){UI.Theme.updateTheme()},updateNetworkHealth:function(e,t){var i=ZCMediaConstants.healthMeterStateText[e];t.find(".health-meter-status").removeClass("health-meter-status"),e>0&&(t.removeClass("AV-health-meter-excellent AV-health-meter-good AV-health-meter-low AV-health-meter-poor AV-health-meter-deadzone"),t.addClass("AV-health-meter-"+i),t.find('[health="'+e+'"]').addClass("health-meter-status")),t.attr("title",MediaUtil.getResource("network.strength.tooltip."+i))},removeVideoElemsStreamInContainer:function(e){0!==e.length&&e.find("video").each((function(){this._removeStream()}))},showMultipleCallAlertPopup:function(e,t,i){var a=MediaCall.BRIDGE.Users.getName(e);$WC.$Dlg.create({id:"call_alert_popup",version:3,class:"zc-av-multicall-dialog-box",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:MediaTemplates.getAlertPopupHeaderImage(MediaCall.BRIDGE.Constants.ZUID,e),header:'<div class="zc-av-fontB clr-green">'+MediaUtil.getResource("multiple.call.alert.header",[$WC.$CUtil.processXSS(a)])+"</div>",subheader:[MediaUtil.getResource("multiple.call.alert.subheader",[$WC.$CUtil.processXSS(a)])]}),closefn:function(){void 0!==t&&t()},buttons:[$WC.$Dlg.getButtonObj(MediaUtil.getResource("common.cancel"),"zc-av-multicall-btn zc-av-multicall-btn--secondary"),$WC.$Dlg.getButtonObj(MediaUtil.getResource("mediacall.end.and.proceed"),"zc-av-multicall-btn zc-av-multicall-btn--primary zc-av-mL20",(function(){void 0!==i&&i()}))]})},isInMaximizedView:function(){var e=!1;return PrimeTime.isInitialized()&&PrimeTimeImpl.hasCurrentSession()?e=PrimeTimeUI.isInMaximizedView():"undefined"!=typeof ConferenceImpl&&ConferenceImpl.hasCurrentSession()?e=ConferenceUI.isInMaximizedView():"undefined"!=typeof ZCSmartConferenceImpl&&ZCSmartConferenceImpl.hasCurrentSession()&&(e=ZCSmartConferenceUI.isInMaximizedView()),e},getVideoEffects:function(e){var t=void 0;if(MediaCall.isVideoEffectsEnabled()&&void 0!==MLBackgroundProcessor){var i=MLBackgroundProcessor.backgroundTypes.NONE,a=MLBackgroundProcessor.filterTypes.NONE;e?(i=e.getSelectedVideoBackground(),a=e.getSelectedVideoFilter()):MediaCall.isVideoEffectsSettingsEnabled()&&void 0!==ZCMediaPreferences&&(i=ZCMediaPreferences.getPreferredVideoBackground(),a=ZCMediaPreferences.getPreferredVideoFilter()),t={background:{type:i},filter:{type:a}}}return t},setAndPlayStreamInMediaContainer:function(e,t,i){if(t&&e.length){var a=e.find("[loader]");a.removeClass("hide");var n=e.find("video")[0];n.setOrientation(i),i&&(n.muted=!0),n.setStream(t),n.playStream((function(){a.addClass("hide")}))}},handleShowOnTop:function(e){var t=e.closefn,i=void 0!==MediaUtil.BRIDGE?MediaUtil.BRIDGE.getZIndex():"1000";i=isNaN(i)?i:parseInt(i)+1,ZCJQuery("#zcwindows").css("z-index",i);var a=function(){var e=void 0!==MediaUtil.BRIDGE?MediaUtil.BRIDGE.getZIndex():"";ZCJQuery("#zcwindows").css("z-index",e),"function"==typeof t&&t()}.bind(this);return Object.assign({},e,{closefn:a})},createPopup:function(e,t){t&&(e=this.handleShowOnTop(e)),$WC.$Win.create(e)},createDialog:function(e,t){t&&(e=this.handleShowOnTop(e)),$WC.$Dlg.create(e)},videoResolutions:function(){var e=["720","480"],t="720",i={720:{width:{min:1280,max:1280},height:{min:720,max:720}},480:{width:{min:640,max:640},height:{min:480,max:480}}};return{getSupportedResolutions:function(){return e},getPreferredVideoRes:function(){return t},setPreferredVideoRes:function(e){e&&(t=e)},getConstraintsForVideoRes:function(e){return{video:i[e]}}}}()},MediaAPI={request:function(e){if(MediaCall.isNewAVDomainRoutingEnabled()&&MediaCallIframeHandler.isLoaded){var t={};return"function"==typeof e.success&&(t.successCB=e.success,delete e.success),"function"==typeof e.error&&(t.errorCB=e.error,delete e.error),MediaCall.BRIDGE.Constants.IS_GUEST_USER&&"undefined"!=typeof GuestChatUtils&&GuestChatUtils.isValidAPI(e.url)&&(e.headers=e.headers||{},e.headers["x-cliq-guid"]=MediaCall.BRIDGE.Constants.GUID),void MediaCallIframeHandler.dispatchAVRequest(e,t)}$ZCAjx.ajax(e)},serialize:function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return"?"+t.join("&")},pushConnectionNetworkDetails:function(e,t,i,a,n){var s={data:i,stats_api_format:a};void 0!==n&&(void 0!==n.isUpStream&&(s.is_upstream=n.isUpStream),void 0!==n.connectionType&&(s.connection_type=n.connectionType)),MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/"+t+"/"+e+"/stats",type:"POST",contentType:"application/json",data:s})},pushConnectionStats:function(e,t,i,a,n){var s={data:i};void 0!==n&&(void 0!==n.isUpStream&&(s.is_upstream=n.isUpStream),void 0!==n.connectionType&&(s.connection_type=n.connectionType)),MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/"+t+"/"+e+"/stats",type:"PUT",contentType:"application/json",data:s})},uploadClientLog:function(e,t,i,a,n){$ZCAjx.ajax({url:MediaCallConstants.baseUrl+"/v2/"+t+"/"+e+"/clientlog",type:"POST",data:function(e,t,i){var a=new FormData;for(var n in e)a.append(n,e[n]);return void 0!==i&&a.append(t,i[0],i[1]),a}({subject:a,description:n},"logfile",i),processData:!1,contentType:!1})},updatePreferredDevice:function(e,t){var i=[];for(var a in e){var n=e[a];i.push({id:n.deviceId,type:n.kind})}MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/users/"+MediaCall.BRIDGE.Constants.ZUID+"/updatepreferredmediadevice",type:MediaCallConstants.request.method.POST,data:{devices:i},contentType:"application/json",success:function(e){"function"==typeof t&&t(e)}})},getPreferredDevices:function(e,t){MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/users/"+MediaCall.BRIDGE.Constants.ZUID+"/preferredmediadevices",type:MediaCallConstants.request.method.GET,success:function(t){"function"==typeof e&&e(t)},error:function(){"function"==typeof t&&t()}})}},MediaManager=function(){var e=!1,t=!1,i={isRequested:!1,type:void 0,module:void 0},a=void 0,n=[],s=null,o={};function r(){return void 0!==WebRTCUserMedia}function l(e,t,i,n){clearTimeout(a),a=setTimeout((function(){d(e,t,i,n)}),3e3)}function d(e,t,i,a){if(void 0!==t||i||a){var n=MediaUtil.getResource("common.device.camera.mic"),s="",o="";i&&a?(n=MediaUtil.getResource("common.device.camera.mic"),o=$WC.template.replace(MediaTemplates.permissionOverlayIcon,{class_name:"zcf-mic"}),o+=$WC.template.replace(MediaTemplates.permissionOverlayIcon,{class_name:"zcf-video"})):a?(n=MediaUtil.getResource("common.device.mic"),o=$WC.template.replace(MediaTemplates.permissionOverlayIcon,{class_name:"zcf-mic"})):i&&(n=MediaUtil.getResource("common.device.camera"),o+=$WC.template.replace(MediaTemplates.permissionOverlayIcon,{class_name:"zcf-video"})),t===ZCMediaConstants.mediaModules.CONFERENCE?s=MediaUtil.getResource("media.access.permission",[MediaUtil.getResource("media.conference"),n]):t===ZCMediaConstants.mediaModules.PRIMETIME&&(s=MediaUtil.getResource("media.access.permission",[MediaUtil.getResource("media.primetime"),n]));var r=$WC.template.replace(MediaTemplates.permissionOverlay,{permission_overlay_icon:o},"InSecureHTML");r=$WC.template.replace(r,{$header:MediaUtil.getResource("common.permission.device",[n]),permission:s,$close:"common.to.close",$ok:"common.okgotit",class_name:$ZCUtil.Browser.isSafari()?"safari":""}),$WC.$Win.create({id:"permissionInfo",class:"zcalgncntr zcbg_mask zc-av-permission-modal",html:r})}}function c(){return"undefined"!=typeof PrimeTimeImpl&&PrimeTimeImpl.hasCurrentSession()}function u(){return"undefined"!=typeof ConferenceImpl&&ConferenceImpl.hasCurrentSession()}function C(){return"undefined"!=typeof ZCSmartConferenceImpl&&ZCSmartConferenceImpl.hasCurrentSession()}function p(){return void 0!==MediaCallImpl&&(MediaCallImpl.hasCurrentSession()||MediaCallImpl.hasOutgoingSession())}function h(e,t){var i={text:MediaUtil.getResource("common.close"),colour:$WC.$Dlg.GREEN_BUTTON},a={mac:{camera:"x-apple.systempreferences:com.apple.preference.security?Privacy_Camera",mic:"x-apple.systempreferences:com.apple.preference.security?Privacy_Microphone",screen:"x-apple.systempreferences:com.apple.preference.security?Privacy_ScreenCapture"},windows:{camera:"ms-settings:privacy-webcam",mic:"ms-settings:privacy-microphone"},openSystemPreferences:function(e){var t=$ZCUtil.getOS();this[t]&&this[t][e]&&window.open(this[t][e])}},n=$ZCUtil.isMacOSCatalinaOrNewer()||$ZCUtil.isWindows10orNewer()&&t!==WebRTCUserMedia.streamTypes.SCREEN;return e.name===WebRTCUserMedia.errors.NotAllowedError&&n&&(i={text:MediaUtil.getResource("media.open.system.preferences"),colour:$WC.$Dlg.GREEN_BUTTON,action:function(){var e=WebRTCUserMedia.isAudioStreamType(t)?"mic":WebRTCUserMedia.isScreenStreamType(t)?"screen":"camera";a.openSystemPreferences(e)}}),[i]}function m(e,t){$WC.$Dlg.confirm({id:"handlemediasessionsdialog",version:2,class:"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-alrt clr-green"></div>'}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[t]}),buttons:[{text:MediaUtil.getResource("common.goahead"),colour:$WC.$Dlg.GREEN_BUTTON,action:e}]})}function f(){$WC.$Win.destroy("permissionInfo")}return"undefined"!=typeof $ZCUtil&&$ZCUtil.isJQueryAvailable()&&void 0===window.ZCJQuery&&(window.ZCJQuery=window.jQuery),{isInitialized:r,bindEvents:function(){if(!t){ZCJQuery(document).on("click","[mediamodulebuttons]",(function(e){e.stopPropagation();var t=ZCJQuery(this),i=t.attr("purpose");MediaHandler.UIEvents[i](e,t)})),ZCJQuery(document).on("change",'[mediamodulecheckbox][type="checkbox"]',(function(e){e.stopPropagation();var t=ZCJQuery(this),i=t.attr("purpose");MediaHandler.UIToggleEvents[i](e,t)})),ZCJQuery(document).on("change",'[mediamoduleradiobuttons] [type="radio"]',(function(e){var t=ZCJQuery(this),i=t.parents("[mediamoduleradiobuttons]").attr("purpose");MediaHandler.UIToggleEvents[i](e,t)})),ZCJQuery(document).on("keydown",(function(e){if(32===e.keyCode&&"composer"!==ZCJQuery(e.target).attr("data-type")){var t="undefined"!=typeof Conference&&Conference.startPushToTalk();void 0===MediaCall||t||MediaCall.startPushToTalk()}else e.altKey&&65==e.keyCode&&MediaManager.handleMuteShortCut()&&e.preventDefault()})),ZCJQuery(document).on("keyup",(function(e){if(32===e.keyCode&&"composer"!==ZCJQuery(e.target).attr("data-type")){var t="undefined"!=typeof Conference&&Conference.stopPushToTalk();void 0===MediaCall||t||MediaCall.stopPushToTalk()}})),t=!0}},applyDefaultConstraints:function(e){e instanceof MediaStream&&e._hasAudioTrack()&&e._getPrimaryAudioTrack().applyConstraints(ZCMediaConstants.audioConstraints).catch()},applyVideoConstraints:function(e,t){e instanceof MediaStream&&e._hasVideoTrack()&&e._getPrimaryVideoTrack().applyConstraints(t).catch()},isStreamRequested:function(){return i.isRequested},setAsStreamRequested:function(e,t){i={isRequested:!0,type:e,module:t};var a=e===WebRTCUserMedia.streamTypes.AUDIO_VIDEO||e===WebRTCUserMedia.streamTypes.VIDEO_ONLY,n=e===WebRTCUserMedia.streamTypes.AUDIO_VIDEO||e===WebRTCUserMedia.streamTypes.AUDIO_ONLY;if(n||a)if(WebRTCUserMedia.isPermissionQuerySupported()){var s=function(){l(e,t,a,n)},o=function(i){a=i===ZCMediaConstants.devicePermissionStates.PROMPT,MediaManager.checkAndShowPermissionWindow(e,t,a,n)};WebRTCUserMedia.getAudioPermission((function(i){n=i===ZCMediaConstants.devicePermissionStates.PROMPT,e===WebRTCUserMedia.streamTypes.AUDIO_VIDEO?WebRTCUserMedia.getVideoPermission(o,s):MediaManager.checkAndShowPermissionWindow(e,t,!1,n)}),s)}else l(e,t,a,n)},resetStreamRequested:function(){clearTimeout(a),i={isRequested:!1,type:void 0,module:void 0},f()},showPermissionWindowUI:d,isRequestPending:function(){return null!=s},setRequestPending:function(e){s=e},setRequestCompleted:function(){s=null},getPendingRequestDetails:function(){return s},isCustomRequestPending:function(e){return o[e]},setCustomRequestAsPending:function(e){o[e]=!0},setCustomRequestAsCompleted:function(e){delete o[e]},initialize:function(t){function i(){e=!1,n.forEach((function(e){"function"==typeof e&&e()})),n=[]}n.push(t),r()?i():e||(e=!0,$ZCUtil.loadMultipleFiles("script",$zcg._VIDEOCHATPROPS.MEDIACOMPONENTS_JS_LIST,i))},isOrgScope:function(e){return e===ZCMediaConstants.scopeTypes.ORG},isTeamScope:function(e){return e===ZCMediaConstants.scopeTypes.TEAM},isChatScope:function(e){return e===ZCMediaConstants.scopeTypes.CHAT},isEventScope:function(e){return e===ZCMediaConstants.scopeTypes.EVENT},isPersonalScope:function(e){return e===ZCMediaConstants.scopeTypes.PERSONAL},getImgUrl:function(e){return(void 0!==MediaUtil.BRIDGE?MediaUtil.BRIDGE.Constants.IMGDEFAULTSTATICURL:$zcg._IMGDEFAULTSTATICURL)+"/media/"+e},showExtensionInstallPreview:function(e){var t=$WC.template.replace('<div class="cliqextn-mc"><div class="dflx"><div class="cliqextn-mc-img dflxjustcent fshrink"><img src="{{src}}" class="h100 w100"></div><div class="mL30"><div class="font16 lin22 mrgT5">{{hint}}</div><div class="mrgT15 dbtn cliqextn-mc-btn" {{event_attribute}} purpose="goToStore">{{btn_text}}</div></div></div></div>',{$hint:"extension.install.hint",$btn_text:"extension.install",event_attribute:e,src:(void 0!==MediaUtil.BRIDGE?MediaUtil.BRIDGE.Constants.IMGDEFAULTSTATICURL:$zcg._IMGDEFAULTSTATICURL)+"/logo/v1/cliq-icon.ico"});$WC.$Win.create({id:"extension_install_preview",header:$WC.template.replace('<div class="dflxcent w100 pR25 pL25"><span class="font17 flxG clr0 bold">{{header}}</span></div>',{$header:"extension.install.header"}),html:t,class:"cliqextn-win adchtwin"})},handleExistingSessions:function(e){if($WC.$Dlg.destroy("handlemediasessionsdialog"),c())m((function(){PrimeTimeImpl.handleEnd(!0),e()}),MediaUtil.getResource("media.endprimetime.info"));else if(u()){var t=ConferenceImpl.getCurrentSession().isAudioConference()?"conference.audio.title":"conference.video.title";m((function(){ConferenceImpl.handleEnd(!0),e()}),MediaUtil.getResource("media.endconference.info",[MediaUtil.getResource(t)]))}else if(C()){var i=ZCSmartConferenceImpl.getCurrentSession();t=i.isAudioConference()?"conference.audio.title":"conference.video.title";m((function(){ZCSmartConferenceImpl.endConference(i.getId(),!0),e()}),MediaUtil.getResource("media.endconference.info",[MediaUtil.getResource(t)]))}else if(p()){var a=MediaCallImpl.hasOutgoingSession()?MediaCallImpl.getOutgoingSession():MediaCallImpl.getCurrentSession(),n=a.isAudioCall()?"videochat.audiocall":a.isVideoCall()?"videochat.videocall":"media.screenshare.session",s=a.isCaller(MediaUtil.getCurrentUserId())?a.getCallee().getName():a.getCaller().getName();m((function(){MediaCallImpl.handleEnd(a.getId(),!0),e()}),MediaUtil.getResource("media.endcall.info",[MediaUtil.getResource(n),s]))}else if("undefined"!=typeof ZCSmartConferenceImpl&&ZCSmartConferenceImpl.hasJoiningSession())ZCSmartConferenceImpl.closePreviewRoom(),e();else if("undefined"!=typeof ZCMediaRecorderImpl&&ZCMediaRecorderImpl.hasCurrentRecordingSession()){var o=ZCMediaRecorderImpl.getCurrentRecordingSession(),r="media.endrecord.info";o.isVideoMessage()?r="video.endrecord.info":o.isScreenRecording()&&(r="screen.endrecord.info"),m((function(){ZCMediaRecorderImpl.handleEnd(o.getId()),e()}),MediaUtil.getResource(r))}else e()},handleMediaError:function(e,t){f();var i="camera",a="";if(WebRTCUserMedia.isAudioStreamType(t)?i="mic":WebRTCUserMedia.isAudioVideoStreamType(t)?i="camera.mic":WebRTCUserMedia.isScreenStreamType(t)&&(i="screen"),e.name===WebRTCUserMedia.errors.NotAllowedError)a=".permission.notallowed";else{if(e.name!==WebRTCUserMedia.errors.NotFoundError&&e.name!==WebRTCUserMedia.errors.NotReadableError)return void 0!==e.code&&void 0!==e.message?void("undefined"!=typeof UI&&void 0!==UI.updateBanner&&UI.updateBanner(Resource.getRealValue(e.message),2e3,!0)):void 0;a=".notfound"}$WC.$Dlg.confirm({id:"handlemediaerror",version:2,class:"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-alrt clr-green"></div>'}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[MediaUtil.getResource("media."+i+a)]}),buttons:h(e,t)})},getCallOptionsHtmlForCwin:function(e){var t="",i=[];if(e.isOnetoOneChat()){Participants.get(e.chid);if(!e.getPermission().video)return t;if(MediaCall.isAudioCallAllowed()&&i.push(MediaCallConstants.types.AUDIO),MediaCall.isVideoCallAllowed()&&i.push(MediaCallConstants.types.VIDEO),MediaCall.isScreenShareWithAudioCallAllowed()&&i.push(MediaCallConstants.types.SCREEN_SHARE_WITH_AUDIO),i.length){var a={onetoonecall:"zcf-calloption"};a[MediaCallConstants.types.AUDIO]="zcf-call",a[MediaCallConstants.types.VIDEO]="zcf-video",a[MediaCallConstants.types.SCREEN_SHARE]="zcf-sharescrn",a[MediaCallConstants.types.SCREEN_SHARE_WITH_AUDIO]="zcf-sharescrn";var n={onetoonecall:void 0};n[MediaCallConstants.types.AUDIO]="videochat.audiocall",n[MediaCallConstants.types.VIDEO]="videochat.videocall",n[MediaCallConstants.types.SCREEN_SHARE]="videochat.sharescreen",n[MediaCallConstants.types.SCREEN_SHARE_WITH_AUDIO]="common.screenshare";var s=i[0],o="";i.length>1&&(o='<div class="zcl-menu-wrap">',i.forEach((function(e){o+=$WC.template.replace('<div id="{{type}}_call_{{chid}}" class="zcl-menu-item ellips" purpose="options"><em class="zcl-menu-item-icn {{icon}}"></em><span>{{title}}</span></div>',{type:e,icon:a[e],$title:n[e]})})),o+="</div>",s="onetoonecall"),t=$WC.template.replace('<div id="{{call_type}}_call_{{chid}}" class="call-options zc-conf-one-to-one-chat" purpose="options"><div><span class="{{call_icon}}" title="{{call_title}}"></span></div>{{drop_down}}</div>',{drop_down:o},"InSecureHTML");var r=void 0!==n[s]?$ZCUtil.getCustomTooltip(MediaUtil.getResource(n[s]),"text",!1,"south"):"";t=$WC.template.replace(t,{call_type:s,call_icon:a[s],call_title:r,chid:e.chid})}}return t},getGroupCallOptionsHtmlForCwin:function(e){var t=e.chid;if(_isLhsRevampEnabled()){var i=MediaManager.getJoinedGroupCallId(),a=CallHistoryData.getOngoingCallForChat(t);if(void 0!==a){var n='<div title="{{type_text}} - {{title}}" purpose="options" data-purpose="joinCall" id="joingroupcall-{{chid}}" nrs_id="{{nrs_id}}" type="{{type}}" class="dflx zc-grp-call-join {{clazz}}">\n\t\t\t\t\t<span class="zcf-video-conf"></span>\n\t\t\t\t\t<span class="mL4 font12 zc-grp-call-txt">{{join}}</span>\n\t\t\t\t</div>';return $WC.template.replace(n,{chid:t,type:a.type,nrs_id:a.nrs_id,title:a.title,$type_text:"audio_conference"===a.type?"videochat.audiocall":"video_conference"===a.type?"videochat.videocall":"videobroadcast.streaming",clazz:i===a.nrs_id?"inactive":"",$join:"common.join"})}}n="";var s=[],o=Conference.isNomenclatureEnabled();if(o?(e.hasPermissionToHostAudioConference()&&Conference.isAudioConferenceAllowed()||e.hasPermissionToHostVideoConference()&&Conference.isVideoConferenceAllowed())&&(s.push("start_meeting"),s.push("schedule_meeting")):(e.hasPermissionToHostAudioConference()&&Conference.isAudioConferenceAllowed()&&s.push("audio_conference"),e.hasPermissionToHostVideoConference()&&Conference.isVideoConferenceAllowed()&&s.push("video_conference")),e.hasPermissionToHostPrimeTime()&&PrimeTime.isAllowed()&&s.push("primetime"),s.length){var r={primetime:"zcf-primetime",audio_conference:"zcf-call",video_conference:"zcf-video",groupcall:"zcf-group-call",meetings:"zcf-meetings",start_meeting:"zcf-meeting",schedule_meeting:"zcf-calendar"},l={primetime:"media.primetime",audio_conference:"videochat.audiocall",video_conference:"videochat.videocall",groupcall:"common.calls",meetings:"common.meetings",start_meeting:"common.start.meeting",schedule_meeting:"event.schedule.meeting"},d="",c=s[0],u="zcbroadcast";s.length>1&&(d='<div class="zcl-menu-wrap">',s.forEach((function(e){d+=$WC.template.replace('<div id="{{type}}{{chid}}" class="zcl-menu-item ellips" purpose="options" data-purpose="{{data_purpose}}"><em class="zcl-menu-item-icn {{icon}}"></em>{{title}}</span></div>',{type:e,icon:r[e],$title:l[e],data_purpose:"primetime"===e?u:""})})),u="",d+="</div>",c=o?"meetings":"groupcall"),n=$WC.template.replace('<div class="call-options grp-call-opts" id="{{group_call_type}}{{chid}}" purpose="options" data-purpose="{{data_purpose}}"><div><span class="{{group_call_icon}}"></span></div>{{drop_down}}</div>',{drop_down:d},"InSecureHTML"),n=$WC.template.replace(n,{group_call_type:c,group_call_icon:r[c],chid:e.chid,data_purpose:u})}return n},updateGroupCallOptionsInChatHeader:function(e){void 0!==e&&ChatUI.isExist(e)&&ChatUI.exist[e].updateAdditionalOptionsUI()},hasOnGoingSession:function(){return c()||u()||C()||p()||"undefined"!=typeof LiveFeedImpl&&LiveFeedImpl.hasOutgoingFeedSession()},hasOnGoingNewMediaCall:p,getJoinedGroupCallId:()=>{var e;if("undefined"!=typeof ConferenceImpl&&(e=ConferenceImpl.getCurrentSession()))return e.getId();if("undefined"!=typeof ZCSmartConferenceImpl&&(e=ZCSmartConferenceImpl.getCurrentSession()))return e.getId();if("undefined"!=typeof PrimeTimeImpl){var t=PrimeTimeImpl.getCurrentSession();if(t)return t.getId()}},isMildNotificationToneNeeded:function(){return c()||u()||C()||void 0!==MediaCallImpl&&MediaCallImpl.hasCurrentSession()},updatePeopleInfoInUI:function(e,t){var i="",a=t.getDepartmentName(),n=t.getDesignation(),s=t.getEmailId();void 0!==n&&void 0!==a?i=n+" - "+a:void 0!==s&&(i=s),e.text(i)},closePermissionOverlay:f,checkAndShowPermissionWindow:function(e,t,i,a){(i||a)&&MediaManager.isStreamRequested()&&d(e,t,i,a)},getClientSupport:function(){var e={perfect_renegotiation:!0,multi_stream:!0};return $ZCUtil.Browser.isChrome()||$ZCUtil.Browser.isSafari()||$ZCUtil.Browser.isOpera()?WebRTCUserMedia.isDisplayMediaSupported()||(e={perfect_renegotiation:!1,multi_stream:!1}):$ZCUtil.Browser.isFirefox()&&(e.perfect_renegotiation=!1),e},handleMuteShortCut:function(){var e=!1;if(MediaCallImpl.hasCurrentSession())e=MediaCallImpl.getCurrentSession().handleMuteShortcut();else if(u()){e=ConferenceImpl.getCurrentSession().handleMuteShortcut()}else if(C()){e=ZCSmartConferenceImpl.getCurrentSession().handleMuteShortcut()}return e},handleStickyInfoConfigUpdate:function(e){C()&&ZCSmartConferenceImpl.getCurrentSession().handleStickyInfoConfigUpdate(e)},updateParticipantStatus:function(e){if(u())ConferenceUI.updateParticipantStatus(e);else if(C()){ZCSmartConferenceImpl.getCurrentSession().updateParticipantStatus(e)}},setPreferredAudioOutput:function(e){if(void 0!==ZCMediaDevices&&ZCMediaDevices.hasPreferredAudioOutput()){var t=ZCMediaDevices.getPreferredDevices().audiooutput,i=ZCMediaDevices.kinds.AUDIO_OUTPUT;if(void 0!==t&&ZCMediaDevices.isValidDevice(i,t.deviceId))for(var a in e)e[a].setSinkId(t.deviceId).catch((function(){}))}},getSnippetMsgParams:function(e,t){let i=ZCSmartConferenceImpl.getCurrentActiveSession();return void 0===i||e!==i.getDummyThreadChatId()&&e!==i.getDummyChatId()||(t.params.trigger=JSON.stringify({type:"conference",id:i.getId()})),t.params[DummyCwinUtils.CONSTANTS.CHAT_KEY]=e,t}}}(),MLBackgroundProcessor=function(){var e=!1,t=!1;function i(){return!(MediaCall.isDesktopApp()&&$ZCUtil.isAppleSilicon())}var a="seasonal",n="normal",s="png",o="gif",r={beach_resort:{occassionType:n,format:s,thumbnailSrc:"thumbnails/beach_resort.png",src:"beach_resort.png"},beach:{occassionType:n,format:s,thumbnailSrc:"thumbnails/beach.png",src:"beach.png"},city_lights:{occassionType:n,format:s,thumbnailSrc:"thumbnails/city_lights.png",src:"city_lights.png"},conf_room:{occassionType:n,format:s,thumbnailSrc:"thumbnails/conf_room.png",src:"conf_room.png"},confetti:{occassionType:n,format:s,thumbnailSrc:"thumbnails/confetti.png",src:"confetti.png"},living_room_small:{occassionType:n,format:s,thumbnailSrc:"thumbnails/living_room_small.png",src:"living_room_small.png"},living_room_smooth:{occassionType:n,format:s,thumbnailSrc:"thumbnails/living_room_smooth.png",src:"living_room_smooth.png"},living_room_warm:{occassionType:n,format:s,thumbnailSrc:"thumbnails/living_room_warm.png",src:"living_room_warm.png"},living_room_white:{occassionType:n,format:s,thumbnailSrc:"thumbnails/living_room_white.png",src:"living_room_white.png"},reading_table:{occassionType:n,format:s,thumbnailSrc:"thumbnails/reading_table.png",src:"reading_table.png"},xmas_snow_santa:{occassionType:a,format:s,thumbnailSrc:"thumbnails/xmas_snow_santa.png",src:"xmas_snow_santa.png"},xmas_tree_smooth:{occassionType:a,format:s,thumbnailSrc:"thumbnails/xmas_tree_smooth.png",src:"xmas_tree_smooth.png"},xmas_tree_warm:{occassionType:a,format:s,thumbnailSrc:"thumbnails/xmas_tree_warm.png",src:"xmas_tree_warm.png"}},l={},d={},c="default_processor";function u(e,t,i){if(void 0===l[e])if(void 0===d[e]){var a=new zohoai.Background;d[e]=a;a.setEffect("none").setMode("lite").setPipelineType("canvas").setModelPath(void 0!==MediaCall.BRIDGE?MediaCall.BRIDGE.ServerConstants.JSSTATICURL+MediaCall.BRIDGE.ServerConstants.ML_FOCUSED_IMG_MODEL_PATH:$zcg._JSSTATICURL+$zcg._VIDEOCHATPROPS.ML_FOCUSED_IMG_MODEL_PATH).setCallback(()=>!0).build(!0,!1).then((function(i){d[e]=void 0,l[e]=i,"function"==typeof t&&t(i)})).catch((function(t){d[e]=void 0,"function"==typeof i&&i(e,t)}))}else"function"==typeof i&&i(e);else"function"==typeof t&&t(l[e])}return{isEnabledForMediaCall:function(){return void 0!==MediaCall&&MediaCall.isVideoEffectsEnabled()},isEnabledForLiveFeed:function(){return $zcg._IS_LIVEFEED_FOCUSED_IMG_ENABLED},isEnabledForGroupCall:function(){return"undefined"!=typeof Conference&&Conference.isVideoEffectsEnabled()},isSeasonalVideoEffectsEnabled:function(){return $zcg._IS_SEASONAL_VIDEO_EFFECTS_ENABLED},backgroundTypes:{NONE:"none",BLUR:"blur",IMAGE:"image",images:["beach_resort","beach","city_lights","conf_room","confetti","living_room_small","living_room_smooth","living_room_warm","living_room_white","reading_table"],seasonalImages:["xmas_snow_santa","xmas_tree_smooth","xmas_tree_warm"],hasNoBackground:function(e){return this.NONE===e||void 0===e},isBlur:function(e){return this.BLUR===e},isImage:function(e){return this.IMAGE===e},isSeasonalImage:function(e){return void 0!==r[e]&&r[e].occassionType===a},isGif:function(e){return r[e].format===o},getSrcUrl:function(e){return MediaManager.getImgUrl("video_backgrounds/"+r[e].src)},getThumbNailUrl:function(e){return MediaManager.getImgUrl("video_backgrounds/"+r[e].thumbnailSrc)}},filterTypes:{NONE:"none",VARIANT:"variant",variants:["grayscale","sepia"],variantsValues:{none:"none",grayscale:"grayscale(1)",sepia:"sepia(50%)"},hasNoFilter:function(e){return this.NONE===e||void 0===e}},isEnabled:function(){return this.isEnabledForMediaCall()||this.isEnabledForLiveFeed()||this.isEnabledForGroupCall()},isInitialized:function(){return e},initialize:function(a,n){this.isInitialized()?"function"==typeof a&&a():this.isEnabled()&&i()?MediaManager.initialize((function(){if(i()){if(t)return;function n(){e=!0,t=!1,u(c),"function"==typeof a&&a()}"undefined"==typeof zohoai?(t=!0,$Util.loadMultipleFiles("script",MediaCall.BRIDGE.ServerConstants.ML_FOCUSED_IMG_JS_LIST,n)):n()}})):"function"==typeof n&&n()},processStream:function(e,t,i,a,n){e._hasBackgroundProcessor()||t===WebRTCUserMedia.streamTypes.AUDIO_ONLY||t===WebRTCUserMedia.streamTypes.SCREEN||void 0===i||(void 0===i.background||MLBackgroundProcessor.backgroundTypes.hasNoBackground(i.background.type))&&(void 0===i.filter||MLBackgroundProcessor.filterTypes.hasNoFilter(i.filter.type))?a(e):function(e,t,i,a){u(e._isModuleInstance()?e._getModuleInstanceId():c,(function(a){e._hasVideoTrack()&&a.setVideo(new MediaStream(e.getVideoTracks())),e._hasAudioTrack()&&a.setAudio(e.getAudioTracks()),a.start().then((function(){var n=a.getStream().getTracks();a.audio&&(n=n.concat(a.audio));var s=new MediaStream(n);s._setBackgroundProcessor(a),s._setSourceStream(e),s._setType(e._getType()),e._isModuleInstance()&&s._setAsModuleInstance(e._getModuleInstanceId()),t&&(t.background&&MLBackgroundProcessor.applyVideoBackground(s,t.background.type),t.filter&&MLBackgroundProcessor.applyVideoFilter(s,t.filter.type)),"function"==typeof i&&i(s)}))}),(function(t,i){"function"==typeof a&&a(null,e._getType())}))}(e,i,a,n)},applyVideoBackground:function(e,t,i){if(e._hasBackgroundProcessor()){if(MLBackgroundProcessor.backgroundTypes.hasNoBackground(t))e._disableBackgroundEffects();else if(MLBackgroundProcessor.backgroundTypes.isBlur(t))MLBackgroundProcessor.enableBackgroundBlur(e,1);else{var a=MLBackgroundProcessor.backgroundTypes.getSrcUrl(t);MLBackgroundProcessor.enableVirtualBackground(a,e,MLBackgroundProcessor.backgroundTypes.isGif(t))}"function"==typeof i&&i()}else MLBackgroundProcessor.processStream(e,e._getType(),{background:{type:t}},i,i)},enableVirtualBackground:function(e,t,i){if(t){var a="ml-default-background"+(new Date).getTime(),n=ZCJQuery("#"+a);if(n.length)n[0].onload=function(){t._enableVirtualBackground("#"+a,i)},n[0].src=e;else{var s=ZCJQuery('<img id="'+a+'" src="'+e+'" class="zc-av-dN" crossorigin="anonymous">');s[0].onload=function(){t._enableVirtualBackground("#"+a,i)},ZCJQuery("body").append(s)}}else n[0].src=e},enableBackgroundBlur:function(e,t){e._enableBackgroundBlur(),void 0!==t&&this.setBlurIntensity(e,t)},setBlurIntensity:function(e,t){e._setBlurIntensity(t)},applyVideoFilter:function(e,t,i){if(e._hasBackgroundProcessor()){var a=MLBackgroundProcessor.filterTypes.variantsValues[t];e._applyVideoFilter(a),"function"==typeof i&&i()}else MLBackgroundProcessor.processStream(e,e._getType(),{filter:{type:t}},i,i)},stopProcessor:function(e){var t=e._getBackgroundProcessor();t&&(e._isModuleInstance()?(t.stop(),delete l[e._getModuleInstanceId()]):(e._disableBackgroundEffects(),e._disableVideoFilter()),e._clearBackgroundProcessor())}}}(),ZCMediaPreferences={getPreferredVideoBackground:function(){var e=void 0!==MediaCall&&void 0!==MediaCall.BRIDGE?MediaCall.BRIDGE.Settings.get:window.Settings.getFromObj,t=void 0;return MLBackgroundProcessor.isSeasonalVideoEffectsEnabled()&&(t=e("seasonal_video_background",!0)),void 0!==t&&t!==MLBackgroundProcessor.backgroundTypes.NONE||(t=e("video_background",!0)),void 0!==t?t:MLBackgroundProcessor.backgroundTypes.NONE},getPreferredVideoFilter:function(){var e=void 0!==MediaCall&&void 0!==MediaCall.BRIDGE?MediaCall.BRIDGE.Settings.get("video_filter",!0):window.Settings.getFromObj("video_filter",!0);return void 0!==e?e:MLBackgroundProcessor.filterTypes.NONE}},AdhocCallBridge={attach:function(e){var t=e.getAssociatedConferenceId(),i=ZCSmartConferenceImpl.getCurrentActiveSession();i&&i.getId()===t&&(i.subscribe(AdhocOneToOneCallHandler),e.subscribe(AdhocConferenceHandler))},detach:function(e){var t=e.getAssociatedConferenceId(),i=ZCSmartConferenceImpl.getCurrentActiveSession();i&&i.getId()===t&&(i.unSubscribe(),e.unSubscribe())},publish:function(e,t,i){e.hasSubscribed()&&e.getSubscribedHandler()[t](e,i.associatedSessionId,i)}};var MediaCall={},MediaCallConstants={},CallLogConstants={},MediaCallRejectMessages={};window._isZCDesktopApp=function(){return MediaCall.isDesktopApp()},MediaCallRejectMessages={_isInitialized:!1,_messages:[],MAX_LIMIT:5,init:function(){MediaCall.BRIDGE.Constants.IS_GUEST_USER||(this._isInitialized=!0,MediaCallAPI.getRejectMessages(MediaCallRejectMessages.setCustomMessageList.bind(this)))},isInitialized:function(){return this._isInitialized},getCustomMessageList:function(){return this._messages},setCustomMessageList:function(e){this._messages=e?e.reverse():[]},updateMessageList:function(e){this._messages.length>=this.MAX_LIMIT&&this._messages.pop(),this._messages.unshift(e)},hasCustomMessage:function(){return this._messages.length>0}},CallLogConstants={callStart:" call has been initiated from ",mediaSessionObject:"[MediaSessionObject]",existingSessionCheck:"Checking for existing media sessions...",existingSessionCheckSuccess:"Existing sessions are cleared, so call process can continue...",callUIShown:"[UI Shown] Call UI shown for caller",clentSupport:"[Client Support Object]",callInit:"[Call Initiated] Call state changed to initiating...",callEnd:"[Call End] Call ended",getMediaDevicesSuccess:"[Media device request completed] Request for media devices completed...",getMediaDevicesInit:"[Media device request] Request for media devices initiated...",sessionId:"Session Id : ",rawSessionID:"Raw Session Id : ",responseTime:"[API Response time] - ",callQualityScore:"[Call Quality Score] - ",networkPrediction:"[Before call connection network prediction] - (1 -> Good, 0 -> Poor)",candidatePairInfo:"[CandidatePairInfo] Selected candidate pair : ",cdnPolling:"[CDN Polling rtt] ",isWmsUp:"Is wms up : ",wmsInfo:"[WMS event logs]",canStartConnectionTimeout:"Is connection timeout started : ",isStereo:"Is stereo enabled : ",initialReconnection:"Initial reconnection attempted ",migarting:"[CALL_MIGRATING]",migrated:"CALL_MIGRATED]",trackEnd:{event:"[Track ended] Renegotiating with new stream :",device:"[Track ended] Device label : "},timers:{callReceivedAckTimeout:"[Call received ack timeout] - call missed state",callRingingTimeout:"[Call ringing timeout] - call missed state"},pullOffer:{end:"[Pull Offer API failed] Call end triggered due to the error : ",retry:"[Pull Offer API retry] Retrying pull offer due to the error : "},startCallAPI:{success:"[Start call API] Start call API success... ",failed:"[Start call API] Start call API failed...",init:"[Start call API] Start call API triggered..."},callState:{waitingForDevicePermission:"[Call State] Waiting for device permission",connected:"[Update Call State API triggered] Call state - Connected",failed:"[Update Call State API failed]",missedOnBusy:"[Update Call State API triggered] Call state - Missed On Busy",received:"[Update Call State API triggered] Call state - call received",collision:"[Update Call State API triggered] Call state - call collision"},streamRequest:{audio:"[Stream request] Audio Stream request initiated for audio call",video:"[Stream request] Video Stream request initiated for video call",success:"[Stream request completed] Stream request completed...",failed:"[Stream request failed] stream request failed...",screen:{initDuringCall:"[Stream request initiated] Screen stream request initiated during call",success:"[Stream request success] Screen stream request success",stopped:"[Stream request stopped] Screen stream request stopped"},screenWithAudio:{init:"[Stream request] ScreenShareWithAudioCall Stream request initiated for screen share with audiocall",audioFailedYetProceed:"[Stream request failed] Audio Stream request failed for screen share with audio call, but proceeding without audio",audioFailed:"[Stream request failed] Audio Stream request failed for screen share with audio call",audioSuccess:"[Stream request success] Audio Stream request success for screen share with audio call",audioInit:"[Stream request] Audio Stream request initiated for screen share with audio call",screenSuccess:"[Stream request success] Screen Stream request success for screen share with audio call",screenFailed:"[Stream request failed] Screen Stream request failed for screen share with audio call",screenStopped:"[Stream request stop] Screen Stream request stopped for screen share with audio call",screenInit:"[Stream request] Screen Stream request initiated for screen share with audio call - Caller"}},webrtc:{sendOfferFailedRetry:"[WebRTC] [Send Offer API failed] Retrying send offer...",sendOfferFailedCallEnded:"[WebRTC] [Send Offer API failed] Call already ended...",sendOffer:"[WebRTC] [Send Offer API triggered] Send Offer with sdp - ",sendAnswer:"[WebRTC] [Send Answer API triggered] Send Answer with sdp - ",answerWithSdpInit:"[WebRTC] [Answer-call API] Answer call API called with sdp - ",answerWithSdpFailed:"[WebRTC] [Answer-call API failed] Answer call API failed...",updateIce:"[WebRTC] [updateIceCandidates API triggered]",forceTurn:"[WebRTC] Force turn : ",reconnect:"[WebRTC] [Reconnect Handler trigered] ReconnectionId - ",reinit:"[WebRTC] [Reinit Handler triggered]",renegotiate:"[WebRTC] [Renegotiate Handler triggered]",addTrack:"[WebRTC] [Track Handler triggered] track - ",iceCandidateError:"[WebRTC] Ice Candidate error ",iceConnectionStateChange:"[WebRTC] IceConnection state change : ",iceGatheringStateChange:"[WebRTC] IceGathering state change : ",signalingStateChange:"[WebRTC] Signaling state change : ",connection:{disconnected:"[WebRTC] [RTC Connection Disconnected]",failed:"[WebRTC] [RTC Connection Failed]",success:"[WebRTC] [RTC Connection connected]",closed:"[WebRTC] [RTC Connection closed]",setBitrate:"[WebRTC] [Set Bitrate] Constant Bit rate of 1M"},requestAndAddTrackInStream:{success:"[WebRTC] [requestAndAddTrackInStream Success] success callback received",failed:"[WebRTC] [requestAndAddTrackInStream failed]",init:"[WebRTC] [requestAndAddTrackInStream] initiated"},requestAndReplaceTracksInStream:{success:"[WebRTC] [requestAndReplaceTracksInStream success]",init:"[WebRTC] [requestAndReplaceTracksInStream] initiated to replace track - "}},wms:{callInit:"[wmsEvent] [CALL_INITIATED]",callRequested:"[wmsEvent] [CALL_REQUESTED]",callReceived:"[wmsEvent] [CALL_RECEIVED]",callAnswered:"[wmsEvent] [CALL_ANSWERED]",callAnsweredAck:"[wmsEvent] [CALL_ANSWERED_ACK]",callConnected:"[wmsEvent] [CALL_CONNECTED]",callCanceled:"[wmsEvent] [CALL_CANCELED]",callDeclined:"[wmsEvent] [CALL_DECLINED]",callMissed:"[wmsEvent] [CALL_MISSED]",callBusy:"[wmsEvent] [CALL_MISSED_ON_BUSY]",callEnd:"[wmsEvent] [CALL_END]",offer:"[wmsEvent] [WebRTC] offer sdp received - ",answer:"[wmsEvent] [WebRTC] answer sdp received - ",iceCandidates:"[wmsEvent] [WebRTC] Ice-Candidates received - ",reinit:"[wmsEvent] [WebRTC] Reinit connection",renegotiate:"[wmsEvent] [WebRTC] Renegotiate connection",callHold:"[wmsEvent] [CALL_HOLD]",mediaSetting:"[wmsEvent] [MEDIA_SETTING] object - "},ui:{minCall:"[UI Event] Action triggered to minimize call",maxCall:"[UI Event] Action triggered to maximize call",micOn:"[UI Event] Action triggered to turn-on mic",micOff:"[UI Event] Action triggered to turn-off mic",camOn:"[UI Event] Action triggered to turn-on camera",camOff:"[UI Event] Action triggered to turn-off camera",answer:"[UI Event] Action triggered to answer incomming call",end:"[UI Event] Action triggered to end ongoing call",screen:"[UI Event] Action triggered to share screen",stopScreen:"[UI Event] Action triggered to stop screen-share",videoSwitch:"[UI Event] Action triggered to switch-to-video",videoSwitchDecline:"[UI Event] Action triggered to decline video-switch suggestion",newDeviceInfoShown:"[UI Event] New device added info shown",setMediaDevice:"[UI Event] Action triggered to set media devices"}},MediaCallConstants={MEDIA_PATH:"/thirdparty/media/",defaultCallId:"outgoingmediacall",customDomainPrefix:"/_avcliq",guestAPIPrefix:"/guestapi",fileNames:{INCOMING_TONE:"ringtone.mp3",WAITING_TONE:"waiting.mp3",RINGING_TONE:"feedback.mp3",RECONNECTING_TONE:"reconnect.mp3",CALL_END_TONE:"call_end.mp3"},baseUrl:"",setBaseUrl:function(){void 0!==MediaCall.BRIDGE.Constants&&(this.baseUrl=(MediaCall.BRIDGE.Constants.IS_CUSTOM_DOMAIN?this.customDomainPrefix:"")+(MediaCall.BRIDGE.Constants.IS_GUEST_USER?this.guestAPIPrefix:""))},requests:{applyPreviewVideoBackgroundEffect:1},callReceivedAckTimeLimt:3e4,callRingingTimeLimit:35e3,incomingCallTimeLimit:3e4,activeCallUpdateInterval:3e4,endCallUIRemovalInterval:1e4,callAnsweredDelayThreshold:2e3,LONG_POLLING_INTERVAL:2e3,INFO_MSG_MODE:"CALL_INFO",AV_VERSION_HEADER:"x-cliq-av",MULTIPLE_CALLS_HANDLING_TYPE_HEADER:"X-Multiple-Calls-Handling-Type",versionDirectives:{UPGRADE:"upgrade",DOWNGRADE:"downgrade"},multipleCallHandlingType:{VERIFY:"VERIFY",END_ACTIVE_CALLS:"END_ACTIVE_CALLS"},types:{AUDIO:"audio",VIDEO:"video",SCREEN_SHARE:"screen_share",SCREEN_SHARE_WITH_AUDIO:"screen_with_media"},request:{method:{GET:"GET",PUT:"PUT",POST:"POST"},status:{SUCCESS:"success",FAILED:"failed"}},states:{WAITING_FOR_PERMISSION:0,INITIATING:1,INCOMING:2,CALLING:3,RINGING:4,CONNECTING:5,CONNECTED:6,RECONNECTING:7,END:8,NO_RESPONSE:9,DECLINED:10,RECORDING:11,RECORDED:12,MIGRATING:13,MIGRATED:14,MISSED_ON_BUSY:15,RECORDING_PROCESSING:16,RECORDING_STARTED:17},logEvents:{GEO_NO_CANDIDATE:"GEO_NO_CANDIDATE",MAIN_NO_CANDIDATE:"MAIN_NO_CANDIDATE",BACKUP_NO_CANDIDATE:"BACKUP_NO_CANDIDATE",GEO_NO_CONNECT:"GEO_NO_CONNECT",MAIN_NO_CONNECT:"MAIN_NO_CONNECT",BACKUP_NO_CONNECT:"BACKUP_NO_CONNECT",MAIN_CONNECTED:"MAIN_CONNECTED",BACKUP_CONNECTED:"BACKUP_CONNECTED",LP_CONNECTED:"LP_CONNECTED",WS_DISCONNECT:"WS_DISCONNECT",NETWORK_POOR:"NETWORK_POOR",ANSWERED_ACK_DELAY:"ANSWERED_ACK_DELAY",WMS_RTT_POOR:"WMS_RTT_POOR"},ringingStates:{ringing:1,declined:-1,no_response:0,cancel_ringing:2},networkHealth:{EXCELLENT:4,GOOD:3,LOW:2,POOR:1,DEADZONE:0,getScore:function(e){return e>=5?this.EXCELLENT:4==e?this.GOOD:3==e?this.LOW:2==e||1==e?this.POOR:this.DEADZONE}},statusText:{CALL_INITIATED:"CALL_INITIATED",CALL_REQUESTED:"CALL_REQUESTED",CALL_RECEIVED:"CALL_RECEIVED",CALL_ANSWERED:"CALL_ANSWERED",CALL_ANSWERED_ACK:"CALL_ANSWERED_ACK",CALL_CONNECTED:"CALL_CONNECTED",CALL_ACTIVE:"CALL_ACTIVE",CALL_DECLINED:"CALL_DECLINED",CALL_CANCELLED:"CALL_CANCELED",CALL_MISSED:"CALL_MISSED",CALL_MISSED_ON_BUSY:"CALL_MISSED_ON_BUSY",CALL_MIGRATING:"CALL_MIGRATING",CALL_MIGRATED:"CALL_MIGRATED",CALL_END:"CALL_END",CALL_COLLISION:"CALL_COLLISION"},isCallInitiated:function(e){return e===this.statusText.CALL_INITIATED},isCallReceived:function(e){return e===this.statusText.CALL_RECEIVED},isCallRequested:function(e){return e===this.statusText.CALL_REQUESTED},isCallAnswered:function(e){return e===this.statusText.CALL_ANSWERED},isCallMissed:function(e){return e===this.statusText.CALL_MISSED},isCallMissedOnBusy:function(e){return e===this.statusText.CALL_MISSED_ON_BUSY},isCallDeclined:function(e){return e===this.statusText.CALL_DECLINED},isCallCancelled:function(e){return e===this.statusText.CALL_CANCELLED},isCallMigrating:function(e){return e===this.statusText.CALL_MIGRATING},isCallMigrated:function(e){return e===this.statusText.CALL_MIGRATED},isCallEnded:function(e){return e===this.statusText.CALL_END}},MediaCall=function(){var e=!1,t=!1;return{BRIDGE:void 0,serverUpCallBack:void 0,setClientBridge:function(e){this.BRIDGE=e},getCurrentUserId:function(){return void 0!==MediaCall.BRIDGE?MediaCall.BRIDGE.Constants.ZUID:void 0},_isInitialized:function(){return t},isInitialized:function(){return void 0!==this.BRIDGE&&this.BRIDGE.isInitialized()},isForceTurnEnabled:function(){return void 0!==this.BRIDGE&&this.BRIDGE.isForceTurnEnabled()},isNetworkIndicatorEnabled:function(){return void 0!==this.BRIDGE&&this.BRIDGE.isNetworkIndicatorEnabled()&&this.isCallStrengthAnalysisSupported()},isReconnectOnConnectionTimeoutEnabled:function(e){return void 0!==e&&e.isInitialReconnectionSupported()},isStereoEnabled:function(){return!0},isNoCamOrMicEnabled:function(e){return void 0!==e&&e.isTrackRenegotiationSupported()},isCallCollisionHandlingEnabled:function(){return void 0!==this.BRIDGE&&this.BRIDGE.isCallCollisionHandlingEnabled()},isAdhocCallConversionEnabled:function(){return void 0!==this.BRIDGE&&this.BRIDGE.isAdhocCallConversionEnabled()},isDeviceChangeListenerEnabled:function(){return void 0!==this.BRIDGE&&this.BRIDGE.isDeviceChangeListenerEnabled()},isLongPollingEnabled:function(){return!0},isRecordingAllowed:function(){return void 0!==this.BRIDGE&&this.BRIDGE.isAVRecordingEnabled()&&!this.BRIDGE.Constants.IS_GUEST_USER},isMultipleCallHandlingEnabled:function(){return void 0!==this.BRIDGE&&this.BRIDGE.isMultipleCallHandlingEnabled()},isVideoEffectsEnabled:function(){return void 0!==this.BRIDGE&&this.BRIDGE.isVideoEffectsEnabled()},isVideoEffectsSettingsEnabled:function(){return void 0!==this.BRIDGE&&this.BRIDGE.isVideoEffectsSettingsEnabled()},isCallStrengthAnalysisSupported:function(){return!($ZCUtil.Browser.isSafari()||$ZCUtil.Browser.isFirefox())},isAudioOrVideoCallAllowed:function(){return this.isAudioCallAllowed()||this.isVideoCallAllowed()},isAudioCallAllowed:function(){return void 0!==this.BRIDGE&&this.BRIDGE.isAudioCallAllowed()},isVideoCallAllowed:function(){return void 0!==this.BRIDGE&&this.BRIDGE.isVideoCallAllowed()},isScreenShareAllowed:function(){return void 0!==this.BRIDGE&&this.BRIDGE.isScreenShareAllowed()},isScreenShareWithAudioCallAllowed:function(){return void 0!==this.BRIDGE&&this.BRIDGE.isScreenShareWithAudioCallAllowed()},isNotebookIntegrationSupported:function(){return void 0!==this.BRIDGE&&this.BRIDGE.isNotebookIntegrationSupported()},isWhiteBoardAllowed:function(e){return void 0!==this.BRIDGE&&this.BRIDGE.isWhiteBoardAllowed()&&void 0!==e&&e.isWhiteBoardSupported()},isNewAVDomainRoutingEnabled:function(){return void 0!==this.BRIDGE&&this.BRIDGE.isNewAVDomainRoutingEnabled()&&!this.BRIDGE.Constants.IS_GUEST_USER},isDesktopApp:function(){return void 0!==this.BRIDGE&&this.BRIDGE.isDesktopApp},isAudioCall:function(e){return MediaCallConstants.types.AUDIO===e},isVideoCall:function(e){return MediaCallConstants.types.VIDEO===e},isScreenShareWithAudioCall:function(e){return MediaCallConstants.types.SCREEN_SHARE_WITH_AUDIO===e},isScreenShare:function(e){return MediaCallConstants.types.SCREEN_SHARE===e},isDirectCall:function(e){return this.isAudioCall(e)||this.isVideoCall(e)||this.isScreenShare(e)||this.isScreenShareWithAudioCall(e)},initialize:function(i,a){this.isInitialized()?"function"==typeof i&&i():MediaCallInterface.Validator.isEnabled()?MediaManager.initialize((function(){if(MediaCallInterface.isSupported()){if(e)return;e=!0,$ZCUtil.loadMultipleFiles("script",$zcg._VIDEOCHATPROPS.MEDIACALL_JS_LIST,(function(){t=!0,e=!1,MediaCallInterface.initialize(),"function"==typeof i&&i()}))}})):"function"==typeof a&&a()},convertLiveFeedToCall:function(e,t,i,a,n){var s=new MediaCallSession({call_id:MediaCallConstants.defaultCallId,type:e,chat_id:i,caller_id:$zcg._ZUID,callee_id:t,status_text:MediaCallConstants.statusText.CALL_INITIATED});void 0!==n&&(s.setAssociatedLiveFeedId(n),LiveFeedImpl.getIncomingFeedSession(n).setAssociatedCallId(s.getId()));MediaCall.initiateCallProcess(s,a)},initiateStartCallProcess:function(e,t,i,a){MediaCallImpl.syncPreferredDevices(function(){MediaCall.initiateCallProcess(new MediaCallSession({call_id:MediaCallConstants.defaultCallId,type:e,chat_id:i,caller_id:MediaCall.BRIDGE.Constants.ZUID,callee_id:t,status_text:MediaCallConstants.statusText.CALL_INITIATED}),a)}.bind(this))},initiateCallProcess:function(e,t){if(e.writeToLog(CallLogConstants.sessionId+MediaCall.BRIDGE.getSid()+"  "+CallLogConstants.rawSessionID+MediaCall.BRIDGE.getRawSid()),e.writeToLog(e.getType()+CallLogConstants.callStart+t),e.writeToLog(CallLogConstants.mediaSessionObject,MediaCallImpl.getLoggableSessionObject(e)),this.isInitialized()&&!MediaManager.isStreamRequested()&&!MediaManager.isRequestPending()&&!MediaCallImpl.hasOutgoingSession()){var i=e.isCaller(MediaCall.BRIDGE.Constants.ZUID),a=i&&(e.isScreenShareWithAudioCall()||e.isScreenShare());if(!a||!MediaCall.BRIDGE.Util.Browser.isChrome()||WebRTCUserMedia.isScreenShareSupportedInNative()||ScreenShare.Extension.isInstalled()){if(MediaCall.isCallCollisionHandlingEnabled()){var n=MediaCallImpl.getCurrentIncomingSession();if(void 0!==n&&n.getCallerId()===e.getCalleeId()&&n.getOtherMember().getClientSupport().call_collision_handling&&!n.isInCallAnsweredState())return void MediaCallUI.answerCall(n.getId(),MediaCall.isVideoCall(e.getType())?"audio_video":"audio")}e.writeToLog(CallLogConstants.existingSessionCheck),MediaManager.handleExistingSessions(function(){e.writeToLog(CallLogConstants.existingSessionCheckSuccess);var n=i?"START_CALL":"ANSWER_CALL",s={type:e.getType(),source:t,client:_isZCDesktopApp()?"Desktop":"Web"};i&&(e.writeToLog(CallLogConstants.callUIShown),MediaCallImpl.setOutgoingSession(e),MediaCallUI.showCallUI(e,!0)),e.writeToLog(CallLogConstants.callState.waitingForDevicePermission),MediaCallUI.adaptUIToState(e,MediaCallConstants.states.WAITING_FOR_PERMISSION);var o=function(){MediaManager.setRequestCompleted(),e.writeToLog(CallLogConstants.getMediaDevicesSuccess);var t=function(t,a){if(e.writeToLog(CallLogConstants.streamRequest.success),MediaManager.resetStreamRequested(),i&&!MediaCallImpl.hasOutgoingSession()||!i&&void 0===MediaCallImpl.getFromIncomingSessions(e.getId()))return void 0!==t&&WebRTCUserMedia.closeStream(t._getType()),void(void 0!==a&&WebRTCUserMedia.closeStream(a._getType()));var o=e.getCurrentMember();if(o.setAVUpStream(t),o.setScreenUpStream(a),void 0!==t){var r=MediaCallUI.getVideoContainer(e.getId(),o.getId()),l=MediaCallUI.getMediaCallWrapper(e.getId());MediaUtil.setStreamInContainer(o.getId(),r,t,(function(){WebRTCUserMedia.isAudioVideoStreamType(t._getType())&&l.find("[videowrapper]").addClass("AV-call-preview")}))}void 0!==a&&a._getPrimaryVideoTrack().applyConstraints({frameRate:{min:15,max:15}}).catch(),e.setMultipleCallsHandlingType(MediaCallConstants.multipleCallHandlingType.VERIFY),i?MediaCallImpl.startCall(e):MediaCallImpl.answerCall(e),void 0!==MediaCall.BRIDGE.Tracker&&MediaCall.BRIDGE.Tracker.track(n+"_INITIATED",s)},a=function(t,a){e.writeToLog(CallLogConstants.streamRequest.failed),e.isLiveFeedAssociated()&&LiveFeedHandler.callEvents.handlEnd(e),MediaCallImpl.clearOutgoingSession(),i&&MediaCallUI.removeCallUI(e),MediaManager.handleMediaError(t,a),MediaManager.resetStreamRequested()};if(e.isAudioCall()||!i&&e.getCurrentMember().isVideoCallWithoutVideo())e.writeToLog(CallLogConstants.streamRequest.audio),WebRTCUserMedia.requestAudioStream(t,a),MediaManager.setAsStreamRequested(WebRTCUserMedia.streamTypes.AUDIO_ONLY);else if(e.isVideoCall()){e.writeToLog(CallLogConstants.streamRequest.video),WebRTCUserMedia.requestAudioVideoStream(t,(function(n,s){if(!i)return e.writeToLog(CallLogConstants.streamRequest.failed),MediaManager.resetStreamRequested(),WebRTCUserMedia.requestAudioStream(t,a),MediaManager.setAsStreamRequested(WebRTCUserMedia.streamTypes.AUDIO_ONLY),void e.getCurrentMember().setVideoCallWithoutVideo();a(n,s)}),void 0,MediaUtil.getVideoEffects()),MediaManager.setAsStreamRequested(WebRTCUserMedia.streamTypes.AUDIO_VIDEO)}else if(e.isScreenShareWithAudioCall()){e.writeToLog(CallLogConstants.streamRequest.screenWithAudio.init);var o=function(i){e.writeToLog(CallLogConstants.streamRequest.screenWithAudio.audioInit),WebRTCUserMedia.requestAudioStream((function(a){e.writeToLog(CallLogConstants.streamRequest.screenWithAudio.audioSuccess),t(a,i)}),(function(a,n){e.getCurrentMember().setScreenShareWithoutAudio(),e.writeToLog(CallLogConstants.streamRequest.screenWithAudio.audioFailedYetProceed),t(void 0,i)})),MediaManager.setAsStreamRequested(WebRTCUserMedia.streamTypes.AUDIO_ONLY)};if(i){e.writeToLog(CallLogConstants.streamRequest.screenWithAudio.screenInit),WebRTCUserMedia.requestScreenStream((function(t){e.writeToLog(CallLogConstants.streamRequest.screenWithAudio.screenSuccess),MediaManager.resetStreamRequested();var i=function(){o(t)};WebRTCUserMedia.getMediaDevices(i,i)}),(function(t,i){e.writeToLog(CallLogConstants.streamRequest.screenWithAudio.screenFailed),a(t,i)}),(function(){var e=MediaCallImpl.hasOutgoingSession()?MediaCallImpl.getOutgoingSession():MediaCallImpl.getCurrentSession();e&&(e.writeToLog(CallLogConstants.streamRequest.screenWithAudio.screenStopped),e.isInCallAnsweredState()?MediaCallHandler.UIEvents.stopScreenShare():MediaCallImpl.handleEnd(e.getId(),!0))})),MediaManager.setAsStreamRequested(WebRTCUserMedia.streamTypes.SCREEN)}else o()}else i?(e.writeToLog(CallLogConstants.streamRequest.init),WebRTCUserMedia.requestScreenStream(t,a),MediaManager.setAsStreamRequested(WebRTCUserMedia.streamTypes.SCREEN)):t();void 0!==MediaCall.BRIDGE.Tracker&&MediaCall.BRIDGE.Tracker.track(n+"_TRIGGERED",s)};e.writeToLog(CallLogConstants.getMediaDevicesInit),a?o():(MediaManager.setRequestPending({module:ZCMediaConstants.sessionTypes.CALLS,request_type:ZCMediaConstants.requestTypes.DEVICES}),WebRTCUserMedia.getMediaDevices(o,o))}.bind(this))}else MediaManager.showExtensionInstallPreview("mediacallbuttons")}},isCurrentChat:function(e){return!!this.isInitialized()&&MediaCallUI.isCurrentChat(e)},setUnreadMessageCount:function(e,t){this.isInitialized()&&MediaCallUI.setUnreadMessageCount(e,t)},handleChatWindowCreated:function(e){this.isInitialized()&&MediaCallUI.handleChatWindowCreated(e)},handleChatWindowClosed:function(e){this.isInitialized()&&MediaCallUI.handleChatWindowClosed(e)},handleGetMeFront:function(e){this.isInitialized()&&MediaCallUI.handleGetMeFront(e)},handleResize:function(){this.isInitialized()&&MediaCallUI.handleResize()},clearAllSessions:function(){if(this.isInitialized()&&(MediaCallImpl.hasCurrentSession()&&MediaCallImpl.handleEnd(MediaCallImpl.getCurrentSession().getId(),!0,{playEndTone:!0}),MediaCallImpl.hasOutgoingSession()&&MediaCallImpl.handleEnd(MediaCallImpl.getOutgoingSession().getId(),!0),MediaCallImpl.hasCurrentIncomingSession())){var e=MediaCallImpl.getAllIncomingSessions();for(var t in e)MediaCallImpl.handleEnd(e[t].getId(),!1)}},handleWmsConnectionStatus:function(e){e&&"function"==typeof serverUpCallBack&&(serverUpCallBack(),serverUpCallBack=void 0)},handleIncomingCalls:function(){if(this.isInitialized()){var e=function(){var e=MediaCall.BRIDGE.getIncomingCalls();if(void 0!==e&&!$WC.Util.isEmptyObject(e))for(var t in e){var i=e[t],a=i.status_text,n=MediaCall.BRIDGE.Util.getSyncedCurrentTime()-new Date(parseInt(i.start_time));if(("CALL_REQUESTED"===a||"CALL_RECEIVED"===a)&&n<MediaCallConstants.callRingingTimeLimit)return void MediaCallHandler.wmsEvents.CALL_REQUESTED({data:i})}};MediaCall.BRIDGE.isWMSConnected()?e():serverUpCallBack=e}},handleUnload:function(){this.clearAllSessions()},handleEscape:function(){return!!this.isInitialized()&&MediaCallUI.handleEscape()},startPushToTalk:function(){return!(!this.isInitialized()||!MediaCallImpl.hasCurrentSession())&&MediaCallImpl.startPushToTalk()},stopPushToTalk:function(){return!(!this.isInitialized()||!MediaCallImpl.hasCurrentSession())&&MediaCallImpl.stopPushToTalk()}}}();var MediaCallUI={},MediaCallImpl={},MediaCallAPI={},MediaCallNetworkPredictorImpl={},MediaCallNetworkPredictor={},LongPollingController={},MediaCallIframeHandler={};MediaCallUI={DETACHED_CONTAINER_ADJUST_WIDTH:20,windowActiveTimeout:void 0,windowActiveTimoutDuration:4e3,_endCallTimers:{},bindEvents:function(){ZCJQuery(document).on("click","[mediacallbuttons]",(function(e){Clickoutside.handleClick(e),e.stopPropagation();var t=ZCJQuery(this),i=t.attr("purpose");MediaCallHandler.UIEvents[i](e,t)})),ZCJQuery(document).on("keydown","[mediacallinput]",(function(e){var t=ZCJQuery(this),i=t.attr("inputname");13==e.keyCode&&("rejectTextBox"===i?MediaCallHandler.UIEvents.sendCustomRejectMessage(e,t):"adhoccalltitle"===i&&MediaCallHandler.UIEvents.ringAllParticipants())})),ZCJQuery(document).on("input","[mediacallinput]",(function(e){var t=ZCJQuery(this),i=t.attr("inputname");"rejectTextBox"===i?MediaCallHandler.UIEvents.handleRejectMessageInput(e,t):"adhoccalltitle"===i&&MediaCallHandler.UIEvents.handleAdhocCallInputs()})),ZCJQuery(document).on("mousemove","[mediacallfullscreenwindow]",(function(e){clearTimeout(MediaCallUI.windowActiveTimeout);var t=ZCJQuery(this).addClass("AV-call-window-active");MediaCallUI.windowActiveTimeout=setTimeout((function(){t.removeClass("AV-call-window-active")}),MediaCallUI.windowActiveTimoutDuration)})),ZCJQuery(document).on("change",'[mediacallcheckbox][type="checkbox"]',(function(e){e.stopPropagation();var t=ZCJQuery(this),i=t.attr("purpose");MediaCallHandler.UIToggleEvents[i](e,t)}))},isCurrentChat:function(e){return ZCJQuery("#mediacallchatsection").find("#"+e).length>0},isInFullScreenView:function(e){return e.hasClass("AV-call-fullscrn")},isInMinimizedView:function(){var e=MediaCallImpl.getCurrentSession();return e&&!e.isMigratedCall()&&!MediaCallUI.isInFullScreenView(MediaCallUI.getMediaCallWrapper(e.getId()))},isInDetachedView:function(e){return MediaCall.BRIDGE.isContainerDeatchOnMinimizeDisabled()?void 0!==e.parents("#mediacall_container").attr("detached"):e.parents("#mediacalldetachedwrapper").length>0},isInAudioLayout:function(e){return e.hasClass("AV-call-audio-only")},isInInitialLayout:function(e){return e.hasClass("AV-call-initial")},isRHSOpened:function(e){return e.hasClass("show-aside")},getMediaCallWrapper:function(e){return ZCJQuery('[mediacallwrapper][callId="'+e+'"]')},getVideoContainer:function(e,t){return this.getMediaCallWrapper(e).find('[videocontainer][userId="'+t+'"]')},deleteMediaContainers:function(e){this.getMediaCallWrapper(e).find("[screencontainer], [videocontainer]").each((function(){var e=ZCJQuery(this);MediaUtil.removeVideoElemsStreamInContainer(e),e.remove()}))},getScreenContainer:function(e,t){return this.getMediaCallWrapper(e).find('[screencontainer][userId="'+t+'"]')},addAndGetScreenContainer:function(e,t){var i=this.getScreenContainer(e,t);if(!i.length){var a=MediaCallTemplates.getScreenVideoContainerHtml(t,MediaCall.BRIDGE.Users.getName(t)),n=this.getMediaCallWrapper(e);this.handleSwitchToVideoLayout(),n.removeClass("AV-call-audio-only").addClass("AV-call-audiovideo");var s=n.find("[screenvideowrapper]");s.addClass("AV-call-subview-2").append(a),i=this.getScreenContainer(e,t),MediaCallHandler.UIEvents.switchView(void 0,s),this.adjustCallContainerHeight(n)}return i},getWhiteBoardContainer:function(e){return this.getMediaCallWrapper(e).find("[whiteboardcontainer]")},addAndGetWhiteBoardContainer:function(e,t){var i=this.getWhiteBoardContainer(e);if(!i.length){var a=MediaCallTemplates.getWhiteBoardContainerHtml("WhiteBoard",t),n=this.getMediaCallWrapper(e);this.handleSwitchToVideoLayout(),n.removeClass("AV-call-audio-only").addClass("AV-call-audiovideo");var s=n.find("[wbwrapper]");s.addClass("AV-call-subview-2 wh100").append(a),i.addClass("w100 h90"),MediaCallHandler.UIEvents.switchView(void 0,s),i=this.getWhiteBoardContainer(e),MediaCallHandler.UIEvents.maximizeWindow(),$Util.animateBufferLoader(i.find("[bufferloadercnt]"),9)}var o=t&&t.hasWhiteBoard()?t.getCurrentWhiteBoardId():"",r=t&&t.hasWhiteBoard()?WhiteBoard.getBoardURL(o,t.getId()):"";if(r){var l=i.find("iframe")[0];l.setAttribute("data-uid",o),l.onload=function(){i.find("[bufferloadercnt]").empty(),ZCJQuery(l).removeClass("vsbH"),WhiteBoard.setUpWhiteBoardBridge(l)},l.src=r}return i},removeWhiteBoardContainer:function(e){var t=this.getWhiteBoardContainer(e.getId());if(t.length){var i=this.getMediaCallWrapper(e.getId()),a=i.find("[wbwrapper]");if(a.hasClass("AV-call-mainview")?(MediaCallHandler.UIEvents.switchView(void 0,i.find(".AV-call-subview-2")),a.removeClass("AV-call-subview-2")):a.hasClass("AV-call-subview")?(i.find(".AV-call-subview-2").removeClass("AV-call-subview-2").addClass("AV-call-subview"),a.removeClass("AV-call-subview")):a.hasClass("AV-call-subview-2")&&a.removeClass("AV-call-subview-2"),a.removeClass("wh100"),a.find("[videocontainer]").remove(),t.remove(),e.isAudioLayoutRequired()&&!e.getCurrentMember().hasSwitchedToVideo()&&!e.getOtherMember().hasSwitchedToVideo()){MediaCallUI.isInFullScreenView(i)&&MediaCallHandler.UIEvents.minimizeWindow(void 0,i.find('[mediacallbuttons][purpose="minimizeWindow"]')),i.removeClass("AV-call-audiovideo").addClass("AV-call-audio-only");var n=ZCJQuery("#mediacall_container");n.removeResizable(),n.addClass("AV-call-audio-only-wrapper").css("width",""),n.removeClass("AV-call-audiovideo-wrapper")}this.adjustCallContainerHeight(i)}},removeScreenContainer:function(e,t){var i=this.getScreenContainer(e.getId(),t);if(i.length){var a=this.getMediaCallWrapper(e.getId()),n=a.find("[screenvideowrapper]");if(n.hasClass("AV-call-mainview")?(MediaCallHandler.UIEvents.switchView(void 0,a.find(".AV-call-subview-2")),n.removeClass("AV-call-subview-2")):n.hasClass("AV-call-subview")?(a.find(".AV-call-subview-2").removeClass("AV-call-subview-2").addClass("AV-call-subview"),n.removeClass("AV-call-subview")):n.hasClass("AV-call-subview-2")&&n.removeClass("AV-call-subview-2"),MediaUtil.removeVideoElemsStreamInContainer(i),i.remove(),e.isAudioLayoutRequired()&&!e.getCurrentMember().hasSwitchedToVideo()&&!e.getOtherMember().hasSwitchedToVideo()){MediaCallUI.isInFullScreenView(a)&&MediaCallHandler.UIEvents.minimizeWindow(void 0,a.find('[mediacallbuttons][purpose="minimizeWindow"]')),a.removeClass("AV-call-audiovideo").addClass("AV-call-audio-only");var s=ZCJQuery("#mediacall_container");s.removeResizable(),s.addClass("AV-call-audio-only-wrapper").css("width",""),s.removeClass("AV-call-audiovideo-wrapper"),this.setContainerPosition(s,this.DETACHED_CONTAINER_ADJUST_WIDTH)}this.adjustCallContainerHeight(a)}},showCallUI:function(e,t){var i=ZCJQuery(MediaCallTemplates.getMainUIHtml(e));e.isVideoCall()&&i.find(".AV-call-video-muted").removeClass("AV-call-video-muted"),this.setCallUIInChatorBody(e,i,t),MediaCall.BRIDGE.setZIndex(i.find("[mediacallwrapper]"))},setCallUIInChatorBody:function(e,t,i){var a=e.getChatId();if(void 0===a){var n=MediaCallImpl.getRecipiantChatIdIfOpen(e.getOtherMemberId());void 0!==n&&(a=n,e.setChatId(a))}i&&void 0!==a&&"function"==typeof MediaCall.BRIDGE.handleChatMount?MediaCall.BRIDGE.handleChatMount(!0,t,a,e.getOtherMemberId()):"function"==typeof MediaCall.BRIDGE.handleChatMount?MediaCall.BRIDGE.handleChatMount(!1,t,a,e.getOtherMemberId()):this.setCallUIInBody(t)},showSwitchToVideoInfo:function(e){0===e.find("[switchnotifycnt]").length&&e.append(MediaCallTemplates.getSwitchNotifyCntHtml()),ZCJQuery("#mediacall_container").addClass("AV-call-main-switch-wrapper")},removeSwitchToVideoInfo:function(e){this.getMediaCallWrapper(e.getId()).find("[switchnotifycnt]").remove(),ZCJQuery("#mediacall_container").removeClass("AV-call-main-switch-wrapper")},removeShareOptionsDropDown:function(e){var t=e+"shrdropdowncnt";this.getMediaCallWrapper(e).find('[mediacallbuttons][purpose="shareOptions"]').removeClass("AV-call-active"),ZCJQuery("#"+t).remove(),Clickoutside.clear(t)},removeMoreOptionsDropDown:function(e){var t=e+"dropdowncnt";this.getMediaCallWrapper(e).find('[mediacallbuttons][purpose="showMoreOptions"]').removeClass("AV-call-active"),ZCJQuery("#"+t).remove(),Clickoutside.clear(t)},resetScreenShareOption:function(){var e=ZCJQuery('[mediacallbuttons][purpose="stopScreenShare"]');e.length&&(e.attr("purpose","startScreenShare").removeClass("AV-call-selected"),e.find("[icon]").removeClass("zcf-scrn-shr-stop").addClass("zcf-sharescrn"),e.find("[content]").text(MediaCall.BRIDGE.Resource.getRealValue("media.screenshare.start")))},adaptEndCallUIToState:function(e,t){var i=this.getMediaCallWrapper(e);if(t===MediaCallConstants.states.WAITING_FOR_PERMISSION)i.find("[statuscontent]").text(MediaCall.BRIDGE.Resource.getRealValue("videochat.waiting.permission"));else if(t===MediaCallConstants.states.RECORDING){var a=$WC.template.replace('<span statusmessage>{{call_state}}</span><span id="{{recording_timer}}"></span>',{recording_timer:ZCMediaRecorderImpl.getRecorderSessionTimerId(e),$call_state:"mediarecorder.recording"});i.find("[statuscontent]").html(a)}else t===MediaCallConstants.states.RECORDED&&i.find("[statusmessage]").text(MediaCall.BRIDGE.Resource.getRealValue("mediarecorder.recorded"))},adaptUIToState:function(e,t){var i=this.getMediaCallWrapper(e.getId()),a=i.find("[statuscontent]"),n="";if(t===MediaCallConstants.states.WAITING_FOR_PERMISSION)n="videochat.waiting.permission";else if(t===MediaCallConstants.states.INITIATING)n="mediacall.state.initiating";else if(t===MediaCallConstants.states.CALLING)n="videochat.message.calling";else if(t===MediaCallConstants.states.RINGING)n="videochat.message.ringing";else if(t===MediaCallConstants.states.NO_RESPONSE)n="mediacall.state.noresponse";else if(t===MediaCallConstants.states.DECLINED)n="mediacall.state.declined";else if(t===MediaCallConstants.states.MISSED_ON_BUSY)n="mediacall.state.missedonbusy";else if(t===MediaCallConstants.states.CONNECTING){n="common.connecting";var s=$WC.template.replace('<div class="AV-call-box zcf-audio AV-call-box-end zc-av-mL0" title="{{title}}" mediacallbuttons purpose="endCall"></div>',{$title:"videochat.endcall"});i.find("[incomingcalloptions]").html(s)}else if(t===MediaCallConstants.states.RECONNECTING)a=i.find("[topstatuscnt]"),i.addClass("AV-call-reconnect"),n="videochat.message.reconnect";else if(t===MediaCallConstants.states.MIGRATING)i.addClass("AV-call-migrating"),a=i.find("[adhoccallstatus] [statustext]"),n="mediacall.state.migrating";else if(t===MediaCallConstants.states.RECORDING_PROCESSING)i.addClass("AV-call-migrating"),a=i.find("[adhoccallstatus] [statustext]"),n="mediacall.state.recording.initiate";else if(t===MediaCallConstants.states.CONNECTED){i.removeClass("AV-call-reconnect"),MediaCallUI.removeRejectMessageDialog(e.getId()),MediaCall.isNetworkIndicatorEnabled()&&ZCJQuery(MediaCall.BRIDGE.isContainerDeatchOnMinimizeDisabled()?"#mediacall_container":"#mediacalldetachedwrapper").addClass("AV-health-meter");var o=i.find("[initialcontainer]");if(o.length){i.find("[impulsecontainer]").remove(),o.remove();var r=e.isAudioLayoutRequired()?"AV-call-audio-only":"AV-call-audiovideo";i.removeClass("AV-call-initial").addClass(r),"AV-call-audio-only"===r&&ZCJQuery("#mediacall_container").addClass("AV-call-audio-only-wrapper"),i.find("[maincontainer]").append(MediaCallTemplates.getOptionsHtml(e)),"AV-call-audiovideo"===r&&this.handleSwitchToVideoLayout(),this.isInDetachedView(i)&&this.setContainerPosition(i.parent(),this.DETACHED_CONTAINER_ADJUST_WIDTH),this.adjustCallContainerHeight(i)}}var l=i.find("[username]");$WC.Util.isEmpty(l.text())&&l.text(e.getOtherMember().getName()),$WC.Util.isEmpty(n)||a.text(MediaCall.BRIDGE.Resource.getRealValue(n)),e.isLiveFeedAssociated()&&LiveFeedHandler.callEvents.adaptUIToState(e,t)},setCallUIInChat:function(e,t){var i=e.find('[mediacallbuttons][purpose="setCallUIInChat"]');i.length&&(i.attr("purpose","setCallUIInBody"),i.find("[icon]").removeClass("zcf-chat").addClass("zcf-mini-player"),i.find("[content]").text(MediaCall.BRIDGE.Resource.getRealValue("mediacall.chat.detach")));var a=ChatUI.exist[t];MainUI.getMefront(t,!0),0===a.win().find("[mediacallwrapper]").length&&(a.win().find("#compcontainer").before(e),a.retainScrollPosition(),this.adjustCallContainerHeight(e))},setCallUIInBody:function(e){var t=e.find("#"+e.attr("callId")+"dropdowncnt"),i=MediaCall.BRIDGE.Constants.IS_GUEST_USER?"#guest_chat_main":"body";if(t.length){var a=t.find('[mediacallbuttons][purpose="setCallUIInBody"]');a.length&&(a.attr("purpose","setCallUIInChat"),a.find("[icon]").removeClass("zcf-mini-player").addClass("zcf-chat"),a.find("[content]").text(MediaCall.BRIDGE.Resource.getRealValue("mediacall.chat.attach")))}if(MediaCall.BRIDGE.isContainerDeatchOnMinimizeDisabled()){(n=ZCJQuery("#mediacall_container")).length?(n.addClass("AV-call-detached"),n.attr("detached","")):(n=e,void 0!==MediaCall.BRIDGE&&"function"==typeof MediaCall.BRIDGE.handleBodyMount?MediaCall.BRIDGE.handleBodyMount(n):ZCJQuery(i).append(n),e=n.find("[mediacallwrapper]"))}else{var n;if((n=ZCJQuery("#mediacalldetachedwrapper")).length)return void(0===n.find("[mediacallwrapper]").length&&(n.append(e),this.adjustCallContainerHeight(e),this.setContainerPosition(n,this.DETACHED_CONTAINER_ADJUST_WIDTH),t.length&&this.setContainerPositionClass(t)));(n=ZCJQuery('<div id="mediacalldetachedwrapper" class="AV-call-detached"></div>')).append(e)}n.setAsDraggable({ondragend:function(e){MediaCallUI.handleDragEnd(e)},areaToBeVisible:ZCMediaConstants.minimizedWindowRange.visibleArea}),MediaCall.BRIDGE.isContainerDeatchOnMinimizeDisabled()||(void 0!==MediaCall.BRIDGE&&"function"==typeof MediaCall.BRIDGE.handleBodyMount?MediaCall.BRIDGE.handleBodyMount(n):ZCJQuery(i).append(n)),this.adjustCallContainerHeight(e),this.setContainerPosition(n,this.DETACHED_CONTAINER_ADJUST_WIDTH),t.length&&this.setContainerPositionClass(t)},unsetDraggableOnMaximize:function(){var e=ZCJQuery("#mediacall_container");e.removeClass("AV-call-detached"),e.removeAttr("detached"),e.setAsNonDraggable()},getViewContainers:function(e){return MediaCallUI.getMediaCallWrapper(e).find('[purpose="switchView"]')},isInSubView:function(e){return e.hasClass("AV-call-subview")||e.hasClass("AV-call-subview-2")},getVideoOrScreenContainer:function(e){var t=e.find("[videocontainer]");return t.length>0?t:e.find("[screencontainer]")},isContainerDraggable:function(e){return e.hasClass("ZCdrag")},makeFullScreenVideosDraggable:function(e){for(var t=this.getViewContainers(e),i=0;i<t.length;i++){var a=ZCJQuery(t[i]);if(this.isInSubView(a)){var n=a.find("[tempvideocontainer]");this.isContainerDraggable(n)||n.setAsDraggable({areaToBeVisible:ZCMediaConstants.miniVideoElemVisibleArea}),n.append(this.getVideoOrScreenContainer(a))}}},resetFullScreenVideosDraggable:function(e){for(var t=this.getViewContainers(e),i=0;i<t.length;i++){var a=ZCJQuery(t[i]);this.isInSubView(a)&&a.append(this.getVideoOrScreenContainer(a.find("[tempvideocontainer]")))}},handleViewSwitch:function(e,t,i){var a=e.find(".AV-call-mainview"),n=a.find("[tempvideocontainer]");n.css(t.find("[tempvideocontainer]").position()),a.removeClass("AV-call-mainview").addClass(i),t.removeClass(i).addClass("AV-call-mainview"),MediaCallUI.isInFullScreenView(e)&&(t.append(this.getVideoOrScreenContainer(t.find("[tempvideocontainer]"))),this.isContainerDraggable(n)||n.setAsDraggable({areaToBeVisible:ZCMediaConstants.miniVideoElemVisibleArea}),n.append(this.getVideoOrScreenContainer(a)))},setContainerPosition:function(e,t){var i=e.width(),a=e.height();t&&(i+=t);var n=e.offset().left,s=e.offset().top,o=ZCJQuery(window),r=o.width(),l=o.height();n+i>r&&e.css("left",r-i),s+a>l&&e.css("top",l-a)},setContainerPositionClass:function(e){var t=e.offset();t.left+e.width()>ZCJQuery(window).width()&&e.addClass("ZC-left"),t.top<0&&e.removeClass("ZC-top").addClass("ZC-bottom"),t.top+e.height()>ZCJQuery(window).height()&&e.removeClass("ZC-bottom").addClass("ZC-top")},openChatInRHS:function(e){if(MediaCallImpl.hasCurrentSession()){var t=this.getMediaCallWrapper(MediaCallImpl.getCurrentSession().getId());this.isInFullScreenView(t)&&(MediaCallImpl.attachChat(e),ZCJQuery('[mediacallbuttons][purpose="openChatInRHS"]').attr({purpose:"closeChatInRHS",title:MediaCall.BRIDGE.Resource.getRealValue("common.hide")}).addClass("AV-call-active"),t.addClass("show-aside"))}},closeChatInRHS:function(){if(MediaCallImpl.hasCurrentSession()){var e=this.getMediaCallWrapper(MediaCallImpl.getCurrentSession().getId());this.isInFullScreenView(e)&&(ZCJQuery('[mediacallbuttons][purpose="closeChatInRHS"]').attr({purpose:"openChatInRHS",title:MediaCall.BRIDGE.Resource.getRealValue("common.chat")}).removeClass("AV-call-active"),e.removeClass("show-aside"))}},setUnreadMessageCount:function(e,t){if(MediaCallImpl.hasCurrentSession()&&(MediaCallImpl.setChatIdForMediaCallSession(e),MediaCallImpl.isValidChatForCurrentSession(e))){var i=ZCJQuery("[mediacallunreadmsgcount]");t?i.text(t).show():i.hide().empty()}},handleGetMeFront:function(e){if(MediaCallImpl.hasCurrentSession()){var t=MediaCallImpl.getCurrentSession(),i=this.getMediaCallWrapper(t.getId());if(0!==i.length){this.adjustCallContainerHeight(i),t.hasChatId()&&e!==t.getChatId()&&(MainUI.isChatinViewport(t.getChatId())||this.isInFullScreenView(i)||this.isInDetachedView(i)||this.setCallUIInBody(i));var a=ChatUI.exist[e];a&&this.handleChatWindowCreated(a)}}},handleChatWindowCreated:function(e){if(MediaCallImpl.hasCurrentSession()){var t=e.chid;if(MediaCallImpl.setChatIdForMediaCallSession(t),MediaCallImpl.isValidChatForCurrentSession(t)){var i=this.getMediaCallWrapper(MediaCallImpl.getCurrentSession().getId());if(this.isInFullScreenView(i)){if(ZCJQuery('[mediacallbuttons][purpose="openChatInRHS"]').attr({purpose:"closeChatInRHS",title:MediaCall.BRIDGE.Resource.getRealValue("common.hide")}).addClass("AV-call-active"),i.addClass("show-aside"),ZCJQuery("#mediacallchatsection").find("#"+t).length)return void e.focus();MainUI.handleIframes(t);var a=e.win();ZCJQuery("#mediacallchatsection").html(a),a.show(),CodeSnippet.handleThemeForAVChat(!0),ZCScroll.customScroll(a.find("#chatbody"),!0),e.getScrollDown(),e.focus()}}}},handleChatWindowClosed:function(e){if(MediaCallImpl.hasCurrentSession()){var t=this.getMediaCallWrapper(MediaCallImpl.getCurrentSession().getId());this.adjustCallContainerHeight(t),MediaCallImpl.setChatIdForMediaCallSession(e),MediaCallImpl.isValidChatForCurrentSession(e)&&this.isInFullScreenView(t)&&(ZCJQuery("#mediacallchatsection").empty(),this.closeChatInRHS())}},handleDragEnd:function(e){if(MediaCallImpl.hasCurrentSession()){var t=MediaCallImpl.getCurrentSession().getId(),i=this.getMediaCallWrapper(t).find("#"+t+"dropdowncnt");i.length&&this.setContainerPositionClass(i)}},handleResize:function(){var e=MediaCallImpl.getCurrentSession();if(void 0!==e&&!e.isMigratedCall()){var t=e.getId(),i=this.getMediaCallWrapper(t);this.adjustCallContainerHeight(i)}},handleEscape:function(){if(MediaCallImpl.hasCurrentSession()){var e=MediaCallImpl.getCurrentSession().getId(),t=this.getMediaCallWrapper(e),i=t.find("[switchnotifycnt]");if(i.length)return i.remove(),ZCJQuery("#mediacall_container").removeClass("AV-call-main-switch-wrapper"),!0;if(this.isInFullScreenView(t))return MediaCallHandler.UIEvents.minimizeWindow(),!0}return!1},handleSwitchToVideoLayout:function(){var e=MediaUtil.getCriteriaForResize((function(e,t){clearTimeout(MediaCallUI.resizeTimeout),MediaCallUI.resizeTimeout=setTimeout((function(){MediaCallUI.handleResize()}),100)})),t=ZCJQuery("#mediacall_container");t.addClass("AV-call-audiovideo-wrapper");var i=t.find(".AV-call-mainview").find("video");if(i.length){var a=i[0].getStream();a instanceof MediaStream&&(e.aspectRatio=a.getAspectRatio()||i[0].getAspectRatio()||ZCMediaConstants.ASPECT_RATIO)}e.widthRange.min=360,e.heightRange.min=270,t.setAsResizable(e),t.removeClass("AV-call-audio-only-wrapper");var n=t.find("[mediacallwrapper]");this.isInAudioLayout(n)&&n.hasClass("AV-call-mute-banner")&&t.css("height",353.5)},adjustCallContainerHeight:function(e){0!=e.length&&(this.isInInitialLayout(e)||this.isInAudioLayout(e)?e.parent().height(""):this.isInDetachedView(e)&&this.setContainerPosition(e.parent()))},removeRejectMessageDialog:function(e){this.getMediaCallWrapper(e).find("#rejectmessagedialog").remove()},removeCallUI:function(e){var t=e.getId();e.hasChatId()&&MediaCallImpl.removeChat(e.getChatId());var i=this.getMediaCallWrapper(t);i.length>0&&(this.deleteMediaContainers(t),i.remove(),ZCJQuery(MediaCall.BRIDGE.isContainerDeatchOnMinimizeDisabled()?"#mediacall_container":"#mediacalldetachedwrapper").remove())},addEndCallTimer:function(e){clearTimeout(this._endCallTimers[e]),this._endCallTimers[e]=setTimeout(function(){MediaCallUI.removeEndCallUI(e)}.bind(this),MediaCallConstants.endCallUIRemovalInterval)},removeEndCallTimer:function(e){clearTimeout(this._endCallTimers[e]),delete this._endCallTimers[e]},removeEndCallUI:function(e){this.removeEndCallTimer(e),this.deleteMediaContainers(e),this.getMediaCallWrapper(e).remove(),ZCJQuery("#mediacallendwrapper").remove()},showBeforeCallNetworkInfo:function(e,t,i){var a=this.getMediaCallWrapper(e);if(a.length>0){var n=a.find("[networkindicator]");MediaCallNetworkPredictorImpl.isPoorNetwork(i[MediaCall.getCurrentUserId()])?(n.attr("title",MediaCall.BRIDGE.Resource.getRealValue("network.strength.weak.curruser")).removeClass("zc-av-dN"),MediaCallImpl.trackPoorNetworkShown(e)):n.addClass("zc-av-dN")}},hideBeforeCallNetworkInfo:function(e){var t=this.getMediaCallWrapper(e).find("[networkindicator]");t.length>0&&t.addClass("zc-av-dN")},updateNetworkHealthMeter:function(e,t,i,a,n){var s=0;if(t instanceof MediaStream){if(t._hasVideoTrack()&&!i.isVideoMuted()&&MediaCallImpl.isValidNetworkScore(n))s=n;else{if(!t._hasAudioTrack()||i.isAudioMuted()||!MediaCallImpl.isValidNetworkScore(a))return;s=a}var o=MediaCallConstants.networkHealth.getScore(s),r=this.getMediaCallWrapper(e).find('[network_health_indicator][userId="'+i.getId()+'"]');MediaUtil.updateNetworkHealth(o,r)}},handleEnd:function(e,t){var i=e.getId(),a=this.getMediaCallWrapper(i);if(t&&"undefined"!=typeof ZCMediaRecorder&&ZCMediaRecorder.isVoiceNoteOnCallEndEnabled())return e.isVideoCall()&&MediaCallUI.getVideoContainer(i,e.getCurrentMemberId()).find("video").addClass("dN zc-av-dN"),a.parents(MediaCall.BRIDGE.isContainerDeatchOnMinimizeDisabled()?"#mediacall_container":"#mediacalldetachedwrapper").attr("id","mediacallendwrapper"),a.find("[impulsecontainer]").remove(),a.find("[calloptions]").replaceWith(MediaCallTemplates.getEndOptionsHtml(e,!0)),void MediaCallUI.addEndCallTimer(i);this.removeCallUI(e),"undefined"!=typeof WhiteBoard&&WhiteBoard.handleWhiteBoardEnd()},handleMute:function(e){var t=MediaCallImpl.getCurrentSession();if(t&&t.getId()===e){if(t.isMigratedForRecording())return AdhocCallBridge.publish(t,"audioMute",{associatedSessionId:t.getAssociatedConferenceId()}),!0;t.writeToLog(CallLogConstants.ui.micOff);var i=MediaCallUI.getMediaCallWrapper(e);i.find('[mediacallbuttons][purpose="turnOffMicrophone"]').addClass("zcf-mic-mute").removeClass("zcf-mic").attr({purpose:"turnOnMicrophone",title:MediaCall.BRIDGE.Resource.getRealValue("common.micon")}),MediaCallImpl.handleAVStatusChange("audio",!0);var a=MediaCallUI.isInFullScreenView(i);i.addClass("AV-call-mute-banner"),i.prepend(MediaTemplates.getMutedBanner(!a));var n=ZCJQuery("#mediacall_container"),s=n.height();n.css("height",s+36);var o=i.find("#newDeviceInfoCnt");return o&&o.find('[mediacallbuttons][purpose="switchToNewDevice"]').attr("deviceKind")===ZCMediaDevices.kinds.AUDIO_INPUT&&MediaCallUI.removeNewDeviceInfoCnt(t),!0}},handleVideoUnMute:function(e){var t=MediaCallImpl.getCurrentSession();if(t&&t.getId()===e){if(t.isMigratedForRecording())return void AdhocCallBridge.publish(t,"videoUnMute",{associatedSessionId:t.getAssociatedConferenceId()});t.writeToLog(CallLogConstants.ui.camOn);var i=MediaCallUI.getMediaCallWrapper(e),a=function(e){i.find('[mediacallbuttons][purpose="turnOnCamera"]').addClass("zcf-video").removeClass("zcf-video-mute").attr({purpose:"turnOffCamera",title:MediaCall.BRIDGE.Resource.getRealValue("videochat.cameraoff")}),MediaCallImpl.handleAVStatusChange("video",!1),t.getCurrentMember().replaceAVUpStreamTrack(e,WebRTCUserMedia.streamTypes.VIDEO_ONLY)};MediaCall.isNoCamOrMicEnabled(t)?MediaCallImpl.renegotiateForUnmute(e,WebRTCUserMedia.streamTypes.VIDEO_ONLY,a):a()}},handleVideoMute:function(e){var t=MediaCallImpl.getCurrentSession();if(t&&t.getId()===e){if(t.isMigratedForRecording())return void AdhocCallBridge.publish(t,"videoMute",{associatedSessionId:t.getAssociatedConferenceId()});t.writeToLog(CallLogConstants.ui.camOff),MediaCallUI.getMediaCallWrapper(e).find('[mediacallbuttons][purpose="turnOffCamera"]').addClass("zcf-video-mute").removeClass("zcf-video").attr({purpose:"turnOnCamera",title:MediaCall.BRIDGE.Resource.getRealValue("videochat.cameraon")}),MediaCallImpl.handleAVStatusChange("video",!0);var i=MediaCallUI.getMediaCallWrapper(e).find("#newDeviceInfoCnt");i&&i.find('[mediacallbuttons][purpose="switchToNewDevice"]').attr("deviceKind")===ZCMediaDevices.kinds.VIDEO_INPUT&&MediaCallUI.removeNewDeviceInfoCnt(t)}},handleNewDeviceAdded:function(e,t){var i=MediaCallImpl.getCurrentSession();if(i&&i.getId()===e){var a=i.getCurrentMember().getAVUpStream(),n=a&&a._hasAudioTrack(),s=a&&a._hasVideoTrack();if(t.kind===ZCMediaDevices.kinds.AUDIO_INPUT&&!n||t.kind===ZCMediaDevices.kinds.VIDEO_INPUT&&!s)return;i.hasNewDevicePopup()&&this.removeNewDeviceInfoCnt(i),i.writeToLog(CallLogConstants.ui.newDeviceInfoShown),i.setNewDevicePopup();var o=MediaCallUI.getMediaCallWrapper(e);o.addClass("AV-call-device-switch-banner"),o.prepend(MediaUtil.getNewDeviceInfoCntHtml(t,"","mediacallbuttons")),o.find("[topbandtitle]").attr("title",t.label)}},removeNewDeviceInfoCnt:function(e){e.resetNewDevicePopup(),MediaCallUI.getMediaCallWrapper(e.getId()).removeClass("AV-call-device-switch-banner"),MediaUtil.removeNewDeviceInfoCnt()},handleUnmute:function(e){var t=MediaCallImpl.getCurrentSession();if(t&&t.getId()===e){if(t.isMigratedForRecording())return AdhocCallBridge.publish(t,"audioUnMute",{associatedSessionId:t.getAssociatedConferenceId()}),!0;t.writeToLog(CallLogConstants.ui.micOn);var i=function(i){var a=MediaCallUI.getMediaCallWrapper(e);a.find('[mediacallbuttons][purpose="turnOnMicrophone"]').addClass("zcf-mic").removeClass("zcf-mic-mute").attr({purpose:"turnOffMicrophone",title:MediaCall.BRIDGE.Resource.getRealValue("common.micoff")}),MediaCallImpl.handleAVStatusChange("audio",!1),a.removeClass("AV-call-mute-banner");var n=ZCJQuery("#mediacall_container"),s=n.height();n.css("height",s-36),a.find("[mutedinfocnt]").remove(),i&&t.getCurrentMember().replaceAVUpStreamTrack(i,WebRTCUserMedia.streamTypes.AUDIO_ONLY)};return MediaCall.isNoCamOrMicEnabled(t)?MediaCallImpl.renegotiateForUnmute(e,WebRTCUserMedia.streamTypes.AUDIO_ONLY,i):i(),!0}},answerCall:function(e,t){MediaCallImpl.stopTone(MediaCallConstants.states.CALLING),MediaCallImpl.stopTone(MediaCallConstants.states.INCOMING),MediaCall.BRIDGE.handleTitleRevert();var i=MediaCallImpl.getFromIncomingSessions(e);MediaCallUI.removeRejectMessageDialog(e),void 0!==i&&(i.writeToLog(CallLogConstants.ui.answer),i.addLongPollingController(),i.addListenerForDeviceChange(),i.isVideoCall()&&"audio"===t&&i.getCurrentMember().setVideoCallWithoutVideo(),MediaCall.initiateCallProcess(i,ZCMediaConstants.triggerSource.CALL_INCOMING_UI))},removeCallSettings:function(){$WC.$Win.destroy("av_settings_win");var e=void 0!==MediaUtil.BRIDGE?MediaUtil.BRIDGE.getZIndex():"";ZCJQuery("#zcwindows").css("z-index",e)}},(MediaCallImpl={_runningSession:void 0,previousSessionId:void 0,_outgoingSession:void 0,_incomingSessions:{},_isPreferredDevicesSynced:!1,setPreferredDevicesObject:function(e){this._isPreferredDevicesSynced=!0;var t={};if(void 0!==e.devices){var i=e.devices;for(var a in i){var n={};n.kind=a,n.deviceId=i[a],t[a]=n}ZCMediaDevices.setPreferredDevices(t)}},isPreferredDevicesSynced:function(){return this._isPreferredDevicesSynced},renegotiateForUnmute:function(e,t,i,a){var n=MediaCallImpl.getCurrentSession(),s=n.getCurrentMember().getAVUpStream(),o=function(e,t){MediaManager.resetStreamRequested(),void 0!==e&&MediaManager.handleMediaError(e,t),void 0!==a&&a(e,t)},r=function(e){MediaManager.resetStreamRequested(),MediaCallImpl.hasCurrentSession()?i(e):WebRTCUserMedia.closeStream(e._getType())};void 0===s?t===WebRTCUserMedia.streamTypes.AUDIO_ONLY?WebRTCUserMedia.requestAudioStream(r,o):t===WebRTCUserMedia.streamTypes.VIDEO_ONLY&&WebRTCUserMedia.requestVideoStream(r,o,void 0,MediaUtil.getVideoEffects(n)):WebRTCUserMedia.requestAndAddTrackInStream(s,t,r,o,MediaUtil.getVideoEffects(n)),MediaManager.setAsStreamRequested(t)},syncPreferredDevices:function(e){this.isPreferredDevicesSynced()?"function"==typeof e&&e():MediaAPI.getPreferredDevices((function(t){MediaCallImpl.setPreferredDevicesObject(t),"function"==typeof e&&e()}),e)},init:function(){"function"==typeof MediaCall.BRIDGE.SoundManager.preLoadFiles&&MediaCall.BRIDGE.SoundManager.preLoadFiles(this.getMediaCallToneUrl()),void 0!==ZCConfig&&ZCConfig.isLibraryMode()&&MediaCallImpl.bindOnBeforeUnloadEvent(),MediaCallConstants.setBaseUrl(),MediaCallUI.bindEvents(),MediaCall.handleIncomingCalls()},bindOnBeforeUnloadEvent:function(){ZCJQuery(window).on("beforeunload",(function(e){if(MediaManager.hasOnGoingNewMediaCall())return!0}))},openDeviceSettings:function(e,t,i,a,n){var s=void 0!==MediaUtil.BRIDGE?MediaUtil.BRIDGE.getZIndex():"1000";s=isNaN(s)?s:parseInt(s)+1,ZCJQuery("#zcwindows").css("z-index",s),ZCJQuery("#av_settings_win").removeClass("zc-av-dN");var o=MediaDeviceWidget.getCurrentConfig(t,i,a,n);ZCJQuery("#av-settings-lhs").find("[settingstab]").removeClass("active"),ZCJQuery("#av-devicesetting-lhs").addClass("active"),ZCJQuery("#av_settings_body").html(MediaCallTemplates.getDeviceSettingsHtml(e,o))},generateTitleForRecording:function(e){return e.getCallerName()+"-"+e.getCalleeName()+"-"+$Date.getDateFieldString(new Date)},showMediaDeviceSettings:function(e){if(MediaCallImpl.hasCurrentSession()){var t=MediaCallImpl.getCurrentSession();if(t.writeToLog(CallLogConstants.ui.setMediaDevice),t.getId()===e){Clickoutside.handleClickOnChild(event),t.clearVideoEffectsPreview();var i=t.getCurrentMember(),a=i.getAVUpStream();if(t.isMigratedForRecording()){var n=ZCSmartConferenceImpl.getCurrentActiveSession();a=n.hasVideoUpStream()?n.getVideoUpStream():n.hasAudioUpStream()?n.getAudioUpStream():void 0}if(void 0!==a){var s=a._getType(),o={},r=void 0,l=MediaCallUI.getVideoContainer(e,t.getOtherMemberId()).find("video"),d=0!==l.length;d&&(r=l[0]),MediaCall.isVideoEffectsEnabled()&&(o.handleCustomUI=function(e,t,i,a,n){MediaCallImpl.openDeviceSettings(e,t,i,a,n)}),WebRTCUserMedia.isSetSinkIdSupported()&&(o[ZCMediaDevices.kinds.AUDIO_OUTPUT]=d),WebRTCUserMedia.isAudioStreamType(s)&&(o[ZCMediaDevices.kinds.VIDEO_INPUT]=!1),MediaDeviceWidget.show((function(e){if(!$WC.Util.isEmptyObject(e)&&(ZCMediaDevices.setPreferredDevices(e,!0),MediaCallImpl.hasCurrentSession()))if(t.isMigratedForRecording())AdhocCallBridge.publish(t,"setMediaDevices",{associatedSessionId:t.getAssociatedConferenceId(),changedDevices:e});else if(e[ZCMediaDevices.kinds.AUDIO_OUTPUT]&&MediaCallImpl.setPreferredAudioOutput(l),e[ZCMediaDevices.kinds.AUDIO_INPUT]||e[ZCMediaDevices.kinds.VIDEO_INPUT]){var n=WebRTCUserMedia.streamTypes.AUDIO_ONLY;e[ZCMediaDevices.kinds.AUDIO_INPUT]&&e[ZCMediaDevices.kinds.VIDEO_INPUT]?n=WebRTCUserMedia.streamTypes.AUDIO_VIDEO:e[ZCMediaDevices.kinds.VIDEO_INPUT]&&(n=WebRTCUserMedia.streamTypes.VIDEO_ONLY);t.writeToLog(CallLogConstants.webrtc.requestAndReplaceTracksInStream.init+n),WebRTCUserMedia.requestAndReplaceTracksInStream(a,n,(function(e){MediaCallImpl.hasCurrentSession()?(t.writeToLog(CallLogConstants.webrtc.requestAndReplaceTracksInStream.success),i.replaceTracksInStream(e,n),i.setUpdatedAVStatus()):WebRTCUserMedia.closeStream(e._getType())}),void 0,void 0,MediaUtil.getVideoEffects(t))}}),o,a,a,r)}}}},getMediaCallToneUrl:function(){var e={},t=MediaCall.BRIDGE.Constants.MEDIADEFAULTSTATICURL+MediaCallConstants.MEDIA_PATH;for(var i in MediaCallConstants.fileNames)e[i]=t+MediaCallConstants.fileNames[i];return e},addInIncomingSessions:function(e){this._incomingSessions[e.getId()]=e},getAllIncomingSessions:function(){return this._incomingSessions},getFromIncomingSessions:function(e){return this._incomingSessions[e]},hasCurrentIncomingSession:function(){return void 0!==this.getCurrentIncomingSession()},getCurrentIncomingSession:function(){var e=this.getAllIncomingSessions();for(var t in e){var i=e[t];if(i.isInCallRequestedState())return i}},removeFromIncomingSessions:function(e){delete this._incomingSessions[e]},setOutgoingSession:function(e){this._outgoingSession=e},getOutgoingSession:function(){return this._outgoingSession},hasOutgoingSession:function(){return void 0!==this._outgoingSession},clearOutgoingSession:function(){this._outgoingSession=void 0},hasCurrentSession:function(){return void 0!==this._runningSession},getCurrentSession:function(){return this._runningSession},clearRunningSession:function(e){this._runningSession.getId()===e&&this.clearCurrentRunningSession()},clearCurrentRunningSession:function(){this.previousSessionId=this._runningSession.getId(),this._runningSession=void 0},setCurrentSession:function(e){this.hasCurrentSession()&&this.getCurrentSession().terminate();this._runningSession=e},getClientSupport:function(){var e=void 0!==ZCConfig&&ZCConfig.isLibraryMode(),t=!e&&Conference&&Conference.isInstantConferenceAllowed(),i={perfect_renegotiation:!0,multi_stream:!0,initial_reconnection:!0,recording_support:t,reconnection_policy:!0,close_track_on_mute:!0,call_collision_handling:!0,adhoc_call_support:t,whiteboard_support:!e};return MediaCall.BRIDGE.Util.Browser.isChrome()||MediaCall.BRIDGE.Util.Browser.isSafari()||MediaCall.BRIDGE.Util.Browser.isOpera()?WebRTCUserMedia.isDisplayMediaSupported()||(i={perfect_renegotiation:!1,multi_stream:!1,initial_reconnection:!0,recording_support:t,reconnection_policy:!0,close_track_on_mute:!0,call_collision_handling:!0,adhoc_call_support:t,whiteboard_support:!e}):MediaCall.BRIDGE.Util.Browser.isFirefox()&&(i.perfect_renegotiation=!1),i},isValidChatForCurrentSession:function(e){return!!this.hasCurrentSession()&&e===this.getCurrentSession().getChatId()},attachChat:function(e){if(this.isValidChatForCurrentSession(e)){var t=ChatUI.exist[e];t?MediaCallUI.handleChatWindowCreated(t):ConversationsList.attachContinueActiveChat(e)}},removeChat:function(e){ZCJQuery("#mediacallchatsection").find("#"+e).length&&MainUI.revertToViewPort(e)},setChatIdForMediaCallSession:function(e){if(this.hasCurrentSession()){var t=this.getCurrentSession();if(!t.hasChatId()){var i=ChatUI.exist[e];if(i&&i.isOnetoOneChat()){var a=Participants.get(i.chid);if(!a||$WC.Util.isEmpty(a.getRecipientFor121Chat())){var n=ConversationsList.get(i.chid);if(void 0!==n){var s=ConversationsList.getRecipantFor121FromRecipants(n);s&&s.zuid===t.getOtherMemberId()&&t.setChatId(i.chid)}}else a.getRecipientFor121Chat()===t.getOtherMemberId()&&t.setChatId(i.chid)}}}},getRecipiantChatIdIfOpen:function(e){return"function"==typeof MediaCall.BRIDGE.getOneToOneChatId?MediaCall.BRIDGE.getOneToOneChatId(e):void 0},filterRelayCandidates:function(e){for(var t=[],i=0;i<e.length;i++)"relay"===new RTCIceCandidate(e[i]).type&&t.push(e[i]);return t},hasTurnCandidates:function(e){for(var t=0;t<e.length;t++){var i=new RTCIceCandidate(e[t]);if("relay"===i.type||"srflx"===i.type||"prflx"===i.type)return!0}return!1},startCall:function(e){MediaCallNetworkPredictorImpl.start(),e.writeToLog(CallLogConstants.callInit),MediaCallUI.adaptUIToState(e,MediaCallConstants.states.INITIATING),e.getCurrentMember().setClientSupport(MediaCallImpl.getClientSupport());var t=function(t){if(this.hasOutgoingSession()){e.writeToLog(CallLogConstants.startCallAPI.success,t),MediaCallUI.getMediaCallWrapper(e.getId()).attr("callId",t.call_id);var i=new MediaCallSession(t);if(e.isLiveFeedAssociated()){var a=e.getAssociatedLiveFeedId();i.setAssociatedLiveFeedId(a);var n=LiveFeedImpl.getIncomingFeedSession(a);n&&n.setAssociatedCallId(i.getId())}i.addNetworkPredictor(),i.addListenerForDeviceChange();var s=e.getCurrentMember(),o=i.getCurrentMember();o.setAVUpStream(s.getAVUpStream()),o.setScreenUpStream(s.getScreenUpStream()),o.setClientSupport(MediaCallImpl.getClientSupport()),s.isScreenShareWithoutAudio()&&o.setScreenShareWithoutAudio(),MediaCallUI.adaptUIToState(i,MediaCallConstants.states.CALLING),MediaCallImpl.playTone(i,MediaCallConstants.states.RINGING),this.setCurrentSession(i),i.setLogString(e.getLogString()),this.clearOutgoingSession(),i.startCall()}else MediaCallAPI.cancelCall(t.call_id)}.bind(this),i=function(t){this.hasOutgoingSession()&&void 0!==t&&t.code===MediaCallAPI.errorCodes.ALREADY_ON_A_CALL?MediaUtil.showMultipleCallAlertPopup(e.getOtherMemberId(),(function(){var e=MediaCallImpl.getOutgoingSession();e&&e.getMultipleCallsHandlingType()!==MediaCallConstants.multipleCallHandlingType.END_ACTIVE_CALLS&&(e.writeToLog(CallLogConstants.startCallAPI.failed),e.terminate(),MediaCallImpl.clearOutgoingSession(),MediaCallUI.removeCallUI(e))}),(function(){if(MediaCallImpl.hasOutgoingSession()){var e=MediaCallImpl.getOutgoingSession();e.setMultipleCallsHandlingType(MediaCallConstants.multipleCallHandlingType.END_ACTIVE_CALLS),MediaCallImpl.startCall(e)}})):(e.writeToLog(CallLogConstants.startCallAPI.failed),e.terminate(),this.clearOutgoingSession(),MediaCallUI.removeCallUI(e))}.bind(this),a={perfect_renegotiation:e.getCurrentMember().isPerfectRenegotiationSupported(),multi_stream:e.getCurrentMember().isMultiStreamSupported(),adhoc_call_support:e.getCurrentMember().isAdhocCallingSupported(),call_collision_handling:e.getCurrentMember().isCallCollisionSupported(),initial_reconnection:e.getCurrentMember().isInitialReconnectionSupported(),recording_support:e.getCurrentMember().isRecordingSupported(),reconnection_policy:!0,close_track_on_mute:!0,whiteboard_support:MediaCall.BRIDGE.isWhiteBoardAllowed()},n={type:e.getType(),client_support:JSON.stringify(a)};e.getCurrentMember().isScreenShareWithoutAudio()&&(n.audio=JSON.stringify({muted:!0})),e.writeToLog(CallLogConstants.clentSupport,a),e.writeToLog(CallLogConstants.startCallAPI.init),MediaCallAPI.startCall(e.getCalleeId(),e.getChatId(),e.getMultipleCallsHandlingType(),n,t,i)},answerCall:function(e){MediaCallUI.adaptUIToState(e,MediaCallConstants.states.CONNECTING),this.setCurrentSession(e),this.removeFromIncomingSessions(e.getId()),e.answerCall()},setPreferredAudioOutput:function(e){if(0!==e.length&&ZCMediaDevices.hasPreferredAudioOutput()){var t=ZCMediaDevices.getPreferredDevices().audiooutput,i=ZCMediaDevices.kinds.AUDIO_OUTPUT;void 0!==t&&ZCMediaDevices.isValidDevice(i,t.deviceId)&&e[0].setSinkId(t.deviceId).catch((function(){}))}},triggerSessionTimer:function(){this.getCurrentSession()&&SessionTimers.setTimer("mediacallsessiontimer")},playIncomingTone:function(e){var t=void 0!==MediaCall.BRIDGE.Settings&&1===MediaCall.BRIDGE.Settings.get("globalsoundnotify");if(t&&(t=e.isAudioCall()||e.isVideoCall()?1===MediaCall.BRIDGE.Settings.get("av_call_sound_notify"):1===MediaCall.BRIDGE.Settings.get("screen_call_sound_notify"))){var i=MediaManager.hasOnGoingSession()?"WAITING_TONE":"INCOMING_TONE";this.stopToneById(i),void 0!==MediaCall.BRIDGE.SoundManager&&MediaCall.BRIDGE.SoundManager.play(i,MediaCall.BRIDGE.Constants.MEDIADEFAULTSTATICURL+MediaCallConstants.MEDIA_PATH+MediaCallConstants.fileNames.INCOMING_TONE,{loop:!0})}},startPushToTalk:function(){var e=this.getCurrentSession();if(e.getCurrentMember().isAudioMuted()){var t=e.getId(),i=MediaCallUI.getMediaCallWrapper(t);if(MediaCallUI.isInFullScreenView(i))return MediaCallUI.handleUnmute(t),e.setPushToTalkState(!0),!0}return!1},stopPushToTalk:function(){var e=this.getCurrentSession();if(e.isPushToTalkEnabled()&&!e.getCurrentMember().isAudioMuted()){var t=e.getId(),i=MediaCallUI.getMediaCallWrapper(t);if(MediaCallUI.isInFullScreenView(i))return MediaCallUI.handleMute(t),e.setPushToTalkState(!1),!0}return!1},trackPoorNetworkShown:function(e){var t=MediaCallImpl.getCurrentSession();void 0===t&&MediaCallImpl.hasCurrentIncomingSession(e)&&(t=MediaCallImpl.getFromIncomingSessions(e)),t&&!t.isPoorNetworkTracked()&&(void 0!==MediaCall.BRIDGE.Tracker&&MediaCall.BRIDGE.Tracker.track("AV_POOR_NETWOTK_SHOWN"),t.setPoorNetworkTracked())},handleCallRingingTimeout:function(e){var t=function(t){var i=MediaCallImpl.getCurrentSession();if(i&&i.getId()===e){if(!i.isInCallAnsweredState()&&void 0!==t&&void 0!==t.answer_description)return void MediaCallImpl.handleCallAnswered(i,t);i.handleCallMissed()}};MediaCallAPI.updateCallStatus(e,MediaCallConstants.statusText.CALL_MISSED,t.bind(this),t.bind(this))},handleCallAnswered:function(e,t){e.writeToLog(CallLogConstants.wms.callAnswered,t),MediaCallAPI.updateCallStatus(e.getId(),MediaCallConstants.statusText.CALL_ANSWERED_ACK,void 0,void 0);var i=e.getOtherMember();void 0!==t.client_support&&i.setClientSupport(t.client_support),t.callee_audio_status&&t.callee_audio_status.muted&&i.setAudioMuted(),t.callee_video_status&&t.callee_video_status.muted&&i.setVideoMuted();var a=t.answered_client_time;if(a&&a>0){var n=MediaCall.BRIDGE.Util.getSyncedCurrentTime()-a;!isNaN(n)&&n>MediaCallConstants.callAnsweredDelayThreshold&&MediaCallAPI.pushCallEventLog(e.getId(),MediaCallConstants.logEvents.ANSWERED_ACK_DELAY)}var s=t.answer_description;void 0!==s&&(s=JSON.parse(s)),e.handleCallAnswered(s,t.tracks_media_id),t.caller_id===MediaCall.BRIDGE.Constants.ZUID&&(MediaCallImpl.stopTone(MediaCallConstants.states.CALLING),MediaCallImpl.stopTone(MediaCallConstants.states.RINGING)),MediaCallUI.adaptUIToState(e,MediaCallConstants.states.CONNECTING)},playTone:function(e,t){var i=void 0,a=void 0,n=void 0===MediaCall.BRIDGE.isWmsOwner||MediaCall.BRIDGE.isWmsOwner();n=n?!MediaCall.BRIDGE.Status.isDND():n;var s={loop:!0,mildTone:!1};t===MediaCallConstants.states.INCOMING&&n?this.playIncomingTone(e):t===MediaCallConstants.states.CALLING?(i=MediaCallConstants.fileNames.WAITING_TONE,a="WAITING_TONE"):t===MediaCallConstants.states.RINGING?(i=MediaCallConstants.fileNames.RINGING_TONE,a="RINGING_TONE"):t===MediaCallConstants.states.RECONNECTING?(i=MediaCallConstants.fileNames.RECONNECTING_TONE,a="RECONNECTING_TONE"):t===MediaCallConstants.states.END&&(i=MediaCallConstants.fileNames.CALL_END_TONE,s.loop=!1,s.mildTone=!0,a="CALL_END_TONE"),void 0!==a&&(this.stopToneById(a),void 0!==MediaCall.BRIDGE.SoundManager&&MediaCall.BRIDGE.SoundManager.play(a,MediaCall.BRIDGE.Constants.MEDIADEFAULTSTATICURL+MediaCallConstants.MEDIA_PATH+i,s))},stopToneById:function(e){void 0!==MediaCall.BRIDGE.SoundManager&&MediaCall.BRIDGE.SoundManager.stop(e)},stopTone:function(e){var t=void 0;e===MediaCallConstants.states.INCOMING?t="INCOMING_TONE":e===MediaCallConstants.states.CALLING?t="WAITING_TONE":e===MediaCallConstants.states.RINGING?t="RINGING_TONE":e===MediaCallConstants.states.RECONNECTING?t="RECONNECTING_TONE":e===MediaCallConstants.states.END&&(t="CALL_END_TONE"),void 0!==t&&void 0!==MediaCall.BRIDGE.SoundManager&&MediaCall.BRIDGE.SoundManager.stop(t)},handleAVStatusChange:function(e,t){if(this.hasCurrentSession()){var i=MediaCall.BRIDGE.Util.getSyncedCurrentTime(),a=this.getCurrentSession();a.getCurrentMember().handleAVStreamStatus(e,t,i);var n=t?"off":"on";MediaCallAPI.updateDeviceState(a.getId(),e,n,i)}},handleRejectMessage:function(e,t,i){if(!$WC.Util.isEmpty(t)){var a=MediaCallImpl.getFromIncomingSessions(e);if(void 0!==a){if(t.length>ZCMediaConstants.REJECT_MESSAGE_MAX_LENGTH)return void UI.updateBanner(MediaCall.BRIDGE.Resource.getRealValue("videochat.incommingreply.errormsg"),2e3,!0);a.getChatId();var n={};this.chid&&(n.chat_id=this.chid),n.callee=a.getOtherMemberId(),n.message=t,n.custom=i,MediaCallImpl.handleEnd(e,!0,{messageData:n})}}},updateAPIResponseTimeInLog:function(e,t,i,a,n){var s=MediaCallImpl.getCurrentSession(),o={url:t,type:i,status:a,startTime:n,endTime:new Date,interval:Math.abs(new Date-n)+" ms"};if(MediaCallNetworkPredictorImpl.addHttpRequestInfo(o),s&&s.getId()===e)s.writeToLog(CallLogConstants.responseTime,o);else{var r=MediaCallImpl.getFromIncomingSessions(e);void 0!==r&&r.writeToLog(CallLogConstants.responseTime,o)}},showAsUnreadForSender:function(e){return e.mode===MediaCallConstants.INFO_MSG_MODE&&void 0!==e.info&&void 0!==e.info.msg&&MediaCallConstants.isCallMissedOnBusy(e.info.msg.status)},isLocalCallId:function(e){return e===MediaCallConstants.defaultCallId},isValidNetworkScore:function(e){return!(void 0===e||isNaN(e)||null==e||e<0||e>5)},updateNetworkHealthMeter:function(e){var t=e.getId(),i=e.getCallStrengthAnalyser().getScore(),a=e.getCurrentMember(),n=i.upStreamScore,s=i.performanceScore;MediaCallUI.updateNetworkHealthMeter(t,a.getAVUpStream(),a,n.audioUpStreamPerformanceScore,n.videoUpStreamPerformanceScore),MediaCallUI.updateNetworkHealthMeter(t,a.getAVDownStream(),e.getOtherMember(),s.audioPerformanceScore,s.videoPerformanceScore)},canDisplayIncomingUI:function(){return!("function"==typeof _isWorkplace&&_isWorkplace()||"function"==typeof _isZohoOne&&_isZohoOne()||"undefined"!=typeof ISCUtil&&ISCUtil.isUIIntegrated())},getLoggableSessionObject:function(e){var t=$ZCUtil.cloneObject(e);return delete t._logString,t},hasActiveAdhocCall:function(e){if(e.isMigratedCall()&&!e.isMigratedForRecording()){var t=ZCSmartConferenceImpl.getCurrentActiveSession();return t&&t.getId()===e.getAssociatedConferenceId()}return!1},sendNetworkInfo:function(e,t){var i=MediaCallNetworkPredictorImpl.getAvgCdnRtt(),a=MediaCallNetworkPredictorImpl.getAvgWmsRtt();i&&i>MediaCallNetworkPredictorImpl.NETWORK_RTT_MAX_THRESHOLD&&MediaCallAPI.pushCallEventLog(e,MediaCallConstants.logEvents.NETWORK_POOR,i,t),a&&a>MediaCallNetworkPredictorImpl.WMS_RTT_MAX_THRESHOLD&&MediaCallAPI.pushCallEventLog(e,MediaCallConstants.logEvents.WMS_RTT_POOR,a,t)},handleEnd:function(e,t,i){var a=this.getCurrentSession(),n=void 0!==a&&a.getId()===e,s=void 0!==i&&i.showCallEndUI,o=!0;if(n?SessionTimers.clearTimer("mediacallsessiontimer"):(a=this.getFromIncomingSessions(e),o=!!t),void 0!==a){if(a.writeToLog(CallLogConstants.callEnd,{notifyServer:t,additionalData:i}),o&&(void 0!==MediaCall.BRIDGE&&"function"==typeof MediaCall.BRIDGE.getWmsDebugInfo&&a.writeToLog(CallLogConstants.wmsInfo,MediaCall.BRIDGE.getWmsDebugInfo()),MediaCallImpl.sendNetworkInfo(e,a.isCaller(MediaCall.getCurrentUserId())),MediaCall.isNewAVDomainRoutingEnabled()?MediaCallAPI.sendClientLogData(e,a.getLogString(),"["+a.getType()+" Call] ["+a.getStatusText()+"]",a.getType()):MediaAPI.uploadClientLog(e,"calls",a.getLogAsFile(e),"["+a.getType()+" Call] ["+a.getStatusText()+"]",a.getType())),t)if(a.isInInitialState())if(a.isCaller(MediaCall.BRIDGE.Constants.ZUID))MediaCallAPI.cancelCall(e);else if(void 0!==i&&void 0!==i.messageData){MediaCallAPI.declineCall(e,i.messageData,function(e){i.messageData.custom&&MediaCallRejectMessages.updateMessageList({msg:i.messageData.message})}.bind(this),(function(){UI.updateBanner(MediaCall.BRIDGE.Resource.getRealValue("chat.message.send.error"),2e3,!0)}))}else MediaCallAPI.declineCall(e);else MediaCallAPI.endCall(e);var r=this.hasActiveAdhocCall(a);a.terminate(r),MediaCallNetworkPredictorImpl.clearAllRtt(),n?(MediaCallImpl.stopTone(MediaCallConstants.states.RECONNECTING),MediaCallImpl.stopTone(MediaCallConstants.states.CALLING),MediaCallImpl.stopTone(MediaCallConstants.states.RINGING),this.clearCurrentRunningSession(),"function"==typeof MediaCall.BRIDGE.handleDarkMode&&MediaCall.BRIDGE.handleDarkMode(!1),$WC.$Win.destroy("media_device_widget"),MediaCallUI.removeCallSettings(),Clickoutside.clear(a.getId()+"dropdowncnt"),MediaCallHandler.UIEvents.closeAddParticipantWin()):(this.removeFromIncomingSessions(e),MediaCall.BRIDGE.handleTitleRevert(),MediaCallImpl.stopTone(MediaCallConstants.states.CALLING),MediaCallImpl.stopTone(MediaCallConstants.states.INCOMING)),MediaCallUI.handleEnd(a,s),a.isLiveFeedAssociated()&&LiveFeedHandler.callEvents.handlEnd(a),(a.isInMigratingState()||a.isMigratedForRecording())&&ConferenceImpl.handleEndForAdhocCall(a.getId())}if(this.hasOutgoingSession()){var l=this.getOutgoingSession();l.getId()===e&&(MediaCallImpl.isLocalCallId(e)||(MediaCallImpl.sendNetworkInfo(e,l.isCaller(MediaCall.getCurrentUserId())),MediaCall.isNewAVDomainRoutingEnabled()?MediaCallAPI.sendClientLogData(e,l.getLogString(),"["+l.getType()+" Call] ["+l.getStatusText()+"]",l.getType()):MediaAPI.uploadClientLog(e,"calls",l.getLogAsFile(e),"["+l.getType()+" Call] ["+l.getStatusText()+"]",l.getType())),l.terminate(),this.clearOutgoingSession(),MediaCallUI.handleEnd(l,s),MediaCallImpl.stopTone(MediaCallConstants.states.CALLING),MediaCallImpl.stopTone(MediaCallConstants.states.RINGING),l.isLiveFeedAssociated()&&LiveFeedHandler.callEvents.handlEnd(l))}void 0!==i&&i.playEndTone&&!r&&MediaCallImpl.playTone(null,MediaCallConstants.states.END)},getDetailsForAdhocCallConversion:function(e){return{call_id:e.getId(),caller_id:e.getCallerId(),callee_id:e.getCalleeId()}},addUsersToCall:function(e,t,i,a,n){var s=this.getCurrentSession();if(void 0!==s&&!$WC.Util.isEmpty(i)&&i.length>0){if(s.isMigratedForRecording())return AdhocCallBridge.publish(s,"addUsers",{associatedSessionId:s.getAssociatedConferenceId(),selectedList:i}),void a();var o=s.getCurrentMember().getAVUpStream();Conference.convertOneToOneCallToConference(e,t,i,o,MediaCallImpl.getDetailsForAdhocCallConversion(s),void 0,a,n)}},createAddParticipantWin:function(e){if(!$WC.$Win.isExist("addparticipantstocallwin")){MediaUtil.createPopup({id:"addparticipantstocallwin",class:"zcl-win-modal1 ",closeoutside:!0,html:MediaCallTemplates.getAddParticipantsWinHtml(e)},!0);SearchField.init("addcallparticipants-usersuggest"),MediaCallImpl.userSuggestion.getSearchFieldInput().select().focus(),MediaCallImpl.userSuggestion.populateDefaultResult(),MediaCallImpl.userSuggestion.setDefaultCallTitle(e),MediaCallHandler.UIEvents.handleAdhocCallInputs()}},canPerformSilentJoin:function(e){var t=MediaCallImpl.getCurrentSession();return!(void 0===e||!t||t.getId()!==e.call_id)&&(e.caller_id===MediaCall.BRIDGE.Constants.ZUID||e.callee_id===MediaCall.BRIDGE.Constants.ZUID)},handleCallEvent:function(e,t){e.msguid;var i=e.data.call_id,a=MediaCallImpl.hasCurrentSession()?MediaCallImpl.getCurrentSession():MediaCallImpl.getFromIncomingSessions(i);if(void 0===a&&(a=MediaCallImpl.getOutgoingSession()),!a||!a.isDuplicateEvent(e.msguid)){if(a){["CALL_ANSWERED","ANSWER_SDP","ICE_CANDIDATE"].includes(e.action)&&!t&&a.pushPollingEvent(e.action),a.pushEventId(e.msguid)}MediaCallHandler.wmsEvents[e.action](e)}},switchDevice:function(e,t){if(ZCMediaDevices.isValidDevice(t,e)){var i=this.getCurrentSession(),a=i.getCurrentMember(),n=a.getAVUpStream();if(t===ZCMediaDevices.kinds.AUDIO_OUTPUT){var s=MediaCallUI.getVideoContainer(i.getId(),i.getOtherMemberId()).find("video");return void MediaCallImpl.setPreferredAudioOutput(s)}var o={audio:{deviceId:{exact:e}}},r=WebRTCUserMedia.streamTypes.AUDIO_ONLY;t===ZCMediaDevices.kinds.VIDEO_INPUT&&(o={video:{deviceId:{exact:e}}},r=WebRTCUserMedia.streamTypes.VIDEO_ONLY);i.writeToLog(CallLogConstants.webrtc.requestAndReplaceTracksInStream.init+r),WebRTCUserMedia.requestAndReplaceTracksInStream(n,r,(function(e){MediaCallImpl.hasCurrentSession()?(i.writeToLog(CallLogConstants.webrtc.requestAndReplaceTracksInStream.success),a.replaceTracksInStream(e,r),a.setUpdatedAVStatus()):WebRTCUserMedia.closeStream(e._getType())}),void 0,o,MediaUtil.getVideoEffects(i))}},adaptUIForCallCollision:function(e,t){var i=e.find('[videocontainer][userId="'+t.caller_id+'"]'),a=e.find('[videocontainer][userId="'+t.callee_id+'"]');e.attr({callid:t.call_id,calltype:t.type,caller:t.callee_id,callee:t.caller_id}),i.attr("userId",t.callee_id),a.attr("userId",t.caller_id)},handleCallCollision:function(e,t){var i=e.getId(),a=t.data.call_id,n=e.getType();MediaCallAPI.updateCallStatus(i,MediaCallConstants.statusText.CALL_COLLISION),MediaCallImpl.stopTone(MediaCallConstants.states.RINGING),this.adaptUIForCallCollision(MediaCallUI.getMediaCallWrapper(i),t.data),e.writeToLog(CallLogConstants.callState.collision),e.terminate(),MediaCallImpl.isLocalCallId(i)?(MediaManager.resetStreamRequested(),MediaCallImpl.clearOutgoingSession()):MediaCallImpl.clearRunningSession(i);var s=MediaCallImpl.getFromIncomingSessions(a);void 0===s&&((s=new MediaCallSession(t.data)).getCurrentMember().setClientSupport(MediaCallImpl.getClientSupport()),s.writeToLog(CallLogConstants.wms.callRequested),s.pushEventId(t.msguid),MediaCallImpl.addInIncomingSessions(s),MediaCallNetworkPredictorImpl.start()),s.getCurrentMember().storeRemoteTracksMediaId(t.data.tracks_media_id),s.getCurrentMember().storeRemoteSdp(JSON.parse(t.data.offer_description)),s.writeToLog(CallLogConstants.wms.offer,t.data.offer_description),void 0!==t.data.client_support&&s.getOtherMember().setClientSupport(t.data.client_support),s.addLongPollingController(),s.addListenerForDeviceChange(),s.isVideoCall()&&!MediaCall.isVideoCall(n)&&s.getCurrentMember().setVideoCallWithoutVideo(),MediaCall.initiateCallProcess(s,ZCMediaConstants.triggerSource.CALL_INCOMING_UI)}}).userSuggestion={id:"addcallparticipants-usersuggest",minLimitForAdhocCall:3,maxLimitForAdhocCall:18,getResultsListID:function(){return this.id+"-list"},getResultsListContainer:function(){return ZCJQuery("#"+this.getResultsListID())},getResultsContainerID:function(){return this.id+"-results"},getResultsContainer:function(){return ZCJQuery("#"+this.getResultsContainerID())},getSearchFieldInputID:function(){return this.id+"-search-field"},getSearchFieldInput:function(){return ZCJQuery("#"+this.getSearchFieldInputID())},getUserSelectFieldId:function(){return this.id+"-select-field"},getUserSelectField:function(){return ZCJQuery("#"+this.getUserSelectFieldId())},getSearchFieldContainer:function(){return ZCJQuery("#"+this.id)},getSelectedListValues:function(){return SearchField.getSelectedList(this.getUserSelectFieldId())},search:function(e){var t=this.getSelectedListValues();if(this.getResultsListContainer().empty(),MediaCallHandler.UIEvents.handleAdhocCallInputs(),!(t.length>=this.maxLimitForAdhocCall)){var i={searchin:SearchAgent.CONTACTS+SearchAgent.ORGCONTACTS,ignorelist:t,listid:this.getResultsListID(),val:e,contactshtml:QuickAction.quickchatcontacthtml,orgcontactshtml:QuickAction.quickchatcontacthtml,allstatuscontacts:!1,successcallback:function(){this.populateResults(e)}.bind(this),clearcallback:function(){this.populateEmptyResult()}.bind(this)},a=SearchAgent.search(i);return a?this.populateResults():(this.populateEmptyResult(),ZCScroll.scrollTop(this.getResultsListContainer(),0)),a}UI.updateBanner(Resource.getRealValue("conference.invite.limit.audio",[this.maxLimitForAdhocCall]),2e3,!0)},handleKeyUp:function(e,t){var i=e.keyCode;if(e.stopPropagation(),27===i){if($WC.Util.isEmpty(t)&&$WC.Util.isEmpty(this.getSearchFieldInput().val()))return void $WC.$Win.destroy("addparticipantstocallwin");this.getSearchFieldInput().val(""),$WC.Util.isEmpty(this.getSearchFieldInput().val())&&this.populateDefaultResult()}SearchField.hasNodes(this.getResultsListID())||this.populateEmptyResult()},handleAction:function(e,t){var i=t.attr("uid"),a=MediaCallTemplates.getSelectedParticipantHtml(i,t.attr("elemtype"),!0);t.remove(),$WC.Util.isEmpty(i)||(this.getUserSelectField().append(a),SearchField.clearSearchField(this.id),this.getSearchFieldInput().val("").select().focus())},handleDeleteNode:function(e){e.remove(),this.getSearchFieldInput().select().focus(),this.populateDefaultResult()},setDefaultCallTitle:function(e){SearchField.hasNodes(this.getUserSelectFieldId())&&ZCJQuery("#addparticipantstocallwin").find('[inputname="adhoccalltitle"]').val(this.createCallTitle(e))},createCallTitle:function(e){return Composer.getDnameForChatTitle(e.getCallerId())+", "+Composer.getDnameForChatTitle(e.getCalleeId())+" & "+Resource.getRealValue("common.more")},populateEmptyResult:function(){var e=$WC.Util.isEmpty(this.getSearchFieldInput().val())?"quickchat.no.contact":"quickchat.no.result";this.getResultsListContainer().html($Util.emptyStateHtml({imageclass:"no_such_user",title:Resource.getRealValue(e)}))},populateResults:function(){var e=this.getResultsContainer();if(this.getSearchFieldInput().val().trim().length>0)e.find(".sel").removeClass("sel");else{var t=e.find("[purpose='search']");t.length&&0===e.find(".sel").length&&t.first().addClass("sel")}},populateDefaultResult:function(){$WC.$Win.isExist("addparticipantstocallwin")&&$WC.Util.isEmpty(this.getSearchFieldInput().val())&&this.search("*")}},MediaCallAPI={errorCodes:{NO_OFFER_RECIEVED_ON_RECONNECTION:"nooffer_received_on_reconnection",CALL_ALREADY_ENDED:"call_already_ended",CALL_ALREADY_ANSWERED:"call_already_answered",CALL_ALREADY_DECLINED:"call_already_declined",CALL_ALREADY_CANCELED:"call_already_canceled",ALREADY_ON_A_CALL:"already_on_a_call",isCallEndError:function(e){return e===this.CALL_ALREADY_ENDED||e===this.CALL_ALREADY_DECLINED||e===this.CALL_ALREADY_CANCELED},isCallAlreadyAnsweredError:function(e){return e===this.CALL_ALREADY_ANSWERED}},startCall:function(e,t,i,a,n,s){var o=new Date,r={},l={client_time:MediaCall.BRIDGE.Util.getSyncedCurrentTime(),...a};MediaCall.isMultipleCallHandlingEnabled()&&(r[MediaCallConstants.MULTIPLE_CALLS_HANDLING_TYPE_HEADER]=i);var d={url:MediaCallConstants.baseUrl+"/v2/users/"+e+"/call",type:MediaCallConstants.request.method.POST,data:l,headers:r,success:function(e){var t,i;t=e.call_id,i=MediaCallConstants.request.status.SUCCESS,MediaCallImpl.updateAPIResponseTimeInLog(t,"/call",MediaCallConstants.request.method.POST,i,o),n(e)},error:function(e){s(e)}};MediaCall.isNewAVDomainRoutingEnabled()&&(d.url=d.url+MediaAPI.serialize(l),delete d.data),MediaAPI.request(d)},answerCall:function(e,t,i,a,n){var s=new Date,o=function(t){MediaCallImpl.updateAPIResponseTimeInLog(e,"/answer",MediaCallConstants.request.method.PUT,t,s)},r={},l={client_time:MediaCall.BRIDGE.Util.getSyncedCurrentTime(),...i};MediaCall.isMultipleCallHandlingEnabled()&&(r[MediaCallConstants.MULTIPLE_CALLS_HANDLING_TYPE_HEADER]=t),MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/calls/"+e+"/answer",type:MediaCallConstants.request.method.PUT,contentType:"application/json",data:l,headers:r,success:function(e){o(MediaCallConstants.request.status.SUCCESS),"function"==typeof a&&a(e)},error:function(e){o(MediaCallConstants.request.status.FAILED),"function"==typeof n&&n(e)}})},cancelCall:function(e){var t=new Date,i=function(i){MediaCallImpl.updateAPIResponseTimeInLog(e,"/cancel",MediaCallConstants.request.method.PUT,i,t)};MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/calls/"+e+"/cancel",type:MediaCallConstants.request.method.PUT,success:function(e){i(MediaCallConstants.request.status.SUCCESS)},error:function(e){i(MediaCallConstants.request.status.FAILED)}})},declineCall:function(e,t,i,a){var n=new Date,s=function(t){MediaCallImpl.updateAPIResponseTimeInLog(e,"/decline",MediaCallConstants.request.method.PUT,t,n)},o={client_time:MediaCall.BRIDGE.Util.getSyncedCurrentTime()};void 0!==t&&(o=Object.assign({},o,t)),MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/calls/"+e+"/decline",type:MediaCallConstants.request.method.PUT,contentType:"application/json",data:o,success:function(e){s(MediaCallConstants.request.status.SUCCESS),"function"==typeof i&&i(e)},error:function(e){s(MediaCallConstants.request.status.FAILED),"function"==typeof a&&a(e)}})},endCall:function(e){var t=new Date,i=function(i){MediaCallImpl.updateAPIResponseTimeInLog(e,"/end",MediaCallConstants.request.method.PUT,i,t)};MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/calls/"+e+"/end",type:MediaCallConstants.request.method.PUT,success:function(e){i(MediaCallConstants.request.status.SUCCESS)},error:function(e){i(MediaCallConstants.request.status.FAILED)}})},requestCallSwitch:function(e){var t=new Date,i=function(i){MediaCallImpl.updateAPIResponseTimeInLog(e,"/requestvideo",MediaCallConstants.request.method.PUT,i,t)};MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/calls/"+e+"/requestvideo",type:MediaCallConstants.request.method.PUT,success:function(e){i(MediaCallConstants.request.status.SUCCESS)},error:function(e){i(MediaCallConstants.request.status.FAILED)}})},cancelCallSwitchRequest:function(e,t){var i=new Date,a=function(t){MediaCallImpl.updateAPIResponseTimeInLog(e,"/cancelvideo",MediaCallConstants.request.method.PUT,t,i)};MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/calls/"+e+"/cancelvideo",type:MediaCallConstants.request.method.PUT,contentType:"application/json",data:{switch_video_token:t},success:function(e){a(MediaCallConstants.request.status.SUCCESS)},error:function(e){a(MediaCallConstants.request.status.FAILED)}})},acceptCallSwitch:function(e,t){var i=new Date,a=function(t){MediaCallImpl.updateAPIResponseTimeInLog(e,"/acceptvideo",MediaCallConstants.request.method.PUT,t,i)};MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/calls/"+e+"/acceptvideo",type:MediaCallConstants.request.method.PUT,contentType:"application/json",data:{switch_video_token:t},success:function(e){a(MediaCallConstants.request.status.SUCCESS)},error:function(e){a(MediaCallConstants.request.status.FAILED)}})},declineCallSwitch:function(e,t){var i=new Date,a=function(t){MediaCallImpl.updateAPIResponseTimeInLog(e,"/declinevideo",MediaCallConstants.request.method.PUT,t,i)};MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/calls/"+e+"/declinevideo",type:MediaCallConstants.request.method.PUT,contentType:"application/json",data:{state:t},success:function(e){a(MediaCallConstants.request.status.SUCCESS)},error:function(e){a(MediaCallConstants.request.status.FAILED)}})},updateDeviceState:function(e,t,i,a){var n="audio"===t?"mic":"camera",s=new Date,o=function(t){MediaCallImpl.updateAPIResponseTimeInLog(e,"/"+n,MediaCallConstants.request.method.PUT,t,s)};MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/calls/"+e+"/"+n,type:MediaCallConstants.request.method.PUT,contentType:"application/json",data:{state:i,action_time:a},success:function(e){o(MediaCallConstants.request.status.SUCCESS)},error:function(e){o(MediaCallConstants.request.status.FAILED)}})},updateCallStatus:function(e,t,i,a,n){var s=new Date,o=function(t){MediaCallImpl.updateAPIResponseTimeInLog(e,"/status",MediaCallConstants.request.method.PUT,t,s)},r={value:t,client_time:MediaCall.BRIDGE.Util.getSyncedCurrentTime()};void 0!==n&&(r.client_support=n),MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/calls/"+e+"/status",type:MediaCallConstants.request.method.PUT,contentType:"application/json",data:r,success:function(e){o(MediaCallConstants.request.status.SUCCESS),"function"==typeof i&&i(e)},error:function(e){o(MediaCallConstants.request.status.FAILED),"function"==typeof a&&a(e)}})},sendOfferSdp:function(e,t,i,a,n,s,o,r,l){var d=new Date,c=function(t){MediaCallImpl.updateAPIResponseTimeInLog(e,"/sendoffersdp",MediaCallConstants.request.method.PUT,t,d)},u={description:t,connection_state:i,tracks_media_id:n,client_time:MediaCall.BRIDGE.Util.getSyncedCurrentTime(),turn_type:o};void 0!==s&&(u.client_support=s),void 0!==a&&a>0&&(u.reconnection_id=a),MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/calls/"+e+"/sendoffersdp",type:MediaCallConstants.request.method.PUT,contentType:"application/json",data:u,success:function(e){c(MediaCallConstants.request.status.SUCCESS),"function"==typeof r&&r(e)},error:function(e){c(MediaCallConstants.request.status.FAILED),"function"==typeof l&&l(e)}})},sendAnswerSdp:function(e,t,i,a,n,s,o){var r=new Date,l=function(t){MediaCallImpl.updateAPIResponseTimeInLog(e,"/sendanswersdp",MediaCallConstants.request.method.PUT,t,r)},d={description:t,connection_state:i,tracks_media_id:n,client_time:MediaCall.BRIDGE.Util.getSyncedCurrentTime()};void 0!==a&&a>0&&(d.reconnection_id=a),MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/calls/"+e+"/sendanswersdp",type:MediaCallConstants.request.method.PUT,contentType:"application/json",data:d,success:function(e){l(MediaCallConstants.request.status.SUCCESS),"function"==typeof s&&s(e)},error:function(e){l(MediaCallConstants.request.status.FAILED),"function"==typeof o&&o(e)}})},pullOffer:function(e,t,i){var a=new Date,n=function(t){MediaCallImpl.updateAPIResponseTimeInLog(e,"/pulloffer",MediaCallConstants.request.method.GET,t,a)};MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/calls/"+e+"/pulloffer",type:MediaCallConstants.request.method.GET,success:function(e){n(MediaCallConstants.request.status.SUCCESS),t(e)},error:function(e){n(MediaCallConstants.request.status.FAILED),"function"==typeof i&&i(e)}})},pollEvents:function(e,t,i,a){var n=new Date,s=function(t){MediaCallImpl.updateAPIResponseTimeInLog(e,"/events",MediaCallConstants.request.method.GET,t,n)};MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/calls/"+e+"/events",type:MediaCallConstants.request.method.GET,data:{sequence:t},success:function(e){s(MediaCallConstants.request.status.SUCCESS),i(e)},error:function(e){s(MediaCallConstants.request.status.FAILED),"function"==typeof a&&a(e)}})},reinit:function(e,t,i){var a=new Date,n=function(t){MediaCallImpl.updateAPIResponseTimeInLog(e,"/reinit",MediaCallConstants.request.method.PUT,t,a)};MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/calls/"+e+"/reinit",type:MediaCallConstants.request.method.PUT,success:function(e){n(MediaCallConstants.request.status.SUCCESS),"function"==typeof t&&t(e)},error:function(e){n(MediaCallConstants.request.status.FAILED),"function"==typeof i&&i(e)}})},renegotiate:function(e,t,i){var a=new Date,n=function(t){MediaCallImpl.updateAPIResponseTimeInLog(e,"/renegotiate",MediaCallConstants.request.method.PUT,t,a)};MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/calls/"+e+"/renegotiate",type:MediaCallConstants.request.method.PUT,success:function(e){n(MediaCallConstants.request.status.SUCCESS),"function"==typeof t&&t(e)},error:function(e){n(MediaCallConstants.request.status.FAILED),"function"==typeof i&&i(e)}})},updateIceCandidates:function(e,t,i,a){var n=new Date,s=function(t){MediaCallImpl.updateAPIResponseTimeInLog(e,"/icecandidate",MediaCallConstants.request.method.PUT,t,n)};if(t.length){var o={ice_candidates:t,connection_state:i,client_time:MediaCall.BRIDGE.Util.getSyncedCurrentTime()};void 0!==a&&a>0&&(o.reconnection_id=a),MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/calls/"+e+"/icecandidate",type:MediaCallConstants.request.method.PUT,contentType:"application/json",data:o,success:function(e){s(MediaCallConstants.request.status.SUCCESS)},error:function(e){s(MediaCallConstants.request.status.FAILED)}})}},updateLog:function(e,t,i){var a=new Date,n=function(t){void 0!==e&&MediaCallImpl.updateAPIResponseTimeInLog(e,"/v1/log",MediaCallConstants.request.method.POST,t,a)};void 0!==e&&(i.call_id=e);var s={purpose:"AV_CALL_LOG",action:t,data:JSON.stringify(i)},o={url:MediaCallConstants.baseUrl+"/v1/log",type:MediaCallConstants.request.method.POST,data:s,success:function(e){n(MediaCallConstants.request.status.SUCCESS)},error:function(e){n(MediaCallConstants.request.status.FAILED)}};MediaCall.isNewAVDomainRoutingEnabled()&&(o.url=o.url+MediaAPI.serialize(s),delete o.data),MediaAPI.request(o)},getRejectMessages:function(e){MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/users/"+MediaCall.BRIDGE.Constants.ZUID+"/customrejectmessages",type:MediaCallConstants.request.method.GET,success:function(t){"function"==typeof e&&e(t.messages)}})},pushCallEventLog:function(e,t,i,a){var n=new Date,s=function(t){MediaCallImpl.updateAPIResponseTimeInLog(e,"/log",MediaCallConstants.request.method.PUT,t,n)},o={};void 0!==i&&i>0&&(o.round_trip_time=Math.round(i)),void 0!==a&&(o.is_caller=a);var r={event:t,client_time:MediaCall.BRIDGE.Util.getSyncedCurrentTime(),data:o};MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/calls/"+e+"/log",type:MediaCallConstants.request.method.PUT,contentType:"application/json",data:r,success:function(e){s(MediaCallConstants.request.status.SUCCESS)},error:function(e){s(MediaCallConstants.request.status.FAILED)}})},sendClientLogData:function(e,t,i,a){MediaAPI.request({url:MediaCallConstants.baseUrl+"/v2/calls/"+e+"/clientlog",type:"POST",sendStringAsFile:!0,fileHash:{fileData:t,fileName:e,fileParamName:"logfile",formDataParams:{subject:i,description:a}}})}},MediaCallNetworkPredictorImpl=function(){var e=[],t=void 0,i=[],a=[],n=void 0,s=void 0;return{NETWORK_RTT_MAX_THRESHOLD:800,CDN_RTT_MAX_THRESHOLD:500,WMS_RTT_MAX_THRESHOLD:500,AVG_ICE_GATHERING_TIME:1500,PREDICTION_INTERVAL:1e3,POLLING_INTERVAL:5e3,states:{GOOD:1,POOR:0},isPoorNetwork:function(e){return e===this.states.POOR},addHttpRequestInfo:function(t){t.status===MediaCallConstants.request.status.SUCCESS&&(3===e.length&&e.shift(),e.push({rtt:t.endTime-t.startTime}))},startCDNPolling:function(e,a){var n=new Date;fetch(MediaCall.BRIDGE.Constants.IMGDEFAULTSTATICURL+"/av_network_prediction.png",{mode:"cors",cache:"no-store"}).then((function(a){200===a.status&&(t=new Date-n,i.push(t),"function"==typeof e&&e(t))})).catch((function(){"function"==typeof a&&a()}))},startWmsPingPongPolling:function(){void 0!==MediaCall.BRIDGE&&"function"==typeof MediaCall.BRIDGE.getWmsRtt&&MediaCall.BRIDGE.isWMSConnected()&&(a.push(MediaCallNetworkPredictorImpl.WMS_RTT_MAX_THRESHOLD),MediaCall.BRIDGE.getWmsRtt((function(e){n=e,a.pop(),a.push(n)})))},getRecentHttpRequestRtt:function(){var t=e[e.length-1];return void 0!==t&&t.rtt},startPolling:function(){this.startWmsPingPongPolling(),this.startCDNPolling()},getCDNPollingRtt:function(){return t},getWMSRtt:function(){return n},getAvgCdnRtt:function(){var e=i.length;if(e>0)return i.reduce((e,t)=>e+t,0)/e},getAvgWmsRtt:function(){var e=a.length;if(e>0)return a.reduce((e,t)=>e+t,0)/e},start:function(){clearInterval(s),s=setInterval(this.startPolling.bind(this),this.POLLING_INTERVAL),this.startPolling()},clearAllRtt:function(){e=[],t=void 0,n=void 0,i=[],a=[],clearInterval(s),s=void 0},clearPollingTimer:function(){clearInterval(s),s=void 0}}}(),(MediaCallNetworkPredictor=function(e,t,i,a){this._id=e,this._currentMemberId=t,this._otherMemberId=i,this._iceConnectionStateVsTime={},this._callAnsweredTime=void 0,this._updateUserNetworkCallback=a,this._predictionCallbackInterval=void 0,this._initialize()}).prototype={_initialize:function(){"function"==typeof this._updateUserNetworkCallback&&(clearInterval(this._predictionCallbackInterval),this._predictionCallbackInterval=setInterval(this.predictUserNetwork.bind(this),MediaCallNetworkPredictorImpl.PREDICTION_INTERVAL))},setCallAnswered:function(){this._callAnsweredTime=new Date},setIceConnectionState:function(e){this._iceConnectionStateVsTime[e]=new Date},getCallAnsweredTime:function(){return this._callAnsweredTime},getRemoteCandidatesGatheredTime:function(){return this._iceConnectionStateVsTime.checking},predictUserNetwork:function(){var e={};e[this._currentMemberId]=MediaCallNetworkPredictorImpl.states.GOOD,e[this._otherMemberId]=MediaCallNetworkPredictorImpl.states.GOOD;var t=MediaCallNetworkPredictorImpl.getRecentHttpRequestRtt(),i=MediaCallNetworkPredictorImpl.getCDNPollingRtt(),a=MediaCallNetworkPredictorImpl.getWMSRtt(),n={recentHttpReqRtt:t,CDNPollingRtt:i,WmsRtt:a};if(i>MediaCallNetworkPredictorImpl.CDN_RTT_MAX_THRESHOLD)e[this._currentMemberId]=MediaCallNetworkPredictorImpl.states.POOR;else if(a<MediaCallNetworkPredictorImpl.WMS_RTT_MAX_THRESHOLD){if(void 0!==this.getRemoteCandidatesGatheredTime())return;var s=new Date-this.getCallAnsweredTime();!isNaN(s)&&s>MediaCallNetworkPredictorImpl.AVG_ICE_GATHERING_TIME&&(e[this._otherMemberId]=MediaCallNetworkPredictorImpl.states.POOR),n.answeredToConnectedInterval=s}this._updateUserNetworkCallback(e,n)},stop:function(){MediaCallNetworkPredictorImpl.clearPollingTimer(),clearInterval(this._predictionCallbackInterval),this._predictionCallbackInterval=void 0}},(LongPollingController=function(e,t,i){this._sessionId=e,this._latestSequenceNumber=0,this._pollingTimer=void 0,this._pollingInterval=i||MediaCallConstants.LONG_POLLING_INTERVAL,this._hasPendingRequest=!1,this._callback=t,this._initialize()}).prototype={_initialize:function(){"function"==typeof this._callback&&(clearInterval(this._pollingTimer),this._pollingTimer=setInterval(this.requestEvents.bind(this),this._pollingInterval))},_setPendingRequest:function(){this._hasPendingRequest=!0},_resetPendingRequest:function(){this._hasPendingRequest=!1},setLatestSequence:function(e){this._latestSequenceNumber=e},requestEvents:function(){this._hasPendingRequest||(this._setPendingRequest(),MediaCallAPI.pollEvents(this._sessionId,this._latestSequenceNumber,function(e){this.setLatestSequence(e.next_sequence),this._resetPendingRequest(),this._callback(e.messages)}.bind(this)))},stop:function(){clearInterval(this._pollingTimer),this._pollingTimer=void 0}},MediaCallIframeHandler={$iframeElem:void 0,iframeWindow:void 0,isLoaded:!1,reloadInterval:void 0,reloadCounter:0,maxReloadLimit:3,reqIdVsCallbacks:{},getIframeUrl:function(){return(MediaCall.BRIDGE.Constants.IS_CUSTOM_DOMAIN?"":MediaCall.BRIDGE.ServerConstants.AVCLIQ_DOMAIN)+(MediaCall.BRIDGE.getUrlPrefix()+(MediaCall.BRIDGE.Constants.IS_CUSTOM_DOMAIN?"/_avcliq":""))+"/avcliq?frameorigin="+MediaCall.BRIDGE.getFrameOrigin()},init:function(){ZCJQuery("body").append('<iframe id="avcliqiframe" class="zc-av-dN" src="'+this.getIframeUrl()+'"></iframe>'),this.$iframeElem=ZCJQuery("#avcliqiframe"),this.iframeWindow=this.$iframeElem[0].contentWindow,this.bindEvents()},bindEvents:function(){window.addEventListener("message",e=>{if(MediaCall.BRIDGE.Constants.IS_CUSTOM_DOMAIN&&this.iframeWindow.origin===e.origin||e.origin===MediaCall.BRIDGE.ServerConstants.AVCLIQ_DOMAIN){var t=JSON.parse(e.data);if(void 0===t.action){if(void 0!==t.module&&"avcalls"===t.module){var i=t.reqId,a=this.reqIdVsCallbacks[i];void 0!==a&&("function"==typeof a.successCB&&void 0!==t.successResp?a.successCB(t.successResp):"function"==typeof a.errorCB&&void 0!==t.errorResp&&a.errorCB(t.errorResp))}}else"onLoad"===t.action&&(this.initModule(),this.clearReloadInterval())}},!1),this.reloadInterval=setInterval(this.reloadIframe.bind(this),8e3)},clearReloadInterval:function(){clearInterval(this.reloadInterval),this.reloadInterval=void 0},reloadIframe:function(){this.reloadCounter>this.maxReloadLimit&&(this.initModule(),this.clearReloadInterval(),MediaCallAPI.updateLog(void 0,"IFRAME_LOADING_FAILED",{loc_time:new Date,time:MediaCall.BRIDGE.Util.getSyncedCurrentTime(),zuid:MediaCall.BRIDGE.Constants.ZUID}),MediaCall.isNewAVDomainRoutingEnabled=()=>!1),this.reloadCounter+=1,this.$iframeElem[0].src=this.getIframeUrl()},dispatchAVRequest:function(e,t){var i="av_c"+(new Date).getTime();this.reqIdVsCallbacks[i]=t;var a={reqId:i,module:"avcalls",params:e};this.iframeWindow.postMessage(JSON.stringify(a),MediaCall.BRIDGE.Constants.IS_CUSTOM_DOMAIN?this.iframeWindow.origin:MediaCall.BRIDGE.ServerConstants.AVCLIQ_DOMAIN)},initModule:function(){this.isLoaded||(MediaCallImpl.init(),MediacallScreenRequestHandler.init(MediaCall.BRIDGE.getDesktopScreenCapturer()),this.isLoaded=!0)}};var MediaCallTemplates={};MediaCallTemplates=function(){var e={mainUI:'<div class="AV-call-wrapper AV-call-initial {{live_feed_class}}" callId="{{call_id}}" calltype="{{call_type}}" calleeid="{{callee_id}}" callerid="{{caller_id}}" mediacallwrapper><div class="zc-av-impulse zc-av-halignC" impulsecontainer></div><div class="AV-call-main" maincontainer><div class="AV-call-section" callsection><div class="AV-call-videowrapper" videowrapper><div class="{{caller_class}}" mediacallbuttons purpose="switchView">{{caller_video_container}}<div class="AV-call-videodrag" tempvideocontainer></div></div><div class="{{callee_class}}" mediacallbuttons purpose="switchView">{{callee_video_container}}<div class="AV-call-videodrag" tempvideocontainer></div></div><div class="{{screen_class}}" screenvideowrapper mediacallbuttons purpose="switchView">{{screen_container}}<div class="AV-call-videodrag" tempvideocontainer></div></div><div class="{{wb_class}}" wbwrapper mediacallbuttons purpose="switchView">{{wb_container}}<div class="AV-call-videodrag" tempvideocontainer></div></div></div></div>{{initial_cnt}}</div>{{adhoc_call_state_container}}<div class="hudl-aside"><div id="mediacallchatsection" class="zcmcembd chtwndws zcsmallchat zcmsgbothside"></div></div></div>',replyUI:'<div id="rejectmessagedialog" class="zc-av-rejecbox-cont"><div class="zc-av-rejecbox-hdr"><div class="zc-av-usr-img"><img class="bdrR100 zc-bdrR100 wh100 zc-wh100" src="{{user_img}}"></div><div class="zc-av-ellips zc-av-flexG"><div class="zc-av-ellips zc-av-fontB zc-av-font15">{{caller_name}}</div><div class="zc-av-clr-S zc-av-font13 zc-av-mT5" callstatus>{{call_status}}</div></div><div class="zc-av-flexC zc-av-mL15" rejectboxbuttongroup>{{incoming_call_btns}}</div></div><div class="zc-av-rejecbox-main"><div class="zc-av-pLR16"><div class="zc-av-call-hdrline zc-av-clr-S">{{message_header}}</div><div class="zc-av-mT15 zc-av-posrel"><input class="zc-av-rejectbox-input" mediacallinput inputname="rejectTextBox" type="text" name="" placeholder="{{custom_placeholder}}"><span class="zc-av-send zcf-send cur" mediacallbuttons disabled purpose="sendCustomRejectMessage"></span></div></div>{{reject_messages}}</div></div>',replyMessageListUI:'<div class="zc-av-mT15 zc-av-fontB" >{{video_reply_msg}}<div class="zc-av-mB10 cur zc-av-line18 zc-av-list" mediacallbuttons purpose="sendDefaultRejectMessage">{{reply_msg1}}</div><div class="zc-av-mB10 cur zc-av-line18 zc-av-list" mediacallbuttons purpose="sendDefaultRejectMessage">{{reply_msg2}}</div><div class="zc-av-mB10 cur zc-av-line18 zc-av-list" mediacallbuttons purpose="sendDefaultRejectMessage">{{reply_msg3}}</div></div><div id="customrejectmessages" class="zc-av-fontB">{{custom_reject_msg}}</div>',rejectMessage:'<div class="zc-av-mB10 cur zc-av-line18 {{margin_class}} zc-av-list" mediacallbuttons purpose="sendDefaultRejectMessage">{{preset_msg}}</div>',videoContainer:'<div class="AV-call-videocontainer AV-call-video-muted" videocontainer userId="{{user_id}}">{{buffer_loader}}{{user_image_cnt}}<video class="AV-call-video zc-wh100 zc-av-posrel"></video><div class="AV-call-info zc-av-flexC" useractioninfo>{{health_meter_cnt}}<span class="zcf-mic-mute AV-call-mute zc-av-dN" audioMutedStatus></span></div><div class="AV-call-swap zcf-swap zc-av-alignM zc-av-flexM"></div></div>',screenContainer:'<div class="AV-call-videocontainer" screencontainer userId="{{user_id}}">{{buffer_loader}}{{user_image_cnt}}<video class="AV-call-video zc-wh100 zc-av-posrel"></video><div class="AV-call-swap zcf-swap zc-av-alignM zc-av-flexM"></div></div>',whiteBoardContainer:'<div class="AV-call-videocontainer wb-cont-min dN" videocontainer><div class="zc-av-alignM zc-av-flexM zcf-whiteboard font30"></div><div class="AV-call-swap zcf-swap zc-av-alignM zc-av-flexM"></div></div><div id="whiteBoardContainer" class="AV-call-wbcontainer flexM flex-col" whiteboardcontainer><div class="AV-call-wb wh100 flex-col mT50"><div class="AV-call-wb-topbar fshrink"><span id="wb_title" class="wb-tpbr-itm p5 flexG pL15 font14">{{title}}</span><span id="wb_participants" class="flexC wb-tpbr-itm"></span><span class="wb-tpbr-sep"></span><span class="zcf-more wb-tpbr-itm curP" whiteboardbutton data-uid="{{data_uid}}" associate-id="{{associate_id}}" associate-type="{{associate_type}}" purpose="showOptions"></span><span class="wb-tpbr-sep"></span><span class="zcf-fullscrn wb-tpbr-itm curP" whiteboardbutton targetElemId="whiteBoardContainer" purpose="openInFullScreen" av-tooltip-title="{{open_full_screen}}"></span></div><div class="wb-if-box wb-if-br wb-iframe flexG posrel">{{buffer_loader}}<iframe class="wb-if-br wh100 posA vsbH" {{src_url}} data-uid="{{data_uid}}" enablejsapi="1" frameBorder="0"></iframe></div></div></div>',share_options:'<div id="{{id}}shrdropdownopt" class="AV-call-box AV-call-hover zcf-sharemedia" av-tooltip-title="{{share_title}}" mediacallbuttons purpose="shareOptions"></div>',initialStateCnt:'<div class="AV-call-status {{call_state_class}}" initialcontainer>{{user_image_cnt}}{{info_cnt}}{{options_cnt}}</div>',incomingCallBtns:'<div class="AV-call-box {{answer_audio_btn_class}} AV-call-box-ans zc-av-mR15 av-tooltip-up" av-tooltip-title="{{answer_title}}" mediacallbuttons purpose="answerCall" answertype="audio"></div><div class="AV-call-box {{answer_video_btn_class}} AV-call-box-ans zc-av-mR15 av-tooltip-up" av-tooltip-title="{{answer_title}}" mediacallbuttons purpose="answerCall" answertype="audio_video"></div><div class="AV-call-box {{decline_icon_class}} AV-call-box-end av-tooltip-up" av-tooltip-title="{{decline_title}}" mediacallbuttons purpose="endCall"></div>',incomingOptCnt:'<div class="zc-av-flexC zc-av-mT15" incomingcalloptions>{{incoming_call_btns}}</div><div class="AV-call-decline-box av-tooltip-up" av-tooltip-title="{{decline_msg_btn_title}}" mediacallbuttons purpose="showDeclineReasons"><span class="zcf-chat zc-av-font16"></span></div>',endButtonGroup:'<div class="AV-call-box AV-call-box-initial {{primaryBtn_class}}" title="{{primaryBtn_title}}" mediacallbuttons purpose="{{primaryBtn_purpose}}"></div><div class="AV-call-box-initial AV-call-box zc-av-mL12 AV-call-box-wide-btn {{secondaryBtn_class}}" title="{{secondaryBtn_title}}" mediacallbuttons purpose="{{secondaryBtn_purpose}}">{{secondaryBtn_icon}}<span class="{{secondaryBtn_title_class}}">{{secondaryBtn_title}}</span></div>',endCallOptCnt:'<div class="zc-av-flexC zc-av-mT15" endedcalloptions><div buttonGroup class="zc-av-flexC zc-av-fontB">{{button_group_html}}</div><div class="AV-call-box AV-call-box-initial zcf-closeB zc-av-mL20 AV-call-box-close" title="{{close_title}}" mediacallbuttons purpose="closeEndCall"></div></div>',stopRecordingBtn:'<div class="AV-call-box AV-call-box-record-stop" title="{{stop_recording_title}}" mediacallbuttons purpose="stopMediaRecording"><svg width="44" height="44" style="z-index: 1;"><circle class="zc-av-circle" r="19.5" cx="22" cy="22" fill="transparent"></circle><circle class="zc-av-circle zc-av-circle-bar" id="recording-progress" r="19.5" cx="22" cy="22" fill="transparent" stroke-dasharray="122"></circle></svg><span class="zc-av-stop-record {{btn_class}}"></span></div>',initialStateOptCnt:'<div class="zc-av-flexC zc-av-mT20" calloptions><div class="AV-call-box zcf-call AV-call-box-end zc-av-mL0 zc-call-end av-tooltip-up" av-tooltip-title="{{title}}" mediacallbuttons purpose="endCall"></div></div>',shareOptionsDropDownItem:'<div class="AV-call-menu-item {{custom_class}}" mediacallbuttons purpose="{{purpose}}"><span icon class="AV-call-menu-icon {{icon}} zc-av-mR10"></span><span content>{{content}}</span></div>',optionsDropDownItem:'<div class="AV-call-menu-item {{custom_class}}" mediacallbuttons purpose="{{purpose}}"><span icon class="AV-call-menu-icon {{icon}} zc-av-mR10"></span><span content>{{content}}</span>{{disabled_info}}</div>',callOptionsTop:'<div class="AV-call-top"><div class="zc-av-flexG"><div id="mediacallsessiontimer" class="zc-av-font13 AV-call-timer"></div>{{status_cnt}}</div><div class="AV-call-health-status zc-av-flexC">{{health_meter_cnt}}<div class="zc-av-mL6">{{health_label}}</div></div></div>',callOptionsCnt:'<div class="AV-call-right">{{call_options_top}}<div class="AV-call-bottom"><div class="zc-av-flexG zc-av-ellips zc-av-mR10">{{name_cnt}}</div>{{av_recording_indicator}}<div class="zc-av-flexC zc-av-fshrink AV-call-options" calloptions><div class="AV-call-box AV-call-hover zcf-mic" title="{{audio_mute_title}}" mediacallbuttons purpose="turnOffMicrophone"></div><div class="AV-call-box AV-call-hover zcf-video {{video_mute_display}}" title="{{video_mute_title}}" mediacallbuttons purpose="turnOffCamera"></div><div class="AV-call-box zcf-audio AV-call-box-end" title="{{end_title}}" mediacallbuttons purpose="endCall"></div>{{share_options}}{{toggle_chat_opt}}<div id="{{id}}dropdownopt" class="AV-call-box AV-call-hover zcf-moreS" mediacallbuttons purpose="showMoreOptions"></div></div><div class="AV-call-mini-btn zc-av-dN" title="{{minimize_title}}" mediacallbuttons purpose="showMiniPlayer"><div class="AV-call-box AV-call-hover zcf-mini-player2"></div></div></div></div>{{full_screen_opt}}',switchNotifyCnt:'<div class="AV-call-switch-con" switchnotifycnt><div class="zc-av-font14 zc-av-fontB zc-av-line22 zc-av-ellips-L3">{{content}}</div><div class="zc-av-flexM zc-av-mT15"><div class="AV-call-btn AV-call-btn--secondary zc-av-mR15 zcl-btn_dark zc-av-ellips" mediacallbuttons purpose="declineSwitchToVideo">{{ignore}}</div><div class="AV-call-btn AV-call-btn--primary" mediacallbuttons purpose="switchToVideo"><span class="zcf-video zc-av-mR10"></span><span class="zc-av-ellips">{{accept}}</span></div></div></div>',curentUserNetworkHealthCnt:'<div class="AV-call-health-box">{{health_meter}}<span>{{health_label}}</span></div>',addParticipantsWinHtml:'<div id="addcallparticipants-usersuggest" class="mcontent"><div class="zcl-win-modal1-hdr fshrink"><div class="w100 justifySB flexC pTB10"><div class="font17 fontB ">{{header_title}}</div><span purpose="closeAddParticipantWin" mediacallbuttons class="zchat-close zcl-icon-lg zcl-icon--filled2"></span></div></div><div class="zcl-win-modal1-srch fshrink"><div class="zcl-search2"><span class="zcf-search2 zcl-seach-icon"></span><div class="zcl-search-input"><input type="text" id="addcallparticipants-usersuggest-search-field" placeholder="{{user_search_placeholder}}"></div></div></div><div id="addcallparticipants-usersuggest-results" class="zcrchtlt flexG"><div id="addcallparticipants-usersuggest-list" class="posl w100 h100"></div></div><div class="zcl-win-modal1-footr fshrink mT5"><div id="calltitleheader" class="footr-dividr flexC footr-padding"><div class="w100 flexC"><div class="fshrink font14 fontB clr-M pR25">{{call_title}}</div><input mediacallinput inputname="adhoccalltitle" type="text" class="zcl-input zcl-input-sm"  placeholder="{{call_title_placeholder}}"></div></div><div class="w100 justifySB flexC footr-padding"><div id="usernodecnt" class="zcrchicnt flexG"><div id="addcallparticipants-usersuggest-select-field" contenteditable="false" class="">{{default_participants}}</div></div><div purpose="ringAllParticipants" mediacallbuttons disabled class="fshrink mL15 zcl-btn-sm zcl-btn--primary">{{ring_btn}}</div></div></div></div>',selectedParticipantHtml:'<div uid="{{user_id}}" elemtype="{{elem_type}}" title="{{user_name}}" nodetype="@" class="dIB zcricnt posl"><img class="w100 h100" src="{{user_img}}"/>{{remove_user_btn}}</div>',bottomStatusContainer:'<div adhoccallstatus class="AV-call-footer zc-av-flexC"><div class="zcf-users"></div><div statustext class="zc-av-mL12"></div></div>',settingsLayoutHtml:'<div class="flexC smartconf-setting-main wh100">\n\t\t      <div class="fshrink smartconf-setting-lhs h100">\n\t\t         <div class="font18 fontB zcl-hdrline">{{settings_header}}</div>\n\t\t         <div id="av-settings-lhs" class="mT20">\n\t\t\t\t\t{{settings_lhs_html}}\n\t\t         </div>\n\t\t      </div>\n\t\t      <div class="flexG ovrflwH h100">\n\t\t      \t<div id="av_settings_body" class="flexG flex-col ovrflwH h100">\n\t\t      \t\t{{settings_body_html}}\n\t\t      \t</div>\n\t\t      </div>\n\t    \t</div>',settingsBodyHtml:'<div class="zcl-win-subcategory fshrink conf-config pT10 pB10">\n\t\t        <div class="flexC curD">{{settings_body_header}}</div>\n\t\t    </div>\n\t\t    {{configurations_html}}',deviceDropdownListItem:'<div class="zcl-menu-item" deviceid="{{device_id}}" devicelabel="{{device_name}}" mediadevicewidgetbutton purpose="selectDevice">\n\t\t        <div class="flexG ellips">{{device_name}}</div>\n\t\t  </div>',eachDeviceCategoryHtml:'<div id="{{category}}dropdowncnt" class="flexC smartconf-device-drpdwn" selecteddeviceid="{{selected_device_id}}" dropdowncnt devicekind="{{category}}">\n\t\t      <div class="flexG">{{label}}</div>\n\t\t      <div class="mLR40 textL w50 zcl-dropdown-wrp">\n\t\t         <div class="zcl-dropdown-input" mediacallbuttons purpose="openDevicesDropDown"><span class="font14 fshrink zcl-dropdown-icon {{icon}}"></span><span class="zcl-dropdown-label ellips" dropdowninput>{{selected_device_name}}</span><span class="zcf-downArrow fon12 fshrink zcl-dropdown-icon"></span></div>\n\t\t         <div id="{{category}}dropdown" class="zcl-menu-wrap no-pointer" dropdown style="display: none;">\n\t\t            {{devices_dropdown_list_html}}\n\t\t         </div>\n\t\t      </div>\n\t\t </div>',deviceSettingsHtml:'<div class="zcl-win-subcategory fshrink conf-config pT10 pB10">\n\t\t   <div class="flexC curD">{{settings_title}}</div>\n\t\t</div>\n\t\t<div id="media_device_widget" class="mT30 pLR30">\n    \t \t{{category_list_html}}\n\t\t</div>',videoEffectsSettings:'<div class="flexG flex-col ovrflwH">\n\t\t\t<div class="zcl-win-subcategory conf-config pT10 pB10" zc_running_title>{{header}}</div>\n\t\t\t<div class="smartconf-video-effects-preview flexM fshrink">\n\t\t\t\t<div id="video_effect_preview_dom" class="smartconf-video-effects-videocnt flexM"><video class="wh100 bdrI"></video>\n\t\t\t\t\t<div class="zcl-rloader posabs sm" loader></div>\n\t\t\t\t\t<div class="smartconf-userimg posabs dN" user_image>\n\t\t\t\t\t\t<img src="{{img_src}}">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t{{palet}}\n\t\t\t<div class="smartconf-video-effects-ftr justifyE fshrink flexC pLR36 mTB20 dN">\n\t\t\t\t{{remember_choise}}\n\t\t\t\t<div class="fshrink">\n\t\t\t\t\t<div class="zcl-btn-sm zcl-btn--secondary mR20" mediacallbuttons purpose="closeVideoEffectsPanel">{{cancel_btn}}</div>\n\t\t\t\t\t<div class="zcl-btn-sm zcl-btn--primary" mediacallbuttons purpose="setVideoEffects">{{apply_btn}}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>'},t=function(t,a){return i(e.screenContainer,t,a)},i=function(e,t,i){var a=MediaCall.isNetworkIndicatorEnabled()?$WC.template.replace('{{health_meter}} <span class="AV-call-health-meter-text zc-av-dN"></span>',{health_meter:MediaTemplates.getNetworkHealthIndicatorHtml({customAttribute:"userId="+t})},"InSecureHTML"):"",n=$WC.template.replace(e,{buffer_loader:MediaTemplates.getBufferLoader("zc-av-dN"),user_image_cnt:MediaTemplates.userImageContainer,health_meter_cnt:a},"InSecureHTML");return $WC.template.replace(n,{user_id:t,user_name:MediaCall.BRIDGE.Users.getName(t,i),user_img:MediaCall.BRIDGE.Users.getImgUrlById(t),user_image_display_class:"",user_image_onload:""})},a=function(t){var i={};i[MediaCallConstants.types.AUDIO]={answerIcon:"zcf-call",declineIcon:"zcf-call zc-call-end"},i[MediaCallConstants.types.VIDEO]={answerIcon:"zcf-video",declineIcon:"zcf-call zc-call-end"},i[MediaCallConstants.types.SCREEN_SHARE_WITH_AUDIO]=i[MediaCallConstants.types.SCREEN_SHARE]={answerIcon:"zcf-sharescrn",declineIcon:"zcf-scrn-shr-stop"};var a=t.getType(),n=a===MediaCallConstants.types.VIDEO;return $WC.template.replace(e.incomingCallBtns,{answer_audio_btn_class:n?"zcf-call":i[a].answerIcon+" zc-av-mR30",answer_video_btn_class:n?"zcf-video":"zc-av-dN",decline_icon_class:i[a].declineIcon,$answer_title:"common.accept",$decline_title:"common.decline"})},n=function(t){var i="",n='<div class="zc-av-font15 zc-av-fontB zc-av-ellips zc-av-usrname" username>{{user_name}}</div><div class="zc-av-font13 zc-av-ellips zc-av-textC zc-av-flexC zc-av-callstatus"><span statuscontent>{{content}}</span><span class="zcf-failed AV-call-warning zc-av-dN" networkindicator></span></div>',s="videochat.message.calling",o=t.getOtherMember(),r="AV-call-incoming";if(t.isCaller(MediaCall.BRIDGE.Constants.ZUID))r="AV-call-outgoing",i=$WC.template.replace(e.initialStateOptCnt,{$title:"videochat.endcall"});else{var l=t.getType();s=MediaCall.isAudioCall(l)?"videochat.incomming.audio":"videochat.incomming.video",(MediaCall.isScreenShareWithAudioCall(l)||MediaCall.isScreenShare(l))&&(s="videochat.incomming.screen",n='<div class="zc-av-font15 zc-av-fontB zc-av-mT15 zc-av-ellips zc-av-usrname" username>{{user_name}}</div><div class="zc-av-mT15 zc-av-font13 zc-av-ellips zc-av-textC" statuscontent>{{content}}</div>'),i=$WC.template.replace(e.incomingOptCnt,{incoming_call_btns:a(t)},"InSecureHTML"),i=$WC.template.replace(i,{$decline_msg_btn_title:"common.decline"})}var d=$WC.template.replace(e.initialStateCnt,{user_image_cnt:'<div class="usr-img-cnt zc-usr-img-cnt bdrR100 zc-bdrR100 zc-av-mT15" userimagecnt><img class="bdrR100 zc-bdrR100 wh100 zc-wh100" user_image src="{{user_img}}"></div>',info_cnt:n,options_cnt:i},"InSecureHTML");return $WC.template.replace(d,{call_state_class:r,user_name:void 0!==o.getName()?o.getName():"",user_img:MediaCall.BRIDGE.Users.getImgUrlById(o.getId()),$content:s})},s=function(){return $WC.template.replace(e.switchNotifyCnt,{$content:"mediacall.share.video.request",$ignore:"mediacall.share.video.ignore",$accept:"mediacall.share.video"})},o=function(t){var i=t.isVideoCall()?$WC.template.replace(e.rejectMessage,{$preset_msg:"videochat.incommingreply.video.msg1",margin_class:""},"InSecureHTML"):"",a="";if(MediaCallRejectMessages.hasCustomMessage()){for(var n=MediaCallRejectMessages.getCustomMessageList(),s=n.length,o=0;o<s-1;o++)a+=$WC.template.replace(e.rejectMessage,{preset_msg:n[o].msg,margin_class:""});a+=$WC.template.replace(e.rejectMessage,{preset_msg:n[s-1].msg,margin_class:"mB5"})}return $WC.template.replace(e.replyMessageListUI,{video_reply_msg:i,custom_reject_msg:a,$reply_msg1:"videochat.incommingreply.msg1",$reply_msg2:"videochat.incommingreply.msg2",$reply_msg3:"videochat.incommingreply.msg3"},"InSecureHTML")},r=function(e,t,i,a){return $WC.template.replace('<div id="{{id}}" class="flexC mT30 zcl-list-item2 mR10" settingstab mediacallbuttons purpose="{{purpose}}"><span class="{{icon_class}} zcl-img md flexM fshrink mR10"></span>{{label}}</div>',{id:e,icon_class:i,purpose:a,$label:t})};return{getMainUIHtml:function(a){var s=a.getCaller(),o=a.getCallee(),r="",l="",d=a.isLiveFeedAssociated()?"AV-call-live-feed":"",c="AV-call-mainview",u="AV-call-subview";o.getId()===MediaCall.BRIDGE.Constants.ZUID&&(a.isScreenShareWithAudioCall()||a.isScreenShare())&&(l="AV-call-mainview",c="AV-call-subview",u="AV-call-subview-2",r=t(s.getId(),s.getName()));var C=MediaCall.BRIDGE.isContainerDeatchOnMinimizeDisabled()?'<div id="mediacall_container" class="AV-call-container AV-call-detached" detached>'+e.mainUI+"</div>":e.mainUI,p=$WC.template.replace(C,{initial_cnt:n(a),caller_class:s.getId()===MediaCall.BRIDGE.Constants.ZUID?u:c,callee_class:o.getId()===MediaCall.BRIDGE.Constants.ZUID?u:c,screen_class:l,wb_class:"flexM",wb_container:"",screen_container:r,live_feed_class:d,caller_video_container:i(e.videoContainer,s.getId(),s.getName()),callee_video_container:i(e.videoContainer,o.getId(),o.getName()),adhoc_call_state_container:e.bottomStatusContainer},"InSecureHTML");return $WC.template.replace(p,{call_id:a.getId(),caller_id:a.getCaller().getId(),callee_id:a.getCallee().getId(),call_type:a.getType(),$end_title:"videochat.endcall"})},getOptionsHtml:function(t){var i=$WC.template.replace(e.callOptionsTop,{health_meter_cnt:MediaCall.isNetworkIndicatorEnabled()?MediaTemplates.getNetworkHealthIndicatorHtml({customAttribute:"userId="+t.getCurrentMember().getId()}):"",status_cnt:t.isAudioLayoutRequired()?'<div class="zc-av-font13 AV-call-top-status zc-av-dN" topstatuscnt></div>':""},"InSecureHTML"),a="";MediaCall.isWhiteBoardAllowed(t)&&(a=$WC.template.replace(e.share_options,{$share_title:"common.share"}));var n=$WC.template.replace(e.callOptionsCnt,{name_cnt:t.isAudioLayoutRequired()?'<div class="zc-av-font15 zc-av-fontB zc-av-ellips AV-call-statuscnt" username>{{user_name}}</div>':"",full_screen_opt:'<div class="AV-call-box AV-call-hover zcf-maximize AV-call-fullscrn-box" mediacallbuttons purpose="maximizeWindow"></div>',toggle_chat_opt:void 0===MediaCall.BRIDGE||void 0!==MediaCall.BRIDGE.handleChatInRhs?'<div class="AV-call-box AV-call-fullscrn-opt AV-call-hover zcf-chat" title="{{chat_title}}" mediacallbuttons purpose="openChatInRHS"></div>':"",video_mute_display:t.isVideoCall()?"":"zc-av-dN",call_options_top:i,share_options:a,av_recording_indicator:MediaCall.isRecordingAllowed()?MediaTemplates.getRecordingIndicator("AV-recording-indicator"):""},"InSecureHTML");return $WC.template.replace(n,{id:t.getId(),user_name:t.getOtherMember().getName(),$chat_title:"common.chat",$audio_mute_title:"common.micoff",$video_mute_title:"videochat.cameraoff",$end_title:"videochat.endcall",$minimize_title:"videochat.minimize",$health_label:MediaCall.isNetworkIndicatorEnabled()?"network.strength.title":""})},getMoreOptionsHtml:function(t){var i=MediaCall.BRIDGE.Constants.IS_GUEST_USER,a=$WC.template.replace(e.optionsDropDownItem,{purpose:"setMediaDevices",disabled_info:"",custom_class:"",icon:"zcf-setting",$content:"videochat.settings.devicesettings"});if(MediaCall.isVideoEffectsEnabled()&&(a=$WC.template.replace(e.optionsDropDownItem,{purpose:"openSettings",custom_class:"",disabled_info:"",icon:"zcf-setting",$content:"common.settings"})),!MediaCall.isWhiteBoardAllowed(t)&&MediaCall.BRIDGE.isScreenShareAllowed()){var n=t.getCurrentMember().isSharingScreen();a+=$WC.template.replace(e.optionsDropDownItem,{purpose:n?"stopScreenShare":"startScreenShare",disabled_info:"",custom_class:n?"AV-call-selected":"",icon:n?"zcf-scrn-shr-stop":"zcf-sharescrn",$content:n?"media.screenshare.end":"media.screenshare.start"})}t.getCurrentMember().hasSwitchedToVideo()||t.isMigratedForRecording()||(a+=$WC.template.replace(e.optionsDropDownItem,{purpose:"switchToVideo",custom_class:"",disabled_info:"",icon:"zcf-video",$content:"mediacall.share.video"}));var s=MediaCallUI.getMediaCallWrapper(t.getId());if(MediaCallUI.isInFullScreenView(s)||"function"!=typeof MediaCall.BRIDGE.handleChatOpen||(a+=$WC.template.replace(e.optionsDropDownItem,{purpose:"openChat",custom_class:"",disabled_info:"",icon:"zcf-chat",$content:"mediacall.chat.open"})),!i&&MediaCall.isNotebookIntegrationSupported()&&(a+=$WC.template.replace(e.optionsDropDownItem,{purpose:"takeNotes",custom_class:"",disabled_info:"",icon:"zcf-notebook",$content:"common.notes"})),!i&&MediaCall.isAdhocCallConversionEnabled()&&t.getCurrentMember().isAdhocCallingSupported()){var o=!(c=t.getOtherMember()).isAdhocCallingSupported(),r=t.isInMigratingState()||o,l="";o&&(l=$WC.template.replace('<span class="zcf-failed AV-call-warning" title="{{info_text}}"></span>',{$info_text:["mediacall.add.users.unsupported.info",MediaCall.BRIDGE.Users.getName(c.getId(),c.getName())]}));var d=$WC.template.replace(e.optionsDropDownItem,{purpose:"addParticipantsToCall",custom_class:r?"AV-call-menu-disabled":"",icon:"zcf-memberAdd",$content:"mediacall.users.add"});a+=$WC.template.replace(d,{disabled_info:l},"InSecureHTML")}if(!i&&MediaCall.isRecordingAllowed()&&!t.isInMigratingState()&&t.getCurrentMember().isRecordingSupported()){o=!(c=t.getOtherMember()).isRecordingSupported(),r=t.isInMigratingState()||o,l="";var c,u=t.getCurrentMember().isRecording();o&&(l=$WC.template.replace('<span class="zcf-failed AV-call-warning" title="{{info_text}}"></span>',{$info_text:["mediacall.add.users.unsupported.info",MediaCall.BRIDGE.Users.getName(c.getId(),c.getName())]}));var C=$WC.template.replace(e.optionsDropDownItem,{purpose:u?"stopCallRecording":"startCallRecording",custom_class:u?"AV-call-selected":r?"AV-call-menu-disabled":"",icon:"AV-call-record-icon AV-call-record-icon-circle flexM zcl-menu-item-icn",$content:u?"media.recording.stop":"media.recording.start"});a+=$WC.template.replace(C,{disabled_info:l},"InSecureHTML")}return $WC.template.replace('<div id="{{id}}dropdowncnt" class="AV-call-moreOpt">{{options}}</div>',{id:t.getId(),options:a},"InSecureHTML")},getShareOptionsHtml:function(t){var i="";if(MediaCall.BRIDGE.isScreenShareAllowed()){var a=t.getCurrentMember().isSharingScreen();i+=$WC.template.replace(e.optionsDropDownItem,{purpose:a?"stopScreenShare":"startScreenShare",disabled_info:"",custom_class:a?"AV-call-selected":"",icon:a?"zcf-scrn-shr-stop":"zcf-sharescrn",$content:a?"media.screenshare.end":"media.screenshare.start"})}if(MediaCall.isWhiteBoardAllowed(t)){var n=t.hasWhiteBoard();i+=$WC.template.replace(e.shareOptionsDropDownItem,{purpose:n?"stopWhiteBoard":"startWhiteBoard",custom_class:n?"zcl-neg-menu-item":"",icon:n?"zcf-whiteboard-end":"zcf-whiteboard",$content:n?"whiteboard.stop":"whiteboard.start"})}return $WC.template.replace('<div id="{{id}}shrdropdowncnt" class="AV-call-moreOpt">{{options}}</div>',{id:t.getId(),options:i},"InSecureHTML")},getScreenVideoContainerHtml:t,getWhiteBoardContainerHtml:function(t,i){var a=i&&i.hasWhiteBoard()?i.getCurrentWhiteBoardId():"",n=i&&i.hasWhiteBoard()?WhiteBoard.getBoardURL(a,i.getId()):"";return $WC.template.replace(e.whiteBoardContainer,{title:t,buffer_loader:MediaTemplates.getBufferLoader(),data_uid:a,associate_id:i.getId(),$open_full_screen:"media.open.fullscreen",associate_type:"direct_call",src_url:n?'src="'+n+'"':""},"InSecureHTML")},getSwitchNotifyCntHtml:s,getSwitchNotifyCntHtml:s,getEndOptionsHtml:function(t,i){var a=$WC.template.replace(e.endButtonGroup,{secondaryBtn_icon:i?'<em class="zcf-call-again zc-av-font20"></em>':""},"InSecureHTML");return a=$WC.template.replace(e.endCallOptCnt,{button_group_html:a},"InSecureHTML"),$WC.template.replace(a,{secondaryBtn_class:"",primaryBtn_class:"zcf-mic zc-av-font20",secondaryBtn_title_class:"zc-av-mL6",primaryBtn_purpose:"startMediaRecording",secondaryBtn_purpose:"callAgain",$primaryBtn_title:"mediacall.voicenote.record",$secondaryBtn_title:"mediacall.callagain",$close_title:"common.cancel"})},getStopRecordingBtnSet:function(){return $WC.template.replace(e.stopRecordingBtn,{$stop_recording_title:"videobroadcast.stop",btn_class:"zcf-stop-record"})},getPlayRecordingBtnSet:function(){return $WC.template.replace(e.endButtonGroup,{secondaryBtn_icon:"",secondaryBtn_title_class:"",secondaryBtn_class:"AV-call-send-record",primaryBtn_class:"zcf-newplay",primaryBtn_purpose:"playRecording",secondaryBtn_purpose:"sendRecording",$primaryBtn_title:"common.play",$secondaryBtn_title:"common.send"})},getRejectMessageDialogHtml:function(t){var i=t.getCaller(),n=i.getId(),s=i.getName(),r=t.getType(),l="videochat.incomming.screen";return r===MediaCallConstants.types.AUDIO?l="videochat.incomming.audio":r===MediaCallConstants.types.VIDEO&&(l="videochat.incomming.video"),$WC.template.replace(e.replyUI,{reject_messages:o(t),incoming_call_btns:a(t),user_img:MediaCall.BRIDGE.Users.getImgUrlById(n),caller_name:MediaCall.BRIDGE.Users.getName(n,s),$message_header:"videochat.incomming.sendmsg",$custom_placeholder:"videochat.incomming.custmsg",$call_status:l},"InSecureHTML")},getRejectBoxCloseBtn:function(){return $WC.template.replace('<div class="AV-call-box zcf-close av-tooltip-up" av-tooltip-title="{{close_title}}" mediacallbuttons purpose="closeRejectMsgBox"></div>',{$close_title:"common.close"})},getAddParticipantsWinHtml:function(t){var i=t.getMembers(),a="";for(var n in i)a+=this.getSelectedParticipantHtml(n,"contact",!1);var s=$WC.template.replace(e.addParticipantsWinHtml,{default_participants:a},"InSecureHTML");return $WC.template.replace(s,{$header_title:["mediacall.addusers.title",t.getOtherMember().getName()],$call_title:"common.topic",$call_title_placeholder:"quickchat.input.placeholder",$user_search_placeholder:"quickchat.node.placeholder",$ring_btn:"conference.ring.all"})},getSelectedParticipantHtml:function(t,i,a){var n=$WC.template.replace(e.selectedParticipantHtml,{remove_user_btn:a?'<div class="zcf-close dN" purpose="deleteSelectedNode"></div>':"",user_id:t,elem_type:i,user_img:MediaCall.BRIDGE.Users.getImgUrlById(t)},"InSecureHTML");return $WC.template.replace(n,{user_name:MediaCall.BRIDGE.Users.getName(t)})},getSettingsLayoutHtml:function(t){var i=t.isVideoCall()||t.getCurrentMember().hasSwitchedToVideo()||t.getOtherMember().hasSwitchedToVideo(),a=r("av-devicesetting-lhs","videochat.settings.devicesettings","zcf-device-setting","setMediaDevices");MediaCall.isVideoEffectsEnabled()&&i&&(a+=r("av-video-effects-lhs","cc.video.effects","zcf-video-blur","switchToVideoEffects"));var n=$WC.template.replace(e.settingsLayoutHtml,{settings_lhs_html:a,settings_body_html:""},"InSecureHTML");return $WC.template.replace(n,{$settings_header:"common.settings"})},getDeviceSettingsHtml:function(t,i){var a=[],n=[],s=[];function o(t){var a="",n=void 0;return t.forEach((function(t){(ZCMediaDevices.isAudioInputDevice(t)?i[ZCMediaDevices.kinds.AUDIO_INPUT]&&i.audioInputDeviceId==t.deviceId:ZCMediaDevices.isAudioOutputDevice(t)?i[ZCMediaDevices.kinds.AUDIO_OUTPUT]&&i.audioOutputDeviceId==t.deviceId:i[ZCMediaDevices.kinds.VIDEO_INPUT]&&i.videoInputDeviceId==t.deviceId)&&(n=t),a+=$WC.template.replace(e.deviceDropdownListItem,{device_id:t.deviceId,device_name:t.label})})),n=void 0===n&&t.length?t[0]:n,{html:a,selected:n}}function r(t,i,a,n,s){var o=void 0!==s.selected,r=$WC.template.replace(e.eachDeviceCategoryHtml,{$label:i,icon:a,selected_device_id:o?s.selected.deviceId:"",selected_device_name:o?s.selected.label:MediaCall.BRIDGE.Resource.getRealValue("videochat.settings.nodevice"),category:n});return r=$WC.template.replace(r,{devices_dropdown_list_html:s.html},"InSecureHTML")}t.forEach((function(e){ZCMediaDevices.isVideoInputDevice(e)?a.push(e):ZCMediaDevices.isAudioInputDevice(e)?n.push(e):s.push(e)}));var l="";i[ZCMediaDevices.kinds.VIDEO_INPUT]&&(l+=r(0,"emoji.camera","zcf-video",ZCMediaDevices.kinds.VIDEO_INPUT,o(a))),i[ZCMediaDevices.kinds.AUDIO_INPUT]&&(l+=r(0,"emoji.microphone","zcf-mic",ZCMediaDevices.kinds.AUDIO_INPUT,o(n))),i[ZCMediaDevices.kinds.AUDIO_OUTPUT]&&(l+=r(0,"videochat.settings.soundoutput","msi-ldspeaker",ZCMediaDevices.kinds.AUDIO_OUTPUT,o(s)));var d=$WC.template.replace(e.deviceSettingsHtml,{category_list_html:l},"InSecureHTML");return $WC.template.replace(d,{$settings_title:"videochat.settings.devicesettings"})},getVideoEffectsPanel:function(t){var i=MediaTemplates.getVideoEffectsPalet({id:"av_video_effects_panel",background:{selectedType:t.getSelectedVideoBackground(),customAttribute:"mediacallbuttons",purpose:"selectVideoBackground"},filter:{selectedType:t.getSelectedVideoFilter(),customAttribute:"mediacallbuttons",purpose:"selectVideoFilter"}}),a="";MediaCall.isVideoEffectsSettingsEnabled()&&(a=$WC.template.replace('<div class="flexG"><div remember_video_effects_choice class="flexC">{{check_box}}</div></div>',{check_box:MediaTemplates.getCheckboxHtml("remembervideoeffectstoggle","linkpreview.consent.checkbox",t.canRememberVideoEffects(),"mediacallcheckbox","toggleRememberVideoEffects",!0)},"InSecureHTML"));var n=$WC.template.replace(e.videoEffectsSettings,{palet:i,remember_choise:a},"InSecureHTML");return $WC.template.replace(n,{img_src:Users.getImgUrlById(t.getCurrentMember().getId()),$header:"cc.video.effects",$cancel_btn:"common.cancel",$apply_btn:"sticky.calender.apply"})}}}();var MediaCallHandler={};MediaCallHandler={peerConnectionEvents:{sendOffer:function(e,t,i,a,n,s){var o=MediaCallImpl.getCurrentSession();if(o&&o.getId()===e){var r={perfect_renegotiation:o.getCurrentMember().isPerfectRenegotiationSupported(),multi_stream:o.getCurrentMember().isMultiStreamSupported(),adhoc_call_support:o.getCurrentMember().isAdhocCallingSupported(),call_collision_handling:o.getCurrentMember().isCallCollisionSupported(),initial_reconnection:o.getCurrentMember().isInitialReconnectionSupported(),recording_support:o.getCurrentMember().isRecordingSupported(),reconnection_policy:!0,close_track_on_mute:!0,whiteboard_support:MediaCall.BRIDGE.isWhiteBoardAllowed()},l=function(){var t=MediaCallImpl.getCurrentSession();t&&t.getId()===e&&t.isInitialConnection()&&t.addLongPollingController()},d=function(i){if(void 0===i||i.code!==MediaCallAPI.errorCodes.CALL_ALREADY_ENDED){var a=MediaCallImpl.getCurrentSession();a&&a.getId()===e&&(a.writeToLog(CallLogConstants.webrtc.sendOfferFailedRetry,t),clearTimeout(a._sendOfferTimer),a._sendOfferTimer=setTimeout((function(){c()}),2e3))}else MediaCallImpl.handleEnd(e,!1)},c=function(){o.writeToLog(CallLogConstants.webrtc.sendOffer,t),MediaCallAPI.sendOfferSdp(e,t,i,a,n,r,s,l,d)};MediaCall.BRIDGE.isWMSConnected()||MediaCallAPI.pushCallEventLog(e,MediaCallConstants.logEvents.WS_DISCONNECT),c()}},sendAnswer:function(e,t,i,a,n){var s=MediaCallImpl.getCurrentSession();if(s&&s.getId()===e)if(s.isCaller(s.getCurrentMemberId())||s.isAnswerCallNotified()||i===MediaCallRTCPeerConnectionConstants.processTypes.REINIT||i===MediaCallRTCPeerConnectionConstants.processTypes.RENEGOTIATE)MediaCallAPI.sendAnswerSdp(e,t,i,a,n);else{MediaCall.BRIDGE.isWMSConnected()||MediaCallAPI.pushCallEventLog(e,MediaCallConstants.logEvents.WS_DISCONNECT),s.setAnswerCallAsNotified();var o={perfect_renegotiation:s.getCurrentMember().isPerfectRenegotiationSupported(),multi_stream:s.getCurrentMember().isMultiStreamSupported(),adhoc_call_support:s.getCurrentMember().isAdhocCallingSupported(),call_collision_handling:s.getCurrentMember().isCallCollisionSupported(),initial_reconnection:s.getCurrentMember().isInitialReconnectionSupported(),recording_support:s.getCurrentMember().isRecordingSupported(),reconnection_policy:!0,close_track_on_mute:!0,whiteboard_support:MediaCall.BRIDGE.isWhiteBoardAllowed()};s.writeToLog(CallLogConstants.webrtc.answerWithSdpInit,t);var r={description:t,tracks_media_id:n,client_support:o};s.getCurrentMember().isVideoCallWithoutVideo()&&(r.video={muted:!0}),MediaCallAPI.answerCall(e,s.getMultipleCallsHandlingType(),r,void 0,(function(t){var i=MediaCallImpl.getCurrentSession();if(i&&i.getId()===e){if(i.writeToLog(CallLogConstants.webrtc.answerWithSdpFailed,t),i.resetAnswerCallAsNotified(),void 0===t)return;if(MediaCallAPI.errorCodes.isCallAlreadyAnsweredError(t.code)||MediaCallAPI.errorCodes.isCallEndError(t.code))MediaCallImpl.handleEnd(i.getId());else if(t.code===MediaCallAPI.errorCodes.ALREADY_ON_A_CALL)return void MediaUtil.showMultipleCallAlertPopup(i.getOtherMemberId(),(function(){var t=MediaCallImpl.getCurrentSession();t&&t.getId()===e&&t.getMultipleCallsHandlingType()!==MediaCallConstants.multipleCallHandlingType.END_ACTIVE_CALLS&&(t.terminate(),MediaCallUI.removeCallUI(t),MediaCallImpl.clearRunningSession(e),MediaCallAPI.declineCall(e))}),(function(){var t=MediaCallImpl.getCurrentSession();t&&t.getId()===e&&(t.setMultipleCallsHandlingType(MediaCallConstants.multipleCallHandlingType.END_ACTIVE_CALLS),t.answerCall())}))}}))}},updateIceCandidates:function(e,t,i,a){var n=MediaCall.isForceTurnEnabled();n&&(t=MediaCallImpl.filterRelayCandidates(t));var s=MediaCallImpl.getCurrentSession();s&&s.getId()===e&&(s.writeToLog(CallLogConstants.webrtc.forceTurn,n),s.writeToLog(CallLogConstants.webrtc.updateIce,t),MediaCallImpl.hasTurnCandidates(t)&&s.getCurrentMember().setTurnCandidatesGenerated(),MediaCallAPI.updateIceCandidates(e,t,i,a))},handleIceConnectionStateChange:function(e,t){var i=MediaCallImpl.getCurrentSession(),a=i&&i.getId()===e?i:MediaCallImpl.getFromIncomingSessions(e);if(void 0!==a){var n=a.getNetworkPredictor();void 0!==n&&n.setIceConnectionState(t),a.writeToLog(CallLogConstants.webrtc.iceConnectionStateChange,t)}},handleIceGatheringStateChange:function(e,t){var i=MediaCallImpl.getCurrentSession(),a=i&&i.getId()===e?i:MediaCallImpl.getFromIncomingSessions(e);void 0!==a&&a.writeToLog(CallLogConstants.webrtc.iceGatheringStateChange,t)},handleSignalingStateChange:function(e,t){var i=MediaCallImpl.getCurrentSession(),a=i&&i.getId()===e?i:MediaCallImpl.getFromIncomingSessions(e);void 0!==a&&a.writeToLog(CallLogConstants.webrtc.signalingStateChange,t)},canStartConnectionTimeout:function(e){var t=MediaCallImpl.getCurrentSession();if(t&&t.getId()===e){var i=MediaCall.isReconnectOnConnectionTimeoutEnabled(t)&&t.isInitialConnection();return t.writeToLog(CallLogConstants.canStartConnectionTimeout,i),i}},isStereoEnabled:function(e){var t=MediaCallImpl.getCurrentSession();if(t&&t.getId()===e)return t.writeToLog(CallLogConstants.isStereo,MediaCall.isStereoEnabled()),MediaCall.isStereoEnabled()},handleInitialReconnection:function(e,t,i,a){var n=MediaCallImpl.getCurrentSession();if(n&&n.getId()===e&&i&&a){var s=n.getCurrentMember(),o=n.getOtherMember(),r=void 0;MediaCallRTCPeerConnectionConstants.turnTypes.isGeo(t)?r=s.isTurnCandidatesGenerated()?o.isTurnCandidatesGenerated()?MediaCallConstants.logEvents.GEO_NO_CONNECT:void 0:MediaCallConstants.logEvents.GEO_NO_CANDIDATE:MediaCallRTCPeerConnectionConstants.turnTypes.isMain(t)?r=s.isTurnCandidatesGenerated()?o.isTurnCandidatesGenerated()?MediaCallConstants.logEvents.MAIN_NO_CONNECT:void 0:MediaCallConstants.logEvents.MAIN_NO_CANDIDATE:MediaCallRTCPeerConnectionConstants.turnTypes.isBackup(t)&&(r=s.isTurnCandidatesGenerated()?o.isTurnCandidatesGenerated()?MediaCallConstants.logEvents.BACKUP_NO_CONNECT:void 0:MediaCallConstants.logEvents.BACKUP_NO_CANDIDATE),r&&(n.writeToLog(CallLogConstants.initialReconnection,r),MediaCallAPI.pushCallEventLog(e,r)),s.resetTurnCandidatesGenerated(),o.resetTurnCandidatesGenerated()}},handleReconnect:function(e,t,i,a){var n=MediaCallImpl.getCurrentSession();n&&n.getId()===e&&(MediaCallNetworkPredictorImpl.startCDNPolling(function(e){void 0!==n&&n.writeToLog(CallLogConstants.cdnPolling+e)}.bind(this)),n.addLongPollingController(),n.writeToLog(CallLogConstants.webrtc.reconnect+t),MediaCallUI.adaptUIToState(n,MediaCallConstants.states.RECONNECTING),MediaCallImpl.playTone(n,MediaCallConstants.states.RECONNECTING),n.getMember(i).handleReconnect(e,t,n.isCaller(MediaCall.BRIDGE.Constants.ZUID)))},handleReinit:function(e,t,i){var a=MediaCallImpl.getCurrentSession();a&&a.getId()===e&&(a.writeToLog(CallLogConstants.webrtc.reinit),a.getMember(t).handleReinit(i))},handleRenegotiate:function(e,t,i){var a=MediaCallImpl.getCurrentSession();a&&a.getId()===e&&(a.writeToLog(CallLogConstants.webrtc.renegotiate),i||a.getCurrentMember().isPerfectRenegotiationSupported()&&a.getOtherMember().isPerfectRenegotiationSupported()?a.getMember(t).renegotiateOffererConnection(!0):MediaCallAPI.renegotiate(e))},handleTrack:function(e,t,i){var a=MediaCallImpl.getCurrentSession();a&&a.getId()===e&&i.length>0&&(a.writeToLog(CallLogConstants.webrtc.addTrack,{type:t.kind,id:t.id}),a.setReceivedTrack(t,i),"audio"==t.kind&&MediaCallImpl.setPreferredAudioOutput(MediaCallUI.getVideoContainer(e,a.getOtherMemberId()).find("video")))},handleIceCandidateError:function(e,t){var i=MediaCallImpl.getCurrentSession(),a=i&&i.getId()===e?i:MediaCallImpl.getFromIncomingSessions(e);void 0!==a&&a.writeToLog(CallLogConstants.webrtc.iceCandidateError,t)},handleDisconnected:function(e,t){var i=MediaCallImpl.getCurrentSession();if(i&&i.getId()===e)i.writeToLog(CallLogConstants.webrtc.connection.disconnected);else{var a=MediaCallImpl.getFromIncomingSessions(e);void 0!==a&&a.writeToLog(CallLogConstants.webrtc.connection.disconnected)}},handleFailed:function(e,t){var i=MediaCallImpl.getCurrentSession();if(i&&i.getId()===e)i.writeToLog(CallLogConstants.webrtc.connection.failed);else{var a=MediaCallImpl.getFromIncomingSessions(e);void 0!==a&&a.writeToLog(CallLogConstants.webrtc.connection.failed)}},handleConnected:function(e,t,i,a,n){var s=MediaCallImpl.getCurrentSession();if(s&&s.getId()===e){var o=s.isInitialConnection(),r=s.getCurrentMember();r.clearLastReconnectionId(),s.removeNetworkPredictor(),s.removeLongPolingController(),s.writeToLog(CallLogConstants.webrtc.connection.success),o&&(MediaCallRTCPeerConnectionConstants.turnTypes.isMain(n)?MediaCallAPI.pushCallEventLog(e,MediaCallConstants.logEvents.MAIN_CONNECTED):MediaCallRTCPeerConnectionConstants.turnTypes.isBackup(n)&&MediaCallAPI.pushCallEventLog(e,MediaCallConstants.logEvents.BACKUP_CONNECTED),s.isConnectedViaPolling()&&MediaCallAPI.pushCallEventLog(e,MediaCallConstants.logEvents.LP_CONNECTED,void 0,s.isCaller(MediaCall.getCurrentUserId())),"undefined"!=typeof RemoteWork&&RemoteWork.syncDetailsUI(),s.resetInitialConnection()),s.isCallee(MediaCall.BRIDGE.Constants.ZUID)&&s.getMember(i).clearPullOfferTimer(),WebRTCUserMedia.isSetBitRateSupported()&&s.getMember(MediaCall.BRIDGE.Constants.ZUID).setBitRate(1e3),MediaCallUI.adaptUIToState(s,MediaCallConstants.states.CONNECTED),MediaCallImpl.stopTone(MediaCallConstants.states.RECONNECTING),o&&(r.isScreenShareWithoutAudio()&&MediaCallUI.handleMute(e),r.isVideoCallWithoutVideo()&&MediaCallUI.handleVideoMute(e),s.getOtherMember().setUpdatedAVStatus()),s.isConnectedStateNotified()||(MediaCallImpl.triggerSessionTimer(),s.setConnectedStateAsNotified(),s.writeToLog(CallLogConstants.callState.connected),MediaCallAPI.updateCallStatus(e,MediaCallConstants.statusText.CALL_CONNECTED,void 0,(function(){s.writeToLog(CallLogConstants.callState.failed),s.resetConnectedStateAsNotified()})));WebRTCPeerConnectionStats.initiateGathering(e,"calls",t,void 0,{networkInfoCallBack:MediaAPI.pushConnectionNetworkDetails,updateStatsCallBack:MediaAPI.pushConnectionStats,candidatePairInfoCallBack:function(e,t,i){var a=MediaCallImpl.getCurrentSession();a&&a.getId()===e&&(a.writeToLog(CallLogConstants.candidatePairInfo,i),MediaCallAPI.updateLog(e,"CALL_CANDIDATEPAIR",{loc_time:new Date,time:MediaCall.BRIDGE.Util.getSyncedCurrentTime(),user_type:a.isCaller(MediaCall.BRIDGE.Constants.ZUID)?"caller":"callee",zuid:MediaCall.BRIDGE.Constants.ZUID,call_mode:a.getType(),remote_ip:i.remote_ip,local_ip:i.local_ip,remote_candidate_type:i.remote_candidate_type,local_candidate_type:i.local_candidate_type}))},errorCallback:function(t,i){var a=MediaCallImpl.getCurrentSession();a&&a.getId()===e&&a.startActiveCallUpdate()}}),a===MediaCallRTCPeerConnectionConstants.processTypes.RESTART&&MediaCallAPI.updateLog(s.getId(),"CALL_RECONNECTION_SUCCESS",{loc_time:new Date,time:MediaCall.BRIDGE.Util.getSyncedCurrentTime(),user_type:s.isCaller(MediaCall.BRIDGE.Constants.ZUID)?"caller":"callee",zuid:MediaCall.BRIDGE.Constants.ZUID,call_mode:s.getType()});s.addCallStrengthAnalyser(t,{updateCallQuality:function(e,t,i){var a=MediaCallImpl.getCurrentSession();a&&a.getId()===e&&(a.writeToLog(CallLogConstants.callQualityScore,i),a.writeToLog(CallLogConstants.callQualityScore,t),MediaCall.isNetworkIndicatorEnabled()&&MediaCallImpl.updateNetworkHealthMeter(a))}})}},handleClosed:function(e,t){var i=MediaCallImpl.getCurrentSession();i&&i.getId()===e&&(MediaCallAPI.updateLog(i.getId(),"CALL_RECONNECTION_FAILURE",{loc_time:new Date,time:MediaCall.BRIDGE.Util.getSyncedCurrentTime(),user_type:i.isCaller(MediaCall.BRIDGE.Constants.ZUID)?"caller":"callee",zuid:MediaCall.BRIDGE.Constants.ZUID,call_mode:i.getType()}),i.writeToLog(CallLogConstants.webrtc.connection.closed),MediaCallImpl.handleEnd(e,!0,{playEndTone:!0}))},hasRemoteVideo:function(e){var t=MediaCallImpl.getCurrentSession();if(t&&t.getId()===e)return t.getOtherMember().hasSwitchedToVideo()||t.getOtherMember().isSharingScreen()}},wmsEvents:{CALL_INITIATED:function(e){var t;MediaCallImpl.canDisplayIncomingUI()&&e.data.caller_id!==MediaCall.BRIDGE.Constants.ZUID&&(void 0===(t=MediaCallImpl.getFromIncomingSessions(e.data.call_id))?((t=new MediaCallSession(e.data)).writeToLog(CallLogConstants.wms.callInit),t.writeToLog(CallLogConstants.sessionId+MediaCall.BRIDGE.getSid()+"  "+CallLogConstants.rawSessionID+MediaCall.BRIDGE.getRawSid()),t.getCurrentMember().setClientSupport(MediaCallImpl.getClientSupport()),t.pushEventId(e.msguid),void 0!==e.data.client_support&&(t.writeToLog(CallLogConstants.clentSupport,e.data.client_support),t.getOtherMember().setClientSupport(e.data.client_support)),MediaCallImpl.addInIncomingSessions(t),MediaCallNetworkPredictorImpl.start()):void 0!==e.data.client_support&&t.getOtherMember().setClientSupport(e.data.client_support))},CALL_REQUESTED:function(e){if(e.data.caller_id!==MediaCall.BRIDGE.Constants.ZUID){if(MediaCall.isCallCollisionHandlingEnabled()&&e.data.client_support&&e.data.client_support.call_collision_handling){var t=MediaCallImpl.hasOutgoingSession()?MediaCallImpl.getOutgoingSession():MediaCallImpl.hasCurrentSession()&&MediaCallImpl.getCurrentSession().isInInitialState()?MediaCallImpl.getCurrentSession():void 0;if(t&&t.getCalleeId()===e.data.caller_id){if(t.isInCallAnsweredState())return;return void(t.isInCallInitiatedState()||t.getStartTime()<=e.data.start_time?MediaCallImpl.handleCallCollision(t,e):(MediaCallAPI.updateCallStatus(e.data.call_id,MediaCallConstants.statusText.CALL_COLLISION),MediaCallImpl.removeFromIncomingSessions(e.data.call_id)))}}var i=MediaCallImpl.getCurrentIncomingSession(),a=void 0!==i;if(a&&(new Date).getTime()-i.getStartTime()>35e3&&(MediaCallImpl.handleEnd(i.getId(),!1),a=!1),MediaCallImpl.hasCurrentSession()||MediaCallImpl.hasOutgoingSession()||a)return MediaCallAPI.updateCallStatus(e.data.call_id,MediaCallConstants.statusText.CALL_MISSED_ON_BUSY),void MediaCallImpl.removeFromIncomingSessions(e.data.call_id);if(MediaCallImpl.canDisplayIncomingUI()){var n=MediaCallImpl.getFromIncomingSessions(e.data.call_id);void 0===n&&((n=new MediaCallSession(e.data)).getCurrentMember().setClientSupport(MediaCallImpl.getClientSupport()),n.writeToLog(CallLogConstants.wms.callRequested),n.pushEventId(e.msguid),MediaCallImpl.addInIncomingSessions(n),MediaCallNetworkPredictorImpl.start()),e.data.caller_audio_status&&e.data.caller_audio_status.muted&&n.getCaller().setAudioMuted(),e.data.caller_video_status&&e.data.caller_video_status.muted&&n.getCaller().setVideoMuted(),MediaCallImpl.syncPreferredDevices(),MediaCallAPI.updateCallStatus(n.getId(),MediaCallConstants.statusText.CALL_RECEIVED,(function(e){if(e.credentials){var t=MediaCallImpl.getFromIncomingSessions(e.call_id);if(t){var i=t.getCurrentMember(),a=e.credentials[i.getId()];a&&i.setTurnCredentials(a),n.writeToLog(CallLogConstants.callState.received)}}e.devices&&!MediaCallImpl.isPreferredDevicesSynced()&&MediaCallImpl.setPreferredDevicesObject(e)}),(function(t){if(void 0!==t&&(MediaCallAPI.errorCodes.isCallAlreadyAnsweredError(t.code)||MediaCallAPI.errorCodes.isCallEndError(t.code))){var i=MediaCallImpl.getFromIncomingSessions(e.data.call_id);void 0!==i&&MediaCallImpl.handleEnd(i.getId(),!1)}})),n.addNetworkPredictor(),n.handleCallRequested(),n.getCurrentMember().storeRemoteTracksMediaId(e.data.tracks_media_id),n.getCurrentMember().storeRemoteSdp(JSON.parse(e.data.offer_description)),n.writeToLog(CallLogConstants.wms.offer,e.data.offer_description),void 0!==e.data.client_support&&n.getOtherMember().setClientSupport(e.data.client_support),MediaCallRejectMessages.isInitialized()||MediaCallRejectMessages.init(),MediaCallUI.showCallUI(n,!1),MediaCallImpl.playTone(n,MediaCallConstants.states.INCOMING);var s="videochat.incoming.screen";n.isAudioCall()?s="videochat.incomming.audio":n.isVideoCall()&&(s="videochat.incomming.video");var o=MediaCall.BRIDGE.Resource.getRealValue(s);MediaCall.BRIDGE.handleTitleChange(o),MediaCall.BRIDGE.Status.isBusy()||MediaCall.BRIDGE.Status.isDND()||MediaCall.BRIDGE.handlePushNotification({type:"onetoonecall",title:"@"+n.getCallerName(),icon:MediaCall.BRIDGE.Users.getImgUrlById(n.getCallerId()),body:o,replyable:!1})}}},CALL_RECEIVED:function(e){if(e.data.caller_id===MediaCall.BRIDGE.Constants.ZUID){var t=MediaCallImpl.getCurrentSession();t&&t.getId()===e.data.call_id&&(t.isInCallInitiatedState()||t.isInCallRequestedState())&&(t.writeToLog(CallLogConstants.wms.callReceived),t.handleCallReceived(),MediaCallUI.adaptUIToState(t,MediaCallConstants.states.RINGING),MediaCallAPI.updateLog(t.getId(),"CALL_RINGING",{loc_time:new Date,time:MediaCall.BRIDGE.Util.getSyncedCurrentTime(),user_type:"caller",zuid:MediaCall.BRIDGE.Constants.ZUID,call_mode:t.getType()}))}},CALL_ANSWERED:function(e){if(e.data.callee_id!==MediaCall.BRIDGE.Constants.ZUID){var t=MediaCallImpl.getCurrentSession();t&&t.getId()===e.data.call_id&&!t.isInCallAnsweredState()&&MediaCallImpl.handleCallAnswered(t,e.data)}else{var i=MediaCallImpl.getFromIncomingSessions(e.data.call_id);void 0!==i&&MediaCallImpl.handleEnd(i.getId(),!1)}},CALL_ANSWERED_ACK:function(e){var t=MediaCallImpl.getCurrentSession();t&&t.getId()===e.data.call_id&&t.writeToLog(CallLogConstants.wms.callAnsweredAck)},CALL_COLLISION:function(e){if(e.data.callee_id===MediaCall.BRIDGE.Constants.ZUID){var t=MediaCallImpl.getFromIncomingSessions(e.data.call_id);void 0!==t&&MediaCallImpl.handleEnd(t.getId(),!1)}},CALL_CONNECTED:function(e){MediaCallImpl.hasCurrentSession()&&MediaCallImpl.getCurrentSession().writeToLog(CallLogConstants.wms.callConnected)},CALL_CANCELED:function(e){var t=MediaCallImpl.getFromIncomingSessions(e.data.call_id);void 0!==t&&t.writeToLog(CallLogConstants.wms.callCanceled),MediaCallImpl.handleEnd(e.data.call_id,!1)},CALL_DECLINED:function(e){var t=MediaCallImpl.getCurrentSession(),i=!1;t&&t.getId()===e.data.call_id&&(MediaCallUI.adaptUIToState(t,MediaCallConstants.states.DECLINED),t.writeToLog(CallLogConstants.wms.callDeclined)),e.data.caller_id===MediaCall.BRIDGE.Constants.ZUID&&(MediaCallImpl.stopTone(MediaCallConstants.states.CALLING),MediaCallImpl.stopTone(MediaCallConstants.states.RINGING),i=!0),MediaCallImpl.handleEnd(e.data.call_id,!1,{showCallEndUI:i})},CALL_MISSED:function(e){MediaCallImpl.handleEnd(e.data.call_id,!1),"undefined"!=typeof CallHistoryData&&e.data.callee_id===MediaCall.BRIDGE.Constants.ZUID&&CallHistoryData.incrementMissedCallsCount()},CALL_MISSED_ON_BUSY:function(e){var t=MediaCallImpl.getCurrentSession(),i=e.data.callee_id===MediaCall.BRIDGE.Constants.ZUID;t&&t.getId()===e.data.call_id&&MediaCallUI.adaptUIToState(t,MediaCallConstants.states.MISSED_ON_BUSY),MediaCallImpl.handleEnd(e.data.call_id,!1,{showCallEndUI:!i}),"undefined"!=typeof CallHistoryData&&i&&CallHistoryData.incrementMissedCallsCount()},CALL_END:function(e){var t=MediaCallImpl.getCurrentSession(),i=!1;t&&t.getId()===e.data.call_id&&("undefined"!=typeof RemoteWork&&RemoteWork.syncDetailsUI(),MediaCallImpl.getCurrentSession().writeToLog(CallLogConstants.wms.callEnd),i=!0),MediaCallImpl.handleEnd(e.data.call_id,!1,{playEndTone:i})},OFFER_SDP:function(e){var t=MediaCallImpl.getCurrentSession();if(t&&t.getId()===e.data.call_id){t.writeToLog(CallLogConstants.wms.offer,e);var i=JSON.parse(e.data.offer_description),a=t.getCurrentMember();a.storeRemoteTracksMediaId(e.data.tracks_media_id),a.setRemoteTurnType(e.data.turn_type),e.data.connection_state===MediaCallRTCPeerConnectionConstants.processTypes.REINIT?a.reinitAnswererConnection(i):e.data.connection_state===MediaCallRTCPeerConnectionConstants.processTypes.RENEGOTIATE?a.renegotiateAnswererConnection(i,t.getOtherMemberId()):a.isOfferAlreadyReceivedForReconnection(e.data.reconnection_id)||(a.setLastReconnectionId(e.data.reconnection_id),a.restartAnswererConnection(i))}},ANSWER_SDP:function(e){var t=MediaCallImpl.getCurrentSession();t&&t.getId()===e.data.call_id&&(t.writeToLog(CallLogConstants.wms.answer,e.data.answer_description),t.getCurrentMember().storeRemoteTracksMediaId(e.data.tracks_media_id),t.getCurrentMember().setRemoteSdp(JSON.parse(e.data.answer_description)))},ICE_CANDIDATE:function(e){var t=MediaCallImpl.getCurrentSession(),i=JSON.parse(e.data.ice_candidates),a=MediaCall.isForceTurnEnabled();a&&(i=MediaCallImpl.filterRelayCandidates(i));var n=MediaCallImpl.hasTurnCandidates(i);if(t&&t.getId()===e.data.call_id)t.getCurrentMember().setRemoteIceCandidates(i),t.writeToLog(CallLogConstants.webrtc.forceTurn,a),t.writeToLog(CallLogConstants.wms.iceCandidates,e.data.ice_candidates),n&&t.getOtherMember().setTurnCandidatesGenerated();else{var s=MediaCallImpl.getFromIncomingSessions(e.data.call_id);void 0!==s&&(s.getCurrentMember().storeRemoteIceCandidates(i),s.writeToLog(CallLogConstants.webrtc.forceTurn,a),s.writeToLog(CallLogConstants.wms.iceCandidates,e.data.ice_candidates),n&&s.getOtherMember().setTurnCandidatesGenerated())}},REINIT:function(e){var t=MediaCallImpl.getCurrentSession();t&&t.getId()===e.data.call_id&&(t.writeToLog(CallLogConstants.wms.reinit,e),t.getCurrentMember().reinitOffererConnection())},RENEGOTIATE:function(e){var t=MediaCallImpl.getCurrentSession();t&&t.getId()===e.data.call_id&&(t.writeToLog(CallLogConstants.wms.renegotiate,e),t.getCurrentMember().renegotiateOffererConnection(!1))},CALL_HOLD:function(e){var t=MediaCallImpl.getCurrentSession();t&&t.getId()===e.data.call_id&&(t.writeToLog(CallLogConstants.wms.callHold,e),t.getOtherMember().handleHoldStatus(e.data.hold,e.data.action_time))},MEDIA_SETTING:function(e){var t=MediaCallImpl.getCurrentSession();if(t&&t.getId()===e.data.call_id){t.writeToLog(CallLogConstants.wms.mediaSetting+JSON.stringify(e));var i=t.getOtherMember();e.data.camera&&i.handleAVStreamStatus("video","off"===e.data.camera,e.data.action_time),e.data.mic&&i.handleAVStreamStatus("audio","off"===e.data.mic,e.data.action_time)}},GROUP_CALL_SWITCHED:function(e){var t=MediaCallImpl.getCurrentSession();if(t&&t.getId()===e.data.call_id){var i=t.getAssociatedConferenceId();ConferenceImpl.hasCurrentSession()&&ConferenceImpl.getCurrentSession().getId()===i?(MediaCallUI.removeCallUI(t),ConferenceUI.getConferenceWindow().removeClass("dN")):ZCSmartConferenceImpl.hasCurrentSession()&&ZCSmartConferenceImpl.getCurrentSession().getId()===i&&(MediaCallUI.removeCallUI(t),ZCSmartConferenceUI.getConferenceWindow().removeClass("dN")),AdhocCallBridge.detach(t)}},CALL_MIGRATING:function(e){var t=MediaCallImpl.getCurrentSession();if(t&&t.getId()===e.data.call_id){var i=e.data.recording_migration,a=e.data.migration_host;t.setStatusText(MediaCallConstants.statusText.CALL_MIGRATING),i?a===MediaCall.BRIDGE.Constants.ZUID&&MediaCallUI.adaptUIToState(t,MediaCallConstants.states.RECORDING_PROCESSING):MediaCallUI.adaptUIToState(t,MediaCallConstants.states.MIGRATING)}},CALL_MIGRATED:function(e){var t=MediaCallImpl.getCurrentSession();if(t&&t.getId()===e.data.call_id){t.writeToLog(CallLogConstants.migrated,e);var i=t.getCurrentMember(),a=t.getOtherMember(),n=i.isSharingScreen();t.setAssociatedConferenceId(e.data.associated_conference_id),t.setStatusText(MediaCallConstants.statusText.CALL_MIGRATED);var s=e.data.associated_conference_id,o=e.data.recording_migration,r=e.data.migration_host,l=ZCSmartConferenceImpl.hasCurrentSession()&&ZCSmartConferenceImpl.getCurrentSession().getId()===s,d=ConferenceImpl.hasCurrentSession()&&ConferenceImpl.getCurrentSession().getId()===s;if(o){if(t.setAsMigratedForRecording(),r===MediaCall.BRIDGE.Constants.ZUID){i.setRecordingReferenceIndex(e.data.recording_index);var c=MediaCallUI.getMediaCallWrapper(t.getId());c.removeClass("AV-call-migrating"),c.find("[recording_indicator]").fadeIn()}if(AdhocCallBridge.attach(t),l){var u=ZCSmartConferenceImpl.getCurrentSession(),C=u.getVideoStreamWithUserId(i.getId()),p=u.getVideoStreamWithUserId(a.getId());C instanceof MediaStream&&AdhocCallBridge.publish(u,"handleVideoStream",{associatedSessionId:e.data.call_id,videoStream:C,userId:i.getId()}),p instanceof MediaStream&&AdhocCallBridge.publish(u,"handleVideoStream",{associatedSessionId:e.data.call_id,videoStream:p,userId:a.getId()})}else if(d){var h=ConferenceImpl.getCurrentSession(),m=h.getMember(a.getId()).getScreenStream();m instanceof MediaStream&&AdhocCallBridge.publish(h,"handleScreenStream",{associatedSessionId:e.data.call_id,screenStream:m,userId:a.getId()})}}n=i.isSharingScreen();if(l)n&&ZCSmartConferenceImpl.addScreenInSession(i.getScreenUpStream()),o||(MediaCallUI.removeCallUI(t),ZCSmartConferenceUI.getConferenceWindow().removeClass("dN")),ZCSmartConferenceUI.handleResize();else{if(!(d||ZCJQuery("#conferencewindow")&&ZCJQuery("#conferencewindow").attr("adhoccallid")===e.data.call_id))return;o||(MediaCallUI.removeCallUI(t),ConferenceUI.getConferenceWindow().removeClass("dN")),ConferenceUI.handleResize()}o||MediaUtil.setDarkMode()}}},UIEvents:{goToStore:function(){$WC.$Win.destroy("extension_install_preview"),ScreenShare.Extension.openStore()},showMiniPlayer:function(e,t){this.minimizeWindow()},minimizeWindow:function(){if(MediaCallImpl.hasCurrentSession()){var e=MediaCallImpl.getCurrentSession();e.writeToLog(CallLogConstants.ui.minCall);var t=MediaCallUI.getMediaCallWrapper(e.getId());t.find("[purpose=minimizeWindow]").addClass("zcf-maximize").removeClass("zcf-leftArrow").attr({purpose:"maximizeWindow",title:MediaCall.BRIDGE.Resource.getRealValue("videochat.fullscreen")}),ZCJQuery('[mediacallbuttons][purpose="closeChatInRHS"]').attr({purpose:"openChatInRHS",title:MediaCall.BRIDGE.Resource.getRealValue("common.chat")}).removeClass("AV-call-active"),"function"==typeof MediaCall.BRIDGE.handleDarkMode&&MediaCall.BRIDGE.handleDarkMode(!1),t.removeClass("AV-call-fullscrn show-aside").removeAttr("mediacallfullscreenwindow"),MediaCallUI.adjustCallContainerHeight(t),e.hasChatId()&&MediaCallImpl.removeChat(e.getChatId()),"chatview"===t.attr("previousPosition")?MediaCallUI.setCallUIInChatorBody(e,t,!0):MediaCallUI.setCallUIInBody(t),e.getCurrentMember().isAudioMuted()&&(t.find("[mutedinfocnt]").remove(),t.addClass("AV-call-mute-banner"),t.prepend(MediaTemplates.getMutedBanner(!0))),t.removeAttr("previousPosition"),MediaCallUI.resetFullScreenVideosDraggable(e.getId())}},maximizeWindow:function(){if(MediaCallImpl.hasCurrentSession()){var e=MediaCallImpl.getCurrentSession();e.writeToLog(CallLogConstants.ui.maxCall);var t=MediaCallUI.getMediaCallWrapper(e.getId());t.find("[purpose=maximizeWindow]").addClass("zcf-leftArrow").removeClass("zcf-maximize").attr({purpose:"minimizeWindow",title:MediaCall.BRIDGE.Resource.getRealValue("media.back.minimize.view")}),t.addClass("AV-call-fullscrn").attr("mediacallfullscreenwindow",""),MediaCall.isNetworkIndicatorEnabled()&&t.addClass("AV-health-meter"),t.attr("previousPosition",MediaCallUI.isInDetachedView(t)?"detachedview":"chatview"),MediaCallUI.adjustCallContainerHeight(t),MediaCall.BRIDGE.isContainerDeatchOnMinimizeDisabled()?MediaCallUI.unsetDraggableOnMaximize():void 0!==MediaCall.BRIDGE&&"function"==typeof MediaCall.BRIDGE.handleBodyMount?MediaCall.BRIDGE.handleBodyMount(t):ZCJQuery("body").append(t),e.getCurrentMember().isAudioMuted()&&(t.find("[mutedinfocnt]").remove(),t.prepend(MediaTemplates.getMutedBanner(!1))),"function"==typeof MediaCall.BRIDGE.handleDarkMode&&MediaCall.BRIDGE.handleDarkMode(!0),MediaCallUI.makeFullScreenVideosDraggable(e.getId())}},switchView:function(e,t){var i="";if(t.hasClass("AV-call-subview"))i="AV-call-subview";else{if(!t.hasClass("AV-call-subview-2"))return;i="AV-call-subview-2"}var a=t.parents("[callId]").attr("callId"),n=MediaCallImpl.getCurrentSession();if(n&&n.getId()===a){var s=MediaCallUI.getMediaCallWrapper(a);MediaCallUI.handleViewSwitch(s,t,i),MediaCallUI.adjustCallContainerHeight(s)}},openChatInRHS:function(e,t){this.toggleChat(e,t)},closeChatInRHS:function(e,t){this.toggleChat(e,t)},setCallUIInChat:function(e,t){this.toggleChat(e,t)},setCallUIInBody:function(e,t){this.toggleChat(e,t)},takeNotes:function(e,t){var i=MediaCallImpl.getCurrentSession();NotebookIntegration.open(i.getId(),(function(){NotebookIntegration.setDefaultNoteTitle(i.getOtherMember().getName()),NoteBookLHS.trackAction("OPEN_NOTE","CALL")})),Clickoutside.handleClickOnChild(e)},stopCallRecording:function(e,t){var i=t.parents("[callId]").attr("callId"),a=MediaCallImpl.getCurrentSession(),n=a.getCurrentMember();if(Clickoutside.handleClickOnChild(e),a&&a.getId()===i&&n.isRecording()){var s=a.getAssociatedConferenceId();ConferenceAPI.stopRecording(s,n.getRecordingReferenceIndex(),function(){var e=MediaCallImpl.getCurrentSession();e&&e.getId()===i&&(e.getCurrentMember().resetRecordingReferenceIndex(),MediaCallUI.getMediaCallWrapper(e.getId()).find("[recording_indicator]").fadeOut(),AdhocCallBridge.publish(e,"stopRecording",{associatedSessionId:e.getAssociatedConferenceId()}))}.bind(this))}},startCallRecording:function(e,t){var i=t.parents("[callId]").attr("callId"),a=MediaCallImpl.getCurrentSession(),n=a.getCurrentMember();if(Clickoutside.handleClickOnChild(e),a&&a.getId()===i&&!n.isRecording()){if(a.isMigratedCall()){var s=a.getAssociatedConferenceId();return void ConferenceAPI.startRecording(s,function(e){var t=MediaCallImpl.getCurrentSession();t&&t.getId()===i&&(t.getCurrentMember().setRecordingReferenceIndex(e),MediaCallUI.getMediaCallWrapper(t.getId()).find("[recording_indicator]").fadeIn(),AdhocCallBridge.publish(t,"startRecording",{associatedSessionId:t.getAssociatedConferenceId(),refIndex:e}))}.bind(this))}if(!a.isInMigratingState()){var o=a.getCallTypeForAdhocCall(),r=n.getAVUpStream(),l=[a.getOtherMemberId()],d=(new Date).getTime();a.setStatusText(MediaCallConstants.statusText.CALL_MIGRATING),n.setRecordingReferenceIndex(d),Conference.convertOneToOneCallToConference(MediaCallImpl.generateTitleForRecording(a),o,l,r,MediaCallImpl.getDetailsForAdhocCallConversion(a),d,void 0,(function(){n.resetRecordingReferenceIndex(),UI.updateBanner(Resource.getRealValue("apierror.message"),2e3,!0)}))}}},addParticipantsToCall:function(e,t){var i=MediaCallImpl.getCurrentSession();i&&i.getId()===t.parents("[callId]").attr("callId")&&!i.isInMigratingState()&&i.isAdhocCallingSupported()&&(Clickoutside.handleClickOnChild(e),MediaCallImpl.createAddParticipantWin(i))},openChat:function(e,t){var i=t.parents("[callId]").attr("callId"),a=MediaCallImpl.getCurrentSession();a.getId()===i&&(Clickoutside.handleClickOnChild(e),void 0!==MediaCall.BRIDGE&&"function"==typeof MediaCall.BRIDGE.handleChatOpen&&MediaCall.BRIDGE.handleChatOpen(a.getChatId(),a.getOtherMemberId()))},toggleChat:function(e,t){if(MediaCallImpl.hasCurrentSession()){var i=t.parents("[callId]").attr("callId");if(MediaCallImpl.getCurrentSession().getId()===i){Clickoutside.handleClickOnChild(e);var a=MediaCallUI.getMediaCallWrapper(i);void 0===MediaCall.BRIDGE||void 0!==MediaCall.BRIDGE.handleChatInRhs&&MediaCall.BRIDGE.handleChatInRhs(i,!MediaCallUI.isRHSOpened(a))}}},turnOnMicrophone:function(e,t){MediaCallUI.handleUnmute(t.parents("[callId]").attr("callId"))},turnOffMicrophone:function(e,t){MediaCallUI.handleMute(t.parents("[callId]").attr("callId"))},turnOnCamera:function(e,t){MediaCallUI.handleVideoUnMute(t.parents("[callId]").attr("callId"))},turnOffCamera:function(e,t){MediaCallUI.handleVideoMute(t.parents("[callId]").attr("callId"))},answerCall:function(e,t){var i=t.parents("[callId]").attr("callId"),a=t.attr("answertype");MediaCallUI.answerCall(i,a)},closeRejectMsgBox:function(e,t){MediaCallUI.removeEndCallUI(t.parents("[callId]").attr("callId"))},endCall:function(e,t){var i=t.parents("[callId]").attr("callId");MediaCallUI.removeRejectMessageDialog(i);var a=MediaCallImpl.getCurrentSession();if(a&&a.getId()===i)"undefined"!=typeof RemoteWork&&RemoteWork.syncDetailsUI(),a.writeToLog(CallLogConstants.ui.end);else{var n=MediaCallImpl.getFromIncomingSessions(i);void 0!==n&&n.writeToLog(CallLogConstants.ui.end)}MediaCallImpl.handleEnd(i,!0)},showDeclineReasons:function(e,t){var i=t.parents("[callId]").attr("callId"),a=MediaCallImpl.getFromIncomingSessions(i);if(a&&a.isInInitialState()){MediaCallImpl.stopTone(MediaCallConstants.states.CALLING),MediaCallImpl.stopTone(MediaCallConstants.states.INCOMING);var n=MediaCallUI.getMediaCallWrapper(i);n.find("[impulsecontainer]").addClass("zc-av-dN");var s=MediaCallTemplates.getRejectMessageDialogHtml(a);n.append(s)}},sendCustomRejectMessage:function(e,t){var i=t.parents("[callId]").attr("callId"),a=MediaCallUI.getMediaCallWrapper(i),n=a.find('[inputname="rejectTextBox"]').val().trim();MediaCallImpl.handleRejectMessage(i,n,!0),a.find('[inputname="rejectTextBox"]').val("")},sendDefaultRejectMessage:function(e,t){var i=t.parents("[callId]").attr("callId"),a=(MediaCallUI.getMediaCallWrapper(i),t.text());MediaCallImpl.handleRejectMessage(i,a,!1)},handleRejectMessageInput:function(e,t){var i=t.parents("[callId]").attr("callId"),a=MediaCallUI.getMediaCallWrapper(i),n=a.find('[purpose = "sendCustomRejectMessage"]');a.find('[inputname="rejectTextBox"]').val().trim().length>0?n.removeAttr("disabled"):n.attr("disabled","")},shareOptions:function(e,t){var i=t.parents("[callId]").attr("callId"),a=MediaCallImpl.getCurrentSession();if(a&&a.getId()===i){if(t.children().length>0)return void MediaCallUI.removeShareOptionsDropDown(i);var n=MediaCallTemplates.getShareOptionsHtml(a);t.addClass("AV-call-active").html(n);var s=i+"shrdropdowncnt";MediaCallUI.setContainerPositionClass(ZCJQuery("#"+s)),Clickoutside.bind({event:e,srcid:t.attr("id"),destid:s,doNotClose:function(e,t,i,a,n){return i&&ZCJQuery(i.currentTarget).attr("id")===e.srcid},customHide:function(e){MediaCallUI.removeShareOptionsDropDown(i)}})}},startWhiteBoard:function(e,t){var i=t.parents("[callId]").attr("callId"),a=MediaCallImpl.getCurrentSession();if(a&&a.getId()===i){if(a.getCurrentMember().isSharingScreen()||a.getOtherMember().isSharingScreen()){var n=a.getCurrentMember().isSharingScreen()?"whiteboard.local.screen.share.end":"whiteboard.remote.screen.share.end";return void UI.updateBanner(Resource.getRealValue(n),2e3,!0)}if(t.children().length>0&&MediaCallUI.removeMoreOptionsDropDown(i),Clickoutside.handleClickOnChild(e),a.hasWhiteBoard()){var s=a.getWhiteBoardCreator();return void UI.updateBanner(Resource.getRealValue("whiteboard.in.conference.limit",Users.getName(s.getId(),s.getName())),2e3,!0)}MediaCallUI.addAndGetWhiteBoardContainer(a._id,a);var o={title:"Whiteboard",associate_id:i,associate_type:"direct_call"};WhiteBoard.createAndShowWhiteBoard(o)}},stopWhiteBoard:function(e,t){var i=t.parents("[callId]").attr("callId"),a=MediaCallImpl.getCurrentSession();if(a&&a.getId()===i){if(t.children().length>0&&MediaCallUI.removeMoreOptionsDropDown(i),Clickoutside.handleClickOnChild(e),!a.hasWhiteBoard()||!a.isWhiteBoardCreator())return;WhiteBoard.closeWhiteBoard(i,"direct_call",a.getCurrentWhiteBoardId())}},showMoreOptions:function(e,t){var i=t.parents("[callId]").attr("callId"),a=MediaCallImpl.getCurrentSession();if(a&&a.getId()===i){if(t.children().length>0)return void MediaCallUI.removeMoreOptionsDropDown(i);var n=MediaCallTemplates.getMoreOptionsHtml(a);t.addClass("AV-call-active").html(n);var s=i+"dropdowncnt";MediaCallUI.setContainerPositionClass(ZCJQuery("#"+s)),Clickoutside.bind({event:e,srcid:t.attr("id"),destid:s,doNotClose:function(e,t,i,a,n){return i&&ZCJQuery(i.currentTarget).attr("id")===e.srcid},customHide:function(e){MediaCallUI.removeMoreOptionsDropDown(i)}})}},startScreenShare:function(e,t){var i=MediaCallImpl.getCurrentSession();if(i.writeToLog(CallLogConstants.ui.screen),!i.getCurrentMember().isSharingScreen())if(i.hasWhiteBoard())UI.updateBanner(Resource.getRealValue("whiteboard.stop.to.share.screen"),2e3,!0);else if(Clickoutside.handleClickOnChild(e),!MediaCall.BRIDGE.Util.Browser.isChrome()||WebRTCUserMedia.isScreenShareSupportedInNative()||ScreenShare.Extension.isInstalled())if(i.isMigratedForRecording())AdhocCallBridge.publish(i,"startScreenShare",{associatedSessionId:i.getAssociatedConferenceId()});else{i.writeToLog(CallLogConstants.streamRequest.screen.initDuringCall),WebRTCUserMedia.requestScreenStream((function(e){var t=MediaCallImpl.getCurrentSession();if(t){t.writeToLog(CallLogConstants.streamRequest.screen.success),e._getPrimaryVideoTrack().applyConstraints({frameRate:{min:15,max:15}}).catch();var i=t.getCurrentMember();i.isMultiStreamSupported()&&t.getOtherMember().isMultiStreamSupported()?i.addScreenInConnection(e):i.replaceVideoWithScreenInNewConnection(e);var a=ZCJQuery('[mediacallbuttons][purpose="startScreenShare"]');a.length&&(a.attr("purpose","stopScreenShare").addClass("AV-call-selected"),a.find("[icon]").removeClass("zcf-sharescrn").addClass("zcf-scrn-shr-stop"),a.find("[content]").text(MediaCall.BRIDGE.Resource.getRealValue("media.screenshare.end")))}else WebRTCUserMedia.closeStream(e._getType())}),void 0,(function(){i.writeToLog(CallLogConstants.streamRequest.screen.stopped),MediaCallHandler.UIEvents.stopScreenShare()}))}else MediaManager.showExtensionInstallPreview("mediacallbuttons")},stopScreenShare:function(e,t){if(MediaCallImpl.hasCurrentSession()){var i=MediaCallImpl.getCurrentSession();if(i.writeToLog(CallLogConstants.ui.stopScreen),e&&Clickoutside.handleClickOnChild(e),i.isMigratedForRecording())AdhocCallBridge.publish(i,"stopScreenShare",{associatedSessionId:i.getAssociatedConferenceId()});else MediaCallImpl.getCurrentSession().getCurrentMember().removeScreenFromConnection(),MediaCallUI.resetScreenShareOption()}},switchToVideo:function(e,t){if(MediaCallImpl.hasCurrentSession()){var i=t.parents("[callId]"),a=i.attr("callId"),n=MediaCallImpl.getCurrentSession();if(n.getId()===a){n.writeToLog(CallLogConstants.ui.videoSwitch),MediaCallUI.removeSwitchToVideoInfo(n),MediaCallUI.handleSwitchToVideoLayout(),Clickoutside.handleClickOnChild(e);var s=n.getCurrentMember();if(!s.hasSwitchedToVideo()){s.setAsSwitchedToVideo();var o=function(e){MediaCallImpl.hasCurrentSession()?(i.removeClass("AV-call-no-subview"),n.writeToLog(CallLogConstants.webrtc.requestAndAddTrackInStream.success),s.isMultiStreamSupported()&&n.getOtherMember().isMultiStreamSupported()?s.addTrackInStream(e,WebRTCUserMedia.streamTypes.VIDEO_ONLY):s.replaceScreenWithVideoInNewConnection(e),MediaCallUI.getVideoContainer(n.getId(),s.getId()).removeClass("AV-call-video-muted"),MediaCallAPI.updateLog(n.getId(),"CALL_SWITCH",{loc_time:new Date,time:MediaCall.BRIDGE.Util.getSyncedCurrentTime(),user_type:n.isCaller(MediaCall.BRIDGE.Constants.ZUID)?"caller":"callee",zuid:MediaCall.BRIDGE.Constants.ZUID,call_mode:n.getType()})):WebRTCUserMedia.closeStream(e._getType())},r=function(e,t){n.writeToLog(CallLogConstants.webrtc.requestAndAddTrackInStream.failed),s.resetSwitchedToVideo()};n.writeToLog(CallLogConstants.webrtc.requestAndAddTrackInStream.init),MediaCall.isNoCamOrMicEnabled(n)?MediaCallImpl.renegotiateForUnmute(a,WebRTCUserMedia.streamTypes.VIDEO_ONLY,o,r):WebRTCUserMedia.requestAndAddTrackInStream(s.getAVUpStream(),WebRTCUserMedia.streamTypes.VIDEO_ONLY,o,r,void 0,MediaUtil.getVideoEffects(n))}}}},closeEndCall:function(e,t){var i=t.parents("[callId]").attr("callId"),a=void 0;if(ZCMediaRecorderImpl.hasCurrentRecordingSession())a=ZCMediaRecorderImpl.getCurrentRecordingSession();else{if(!ZCMediaRecorderImpl.hasRecordedSession(i))return void MediaCallUI.removeEndCallUI(i);a=ZCMediaRecorderImpl.getRecordedSession(i)}ZCMediaRecorderHandler.mediaCallUIEvents.stopMediaRecording(i),ZCMediaRecorderImpl.showCancelRecordingDialog(function(){ZCMediaRecorderImpl.handleEnd(i)}.bind(this),a,!0)},callAgain:function(e,t){var i=t.parents("[callId]"),a=i.attr("callId"),n=i.attr("calltype"),s=i.attr("calleeid");MediaCallUI.removeEndCallUI(a),MediaCall.initiateStartCallProcess(n,s,void 0,MediaConstants.triggerSource.NO_RESPONSE_OPTIONS)},startMediaRecording:function(e,t){ZCMediaRecorderHandler.mediaCallUIEvents.startMediaRecording(t.parents("[callId]"))},stopMediaRecording:function(e,t){ZCMediaRecorderHandler.mediaCallUIEvents.stopMediaRecording(t.parents("[callId]").attr("callId"))},playRecording:function(e,t){ZCMediaRecorderHandler.mediaCallUIEvents.playRecording(t.parents("[callId]").attr("callId"))},pauseRecording:function(e,t){ZCMediaRecorderHandler.mediaCallUIEvents.pauseRecording(t.parents("[callId]").attr("callId"))},sendRecording:function(e,t){ZCMediaRecorderHandler.mediaCallUIEvents.sendRecording(t)},declineSwitchToVideo:function(e,t){if(MediaCallImpl.hasCurrentSession()){var i=t.parents("[callId]").attr("callId"),a=MediaCallImpl.getCurrentSession();a.writeToLog(CallLogConstants.ui.videoSwitchDecline),a.getId()===i&&MediaCallUI.removeSwitchToVideoInfo(a)}},setMediaDevices:function(e,t){MediaCallImpl.showMediaDeviceSettings(t.parents("[callId]").attr("callId"))},openDevicesDropDown:function(e){var t=ZCJQuery(e.currentTarget).parents("[dropdowncnt]");Clickoutside.bind({srcid:t.attr("id"),destid:t.find("[dropdown]").attr("id")})},openSettings:function(e,t){var i=t.parents("[callId]").attr("callId"),a=MediaCallImpl.getCurrentSession();Clickoutside.handleClickOnChild(e),a.getId()===i&&$WC.$Win.create({id:"av_settings_win",class:"modalwindow zcalgncntr zcbg_mask smartconf-setting nite-mode zc-av-dN",html:MediaCallTemplates.getSettingsLayoutHtml(a),closefn:function(){var e=MediaCallImpl.getCurrentSession();MediaCallUI.removeCallSettings(),e&&e.clearVideoEffectsPreview()},openfn:function(){ZCJQuery("#av_settings_win").attr("callId",i),MediaCallImpl.showMediaDeviceSettings(i)}.bind(this)})},switchToVideoEffects:function(e,t){var i=MediaCallImpl.getCurrentSession();i.clearVideoEffectsPreview();var a=ZCJQuery("#av-settings-lhs");a.find("[settingstab]").removeClass("active"),a.find("#av-video-effects-lhs").addClass("active");var n=ZCJQuery("#av_settings_body");n.html(MediaCallTemplates.getVideoEffectsPanel(i));MediaManager.setAsStreamRequested(WebRTCUserMedia.streamTypes.VIDEO_ONLY),WebRTCUserMedia.requestNewStreamInstance(WebRTCUserMedia.streamInstanceIds.video_effects_preview,WebRTCUserMedia.streamTypes.VIDEO_ONLY,(function(e){MediaManager.resetStreamRequested();var t=n.find("#video_effect_preview_dom");t.length?(MediaUtil.setAndPlayStreamInMediaContainer(t,e,!0),i.setVideoEffectsPreviewStream(e)):WebRTCUserMedia.closeStreamInstance(WebRTCUserMedia.streamInstanceIds.video_effects_preview,e._getType())}),(function(e){MediaManager.resetStreamRequested();var t=n.find("#video_effect_preview_dom");t.find("[loader]").addClass("hide"),t.find("[user_image]").removeClass("dN")}),void 0,MediaUtil.getVideoEffects(i))},selectVideoBackground:function(e,t){var i=MediaCallImpl.getCurrentSession();if(!i.isRequestPending(MediaCallConstants.requests.applyPreviewVideoBackgroundEffect)){var a=ZCJQuery("#av_video_effects_panel");a.find("[background_list] [list_item]").removeClass("zc-av-video-effects-list-item-active"),t.addClass("zc-av-video-effects-list-item-active");var n=i.getSelectedVideoBackground(),s=i.getSelectedVideoFilter(),o=t.attr("value"),r=i.getVideoEffectsPreviewStream();if(r){var l=ZCJQuery("#av_settings_body").find("#video_effect_preview_dom"),d=l.find("[loader]");d.removeClass("hide");var c=t.find("[loader]");c.removeClass("dN"),i.setRequestAsPending(MediaCallConstants.requests.applyPreviewVideoBackgroundEffect),MLBackgroundProcessor.applyVideoBackground(r,o,(function(e){d.addClass("hide"),c.addClass("dN"),i.setRequestAsCompleted(MediaCallConstants.requests.applyPreviewVideoBackgroundEffect),e&&(MediaUtil.setAndPlayStreamInMediaContainer(l,e,!0),i.setVideoEffectsPreviewStream(e))}))}var u=o;(MLBackgroundProcessor.backgroundTypes.hasNoBackground(o)||MLBackgroundProcessor.backgroundTypes.isBlur(o))&&(u=MLBackgroundProcessor.backgroundTypes.images[0]);var C=a.find("[filters_list] [list_item]");C.find("img").attr("src",MLBackgroundProcessor.backgroundTypes.getThumbNailUrl(u));var p=C.filter(".zc-av-video-effects-list-item-active").attr("value");ZCJQuery("#av_settings_body").toggleClass("smartconf-effect-edited",n!==o||s!==p)}},selectVideoFilter:function(e,t){var i=MediaCallImpl.getCurrentSession();if(!i.isRequestPending(MediaCallConstants.requests.applyPreviewVideoBackgroundEffect)){var a=ZCJQuery("#av_video_effects_panel");a.find("[filters_list] [list_item]").removeClass("zc-av-video-effects-list-item-active"),t.addClass("zc-av-video-effects-list-item-active");var n=i.getSelectedVideoBackground(),s=i.getSelectedVideoFilter(),o=a.find("[background_list] [list_item].zc-av-video-effects-list-item-active").attr("value"),r=t.attr("value"),l=i.getVideoEffectsPreviewStream();if(l){var d=ZCJQuery("#av_settings_body").find("#video_effect_preview_dom"),c=d.find("[loader]");c.removeClass("hide");var u=t.find("[loader]");u.removeClass("dN"),i.setRequestAsPending(MediaCallConstants.requests.applyPreviewVideoBackgroundEffect),MLBackgroundProcessor.applyVideoFilter(l,r,(function(e){c.addClass("hide"),u.addClass("dN"),i.setRequestAsCompleted(MediaCallConstants.requests.applyPreviewVideoBackgroundEffect),e&&(MediaUtil.setAndPlayStreamInMediaContainer(d,e,!0),i.setVideoEffectsPreviewStream(e))}))}ZCJQuery("#av_settings_body").toggleClass("smartconf-effect-edited",n!==o||s!==r)}},setVideoEffects:function(e,t){var i=ZCJQuery("#av_video_effects_panel"),a=i.find("[background_list] [list_item].zc-av-video-effects-list-item-active").attr("value"),n=i.find("[filters_list] [list_item].zc-av-video-effects-list-item-active").attr("value");MediaCallImpl.getCurrentSession().applyVideoEffects(a,n),MediaCallUI.removeCallSettings()},closeVideoEffectsPanel:function(e,t){MediaCallUI.removeCallSettings()},handleAdhocCallInputs:function(){var e=ZCJQuery("#addparticipantstocallwin"),t=e.find('[inputname="adhoccalltitle"]'),i=MediaUtil.isValidTitle(t.val()),a=MediaCallImpl.userSuggestion.getSelectedListValues().length>=MediaCallImpl.userSuggestion.minLimitForAdhocCall&&i;t.toggleClass("inpt-error",!i),e.find("[mediacallbuttons][purpose=ringAllParticipants]").attr("disabled",!a)},closeAddParticipantWin:function(e,t){$WC.$Win.destroy("addparticipantstocallwin")},ringAllParticipants:function(e,t){if(MediaCallImpl.hasCurrentSession()){var i=ZCJQuery("#addparticipantstocallwin"),a=i.find("[mediacallbuttons][purpose=ringAllParticipants]"),n=i.find('[inputname="adhoccalltitle"]'),s=n.val();if(MediaUtil.isValidTitle(s)){var o=MediaCallImpl.getCurrentSession(),r=o.getCallTypeForAdhocCall(),l=MediaCallImpl.userSuggestion.getSelectedListValues();o.setStatusText(MediaCallConstants.statusText.CALL_MIGRATING),$Util.Button.addLoadIconForAjax(a),$WC.Util.removeElementFromArray(l,MediaCall.BRIDGE.Constants.ZUID),MediaCallImpl.addUsersToCall(s,r,l,(function(){MediaCallHandler.UIEvents.closeAddParticipantWin(),$Util.Button.showCompletionAndResetContent(a,!1)}),(function(){$Util.Button.showCompletionAndResetContent(a,!0),UI.updateBanner(Resource.getRealValue("apierror.message"),2e3,!0)}))}else n.addClass("inpt-error")}else MediaCallHandler.UIEvents.closeAddParticipantWin()},closeNewDeviceInfo:function(e,t){var i=t.parents("[callId]").attr("callId"),a=MediaCallImpl.getCurrentSession();a&&a.getId()===i&&MediaCallUI.removeNewDeviceInfoCnt(a)},switchToNewDevice:function(e,t){var i=t.parents("[callId]").attr("callId"),a=MediaCallImpl.getCurrentSession();if(a&&a.getId()===i){var n=t.attr("deviceId"),s=t.attr("deviceKind");MediaCallUI.removeNewDeviceInfoCnt(a),MediaCallImpl.switchDevice(n,s)}}},UIToggleEvents:{toggleRememberVideoEffects:function(e,t){var i=MediaCallImpl.getCurrentSession(),a=t.is(":checked");i.setRememberVideoEffectsStatus(a)}}};var MediacallScreenRequestHandler=function(){var e=void 0,t={"ZOHOCLIQ-EXTN-CHECK":!0,"ZOHOCLIQ-GET-SCREEN-SOURCEID":!0,"ZOHOCLIQ-EXTENSION":!0},i=function(e,t,i){return{source:"ZOHOCLIQ-EXTENSION",requestId:e,message:{type:t,data:i}}},a={screen_share_tab:"full_screen",screen_share_choice:null,isSystemAudioAllowed:!1,bindScreenSelectUIEvents:function(e){e.on("click","[purpose='screen']",(function(t){var i=t.currentTarget;i.id!==a.screen_share_choice&&(a.screen_share_choice&&e.find("#"+a.screen_share_choice).removeClass("sel"),a.screen_share_choice=i.id,$(i).addClass("sel"),e.find("#share").removeAttr("disabled"))})),e.on("click","[purpose='sourcetab']",(function(t){var i=t.currentTarget;i.id!==a.screen_share_tab&&(a.screen_share_tab&&(e.find("#"+a.screen_share_tab).removeClass("sel"),e.find("#"+a.screen_share_tab+"_holder").addClass("AV-call-hide")),a.screen_share_tab=i.id,"full_screen"===i.id?e.find("#include_sys_audio").removeClass("AV-call-hide"):e.find("#include_sys_audio").addClass("AV-call-hide"),e.find("#"+a.screen_share_tab+"_holder").removeClass("AV-call-hide"),$(i).addClass("sel"))}))},showScreenShareSelection:function(e,t){var i=!1,n='<div id="{{source_id}}" class="AV-call-scrnshare-prmsn-grid AV-call-mR20" purpose="screen"><img src="{{thumbnail_src}}"><div class="AV-call-flexC AV-call-mT10 AV-call-prmsn-grid-title"><span class="AV-call-flexG AV-call-ellips">{{window_title}}</span></div></div>',s='<div class="AV-call-scrnshare-prmsn-cont"><div class="AV-call-font18 AV-call-fshrink">'+MediaCall.BRIDGE.Resource.getRealValue("tour.zcscreenshare.title")+'</div><div class="AV-call-font14 AV-call-mT15 AV-call-fshrink AV-call-clr-S">'+MediaCall.BRIDGE.Resource.getRealValue("desktop.screen.share.desc")+'</div><div class="AV-call-zcl-hor-tab AV-call-fshrink"><div id="full_screen" purpose="sourcetab" class="AV-call-zcl-hor-tab-item sel">'+MediaCall.BRIDGE.Resource.getRealValue("desktop.share.entire")+'</div><div id="app_wins" purpose="sourcetab" class="AV-call-zcl-hor-tab-item">'+MediaCall.BRIDGE.Resource.getRealValue("desktop.share.appwindow")+'</div></div><div class="AV-call-flexG AV-call-ovrflwH"><div id="full_screen_holder" class="AV-call-scrnshare-prmsn-main AV-call-scrnshare-prmsn-gridview"></div><div id="app_wins_holder" class="AV-call-hide AV-call-scrnshare-prmsn-main AV-call-scrnshare-prmsn-gridview"></div></div><div class="AV-call-scrnshare-prmsn-ftr"><div id="cancel" purpose="button" class="AV-call-zcl-btn-sm AV-call-zcl-btn--secondary AV-call-mR20">'+MediaCall.BRIDGE.Resource.getRealValue("common.cancel")+'</div><div id="share" purpose="button" class="AV-call-zcl-btn-sm AV-call-zcl-btn--primary" disabled>'+MediaCall.BRIDGE.Resource.getRealValue("common.share")+"</div></div></div></div>",o="",r="";e.forEach((function(e){var t={source_id:e.id.replace(/:/g,"_"),thumbnail_src:e.thumbnail.toDataURL(),window_title:e.name};e.id.startsWith("window")?o+=$WC.template.replace(n,t):r+=$WC.template.replace(n,t)}));var l=$WC.$Win.create({id:"DC_screen_share_select",html:s,class:"AV-call-scrnshare-prmsn-parent "+(void 0!==ZCConfig&&ZCConfig.isLibraryMode()?"chat-bar":"cliq-app"),closefn:function(){i||t(),i=!1,a.screen_share_choice=null,a.screen_share_tab="full_screen"}});(l=$(l)).find("#full_screen_holder").html(r),l.find("#app_wins_holder").html(o),this.bindScreenSelectUIEvents(l),l.on("click","[purpose='button']",(function(e){var n,s=e.target.id;if(s){if("system_audio_btn"===s){var o=e.target.checked;return a.isSystemAudioAllowed=o,void l.find("#sys_audio_icon").addClass(o?"zcf-mute-sound":"zcf-unmute-sound").removeClass(o?"zcf-unmute-sound":"zcf-mute-sound")}"share"===s&&(n=a.screen_share_choice.replace(/_/g,":"),i=!0),t(n),$WC.$Win.destroy("DC_screen_share_select"),a.screen_share_choice=null,a.screen_share_tab="full_screen"}}))},handleScreenShare:function(t){e({types:["window","screen"]}).then((function(e){a.showScreenShareSelection(e,t)})).catch((function(e){throw e}))}};return{init:function(n){"function"==typeof(e=n)&&$(window).on("message",(function(e){var n=e.originalEvent.data,s=n.message;"object"!=typeof s||"ZOHOCLIQ-SCEEN-SOURCE-ID"!==s.type&&"ZOHOCLIQ-GET-SCREEN-DENIED"!==s.type||(s=n.source),t[s]&&("ZOHOCLIQ-EXTN-CHECK"==s?window.postMessage(i(n.requestId,s,!0),"*"):"ZOHOCLIQ-EXTENSION"===n.source&&void 0!==ScreenShare.Extension?ScreenShare.Extension.handleMessageEvent(e):a.handleScreenShare((function(e){var t="ZOHOCLIQ-GET-SCREEN-DENIED",a=!1;e&&(t="ZOHOCLIQ-SCEEN-SOURCE-ID",a=e),window.postMessage(i(n.requestId,t,a),"*")})))}))},isSystemAudioAllowedInSS:function(){return a.isSystemAudioAllowed}}}(),MediaCallSession=function(e){this._id=e.call_id,this._type=e.type,this._chatId=e.chat_id,this._startTime=e.start_time,this._attendedTime=-1,this._status=e.status,this._statusText=e.status_text,this._callerId=e.caller_id,this._calleeId=e.callee_id,this._callerName=void 0!==MediaCall&&void 0!==MediaCall.BRIDGE?MediaCall.BRIDGE.Users.getName(this._callerId,e.caller_name):"undefined"!=typeof Users&&"function"==typeof Users.getName?Users.getName(this._callerId,e.caller_name):"",this._calleeName=void 0!==MediaCall&&void 0!==MediaCall.BRIDGE?MediaCall.BRIDGE.Users.getName(this._calleeId,e.callee_name):"undefined"!=typeof Users&&"function"==typeof Users.getName?Users.getName(this._calleeId,e.callee_name):"",void 0===e.credentials&&(e.credentials={}),this._members={},this._members[this._callerId]=new MediaCallMember(this._callerId,this._callerName,this._id,e.credentials[this._callerId]),this._members[this._calleeId]=new MediaCallMember(this._calleeId,this._calleeName,this._id,e.credentials[this._calleeId]),this.isVideoCall()?(this._members[this._callerId].setAsSwitchedToVideo(),this._members[this._calleeId].setAsSwitchedToVideo()):(this.isScreenShare()||this.isScreenShareWithAudioCall())&&this._members[this._callerId].setAsSharingScreen(),this._answerCallNotified=!1,this._connectedStateNotified=!1,this._callReceivedAckTimeOut=void 0,this._callRingingTimeOut=void 0,this._incomingCallTimeOut=void 0,this._activeCallUpdateInterval=void 0,this._reconnectionPolicy=e.reconnection_policy||{event:"disconnected",interval:"2000",connection_timeout:"5000"},this._associatedLiveFeedId=void 0,this._logString="",this._callStrengthAnalyser=void 0,this._networkPredictor=void 0,this._longPollingController=void 0,this._callEventIds=[],this._pollingEvents=[],this._isPushToTalkEnabled=!1,this._hasNewDevicePopup=!1,this._isPoorNetworkTracked=!1,this._associatedConferenceId=void 0,this._multipleCallsHandlingType=void 0,this._isInitialConnection=!0,this._isMigratedCall=!1,this._isMigratedForRecording=!1,this._whiteBoard={currentBoard:void 0,boards:{}},this._pendingRequests={},this._videoEffectsPreviewStream=void 0,this._canRememberVideoEffects=!1,this._callMergeEvents=void 0,MediaCall.isVideoEffectsEnabled()&&(MediaCall.isVideoEffectsSettingsEnabled()&&void 0!==ZCMediaPreferences?this._videoEffects={background:ZCMediaPreferences.getPreferredVideoBackground(),filter:ZCMediaPreferences.getPreferredVideoFilter()}:this._videoEffects={background:MLBackgroundProcessor.backgroundTypes.NONE,filter:MLBackgroundProcessor.filterTypes.NONE})};MediaCallSession.prototype={getId:function(){return this._id},getCallerId:function(){return this._callerId},getCalleeId:function(){return this._calleeId},getCallerName:function(){return this._callerName},getCalleeName:function(){return this._calleeName},getCaller:function(){return this.getMembers()[this.getCallerId()]},getCallee:function(){return this.getMembers()[this.getCalleeId()]},getCurrentMember:function(){return this.getMembers()[MediaCall.getCurrentUserId()]},getCurrentMemberId:function(){return this.getCurrentMember().getId()},getOtherMemberId:function(){return this.getOtherMember().getId()},getOtherMember:function(){return this.isCaller(MediaCall.getCurrentUserId())?this.getCallee():this.getCaller()},getMember:function(e){return this.getMembers()[e]},getMembers:function(){return this._members},getType:function(){return this._type},getStartTime:function(){return this._startTime},getStatusText:function(){return this._statusText},getChatId:function(){return this._chatId},isAudioCall:function(){return MediaCall.isAudioCall(this._type)},isVideoCall:function(){return MediaCall.isVideoCall(this._type)},isScreenShareWithAudioCall:function(){return MediaCall.isScreenShareWithAudioCall(this._type)},isScreenShare:function(){return MediaCall.isScreenShare(this._type)},isCaller:function(e){return this._callerId===e},isCallee:function(e){return this._calleeId===e},isAnswerCallNotified:function(){return this._answerCallNotified},isConnectedStateNotified:function(){return this._connectedStateNotified},setAsMigratedForRecording:function(){return this._isMigratedForRecording=!0},isMigratedForRecording:function(){return this._isMigratedForRecording},isAudioLayoutRequired:function(){return this.isAudioCall()||this.isCaller(MediaCall.getCurrentUserId())&&(this.isScreenShareWithAudioCall()||this.isScreenShare())},isVideoLayoutRequired:function(){return this.isVideoCall()||this.isCallee(MediaCall.getCurrentUserId())&&(this.isScreenShareWithAudioCall()||this.isScreenShare())},isInCallInitiatedState:function(){return MediaCallConstants.isCallInitiated(this.getStatusText())},isInCallReceivedState:function(){return MediaCallConstants.isCallReceived(this.getStatusText())},isInCallRequestedState:function(){return MediaCallConstants.isCallRequested(this.getStatusText())},isInCallAnsweredState:function(){return MediaCallConstants.isCallAnswered(this.getStatusText())},isInInitialState:function(){return this.isInCallInitiatedState()||this.isInCallReceivedState()||this.isInCallRequestedState()},isInMigratingState:function(){return MediaCallConstants.isCallMigrating(this.getStatusText())},isMigratedCall:function(){return this._isMigratedCall},setAssociatedConferenceId:function(e){this._associatedConferenceId=e},getAssociatedConferenceId:function(){return this._associatedConferenceId},isLiveFeedAssociated:function(){return void 0!==this._associatedLiveFeedId},hasNewDevicePopup:function(){return this._hasNewDevicePopup},setNewDevicePopup:function(){this._hasNewDevicePopup=!0},resetNewDevicePopup:function(){this._hasNewDevicePopup=!1},isPushToTalkEnabled:function(){return this._isPushToTalkEnabled},setPushToTalkState:function(e){this._isPushToTalkEnabled=e},getMultipleCallsHandlingType:function(){return this._multipleCallsHandlingType},setMultipleCallsHandlingType:function(e){this._multipleCallsHandlingType=e},hasChatId:function(){return void 0!==this._chatId},setStatusText:function(e){e===MediaCallConstants.statusText.CALL_MIGRATED&&(this._isMigratedCall=!0),this._statusText=e},getAssociatedLiveFeedId:function(){return this._associatedLiveFeedId},getAttendedTime:function(){return this._attendedTime},setChatId:function(e){this._chatId=e},setAssociatedLiveFeedId:function(e){this._associatedLiveFeedId=e},setAttendedTime:function(e){this._attendedTime=e},setConnectedStateAsNotified:function(){this._connectedStateNotified=!0},resetConnectedStateAsNotified:function(){this._connectedStateNotified=!1},isInitialConnection:function(){return this._isInitialConnection},resetInitialConnection:function(){this._isInitialConnection=!1},setAnswerCallAsNotified:function(){this._answerCallNotified=!0},resetAnswerCallAsNotified:function(){this._answerCallNotified=!1},isTrackRenegotiationSupported:function(){return this.getCurrentMember().isTrackRenegotiationSupported()&&this.getOtherMember().isTrackRenegotiationSupported()},isPoorNetworkTracked:function(){return this._isPoorNetworkTracked},setPoorNetworkTracked:function(){this._isPoorNetworkTracked=!0},isAdhocCallingSupported:function(){return this.getCurrentMember().isAdhocCallingSupported()&&this.getOtherMember().isAdhocCallingSupported()},isInitialReconnectionSupported:function(){return this.getCurrentMember().isInitialReconnectionSupported()&&this.getOtherMember().isInitialReconnectionSupported()},isRecordingSupported:function(){return this.getCurrentMember().isRecordingSupported()&&this.getOtherMember().isRecordingSupported()},isWhiteBoardSupported:function(){return this.getCurrentMember().isWhiteBoardSupported()&&this.getOtherMember().isWhiteBoardSupported()},getNetworkPredictor:function(){return this._networkPredictor},getVideoEffectsPreviewStream:function(){return this._videoEffectsPreviewStream},setVideoEffectsPreviewStream:function(e){this._videoEffectsPreviewStream=e},clearVideoEffectsPreview:function(){this._videoEffectsPreviewStream&&(WebRTCUserMedia.closeStreamInstance(WebRTCUserMedia.streamInstanceIds.video_effects_preview,this._videoEffectsPreviewStream._getType()),this._videoEffectsPreviewStream=void 0)},isRequestPending:function(e){return this._pendingRequests[e]},setRequestAsPending:function(e){this._pendingRequests[e]=!0},setRequestAsCompleted:function(e){delete this._pendingRequests[e]},canRememberVideoEffects:function(){return this._canRememberVideoEffects},setRememberVideoEffectsStatus:function(e){this._canRememberVideoEffects=e},subscribe:function(e){this._callMergeEvents=e},unSubscribe:function(){this._callMergeEvents=void 0},hasSubscribed:function(){return void 0!==this._callMergeEvents},getSubscribedHandler:function(){return this._callMergeEvents},getVideoEffects:function(){return this._videoEffects},setVideoEffects:function(e){this._videoEffects=e},getSelectedVideoBackground:function(){return this._videoEffects.background},getSelectedVideoFilter:function(){return this._videoEffects.filter},setSelectedVideoBackground:function(e){this._videoEffects.background=e},setSelectedVideoFilter:function(e){this._videoEffects.filter=e},applyVideoEffects:function(e,t){if(!this.isRequestPending(MediaCallConstants.requests.applyVideoBackgroundEffect)){var i=this.getCurrentMember(),a=i.getAVUpStream(),n=a._hasVideoTrack(),s=!1,o=!1,r={},l=!1,d=!1;this.getSelectedVideoBackground()!==e&&(r.backgroundType=e,s=n,this.setSelectedVideoBackground(e),l=!0),this.getSelectedVideoFilter()!==t&&(r.filterType=t,o=n,this.setSelectedVideoFilter(t),d=!0);var c=function(e,t){this.setRequestAsPending(MediaCallConstants.requests.applyVideoBackgroundEffect),MLBackgroundProcessor.applyVideoFilter(e,t,function(e){this.setRequestAsCompleted(MediaCallConstants.requests.applyVideoBackgroundEffect),e&&i.replaceAVUpStreamTrack(e,WebRTCUserMedia.streamTypes.VIDEO_ONLY)}.bind(this))}.bind(this);if(s?(this.setRequestAsPending(MediaCallConstants.requests.applyVideoBackgroundEffect),MLBackgroundProcessor.applyVideoBackground(a,e,function(e){this.setRequestAsCompleted(MediaCallConstants.requests.applyVideoBackgroundEffect),e?(o&&MLBackgroundProcessor.applyVideoFilter(e,t),i.replaceAVUpStreamTrack(e,WebRTCUserMedia.streamTypes.VIDEO_ONLY)):o&&c(a,t)}.bind(this))):o&&c(a,t),this.canRememberVideoEffects()&&(l||d)){var u={};if(l)MLBackgroundProcessor.backgroundTypes.isSeasonalImage(e)?u.seasonal_video_background=e:(u.video_background=e,u.seasonal_video_background=MLBackgroundProcessor.backgroundTypes.NONE);d&&(u.video_filter=t),MediaCall.BRIDGE.Settings.update(u)}void 0!==MediaCall.BRIDGE.Tracker&&MediaCall.BRIDGE.Tracker.track("AV_VIDEO_EFFECTS_ADDED",r)}},getCallTypeForAdhocCall:function(){return this.isVideoCall()||this.getCurrentMember().hasSwitchedToVideo()||this.getOtherMember().hasSwitchedToVideo()?MediaCallConstants.types.VIDEO:MediaCallConstants.types.AUDIO},addNetworkPredictor:function(){this._networkPredictor=new MediaCallNetworkPredictor(this.getId(),this.getCurrentMemberId(),this.getOtherMemberId(),function(e,t){this.writeToLog(CallLogConstants.networkPrediction,{state:e,calculations:t}),MediaCallUI.showBeforeCallNetworkInfo(this.getId(),this.getOtherMemberId(),e)}.bind(this))},isDuplicateEvent:function(e){return e&&this._callEventIds.includes(e)},pushEventId:function(e){e&&this._callEventIds.push(e)},pushPollingEvent:function(e){this._pollingEvents.push(e)},isConnectedViaPolling:function(){return this._pollingEvents.length>0},deviceAddedCallback:function(e){MediaCallUI.handleNewDeviceAdded(this._id,e[0])},addListenerForDeviceChange:function(){MediaCall.isDeviceChangeListenerEnabled()&&ZCMediaDevices.addListenerForDeviceChange(this._id,this.deviceAddedCallback.bind(this))},removeListenerForDeviceChange:function(){ZCMediaDevices.removeListenerForDeviceChange(this._id)},addLongPollingController:function(){MediaCall.isLongPollingEnabled()&&(this.removeLongPolingController(),this._longPollingController=new LongPollingController(this.getId(),function(e){for(var t=0;t<e.length;t++)MediaCallImpl.handleCallEvent(e[t],!1)}.bind(this),this._reconnectionPolicy.long_polling_interval))},removeNetworkPredictor:function(){void 0!==this._networkPredictor&&(MediaCallUI.hideBeforeCallNetworkInfo(this.getId()),this._networkPredictor.stop(),this._networkPredictor=void 0),MediaCallNetworkPredictorImpl.clearPollingTimer()},removeLongPolingController:function(){void 0!==this._longPollingController&&(this._longPollingController.stop(),this._longPollingController=void 0)},getCallStrengthAnalyser:function(){return this._callStrengthAnalyser},addCallStrengthAnalyser:function(e,t){this.removeCallStrengthAnalyser(),this._callStrengthAnalyser=new CallStrengthAnalyser(this.getId(),e,t)},removeCallStrengthAnalyser:function(){void 0!==this._callStrengthAnalyser&&(this._callStrengthAnalyser.stopAnalysis(),this._callStrengthAnalyser=void 0)},startCall:function(){this.isCaller(MediaCall.getCurrentUserId())&&(this.getCaller().initConnection(this._calleeId),this._setCallReceivedAckTimeOut())},answerCall:function(){this.isCaller(MediaCall.getCurrentUserId())||(void 0!==this._networkPredictor&&this._networkPredictor.setCallAnswered(),this._clearIncomingCallTimeOut(),this.setStatusText(MediaCallConstants.statusText.CALL_ANSWERED),this.getCallee().connectConnection(this._callerId),this.getCurrentMember().isReconnectionPolicySupported()&&this.getOtherMember().isReconnectionPolicySupported()&&this.getCurrentMember().setReconnectionPolicy(this._reconnectionPolicy))},_setCallReceivedAckTimeOut:function(){var e=function(){this.writeToLog(CallLogConstants.timers.callReceivedAckTimeout),this._callReceivedAckTimeOut=void 0,MediaCallImpl.handleCallRingingTimeout(this.getId())}.bind(this);clearTimeout(this._callReceivedAckTimeOut),this._callReceivedAckTimeOut=setTimeout(e,MediaCallConstants.callReceivedAckTimeLimt)},handleCallReceived:function(){var e=function(){this.writeToLog(CallLogConstants.timers.callRingingTimeout),this._callRingingTimeOut=void 0,MediaCallImpl.handleCallRingingTimeout(this.getId())}.bind(this);this.setStatusText(MediaCallConstants.statusText.CALL_RECEIVED),this._clearCallReceivedAckTimeOut(),clearTimeout(this._callRingingTimeOut),this._callRingingTimeOut=setTimeout(e,MediaCallConstants.callRingingTimeLimit)},handleCallMissed:function(){this.setStatusText(MediaCallConstants.statusText.CALL_MISSED),this.terminate(),MediaCallUI.adaptUIToState(this,MediaCallConstants.states.NO_RESPONSE),MediaCallImpl.handleEnd(this.getId(),!1,{playEndTone:!0,showCallEndUI:!0})},handleCallRequested:function(){var e=function(){this.setStatusText(MediaCallConstants.statusText.CALL_MISSED),this._incomingCallTimeOut=void 0,this.terminate(),MediaCallImpl.handleEnd(this.getId(),!1)}.bind(this);this.setStatusText(MediaCallConstants.statusText.CALL_REQUESTED),clearTimeout(this._incomingCallTimeOut),this._incomingCallTimeOut=setTimeout(e,MediaCallConstants.incomingCallTimeLimit)},handleCallAnswered:function(e,t){void 0!==this._networkPredictor&&this._networkPredictor.setCallAnswered(),this._clearCallReceivedAckTimeOut(),this._clearCallRingingTimeOut(),this.getCurrentMember().isReconnectionPolicySupported()&&this.getOtherMember().isReconnectionPolicySupported()&&this.getCurrentMember().setReconnectionPolicy(this._reconnectionPolicy),this.setStatusText(MediaCallConstants.statusText.CALL_ANSWERED),void 0!==e&&(this.getCurrentMember().storeRemoteTracksMediaId(t),this.getCurrentMember().setRemoteSdp(e))},handleMuteShortcut:function(){if(!this.isInInitialState()){var e=this.getId();return this.getCurrentMember().isAudioMuted()?MediaCallUI.handleUnmute(e):MediaCallUI.handleMute(e)}},setReceivedTrack:function(e,t){var i=this.getCurrentMember();$WC.Util.isEmptyObject(i.getRemoteTracksMediaId())?this.isAudioCall()?i.setAVDownStream(e):this.isVideoCall()?i.storeAVTrack(e):this.isScreenShareWithAudioCall()?this.isCaller(MediaCall.getCurrentUserId())?i.setAVDownStream(e):i.storeAVTrack(e):this.isCallee(MediaCall.getCurrentUserId())&&i.setAVDownStream(e):i.handleRemoteTrackAdded(e,t)},startActiveCallUpdate:function(){this._clearActiveCallUpdateInterval(),this._activeCallUpdateInterval=setInterval(function(){void 0!==this._id&&MediaCallAPI.updateCallStatus(this._id,MediaCallConstants.statusText.CALL_ACTIVE)}.bind(this),MediaCallConstants.activeCallUpdateInterval)},_clearActiveCallUpdateInterval:function(){clearInterval(this._activeCallUpdateInterval),this._activeCallUpdateInterval=void 0},_clearCallReceivedAckTimeOut:function(){clearTimeout(this._callReceivedAckTimeOut),this._callReceivedAckTimeOut=void 0},_clearCallRingingTimeOut:function(){clearTimeout(this._callRingingTimeOut),this._callRingingTimeOut=void 0},_clearIncomingCallTimeOut:function(){clearTimeout(this._incomingCallTimeOut),this._incomingCallTimeOut=void 0},terminate:function(e){this._clearCallReceivedAckTimeOut(),this._clearCallRingingTimeOut(),this._clearIncomingCallTimeOut(),this._clearActiveCallUpdateInterval(),this.removeCallStrengthAnalyser(),this.removeNetworkPredictor(),this.removeLongPolingController(),this.removeListenerForDeviceChange(),this.clearVideoEffectsPreview(),this.unSubscribe();var t=this.getMembers();for(zuid in t){t[zuid].closeConnection(!e)}},getLogString:function(){return this._logString},setLogString:function(e){this._logString=e},writeToLog:function(e,t){this._logString=this._logString+"\n["+new Date(Date.now())+"] -> "+e,void 0!==t&&(this._logString=this._logString+" "+JSON.stringify(t,null,4))},getLogAsFile:function(e){if(this._logString.length>0)return e=void 0!==e?e:ZCMediaConstants.defaultLogFileName,[new File([this._logString],e,{type:"text/plain"}),e]},updateWhiteBoardInfo:function(e){this._whiteBoard.currentBoard=e.boardId,this._whiteBoard.boards[this._whiteBoard.currentBoard]=e},hasWhiteBoard:function(){return void 0!==this._whiteBoard.currentBoard},isWhiteBoardCreator:function(){return void 0!==this._whiteBoard.currentBoard&&this._whiteBoard.boards[this._whiteBoard.currentBoard].creator===$zcg._ZUID},getCurrentWhiteBoardId:function(){return this._whiteBoard.currentBoard},getWhiteBoardCreator:function(){return this.getMember(this._whiteBoard.boards[this._whiteBoard.currentBoard].creator)},getCurrentWhiteBoard:function(){if(void 0!==this._whiteBoard.currentBoard)return this._whiteBoard.boards[this._whiteBoard.currentBoard]},resetCurrentWhiteBoard:function(){this._whiteBoard.currentBoard=void 0}};var MediaCallMember=function(e,t,i,a){this._id=e,this._name=t,this._callId=i,this._turnCredentials=a,this._connection=void 0,this._isSharingScreen=!1,this._recordingReferenceIndex=void 0,this._avUpStream=void 0,this._screenUpStream=void 0,this._avDownStream=void 0,this._screenDownStream=void 0,this._avDownStreamTracks=[],this._videoDownStreamId=void 0,this._audioDownStreamId=void 0,this._remoteSdp=void 0,this._remoteIceCandidates=[],this._remoteTracksMediaId={},this._remoteTurnType=void 0,this._clientSupport={perfect_renegotiation:!0,multi_stream:!0,close_track_on_mute:!0},this._pullOfferTimer=void 0,this._sendOfferTimer=void 0,this._lastReconnectionId=void 0,this._audioStatus={muted:!1,time:-1},this._videoStatus={muted:!1,time:-1},this._holdStatus={state:"off",time:-1},this._isScreenShareWithoutAudio=!1,this._isVideoCallWithoutVideo=!1,this._hasSwitchedToVideo=!1,this._hasAddedTransceiverForVideo=!1,this._isTurnCandidatesGenerated=!1,this._isDownStreamConnectedForConvertedCall=!1};MediaCallMember.prototype={getId:function(){return this._id},getName:function(){return this._name},getAVUpStream:function(){return this._avUpStream},getAVDownStream:function(){return this._avDownStream},getScreenUpStream:function(){return this._screenUpStream},getTurnCredentials:function(){return this._turnCredentials},setTurnCredentials:function(e){this._turnCredentials=e},setTurnCandidatesGenerated:function(){this._isTurnCandidatesGenerated=!0},resetTurnCandidatesGenerated:function(){this._isTurnCandidatesGenerated=!1},isTurnCandidatesGenerated:function(){return this._isTurnCandidatesGenerated},setClientSupport:function(e){this._clientSupport=e},getClientSupport:function(){return this._clientSupport},isReconnectionPolicySupported:function(){return void 0!==this._clientSupport.reconnection_policy&&this._clientSupport.reconnection_policy},isTrackRenegotiationSupported:function(){return void 0!==this._clientSupport.close_track_on_mute&&this._clientSupport.close_track_on_mute},isAdhocCallingSupported:function(){return void 0!==this._clientSupport.adhoc_call_support&&this._clientSupport.adhoc_call_support},isCallCollisionSupported:function(){return void 0!==this._clientSupport.call_collision_handling&&this._clientSupport.call_collision_handling},isInitialReconnectionSupported:function(){return void 0!==this._clientSupport.initial_reconnection&&this._clientSupport.initial_reconnection},isRecordingSupported:function(){return void 0!==this._clientSupport.recording_support&&this._clientSupport.recording_support},isWhiteBoardSupported:function(){return void 0!==this._clientSupport.whiteboard_support&&this._clientSupport.whiteboard_support},isPerfectRenegotiationSupported:function(){return this._clientSupport.perfect_renegotiation},isMultiStreamSupported:function(){return this._clientSupport.multi_stream},isSharingScreen:function(){return this._isSharingScreen},isRecording:function(){return void 0!==this._recordingReferenceIndex},isCurrentUser:function(){return this._id===MediaCall.getCurrentUserId()},setAsSharingScreen:function(){this._isSharingScreen=!0},resetSharingScreen:function(){this._isSharingScreen=!1},setRecordingReferenceIndex:function(e){this._recordingReferenceIndex=e},resetRecordingReferenceIndex:function(){this._recordingReferenceIndex=void 0},getRecordingReferenceIndex:function(){return this._recordingReferenceIndex},setAsSwitchedToVideo:function(){this._hasSwitchedToVideo=!0},resetSwitchedToVideo:function(){this._hasSwitchedToVideo=!1},hasSwitchedToVideo:function(){return this._hasSwitchedToVideo},setAudioMuted:function(){return this._audioStatus.muted=!0},setVideoMuted:function(){return this._videoStatus.muted=!0},isAudioMuted:function(){return this._audioStatus.muted},isVideoMuted:function(){return this._videoStatus.muted},setScreenShareWithoutAudio:function(){this._isScreenShareWithoutAudio=!0},isScreenShareWithoutAudio:function(){return this._isScreenShareWithoutAudio},setVideoCallWithoutVideo:function(){this._isVideoCallWithoutVideo=!0},isVideoCallWithoutVideo:function(){return this._isVideoCallWithoutVideo},setAVUpStream:function(e){e&&(this._avUpStream=e,this._avUpStream.bindTrackEnd(this.handleTrackEnd.bind(this)))},setScreenUpStream:function(e){this._screenUpStream=e},setBitRate:function(e){this._connection.setBitRate(e)},setReconnectionPolicy:function(e){this._connection.setReconnectionPolicy(e)},isIceConnectionStateConnected:function(){return this._connection&&this._connection.isIceConnectionStateConnected()},isDownStreamConnectedForConvertedCall:function(){return this._isDownStreamConnectedForConvertedCall},setAsDownStreamConnectedForConvertedCall:function(){this._isDownStreamConnectedForConvertedCall=!0},handleRemoteTrackAdded:function(e,t){var i=t[0],a=i.id,n=this.getRemoteTracksMediaId();if("audio"==e.kind){if(n.audio!==a)return;if(void 0===this._avDownStream)this._audioDownStreamId=a,this._avDownStream=i,this.setRemoteAVStreamInContainer();else if(this._audioDownStreamId!==a){var s=this._avDownStream._hasVideoTrack()?WebRTCUserMedia.streamTypes.AUDIO_VIDEO:WebRTCUserMedia.streamTypes.AUDIO_ONLY;this._avDownStream._hasAudioTrack()?this._avDownStream._replacePrimaryAudioTrack(e):this._avDownStream._addPrimaryAudioTrack(e,s),this._audioDownStreamId=a}else this.pauseAndPlay()}else if("video"==e.kind){var o=MediaCallImpl.getCurrentSession(),r=o.getCurrentMember(),l=o.getOtherMember();if(n.screen===a)l.setAsSharingScreen(),this._screenDownStream=i,this.setRemoteScreenStreamInContainer();else if(n.video===a){if(!l.hasSwitchedToVideo()){l.setAsSwitchedToVideo();var d=MediaCallUI.getMediaCallWrapper(o.getId());MediaCallUI.handleSwitchToVideoLayout(),d.removeClass("AV-call-audio-only").addClass("AV-call-audiovideo"),MediaCallUI.adjustCallContainerHeight(d),MediaCallUI.getVideoContainer(o.getId(),l.getId()).removeClass("AV-call-video-muted"),this.hasSwitchedToVideo()||MediaCallUI.showSwitchToVideoInfo(d)}if(void 0===this._avDownStream)this._videoDownStreamId=a,this._avDownStream=i,this.setRemoteAVStreamInContainer();else if(this._videoDownStreamId!==a){s=this._avDownStream._hasAudioTrack()?WebRTCUserMedia.streamTypes.AUDIO_VIDEO:WebRTCUserMedia.streamTypes.VIDEO_ONLY;this._avDownStream._hasVideoTrack()?this._avDownStream._replacePrimaryVideoTrack(e):this._avDownStream._addPrimaryVideoTrack(e,s),this._videoDownStreamId=a}else this.pauseAndPlay()}d=MediaCallUI.getMediaCallWrapper(o.getId());var c=r.isSharingScreen()||l.isSharingScreen(),u=o.isVideoCall()||r.hasSwitchedToVideo()||l.hasSwitchedToVideo();d.toggleClass("AV-call-no-subview",!u&&c)}},handleTrackEnd:function(e,t){if("audio"==e){var i=function(e){var i=MediaCallImpl.getCurrentSession();i?(i.writeToLog(CallLogConstants.trackEnd.event),i.getCurrentMember().replaceTracksInStream(e,WebRTCUserMedia.streamTypes.AUDIO_ONLY),i.getCurrentMember().setUpdatedAVStatus(),t&&t.currentTarget&&t.currentTarget.label&&i.writeToLog(CallLogConstants.trackEnd.device,t.currentTarget.label)):WebRTCUserMedia.closeStream(e._getType())}.bind(this);WebRTCUserMedia.requestAndReplaceTracksInStream(this._avUpStream,WebRTCUserMedia.streamTypes.AUDIO_ONLY,i,void 0,void 0,void 0)}},openWhiteBoard:function(){var e=MediaCallImpl.getCurrentSession();MediaCallImpl.getCurrentSession().getOtherMember();MediaCallUI.addAndGetWhiteBoardContainer(e._id,e)},closeWhiteBoard:function(){var e=MediaCallImpl.getCurrentSession();e.resetCurrentWhiteBoard(),MediaCallUI.removeWhiteBoardContainer(e,e.getOtherMemberId())},handleRemoteTrackIfRemoved:function(){var e=this.getRemoteTracksMediaId();if(MediaCallImpl.hasCurrentSession()&&void 0!==e&&void 0===e.screen){var t=MediaCallImpl.getCurrentSession().getOtherMember();t.resetSharingScreen(),this._screenDownStream=void 0,MediaCallUI.removeScreenContainer(MediaCallImpl.getCurrentSession(),t.getId())}},pauseAndPlay:function(){var e=MediaCallImpl.getCurrentSession().getOtherMember(),t=MediaCallUI.getVideoContainer(this._callId,e.getId()).find("video")[0];t.pause(),t.play().then(function(){var e=MediaCallUI.getMediaCallWrapper(this._callId);MediaCallUI.adjustCallContainerHeight(e)}.bind(this))},setRemoteAVStreamInContainer:function(){var e=MediaCallImpl.getCurrentSession().getOtherMember(),t=MediaCallUI.getVideoContainer(this._callId,e.getId());MediaUtil.setStreamInContainer(e.getId(),t,this._avDownStream,function(){var e=MediaCallUI.getMediaCallWrapper(this._callId);MediaCallUI.adjustCallContainerHeight(e)}.bind(this))},setLocalAVStreamInContainer:function(){var e=MediaCallUI.getVideoContainer(this._callId,this.getId());MediaUtil.setStreamInContainer(this.getId(),e,this._avUpStream,function(){var e=MediaCallUI.getMediaCallWrapper(this._callId);MediaCallUI.adjustCallContainerHeight(e)}.bind(this))},setRemoteScreenStreamInContainer:function(){var e=MediaCallImpl.getCurrentSession().getOtherMember(),t=MediaCallUI.addAndGetScreenContainer(this._callId,e.getId());MediaUtil.setStreamInContainer(e.getId(),t,this._screenDownStream,function(){var e=MediaCallUI.getMediaCallWrapper(this._callId);MediaCallUI.adjustCallContainerHeight(e)}.bind(this))},setAVDownStream:function(e){this._avDownStream=new MediaStream([e]),this.setRemoteAVStreamInContainer()},storeAVTrack:function(e){void 0!==this._avDownStream?"audio"==e.kind?this._avDownStream._replacePrimaryAudioTrack(e):this._avDownStream._replacePrimaryVideoTrack(e):(this._avDownStreamTracks.push(e),2===this._avDownStreamTracks.length&&(this._avDownStream=new MediaStream(this._avDownStreamTracks),this.setRemoteAVStreamInContainer(),this._avDownStreamTracks=[]))},addTrackInStream:function(e,t){if(this.setAVUpStream(e),this._remoteSdp=void 0,this._remoteIceCandidates=[],WebRTCUserMedia.isVideoStreamType(t)){var i=MediaCallUI.getMediaCallWrapper(this._callId);MediaCallUI.handleSwitchToVideoLayout(),i.removeClass("AV-call-audio-only").addClass("AV-call-audiovideo"),i.find('[mediacallbuttons][purpose="turnOffCamera"]').removeClass("dN zc-av-dN"),MediaCallUI.adjustCallContainerHeight(i)}this.setLocalAVStreamInContainer(),this._connection.addTrack(e,t)},replaceAVUpStreamTrack:function(e,t){this.setAVUpStream(e),this.setLocalAVStreamInContainer(),this._connection.replaceTracksWithoutNegotiation(e,t)},replaceTracksInStream:function(e,t){this.setAVUpStream(e),this._remoteSdp=void 0,this._remoteIceCandidates=[],this._connection.replaceTracks(e,t)},setRemoteTurnType:function(e){this._remoteTurnType=e,this._connection&&this._connection.setTurnType(this._remoteTurnType)},getRemoteTurnType:function(){return this._remoteTurnType},storeRemoteSdp:function(e){this._remoteSdp=e},setRemoteSdp:function(e){this.storeRemoteSdp(e),this._connection.setRemoteTracksMediaId(this._remoteTracksMediaId),this._connection.setRemoteSdp(e),this._connection.updateLocalIceCandidates(),this._connection.addRemoteIceCandidates(this._remoteIceCandidates),this._remoteIceCandidates=[]},getRemoteTracksMediaId:function(){return this._remoteTracksMediaId},storeRemoteTracksMediaId:function(e){void 0!==e&&(this._remoteTracksMediaId=e,this.handleRemoteTrackIfRemoved())},storeRemoteIceCandidates:function(e){e.forEach(function(e){this._remoteIceCandidates.push(e)}.bind(this))},setRemoteIceCandidates:function(e){this.storeRemoteIceCandidates(e),void 0!==this._remoteSdp&&(this._connection.addRemoteIceCandidates(e),this._remoteIceCandidates=[])},handleHoldStatus:function(e,t){this._holdStatus.time>t||(this._holdStatus.time=t,this._holdStatus.state=e)},setUpdatedAVStatus:function(){this.handleAVStreamStatus("audio",this._audioStatus.muted,this._audioStatus.time),this.handleAVStreamStatus("video",this._videoStatus.muted,this._videoStatus.time)},updateAVStatus:function(e,t,i){if("video"===e){if(this._videoStatus.time>i)return;this._videoStatus.time=i,this._videoStatus.muted=t}else{if(this._audioStatus.time>i)return;this._audioStatus.time=i,this._audioStatus.muted=t}},handleAVStreamStatus:function(e,t,i){var a=this.getId()===MediaCall.getCurrentUserId(),n=function(){WebRTCUserMedia.closeStream(this._avUpStream._getType()),this._avUpStream=void 0};if("video"===e){if(this._videoStatus.time>i)return;this._videoStatus.time=i,this._videoStatus.muted=t;var s=MediaCallUI.getVideoContainer(this._callId,this.getId());if(a){var o=this.getAVUpStream();MediaCall.isNoCamOrMicEnabled(MediaCallImpl.getCurrentSession())?t&&o&&o._hasVideoTrack()&&WebRTCUserMedia.removeTracksInStream(o,WebRTCUserMedia.streamTypes.VIDEO_ONLY,void 0,n.bind(this)):t?o._disableVideoTrack():o._enableVideoTrack()}else s.toggleClass("AV-call-video-muted",t);s.find("video").toggleClass("dN zc-av-dN",t)}else{if(this._audioStatus.time>i)return;if(this._audioStatus.time=i,this._audioStatus.muted=t,a){o=this.getAVUpStream();MediaCall.isNoCamOrMicEnabled(MediaCallImpl.getCurrentSession())?t&&o&&o._hasAudioTrack()&&WebRTCUserMedia.removeTracksInStream(o,WebRTCUserMedia.streamTypes.AUDIO_ONLY,void 0,n.bind(this)):t?o._disableAudioTrack():o._enableAudioTrack()}else MediaCallUI.getVideoContainer(this._callId,this.getId()).find("[audioMutedStatus]").toggleClass("dN zc-av-dN",!t)}},setLastReconnectionId:function(e){this._lastReconnectionId=e},clearLastReconnectionId:function(e){this._lastReconnectionId=void 0},isOfferAlreadyReceivedForReconnection:function(e){return this._lastReconnectionId===e},initConnection:function(e){this._connection=new MediaCallRTCPeerConnection(this._callId,this.getId(),this.getId(),e,this.getTurnCredentials(),MediaCallHandler.peerConnectionEvents),this._connection.init(this.getAVUpStream(),this.getScreenUpStream())},connectConnection:function(e){this._connection=new MediaCallRTCPeerConnection(this._callId,this.getId(),e,this.getId(),this.getTurnCredentials(),MediaCallHandler.peerConnectionEvents),this._connection.setTurnType(this._remoteTurnType),this._connection.setRemoteTracksMediaId(this._remoteTracksMediaId),this._connection.connect(this._remoteSdp,this._remoteIceCandidates,this.getAVUpStream(),this.getScreenUpStream()),this._connection.setConnectionHandshakeTimeout()},replaceScreenWithVideoInNewConnection:function(e){this.isSharingScreen()&&(MediaCallUI.resetScreenShareOption(),this._screenUpStream&&(WebRTCUserMedia.closeStream(this._screenUpStream._getType()),this._screenUpStream=void 0),this.resetSharingScreen()),this.setAVUpStream(e);var t=MediaCallUI.getMediaCallWrapper(this._callId);t.find('[mediacallbuttons][purpose="turnOffCamera"]').removeClass("dN zc-av-dN"),MediaCallUI.handleSwitchToVideoLayout(),MediaCallUI.adjustCallContainerHeight(t),this._connection.replaceScreenWithVideo(e)},replaceVideoWithScreenInNewConnection:function(e){var t=this.getAVUpStream();if(t._hasVideoTrack()){this.setScreenUpStream(e),this.setAsSharingScreen(),this.resetSwitchedToVideo();var i=MediaCallUI.getMediaCallWrapper(this._callId);if(this.isVideoMuted()){var a=i.find('[mediacallbuttons][purpose="turnOnCamera"]').addClass("dN zc-av-dN");MediaCallHandler.UIEvents.turnOnCamera(void 0,a)}else i.find('[mediacallbuttons][purpose="turnOffCamera"]').addClass("dN zc-av-dN");var n=function(t){var i=MediaCallUI.getVideoContainer(this._callId,this.getId());MediaUtil.setStreamInContainer(this.getId(),i,t),this._connection.replaceVideoWithScreen(t,e)}.bind(this);WebRTCUserMedia.removeTracksInStream(t,WebRTCUserMedia.streamTypes.VIDEO_ONLY,!1,n)}else this.addScreenInConnection(e)},addScreenInConnection:function(e){this.isSharingScreen()||(this.setScreenUpStream(e),this.setAsSharingScreen(),this._connection.addScreenTrack(e))},removeScreenFromConnection:function(){this.isSharingScreen()&&(this._screenUpStream&&(WebRTCUserMedia.closeStream(this._screenUpStream._getType()),this._screenUpStream=void 0,this._connection.removeScreenTrack()),this.resetSharingScreen())},handleReconnect:function(e,t,i){if(this._remoteSdp=void 0,this._remoteIceCandidates=[],this._avDownStream=void 0,this._screenDownStream=void 0,this._avDownStreamTracks=[],this._hasAddedTransceiverForVideo=!1,i)this._connection.restartOffererProcess(),this._connection.setRemoteTracksMediaId(this._remoteTracksMediaId);else{var a=function(t){var i=MediaCallImpl.getCurrentSession();i&&i.getId()===e&&!i.getCurrentMember().isIceConnectionStateConnected()&&(void 0===t||t.code!==MediaCallAPI.errorCodes.CALL_ALREADY_ENDED?(clearTimeout(this._pullOfferTimer),i.writeToLog(CallLogConstants.pullOffer.retry,t),this._pullOfferTimer=setTimeout((function(){n()}),2e3)):(i.writeToLog(CallLogConstants.pullOffer.end,t),MediaCallImpl.handleEnd(this._callId,!0)))}.bind(this),n=function(){(void 0!==MediaCall.BRIDGE?MediaCall.BRIDGE.isWMSConnected():$zcg._CONNECTED)?MediaCallAPI.pullOffer(this._callId,function(e){var t=JSON.parse(e.offer_description),i=e.reconnection_id;this.isOfferAlreadyReceivedForReconnection(i)||(this.setLastReconnectionId(i),this._remoteSdp=t,this.setRemoteTurnType(e.turn_type),void 0===this.getRemoteTurnType()&&this._connection.switchTurnServers(),this._connection.restartAnswererProcess(t),this._connection.setRemoteTracksMediaId(this._remoteTracksMediaId))}.bind(this),a):a()}.bind(this);MediaCall.isLongPollingEnabled()||n()}},handleReinit:function(e){this._remoteSdp=void 0,this._remoteIceCandidates=[],this._avDownStream=void 0,this._screenDownStream=void 0,this._avDownStreamTracks=[],e?(this._connection.reinitOfferer(),this._connection.setRemoteTracksMediaId(this._remoteTracksMediaId)):MediaCallAPI.reinit(this._callId)},reinitOffererConnection:function(){this._remoteSdp=void 0,this._remoteIceCandidates=[],this._avDownStream=void 0,this._screenDownStream=void 0,this._avDownStreamTracks=[],this._connection.reinitOfferer(),this._connection.setRemoteTracksMediaId(this._remoteTracksMediaId)},reinitAnswererConnection:function(e){this._remoteSdp=e,this._remoteIceCandidates=[],this._avDownStream=void 0,this._screenDownStream=void 0,this._avDownStreamTracks=[],this._connection.reinitAnswerer(e),this._connection.setRemoteTracksMediaId(this._remoteTracksMediaId)},restartAnswererConnection:function(e){clearTimeout(this._pullOfferTimer),this._pullOfferTimer=void 0,this._remoteSdp=e,this._remoteIceCandidates=[],this._avDownStream=void 0,this._screenDownStream=void 0,this._avDownStreamTracks=[],void 0===this.getRemoteTurnType()&&this._connection.switchTurnServers(),this._connection.restartAnswererProcess(e),this._connection.setRemoteTracksMediaId(this._remoteTracksMediaId)},renegotiateOffererConnection:function(e){var t=!1;this._hasAddedTransceiverForVideo||!this.isPerfectRenegotiationSupported()||e||void 0!==this._screenDownStream&&void 0!==this._avDownStream&&this._avDownStream._hasVideoTrack()||(this._hasAddedTransceiverForVideo=t=!0),this._connection.renegotiateOfferer(e,t)},renegotiateAnswererConnection:function(e,t){this._connection.setRemoteTracksMediaId(this._remoteTracksMediaId),this._connection.renegotiateAnswerer(e,t)},isConnectionStateClosed:function(){return void 0===this._connection||this._connection.isConnectionStateClosed()},clearPullOfferTimer:function(){clearTimeout(this._pullOfferTimer),this._pullOfferTimer=void 0},removeStreamInstances:function(){this._avUpStream=void 0,this._screenUpStream=void 0},closeConnection:function(e){clearTimeout(this._pullOfferTimer),this._pullOfferTimer=void 0,clearTimeout(this._sendOfferTimer),this._sendOfferTimer=void 0,this._connection&&this._connection.close(),e&&(this._avUpStream&&(WebRTCUserMedia.closeStream(this._avUpStream._getType()),this._avUpStream=void 0),this._screenUpStream&&(WebRTCUserMedia.closeStream(this._screenUpStream._getType()),this._screenUpStream=void 0))}};var AdhocOneToOneCallHandler={handleAVStatus:function(e,t,i){var a=i.msgObj,n=MediaCallImpl.getCurrentSession();if(n&&n.getId()===t){var s=n.getCurrentMemberId(),o=n.getOtherMemberId();if(n.writeToLog(CallLogConstants.wms.mediaSetting+JSON.stringify(a)),s!==a.actionUserId&&a.userIds.includes(o)){var r=n.getOtherMember();a.audio?r.handleAVStreamStatus("audio",a.audio.muted,a.audio.time):r.handleAVStreamStatus("video",a.video.muted,a.video.time)}}},handleScreenRemoved:function(e,t,i){var a=MediaCallImpl.getCurrentSession(),n=a.getOtherMember().getId(),s=a.getCurrentMember().getId();a&&a.getId()===t&&(i.userId===s?(MediaCallUI.resetScreenShareOption(),a.getCurrentMember().resetSharingScreen()):i.userId===n&&MediaCallUI.removeScreenContainer(a,n))},handleVideoStream:function(e,t,i){var a=MediaCallImpl.getCurrentSession();if(a&&a.getId()===t){var n=i.videoStream,s=a.getCurrentMember().getId(),o=a.getOtherMember().getId();if(void 0!==n&&(i.userId===o||i.userId===s)){var r=MediaCallUI.getVideoContainer(t,i.userId);MediaCallUI.getMediaCallWrapper(t);MediaUtil.setStreamInContainer(i.userId,r,n,function(){var e=MediaCallUI.getMediaCallWrapper(t);MediaCallUI.adjustCallContainerHeight(e)}.bind(this))}}},handleScreenStream:function(e,t,i){var a=MediaCallImpl.getCurrentSession();if(a&&a.getId()===t){var n=i.screenStream,s=a.getOtherMember().getId();if(void 0!==n&&i.userId===s){var o=MediaCallUI.addAndGetScreenContainer(t,s);MediaUtil.setStreamInContainer(s,o,n,function(){var e=MediaCallUI.getMediaCallWrapper(t);MediaCallUI.adjustCallContainerHeight(e)}.bind(this))}}}},AdhocConferenceHandler={audioMute:function(e,t,i){var a=e.getId(),n=e.getCurrentMember();e.writeToLog(CallLogConstants.ui.micOff);var s=MediaCallUI.getMediaCallWrapper(a);s.find('[mediacallbuttons][purpose="turnOffMicrophone"]').addClass("zcf-mic-mute").removeClass("zcf-mic").attr({purpose:"turnOnMicrophone",title:MediaCall.BRIDGE.Resource.getRealValue("common.micon")}),MediaCallUI.getVideoContainer(a,n.getId()).find("[audioMutedStatus]").removeClass("dN zc-av-dN");var o=MediaCallUI.isInFullScreenView(s);s.addClass("AV-call-mute-banner"),s.prepend(MediaTemplates.getMutedBanner(!o)),n.updateAVStatus("audio",!0,MediaCall.BRIDGE.Util.getSyncedCurrentTime());var r=s.find("#newDeviceInfoCnt");r&&r.find('[mediacallbuttons][purpose="switchToNewDevice"]').attr("deviceKind")===ZCMediaDevices.kinds.AUDIO_INPUT&&MediaCallUI.removeNewDeviceInfoCnt(e),ConferenceImpl.hasCurrentSession()&&ConferenceImpl.getCurrentSession().getId()===t?ConferenceHandler.UIEvents.muteAudio():ZCSmartConferenceImpl.hasCurrentSession()&&ZCSmartConferenceImpl.getCurrentSession().getId()===t&&ZCSmartConferenceHandler.UIEvents.muteAudio()},audioUnMute:function(e,t,i){var a=e.getId(),n=e.getCurrentMember(),s=MediaCallUI.getMediaCallWrapper(a);s.find('[mediacallbuttons][purpose="turnOnMicrophone"]').addClass("zcf-mic").removeClass("zcf-mic-mute").attr({purpose:"turnOffMicrophone",title:MediaCall.BRIDGE.Resource.getRealValue("common.micoff")}),MediaCallUI.getVideoContainer(a,n.getId()).find("[audioMutedStatus]").addClass("dN zc-av-dN"),s.removeClass("AV-call-mute-banner"),s.find("[mutedinfocnt]").remove(),n.updateAVStatus("audio",!1,MediaCall.BRIDGE.Util.getSyncedCurrentTime()),ConferenceImpl.hasCurrentSession()&&ConferenceImpl.getCurrentSession().getId()===t?ConferenceHandler.UIEvents.unmuteAudio():ZCSmartConferenceImpl.hasCurrentSession()&&ZCSmartConferenceImpl.getCurrentSession().getId()===t&&ZCSmartConferenceHandler.UIEvents.unmuteAudio()},videoMute:function(e,t,i){var a=e.getId(),n=e.getCurrentMember();e.writeToLog(CallLogConstants.ui.camOff),MediaCallUI.getMediaCallWrapper(a).find('[mediacallbuttons][purpose="turnOffCamera"]').addClass("zcf-video-mute").removeClass("zcf-video").attr({purpose:"turnOnCamera",title:MediaCall.BRIDGE.Resource.getRealValue("videochat.cameraon")}),n.updateAVStatus("video",!0,MediaCall.BRIDGE.Util.getSyncedCurrentTime()),MediaCallUI.getVideoContainer(a,n.getId()).find("video").addClass("dN zc-av-dN");var s=MediaCallUI.getMediaCallWrapper(a).find("#newDeviceInfoCnt");s&&s.find('[mediacallbuttons][purpose="switchToNewDevice"]').attr("deviceKind")===ZCMediaDevices.kinds.VIDEO_INPUT&&MediaCallUI.removeNewDeviceInfoCnt(e),ConferenceImpl.hasCurrentSession()&&ConferenceImpl.getCurrentSession().getId()===t?ConferenceHandler.UIEvents.muteVideo():ZCSmartConferenceImpl.hasCurrentSession()&&ZCSmartConferenceImpl.getCurrentSession().getId()===t&&ZCSmartConferenceHandler.UIEvents.muteVideo()},videoUnMute:function(e,t,i){var a=e.getId(),n=MediaCallUI.getMediaCallWrapper(a),s=e.getCurrentMember(),o=MediaCallUI.getVideoContainer(a,s.getId());n.find('[mediacallbuttons][purpose="turnOnCamera"]').addClass("zcf-video").removeClass("zcf-video-mute").attr({purpose:"turnOffCamera",title:MediaCall.BRIDGE.Resource.getRealValue("videochat.cameraoff")}),o.removeClass("AV-call-video-muted"),o.find("video").removeClass("dN zc-av-dN"),s.updateAVStatus("video",!1,MediaCall.BRIDGE.Util.getSyncedCurrentTime()),ConferenceImpl.hasCurrentSession()&&ConferenceImpl.getCurrentSession().getId()===t?ConferenceHandler.UIEvents.unmuteVideo():ZCSmartConferenceImpl.hasCurrentSession()&&ZCSmartConferenceImpl.getCurrentSession().getId()===t&&ZCSmartConferenceHandler.UIEvents.unmuteVideo()},startScreenShare:function(e,t,i){var a=e.getId(),n=(MediaCallUI.getMediaCallWrapper(a),ZCJQuery('[mediacallbuttons][purpose="startScreenShare"]'));n.length&&(n.attr("purpose","stopScreenShare").addClass("AV-call-selected"),n.find("[icon]").removeClass("zcf-sharescrn").addClass("zcf-scrn-shr-stop"),n.find("[content]").text(MediaCall.BRIDGE.Resource.getRealValue("media.screenshare.end"))),e.getCurrentMember().setAsSharingScreen(),ConferenceImpl.hasCurrentSession()&&ConferenceImpl.getCurrentSession().getId()===t?ConferenceHandler.UIEvents.startScreenShare():ZCSmartConferenceImpl.hasCurrentSession()&&ZCSmartConferenceImpl.getCurrentSession().getId()===t&&ZCSmartConferenceUI.startScreenShare()},stopScreenShare:function(e,t,i){MediaCallUI.resetScreenShareOption(),e.getCurrentMember().resetSharingScreen(),ConferenceImpl.hasCurrentSession()&&ConferenceImpl.getCurrentSession().getId()===t?ConferenceHandler.UIEvents.stopScreenShare():ZCSmartConferenceImpl.hasCurrentSession()&&ZCSmartConferenceImpl.getCurrentSession().getId()===t&&ZCSmartConferenceHandler.UIEvents.stopScreenShare()},setMediaDevices:function(e,t,i){var a=i.changedDevices;ConferenceImpl.hasCurrentSession()&&ConferenceImpl.getCurrentSession().getId()===t?ConferenceImpl.handleDeviceChange(ConferenceImpl.getCurrentSession(),a):ZCSmartConferenceImpl.hasCurrentSession()&&ZCSmartConferenceImpl.getCurrentSession().getId()===t&&ZCSmartConferenceImpl.handleDeviceChange(ZCSmartConferenceImpl.getCurrentSession(),a)},addUsers:function(e,t,i){var a=i.selectedList,n=ZCSmartConferenceImpl.getCurrentActiveSession().getId();ConferenceAPI.invite(n,a,!1,!0),ZCSmartConferenceUI.closeInviteUsers(n),AdhocCallBridge.detach(e)},startRecording:function(e,t,i){var a=i.refIndex;ConferenceImpl.hasCurrentSession()&&ConferenceImpl.getCurrentSession().getId()===t?(ConferenceImpl.getCurrentSession().setRecordingReferenceIndex(a),ConferenceImpl.getCurrentSession().sendRecordingStatusToParticipants(),$("#conferencewindow").find("[recording_indicator]").fadeIn()):ZCSmartConferenceImpl.hasCurrentSession()&&ZCSmartConferenceImpl.getCurrentSession().getId()===t&&(ZCSmartConferenceImpl.getCurrentSession().setRecordingReferenceIndex(a),ZCSmartConferenceImpl.getCurrentSession().sendRecordingStatusToParticipants(),ZCSmartConferenceUI.getConferenceWindow().find("[recording_indicator]").fadeIn())},stopRecording:function(e,t,i){ConferenceImpl.hasCurrentSession()&&ConferenceImpl.getCurrentSession().getId()===t?(ConferenceImpl.getCurrentSession().setRecordingReferenceIndex(void 0),ConferenceImpl.getCurrentSession().sendRecordingStatusToParticipants(),$("#conferencewindow").find("[recording_indicator]").fadeOut()):ZCSmartConferenceImpl.hasCurrentSession()&&ZCSmartConferenceImpl.getCurrentSession().getId()===t&&(ZCSmartConferenceImpl.getCurrentSession().setRecordingReferenceIndex(void 0),ZCSmartConferenceImpl.getCurrentSession().sendRecordingStatusToParticipants(),ZCSmartConferenceUI.getConferenceWindow().find("[recording_indicator]").fadeOut())}},MediaCallRTCPeerConnectionConstants={};MediaCallRTCPeerConnectionConstants={processTypes:{INIT:"init",REINIT:"reinit",RESTART:"reconnection",RENEGOTIATE:"renegotiate"},isRestart:function(e){return this.processTypes.RESTART===e},turnTypes:{GEO:"geo",MAIN:"main",BACKUP:"backup",isGeo:function(e){return this.GEO===e},isMain:function(e){return this.MAIN===e},isBackup:function(e){return this.BACKUP===e}},defaultReconnectionInterval:2e3};var MediaCallRTCPeerConnection=function(e,t,i,a,n,s){this._connectionId=e,this._hostId=t,this._offererId=i,this._answererId=a,this._connection=void 0,this._turnCredentials=n,this._avUpStream=void 0,this._screenUpStream=void 0,this._localSdp=void 0,this._remoteSdp=void 0,this._localIceCandidates=[],this._remoteIceCandidates=[],this._audioRtpSenders=[],this._videoRtpSenders=[],this._screenRtpSenders=[],this._localTracksMediaId={},this._remoteTracksMediaId={},this._canUpdateLocalIceCandidates=!1,this._iceCandidatesGatheringTimer=void 0,this._disconnectTimer=void 0,this._connectionHandshakeTimer=void 0,this._reconnectionId=0,this._reconnectionState=MediaCall.BRIDGE.Util.Browser.isFirefox()?WebRTCPeerConnectionConstants.iceConnectionStates.FAILED:WebRTCPeerConnectionConstants.iceConnectionStates.DISCONNECTED,this._reconnectionInterval=MediaCall.BRIDGE.Util.Browser.isFirefox()?0:MediaCallRTCPeerConnectionConstants.defaultReconnectionInterval,this._processType=MediaCallRTCPeerConnectionConstants.processTypes.INIT,this._handler=s,this._turnType=MediaCallRTCPeerConnectionConstants.turnTypes.GEO,this._currentTurnConnected=!1,this._connectionTimeout=void 0,this._connectionTimeoutInterval=5e3};MediaCallRTCPeerConnection.prototype={_getTurnServerUrls:function(){var e=[];return MediaCallRTCPeerConnectionConstants.turnTypes.isGeo(this._turnType)?$WC.Util.isEmpty(this._turnCredentials.geo_turnurls)?(e=this._turnCredentials.main_turnurls,this._turnType=MediaCallRTCPeerConnectionConstants.turnTypes.MAIN):e=this._turnCredentials.geo_turnurls:MediaCallRTCPeerConnectionConstants.turnTypes.isMain(this._turnType)?e=this._turnCredentials.main_turnurls:MediaCallRTCPeerConnectionConstants.turnTypes.isBackup(this._turnType)&&($WC.Util.isEmpty(this._turnCredentials.backup_turnurls)?(e=this._turnCredentials.main_turnurls,this._turnType=MediaCallRTCPeerConnectionConstants.turnTypes.MAIN):e=this._turnCredentials.backup_turnurls),e},_getConfiguration:function(){if($WC.Util.isEmpty(this._turnCredentials)||$WC.Util.isEmptyObject(this._turnCredentials))return{};var e=this._getTurnServerUrls(),t=this._turnCredentials.username,i=this._turnCredentials.credential,a=[];return e.forEach((function(e){a.push({urls:e,username:t,credential:i})})),{iceServers:a}},_addTracksInConnection:function(){void 0!==this._avUpStream&&this._addAVTracksInConnection(),void 0!==this._screenUpStream&&this._addScreenTracksInConnection()},_addAVTracksInConnection:function(){this._addAudioTracksInConnection(),this._addVideoTracksInConnection()},_addAudioTracksInConnection:function(){this._avUpStream.getTracks().forEach(function(e){"audio"===e.kind&&(this._audioRtpSenders.push(this._connection.addTrack(e,this._avUpStream)),this._localTracksMediaId.audio=this._avUpStream.id)}.bind(this))},_addVideoTracksInConnection:function(){this._avUpStream.getTracks().forEach(function(e){"video"===e.kind&&(this._videoRtpSenders.push(this._connection.addTrack(e,this._avUpStream)),this._localTracksMediaId.video=this._avUpStream.id)}.bind(this))},_addScreenTracksInConnection:function(){this._screenUpStream.getTracks().forEach(function(e){this._screenRtpSenders.push(this._connection.addTrack(e,this._screenUpStream)),this._localTracksMediaId.screen=this._screenUpStream.id}.bind(this))},_removeAVTracksInConnection:function(){this._removeAudioTracksInConnection(),this._removeVideoTracksInConnection()},_removeAudioTracksInConnection:function(){this._audioRtpSenders.forEach(function(e){delete this._localTracksMediaId.audio,this._connection.removeTrack(e)}.bind(this)),this._audioRtpSenders=[]},_removeVideoTracksInConnection:function(){this._videoRtpSenders.forEach(function(e){delete this._localTracksMediaId.video,this._connection.removeTrack(e)}.bind(this)),this._videoRtpSenders=[]},_removeScreenTracksInConnection:function(){this._screenRtpSenders.forEach(function(e){delete this._localTracksMediaId.screen,this._connection.removeTrack(e)}.bind(this)),this._screenRtpSenders=[]},isConnectionStateClosed:function(){return void 0===this._connection||this._connection.iceConnectionState==WebRTCPeerConnectionConstants.iceConnectionStates.CLOSED},isIceConnectionStateConnected:function(){return this._connection.iceConnectionState==WebRTCPeerConnectionConstants.iceConnectionStates.CONNECTED},init:function(e,t){this._connection=new RTCPeerConnection(this._getConfiguration()),this._bindEventHandlers(),this._avUpStream=e,this._screenUpStream=t,this._addTracksInConnection();var i=!1;void 0!==this._avUpStream&&WebRTCUserMedia.isAudioStreamType(this._avUpStream._getType())&&(i=this._handler.hasRemoteVideo(this._connectionId)),this._createOffer(this._processType,this._processType===MediaCallRTCPeerConnectionConstants.processTypes.REINIT,i)},connect:function(e,t,i,a){this._connection=new RTCPeerConnection(this._getConfiguration()),this._bindEventHandlers(),this._remoteSdp=e,void 0!==t&&(this._remoteIceCandidates=t),this._avUpStream=i,this._screenUpStream=a,this._addTracksInConnection(),this._createAnswer(this._processType)},_bindEventHandlers:function(){var e=this._connection,t=function(e){var t=e.candidate;if(t){if(this._localIceCandidates.push(t),!this._canUpdateLocalIceCandidates)return;if(!this._iceCandidatesGatheringTimer){var i=function(){this._handler.updateIceCandidates(this._connectionId,this._localIceCandidates,this._processType,this._reconnectionId),this._localIceCandidates=[],this._iceCandidatesGatheringTimer=void 0}.bind(this);this._iceCandidatesGatheringTimer=setTimeout(i,100)}}}.bind(this),i=function(t){var i=e.iceConnectionState;if("function"==typeof this._handler.handleIceConnectionStateChange&&this._handler.handleIceConnectionStateChange(this._connectionId,i),WebRTCPeerConnectionConstants.iceConnectionStates.CONNECTED===i){var a=this._processType;this._processType=MediaCallRTCPeerConnectionConstants.processTypes.INIT,clearTimeout(this._connectionHandshakeTimer),this._connectionHandshakeTimer=void 0,clearTimeout(this._disconnectTimer),this._disconnectTimer=void 0,this.clearConnectionTimeout(),this.setCurrentTurnConnectedStatus(!0),this._handler.handleConnected(this._connectionId,this._connection,this._hostId,a,this._turnType)}else this._reconnectionState===i&&(this.clearConnectionTimeout(),this.setConnectionHandshakeTimeout(),clearTimeout(this._disconnectTimer),this._disconnectTimer=setTimeout(function(){this._reconnect()}.bind(this),this._reconnectionInterval),this._handler.handleDisconnected(this._connectionId,this._hostId))}.bind(this),a=function(e){this._handler.handleTrack(this._connectionId,e.track,e.streams)}.bind(this),n=function(e){var t={code:e.errorCode,text:e.errorText,hostCandidate:e.hostCandidate,url:e.url,iceConnectionState:this._connection.iceConnectionState,iceGatheringState:this._connection.iceGatheringState};this._handler.handleIceCandidateError(this._connectionId,t)}.bind(this),s=function(t){this._handler.handleIceGatheringStateChange(this._connectionId,e.iceGatheringState)}.bind(this),o=function(t){this._handler.handleSignalingStateChange(this._connectionId,e.signalingState)}.bind(this);e.onicecandidate=t,e.oniceconnectionstatechange=i,e.onicecandidateerror=n,e.ontrack=a,e.onicegatheringstatechange=s,e.onsignalingstatechange=o},_createOffer:function(e,t,i){var a={};t&&(a={offerToReceiveAudio:!0,offerToReceiveVideo:!0}),i&&"function"==typeof this._connection.addTransceiver&&this._connection.addTransceiver(WebRTCUserMedia.getStreamTypeInString(WebRTCUserMedia.streamTypes.VIDEO_ONLY)),this._connection.createOffer(a).then(function(t){this._localSdp=t,this._handler.isStereoEnabled(this._connectionId)&&(this._localSdp.sdp=this._localSdp.sdp.replace("useinbandfec=1","useinbandfec=1;stereo=1;sprop-stereo=1")),this._connection.setLocalDescription(t).then(function(){this._handler.sendOffer(this._connectionId,this._localSdp,e,this._reconnectionId,this._localTracksMediaId,this._turnType)}.bind(this))}.bind(this))},_createAnswer:function(e){var t={};this._connection.setRemoteDescription(this._remoteSdp).then(function(){this._connection.createAnswer(t).then(function(t){this._localSdp=t,this._handler.isStereoEnabled(this._connectionId)&&(this._localSdp.sdp=this._localSdp.sdp.replace("useinbandfec=1","useinbandfec=1;stereo=1;sprop-stereo=1")),this._connection.setLocalDescription(t).then(function(){this._handler.sendAnswer(this._connectionId,this._localSdp,e,this._reconnectionId,this._localTracksMediaId),this.updateLocalIceCandidates()}.bind(this))}.bind(this)),this.addRemoteIceCandidates()}.bind(this))},addScreenTrack:function(e){this._screenUpStream=e,this._addScreenTracksInConnection(),this._renegotiate()},removeScreenTrack:function(){this._removeScreenTracksInConnection(),this._screenUpStream=void 0,this._renegotiate()},addTrack:function(e,t){this._avUpStream=e,WebRTCUserMedia.isAudioStreamType(t)?this._addAudioTracksInConnection():this._addVideoTracksInConnection(),this._renegotiate()},replaceTracksWithoutNegotiation:function(e,t){if(this._avUpStream){var i=function(){this.replaceTracks(e,t)}.bind(this);if(this._avUpStream=e,"function"!=typeof RTCRtpSender.prototype.replaceTrack)return i();if(WebRTCUserMedia.isAudioStreamType(t)||WebRTCUserMedia.isAudioVideoStreamType(t)){if(0===this._audioRtpSenders.length)return i();this._audioRtpSenders.forEach(function(t){t.replaceTrack(e._getPrimaryAudioTrack()).then(function(){this._localTracksMediaId.audio=e.id}.bind(this)).catch(i)}.bind(this))}if(WebRTCUserMedia.isVideoStreamType(t)||WebRTCUserMedia.isAudioVideoStreamType(t)){if(0===this._videoRtpSenders.length)return i();this._videoRtpSenders.forEach(function(t){t.replaceTrack(e._getPrimaryVideoTrack()).then(function(){this._localTracksMediaId.video=e.id}.bind(this)).catch(i)}.bind(this))}}},replaceTracks:function(e,t){this._avUpStream=e,WebRTCUserMedia.isAudioVideoStreamType(t)?(this._removeAVTracksInConnection(),this._addAVTracksInConnection()):WebRTCUserMedia.isAudioStreamType(t)?(this._removeAudioTracksInConnection(),this._addAudioTracksInConnection()):(this._removeVideoTracksInConnection(),this._addVideoTracksInConnection()),this._renegotiate()},replaceScreenWithVideo:function(e){this._avUpStream=e,this._screenUpStream=void 0,this._reinit()},replaceVideoWithScreen:function(e,t){this._avUpStream=e,this._screenUpStream=t,this._reinit()},_reinit:function(){this._handler.handleReinit(this._connectionId,this._hostId,this._offererId===this._hostId)},_renegotiate:function(){this._handler.handleRenegotiate(this._connectionId,this._hostId,this._offererId===this._hostId)},_reconnect:function(){this._reconnectionId++,this._handler.handleReconnect(this._connectionId,this._reconnectionId,this._hostId,this._offererId===this._hostId)},setConnectionHandshakeTimeout:function(){void 0===this._connectionHandshakeTimer&&(this._connectionHandshakeTimer=setTimeout(function(){this._handler.handleClosed(this._connectionId,this._hostId)}.bind(this),3e4))},restartOffererProcess:function(){this._processType=MediaCallRTCPeerConnectionConstants.processTypes.RESTART,this._closeConnection(),this.switchTurnServers(),this.init(this._avUpStream,this._screenUpStream)},restartAnswererProcess:function(e){this._processType=MediaCallRTCPeerConnectionConstants.processTypes.RESTART,this._closeConnection(),this.connect(e,void 0,this._avUpStream,this._screenUpStream)},reinitOfferer:function(){this._processType=MediaCallRTCPeerConnectionConstants.processTypes.REINIT,this._closeConnection(),this.init(this._avUpStream,this._screenUpStream)},reinitAnswerer:function(e){this._processType=MediaCallRTCPeerConnectionConstants.processTypes.REINIT,this._closeConnection(),this.connect(e,void 0,this._avUpStream,this._screenUpStream)},renegotiateOfferer:function(e,t){this._processType=MediaCallRTCPeerConnectionConstants.processTypes.RENEGOTIATE,this._offererId=this._hostId,this._canUpdateLocalIceCandidates=!1,this._localIceCandidates=[],void 0!==this._avUpStream&&WebRTCUserMedia.isAudioStreamType(this._avUpStream._getType())&&(t=this._handler.hasRemoteVideo(this._connectionId)),this._createOffer(this._processType,!e,t)},renegotiateAnswerer:function(e,t){this._processType=MediaCallRTCPeerConnectionConstants.processTypes.RENEGOTIATE,this._remoteSdp=e,this._offererId=t,this._createAnswer(this._processType)},setRemoteSdp:function(e){this._remoteSdp=e,this._connection.setRemoteDescription(this._remoteSdp),"function"==typeof this._handler.canStartConnectionTimeout&&this._handler.canStartConnectionTimeout(this._connectionId)&&this.startConnectionTimeout()},setRemoteTracksMediaId:function(e){this._remoteTracksMediaId=e},setTurnType:function(e){void 0!==e&&(this._turnType=e)},isCurrentTurnConnected:function(){return this._currentTurnConnected},setCurrentTurnConnectedStatus:function(e){this._currentTurnConnected=e},switchTurnServers:function(){this.isCurrentTurnConnected()?this.setCurrentTurnConnectedStatus(!1):MediaCallRTCPeerConnectionConstants.turnTypes.isGeo(this._turnType)?this.setTurnType(MediaCallRTCPeerConnectionConstants.turnTypes.MAIN):MediaCallRTCPeerConnectionConstants.turnTypes.isMain(this._turnType)?this.setTurnType(MediaCallRTCPeerConnectionConstants.turnTypes.BACKUP):this.setTurnType(MediaCallRTCPeerConnectionConstants.turnTypes.GEO)},updateLocalIceCandidates:function(){this._canUpdateLocalIceCandidates=!0,this._handler.updateIceCandidates(this._connectionId,this._localIceCandidates,this._processType,this._reconnectionId),this._localIceCandidates=[]},addRemoteIceCandidates:function(e){e&&e.forEach(function(e){this._remoteIceCandidates.push(e)}.bind(this));var t=this._connection;this._remoteIceCandidates.forEach((function(e){t.addIceCandidate(new RTCIceCandidate(e))})),this._remoteIceCandidates=[]},setBitRate:function(e){this._videoRtpSenders.forEach((function(t){var i=t.getParameters();i.encodings||(i.encodings=[{}]),i.encodings[0].maxBitrate=1e3*e,t.setParameters(i)}))},setReconnectionPolicy:function(e){this._reconnectionState=MediaCall.BRIDGE.Util.Browser.isFirefox()?WebRTCPeerConnectionConstants.iceConnectionStates.FAILED:e.event,this._reconnectionInterval=MediaCall.BRIDGE.Util.Browser.isFirefox()?0:parseInt(e.interval),this._connectionTimeoutInterval=parseInt(e.connection_timeout)},_closeConnection:function(){clearTimeout(this._iceCandidatesGatheringTimer),this._iceCandidatesGatheringTimer=void 0,this._connection&&(this._connection.close(),this._connection=void 0),this._localSdp=void 0,this._remoteSdp=void 0,this._localIceCandidates=[],this._remoteIceCandidates=[],this._audioRtpSenders=[],this._videoRtpSenders=[],this._screenRtpSenders=[],this._localTracksMediaId={},this._remoteTracksMediaId={}},startConnectionTimeout:function(){clearTimeout(this._connectionTimeout),this._connectionTimeout=setTimeout(function(){void 0===this._connection||this.isIceConnectionStateConnected()||(this._handler.handleInitialReconnection(this._connectionId,this._turnType,this._localIceCandidates,this._remoteIceCandidates),this.setConnectionHandshakeTimeout(),this._reconnect())}.bind(this),this._connectionTimeoutInterval)},clearConnectionTimeout:function(){clearTimeout(this._connectionTimeout),this._connectionTimeout=void 0},close:function(){clearTimeout(this._connectionHandshakeTimer),this._connectionHandshakeTimer=void 0,clearTimeout(this._disconnectTimer),this._disconnectTimer=void 0,this.clearConnectionTimeout(),this._closeConnection()}};var WebRTCUserMedia={};WebRTCUserMedia=function(){var e=void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia,t=e&&void 0!==navigator.mediaDevices.getDisplayMedia,i=e&&void 0!==navigator.permissions&&"function"==typeof navigator.permissions.query,a=e&&void 0!==window.MediaRecorder&&"function"==typeof window.MediaRecorder;if(!e)return{isSupported:function(){return e},isScreenShareSupportedInNative:function(){return t&&!_isZCDesktopApp()},isDisplayMediaSupported:function(){return t}};var n={};navigator.mediaDevices.getSupportedConstraints&&(n=navigator.mediaDevices.getSupportedConstraints());var s={},o={1:null,2:null,3:null,4:null},r={AUDIO_ONLY:1,VIDEO_ONLY:2,AUDIO_VIDEO:3,SCREEN:4},l={1:"audio",2:"video",3:"audiovideo",4:"video"},d={audio:1,video:2,audiovideo:3},c=function(e,t){return s[e]?s[e][t]:void 0},u=function(e,t){var i=t._getType();void 0===s[e]&&(s[e]={}),s[e][i]=t},C=function(e,t,i,a,n,s,r,l,d){var C=r?c(l,e):o[e];if(C)t(C);else{var p=f(e,a);(n?navigator.mediaDevices.getDisplayMedia:navigator.mediaDevices.getUserMedia).call(navigator.mediaDevices,p).then((function(a){var n=r&&l;function c(i){if(i._setType(e),n?(i._setAsModuleInstance(l),u(l,i)):o[e]=i,"function"==typeof s){var a=i._getPrimaryVideoTrack();a&&(a.onended=s)}t(i)}n&&a._setAsModuleInstance(l),void 0!==MLBackgroundProcessor&&d?MLBackgroundProcessor.processStream(a,e,d,c,i):c(a)})).catch((function(t){"function"==typeof i&&i(t,e)}))}},p=function(e,t){navigator.mediaDevices.enumerateDevices().then((function(t){void 0!==ZCMediaDevices&&ZCMediaDevices.update(t),"function"==typeof e&&e(t)})).catch((function(e){void 0!==ZCMediaDevices&&ZCMediaDevices.update([]),"function"==typeof t&&t(e)}))},h=function(e,t,i){navigator.permissions.query({name:e}).then((function(e){"function"==typeof t&&t(e.state)})).catch((function(e){"function"==typeof i&&i(e)}))},m=function(e){var t=o[e];t?(t._close(),o[e]=null):o[e]=null},f=function(e,t){var i={},a=!0,s=!0;if(e!==r.SCREEN&&n["deviceId"]&&void 0!==ZCMediaDevices){var o=ZCMediaDevices.getPreferredDevices(),l=o[ZCMediaDevices.kinds.AUDIO_INPUT],d=o[ZCMediaDevices.kinds.VIDEO_INPUT];l&&(a={deviceId:{exact:l.deviceId}}),d&&(s={deviceId:{exact:d.deviceId}})}switch(i=ZCJQuery.extend(!0,{},{audio:a,video:s},t),e){case r.AUDIO_ONLY:i.video=!1;break;case r.VIDEO_ONLY:i.audio=!1;break;case r.SCREEN:void 0!==t&&void 0!==t.audio||(i.audio=!1)}return i};return navigator.mediaDevices.enumerateDevices?(p(),{streamTypes:r,errors:{NotAllowedError:"NotAllowedError",NotFoundError:"NotFoundError",NotReadableError:"NotReadableError"},streamInstanceIds:{livefeed_video:"LIVEFEED_VIDEO",video_effects_preview:"VIDEO_EFFECTS_PREVIEW",settings_video_effects_preview:"SETTINGS_VIDEO_EFFECTS_PREVIEW"},isSupported:function(){return e},isScreenShareSupportedInNative:function(){return t&&!_isZCDesktopApp()},isSetSinkIdSupported:function(){return"undefined"!=typeof $ZCUtil&&!$ZCUtil.Browser.isFirefox()},isDisplayMediaSupported:function(){return t},isPermissionQuerySupported:function(){return i&&($ZCUtil.Browser.isChrome()||$ZCUtil.Browser.isOpera()||$ZCUtil.Browser.isEdge())},isMediaRecorderSupported:function(){return a},isSetBitRateSupported:function(){return void 0!==window.RTCRtpSender&&"function"==typeof window.RTCRtpSender.prototype.getParameters},isAudioStreamType:function(e){return this.streamTypes.AUDIO_ONLY===e},isVideoStreamType:function(e){return this.streamTypes.VIDEO_ONLY===e},isAudioVideoStreamType:function(e){return this.streamTypes.AUDIO_VIDEO===e},isScreenStreamType:function(e){return this.streamTypes.SCREEN===e},getStreamTypeInString:function(e){return function(e){return l[e]}(e)},getStreamTypesInInt:function(e){return function(e){return d[e]}(e)},getStream:function(e){return o[e]},getMediaDevices:function(e,t){p(e,t)},getAudioPermission:function(e,t){h(ZCMediaConstants.mediaDevices.MICROPHONE,e,t)},getVideoPermission:function(e,t){h(ZCMediaConstants.mediaDevices.CAMERA,e,t)},requestAudioStream:function(e,t,i){C(this.streamTypes.AUDIO_ONLY,e,t,i,!1,void 0,!1,void 0)},requestVideoStream:function(e,t,i,a){C(this.streamTypes.VIDEO_ONLY,e,t,i,!1,void 0,!1,void 0,a)},requestAudioVideoStream:function(e,t,i,a){C(this.streamTypes.AUDIO_VIDEO,e,t,i,!1,void 0,!1,void 0,a)},requestAudioVideoOrAudioStream:function(e,t,i){var a=function(a,n){a.name!==this.errors.NotAllowedError?C(this.streamTypes.AUDIO_ONLY,e,t,i,!1,void 0,!1,void 0):"function"==typeof t&&t(a,n)}.bind(this);C(this.streamTypes.AUDIO_VIDEO,e,a,i,!1,void 0,!1,void 0)},requestScreenStream:function(e,t,i,a,n,s){if($ZCUtil.Browser.isChrome()||$ZCUtil.Browser.isSafari()||$ZCUtil.Browser.isOpera())this.isScreenShareSupportedInNative()?C(this.streamTypes.SCREEN,e,t,ZCJQuery.extend(!0,{},a,{video:!0}),!0,i,n,s):ScreenShare.Extension.getSourceId(function(o){var r={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o}}};C(this.streamTypes.SCREEN,e,t,ZCJQuery.extend(!0,{},a,r),!1,i,n,s)}.bind(this));else{C(this.streamTypes.SCREEN,e,t,ZCJQuery.extend(!0,{},a,{audio:!1,video:{mediaSource:"screen"}}),!1,i,n,s)}},requestAndAddTrackInStream:function(e,t,i,a,n){var s=e._getType();if(!this.isScreenStreamType(s))if(this.isAudioStreamType(t)){var r=e._hasVideoTrack()?this.streamTypes.AUDIO_VIDEO:this.streamTypes.AUDIO_ONLY;if(!e._hasAudioTrack()&&null===o[r]){var l=null===o[this.streamTypes.AUDIO_ONLY],d=function(t){e._addPrimaryAudioTrack(t._getPrimaryAudioTrack(),r),o[r]=e,o[s]=null,l&&(o[this.streamTypes.AUDIO_ONLY]=null),"function"==typeof i&&i(e)}.bind(this);this.requestAudioStream(d,a)}}else if(this.isVideoStreamType(t)){r=e._hasAudioTrack()?this.streamTypes.AUDIO_VIDEO:this.streamTypes.VIDEO_ONLY;if(!e._hasVideoTrack()&&null===o[r]){l=null===o[this.streamTypes.VIDEO_ONLY],d=function(t){e._addPrimaryVideoTrack(t._getPrimaryVideoTrack(),r),t._hasBackgroundProcessor()&&(e._setBackgroundProcessor(t._backgroundProcessor),e._setSourceStream(t._sourceStream)),o[r]=e,o[s]=null,l&&(o[this.streamTypes.VIDEO_ONLY]=null),"function"==typeof i&&i(e)}.bind(this);this.requestVideoStream(d,a,void 0,n)}}},requestAndReplaceTracksInStream:function(e,t,i,a,n,s){if(this.isAudioVideoStreamType(t))e._hasAudioTrack()&&e._hasVideoTrack()&&(this.closeStream(e._getType(),!0),this.requestAudioVideoStream(i,a,n,s));else if(this.isAudioStreamType(t)){if(e._hasAudioTrack())if(e._hasVideoTrack()){var r=null===o[this.streamTypes.AUDIO_ONLY],l=function(t){e._replacePrimaryAudioTrack(t._getPrimaryAudioTrack()),r&&(o[this.streamTypes.AUDIO_ONLY]=null),"function"==typeof i&&i(e)}.bind(this);this.requestAudioStream(l,a,n)}else this.closeStream(e._getType(),!0),this.requestAudioStream(i,a,n)}else if(this.isVideoStreamType(t)&&e._hasVideoTrack())if(e._hasAudioTrack()){r=null===o[this.streamTypes.VIDEO_ONLY],l=function(t){e._replacePrimaryVideoTrack(t._getPrimaryVideoTrack()),r&&(o[this.streamTypes.VIDEO_ONLY]=null),"function"==typeof i&&i(e)}.bind(this);this.requestVideoStream(l,a,n,s)}else this.closeStream(e._getType(),!0),this.requestVideoStream(i,a,n,s)},removeTracksInStream:function(e,t,i,a){var n=e._getType();this.isAudioVideoStreamType(n)?(this.isAudioStreamType(t)?(e._removePrimaryAudioTrack(),e._setType(this.streamTypes.VIDEO_ONLY),o[this.streamTypes.VIDEO_ONLY]=e,o[n]=null):this.isVideoStreamType(t)&&(e._removePrimaryVideoTrack(),e._hasBackgroundProcessor()&&(e._stopBackgroundProcessor(),e._getSourceStream()._removePrimaryVideoTrack()),e._setType(this.streamTypes.AUDIO_ONLY),o[this.streamTypes.AUDIO_ONLY]=e,o[n]=null),"function"==typeof i&&i(e)):"function"==typeof a&&a()},splitTracksInStream:function(e,t){if(e){var i=e._getType(),a=void 0,n=void 0;return e._hasAudioTrack()&&((a=new MediaStream([e._getPrimaryAudioTrack()]))._setType(this.streamTypes.AUDIO_ONLY),o[this.streamTypes.AUDIO_ONLY]=a),e._hasVideoTrack()&&(n=new MediaStream([e._getPrimaryVideoTrack()]),e._hasBackgroundProcessor()&&(n._setBackgroundProcessor(e._backgroundProcessor),n._setSourceStream(e._sourceStream)),n._setType(this.streamTypes.VIDEO_ONLY),o[this.streamTypes.VIDEO_ONLY]=n),t&&(o[i]=null),{audioStream:a,videoStream:n}}},requestNewStreamInstance:function(e,t,i,a,n,s){C(t,i,a,n,!1,void 0,!0,e,s)},requestNewScreenStreamInstance:function(e,t,i,a,n){requestScreenStream(t,i,a,n,!0,e)},closeStreamInstance:function(e,t){!function(e,t){var i=c(e,t);i&&(i._close(),delete s[e][t])}(e,t)},closeStream:function(e){m(e)},closeAllStreams:function(){for(var e in o)m(e)}}):Promise.reject(new Error("enumerateDevices is not implemented in this browser"))}();var WebRTCPeerConnectionConstants={};WebRTCPeerConnectionConstants={iceConnectionStates:{CONNECTED:"connected",COMPLETED:"completed",DISCONNECTED:"disconnected",FAILED:"failed",CLOSED:"closed"},connectionTypes:{AUDIO_VIDEO:"audiovideo",AUDIO:"audio",VIDEO:"video",SCREEN:"screen",DATA_CHANNEL:"datachannel"},connectionModes:{UNIFIED:"unified",PLANB:"planB"},isUnifiedPlan:function(e){return this.connectionModes.UNIFIED===e},isPlanB:function(e){return this.connectionModes.PLANB===e},isAudioConnection:function(e){return this.connectionTypes.AUDIO===e},isVideoConnection:function(e){return this.connectionTypes.VIDEO===e},isScreenConnection:function(e){return this.connectionTypes.SCREEN===e},isDataChannelConnection:function(e){return this.connectionTypes.DATA_CHANNEL===e},isConnectionActive:function(e){if(void 0===e)return!1;var t=e.iceConnectionState;return t===this.iceConnectionStates.CONNECTED||t===this.iceConnectionStates.COMPLETED},isConnectionClosed:function(e){return void 0!==e&&e.iceConnectionState===this.iceConnectionStates.CLOSED},processTypes:{INIT:"init",REINIT:"reinit",RESTART:"restart",RENEGOTIATE:"renegotiate"},isInit:function(e){return this.processTypes.INIT===e},isRestart:function(e){return this.processTypes.RESTART===e},isReInit:function(e){return this.processTypes.REINIT===e},isRenegotiate:function(e){return this.processTypes.RENEGOTIATE===e}};var WebRTCPeerConnection=function(e,t,i,a,n,s,o,r,l,d,c,u){this._id=e,this._hostId=t,this._mediaStreamContainer=n,this._handler=a,this._turnServer=s,this._userName=o,this._credential=r,this._audioRtpSenders=[],this._videoRtpSenders=[],this._screenRtpSenders=[],this._remoteSDP=c,this._localSDP=void 0,this._localIceCandidates=[],this._iceCandidatesGatheringTimer=void 0,this._remoteIceCandidates=u||[],this._isUpStream=d,this._stream=void 0,this._streamType=l,this._connectionType=i,this._processType=WebRTCPeerConnectionConstants.processTypes.INIT,this._isReconnecting=!1,this._reconnectTimer=void 0,this._reconnectInterval=void 0,this._canUpdateLocalIceCandidates=!1,this._initialize(this._processType)};WebRTCPeerConnection.prototype={_addTracksInConnection:function(){void 0!==this._stream&&(WebRTCUserMedia.isScreenStreamType(this._streamType)?this._addScreenTracksInConnection():this._addAVTracksInConnection())},_addAVTracksInConnection:function(){this._addAudioTracksInConnection(),this._addVideoTracksInConnection()},_addAudioTracksInConnection:function(){this._stream.getTracks().forEach(function(e){"audio"===e.kind&&this._audioRtpSenders.push(this._connection.addTrack(e,this._stream))}.bind(this))},_addVideoTracksInConnection:function(){this._stream.getTracks().forEach(function(e){"video"===e.kind&&this._videoRtpSenders.push(this._connection.addTrack(e,this._stream))}.bind(this))},_addScreenTracksInConnection:function(){this._stream.getTracks().forEach(function(e){this._screenRtpSenders.push(this._connection.addTrack(e,this._stream))}.bind(this))},_removeAVTracksInConnection:function(){this._removeAudioTracksInConnection(),this._removeVideoTracksInConnection()},_removeAudioTracksInConnection:function(){this._audioRtpSenders.forEach(function(e){this._connection.removeTrack(e)}.bind(this)),this._audioRtpSenders=[]},_removeVideoTracksInConnection:function(){this._videoRtpSenders.forEach(function(e){this._connection.removeTrack(e)}.bind(this)),this._videoRtpSenders=[]},_initialize:function(e){this._processType=e,WebRTCPeerConnectionConstants.isReInit(e)&&(this._closeConnection(),clearInterval(this._reconnectInterval),this._reconnectInterval=void 0),this._connection||(this._connection=new RTCPeerConnection(this._getConfiguration())),this._bindEventHandlers(e),this._isUpStream?(!WebRTCPeerConnectionConstants.isReInit(e)&&this._stream||(this._stream=WebRTCUserMedia.getStream(this._streamType),this._addTracksInConnection()),this._createOffer(e)):this._createAnswer()},_bindEventHandlers:function(e){var t=!1,i=this._connection,a=function(i){var a=i.candidate;if(a)if(t){if(this._localIceCandidates.push(a.candidate),!this._canUpdateLocalIceCandidates)return;if(!this._iceCandidatesGatheringTimer){var n=function(){this._handler.updateIceCandidates(this._id,this._connectionType,this._hostId,this._localIceCandidates,e),this._localIceCandidates=[],this._iceCandidatesGatheringTimer=void 0}.bind(this);this._iceCandidatesGatheringTimer=setTimeout(n,1e3)}}else this._isUpStream?WebRTCPeerConnectionConstants.isRenegotiate(e)||this._handler.sendOffer(this._id,this._connectionType,this._localSDP.sdp,a.candidate,e,this._streamType):this._handler.sendAnswer(this._id,this._connectionType,this._localSDP.sdp,a.candidate,e,this._hostId),t=!0}.bind(this),n=function(t){var a=i.iceConnectionState;if(WebRTCPeerConnectionConstants.iceConnectionStates.CONNECTED===a||WebRTCPeerConnectionConstants.iceConnectionStates.COMPLETED===a)this._processType=WebRTCPeerConnectionConstants.processTypes.INIT,this._isReconnecting=!1,clearInterval(this._reconnectInterval),this._reconnectInterval=void 0,clearTimeout(this._reconnectTimer),this._reconnectTimer=void 0,this._handler.handleConnected(this._id,this._connectionType,this._connection,this._hostId,this._streamType,this._isUpStream,e);else if(WebRTCPeerConnectionConstants.iceConnectionStates.FAILED===a){this._reconnect();var n=this;clearInterval(this._reconnectInterval),this._reconnectInterval=setInterval((function(){n._reconnect()}),15e3)}}.bind(this),s=function(e){void 0===this._stream&&(this._stream=e.streams[0],this._stream._setType(this._streamType),this._mediaStreamContainer&&(this._mediaStreamContainer.setStream(this._stream),this._mediaStreamContainer.playStream(function(){this._handler.handlePlay(this._connectionType,this._hostId,this._stream,this._streamType,this._mediaStreamContainer)}.bind(this),function(e){"function"==typeof this._handler.handlePlayError&&this._handler.handlePlayError(e)}.bind(this))),"function"==typeof this._handler.handleTrack&&this._handler.handleTrack(this._id,e.track,e.transceiver,e.streams[0],this._hostId))}.bind(this);i.onicecandidate=a,i.oniceconnectionstatechange=n,i.ontrack=s;var o=function(t){var a=i.connectionState;WebRTCPeerConnectionConstants.iceConnectionStates.CONNECTED===a?(this._processType=WebRTCPeerConnectionConstants.processTypes.INIT,this._isReconnecting=!1,clearInterval(this._reconnectInterval),this._reconnectInterval=void 0,clearTimeout(this._reconnectTimer),this._reconnectTimer=void 0,this._handler.handleConnected(this._id,this._connectionType,this._connection,this._hostId,this._streamType,this._isUpStream,e)):WebRTCPeerConnectionConstants.iceConnectionStates.FAILED===a&&(this._reconnect(),clearInterval(this._reconnectInterval),this._reconnectInterval=setInterval(function(){this._reconnect()}.bind(this),15e3))}.bind(this);i.onconnectionstatechange=o},addTrack:function(e,t){this._isUpStream&&(this._stream=e,this._streamType=e._getType(),WebRTCUserMedia.isAudioStreamType(t)?0===this._audioRtpSenders.length&&this._addAudioTracksInConnection():WebRTCUserMedia.isVideoStreamType(t)?0===this._videoRtpSenders.length&&this._addVideoTracksInConnection():WebRTCUserMedia.isScreenStreamType(t)&&0===this._screenRtpSenders.length&&this._addScreenTracksInConnection(),this._renegotiate())},_renegotiate:function(){this._isUpStream&&(this._isReconnecting=!1,clearInterval(this._reconnectInterval),clearTimeout(this._reconnectTimer),this._initialize(WebRTCPeerConnectionConstants.processTypes.RENEGOTIATE))},_reconnect:function(){if(!this._isReconnecting){this._isReconnecting=!0;var e=WebRTCPeerConnectionConstants.processTypes.RESTART;"function"==typeof this._handler.getUpStreamReconnectProcessType&&(e=this._handler.getUpStreamReconnectProcessType()),this._processType=e,clearTimeout(this._reconnectTimer);var t=this;this._reconnectTimer=setTimeout((function(){t._isReconnecting=!1}),1e4),this._isUpStream&&this._initialize(e),this._handler.reconnectStream(this._id,this._connectionType,this._hostId,this._streamType,this._isUpStream)}},reinit:function(){this._initialize(WebRTCPeerConnectionConstants.processTypes.REINIT)},replaceTracks:function(e,t){this._isUpStream&&(this._stream=e,this._streamType=e._getType(),WebRTCUserMedia.isAudioVideoStreamType(t)?this._removeAVTracksInConnection():WebRTCUserMedia.isAudioStreamType(t)?(this._removeAudioTracksInConnection(),this._addAudioTracksInConnection()):(this._removeVideoTracksInConnection(),this._addVideoTracksInConnection()),this.reinit())},_createOffer:function(e){var t={};WebRTCPeerConnectionConstants.isRestart(e)&&(t.iceRestart=!0,this._localIceCandidates=[]);var i=this._connection,a=this;i.createOffer(t).then((function(t){a._localSDP=t,i.setLocalDescription(t),WebRTCPeerConnectionConstants.isRenegotiate(e)&&a._handler.handleRenegotiate(a._id,a._connectionType,t.sdp,a._streamType)}))},_createAnswer:function(){var e={},t=this._connection,i=this;t.setRemoteDescription(this._getRTCSessionDescriptionObj("offer",this._remoteSDP)).then((function(){t.createAnswer(e).then((function(e){i._localSDP=e,t.setLocalDescription(e)}))}))},setRemoteDescription:function(e,t,i){i&&i.length&&(this._remoteIceCandidates=i);var a=this;this._connection.setRemoteDescription(this._getRTCSessionDescriptionObj(e,t)).then((function(){a.addRemoteIceCandidates()}))},addRemoteIceCandidates:function(){var e=this._connection;this._remoteIceCandidates.forEach((function(t){e.addIceCandidate(new RTCIceCandidate(t))})),this._remoteIceCandidates=[]},updateLocalIceCandidates:function(){this._canUpdateLocalIceCandidates=!0,this._handler.updateIceCandidates(this._id,this._connectionType,this._hostId,this._localIceCandidates,this._processType),this._localIceCandidates=[]},_getRTCSessionDescriptionObj:function(e,t){return new RTCSessionDescription({type:e,sdp:t})},_closeConnection:function(){clearTimeout(this._reconnectTimer),this._reconnectTimer=void 0,clearTimeout(this._iceCandidatesGatheringTimer),this._iceCandidatesGatheringTimer=void 0,this._connection&&(this._connection.close(),this._connection=void 0),this._isReconnecting=!1,this._canUpdateLocalIceCandidates=!1,this._audioRtpSenders=[],this._videoRtpSenders=[],this._screenRtpSenders=[],this._remoteSDP=void 0,this._localSDP=void 0,this._localIceCandidates=[],this._remoteIceCandidates=[]},close:function(e){clearInterval(this._reconnectInterval),this._reconnectInterval=void 0,this._closeConnection(),!e&&this._stream&&this._isUpStream&&WebRTCUserMedia.closeStream(this._stream._getType())},_getConfiguration:function(){var e=this._turnServer,t=this._userName,i=this._credential,a=[];return e.forEach((function(e){a.push({urls:e,username:t,credential:i})})),{iceServers:a}},setBitRate:function(e){this._videoRtpSenders.forEach((function(t){var i=t.getParameters();i.encodings||(i.encodings=[{}]),i.encodings[0].maxBitrate=1e3*e,t.setParameters(i)}))}};var WebRTCPeerConnectionStats={},CallStrengthAnalyser={},CallStrengthStatsConstants={},GroupCallStrengthAnalyser={};WebRTCPeerConnectionStats=function(){var e={},t=void 0,i=1e3,a="standard",n={connectedTransportKeyIncludes:"RTCTransport_",candidateKeyIncludes:"RTCIceCandidate",hostCandidateTypeValue:"host",candidatePairType:"candidate-pair",candidatePairSelectedState:"succeeded",localCandidateType:"local-candidate",remoteCandidateType:"remote-candidate",transportStatType:"transport",ssrcKeyName:"ssrc",ssrcListKeyName:"ssrclist",subTypeKeyName:"subTypeKey"},s={"outbound-rtp":{subTypeKey:"kind",kind:{audio:"RTCOutboundRTPAudioStream_",video:"RTCOutboundRTPVideoStream_"}},"inbound-rtp":{subTypeKey:"kind",kind:{audio:"RTCInboundRTPAudioStream_",video:"RTCInboundRTPVideoStream_"}},"remote-inbound-rtp":{subTypeKey:"kind",kind:{audio:"RTCRemoteInboundRtpAudioStream_",video:"RTCRemoteInboundRtpVideoStream_"}}},o={RTCLiveIceCandidatePair:{bytesSent:"bytessent",bytesReceived:"bytesreceived",availableOutgoingBitrate:"availablebitrate",availableIncomingBitrate:"recvbitrate",totalRoundTripTime:"totalrtt",currentRoundTripTime:"rtt"},RTCOutboundRTPVideoStream_:{pliCount:"videoplisrecv",nackCount:"videonacksrecv",bytesSent:"videobytessent",framesEncoded:"framesencoded",packetsSent:"videopacketssent",framesSent:"videoframessent",totalEncodeTime:"totalencodetime",totalPacketSendDelay:"totalpacketsenddelay"},RTCRemoteInboundRtpVideoStream_:{jitter:"sendvideojitter",packetsLost:"sendvideopacketlost"},RTCInboundRTPAudioStream_:{jitter:"recvaudiojitter",packetsLost:"recvaudiopacketlost",packetsReceived:"audiopacketsreceived"},RTCInboundRTPVideoStream_:{pliCount:"videoplissent",nackCount:"videonackssent",packetsLost:"recvvideopacketlost",bytesReceived:"bytesreceived",packetsReceived:"packetsreceived",framesDecoded:"framesdecoded",totalDecodeTime:"totaldecodetime",totalInterFrameDelay:"totalinterframedelay",framesReceived:"framesreceived",framesDropped:"framesdropped"},RTCOutboundRTPAudioStream_:{packetsSent:"audiopacketssent",bytesSent:"audiobytessent"},RTCRemoteInboundRtpAudioStream_:{jitter:"sendaudiojitter",packetsLost:"sendaudiopacketlost"}},r=["RTCOutboundRTPVideoStream_","RTCRemoteInboundRtpAudioStream_","RTCRemoteInboundRtpVideoStream_","RTCInboundRTPAudioStream_","RTCInboundRTPVideoStream_","RTCOutboundRTPAudioStream_"],l=function(e,t,i,a,n){this._moduleId=t,this._id=e,this._connection=i,this._connectionMetaData=a,this._timeVsStats={},this._networkInfo={},this._candidatePairInfo={},this._networkInfoCallBack=n.networkInfoCallBack,this._updateStatsCallBack=n.updateStatsCallBack,this._statsCallBack=n.statsCallBack,this._candidatePairInfoCallBack=n.candidatePairInfoCallBack,this._hasSentNetworkInfo=!1,this._hasSentCandidatePairInfo=!1,this._statsObjectMaxSize=30,void 0!==a&&void 0!==a.statsObjectMaxSize&&(this._statsObjectMaxSize=a.statsObjectMaxSize)};function d(){return"undefined"!=typeof $ZCUtil&&"undefined"!=typeof RTCStatsReport}function c(e){return(function(e){return void 0!==e&&e.type===n.localCandidateType}(e)||function(e){return void 0!==e&&e.type===n.remoteCandidateType}(e))&&e.candidateType===n.hostCandidateTypeValue}function u(e){return function(e){return void 0!==e&&e.type===n.candidatePairType&&(void 0===e.nominated||e.nominated)}(e)&&e.state===n.candidatePairSelectedState}function C(e){return void 0!==e&&e.type===n.transportStatType}function p(e){var t=void 0,i=e.values(),a=void 0;do{var n=(a=i.next()).value;if(u(n)){t=n.id;break}if(C(n)){t=n.selectedCandidatePairId;break}}while(!a.done);return t}function h(e,t,i){var a={},l=function(e,t){for(var i in o)if(-1!==e.indexOf(i)||e.toUpperCase()===i.toUpperCase())return i;for(var a in s)if(t.type===a){var r=s[a],l=r[n.subTypeKeyName];return void 0!==l?r[l][t[l]]:r}}(e,t);if(l){var d=i&&function(e){return-1!==r.indexOf(e)}(l),c=o[l];for(var u in c)if(d){var C=t[n.ssrcKeyName];void 0===a[C]&&(a[n.ssrcKeyName]=C,a[C]={}),a[C][c[u]]=t[u]}else a[c[u]]=t[u]}return a}function m(e,t,i){var a=t.get(i.localCandidateId),n=t.get(i.remoteCandidateId),s=a.networkType,o=a.ip||a.address,r=void 0,l=(n.ip||n.address,void 0);void 0!==(l=c(a)?a:function(e,t){var i;return e.forEach((function(e,a){c(e)&&e.networkType===t&&(i=e)})),i}(t,s))&&(r=l.ip||l.address),e.setNetworkInfo(s,r,o,a,n),e.sendNetworkInfo()}function f(e,t,i){var a=t.get(i.localCandidateId),n=t.get(i.remoteCandidateId);e.setCandidatePairInfo(a,n),e.sendCandidatePairInfo()}function g(e){var t=e.getConnection();WebRTCPeerConnectionConstants.isConnectionClosed(t)?v(e.getId(),e.getModuleId()):WebRTCPeerConnectionConstants.isConnectionActive(t)&&t.getStats().then((function(t){var i=p(t);if(void 0!==i){var a=t.get(i);e.hasSentNetworkInfo()||m(e,t,a),e.hasSentCandidatePairInfo()||f(e,t,a);var s=e.isSSRCBased(),o=new Set,r=h("RTCLiveIceCandidatePair",a,s);t.forEach((function(e,t){var i=h(t,e,s);s&&i[n.ssrcKeyName]&&(o.add(i[n.ssrcKeyName]),delete i[n.ssrcKeyName]),ZCJQuery.extend(!0,r,i)})),s&&(r[n.ssrcListKeyName]=[...o]);var l="undefined"!=typeof $ZCUtil?$ZCUtil.getSyncedCurrentTime():Date.now();e.updateAndSendStats(l,r,t)}}))}function v(i,a){var n=e[a];if(void 0!==n){var s=n[i];s&&s._sendStats(),delete n[i],0===Object.keys(n).length&&delete e[a]}0===Object.keys(e).length&&(clearInterval(t),t=void 0)}return l.prototype={setNetworkInfo:function(e,t,i,a,n){var s=a.ip||a.address;void 0!==a.port&&(s=s+":"+a.port);var o=n.ip||n.address;void 0!==n.port&&(o=o+":"+n.port),this._networkInfo={network_type:e,private_ip:t,public_ip:i,local_ip:s,remote_ip:o,local_candidate_type:a.candidateType}},setCandidatePairInfo:function(e,t){this._candidatePairInfo={remote_ip:t.ip||t.address,local_ip:e.ip||e.address,remote_candidate_type:t.candidateType,local_candidate_type:e.candidateType,remote_candidate_port:t.port,local_candidate_port:e.port}},getId:function(){return this._id},getModuleId:function(){return this._moduleId},getConnection:function(){return this._connection},isSSRCBased:function(){return void 0!==this._connectionMetaData&&this._connectionMetaData.isSSRCBased},hasSentNetworkInfo:function(){return this._hasSentNetworkInfo},sendNetworkInfo:function(){"function"==typeof this._networkInfoCallBack&&this._networkInfoCallBack(this._id,this._moduleId,this._networkInfo,a,this._connectionMetaData),this._hasSentNetworkInfo=!0},hasSentCandidatePairInfo:function(){return this._hasSentCandidatePairInfo},sendCandidatePairInfo:function(){"function"==typeof this._candidatePairInfoCallBack&&this._candidatePairInfoCallBack(this._id,this._moduleId,this._candidatePairInfo),this._hasSentCandidatePairInfo=!0},updateAndSendStats:function(e,t,i){this._timeVsStats[e]=t,"function"==typeof this._statsCallBack&&this._statsCallBack(e,t,i,this._connectionMetaData),Object.keys(this._timeVsStats).length===this._statsObjectMaxSize&&this._sendStats()},_sendStats:function(){"function"==typeof this._updateStatsCallBack&&this._updateStatsCallBack(this._id,this._moduleId,this._timeVsStats,a,this._connectionMetaData),this._timeVsStats={}}},{isStatsSupported:d,initiateGathering:function(a,n,s,o,r){if(void 0!==a&&void 0!==n&&void 0!==s&&(void 0!==r.statsCallBack||void 0!==r.networkInfoCallBack&&void 0!==r.updateStatsCallBack)){if(!d())return s.getStats().then(function(e){var t=p(e);f(new l(a,n,s,o,r),e,e.get(t))}.bind(this)),void function(e,t,i){"function"==typeof i.errorCallback&&i.errorCallback(e,t)}(a,n,r);var c=e[n]||{};c[a]=new l(a,n,s,o,r),e[n]=c,void 0===t&&(t=setInterval((function(){!function(){for(var t in e){var i=e[t];for(var a in i){var n=i[a];try{g(n)}catch(e){}}}}()}),i))}},stopGathering:v}}(),CallStrengthStatsConstants={maxThresholdScore:10,callStrengthCalcInterval:1e4,statsGatheringInterval:1e3,audioDownStreamScore:{paramsCount:2,lostParamsCount:1},audioUpStreamScore:{paramsCount:2,lostParamsCount:0},videoDownStreamScore:{paramsCount:3,lostParamsCount:1},videoUpStreamScore:{paramsCount:3,lostParamsCount:0},rtt:{maxThreshold:.8,minThreshold:.3},jitter:{audioMinThreshold:.03,videoMinThreshold:.2},packetSent:{maxThreshold:40,minThreshold:30},bytesSent:{maxThreshold:2500,minThreshold:1500},frames:{maxDecodeValue:7,delayThreshold:.15},video:{maxEncodingDelay:.15,maxPacketSentDelay:.05},iceCandidatePair:"RTCIceCandidatePair",mediaTrackReceiver:"RTCMediaStreamTrack_receiver",mediaTrackSender:"sender",rtpType:{outBound:"outbound-rtp",inBound:"inbound-rtp"},statType:{audio:"audio",video:"video"}},(CallStrengthAnalyser=function(e,t,i){this._id=e,this._peerConnection=t,this._statType=void 0,this._statsGatheringTimer=void 0,this._updateScoreTimer=void 0,this._callBacks=i,this._prevAudioBytesSent=0,this._prevAudioPacketsSent=0,this._prevAudioPacketsReceived=0,this._prevAudioPacketsLost=0,this._currentAudioPacketsReceived=0,this._currentAudioPacketsLost=0,this._prevVideoFramesDecoded=0,this._prevVideoInterFrameDelay=0,this._prevVideoPacketSendDelay=0,this._prevVideoDecodeTime=0,this._prevVideoEncodeTime=0,this._prevVideoPacketsSent=0,this._prevVideoPacketsLost=0,this._prevVideoPacketsReceived=0,this._prevVideoFramesSent=0,this._prevVideoFramesLost=0,this._prevVideoFramesReceived=0,this._prevVideoFramesEncoded=0,this._prevVideoJitterBufferDelay=0,this._prevVideoJitterBufferEmittedCount=0,this._currentVideoPacketsLost=0,this._currentVideoPacketsReceived=0,this._currentVideoFramesLost=0,this._currentVideoFramesReceived=0,this._lastAudioPacketReceivedTimestamp=0,this._lastVideoPacketReceivedTimestamp=0,this._rttArray=[],this._audioJitterBufferArray=[],this._audioPacketsSentArray=[],this._audioBytesSentArray=[],this._framesDecodedArray=[],this._videoJitterBufferArray=[],this._interFrameDelayArray=[],this._decodeTimeArray=[],this._framesSentArray=[],this._videoFramesEncodingTimeArray=[],this._videoPacketSendDelayTimeArray=[],this._callStrengthScore=void 0,this._startTime=(new Date).getTime(),this._initiate()}).prototype={getId:function(){return this._id},getConnection:function(){return this._peerConnection},_setStatType:function(e){this._statType=e},_getCurrentStatType:function(){return this._statType},_hasVideoStat:function(){return this._getCurrentStatType()===CallStrengthStatsConstants.statType.video},_setScore:function(e){this._callStrengthScore=e},getScore:function(){return this._callStrengthScore},_initiate:function(){if(void 0!==this._id&&void 0!==this._peerConnection&&void 0!==this._callBacks&&void 0!==this._callBacks.updateCallQuality)return"undefined"==typeof $ZCUtil||!$ZCUtil.Browser.isChrome()&&!$ZCUtil.Browser.isOpera()?"function"==typeof this._callBacks.handleFallback?this._callBacks.handleFallback():void 0:void this._startAnalysis()},_startAnalysis:function(){clearInterval(this._statsGatheringTimer),this._statsGatheringTimer=setInterval(this._initiateStatsGathering.bind(this),CallStrengthStatsConstants.statsGatheringInterval),this._updateScoreTimer=setInterval(this._updateScore.bind(this),CallStrengthStatsConstants.callStrengthCalcInterval)},stopAnalysis:function(){clearInterval(this._statsGatheringTimer),clearInterval(this._updateScoreTimer)},_initiateStatsGathering:function(){this._peerConnection.getStats().then(function(e){this._gatherStats(e)}.bind(this))},_gatherStats:function(e){e.forEach(function(e){e.id.includes(CallStrengthStatsConstants.iceCandidatePair)&&e.nominated&&this._rttArray.push(e.currentRoundTripTime),e.kind===CallStrengthStatsConstants.statType.audio?this._gatherAudioStat(e):e.kind===CallStrengthStatsConstants.statType.video&&this._gatherVideoStat(e),void 0!==e.kind&&this._setStatType(e.kind)}.bind(this))},_gatherAudioStat:function(e){e.type===CallStrengthStatsConstants.rtpType.outBound&&void 0!==e.mediaSourceId&&(this._audioPacketsSentArray.push(e.packetsSent-this._prevAudioPacketsSent),this._audioBytesSentArray.push(e.bytesSent-this._prevAudioBytesSent),this._prevAudioPacketsSent=e.packetsSent,this._prevAudioBytesSent=e.bytesSent),e.type===CallStrengthStatsConstants.rtpType.inBound&&e.lastPacketReceivedTimestamp-this._lastAudioPacketReceivedTimestamp>0&&(this._audioJitterBufferArray.push(e.jitter),this._currentAudioPacketsLost=e.packetsLost,this._currentAudioPacketsReceived=e.packetsReceived,this._lastAudioPacketReceivedTimestamp=e.lastPacketReceivedTimestamp)},_gatherVideoStat:function(e){if(e.id.includes(CallStrengthStatsConstants.mediaTrackSender)&&(this._framesSentArray.push(e.framesSent-this._prevVideoFramesSent),this._prevVideoFramesSent=e.framesSent),e.id.includes(CallStrengthStatsConstants.mediaTrackReceiver)){this._currentVideoFramesReceived=e.framesReceived,this._currentVideoFramesLost=e.framesDropped;var t=e.jitterBufferDelay,i=e.jitterBufferEmittedCount;0!=this._prevVideoJitterBufferEmittedCount&&(t-=this._prevVideoJitterBufferDelay,i-=this._prevVideoJitterBufferEmittedCount),this._videoJitterBufferArray.push(t/i),this._prevVideoJitterBufferDelay=e.jitterBufferDelay,this._prevVideoJitterBufferEmittedCount=e.jitterBufferEmittedCount}if(e.type===CallStrengthStatsConstants.rtpType.outBound&&void 0!==e.mediaSourceId&&(this._videoFramesEncodingTimeArray.push((e.totalEncodeTime-this._prevVideoEncodeTime)/(e.framesEncoded-this._prevVideoFramesEncoded)),this._videoPacketSendDelayTimeArray.push((e.totalPacketSendDelay-this._prevVideoPacketSendDelay)/(e.packetsSent-this._prevVideoPacketsSent)),this._prevVideoFramesEncoded=e.framesEncoded,this._prevVideoEncodeTime=e.totalEncodeTime,this._prevVideoPacketSendDelay=e.totalPacketSendDelay,this._prevVideoPacketsSent=e.packetsSent),e.type===CallStrengthStatsConstants.rtpType.inBound&&e.lastPacketReceivedTimestamp-this._lastVideoPacketReceivedTimestamp>0){this._currentVideoPacketsLost=e.packetsLost,this._currentVideoPacketsReceived=e.packetsReceived;var a=e.framesDecoded-this._prevVideoFramesDecoded;this._framesDecodedArray.push(a),this._interFrameDelayArray.push((e.totalInterFrameDelay-this._prevVideoInterFrameDelay)/a),this._decodeTimeArray.push((e.totalDecodeTime-this._prevVideoDecodeTime)/a),this._prevVideoFramesDecoded=e.framesDecoded,this._prevVideoDecodeTime=e.totalDecodeTime,this._prevVideoInterFrameDelay=e.totalInterFrameDelay,this._lastVideoPacketReceivedTimestamp=e.lastPacketReceivedTimestamp}},_resetStats:function(){this._rttArray=[],this._audioJitterBufferArray=[],this._audioPacketsSentArray=[],this._audioBytesSentArray=[],this._framesDecodedArray=[],this._videoJitterBufferArray=[],this._interFrameDelayArray=[],this._decodeTimeArray=[],this._framesSentArray=[],this._videoFramesEncodingTimeArray=[],this._videoPacketSendDelayTimeArray=[]},_updateScore:function(){var e=this._analyseDownStreamConnectionStrength(),t=this._analyseUpStreamConnectionStrength(),i=CallStrengthStatsConstants.maxThresholdScore,a=i/2,n=i*CallStrengthStatsConstants.audioDownStreamScore.paramsCount+a*CallStrengthStatsConstants.audioDownStreamScore.lostParamsCount,s=i*CallStrengthStatsConstants.audioUpStreamScore.paramsCount+a*CallStrengthStatsConstants.audioUpStreamScore.lostParamsCount,o=Math.round((n-e.audioJitterScore-e.rttScore-e.audioPacketsLostPercentage)/(n/5)),r=Math.round((s-t.audioPacketsSentScore-t.audioBytesSentScore)/(s/5));(e.audioJitterScore>=.6*i||e.rttScore>=.6*i||e.audioPacketsLostPercentage>=.4*a)&&o>3&&(o=3);var l={upStreamScore:{audioUpStreamPerformanceScore:r},performanceScore:{audioPerformanceScore:o}};if(this._hasVideoStat()){var d=i*CallStrengthStatsConstants.videoDownStreamScore.paramsCount+a*CallStrengthStatsConstants.videoDownStreamScore.lostParamsCount,c=i*CallStrengthStatsConstants.videoUpStreamScore.paramsCount+a*CallStrengthStatsConstants.videoUpStreamScore.lostParamsCount,u=Math.round((d-e.videoJitterScore-e.frameScore-e.interFrameDelayScore-e.videoFramesLostPercentage)/(d/5)),C=Math.round((c-t.frameSentScore-t.videoEncodingScore-t.videoPacketSendDelayScore)/(c/5));(e.videoJitterScore>=.6*i||e.frameScore>=.6*i||e.interFrameDelayScore>=.6*i||e.videoFramesLostPercentage>=.4*a)&&u>3&&(u=3),l.upStreamScore.videoUpStreamPerformanceScore=C,l.performanceScore.videoPerformanceScore=u}var p={downstreamStrength:e,upstreamStrength:t};this._setScore(l),this._callBacks.updateCallQuality(this.getId(),l,p),this._resetStats()},_analyseDownStreamConnectionStrength:function(){var e=this._currentAudioPacketsReceived-this._prevAudioPacketsReceived,t=this._currentAudioPacketsLost-this._prevAudioPacketsLost,i={audioPacketsLostPercentage:this._calculateLossPercentage(e,t),audioJitterScore:this._calculateJitterScore(this._audioJitterBufferArray,CallStrengthStatsConstants.jitter.audioMinThreshold),rttScore:this._calculateRTTScore()};if(this._prevAudioPacketsReceived=this._currentAudioPacketsReceived,this._prevAudioPacketsLost=this._currentAudioPacketsLost,this._hasVideoStat()){var a=this._currentVideoPacketsReceived-this._prevVideoPacketsReceived,n=this._currentVideoPacketsLost-this._prevVideoPacketsLost,s=this._currentVideoFramesReceived-this._prevVideoFramesReceived,o=this._currentVideoFramesLost-this._prevVideoFramesLost;i.videoPacketsLostPercentage=this._calculateLossPercentage(a,n),i.videoFramesLostPercentage=this._calculateLossPercentage(s,o),i.videoJitterScore=this._calculateJitterScore(this._videoJitterBufferArray,CallStrengthStatsConstants.jitter.videoMinThreshold),i.frameScore=this._calculateFrameScore(this._framesDecodedArray),i.interFrameDelayScore=this._calculateFrameDelayScore(),this._prevVideoPacketsReceived=this._currentVideoPacketsReceived,this._prevVideoPacketsLost=this._currentVideoPacketsLost,this._prevVideoFramesReceived=this._currentVideoFramesReceived,this._prevVideoFramesLost=this._currentVideoFramesLost}return i},_analyseUpStreamConnectionStrength:function(){var e={audioPacketsSentScore:this._calculateAudioUpStreamScore(this._audioPacketsSentArray,CallStrengthStatsConstants.packetSent.minThreshold,CallStrengthStatsConstants.packetSent.maxThreshold),audioBytesSentScore:this._calculateAudioUpStreamScore(this._audioBytesSentArray,CallStrengthStatsConstants.bytesSent.minThreshold,CallStrengthStatsConstants.bytesSent.maxThreshold)};if(this._hasVideoStat()){var t=this._calculateFrameScore(this._framesSentArray);e.videoEncodingScore=this._calculateVideoUpStreamDelayScore(this._videoFramesEncodingTimeArray,CallStrengthStatsConstants.video.maxEncodingDelay),e.videoPacketSendDelayScore=this._calculateVideoUpStreamDelayScore(this._videoPacketSendDelayTimeArray,CallStrengthStatsConstants.video.maxPacketSentDelay),e.frameSentScore=t>CallStrengthStatsConstants.maxThresholdScore?CallStrengthStatsConstants.maxThresholdScore:t}return e},_calculateRTTScore:function(){var e=0,t=this._rttArray.length;for(var i of(t<CallStrengthStatsConstants.maxThresholdScore&&(e=CallStrengthStatsConstants.maxThresholdScore-t),this._rttArray))null==i||i>CallStrengthStatsConstants.rtt.maxThreshold?e+=2:i>CallStrengthStatsConstants.rtt.minThreshold&&e++;return e>CallStrengthStatsConstants.maxThresholdScore?CallStrengthStatsConstants.maxThresholdScore:e},_calculateJitterScore:function(e,t){var i=0,a=e.length;for(var n of(a<CallStrengthStatsConstants.maxThresholdScore&&(i=CallStrengthStatsConstants.maxThresholdScore-a),e))(null==n||isNaN(n)||n>t)&&i++;return i},_calculateFrameScore:function(e){var t=0,i=e.length;for(var a of(i<CallStrengthStatsConstants.maxThresholdScore&&(t=CallStrengthStatsConstants.maxThresholdScore-i),e))(null==a||a<CallStrengthStatsConstants.frames.maxDecodeValue)&&t++;return t},_calculateFrameDelayScore:function(){var e=0,t=this._interFrameDelayArray.length;for(var i of(t<CallStrengthStatsConstants.maxThresholdScore&&(e=CallStrengthStatsConstants.maxThresholdScore-t),this._interFrameDelayArray))(null==i||isNaN(i)||i>CallStrengthStatsConstants.frames.delayThreshold)&&e++;return e},_calculateLossPercentage:function(e,t){var i=CallStrengthStatsConstants.maxThresholdScore/2;return null==t||null==e||0==e||isNaN(t)||isNaN(e)||(i=Math.round(t/e*CallStrengthStatsConstants.maxThresholdScore/2))>CallStrengthStatsConstants.maxThresholdScore/2&&(i=CallStrengthStatsConstants.maxThresholdScore/2),i},_calculateAudioUpStreamScore:function(e,t,i){var a=0,n=e.length;for(var s of(n<CallStrengthStatsConstants.maxThresholdScore&&(a=CallStrengthStatsConstants.maxThresholdScore-n),e))null==s||s<t?a+=2:s<i&&a++;return a>CallStrengthStatsConstants.maxThresholdScore?CallStrengthStatsConstants.maxThresholdScore:a},_calculateVideoUpStreamDelayScore:function(e,t){var i=0,a=e.length;for(var n of(a<CallStrengthStatsConstants.maxThresholdScore&&(i=CallStrengthStatsConstants.maxThresholdScore-a),e))(null==n||n>t||isNaN(n))&&i++;return i>CallStrengthStatsConstants.maxThresholdScore?CallStrengthStatsConstants.maxThresholdScore:i}},(GroupCallStrengthAnalyser=function(e,t,i,a){this._id=e,this._stageIncreaseCallBack=t,this._stageReduceCallBack=i,this._networkStrengthCallBack=a,this._prevAudioUpStreamSSRCMap={},this._audioUpStreamSSRCMap={},this._audioUpStreamConnectionCrttArray=[],this._audioUpStreamPeformanceMap={},this._prevAudioDownStreamSSRCMap={},this._audioDownStreamSSRCMap={},this._audioDownStreamConnectionCrttArray=[],this._audioDownStreamPeformanceMap={},this._prevVideoFramesEncoded=0,this._prevVideoEncodeTime=0,this._prevVideoPacketSendDelay=0,this._prevVideoPacketsSent=0,this._prevVideoFramesSent=0,this._videoFramesSentArray=[],this._videoFramesEncodingTimeArray=[],this._videoPacketSendDelayTimeArray=[],this._videoDownStreamSSRCMap={},this._audioUpStreamConnectionScore=0,this._audioDownStreamConnectionScore=0,this._videoUpStreamConnectionScore=0,this._videoDownStreamConnectionScore=0,this._isAudioUpStreamAnalysed=!1,this._isAudioDownStreamAnalysed=!1,this._isVideoUpStreamAnalysed=!1,this._isVideoDownStreamAnalysed=!1,this._audioUpStreamConnectionStatsData=void 0,this._audioDownStreamConnectionStatsData=void 0,this._videoUpStreamConnectionStatsData=void 0,this._videoDownStreamConnectionStatsData=void 0,this._audioUpStreamConnectionFilteredStatsData=void 0,this._audioDownStreamConnectionFilteredStatsData=void 0,this._videoUpStreamConnectionFilteredStatsData=void 0,this._videoDownStreamConnectionFilteredStatsData=void 0,this._stageCalcInterval=void 0,this._scoreUpdateInterval=void 0,this.initiate()}).prototype={initiate:function(){clearInterval(this._scoreUpdateInterval),this._scoreUpdateInterval=setInterval(function(){this._calculateAudioUpStreamConnectionScore(),this._calculateAudioDownStreamConnectionScore(),this._calculateVideoUpStreamConnectionScore()}.bind(this),9e3),clearInterval(this._stageCalcInterval),this._stageCalcInterval=setInterval(function(){var e=!1,t=!1,i=0,a=0,n=void 0,s=void 0;this._isAudioDownStreamAnalysed&&(n=this._audioDownStreamConnectionScore,i+=this._audioDownStreamConnectionScore,a++,this._audioDownStreamConnectionScore<=2?e=!0:this._audioDownStreamConnectionScore>=4&&(t=!0),this._isAudioDownStreamAnalysed=!1),this._isAudioUpStreamAnalysed&&(s=this._audioUpStreamConnectionScore,i+=this._audioUpStreamConnectionScore,a++,this._audioUpStreamConnectionScore<=2?(e=!0,t=!1):this._audioUpStreamConnectionScore>=4&&!e&&(t=!0),this._isAudioUpStreamAnalysed=!1),a>0&&(i=Math.round(i/a),this._networkStrengthCallBack(i)),t?this._stageIncreaseCallBack(s,n):e&&this._stageReduceCallBack(s,n)}.bind(this),1e3)},destroy:function(){clearInterval(this._scoreUpdateInterval),this._scoreUpdateInterval=void 0,clearInterval(this._stageCalcInterval),this._stageCalcInterval=void 0},updateAudioUpStreamConnectionStatsData:function(e,t){this._audioUpStreamConnectionStatsData=e,this._audioUpStreamConnectionFilteredStatsData=t,this._setAudioUpStreamConnectionStatsData()},updateAudioDownStreamConnectionStatsData:function(e,t){this._audioDownStreamConnectionStatsData=e,this._audioDownStreamConnectionFilteredStatsData=t,this._setAudioDownStreamConnectionStatsData()},updateVideoUpStreamConnectionStatsData:function(e,t){this._videoUpStreamConnectionStatsData=e,this._videoUpStreamConnectionFilteredStatsData=t,this._setVideoUpStreamConnectionStatsData()},updateVideoDownStreamConnectionStatsData:function(e,t){this._videoDownStreamConnectionStatsData=e,this._videoDownStreamConnectionFilteredStatsData=t,this._setVideoDownStreamConnectionStatsData()},_setAudioUpStreamConnectionStatsData:function(){var e=this._audioUpStreamConnectionStatsData,t=this._audioUpStreamConnectionFilteredStatsData;if(e&&t){void 0!==t.rtt&&this._audioUpStreamConnectionCrttArray.push(t.rtt);var i=t.ssrclist;for(var a of i){var n=t[a],s=this._audioUpStreamSSRCMap[a];s?(s.jitter.push(n.sendaudiojitter),s.packetsLost=n.sendaudiopacketlost,s.packetsSent=n.audiopacketssent):this._audioUpStreamSSRCMap[a]={jitter:[n.sendaudiojitter],packetsLost:n.sendaudiopacketlost,packetsSent:n.audiopacketssent}}}},_calculateAudioUpStreamConnectionScore:function(){if(this._audioUpStreamConnectionStatsData&&this._audioUpStreamConnectionFilteredStatsData){this._audioUpStreamPeformanceMap={};var e=!1,t=0;if(this._audioUpStreamConnectionCrttArray.length){for(var i of(e=!0,this._audioUpStreamConnectionCrttArray))null==i||i>1?t+=2:i>.3&&t++;t>CallStrengthStatsConstants.maxThresholdScore&&(t=CallStrengthStatsConstants.maxThresholdScore)}var a=0,n=0,s=0,o=0;for(var r in this._audioUpStreamSSRCMap){var l=this._audioUpStreamSSRCMap[r],d=0,c=l.packetsLost,u=l.packetsSent;if(this._prevAudioUpStreamSSRCMap&&this._prevAudioUpStreamSSRCMap[r]){var C=this._prevAudioUpStreamSSRCMap[r];C&&(c-=C.packetsLost,u-=C.packetsSent,c<0&&(c=l.packetsLost||0),u<0&&(u=l.packetsSent))}var p=l.jitter,h=0;if(u>0||c>0)for(var m of p)a++,(null==m||m>.03)&&(h++,n++);h>CallStrengthStatsConstants.maxThresholdScore&&(h=CallStrengthStatsConstants.maxThresholdScore),o+=c,s+=u,d=c>0&&u>0?Math.round(c/u*5):0,(isNaN(d)||d>5||d<0)&&(d=5);var f=0;f=e?Math.round((25-h-d-t)/5):Math.round((15-h-d)/3),h>=6&&f>3&&(f=3),this._audioUpStreamPeformanceMap[r]=f}var g=0;(o>0||s>0)&&(g=Math.round(n/a*CallStrengthStatsConstants.maxThresholdScore));var v=0;o>0&&s>0&&(v=Math.round(o/s*5)),v>CallStrengthStatsConstants.maxThresholdScore&&(v=CallStrengthStatsConstants.maxThresholdScore);var _=g+v,I=0;(I=e?Math.round((25-(_+t))/5):Math.round((15-_)/3))>2&&(g>5||v>2||e&&t>5)&&(I=2),this._audioUpStreamConnectionScore=I,this._prevAudioUpStreamSSRCMap=ZCJQuery.extend(!0,{},this._audioUpStreamSSRCMap),this._audioUpStreamConnectionCrttArray=[],this._isAudioUpStreamAnalysed=!0}},_setAudioDownStreamConnectionStatsData:function(){var e=this._audioDownStreamConnectionStatsData,t=this._audioDownStreamConnectionFilteredStatsData;if(e&&t){void 0!==t.rtt&&this._audioDownStreamConnectionCrttArray.push(t.rtt);var i=t.ssrclist;for(var a of i){var n=t[a],s=this._audioDownStreamSSRCMap[a];s?(s.jitter.push(n.recvaudiojitter),s.packetsLost=n.recvaudiopacketlost,s.packetsReceived=n.audiopacketsreceived):this._audioDownStreamSSRCMap[a]={jitter:[n.recvaudiojitter],packetsLost:n.recvaudiopacketlost,packetsReceived:n.audiopacketsreceived}}}},_calculateAudioDownStreamConnectionScore:function(){if(this._audioDownStreamConnectionStatsData&&this._audioDownStreamConnectionFilteredStatsData){this._audioDownStreamPeformanceMap={};var e=!1,t=0;if(this._audioDownStreamConnectionCrttArray.length){for(var i of(e=!0,this._audioDownStreamConnectionCrttArray))null==i||i>1?t+=2:i>.3&&t++;t>CallStrengthStatsConstants.maxThresholdScore&&(t=CallStrengthStatsConstants.maxThresholdScore)}var a=0,n=0,s=0,o=0;for(var r in this._audioDownStreamSSRCMap){var l=this._audioDownStreamSSRCMap[r],d=0,c=l.packetsLost,u=l.packetsReceived;if(this._prevAudioDownStreamSSRCMap&&this._prevAudioDownStreamSSRCMap[r]){var C=this._prevAudioDownStreamSSRCMap[r];C&&(c-=C.packetsLost,u-=C.packetsReceived,c<0&&(c=l.packetsLost||0),u<0&&(u=l.packetsReceived))}var p=l.jitter,h=0;if(u>0||c>0)for(var m of p)a++,(null==m||m>.03)&&(h++,n++);h>CallStrengthStatsConstants.maxThresholdScore&&(h=CallStrengthStatsConstants.maxThresholdScore),o+=c,s+=u,d=c>0&&u>0?Math.round(c/u*5):0,(isNaN(d)||d>5||d<0)&&(d=5);var f=0;f=e?Math.round((25-h-d-t)/5):Math.round((15-h-d)/3),h>=6&&f>3&&(f=3),this._audioDownStreamPeformanceMap[r]=f}var g=0;(o>0||s>0)&&(g=Math.round(n/a*CallStrengthStatsConstants.maxThresholdScore));var v=0;o>0&&s>0&&(v=Math.round(o/s*5)),v>CallStrengthStatsConstants.maxThresholdScore&&(v=CallStrengthStatsConstants.maxThresholdScore);var _=g+v,I=0;(I=e?Math.round((25-(_+t))/5):Math.round((15-_)/3))>2&&(g>5||v>2||e&&t>5)&&(I=2),this._audioDownStreamConnectionScore=I,this._prevAudioDownStreamSSRCMap=ZCJQuery.extend(!0,{},this._audioDownStreamSSRCMap),this._audioDownStreamConnectionCrttArray=[],this._isAudioDownStreamAnalysed=!0}},_setVideoUpStreamConnectionStatsData:function(){var e=this._videoUpStreamConnectionStatsData,t=this._videoUpStreamConnectionFilteredStatsData;if(e&&t){var i=t[t.ssrclist[0]],a=i.totalencodetime-this._prevVideoEncodeTime,n=i.framesencoded-this._prevVideoFramesEncoded;this._videoFramesEncodingTimeArray.push(a/n);var s=i.totalpacketsenddelay-this._prevVideoPacketSendDelay,o=i.packetssent-this._prevVideoPacketsSent;this._videoPacketSendDelayTimeArray.push(s/o),this._videoFramesSentArray.push(i.framessent-this._prevVideoFramesSent),this._prevVideoFramesEncoded=i.framesencoded,this._prevVideoEncodeTime=i.totalencodetime,this._prevVideoPacketSendDelay=i.totalpacketsenddelay,this._prevVideoPacketsSent=i.videopacketssent,this._prevVideoFramesSent=i.videoframessent}},_calculateVideoUpStreamConnectionScore:function(){if(this._videoUpStreamConnectionStatsData&&this._videoUpStreamConnectionFilteredStatsData){var e=0;for(var t of this._videoFramesSentArray)(null==t||t<5)&&e++;var i=Math.round(e/this._videoFramesSentArray.length)*CallStrengthStatsConstants.maxThresholdScore;i>CallStrengthStatsConstants.maxThresholdScore&&(i=CallStrengthStatsConstants.maxThresholdScore);var a=0;for(var n of this._videoFramesEncodingTimeArray)(null==n||isNaN(n)||n>.15)&&a++;var s=Math.round(a/this._videoFramesEncodingTimeArray.length)*CallStrengthStatsConstants.maxThresholdScore;s>CallStrengthStatsConstants.maxThresholdScore&&(s=CallStrengthStatsConstants.maxThresholdScore);var o=0;for(var r of this._videoPacketSendDelayTimeArray)(null==r||isNaN(r)||r>.1)&&o++;var l=Math.round(o/this._videoPacketSendDelayTimeArray.length)*CallStrengthStatsConstants.maxThresholdScore;l>CallStrengthStatsConstants.maxThresholdScore&&(l=CallStrengthStatsConstants.maxThresholdScore);var d=Math.round((30-i-s-l)/6);this._videoUpStreamConnectionScore=d,this._videoFramesEncodingTimeArray=[],this._videoPacketSendDelayTimeArray=[],this._videoFramesSentArray=[],this._isVideoUpStreamAnalysed=!0}},_setVideoDownStreamConnectionStatsData:function(){}},"undefined"!=typeof MediaStream&&(MediaStream.prototype._getSrcUrl=function(){return(window.URL||window.webkitURL).createObjectURL(this)},MediaStream.prototype._setType=function(e){this._type=e},MediaStream.prototype._getType=function(){return this._type},MediaStream.prototype._getPrimaryAudioTrack=function(){return this.getAudioTracks()[0]},MediaStream.prototype._getPrimaryVideoTrack=function(){return this.getVideoTracks()[0]},MediaStream.prototype._addPrimaryAudioTrack=function(e,t){this._hasAudioTrack()||"audio"!==e.kind||(this.addTrack(e),this._setType(t))},MediaStream.prototype._addPrimaryVideoTrack=function(e,t){this._hasVideoTrack()||"video"!==e.kind||(this.addTrack(e),this._setType(t))},MediaStream.prototype._isPrimaryAudioTrackMuted=function(){var e=this._getPrimaryAudioTrack();return!e||e.muted},MediaStream.prototype._isPrimaryVideoTrackMuted=function(){var e=this._getPrimaryVideoTrack();return!e||e.muted},MediaStream.prototype._replacePrimaryAudioTrack=function(e){if(this._hasAudioTrack()&&"audio"===e.kind){var t=this._getPrimaryAudioTrack();t.id!==e.id&&(t.stop(),this.removeTrack(t),this.addTrack(e))}},MediaStream.prototype._replacePrimaryVideoTrack=function(e){if(this._hasVideoTrack()&&"video"===e.kind){var t=this._getPrimaryVideoTrack();t.id!==e.id&&(t.stop(),this.removeTrack(t),this.addTrack(e))}},MediaStream.prototype._removePrimaryAudioTrack=function(){if(this._hasAudioTrack()){var e=this._getPrimaryAudioTrack();e.stop(),this.removeTrack(e)}},MediaStream.prototype._removePrimaryVideoTrack=function(){if(this._hasVideoTrack()){var e=this._getPrimaryVideoTrack();e.stop(),this.removeTrack(e)}},MediaStream.prototype._hasAudioTrack=function(){return this._getPrimaryAudioTrack()instanceof MediaStreamTrack},MediaStream.prototype._hasVideoTrack=function(){return this._getPrimaryVideoTrack()instanceof MediaStreamTrack},MediaStream.prototype._getAudioDeviceId=function(){var e=this._getPrimaryAudioTrack();return e?e.getSettings().deviceId:null},MediaStream.prototype._getVideoDeviceId=function(){var e=this;this._sourceStream&&(e=this._sourceStream);var t=e._getPrimaryVideoTrack();return t?t.getSettings().deviceId:null},MediaStream.prototype._getAudioDeviceLabel=function(){var e=this._getPrimaryAudioTrack();return e?e.label:null},MediaStream.prototype._getVideoDeviceLabel=function(){var e=this._getPrimaryVideoTrack();return e?e.label:null},MediaStream.prototype._getVideoSize=function(){var e=this._getPrimaryVideoTrack(),t={width:0,height:0};if(e){var i=e.getSettings();i.width&&(t.width=i.width),i.height&&(t.height=i.height)}return t},MediaStream.prototype.getAspectRatio=function(){var e=0,t=this._getVideoSize();return t.width&&t.height&&(e=t.width/t.height),e},MediaStream.prototype._disableAudioTrack=function(){var e=this._getPrimaryAudioTrack();return!!e&&(e.enabled=!1,!0)},MediaStream.prototype._enableAudioTrack=function(){var e=this._getPrimaryAudioTrack();return!!e&&(e.enabled=!0,!0)},MediaStream.prototype._disableVideoTrack=function(){var e=this._getPrimaryVideoTrack();return!!e&&(e.enabled=!1,!0)},MediaStream.prototype._enableVideoTrack=function(){var e=this._getPrimaryVideoTrack();return!!e&&(e.enabled=!0,!0)},MediaStream.prototype._setTrackStatus=function(e,t){"audio"===e?this._setAudioTrackStatus(t):this._setVideoTrackStatus(t)},MediaStream.prototype._setAudioTrackStatus=function(e){e?this._disableAudioTrack():this._enableAudioTrack()},MediaStream.prototype._setVideoTrackStatus=function(e){e?this._disableVideoTrack():this._enableVideoTrack()},MediaStream.prototype._isAudioTrackEnabled=function(){var e=this._getPrimaryAudioTrack();return!!e&&e.enabled},MediaStream.prototype._isVideoTrackEnabled=function(){var e=this._getPrimaryVideoTrack();return!!e&&e.enabled},MediaStream.prototype._startAudioFrequencyAnalyser=function(e){if(this._audioFrequencyAnalyserCallBacks=this._audioFrequencyAnalyserCallBacks||[],this._audioFrequencyAnalyserCallBacks.push(e),!this._audioContext){var t=window.AudioContext||window.webkitAudioContext;this._audioContext=new t}if(!this._audioAnalyser){this._audioAnalyser=this._audioContext.createAnalyser(),this._audioAnalyser.minDecibels=-90,this._audioAnalyser.maxDecibels=-10,this._audioAnalyser.fftSize=512;var i=this._audioAnalyser.context.sampleRate/this._audioAnalyser.fftSize,a=[Math.ceil(50/i),Math.ceil(3e3/i)]}this._audioSourceNode||(this._audioSourceNode=this._audioContext.createMediaStreamSource(this),this._audioSourceNode.connect(this._audioAnalyser));var n=new Uint8Array(this._audioAnalyser.frequencyBinCount);$ZCUtil.queueAnimation(function(){if(this._audioAnalyser){this._audioAnalyser.getByteFrequencyData(n);var e=Array.from(Array.prototype.slice.apply(n,a)),t=Math.max.apply(null,e);this._audioFrequencyAnalyserCallBacks=this._audioFrequencyAnalyserCallBacks.filter((function(i){return i(t,e)}));var i=this._audioFrequencyAnalyserCallBacks.length>0&&this.active;return i||this._stopAudioFrequencyAnalyser(),i}}.bind(this))},MediaStream.prototype._stopAudioFrequencyAnalyser=function(){this._audioSourceNode&&(this._audioSourceNode.disconnect(this._audioAnalyser),delete this._audioSourceNode),this._audioAnalyser&&delete this._audioAnalyser,this._audioContext&&(this._audioContext.close(),delete this._audioContext),delete this._audioFrequencyAnalyserCallBacks},MediaStream.prototype.bindTrackEnd=function(e){e&&"function"==typeof e&&(this._hasAudioTrack()&&(this._getPrimaryAudioTrack().onended=function(t){e("audio",t,this)}.bind(this)),this._hasVideoTrack()&&(this._getPrimaryVideoTrack().onended=function(t){e("video",t,this)}.bind(this)))},MediaStream.prototype._close=function(){this.getTracks().forEach((function(e){e.stop()})),this._stopAudioFrequencyAnalyser(),this._stopBackgroundProcessor(),this._closeSourceStream()},MediaStream.prototype._setBackgroundProcessor=function(e){this._backgroundProcessor=e},MediaStream.prototype._getBackgroundProcessor=function(){return this._backgroundProcessor},MediaStream.prototype._hasBackgroundProcessor=function(){return void 0!==this._backgroundProcessor},MediaStream.prototype._stopBackgroundProcessor=function(){void 0!==this._backgroundProcessor&&(MLBackgroundProcessor.stopProcessor(this),this._backgroundProcessor=void 0)},MediaStream.prototype._clearBackgroundProcessor=function(){this._backgroundProcessor=void 0},MediaStream.prototype._enableVirtualBackground=function(e,t){void 0!==this._backgroundProcessor&&this._backgroundProcessor.setBackground(e,t).then(function(){this._backgroundProcessor.setEffect("vb")}.bind(this))},MediaStream.prototype._enableBackgroundBlur=function(){void 0!==this._backgroundProcessor&&this._backgroundProcessor.setEffect("blur")},MediaStream.prototype._disableBackgroundEffects=function(){void 0!==this._backgroundProcessor&&this._backgroundProcessor.setEffect("none")},MediaStream.prototype._setBlurIntensity=function(e){void 0!==this._backgroundProcessor&&this._backgroundProcessor.setBlurIntensity(e)},MediaStream.prototype._applyVideoFilter=function(e){void 0!==this._backgroundProcessor&&(this._backgroundProcessor.utils.ctx.filter=e)},MediaStream.prototype._disableVideoFilter=function(){void 0!==this._backgroundProcessor&&(this._backgroundProcessor.utils.ctx.filter="none")},MediaStream.prototype._setAsModuleInstance=function(e){this._instanceId=e},MediaStream.prototype._isModuleInstance=function(){return void 0!==this._instanceId},MediaStream.prototype._getModuleInstanceId=function(){return this._instanceId},MediaStream.prototype._setSourceStream=function(e){this._sourceStream=e},MediaStream.prototype._getSourceStream=function(e){return this._sourceStream},MediaStream.prototype._closeSourceStream=function(){void 0!==this._sourceStream&&this._sourceStream._close()}),HTMLVideoElement.prototype.getStream=HTMLAudioElement.prototype.getStream=function(){var e=null;return"object"==typeof this.srcObject&&(e=this.srcObject),e},HTMLVideoElement.prototype.setStream=HTMLAudioElement.prototype.setStream=function(e){"object"==typeof this.srcObject&&(this.srcObject=e)},HTMLVideoElement.prototype._removeStream=function(){this.srcObject=null},HTMLVideoElement.prototype.playStream=HTMLAudioElement.prototype.playStream=function(e,t){this.getStream()&&this.play().then((function(){"function"==typeof e&&e()})).catch((function(e){"function"==typeof t&&t(e)}))},HTMLVideoElement.prototype.setOrientation=function(e){var t=e?-1:1;ZCJQuery(this).css("transform","scaleX("+t+")")},HTMLVideoElement.prototype.fit=function(e,t){var i=this.getStream();if(null!=i){var a=i._getVideoSize(),n=a.width,s=a.height;if(n&&s){var o=n,r=s;if(e&&t){var l=n/s;(o=t*l)>e&&(o=e),r=o/l}ZCJQuery(this).css({width:o,height:r})}}},HTMLVideoElement.prototype.getAspectRatio=function(){var e=this.videoWidth,t=this.videoHeight,i=0;return e&&t&&(i=e/t),i};var ZCMediaDevices={},MediaDeviceWidget={};ZCMediaDevices=function(){var e={},t={AUDIO_INPUT:"audioinput",AUDIO_OUTPUT:"audiooutput",VIDEO_INPUT:"videoinput"},i={},a={};return i[t.AUDIO_INPUT]={},i[t.AUDIO_OUTPUT]={},i[t.VIDEO_INPUT]={},WebRTCUserMedia.isSupported()&&WebRTCUserMedia.getMediaDevices(),{kinds:t,get:function(e,t){return i[e][t]},getAudioInputDevices:function(){return i[t.AUDIO_INPUT]},getVideoInputDevices:function(){return i[t.VIDEO_INPUT]},getAudioOutputDevices:function(){return i[t.AUDIO_OUTPUT]},isAudioInputDevice:function(e){return e.kind===this.kinds.AUDIO_INPUT},isAudioOutputDevice:function(e){return e.kind===this.kinds.AUDIO_OUTPUT},isVideoInputDevice:function(e){return e.kind===this.kinds.VIDEO_INPUT},isAudioInputDeviceKind:function(e){return e===this.kinds.AUDIO_INPUT},isAudioOutputDeviceKind:function(e){return e===this.kinds.AUDIO_OUTPUT},isVideoInputDeviceKind:function(e){return e===this.kinds.VIDEO_INPUT},hasNoVideoInputDevices:function(){var e=this.getVideoInputDevices();for(var t in e){var i=e[t];if(""!==t&&""!==i.label)return!1}return!0},update:function(e){i[t.AUDIO_INPUT]={},i[t.AUDIO_OUTPUT]={},i[t.VIDEO_INPUT]={},e.forEach((function(e){i[e.kind][e.deviceId]=e}))},hasPreferredAudioInput:function(){return void 0!==e[this.kinds.AUDIO_INPUT]},hasPreferredAudioOutput:function(){return void 0!==e[this.kinds.AUDIO_OUTPUT]},hasPreferredVideoInput:function(){return void 0!==e[this.kinds.VIDEO_INPUT]},updatePreferredDevicesFromLocalDB:function(){e=$DB.get("preferredmediadevices")||{}},setPreferredDevice:function(t,i){if(t&&(e[t.kind]=t.deviceId,i&&void 0!==MediaAPI&&"function"==typeof MediaAPI.updatePreferredDevice)){var a={};a[t.kind]=t,MediaAPI.updatePreferredDevice(a)}"undefined"!=typeof $DB&&$DB.update("preferredmediadevices",e)},setPreferredDevices:function(e,t){for(var i in e)this.setPreferredDevice(e[i],!1);t&&void 0!==MediaAPI&&"function"==typeof MediaAPI.updatePreferredDevice&&MediaAPI.updatePreferredDevice(e)},getPreferredDevices:function(){var i={},a=this.get(this.kinds.AUDIO_INPUT,e[this.kinds.AUDIO_INPUT]),n=this.get(this.kinds.AUDIO_OUTPUT,e[this.kinds.AUDIO_OUTPUT]),s=this.get(this.kinds.VIDEO_INPUT,e[this.kinds.VIDEO_INPUT]);return a&&(i[t.AUDIO_INPUT]=a),n&&(i[t.AUDIO_OUTPUT]=n),s&&(i[t.VIDEO_INPUT]=s),i},isValidDevice:function(e,t){return void 0!==this.get(e,t)},_updateAndGetNewlyAddedDevices:async function(e){for(var t=i,a=await navigator.mediaDevices.enumerateDevices(),n=[],s=0;s<a.length;s++){var o=a[s];void 0===t[o.kind][o.deviceId]&&n.push(o)}n.length>0&&e(n),this.update(a)},addListenerForDeviceChange:function(e,t){e&&"function"==typeof t&&(null==navigator.mediaDevices.ondevicechange&&(navigator.mediaDevices.ondevicechange=function(){ZCMediaDevices._updateAndGetNewlyAddedDevices(function(e){for(var t in a)a[t](e)}.bind(this))}.bind(this)),a[e]=t)},removeListenerForDeviceChange:function(e){delete a[e],$WC.Util.isEmptyObject(a)&&(navigator.mediaDevices.ondevicechange=null)}}}(),MediaDeviceWidget=function(){var e=null,t=null,i=null,a={showSelectedCategory:function(e){var t=e.attr("category");e.siblings().removeClass("zc-av-medsel"),e.addClass("zc-av-medsel");var i=ZCJQuery("#media_device_widget");i.find("[mediadevicecnt]").hide(),i.find("[mediadevicecnt][category='"+t+"']").show()},selectDevice:function(t,i){Clickoutside.handleClickOnChild(i);var a=t.parents("[dropdowncnt]"),n=a.attr("selecteddeviceid"),s=t.attr("deviceid"),o=a.attr("devicekind");if(s!==n){var r=ZCMediaDevices.get(o,s),l={};l[o]=r,e(l),a.find("[dropdowninput]").text(r.label),a.attr("selecteddeviceid",s)}},setSelectedDevices:function(){var t=ZCJQuery("#media_device_widget"),a={};function n(e,t){var i=t.val();"false"==t.children('[value="'+i+'"]').attr("isdefault")&&(a[e]=ZCMediaDevices.get(e,i))}i[ZCMediaDevices.kinds.AUDIO_INPUT]&&n(ZCMediaDevices.kinds.AUDIO_INPUT,t.find("#selectedaudioinput")),i[ZCMediaDevices.kinds.AUDIO_OUTPUT]&&n(ZCMediaDevices.kinds.AUDIO_OUTPUT,t.find("#selectedaudiooutput")),i[ZCMediaDevices.kinds.VIDEO_INPUT]&&n(ZCMediaDevices.kinds.VIDEO_INPUT,t.find("#selectedvideoinput")),"function"==typeof e&&e(a),$WC.$Win.destroy("media_device_widget")},setSpecificSelectedDevice:function(t,a){Clickoutside.handleClickOnChild(a);var n={},s=t.attr("deviceType"),o=t.attr("deviceId"),r=t.attr("selected");i[ZCMediaDevices.kinds.AUDIO_INPUT]&&ZCMediaDevices.isAudioInputDeviceKind(s)&&!r&&(n[ZCMediaDevices.kinds.AUDIO_INPUT]=ZCMediaDevices.get(ZCMediaDevices.kinds.AUDIO_INPUT,o)),i[ZCMediaDevices.kinds.VIDEO_INPUT]&&ZCMediaDevices.isVideoInputDeviceKind(s)&&!r&&(n[ZCMediaDevices.kinds.VIDEO_INPUT]=ZCMediaDevices.get(ZCMediaDevices.kinds.VIDEO_INPUT,o)),"function"==typeof e&&e(n)}},n=function(e,t,i,a){let n=null,s={audioInputDeviceId:null,audioOutputDeviceId:null,videoInputDeviceId:null};return s[ZCMediaDevices.kinds.AUDIO_INPUT]=!0,s[ZCMediaDevices.kinds.AUDIO_OUTPUT]=WebRTCUserMedia.isSupported()&&WebRTCUserMedia.isSetSinkIdSupported(),s[ZCMediaDevices.kinds.VIDEO_INPUT]=!0,n=ZCJQuery.extend({},s,e),t&&(n.audioInputDeviceId=t._getAudioDeviceId()),i&&(n.videoInputDeviceId=i._getVideoDeviceId()),a&&(n.audioOutputDeviceId=a.sinkId),n},s=function(e,t,a,s,o){return i=n(t,a,s,o),$WC.template.replace('<div class="mcontent">{{lhs_cnt}}{{rhs_cnt}}{{footer}}</div>',{lhs_cnt:(r="",l="zc-av-medsel",d='<li class="{{icon_class}} {{sel_class}}" category="{{category}}" mediadevicewidgetbutton purpose="showSelectedCategory">{{category_name}}</li>',i[ZCMediaDevices.kinds.AUDIO_INPUT]&&(r+=$WC.template.replace(d,{$category_name:"emoji.microphone",sel_class:l,icon_class:"zcf-mic",category:ZCMediaDevices.kinds.AUDIO_INPUT}),l=""),i[ZCMediaDevices.kinds.AUDIO_OUTPUT]&&(r+=$WC.template.replace(d,{$category_name:"videochat.settings.soundoutput",sel_class:l,icon_class:"msi-ldspeaker",category:ZCMediaDevices.kinds.AUDIO_OUTPUT}),l=""),i[ZCMediaDevices.kinds.VIDEO_INPUT]&&(r+=$WC.template.replace(d,{$category_name:"emoji.camera",sel_class:l,icon_class:"zcf-video",category:ZCMediaDevices.kinds.VIDEO_INPUT})),$WC.template.replace('<div class="zc-av-mediaui_lhs" mediadevicecategorycnt><ul>{{category_list}}</ul></div>',{category_list:r},"InSecureHTML")),rhs_cnt:function(){var t=[],a=[],n=[];e.forEach((function(e){ZCMediaDevices.isAudioInputDevice(e)?t.push(e):ZCMediaDevices.isVideoInputDevice(e)?a.push(e):n.push(e)}));var s="",o="",r=$WC.template.replace("<option>{{no_device}}</option>",{$no_device:"videochat.settings.nodevice"}),l='<div class="zc-av-mediaui_rhs {{display_class}}" mediadevicecnt category="{{category}}"><div><select id="{{id}}" class="zc-av-slt_view msi-expand">{{options_list_html}}</select></div></div>';function d(e){var t="";return e.length?e.forEach((function(e){var a=!1;a=ZCMediaDevices.isAudioInputDevice(e)?i[ZCMediaDevices.kinds.AUDIO_INPUT]&&i.audioInputDeviceId==e.deviceId:ZCMediaDevices.isAudioOutputDevice(e)?i[ZCMediaDevices.kinds.AUDIO_OUTPUT]&&i.audioOutputDeviceId==e.deviceId:i[ZCMediaDevices.kinds.VIDEO_INPUT]&&i.videoInputDeviceId==e.deviceId,t+=$WC.template.replace('<option class="clr0" isdefault="{{is_default}}" {{selected}} value="{{device_id}}">{{label}}</option>',{device_id:e.deviceId,label:e.label,is_default:a,selected:a?"selected":""})})):t=r,t}return i[ZCMediaDevices.kinds.AUDIO_INPUT]&&(s+=$WC.template.replace(l,{options_list_html:d(t),category:ZCMediaDevices.kinds.AUDIO_INPUT,display_class:o,id:"selectedaudioinput"},"InSecureHTML"),o="dN zc-av-dN"),i[ZCMediaDevices.kinds.AUDIO_OUTPUT]&&(s+=$WC.template.replace(l,{options_list_html:d(n),category:ZCMediaDevices.kinds.AUDIO_OUTPUT,display_class:o,id:"selectedaudiooutput"},"InSecureHTML"),o="dN zc-av-dN"),i[ZCMediaDevices.kinds.VIDEO_INPUT]&&(s+=$WC.template.replace(l,{options_list_html:d(a),category:ZCMediaDevices.kinds.VIDEO_INPUT,display_class:o,id:"selectedvideoinput"},"InSecureHTML")),s}(),footer:$WC.template.replace('<div class="zc-av-footer "><div class="zc-av-windwbtn" mediadevicewidgetbutton purpose="setSelectedDevices">{{save}}</div></div>',{$save:"common.save"})},"InSecureHTML");var r,l,d};return{getCurrentConfig:n,handleCustomUIClose:function(){e=null,i=null},show:function(o,r,l,d,c,u){if(!ZCJQuery("#media_device_widget").length&&WebRTCUserMedia.isSupported()){e=o,t=u;var C=function(){e=null,i=null,"function"==typeof t&&(t(),t=null)},p=function(e){"function"==typeof r.handleCustomUI?(r.handleCustomUI(e,r,l,d,c),i=n(r,l,d,c)):MediaUtil.createPopup({id:"media_device_widget",header:MediaUtil.getResource("videochat.settings.msg1"),class:"zc-av-mediaui zcalgncntr zcbg_mask",closefn:C,html:s(e,r,l,d,c)},!0),ZCJQuery("#media_device_widget").on("click","[mediadevicewidgetbutton]",(function(e){e.stopPropagation();var t=ZCJQuery(this),i=t.attr("purpose");a[i](t,e)}))}.bind(this);WebRTCUserMedia.getMediaDevices(p)}}}}();var ZCAVCallManager,ZCAVUtil,ScreenShare={};ScreenShare.Extension=function(){var e=!1,t=[],i="https://chrome.google.com/webstore/detail/amdlbhchbncikhefhcbmcdcgadlggdlb",a=null;return{getLink:function(){if($ZCUtil.Browser.isChrome())return i},isInstalled:function(){return e||!$ZCUtil.Browser.isChrome()||_isZCDesktopApp()},setStatusAsInstalled:function(){e=!0},checkInstalledStatus:function(){if(window.postMessage({requestId:"zoho_cliq_extn_check",message:"ZOHOCLIQ-EXTN-CHECK"},"*"),t.length){var e=[];t.forEach((function(t){t.closed||e.push(t)})),t=e}},openStore:function(){t.push(window.open(this.getLink()))},isStoreOpened:function(){return t.length>0},getSourceId:function(e){a=e,window.postMessage({requestId:"zoho_cliq_get_screen_sourceId",message:"ZOHOCLIQ-GET-SCREEN-SOURCEID"},"*")},handleMessageEvent:function(t){var i=t.originalEvent.data;"ZOHOCLIQ-EXTENSION"===i.source&&("zoho_cliq_extn_check"===i.requestId?e=!0:"zoho_cliq_get_screen_sourceId"===i.requestId&&("function"==typeof a&&a(i.message.data),a=null))}}}(),void 0!==ZCConfig&&(ZCConfig.getMode=function(){return ZCConfig.mode.library}),(ZCAVCallManager=function(e){e=Object.assign({},ZCAVUtil.defaultProps,e),this.Constants=Object.assign({},ZCAVUtil.defaultProps.constants,e.constants),this.Validator=e.validator,this.FeatureConfig=void 0!==e.server_config&&e.server_config.feature_config||{},this.ServerConstants=void 0!==e.server_config&&e.server_config.server_constants||{},this.Users=e.users_api,this.Resource=e.resource_api,this.Tracker=e.spotlight_api,this.Notifier=e.notification_api,this.Settings=e.settings_api,this.SoundManager=e.sound_manager,this.Util=e.utils||ZCAVUtil,this.Util.getSyncedCurrentTime=e.get_synced_current_time||Date.now,this.getSid=e.get_sid,this.getRawSid=e.get_raw_sid,this.getOneToOneChatId=e.get_dm_chat_id,this.getTitleForChid=e.getTitleForChid,this.getZIndex=e.get_z_index,this.isWmsOwner=e.is_wms_owner,this.getWmsDebugInfo=e.get_wms_debug_info,this.getFrameOrigin=e.get_frame_origin,this.getUrlPrefix=e.get_url_prefix,this.isWMSConnected=e.wms_status_api,this.getWmsRtt=e.get_wms_rtt,this.Status=Object.assign({},ZCAVUtil.defaultProps.user_status_api,e.user_status_api),this.handleBodyMount=e.handleBodyMount||function(e){ZCJQuery("#zcwindows").before(e),this.setZIndex(e.find("[mediacallwrapper]"))},this.handleChatMount=e.handleChatMount,this.handleChatInRhs=e.handleChatInRhs,this.handleDarkMode=e.handleDarkMode,this.handleChatOpen=e.handleChatOpen,this.desktopScreenCapturer=e.desktopScreenCapturer,this.isDesktopApp=e.isDesktopApp,this.needsClickoutsideBind=e.needsClickoutsideBind,this.notebookIntegSupported=e.notebookIntegSupported,this.incomingCalls=e.incomingCalls,this.isInitialized=e.isInitialized||function(){return!0},this._isSupported=function(){return void 0!==WebRTCUserMedia&&WebRTCUserMedia.isSupported()&&!this.Util.Browser.isEdge()},this._isScreenShareSupported=function(){return this._isSupported()&&(this.Util.Browser.isChrome()||this.Util.Browser.isFirefox()||WebRTCUserMedia.isScreenShareSupportedInNative())},this._isEnabled=function(){return this._isAudioCallEnabled()||this._isVideoCallEnabled()||this._isScreenShareEnabled()},this._isAudioCallEnabled=function(){return void 0===this.Validator||"function"!=typeof this.Validator.isAudioCallEnabled||this.Validator.isAudioCallEnabled()},this._isVideoCallEnabled=function(){return void 0===this.Validator||"function"!=typeof this.Validator.isVideoCallEnabled||this.Validator.isVideoCallEnabled()},this._isScreenShareEnabled=function(){return void 0===this.Validator||"function"!=typeof this.Validator.isScreenShareEnabled||this.Validator.isScreenShareEnabled()},window.$ZCUtil=this.Util,window.$ZCDate={append0:function(e){return e<10?"0"+e:e}}}).prototype={initialize:function(e){var t=function(){window.ZCJQuery=window.jQuery,window.resolveJQueryConflict&&jQuery.noConflict(!0),0==ZCJQuery("#zcwindows").length&&ZCJQuery("body:first").append('<div id="zcwindows" class="zcoverlay"></div>'),this.setZIndex(ZCJQuery("#zcwindows")),this.needsClickoutsideBind&&document.addEventListener("click",(function(e){Clickoutside.handleClick(e)})),window.injectZCJQueryOverrides(),MediaManager.bindEvents(),MediaUtil.setClientBridge(this),MediaCall.isNewAVDomainRoutingEnabled()?MediaCallIframeHandler.init():(MediaCallImpl.init(),MediacallScreenRequestHandler.init(MediaCall.BRIDGE.getDesktopScreenCapturer())),"function"==typeof e&&e()}.bind(this);if($ZCUtil.isJQueryAvailable())t();else{window.resolveJQueryConflict=!0;var i=document.createElement("script");i.type="text/javascript",i.src=this.getJqueryUrl(),i.onload=t,document.head.appendChild(i)}},getJqueryUrl:function(){return this.Constants.tp_static_url+"/officechat/js/jquery-1.10.1.min.33d85132f0154466fc017dd05111873d.js"},setZIndex:function(e){if("function"==typeof this.getZIndex){var t=this.getZIndex();e.css("z-index",t)}},isForceTurnEnabled:function(){return void 0!==this.Validator&&"function"==typeof this.Validator.isForceTurnEnabled&&this.Validator.isForceTurnEnabled()},isMultipleCallHandlingEnabled:function(){return void 0!==this.FeatureConfig&&this.FeatureConfig.isMultipleCallHandlingEnabled},isDeviceChangeListenerEnabled:function(){return void 0!==this.FeatureConfig&&this.FeatureConfig.isDeviceChangeListenerEnabled},isNewAVDomainRoutingEnabled:function(){return void 0!==this.FeatureConfig&&this.FeatureConfig.isNewAVDomainRoutingEnabled},isAVRecordingEnabled:function(){return void 0!==this.Validator&&"function"==typeof this.Validator.isAVRecordingEnabled&&this.Validator.isAVRecordingEnabled()},isNetworkIndicatorEnabled:function(){return void 0!==this.FeatureConfig&&this.FeatureConfig.isNetworkIndicatorEnabled},isCallCollisionHandlingEnabled:function(){return void 0!==this.FeatureConfig&&this.FeatureConfig.isCallCollisionHandlingEnabled},isVideoEffectsEnabled:function(){return void 0!==this.FeatureConfig&&this.FeatureConfig.isVideoEffectsEnabled},isVideoEffectsSettingsEnabled:function(){return void 0!==this.FeatureConfig&&this.FeatureConfig.isVideoEffectsSettingsEnabled&&!this.Constants.IS_GUEST_USER},isAdhocCallConversionEnabled:function(){return void 0!==this.Validator&&"function"==typeof this.Validator.isAdhocCallConversionEnabled&&this.Validator.isAdhocCallConversionEnabled()},isContainerDeatchOnMinimizeDisabled:function(){return!0},isEnabled:function(){return this._isEnabled()},isSupported:function(){return this._isSupported()},isAudioCallAllowed:function(){return this._isSupported()&&this._isAudioCallEnabled()},isVideoCallAllowed:function(){return this._isSupported()&&this._isVideoCallEnabled()},isScreenShareAllowed:function(){return this._isScreenShareSupported()&&this._isScreenShareEnabled()},isWhiteBoardAllowed:function(){return void 0!==this.Validator&&"function"==typeof this.Validator.isWhiteBoardEnabled&&this.Validator.isWhiteBoardEnabled()},isScreenShareWithAudioCallAllowed:function(){return this.isScreenShareAllowed()&&this.isAudioCallAllowed()},isSystemAudioInSSAllowed:function(){return void 0!==this.Validator&&"function"==typeof this.Validator.isSystemAudioAllowedInSSEnabled&&(this.Validator.isSystemAudioAllowedInSSEnabled()&&MediacallScreenRequestHandler.isSystemAudioAllowedInSS())},isNotebookIntegrationSupported:function(){return this.notebookIntegSupported},getIncomingCalls:function(){return this.incomingCalls},handleWmsMessage:function(e){MediaCallImpl.handleCallEvent(e,!0)},handleLogout:function(){MediaCall.clearAllSessions()},startCall:function(e,t,i){MediaCall.initiateStartCallProcess(e,t,i,ZCMediaConstants.triggerSource.CHAT_HEADER)},handlePushNotification:function(e){void 0!==this.Notifier&&this.Notifier.notify(e)},handleTitleChange:function(e){void 0!==this.Notifier&&this.Notifier.notifyInTitle(e)},handleTitleRevert:function(){void 0!==this.Notifier&&this.Notifier.revertTitle()},isDesktopApp:function(){return this.isDesktopApp},getDesktopScreenCapturer:function(){return this.desktopScreenCapturer}},ZCAVUtil={defaultProps:{constants:{MEDIADEFAULTSTATICURL:"/officechat/sound/default",IMGDEFAULTSTATICURL:"/officechat/images/default",_CONNECTED:!0,IS_GUEST_USER:!1,GUID:void 0,IS_CUSTOM_DOMAIN:!1,SPACE_KEYCODE:32,_cssClasses:{NEG_PRIMARY_BTN:"zcl-btn-neg--primary",NEG_SECONDARY_BTN:"zcl-btn-neg--secondary",PRIMARY_BTN:"zcl-btn--primary",SECONDARY_BTN:"zcl-btn--secondary"}},wms_status_api:function(){return this.Constants._CONNECTED},user_status_api:{isBusy:function(){return!1},isDND:function(){return!1}},settings_api:{get:function(){return 0}},users_api:{getName:function(e,t){return t},getImgUrlById:function(e,t){return t=$WC.Matcher.check("imagesize",t)?t:"thumb",MediaCall.BRIDGE.Constants.PHOTOSERVER+"/file?ID="+e+"&exp=6000&t=user&fs="+t}},resource_api:{getRealValue:function(e){return e}},get_z_index:function(){return 1e3},get_frame_origin:function(){return window.location.origin},get_url_prefix:function(){return""}},getOS:function(){var e=window.navigator.userAgent,t=window.navigator.platform,i=null;return-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(t)?i="Mac":-1!==["iPhone","iPad","iPod"].indexOf(t)?i="iOS":-1!==["Win32","Win64","Windows","WinCE"].indexOf(t)?i="Windows":/Android/.test(e)?i="Android":!i&&/Linux/.test(t)&&(i="Linux"),i.toLowerCase()},isMacOs:function(){return-1!=navigator.appVersion.indexOf("Mac")},isMacOSMojaveOrOlder:function(){var e=navigator.userAgent.match(/Mac\sOS\sX\s10(.|_)(7|8|9|10|11|12|13|14)/);return!$WC.Util.isEmpty(e)&&e.length},isMacOSCatalinaOrNewer:function(){return this.isMacOs()&&!this.isMacOSMojaveOrOlder()},isWindowsOs:function(){return-1!=navigator.appVersion.indexOf("Windows")},isAppleSilicon:function(){var e=navigator.userAgent.match(/AppleSilicon/);return this.isMacOs()&&!$WC.Util.isEmpty(e)&&e.length},getWindowsVersion:function(){try{return Math.ceil(parseFloat(navigator.userAgent.match(/Windows\sNT\s([^;]+)/)[1]))}catch(e){}return-1},isWindows10orNewer:function(){return this.isWindowsOs()&&this.getWindowsVersion()>10},Browser:{CHROME:"chrome",FIREFOX:"firefox",OPERA:"opera",SAFARI:"safari",IE:"ie",EDGE:"edge",name:null,getBrowserName:function(){if(this.name)return this.name;(navigator&&navigator.vendor||"").toLowerCase();var e=(navigator&&navigator.userAgent||"").toLowerCase();return $WC.Matcher.check("firefox_useragent_lowercase",e)?this.name=this.FIREFOX:$WC.Matcher.check("opera_useragent_lowercase",e)?this.name=this.OPERA:$WC.Matcher.check("edge_useragent_lowercase",e)?this.name=this.EDGE:$WC.Matcher.check("chrome_useragent_lowercase",e)?this.name=this.CHROME:$WC.Matcher.check("ie_useragent_lowercase",e)?this.name=this.IE:$WC.Matcher.check("safari_useragent_lowercase",e)?this.name=this.SAFARI:this.name="unknown",this.name},isFirefox:function(){return this.getBrowserName()==this.FIREFOX},isChrome:function(){return this.getBrowserName()==this.CHROME},isOpera:function(){return this.getBrowserName()==this.OPERA},isSafari:function(){return this.getBrowserName()==this.SAFARI},isEdge:function(){return this.getBrowserName()==this.EDGE}},getOS:function(){var e=window.navigator.userAgent,t=window.navigator.platform,i=null;return-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(t)?i="Mac":-1!==["iPhone","iPad","iPod"].indexOf(t)?i="iOS":-1!==["Win32","Win64","Windows","WinCE"].indexOf(t)?i="Windows":/Android/.test(e)?i="Android":!i&&/Linux/.test(t)&&(i="Linux"),i.toLowerCase()},animateBufferLoader:function(e,t){if("object"==typeof e){for(var i=this.getCssTransformProperty()+":rotate({{degree}}deg) translate(0px, -150%);animation-delay: {{delay_time}}s",a=360/(t=t?parseInt(t):12),n=1/t,s=0,o=0,r="",l=0;l<t;l++)r+='<div class="zc-buffer-loader-bar" style="'+$WC.template.replace(i,{degree:s,delay_time:o})+'"></div>',o+=n,s+=a;var d='<div class="zc-buffer-loader">'+r+"</div>";e.append(d)}},getCssTransformProperty:function(){for(var e=["transform","-webkit-transform","-moz-transform","-ms-transform","-o-transform"],t=0;t<e.length;t++)if(void 0!==document.body.style[e[t]])return e[t]},queueAnimation:function(){var e=[],t=null,i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,a=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.msCancelAnimationFrame,n=function(){(e=e.filter((function(e){return e()}))).length&&(t=i(n))};return function(s){e.push(s),t&&a(t),t=i(n)}}(),getDurationInHrMinSec:function(e){var t="",i=e/1e3,a=Math.floor(i/3600);i%=3600;var n=Math.floor(i/60),s=Math.floor(i%60),o=a>0,r=n>0,l=s>0;return o&&(t+=a),r&&(t+=o?":"+$Date.append0(n):n),l&&(t+=o&&!r?":"+$Date.append0(n)+":"+$Date.append0(s):r?":"+$Date.append0(s):"00:"+$Date.append0(s)),t},cloneObject:function(e,t){return t?ZCJQuery.extend(!0,{},e):ZCJQuery.extend({},e)},isJQueryAvailable:function(){return void 0!==window.jQuery&&void 0!==jQuery.fn&&"function"==typeof jQuery.fn.on}};