var ZInvoice={setZFIframeHeight:function(e){ZInvoice.setZBIFrameHeight(e,"zBooksIframe")},showMessageBand:function(e,t){crmui.showMsgBand(ZInvoice.msgType[e],t,4e3)},getTimeline:function(e){getTimeLine(e,"activeTabCl")},saveAndSend:{isSaveAndSend:!1,loadDetails:!1,customModule:"",entityID:""},potentialDetails:{accountID:"",contactID:"",potentialName:""},contactDetails:{accountID:""},potentialLinkingObj:{accountID:"",contactID:"",potentialID:"",potentialName:"",crmModuleType:""},companyDetailsForOrg:{email:"",companyName:"",countryCode:"",currencyCode:"",isMCEnabled:!1,timeZone:""},bannerDetails:{showBanner:!1,products:"",companyName:""},devObject:{userParam:null,branchParam:null},financeDetails:{module:null,entityId:null,isRefresh:!1},productsToEnable:[],isEditNotCompleted:!1,isReEnablingIntegration:!1,productsToDisable:[],pageNavigationStatus:0,potentialEstRefreshCount:1,potentialInvRefreshCount:1,commentsArray:[],zbTimeZoneOffset:0,potentialStages:[],potentialStageMap:{},zsmRLRefresh:!1};ZInvoice.zInvMod,ZInvoice.zInvEntId,ZInvoice.zInvRelId,ZInvoice.entityType,ZInvoice.msgType=["empty","success","info","warning","error"],ZInvoice.initiateAjaxUsingRequestPool=function(e,t,n,o,i,a){t=null===t?"GET":t,(new crmRequestPool).initiate({action:e,type:t,data:n,beforeSend:function(e){!0===Crm.isPageLoad&&e.setRequestHeader("is-Page-Load","true"),Crm.isPageLoad=!1},success:function(e){if(commonUtils.showHideLoadingDiv(!1),e&&"object"!=typeof e&&e.indexOf("CRM_ERROR_PAGE_500::::EXCEPTION")>-1){var t=$("#show");t.length&&(t.html(e),$.scrollTo("#basic"))}else null===a?null!==o&&"function"==typeof o&&o(e):$("#"+a).html(e)},error:function(e){commonUtils.showHideLoadingDiv(!1),null!==i&&"function"==typeof i&&i(e)}})},ZInvoice.constructTimeline=function(e,t){var n=ZInvoice.commentsArray,o=Number(ZInvoice.zbTimeZoneOffset);if(!validationUtils.isJson(n)||!ZInvoice.zbTimeZoneOffset||isNaN(o))return e;switch(t){case"CustomModule5001":t="Invoice";break;case"CustomModule5002":t="Estimate";break;case"CustomModule5003":t="Sales Order";break;case"CustomModule5004":t="Purchase Order"}var i=[];i=e.filter((function(e){return!crmTab.isZBCustomModule(e.module)}));for(var a=o/6e4,s=Utils.getTimezoneOffset(),c=n.length<50?n.length:50,r=0;r<c;r++){var l={},d=new Date(n[r].date.replace(/-/g,"/")+" "+n[r].time),m=a+s;d.setMinutes(d.getMinutes()-m),l.owner=$ESAPI.encoder().encodeForHTML(n[r].commented_by),l.description=$ESAPI.encoder().encodeForHTML(n[r].description),l.owner_id=$ESAPI.encoder().encodeForHTMLAttribute(n[r].commented_by_id),l.action=$ESAPI.encoder().encodeForHTML(n[r].operation_type),l.DisplayDate=$.datepicker.formatDate("M dd, yy",d),l.ToolTipDate=d.toJSON().substring(0,21).replace("T"," "),l.displayName=I18n.getMsg(t),l.module=t,l.DisplayTime=Utils.getTimeInUserFormat(d,!0),l.SUBJECT="";var u=l.owner+" "+I18n.getMsg("crm.mass.actions.in")+" "+Crm.brandName+" Books";l.description.includes(Crm.brandName)&&(u="");var v=$("<span></span>").addClass("tl").html(l.description),p=$("<div></div>");null!=u&&""!=u?($("<span></span>").addClass("tl_by").html(I18n.getMsg("crm.label.simply.by")).appendTo(p),$("<span></span>").addClass("f12").attr("purpose","showUserBC").attr("data-params",'{"userId":"'+l.owner_id+'"}').html(u).appendTo(p),$("<span></span>").addClass("tl_dat").addClass("mL5").attr("title",l.ToolTipDate).html(l.DisplayDate).appendTo(p)):$("<span></span>").addClass("tl_dat").attr("title",l.ToolTipDate).html(l.DisplayDate).appendTo(p),"Updated"===l.action?(l.displayContent=v.outerHTML()+p.outerHTML(),l.class="timeline-updateicon"):"Added"===l.action?(l.displayContent=v.outerHTML()+p.outerHTML(),l.class="timeline-Notes-icon"):(l.displayContent=v.addClass("tl_a").removeClass("tl").html(I18n.getMsg("crm.ln.lable.comment")+" "+I18n.getMsg("added")).outerHTML()+v.addClass("tl_s").removeClass("tl_a").html("-").outerHTML()+v.addClass("pt10").removeClass("tl_s").html("<pre wrap='soft' style='overflow:auto;word-wrap:break-word;margin:0px;width:235px;'>"+l.description+"</pre>").outerHTML()+p.addClass("mT5").outerHTML(),l.class="timeline-Invoices-icon"),i.push(l)}return JSON.stringify(i)},ZInvoice.showApproveBtn=function(){$("#customizeRelDetailsApprove").closest("td").removeClass("dN")},ZInvoice.loadRelatedList=function(){var e=$("span[name^='zinvoicepersonality_']");if(void 0!==$("#zinvEntityID").val()){var t=$(window).scrollTop(),n=t+renderingUtils.windowHeight,o=e.offset().top,i=o+e.height();"true"!=e.attr("istriggered")&&i>=t&&o<=n&&i<=n&&o>=t&&(e.attr("istriggered","true"),$("#zinvoiceRef")[0].click())}},ZInvoice.invoiceDetailSuccessHandler=function(e){var t={},n=$("#packagediv"),o=$("#inventorydiv"),i=$("#salesDIV"),a=$("#payablesDIV"),s=$("#receivablesDIV"),c=$("#summaryHdr"),r=$("#noInfoMsg"),l=$("#zfReceivablesTable"),d=void 0;$("#zfStockTable, #zfShipmentTable").add(l).children().show(),$(".zfinance-load").add(i).add(a).add(s).add(c).add(r).hide(),$("#invInfoDiv").hide(),$("#invInfoContentDIV").removeClass("hide");try{d=(t=JSON.parse(e)).contact}catch(t){return n.text(e),o.text(e),void l.text(e)}if(void 0===d?r.add(c).show():(void 0!==d.outstanding_receivable_amount_formatted&&(s.show(),$("#receivableAmt").html(d.outstanding_receivable_amount_formatted),$("#unusedReceivableAmt").html(d.unused_credits_receivable_amount_formatted)),void 0!==d.outstanding_payable_amount_formatted&&(a.show(),$("#payableAmt").html(d.outstanding_payable_amount_formatted),$("#unusedPayableAmt").html(d.unused_credits_payable_amount_formatted)),void 0!==d.total_sales_formatted&&(i.show(),$("#salesAmt").html(d.total_sales_formatted))),$("#zfStockLabel").is(":visible")){try{t.inventorydetails&&!t.inventorydetails.zf_item_summary_Error?($("#itemstobepacked").html('<span style="color:#666">'+I18n.getMsg("crm.zinventory.itemstobepacked")+"</span> :  "+t.inventorydetails.zf_item_qty_to_be_packed),$("#itemstobeshipped").html('<span style="color:#666">'+I18n.getMsg("crm.zinventory.itemstobeshipped")+"</span> :  "+t.inventorydetails.zf_item_qty_to_be_shipped),$("#itemstobeinvoiced").html('<span style="color:#666">'+I18n.getMsg("crm.zinventory.itemstobeinvoiced")+"</span> :  "+t.inventorydetails.zf_item_qty_to_be_invoiced)):o.text(t.inventorydetails.zf_item_summary_Error)}catch(e){o.text(I18n.getMsg("crm.security.error.add.user"))}try{if(t.inventorydetails&&!t.inventorydetails.zinventory_packages_Error)if(t.inventorydetails.packages_array.length<1)n.text(I18n.getMsg("crm.zinventory.norecentshipments"));else{var m="";$.each(t.inventorydetails.packages_array,(function(){m=m+'<div style="padding: 7px 0;border-top:1px solid #ebebeb"><div><span style="color:#666">'+I18n.getMsg("crm.zinventory.shipmentdate")+"</span> : "+this.shipment_date_formatted+'</div><div style="font-size:1.3rem;"><div style="float:left;min-width:120px;width:auto"><span style="color:#666">'+I18n.getMsg("crm.zinventory.packagenumber")+"</span> :  "+this.package_number+'</div><span style="color:#666;padding:0 10px"> | </span><span style="color:#666">'+I18n.getMsg("Quantity")+"</span> :  "+this.quantity_formatted+'</div><div style="font-size:1.3rem;"><span style="color:#666">'+I18n.getMsg("crm.zinventory.sonumber")+'</span> :  <a data-zcqa="detailView" data-cid = "detailView" data-params=\'{"module":"CustomModule5004","zbPKID":"'+this.salesorder_id+'","id":"'+this.salesorder_crm_reference_id+'","lookback":"true"}\' href="javascript:void(0);">'+this.salesorder_number+"</a></div></div>"})),n.html(m)}else n.text(t.inventorydetails.zinventory_packages_Error)}catch(e){n.text(I18n.getMsg("crm.security.error.add.user"))}}},ZInvoice.fetchInvoiceDetails=function(e,t){var n=new getHTTPObject,o="Accounts"===t?"zcrm_account_id":"zcrm_contact_id",i=Crm.getCrmBasePath()+"/connectzb?crmEntityId="+e+"&reference_id_type="+o+"&entityType=16";try{n.open("GET",i,!0),n.onreadystatechange=function(){4===n.readyState&&ZInvoice.invoiceDetailSuccessHandler(n.responseText)}}catch(e){ZInvoice.showMessageBand(4,e)}n.send(null)},ZInvoice.downloadZIJSForEntity=function(e,t,n,o,i,a,s){ZInvoice.zInvEntId=e,ZInvoice.zInvMod=t,ZInvoice.zInvRelId=n;var c=Crm.getCrmBasePath()+"/connectzb?module="+t+"&crmEntityId="+e,r=$("#zBooksIframe"),l=$("#zbModalContent");$("#zbModalHdr").show(),l.removeClass("modal-medium").addClass("modal-large"),void 0!==a&&(s&&(r.css("width","830px"),l.removeClass("modal-large").addClass("modal-medium")),c=c+"&entityid="+a),c=c+"&entityType="+o,c=ZInvoice.setupDevelopmentURL(c),$("#zBooksTitleDIV").empty(),getElemById("zBooksTitleDIV").innerHTML=i,r[0].src=c,freezeBackground(),$("#zb-loading-3").removeClass("hide"),r.on("load",(function(){removeFreezeLayer(),$("#zb-loading-3").addClass("hide"),crmui.showPopup("zb-Modal"),ZInvoice.zbModalHgt(),$("html").addClass("hide-scroll")})),$(window).on("orientationchange",(function(){window.innerHeight>window.innerWidth?ZInvoice.zbModalHgt("Portrait"):ZInvoice.zbModalHgt("Landscape")})),$(window).on("resize",(function(){ZInvoice.zbModalHgt()}))},ZInvoice.zbModalHgt=function(){var e=$("#zb-Modal"),t=e.find(".pp-content"),n=window.innerHeight?window.innerHeight-175:$(window).height()-175;t.addClass("zBTouch"),t.css("max-height",n+"px !important"),e.addClass("w85per"),e.find(".modal-content").css("height",n-60+"px"),e.find(".modal-body").css("height",n-60+"px")},ZInvoice.procZInvoiceResp=function(e,t,n,o){try{var i="object"==typeof e?e:jQuery.parseJSON(e),a=i.code}catch(e){return void ZInvoice.showMessageBand(4,I18n.getMsg("crm.zinvoice.processError"))}if(o||mailsetCenter("zbErrMsg"),0===a)if(ZInvoice.showMessageBand(1,i.message),t){ZInvoice.saveAndSend.isSaveAndSend=n;var s="invoice";t===ZBEntityJSConstants.ZBESTIMATE?s="estimate":t===ZBEntityJSConstants.ZBSALESORDER?s="salesorder":t===ZBEntityJSConstants.ZBPURCHASEORDER&&(s="purchaseorder");var c=i[s].crm_custom_reference_id;Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[t,c]})}else ZInvoice.saveAndSend.loadDetails=!n,ZInvoice.closeZBInvoiceIFrame(),n&&ZInvoice.processSaveAndSend(i);else ZInvoice.showMessageBand(4,i.message)},ZInvoice.downloadZohoInvoiceJS=function(e,t,n,o,i,a){ZInvoice.zInvEntId=e,ZInvoice.zInvMod=t,ZInvoice.zInvRelId=n;var s=o;ZInvoice.entityType="1";var c=I18n.getMsg("zb.common.NewEstimate");s&&(ZInvoice.entityType="2",c=I18n.getMsg("zb.common.NewInvoice")),void 0!==i&&""!=i&&(a?ZInvoice.entityType=s?"12":"13":(ZInvoice.entityType="5",c=I18n.getMsg("zb.common.EditEstimate"),s&&(ZInvoice.entityType="6",c=I18n.getMsg("zb.common.EditInvoice")))),ZInvoice.downloadZIJSForEntity(e,t,n,ZInvoice.entityType,c,i,a)},ZInvoice.setIFrameHeight=function(e){ZInvoice.setHeight("#zBooksIframe",e)},ZInvoice.setZBDashboardIFrameHeight=function(e,t){ZInvoice.setHeight(t,e)},ZInvoice.setZBIFrameHeight=function(e,t){ZInvoice.setHeight("#"+t,e)},ZInvoice.setHeight=function(e,t){((""+t).includes("px")?parseInt(t.replace("px","")):t)<50&&("zbDashboard"==e||"#zbDashboard"==e?t=1300:"zbDashboard2"!=e&&"#zbDashboard2"!=e||(t=2300)),$(e).height(t)},ZInvoice.closeZBInvoiceIFrame=function(){$("#zb-Modal").find(".pp-content").removeClass("zBTouch"),crmui.hidePopup("zb-Modal"),$("#zBooksIframe").unbind(),$("#zBooksIframe").attr("src","about:blank"),$("html").removeClass("hide-scroll"),ZInvoice.saveAndSend.loadDetails&&(0===$("#zbCMDetailsIframe").length?ZInvoice.zsmRLRefresh?($("#zSubscriptionsRefresh")[0].click(),ZInvoice.zsmRLRefresh=!1):$("#zinvoiceRef")[0].click():ZInvoice.contactZBAndLoadEntityDetails(ZInvoice.saveAndSend.customModule,ZInvoice.saveAndSend.entityID,"zbCMDetailsIframe"),ZInvoice.saveAndSend.loadDetails=!1)},ZInvoice.pushNotifyCx=function(e){if("enable"===e){var t=I18n.getMsg("crm.financesuite.enable.msg")+"<br>"+I18n.getMsg("crm.financesuite.pushnotify.toviewupdate"),n='<div id="fin_notification" class="mig_notification dN" style="width:475px; bottom:28px;"><div class="migCardTitle"><div>'+(I18n.getMsg("Notification")+" - "+I18n.getMsg("crm.zapps.finance"))+'</div><div class="pA svgIconsImg top15 right15 ico-close-white-small2 cP" onclick="$(\'#fin_notification\').slideUp(400,function(){$(this).remove()})"></div></div><div class="pT20 pB10 pR15 pL15"><div class="aligncenter mB15" onclick="$(\'#fin_notification\').slideUp(200)">'+t+"</div></div></div>";$("body").append(n),$("#fin_notification").slideDown()}},ZInvoice.setupInvoiceIntegration=function(e){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup("sync_error");else{var t={mode:"create",showCredentials:"false",serviceName:e};commonUtils.showHideLoadingDiv(!0),ZInvoice.initiateAjaxUsingRequestPool(Crm.getCrmBasePath()+"/invoiceIntegration.do","GET",t,(function(e){($("#result").html(e),"undefined"!=typeof CrmPlusLib&&void 0!==CrmPlusLib.serviceView&&void 0!==CrmPlusLib.serviceView.currentView&&"extensionView"==CrmPlusLib.serviceView.currentView)&&(document.querySelector("#zb-intg-heading span.backtoIcon").classList.add("hide"),document.getElementsByClassName("setupleftmenutd")[0].classList.add("hide"))}),null,null)}},ZInvoice.upgradeEdition=function(){document.location.href=Crm.getCrmBasePath()+"/Security.do?actionName=manageSubscription&fm=tp"},ZInvoice.updateOrgName=function(e,t,n,o){n=I18n.getMsg("crm.zfs.common.got.access")+" "+n,$("#showAvailableIn").html(n),$("#organization_name").val(e),$("#sel_org_name").html(e),$("#organization_id").val(t),$("#base_currency").val(o);var i=$("#orgList");i.addClass("hide"),i.removeClass("show"),$("#zfsIntegrationNextBtn").prop("disabled",!1)},ZInvoice.showOrgList=function(){var e=$("#orgList");e.hasClass("hide")?(e.addClass("show"),e.removeClass("hide")):(e.addClass("hide"),e.removeClass("show"))},ZInvoice.goToSettingsPage=function(e){networkUtils.openUrl(e,"_blank")},ZInvoice.validateInvoiceConfig=function(e,t){getObj("invoiceKey").disabled=!1,"false"===t&&(getObj("email").disabled=!1);var n=!0,o={},i=getObj("invoiceKey").value.trim(),a=getObj("email").value.trim(),s=Crm.getCrmBasePath()+"/invoiceIntegration.do",c="null"!==e?"updateuser":"getInvoiceOrganizations",r=$('[name="crmcsrfparam"]').val();if(""===a||void 0===a){n=!1;var l="crm.books.validation.email"}else{if(!validationUtils.isValidEmail(a)){n=!1;l="crm.books.validation.email.invalid"}}if(""!==i&&void 0!==i||(n=!1,l="crm.books.validation.zsc"),n){o={invoiceKey:i,email:a,mode:c};var d="GET";"updateuser"===c&&(d="POST",o.crmcsrfparam=r,"true"===t&&(o.isUpdateZSCKey=!0)),commonUtils.showHideLoadingDiv(!0),ZInvoice.initiateAjaxUsingRequestPool(s,d,o,null,(function(e){var t=e.responseText;if(/<[a-z][\s\S]*>/i.test(t))ZInvoice.showMessageBand(4,I18n.getMsg("crm.zinvoice.processError"));else{var n=JSON.parse(t);ZInvoice.showMessageBand(4,n.error)}}),"result")}else ZInvoice.showMessageBand(4,I18n.getMsg(l))},ZInvoice.cancelZBCreate=function(){var e=Crm.getCrmBasePath()+"/invoiceIntegration.do";ZInvoice.initiateAjaxUsingRequestPool(e,"GET",{mode:"viewInvoiceIntegration"},(function(e){($("#result").html(e),"undefined"!=typeof CrmPlusLib&&void 0!==CrmPlusLib.serviceView&&void 0!==CrmPlusLib.serviceView.currentView&&"extensionView"==CrmPlusLib.serviceView.currentView)&&(document.querySelector("#zb-intg-heading span.backtoIcon").classList.add("hide"),document.getElementsByClassName("setupleftmenutd")[0].classList.add("hide"))}),null,null)},ZInvoice.deactivateZBIntegration=function(e,t){crmui.showPopup({id:e.replace("#",""),headerBg:!0});var n=t?t.split(","):"";n?n.forEach((function(e){"books"===e||"invoice"===e?$("#zfsDeactivateBooks").removeClass("hide"):"expense"===e?$("#zfsDeactivateExpense").removeClass("hide"):"subscriptions"===e?$("#zfsDeactivateSubscriptions").removeClass("hide"):"inventory"===e&&$("#zfsDeactivateInventory").removeClass("hide")})):$("#deactivateMessageContent").html(I18n.getMsg("crm.zfs.general.deactivateMessage"))},ZInvoice.showServerErrorMessage=function(e){ZInvoice.showMessageBand(4,e)},ZInvoice.contactZBAndLoadDashboard=function(e,t,n,o){var i=Crm.getCrmBasePath()+"/connectzb?entityType="+e;void 0!==t&&""!==t&&(i=i+"&entityName="+t),null!=n&&""!==n&&(i=i+"&isMigration="+n),void 0===o&&(o="zbDashboard");var a=$("#"+o);a.attr("src",i),$("#zb-loading-1").removeClass("hide"),a.addClass("hide"),a.on("load",(function(){var e=$("#zbdbiframeDiv");$("#zb-loading-1").addClass("hide"),$("#"+o).removeClass("hide"),null!==e&&e.css("display","block")}))},ZInvoice.goToZBFieldMappingPage=function(e,t){var n=Crm.getCrmBasePath()+"/invoiceIntegration.do",o={mode:"fetchZIFieldMappingDetails",entity:e};t&&(o.isMigration="true",removeFreezeLayer(),ZInvoice.closeZBMigrationPopup()),ZInvoice.initiateAjaxUsingRequestPool(n,"GET",o,null,null,"result")},ZInvoice.deactivateZCRMZBIntegration=function(e,t){$("#"+e).css("display","none"),removeFreezeLayer();var n=csrfParamName+"="+encodeURIComponent(csrfToken);if(commonUtils.showHideLoadingDiv(!0),ZInvoice.initiateAjaxUsingRequestPool(Crm.getCrmBasePath()+"/invoiceIntegration.do?mode=delete","POST",n,(function(){t&&ZInvoice.loadAppsAndAddonsPage()}),null,null),ZInvoice.clearSetupPageObjects(),"undefined"!=typeof CrmPlusLib&&void 0!==CrmPlusLib.serviceView&&void 0!==CrmPlusLib.serviceView.currentView&&"extensionView"==CrmPlusLib.serviceView.currentView){n={serviceName:"books"};CrmPlusLib.serviceView.close("extensionView",n)}},ZInvoice.callAjaxUpdateFrmZB=function(e){ZInvoice.initiateAjaxUsingRequestPool(e,"GET",null,null,(function(e){var t=e.responseText,n=JSON.parse(t);ZInvoice.showServerErrorMessage(n.error)}),"result")},ZInvoice.goToZBCRMDashboard=function(e){ZInvoice.initiateAjaxUsingRequestPool(Crm.getCrmBasePath()+"/invoiceIntegration.do","GET",{mode:"viewInvoiceIntegration"},(function(t){($("#result").html(t),ZInvoice.showSuccessOrErrorMsg(e),"undefined"!=typeof CrmPlusLib&&void 0!==CrmPlusLib.serviceView&&void 0!==CrmPlusLib.serviceView.currentView&&"extensionView"==CrmPlusLib.serviceView.currentView)&&(document.querySelector("#zb-intg-heading span.backtoIcon").classList.add("hide"),document.getElementsByClassName("setupleftmenutd")[0].classList.add("hide"))}),null,null)},ZInvoice.showSuccessOrErrorMsg=function(e){null==e||ZInvoice.showMessageBand(0===e.code?1:4,e.message)},ZInvoice.saveAndSyncZFSIntegration=function(e,t,n,o,i,a,s){var c={"zb-trigger":o,crmcsrfparam:window.csrfToken},r=[];if("false"===e&&r.push("contact"),"false"===n&&r.push("vendor"),"false"===t&&r.push("item"),null!==a)for(var l in a)c[l]=a[l];c.entities=r.join(","),c.service_list=ZInvoice.productsToEnable.join(","),c.entityType="45",c.hide_crm_native_inventory_modules=s,commonUtils.showHideLoadingDiv(!0),ZInvoice.initiateAjaxUsingRequestPool(Crm.getCrmBasePath()+"/connectzb","POST",c,(function(e){if(null!==e&&"object"==typeof e){var t=e.code,n=e.message;0===t?(ZInvoice.clearSetupPageObjects(),ZInvoice.showSuccessMessagePopUp(i)):4183===t?(ZInvoice.clearSetupPageObjects(),ZInvoice.showMessageBand(4,n),setTimeout((function(){Utils.windowLocationReload()}),3500)):(ZInvoice.showServerErrorMessage(n),$("#zbDashboard")[0].contentWindow.CRMIntegrationUtil.releaseButtonsInDashboard())}}),(function(e){var t=e.responseText;if(/<[a-z][\s\S]*>/i.test(t))ZInvoice.showErrorMsgInZBOrgListPage(I18n.getMsg("crm.zinvoice.processError"));else{var n=JSON.parse(t);ZInvoice.showErrorMsgInZBOrgListPage(n.error),$("#zbDashboard")[0].contentWindow.CRMIntegrationUtil.releaseButtonsInDashboard()}}),null)},ZInvoice.approveEntity=function(e,t){var n={crmcsrfparam:window.csrfToken,entityType:"50"};n.module=e,n.entityid=t,commonUtils.showHideLoadingDiv(!0),ZInvoice.initiateAjaxUsingRequestPool(Crm.getCrmBasePath()+"/connectzb","POST",n,(function(t){null!==t&&"object"!=typeof t&&(t=JSON.parse(t));var n=t.code,o=t.message;0===n?(reloadCurrentEntityView(),crmTab.checkPresenceInCache(e)&&crmTab.deleteFromCache(e),ZInvoice.showMessageBand(1,o)):ZInvoice.showMessageBand(4,o)}),(function(e){var t=e.responseText;/<[a-z][\s\S]*>/i.test(t)?ZInvoice.showMessageBand(4,I18n.getMsg("crm.zinvoice.processError")):ZInvoice.showMessageBand(4,JSON.parse(t).error)}),null)},ZInvoice.zbChangeStatus=function(e,t,n,o){var i={crmcsrfparam:window.csrfToken,entityType:"99"};i.status=n,i.module=e,i.entityid=t,i.crmpkid=o,commonUtils.showHideLoadingDiv(!0),ZInvoice.initiateAjaxUsingRequestPool(Crm.getCrmBasePath()+"/connectzb","POST",i,(function(t){null!==t&&"object"!=typeof t&&(t=JSON.parse(t));var n=t.code,o=t.message;0===n?(reloadCurrentEntityView(),crmTab.checkPresenceInCache(e)&&crmTab.deleteFromCache(e),ZInvoice.showMessageBand(1,o)):ZInvoice.showMessageBand(4,o)}),(function(e){var t=e.responseText;if(/<[a-z][\s\S]*>/i.test(t))ZInvoice.showMessageBand(4,I18n.getMsg("crm.zinvoice.processError"));else{var n=JSON.parse(t);ZInvoice.showMessageBand(4,n.error)}}),null)},ZInvoice.showZBOverwriteAlert=function(){freezeBackground(),$("#zbOverwriteAlert").css("top",0)},ZInvoice.saveZBSyncSettings=function(){removeFreezeLayer(),$("#zbOverwriteAlert").removeAttr("style"),$("#zbDashboard2")[0].contentWindow.CRMIntegrationUtil.saveCRMSyncSettings()},ZInvoice.cancelZBOverwriteAlert=function(){removeFreezeLayer(),$("#zbOverwriteAlert").removeAttr("style"),$("#zbDashboard2")[0].contentWindow.CRMIntegrationUtil.disableSetupBtn(!1)},ZInvoice.setupZBIntegration=function(){var e=$("#organization_id").val();if(""!==e&&null!=e){commonUtils.showHideLoadingDiv(!0);var t=formData2QueryString(document.orgListFormForIntegration);ZInvoice.initiateAjaxUsingRequestPool(Crm.getCrmBasePath()+"/invoiceIntegration.do?mode=save","POST",t,(function(e){($("#result").html(e),"undefined"!=typeof CrmPlusLib&&void 0!==CrmPlusLib.serviceView&&void 0!==CrmPlusLib.serviceView.currentView&&"extensionView"==CrmPlusLib.serviceView.currentView)&&(document.querySelector("#zb-intg-heading span.backtoIcon").classList.add("hide"),document.getElementsByClassName("setupleftmenutd")[0].classList.add("hide"))}),(function(e){var t=e.responseText;if(/<[a-z][\s\S]*>/i.test(t))ZInvoice.showErrorMsgInZBOrgListPage(I18n.getMsg("crm.zinvoice.processError"));else{var n=JSON.parse(t);ZInvoice.showErrorMsgInZBOrgListPage(n.error)}}),null)}else ZInvoice.showErrorMsgInZBOrgListPage(I18n.getMsg("crm.books.configure.org.validation.msg"))},ZInvoice.showErrorMsgInZBOrgListPage=function(e){ZInvoice.showMessageBand(4,e)},ZInvoice.applyScrollShadow=function(e,t){var n=$("#"+e)[0].scrollTop;n>20?$("#"+t).css("box-shadow","#FFF 0px -6px 8px 2px, rgba(0, 0, 0, 0.2) 0px 5px 10px -4px"):$("#"+t).removeAttr("style"),"zbIntegrationSetupPage"===e&&(n<85?$("#zfHeadingPortal").fadeOut(150):$("#zfHeadingPortal").fadeIn())},ZInvoice.goToCredentialsPageForZI=function(e,t,n){var o={mode:"create",showCredentials:"true",serviceName:e,showUpdateUser:t,showUpdateZSC:n},i=Crm.getCrmBasePath()+"/invoiceIntegration.do";ZInvoice.initiateAjaxUsingRequestPool(i,"GET",o,null,null,"result")},ZInvoice.showHideZBDBTooltip=function(e,t,n){var o=$("#zbdbtooltip");n?(o.html(t),"contact"===e?o.css({display:"block",left:"600px",top:"730px",width:"400px"}):"item"===e&&o.css({display:"block",left:"520px",top:"770px",width:"400px"})):o.css("display","none")},ZInvoice.cancelIntegrationSetupPhase=function(e){var t={crmcsrfparam:window.csrfToken,entityType:"46"};ZInvoice.isEditNotCompleted=!1,ZInvoice.initiateAjaxUsingRequestPool(Crm.getCrmBasePath()+"/connectzb","POST",t,null,null,null),removeFreezeLayer(),ZInvoice.clearSetupPageObjects(),e&&ZInvoice.goToZBCRMDashboard()},ZInvoice.showOtherSyncSettings=function(){ZInvoice.closeHtmldiv("zfsMessagePopUpBooks"),$("#zbDashboard")[0].contentWindow.CRMIntegrationUtil.showSyncSettingsForBooks(),$("#setup_new_ContentDiv").scrollTop(500)},ZInvoice.loadCreateNewOrgPage=function(e,t,n,o,i,a,s){var c=Crm.getCrmBasePath()+"/connectzb?entityType="+e,r="zbDashboard",l=$("#"+r),d=$("#zb-loading-1");ZInvoice.companyDetailsForOrg.email=t,ZInvoice.companyDetailsForOrg.companyName="null"!==n?n:"",ZInvoice.companyDetailsForOrg.countryCode="null"!==o?o:"",ZInvoice.companyDetailsForOrg.currencyCode="null"!==i?i:"",ZInvoice.companyDetailsForOrg.timeZone="null"!==s?s:"",ZInvoice.companyDetailsForOrg.isMCEnabled=a,l.attr("src",c),d.removeClass("hide"),l.addClass("hide"),l.on("load",(function(){var e=$("#zbdbiframeDiv");$("#zb-loading-1").addClass("hide"),$("#"+r).removeClass("hide"),null!==e&&e.css("display","block")}))},ZInvoice.loadAppsAndAddonsPage=function(){document.location.href=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/settings/extensions/zoho/apps")},ZInvoice.showBannerinDashboard=function(){$("#zb-create-org-success").removeClass("hide");var e,t,n,o,i=!1;(ZInvoice.bannerDetails.products||[]).split(",").forEach((function(i){"books"===i?e=!0:"inventory"===i?t=!0:"expense"===i?n=!0:"subscriptions"===i&&(o=!0)})),e||t?(e&&($("#booksURLInDashboard").removeClass("hide"),i=!0),t&&($("#inventoryURLInDashboard").removeClass("hide"),i&&$("<span>|</span>").insertBefore("#inventoryURLInDashboard"),i=!0,e||$("#triggerOrModuleLine").html(I18n.getMsg("crm.finance.suite.org.created.module.hide",Crm.appName)))):($("#orgCreateSuccessPointTwo").html(I18n.getMsg("crm.zfs.org.created.success.point.two.others")),$("#orgCreateSuccessPointThree").remove()),n&&($("#expenseURLInDashboard").removeClass("hide"),i&&$("<span>|</span>").insertBefore("#expenseURLInDashboard"),i=!0),o&&($("#subscriptionsURLInDashboard").removeClass("hide"),i&&$("<span>|</span>").insertBefore("#subscriptionsURLInDashboard")),$("#orgCreatedName").html(I18n.getMsg("crm.zfs.org.created.success.point.one","<b>"+$ESAPI.encoder().encodeForHTML(ZInvoice.bannerDetails.companyName)+"</b>"))},ZInvoice.scrollTopToDisplayTriggers=function(){$("#setup_new_ContentDiv").scrollTop($("#zbDashboard").height())},ZInvoice.showCommonMsgPopup=function(e,t){var n=I18n.getMsg("crm.zfsinteg.service.disable.confirm",Crm.userDetails.PARTNERBRAND),o="",i=I18n.getMsg("crm.finance.suite.disable.books.header");"disableLimit"===e?(n=I18n.getMsg("crm.zfsinteg.service.disable.limit",Crm.userDetails.PARTNERBRAND),o=I18n.getMsg("crm.general.note")):("expense"===t?i=I18n.getMsg("crm.finance.suite.disable.expense.header"):"subscriptions"===t&&(i=I18n.getMsg("crm.finance.suite.disable.subscriptions.header")),o=I18n.getMsg("crm.finance.suite.disable.service.header",i)),ZInvoice.showHtmldiv("zfscommonMsgDiv"),$("#zfscommonMsgHeader").html(o),$("#zfscommonMsgDivText").html(n)},ZInvoice.clearSetupPageObjects=function(){ZInvoice.isEditNotCompleted=!1,ZInvoice.isReEnablingIntegration=!1,ZInvoice.productsToEnable.length=0,ZInvoice.productsToDisable.length=0,ZInvoice.pageNavigationStatus=0},ZInvoice.showEntityDisabledMessage=function(e,t){var n=I18n.getMsg("crm.finance.suite.item.module.disabled.header"),o=I18n.getMsg("crm.finance.suite.item.module.disabled.message",[Crm.brandName,Crm.appName]);"contact"===e?(n=I18n.getMsg("crm.finance.suite.contact.module.disabled.header"),o=I18n.getMsg("crm.finance.suite.contact.module.disabled.message",[Crm.brandName,Crm.appName])):"vendor"===e&&(n=I18n.getMsg("crm.finance.suite.vendor.module.disabled.header"),o=I18n.getMsg("crm.finance.suite.vendor.module.disabled.message",Crm.brandName)),ZInvoice.showHtmldiv("zfscommonMsgDiv"),$("#zfscommonMsgHeader").html(n),$("#zfscommonMsgDivText").html(o)},ZInvoice.showMessagePopupDiv=function(e){ZInvoice.showHtmldiv("zfsMessagePopUpBooks"),$("#zbIntegPopupMsgBlock").html(I18n.getMsg("crm.zfsinteg.books.extra.sync",e))},ZInvoice.showSuccessMessagePopUp=function(e){var t=e?I18n.getMsg("crm.finance.suite.updated.success.header"):I18n.getMsg("crm.finance.suite.integrated.success.header");ZInvoice.showHtmldiv("integrationSuccessPopup"),$("#financeSuccessHeader").html(t)},ZInvoice.showCancelFieldMappingPopUp=function(e){ZInvoice.showHtmldiv("zfsCancelFieldMapping"),$("#zbCancelFieldMappingText").html(I18n.getMsg("crm.zfs.cancel.setup.phase",e))},ZInvoice.processPageNavigation=function(){0===ZInvoice.pageNavigationStatus?ZInvoice.clearSetupPageObjects():1===ZInvoice.pageNavigationStatus?ZInvoice.deactivateZCRMZBIntegration("",!1):2===ZInvoice.pageNavigationStatus&&ZInvoice.cancelIntegrationSetupPhase(!1)},ZInvoice.open_popup=function(e){"native_hide_confirm"==e&&(e="zfIntegCRMHidePopup"),crmui.showPopup(e)},ZInvoice.close_popup=function(e){"native_hide_confirm"==e&&(e="zfIntegCRMHidePopup"),crmui.hidePopup(e)},ZInvoice.showHtmldiv=function(e){freezeBackground(),$("#"+e).css("top",0)},ZInvoice.closeHtmldiv=function(e){"zbSetupCancelWarning"==e?crmui.hidePopup(e):($("#"+e).attr("style",(function(e,t){return(t||"")+"top: -200px !important;"})),removeFreezeLayer())},ZInvoice.hideModuleAndProceedSave=function(e){ZInvoice.closeHtmldiv("zfIntegCRMHidePopup"),$("#zbDashboard")[0].contentWindow.CRMIntegrationUtil.updateCRMNativeModuleConfirmation(e)},ZInvoice.fetchPotentialsStage=function(){var e={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken},t=new crmRequestPool,n=ZInvoice.potentialStages;if(!(n.length>0))return t.initiate({action:"/crm/v2/settings/fields?module=Potentials",type:"GET",headers:e,success:function(e){for(var t=e.fields,o=t.length,i=0;i<o;i++)if("Stage"===t[i].api_name){n=t[i].pick_list_values;break}n.length>0?(ZInvoice.potentialStages=n,$("#zbDashboard")[0].contentWindow.CRMIntegrationUtil.populatePotentialStages(n)):$("#zbDashboard")[0].contentWindow.CRMIntegrationUtil.hideAndShowErrorForPotential()},error:function(){$("#zbDashboard")[0].contentWindow.CRMIntegrationUtil.hideAndShowErrorForPotential()}});$("#zbDashboard")[0].contentWindow.CRMIntegrationUtil.populatePotentialStages(n)},ZInvoice.processSaveAndSend=function(e){var t,n,o,i="",a="";ZInvoice.saveAndSend.loadDetails=!0,e.hasOwnProperty("invoice")?(i=ZBEntityJSConstants.INVOICE_EMAIL_GET,a=e.invoice.invoice_id):e.hasOwnProperty("estimate")?(i=ZBEntityJSConstants.ESTIMATE_EMAIL_GET,a=e.estimate.estimate_id):e.hasOwnProperty("salesorder")&&(i=ZBEntityJSConstants.SALESORDER_EMAIL_GET,a=e.salesorder.salesorder_id),t=getElemById("crmEntityId").value,n=getElemById("listRelationId").value,o=getElemById("module").value,ZInvoice.downloadZIJSForEntity(t,o,n,i,"",a)},ZInvoice.fetchZBEntityCreatePage=function(e,t,n,o){var i=Crm.getCrmBasePath()+"/connectzb?module="+e+"&entityType="+t+"&acceptJHTML=true",a=$("#zBooksIframe"),s=$("#zb-loading-1");"null"!==n&&(i=i+"&crmEntityId="+n),o&&"null"!==o&&(i=i+"&entityid="+o),i=ZInvoice.setupDevelopmentURL(i),s.removeClass("hide"),a.addClass("hide"),a.attr("src",i),a.on("load",(function(){$("#zb-loading-1").addClass("hide"),$("#zBooksIframe").removeClass("hide")}))},ZInvoice.setupDevelopmentURL=function(e){var t=ZInvoice.devObject.userParam,n=ZInvoice.devObject.branchParam;return null!=t?e=e+"&zbAssetUserParam="+t:null!=n&&(e=e+"&zbAssetBranchParam="+n),e},ZInvoice.getAlertContentForContacts=function(e,t,n,o,i,a,s,c,r,l){var d="fromDetailsView"===r?new Array($("#id").val()):customViewObject.selectedIds;ZInvoice.fetchAssociatedIds(customViewObject.module,d,(function(d){if(d.length>0){var m=I18n.getMsg("crm.cannot.delete.account.contact.singular",customViewObject.singularModName.toLowerCase()),u=I18n.getMsg("crm.cannot.delete.account.contact.plural",customViewObject.pluralModName.toLowerCase()),v=customViewObject.selectedIds.length>1?u:m;v=void 0===$("#id").val()?v:m;var p='<div onclick="sE()" class="w500 p20"><div class="floatL pL20 w430"><div class="f20"><h2 style="color:#E20000";>'+I18n.getMsg("crm.cannot.delete.account.contact.header",customViewObject.selectedIds.length>1?customViewObject.pluralModName:customViewObject.singularModName)+'</h2></div><div class="mT10">'+v+'</div></div><br class="clearB"><div  class="alignright mT20"><input type="button" id="popupok" class="newgraybtn" value="'+I18n.getMsg("crm.button.ok")+"\" onclick=\"hide('popupnew');removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30\"></div></div>";renderingUtils.popUpWithFreeze(p);var I=!1}else if("Accounts"!=t)I=window.confirm(I18n.getMsg("confirmmsg"));else{I=!0;$("#Warningdiv").hide()}!1!==I&&Callonclickofbutton2_new(e,t,n,o,i,a,s,c,r,l,void 0)}))},ZInvoice.getAlertContentOnContactDelete=function(e,t,n){var o=new Array($("#id").val());ZInvoice.fetchAssociatedIds(n.module,o,(function(n){var o=!0;if(n.length>0){var i=void 0===customViewObject||(void 0===customViewObject.selectedIds||!(customViewObject.selectedIds.length>1)),a=null!=customViewObject&&null!=customViewObject.isZBCustomModuleEnabled?customViewObject.singularModName:zbCustomModuleObjForAccountContactDeletion.singularModuleName,s=null!=customViewObject&&null!=customViewObject.isZBCustomModuleEnabled?customViewObject.pluralModName:zbCustomModuleObjForAccountContactDeletion.pluralModuleName,c=I18n.getMsg("crm.cannot.delete.account.contact.singular",a.toLowerCase()),r=I18n.getMsg("crm.cannot.delete.account.contact.plural",s.toLowerCase()),l=i?c:r;l=void 0===$("#id").val()?l:c;var d='<div onclick="sE()" class="w500 p20"><div class="floatL pL20 w430"><div class="f20"><h2 style="color:#E20000";>'+I18n.getMsg("crm.cannot.delete.account.contact.header",i?a:s)+'</h2></div><div class="mT10">'+l+'</div></div><br class="clearB"><div  class="alignright mT20"><input type="button" id="popupok" class="newgraybtn" value="'+I18n.getMsg("crm.button.ok")+"\" onclick=\"hide('popupnew');removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30\"></div></div>";renderingUtils.popUpWithFreeze(d),o=!1}!1!==o&&Crm.deleteEntity_new(e,t)}))},ZInvoice.fetchAssociatedIds=function(e,t,n){var o={crmcsrfparam:window.csrfToken};o.selectedIds=t.toString(),o.module=""+e,commonUtils.showHideLoadingDiv(!0),jQuery.ajax({type:"POST",url:Crm.getCrmBasePath()+"/invoiceIntegration.do?mode=checkAssociation",data:o,async:!0,success:function(e){commonUtils.showHideLoadingDiv(),/<[a-z][\s\S]*>/i.test(e)?ZInvoice.showMessageBand(4,I18n.getMsg("crm.zinvoice.processError")):n&&n(JSON.parse(e))},error:function(){ZInvoice.showMessageBand(4,I18n.getMsg("crm.zinvoice.processError")),commonUtils.showHideLoadingDiv()}})},ZInvoice.getSelectedRecordsFromMassDelete=function(){for(var e=new Array,t=document.getElementsByName("chk"),n=t.length,o=0;o<n;o++)if(t[o].checked){var i=t[o].value;e.push(i)}return e},ZInvoice.getAlertContentOnMassDelete=function(e,t,n,o){var i=ZInvoice.getSelectedRecordsFromMassDelete();ZInvoice.fetchAssociatedIds(zbCustomModuleObjForAccountContactDeletion.module,i,(function(i){if(i.length>0){var a=!(ZInvoice.getSelectedRecordsFromMassDelete().length>1),s=zbCustomModuleObjForAccountContactDeletion.singularModuleName,c=zbCustomModuleObjForAccountContactDeletion.pluralModuleName,r=I18n.getMsg("crm.cannot.delete.account.contact.singular",s.toLowerCase()),l=I18n.getMsg("crm.cannot.delete.account.contact.plural",c.toLowerCase()),d=a?r:l,m='<div onclick="sE()" class="w500 p20"><div class="floatL pL20 w430"><div class="f20"><h2 style="color:#E20000";>'+I18n.getMsg("crm.cannot.delete.account.contact.header",a?s:c)+'</h2></div><div class="mT10">'+d+'</div></div><br class="clearB"><div  class="alignright mT20"><input type="button" id="popupok" class="newgraybtn" value="'+I18n.getMsg("crm.button.ok")+"\" onclick=\"hide('popupnew');removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30\"></div></div>";renderingUtils.popUpWithFreeze(m)}else e.find("#delItemName").text(t),n?e.find("#showWarning2").css("display","").find("#noteMsg").text(I18n.getMsg(n)):e.find("#showWarning2").css("display","none"),showAnimatePopup("deletepopup"),setTimeout((function(){$("#deletepopup").find("#deleteButton")[0].focus()}),100),o&&renderingUtils.stopEvent(o)}))},ZInvoice.openZCRMAccountsLookupWindow=function(e,t){var n=$("#zBooksIframe")[0].contentWindow,o=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/Search.do?searchmodule="+e+"&isFrmZBModule=true&fldName=null&fldId=null&fldLabel=null&fldValue=&targetForm=null");"ContactsWithoutAccounts"==e&&(e="Contacts",o=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/Search.do?searchmodule="+e+"&isFrmZBModule=true&fldName=Crm_Contacts_NoAccount&fldId=null&fldLabel=null&fldValue=&targetForm=null")),ZBLookUpUtil.searchModuleName=e,ZBLookUpUtil.zbFromCRMURLType=t,"undefined"!=typeof Crm&&Crm.userDetails.isLookupAdvancedSearchEnabled?ZInvoice.openNewLookup(e):openPopUp("lookUpWin",n,o,"ZBModule",900,400,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes")},ZInvoice.openNewLookup=function(e,t){var n=document.getElementById("lookupModalDiv");if(null===n){var o=document.createElement("div");o.id="lookupModalDiv",document.body.appendChild(o),n=document.getElementById("lookupModalDiv")}var i={},a=[],s=networkUtils.returnDependencyFiles(["crm-entity-lookup.js"],crmConstants.jsStaticPathForLyte);s=s.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Lookup")],crmConstants.jsStaticPath)),Crm.userDetails.RTL_ENABLED&&(a=networkUtils.returnDependencyFiles(["crm-entity-lookup-rtl.css"],crmConstants.cssStaticPathForLyte));var c=s.concat(a);Lyte.injectResources(c,void 0,(function(){i.labelName="Crm_Contacts_ACCOUNTID",i.isFrmZBModule=!0,i.lookupModule=e,i.searchModule=e,i.parentModule=e,t&&(i.defaultCriteria=t),Crm.moduleName=e;var o=document.createElement("crm-entity-lookup");o.component.setData("reqData",{}),n.append(o),o.component.layersAnalystAgent(o.component,void 0,i,void 0,!0)}))},ZInvoice.openZCRMVendorsLookupWindow=function(e){var t=$("#zBooksIframe")[0].contentWindow;ZBLookUpUtil.searchModuleName="Vendors",ZBLookUpUtil.zbFromCRMURLType=e,"undefined"!=typeof Crm&&Crm.userDetails.isLookupAdvancedSearchEnabled?ZInvoice.openNewLookup(ZBLookUpUtil.searchModuleName):openPopUp("lookUpWin",t,Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/Search.do?searchmodule=Vendors&isFrmZBModule=true&fldName=null&fldId=null&fldLabel=null&fldValue=&targetForm=null"),"ZBModule",900,400,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes")},ZInvoice.openZCRMPotentialsLookupWindow=function(e,t){var n=$("#zBooksIframe")[0].contentWindow;if(e)var o=[{api_name:"Account_Name",comparator:"equals",value:e}];"undefined"!=typeof Crm&&Crm.userDetails.isLookupAdvancedSearchEnabled?ZInvoice.openNewLookup("Potentials",o):openPopUp("lookUpWin",n,Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/Search.do?searchmodule=Potentials&accountId="+e+"&contactId="+t+"&isFrmZBModule=true&fldName=null&fldId=null&fldLabel=null&fldValue=&targetForm=null"),"ZBModule",900,400,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes")},ZInvoice.getZCRMAllUsers=function(e){var t={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};return(new crmRequestPool).initiate({action:"/crm/v2/users?scope=crmapi&type=ActiveUsers",type:"GET",headers:t,success:function(t){$("#zBooksIframe")[0].contentWindow.InvoiceUtil.loadZCrmUsersListInSelect2(t,e)}})},ZInvoice.showBooksHistory=function(){$("#zbCMDetailsIframe")[0].contentWindow.InvoiceUtil.showCommentsHistory()};var ZBEntityJSConstants={ZBINVOICE:"CustomModule5001",ZBESTIMATE:"CustomModule5002",ZBSALESORDER:"CustomModule5004",ZBPURCHASEORDER:"CustomModule5003",INVOICE_EMAIL_GET:22,ESTIMATE_EMAIL_GET:24,SALESORDER_EMAIL_GET:26,PURCHASEORDER_EMAIL_GET:56,INVOICE_PDF:14,ESTIMATES_PDF:15,SALES_ORDER_PDF:21,PURCHASEORDER_PDF:55,INVOICE_DETAILS_PAGE:12,ESTIMATE_DETAILS_PAGE:13,SALESORDER_DETAILS_PAGE:20,PURCHASEORDER_DETAILS_PAGE:54,ZB_ESTIMATE_TO_SO:71,ZB_ESTIMATE_TO_INVOICE:72,ZB_SO_TO_INVOICE:73,ZB_SO_TO_PO:77,ZB_ESTIMATE_CLONE:74,ZB_INVOICE_CLONE:75,ZB_SO_CLONE:76,ZB_PO_CLONE:78};ZInvoice.emailZBCustommodule=function(e,t){ZInvoice.saveAndSend.customModule=e,ZInvoice.saveAndSend.entityID=t,ZInvoice.saveAndSend.loadDetails=!!ZInvoice.saveAndSend.isSaveAndSend;var n=ZBEntityJSConstants.INVOICE_EMAIL_GET;e===ZBEntityJSConstants.ZBESTIMATE?n=ZBEntityJSConstants.ESTIMATE_EMAIL_GET:e===ZBEntityJSConstants.ZBSALESORDER?n=ZBEntityJSConstants.SALESORDER_EMAIL_GET:e===ZBEntityJSConstants.ZBPURCHASEORDER&&(n=ZBEntityJSConstants.PURCHASEORDER_EMAIL_GET),ZInvoice.downloadZIJSForEntity("","","",n,"",t)},ZInvoice.zbCustommoduleExportAsPDF=function(e,t,n){var o=ZBEntityJSConstants.INVOICE_PDF;e===ZBEntityJSConstants.ZBESTIMATE?o=ZBEntityJSConstants.ESTIMATES_PDF:e===ZBEntityJSConstants.ZBSALESORDER?o=ZBEntityJSConstants.SALES_ORDER_PDF:e===ZBEntityJSConstants.ZBPURCHASEORDER&&(o=ZBEntityJSConstants.PURCHASEORDER_PDF),Utils.windowLocationHref(Crm.getCrmBasePath()+"/connectzb?entityType="+o+"&entityid="+t+"&entityNumber="+encodeURIComponent(n))},ZInvoice.zbCustommodulePrintPDF=function(e,t,n){var o=ZBEntityJSConstants.INVOICE_PDF;e===ZBEntityJSConstants.ZBESTIMATE?o=ZBEntityJSConstants.ESTIMATES_PDF:e===ZBEntityJSConstants.ZBSALESORDER?o=ZBEntityJSConstants.SALES_ORDER_PDF:e===ZBEntityJSConstants.ZBPURCHASEORDER&&(o=ZBEntityJSConstants.PURCHASEORDER_PDF);var i=Crm.getCrmBasePath()+"/connectzb?entityType="+o+"&entityid="+t+"&entityNumber="+encodeURIComponent(n)+"&print=true";networkUtils.openUrl(i,"_blank")},ZInvoice.contactZBAndLoadEntityDetails=function(e,t,n){if(ZInvoice.saveAndSend.isSaveAndSend)return ZInvoice.emailZBCustommodule(e,t),void(ZInvoice.saveAndSend.isSaveAndSend=!1);var o=$("#"+n),i=ZBEntityJSConstants.INVOICE_DETAILS_PAGE;e===ZBEntityJSConstants.ZBESTIMATE?i=ZBEntityJSConstants.ESTIMATE_DETAILS_PAGE:e===ZBEntityJSConstants.ZBSALESORDER?i=ZBEntityJSConstants.SALESORDER_DETAILS_PAGE:e===ZBEntityJSConstants.ZBPURCHASEORDER&&(i=ZBEntityJSConstants.PURCHASEORDER_DETAILS_PAGE);var a=Crm.getCrmBasePath()+"/connectzb?acceptJHTML=true&entityType="+i+"&entityid="+t;o.attr("src",a),$("#zb-loading-1").removeClass("hide"),o.addClass("zb-hide"),o.on("load",(function(){$("#zb-loading-1").addClass("hide"),$("#"+n).removeClass("zb-hide"),$("#zbCMDetailsIframe").contents().find("#detailsPage").css("padding","20px")}))},ZInvoice.showMessage=function(e){ZInvoice.showMessageBand(4,e)},ZInvoice.showZBCMAlert=function(){var e=document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop;freezeBackground(),$("#zbcm-modal").css({display:"block","z-index":"30",width:"580px",position:"absolute",left:"25%",top:e+110+"px"})},ZInvoice.moveToTop=function(){$("html,body").scrollTop(150)},ZInvoice.refreshpotentialEstInvRL=function(e){"1"===e.triggerType&&("Potentials"===e.module&&e.estimate_enabled&&e.estimate_view&&e.estimate_map&&"null"!==e.estimate_map&&""===e.estimate_map[0].crm_id&&ZInvoice.potentialEstRefreshCount<6?setTimeout((function(){ZInvoice.potentialEstRefreshCount++,$("#zinvoiceRef")[0].click()}),5e3):ZInvoice.potentialEstRefreshCount=1),"2"===e.triggerType&&("Potentials"===e.module&&e.invoice_enabled&&e.invoice_view&&e.invoice_map&&"null"!==e.invoice_map&&""===e.invoice_map[0].crm_id&&ZInvoice.potentialInvRefreshCount<6?setTimeout((function(){ZInvoice.potentialInvRefreshCount++,$("#zinvoiceRef")[0].click()}),5e3):ZInvoice.potentialInvRefreshCount=1)},ZInvoice.convertToSO=function(e,t,n){if("accepted"===e){var o={id:t,zbPKID:n,conversionCloneAction:ZBEntityJSConstants.ZB_ESTIMATE_TO_SO,from:"detailView"};Lyte.Router.transitionTo({route:"crm.tab.module.create",dynamicParams:[ZBEntityJSConstants.ZBSALESORDER]}).data=o}else ZInvoice.showMessageBand(2,I18n.getMsg("crm.books.custommodule.esttosoalert"))},ZInvoice.convertToInvoice=function(e,t,n){var o="";e===ZBEntityJSConstants.ZBESTIMATE?o=ZBEntityJSConstants.ZB_ESTIMATE_TO_INVOICE:e===ZBEntityJSConstants.ZBSALESORDER&&(o=ZBEntityJSConstants.ZB_SO_TO_INVOICE);var i={id:t,zbPKID:n,conversionCloneAction:o,from:"detailView"};Lyte.Router.transitionTo({route:"crm.tab.module.create",dynamicParams:[ZBEntityJSConstants.ZBINVOICE]}).data=i},ZInvoice.convertToPO=function(e,t){var n={id:e,zbPKID:t,conversionCloneAction:ZBEntityJSConstants.ZB_SO_TO_PO,from:"detailView"};Lyte.Router.transitionTo({route:"crm.tab.module.create",dynamicParams:[ZBEntityJSConstants.ZBPURCHASEORDER]}).data=n},ZInvoice.cloneZBTxns=function(e,t,n){var o=ZBEntityJSConstants.ZB_INVOICE_CLONE;e===ZBEntityJSConstants.ZBESTIMATE?o=ZBEntityJSConstants.ZB_ESTIMATE_CLONE:e===ZBEntityJSConstants.ZBSALESORDER?o=ZBEntityJSConstants.ZB_SO_CLONE:e===ZBEntityJSConstants.ZBPURCHASEORDER&&(o=ZBEntityJSConstants.ZB_PO_CLONE);var i={id:t,zbPKID:n,conversionCloneAction:o,from:"detailView"};Lyte.Router.transitionTo({route:"crm.tab.module.create",dynamicParams:[e]}).data=i},ZInvoice.optimizePageForEmberEmail=function(){$("#zbModalHdr").css("display","none"),$("#zBooksIframe").css({width:"100%",height:"1300px"}),$(".modal-body").css("padding","0 3px")},ZInvoice.trackShipment=function(e,t,n,o){var i="crm-zfinance-tracking",a=networkUtils.returnDependencyFiles([i+".js"],crmConstants.jsStaticPathForLyte),s=networkUtils.returnDependencyFiles([i+".css"],crmConstants.cssStaticPathForLyte);Lyte.injectResources(a.concat(s),void 0,(function(){$("#zFShipmentStatusPop").html(""),Lyte.Component.render(i,{packageId:e,carrier:t,trackNum:n,status:o},"#zFShipmentStatusPop")}))},ZInvoice.showHideZFRelatedDetails=function(e,t){var n=$("#"+t),o=$("#"+e),i=o.offset().top,a=o.offset().left;o.height();if("none"===n.css("display")){if(void 0!==ZInvoice.financeDetails.entityId&&null!==ZInvoice.financeDetails.entityId&&ZInvoice.financeDetails.isRefresh){var s='<div class="zfinance-load"><span class="crm-zinvoice-label f12 color_6">'+I18n.getMsg("crm.financesuite.fetching.data")+'...</span><div class="content-animated-line crm-zinvoice-anim"><div class="content-masker first-1"></div><div class="content-masker first-white"></div><div class="content-masker second-1"></div></div></div>',c=$("#zfReceivablesTable, #zfStockTable, #zfShipmentTable");c.children().hide(),c.append(s),ZInvoice.fetchInvoiceDetails(ZInvoice.financeDetails.entityId,ZInvoice.financeDetails.module),ZInvoice.financeDetails.isRefresh=!1}n.css("display","block");["zfStockTable","zfShipmentTable","zfReceivablesTable"].forEach((function(e){e!==t?$("#"+e).css("display","none"):1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&(Crm.userDetails.RTL_ENABLED?$("#"+e).css({top:i+20,position:"fixed",display:"block",left:a-80}):$("#"+e).css({top:i+20,position:"fixed",display:"block",left:a}))}))}else n.css("display","none")},ZInvoice.loadRL=function(e,t,n,o,i,a){var s,c="."+e+"_"+n;if("ZINVOICEPERSONALITY"==e)s="crm-zfinance-rl";else if("ZEXPENSEPERSONALITY"==e)s="crm-zexpense-rl";else{if("ZSUBSCRIPTIONSPERSONALITY"!=e)return;s="crm-subscription-rl"}$(c).length||($(s).parent()[0].setAttribute("id",e+"_"+n),c="#"+e+"_"+n);var r=networkUtils.returnDependencyFiles([s+".js"],crmConstants.jsStaticPathForLyte),l=networkUtils.returnDependencyFiles([s+".css"],crmConstants.cssStaticPathForLyte);Lyte.injectResources(r.concat(l),void 0,(function(){$(c).html(""),Lyte.Component.render(s,{module:t,entity_id:o,resp_data:i,is_initial:a},c)}))},ZInvoice.showSuccessErrorMsgInExpenseRL=function(e,t){ZInvoice.showMessageBand(t?4:1,e)},ZInvoice.handleZExpensePostMessage=function(e){if("zexpense"===e.data.zservice){if($("#externalIframe")[0].style.maxHeight="calc(100vh - 123px)",e.data.hasOwnProperty("height")&&ZInvoice.setZBDashboardIFrameHeight(e.data.height+"px","#externalIframe"),e.data.hasOwnProperty("module")){var t="Expense Reports"===e.data.module?"CustomModule5007":"CustomModule5006";$("#zohoExpenseTabLayer #tabActiveBarUl li").find("a").removeClass("activeLiList"),$("#"+t).addClass("activeLiList")}if(e.data.hasOwnProperty("action")&&"scrollToPosition"===e.data.action){var n=e.data.value;$("html,body").scrollTop(n)}}},ZInvoice.showAlertComponent=function(e){var t=document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop;freezeBackground(),$("#"+e).css({display:"block","z-index":"30",width:"500px",position:"absolute",left:"25%",top:t+110+"px"})},ZInvoice.cancelAlertComponent=function(e){removeFreezeLayer(),$("#"+e).css("display","none")},ZInvoice.setPotentialDataParams=function(e,t,n,o){"null"!==ZInvoice.potentialDetails.accountID&&"undefined"!==ZInvoice.potentialDetails.accountID||(ZInvoice.potentialDetails.accountID=""),"null"!==ZInvoice.potentialDetails.contactID&&"undefined"!==ZInvoice.potentialDetails.contactID||(ZInvoice.potentialDetails.contactID="");var i="CustomModule5006",a="expenses",s="potentialNewExpense";n&&(i="CustomModule5007",a="expensereports",s="potentialNewExpenseReport"),$("#"+s).attr("data-params",'{"webTab":true,"module":"'+i+'","zexpenseurl":"/switch?organization_id='+t+"&redirect_url=/app?from_zcrm=true#/"+a+"/new?potential_id="+e+"&zcrm_account_id="+ZInvoice.potentialDetails.accountID+"&zcrm_contact_id="+ZInvoice.potentialDetails.contactID+"&potential_name="+encodeURIComponent(ZInvoice.potentialDetails.potentialName)+'"}'),$(o).attr("lt-prop-td",'{"webTab":true,"module":"'+i+'","zexpenseurl":"/switch?organization_id='+t+"&redirect_url=/app?from_zcrm=true#/"+a+"/new?potential_id="+e+"&zcrm_account_id="+ZInvoice.potentialDetails.accountID+"&zcrm_contact_id="+ZInvoice.potentialDetails.contactID+"&potential_name="+encodeURIComponent(ZInvoice.potentialDetails.potentialName)+'"}')},ZInvoice.setAccountContactDataParams=function(e,t,n,o,i){if("null"!==ZInvoice.contactDetails.accountID&&"undefined"!==ZInvoice.contactDetails.accountID||(ZInvoice.contactDetails.accountID=""),n){var a='{"webTab":true,"module":"CustomModule5006","zexpenseurl":"/switch?organization_id='+o+"&redirect_url=/app?from_zcrm=true#/expenses/new?zcrm_account_id=";a+="Accounts"===t?e:ZInvoice.contactDetails.accountID+"&zcrm_contact_id="+e,$("#accountContactNewExpense").attr("data-params",a+"&module="+t+'"}'),$(i).attr("lt-prop-td",a+"&module="+t+'"}')}else{var s='{"webTab":true,"module":"CustomModule5007","zexpenseurl":"/switch?organization_id='+o+"&redirect_url=/app?from_zcrm=true#/expensereports/new?zcrm_account_id=";s+="Accounts"===t?e:ZInvoice.contactDetails.accountID+"&zcrm_contact_id="+e,$("#accountContactNewExpenseReport").attr("data-params",s+"&module="+t+'"}'),$(i).attr("lt-prop-td",s+"&module="+t+'"}')}},ZInvoice.fetchZSubscriptionsHTMLforModal=function(e,t,n,o,i,a,s){var c=$("#zbModalHdr"),r=$("#zbModalContent"),l=$("#zBooksIframe"),d=Crm.getCrmBasePath()+"/connectzs?crmModule="+t+"&crmEntityID="+e+"&formatType=jhtml&actionNumber="+o;c.show(),l.css("width","993px"),r.removeClass("modal-medium").addClass("modal-large"),void 0!==a&&(s&&(c.hide(),l.css("width","830px"),r.removeClass("modal-large").addClass("modal-medium")),d=d+"&zsEntityID="+a),d=ZInvoice.setupDevelopmentURL(d),$("#zBooksTitleDIV").empty(),getElemById("zBooksTitleDIV").innerHTML=i,l[0].src=d,$("#loadingDiv").html(I18n.getMsg("loading")),freezeBackground(),mailsetCenter("loadingDiv"),l.on("load",(function(){removeFreezeLayer(),$("#loadingDiv").hide(),crmui.showPopup("zb-Modal"),$("html").addClass("hide-scroll")}))};