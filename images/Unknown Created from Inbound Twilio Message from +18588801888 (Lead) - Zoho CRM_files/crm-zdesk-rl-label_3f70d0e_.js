Lyte.Component.register("crm-zdesk-rl-label",{_template:'<template tag-name="crm-zdesk-rl-label"> <table width="100%" cellspacing="0" cellpadding="0" class="relCenterBg"> <tbody> <tr height="25"> <td> <span name="supportpersonality_{{related_list_id}}" id="supportpersonality_{{related_list_id}}" class="relListHead">{{display_label}}</span> <template is="if" value="{{expHandlers(expHandlers(type,\'==\',&quot;CANVAS&quot;),\'&amp;&amp;\',expHandlers(rlCount,\'!==\',&quot;0&quot;))}}"><template case="true"> <span class="zdeskRLCount" data-zcqa="zDRLCount">{{rlCount}}</span> </template></template> <div class="dIB pL10"> <template is="if" value="{{refreshIconShow}}"><template case="true"> <div class="{{if(refreshIconLoadingShow,\' tb_small_loader vmiddle ref_loading\',\' tb_small_loader vmiddle ref_complete\')}}{{if(refreshIconDisable,\' op05 eventNone\',\'\')}}" id="deskRefresh" onclick="{{action(\'reload\')}}"> <span class="ld_init"></span> <span class="ld_process"></span> </div> </template></template> </div> </td> </tr> </tbody> </table> </template>',_dynamicNodes:[{type:"attr",position:[1,1,1,1,1]},{type:"text",position:[1,1,1,1,1,0]},{type:"attr",position:[1,1,1,1,3]},{type:"if",position:[1,1,1,1,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[1,1,1,1,5,1]},{type:"if",position:[1,1,1,1,5,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}}],_observedAttributes:["module","entity_id","related_list_id","display_label","refreshIconLoadingShow","refreshIconDisable","refreshIconShow","rlCount","type"],data:function(){return{module:Lyte.attr("string"),entity_id:Lyte.attr("string"),related_list_id:Lyte.attr("string"),display_label:Lyte.attr("string"),refreshIconLoadingShow:Lyte.attr("boolean",{default:!1}),refreshIconDisable:Lyte.attr("boolean",{default:!1}),refreshIconShow:Lyte.attr("boolean",{default:!1}),rlCount:Lyte.attr("string",{default:"0"}),type:Lyte.attr("string")}},actions:{reload:function(){var t=document.querySelector("crm-zdesk-rl-body").component,e=this,a=t.getData("module"),i=t.getData("entityId"),s=t.getData("datePattern");if(Crm.trackSpotLightAction("ZDesk - Ticket Refresh"),s){this.setData("refreshIconLoadingShow",!0);var o=t.getCurrentTicketType(a),r={pageToken:0,ticketType:o,module:a,moduleId:i,deskstats:!0,action:"refreshData"},l=t.getKeyValueForTicketCriteria();validationUtils.isEmpty(l)?this.setData("refreshIconLoadingShow",!1):(r[l.key]=l.value,store.createRecord("dummy"),commonUtils.showHideLoadingDiv(!0),store.create("dummy",void 0,{url:t.getData("url_desk"),method:"POST"},r).then((function(a){var i=a.dummy;if(validationUtils.isNotEmpty(i)){t.actions.clearSelect.call(t),t.initializeData(),t.updateDetailsForRL(i.SupportObj);var s=t.getData("ticketsStatsLinkShow"),r=t.getData("deskTicketsSummaryShow"),l=t.getData("ticketStatsLinkText"),n=t.getData("totalTickets");if(i.hasOwnProperty("ticketPotentials")&&t.setData("ticketPotentials",i.ticketPotentials),i.hasOwnProperty("ticketStats")&&null!==i.ticketStats)if("Products"===t.getData("module")){var d=i.ticketStats.encryptedProductId;t.setData("desk_encryptedProductId",d)}else t.setData("ticketStats",i.ticketStats),t.summarizeTickets(i,!0,r,n,s,l);commonUtils.showHideLoadingDiv(),t.setData("data",i.tickets),t.setData("ticketKeys",i.ticketKeys),t.setData("ticketHeadings",i.ticketHeadings),t.setData("ticketFields",i.ticketFields),null!==document.querySelector("#ticketFilterSelect")&&document.querySelector("#ticketFilterSelect").ltProp("selected",o),t.setData("rowCountVis",i.tickets?i.tickets.length:0),i.hasOwnProperty("page")&&t.executeMethod("setLyteNavigatorValues",i)}commonUtils.showHideLoadingDiv(),e.setData("refreshIconDisable",!0),e.setData("refreshIconLoadingShow",!1)})))}}},methods:{}});
