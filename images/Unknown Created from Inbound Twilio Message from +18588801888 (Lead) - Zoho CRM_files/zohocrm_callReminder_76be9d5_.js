var CallReminder={cti_obj:{},get:CTIAPI.get,put:CTIAPI.put,remove:CTIAPI.remove,has:CTIAPI.has,keys:CTIAPI.keys,set obj(e){for(var i in e)this.put(i,e[i])},handleCustomMessage:function(e){var i=e;if("laterReminder"===i.action){if(!0!==CallReminder.get("laterBtClickThisWindow")){var t=i.activityid,a=ctiapiRem_dataparam["dataparam_"+t];void 0!==a&&appendReminder(a,$("#later_"+t),!0)}CallReminder.put("laterBtClickThisWindow",!1)}else if("cancelReminder"===i.action){t=i.activityid;closeReminder($("#endcall_"+t)),0===reminderDatatemp.reminders.availableReminders?$("#ctireminder").slideUp(500,(function(){$(this).hide()})):updateReminderHead()}},later:function(e,i){if(i){CallReminder.put("laterBtClickThisWindow",!0);var t=Crm.getCrmBasePath()+"/CtiApiConfig.do",a={mode:"laterReminder",activityid:e+""};networkUtils.setCsrfParam(a),(new crmRequestPool).initiate({type:"POST",url:t,data:a})}},call:function(e){if(void 0!==ctiapiRem_dataparam["dataparam_"+e]){var i=ctiapiRem_dataparam["dataparam_"+e].call_description;i=validationUtils.isNotEmpty(i)?i:"",$("#ctiapi_calldesc").val(i),CTIAPI.LocalStorage.put("call_desc",i),removeReminder(e),closeReminder($("#later_"+e)),closeMultipleReminderBussinesscardView(),$(".reminderslist div[ctiapi-data-params=dataparam_"+e+"]").remove()}},cancel:function(e,i){if(i){var t=Crm.getCrmBasePath()+"/CtiApiConfig.do",a={mode:"cancelReminder",activityid:e+""};networkUtils.setCsrfParam(a),(new crmRequestPool).initiate({type:"POST",url:t,data:a})}},getEntityImgSrc:function(e){var i=e.entitymodule,t=e.entityid,a=e.photofileid,r=networkUtils.getImageUrl("user_d522435_.jpg",ResourceConstants.CRM);return i!==moduleRecordMapping.Accounts.plural_label&&validationUtils.isNotEmpty(a)&&(r=Crm.getCrmBasePath()+"/EntityImageAttach.do?action_module="+i+"&entityId="+t+"&actionName=readImage&fileId="+a),r},ctiapi_showReminderClick2CallPhnos:function(e,i,t){var a=validationUtils.isNotEmpty(t)?$("#"+t):$(e).closest("#businessView"),r=a.height(),n=a.offset().top,s=renderingUtils.windowHeight,l=$(a).find("#entityPhnoDiv_"+i),d=l.innerHeight();if(l.toggle(),s>r+n+d)a.hasClass("bot150")?l.css("top",r+2*$(e).height()-59):l.css("top",r+2*$(e).height()-9);else if(validationUtils.isNotEmpty(t))l.css("top",r-2*$(e).height()-d+2);else{$(e).closest("#ctireminder").length>0?l.css("top",r-d-$(e).innerHeight()/2+10):l.css("top",r-d+8)}},scrollReminderBody:function(){var e=$("#ctiapi_multireminder_bussinessview_arrow"),i=$(".reminderusers.selectedReminderUser");if(i.length>0){var t=e.attr("selectedreminderoldposition");t=NaN!==parseInt(t)?parseInt(t):0;var a=i.position().top;t-34<=a&&a<=t+34||i.click()}},deleteReminder:function(e){var i=reminderDatatemp.reminders.reminderIdNameMap[e];reminderDatatemp.reminders.availableReminders>0&&(reminderDatatemp.reminders.availableReminders=reminderDatatemp.reminders.availableReminders-1),reminderDatatemp.reminders.deleteRemindersList.push(i),ctiapiSche.deleteReminderId(e)},getSelectedReminder:function(e){var i=$(e),t=i.position().top,a=$("#ctiapi_multireminder_bussinessview"),r=$(".remindercallList.reminderslist");if(t<0){var n=r.scrollTop()+t;r.scrollTop(n),t=0}else if(t>270){var s=335-t,l=i.innerHeight()-s;n=r.scrollTop()+l;r.scrollTop(n),t=270}if(t<=68?$(".remindercallList").find(".reminderusers").length<=3?a.removeClass("bot150"):a.addClass("bot150"):t>68&&t<126?a.addClass("bot150"):a.removeClass("bot150"),i.hasClass("chooseOwnerHov"))closeMultipleReminderBussinesscardView();else{var d=ctiapiRem_dataparam[i.attr("ctiapi-data-params")],o=d.zgid,c=d.userid,m=d.phone,p=d.entityid,h=d.entitymodule,v=d.recordEntityName,u=d.reminderClick2CallPhoneNos,g=d.reminderPhno;d.lower_reminder=!0;var f=d.callactivityid+"",R=getremindertime([f]),b=validationUtils.isNotEmpty(setMoreLater(R,!1))?setMoreLater(R,!1):setMoreLater(0,!1),I=validationUtils.isNotEmpty(setMoreLater(R,!0))?setMoreLater(R,!0):setMoreLater(0,!0),y=R<-6e4?"color:#dc5a5a":"color:#66bb33",C="";for(var w in $("#tof_"+f).html(b).attr("title",I).css(y),$(".reminderTime_Msg_"+f).html(I).css(y),Crm.userDetails.RTL_ENABLED?C+='<div style="left : -9px; bottom: 80px;" class="iconrightArw" id="ctiapi_multireminder_bussinessview_arrow"></div>':C+='<div style="right: -9px; bottom: 80px;" class="iconrightArw" id="ctiapi_multireminder_bussinessview_arrow"></div>',C+='<div class="font22 p10 pL15 pR15 reminderTime_Msg_'+f+'" style="'+y+'">'+I+"</div>",C+=Handlebars.templates.ctiapi_reminder_businesscard(d),C+='<div class="newPopup zI100" id="entityPhnoDiv_'+f+'" style="display: none;margin-left: 10px" onclick="sE(event);">',C+='<div class="pR">',C+='<div class="multipleNos">',C+='<table cellpadding="5" cellspacing="0" border="0"><tbody>',u){var M=u[w];validationUtils.isNotEmpty(M)&&(C+="<tr onmouseover=\"$(this).addClass('trhover')\" onmouseout=\"$(this).removeClass('trhover')\" class='pointer' onclick=\"ctiApiNotifier.click2Call('"+$ESAPI.encoder().encodeForJavaScript(M)+"','"+o+"','"+c+"','"+p+"','"+f+"','"+h+"','"+$ESAPI.encoder().encodeForJavaScript(v)+"');closeReminder(this);\">",C+='<td class="color_79 pL20">'+CTIAPI.encodeForHTMLWithoutNull(I18n.getMsg(w))+" </td>",C+='<td class="color1 pR20">'+CTIAPI.encodeForHTMLWithoutNull(M)+"</td>",C+="</tr>")}C+="</tbody></table>",C+="</div>",C+="</div>",C+="</div>",C+='<div class="bT p15 oH">',!0===CallReminder.get("outgoingEnable")&&parseInt(d.timeOfReminder)<=6e4&&(g.length<=1?(C+='<a class="greenFlatBtn dIB fL greenbgtbn norBtn singleReminderCallBt_'+f+'" style="height:auto" >',C+="<span class='fL' onclick=\"ctiApiNotifier.click2Call('"+$ESAPI.encoder().encodeForJavaScript(m)+"','"+o+"','"+c+"','"+p+"','"+f+"','"+h+"','"+$ESAPI.encoder().encodeForJavaScript(v)+"');\" >"+I18n.getMsg("Call")+"</span> ",C+="</a>"):(C+='<a class="greenFlatBtn dIB fL greenbgtbn norBtn singleReminderCallBt_'+f+'" style="height:auto" onclick="CallReminder.ctiapi_showReminderClick2CallPhnos(this,\''+f+"','ctiapi_multireminder_bussinessview');sE(event);\">",C+='<span class="fL">'+I18n.getMsg("Call")+"</span> ",C+='<i class="whtdownArw fL"></i>',C+="</a>")),C+='<span  class="actselVal oH ellipsistext fR ctiRemClose"><span class="actVal" id="endcall" onclick="closeMultipleReminderBussinesscardView();">'+I18n.getMsg("crm.button.mass.hide")+"</span>",C+='<span class="actSelArw" data-zcqa="callMoreOption" id="arrow_'+f+"\" onclick=\"Crm.scheduledCallMoreOption(this, 'homePage','"+c+'\');sE1(event);"><span class="dIB actArwNew"></span></span></span>',C+="</div>";var _=$(".remindercallList").innerHeight()-t,S=i.innerHeight()/2;a.html(C).show(),$(".chooseOwner").removeClass("chooseOwnerHov selectedReminderUser"),i.addClass("chooseOwnerHov selectedReminderUser"),a.hasClass("bot150")?$("#ctiapi_multireminder_bussinessview_arrow").css("bottom",_+S-201).attr("selectedreminderoldposition",t).show():$("#ctiapi_multireminder_bussinessview_arrow").css("bottom",_+S-75).attr("selectedreminderoldposition",t).show()}}};Object.freeze(CallReminder);var ctiapiRem_dataparam={getTime:function(e){if(void 0!==e&&""!==e){var i=this["dataparam_"+e];return parseInt(i.timeOfReminder)+parseInt(i.date)}}},reminderDatatemp={reminders:{availableReminders:0,noOfReminders:0,timesOfReminders:[],deleteRemindersList:[],deletedRemindersIDList:[],reminderIdNameMap:{}},removeReminder:function(e){var i=reminderDatatemp.reminders.reminderIdNameMap[e];reminderDatatemp.reminders.availableReminders>0&&void 0!==i&&(reminderDatatemp.reminders.availableReminders=reminderDatatemp.reminders.availableReminders-1,reminderDatatemp.reminders.deletedRemindersIDList.push(e+""),reminderDatatemp.reminders.deleteRemindersList.push(i),delete reminderDatatemp.reminders.reminderIdNameMap[e],ctiapiSche.deleteReminderId(e)),0===reminderDatatemp.reminders.availableReminders?$("#ctireminder").slideUp(500,(function(){$(this).hide()})):$("#reminderbody").is(":hidden")||$("#ICPOP1 #reminderTitle").click(),updateReminderHead()}},ctiapiSche={reminderIds:{},timeInterval:6e4,serverTimeInterval:9e5,clientScheId:null,serverScheId:null,clientScheLastRunTime:null,serverScheLastRunTime:null,clientScheStartTime:null,serverScheStartTime:null,scheStartDelaySec:0,start:function(e){var i=new Date;if(this.scheStartDelaySec=60-i.getSeconds(),this.scheStartDelaySec<2||this.scheStartDelaySec>58)null===this.clientScheId&&Object.keys(this.reminderIds).length>0?((e=e||updateRemindersTime)(),this.clientScheId=setInterval(e,this.timeInterval),this.clientScheStartTime=i,this.serverScheId=setInterval((function(){updateRemindersTimesFromServer(Object.keys(ctiapiSche.reminderIds))}),this.serverTimeInterval),this.serverScheStartTime=i,this.scheStartDelaySec=0):this.stop()&&Object.keys(this.reminderIds).length>0&&this.start();else{var t=this.scheStartDelaySec||0;setTimeout((function(){ctiapiSche.start(e)}),1e3*t)}},stop:function(){return null!==this.clientScheId&&(clearInterval(this.clientScheId),clearInterval(this.serverScheId),this.serverScheId=null,this.clientScheId=null,!0)},deleteReminderId:function(e){delete this.reminderIds[e+""],0===Object.keys(this.reminderIds).length&&this.stop()},appendReminderId:function(e){this.reminderIds[e+""]=e+"",null===this.clientScheId&&this.start(updateRemindersTime)},log:function(){var e={client:this.clientScheId,server:this.serverScheId},i={client:this.clientScheStartTime+"",server:this.serverScheStartTime+""},t={client:this.clientScheLastRunTime+"",server:this.serverScheLastRunTime+""},a="reminderIds : "+Object.keys(this.reminderIds)+" \n scheStartDelaySec : "+this.scheStartDelaySec+" \n ";return a+="scheId : "+JSON.stringify(e)+"\n ",a+="startTime : "+JSON.stringify(i)+"\n ",a+="lastRunTime : "+JSON.stringify(t)}};function closeMultipleReminderBussinesscardView(){$(".chooseOwner").removeClass("chooseOwnerHov selectedReminderUser"),$("#ctiapi_multireminder_bussinessview_arrow").hide(),$("#ctiapi_multireminder_bussinessview").hide()}function createReminder1(e,i){var t="",a="",r=e,n=r.zgid,s=r.userid,l=r.entityid,d=r.entitymodule,o=r.recordEntityName,c=r.callactivityid+"",m=r.reminderClick2CallPhoneNos;CallReminder.put("outgoingEnable",r.outgoingenabled);var p=new Array;for(var h in m){var v=m[h];validationUtils.isNotEmpty(v)&&p.push(v)}r.reminderPhno=p,ctiapiRem_dataparam["dataparam_"+c]=r,ctiapiSche.appendReminderId(c);var u=getremindertime(c),g=u<-6e4?"color:#dc5a5a":"color:#66bb33",f=validationUtils.isNotEmpty(setMoreLater(u,!0))?setMoreLater(u,!0):setMoreLater(0,!0);i?(t+='<div class="singlereminder " id="ICPOP2" style=" position:absolute;margin:0 auto;z-index:25;top:24%;left:42%">',a+='<div class="chatPopTitle oH"> ',a+='<table cellspacing="0" cellpadding="0" border="0" width="100%" class="pT10 pB10" style="height:auto">',a+="<tr>",a+='<td class="aligncenter font22">',a+='<span class="reminderTime_Msg_'+c+'" style="'+g+'">'+f+"</span>",a+="</td>",a+="</tr>",a+="</table>",t+=a+="</div>",t+='<div id="businessView" class="chatContainer">',r.lower_reminder=!1):(t+='<div id="ICPOP2" style="z-index:25;width:370px;">',t+='<div class="chatPopTitle oH" onclick="toggleSingleReminder(\''+c+"')\">",t+='<div class="pT10 pB10 oH">',t+='<i class="icon_remind"></i><span id="callTitleSpan" class="pL10 fL f14">'+I18n.getMsg("crm.tpi.ctiapi.label.notification.callreminderwithoutarg")+' <span class="bg_notify font13 mL5">1</span></span>',t+="</div>",t+="</div>",t+='<div id="businessView" class="chatContainer">',t+='<div class="font22 p10 pL15 pR15 reminderTime_Msg_'+c+'" style="'+g+'">'+f+"</div>",r.lower_reminder=!0),t+=Handlebars.templates.ctiapi_reminder_businesscard(r);c=r.callactivityid+"";t+='<div class="bT p15"><div class="dIB w100per">';e.protocolDetails&&e.protocolDetails.ctiprotocolvalue;for(var h in!0===CallReminder.get("outgoingEnable")&&parseInt(r.timeOfReminder)<=6e4&&p.length>0?(1===p.length?(t+='<a class="greenFlatBtn dIB fL greenbgtbn norBtn singleReminderCallBt_'+c+'" style="height:auto" >',t+="<span class='fL' onclick=\"ctiApiNotifier.click2Call('"+$ESAPI.encoder().encodeForJavaScript(p[0])+"','"+n+"','"+s+"','"+l+"','"+c+"','"+d+"','"+$ESAPI.encoder().encodeForJavaScript(o)+"');closeReminder(this);\" >"+I18n.getMsg("Call")+"</span> ",t+="</a>"):(t+='<a class="greenFlatBtn dIB fL greenbgtbn norBtn singleReminderCallBt_'+c+'" style="height:auto" onclick="CallReminder.ctiapi_showReminderClick2CallPhnos(this,\''+c+"');sE(event);\">",t+='<span class="fL" >'+I18n.getMsg("Call")+"</span> ",t+='<i class="whtdownArw fL"></i>',t+="</a>"),t+='<input type="button" id="later_'+c+'" hide="false" value="'+I18n.getMsg("crm.tpi.ctiapi.button.label.notification.later")+'" class="newgraybtn mL5 btnTransfer norBtn" onclick="appendReminder(ctiapiRem_dataparam.dataparam_'+c+",this,"+i+");CallReminder.later('"+c+"',true);\">",t+='<span  class="actselVal oH ellipsistext fR ctiRemClose"><span class="actVal" id="endcall_'+c+'" onclick="closeReminder(this);CallReminder.deleteReminder(\''+c+"');CallReminder.cancel('"+c+"','true');\">"+I18n.getMsg("crm.button.close")+"</span>",t+='<span class="actSelArw" data-zcqa="callMoreOption" id="endcall_'+c+"\" onclick=\"Crm.scheduledCallMoreOption(this, 'homePage','"+s+'\');sE1(event);"><span class="dIB actArwNew"></span></span></span>'):window.ZPB&&ZPB.clickToDial&&ZPB.clickToDial.isEnabled()?(1===p.length?(t+='<a class="greenFlatBtn dIB fL greenbgtbn norBtn singleReminderCallBt_'+c+'" style="height:auto" >',t+="<span class='fL' onclick='crmCallsNew.initiateCallViaZPB(\""+p[0]+'","'+l+'","'+d+'","'+$ESAPI.encoder().encodeForJavaScript(o)+'","'+c+"\");closeReminder(this);' >"+I18n.getMsg("Call")+"</span>",t+="</a>"):(t+='<a class="greenFlatBtn dIB fL greenbgtbn norBtn singleReminderCallBt_'+c+'" style="height:auto" onclick="CallReminder.ctiapi_showReminderClick2CallPhnos(this,\''+c+"');sE(event);\">",t+='<span class="fL" >'+I18n.getMsg("Call")+"</span> ",t+='<i class="whtdownArw fL"></i>',t+="</a>"),t+='<input type="button" id="later_'+c+'" hide="false" value="'+I18n.getMsg("crm.tpi.ctiapi.button.label.notification.later")+'" class="newgraybtn mL5 btnTransfer norBtn" onclick="appendReminder(ctiapiRem_dataparam.dataparam_'+c+",this,"+i+");CallReminder.later('"+c+"',true);\">",t+='<span  class="actselVal oH ellipsistext fR ctiRemClose"><span class="actVal" id="endcall_'+c+'" onclick="closeReminder(this);CallReminder.deleteReminder(\''+c+"');CallReminder.cancel('"+c+"','true');\">"+I18n.getMsg("crm.button.close")+"</span>",t+='<span class="actSelArw" data-zcqa="callMoreOption" id="endcall_'+c+"\" onclick=\"Crm.scheduledCallMoreOption(this, 'homePage','"+s+'\');sE1(event);"><span class="dIB actArwNew"></span></span></span>'):(t+="</a><span  id='later_"+c+"' hide='false' data-zcqa='callMoreOption' class='fL mL5 remselVal oH ellipsistext blueNewBtn btnTransfer primarybtn' onclick=\"Crm.scheduledCallMoreOption(this, 'homePage','"+s+"');sE1(event);\"><span class='remval'>"+I18n.getMsg("crm.label.mark.completed")+"</span>  <span class='remSelArw'> <span class='dIB remArwNew'></span>  </span>     </span>",t+='<input type="button" value='+I18n.getMsg("crm.button.close")+' class="newgraybtn mL5 pointer fR norBtn" id="endcall_'+c+'" onclick="closeReminder(this);CallReminder.deleteReminder(\''+c+"');CallReminder.cancel('"+c+"','true');\">"),t+='<input type="hidden" id="singleReminderId" value="'+c+'"/>',t+="</div></div>",t+='<div class="newPopup zI100" id="entityPhnoDiv_'+c+'" style="display: none;margin-left: 10px" onclick="sE(event);">',t+='<div class="pR">',t+='<div class="multipleNos">',t+='<table cellpadding="5" cellspacing="0" border="0">',m){v=m[h];validationUtils.isNotEmpty(v)&&(!0===CallReminder.get("outgoingEnable")?t+="<tr onmouseover=\"$(this).addClass('trhover')\" onmouseout=\"$(this).removeClass('trhover')\" class='pointer' onclick=\"ctiApiNotifier.click2Call('"+$ESAPI.encoder().encodeForJavaScript(v)+"','"+n+"','"+s+"','"+l+"','"+c+"','"+d+"','"+$ESAPI.encoder().encodeForJavaScript(o)+"');closeReminder(this);\">":window.ZPB&&ZPB.clickToDial&&ZPB.clickToDial.isEnabled()&&(t+="<tr onmouseover=\"$(this).addClass('trhover')\" onmouseout=\"$(this).removeClass('trhover')\" class='pointer' onclick='crmCallsNew.initiateCallViaZPB(\""+v+'","'+l+'","'+d+'","'+$ESAPI.encoder().encodeForJavaScript(o)+'","'+c+"\");closeReminder(this);'>"),t+='<td class="color_79 pL20">'+CTIAPI.encodeForHTMLWithoutNull(I18n.getMsg(h))+" </td>",t+='<td class="color1 pR20">'+CTIAPI.encodeForHTMLWithoutNull(v)+"</td>",t+="</tr>")}if(t+="</table>",t+="</div>",t+="</div>",t+="</div>",t+="</div>",t+="<div>",t+='<div class="cont greenn" id="reminderdetails" style="position: absolute; left: -325px; top: -90px; display: block;"></div>',i){var R=$("body");R.append(t),1===$(".singlereminder").length&&($(".ctiapiReminderFreezeLayer").remove(),R.append('<div class="ctiapiFreezeLayer ctiapiReminderFreezeLayer"></div>'),$("#ctireminder").addClass("noboxShadow"),$(".lookFieldSrcWrap").hide(),Crm.menu.globalHideMenu()),callRemCenter("singlereminder")}else $("#ctireminder").html(t).show(),toggleSingleReminder(c),closeReminder($(".singlereminder #later_"+c).get(0));$(window).scrollTop("ICPOP2"),multiReminderShowHide()}function callRemCenter(e){var i=document.documentElement.scrollTop||document.body.scrollTop,t=document.documentElement.scrollLeft||document.body.scrollLeft,a=renderingUtils.windowHeight,r=$("."+e),n=r.height(),s=r.width(),l=r.length,d=$("#setWidthForCallRemDesc"),o=d.width();if(a>n)$(r[l-1]).css({display:"block",position:"absolute",left:"50%",top:"50%","margin-left":-s/2+t,"margin-top":-n/2+i});else{var c=i+10;$(r[l-1]).css({display:"block",position:"absolute",left:"50%",top:c,"margin-left":-s/2+t,"margin-top":"0px"})}o<s&&d.css({width:s/2+40})}function multiReminderShowHide(){var e=$(".singlereminder");e.hide(),$(e[e.length-1]).show(),$(".totalsinglereminder").html(" ("+e.length+")")}function removeReminder(e){reminderDatatemp.removeReminder(e)}function closeReminder(e){var i=null;e?0===(i=$(e).closest(".singlereminder")).length&&(i=$(e).closest("#ICPOP2")):i=$("#ICPOP2"),i.slideUp(100,(function(){multiReminderShowHide()})),i.remove(),0===$(".singlereminder").length&&($(".ctiapiReminderFreezeLayer").hide(),$("#ctireminder").removeClass("noboxShadow"))}function appendReminder(e,i,t){var a=e,r=reminderDatatemp.reminders.noOfReminders,n=reminderDatatemp.reminders;if(t&&void 0===n.reminderIdNameMap[a.callactivityid+""]&&-1===n.deletedRemindersIDList.indexOf(a.callactivityid+"")){r=reminderDatatemp.reminders.noOfReminders=r+1,reminderDatatemp.reminders.availableReminders=reminderDatatemp.reminders.availableReminders+1;var s={remindername:"reminder"+r,time:a.timeOfReminder};reminderDatatemp.reminders.timesOfReminders.push(s),reminderDatatemp.reminders.reminderIdNameMap[a.callactivityid+""]="reminder"+r,reminderDatatemp.reminders["reminder"+r]=a}1===reminderDatatemp.reminders.availableReminders?createReminder1(a,!1):(createReminder(reminderDatatemp),closeReminder(i))}function createReminder(e){var i="";i+='<div class="cont greenn" id="reminderdetails" style="position: absolute; left: -305px; top: -90px; display: block;"></div>',i+='<div id="ICPOP1" class="content" style="width:370px;">',i+=getReminderHead(e),i+=getReminderBody(e),i+="<div>",$("#ctireminder").html(i);var t=$(".reminderusers").length,a=t>1?" ("+t+")":"";$("#reminderTitleSpan").html(I18n.getMsg("crm.tpi.ctiapi.label.notification.callreminder",a)),toggleReminder(!0),toggleSingleReminder("","false")}function getReminderHead(e){var i="",t=e.reminders.availableReminders>1?e.reminders.availableReminders:"1";return i+='<div class="chatPopTitle oH" onclick="toggleReminder();">',i+='<div class="pT10 pB10 oH">',i+='<i class="icon_remind"></i><span id="callTitleSpan" class="pL10 fL f14">'+I18n.getMsg("crm.tpi.ctiapi.label.notification.callreminderwithoutarg")+' <span class="bg_notify font13 mL5" id="reminder_count">'+t+"</span></span>",i+="</div>",i+="</div>"}function updateReminderHead(){var e=reminderDatatemp.reminders.availableReminders>0?reminderDatatemp.reminders.availableReminders:"";$("#reminder_count").html(e)}function toggleSingleReminder(e,i){var t=$("#later_"+e),a=i||t.attr("hide"),r=$(".remainder-notifi"),n=$("#reminderbody").css("display");if(r.is(":visible")){var s=r.width();$("#ctireminder").css({"z-index":"26",right:s})}else $("#ctireminder").css({"z-index":"26",right:"0px"});if("false"===a)$("#ctireminder #businessView").slideUp().hide(1e3),t.attr("hide","true");else if("true"===a){$("#ctireminder #businessView").slideDown(),t.attr("hide","false");var l=new Array;l.push($("#singleReminderId").val());var d=getremindertimes(l);if(typeof d!=={}){var o=d[l[0]],c=validationUtils.isNotEmpty(setMoreLater(o,!0))?setMoreLater(o,!0):setMoreLater(0,!0),m=getremindertime(l[0])<-6e4?{color:"#dc5a5a"}:{color:"#66bb33"};$("#reminderTimeSpan_"+l[0]).html(c).attr("time",o),$(".reminderTime_Msg_"+l[0]).html(c).css(m);var p=ctiapiRem_dataparam["dataparam_"+l[0]],h=$("#twistatusimg");if(((void 0===h||h.is(":hidden"))&&!0===p.outgoingenabled||void 0!==h&&"1"===h.attr("statusvalue"))&&parseInt(o)<=6e4){var v=p.zgid+"",u=p.userid+"",g=p.phone+"",f=p.callactivityid+"",R=p.entityid+"",b=p.entitymodule,I=p.reminderPhno,y=p.recordEntityName,C='<span class="fL" >'+I18n.getMsg("Call")+"</span></i>";I.length<=1?C='<span class="fL" onclick=\'ctiApiNotifier.click2Call("'+$ESAPI.encoder().encodeForJavaScript(g)+'","'+v+'","'+u+'","'+R+'","'+f+'","'+b+'","'+$ESAPI.encoder().encodeForJavaScript(y)+"\");' >"+I18n.getMsg("Call")+"</span> ":(C='<span class="fL" >'+I18n.getMsg("Call")+"</span> ",C+='<i class="whtdownArw fL"></i>');var w=".singleReminderCallBt_"+l[0];$(w).html(C),$(w).parent().find(".btnTransfer").addClass("ctireminderBtnTransfer")}}}else toggleSingleReminder("","none"===n?"true":"false")}function toggleReminder(e){!0===e?$("#reminderbody").slideUp().hide(1e3):!1===e?updateMultipleReminderTimes():"none"===$("#reminderbody").css("display")?toggleReminder(!1):toggleReminder(!0),closeMultipleReminderBussinesscardView()}function updateMultipleReminderTimes(){var e=new Array;$(".reminderusers").each((function(){var i=ctiapiRem_dataparam[$(this).attr("ctiapi-data-params")];-1===e.indexOf(i.callactivityid)&&e.push(i.callactivityid)}));var i=getremindertimes(e);if(i!=={}){for(var t=reminderDatatemp.reminders.timesOfReminders,a=reminderDatatemp.reminders.availableReminders>0?reminderDatatemp.reminders.availableReminders:"",r=e.length,n=0;n<r;n++){var s=e[n],l=i[s],d=validationUtils.isNotEmpty(setMoreLater(l,!1))?setMoreLater(l,!1):setMoreLater(0,!1),o=validationUtils.isNotEmpty(setMoreLater(l,!0))?setMoreLater(l,!0):setMoreLater(0,!0),c=l<-6e4?{color:"#dc5a5a"}:{color:"#66bb33"},m=reminderDatatemp.reminders.reminderIdNameMap[s+""];$("#tof_"+s).html(d).attr("title",o).css(c);for(var p=t.length,h=0;h<p;h++)if(t[h].remindername===m){t[h].time=l;break}}var v=getReminderBody(reminderDatatemp),u=$("#reminderbody");$("#reminder_count").html(a),u.addClass("oldreminderslist").attr("id","oldreminderbody").after(v).remove(),u.hide().slideDown(500)}}function updateRemindersTimesFromServer(e){var i=Crm.getCrmBasePath()+"/CtiApiConfig.do",t={mode:"getremindertimes",isAjax:!0,activityids:e+""};networkUtils.setCsrfParam(t),(new crmRequestPool).initiate({type:"POST",url:i,data:t,success:function(i){if("object"==typeof i){for(var t=e.length,a=0;a<t;a++){var r=e[a],n=i[r],s=(new Date).getTime();if(void 0!==r){var l=ctiapiRem_dataparam["dataparam_"+r];l.date=s,l.timeOfReminder=n}}updateRemindersTime(),ctiapiSche.serverScheLastRunTime=new Date}}})}function getremindertime(e){return getremindertimes([e])[e]}function getremindertimes(e){for(var i={},t=(new Date).getTime(),a=e.length,r=0;r<a;r++){var n=e[r],s=ctiapiRem_dataparam.getTime(n)-t;i[n]=s}return i}function showHideSelectedReminder(e){var i=getremindertime(e);parseInt(i)<=6e4?$(".selectedReminder.reminderCallBt").show():$(".selectedReminder.reminderCallBt").hide()}function updateRemindersTime(){var e=!1;for(var i in ctiapiSche.reminderIds){var t=ctiapiRem_dataparam["dataparam_"+i],a=t.callactivityid+"",r=getremindertime(a),n=validationUtils.isNotEmpty(setMoreLater(r,!1))?setMoreLater(r,!1):setMoreLater(0,!1),s=validationUtils.isNotEmpty(setMoreLater(r,!0))?setMoreLater(r,!0):setMoreLater(0,!0),l=getremindertime(a)<-6e4?{color:"#dc5a5a"}:{color:"#66bb33"};$(".reminderTimeBig_"+i).html('<span id="reminderTimeSpan_'+a+'">'+s+'</span>  <label href="javascript:void(0);" class="dB red f18 ellipsistext" title="'+CTIAPI.encodeForHTMLWithoutNull(t.entityname)+'" '+(validationUtils.isNotEmpty(t.extradetails)?" - "+CTIAPI.encodeForHTMLWithoutNull(t.extradetails):"")+'">"'+CTIAPI.encodeForHTMLWithoutNull(t.entityname)+'" '+(validationUtils.isNotEmpty(t.extradetails)?" - "+CTIAPI.encodeForHTMLWithoutNull(t.extradetails):"")+"</label>"),$(".reminderTime_Msg_"+a).html(s).css(l),$("#tof_"+a).html(n).attr("title",s).css(l);var d=$("#twistatusimg");if(((void 0===d||d.is(":hidden"))&&!0===t.outgoingenabled||void 0!==d&&"1"===d.attr("statusvalue"))&&parseInt(r)<=6e4){var o=t.zgid+"",c=t.userid+"",m=t.phone+"",p=a,h=t.entityid+"",v=t.entitymodule,u=t.reminderPhno,g=t.recordEntityName,f='<span class="fL" >'+I18n.getMsg("Call")+"</span></i>";u.length<=1?f='<span class="fL" onclick=\'ctiApiNotifier.click2Call("'+$ESAPI.encoder().encodeForJavaScript(m)+'","'+o+'","'+c+'","'+h+'","'+p+'","'+v+'","'+$ESAPI.encoder().encodeForJavaScript(g)+"\");' >"+I18n.getMsg("Call")+"</span> ":(f='<span class="fL">'+I18n.getMsg("Call")+"</span> ",f+='<i class="whtdownArw fL"></i>'),$(".singleReminderCallBt_"+a).html(f),e=!0}}if(e){$(".reminderCallBt").show();var R=$(".reminderusers.sel");if(void 0!==R&&R.length>0)showHideSelectedReminder(R.attr("ctiapi-data-params").split("dataparam_")[1]+"")}else $(".reminderCallBt").hide();ctiapiSche.clientScheLastRunTime=new Date}function getReminderBody(e){var i=new Array,t=e.reminders,a=t.timesOfReminders.sort((function(e,i){return e.time-i.time})),r="";r+='<div class="chatContainer pR" id="reminderbody">',r+='<div id="businessView">',r+='<div class="remindercallList reminderslist" onscroll="CallReminder.scrollReminderBody()">';for(var n=0,s=0;n<t.noOfReminders;n++,s++){var l=a[n].remindername,d=a[n].time,o=t[l],c=o.callactivityid+"",m=d<-6e4?"color:#dc5a5a":"color:#66bb33";if(-1===reminderDatatemp.reminders.deleteRemindersList.indexOf(l)&&-1===i.indexOf(c)){var p=setMoreLater(d,!0);i.push(c),r+='<div id="ICPOP2" class="chooseOwner reminderusers" ctiapi-data-params="dataparam_'+c+'" orderno="'+s+'" onclick="CallReminder.getSelectedReminder(this);">',r+='<div class="">',r+='<img src="'+CallReminder.getEntityImgSrc(o)+'" width="40" class="floatL mR10">',r+='<input type="hidden" id="endcall_'+c+'">',r+='<span class="fL w220 oH">',r+='<label class="dB f13 crm-font-bold color_40 cP ellipsistext" title="'+CTIAPI.encodeForHTMLWithoutNull(o.entityname)+'">',r+=CTIAPI.encodeForHTMLWithoutNull(o.entityname),r+="</label>",r+='<a href="javascript:void(0);" class="ellipsistext f12 gray2 w220 oH dIB" title="'+(validationUtils.isNotEmpty(o.entityemailid)?CTIAPI.encodeForHTMLWithoutNull(o.entityemailid):"")+'">',r+=validationUtils.isNotEmpty(o.entityemailid)?CTIAPI.encodeForHTMLWithoutNull(o.entityemailid):"",r+="</a>",r+="</span> ",r+='<span class="fR w70 ellipsistext alignright" id="tof_'+c+'" title="'+p+'" style="'+m+'">',r+=setMoreLater(d,!1),r+="</span>",r+="</div>",r+="</div>"}else s--}return r+="</div>",r+="</div>",r+="</div>"}function setMoreLater(e,i){return setDaysHoursMins(e,i)}function setDaysHoursMins(e,i){var t=Utils.getMillisecondsToBasicDateProperties(e),a=i?".detailedtext":"",r=t.days,n=t.hours,s=t.mins;if(!(parseInt(e)>0&&parseInt(e)<1e3||parseInt(e)<0&&parseInt(e)>-1e3))if(Math.abs(r)>0)if(n%=24,Math.abs(n)>0){var l=(Math.abs(n)+"").length>1?Math.abs(n)+"":"0"+Math.abs(n);if(r>0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.dayshoursmore"+a,[r+"",l]);if(r<0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.dayshourslate"+a,[Math.abs(r)+"",l])}else{if(r>0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.daysmore"+a,r+"");if(r<0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.dayslate"+a,Math.abs(r)+"")}else if(Math.abs(n)>0)if(Math.abs(s)>0){var d=(Math.abs(s)+"").length>1?Math.abs(s)+"":"0"+Math.abs(s);if(n>0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.hoursminutesmore"+a,[n+"",d]);if(n<0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.hoursminuteslate"+a,[Math.abs(n)+"",d])}else{if(n>0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.hourssmore"+a,n+"");if(n<0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.hourslate"+a,Math.abs(n)+"")}else if(Math.abs(s)>0){if(0===s)return I18n.getMsg("crm.tpi.ctiapi.label.notification.itstimetocall");if(s>0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.minutesmore"+a,s+"");if(s<0)return I18n.getMsg("crm.tpi.ctiapi.label.notification.minuteslate"+a,Math.abs(s)+"")}return I18n.getMsg("crm.tpi.ctiapi.label.notification.itstimetocall")}