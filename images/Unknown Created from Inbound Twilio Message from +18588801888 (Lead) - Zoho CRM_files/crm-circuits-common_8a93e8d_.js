store.registerModel("circuits",{id:Lyte.attr("string"),name:Lyte.attr("string"),description:Lyte.attr("string"),states:Lyte.attr("string"),status:Lyte.attr("string")},{actions:{portals:{endPoint:"portals"},summary:{endPoint:"summary"},integration:{endPoint:"integration"},execution:{endPoint:"execution"},summary:{endPoint:"summary"},execution_summary:{endPoint:"execution_summary"},circuit_execution:{endPoint:"circuit_execution"},circuit_action:{endPoint:"circuit_action"},circuit_rl:{endPoint:"circuit_rl"},circuit_association_details:{endPoint:"circuit_association_details"},circuits_payment_status:{endPoint:"circuits_payment_status"},all_circuit_list:{endPoint:"all_circuit_list"}}}),store.registerAdapter("circuits",{namespace:"crm/v2.2/settings",buildURL:function(t,e,i,r,c,s,a){switch(s){case"integration":c=c.replace("settings/circuits/actions/integration","settings/integrations/zcircuits"),a&&a.portal_id&&(c=c+"/"+a.portal_id.toString()),delete a.portal_id;break;case"portals":c=c.replace("settings/circuits/actions/portals","settings/integrations/zcircuits/portals");break;case"summary":c=c.replace("settings/circuits/actions/summary","settings/integrations/zcircuits/executions/actions/summary");break;case"execution":c=(c=c.replace("settings/circuits/actions/execution","settings/integrations/zcircuits/circuits/{circuit_id}/actions/trigger")).replace("{circuit_id}",a.payLoad[0].circuit_id),delete a.payLoad[0].circuit_id;break;case"execution_summary":c=c.replace("settings/circuits/actions/execution_summary","settings/integrations/zcircuits/executions"),a.payLoad&&a.payLoad.length&&a.payLoad[0].circuit_id&&(c=c.replace("settings/integrations/zcircuits/executions","settings/integrations/zcircuits/circuits/"+a.payLoad[0].circuit_id+"/executions"),delete a.payLoad[0].circuit_id);break;case"circuit_execution":c=(c=c.replace("settings/circuits/actions/circuit_execution","settings/circuits/{circuit_id}/executions")).replace("{circuit_id}",a.payLoad[0].circuit_id);break;case"all_circuit_list":c=c.replace("settings/circuits/actions/all_circuit_list","__internal/settings/integrations/zcircuits/circuits");break;case"circuit_action":c=(c=(c=(c=c.replace("settings/circuits/actions/circuit_action","settings/integrations/zcircuits/circuits/{circuit_id}/executions/{execution_id}/actions/{action}")).replace("{circuit_id}",a.payLoad[0].circuit_id)).replace("{execution_id}",a.payLoad[0].execution_id)).replace("{action}",a.payLoad[0].action);break;case"circuit_rl":c=(c=(c=(c=c.replace("settings/circuits/actions/circuit_rl","{module}/{id}/{related_list_api_name}")).replace("{module}",i.module)).replace("{id}",i.search_key)).replace("{related_list_api_name}","Circuit_Executions"),delete i.module,delete i.search_key;break;case"circuit_association_details":c=(c=c.replace("settings/circuits/actions/circuit_association_details","settings/integrations/zcircuits/circuits/{circuit_id}/actions/associated")).replace("{circuit_id}",a.payLoad[0].id),delete a.payLoad[0].id;break;case"circuits_payment_status":c=c.replace("settings/circuits/actions/circuits_payment_status","__internal/settings/integrations/zcircuits/payment_status");break;default:c=c.replace("settings/circuits","settings/integrations/zcircuits/circuits")}return a&&a.payLoad&&(i=a.payLoad),c},methodForRequest:function(t,e,i,r){return r&&r.request_type?r.request_type:("PATCH"===t&&(t="PUT"),t)}}),store.registerSerializer("circuits",{serialize:function(t,e,i,r,c,s,a){return"createRecord"!==t&&"updateRecord"!==t||(e.circuits.hasOwnProperty("id")&&delete e.circuits.id,e.circuits=[e.circuits]),r&&r.request_type&&("POST"===r.request_type||"PUT"===r.request_type)&&(e="integration"===a?{zcircuits:r.payLoad}:"portals"===a?{zcircuits_portals:r.payLoad}:"execution"===a?{circuit_trigger:r.payLoad}:{circuits:r.payLoad}),e},payloadKey:function(t){return""+t},normalizeResponse:function(t,e,i,r,c){return"circuits"==t&&("createRecord"===e&&201==c||"updateRecord"===e&&200==c||"deleteRecord"===e&&200==c)&&(i.circuits=i.circuits[0].details),"circuits"===t&&"findAll"===e&&204===c&&(i.circuits={}),i}}),Lyte.Mixin.register("crm-circuits-mixin",{data:{brandName:Lyte.attr("string",{default:Crm.brandName}),needToShowStopBanner:Lyte.attr("boolean",{default:!1})},methods:{errorHandling:function(t,e,i){if(e)crmui.showMsgBand("error",I18n.getMsg(e),"4000");else switch(JSON.parse(t).code){case"NO_PERMISSION":crmui.showMsgBand("error",I18n.getMsg("crm.circuits.error.authorization"),"4000");break;case"USER_NOT_CONFIRMED":crmui.showMsgBand("error",I18n.getMsg("crm.label.widgets.error.email.unconfirmed"),"4000");break;case"FEATURE_NOT_AVAILABLE":crmui.showMsgBand("error",I18n.getMsg("crm.setup.attribution.FEATURE_NOT_SUPPORTED"),"4000");break;case"NOT_ALLOWED":crmui.showMsgBand("error",I18n.getMsg("crm.circuits.circuit.integration.deactivate.error"),"4000");break;case"CANNOT_PROCESS":"abort"===i[0]?crmui.showMsgBand("error",I18n.getMsg("crm.circuits.abort.ranalready.error"),"4000"):"retry"===i[0]?crmui.showMsgBand("error",I18n.getMsg("crm.circuits.retry.initiate.error"),"4000"):"rerun"===i[0]?crmui.showMsgBand("error",I18n.getMsg("crm.circuits.rerun.running.error"),"4000"):0===i[1]?crmui.showMsgBand("error",I18n.getMsg("crm.circuits.circuit.deactivate.error",i[0]),"4000"):1===i[1]?crmui.showMsgBand("error",I18n.getMsg("crm.circuits.circuit.delete.error",i[0]),"4000"):crmui.showMsgBand("error",I18n.getMsg("crm.label.widgets.error.internal"),"4000");break;case"DUPLICATE_DATA":crmui.showMsgBand("error",e,"4000");break;case"USED_IN_OTHER_SERVICES":crmui.showMsgBand("error",I18n.getMsg("crm.circuits.circuit.cannot.be.deleted.other",i[0]),"4000");break;case"PATTERN_NOT_MATCHED":crmui.showMsgBand("error",I18n.getMsg("crm.circuits.name.criteria.failed"),"4000");break;case"PRIMARY_ID_ALREADY_INTEGRATED":crmui.showMsgBand("error",I18n.getMsg("crm.circuits.portal.integration.unavailable"),"4000");break;case"INVALID_DATA":crmui.showMsgBand("error",I18n.getMsg("crm.circuits.does.not.exist"),"4000");break;case"TRIAL_EXECUTION_LIMIT_EXCEEDED":Crm.userDetails.IS_ADMIN_ROLE?crmui.showMsgBand("error",I18n.getMsg("crm.circuits.associate.non.payment",Crm.brandName),"4000"):crmui.showMsgBand("error",I18n.getMsg("crm.circuits.associate.non.payment",Crm.brandName)+". "+I18n.getMsg("crm.circuits.contact.admin"),"4000");break;default:crmui.showMsgBand("error",I18n.getMsg("crm.label.widgets.error.internal"),"4000")}},onCloseOfCircuitAssociateComp:function(t,e,i){try{var r=$(".setupleftmenutable"),c=$("#customizeModuleDiv");switch(e){case"close":switch(t){case"custom_button":CustomButtonJSObject.closeCustomFunctionConfigDiv()}break;case"configure":switch(t){case"custom_button":CustomButtonJSObject.saveCircuitInfo(i);break;case"workflow":var s={actionType:"Circuits"};s.actionName=i.name,s.data={circuit_id:i.id,name:i.name},wfActions.addorUpdateActionRow(s);break;case"blueprint_state":BlueprintState.frameSubmitAction("create",i.id,i.name,"");break;case"blueprint":ProcessBuilder.frameSubmitAction("associateCircuit",i.id,i.name,"")}break;case"editorOpen":switch(t){case"custom_button":c.hide();break;case"workflow":case"blueprint":case"blueprint_state":r.hide()}break;case"editorClose":switch(t){case"custom_button":c.show();break;case"workflow":case"blueprint":case"blueprint_state":r.show()}break;case"getRenderId":switch(t){case"custom_button":case"workflow":case"blueprint":case"blueprint_state":if(0===$("#circuitEditorDiv").length){$("body").append('<div id="circuitEditorDiv"></div>')}return"#circuitEditorDiv"}break;default:return crmui.showMsgBand("error",I18n.getMsg("crm.label.widgets.error.internal"),"4000"),!1}}catch(t){return crmui.showMsgBand("error",I18n.getMsg("crm.label.widgets.error.internal"),"4000"),!1}return!0},openAssociateComponent:function(t){if(commonUtils.showHideLoadingDiv(!0),0!==$("crm-circuits-association").length)Lyte.triggerEvent("cirAssoc_setData",t),Lyte.triggerEvent("cirAssoc_reloadCircuitsPop");else{var e=networkUtils.returnDependencyFiles(["crm-circuits-association.js"],crmConstants.jsStaticPathForLyte);e=e.concat(networkUtils.returnDependencyFiles(["crm-circuits-association.css","crm-circuits-preview-display.css","crm-circuits-create-edit.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-circuits-rtl.css"],crmConstants.cssStaticPathForLyte))),Lyte.injectResources(e,void 0,(function(){Lyte.Component.render("crm-circuits-association",t,"#result"),Lyte.triggerEvent("cirAssoc_setData",{showMainPop:!0})}))}},getPaymentStatus:function(){return!Crm.userDetails.hasOwnProperty("Circuits")||!Crm.userDetails.Circuits.hasOwnProperty("paymentInfo")||Crm.userDetails.Circuits.isPaymentDone},checkPaymentStatusIsPresentInClient:function(t,e){Crm.userDetails.hasOwnProperty("Circuits")&&Crm.userDetails.Circuits.hasOwnProperty("paymentInfo")?t&&t(e):store.triggerAction("circuits","circuits_payment_status",{request_type:"GET"}).then((function(i){Crm.userDetails.Circuits||(Crm.userDetails.Circuits={}),Crm.userDetails.Circuits.integration_done_by=i.payment_status[0].done_by,delete i.payment_status[0].done_by,Crm.userDetails.Circuits.paymentInfo=i.payment_status[0],t&&t(e)}),(function(){t&&t(e)}))},getZuidVsUserIdObj:function(){for(var t=store.peekAll("user"),e={},i=t.length,r=0;r<i;r++){var c=t[r];e[c.zuid]=c.id}return e}}}),Lyte.Component.registerHelper("getTimeValueinUsrFormat",(function(t,e){return t===e?"-":Lyte.Component.registeredHelpers.dateTimeUserFormatFromISOFormat(t)})),Lyte.Component.registerHelper("getCircuitsI18nValue",(function(t){var e={API:"crm.label.privacy.data.source.api",TEST_RUN:"crm.circuits.component.TEST_RUN",CUSTOM_BUTTON:"crm.auditlog.custombutton",custom_button:"crm.auditlog.custombutton","custom button":"crm.auditlog.custombutton",SCHEDULES:"crm.setup.system.schedules",WORKFLOW:"crm.workflow.title",workFlow:"crm.workflow.title",workflow:"crm.workflow.title",WORKFLOW_ACTION:"crm.workflow.title",ORCHESTRATION:"crm.circuits.component.ORCHESTRATION",BLUEPRINT:"crm.functions.failures.blueprint",blueprint:"crm.functions.failures.blueprint",BLUEPRINT_ACTION:"crm.functions.failures.blueprint",APPROVAL_PROCESS:"crm.functions.failures.approval_process",ASSIGNMENT_RULES:"webform.lar.valid",VALIDATION_RULES:"crm.label.cf.crmfundamentals",Success:"crm.circuits.status.success",Abort_in_progress:"crm.circuits.status.abortinprogress",Failed:"crm.circuits.status.failed",Aborted:"crm.circuits.status.aborted",Running:"crm.circuits.status.running"};return e.hasOwnProperty(t)?I18n.getMsg(e[t]):t})),Lyte.Component.registerHelper("eliminateDuplicatesForAssocComp",(function(t){var e=this.component,i=e.getData("processIdsInUI");return!["blueprint_action","workflow_action"].contains(t.type)||!i.contains(t.associated_process.id)&&(i.push(t.associated_process.id),e.setData("processIdsInUI",i),!0)})),Lyte.Component.registerHelper("getUserNameByZuid",(function(t,e){return Lyte.Component.registeredHelpers.getUserName(e[t])}));
