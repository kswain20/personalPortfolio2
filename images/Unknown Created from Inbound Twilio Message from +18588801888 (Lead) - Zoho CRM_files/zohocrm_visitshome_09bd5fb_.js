var CrmTracking={};CrmTracking.popupState,CrmTracking.serverTimeDiff=0,CrmTracking.isSalesiqUser=!1,CrmTracking.portalsInfo={},CrmTracking.userPortalsInfo={},CrmTracking.ids=[],CrmTracking.beforeTime=(new Date).getTime(),CrmTracking.diff=0,CrmTracking.maxOnline=100;var trackingCacheObj={};CrmTracking.initTrackObj=function(){trackingCacheObj.zCrmLivedeskInfo={config:{vWinMinimized:"true",vIsServerUp:"true"},data:{},dkeys:[],time:(new Date).getTime(),newVisKeys:{}}},CrmTracking.setServerTimeDiff=function(e){CrmTracking.serverTimeDiff=(new Date).getTime()-e},CrmTracking.handleServerUp=function(){var e=trackingCacheObj.zCrmLivedeskInfo;if(e){var n=!e.config.vIsServerUp||e.config.vIsServerUp;n&&"false"!=n||CrmTracking.handleVisit()}},CrmTracking.updateNetWorkState=function(){if(trackingCacheObj.zCrmLivedeskInfo){var e=trackingCacheObj.zCrmLivedeskInfo;e.config.vIsServerUp="false",trackingCacheObj.zCrmLivedeskInfo=e}else CrmTracking.initTrackObj()},CrmTracking.initNotification=function(){CrmTracking.getOnlineVisits(!0,void 0,!0),setTimeout((function(){CrmTracking.initPortalActiveCount()}),10)},CrmTracking.populateUserPortalsDD=function(){var e=Handlebars.templates.OnlineVisitsPortalDD(CrmTracking.userPortalsInfo);$("#ldChatMultiplePortalSel").html(e),$("#select2-ldChatMultiplePortalSel-container").text(I18n.getMsg("crm.salesiq.all.accounts")).attr("title",I18n.getMsg("crm.salesiq.all.accounts"))},CrmTracking.initPortalActiveCount=function(){$("#ldChatMultiplePortalSel").select2({templateResult:CrmTracking.formatPortalActiveCount,templateSelection:CrmTracking.formatPortalActiveCount})},CrmTracking.formatPortalActiveCount=function(e){if(!e.id)return e.text;var n=null,a=$(e.element),i=a.val();if("all"==i)return a.text();var t="";trackingCacheObj.zCrmLivedeskInfo&&trackingCacheObj.zCrmLivedeskInfo.data[i]&&(t=Object.keys(trackingCacheObj.zCrmLivedeskInfo.data[i]).length),n=trackingCacheObj.zCrmLivedeskInfo&&trackingCacheObj.zCrmLivedeskInfo.newVisKeys[i]?"notCRed":"notCGray",""!=t&&(t="( "+t+" )");var r=renderingUtils.createHTML({name:"span",child:[{name:"text",content:a.text()}]}),s=renderingUtils.createHTML({name:"text",content:" "}),l=renderingUtils.createHTML({name:"span",attr:{class:"vmore ld-vmore"},child:[{name:"span",attr:{id:"notCSpan",class:"notC "+n},child:[{name:"text",content:t}]}]});return $(r).add($(s)).add($(l))},CrmTracking.showNotificationBar=function(){if(trackingCacheObj.zCrmLivedeskInfo&&CrmTracking.isSalesiqUser){WebMessanger.disableWMSStatus();var e=renderingUtils.createHTML({name:"div",attr:{id:"wVisTitBar",class:"crm-wms-icon wldchatPopTitle cP pR",onclick:"CrmTracking.maximizePop(); sE(event);",onmouseover:"crmui.toolTip_show(this,'center','"+I18n.getMsg("crm.livedesk.online")+"')",onmouseleave:"crmui.hideTooltip(this)","data-zcqa":"wVisTitBar","data-title":I18n.getMsg("crm.livedesk.online")},child:[{name:"span",attr:{id:"ldTitleSpan",class:""}},{name:"span",attr:{id:"wVisCount",class:"bubbleCountBtm"},child:[{name:"text",content:""}]}]}),n=renderingUtils.createHTML({name:"td",attr:{style:"vertical-align:middle"}});if($("#chatBarIcons").length>0){if(0==$("#wVisTitBar").length){$("#chatBarIcons tr").find(".touriconOuter").length?$("#chatBarIcons td.touriconOuter").after($(n).append($(e))):$("#chatBarIcons tr:first").prepend($(n).append($(e)));var a=$("#LDPOP");a.length&&a.css({bottom:"-"+a.innerHeight()+"px"})}e=$("#wmsstatusbar").html()}WebMessanger.setServiceStatus(e),$("#ldTitleSpan").append("<crmutil-icon icon-name='monitor-avator-plain' icon-class='zcicn-monitor-avator-plain mT7'></crmutil-icon>"),WmsUIImpl.UIReady=function(){WebMessanger.setServiceStatus(e)},CrmTracking.updateWCount(CrmTracking.getVisitorCnt(),!0)}},CrmTracking.add=function(e){CrmTracking.ids.length>CrmTracking.maxOnline-1&&CrmTracking.ids.splice(CrmTracking.maxOnline-1,CrmTracking.ids.length),-1==CrmTracking.ids.indexOf(e)&&CrmTracking.ids.unshift(e)},CrmTracking.addZero=function(e){return e<10?"0"+e:e},CrmTracking.startVisitTimer=function(){if(validationUtils.isNotEmpty(CrmTracking.ids)){for(var e=(new Date).getTime(),n=CrmTracking.ids.length,a=0;a<n;a++){var i=CrmTracking.ids[a],t=$("#"+i+"_hours"),r=$("#"+i+"_minutes"),s=$("#"+i+"_seconds"),l=$("#"+i+"_Hhours"),o=$("#"+i+"_Hminutes"),c=$("#"+i+"_timess"),d=$("#"+i+"_timemm"),m=0;m=parseInt(t.html());var g=parseInt(r.html()),v=parseInt(s.html());(v+=1)>=60&&((g+=1)>=60&&(m+=1,g=0),v=0),t.html(CrmTracking.addZero(m)),r.html(CrmTracking.addZero(g)),s.html(CrmTracking.addZero(v)),m>0&&($("#"+i+"_hourDiv").show(),l&&(l.html(CrmTracking.addZero(m)),$("#"+i+"_HhourDiv").show())),o&&(o.html(CrmTracking.addZero(g)),$("#"+i+"_Hseconds").html(CrmTracking.addZero(v))),v=parseInt(c.html()),g=parseInt(d.html()),(v+=1)>=60&&(g+=1,v=0),c.html(v),g>0&&(d.html(g),$("#"+i+"_total").show())}CrmTracking.diff=e-CrmTracking.beforeTime-1e3+CrmTracking.diff,CrmTracking.diff>=1e3&&(CrmTracking.diff=1e3),CrmTracking.beforeTime=e,setTimeout((function(){CrmTracking.startVisitTimer()}),1e3-CrmTracking.diff)}},CrmTracking.stopVisitTimer=function(e){e?CrmTracking.ids.removeFirstOccurenceOfElement(e):CrmTracking.ids=[]},CrmTracking.handleVisit=function(e){try{if(-1!=window.location.href.indexOf("mailer/EntReply.do?action"))return;var n="",a=0,i=!0;if(trackingCacheObj.zCrmLivedeskInfo)n=(V=trackingCacheObj.zCrmLivedeskInfo).config.vWinMinimized?V.config.vWinMinimized:"",i=!V.config.vIsServerUp||V.config.vIsServerUp,a=V.dkeys?V.dkeys.length:0;if(0==a||e&&"null"!=e)if(e)if(e.operation){var t=e.operation,r=e.data.uvid,s=$("#"+r);switch(t){case"NewVisitor":var l=e.data._screenname;CrmTracking.updLocalStorage(r,e.data,t,l),trackingCacheObj.zCrmLivedeskInfo.newVisKeys[l]||(trackingCacheObj.zCrmLivedeskInfo.newVisKeys[l]=[]),trackingCacheObj.zCrmLivedeskInfo.newVisKeys[l].push(r);var o=CrmTracking.getCurrScreenName(),c=$("#LDPOP"),d=$("#newVisit");if(0==a&&"26px"==c.css("bottom")){if(l!=o)return void $("#ldChatMultiplePortalSel").val(l).change();CrmTracking.fillVisitInfo(r,e)}else if("true"==n)$("#wVisTitBar").addClass("active_chat");else if("false"==n)if(null==o)trackingCacheObj.zCrmLivedeskInfo.dkeys.length?d.show().addClass("showmore-active"):CrmTracking.renderVisits(void 0,void 0,l,void 0);else{var m=0;if(l==o&&(m=1),!(trackingCacheObj.zCrmLivedeskInfo.data[o]&&Object.keys(trackingCacheObj.zCrmLivedeskInfo.data[o]).length>m))return void $("#ldChatMultiplePortalSel").val(l).change();d.show().addClass("showmore-active")}if((0!=a||"26px"!=c.css("bottom"))&&"none"!=d.css("display")||!CrmTracking.popupState){var g=$("#newVisitCnt"),v=g.html();v=v?parseInt(v)+1:1,g.html(v)}o=CrmTracking.getCurrScreenName();if("false"==n&&null!=o&&o==l)""!=(b=(I=$("#notCSpan")).text())?(b=b.charAt(2),b=parseInt(b)+1):b=1,b="( "+b+" )",I.text(b);CrmTracking.updateWCount(CrmTracking.getVisitorCnt(),!0),$("#wVisCount").removeClass("ldchat-gray");break;case"InfoUpdate":l=e.data._screenname;var C=e.data.info,u=trackingCacheObj.zCrmLivedeskInfo.data[l][r];if($.each(C,(function(e,n){u[e]=n})),trackingCacheObj.zCrmLivedeskInfo.data[l][r]=u,s){var k=CrmTracking.fillVisitInfo(r,"",!0,l);s.replaceWith(k)}if(V.entitiesOnline&&C.integdata){var p=C.integdata.ZohoCRM;CrmTracking.updateEntitiesOnline(V,p,u.link)}break;case"PageUpdate":l=e.data._screenname;CrmTracking.updLocalStorage(r,e.data.path.path,t,l);var f=$("#"+e.data.uvid+" .ldeskpv").html();if($("#"+e.data.uvid+" .ldeskpv").html(parseInt(f)+1),s){k=CrmTracking.fillVisitInfo(r,"",!0,l);s.replaceWith(k)}break;case"VisitorLeft":l=e.data._screenname;CrmTracking.updLocalStorage(e.data.uvid,null,t,l);var h=CrmTracking.getVisitorCnt();CrmTracking.updateWCount(h,!0);var T=trackingCacheObj.zCrmLivedeskInfo.newVisKeys;T[l]&&(T[l].splice(T[l].indexOf(r),1),0==T[l].length&&delete T[l]);var I,b;o=CrmTracking.getCurrScreenName();if("false"==n&&null!=o&&o==l)b=(b=(I=$("#notCSpan")).text()).charAt(2),b=0==(b=parseInt(b)-1)?"":"( "+b+" )",I.text(b);break;case"ModifyTracking":!0!==e.data.visitortracking&&"true"!==e.data.visitortracking||CrmTracking.getOnlineVisits(!0,e.data._screenname,!0);break;case"DisableCRM":CrmTracking.handleConfDisable(e.data._screenname);break;case"EnableCRM":validationUtils.isEmpty(CrmTracking.userPortalsInfo)&&!VisitsConfig.isEnabledFromZCRM&&networkUtils.loadFeatureScripts(["zohocrm_visitsetup.js"],(function(){VisitRoute.fetchIntegDetails("configured").then((function(e){CrmTracking.userPortalsInfo=e.userPortals,CrmTracking.portalsInfo=e.configured,CrmTracking.populateUserPortalsDD()}))})),setTimeout((function(){CrmTracking.getOnlineVisits(!0,e.data._screenname,!0)}),3e3)}}else{CrmTracking.showNotificationBar(),CrmTracking.initTrackObj();var O=(e=JSON.parse(e)).RESPONSE,L=O.length;h=L>CrmTracking.maxOnline?CrmTracking.maxOnline:L;if(cookieUtils.setCookie("zVisitCount",h),CrmTracking.updateWCount(h,!0),L>0)for(var y=0;y<L;y++){var w=O[y].uvid;CrmTracking.updLocalStorage(w,O[y],"BulkInsert",O[y]._screenname)}}else if(i&&"false"===i){var V;CrmTracking.getOnlineVisits(!1,void 0,!0),(V=trackingCacheObj.zCrmLivedeskInfo)&&(V.config.vIsServerUp="true",V.config.vWinMinimized="true",trackingCacheObj.zCrmLivedeskInfo=V,a=V.dkeys?V.dkeys.length:0,CrmTracking.showNotificationBar())}else CrmTracking.showNotificationBar();else CrmTracking.showNotificationBar(),n&&"false"==n&&$("#wVisTitBar").addClass("ldchatPop_active")}catch(e){console.log("Error in handleVisit method")}},CrmTracking.removeSplicedUIDsFromVInfo=function(e,n){$.each(e,(function(){for(var e in CrmTracking.userPortalsInfo)n.data[e][this]&&(delete n.data[e][this],validationUtils.isEmpty(n.data[e])&&delete n.data[e])}))},CrmTracking.updLocalStorage=function(e,n,a,i){trackingCacheObj.zCrmLivedeskInfo||CrmTracking.initTrackObj();var t=trackingCacheObj.zCrmLivedeskInfo;switch(a){case"BulkInsert":var r=null;(r=t.data[i]?t.data[i]:{})[e]=n,t.data[i]=r;var s=t.dkeys.indexOf(e);if((o=t.dkeys.length)>CrmTracking.maxOnline-1){var l=t.dkeys.splice(CrmTracking.maxOnline-1,o);CrmTracking.removeSplicedUIDsFromVInfo(l,t),trackingCacheObj.zCrmLivedeskInfo.countExceeded=!0}-1==s&&(t.newVisKeys[i]&&t.newVisKeys[i].contains(e)?t.dkeys.unshift(e):t.dkeys.push(e));break;case"NewVisitor":var o;if((o=t.dkeys.length)>CrmTracking.maxOnline-1){l=t.dkeys.splice(CrmTracking.maxOnline-1,o);CrmTracking.removeSplicedUIDsFromVInfo(l,t),trackingCacheObj.zCrmLivedeskInfo.countExceeded=!0}r=null;if((r=t.data[i]?t.data[i]:{})[e]=n,t.data[i]=r,-1==(s=t.dkeys.indexOf(e))&&(t.dkeys.unshift(e),CrmTracking.updVisitorCnt()),t.entitiesOnline&&n.integdata){var c=n.integdata.ZohoCRM;CrmTracking.updateEntitiesOnline(t,c,n.link)}break;case"VisitorLeft":CrmTracking.stopVisitTimer(e);s=t.dkeys.indexOf(e);var d=t.config.vWinMinimized?t.config.vWinMinimized:"";if(CrmTracking.updVisitorCnt("VisitorLeft"),t.entitiesOnline){var m=t.data[i][e].integdata;if(m){c=m.ZohoCRM;CrmTracking.updateEntitiesOnline(t,c)}}var g=$("#newVisit"),v=g.css("display");-1!=s&&(delete t.data[i][e],validationUtils.isEmpty(t.data[i])&&delete t.data[i],t.dkeys.splice(t.dkeys.indexOf(e),1),trackingCacheObj.zCrmLivedeskInfo.countExceeded=!1,$("#"+e+" .chatsingle").addClass("ldoffline"));var C=$("#newVisitCnt"),u=C.html();(0==$("#"+e).length&&g&&"none"!=v||u&&-1!=s&&s<parseInt(u))&&(u&&0==(u=parseInt(u)-1)&&$("#wVisTitBar").removeClass("active_chat"),u&&0!=u?C.html(u):C.html(u).hide()),setTimeout((function(n){if(n&&(n.remove(),$('div[uvid="'+e+'"]').closest("#visHistory").remove()),d&&"false"==d){var a=CrmTracking.getCurrScreenName();CrmTracking.renderVisits(!0,!0,a),$("#LDPOP").show()}}),5e3),CrmTracking.initPerfectscroll();break;case"PageUpdate":var k=t.data[i][e];k.paths.push(n),k.cpage=n.h,k.cpagetitle=n.p,t.data[i][e]=k}trackingCacheObj.zCrmLivedeskInfo=t},CrmTracking.getOnlineVisits=function(e,n,a){var i=$("#vt_load_tab");i.show(),CrmTracking.closeLeftPopup();var t=$("#notCSpan");if(t.hasClass("notCRed")&&t.removeClass("notCRed").addClass("notCGray"),trackingCacheObj.zCrmLivedeskInfo&&trackingCacheObj.zCrmLivedeskInfo.data&&!a){CrmTracking.isSalesiqUser=!0;var r=trackingCacheObj.zCrmLivedeskInfo,s=(new Date).getTime()-r.time,l=Math.floor(s/1e3/60/60);if("all"==n?CrmTracking.renderVisits():CrmTracking.renderVisits(void 0,void 0,n),CrmTracking.initPerfectscroll(),i.hide(),l<1)return void(e&&CrmTracking.showNotificationBar())}if(a){var o={skip_load_tab:!0,success_callback:function(a){if(i.hide(),a&&null!=a.resp&&"-1"!=a.resp){if(CrmTracking.setServerTimeDiff(parseInt(a.time)),null==n){var t=null;trackingCacheObj.zCrmLivedeskInfo&&(t=trackingCacheObj.zCrmLivedeskInfo.newVisKeys),CrmTracking.initTrackObj(),CrmTracking.isSalesiqUser=!0,t&&(trackingCacheObj.zCrmLivedeskInfo.newVisKeys=t)}var r=a.resp;for(var s in r){var l=r[s].RESPONSE;if(delete trackingCacheObj.zCrmLivedeskInfo.data[s],validationUtils.isNotEmpty(l))for(var o=l.length,c=0;c<o;c++){var d=l[c].uvid;CrmTracking.updLocalStorage(d,l[c],"BulkInsert",s)}}var m=(o=trackingCacheObj.zCrmLivedeskInfo.dkeys.length)>CrmTracking.maxOnline?CrmTracking.maxOnline:o;cookieUtils.setCookie("zVisitCount",m),CrmTracking.updateWCount(m,!0),e&&CrmTracking.showNotificationBar(),CrmTracking.popupState&&(CrmTracking.renderVisits(),CrmTracking.initPerfectscroll()),CrmTracking.renderOnlineIcons()}else CrmTracking.handleConfDisable(void 0,!0)}};networkUtils.makeRequest("/crm/v2/Visits/online","GET",o)}},CrmTracking.fillVisitInfo=function(e,n,a,i){var t="UnKnown",r="";if(n)r=n.data;else{var s=trackingCacheObj.zCrmLivedeskInfo;for(var l in a||(e=s.dkeys[0]),s.data)s.data[l][e]&&(r=s.data[l][e])}var o=r._screenname;if(null!=i&&i!=o)return"";if(r.integdata&&r.integdata.ZohoCRM){var c=r.integdata.ZohoCRM;c.Contact?t="Contacts":c.Lead&&(t="Leads")}var d=CrmTracking.getBusinessCardJSON(r,e);d.screenName=o,d.unChangedMod=t;var m=Handlebars.templates.OnlineVisitsInfo(d);if(a)return m;$("#npopupInner").html(m),$("#LDPOP").css({bottom:"26px"}),(s=trackingCacheObj.zCrmLivedeskInfo).config.vWinMinimized="false",trackingCacheObj.zCrmLivedeskInfo=s},CrmTracking.fillRelatedInfo=function(e,n,a){var i=trackingCacheObj.zCrmLivedeskInfo,t=$(a),r=t.attr("zptname");if(t.hasClass("nb-active"))CrmTracking.closeLeftPopup();else if($("#vPotentialDet").attr("uvid")!=e){var s=i.data[r][e];if(s){var l=s.paths[0].morekey,o=s.uuid,c="false",d="";n&&"Contacts"==n?(d=s.integdata.ZohoCRM.Contact.CONTACTID,s.integdata.ZohoCRM.Potential&&(c="true")):n&&"Leads"==n&&(d=s.integdata.ZohoCRM.Lead.LEADID);var m={uid:e,uuid:o,morekeys:l,screenName:r,entityId:d,isPotPresent:c,potPlural:moduleRecordMapping.Potentials.plural_label},g=Handlebars.templates.OnlineVisitsRelatedInfo(m);$("#visHistory").html(g),CrmTracking.showVisitHistory(o,l,"",r,a)}}else CrmTracking.leftPanelAnimate(a);Crm.trackSpotLightAction("Sales IQ - Online Users Click")},CrmTracking.leftPanelAnimate=function(e){var n,a=$("#LDPOP").height(),i=$("#visHistory"),t=i.height(),r=parseInt(i.innerWidth()),s=i.offset().left,l=$("#visMain").offset().left,o=$(".ldchatPopTitle").innerHeight();$(".notify-box").removeClass("nb-active ldbb1");var c=$(e).closest(".notify-box");c.addClass("nb-active");var d=c.position().top,m=$(".nb-active"),g=m.position().top,v=c.offset().top-$(window).scrollTop();m.prev().addClass("ldbb1"),n=s<l,t>a?(i.css({top:"",bottom:"0px"}),$("#poparw").addClass("ld-poparw-active").css({display:"block",top:"",bottom:""})):(v=d+o,i.css({top:v,bottom:""}),g<0?$("#poparw").addClass("ld-poparw-active").css({top:"",bottom:"5px"}):(v=g+o+10,$("#poparw").addClass("ld-poparw-active").css({top:v,bottom:""}))),n||i.css({left:"-"+(r+3)+"px"})},CrmTracking.getVisOnScroll=function(e,n,a,i){var t="";(!n||n<4)&&(n=0);for(var r=4,s=n;s<n+r;s++){var l=e.dkeys[s];if(null==l)break;var o=$("#"+l);if(a||-1==t.indexOf(l)&&o&&0==o.length){var c="";try{""==(c=CrmTracking.fillVisitInfo(l,"",!0,i))&&(r+=1)}catch(e){c="",console.log("Exception in filling visits info")}t+=c}else r+=1}return t},CrmTracking.getNoVisitDiv=function(e){return renderingUtils.createHTML({name:"div",attr:{class:"novisit",id:"noVisitDiv"},child:[{name:"text",content:I18n.getMsg(e)}]})},CrmTracking.renderVisits=function(e,n,a,i){var t=$("#npopupInner"),r=$("#LDPOP");if(i){var s=CrmTracking.getNoVisitDiv("crm.tracking.disabled.info");return t.html(s),void r.css({bottom:"26px"})}var l=CrmTracking.getCurrScreenName();if(null==a&&e&&(!Object.keys(trackingCacheObj.zCrmLivedeskInfo.newVisKeys).contains(l)||Object.keys(trackingCacheObj.zCrmLivedeskInfo.newVisKeys).length>1))1==Object.keys(trackingCacheObj.zCrmLivedeskInfo.newVisKeys).length?(a=Object.keys(trackingCacheObj.zCrmLivedeskInfo.newVisKeys)[0],$("#ldChatMultiplePortalSel").val(a).change()):$("#ldChatMultiplePortalSel").val("all").change();else{null==a&&(a=CrmTracking.getCurrScreenName()),n||null!=a&&!trackingCacheObj.zCrmLivedeskInfo.newVisKeys[a]||($("#newVisit").removeClass("showmore-active").hide(),$("#newVisitCnt").html(""));var o=trackingCacheObj.zCrmLivedeskInfo;o&&(o.config.vWinMinimized="false",trackingCacheObj.zCrmLivedeskInfo=o);var c=validationUtils.isEmpty(trackingCacheObj.zCrmLivedeskInfo.data)||void 0!==a&&void 0===o.data[a]?CrmTracking.getNoVisitDiv("crm.livedesk.novisitors.online"):CrmTracking.getVisOnScroll(o,0,!0,a);if(t.html(c),r.css({bottom:"26px"}),e&&CrmTracking.initPerfectscroll(),null==a||"all"==a||trackingCacheObj.zCrmLivedeskInfo.newVisKeys[a]){var d=[];null!=a&&"all"!=a?(d=trackingCacheObj.zCrmLivedeskInfo.newVisKeys[a],delete trackingCacheObj.zCrmLivedeskInfo.newVisKeys[a]):$.each(trackingCacheObj.zCrmLivedeskInfo.newVisKeys,(function(e,n){d=d.concat(n),delete trackingCacheObj.zCrmLivedeskInfo.newVisKeys[e]})),CrmTracking.highlightNewVisit(d),$("#ldChatMultiplePortal").removeClass("mp-active-chat")}}},CrmTracking.highlightNewVisit=function(e){$.each(e,(function(e,n){var a=$("#npopupInner #"+n);a.addClass("notify-highlight"),setTimeout((function(){a.removeClass("notify-highlight")}),1e4)}))},CrmTracking.validateURL=function(e){return!!/^(ht|f)(ile|tp(s?)):\/\/[-.\w]*(\/?)([a-zA-Z0-9-.?,:'\/\+=&amp;%\$#_@]*)?$/.test(e)},CrmTracking.getBusinessCardJSON=function(e,n){var a="",i="",t="",r="",s="",l=0,o="",c="",d="-",m="",g="-",v="",C=0,u="";if(e.integdata&&e.integdata.ZohoCRM){var k=e.integdata.ZohoCRM,p="";k.Contact?(o=(p=k.Contact).CONTACTID,c=Crm.getCrmBasePath()+"/tab/Contacts/"+o,i=p["Mailing Country"]?p["Mailing Country"]:"",v=p.Phone?p.Phone:"",a="Contacts",k.Potential&&(k.Potential["No of Open Potentials"]&&0!=k.Potential["No of Open Potentials"]?(a="Potentials",m=k.Potential["Revenue in pipeline"]):(m=k.Potential["Closed Won"],a="Customer"))):k.Lead&&(a="Leads",o=(p=k.Lead).LEADID,c=Crm.getCrmBasePath()+"/tab/Leads/"+o,i=p.Country?p.Country:"",v=p.Phone?p.Phone:""),l=p["Last Visited Time"]?p["Last Visited Time"]:"",d=p["Days Visited"]?p["Days Visited"]:"-";var f=p["Last Name"]?p["Last Name"]:"",h=p["First Name"]?p["First Name"]:"";r=CrmTracking.getFormatedName(h,f),g=p["Visitor Score"]?p["Visitor Score"]:"-",s=(s=p["Account Name"]?p["Account Name"]:"")||(p.Company?p.Company:""),t=p.ACCOUNTID?Crm.getCrmBasePath()+"/tab/Accounts/"+p.ACCOUNTID:"",l=0!=l?l.replace(/\-/g,"/"):0,l=new Date(l).getTime()}else a="UnKnown",r=e.name==e.token?"Visitor "+e.token:e.name,s="",c="javascript:;",l=(l=e.lvtime)&&0!=l?l.replace(/\-/g,"/"):0,i=e.Country;i=""==(i=""==i?e.Country:i)||null==i?" - ":i;var T=e.link;l&&0!=l&&(u=(C=new Date(parseInt(l)))?C.toLocaleString():"");var I=C&&0!=C?Math.round(((new Date).getTime()-C)/6e4/60/24):"-";0==I?I=I18n.getMsg("Today"):1==I?I=I18n.getMsg("Yesterday"):"-"!=I&&(I=I18n.getMsg("crm.event.remind.days",""+I));var b=e.cpagetitle?e.cpagetitle:"",O=b,L=e.cpage;CrmTracking.validateURL(L)||(L="");for(var y=e.paths,$=0,w=null,V=!1,P=y.length,S=0;S<P;S++){var z=y[S],j=z.p;4!=z.e&&"Visitor Left"!=j&&$++,z.p!=b||V||(w=z.t,V=!0)}var N=parseInt(w);N+=CrmTracking.serverTimeDiff;var D=(new Date).getTime(),E=D;N>D&&(N=E);var x=parseInt(e.intime);E=D,(x+=CrmTracking.serverTimeDiff)>D&&(x=E);var M=E-x,_=Math.floor(M/1e3/60/60);M-=1e3*_*60*60;var U=Math.floor(M/1e3/60);M-=1e3*U*60;var R=Math.floor(M/1e3);""==b?b="Untitled":b.length>20&&(b=b.substring(0,19)+"...");var B="",H="";switch(a){case"Potentials":B=moduleRecordMapping.Potentials.singular_label,H="icong icon-potn";break;case"Customer":B="Customer",H="icong icon-potn";break;case"Leads":B=moduleRecordMapping.Leads.singular_label,H="icong icon-lead";break;case"Contacts":B=moduleRecordMapping.Contacts.singular_label,H="icong icon-cust";break;default:B="crm.livedesk.visit.Unknown",H="icong icon-visitor"}var A=CrmTracking.userPortalsInfo[e._screenname];null==m&&(m="0");var W=Crm.userDetails.defaultOrgCurrency;null==W&&(W=Crm.userDetails.CURRENCY_DETAILS[Crm.userDetails.BASE_CURRENCY].symbol),CrmTracking.add(n);var Z=Crm.userDetails.TELEPHONY_ENABLED,K=Crm.userDetails.ZGID,q=Crm.userDetails.USER_ID,F=crmConstants.livedeskURL+T,J=CrmTracking.addZero(_),G=CrmTracking.addZero(U),Y=CrmTracking.addZero(R),Q=!1;return null==CrmTracking.getCurrScreenName()&&(Q=!0),{uId:n,i18nKey:B,classForTitle:H,custNo:v,isTelephonyEnabled:Z,zgid:K,userId:q,entityId:o,module:a,chatLink:F,vName:r,entityURL:c,accEntityURL:t,vComp:s,portalName:A,symbol:W,vRevenue:m,vCountry:i,cpage:L,orgCpageTitle:O,cpageTitle:b,pagesVisited:$,hours:_,zeroAddedHour:J,zeroAddedminute:G,zeroAddedSecond:Y,isPortalNameNeeded:Q,vDaysVisit:d,dateOnHover:u,lvtimeInDays:I,vScore:g}},CrmTracking.initPerfectscroll=function(){var e=parseInt($("#tabLayer").innerHeight())+67,n=$("#npopupInner .notify-box");e=renderingUtils.windowHeight-(e+28+parseInt($("#visTitBar").innerHeight()));var a=0;if(n.each((function(){a+=$(this).innerHeight()})),a<180){a=180;var i=$("#npopupInner .notify-box:first");return a=i.length>0?i.innerHeight():"180px",$("#allvisits").css({height:a}),void thirdPartyUtils.unbindPerfectScroll("#allvisits")}a<e?$("#allvisits").css({height:a}):$("#allvisits").css({height:e+"px"}),n.css({"border-bottom":"1px solid #f7f7f7"}),$("#npopupInner .notify-box:last").css({"border-bottom":"1px solid transparent"}),CrmTracking.setPerfectScrollBar("allvisits","npopupInner")},CrmTracking.setPerfectScrollBar=function(e){var n=$("#"+e);n[0]&&(n.css({overflow:"hidden",position:"relative"}),thirdPartyUtils.unbindPerfectScroll("#"+e),thirdPartyUtils.bindPerfectScroll("#"+e,{wheelSpeed:1,wheelPropagation:!0,suppressScrollX:!1}))},CrmTracking.appendOnScroll=function(){var e=$("#noVisitDiv");if(!e.length||!e.is(":visible")){var n=$("#npopupInner");if(n.scrollTop()>=n.get(0).scrollHeight-n.get(0).clientHeight-100){var a=trackingCacheObj.zCrmLivedeskInfo,i=$("#visMain .notify-box").length,t=i||0;if(a.dkeys.length!=t){var r=CrmTracking.getCurrScreenName();n.append(CrmTracking.getVisOnScroll(a,t,void 0,r)),CrmTracking.initPerfectscroll()}}}},CrmTracking.showOpenPotInfo=function(e){var n=networkUtils.returnDependencyFiles(["crm-tracking-deals-info.js"],crmConstants.jsStaticPathForLyte),a=networkUtils.returnDependencyFiles(["crm-tracking-deals-info.css"],crmConstants.cssStaticPathForLyte),i=n.concat(a),t="/crm/extensions/v2/__internal/Contacts/"+e+"/deals_info",r={skip_load_tab:!0,success_callback:function(e){$("#entity").hide(),$("#vPotentialDet a").removeClass("vtab-active"),$("#openPotInfo").addClass("vtab-active");var n=$("#trackHistory");n.empty(),Lyte.Component.registeredComponents["crm-tracking-deals-info"]?(Lyte.Component.render("crm-tracking-deals-info",e,"#trackHistory"),n.show(),$("#potnInner").innerHeight()>"170"&&$("#potnOuter").css({height:"170px"}),CrmTracking.setPerfectScrollBar("potnOuter","potnInner"),CrmTracking.popBotPos("visHistory")):Lyte.injectResources(i,void 0,(function(){Lyte.Component.render("crm-tracking-deals-info",e,"#trackHistory"),n.show(),$("#potnInner").innerHeight()>"170"&&$("#potnOuter").css({height:"170px"}),CrmTracking.setPerfectScrollBar("potnOuter","potnInner"),CrmTracking.popBotPos("visHistory")}))}};networkUtils.makeRequest(t,"GET",r)},CrmTracking.showVisitHistory=function(e,n,a,i,t){var r="/crm/v2/Visits/online/"+encodeURIComponent(e),s={params:"morekey="+encodeURIComponent(n)+"&screenName="+encodeURIComponent(i),skip_load_tab:!0,success_callback:function(e){var n=e.RESPONSE;$("#vPotentialDet a").removeClass("vtab-active"),$(a).addClass("vtab-active"),$("#vhis").addClass("vtab-active");for(var i=renderingUtils.createHTML({name:"div",attr:{class:"timeline-head pL15 pR15"},child:[{name:"span",attr:{class:"fL tvhd tvhdp"},child:[{name:"text",content:I18n.getMsg("crm.livedesk.page")}]},{name:"span",attr:{class:"fR tvhd"},child:[{name:"text",content:I18n.getMsg("Time spent")}]},{name:"div",attr:{class:"clearB"}}]}),r={name:"div",attr:{id:"tvisits_outer",class:"pL15 pR15"},child:[{name:"div",attr:{class:"tvisits_inner"},child:[{name:"ul",attr:{class:"timeline-visits"}}]}]},s=n.length,l=[],o=0;o<s;o++){var c=n[o],d=c.p;if(4!=c.e&&5!=c.e){""==d&&"Visitor Left"!=d&&(d="Untitled");var m=0,g=0;if(0!=o){g=c.t;var v=n[o-1].t;m=Math.round((v-g)/6e4)}if("Visitor Left"!=d){var C={name:"li",child:[{name:"a",attr:{class:"tvpv",target:"_blank",title:d},child:[{name:"text",content:d}]},{name:"text",content:" "},{name:"span",attr:{class:"fR tvsp"}}]};CrmTracking.validateURL(c.h)&&(C.child[0].attr.href=c.h),0!=o&&(C.child[2].child=[{name:"text",content:m+" mins"}]),l.push(C)}}}r.child[0].child[0].child=l;var u=renderingUtils.createHTML(r);$("#trackHistory").html($(i).add($(u))).show("fast"),t&&CrmTracking.leftPanelAnimate(t),CrmTracking.popBotPos("visHistory");var k=$("#tvisits_outer");k.innerHeight()>"170"&&k.css({height:"170px"}),CrmTracking.setPerfectScrollBar("tvisits_outer","tvisits_inner")}};networkUtils.makeRequest(r,"GET",s)},CrmTracking.closeLeftPopup=function(){var e=$("#visHistory");e.length&&e.is(":visible")&&(e.css({left:"10px"}),$("#vPotentialDet").removeAttr("uvid"),$("#poparw").removeClass("ld-poparw-active"),$(".notify-box").removeClass("nb-active ldbb1"))},CrmTracking.remTrackingRelStuff=function(e){if(trackingCacheObj.zCrmLivedeskInfo&&trackingCacheObj.zCrmLivedeskInfo.data&&trackingCacheObj.zCrmLivedeskInfo.data[e]){var n=Object.keys(trackingCacheObj.zCrmLivedeskInfo.data[e]).length;for(var a in trackingCacheObj.zCrmLivedeskInfo.data[e]){var i=trackingCacheObj.zCrmLivedeskInfo.dkeys.indexOf(a);trackingCacheObj.zCrmLivedeskInfo.dkeys.splice(trackingCacheObj.zCrmLivedeskInfo.dkeys.indexOf(a),1),delete trackingCacheObj.zCrmLivedeskInfo.dkeys[i];var t=trackingCacheObj.zCrmLivedeskInfo.data[e][a].integdata;if(t){var r=t.ZohoCRM;if(r)if(r.Lead){var s=r.Lead.LEADID;delete trackingCacheObj.zCrmLivedeskInfo.entitiesOnline.Lead[s]}else if(r.Contact){s=r.Contact.CONTACTID;delete trackingCacheObj.zCrmLivedeskInfo.entitiesOnline.Contact[s]}}}delete trackingCacheObj.zCrmLivedeskInfo.data[e],cookieUtils.setCookie("zVisitCount",cookieUtils.getCookie("zVisitCount")-n);var l=CrmTracking.getVisitorCnt();CrmTracking.updateWCount(l,!0)}},CrmTracking.maximizePop=function(){if(CrmTracking.popupState)CrmTracking.minimizePop();else{var e=$("#wVisTitBar"),n=$("#wVisCount"),a=CrmTracking.getVisitorCnt(),i=$("#LDPOP");Crm.menu.globalHideMenu(),crmNTCGlobal.closeGlobalNotifications(),$("#remainder-notifi:visible").length>0&&Activities.showHideRemainder(),$("#feedBackPopup:visible").length&&hideFeedBackPopup(),$(".timericon").removeClass("footIconActive timericonAct"),e.addClass("ldchatPop_active"),CrmTracking.updateWCount(a,!1),e.removeClass("active_chat"),n.addClass("ldchat-gray");var t=trackingCacheObj.zCrmLivedeskInfo;t.config.vWinMinimized="false",trackingCacheObj.zCrmLivedeskInfo=t;var r=CrmTracking.getCurrScreenName();CrmTracking.renderVisits(void 0,void 0,r),CrmTracking.popupState=!0,CrmTracking.updateVisitHeadBg(),i.fadeIn("fast",(function(){i.css({bottom:"26px"})})),CrmTracking.initPerfectscroll(),CrmTracking.startVisitTimer(),Crm.trackSpotLightAction("Sales IQ - Visitors Online Click",{Count:a})}var s=document.getElementById("viewFeatures");if(s&&"none"!==s.style.display){var l=document.querySelector("#msgBoardDisplay .msg-board-icon"),o=document.getElementById("mics_stacked_carpet"),c=document.getElementById("mics_stacked_backdrop");s.style.display="none",l.classList.remove("msg-board-icon-active"),o.style.display="none",c.style.display="none",$L("html").removeClass("oH")}},CrmTracking.updateVisitHeadBg=function(){if(CrmTracking.popupState){var e=Crm.userDetails.SKIN_INFO.NEWBGCOLOR?Crm.userDetails.SKIN_INFO.NEWBGCOLOR:"#366dc7";$("#visTitBar .ldchatPopHead").css({"background-color":e})}},CrmTracking.updateWCount=function(e,n){var a=$("#wVisCount , #wVisCountHead");0==e?a.hide():1==e&&a.show();var i=e+"";trackingCacheObj.zCrmLivedeskInfo.countExceeded?(a.html(e+"+"),i=e+"+"):a.html(e),n&&isLoadedInCRMPlusIFrame()&&CrmPlusImpl.trigger("setNotificationCount",["visitors_online",i])},CrmTracking.minimizePop=function(){CrmTracking.stopVisitTimer(),CrmTracking.popupState=!1;var e=trackingCacheObj.zCrmLivedeskInfo;e.config.vWinMinimized="true",trackingCacheObj.zCrmLivedeskInfo=e;var n=$("#LDPOP");n.length&&n.css({bottom:"-"+n.innerHeight()+"px"}),$("#visHistory").css({left:"10px"}),$("#poparw").removeClass("ld-poparw-active"),$("#newVisit").removeClass("showmore-active").hide();var a=$("#allvisits");a.scrollTop(0),a.find(".ps-scrollbar-y").css({top:0}),$("#ldChatMultiplePortalSel")&&thirdPartyUtils.closeSelect2("ldChatMultiplePortalSel"),$("#wVisTitBar").removeClass("ldchatPop_active"),$("#wVisCount").addClass("ldchat-gray"),CrmTracking.updateWCount(CrmTracking.getVisitorCnt(),!1)},CrmTracking.getVisitorCnt=function(){if(trackingCacheObj.zCrmLivedeskInfo){var e=trackingCacheObj.zCrmLivedeskInfo.dkeys;return e.length?e.length:0}var n=cookieUtils.getCookie("zVisitCount");return n||0},CrmTracking.updVisitorCnt=function(e){var n=CrmTracking.getVisitorCnt(),a=0;n&&("VisitorLeft"==e?n>-1&&(a=parseInt(n)-1):a=parseInt(n)+1),0==a&&$("#wVisTitBar").removeClass("active_chat"),cookieUtils.setCookie("zVisitCount",a);var i=CrmTracking.getVisitorCnt();CrmTracking.updateWCount(i,!0)},CrmTracking.getFormatedName=function(e,n){var a=Crm.userDetails.NAME_FORMAT.split(",");return Crm.userDetails.NAME_FORMAT&&"Last Name"===a[1]?n+" "+e:e+" "+n},CrmTracking.handleConfDisable=function(e,n){CrmTracking.remTrackingRelStuff(e),n&&(delete trackingCacheObj.zCrmLivedeskInfo,CrmTracking.isSalesiqUser=!1,$("#LDPOP").hide(),$("#wVisTitBar").remove())},CrmTracking.popBotPos=function(e){var n=$("#"+e),a=$(window),i=$(".nb-active").offset().top-a.scrollTop()-$("#visTitBar").innerHeight(),t=$("#LDPOP").offset().top-a.scrollTop();n.offset().top+n.innerHeight()-a.scrollTop()>renderingUtils.windowHeight-25&&n.css({top:"auto",bottom:"5px"}),i<t&&n.css({top:"5px",bottom:"auto"})},CrmTracking.getCurrScreenName=function(){var e=$("#ldChatMultiplePortalSel").val();return"all"==e&&(e=void 0),e},CrmTracking.renderOnlineIcons=function(){try{CrmTracking.populateOnlineInfo("Leads"),CrmTracking.populateOnlineInfo("Contacts");var e=$("#show");e.on("mouseover",".online-entity",(function(){crmui.toolTip_show(this,"right",I18n.getMsg("crm.visit.currentlyonline"))})),e.on("mouseout",".online-entity",(function(){crmui.hideTooltip()}))}catch(e){console.log("error in renderOnlineIcons method")}},CrmTracking.getOnlineEntities=function(e){var n={Lead:"LEADID",Contact:"CONTACTID"},a={};if(trackingCacheObj.zCrmLivedeskInfo){if(trackingCacheObj.zCrmLivedeskInfo.entitiesOnline&&trackingCacheObj.zCrmLivedeskInfo.entitiesOnline[e])return trackingCacheObj.zCrmLivedeskInfo.entitiesOnline[e];var i=trackingCacheObj.zCrmLivedeskInfo.data;for(var t in i){var r=i[t];for(var s in r){var l=r[s].integdata;if(l){var o=l.ZohoCRM;if(o&&o[e])a[o[e][n[e]]]=r[s].link}}}trackingCacheObj.zCrmLivedeskInfo.entitiesOnline||(trackingCacheObj.zCrmLivedeskInfo.entitiesOnline={}),trackingCacheObj.zCrmLivedeskInfo.entitiesOnline[e]=a}return a},CrmTracking.populateOnlineInfo=function(e){if(trackingCacheObj.zCrmLivedeskInfo){var n=e.substring(0,e.length-1),a=CrmTracking.getOnlineEntities(n);for(var i in a)CrmTracking.insertOnlineIcon(i)}},CrmTracking.isEntityOnline=function(e,n){return""!=CrmTracking.getChatLink(e,n)},CrmTracking.getChatLink=function(e,n){var a="";try{if(("Leads"==e||"Contacts"==e)&&trackingCacheObj.zCrmLivedeskInfo){var i=e.substring(0,e.length-1),t=CrmTracking.getOnlineEntities(i);t[n]&&(a=crmConstants.livedeskURL+t[n])}}catch(e){console.log("Error in getChatLink method")}return a},CrmTracking.insertOnlineIcon=function(e){var n=$('[data-id="online-entity-'+e+'"]');if(n.length>0)n.addClass("online-entity");else if((n=$(".visitorOnlineBCView_"+e)).length>0)n.removeClass("dN");else{var a=crmListView.getObject().module;if("Leads"==a||"Contacts"==a){var i=$('[id="listView_'+e+'"]');i&&(n=$(renderingUtils.createHTML({name:"span",attr:{"data-id":"online-entity-"+e+"-lview",class:"online-entity vat"}})),i.before(n))}}},CrmTracking.removeOnlineIcon=function(e){var n=$('[data-id="online-entity-'+e+'-lview"]');n.length>0?n.remove():(n=$('[data-id="online-entity-'+e+'"]')).length>0?n.removeClass("online-entity"):(n=$(".visitorOnlineBcView")).length>0&&n.addClass("dN")},CrmTracking.updateEntitiesOnline=function(e,n,a){var i="",t="";n&&n.Lead&&e.entitiesOnline.Lead?(i="Lead",t=n.Lead.LEADID):n&&n.Contact&&e.entitiesOnline.Contact&&(i="Contact",t=n.Contact.CONTACTID),""!=t&&(a?(e.entitiesOnline[i][t]=a,CrmTracking.insertOnlineIcon(t)):(delete e.entitiesOnline[i][t],CrmTracking.removeOnlineIcon(t)))},function(){var e=Handlebars.template,n=Handlebars.templates=Handlebars.templates||{};n.OnlineVisitsInfo=e({1:function(e,n,a,i,t){var r;return" "+(null!=(r=a.if.call(null!=n?n:{},null!=n?n.isTelephonyEnabled:n,{name:"if",hash:{},fn:e.program(2,t,0),inverse:e.program(4,t,0),data:t}))?r:"")+" "},2:function(e,n,a,i,t){var r,s=null!=n?n:{},l=e.escapeExpression,o=e.lambda;return" <a href='javascript:;' class='ld-callicon' onclick=\"ctiApiNotifier.click2Call('"+l(a.encodeJS.call(s,null!=n?n.custNo:n,{name:"encodeJS",hash:{},data:t}))+"','"+(null!=(r=o(null!=n?n.zgid:n,n))?r:"")+"','"+(null!=(r=o(null!=n?n.userId:n,n))?r:"")+"','"+(null!=(r=o(null!=n?n.entityId:n,n))?r:"")+"','','"+l(a.encodeJS.call(s,null!=n?n.module:n,{name:"encodeJS",hash:{},data:t}))+"','"+l(a.encodeJS.call(s,null!=n?n.vName:n,{name:"encodeJS",hash:{},data:t}))+"'); sE(event);\"><i class='callIcon' id='calllabel1'></i></a> "},4:function(e,n,a,i,t){var r,s=null!=n?n:{};return null!=(r=a.if.call(s,a.isZPBenabled.call(s,{name:"isZPBenabled",hash:{},data:t}),{name:"if",hash:{},fn:e.program(5,t,0),inverse:e.program(7,t,0),data:t}))?r:""},5:function(e,n,a,i,t){var r,s=null!=n?n:{},l=e.escapeExpression;return"<a href='javascript:;' class='ld-callicon' onclick=\"crmCallsNew.initiateCallViaZPB('"+l(a.encodeJS.call(s,null!=n?n.custNo:n,{name:"encodeJS",hash:{},data:t}))+"','"+(null!=(r=e.lambda(null!=n?n.entityId:n,n))?r:"")+"','"+l(a.encodeJS.call(s,null!=n?n.module:n,{name:"encodeJS",hash:{},data:t}))+"','"+l(a.encodeJS.call(s,null!=n?n.vName:n,{name:"encodeJS",hash:{},data:t}))+"'); sE(event);\"><i class='callIcon' id='calllabel1'></i></a>"},7:function(e,n,a,i,t){var r;return'<a class="ld-callicon" title="'+e.escapeExpression(a.getI18n.call(null!=n?n:{},"crm.phoneNo.Link.Title",{name:"getI18n",hash:{},data:t}))+'" onclick="sE(event);" href="skype:+'+(null!=(r=e.lambda(null!=n?n.custNo:n,n))?r:"")+'?call"></a>'},9:function(e,n,a,i,t){return" <p><b class='ldchatVisTitle'>"+e.escapeExpression(e.lambda(null!=n?n.vName:n,n))+"</b></p> "},11:function(e,n,a,i,t){var r,s=e.lambda;return" <p><b class='ldchatVisTitle'><a target='_blank' onclick=\"sE(event);\" href='"+(null!=(r=s(null!=n?n.entityURL:n,n))?r:"")+"'>"+e.escapeExpression(s(null!=n?n.vName:n,n))+"</a></b></p> "},13:function(e,n,a,i,t){var r,s=e.lambda;return" <p><a target='_blank' onclick=\"sE(event);\" href='"+(null!=(r=s(null!=n?n.accEntityURL:n,n))?r:"")+"'>"+e.escapeExpression(s(null!=n?n.vComp:n,n))+"</a></p> "},15:function(e,n,a,i,t){var r=e.escapeExpression;return" <div class='ldeskpv' title=\""+r(a.getI18n.call(null!=n?n:{},"crm.livedesk.portal",{name:"getI18n",hash:{},data:t}))+'">'+r(e.lambda(null!=n?n.portalName:n,n))+"</div> "},17:function(e,n,a,i,t){var r,s=e.lambda;return" <div class='vpotential-row' title='"+e.escapeExpression(a.getI18n.call(null!=n?n:{},"Expected Revenue",{name:"getI18n",hash:{},data:t}))+"'>"+(null!=(r=s(null!=n?n.symbol:n,n))?r:"")+(null!=(r=s(null!=n?n.vRevenue:n,n))?r:"")+"</div> "},19:function(e,n,a,i,t){var r;return" "+(null!=(r=a.ifEquals.call(null!=n?n:{},null!=n?n.module:n,"Customer",{name:"ifEquals",hash:{},fn:e.program(20,t,0),inverse:e.program(22,t,0),data:t}))?r:"")+" "},20:function(e,n,a,i,t){var r,s=e.lambda;return" <div class='vpotential-row' title='"+e.escapeExpression(a.getI18n.call(null!=n?n:{},"Closed Won",{name:"getI18n",hash:{},data:t}))+"'>"+(null!=(r=s(null!=n?n.symbol:n,n))?r:"")+(null!=(r=s(null!=n?n.vRevenue:n,n))?r:"")+"</div> "},22:function(e,n,a,i,t){return" <div class='vcountry-row'><i class='ldicon icountry'></i>"+e.escapeExpression(e.lambda(null!=n?n.vCountry:n,n))+"</div> "},24:function(e,n,a,i,t){var r=e.escapeExpression,s=e.lambda;return" <div class='vinfo-row pB5'><div class='fL'><span class='now-in'>"+r(a.getI18n.call(null!=n?n:{},"crm.livedesk.nowin",{name:"getI18n",hash:{},data:t}))+"</span><a class='mL10 siq-link' target='_blank' rel=\"noopener noreferrer\" title='"+r(s(null!=n?n.orgCpageTitle:n,n))+"' href='"+r(s(null!=n?n.cpage:n,n))+"' onclick='sE(event)'>"+r(s(null!=n?n.cpageTitle:n,n))+"</a></div><div class='clearB'></div></div> "},26:function(e,n,a,i,t){var r=e.escapeExpression,s=e.lambda;return" <div class='vinfo-row'><div class='fL'><span class='now-in'>"+r(a.getI18n.call(null!=n?n:{},"crm.livedesk.nowin",{name:"getI18n",hash:{},data:t}))+"</span><span class='mL10' target='_blank' title='"+r(s(null!=n?n.orgCpageTitle:n,n))+"'>"+r(s(null!=n?n.cpageTitle:n,n))+"</span></div><div class='clearB'></div></div> "},28:function(e,n,a,i,t){var r,s=e.lambda;return' <span class="fL" id=\''+(null!=(r=s(null!=n?n.uId:n,n))?r:"")+"_hourDiv' ><span id='"+(null!=(r=s(null!=n?n.uId:n,n))?r:"")+"_hours'>"+(null!=(r=s(null!=n?n.zeroAddedHour:n,n))?r:"")+"</span>:</span> "},30:function(e,n,a,i,t){var r,s=e.lambda;return' <span class="fL" id=\''+(null!=(r=s(null!=n?n.uId:n,n))?r:"")+"_hourDiv' style='display:none;'><span id='"+(null!=(r=s(null!=n?n.uId:n,n))?r:"")+"_hours'>"+(null!=(r=s(null!=n?n.zeroAddedHour:n,n))?r:"")+"</span>:</span> "},compiler:[7,">= 4.0.0"],main:function(e,n,a,i,t){var r,s=e.lambda,l=null!=n?n:{},o=e.escapeExpression;return" <div class='notify-box' id='"+(null!=(r=s(null!=n?n.uId:n,n))?r:"")+"' zptname='"+(null!=(r=s(null!=n?n.screenName:n,n))?r:"")+"' onclick=\"CrmTracking.fillRelatedInfo('"+(null!=(r=s(null!=n?n.uId:n,n))?r:"")+"','"+(null!=(r=s(null!=n?n.unChangedMod:n,n))?r:"")+"',this)\"> <div> <div class='ldvisitname pR'> <i title='"+o(a.getI18n.call(l,null!=n?n.i18nKey:n,{name:"getI18n",hash:{},data:t}))+"' class='"+o(s(null!=n?n.classForTitle:n,n))+"'></i> <a target='_blank' title=\""+o(a.getI18n.call(l,"Chat",{name:"getI18n",hash:{},data:t}))+"\" class='chatsingle ld-chat-icon' onclick=\"sE(event);Crm.trackSpotLightAction('Sales IQ - Chat Click');\" href='"+o(s(null!=n?n.chatLink:n,n))+"'></a> "+(null!=(r=a.ifNotEquals.call(l,null!=n?n.custNo:n,"",{name:"ifNotEquals",hash:{},fn:e.program(1,t,0),inverse:e.noop,data:t}))?r:"")+" "+(null!=(r=a.ifEquals.call(l,null!=n?n.module:n,"UnKnown",{name:"ifEquals",hash:{},fn:e.program(9,t,0),inverse:e.program(11,t,0),data:t}))?r:"")+" "+(null!=(r=a.ifNotEquals.call(l,null!=n?n.module:n,"",{name:"ifNotEquals",hash:{},fn:e.program(13,t,0),inverse:e.noop,data:t}))?r:"")+" "+(null!=(r=a.if.call(l,null!=n?n.isPortalNameNeeded:n,{name:"if",hash:{},fn:e.program(15,t,0),inverse:e.noop,data:t}))?r:"")+" <div class='clearB'></div></div> "+(null!=(r=a.ifEquals.call(l,null!=n?n.module:n,"Potentials",{name:"ifEquals",hash:{},fn:e.program(17,t,0),inverse:e.program(19,t,0),data:t}))?r:"")+" "+(null!=(r=a.ifNotEquals.call(l,null!=n?n.cpage:n,"",{name:"ifNotEquals",hash:{},fn:e.program(24,t,0),inverse:e.program(26,t,0),data:t}))?r:"")+" <div class='fL vpvr vpbl'></div><div class='clearB'></div> <div class='fL vpvl'><span class='gray6'>"+o(a.getI18n.call(l,"crm.visit.pagesvisited",{name:"getI18n",hash:{},data:t}))+"</span><strong class='pL10'>"+o(s(null!=n?n.pagesVisited:n,n))+" "+o(a.getI18n.call(l,"Pages",{name:"getI18n",hash:{},data:t}))+"</strong></div> <div class='fL pL25'> <i class='ldicon ldtimespent fL'></i> "+(null!=(r=a.ifCond.call(l,null!=n?n.hours:n,">",0,{name:"ifCond",hash:{},fn:e.program(28,t,0),inverse:e.program(30,t,0),data:t}))?r:"")+" <span id='"+(null!=(r=s(null!=n?n.uId:n,n))?r:"")+"_minutes'>"+(null!=(r=s(null!=n?n.zeroAddedminute:n,n))?r:"")+"</span>:<span id='"+(null!=(r=s(null!=n?n.uId:n,n))?r:"")+"_seconds'>"+(null!=(r=s(null!=n?n.zeroAddedSecond:n,n))?r:"")+"</span> </div> <div class='fL vpvr vpbl'></div><div class='clearB'></div> <div class='vinfo-row'> <div class='fL vpvl ldlh1'><span class='gray6'>"+o(a.getI18n.call(l,"crm.livedesk.days.visited",{name:"getI18n",hash:{},data:t}))+"</span><br><span class='ldlh2'>"+o(s(null!=n?n.vDaysVisit:n,n))+"</span></div> <div class='fL vpvr vpvl vpbl ldlh1' title='"+o(s(null!=n?n.dateOnHover:n,n))+"'> <span class='gray6'>"+o(a.getI18n.call(l,"crm.visit.lastvisited",{name:"getI18n",hash:{},data:t}))+"</span> <br> <span class='ldlh2'>"+o(s(null!=n?n.lvtimeInDays:n,n))+"</span> </div> <div class='fL vpvr vpvl vpbl ldlh1'> <span class='gray6'>"+o(a.getI18n.call(l,"Visitor Score",{name:"getI18n",hash:{},data:t}))+"</span> <br> <span class='ldlh2'>"+o(s(null!=n?n.vScore:n,n))+"</span> </div> <div class='clearB'></div> </div> </div> <div class='clearB'></div> </div> "},useData:!0}),n.OnlineVisitsPortalDD=e({1:function(e,n,a,i,t){var r=e.lambda,s=e.escapeExpression;return' <option value="'+s(r(t&&t.key,n))+'">'+s(r(n,n))+"</option> "},compiler:[7,">= 4.0.0"],main:function(e,n,a,i,t){var r,s=null!=n?n:{};return' <option value="all">'+e.escapeExpression(a.getI18n.call(s,"crm.salesiq.all.accounts",{name:"getI18n",hash:{},data:t}))+"</option> "+(null!=(r=a.each.call(s,n,{name:"each",hash:{},fn:e.program(1,t,0),inverse:e.noop,data:t}))?r:"")+" "},useData:!0}),n.OnlineVisitsRelatedInfo=e({1:function(e,n,a,i,t){var r,s=null!=n?n:{};return" <a href='javascript:;' id='openPotInfo' onclick=\"CrmTracking.showOpenPotInfo('"+(null!=(r=e.lambda(null!=n?n.entityId:n,n))?r:"")+"')\" class='fl f14 visitorHistory pL10'>"+(null!=(r=a.getI18n.call(s,"crm.livedesk.info",a.encodeJS.call(s,null!=n?n.potPlural:n,{name:"encodeJS",hash:{},data:t}),{name:"getI18n",hash:{},data:t}))?r:"")+"</a> "},compiler:[7,">= 4.0.0"],main:function(e,n,a,i,t){var r,s=e.lambda,l=null!=n?n:{};return" <div class='ldwrap pT15 pB15' id='vPotentialDet' uvid='"+(null!=(r=s(null!=n?n.uid:n,n))?r:"")+"' style='display: block;'><div class='pR vinfotab f14 pB5 pL15 pR15'> <a href='javascript:;' id='vhis' onclick=\"CrmTracking.showVisitHistory('"+(null!=(r=s(null!=n?n.uuid:n,n))?r:"")+"','"+(null!=(r=s(null!=n?n.morekeys:n,n))?r:"")+"',this,'"+(null!=(r=s(null!=n?n.screenName:n,n))?r:"")+"')\" class='fl f14 visitorHistory mR10 vtab-active'>"+e.escapeExpression(a.getI18n.call(l,"Visit History",{name:"getI18n",hash:{},data:t}))+"</a> "+(null!=(r=a.ifCondLogic.call(l,null!=n?n.entityId:n,"!=","","&&",null!=n?n.isPotPresent:n,"=","true",{name:"ifCondLogic",hash:{},fn:e.program(1,t,0),inverse:e.noop,data:t}))?r:"")+" <div class='pR'><span onclick='CrmTracking.closeLeftPopup()' class='newPopupCloseIcon svgIcons ico-close-small2 cP op08 pA' style='right:0; top:0'></span></div><div class='clearB'></div></div> <div class='p0 pT20 bT2 tv-wrap pB20' id='trackHistory'></div> </div>"},useData:!0})}();