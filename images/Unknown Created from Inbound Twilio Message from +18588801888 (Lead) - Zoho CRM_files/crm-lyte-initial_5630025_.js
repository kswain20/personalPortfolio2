var app={windowRect:{innerWidth:window.innerWidth,innerHeight:window.innerHeight,outerWidth:window.outerWidth,outerHeight:window.outerHeight},uiCompLocale:["bg_BG","cs_CZ","da_DK","de_DE","en_GB","en_US","es_ES","fr_FR","he_IL","hi_IN","hr_HR","hu_HU","it_IT","iw_IL","ja_JP","ko_KR","nl_NL","pl_PL","pt_BR","pt_PT","ru_RU","sv_SE","tr_TR","vi_VN","zh_CN","zh_TW","ar_EG"],cruxCompLocale:["bg_BG","cs_CZ","da_DK","de_DE","en_GB","en_US","es_ES","fr_FR","he_IL","hi_IN","hr_HR","hu_HU","it_IT","iw_IL","ja_JP","ko_KR","nl_NL","pl_PL","pt_BR","pt_PT","ru_RU","sv_SE","tr_TR","vi_VN","zh_CN","zh_TW","ar_EG"],cachedModulePromises:{},reqCache:{},_cscript_registry:{_cat_pages:{},_definitions:{}},cscript_registry:function(e){e.config.forEach((function(t){t.route_name=e.route_name,t.category=e.category,app._cscript_registry._definitions[t.route_name]?app._cscript_registry._definitions[t.route_name].push(t):app._cscript_registry._definitions[t.route_name]=[t]}))},globalClickhandling:function(e){var t=$(".profOptionList");t.is(":visible")&&t.hide();var r=null;r=(r=renderingUtils.getTargetElem(e))||document.getElementById("show");var i=$("#qCreate");if(!Crm.isHeadless&&crmNTC.isSignalDetailViewVisible()){void 0!==r&&"signalDetailViewClose"===r.id&&crmNTCDetailView.closeDetailView(),"undefined"===r.id||"signalsActivityDiv"===r.id||i.is(":visible")&&$("#eventCreatePopup").is(":visible")&&$("#createEditCallDiv").is(":visible")||(getElemById("signalsActivityDiv").style.display="none")}else if($("#notificationscontainer").hasClass("open")){crmNTCGlobal.closeGlobalNotifications(),$(".notifiactionIcon").removeClass("notifiactionIconH"),$("#notifications_inner").empty(),AcsApi.resetBadgeCount("UNS");var a=$("#signalsActivityDiv");a.is(":visible")&&a.hide()}var s=$("#recentMailsDiv")[0];if(s&&"block"==s.style.display){for(var o=e||window.event,n=o.target||o.srcElement;n;){if("calenDiv"==n.id){var l=1;break}n=n.parentNode}l||(document.body.removeChild(s),$(".mailIc").attr("class","mailIc"))}var c=$("#diNotificationDiv");c.is(":visible")&&(CrmIntelligence.toFooter(c),CrmIntelligence.hideDiNotification());var d=$("#LDPOP");d.length&&d.is(":visible")&&CrmTracking.minimizePop()},renderTemplate:function(e,t){if(e&&t){var r,i=e.currentModel;if(e.ORoutlet=r=function e(t,r){var i;if(r){if(!(i=r.outlet?r.outlet.querySelector(t):void 0))return e(t,r.parent)}else(i=document.querySelector(t))||console.error("There is no outlet named "+t+".");return i}(t.outlet,e.parent)){var a={outlet:t.outlet,route:e};if(e.transition.data&&e.transition.data.refreshTemplate&&(e.ORComponent&&delete e.ORComponent,delete e.transition.data.refreshTemplate),t.component)if(e.ORComponent&&!t.reRender&&e.ORComponent.tagName.toLocaleLowerCase()==t.component&&e.ORoutlet==r&&r.contains(e.ORComponent))n(e.ORComponent,i);else{Lyte.triggerEvent("beforeTemplateDestroy",a);var s=document.createElement(t.component);s._route=e.__lp.objPath,n(s,i),r.innerHTML="",r.appendChild(e.ORComponent=s)}else if(t.html){e.ORComponent=void 0,Lyte.triggerEvent("beforeTemplateDestroy",a),r.innerHTML=t.html;var o=r.getElementsByTagName("script");o.length&&function(e){for(var t,r=0;t=e[r];r++){for(var i,a=t.parentNode,s=document.createElement("script"),o=0;i=t.attributes[o];o++)s.setAttribute(i.name,i.value);s.innerHTML=t.innerHTML,a.appendChild(s),a.removeChild(t)}}(Array.from(o))}}}function n(e,t){t&&("object"!=typeof t||Array.isArray(t)?console.error("Invalid data passed to a component :"+e+"."):e.setData(t))}},localHistory:[],listViewLinkedRoutes:["crm.settings.section.custom-view","crm.tab.module.create","crm.tab.module.entity.detail","crm.tab.module.entity.edit","crm.tab.module.entity.find-and-merge","crm.settings.import","crm.tab.module.actions.mass-tools","crm.settings.section.manage-tags","crm.settings.section.manage-mass-mail","crm.settings.section.autoresponders","crm.tab.module.actions"],newSubVersion:0};Lyte.Mixin.register("crux-filter-utils",{_cruxReplace:Lyte.Component.registeredHelpers.cruxReplace,specialfield:function(e,t,r,i,a,s,o){var n,l,c,d,u={UMT:{field:{api_name:"User_Modified_Time",id:""},comparator:null,value:null},SMT:{field:{api_name:"System_Modified_Time",id:""},comparator:null,value:null},URAT:{field:{api_name:"User_Related_Activity_Time",id:""},comparator:null,value:null},SRAT:{field:{api_name:"System_Related_Activity_Time",id:""},comparator:null,value:null},LAT:{field:{api_name:"Last_Activity_Time",id:""},comparator:null,value:null}};if("cxFilter_TouchedRecords"==e.api_name)"-1"!=t.indexOf("User")&&(u.UMT.comparator=u.URAT.comparator=i,u.UMT.value=u.URAT.value=r,l=this.construct_group(u.UMT,u.URAT,"OR"),n=JSON.parse(JSON.stringify(l)),"-1"!=t.indexOf("Only")?(u.SMT.comparator=u.SRAT.comparator="equal"==i?"not_equal":"less_than"==i||"less_equal"==i?"greater_than":"",u.SMT.value=u.SRAT.value=r,l=JSON.parse(JSON.stringify(u.SMT)),c=JSON.parse(JSON.stringify(u.SRAT)),"greater_than"==u.SMT.comparator&&(u.SMT.comparator=u.SRAT.comparator="equal",u.SMT.value=u.SRAT.value="${EMPTY}",l=this.construct_group(l,u.SMT,"OR"),c=this.construct_group(c,u.SRAT,"OR")),d=this.construct_group(l,c,"AND"),n=this.construct_group(n,d,"AND")):(u.UMT.comparator="not_equal",u.UMT.value="${EMPTY}",n=this.construct_group(n,u.UMT,"AND"))),"-1"!=t.indexOf("System")&&(u.SMT.comparator=u.SRAT.comparator=i,u.SMT.value=u.SRAT.value=r,c=this.construct_group(u.SMT,u.SRAT,"OR"),n=JSON.parse(JSON.stringify(c)),"-1"!=t.indexOf("Only")?(u.UMT.comparator=u.URAT.comparator="equal"==i?"not_equal":"less_than"==i||"less_equal"==i?"greater_than":"",u.UMT.value=u.URAT.value=r,l=JSON.parse(JSON.stringify(u.UMT)),c=JSON.parse(JSON.stringify(u.URAT)),"greater_than"==u.UMT.comparator&&(u.UMT.comparator=u.URAT.comparator="equal",u.UMT.value=u.URAT.value="${EMPTY}",l=this.construct_group(l,u.UMT,"OR"),c=this.construct_group(c,u.URAT,"OR")),d=this.construct_group(l,c,"AND"),n=this.construct_group(n,d,"AND")):(u.SMT.comparator="not_equal",u.SMT.value="${EMPTY}",n=this.construct_group(n,u.SMT,"AND"))),"-1"!=t.indexOf("And")&&(n=this.construct_group(l,c,"AND")),-1!=t.indexOf("Or")&&(n=this.construct_group(l,c,"OR"));else if("cxFilter_UnTouchedRecords"==e.api_name){if("-1"!=t.indexOf("User")){u.UMT.comparator=u.URAT.comparator="equal"==i?"not_equal":"less_than"==i||"less_equal"==i?"greater_than":"",u.UMT.value=u.URAT.value=r;var m=JSON.parse(JSON.stringify(u));u.UMT.comparator=u.URAT.comparator="equal",u.UMT.value=u.URAT.value="${EMPTY}",d=this.construct_group(m.UMT,u.UMT,"OR"),l=this.construct_group(m.URAT,u.URAT,"OR"),n=l=this.construct_group(d,l,"AND"),"-1"!=t.indexOf("Only")&&(u.SMT.comparator=u.SRAT.comparator=i,u.SMT.value=u.SRAT.value=r,n=this.construct_group(u.SMT,u.SRAT,"OR"),n=this.construct_group(l,n,"AND"))}if("-1"!=t.indexOf("System")){u.SMT.comparator=u.SRAT.comparator="equal"==i?"not_equal":"less_than"==i||"less_equal"==i?"greater_than":"",u.SMT.value=u.SRAT.value=r;m=JSON.parse(JSON.stringify(u));u.SMT.comparator=u.SRAT.comparator="equal",u.SMT.value=u.SRAT.value="${EMPTY}",d=this.construct_group(m.SMT,u.SMT,"OR"),c=this.construct_group(m.SRAT,u.SRAT,"OR"),n=c=this.construct_group(d,c,"AND"),"-1"!=t.indexOf("Only")&&(u.UMT.comparator=u.URAT.comparator=i,u.UMT.value=u.URAT.value=r,n=this.construct_group(u.UMT,u.URAT,"OR"),n=this.construct_group(c,n,"AND"))}"-1"!=t.indexOf("Or")&&(n=this.construct_group(l,c,"OR")),"-1"!=t.indexOf("And")&&(n=this.construct_group(l,c,"AND"))}else if("cxFilter_RecordAction"==e.api_name){a=a;if("-1"!=t.indexOf("User"))if("modified"==a.toLowerCase())u.UMT.comparator=i,u.UMT.value=r,l=JSON.parse(JSON.stringify(u.UMT)),n=JSON.parse(JSON.stringify(l)),"-1"!=t.indexOf("Only")&&(u.SMT.comparator="equal"==i?"not_equal":"less_than"==i||"less_equal"==i?"greater_than":"",u.SMT.value=r,d=JSON.parse(JSON.stringify(u.SMT)),"greater_than"==u.SMT.comparator&&(u.SMT.comparator="equal",u.SMT.value="${EMPTY}",d=this.construct_group(d,u.SMT,"OR")),n=this.construct_group(n,d,"AND"));else{u.UMT.comparator="equal"==i?"not_equal":"less_than"==i||"less_equal"==i?"greater_than":"",u.UMT.value=r;m=JSON.parse(JSON.stringify(u));u.UMT.comparator="equal",u.UMT.value="${EMPTY}",l=this.construct_group(m.UMT,u.UMT,"OR"),n=JSON.parse(JSON.stringify(l)),"-1"!=t.indexOf("Only")&&(u.SMT.comparator=i,u.SMT.value=r,n=this.construct_group(n,u.SMT,"AND"))}if("-1"!=t.indexOf("System"))if(a&&"modified"==a.toLowerCase())u.SMT.comparator=i,u.SMT.value=r,c=JSON.parse(JSON.stringify(u.SMT)),n=JSON.parse(JSON.stringify(c)),"-1"!=t.indexOf("Only")&&(u.UMT.comparator="equal"==i?"not_equal":"less_than"==i||"less_equal"==i?"greater_than":"",u.UMT.value=r,d=JSON.parse(JSON.stringify(u.UMT)),"greater_than"==u.UMT.comparator&&(u.UMT.comparator="equal",u.UMT.value="${EMPTY}",d=this.construct_group(d,u.UMT,"OR")),n=this.construct_group(n,d,"AND"));else{u.SMT.comparator="equal"==i?"not_equal":"less_than"==i||"less_equal"==i?"greater_than":"",u.SMT.value=r;m=JSON.parse(JSON.stringify(u));u.SMT.comparator="equal",u.SMT.value="${EMPTY}",n=c=this.construct_group(m.SMT,u.SMT,"OR"),"-1"!=t.indexOf("Only")&&(u.UMT.comparator=i,u.UMT.value=r,n=this.construct_group(c,u.UMT,"AND"))}"-1"!=t.indexOf("Or")&&(n=this.construct_group(l,c,"OR")),"-1"!=t.indexOf("And")&&(n=this.construct_group(l,c,"AND"))}else if("cxFilter_RelatedRecordsAction"==e.api_name){a=a;if("-1"!=t.indexOf("User"))if("done"==a.toLowerCase()||"modified"==a.toLowerCase())u.URAT.comparator=i,u.URAT.value=r,l=JSON.parse(JSON.stringify(u.URAT)),n=JSON.parse(JSON.stringify(l)),"-1"!=t.indexOf("Only")&&(u.SRAT.comparator="equal"==i?"not_equal":"less_than"==i||"less_equal"==i?"greater_than":"",u.SRAT.value=r,l=JSON.parse(JSON.stringify(u.SRAT)),"greater_than"==u.SRAT.comparator&&(u.SRAT.comparator="equal",u.SRAT.value="${EMPTY}",l=this.construct_group(l,u.SRAT,"OR")),n=this.construct_group(n,l,"AND"));else{u.URAT.comparator="equal"==i?"not_equal":"less_than"==i||"less_equal"==i?"greater_than":"",u.URAT.value=r;m=JSON.parse(JSON.stringify(u));u.URAT.comparator="equal",u.URAT.value="${EMPTY}",n=l=this.construct_group(m.URAT,u.URAT,"OR"),"-1"!=t.indexOf("Only")&&(u.SRAT.comparator=i,u.SRAT.value=r,n=this.construct_group(l,u.SRAT,"AND"))}if("-1"!=t.indexOf("System"))if("done"==a.toLowerCase()||"modified"==a.toLowerCase())u.SRAT.comparator=i,u.SRAT.value=r,c=JSON.parse(JSON.stringify(u.SRAT)),n=JSON.parse(JSON.stringify(c)),"-1"!=t.indexOf("Only")&&(u.URAT.comparator="equal"==i?"not_equal":"less_than"==i||"less_equal"==i?"greater_than":"",u.URAT.value=r,c=JSON.parse(JSON.stringify(u.URAT)),"greater_than"==u.URAT.comparator&&(u.URAT.comparator="equal",u.URAT.value="${EMPTY}",c=this.construct_group(c,u.URAT,"OR")),n=this.construct_group(n,c,"AND"));else{u.SRAT.comparator="equal"==i?"not_equal":"less_than"==i||"less_equal"==i?"greater_than":"",u.SRAT.value=r;m=JSON.parse(JSON.stringify(u));u.SRAT.comparator="equal",u.SRAT.value="${EMPTY}",n=c=this.construct_group(m.SRAT,u.SRAT,"OR"),"-1"!=t.indexOf("Only")&&(u.URAT.comparator=i,u.URAT.value=r,n=this.construct_group(c,u.URAT,"AND"))}"-1"!=t.indexOf("Or")&&(n=this.construct_group(l,c,"OR")),"-1"!=t.indexOf("And")&&(n=this.construct_group(l,c,"AND"))}else if("cxFilter_Email_Status"==e.api_name){u={LAT:{field:{api_name:"LAST_ACTION_TIME",id:""},comparator:null,value:null},LST:{field:{api_name:"LAST_SENT_TIME",id:""},comparator:null,value:null},GEN_FORMAT:{field:{api_name:"LAST_ACTION",id:""},comparator:null,value:null}};var p,g=t,f=!0;if("sent"==g?(p=a,u.LST.comparator=i,u.LST.value=r,f="any_of_the_above"!=p,l=JSON.parse(JSON.stringify(u.LST)),g=p):"not_sent"==g?(u.LST.comparator="${EMPTY}"==r?i:this.negative_Comparator(i),u.LST.value=r,l=JSON.parse(JSON.stringify(u.LST)),"greater_than"!=u.LST.comparator&&"greater_equal"!=u.LST.comparator||(u.LST.comparator,u.LST.comparator="equal",u.LST.value="${EMPTY}",l=this.construct_group(l,u.LST,"OR"))):(u.LAT.value=r,("not_opened"==g||"not_received"==g)&!p?(u.LAT.comparator=this.negative_Comparator(i),l=JSON.parse(JSON.stringify(u.LAT)),"greater_than"!=u.LAT.comparator&&"greater_equal"!=u.LAT.comparator||(u.LAT.comparator,u.LAT.comparator="equal",u.LAT.value="${EMPTY}",l=this.construct_group(l,u.LAT,"OR"))):(u.LAT.comparator=i,l=JSON.parse(JSON.stringify(u.LAT)))),f){u.GEN_FORMAT.comparator="equal",u.GEN_FORMAT.value="${EMPTY}"==r?r:{responded:["Responded"],clicked:["Clicked"],opened:["Opened","Clicked","Responded"],not_opened:["Opened","Clicked","Responded","Bounced"],bounced:["Bounced"],opened_and_not_replied:["Opened","Clicked"],not_sent:["Opened","Clicked","Sent","Replied","Bounced"],received:["Received","Responded"],not_received:["Received","Responded"]}[g];var h="AND";"not_opened"!=g&&"not_sent"!=g&&"not_received"!=g||(u.GEN_FORMAT.comparator="${EMPTY}"==r?"equal":"not_equal",h="not_opened"==g&&p?h:"OR",h="${EMPTY}"==u.GEN_FORMAT.value?"AND":h),n=this.construct_group(l,u.GEN_FORMAT,h),"not_opened"==g&&(u.LST.comparator="not_equal",u.LST.value="${EMPTY}",n=this.construct_group(n,u.LST,"AND"))}else n=this.construct_group(l,null)}else if("cxFilter_Activities"==e.api_name){u={TASKS:[{status:{field:{api_name:"Status",id:""},comparator:"not_equal",value:"${PICKLIST.Completed}"}},{Due_Date:{field:{api_name:"Due_Date",id:""},comparator:"equal",value:"${YESTERDAYMINUS}"}}],CALLS:[{status:{field:{api_name:"Call_Status",id:""},comparator:"equal",value:"Overdue"}},{Call_Start_Date_Time:{field:{api_name:"Call_Start_Time",id:""},comparator:"less_than",value:"${CURRENTTIME}"}}],EVENTS:{field:{api_name:"End_DateTime",id:""},comparator:null,value:"${TODAY}"}};var y={field:{api_name:"Activity_Type"},comparator:"equal",value:""};if((D={}).include_objects=!0,"Tasks"!=t&&"Activities"!=t||(l=this.construct_group(u.TASKS[0].status,u.TASKS[1].Due_Date,"AND"),y.value="Tasks",n=l=this.construct_group(l,y,"AND")),"Calls"!=t&&"Activities"!=t||(c=this.construct_group(u.CALLS[0].status,u.CALLS[1].Call_Start_Date_Time,"AND"),y.value="Calls",n=c=this.construct_group(c,y,"AND")),"Activities"==t)n=this.construct_group(l,c,"OR");else if("Without_Open_Activity"==t){D.include_objects=!1,u.CALLS[0].status.comparator="equal",u.CALLS[0].status.value=["scheduled","overdue"],y.value="Calls";var v=this.construct_group(u.CALLS[0].status,y,"AND");y.value="Tasks";var _=this.construct_group(u.TASKS[0].status,y,"AND");l=this.construct_group(v,_,"OR"),u.EVENTS.comparator="greater_equal",u.EVENTS.value="${CURRENTTIME}",y.value="Events";var b=this.construct_group(u.EVENTS,y,"AND");n=this.construct_group(l,b,"OR")}else if("Activity_Due"==t){u.TASKS[1].Due_Date.comparator=i,u.TASKS[1].Due_Date.value=r,l=this.construct_group(u.TASKS[0].status,u.TASKS[1].Due_Date,"AND"),y.value="Tasks",l=this.construct_group(l,y,"AND"),u.CALLS[0].status.comparator="equal",u.CALLS[0].status.value=["Scheduled","Overdue"],u.CALLS[1].Call_Start_Date_Time.comparator=i,u.CALLS[1].Call_Start_Date_Time.value=r,c=this.construct_group(u.CALLS[0].status,u.CALLS[1].Call_Start_Date_Time,"AND"),y.value="Calls",c=this.construct_group(c,y,"AND"),d=this.construct_group(l,c,"OR"),"${TODAYANDOVERDUE}"==r&&(i="equal",r="${TODAY}"),u.EVENTS.comparator=i,u.EVENTS.value=r,y.value="Events";b=this.construct_group(u.EVENTS,y,"AND");n=this.construct_group(d,b,"OR")}else if("Without_Any_Activity"==t)D.include_objects=!1,n={field:{api_name:"Modified_Time",id:""},comparator:i,value:r};else if("Activity_Done"==t){d={field:{api_name:"Closed_Time",id:""},comparator:i,value:r},y.value="Tasks",d=this.construct_group(d,y,"AND"),u.CALLS[0].status.comparator="not_equal",u.CALLS[0].status.value=["Scheduled","Overdue"],u.CALLS[1].Call_Start_Date_Time.comparator=i,u.CALLS[1].Call_Start_Date_Time.value=r,l=this.construct_group(u.CALLS[0].status,u.CALLS[1].Call_Start_Date_Time,"AND"),y.value="Calls",l=this.construct_group(l,y,"AND"),d=this.construct_group(d,l,"OR"),u.EVENTS.comparator=i,u.EVENTS.value=r,y.value="Events";b=this.construct_group(u.EVENTS,y,"AND");n=this.construct_group(d,b,"OR")}D.relation={},D.relation.relation_id=moduleRecordMapping.Activities.id,D.relation.api_name=moduleRecordMapping.Activities.api_name,D.criteria=n,n=D}else if("cxFilter_Notes"==e.api_name)(D={}).include_objects=!0,"Without_Any_Notes"==t&&(D.include_objects=!1),D.relation={},D.relation.relation_id=moduleRecordMapping.Notes.id,D.relation.api_name=moduleRecordMapping.Notes.api_name,D.criteria={field:{api_name:"Created_Time",id:""},comparator:i,value:r},n=D;else if("cxFilter_Deals"==e.api_name)u=[{field:{api_name:"Stage",id:""},comparator:"equal",value:"${OPEN}"},{field:{api_name:"Created_Time",id:""},comparator:"",value:""}],(D={}).include_objects=!0,"Without_Open_Deal"==t&&(D.include_objects=!1),"With_Open_Deal"==t||"Without_Open_Deal"==t?(u[1].comparator=i,u[1].value=r,n=this.construct_group(u[0],u[1],"AND")):(D.include_objects=!1,u[1].field.api_name="Deal_Name",u[1].comparator="not_equal",u[1].value="${EMPTY}",n=u[1]),D.relation={},D.relation.relation_id=moduleRecordMapping.Potentials.id,D.relation.api_name=moduleRecordMapping.Potentials.api_name,D.criteria=n,n=D;else if("cxFilter_Contacts"==e.api_name)(D={}).include_objects=!0,"Without_Any_Contact"==t&&(D.include_objects=!1),D.relation={},D.relation.relation_id=moduleRecordMapping.Contacts.id,D.relation.api_name=moduleRecordMapping.Contacts.api_name,D.criteria={field:{api_name:"Full_Name",id:""},comparator:"not_equal",value:"${EMPTY}"},n=D;else if("cxFilter_Chats"==e.api_name){(D={include_objects:!0,relation:{}}).relation.relation_id=moduleRecordMapping.Visits.id,D.relation.api_name="Visits_Zoho_Livedesk",l={field:{api_name:"Actions_Performed.Action_Type",id:""},comparator:"equal",value:t="Attended"==(t="Missed"==t?"Missed Chat":t)?"Chat":t},c={field:{api_name:"Actions_Performed.Action_Performed_Time",id:""},comparator:i,value:r},n=this.construct_group(l,c,"AND"),D.criteria=n,n=D}else if("cxFilter_Not_Replied_Messages"==e.api_name||"cxFilter_Replied_Messages"==e.api_name){var w={field:{api_name:"message_time__s",id:""},comparator:i,value:r},C={field:{api_name:"conversation_status__s",id:""}};switch(e.api_name){case"cxFilter_Not_Replied_Messages":C.comparator="not_equal",C.value="Replied";break;case"cxFilter_Replied_Messages":C.comparator="equal",C.value="Replied"}n=this.construct_group(w,C,"AND")}else if("cxFilter_Email_Sentiment"==e.api_name){var D,L=this.data&&"Accounts"===this.data.cxPropModule?"Email_Sentiment.":"",R={field:{api_name:L+"Received_Date",id:""},comparator:i,value:r},P=a,I="greater_than";r=0;if(l={field:{}},c={field:{}},"For_The_Last_Email"==P)r="PositiveOrNegative"==t?["Positive","Negative"]:t,l.field.api_name=L+"Last_Email_Sentiment",l.comparator="equal",l.value=r,d=JSON.parse(JSON.stringify(l));else{if("count"==P||"percentage"==P){I=o||$("#DDV_"+P)[0].ltProp("Selected");if(s)r=s;else{var S=$("#"+P+"_crux_comp")[0];S.component.validate(),r=S.component.getValue()}}"Positive"!=t&&"PositiveAndNegative"!=t&&"PositiveOrNegative"!=t&&"PositiveOnly"!=t||(P=""==P?"count":P,l.field.api_name=L+"Positive",l.comparator=I,l.value="${"+P.toUpperCase()+"|"+r+"}",d=JSON.parse(JSON.stringify(l))),"Negative"!=t&&"PositiveAndNegative"!=t&&"PositiveOrNegative"!=t&&"NegativeOnly"!=t||(P=""==P?"count":P,c.field.api_name=L+"Negative",c.comparator=I,c.value="${"+P.toUpperCase()+"|"+r+"}",d=JSON.parse(JSON.stringify(c))),"PositiveAndNegative"==t?d=this.construct_group(l,c,"AND"):"PositiveOrNegative"==t?d=this.construct_group(l,c,"OR"):"PositiveOnly"==t?(c.field.api_name=L+"Negative",c.comparator="equal",c.value="${COUNT|0}",d=this.construct_group(d,c,"AND")):"NegativeOnly"==t?(c.field.api_name=L+"Positive",c.comparator="equal",c.value="${COUNT|0}",d=this.construct_group(d,c,"AND")):"Neutral"==t&&(P=""==P?"count":P,l.field.api_name=L+"Neutral",l.comparator=I,l.value="${"+P.toUpperCase()+"|"+r+"}",d=JSON.parse(JSON.stringify(l)))}n=n=this.construct_group(R,d,"AND"),(D={include_objects:!0,relation:{}}).relation.api_name=L?"Contacts":"Email_Sentiment",D.criteria=n,n=D}return n},construct_group:function(e,t,r){var i=[];return null==e||0==e.length?t:null==t||0==t.length?e:(Lyte.arrayUtils(i,"push",JSON.parse(JSON.stringify(e))),Lyte.arrayUtils(i,"push",JSON.parse(JSON.stringify(t))),{group_operator:r,group:i})},sortArray:function(e,t){return e.sort((function(e,r){var i=e[t].toUpperCase(),a=r[t].toUpperCase();return i<a?-1:i>a?1:0})),e},getISODateStartTime:function(e){if(!e)return"";var t=-1!=["dd.mm.yyyy.","yyyy. mm. dd","yyyy.mm.dd","yyyy'年'mm'月'dd'日'"].indexOf(Crm.userDetails.DATE_PATTERN.toLowerCase());return(e=this.convertUsrtoDefaultDatePattern(e,t)).setTime(e.getTime()-6e4*e.getTimezoneOffset()),e=e.toISOString().split(/\./)[0]},getISODateEndTime:function(e){if(!e)return"";var t=-1!=["dd.mm.yyyy.","yyyy. mm. dd","yyyy.mm.dd","yyyy'年'mm'月'dd'日'"].indexOf(Crm.userDetails.DATE_PATTERN.toLowerCase());return(e=this.convertUsrtoDefaultDatePattern(e,t)).setHours(23,59,59,999),e.setTime(e.getTime()-6e4*e.getTimezoneOffset()),e=e.toISOString().split(/\./)[0]},getMulSelLookUpField:function(e,t){for(var r=moduleRecordMapping[e].fields,i=r.length,a=0;a<i;a++)if(("multiselectlookup"==r[a].data_type||"multiuserlookup"==r[a].data_type)&&r[a][r[a].data_type].api_name==t.api_name)return r[a]},getRelationDetails:function(e,t){var r=moduleRecordMapping[e].related_lists;if(r)for(var i=r.length,a=0;a<i;a++)if(r[a].api_name==t)return r[a]},isVisitsField:function(e){var t={LASTVISITEDTIME:"Last_Visited_Time",AVERAGETIMESPENT:"Average_Time_Spent_Minutes",DAYSVISITED:"Days_Visited",FIRSTVISITEDURL:"First_Visited_URL",FIRSTVISITEDTIME:"First_Visited_Time",NUMBEROFCHATS:"Number_Of_Chats",REFERRER:"Referrer",VISITORSCORE:"Visitor_Score",ATTENDEDBY:"Attended_By",BROWSER:"Browser",OPERATINGSYSTEM:"Operating_System",PORTAL_NAME:"Portal_Name",SEARCHENGINE:"Search_Engine",TIMESPENT:"Time_Spent",VISITEDTIME:"Visited_Time"};return"AVERAGETIMESPENT"==e||"DAYSVISITED"==e||"FIRSTVISITEDURL"==e||"FIRSTVISITEDTIME"==e||"LASTVISITEDTIME"==e||"NUMBEROFCHATS"==e||"REFERRER"==e||"VISITORSCORE"==e?{isVisits:!0,fieldtype:"normalField",api_name:t[e]}:("ATTENDEDBY"==e||"BROWSER"==e||"OPERATINGSYSTEM"==e||"PORTAL_NAME"==e||"SEARCHENGINE"==e||"TIMESPENT"==e||"VISITEDTIME"==e)&&{isVisits:!0,fieldtype:"crossField",api_name:t[e]}},negative_Comparator:function(e){var t={equal:"not_equal",not_equal:"equal",less_than:"greater_than",less_equal:"greater_equal",greater_than:"less_than",greater_equal:"less_equal",between:"not_between",not_between:"between"};return t[e]?t[e]:e},checkLimitValues:function(e,t){return!(-1!=["text","textarea","phone","email","mobile","website"].type(t)&&e.constructor==Array&&e.length>50)||(this.showAlert(I18n.getMsg("crm.alert.maximum.text.values.contains",50)),!1)},isZBCustomModule:function(e){return["CustomModule5001","CustomModule5002","CustomModule5003","CustomModule5004","CustomModule5005"].indexOf(e)>=0},removeValue:function(e,t,r){for(var i=0;e[i];i++)-1!=r.indexOf(e[i][t])&&(e.splice(i,1),i-=1)},updateCrossFilter:function(e,t,r){for(var i=0,a=e.length,s=!1;i<a;i++)if(e[i].relation&&e[i].relation.api_name===t){s=!0,e[i].include_objects=0!=e[i].include_objects&&0!=r.include_objects;var o=this.construct_group(e[i].criteria,r.criteria,"AND");e[i].criteria=o;break}s||Lyte.arrayUtils(e,"push",r)},getIndex:function(e,t,r,i){var a=0,s=e?e.length:0;for(a=0;a<s;a++)if(e[a][r]==t)return i?a:e[a].index;return!1},getValueBasedonKeys:function(e,t){for(var r=0,i=e.length,a=[];r<i;r++)a.push({id:e[r].id,name:e[r][t]});return a},sendxhr:function(e,t,r,i){return new Promise((function(a,s){var o=new XMLHttpRequest;for(var n in o.open(t,e,!0),(r=r||{})["X-ZCSRF-TOKEN"]=csrfParamName+"="+csrfToken,window.clientPortalName&&(r["X-CRMPORTAL"]=window.clientPortalName),"undefined"!=typeof crmZgid&&crmZgid&&(r["X-CRM-ORG"]=crmZgid),r)o.setRequestHeader(n,r[n]);o.send(i),o.onreadystatechange=function(){if(4==o.readyState)return"2"==o.status.toString()[0]||"3"==o.status.toString()[0]?a(o):s(o)}}))},convertUsrtoDefaultDatePattern:function(e,t){if(!e)return"";if(!e.getMonth){var r=Crm.userDetails.DATE_PATTERN.toUpperCase();try{e=$L.moment(e,r).getDObj()}catch(e){murphy.error(e)}}return e}}),Lyte.Mixin.register("migration-util",{focusSearchInput:function(e){$L("."+e).focus()},fieldSearchResult:function(e){var t=$L(".migDDNoResults");0===e.length?t.removeClass("dN"):t.addClass("dN")},updateNavigationStep:function(e,t){var r=$L("crm-dm-wizard-steps")[0].component;r&&r.setData("step",t);var i=document.querySelector("lyte-step");i&&i.goto(e)},updateWizardStepsAfterFileUpload:function(e){var t=$L("crm-dm-wizard-steps")[0].component;t.setData("isAfterUpload",e),t.setData("step",e?"0a":"0")},checkValueIsOutOfRange:function(e,t){return e<0||e>t},clearTagAfterError:function(e){setTimeout((function(){e.resetSearch(),e.blur()}),0)},validateTags:function(e,t,r,i){var a=$L("crm-dm-wizard-steps")[0].component;return t.count+1>t.allowed_count?!(this.searchInArrayOfObjects(e,"name",i)<0)||(r.toggle("close"),a.setData("tagAlertContent",I18n.getMsg("crm.tag.edition.limit.exceeded")),a.setData("showInvalidTagNameAlert",!0),this.clearTagAfterError(r),!1):!!e.match(/^.*[0-9a-zA-Z]/)||(r.toggle("close"),a.setData("tagAlertContent",I18n.getMsg("crm.tag.splChar")),a.setData("showInvalidTagNameAlert",!0),this.clearTagAfterError(r),!1)},commonTagErrorHandler:function(e,t){if(3===e.errorCode){t.toggle("close");var r=$L("crm-dm-wizard-steps")[0].component;r.setData("showInvalidTagNameAlert",!0),r.setData("tagAlertContent",I18n.getMsg("crm.tags.records.limit.reached",tagsRecordLimit)),t.resetSearch()}},popUnmappedMandatory:function(e){$L("#fieldMappingTable:visible").find(".migErrorColNameHighlight").attr("id","unMappedMandatoryCount"),$L("crm-dm-field-mapping")[0].component.actions.openBubble(e,".migErrorColNameHighlight:visible")},addLabelToMap:function(e,t,r){var i=this.getSimpleLabel(e);Lyte.objectUtils(r,"add",i,t)},addLabelToMapForHeader:function(e,t,r){var i=this.getSimpleLabel(e);t.headerLabel=e,Lyte.objectUtils(r,"add",i,t)},getSimpleLabel:function(e){return e.split(".").join("#")},formatBytes:function(e,t){if(0===e)return"0 Byte";var r=t+1||3,i=Math.floor(Math.log(e)/Math.log(1e3));return parseFloat((e/Math.pow(1e3,i)).toFixed(r))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][i]},migContentHeight:function(){var e=$L("#featuretitle"),t=e.offset().top+e.outerHeight()+($L("#wizardsteps").outerHeight()+28);$L("#migContentOuter").css("height","calc(100vh - "+t+"px)")},fileUploadApiMode:function(){var e=$("#file-upload"),t=$("#fileInput");if(1===e.length){var r=t.offset().top+28;t.css("height","calc(100vh - "+r+"px)")}},getModuleIcon:function(e,t,r){var i="mig_";return e&&-1!==Lyte.registeredMixins["migration-util"].inArray(e,["Leads","Accounts","Contacts","Deals","Potentials","Campaigns","Campaign Contact Members","Campaign Lead Members","Tasks","Events","Calls","Forecasts","Cases","Solutions","Products","Price_Books","Quotes","Sales_Orders","Purchase_Orders","Invoices"])?i+="Campaign Contact Members"===e?"Campaigns_Contacts":"Campaign Lead Members"===e?"Campaigns_Leads":e:i+=r?"SubForm":"default",t?"dIB vam svgIconsImg small_"+i:"migIcon mig_mod_sprite "+i+" verCntr"},fieldMapTableHgt:function(){var e=$L("#migContentOuter").outerHeight(),t=$L("#fieldsModuleList"),r=e-t.position().top;t.css("height",r)},populateDataTypeTree:function(e){var t=e[1],r=e[2],i=r.Total.limit-(t.Total?t.Total:0),a=r.Email.limit-(t.Email?t.Email:0),s=r.Phone.limit-(t.Phone?t.Phone:0),o=r.Multiselect.limit-(t.Multiselect?t.Multiselect:0),n=r.Picklist.limit-(t.Picklist?t.Picklist:0),l=r.Percent.limit-(t.Percent?t.Percent:0),c=r.Currency.limit-(t.Currency?t.Currency:0),d=r.BigInt.limit-(t.BigInt?t.BigInt:0),u=r.Lookup.limit-(t["Multiselect Lookup"]?t["Multiselect Lookup"]:0),m=r.UserLookup.limit-(t.UserLookup?t.UserLookup:0),p=r.Boolean.limit-(t.Boolean?t.Boolean:0),g=r.Date.limit-(t.Date?t.Date:0),f=r.Datetime.limit-(t.Datetime?t.Datetime:0),h=r.Textarea.limit-(t.Textarea?t.Textarea:0),y=r.Decimal.limit-(t.Decimal?t.Decimal:0),v=r.Number.limit-(t.Number?t.Number:0),_=r.Text.limit-(t.Text?t.Text:0),b=r.Website.limit-(t.Website?t.Website:0),w=new this.Parent;w.constructor(_);var C=new this.Parent;C.constructor(y);var D=[w,C],L=new this.DataType;L.constructor(i,r.Total.limit,D);var R=new this.Child;R.constructor(_,"P_Text","text",r.Text.limit);var P=new this.Child;P.constructor(s,"P_Text","phone",r.Phone.limit);var I=new this.Child;I.constructor(a,"P_Text","email",r.Email.limit);var S=new this.Child;S.constructor(o,"P_Text","multiselectpicklist",r.Multiselect.limit);var M=new this.Child;M.constructor(n,"P_Text","picklist",r.Picklist.limit);var k=new this.Child;k.constructor(b,"P_Text","website",r.Website.limit);var T=new this.Child;T.constructor(h,"P_Text","textarea",r.Textarea.limit);var E=new this.Child;E.constructor(l,"P_Decimal","percent",r.Percent.limit);var A=new this.Child;A.constructor(y,"P_Decimal","double",r.Decimal.limit);var F=new this.Child;F.constructor(c,"P_Decimal","currency",r.Currency.limit);var U=new this.Child;U.constructor(v,null,"integer",r.Number.limit);var O=new this.Child;O.constructor(d,null,"bigint",r.BigInt.limit);var x=new this.Child;x.constructor(u,null,"lookup",r.Lookup.limit);var N=new this.Child;N.constructor(m,null,"ownerlookup",r.UserLookup.limit);var j=new this.Child;j.constructor(g,null,"date",r.Date.limit);var z=new this.Child;z.constructor(f,null,"datetime",r.Datetime.limit);var $=new this.Child;$.constructor(p,null,"boolean",r.Boolean.limit);var q=[R,P,I,S,M,k,T,E,A,F,U,O,x,N,j,z,$],B={};for(var V in B.Total=L,B.P_Text=w,B.P_Decimal=C,q)B[q[V].name]=q[V];return B},populateCustomFieldMap:function(e){var t,r={};for(var i in e){(t=new this.CustomField).constructor(!1),t.setMapped(!0);var a=e[i].label;t.setName(a&&a.length>0?a.substring(0,50):"");var s=e[i].detected_type?e[i].detected_type.data_type:null;if(s){var o=s;o=this.getFromStore("responseFieldOptions")[o],t.setDataType(o),o||t.setErrorInDataType(I18n.getMsg("crm.label.select.field.type"))}else t.setErrorInDataType(I18n.getMsg("crm.label.select.field.type"));t.setFileIndex(e[i].index),r[e[i].index]=t}return r},getIndexForCurrentFilter:function(e,t){var r,i=$L("crm-dm-field-list")[0].component;switch(t){case"all":return e;case"mapped":r=i.data.fieldRowsMappedCopy;break;case"unmapped":return-1}for(var a=r.length,s=0;s<a;s++)if(e===r[s].getFileIndex())return s},constructRequestAndSaveMapping:function(e,t,r){$L(".migInvalidDataWarning").find(".fieldListInvalidInput").addClass("dN"),$L(".fieldListForModule:visible").find("lyte-td").removeClass("migInvalidDataWarning");var i,a=new Error("Migration Debugging Error"),s=$L("crm-dm-field-mapping")[0].component,o=s.data.numberSupportFormats,n=s.data.dateSupportFormats,l=s.data.dateTimeSupportFormats,c=[],d=$L("crm-dm-field-list")[0].component,u=$L("crm-dm-map-fields")[0].component,m=d.getData("fieldRows"),p=$L("crm-dm-assign-default")[0],g=d.data.filter;!p&&this.isFeatureSupported(t,"AssignDefault")&&(u.actions.loadDefaultAssignmentTab(),p=$L("crm-dm-assign-default")[0]),p&&(i=p.component.getData("defaultRows"));var f=[],h=[],y=[],v=[],_={},b={},w=!1,C=this.getFromStore("labelVsLabelObject");murphy.addCustomTracking({message:"CRASM Function Init params ["+e+", "+t+", "+r+"]",type:"custom event"});for(var D,L=m.length,R=0;R<L;R++){var P=(x=m[R]).getLabels(),I=x.getFileIndex(),S=P?P.length:0,M=x.getDefault(),k=!1;if((j=$L("#comp_"+I))&&j[0]&&j[0].component&&(j[0].component.validate()||(k=!0)),x.getDefault()){if("lookup"===x.getType()||"tag"===x.getType()||"ownerlookup"===x.getType()||"date"===x.getType()||"datetime"===x.getType()||"userlookup"===x.getType()||"layout"===x.getType()||"multiselectpicklist"===x.getType())try{switch(x.getType()){case"ownerlookup":case"userlookup":case"lookup":case"layout":M=M.id;break;case"date":M=M.newValue;break;case"tag":M=M[0].name;case"multiselectpicklist":for(var T=M?M.length:0,E="",A=1;A<T;A++)E=E+M[A]+";";M=E}}catch(e){M=void 0}"boolean"!==x.getType()&&"picklist"!==x.getType()||M!=="-"+I18n.getMsg("None")+"-"||(M=void 0,x.setDefault(void 0)),M&&M.trim().length<1&&(M=void 0,x.setDefault(void 0)),"number"!==x.getType()&&"currency"!==x.getType()&&"double"!==x.getType()&&"bigint"!==x.getType()&&"integer"!==x.getType()||!isNaN(M)||(h.push(this.getIndexForCurrentFilter(R,g)),b[R]=I18n.getMsg("crm.import.error.invalid.number"),k=!0)}if("number"!==x.getType()&&"currency"!==x.getType()&&"double"!==x.getType()&&"boolean"!==x.getType()&&"bigint"!==x.getType()&&"integer"!==x.getType()&&"date"!==x.getType()&&"datetime"!==x.getType()||(x.getPattern()&&x.getPattern()!==I18n.getMsg("None")?"boolean"===x.getType()&&x.getPattern()!==I18n.getMsg("Boolean")&&"12345"!==x.getPattern()?(y.push(this.getIndexForCurrentFilter(R,g)),k=!0):("date"!==x.getType()||s.data.extraSupportedFormats.includes(x.getPattern())||n.includes(x.getPattern())||l.includes(x.getPattern()))&&("datetime"!==x.getType()||s.data.extraSupportedFormats.includes(x.getPattern())||n.includes(x.getPattern())||l.includes(x.getPattern()))&&("number"!==x.getType()&&"bigint"!==x.getType()&&"currency"!==x.getType()&&"double"!==x.getType()&&"integer"!==x.getType()||o.includes(x.getPattern()))||(y.push(this.getIndexForCurrentFilter(R,g)),k=!0):(y.push(this.getIndexForCurrentFilter(R,g)),k=!0)),k)w=!0;else for(A=0;A<S;A++){if(D={},W=P[A]?this.getSimpleLabel(P[A]):void 0){var F=C[W].getApiName();D.api_name=F,D.index=x.getFileIndex(),-1===f.indexOf(x.getFileIndex())&&f.push(x.getFileIndex()),x.getDefault()&&(D.default_value=this.serializeCruxValues(x)),!x.getPattern()||"number"!==x.getType()&&"currency"!==x.getType()&&"double"!==x.getType()&&"boolean"!==x.getType()&&"bigint"!==x.getType()&&"integer"!==x.getType()&&"date"!==x.getType()&&"datetime"!==x.getType()||(D.format=x.getPattern()),c.push(D)}}}murphy.addCustomTracking({message:"Request after field mapping "+JSON.stringify(c),type:"custom event"});var U=k,O=!1;if(i&&i.length){L=i.length;for(R=0;R<L;R++){var x,N=(x=i[R]).getLabel(),j=$L("#defcomp_"+R),z=x.getDefault(),q=x.getType();if("lookup"===x.getType()||"tag"===x.getType()||"ownerlookup"===x.getType()||"userlookup"===x.getType()||"layout"===x.getType()||"multiselectpicklist"===x.getType())try{switch(x.getType()){case"ownerlookup":case"userlookup":case"lookup":z=z.id;break;case"layout":if(null===z)for(var B=d.getData("layoutOptions"),V=B.length,H=0;H<V;H++){var J={};J.id=B[H].id,J.name=B[H].name,z=B[H].id,x.setDefault(J);break}else z=z.id;break;case"tag":z=z[0].name;break;case"date":case"datetime":M=M.newValue;break;case"multiselectpicklist":for(T=M?M.length:0,E="",A=1;A<T;A++)E=E+z[A]+";";z=E}}catch(e){z=""}if(!N||null!=z&&z.trim().length){if(N&&z&&!z.trim().length)k=!0;else if("boolean"!==q&&"layout"!==q&&"lookup"!==q&&j&&j[0]&&j[0].component&&!j[0].component.validate())k=!0;else if(x.getDefault()){if(z.trim().length<1){v.push(R),_[R]=I18n.getMsg("crm.field.empty.check.alert",N),k=!0;continue}if("currency"===x.getType()&&isNaN(z)){v.push(R),_[R]=I18n.getMsg("crm.import.error.invalid.number"),k=!0;continue}var W;if(D={},W=N?this.getSimpleLabel(N):void 0){F=C[W].getApiName();D.api_name=F,D.default_value=this.serializeCruxValues(x),c.push(D)}}}else v.push(R),_[R]=I18n.getMsg("crm.field.empty.check.alert",N),k=!0}k&&(w=!0,O=!U)}if(w){var G="migInvalidDataWarning",Y=v.length,Z=y.length,Q=h.length,K=$L(".migFieldMapTable")[0],X=document.getElementById("navigationTab");Y<1&&(Z>0||Q>0)&&X.openTab("mappingTab");var ee=$L(".fieldListForModule:visible").find("lyte-tr");if(Y)var te=$L(".fieldTable").find("lyte-tr");Z||Q||!Y&&!O||X.openTab("assignDefaultTab");for(R=0;R<Y;R++){var re=v[R];te.eq(re).find("lyte-td").eq(1).addClass(G),(ie=$L(te.eq(re).find(".migAssignDefErrorIcon").eq(0))).removeClass("dN"),ie.attr("lt-prop-title",_[re])}for(R=0;R<Z;R++){re=y[R];ee.eq(re).find("lyte-td").eq(3).addClass(G)}for(R=0;R<Q;R++){var ie,ae=h[R],se=ee.eq(ae);se.find("lyte-td").eq(2).addClass(G),(ie=$L(se.find(".migAssignRepEmptyErrorIcon").eq(0))).removeClass("dN"),ie.attr("lt-prop-title",b[ae])}var oe=$L(".migInvalidDataWarning");return this.showMessageInFieldMapping(I18n.getMsg("crm.import.selected.field.dataformat.mismatch"),"error"),oe.length&&K.scrollTable(0,oe.first().position().top-41),oe.find(".fieldListInvalidInput").removeClass("dN"),this.removeMigrationBackdrop(),!1}murphy.addCustomTracking({message:"Request after fassign default "+JSON.stringify(c),type:"custom event"});var ne=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];void 0===e.data_migration&&e.$.set("data_migration",ne),e.$.set("field_mappings",c);var le=store.peekRecord("migration",ne);return u.setData("allDataSet",!1),le.$.save({module:t}).then(function(e){murphy.addCustomTracking({message:"Response "+JSON.stringify(e),type:"custom event"}),store.pushPayload("migration-module",{module:t,mapped_count:f.length}),this.showMessageInFieldMapping(I18n.getMsg("crm.migration.field.mapping.save",Handlebars.helpers.encodeHTML(this.getFromStore("moduleVsLabel")[t])),"success");var i=$("#fieldsModuleList").find("li.field_map_item_active");if(i.removeClass("field_map_item_active"),i.find(".vh").removeClass("vh").addClass("vv"),void 0!==r){var s,o,n=$("#fieldsModuleList li .vh");if(n.length){var l=n.eq(0);l&&((o=l.closest("li")).addClass("field_map_item_active"),s=o.attr("title"));var c=$L("crm-dm-assign-default")[0];c&&c.component.setData("defaultRows",[]);var d=$L("crm-dm-map-fields")[0].component;d.setData("currentModule",this.getFromStore("labelVsApi")[s]),d.hideOptionToSwitchTab(d)}else if(r){this.routeToIndexRoutes("crm.settings.migration.index.report-and-review",Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],{step:"no_redirect"})}else if(!r){$L("crm-dm-map-fields")[0].component.setData("allDataSet",!0),i.addClass("field_map_item_active"),this.removeMigrationBackdrop()}murphy.addCustomTracking({message:"Transition Complete",type:"custom event"})}else{$L("crm-dm-wizard-steps")[0].component.checkToGoForNextModule(),this.removeMigrationBackdrop()}murphy.error(a)}.bind(this),function(e){this.showMessageInFieldMapping(this.getErrorMessageFromFailedResponse(e),"error"),this.removeMigrationBackdrop()}.bind(this)),murphy.error(a),!0},serializeCruxValues:function(e){var t=e.getDefault()?e.getDefault():"",r=e.getType();if(""!==t)switch(r){case"ownerlookup":case"userlookup":case"lookup":case"layout":var i;return{name:(i="object"==typeof t?t:JSON.parse(t)).name?i.name:"",value:i.id};case"tag":for(var a=(o=t?t.length:0)?t[0].name:"",s=1;s<o;s++)a=a+","+t[s].name;return{value:a};case"multiselectpicklist":var o;for(a=(o=t?t.length:0)?t[0]:"",s=1;s<o;s++)a=a+";"+t[s];return{value:a};default:return{value:t.newValue?t.newValue.toString():t}}},deSerializeCruxValues:function(e,t){if(t)switch(e){case"ownerlookup":case"userlookup":return{name:t.name?t.name:"test",id:t.value};case"layout":case"lookup":return{name:t.name?t.name:"test",id:t.value};case"tag":for(var r=t?t.value.split(","):[],i=r?r.length:0,a=[],s=0;s<i;s++)a.push({name:r[s]});$L("crm-dm-field-list")[0].component.setData("currentTags",a);var o=$L("crm-dm-assign-default")[0];return o&&o.component.setData("currentTags",a),a;case"multiselectpicklist":return t?t.value.split(";"):[];case"lookup":default:return t.value}},isCurrentModuleRevisit:function(){return store.peekRecord("migration-module",store.peekAll("migration-store")[0].apiVsModule[$L("crm-dm-map-fields")[0].component.data.currentModule]).mapped_count},getCurrentModuleNameForFieldMapping:function(){var e=$L("crm-dm-map-fields")[0].component.data.currentModule;return this.getFromStore("apiVsModule")[e]},isCurrentModuleSupportedForDefaultValues:function(){return this.isFeatureSupported(this.getCurrentModuleNameForFieldMapping(),"AssignDefault")},getDropdownElement:function(e,t,r,i){var a;return a=$L("#drop_"+e+"_"+t+"_A"),i?a:a[0]?a[0]:null},removeOldMapping:function(e,t){if(e[0]){if(e[0].classList.contains("crmBoxDropdown")&&e[0].ltProp&&e[0].ltProp("selected")===t)return e[0].ltProp("displayValue",""),e[0].ltProp("selected",""),!0;if(e[0].classList.contains("migFieldsDummyValue")&&e.text()===t)return e.removeClass("migFieldsDummyValue"),e.addClass("dIB vab w80per ellipsistext"),e.text(I18n.getMsg("crm.select.field.to.import")),!0}return!1},setWizardSteps:function(){var e=$("#fieldsModuleList").find("li"),t=e.length,r=e.find(".vv").length,i=$L("crm-dm-wizard-steps")[0].component;t===r?i.setData("showSaveAndNext",!1):i.setData("showSaveAndNext",!0)},checkAndsetDefaultSupported:function(e,t){if(this.isCurrentModuleSupportedForDefaultValues()){var r=!0,i=this.getFromStore("labelVsLabelObject");if(t&&t.length>0)for(var a=t.length,s=0;s<a&&(r=i[this.getSimpleLabel(t[s])].isDefaultSupported());s++);e.setDefaultSupported(r),r||e.setDefault(void 0)}else e.setDefaultSupported(!1)},setAndCheckType:function(e,t,r,i){if(r){if(!t.getType()&&e)return t.setType(e.getType()),t.setField(e.getField()),"lookup"===e.getType()&&t.setLookupModule(e.getField().lookup.module.api_name),!0;if(t.getType()===e.getType()){if("lookup"===e.getType()){var a=e.getField(),s=a.lookup&&a.lookup.module?a.lookup.module.api_name:void 0;return t.getLookupModule()===s}return!0}if("text"===e.getType()||"textarea"===e.getType())return!0;if("text"===t.getType()||"textarea"===t.getType())return t.setType(e.getType()),"lookup"===e.getType()&&t.setLookupModule(e.getField().lookup.module.api_name),!0;if("date"!==t.getType()&&"datetime"!==t.getType())return!1;if("date"===e.getType()||"datetime"===e.getType())return!0}else null!==i&&0===i.length&&(t.setType(null),t.setField(null),t.setLookupModule(null),t.setDefault(null),t.setLabels(null))},showMessageInFieldMapping:function(e,t){var r=$L("crm-dm-field-mapping")[0].component;r.setData("messageType",t),r.setData("message",e),r.setData("showLimitMessageBox",!0)},showMessageInSelectCRM:function(e,t){var r=$L("crm-dm-select-crm")[0].component;r.setData("messageType",t),r.setData("message",e),r.setData("showMessageBox",!0)},typecastToLabel:function(e){var t=new this.Label;return t.constructor(e.api_name,e.label,e.mandatory,e.data_type,e.ui_type,e.field),t.setDefaultSupported(e.is_default),t.setDefault(e.default_value),t},typecastToCustomField:function(e){var t=new this.CustomField;return t.constructor(e.mapped,e.datatype,e.name,e.error_datatype,e.error_name,e.subDatatype,e.file_index),t},calibrateFieldMappingFilters:function(e,t){for(var r=$L("crm-dm-field-list")[0].component,i=0,a=e?Object.keys(e).length:0,s=0;s<a;)e[s]&&e[s].length>0&&i++,s++;r.setData("mappedFieldsCount",i),r.setData("unMappedFieldsCount",a-i),r.setData("allFieldsCount",a),t||this.showActiveModuleFilter($L("#title-all"))},sortKeysForObjects:function(e){var t={};return Object.keys(e).sort((function(e,t){return t.toLowerCase()<e.toLowerCase()?1:-1})).forEach((function(r){if(r===I18n.getMsg("crm.select.none")){var i=new Lyte.registeredMixins["migration-constants"].Label;i.label="--"+I18n.getMsg("crm.select.none")+"--",Lyte.registeredMixins["migration-util"].addLabelToMap("0"+i.label,i,t)}else t[r]=e[r]})),t},removeElementFromList:function(e,t){return e.filter((function(e){return e!==t}))},inArray:function(e,t){if(t.indexOf)return t.indexOf(e);for(var r=t.length,i=0;i<r;i++)if(t[i]===e)return i;return-1},searchInArrayOfObjects:function(e,t,r){for(var i=r.length,a=0;a<i;a++)if(r[a][t]===e)return a;return-1},removeFromArrayOfObjects:function(e,t,r){var i=[];for(var a in r)r[a][t]!==e&&i.push(r[a]);return i},getDeepCopyOfCustomModule:function(e){var t=new this.CustomModule;return t.constructor(e.module,e.islinking,e.m_module,e.ms_lookup,e.n_module,e.relatedmodule,e.show_linking_module),t},setModuleListDropDownForLinking:function(){var e=[],t=I18n.getMsg("None");return e.push(t),store.peekAll("module").forEach(function(t){var r=t.module_name,i=t.presence_sub_menu,a=t.generated_type,s=t.visible,o=t.viewable;i&&o&&s&&("custom"===a||"default"===a)&&this.isFeatureSupported(r,"LinkingModuleCreation")&&e.push(t.plural_label)}.bind(this)),e},isFeatureSupported:function(e,t){var r=moduleRecordMapping[e]?moduleRecordMapping[e].id:void 0,i=r?store.peekRecord("module",r):void 0,a=i?i.generated_type:"default",s=Crm.userDetails.LICENSE_TYPE;switch(t){case"tags":var o=[this.ATTACHMENTS,this.NOTES,this.DOCUMENTS,this.CONTENT_VERSION,this.PRICEBOOKS];return"linking"!==a&&"subform"!==a&&-1===this.inArray(e,o)&&"L"!==s;case"pkcolumn":return"subform"!==a;case"layouts":var n=[this.ATTACHMENTS,this.NOTES,this.DOCUMENTS,this.CONTENT_VERSION,this.PRICEBOOKS,this.ACTIVITIES,this.EVENTS,this.COMPETITORS,this.CALLS,this.TASKS];return-1!==this.inArray(s,["E","A","C","Z","U","D"])&&("subform"!==a&&-1===this.inArray(e,n));case"createfield":var l=[this.QuotedItems,this.OrderedItems,this.PurchaseItems,this.InvoicedItems,this.USERS,this.CAMPAIGN_MEMBERS,this.CAMPAIGN_LEAD_MEMBERS,this.CAMPAIGN_CONTACT_MEMBERS,this.CALLS,this.NOTES,this.COMPETITORS,this.ATTACHMENTS,this.POTENTIAL_STAGE_HISTORY,this.CONTACTROLES,this.DEALCONTACTROLE,this.DOCUMENTS,this.CONTENT_VERSION,this.PHOTOS,this.QUOTE_LINE_ITEMS,this.PURCHASE_ORDER_LINE_ITEMS,this.SALES_ORDER_LINE_ITEMS,this.INVOICE_LINE_ITEMS,this.LEAD_PRODUCT,this.CONTACT_PRODUCT,this.ACCOUNT_PRODUCT,this.POTENTIAL_PRODUCT,this.PRODUCT_PRICEBOOK,this.CASE_COMMENTS,this.LAYOUT];return!(!Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM||"L"===s||l.indexOf(e)>=0);case"AssignDefault":var c=[this.LEADS,this.CAMPAIGNS,this.POTENTIALS,this.CONTACTS,this.ACCOUNTS,this.NOTES,this.EVENTS,this.TASKS,this.CALLS,this.PRICEBOOKS,this.PRODUCTS,this.QUOTES,this.INVOICES,this.SALESORDERS,this.SOLUTIONS,this.PURCHASEORDERS,this.VENDORS,this.CASES];return"custom"===a||"linking"===a||"subform"===a||c.indexOf(e)>=0;case"HasParentSummaryLinks":var d=[this.CAMPAIGN_MEMBERS,this.CAMPAIGN_LEAD_MEMBERS,this.CAMPAIGN_CONTACT_MEMBERS,this.NOTES,this.ATTACHMENTS,this.COMPETITORS,this.POTENTIAL_STAGE_HISTORY,this.CONTACTROLES,this.DEALCONTACTROLE,this.PHOTOS,this.QUOTE_LINE_ITEMS,this.PURCHASE_ORDER_LINE_ITEMS,this.SALES_ORDER_LINE_ITEMS,this.INVOICE_LINE_ITEMS,this.CASE_COMMENTS,this.LEAD_PRODUCT,this.CONTACT_PRODUCT,this.ACCOUNT_PRODUCT,this.POTENTIAL_PRODUCT,this.PRODUCT_PRICEBOOK];return"subform"===a||d.indexOf(e)>=0;case"LinkingModuleCreation":return!([this.FORECASTS,this.CALLS,this.TASKS,this.EVENTS,this.ATTACHMENTS,this.NOTES,this.VISITS,this.REPORTS,this.DASHBOARDS,this.JOBSHEETS,this.APPOINTMENTS,this.SERVICES].indexOf(e)>=0)}},redirectMigrationBasedOnCurrentStatus:function(e,t){var r=objectUtils.cloneObject(e),i=null,a=r.status?r.status:r.state;if(void 0!==r&&void 0!==a){switch(a){case"UPLOAD":i=".index.file-upload";break;case"FILEPRCS":i=".index.extract-data";break;case"PENDING":case"HALT":if(t&&t.transition.target)switch(t.transition.target.substring(t.transition.target.lastIndexOf("."))){case".map-fields":i=".index.map-fields";break;case".report-and-review":i=".index.report-and-review";break;default:i=".index.map-modules"}else i=".index.map-modules";break;case"INITIATE":case"ABORT":case"STARTED":case"REVERT":case"POSTPROCESS":case"COMPLETED":i=".index.complete";break;default:return void(Lyte.Router.replaceWith({route:"crm.settings.section.data-migration"}).data={step:"error"})}i="crm.settings.migration"+i;var s={};s.route=i,s.dynamicParams=[r.id],Lyte.Router.replaceWith(s).data=objectUtils.cloneObject({step:"redirection"})}},routeToExit:function(e){var t=this.getFromStore("history");(!t||t&&"crm.settings.migration"===t.route)&&(t={route:"crm.settings.section.data-migration"});var r=Lyte.Router.transitionTo(t);if(e){var i={};i.step=e,r.data=i}},routeToIndexRoutes:function(e,t,r){var i={route:e,dynamicParams:[t]},a=Lyte.Router.transitionTo(i);r&&(a.data=r)},createMigration:function(e,t,r){this.addToStore({history:Lyte.Router.getRouteInstance().transition.info}),store.findAll("migration").then(function(i){var a;if("error"!==i.status)this.redirectMigrationBasedOnCurrentStatus(i);else if(1===t){var s={source_system:e,source_type:t};"Others"===e&&(s.source_name=r),store.createRecord("migration",s).$.save().then(function(r){r=r.migration,a=Lyte.Router.transitionTo({route:"crm.settings.migration.index.file-upload",dynamicParams:[r.details.id]}),r.details.source_system=e,r.details.source_type=t,a.data=r}.bind(this),function(){this.routeToExit("unknown")}.bind(this))}else{a=Lyte.Router.transitionTo({route:"crm.settings.migration.api-login"});var o={details:{}};o.details.source_system=e,o.details.source_type=t,a.data=o}}.bind(this))},setUploadStatus:function(e,t){var r=$(e),i=r.find(".active_sts"),a=r.find("."+t);i.removeClass("active_sts").addClass("prev_sts"),a.nextAll("next_sts"),a.removeClass("next_sts prev_sts").addClass("active_sts")},reInitModuleMaps:function(e){var t=store.peekAll("module"),r=this.getModulesList(t),i=this.getModulesList(this.getFromStore("sourceModules"));for(var a in i)r[a]=i[a];var s=this.addSuggestedModules(r,e);if(!s)return!1;r=s;var o={},n={},l={};for(var c in r)o[c]=r[c].plural_label,n[r[c].plural_label]=r[c].api_name,l[r[c].api_name]=c;return this.addToStore({labelVsApi:n,moduleVsLabel:o,labelVsModule:_.invert(o),apiVsModule:l,apiVsLabel:_.invert(n)}),r},getStatus:function(e,t,r){switch(e){case"INPROGRESS":return r&&0!=r?"Inprogress":null;case"FAILED":return"Stopped";case"COMPLETED":return"Completed";default:return null}},setCompleteTreeData:function(e,t){this.reInitModuleMaps(e);var r,i=store.peekRecord("migration",e.id);if(t)r=[];else{var a=$L("crm-dm-complete")[0].component;r=a.getData("completeData")}var s=e.resource?e.resource.length:0,o=!1,n=$L("crm-dm-wizard-steps")[0].component,l=$L("crm-dm-feature-title")[0].component;"ABORT"===e.status?(o=!0,n.setData("showEditMigration",!1)):"COMPLETED"===e.status&&(n.setData("toHalt",!1),n.setData("showEditMigration",!1),n.setData("isMigrationComplete",!0),l.setData("isMigrationComplete",!0));for(var c=0;c<s;c++){if("unSupportedFiles"!==(M=(S=e.resource[c]).module)&&"unmappedFiles"!==M&&"multiSelect"!==M){var d,u,m,p=S.file_details?S.file_details:S.files;if(this.getFromStore("moduleVsLabel")[M]){var g=p?p.length:0,f=[];d=0,u=0,m=0,S.is_aborted&&(P=M);for(var h=0;h<g;h++){var y=p[h];d+=y.added_count,u+=y.skipped_count,m=(m+=y.total_count)<0?0:m;var v=new this.TreeObject,_=1===i.source_type?y.name?y.name:y:this.getFromStore("moduleVsLabel")[M];if(v.populateChild(_,this.getStatus(y.status,o,y.total_count),void 0===y.added_count?0:y.added_count,void 0===y.skipped_count?0:y.skipped_count,void 0===y.total_count||y.total_count<0?0:y.total_count,"migStartTableChild",y.importid,S.module),1===i.source_type)f.push(v);else if(t)r.push(v);else for(var b=r.length,w=0;w<b;w++)if(r[w].module===this.getFromStore("moduleVsLabel")[M]){var C=r[w];Lyte.arrayUtils(r,"replaceAt",w,v);break}}if(0===g&&1!==i.source_type&&t)(v=new this.TreeObject).populateChild(this.getFromStore("moduleVsLabel")[M],null,0,0,0,"migStartTableChild",void 0,S.module),r.push(v);if(1===i.source_type){var D=new this.TreeObject;if(D.populateParent(this.getFromStore("moduleVsLabel")[M],this.getStatus(S.status,o,m),isNaN(d)?0:d,isNaN(u)?0:u,isNaN(m)?0:m,"migStartTableParent","toggleRow",f,this.getStatus(S.status,o,m),t),t)r.push(D);else for(b=r.length,w=0;w<b;w++)if(r[w].module===this.getFromStore("moduleVsLabel")[M]){(C=r[w]).defaultState&&(D.defaultState=C.defaultState),Lyte.arrayUtils(r,"replaceAt",w,D);break}}}}}var L=e.state;if(!a)return r.abortModule=P,r;if(L){var R,P;switch(L){case"COMPLETED":R="migSuccess";break;case"ABORT":var I=!1;for(h=0;h<s;h++){var S,M;if("unSupportedFiles"!==(M=(S=e.resource[h]).module)&&"unmappedFiles"!==M&&"FAILED"===S.status){I=!0;break}}I?R="migFailed":(R="migHalt",a.setData("abortModule",P));break;default:R="migRunning"}a.setData("flag",R)}},populateAvailableDataType:function(e){this.addToStore({requestingFieldOptions:{Text:"text","crm.label.integer":"integer",Percent:"percent",Decimal:"double",Currency:"currency",Date:"date","crm.label.datetime":"datetime",Email:"email",Phone:"phone","crm.label.pick":"picklist",URL:"website","crm.label.textarea":"textarea","crm.label.boolean":"boolean","crm.label.multiselect":"multiselectpicklist","crm.label.LongInteger":"bigint",Lookup:"lookup",User:"userlookup"},responseFieldOptions:{URL:"URL",Currency:"Currency",Boolean:"crm.label.boolean",Date:"Date",Datetime:"crm.label.datetime",Picklist:"crm.label.pick",Email:"Email",Text:"Text"}});var t=["Text","crm.label.integer","Percent","Decimal","Currency","Date","crm.label.datetime","Email","Phone","crm.label.pick","URL","crm.label.textarea","crm.label.boolean","crm.label.multiselect"],r=Crm.userDetails.LICENSE_TYPE,i=!1;return store.peekAll("module").filter((function(t){return"subform"===t.generated_type&&t.api_name===e})).length>0&&(i=!0),"N"!==r&&"S"!==r&&"X"!==r&&"L"!==r&&(t.push("crm.label.LongInteger"),t.push("Lookup"),i||t.push("User")),t},processReport:function(e,t){if(!this.reInitModuleMaps(e))return!1;for(var r={},i=e.resource.length,a=t.length,s=0;s<i;s++){var o=e.resource[s].module,n=store.peekRecord("migration-module",e.resource[s].module);if(o){for(var l=e.resource[s].files.length,c=n.files[0],d=0,u=void 0!==n.mapped_count?n.mapped_count:0,m=0;m<a;m++)if(c===t[m].name){d=t[m].header.length-u,store.pushPayload("migration-module",{module:o,unmapped_count:d,total_count:t[m].header.length});break}var p={};p.file_count=l,p.mapped=u,p.unmapped=d,r[o]=p}}return r},showFieldPies:function(e){for(var t in e){var r=e[t],i={chart:{type:"pie",height:30,width:30},title:{text:""},legend:{enabled:!1},credits:{enabled:!1},plotOptions:{pie:{startAngle:180,borderWidth:0,pointPadding:0,allowPointSelect:!0,cursor:"default",dataLabels:{enabled:!1,style:{width:"100px"}},innerSize:"150%",showInLegend:!1,point:{events:{legendItemClick:function(){return!1}}}},series:{enableMouseTracking:!1}},series:[{data:[{y:r.mapped,color:"#19bc7d"},{y:r.unmapped,color:"#dedadb"}]}]},a=t.replace(/[^\w]/gi,"");if($("#chart_"+a).highcharts(i),r.mapped&&r.unmapped){var s=r.mapped/(r.mapped+r.unmapped)*100;$("#chart_"+a+"_per").text(s.toFixed(0)+" %")}else r.unmapped||$("#chart_"+a+"_per").text("100 %")}},getModulesList:function(e,t){var r,i={};for(var a in e)if(r=e[a].module_name,e[a].viewable||"linking"===e[a].generated_type){if(!e[a].visible&&e[a].show_as_tab)continue;var s={};s.api_name=e[a].api_name,s.singular_label=e[a].singular_label;var o=e[a].generated_type;switch(s.generated_type=o,s.plural_label="subform"===o?e[a].plural_label+"-"+e[a].parent_module.plural_label:e[a].plural_label,r){case this.USERS:case this.CAMPAIGNS:case this.LEADS:case this.ACCOUNTS:case this.CONTACTS:case this.CAMPAIGN_MEMBERS:case this.CAMPAIGN_CONTACT_MEMBERS:case this.CAMPAIGN_LEAD_MEMBERS:case this.POTENTIALS:case this.PRODUCTS:case this.CASES:case this.SOLUTIONS:case this.VENDORS:case this.PRICEBOOKS:case this.TASKS:case this.CALLS:case this.EVENTS:case this.NOTES:case this.ATTACHMENTS:case this.DOCUMENTS:case this.COMPETITORS:case this.POTENTIAL_STAGE_HISTORY:case this.CONTACTROLES:case this.DEALCONTACTROLE:case this.SALESORDERS:case this.PURCHASEORDERS:case this.INVOICES:case this.QUOTES:case this.QUOTE_LINE_ITEMS:case this.PURCHASE_ORDER_LINE_ITEMS:case this.SALES_ORDER_LINE_ITEMS:case this.INVOICE_LINE_ITEMS:case this.CASE_COMMENTS:case this.LAYOUT:case this.PRODUCT_PRICEBOOK:case this.LEAD_PRODUCT:case this.ACCOUNT_PRODUCT:case this.CONTACT_PRODUCT:case this.POTENTIAL_PRODUCT:case this.CONTENT_VERSION:case"Services":if(t&&(this.TASKS===r||this.EVENTS===r||this.CALLS===r||this.FORECASTS===r||this.VISITS===r))continue;i[r]=s;break;default:("custom"===o||"linking"===o&&!t||"subform"===o&&!t)&&(i[r]=s)}}return i},addSuggestedModules:function(e,t){for(var r=t.resource?t.resource.length:0,i=[],a=0;a<r;a++){var s=t.resource[a],o=t.resource[a].module;o&&!e[o]&&s.suggested?e[o]={plural_label:o,suggested:s.suggested}:o&&!e[o]&&i.push(o)}return this.addToStore({unfitModules:i}),!this.isCompleteScreen(t)&&i.length>0&&this.unmapUnfitModulesAndRouteToMapping(t),e},isCompleteScreen:function(e){switch(e.status?e.status:e.state){case"INITIATE":case"ABORT":case"STARTED":case"REVERT":case"POSTPROCESS":case"COMPLETED":return!0;default:return!1}},unmapUnfitModulesAndRouteToMapping:function(){var e=this.getFromStore("unfitModules"),t=e?e.length:0;if(0!==t){for(var r,i,a=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],s=[],o=0;o<t;o++)i=e[o],(r=store.peekRecord("migration-module",i))&&(r.$.set("files",[]),void 0===r.data_migration&&r.$.set("data_migration",a),s.push(i));return 0!==s.length&&(store.peekRecord("migration",a).$.save({module:"invalidate",modules:s}).then(function(r){if(r&&r.migration&&"SUCCESS"===r.migration.code)for(var s=0;s<t;s++)i=e[s],store.unloadRecord("migration-module",i);if("crm.settings.migration.index.map-modules"!==Lyte.Router.getRouteInstance().transition.info.route){var o={route:"crm.settings.migration.index.map-modules"};o.dynamicParams=[a],Lyte.Router.replaceWith(o).data=objectUtils.cloneObject({step:"redirection"})}else{Lyte.Router.getRouteInstance().refresh().data=objectUtils.cloneObject({step:"redirection"})}var n=$L("crm-dm-wizard-steps")[0].component;n.setData("errorMessage",I18n.getMsg("zb.common.error.PageTitle")),n.setData("showError",!0)}.bind(this),function(e){Lyte.registeredMixins["migration-util"].handleErrorResponse(e)}.bind(this)),!0)}},hideOptionToSwitchTab:function(e){e||(e=$L("crm-dm-map-fields")[0].component);var t=e.getFromStore("apiVsModule")[e.data.currentModule];e.setData("showTabViewOptions",this.isFeatureSupported(t,"AssignDefault"))},addToStore:function(e){var t=store.peekAll("migration-store")?store.peekAll("migration-store")[0]:void 0;t||(t=store.createRecord("migration-store"));var r=t.id,i={};for(var a in i.id=r,e)i[a]=e[a];store.pushPayload("migration-store",i)},getFromStore:function(e){var t=store.peekAll("migration-store")?store.peekAll("migration-store")[0]:void 0;return t?t[e]:void 0},resetStore:function(){var e=store.peekAll("migration-store")?store.peekAll("migration-store")[0]:void 0;if(e){e.$.set({unmappedLabels:{},mappedLabels:{},showMappedLabels:!1,defaultLabels:[],indexVsLabels:{},labelVsLabelObject:{},fieldApiVsLabel:{},suggestion:{},fieldMappings:{},tagOptions:[],showMandatoryBubble:!1,mandatoryCount:0,bubbleList:[]})}},resetFullMigration:function(){store.unloadAll("migration-store"),store.unloadAll("migration-module"),store.unloadAll("migration"),store.unloadAll("import-history")},setTemplateData:function(e,t){var r=new Error("Migration Debugging Error"),i={},a={},s=this.reInitModuleMaps(e);if(!s)return!1;murphy.addCustomTracking({message:"Response from module mapping neon  supported module "+JSON.stringify(s),type:"custom event"});for(var o=e.resource?e.resource.length:0,n=[],l=0;l<o;l++)n.push(e.resource[l]);var c=e.resource?e.resource.length:0;for(l=0;l<c;l++){var d=e.resource[l].module;if(d){s[d].files=e.resource[l].files;for(var u=e.resource[l].files.length,m=0;m<u;m++){(f={}).module=d,a[e.resource[l].files[m]]=f}}}var p=t.unmapped_files.length;for(m=0;m<p;m++){(f=a[t.unmapped_files[m].name]?a[t.unmapped_files[m].name]:{}).data=t.unmapped_files[m],a[t.unmapped_files[m].name]=f}var g=t.mapped_files.length;for(m=0;m<g;m++){var f;(f=a[t.mapped_files[m].name]?a[t.mapped_files[m].name]:{}).data=t.mapped_files[m],a[t.mapped_files[m].name]=f}return i.response=e,i.filesVsModules=a,i.modules=s,murphy.addCustomTracking({message:"Response from module mapping neon 1.1  supported module "+JSON.stringify(s),type:"custom event"}),murphy.error(r),i},getMappedModules:function(e,t){if(!this.reInitModuleMaps(e))return!1;for(var r=[],i=e.resource?e.resource.length:0,a=[],s=0;s<i;s++){var o=e.resource[s],n=o.module,l=o.files;this.getFromStore("moduleVsLabel")[n]&&l&&l.length>0&&r.push(this.getFromStore("moduleVsLabel")[n]),this.getFromStore("moduleVsLabel")[n]&&!o.mapped_count&&t&&a.push(this.getFromStore("moduleVsLabel")[n])}var c=r.sort(this.sortModules);if(t){var d=a.sort(this.sortModules);d.length?e.activeModule=d[0]:e.activeModule=c[0]}return c},sortModules:function(e,t){return(e=e.toLowerCase())>(t=t.toLowerCase())?1:t>e?-1:0},refreshGraphInModules:function(e,t,r,i){var a=e+r+i+t,s=Math.round(r?r/a*100:0),o={legend:{}};o.legend.enabled=!1,o.legend.useHTML=!0,o.tooltip={},o.plotOptions={},o.plotOptions.series={},o.plotOptions.series.animation=!1,o.plotOptions.pie={},o.plotOptions.pie.showInLegend=!1,o.plotOptions.pie.allowPointSelect=!1,o.plotOptions.pie.innerSize="87%",o.plotOptions.pie.dataLabels={},o.plotOptions.pie.dataLabels.enabled=!1,o.plotOptions.pie.dataLabels.style={},o.plotOptions.pie.dataLabels.style.lineHeight="10px",o.plotOptions.pie.dataLabels.style.width="50px",o.plotOptions.pie.dataLabels.useHTML=!0,o.series=[];var n={};n.name=I18n.getMsg("crm.migration.files.count"),n.data=[];var l=[];l.push(I18n.getMsg("crm.migration.mapped")),l.push(r),n.data.push(l),(l=[]).push(I18n.getMsg("crm.migration.unmapped")),l.push(e),n.data.push(l),(l=[]).push(I18n.getMsg("crm.migration.unSupported")),l.push(t+i),n.data.push(l),o.series.push(n),o.title={},o.title.style={},o.title.style.fontSize="10px",o.title.useHTML=!0,o.title.verticalAlign="middle",o.title.text="<div class='dIB'><div  style='font-size:25px' class='aligncenter'>"+s+"<span style='font-size:19px;top:-2px;' class='pR'>%</span></div><div class='aligncenter'>"+I18n.getMsg("crm.migration.graph.title")+"</div></div>",o.currencyColumn=!1,o.credits={},o.credits.enabled=!1,o.chart={},o.chart.height=130,o.chart.width=130,o.chart.type="pie",o.colors=[],o.colors.push("#19BC7D"),o.colors.push("#dddada"),o.colors.push("#F36E6F"),o.series.size="80%",o.plotOptions.series.states={},o.plotOptions.series.states.hover={},o.plotOptions.series.states.hover.enabled=!1,o.chart.marginTop=0,o.chart.marginBottom=0,o.chart.marginLeft=0,o.chart.marginRight=0,o.chart.pullOutRadius=0,o.plotOptions.pie.borderWidth=0,$("#graphForModules").highcharts(o)},editModName:function(e){var t=$("#mig-popup .zcrm-content"),r=$("#edit-mod-name").clone();t.html(r),$("#mig-popup #edit-mod-name").show(),showAnimatePopup("mig-popup"),setTimeout((function(){var t=$(e).attr("data-modulename"),r=$("#editmodname");r.val(t),$("#oldEditmodname").val(t),r.select().focus()}),200)},moduleOnHoverShadow:function(e,t){var r=$(e).closest(".folderitem");"true"===t?r.addClass("boxHighlight"):r.removeClass("boxHighlight")},showMigrationBackdrop:function(){freezeBackground(),$L(".mig_loadingDot").removeClass("dN")},removeMigrationBackdrop:function(){setTimeout((function(){removeFreezeLayer(),$L(".mig_loadingDot").addClass("dN")}),500)},validateMappings:function(e,t){var r=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],i=store.peekRecord("migration",r),a=i.attachmentcount,s=store.peekRecord("migration-module",e.ATTACHMENTS);if(s&&s.files.length>0&&!a){e.setData("isAttachments",!0);var o=s.files;return s.$.set("files",[]),e.addToStore({module:e.ATTACHMENTS}),void 0===s.data_migration&&s.$.set("data_migration",r),(i=store.peekRecord("migration",r)).$.save({module:e.ATTACHMENTS}).then(function(t){if(t&&t.migration&&"SUCCESS"===t.migration.code){for(var r=$L("crm-dm-folder-list")[0].component,i=o.length,a=r.getData("filesVsModules"),s=0;s<i;s++)delete a[o[s]].module;store.unloadRecord("migration-module",e.ATTACHMENTS),r.setData("filesVsModules",a);for(var n=r.getData("mappedFiles"),l=n.length,c=0;c<l;c++)if(n[c]){var d=n[c].name;for(s=0;s<i;s++)if(o[s]===d){var u=n[c];Lyte.arrayUtils(r.getData("unmappedFiles"),"insertAt",0,u),Lyte.arrayUtils(r.getData("mappedFiles"),"removeAt",c,1)}}var m=r.getData("modules_copy");m[r.ATTACHMENTS].files=[],r.setData("modules_copy",Object.assign({},m));var p=Lyte.deepCopyObject(r.getData("modules"));p[r.ATTACHMENTS].files=[],r.setData("modules",p),r.setData("unmappedFiles",Object.assign([],r.getData("unmappedFiles"))),r.setData("mappedFiles",Object.assign([],r.getData("mappedFiles"))),r.dragAndDropModule(),document.querySelector("crm-dm-map-modules").component.methods.checkforNofiles()}}.bind(this),function(t){e.setData("errorMessage",this.getErrorMessageFromFailedResponse(t)),e.setData("showError",!0)}.bind(this)),!1}var n=0,l=$L("crm-dm-map-modules")[0];l?(n=l.component.data.mapped_files)&&(n=n.length):n=t.length;if(n<1)return e.setData("showError",!0),e.setData("errorMessage",I18n.getMsg("crm.module.select.atleast.one")),!1;if(!e.validateAssociation(store.peekRecord("migration-module",e.QUOTES),store.peekRecord("migration-module",e.QUOTE_LINE_ITEMS))&&!e.validateAssociation(store.peekRecord("migration-module",e.QUOTES),store.peekRecord("migration-module",e.QuotedItems)))return e.setData("errorMessage",I18n.getMsg("crm.migration.lineItem.notMapped",I18n.getMsg(e.QUOTES))),e.setData("showError",!0),!1;if(!e.validateAssociation(store.peekRecord("migration-module",e.INVOICES),store.peekRecord("migration-module",e.INVOICE_LINE_ITEMS))&&!e.validateAssociation(store.peekRecord("migration-module",e.INVOICES),store.peekRecord("migration-module",e.InvoicedItems)))return e.setData("errorMessage",I18n.getMsg("crm.migration.lineItem.notMapped",I18n.getMsg(e.INVOICES))),e.setData("showError",!0),!1;if(!e.validateAssociation(store.peekRecord("migration-module",e.SALESORDERS),store.peekRecord("migration-module",e.SALES_ORDER_LINE_ITEMS))&&!e.validateAssociation(store.peekRecord("migration-module",e.SALESORDERS),store.peekRecord("migration-module",e.OrderedItems)))return e.setData("errorMessage",I18n.getMsg("crm.migration.lineItem.notMapped",I18n.getMsg(e.SALESORDERS))),e.setData("showError",!0),!1;if(!e.validateAssociation(store.peekRecord("migration-module",e.PURCHASEORDERS),store.peekRecord("migration-module",e.PURCHASE_ORDER_LINE_ITEMS))&&!e.validateAssociation(store.peekRecord("migration-module",e.PURCHASEORDERS),store.peekRecord("migration-module",e.PurchaseItems)))return e.setData("errorMessage",I18n.getMsg("crm.migration.lineItem.notMapped",I18n.getMsg(e.PURCHASEORDERS))),e.setData("showError",!0),!1;var c=[];store.peekAll("module").forEach((function(e){"subform"===e.generated_type&&c.push({child:e.module_name,parent:e.parent_module.module_name,plabel:e.parent_module.plural_label})}));for(var d=c.length,u=0;u<d;u++)if(!e.validateAssociation(store.peekRecord("migration-module",c[u].child),store.peekRecord("migration-module",c[u].parent),!0))return e.setData("showError",!0),e.setData("errorMessage",I18n.getMsg("crm.migration.subform.notMapped",I18n.getMsg(c[u].plabel))),!1;return!0},postProcessFilePreview:function(){var e=$("#preview_mapped_files"),t=$("#preview_unmapped_files");0===e.children().length?$("#nofileunmapped").removeClass("dN"):$("#nofileunmapped").addClass("dN"),0===t.children().length?$("#nofilemapped").removeClass("dN"):$("#nofilemapped").addClass("dN")},refreshUploadedFileCnt:function(){var e=$("#upldFileCnt"),t=$("#dash_list"),r=t.find("li.dz-success.dz-callbackcomplete").length+t.find("li.uploadFileFromServer").length,i=t.find("li").length;e.text(r),0===i?($("#discardBtn,.browse_file").removeClass("dN"),$("#cntSplitter").addClass("dN"),$("#migCsetUpBtn").addClass("dN"),$(".migNotifyEmail").addClass("dN").removeClass("dIB"),$L("#goSc2")[0].ltProp("disabled",!0),this.updateWizardStepsAfterFileUpload(!1)):i===r?($("#totFileCnt").text(i),e.addClass("dN"),$(".slash").addClass("dN"),$("#cntSplitter").removeClass("dN"),$L("#goSc2")[0].ltProp("disabled",!1),this.updateWizardStepsAfterFileUpload(!0)):(this.updateWizardStepsAfterFileUpload(!0),e.removeClass("dN"),$(".slash").removeClass("dN"),$("#totFileCnt").text(i))},handleWmSMessages:function(e,t,r){var i=Lyte.Router.getRouteInstance().transition.info&&Lyte.Router.getRouteInstance().transition.info.dynamicParams?Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]:null,a=window.location.pathname,s=!1;if(r.isSample=!1,r.sourceSystem&&"sample"!==r.sourceSystem&&"rollback"!==t.module?r.isSample=!1:r.isSample=!0,(t.message?t.message.id:t.migrationId===i)&&(s=!0),"migrationFileNotSupported"===e&&(s=!0),i&&s&&a.startsWith(Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/settings/migration")))switch(e){case"migrationUploadComplete":if(t.message&&"UPLOAD"===t.message.status){if(c=(c=$L("crm-dm-wizard-steps"))&&c[0]?c[0].component:void 0)return c.setData("errorMessage",I18n.getMsg("crm.migration.error.102")),c.setData("showError",!0),store.unloadRecord("migration",i),void(Lyte.Router.transitionTo({route:"crm.settings.migration.index.file-upload",dynamicParams:[i]}).data=t.message)}else Lyte.Router.transitionTo({route:"crm.settings.migration.index.map-modules",dynamicParams:[i]}).data=t;break;case"migrationFileNotSupported":case"migrationUploadVirusCallBack":var o;(o=$("#"+t.eventid).data(t.eventid))&&o(t);break;case"migrationApiInterrupt":var n=$("#exceptionErrorMsg");n.text(I18n.getMsg("crm.migration.api.error.datapulling")),n.addClass("redImp");break;case"migrationAfterCompleteNotification":var l=$L("crm-dm-wizard-steps")[0];l&&l.component.actions.cancelHaltMigration(l.component);case"migrationInitiated":case"migrationAborted":case"updateMigrationProgressForFile":case"migrationModuleCompleteNotification":if(t.message){var c,d=store.serializer.migration.normalizeResponse("migration","createRecord",t.message);this.setCompleteTreeData(d.data,!1),(c=$L("crm-dm-wizard-steps")[0].component)&&!0===c.getData("isMigrationComplete")&&document.querySelector("crm-dm-complete").component.finishHeight(),store.pushPayload("migration",d.data)}}else if("migrationUploadVirusCallBack"!==t.module&&r&&r.content&&("migrationUploadComplete"!==t.module||!t.message||"UPLOAD"!==t.message.status)){var u=document.querySelector("crm-dm-notification");u&&u.remove(),Lyte.Component.render("crm-dm-notification",r,"body")}},addModule:function(e,t,r,i,a,s,o){if(!t||""!==i.trim()||""!==a.trim()){if(r||""!==e.trim()&&void 0!==e||(e=i+" X "+a),!e||""===e.trim()||void 0===e)return!1;$("#modCreateErrorMsg").addClass("dN"),commonUtils.showHideLoadingDiv(!0);var n={payLoad:{}};n.payLoad.moduleName=e,n.payLoad.LinkingModule=t,n.payLoad.mModuleSysref=i,n.payLoad.nModuleSysref=a,n.payLoad.mfieldLabel=s,n.payLoad.linkingModulePresence=r,n.payLoad.nfieldLabel=o,n.type="createMigrationModule",n.url="crm/migration/v1/createMigrationModule",n.method="POST",store.createRecord("dummy"),store.create("dummy",void 0,n).then((function(i){i=i.dummy;var a=$L("crm-dm-map-modules")[0].component,s=$L("crm-dm-create-custom-module-model")[0].component;if(i.hasOwnProperty("STATUS_CODE")&&"ZS001"===i.STATUS_CODE){var o=i.STATUS_MESSAGE,n=JSON.parse(o);if(t&&!r)$("#newmodname, #fieldLabelInMModule, #fieldLabelInNModule").val(""),document.getElementById("createModPopover").ltProp("show",!1),a.setData("show_pop_over",!1),s.setData("successMessageCreateModule",I18n.getMsg("crm.bulk.fields.created.success")),s.setData("showSuccessMessageCreateModule",!0),crmTab.reloadTabMenu(!0);else if(n.hasOwnProperty("sysRefName")){var l=a.getData("modules"),c={};c.plural_label=e,c.generated_type=t?"linking":"custom",c.api_name=n.sysRefName,l[n.tabname]=c,a.setData("modules",Object.assign({},l));var d=a.getFromStore("moduleVsLabel"),u=a.getFromStore("labelVsApi"),m=a.getFromStore("apiVsModule"),p=a.getFromStore("labelVsModule"),g=a.getFromStore("apiVsLabel");d[n.tabname]=e,u[e]=n.sysRefName,m[n.sysRefName]=n.tabname,p[e]=n.tabname,g[n.sysRefName]=e,a.addToStore({labelVsApi:u,moduleVsLabel:d,labelVsModule:p,apiVsModule:m,apiVsLabel:g});var f=0,h=0,y=0;for(var v in l)l[v]&&(l[v].files?f+=1:h+=1,y+=1);a.setData("total_modules",y),a.setData("mapped_modules",f),a.setData("unmapped_modules",h),$("#newmodname, #fieldLabelInMModule, #fieldLabelInNModule").val(""),document.getElementById("createModPopover").ltProp("show",!1),a.setData("show_pop_over",!1);var _=$L("crm-dm-folder-list")[0].component;_.setData("modules_copy",Object.assign({},l)),$("#allFltrModule").click(),_.actions.showFilePreview(c,n.tabname),crmTab.reloadTabMenu(!0)}else n.hasOwnProperty("WRNG")&&(s.setData("errorMessageCreateModule",$ESAPI.encoder().encodeForHTML(o)),s.setData("showErrorMessageCreateModule",!0));store.findAll("module")}commonUtils.showHideLoadingDiv()}),(function(t){var r=$L("crm-dm-create-custom-module-model")[0].component,i=JSON.parse(t.responseText);i.STATUS_MESSAGE?r.setData("errorMessageCreateModule",I18n.getMsg("crm.module.create.failure",e)+" : "+i.STATUS_MESSAGE):r.setData("errorMessageCreateModule",I18n.getMsg("crm.module.create.failure",e)+I18n.getMsg("crm.migration.general.error")),r.setData("showErrorMessageCreateModule",!0),commonUtils.showHideLoadingDiv()}))}},handleErrorResponse:function(e){var t=$L("crm-dm-wizard-steps")[0].component;t.setData("errorMessage",this.getErrorMessageFromFailedResponse(e)),t.setData("showError",!0)},getErrorMessageFromFailedResponse:function(e){var t=e.responseText,r=JSON.parse(t),i=r.code,a=r.message;switch(i){case"NO_PERMISSION":return I18n.getMsg("crm.social.setup.denied");case"RESOURCE_NOT_FOUND":return I18n.getMsg("crm.migration.id.notFound");case"MANDATORY_FIELDS_NOT_MAPPED":var s="";return r.hasOwnProperty("details")&&r.details.hasOwnProperty("api_name")&&(s=r.details.api_name),I18n.getMsg("crm.import.one.mandatory.field.notmapped",Handlebars.helpers.encodeHTML(s));case"DUPLICATE_FIELD_MAPPED":s="";return r.hasOwnProperty("details")&&r.details.hasOwnProperty("api_name")&&(s=r.details.api_name),I18n.getMsg("crm.import.field.already.mapped",Handlebars.helpers.encodeHTML(s));case"SINGULAR_SYSTEM_MODULE_LABELS":var o=I18n.getMsg("crm.create.module.singular.tab.label");return I18n.getMsg("crm.general.restricted.label.error",[Handlebars.helpers.encodeHTML(a),o]);case"PLURAL_SYSTEM_MODULE_LABELS":o=I18n.getMsg("crm.create.module.plural.tab.label");return I18n.getMsg("crm.general.restricted.label.error",[Handlebars.helpers.encodeHTML(a),o]);default:return I18n.getMsg("zb.common.error.PageTitle")}},convertToSupportedFormat:function(e,t){var r={};switch(t){case"files":r.mapped_files=[],r.unmapped_files=[],r.empty_files=[],r.unsupported_files=[];for(var i=e.files,a=i.length,s=0;s<a;s++){var o=i[s];switch(o["sample-data"]&&(o["sample-data"]=o["sample-data"].slice(0,15)),o.type){case"mapped":r.mapped_files.push(o);break;case"unmapped":r.unmapped_files.push(o);break;case"unsupported":r.unsupported_files.push(o);break;case"empty":r.empty_files.push(o)}}}return r.unmapped_files&&(r.unmapped_files=this.sort_by_key(r.unmapped_files,"name")),r},sort_by_key:function(e,t){return e.sort((function(e,r){var i=e[t],a=r[t];return i<a?-1:i>a?1:0}))},showActiveModuleFilter:function(e){var t=e.outerWidth(),r=e.outerHeight(),i=e.position().left,a=$(".migFieldFilterOuter");a.find("lyte-tab-title").removeClass("lyteTabActive active");var s=a.find(".moduleSelection");e.addClass("lyteTabActive"),s.css({left:i,width:parseFloat(t),height:r}).removeClass("dN")},resetDragging:function(){$L("#leftmenu").removeClass("migDragStarts"),$L("#listUnMapped").find("li").removeClass("migDragElement"),$L("#folderlistul").find("li").removeClass("show_border enable_drag"),$L("#noModuleMatch, #dragFreeze").addClass("dN")},refreshSearchView:function(){if($L("#migSearchModFile").length){var e=document.getElementById("migSearchModFile"),t=e.component.data.ltPropValue;""!==t&&e.setValue(t)}},dragAndDropModule:function(){var e=this,t=$L("#listUnMapped").find("li"),r=$L("#folderlistul").find("li");t.length&&r.length&&(t.draggable({containment:"#stepcontent",helper:"original",tolerance:"pointer",scrollSpeed:1,onStart:function(){document.onselectstart=function(){return!1}},helper:function(e){return $(e).addClass("migDragElement"),e.cloneNode(!0)},scrollDivY:"#migModuleTabs lyte-tab-body",onDragStart:function(e){$("#leftmenu").addClass("migDragStarts");var t=$L(e).find(".fname")[0].component.data.ltPropValue;document.querySelector("crm-dm-map-modules").component.methods.highlightCompatibleModules(t),$("#dragFreeze").removeClass("dN")},onStop:function(){return document.onselectstart=function(){return!0},e.resetDragging(),!1}}),r.droppable({accept:["#listUnMapped li"],hoverClass:"show_border",tolerance:"pointer",onDrop:function(t,r){if($L(r).hasClass("enable_drag")){var i=$L("crm-dm-map-modules")[0].component,a=i.data;if(!r.id)return;var s,o=$L(r).attr("data-apiname")?$L(r).attr("data-apiname"):r.id.substring(7),n=$L(t).find(".fname")[0].component.data.ltPropValue,l=[];if(a.modules[o]&&a.modules[o].files&&a.modules[o].files.length)(l=a.modules[o].files).push(n),(s=store.peekRecord("migration-module",o)).$.set("files",Object.assign([],l));else{l.push(n);var c={};c.files=l,c.module=o,(s=store.createRecord("migration-module",c)).$.isError&&(store.unloadRecord("migration-module",o),s=store.createRecord("migration-module",c))}i.addToStore({module:o});var d=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];void 0===s.data_migration&&s.$.set("data_migration",d);var u=store.peekRecord("migration",d);commonUtils.showHideLoadingDiv(!0),u.$.save({module:o}).then((function(t){if(commonUtils.showHideLoadingDiv(),t&&t.migration&&"SUCCESS"===t.migration.code){var r=$L("crm-dm-map-modules")[0].component,i=r.data,a=r.getData("unmapped_files"),s=r.getData("mapped_files"),c=r.getData("removedFile");s.push(c);var d=i.modules;d[o].files=l,r.setData("modules",Object.assign({},d));var u=$L("crm-dm-folder-list")[0].component,m=u.getData("modules_copy");m[o]=d[o],u.setData("modules_copy",Object.assign({},m));var p=i.filesVsModules;p[n].module=o,r.setData("filesVsModules",Object.assign({},p)),$L("#unMappedCount").text(a.length),r.setData("mapped_files",Object.assign([],s)),e.dragAndDropModule(),document.querySelector("crm-dm-map-modules").component.methods.checkforNofiles(),e.refreshSearchView()}}),function(t){commonUtils.showHideLoadingDiv(),store.unloadRecord("migration-module",o);var r=i.getData("removedFile"),a=i.getData("removedFileIndex"),s=i.getData("unmapped_files");r&&(Lyte.arrayUtils(s,"insertAt",a,r),i.setData("removedFile",void 0),e.dragAndDropModule()),Lyte.registeredMixins["migration-util"].handleErrorResponse(t)}.bind(this));var m=-1,p=i.getData("unmapped_files");for(var g in p){if(p[g].name===n){m=g;break}}-1!==m&&(i.setData("removedFile",p[m]),i.setData("removedFileIndex",m),Lyte.arrayUtils(p,"removeAt",m,1)),$(r).addClass("dragHighlight"),setTimeout((function(){$("#folderlistul").find("li").removeClass("dragHighlight"),e.refreshSearchView()}),500),e.resetDragging()}}}))}}),Lyte.Mixin.register("migration-constants",{LEADS:"Leads",ACCOUNTS:"Accounts",CONTACTS:"Contacts",CONTACTROLES:"Contact Roles",POTENTIALS:"Potentials",DEALS:"Deals",STAGE_HISTORY:"Stage History",DEALHISTORY:"DealHistory",DEALCONTACTROLE:"DealContactRole",CAMPAIGNS:"Campaigns",REPORTS:"Reports",DASHBOARDS:"Dashboards",ANALYTICS:"Analytics",FORECASTS:"Forecasts",VISITS:"Visits",ACTIVITIES:"Activities",CASES:"Cases",PRICEBOOKS:"PriceBooks",VENDORS:"Vendors",PRODUCTS:"Products",SOLUTIONS:"Solutions",QUOTES:"Quotes",LAYOUT:"Layout",CONTENT_VERSION:"ContentVersion",JOBSHEETS:"JobSheets",APPOINTMENTS:"Appointments",SERVICES:"Services",QUOTE_LINE_ITEMS:"QuoteLineItems",PURCHASE_ORDER_LINE_ITEMS:"PurchaseOrderLineItems",SALES_ORDER_LINE_ITEMS:"SalesOrderLineItems",INVOICE_LINE_ITEMS:"InvoiceLineItems",QUOTELINEITEMS:"Quote_Line_Items",PURCHASEORDERLINEITEMS:"PurchaseOrder_Line_Items",SALESORDERLINEITEMS:"SalesOrder_Line_Items",INVOICELINEITEMS:"Invoice_Line_Items",QUOTELINEITEMS_QUOTE:"Quote",PURCHASEORDERLINEITEMS_PURCHASEORDER:"Purchase_Order",SALESORDERLINEITEMS_SALESORDER:"Sales_Order",INVOICELINEITEMS_INVOICE:"Invoice",SALESORDERS:"SalesOrders",PURCHASEORDERS:"PurchaseOrders",INVOICES:"Invoices",CALLS:"Calls",SETUP:"Setup",EVENTS:"Events",TASKS:"Tasks",NOTES:"Notes",ATTACHMENTS:"Attachments",INVITEES:"Invitees",COMPETITORS:"Competitors",USERS:"Users",USERS_SMALL:"users",DOCUMENTS:"Documents",HOME:"Home",CHAT:"Chat",PROJECTS:"Projects",DESK:"Desk",POT_STAGE_HISTORY:"PotStageHistory",GOOGLEADWORDS:"Google AdWords",FEEDS:"Feeds",CAMPAIGN_MEMBERS:"Campaign Members",CAMPAIGN_LEAD_MEMBERS:"Campaign Lead Members",CAMPAIGN_CONTACT_MEMBERS:"Campaign Contact Members",POTENTIAL_STAGE_HISTORY:"Potential Stage History",CASE_COMMENTS:"Case Comments",CONTACT_POTENTIAL:"ContactPotential",LEAD_PRODUCT:"LeadProduct",CONTACT_PRODUCT:"ContactProduct",ACCOUNT_PRODUCT:"AccountProduct",POTENTIAL_PRODUCT:"PotentialProduct",PRODUCT_PRICEBOOK:"ProductPriceBook",PRODUCT_INVENTORY:"ProductInventory",PHOTOS:"Photos",fileZoneReady:!1,apiErrorPreFix:"crm.migration.api.error.",QuotedItems:"QuotedItems",OrderedItems:"OrderedItems",PurchaseItems:"PurchaseItems",InvoicedItems:"InvoicedItems",CustomField:function e(){e.prototype.constructor=function(e,t,r,i,a,s,o){this.mapped=e,this.datatype=t,this.name=r,this.error_datatype=i,this.error_name=a,this.hasError=!1,this.subDatatype=s,this.file_index=o,this.error_on_api=void 0},e.prototype.setErrorInName=function(e){e&&this.error_datatype||(this.hasError=!1),this.error_name=e},e.prototype.getErrorInName=function(){return this.error_name},e.prototype.setErrorInDataType=function(e){this.error_name&&e||(this.hasError=!1),this.error_datatype=e},e.prototype.getErrorInDataType=function(){return this.error_datatype},e.prototype.getName=function(){return this.name},e.prototype.setName=function(e){this.name=e},e.prototype.setMapped=function(e){this.mapped=e},e.prototype.getMapped=function(){return this.mapped},e.prototype.setErrorOnApi=function(e){this.error_on_api=e},e.prototype.getErrorOnApi=function(){return this.error_on_api},e.prototype.setDataType=function(e){this.datatype=e},e.prototype.setSpecificsInDataType=function(e){this.subDatatype=e},e.prototype.getSpecificsInDataType=function(){return this.subDatatype},e.prototype.getDataType=function(){return this.datatype},e.prototype.setFileIndex=function(e){this.file_index=e},e.prototype.getFileIndex=function(){return this.file_index}},DataType:function e(){e.prototype.constructor=function(e,t,r){this.limit=e,this.available=t,this.parents=r},e.prototype.getLimit=function(){return this.limit},e.prototype.setLimit=function(e){this.limit=e},e.prototype.getAvailable=function(){return this.available}},Parent:function e(){e.prototype.constructor=function(e){this.limit=e},e.prototype.getLimit=function(){return this.limit},e.prototype.setLimit=function(e){this.limit=e}},Child:function e(){e.prototype.constructor=function(e,t,r,i){this.limit=e,this.parent=t,this.name=r,this.available=i},e.prototype.getParent=function(){return this.parent},e.prototype.getName=function(){return this.name},e.prototype.getLimit=function(){return this.limit},e.prototype.getAvailable=function(){return this.available},e.prototype.setLimit=function(e){this.limit=e}},FieldRow:function e(){e.prototype.constructor=function(e,t,r,i,a){this.header=e,this.index=t,this.labels=r,this.pattern=i,this.sampledata=a,a&&(this.sample0=a[0],this.sample1=a[1]),this.status=r&&r.length>0?r.length:-1,this.is_default=!0},e.prototype.setFileHeader=function(e){this.header=e},e.prototype.getFileHeader=function(){return this.header},e.prototype.setFileIndex=function(e){this.index=e},e.prototype.getFileIndex=function(){return this.index},e.prototype.setLabels=function(e){this.status=e&&e.length>0?e.length:-1,this.labels=e},e.prototype.getLabels=function(){return this.labels},e.prototype.getStatus=function(){return this.status},e.prototype.setPattern=function(e){this.pattern=e},e.prototype.getPattern=function(){return this.pattern},e.prototype.setShowMapIndex=function(e,t){return this.showMapIndex||(this.showMapIndex=[]),this.showMapIndex[e]=t},e.prototype.getShowMapIndex=function(e){return this.showMapIndex[e]},e.prototype.setSampleData=function(e){this.sampledata=e,e&&(this.sample0=e[0],this.sample1=e[1])},e.prototype.getSampleData=function(){return this.sampledata},e.prototype.setPattern=function(e){this.pattern=e},e.prototype.getPattern=function(){return this.pattern},e.prototype.setField=function(e){this.field=e},e.prototype.getField=function(){return this.field},e.prototype.setDefault=function(e){this.default_value=e},e.prototype.getDefault=function(){return this.default_value},e.prototype.setType=function(e){this.default_type=e},e.prototype.getType=function(){return this.default_type},e.prototype.setLookupModule=function(e){this.lookup_module=e},e.prototype.getLookupModule=function(){return this.lookup_module},e.prototype.setDefaultSupported=function(e){this.is_default=e},e.prototype.isDefaultSupported=function(){return this.is_default}},Label:function e(){e.prototype.constructor=function(e,t,r,i,a,s,o){this.api_name=e,this.label=t,this.mandatory=r,this.data_type=i,this.ui_type=a,this.field=s,this.display_label=o},e.prototype.getApiName=function(){return this.api_name},e.prototype.getLabel=function(){return this.label},e.prototype.setLabel=function(e){this.label=e},e.prototype.isMandatory=function(){return this.mandatory},e.prototype.setMandatory=function(e){this.mandatory=e},e.prototype.getType=function(){return this.data_type},e.prototype.setType=function(e){this.data_type=e},e.prototype.getUIType=function(){return this.ui_type},e.prototype.setDefaultSupported=function(e){this.is_default=e},e.prototype.isDefaultSupported=function(){return this.is_default},e.prototype.setDefault=function(e){this.default_value=e},e.prototype.getDefault=function(){return this.default_value},e.prototype.setField=function(e){this.field=e},e.prototype.getField=function(){return this.field},e.prototype.setApiName=function(e){this.api_name=e},e.prototype.setPattern=function(e){this.pattern=e},e.prototype.getPattern=function(){return this.pattern}},DefaultRow:function e(){e.prototype.constructor=function(e,t,r,i){this.default_value=e,this.label=t,this.type=r,this.field=i},e.prototype.getDefault=function(){return this.default_value},e.prototype.setDefault=function(e){this.default_value=e},e.prototype.getLabel=function(){return this.label},e.prototype.setLabels=function(e){this.label=e},e.prototype.getType=function(){return this.type},e.prototype.setType=function(e){this.type=e},e.prototype.setField=function(e){this.field=e},e.prototype.getField=function(){return this.field},e.prototype.setLookupModule=function(e){this.lookup_module=e},e.prototype.getLookupModule=function(){return this.lookup_module}},CustomModule:function e(){e.prototype.constructor=function(e,t,r,i,a,s,o){this.module=e,this.islinking=t,this.m_module=r,this.ms_lookup=i,this.n_module=a,this.relatedmodule=s,this.show_linking_module=o},e.prototype.getModuleName=function(){return this.module},e.prototype.setModuleName=function(e){this.module=e},e.prototype.setLinking=function(e){this.islinking=e},e.prototype.isLinking=function(){return this.islinking},e.prototype.setMModule=function(e){this.m_module=e},e.prototype.getMModule=function(){return this.m_module},e.prototype.getNModule=function(){return this.n_module},e.prototype.setNModule=function(e){this.n_module=e},e.prototype.getMSLookupLabel=function(){return this.ms_lookup},e.prototype.setMSLookupLabel=function(e){this.ms_lookup=e},e.prototype.getRelatedModuleLabel=function(){return this.relatedmodule},e.prototype.setRelatedModuleLabel=function(e){this.relatedmodule=e},e.prototype.setShowLinkingModule=function(e){this.show_linking_module=e},e.prototype.isShowLinkingModule=function(){return this.show_linking_module}},TreeObject:function e(){e.prototype.populateChild=function(e,t,r,i,a,s,o,n){this.module=e,this.status=t,this.added=r,this.skipped=i,this.total=a,this.clas=s,this.id=o,this.moduleLabel=n},e.prototype.populateParent=function(e,t,r,i,a,s,o,n,l,c){this.module=e,this.status=t,this.added=r,this.skipped=i,this.total=a,this.clas=s,this.onClickMethod=o,this.children=n,this.importStatus=l,c&&(this.defaultState="close")}},bindUploadBtnAndOpts:function(e,t,r){try{new FileUploader(document.getElementById("dragarea"),{autoProcessQueue:!0,previewsContainer:"#dash_list",uploadMultiple:!0,createImageThumbnails:!1,maxFileSize:2048,totalFilesize:8192,filesizeBase:1024,maxFiles:200-(r||0),clickable:["#fileUploadbtn","#fileUploadbtnSmall"],headers:{feature:"uploadMigration",userid:t,"X-CRM-ORG":crmZgid},acceptedFiles:".zip,.csv",previewTemplate:Handlebars.templates.UploadFileTemplate(),notificationLimit:1e4,uploadMethod:"zfs",dictRemoveFileConfirmation:I18n.getMsg("crm.migration.delete.upload.file"),dictMaxFilesExceeded:I18n.getMsg("crm.migration.upload.max.files.exceed"),dictReponseError:I18n.getMsg("crm.fileuploader.responseerror"),save:"#goSc2",cancel:"#discardConfirmSuccess",init:function(){var t=this;this.options.maxFiles=200-(r||0),t.on("dragover",(function(){var e=$L("#dragarea"),t=e.height(),r=e.width();$(".browse_file").addClass("dN"),e.addClass("drag_highlight"),$("#drop_files").css({width:r,height:t}).removeClass("dN"),$("#dash_list").css("opacity",".1")})),t.on("dragleave",(function(){$("#drop_files").addClass("dN");var e=$("#dash_list");e.css("opacity","1"),0===this.files.length+e.children().length&&$(".browse_file").removeClass("dN"),$L("#dragarea").removeClass("drag_highlight")})),t.on("rejectedallfiles",(function(){var e=$("#dash_list");0===this.files.length+e.children().length&&$(".browse_file").removeClass("dN"),$L("#dragarea").removeClass("drag_highlight")})),t.on("drop",(function(){$("#drop_files").addClass("dN");var e=$("#dash_list");e.css("opacity","1"),$L("#dragarea").removeClass("drag_highlight"),0===this.files.length+e.children().length&&$(".browse_file").removeClass("dN")})),t.on("terminate",(function(){$("#upldFileCnt").text(""),$("#totFileCnt").text("")})),t.on("removedfile",(function(){Lyte.registeredMixins["migration-util"].refreshUploadedFileCnt()})),t.on("addedfile",(function(){var e=this.files.length,t=$("#dash_list");$("#drop_files").addClass("dN"),t.css("opacity","1"),$L("#dragarea").removeClass("drag_highlight"),$("#cntSplitter").removeClass("dN"),e&&($("#migCsetUpBtn").removeClass("dN"),$(".browse_file").addClass("dN")),Lyte.registeredMixins["migration-util"].updateWizardStepsAfterFileUpload(!0),Lyte.registeredMixins["migration-util"].refreshUploadedFileCnt(),$L("#goSc2")[0].ltProp("disabled",!0)})),t.on("callbackcomplete",(function(){Lyte.registeredMixins["migration-util"].refreshUploadedFileCnt()})),t.on("uploadprogress",(function(e,t,r){$(e.previewElement).find(".ufsizetxt").text(Lyte.registeredMixins["migration-util"].formatBytes(r,1)+" / "+Lyte.registeredMixins["migration-util"].formatBytes(e.size,1)),$("#goSc2").prop("disabled",!0)})),t.on("sending",(function(t,r){r.setRequestHeader("migrationid",e)})),t.on("error",(function(e){var t=$(e.previewElement),r=t.find(".ufstatustxt");Lyte.registeredMixins["migration-util"].setUploadStatus(r,"migScanUploadFailed"),t.find(".migsvg-loader").hide()})),t.on("complete",(function(e){var t=$(e.previewElement),r=t.find(".pgbarOuter"),i=t.find(".mig-up-close");r.hide(),i.fadeOut(),t.hasClass("dz-error")||t.find(".migsvg-loader").fadeIn();var a=t.find(".ufstatustxt");t.find(".ufsizetxt").text(Lyte.registeredMixins["migration-util"].formatBytes(e.size,1)),a.show(),Lyte.registeredMixins["migration-util"].refreshUploadedFileCnt()})),t.on("customizepreviewtemplate",(function(e){var t=$(e.previewElement),r=t.find(".mig_img");"application/zip"===e.type||e.name.toLowerCase().endsWith(".zip")?r.addClass("mig_zip"):("text/csv"===e.type||e.name.toLowerCase().endsWith(".csv"))&&r.addClass("mig_csv");var i=t.find(".dz-filename"),a=e.name;a.length>20&&i.attr("title",a),i=t.find(".dz-size")}))},customConfirmCallback:function(e,t){$L("crm-dm-file-upload")[0].component.actions.showDeleteFilePopUp(t.name,t.previewElement.id),$("#deleteUploadedFile").click((function(){success(),$("#dash_list").children().length>0&&$("#goSc2").prop("disabled",!1)}))},fileUploaderCallback:function(e){var t=$("#"+e.eventid),r=t.find(".ufstatustxt");switch(t.find(".virus_scan").hide(),e.code){case"CV01":Lyte.registeredMixins["migration-util"].setUploadStatus(r,"migScanVirusFound");break;case"CV02":Lyte.registeredMixins["migration-util"].setUploadStatus(r,"migScanCompleted"),t.find(".migsvg-loader").addClass("completescan");break;case"CV03":Lyte.registeredMixins["migration-util"].setUploadStatus(r,"migScanFileImproper")}setTimeout((function(){t.find(".migsvg-loader").fadeOut(),t.find(".migUplFileDelete").fadeIn()}),1900)}})}catch(e){murphy.error(e)}}}),Lyte.Component.register("crm-dm-notification",{_template:'<template tag-name="crm-dm-notification"> <lyte-modal id="dm_notification" lt-prop-wrapper-class="migNotificationPop" lt-prop-show="{{showNotification}}" lt-prop-width="400px" lt-prop-height="auto" lt-prop-transition="{&quot;animation&quot;:&quot;slideFromBottom&quot;}" lt-prop-offset="{&quot;right&quot;:&quot;20&quot;,&quot;bottom&quot;:&quot;30&quot;}" lt-prop-freeze="false" lt-prop-close-on-escape="false" lt-prop-show-close-button="false"> <template is="registerYield" yield-name="modal"> <lyte-modal-header class="migNotifyHeader">{{title}}<span class="zcrm_svgIcons migWhiteCloseIcon fR mT5 cP" onclick="{{action(\'closeNotification\')}}"></span></lyte-modal-header> <lyte-modal-content class="migNotifyContentPadding txt-ctr"> <span class="compLogo {{getBrandLogo()}} dIB vam"></span> <span class="migCompletePop pR dIB vam"> <span class="zcrm_svgIcons migRightArr pA"></span> </span> <img class="crmLogoImg vam" alt="CRM" src="{{getLogoUrl(\'Logo_url\')}}"> </lyte-modal-content> <lyte-modal-footer class="migNotifyFooter"> <template is="if" value="{{expHandlers(isSample,\'!\')}}"><template case="true"> <lyte-button lt-prop-appearance="primary" onclick="{{action(\'openUrl\')}}"> <template is="registerYield" yield-name="text">{{content}}</template> </lyte-button> </template><template case="false"> <p class="f14 color_2">{{content}}</p> </template></template> </lyte-modal-footer> </template> </lyte-modal> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,0]},{type:"attr",position:[1,2]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"attr",position:[3,5]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5,1]},{type:"if",position:[5,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["showNotification","id","content","title","sourceSystem","isSample"],data:function(){return{showNotification:Lyte.attr("boolean",{default:!0}),id:Lyte.attr("string"),content:Lyte.attr("string"),title:Lyte.attr("string",{default:I18n.getMsg("crm.migration.label.DataMigration")}),sourceSystem:Lyte.attr("string"),isSample:Lyte.attr("boolean",{default:!1})}},actions:{openUrl:function(){var e=this.getData("id");networkUtils.openUrl(window.location.origin+Crm.getCrmBasePath()+"/settings/migration/"+e,"_blank")},closeNotification:function(){document.querySelector("crm-dm-notification").remove()}}}),Lyte.Component.registerHelper("getBrandLogo",(function(){switch(this.getData("sourceSystem").toLowerCase()){case"salesforce":return"migLogoSf";case"hubspot":return"migLogoHub";case"pipedrive":return"migLogoPipe";case"insightly":return"migLogoInsight";case"maximizer":return"migLogoMaxmizer";case"msdynamics":return"migLogoDynamics";case"zohocontactmanager":return"migLogoCntManager";case"highrise":return"migLogoHigh";case"others":return"migLogoOther";case"zoho":default:return"migLogoZoho"}})),Lyte.Mixin.register("crm-menu-utils",{changeMenu:function(e){var t={dynamicParams:[],queryParams:{}};if("Approvals"==e)Lyte.Router.getRouteInstance().transitionTo("crm.tab.approvals.index");else{var r,i=moduleRecordMapping[e];if(i.custom_view&&i.custom_view.id&&"Home"!=i.api_name&&"Forecasts"!=i.api_name){i.kanban_view?t.route="crm.tab.module.custom-view.kanban":i.canvas_view?t.route="crm.tab.module.custom-view.canvas":t.route="crm.tab.module.custom-view.list",t.dynamicParams.push(e),t.dynamicParams.push(i.custom_view.id),i.viewid&&t.dynamicParams.push(i.viewid);var a=crmTab.getFromCache(e);a&&a.filters&&(t.queryParams={filters:JSON.stringify(a.filters)},a.filterId&&(t.queryParams.filter_id=a.filterId)),t.data={clearselectedIds:!0}}else if("Home"==i.api_name)t.route="crm.tab.module.begin",t.dynamicParams.push(e);else if("Google_AdWords"==i.api_name&&"crm.tab.google-adwords"!=Lyte.Router.getRouteInstance().transition.info.route)t.route="crm.tab.google-adwords";else if("Projects"==i.api_name&&"crm.tab.projects"!=Lyte.Router.getRouteInstance().transition.info.route)t.route="crm.tab.projects";else if("Marketplace"==i.api_name)t.route="crm.tab.marketplace";else if("Dashboards"==i.api_name)t.route="crm.tab.dashboards.index";else if("Google AdWords"==i.api_name)t.route="crm.tab.google-adwords";else if("Forecasts"==i.api_name)t.route=newForecastsEnabled?"crm.tab.newForecasts.index":"crm.tab.forecasts.index";else if("Reports"==i.api_name)t.route=newReportsEnabled?"crm.tab.newReports":"crm.tab.reports.index";else if("Messages"===i.api_name)t.route="crm.tab.messages";else if("Approvals"==i.api_name)t.route="crm.tab.approvals.index";else{if("SalesInbox"==i.api_name&&crmTab.isMailClientActive)return void("undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()?window.open(RebrandLinkUtil.getProperty("URLPROTOCOL")+"://"+RebrandLinkUtil.getProperty("CRMURL")+Crm.getOrgSpecificURL(Urls.Salesinbox)):window.location=window.location.origin+Crm.getOrgSpecificURL(Urls.Salesinbox));if("SalesInbox"==i.api_name&&crmTab.isMailClientActive)return void("undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()?window.open(RebrandLinkUtil.getProperty("URLPROTOCOL")+"://"+RebrandLinkUtil.getProperty("CRMURL")+Crm.getOrgSpecificURL(Urls.Salesinbox)):window.location=crmHistory.locationOrigin+Crm.getOrgSpecificURL(Urls.Salesinbox));t.route="crm.tab.module.index-module",t.dynamicParams.push(e)}Crm.checkIfSameRoute(Lyte.Router.getRouteInstance().transition.info,t)?r=Lyte.Router.getRouteInstance().refresh():(customViewObject&&customViewObject.module==i.api_name&&customViewObject.filters&&!t.queryParams.filters&&(t.queryParams.filters=JSON.stringify(customViewObject.filters)),r=Lyte.Router.transitionTo(t)),t.data&&(r.data=t.data,delete t.data)}},checkParamsAndTransition:function(e,t,r){var i={dynamicParams:[t||e.module_name,e.custom_view.id],queryParams:{},route:"crm.tab.module.custom-view.list"};return e.kanban_view?i.route="crm.tab.module.custom-view.kanban":e.canvas_view&&0!=e.customized_view?i.route="crm.tab.module.custom-view.canvas":e.zia_view&&(i.route="crm.tab.module.custom-view.zia"),e.viewid&&i.dynamicParams.push(e.viewid),r&&((r.filter_id||r.filterId)&&(i.queryParams.filter_id=r.filter_id?r.filter_id:r.filterId),r.filters&&(i.queryParams.filters=JSON.stringify(r.filters)),r.cross_filters&&(i.queryParams.cross_filters=JSON.stringify(r.cross_filters)),e.kanban_view&&r.layoutId&&(i.queryParams.layout_id=r.layoutId),e.kanban_view&&r.pipeline&&(i.queryParams.pipeline=r.pipeline)),i}}),Lyte.Mixin.register("crm-open-help",{actions:{openHelp:function(e,t,r,i){if(t)switch(Crm.userDetails.LOCALE){case"fr_FR":e=RebrandLinkUtil.getProperty("HELPLINK_URL_NEW")+"fr/crm/help/"+crmConstants.helpUrl[e];case"es_ES":e=RebrandLinkUtil.getProperty("HELPLINK_URL_NEW")+"es-xl/crm/help/"+crmConstants.helpUrl[e];case"pt_BR":e=RebrandLinkUtil.getProperty("HELPLINK_URL_NEW")+"pt-br/crm/help/"+crmConstants.helpUrl[e];case"de_DE":e=RebrandLinkUtil.getProperty("HELPLINK_URL_NEW")+"de/crm/help/"+crmConstants.helpUrl[e];default:e=crmConstants.helpUrl["help.domain.url"]+crmConstants.helpUrl[e]}r&&(e=("zh_CN"==Crm.userDetails.LOCALE?RebrandLinkUtil.getProperty("CRM_HELPLINK_CN"):RebrandLinkUtil.getProperty("index_help_url"))+crmConstants.helpUrl[e]);openHelp(e,i)}}}),Lyte.Mixin.register("crm-view-utils",{isRecordFetched:!1,initiateRequest:function(e,t,r,i,a,s){this.isRecordFetched=!1;var o=moduleRecordMapping[r],n=e.queryParams,l={};if(this.beforeRecordAPI(n,l,o,a,s),!this.preventTransition){var c=l.per_page?Number(l.per_page):o.per_page;500==c&&500==Crm.userDetails.maxRange?c=500:-1==[10,20,30,40,50,100].indexOf(c)?c=o.per_page:100!=c||Crm.userDetails.ISPAID_USER||(c=50),this.per_page=c,l.per_page=c,n&&n.sort_by&&n.sort_order&&["asc","desc","unsort"].contains(n.sort_order)&&o.custom_view&&(null==o.custom_view.sort_order&&"unsort"!=n.sort_order||o.custom_view.sort_order&&o.custom_view.sort_order!=n.sort_order||validationUtils.isNotEmpty(o.custom_view.sort_by)&&o.custom_view.sort_by.id!=n.sort_by)&&(this.updateSort=!0,store.unloadAll(o.id));var d=o.id;t.module=o.module_name,this.cachedObj.searchletter&&"All"!=this.cachedObj.searchletter&&(t.clearCache=!0);var u=[],m=Number(l.page);if(t.clearCache)store.unloadAll(d),0!=this.fetchCount&&(o.total_count=void 0);else{u=store.model[d]?store.model[d].data.sortBy("recnum"):u;var p=(m-1)*o.per_page+1,g=m*o.per_page-1;g=o.total_count&&o.total_count<g?o.total_count-1:g}this.queryObj=l;var f=this,h=$L("crm-customview-layer")[0];return!t.clearCache&&u.length>0&&u[p-1]&&u[g]&&u[p-1].recnum===p?Lyte.resolvePromises({cv_records:u.splice(p-1,o.per_page),module:t.module,total_count:moduleRecordMapping[t.module].total_count}):(store.model[d]||store.registerModel(d,{},{extends:"entity"}),this.cachedObj.searchletter&&"All"!=this.cachedObj.searchletter&&(delete t.clearCache,this.cachedObj.searchletter="All"),Crm.userDetails.fetchCountValues?!1!==i.fetchCount&&!1!==this.fetchCount||!this.cachedObj?(h&&h.setData("show_loading",!0),this.triggerRecordCount=!0):(this.cachedObj.totalCount=moduleRecordMapping[o.module_name].total_count,i.currentModel&&(i.currentModel.total_count=moduleRecordMapping[o.module_name].total_count)):h&&(!1!==i.fetchCount&&!1!==this.fetchCount||!this.cachedObj)&&h.setData("total_new_count","###"),new Promise((function(e,r){if(f.updateSort){var i=store.peekRecord("custom_view",l.cvid);"unsort"==n.sort_order?(i.$.set("sort_by",{}),i.$.set("sort_order",void 0)):(i.$.set("sort_order",l.sort_order),i.$.set("sort_by",{id:l.sort_by})),store.triggerAction("custom_view","change_sort",{sort_by:i.sort_by,sort_order:i.sort_order,module:o.api_name,id:l.cvid}).then((function(){a()}),(function(e){r(e)})),delete f.updateSort}else a();function a(){Promise.all([app.store.makeRequest("findAll",d,l,void 0,!1)]).then((function(r){f.isRecordFetched=!0;var i={};if(i.module=t.module,r[0]){if(i.cv_records=r[0][d],r[0].meta)for(var a in r[0].meta)i[a]=r[0].meta[a]}else i.cvError=!0;e(i)}),(function(e){r(e)}))}})))}delete this.preventTransition},beforeRecordAPI:function(e,t,r,i,a){var s=crmConstants.moduleDisplayField[r.module_name]?crmConstants.moduleDisplayField[r.module_name][0]:"";for(var o in e)if(null!=e[o]&&(e[o]||!1===e[o]))switch(o){case"sort_order":"unsort"==e.sort_order?delete t.sort_by:t.sort_order=e.sort_order;break;case"search_letter":t.alphabet=e.search_letter,t.fields=[r.module_name.indexOf("CustomModule")>-1||r.module_name.indexOf("LinkingModule")>-1?"Name":s];break;case"search_field":!e.search_letter||"Full_Name"!==e.search_field&&"Last_Name"!==e.search_field||(t.alphabetical_index_field=e.search_field);break;case"filter_id":t.filter_id=e.filter_id;break;default:t[o]=e[o]}t.sort_order&&!t.sort_by&&delete t.sort_order,"Campaigns"==r.module_name&&(t.exclude_followup_campaigns=!0),1===Crm.userDetails.TMENABLED&&!a&&void 0===t.territory_id&&r.territory&&r.territory.id&&0!==r.territory.id&&/Leads|Contacts|Potentials|Deals|Accounts/.test(r.module_name)&&(t.territory_id=r.territory.id,r.territory.subordinates&&(t.include_child=r.territory.subordinates));var n=this.cachedObj?this.cachedObj:crmTab.getFromCache(r.module_name);n=n||{};var l=t.filters&&"string"==typeof t.filters?JSON.parse(t.filters):t.filters;if(t.filters&&this.isOldCriteria(l))try{var c=this.oldCriteria_to_newCriteria(JSON.parse(t.filters),Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]);return c?(e.filters=t.filters=c.filters?JSON.stringify(c.filters):void 0,c.cross_filters&&(e.cross_filters=t.cross_filters=JSON.stringify(c.cross_filters)),this.preventTransition=!0,this.transition.abort(),void(this.setQueryParams(e).data={clearCache:!0})):(this.filterErrorMsg(I18n.getMsg("crm.filter.error.label",I18n.getMsg("crm.report.filters")),"message"),void delete t.filters)}catch(e){return this.filterErrorMsg(I18n.getMsg("crm.filter.error.label",I18n.getMsg("crm.report.filters")),"message"),void delete t.filters}n.filters=t.filters?this.parse_Nested_Json(t.filters):void 0,n.cross_filters=t.cross_filters?this.parse_Nested_Json(t.cross_filters):void 0,t.filter_id&&(t.filters||t.cross_filters)&&(delete t.filters,delete t.cross_filters);var d=this.portalName?this.portalName:n?n.screenName:void 0;d&&"allportals"!==d&&(t.portal_name=CrmTracking.portalsInfo[d]),t.fields?(t.fields=r.$properties?t.fields.concat(r.$properties):t.fields,r&&r.$on_demand_properties&&(t.fields=t.fields.concat(r.$on_demand_properties))):(t.fields=r.$properties,r&&r.$on_demand_properties&&(t.fields=t.fields.concat(r.$on_demand_properties))),t.fields=t.fields?t.fields.filter((function(e){return"$notes_view"!==e})):void 0,t.fields?(crmTab.isZBCustomModule(r.module_name)?t.fields.push("ExchangeRate"):t.fields.push("Exchange_Rate"),"Activities"==r.module_name&&(t.fields.push("$activity_type"),isNewCallView?t.fields.push("Outgoing_Call_Status"):t.fields.push("Call_Status"),t.fields.push("Call_Type"),t.fields.push("Owner")),"Calls"===r.module_name&&(isNewCallView?t.fields.push("Outgoing_Call_Status"):t.fields.push("Call_Status"),t.fields.push("Call_Type"),t.fields.push("Owner")),"Events"!==r.module_name&&"Tasks"!==r.module_name||t.fields.push("Owner"),t.fields.push("Data_Processing_Basis_Details"),"Leads"!=r.api_name&&"Contacts"!=r.api_name||(t.fields.push("First_Name"),t.fields.push("Last_Name"),t.fields.push("Full_Name")),t.fields.push("Currency")):delete t.fields,t.approved="both",t.cvid=i,t.home_converted_currency=!0,t.formatted_currency=!0},setCount:function(e,t,r){var i,a=setInterval((function(){if(i=document.getElementsByTagName("crm-list-view"),-1!==["list","users","list-view"].indexOf(Lyte.Router.getRouteInstance().routeName)){if(i.length&&r.isRecordFetched){e&&!e.count&&(e.count=0),i=i[0],clearInterval(a);var s=Lyte.Router.getRouteInstance(),o=r.cachedObj;i.setData("total_count",e.count),moduleRecordMapping[t.module_name].total_count=e.count,o.totalCount=e.count,s.currentModel&&(s.currentModel.total_count=e.count),$L("crm-customview-layer")[0].setData("show_loading",!1),document.querySelector("crm-custom-outer-box").setData("total_count",e.count);var n=$("crm-custom-filter")[0];if(s.getQueryParams().filter_id||n&&n.component.data.appliedFilterId&&!n.getData("isSaveFilter")&&n.getData("savedFilters").length){var l,c=(n=n.component).getData("savedFilters"),d=c.length,u=s.getQueryParams().filter_id?s.getQueryParams().filter_id:n.filter_id;if(r.filter_id&&r.filter_id!=n.data.appliedFilterId)return;for(l=0;l<d;l++)c[l].id==u&&(Lyte.objectUtils(o,"add","totalCount",e.count),Lyte.objectUtils(c[l],"add","count",e.count))}}}else clearInterval(a)}),200)},fieldYieldMapping:function(e,t,r,i){var a=Object.assign({},crmConstants.defaultUiTypeToCruxMapping);Object.assign(a,{20:"user",127:"lookup",133:"lookup"}),"mass-tools"===i&&Object.assign(a,{33:"text"});var s={},o=(r=void 0===r?this.getData("module_info"):r).fields,n=crmConstants.moduleDisplayField,l="Activities"===r.module_name||"Events"===r.module_name;r.module_name.indexOf("CustomModule")>-1||r.module_name.indexOf("LinkingModule")>-1?n[r.module_name]=["Name"]:r.module_name.startsWith("Orchestration")&&(n[r.module_name]=[]);var c=n[r.module_name];c=void 0===c?[]:c;for(var d=e.length,u=[],m=o.length,p=c.length,g=$L("crm-inner-list")[0],f=!1,h=g?g.component.getData("cv_mod_fields"):new Map,y=0;y<d;y++)if(e[y]._width||h.size>0){f=!0;break}for(y=0;y<d;y++)for(var v=0;v<m;v++)if(e[y].api_name==o[v].api_name&&o[v].visible&&o[v].available_in_user_layout&&51!=o[v].ui_type){"Full_Name"!=o[v].api_name||"Contacts"!=r.module_name&&"Leads"!=r.module_name||(o[v].field_label=I18n.getMsg("custommodule.crmfield.fl.name",r.singular_label)),s[o[v].api_name]=a[o[v].ui_type],"lookup"==o[v].data_type&&(o[v].yieldName="lookup");for(var _=0;_<p;_++)c[_]==o[v].api_name&&(o[v].yieldName="lookup");o[v].cxPropClass=this.getClassForLVData(o[v]),o[v].list_display_label=o[v].field_label,209==o[v].ui_type&&(o[v].list_display_label=I18n.getMsg("crm.label.small.tags")),o[v].sortable||(o[v].cxPropClass="cursorDefault"),2==o[v].ui_type&&"TYPE"==o[v].column_name?o[v].yieldName="campaign-type":"multi_module_lookup"==o[v].data_type?o[v].yieldName="multi_module_lookup":"BEST_TIME"==o[v].column_name?o[v].yieldName="best_time":l&&!0===o[v].enable_colour_code?(o[v].yieldName="eventtypecolour",o[v].cxPropClass="pR"):"ACTIVITYTYPE"==o[v].column_name?o[v].yieldName="activity_type":999==o[v].ui_type?o[v].yieldName="territory":8==o[v].ui_type&&(o[v].cxPropTooltip=!0,o[v].style="max-width :  150px");var b=Object.assign({},o[v]);b.cxPropClass+=" cellWrap",c.contains(e[y].api_name)&&(b.cxPropClass+=" aZLinkIncl","Last_Name"!==e[y].api_name&&(b.cxPropClass+=" displayColumn")),!b.ui_type||3!==b.ui_type&&110!==b.ui_type||(b.cxPropClass+=" nlv_data_textarea"),r.custom_view.sort_by&&r.custom_view.sort_by.id===b.id&&(b.cxPropClass+=" sApplyField");var w=0;t&&(b.cxPropResize="enable",h.has(b.id)?(w=h.get(b.id),b.style="width: "+w+"px;"):e[y]._width?(w=parseInt(e[y]._width),b.style="width: "+w+"px;"):b.style="",f&&""===b.style&&(w=this.getDefaultWidthForField(b.ui_type),b.style="width: "+w+"px;"),0!==w&&(b.width=w+"px")),209===b.ui_type&&(w=0===w?this.getDefaultWidthForField(b.ui_type):w,b.tagWidth=w+"px",b.cxPropClass+=" nlv_data_tags"),999===b.ui_type&&(b.cxPropClass+=" nlv_data_territory"),u.push(b);break}return u[0]&&(u[0].fixed="enable"),{customfields:u,fieldMapping:s}},getClassForLVData:function(e){var t=e.ui_type;return"SMOWNERID"===e.column_name||"SMCREATORID"===e.column_name||"MODIFIEDBY"===e.column_name?"lv_data_textfield lv_data_username":36==t||77==t||116==t&&"currency"==e.data_type||"formula"==e.data_type&&"currency"==e.formula.return_type?"lv_data_currency listviewalignright":3==t||110==t?"lv_data_desc":Handlebars.helpers.getClassForLVData(e,void 0,void 0,"list")},filterErrorMsg:function(e,t,r,i,a){var s="",o="",n=I18n.getMsg("crm.button.ok.got.it"),l=!1;e||(n=I18n.getMsg("crm.filter.common.error1.button"),o=I18n.getMsg("crm.filter.common.error1"),l=!0),r&&"A proper filter id is required"==r.message&&(n=I18n.getMsg("crm.button.ok.got.it"),l=!1,o="",s=I18n.getMsg("crm.record.not.accessible.message.heading",I18n.getMsg("crm.label.filter")));var c=Lyte.Router.getRouteInstance(),d={filters:void 0,filter_id:void 0,cross_filters:void 0,territory_id:void 0,include_child:void 0};d.search_letter=c.getQueryParams().search_letter,!r||"Given territory ID is not accessible for the user"!=r.message&&"Territories does not contains any subordinates"!=r.message||(s=I18n.getMsg("crm.territory.error.heading"),o=I18n.getMsg("crm.territory.error.content"),n=I18n.getMsg("crm.error.goto.button",[I18n.getMsg("crm.label.all.territories")]),l=!1,d.territory_id="0"),r&&r.details&&"sort_order"==r.details.api_name&&(d.sort_by=void 0,d.sort_order=void 0),"message"==t?(renderingUtils.showMsgBox(e,"error"),c.setQueryParams(d).data={clearCache:!0}):_cruxUtils.showCustomAlert({params:{ltPropWrapperClass:"filterAlertMsg",ltPropPrimaryMessage:s,ltPropContentAlign:"left",ltPropSecondaryMessage:l?"x":o,ltPropButtons:[{type:"accept",text:n,appearance:"primary"}]},show:function(e){if($L(".filterAlertMsg lyte-button").focus(),l){var t=e.childComp.querySelector(".alertSecondaryMsg");t.innerHTML=o,$L(e.childComp).find(".filterAlert").addClass("f21 proxima mT0"),$L(t).addClass("alignleft")}},close:function(){("0"==d.territory_id&&c.setTerritory(d,c.transition.info.dynamicParams[0]),i&&a)?a():c.transitionTo({route:c.transition.target,dynamicParams:c.transition.info.dynamicParams,queryParams:d}).data={clearCache:!0,reloadAll:!0}}})},viewAfterModel:function(e,t,r){e.cv_records||e.errorOnModel||(e.cv_records=[]);document.getElementsByTagName("crm-customview-layer");if(e.module=r,!1===e.more_records){var i=((t.page?t.page:1)-1)*(t.per_page?t.per_page:moduleRecordMapping[e.module].per_page)+e.cv_records.length;e.total_count=i,moduleRecordMapping[e.module].total_count=i}else e.more_records=!0,e.total_count=moduleRecordMapping[e.module].total_count;this.cachedObj.module=e.module,this.cachedObj.fromLyte=!0,this.cachedObj.searchletter=t.search_letter?t.search_letter:"All",this.cachedObj.search_field=t.search_letter?t.search_field:void 0,this.cachedObj.filter_id=t.filter_id,e.total_count&&(this.cachedObj.totalCount=e.total_count)},setDataFromRoute:function(e,t,r,i,a){e.module_name=e.module;var s=moduleRecordMapping[e.module],o=store.peekRecord("custom_view",t);if(this.per_page=this.per_page?this.per_page:s.per_page,s.$.set("per_page",e.currentOption?Number(e.currentOption):this.per_page),o&&s.custom_view&&o.id!=s.custom_view.id&&s.$.set("custom_view",o),i||s.$.save(),"Visits"==e.module&&(this.vistFields(e),e.portalName="allportals"===this.portalName?I18n.getMsg("crm.salesiq.all.accounts"):CrmTracking.portalsInfo[this.portalName],e.screenName=this.portalName),e.module_info=moduleRecordMapping[e.module],e.cv_name=moduleRecordMapping[e.module].custom_view?moduleRecordMapping[e.module].custom_view.display_value:"",e.cvid=this.cachedObj.cvId=t,e.cvId=t,e.saved_filters=!i&&this.parent.currentModel.saved_filters?this.parent.currentModel.saved_filters:[],e.filters=r&&r.filters?JSON.parse(r.filters):void 0,e.cross_filters=r&&r.cross_filters?JSON.parse(r.cross_filters):void 0,e.filter_id=r&&r.filter_id?r.filter_id:void 0,this.transition&&this.transition.clearCache)for(var n=e.saved_filters.length,l=0;l<n;l++)e.saved_filters[l].count=void 0;e.showCustomFilter=!(("Activities"===e.module||"Tasks"===e.module||"Events"===e.module||"Calls"===e.module)&&s.kanban_view||"Visits"===e.module&&s.kanban_view),e.isFilterActive=!!e.module_info.filter_status,e.hideGreyArea=e.module_info.canvas_view||("Activities"===e.module_info.module_name||"Tasks"===e.module_info.module_name||"Events"===e.module_info.module_name||"Calls"===e.module_info.module_name||"Visits"===e.module_info.module_name)&&e.module_info.kanban_view,e.showAlphaSort="en_US,en_GB".indexOf(Crm.userDetails.LOCALE)>-1&&!Crm.userDetails.CLIENT_ACCOUNT&&e.module_info.canvas_view&&"Appointments"!==e.module,e.showKvSettings=(e.module_info.kanban_view||e.module_info.zia_view)&&"false"===e.error,this.parent&&this.parent.parent.currentModel.cpqObj&&moduleRecordMapping.ZohoCPQ&&(crmTab.isZCpqTab(e.module)||crmTab.isZCpqSubTab(e.module))?(e.cpqobj=this.parent.parent.currentModel.cpqObj,e.enableCpqTab=!0):e.enableCpqTab=!1,this.fetchRecFilterCount(e.saved_filters,r,e.module_info,i,a)},setDataBeforeRender:function(e,t,r,i,a){var s=moduleRecordMapping[e.module],o=this.cachedObj.currentOption=s.per_page,n=r.page?r.page:1;if(n>1?e.startIndex=Math.round(o*(n-1)):s.start_index&&1!=r.page?e.startIndex=s.start_index:e.startIndex=0,s.$.set("start_index",e.startIndex),!e.errorOnModel){var l=$L("crm-page-navigator")[0],c=$L("crm-customview-buttons")[0];this.fromNavigator&&l?(e.page=l.getData("page"),e.per_page=l.getData("per_page"),e.reset_scroll=!1):(e.reset_scroll=!0,e.page=Number(n),e.per_page=o),e.cvbtnRendered=!(c&&c.getData("frominitial")||!c),this.cachedObj.body=e.cv_records,this.cachedObj.fromIndex=o*(n-1)+1,this.cachedObj.toIndex=o*n,e.errorOnModel=!1}e.module_info=s;var d=store.peekRecord("custom_view",t);if(s.custom_view&&d){if(e.cv_records&&this.isRecordFetched&&(e.cv_records=store.pushPayload(s.id,e.cv_records),e.cv_records.length)){var u=(n-1)*o+1;e.cv_records.forEach((function(e){e.recnum=u++}))}if(e.listfields=d.fields,e.customview_records=e.cv_records,e.clip_mode=!d.wrap_text,e.isResizeEnabled=!(void 0!==window.clientPortalName&&window.clientPortalName||"PORTALS"===a),e.isClipWrapEnabled=!(void 0!==window.clientPortalName&&window.clientPortalName||"PORTALS"===a),e.showManageColumn=Crm.userDetails.permissions.Crm_Implied_Manage_CustomViews&&!(void 0!==window.clientPortalName&&window.clientPortalName)&&!("PORTALS"===a),e.featureObject={},i&&a)switch(e.featureName=a,a){case"PORTALS":var m=store.peekRecord("user_type",Lyte.Router.getRouteInstance().getDynamicParam()).name;e.customMessage=I18n.getMsg("invite.users.to.portals",m);break;case"COMPLIANCE":e.customMessage=s.plural_label,e.featureObject.statusLabel=" - "+I18n.getMsg(CrmPrivacyDashboard.statusVsLabelKey[r.status]),e.isPrivacyListView=!0,this.cachedObj.privacyDetails={status:r.status,type:r.type},this.getBtnListForPrivacyDashBoard(r,e.featureObject)}}},headerSelection:function(e,t,r,i){if($L("#selectCheckbox").length){if(!t){var a=document.getElementsByTagName("crm-list-view")[0];i=a.getData("customview_records"),r=a.getData("selectedIds")}"mass_tools"===t&&(a=$L("crm-mass-tools")[0]);var s="customCheckBox",o=0,n=r.length,l=i.length;this.lastRecNum=-1;for(var c=i.length,d=0;d<c;d++)if(r.indexOf(i[d].id)>-1)o++,this.lastRecNum=i[d].recnum,s="partialselect";else if(this.waitingForApproval(i[d],a.getData("featureName")))l--,this.lastRecNum=i[d].recnum;else if(o>0){s="partialselect";break}if(o==l&&0!=o&&(s="customCheckBoxChecked"),!t){e.temp_count=e.total_count-(r.length-l);var u=Lyte.Router.getRouteInstance().getQueryParams().filters,m=$L("crm-customview-buttons")[0];if(!u&&!1!==customViewObject.showSelectAll&&Crm.massOperationTotalLimit>=e.total_count&&e.temp_count>n&&e.total_count>e.per_page&&"customCheckBoxChecked"==s&&featuresAvailable.Schedule_Mass_Operation&&m){customViewObject.showHideSelectAllDiv=!0,m.setData("showSelectedDiv",!0);var p=a.getData("page");customViewObject.selectAllHistory||(customViewObject.selectAllHistory=[]),!customViewObject.selectAllHistory.contains(p)&&customViewObject.selectAllHistory.push(p)}m&&"customCheckBoxChecked"!=s&&this.fromPerpage&&(m.setData("showSelectedDiv",!1),customViewObject.showHideSelectAllDiv=!1)}}document.querySelectorAll("[id='selectCheckbox']").forEach((function(e){e.ltProp("class",s);var t=e.querySelector("span");t.classList.remove(t.classList.value),t.classList.add(s)}))},vistFields:function(e){if("object"==typeof CrmTracking&&CrmTracking.portalsInfo){var t={allportals:I18n.getMsg("crm.salesiq.all.accounts")},r=objectUtils.cloneObject(CrmTracking.portalsInfo);for(var i in r)t[i]=r[i];e.portals=t}},executeCustomButtons:function(e,t,r,i,a,s,o){if(e.empty_fields&&Object.keys(e.empty_fields).length){var n={};if(n.errorMessage=e.empty_fields,e.buttonId=t,e.recordId=r,"custom_function"==e.action&&null==r){var l=this.getData("selectedIds");l&&l.length&&(e.recordId=l)}e.position=i,e.module_id=a,n.jsonResString=e,n.position=i,Handlebars.registerPartial("CustomButtonPopup",Handlebars.templates.CustomButtonPopup),$("#tabLayer").after(Handlebars.templates.CustomButtonPopup(n)),crmui.showPop("customButtonPopUp")}else if("invoke_url"==e.action||"web_tab"==e.action){var c=e.url.open_in;switch(c){case"new_tab":g="_blank";break;case"same_tab":g="_self";break;default:openPopUp("newWin","",Crm.getOrgSpecificURL(e.url.open_url),"newPopup",1e3,800,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes")}if(e.web_tab){var d=window.location.href.split("crm/")[0]+"crm/ShowTab.do?webTab=true&module="+e.web_tab;networkUtils.openUrl(Crm.getOrgSpecificURL(d),g)}else"new_window"!=c&&networkUtils.openUrl(e.url.open_url,g)}else if("widget"==e.action){var u="undefined"!=typeof WidgetHandler?WidgetHandler.getWidget("CustomButtons",t):void 0,m={Entity:moduleRecordMapping[this.getData("module")].api_name};"eachRecord"==i?(m.ButtonPosition="listvieweachrecord",m.EntityId=[r]):"withoutRecord"==i?(m.ButtonPosition="listviewwithoutrecord",s.hasOwnProperty("cvid")&&(m.cvid=s.cvid),s.hasOwnProperty("page")&&(m.page=s.page),o.hasOwnProperty("ids")&&(m.EntityId=o.ids)):(m.EntityId=this.getData("selectedIds"),m.ButtonPosition="listview"),u&&WidgetHandler.CustomButtons.render(u,m,i)}else if("custom_function"==e.action)if(e.proceed_empty){commonUtils.showHideLoadingDiv(!0),this.triggerCustomButtonAction(this,e.module_id,{button_id:e.buttonId,ids:e.recordId,type:"POST"},{proceed_empty:!0},e.position?e.position:"listView")}else{var p,g;if(e.custom_function&&"success"==e.custom_function.status&&e.custom_function.creator_response?networkUtils.loadFeatureScripts(["zohocrm_customButtonTemplate.js"],(function(){Handlebars.registerPartial("cbSuccessPopup",Handlebars.templates.cbSuccessPopup),$("body").append(Handlebars.templates.cbSuccessPopup()),$L("#cbSuccessPopup").addClass("zcrm-show"),setTimeout((function(){$("#cbSuccessPopup").show()}),150),$("#cbSuccessPopupRespContent").text(e.custom_function.creator_response),$L("#cbExecutedPage").val(i)}),null):removeFreezeLayer(),e.custom_function&&e.custom_function.url&&(p=e.custom_function.url.open_url,g=e.custom_function.url.openIn),""!=p&&CustomButtonJSObjectInit.isValidWebUrl(p))switch(g){case"iframe":$("#"+e.frameElement).attr("src",p);break;case"New window":openPopUp("newWin","",Crm.getOrgSpecificURL(p),"newPopup",1e3,800,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes");break;case"parent window":window.location=Crm.getOrgSpecificURL(jsonRes.openURL);break;default:networkUtils.openUrl(Crm.getOrgSpecificURL(p),g)}}else if("circuits"===e.action)if(e.circuits.scheduled)crmui.showMsgBand("success",I18n.getMsg("crm.circuits.schedule.success"),"4000");else if(e.circuits.circuitId&&Crm.userDetails.permissions.hasOwnProperty("Crm_Implied_Circuits_Access")&&Crm.userDetails.permissions.Crm_Implied_Circuits_Access)if(e.circuits.executionUrl){var f=e.circuits.executionUrl,h=e.circuits.name;crmui.showMsgBand("success",I18n.getMsg("crm.circuits.trigger.success")+'. <span class="link1" onClick="crmRelatedList.showCircuitPreview(\''+f+"','"+h+"')\">"+I18n.getMsg("crm.circuits.rl.view.execution")+"</span>",5e3)}else{f=Crm.getCrmBasePath()+"/settings/extensions/zoho/circuits/executionLogs?circuit_id="+e.circuits.circuitId;crmui.showMsgBand("success",I18n.getMsg("crm.circuits.trigger.success")+". <span class='link1' onClick='networkUtils.openUrl(\""+f+'", "_blank", "");\'>'+I18n.getMsg("crm.circuits.rl.view.execution")+"</span>",5e3)}else crmui.showMsgBand("success",I18n.getMsg("crm.circuits.trigger.success"),"4000")},observeSelectedIds:function(e,t){var r="partialselect",i=e.selectedIds.length,a=Lyte.Router.getRouteInstance().routeName,s=Lyte.Router.getRouteInstance().getQueryParams();s.search_letter&&"All"!=s.search_letter&&(customViewObject.showSelectAll=!1);var o=void 0!==customViewObject.module?moduleRecordMapping[customViewObject.module].actions:void 0;if(o&&o.length){var n=o.filter((function(e){return"hideSelectAllRecords"==e.name}));customViewObject.showSelectAll=!n.length&&customViewObject.showSelectAll}var l=e.unCheckedEntitiesCount;0!=l&&null==l&&(l=e.data?$L("#"+e.data).find(".customCheckBox[data-cid=selectEntity]").length:"list"==a||"view-workflow-rule"==a?$L(".lyteExpTableOrigTableInnerWrap .lyteExpTableRowGroup .customCheckBox").length:$L("#viewcontainer .customCheckBox").length);var c="list"==a||"view-workflow-rule"==a?$L(".lyteExpTableOrigTableInnerWrap .lyteExpTableRowGroup .customCheckBoxChecked").length:$L("#viewcontainer .customCheckBoxChecked").length,d=moduleRecordMapping[e.module],u=$L("crm-customview-buttons");if(0==i)r="customCheckBox",delete customViewObject.selectAllHistory,$L("#custom_layer_table").removeClass("cvtransform"),this.hideButtonLayer=setTimeout((function(){customViewObject.doMassActioninScheduler=!1,u[0]&&(u[0].setData("selectAllEntity",!1),u[0].setData("showSelectedDiv",!1),customViewObject.showHideSelectAllDiv=!1);var e=document.getElementsByTagName("crm-custom-filter")[0];e&&e.classList.remove("selectAllOverlay");var t=document.getElementById("viewcontainer");t&&t.classList.remove("selectAllOverlay"),$L("crm-customview-layer").css({visibility:"visible"}),$L("#listviewButtonLayer").css({visibility:"hidden"})}),200),delete this.startIndex;else{if(clearTimeout(this.hideButtonLayer),d.$.set("start_index",e.start_index),"view-workflow-rule"!==a&&"mass-tools"!==a){if(u.length)u=u[0],e.showSelectDiv=e.showSelectDiv?e.showSelectDiv:u.getData("showSelectedDiv"),customViewObject.showHideSelectAllDiv=e.showSelectDiv;else{customViewObject.showHideSelectAllDiv=e.showSelectDiv;var m=document.querySelector("crm-custom-outer-box");(m=null==m?$L("crm-workflow-reports")[0]:m).setData("selectedIds",e.selectedIds),u=m.querySelector("crm-customview-buttons")}u.setData({module:e.module,total_count:customViewObject.totalCount,start_index:e.start_index,page:e.page,actions:moduleRecordMapping[e.module].actions,parent_comp:e.parent_comp,showSelectedDiv:e.showSelectDiv}),$L("#custom_layer_table").addClass("cvtransform"),e.parent_comp&&u.setData("parent_comp",e.parent_comp),t||setTimeout((function(){$L("#listviewButtonLayer").css({visibility:"visible"})}),200)}if(t){var p=1===i?I18n.getMsg("crm.record.not.accessible"):I18n.getMsg("records");$L("crm-customview-layer")[0].component.setData("selected",I18n.getMsg("crm.listview.selected.records",[i,p])),$L("#modal_buttons_layer").css({visibility:"visible"})}if(this.startIndex=this.startIndex&&this.startIndex<e.page?this.startIndex:e.page,(1==e.customview_recordlen||0==l)&&i>=1&&(r="customCheckBoxChecked","view-workflow-rule"!==a&&"mass-tools"!==a&&u.setData("displayOnlineEntities",!1)),0==c&&(r="customCheckBox"),"customCheckBoxChecked"==r&&(e.showSelectDiv=!0,this.checkSelectedDiv(d,u,e),customViewObject.selectAllHistory||(customViewObject.selectAllHistory=[]),!customViewObject.selectAllHistory.contains(e.page)&&customViewObject.selectAllHistory.push(e.page)),"partialselect"==r&&i<d.per_page)if(d.kanban_view){for(var g=document.querySelectorAll("#checkAll"),f=g.length,h=0,y=0;y<f;y++)if(g[y].classList.contains("customCheckBoxChecked")){h=1;break}u.setData("showSelectedDiv",1==h),customViewObject.showHideSelectAllDiv=1==h}else"view-workflow-rule"!=a&&(c>=i&&0!=l?u.setData("showSelectedDiv",!1):u.setData("showSelectedDiv",e.showSelectDiv),customViewObject.showHideSelectAllDiv=u.getData("showSelectedDiv"))}("list"===a||"view-workflow-rule"===a||t)&&this.$node.querySelectorAll("[id='selectCheckbox']").forEach((function(e){if(e){var t=e.querySelector("span");t.classList="",t.classList=r,e.ltProp("class",r)}}));customViewObject.selectedIds=e.selectedIds,"view-workflow-rule"!==a&&"mass-tools"!==a&&!d.kanban_view&&i&&["customCheckBox","partialselect"].contains(r)&&u&&(u=u[0]?u[0]:u,customViewObject.selectAllHistory&&-1!=customViewObject.selectAllHistory.indexOf(e.page)&&customViewObject.selectAllHistory.removeFirstOccurenceOfElement(e.page),u.getData("showSelectedDiv")&&(customViewObject.selectAllHistory&&customViewObject.selectAllHistory.length||(u.setData("showSelectedDiv",!1),customViewObject.showHideSelectAllDiv=!1)))},checkSelectedDiv:function(e,t,r){var i=Lyte.Router.getRouteInstance().getQueryParams().filters;customViewObject.totalCount=customViewObject.totalCount?customViewObject.totalCount:e.total_count,e.total_count=e.total_count?e.total_count:customViewObject.totalCount,customViewObject.filters||customViewObject.cross_filters||customViewObject.filter_id||!featuresAvailable.Schedule_Mass_Operation||(i||!e.total_count&&!customViewObject.totalCount?void 0!==t&&0!==t.length&&!i&&r.showSelectDiv&&0!=customViewObject.showSelectAll&&(customViewObject.showHideSelectAllDiv=!0,t.setData("showSelectedDiv",!0)):Crm.massOperationTotalLimit>=e.total_count&&customViewObject.totalCount>r.selectedIds.length&&0!=customViewObject.showSelectAll&&(customViewObject.showHideSelectAllDiv=!0,t.setData("showSelectedDiv",!0)))},selectAllEntity:function(e,t,r,i){var a=Lyte.Router.getRouteInstance().routeName,s=document.getElementsByTagName("crm-custom-outer-box")[0];if("mass-tools"===a){var o=$L("crm-mass-tools")[0];i=o.component.data.selectedIds;s=o}else{var n=document.getElementsByTagName("crm-list-view")[0],l=$L("crm-workflow-reports")[0];i=(s=void 0===s?l:s).getData("selectedIds");s.setData("prevSelectedId","")}var c={selectedIds:i,page:this.getData("page"),per_page:this.getData("module_info").per_page,module:this.getData("module"),start_index:this.getData("start_index"),parent_comp:this.getData("parent_comp")},d=!1;if("list"===a||"mass-tools"===a||"view-workflow-rule"===a||s.getData("isFromModal")){var u=document.querySelector("[id='selectCheckbox']"),m=this,p=!1,g=!0,f=u?u.ltProp("class"):"customCheckBoxChecked",h=(void 0===n?document.getElementsByTagName("crm-inner-list")[0]:n).getData("customview_records"),y=h.length;if("customCheckBox"==f&&!e||t&&"partialselect"==f){var v=[];if(!p){for(var _=!1,b=0;b<y;b++)if("view-workflow-rule"!==a||!(null!==h[b].reason_for_exclusion||h[b].$deleted_record&&(null==h[b].record||!h[b].$retry_enabled)||h[b].$converted_record||h[b].$retry_limit_reached||!h[b].$retry_enabled||h[b].$stop_processing||"email_notification"===h[b].action.type&&null===h[b].associated_to||"email_notification"===h[b].action.type&&null!=h[b].Data_Processing_Basis_Details&&!h[b].Data_Processing_Basis_Details.Contact_Through_Email||null!==h[b].retry_mode_in_progress)){if(i.length+v.length==crmConstants.maxSelectCount&&!customViewObject.doMassActioninScheduler){renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.records.alert",crmConstants.maxSelectCount)),c.showSelectDiv=!1,d=!1;break}if(d=!0,(!m.waitingForApproval(h[b],s.getData("featureName"))||"mass-tools"===a)&&-1===i.indexOf(h[b].id)){if("undefined"!=typeof CrmTracking&&CrmTracking.isEntityOnline(this.getData("module"),h[b].id))_=!0;else if(r){g=!1;continue}var w=document.querySelectorAll("lyte-exptable-tr[id='"+h[b].id+"']"),C=!1;v.push(h[b].id),w.forEach((function(e){var t=e.querySelector("lyte-checkbox");if(t&&"customCheckBox"==t.ltProp("class")){t.ltProp("class","customCheckBoxChecked"),e.style.backgroundColor="setTdBorBtm";var r=t.querySelector("span");r.classList.remove("customCheckBox"),r.classList.add("customCheckBoxChecked"),e.classList.add("listViewRowSelected")}}))}}c.per_page<m.getData("total_count")&&(c.showSelectDiv=!0);var D=document.querySelector("crm-customview-buttons");_&&D&&!D.getData("displayOnlineEntities")&&D.setData("displayOnlineEntities",!0)}Lyte.arrayUtils(i,"push",v),crmListView.startIndex[customViewObject.fromIndex]?crmListView.startIndex[customViewObject.fromIndex]=crmListView.startIndex[customViewObject.fromIndex]+v.length:crmListView.startIndex[customViewObject.fromIndex]=v.length}else if(!p){for(b=0;b<y;b++){var L=i.indexOf(h[b].id);C=!1;(w=document.querySelectorAll("lyte-exptable-tr[id='"+h[b].id+"']")).forEach((function(e){var t=e.querySelector("lyte-checkbox");if(t&&"customCheckBoxChecked"==t.ltProp("class")){t.ltProp("class","customCheckBox"),e.style.backgroundColor="";var r=t.querySelector("span");r.classList.remove("customCheckBoxChecked"),r.classList.add("customCheckBox"),e.classList.remove("listViewRowSelected")}})),!C&&L>-1&&(Lyte.arrayUtils(i,"removeAt",L,1),C=!0,crmListView.startIndex[customViewObject.fromIndex]&&(crmListView.startIndex[customViewObject.fromIndex]=crmListView.startIndex[customViewObject.fromIndex]-1),0==crmListView.startIndex[customViewObject.fromIndex]&&delete crmListView.startIndex[customViewObject.fromIndex])}if("mass-tools"!==a){c.showSelectDiv=!1;var R=$L("crm-customview-layer")[0];(R=void 0!==R?R:l).style.visibility="visible"}}p=!0,document.querySelectorAll("[id='selectCheckbox']").forEach((function(e){var t=e?e.querySelector("span"):void 0;d&&g?(e.ltProp("class","customCheckBoxChecked"),t.classList.remove("customCheckBox"),t.classList.add("customCheckBoxChecked")):t&&(t.classList.remove("customCheckBoxChecked"),t.classList.add("customCheckBox"),e.ltProp("class","customCheckBox"))}));var P=document.getElementsByTagName(m.getData("parent_comp"))[0];P.setData("selectedIds",i)}if(e&&("mass-tools"!==a?s.setData("selectedIds",[]):P.setData("selectedIds",[]),c.selectedIds=[],crmListView.startIndex={}),this.getData("customview_records")&&(c.customview_recordlen=this.getData("customview_records").length),"mass-tools"!==a&&(this.observeSelectedIds(c),e&&("list"===a||s.getData("isFromModal")?n.component.setData("selectedIds",[]):"view-workflow-rule"===a?l.setData("selectedIds",[]):crmListView.selectAllEntity())),"mass-tools"===a){var I=P.getData("selectedIds").length;I?(P.setData("showActionBtn",!0),1===I?this.setData("selectedMsg",I18n.getMsg("crm.masstool.record.selected",1)):this.setData("selectedMsg",I18n.getMsg("crm.masstool.records.selected",I))):P.setData("showActionBtn",!1)}},selectedEntity:function(e,t,r,i,a){var s=document.getElementsByTagName("crm-custom-outer-box")[0];if("mass-tools"!==a)r=(s=void 0===s?document.getElementsByTagName("crm-workflow-reports")[0]:s).getData("selectedIds"),i=s.getData("prevSelectedId");else s=$L("crm-mass-tools")[0];var o=$("#"+e.id+" lyte-checkbox")[0].ltProp("class");if(event&&1==event.shiftKey&&i&&i!=e.id){var n=$L("#selectEntity_"+i)[0].component.data.dataRecnum-1,l=$L("#selectEntity_"+e.id)[0].component.data.dataRecnum-1,c=this.getData("module_info").start_index;if(n-=c,l-=c,"customCheckBox"==o)if(l<n)for(var d=n;d>=l;d--){if(r.length==crmConstants.maxSelectCount){renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.records.alert",crmConstants.maxSelectCount));break}if(!this.waitingForApproval(t[d],s.getData("featureName"))){var u=t[d].id;r.contains(u)||this.selectEntityCommon(u,"customCheckBox",void 0,void 0,s)}}else for(d=n;d<=l;d++){if(r.length==crmConstants.maxSelectCount){renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.records.alert",crmConstants.maxSelectCount));break}if(!this.waitingForApproval(t[d],s.getData("featureName"))){u=t[d].id;r.contains(u)||this.selectEntityCommon(u,"customCheckBox",void 0,void 0,s)}}else if(l<n)for(d=n;d>=l;d--){u=t[d].id;r.contains(u)&&this.selectEntityCommon(u,"customCheckBoxChecked",void 0,void 0,s)}else for(d=n;d<=l;d++){u=t[d].id;r.contains(u)&&this.selectEntityCommon(u,"customCheckBoxChecked",void 0,void 0,s)}var m={selectedIds:r,per_page:this.getData("module_info").per_page,page:this.getData("page"),module:this.getData("module"),start_index:this.getData("module_info").start_index,customview_recordlen:this.getData("customview_records").length,parent_comp:this.getData("parent_comp")};return this.observeSelectedIds(m,s.getData("isFromModal")),!1}r.length==crmConstants.maxSelectCount&&"customCheckBoxChecked"!=o?renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.records.alert",crmConstants.maxSelectCount)):this.selectEntityCommon(e.id,o,void 0,void 0,s)},selectEntityCommon:function(e,t,r,i,a){var s,o=a?a.getData("selectedIds"):this.getData("selectedIds");a&&(s="listview");var n=document.querySelectorAll("lyte-exptable-tr[id='"+e+"']"),l=this;n.forEach((function(i){var n=i.querySelector("lyte-checkbox"),c=n.querySelector("span");if("customCheckBox"==t&&"selectAllEntity"!=e){if(-1==o.indexOf(e)&&(Lyte.arrayUtils(o,"push",e),crmListView.startIndex[customViewObject.fromIndex]?crmListView.startIndex[customViewObject.fromIndex]=crmListView.startIndex[customViewObject.fromIndex]+1:crmListView.startIndex[customViewObject.fromIndex]=1),s){var d=document.querySelector("crm-customview-buttons");if(("Leads"==l.getData("module")||"Contacts"==l.getData("module"))&&d&&!d.getData("displayOnlineEntities")&&"undefined"!=typeof CrmTracking)for(var u=document.getElementsByTagName("crm-list-view")[0].getData("customview_records"),m=u.length,p=0;p<m;p++)if(CrmTracking.isEntityOnline(l.getData("module"),u[p].id)){d.setData("displayOnlineEntities",!0);break}}n.ltProp("class","customCheckBoxChecked"),c.classList.remove("customCheckBox"),c.classList.add("customCheckBoxChecked"),$L(i).addClass("listViewRowSelected")}else o.indexOf(e)>-1&&(Lyte.arrayUtils(o,"removeAt",o.indexOf(e),1),crmListView.startIndex[customViewObject.fromIndex]&&(crmListView.startIndex[customViewObject.fromIndex]=crmListView.startIndex[customViewObject.fromIndex]-1),0==crmListView.startIndex[customViewObject.fromIndex]&&delete crmListView.startIndex[customViewObject.fromIndex]),n.ltProp("class","customCheckBox"),c.classList.remove("customCheckBoxChecked"),c.classList.add("customCheckBox"),$L(i).removeClass("listViewRowSelected");if(document.getElementsByTagName(l.getData("parent_comp"))[0].setData("selectedIds",o),"selectAllEntity"!==r&&"listview"===s){a.setData("prevSelectedId",e);var g={selectedIds:o,page:l.getData("page"),per_page:l.getData("module_info").per_page,module:l.getData("module"),start_index:l.getData("module_info").start_index,customview_recordlen:l.getData("customview_records").length,parent_comp:l.getData("parent_comp")};$L(i).parents(".lyteExpTableOrigTableInnerWrap").length&&l.observeSelectedIds(g,l.getData("isFromModal"))}}))},reloadCurrentView:function(e,t,r,i){i=i||!1;crmTab.deleteFromCache(e);var a=$L("crm-customview-buttons")[0];a&&a.setData("selectAllEntity",!1),this.hideCVbtns();var s=Lyte.Router.getRouteInstance();if("list"===r){var o=s.getQueryParams(),n=document.getElementsByTagName("crm-list-view")[0],l=n?n.component.startIndex:void 0;t&&!o.page?(t=crmHistory.getPageDetailsFromIndex(t.fromIndex,t.toIndex)).page===o.page&&t.perPage===o.per_page||!o.page||!o.per_page?s.refresh().data={clearCache:!0}:s.setQueryParams({page:o.page,per_page:o.per_page}).data={clearCache:!0}:l&&o.page&&o.page!==l?s.setQueryParams("page",l).data={clearCache:!0}:s.refresh().data={clearCache:!0,hideSelectAll:i}}else s.refresh()},mouseOverCustomButton:function(e,t,r,i){var a=document.getElementsByTagName("crm-custombuttons-popover");0==a.length&&(a=Lyte.Component.render("crm-custombuttons-popover","","#viewcontainer")),clearTimeout(this.disp_popover),this.disp_popover=setTimeout((function(){var r=store.peekRecord("custom_button",t);a.component?a.component.onMouseOver("."+e+t,r.name,r.description):a[0].component.onMouseOver("."+e+t,r.name,r.description)}),3e3)},mouseOutCustomButton:function(){var e=$L("#customButtonPopover");e&&e[0].ltProp("show",!1),clearTimeout(this.disp_popover)},executeCustomButton:function(e,t,r,i,a){if(commonUtils.showHideLoadingDiv(!0),!this.requestButtonSend){var s=moduleRecordMapping[this.getData("module")].id,o={button_id:e,type:"POST"};o.ids=t?[t]:i||"";var n={};a&&(a.hasOwnProperty("cvId")&&(n.cvid=a.cvId),a.hasOwnProperty("pageNo")&&(n.page=a.pageNo)),this.requestButtonSend=!0,r=r||"eachRecord",this.triggerCustomButtonAction(this,s,o,n,r,t)}event.stopPropagation(),event.preventDefault()},triggerCustomButtonAction:function(e,t,r,i,a,s){store.triggerAction(t,"custom_buttons",r,i).then((function(o){e.requestButtonSend=!1,commonUtils.showHideLoadingDiv(),e.executeCustomButtons(o.details,r.button_id,s,a,t,i,r)}),(function(t){var r=t.response?JSON.parse(t.response):{},i=r.hasOwnProperty("details")?r.details:{},a=!!i.hasOwnProperty("creator_error")&&"TOO_MANY_REQUESTS"==i.creator_error,s=!!r.hasOwnProperty("message")&&"circuit call has reached its maximum limit"==r.message,o=!!r.hasOwnProperty("code")&&"ACCOUNT_FREEZED"==r.code,n=!!r.hasOwnProperty("code")&&"TYPE_NOT_ALLOWED"==r.code;if(e.requestButtonSend=!1,commonUtils.showHideLoadingDiv(),a)crmui.showMsgBand("error","Sorry, the action can’t be performed as you have reached the allowed functions call limit that can be made in the last 24 hours",2500);else if(s)r.hasOwnProperty("details")&&(r.details.hasOwnProperty("limit")&&0===r.details.limit)?crmui.showMsgBand("error",I18n.getMsg("crm.circuits.button.feature.not.available",Crm.brandName),5e3):crmui.showMsgBand("error",I18n.getMsg("crm.circuits.limit.exceeded"),5e3);else if(o)Crm.userDetails.IS_ADMIN_ROLE?crmui.showMsgBand("error",I18n.getMsg("crm.circuits.accfreeze.button.admin",Crm.brandName),5e3):crmui.showMsgBand("error",I18n.getMsg("crm.circuits.accfreeze.button.nonadmin",Crm.brandName),5e3);else if(n)Crm.userDetails.IS_ADMIN_ROLE?crmui.showMsgBand("error",I18n.getMsg("crm.circuits.associate.non.payment",Crm.brandName),5e3):crmui.showMsgBand("error",I18n.getMsg("crm.circuits.associate.non.payment",Crm.brandName)+". "+I18n.getMsg("crm.circuits.contact.admin"),5e3);else if(500!=r.status){if("INVALID_MODULE"!==r.code)return 400===t.status?r.details&&"SOCKET_CLOSED"===r.details.creator_error?void crmui.showMsgBand("warning",I18n.getMsg("crm.custombutton.function.time.exceed"),1500):void crmui.showMsgBand("error",r.message,1500):void(500!==t.status||crmui.showMsgBand("warning",I18n.getMsg("crm.workflow.save.error"),3e3));renderingUtils.displayPermissionDenied()}else crmui.showMsgBand("warning",I18n.getMsg("crm.security.error.add.user"),1500)}))},filterCustomButton:function(e){var t=[];if(e)for(var r=e,i=r.length,a=0;a<i;a++)if("list_view"==r[a].position)for(var s=r[a].profiles.length,o=0;o<s;o++)if(Crm.userDetails.PROFILE_NAME==r[a].profiles[o].name){var n={id:r[a].id,name:r[a].name,description:r[a].description};r[a].hasOwnProperty("sequence_number")&&(n.sequence_number=r[a].sequence_number),t.push(n)}return t},hideCVbtns:function(){var e=document.getElementsByTagName("crm-custom-outer-box")[0];e&&e.setData("selectedIds",[]),customViewObject.selectedIds=[],$L("#listviewButtonLayer").length>0&&$("crm-customview-buttons")[0]&&($L("#custom_layer_table").removeClass("cvtransform"),document.getElementsByTagName("crm-custom-filter")[0].classList.remove("selectAllOverlay"),document.getElementById("viewcontainer").classList.remove("selectAllOverlay"),setTimeout((function(){$L("#listviewButtonLayer").css({visibility:"hidden"})}),200))},isOldCriteria:function(e){return!(!e[0]||!e[0].searchfieldtype)},getDateCompValue:function(e){if(-1!=e.value.indexOf("$"))return e;if("equal"==e.comp&&(e.comp="between",e.value=[e.value,e.value]),"between"==e.comp||"not_between"==e.comp){e.value="string"==typeof e.value?e.value.split(","):e.value,e.value[0]=this.getISODateStartTime(Utils.convertDateToUserPattern(e.value[0])),e.value[1]=this.getISODateEndTime(Utils.convertDateToUserPattern(e.value[1]));var t=/^(.*)T/.exec(e.value[0])[1],r=/^(.*)T/.exec(e.value[1])[1];e.value="D"==e.criteria.searchfieldtype?[t,r]:e.value}else if(-1!=["greater_than","less_than"].indexOf(e.comp)){e.value=this.getISODateStartTime(Utils.convertDateToUserPattern(e.value));t=/^(.*)T/.exec(e.value)[1];e.value="D"==e.criteria.searchfieldtype?t:e.value}return e},oldCriteria_to_newCriteria:function(e,t){var r,i={},a=[],s=[],o=[],n=e.length,l={0:"equal",1:"not_equal",2:"contains",3:"not_contains",4:"greater_equal",5:"greater_than",6:"less_equal",7:"less_than",10:"starts_with",11:"ends_with",14:"between",15:"not_between"},c=function(e){-1!=e.indexOf(",")&&(e=e.split(","));for(var t=(e="string"==typeof e?[e]:e).length,r=[],i=0;i<t;i++)r.push({id:e[i]});return r};for(r=0;r<n;r++){var d=e[r].searchfield;q=e[r].value,$=l[e[r].condition];var u=d.split(":");if(1==q||!q||-1==q.indexOf("LASTDAYS")&&-1==q.indexOf("LASTAGE"))if(1!=q&&q&&"-1"!=q.indexOf("${AGE")){m=/\d+/i.exec(q)[0],p="-1"!=q.indexOf("WEEKS")?"WEEKS":"-1"!=q.indexOf("MONTHS")?"MONTHS":"DAYS";q="${DUEIN"+p+"}+"+m,$="less_equal"}else 1!=q&&q&&"-1"!=q.indexOf("${")&&($="${NOTEMPTY}"==q?"less_equal":"equal",q="${NEXT7DAYS}"==q?"${DUEINDAYS}+7":q);else{var m=/\d+/i.exec(q)[0],p="-1"!=q.indexOf("WEEKS")?"WEEKS":"-1"!=q.indexOf("MONTHS")?"MONTHS":"DAYS";q="${AGEIN"+p+"}+"+m,$="less_equal"}if("-1"!=d.indexOf("TOUCHED")||"-1"!=d.indexOf("UNTOUCHED")||"-1"!=d.indexOf("RECORDACTION")||"-1"!=d.indexOf("RELRECORDACTION")){q="${NOTEMPTY}"==q?"${CURRENTTIME}":q;var g={TOUCHED:"TouchedRecords",UNTOUCHED:"UnTouchedRecords",RECORDACTION:"RecordAction",RELRECORDACTION:"RelatedRecordsAction"},f={BOTH:"UserAndSystem",EITHER:"UserOrSystem",USER:"User",SYSTEM:"System",USERONLY:"OnlyByUser",SYSTEMONLY:"OnlyBySystem"};if(i.is_modified="","-1"!=d.indexOf("RECORDACTION")||"-1"!=d.indexOf("RELRECORDACTION")?(i.is_modified=u[2],i.by=f[u[3]]):i.by=f[u[2]],i.field={},i.api_name=g[u[1]],i.value=q,i.comparator=$,!(S=this.specialfield(i,i.by,i.value,i.comparator,i.is_modified)))return"";a.push(S),i={}}else if("ACT"==e[r].searchfieldtype){i.api_name="Activities",i.comparator=$,i.value=q;g=d.split(":");if(v={OVERDUE:"Activities",WITHOUTOPEN:"Without_Open_Activity",DUE:"Activity_Due",MODIFIEDTIME:"Without_Any_Activity",COMPLETED:"Activity_Done"},i.by=v[g[1]],"Tasks"!=g[0]&&"Calls"!=g[0]||(i.by=g[0]),i.value&&i.comparator){var h=this.getDateCompValue({criteria:e[r],value:i.value,comp:i.comparator});i.comparator=h.comp,i.value=h.value}if(!(S=this.specialfield(i,i.by,i.value,i.comparator)))return"";s.push(S)}else if("EMA"==e[r].searchfieldtype){i.api_name="Email_Status",i.comparator=$,i.value=q;g=d.split(":");if("-1"!=e[r].searchfield.indexOf("LAST_SENT_TIME"))i.by="sent",i.sub_status={SENT_OPENED:"opened",NOTOPENED:"not_opened",BOUNCED:"bounced",OPENEDNOTREPLIED:"opened_and_not_replied",SENT:"any_of_the_above"}[g[2]];else{var y=g[1]+":"+g[2];i.by={LAST_SENT_TIME:"sent","NOT_SENT:NOTSENT":"not_sent","LAST_ACTION_TIME:OPENED":"opened","NOT_OPENED:NOTOPENED":"not_opened","LAST_ACTION_TIME:RECEIVED":"received","NOT_RECEIVED:NOTRECEIVED":"not_received","LAST_ACTION_TIME:BOUNCED":"bounced","LAST_ACTION_TIME:OPENEDNOTREPLIED":"opened_and_not_replied"}[y]}h=this.getDateCompValue({criteria:e[r],value:i.value,comp:i.comparator});if(i.comparator=h.comp,i.value=h.value,!(S=this.specialfield(i,i.by,i.value,i.comparator,i.sub_status)))return"";a.push(S)}else if("NOT"==e[r].searchfieldtype){i.api_name="Notes",i.comparator=$,i.value="${EMPTY}"==q?"${NOTEMPTY}":q;g=d.split(":");i.by=null!=g[2]?"Without_Any_Notes":"Notes_Added";h=this.getDateCompValue({criteria:e[r],value:i.value,comp:i.comparator});if(i.comparator=h.comp,i.value=h.value,!(S=this.specialfield(i,i.by,i.value,i.comparator)))return"";s.push(S)}else if("POT"==e[r].searchfieldtype){i.api_name="Deals",i.comparator=$,i.value=q;g=d.split(":");var v={WITHOUTOPEN:"Without_Open_Deal",WITHOPEN:"With_Open_Deal",CREATEDTIME:"Without_Any_Deal"};i.by=v[g[1]],this.preventDealField="With_Open_Deal"!=i.by;h=this.getDateCompValue({criteria:e[r],value:i.value,comp:i.comparator});if(i.comparator=h.comp,i.value=h.value,!(S=this.specialfield(i,i.by,i.value,i.comparator)))return"";if(this.preventDealField)for(var _=s.length,b=0;b<_;b++)if("Deals"==s[b].relation.api_name){s.splice(b,1);break}this.updateCrossFilter(s,"Deals",S)}else if("CHATS"==e[r].searchfieldtype){i.api_name="Chats",i.comparator=$,i.value="${EMPTY}"==q?"${NOTEMPTY}":q;g=d.split(":");i.by="CHATSMISSED"==g[1]?"Missed":"Attended";h=this.getDateCompValue({criteria:e[r],value:i.value,comp:i.comparator});if(i.comparator=h.comp,i.value=h.value,!(S=this.specialfield(i,i.by,i.value,i.comparator)))return"";s.push(S)}else if("CAM"==e[r].searchfieldtype){var w=r;if("MEMBERSTATUS"==(g=d.split(":"))[1]){var C={comparator:"equal",field:{api_name:"Member_Status"},value:e[r].value.split(",")};w=r+1,r+=1}q=JSON.parse(e[w].value);var D=0,L=q.length;for(D=0;D<L;D++)q[D].name=q[D].Campaign_Name,delete q[D].Campaign_Name;var R={comparator:"equal",field:{api_name:"Campaign_Name"},value:q};B={include_objects:!0,relation:{api_name:"Campaigns"}},"MEMBERSTATUS"==g[1]?(B.criteria={},B.criteria.group=[C,R],B.criteria.group_operator="AND"):B.criteria=R,s.push(B)}else if("MXN"==e[r].searchfieldtype){if(!(g=moduleRecordMapping[t].fields.filterBy({api_name:e[r].sysrefname})[0]))continue;if(B={include_objects:!0,relation:{api_name:g[g.data_type].api_name}},"${EMPTY}"==e[r].condition)$="not_equal",q=e[r].condition,B.include_objects=!1;else{q=JSON.parse(e[r].value);D=0,L=q.length;for(D=0;D<L;D++)q[D].name=q[D].value,delete q[D].value}B.criteria={comparator:$,field:{api_name:g[g.data_type].connectedlookup_apiname},value:q},s.push(B)}else if("SMA"==e[r].searchfieldtype){i.api_name="Email_Sentiment";var P,I;u=e[r].searchfield.split(":");i.by={POSITIVE:"Positive",NEGATIVE:"Negative",POSITIVE_AND_NEGATIVE:"PositiveAndNegative",POSITIVE_OR_NEGATIVE:"PositiveOrNegative",POSITIVE_ONLY:"PositiveOnly",NEGATIVE_ONLY:"NegativeOnly",NEUTRAL:"Neutral"}[u[1]],i.comparator=$,i.substatus="","POSITIVE"!=u[1]&&"NEGATIVE"!=u[1]&&"POSITIVE_OR_NEGATIVE"!=u[1]&&"NEUTRAL"!=u[1]||"LASTMAIL"==u[2]&&(i.status="For_The_Last_Email"),"COUNT"!=u[2]&&"PERCENTAGE"!=u[2]||(i.status="",P=u[3],u[3]&&("less_than_or_equal"!=u[3]&&"greater_than_or_equal"!=u[3]||(P="less_than_or_equal"==P?"less_equal":"greater_equal"),I=u[4],i.substatus=u[2],i.status=u[2].toLowerCase())),q="${UNTILNOW}"==q?"${CURRENTTIME}":q;var S;h=this.getDateCompValue({criteria:e[r],value:q,comp:i.comparator});if(i.comparator=h.comp,q=h.value,!(S=this.specialfield(i,i.by,q,i.comparator,i.status,I,P)))return"";s.push(S)}else if("CON"==e[r].searchfieldtype)S={include_objects:"WITH"==e[r].searchfield.split(":")[1],relation:{api_name:"Contacts"},criteria:{field:{api_name:"Full_Name"},comparator:"not_equal",value:"${EMPTY}"}},s.push(S);else if("LPRE"==e[r].searchfieldtype||"PRE"==e[r].searchfieldtype)i.field={},i.field.api_name="Prediction_Score",i.comparator="equal",i.value="LPSCR"==e[r].searchfield||"PRESCORE"==e[r].searchfield?q:"${"+e[r].searchfield+"|"+q+"}","LPSCR"!=e[r].searchfield&&"PRESCORE"!=e[r].searchfield||(i.comparator=$,-1!=i.value.indexOf(",")&&(i.value=q.split(","))),o.push(JSON.parse(JSON.stringify(i)));else if("REC"===e[r].searchfieldtype){var M,k=e[r].searchfield.split(":")[1],T=JSON.parse(e[r].value),E=T.selected_products;if(E?0!==E.length&&(M={comparator:"equal",value:E}):M={comparator:"not_equal",value:"${EMPTY}"},M.field={FIRSTBUY:{api_name:"first_buy_what"},CWBAB:{api_name:"cross_selling_what"},FBT:{api_name:"bundle_what"},REBUY:{api_name:"rebuy_what"},NEXTBUY:{api_name:"next_buy_what"}}[k],"CWBAB"===k)M={group_operator:"and",group:[M,{comparator:"equal",value:T.value_Recommendation,field:{api_name:"cross_selling_what_influenced"}}]};if("REBUY"===k){var A=T.rebuy_options.option,F=T.rebuy_options.custom_date;(A={day:"${TODAY}",week:"${THISWEEK}",month:"${THISMONTH}"}[A])||(A=F),M={group_operator:"and",group:[M,{comparator:"equal",value:A,field:{api_name:"rebuy_date_what"}}]}}var U={include_objects:!0,relation:{api_name:{FIRSTBUY:{api_name:"First_Buy"},CWBAB:{api_name:"Cross_Selling"},FBT:{api_name:"Bundle"},REBUY:{api_name:"Rebuy"},NEXTBUY:{api_name:"Sequence"}}[k]},criteria:M};s.push(U)}else if("RFM_score"==e[r].searchfieldtype){var O={CF_Recency:"Recency",CF_Frequency:"Frequency",CF_Monetary:"Monetary"},x=e[r].searchfield.replaceAll("::","").split(":"),N=e[r].condition.split(":::"),j=e[r].value.split(":::"),z=j.length;for(b=1;b<=z;b++){var $,q="between"==($=l[N[b-1]])||"not_between"==$?j[b-1].split(","):j[b-1];o.push({field:{api_name:O[x[3*b-1]]},comparator:$,value:q})}}else{O={AMOUNT:"Deal_Amount",CLOSINGDATE:"Deal_Closing_Date",STAGE:"Deal_Stage",SMOWNERID:"Deal_Owner",STATUSID:"Record_status"};if(e[r].value.split(",").length>1&&(q=e[r].value.split(",")),e[r].condition==e[r].value&&($="equal"),"U"!=e[r].searchfieldtype&&"L"!=e[r].searchfieldtype&&"W"!=e[r].searchfieldtype||($=l[e[r].condition],q=c(q)),e[r].searchModule!=t&&("Deal_Amount"==O[u[1]]||"Deal_Closing_Date"==O[u[1]]||"Deal_Stage"==O[u[1]]||"Deal_Owner"==O[u[1]])){if(this.preventDealField)continue;if("Deal_Closing_Date"==O[u[1]])$=(h=this.getDateCompValue({criteria:e[r],value:q,comp:$})).comp,q=h.value;var B={include_objects:!0,relation:{relation_id:moduleRecordMapping.Potentials.id,api_name:"Deals"},criteria:{field:{api_name:moduleRecordMapping.Potentials.fields.filterBy({column_name:u[1]})[0].api_name},comparator:$,value:q}};this.updateCrossFilter(s,"Deals",B);continue}if("Record_status"==O[u[1]]){B={include_objects:!0,relation:{relation_id:"",api_name:"Review_Processes"},criteria:{field:{api_name:O[u[1]]},comparator:$,value:q}};s.push(B);continue}var V=this.isVisitsField(u[1]);if("DT"==e[r].searchfieldtype||"D"==e[r].searchfieldtype)$=(h=this.getDateCompValue({criteria:e[r],value:q,comp:$})).comp,q=h.value;if(V.isVisits&&e[r].searchModule!=t){if("normalField"==V.fieldtype)o.push({field:{api_name:V.api_name},comparator:$,value:q});else{B={include_objects:!0,relation:{relation_id:"",api_name:"Visits_Zoho_Livedesk"},criteria:{field:{api_name:V.api_name},comparator:$,value:q}};this.updateCrossFilter(s,"Visits_Zoho_Livedesk",B)}continue}var H="DATASOURCE"==u[1]?"SE_STATUS":u[1],J=moduleRecordMapping[t].fields.filterBy({column_name:H})[0];if(!J||!J.visible)continue;if("duration"==e[r].trackerOption){C={field:{api_name:"Modified_Time"},comparator:{lesser:"less_than",greater:"greater_than",greaterequal:"greater_equal",lesserequal:"less_equal",equal:"equal"}[e[r].trackerOptionCond],value:"${AGEINDAYS}+"+e[r].trackerOptionDays};var W={field:{api_name:J.history_tracking.duration_configured_field.api_name},comparator:"equal",value:"${EMPTY}"},G=(h=this.construct_group(C,W,"AND"),moduleRecordMapping[t].related_lists[this.getIndex(moduleRecordMapping[t].related_lists,"picklist_tracker","action",!0)]);s.push({include_objects:!0,relation:{api_name:G.api_name},criteria:this.construct_group(h,{field:{api_name:J.api_name},comparator:$,value:q},"AND")})}if("tag"==e[r].searchfieldtype){if("${EMPTY}"!=q&&"${NOTEMPTY}"!=q){var Y=(q="string"==typeof q?q.split(","):q).length,Z=[],Q=Lyte.Router.getRouteInstance().parent.currentModel.tags;for(D=0;D<Y;D++)Z.push(Q.filter((function(e){return q[D]==e.modRefId}))[0]);q=this.getValueBasedonKeys(Z,"name")}var K={field:{api_name:J.api_name},comparator:$,value:q};if("Activities"===Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()){W={field:{api_name:"Activity_Type"},comparator:"equal",value:e[r].searchModule};K=this.construct_group(K,W,"AND")}o.push(K)}else{var X=J.api_name;if("lookup"==J.data_type&&("Activities"!=t||-1==["CONTACTID","SEID"].indexOf(J.column_name))){var ee=crmConstants.moduleDisplayField[store.peekRecord("module",J.lookup.module.id).module_name];X=X+"."+(ee=ee||["Name"])[0]}o.push({field:{api_name:X},comparator:$,value:q})}}}i={};return Lyte.arrayUtils(o,"insertAt",0,a),o.length>0&&(o.reverse(),i.filters=1==o.length?o[0]:{group:o,group_operator:"AND"}),s.length>0&&(i.cross_filters=s.reverse()),delete this.preventDealField,i},handleKanbanSettingPopup:function(){var e=crmListView.kanbanSettingData;e&&1==e.showKanbanPopup&&(crmListView.popup(!0,e),delete crmListView.kanbanSettingData)},parse_Nested_Json:function(e){return"string"==typeof e?this.parse_Nested_Json(JSON.parse(e)):e},campaignLayoutFilterFetch:function(e){for(var t=["status","source"],r=["active","campaign_integration"],i=moduleRecordMapping.Campaigns.layouts.filter((function(e){return t.every((function(t){return r.includes(e[t])}))})),a=i.length,s=[],o=0;o<a;o++)for(var n=i[o].profiles.length,l=0;l<n;l++)if(Crm.userDetails.PROFILE_NAME==i[o].profiles[l].name){s.push(i[o]);break}e.setData("campaignLayout",s);var c=moduleRecordMapping.Campaigns.layouts.filter((function(e){return e.profiles.some((function(e){return e.name==Crm.userDetails.PROFILE_NAME&&e.default}))}))[0];e.setData("campDefLayout",c)},setHeight:function(){$L.fastdom.measure(function(){renderingUtils.resizeWindowHW();var e=$L(".outerElem"),t=renderingUtils.windowHeight-e.offset().top-$L("#cvpadding").outerHeight(),r=$L("#wmstoolbar");r.length?t-=r.outerHeight():t-=28;var i=$L("crm-inner-list .lyteExpOriginalTable").height(),a=$L("crm-inner-list .lyteExpTableOrigTableInnerWrap"),s=a[0].scrollWidth;a[0].clientWidth<s&&(i+=renderingUtils.getScrollBarWidthValue);var o=t;i<t&&0!=i&&(o=i),this.height=o,$L.fastdom.mutate(function(){var e=$L("#wfRpExecutionList"),t=void 0!==e[0]?e.offset().top:$L("#viewcontainer").offset().top,r=renderingUtils.windowHeight-(t+28),i=0;this.height>=r&&(i=20);var a=document.getElementById("listcrux");if(a.cxProp("height",this.height-i+"px"),Crm.isCpqActivated()){var s=$("#lv_left_filter").css("height");a.cxProp("height",s)}Crm.latestEntId&&this.latestEntityId&&this.latestEntityId(Crm.latestEntId),$L("#listviewtablescroll").css("min-height",r-20)}.bind(this))}.bind(this));var e=$L("#cv_buttons_layer")[0];e&&e.scrollWidth>e.offsetWidth?$L("#cv_pagination").addClass("cv_btns_layerbxshadow"):$L("#cv_pagination").removeClass("cv_btns_layerbxshadow")},constructNavigObject:function(e,t,r,i){for(var a=t.length,s=[],o=0;o<a;o++)s[t[o].recnum]={module:"Activities"==r?t[o].$activity_type:r,id:t[o].id};crmNavig.customViewKey=e,crmNavig.recentListViewUrl=crmHistory.getState().url,crmNavig[crmNavig.customViewKey]={},crmNavig[crmNavig.customViewKey].recordId=s,crmNavig[crmNavig.customViewKey].currentOption=i},sortRecord:function(e,t,r,i,a,s,o){var n,l,c=moduleRecordMapping[this.getData("module")],d=c.custom_view.id,u=this,m=store.peekRecord("custom_view",d),p=(i=$L(".lyteMenuSelected")[0]||i)?i.parentElement.id:"unsort"===e?a.id:void 0,g=m.sort_by?m.sort_by.id:void 0;if(p&&(n=store.peekRecord("field",p).api_name,"unsort"===e?m.$.set("sort_by",{}):m.$.set("sort_by",{id:p,api_name:n}),l=store.peekRecord("field",p).id),"BEST_TIME"!==n||g!==m.sort_by.id||m.sort_order!==e){"unsort"===e?(m.$.set("sort_order",void 0),m.$.set("sort_by",{})):m.$.set("sort_order",e),customViewObject.selectedIds&&customViewObject.selectedIds.length&&this.selectAllEntity(!0),commonUtils.showHideLoadingDiv(!0);var f={sort_by:m.sort_by,sort_order:m.sort_order,module:c.api_name,id:d};s&&o&&this.setFeatureSpecificParams(f,o),store.triggerAction("custom_view","change_sort",f).then((function(){s?(u.setData("queryParams",$L("#customFilter")[0].component.getCriteria().queryParams),u.sortRecordsForModal(l,e,c.per_page,c.module_name,o),commonUtils.showHideLoadingDiv()):u.throwEvent("sortOrder",l,e,c.per_page)}),(function(e){403===e.status||401===e.status?renderingUtils.displayPermissionDenied(e):400===e.status&&_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.field.sort.error")}}),m.$.rollBack(),commonUtils.showHideLoadingDiv()}))}},setSortBySummary:function(e){var t="",r=store.peekRecord("custom_view",e.cvid);if(r&&r.sort_by){for(var i=e.module_info.fields.length,a=e.module_info.fields,s="",o=r.sort_by.api_name?r.sort_by.api_name:a.find((function(e){if(e.id===r.sort_by.id)return e})).api_name,n=0;n<i;n++)if(a[n].api_name===o){t=a[n].field_label,s=a[n].data_type;break}t.length&&(t+=" (",["phone","currency","integer"].contains(s)&&"BEST_TIME"!==o?t+="asc"===r.sort_order?"0-9":"9-0":t+="asc"===r.sort_order?I18n.getMsg("crm.column.sort.asc"):I18n.getMsg("crm.column.sort.desc"),t+=")")}e.sorted_column=t},setFilterSummary:function(){var e=$("crux-smart-filter")[0].component.data.checked,t="";if(e.length>0){var r=e.length;t+=e[r-1].field.display_field_label;for(var i=r-2;i>=0;i--)t+=", ",t+=e[i].field.display_field_label}var a=$L("crm-custom-outer-box")[0];a&&a.component.setData("applied_filters",t)},reRenderTagComponent:function(e,t){$L.fastdom.measure((function(){var r=document.querySelectorAll("crux-tag-component"),i=r.length;$L.fastdom.mutate((function(){for(var a=0;a<i;a++)r[a].resize({cxPropClipMode:e,cxPropWidth:t})}))}))},applyAlphaSort:function(e,t){var r=Lyte.Router.getRouteInstance().transition.info,i=r.queryParams;i.page=1,i.search_letter="All"!==e?e:void 0,i.search_field=t&&i.search_letter?t:void 0,Lyte.Router.transitionTo({route:r.route,queryParams:i,dynamicParams:r.dynamicParams}).data={clearCache:!0}},getCVFieldsWOWidth:function(e){for(var t=e.length,r=!1,i=0;i<t;i++)if(e[i]._width){r=!0;break}if(r){var a=[];return e.forEach((function(e){var t=Object.assign({},e);delete t._width,a.push(t)})),a}return e},getDefaultWidthForField:function(e){return 209===e||3===e||110===e?400:200},checkForStickyTable:function(){if(!/firefox/gi.test(navigator.userAgent)){var e=document.createElement("th"),t="IntersectionObserver"in window;return e.style.position="sticky",!("sticky"!==e.style.position||!t)||(e.style.position="-webkit-sticky",!("-webkit-sticky"!==e.style.position||!t))}return!1},constructRCOptions:function(){var e=I18n.getMsg("crm.label.no.of.records"),t=[{user_value:"10 "+e,system_value:10},{user_value:"20 "+e,system_value:20},{user_value:"30 "+e,system_value:30},{user_value:"40 "+e,system_value:40},{user_value:"50 "+e,system_value:50}];return Crm.userDetails.ISPAID_USER&&t.push({user_value:"100 "+e,system_value:100}),500===Crm.userDetails.maxRange&&t.push({user_value:"500 "+e,system_value:500}),t},WEBINAR_BASE_URL:"/crm/v2/__internal/Campaigns",WEBINAR_POLL_CATEGORY:{STAR_RATING:1,MCQ_SINGLE:2,MCQ_MULTIPLE:3},getHierarchyInfo:function(e){var t=store.peekRecord("module",moduleRecordMapping.Campaigns.id).hierarchy_meta,r={hierarchy_level:e.level,hierarchy_level_allowed:t.max_level,no_of_childs:e.no_of_childs},i=t.level_vs_child_allowed.filter((function(t){return t.level==e.level}))[0];return r.max_childs_allowed=i.no_of_childs,r.child_creation_allowed=r.max_childs_allowed>r.no_of_childs,r.child_creation_allowed||(r.tooltip_key=r.max_childs_allowed>0?"crm.tooltip.child.campaign.limit.reached":"crm.tooltip.child.campaign.level.disallowed"),r},fetchChildCampaignRecords:function(e,t,r){var i={headers:{Range:t+"-"+(t-1+5)},success_callback:function(e){r(e)}};networkUtils.makeRequest("/crm/v2/Campaigns/"+e+"/Child_Campaigns","GET",i)},getIntegCampObject:function(){var e={};return e["zoho.webinar"]={route:"crm.settings.section.extensions.zoho-extensions.webinar",showLayout:!0,name:Crm.integrationsAppName.ZOHO_WEBINAR,nameSpace:"zoho.webinar",iconClass:"zCampWebinarIcon"},e},waitingForApproval:function(e,t){var r=!1===e.$approved&&!1===e.$approval.resubmit;return!!(e.$stop_processing&&"COMPLIANCE"!==t||r||!0===e.$in_merge||"review_process_pending"===e.$approval_state)},hideMoreActions:function(e){for(var t=$L("#moreActionPopup,#tagPopover,#zCampMoreActionMenu,lyte-popover#divMacro,#add_TagPopUp,#remove_TagPopUp"),r=t.length,i=0;i<r;i++)t[i].component&&t[i].ltProp("show",!1);for(var a=$L(".moreActionListview"),s=a.length,o=0;o<s;o++)a[o].parent.ltProp("show",!1);for(var n=$L(".customButtonDropBox"),l=n.length,c=0;c<l;c++)!n[c].classList.contains("lyteDropdownHidden")&&n[c].origindd&&n[c].origindd.toggle();var d=$("#cruxCustomAlert")[0];d&&d.ltProp("show",!1),Q.close(),crmui.hidePopup("updateConsenttype"),crmui.hidePopup("customButtonPopUp");var u=$("#customButtonPopUp")[0];u&&u.remove(),closeDashletDiv("loadingDiv"),handleCancelMUNew(e)},gamificationClose:function(){this.setHeight();var e=document.querySelector("lyte-expresstable");e.fixRowHeight(),e.setHeaderWidth(),document.querySelector("crm-custom-filter").component.resize()},handleError:function(e,t){var r=this.currentModel?this.currentModel:{};if(r.status&&200!==r.status&&201!==r.status){var i=r.response?JSON.parse(r.response):void 0;if(403==r.status||i&&"NO_PERMISSION"==i.code||401===r.status&&i&&"AUTHENTICATION_FAILURE"==i.code&&Crm.userDetails.CLIENT_ACCOUNT){crmHistory.transitionError=!1;var a=Lyte.Router.getRouteInstance().transition.info,s=app.prevTransitionBeforeRefresh?app.prevTransitionBeforeRefresh:app.prevTransition;a.route.indexOf("custom-view")>-1&&s.route==a.route&&s.dynamicParams[0]==a.dynamicParams[0]&&s.dynamicParams[1]==a.dynamicParams[1]||(crmHistory.handleAjaxErrorLyte=!0),crmHistory.doNotReload=!0,renderingUtils.displayPermissionDenied(),this.transition.abort()}else if(400===r.status&&"INVALID_MODULE"===i.code||null==moduleRecordMapping[e]){crmHistory.transitionError=!1;var o=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),n=window.location.pathname.split(o)[1];this.replaceWith("crm.crm-error",n).data={showError:!0,module:e,errorMsg:I18n.getMsg("module.not.available")}}else if(i&&"LOOKUP_LIMIT_EXCEEDED"==i.code&&i.details){crmHistory.transitionError=!1;var l=0,c=i.details.used_in.length,d={Custom_View_Select_Column:"",Criteria:""};for(l=0;l<c;l++)d[i.details.used_in[l].name]=this.getApiName(i.details.used_in[l].lookup_fields);var u=d.Custom_View_Select_Column+"####"+d.Criteria,m=$L("crm-custom-filter")[0];m&&(m.setData({isApplyFilter:!0,isSaveFilter:!1}),document.querySelector("#applyBtn").ltProp("disabled",!0)),crmHistory.doNotReload=!0,history.go(-1),Search.displayLookupExceedsMsg({responseText:u}),customViewObject.filters=customViewObject.cross_filters=void 0,this.transition.abort()}else r.response&&r.response.indexOf('{"param_name":"cvid"}')>-1?(crmHistory.transitionError=!1,this.currentModel.cvDeletePage=!0):r.response&&-1==r.response.indexOf('{"param_name":"cvid"}')&&400==r.status?(crmHistory.transitionError=!1,this.filterErrorMsg(void 0,void 0,i),this.transition.abort()):(crmHistory.transitionError=!1,this.currentModel.errorOnModel=!0,this.currentModel.module=this.parent.parent.getDynamicParam())}},getApiName:function(e){var t=0,r=[],i=e?e.length:0;for(t=0;t<i;t++)store.peekRecord("field",e[t].id)&&r.push(store.peekRecord("field",e[t].id).display_label);return r.join(" , ")},removeTotalCache:function(e,t){var r=moduleRecordMapping[e];if(r){store.clearCachedQuery("filter",{module:e,cvid:t}),store.unloadAll("territory"),"Activities"==e?moduleRecordMapping.Activities.child_module.forEach((function(e){store.clearCachedQuery("tag",{module:e.api_name,fromPage:"view"})})):store.clearCachedQuery("tag",{module:r.api_name,fromPage:"view"}),store.clearCachedQuery("custom_button",{module:r.api_name}),moduleRecordMapping[e].actions=void 0,moduleRecordMapping[e].start_index=void 0,null!=store.modelFor(moduleRecordMapping[e].id)&&store.unloadAll(moduleRecordMapping[e].id),moduleRecordMapping[e].crux_customViewAccessedModules=!1;var i=crmConstants.moduleVsCrossModules[e];if(i)for(var a=i.length,s=0;s<a;s++)-1==crmConstants.cachedModules.indexOf(i[s])&&(moduleRecordMapping[i[s]].crux_customViewAccessedModules=!1);moduleRecordMapping[e].total_count=void 0,crmTab.getFromCache(e)&&(crmTab.getFromCache(e).selectedIds=[])}},makeCustomViewRequest:function(e,t,r,i){var a=store.peekRecord("custom_view",e),s=a?a.modified_time:"",o={module:moduleRecordMapping[t].api_name};return r&&i&&this.setFeatureSpecificParams(o,i),store.findRecord("custom_view",e,o).then((function(e){return e?(e.modified_time!=s&&crmTab.deleteFromCache(t),store.pushPayload("module",{custom_view:e,id:moduleRecordMapping[t].id})):crmTab.deleteFromCache(t),e}))},fetchFilterCount:function(e){if(Crm.userDetails.fetchCountValues){var t=Lyte.Router.getRouteInstance().parent.parent.getDynamicParam();"crm.tab.messages.custom-view.list"===Lyte.Router.getRouteInstance().transition.info.route&&(t="Messages");var r=moduleRecordMapping[t],i={cvid:r.custom_view.id,approved:"both"};r.territory&&(i.territory_id=r.territory.id,r.territory.subordinates&&(i.include_child=r.territory.subordinates));var a=crmTab.getFromCache(t),s=a?a.screenName:customViewObject?customViewObject.screenName:void 0;s&&"allportals"!==s&&(i.portal_name=CrmTracking.portalsInfo[s]),Lyte.Router.getRouteInstance().getQueryParams().search_letter&&(i.alphabet=Lyte.Router.getRouteInstance().getQueryParams().search_letter),"Campaigns"==t&&(i.exclude_followup_campaigns=!0);var o=!1;Array.isArray(e)||(e=[e],o=!0),e.forEach((function(e){i.filter_id=e.id,store.triggerAction(r.id,"count",i).then((function(t){Lyte.objectUtils(e,"add","count",t.count),o&&(customViewObject.totalCount=t.count)}))}))}},fetchRecFilterCount:function(e,t,r,i,a){if(Crm.userDetails.fetchCountValues&&(this.triggerRecordCount||e.length)){var s={},o="",n={},l=this;if(this.beforeRecordAPI(t,s,r,r.custom_view.id,i),delete s.fields,delete s.page,delete s.per_page,Array.isArray(e)||(e=[e]),e.forEach((function(t){n[t.id]=e.indexOf(t),void 0===t.count&&(o=o+t.id+",")})),o.length&&(s.include_filters=o.slice(0,o.length-1)),!this.triggerRecordCount&&!s.include_filters)return null;i&&(delete s.type,delete s.status,this.setFeatureSpecificFilters(s,a)),store.triggerAction(r.id,"count",s).then((function(t){l.filter_id=s.filter_id,l.setCount(t,r,l),t.filters_count&&t.filters_count.forEach((function(t){Lyte.objectUtils(e[n[t.id]],"add","count",t.status&&"error"===t.status?"-":t.count)})),setTimeout((function(){l.headerSelection(r)}),201)}),(function(){l.setCount({},r,l)}))}},clearSelection:function(){var e=document.querySelector("crm-customview-buttons");e&&e.component&&this.selectAllEntity.call(e.component,!0)},setTerritory:function(e,t){var r=moduleRecordMapping[t];if(e=e||Lyte.Router.getRouteInstance().getQueryParams(),r.territory&&null!=e.territory_id&&e.territory_id!==r.territory.id)if(-1!==["-1","-3","0","-2"].indexOf(e.territory_id)){var i={0:I18n.getMsg("crm.label.all.territories"),"-1":I18n.getMsg("crm.label.without.territory"),"-3":I18n.getMsg("crm.label.multiple.territories"),"-2":I18n.getMsg("crm.label.other.territories")},a={id:e.territory_id,name:i[e.territory_id]};r.$.set({territory:a}),r.$.save()}else store.findRecord("territory",e.territory_id).then((function(t){var i={id:(t=store.peekRecord("territory",e.territory_id)).id,name:t.name};e.include_child&&(i.subordinates=!0),r.$.set({territory:i}),r.$.save()}));else if(null!=e.territory_id){var s,o=!1;if(e.include_child&&!1===r.territory.subordinates?(o=!0,s=!0):0==e.include_child&&r.territory.subordinates&&(o=!0,s=!1),o){a={id:e.territory_id,name:r.territory.name,subordinates:s};r.$.set({territory:a}),r.$.save()}}},getUpdatedActions:function(e,t){var r=moduleRecordMapping[e].actions;r&&r.length&&(r.filter((function(e){return"hideSelectAllRecords"==e.name})).length&&app.store.makeRequest("triggerAction",moduleRecordMapping[e].id,"mass_actions",{cvid:t,type:"GET"}).then((function(t){if(t.actions){moduleRecordMapping[e].actions=t.actions;var r=t.actions.filter((function(e){return"hideSelectAllRecords"==e.name}));customViewObject.showSelectAll=!r.length||customViewObject.showSelectAll}})))},preFetch:function(e,t,r,i,a,s){var o=moduleRecordMapping[t],n=crmTab.getFromCache(o.module_name);this.cachedObj=n||{},"Visits"===o.module_name&&(this.portalName=i.portalName?i.portalName:this.cachedObj.screenName?this.cachedObj.screenName:"allportals",Crm.trackSpotLightAction("Visits - Normal View Click")),!e.sort_order||"sort_asc"!==e.sort_order&&"sort_unsort"!==e.sort_order&&"sort_desc"!==e.sort_order||(e.sort_order=e.sort_order.slice(5)),!e.page&&o.start_index&&(e.page=o.start_index/o.per_page+1),e.page=e.page?Number(e.page)<1?1:Number(e.page):1,this.fetchOnlyBody=!1;var l=$L("#listviewtablescroll");return l[0]&&l.addClass("lvTHPointerEventNone"),this.makeCustomViewRequest(r,t,a,s)},fetch:function(e,t,r,i,a,s){var o=moduleRecordMapping[t],n=!1;return(o.kanban_view||o.canvas_view||o.zia_view)&&(n=!0),o.$.set("kanban_view",!1),Crm.userDetails.CLIENT_ACCOUNT||o.$.set("canvas_view",!1),o.$.set("zia_view",!1),!1!==this.fetchCount&&n&&store.triggerUpdate("module",o.id,["kanban_view","per_page"]),store.unloadAll("servapp_preferences"),i=i||{},this.initiateRequest(e,i,t,s||{},r,a)},postFetch:function(e,t,r){return e&&!e.errorOnModel&&(e&&e.show_begin_page&&e&&e.data_waiting_for_approval||"Activities"===e.module&&!0===moduleRecordMapping[e.module].filter_status&&($L("#lv_left_filter").css({display:"block"}),$L("#viewcontainer").css({width:"calc(100% - 303px)"}))),this.viewAfterModel(e,t,r),e},renderHTMLTemplate:function(e,t,r,i,a,s,o,n,l){var c=moduleRecordMapping[r];if(e.cvDeletePage){function d(e){if("ALLVIEWS"===e.system_name)return e}delete c.custom_view,store.findAll("custom_view",{module:c.api_name}).then((function(e){for(var t=$L("crm-cverror-page")[0],r=e.filter(d),i=r[0],a=r.length,s=0;s<a;s++)if(r[s].name.startsWith("All")){i=r[s];break}var o=i.display_value;t&&(t.setData("cvdisplayName",o),t.setData("module_name",c.module_name)),c.cvid=i.id,c.custom_view=i})),app.renderTemplate(this,{outlet:"#show",component:"crm-cverror-page"})}else{e.viewType="list",c&&c.kanban_view&&c.$.set("kanban_view",!1);var u=c.module_name,m=!1;this.prevModule!==u&&(m=!0),this.prevModule=u,(a.clearselectedIds||!1!==a.clearselectedIds&&(a.clearCache||this.cachedObj.clearonImportCompletion))&&(this.cachedObj.selectedIds=[],delete this.cachedObj.selectAllHistory,delete this.cachedObj.showHideSelectAllDiv,delete this.cachedObj.showSelectAll,crmListView=crmListView||{},crmListView.startIndex={});var p=c.module_name.startsWith("Orchestration")?"crm.orchestration.empty.message":"crm.module.empty.message";if(e.no_record_message=Lyte.Component.registeredHelpers.I18nDynamicKey(p,"",c.plural_label),e.selectedIds=this.cachedObj.selectedIds?this.cachedObj.selectedIds:[],!n&&(a.refreshTemplate||!this.ORComponent)){var g=$L("crm-inner-list")[0];g&&(g.getData("cv_width_updated")&&g.component.persistWidthToStore.call(g.component),g.component.checkForWrapUpdate.call(g.component))}this.setDataFromRoute(e,i,t.queryParams,n,l),this.setDataBeforeRender(e,i,t.queryParams,n,l),e.cv_sys_name=c.custom_view&&c.custom_view.system_name?c.custom_view.system_name:"",e.search_letter=t.queryParams.search_letter?t.queryParams.search_letter:"All",e.search_field=t.queryParams.search_letter?t.queryParams.search_field:void 0;var f=t.queryParams;e.errorOnModel&&!e.cvDeletePage&&(e.errorHTML=Handlebars.templates.cvError(this.cachedObj));var h=$L("crm-custom-filter");if(n&&h[0]&&h[0].setData("filterQueryParams",{filters:f.filters,cross_filters:f.cross_filters,filter_id:f.filter_id}),e.filterQueryParams={filters:f.filters,cross_filters:f.cross_filters,filter_id:f.filter_id},this.setSortBySummary(e),n)if(e.isFromModal=!0,e.queryParams=f,s||o){document.querySelector("crm-list-view-modal").setData(e)}else{var y=document.querySelector("#listViewPopup");null!==y&&y.remove(),Lyte.Component.render("crm-list-view-modal",e,"body")}else this.reRender=m,app.renderTemplate(this,{outlet:"#show",component:"crm-custom-outer-box",reRender:m})}},postRender:function(e,t,r){if(!crmHistory.transitionError&&!e.cvDeletePage){if("Accounts"!==e.module&&"Contacts"!==e.module||(this.cachedObj.isZBCustomModuleEnabled=moduleRecordMapping[e.module].zb_custommodule_enabled),delete this.fetchCount,!e.errorOnModel){this.cachedObj.isKanbanView=!1,this.cachedObj.isStageView=!1,this.cachedObj.isPredictView=!1;var i=t.queryParams;if(this.cachedObj.filters=i.filters?JSON.parse(i.filters):void 0,this.cachedObj.cross_filters=i.cross_filters?JSON.parse(i.cross_filters):void 0,crmTab.putInCache(e.module,this.cachedObj),customViewObject=this.cachedObj,!this.triggerRecordCount){var a=$L("crm-customview-layer")[0];a&&a.setData("show_loading",!1)}if(!customViewObject.selectedIds||!customViewObject.selectedIds.length){var s=$L("crm-custom-filter")[0];s&&s.classList.remove("selectAllOverlay");var o=$L("#viewcontainer")[0];o&&o.classList.remove("selectAllOverlay")}var n=$L("#listviewtablescroll");n[0]&&n.removeClass("lvTHPointerEventNone"),this.headerSelection(moduleRecordMapping[e.module]);var l=$L("crm-customview-buttons")[0];l&&(l.component.setData("start_index",e.startIndex),l.component.setData("total_count",e.total_count)),customViewObject.filterId=i.filter_id?i.filter_id:void 0,customViewObject.screenName=this.portalName,customViewObject.isPrivacyListView=e.isPrivacyListView,this.constructNavigObject(r,e.customview_records,e.module,moduleRecordMapping[e.module].per_page);var c=$L("#newPopup"),d=$L("crm-inner-list");c[0]&&d[0]&&(c[0].ltProp("show",!1),d[0].setData("columnListOpen",!1)),moduleRecordMapping[e.module].territory&&moduleRecordMapping[e.module].territory.id&&(customViewObject.territoryId=moduleRecordMapping[e.module].territory.id,customViewObject.includeChild=moduleRecordMapping[e.module].territory.subordinates),delete customViewObject.isCustomizedView,this.getUpdatedActions(e.module,r)}delete this.triggerRecordCount,commonUtils.showHideLoadingDiv()}},getModuleData:function(e,t){if("Contact Role"!==e){if("OneFeeds"===e&&(e="Feeds"),void 0===moduleRecordMapping[e]&&moduleRecordMapping[e.replace(" ","/")]&&(e=e.replace(" ","/")),(e.indexOf("CustomModule")>=0||e.indexOf("Orchestration")>=0&&"Orchestration"!==e||e.indexOf("LinkingModule")>=0||window.clientPortalName||"Visits"===e&&"object"==typeof CrmTracking&&CrmTracking.portalsInfo||"Services"===e||"Appointments"===e)&&moduleRecordMapping[e]&&(!moduleRecordMapping[e].custom_view||!moduleRecordMapping[e].custom_view.id)&&(!window.clientPortalName||"web"!==moduleRecordMapping[e].generated_type)&&!moduleRecordMapping[e].web_link)return store.findAll("custom_view",{module:moduleRecordMapping[e].api_name}).then((function(t){return t&&(moduleRecordMapping[e].cvid=t.$.meta.default),moduleRecordMapping[e].api_supported?store.findRecord("module",moduleRecordMapping[e].id).then((function(t){return{module:t.module?t.module[0]:moduleRecordMapping[e],module_name:e}})):{module:moduleRecordMapping[e],module_name:e}}));if(moduleRecordMapping[e]&&!moduleRecordMapping[e].cvid&&"crm.tab.module.promo"===this.transition.target)return this.handlePromo(e);e="Potentials"===e?"Deals":e;var r=moduleRecordMapping[e],i=["crm.tab.module.entity.edit","crm.tab.module.create","crm.tab.module.entity.clone"];if((t.indexOf("crm.settings.section.client-portal.user-types.users")>-1||t.indexOf("crm.tab.module.custom-view")>-1||t.indexOf("crm.tab.module.entity")>-1||t.indexOf("crm.settings.section.compliance.consent-dashboard.list-view")>-1||t.indexOf("crm.tab.module.actions.mass-tools")>-1)&&r&&r.api_supported&&(!r.crux_customViewAccessedModules||r.crux_customViewAccessedModules&&-1===crmConstants.cachedModules.indexOf(e))){this.transition&&i.contains(this.transition.target)&&(this.transition.data.skipModuleReqTrigger=!0);var a={};if(a.module=app.store.makeRequest("findRecord","module",r.id),r.crux_customViewAccessedModules=!0,!window.clientPortalName){var s=crmConstants.moduleVsCrossModules[e];if(s){for(var o=s.length,n=0;n<o;n++){var l=moduleRecordMapping[s[n]];("Visits"!==l.module_name||"Visits"===l.module_name&&"object"==typeof CrmTracking&&CrmTracking.portalsInfo)&&(a["request"+(n+1)]=c(l.id))}function c(e){return new Promise((function(t){app.store.makeRequest("findRecord","module",e,void 0,void 0,void 0,{getFields:!0}).then((function(e){t(e[0])}),(function(){t()}))}))}}}return Lyte.resolvePromises(a).then((function(t){t.module=t.module?t.module[0]:moduleRecordMapping[e],t.module_name=e;for(var r=1;t["request"+r];)t["request"+r]=t["request"+r],r++;return t}))}var d=Lyte.Router.getRouteInstance().parent.routeName;if(-1===["CustomModule5001","CustomModule5002","CustomModule5003","CustomModule5004"].indexOf(e)){if("Activities"===e)r=moduleRecordMapping[this.getQueryParams().sub_module];if(r&&r.api_supported&&-1!==["crm.tab.module.create"].indexOf(Lyte.Router.getRouteInstance().transition.target)||d&&"entity"===d)return this.transition&&i.contains(this.transition.target)&&(this.transition.data.skipModuleReqTrigger=!0),app.store.makeRequest("findRecord","module",r.id,{include:["layouts","lookup_field_properties","custom_view","related_lists","business_card_fields"]}).then((function(){return{module:moduleRecordMapping[e],module_name:e}}))}return{module:moduleRecordMapping[e],module_name:e}}},postModuleDataFetch:function(e){("Leads"===e||"Contacts"===e||"Campaigns"===e)&&moduleRecordMapping.Campaigns.viewable&&moduleRecordMapping.Campaigns.visible&&app.store.makeRequest("findAll","campaign_status",{module:"Campaigns"},!0)},getCustomViewData:function(e,t,r){var i,a,s,o,n=store.peekRecord("module",moduleRecordMapping[e].id),l=n.id;if(n.actions||(store.model[l]||store.registerModel(l,{},{extends:"entity"}),s=app.store.makeRequest("triggerAction",l,"mass_actions",{cvid:t,type:"GET"})),this.isOldTagCriteria){var c="Activities"===n.api_name?this.isOldTagCriteria.searchModule:n.api_name;delete this.isOldTagCriteria,i=app.store.makeRequest("findAll","tag",{module:c,fromPage:"view"},!0)}return e in Crm.activityGrp&&"crm.tab.module.custom-view.kanban"==r.target||(a=app.store.makeRequest("findAll","filter",{module:n.api_name,cvid:t},!0,void 0,{cvid:t,module:n.api_name})),n.api_supported&&!window.clientPortalName&&(o=app.store.makeRequest("findAll","custom_button",{module:n.api_name},!0)),Lyte.resolvePromises({filter:a,custom_button:o,actions:s,tag:i}).then((function(t){var r={};if(t.actions&&t.actions.actions&&(moduleRecordMapping[e].actions=t.actions.actions),t.custom_button){for(var i=t.custom_button.length,a=[],s=[],o=0;o<i;o++)if("list_view_each_record"===t.custom_button[o].position||"list_view_without_record"===t.custom_button[o].position)for(var n=t.custom_button[o].profiles.length,l=0;l<n;l++)Crm.userDetails.PROFILE_NAME===t.custom_button[o].profiles[l].name&&("list_view_each_record"===t.custom_button[o].position?a.push(t.custom_button[o]):s.push(t.custom_button[o]));r.list_cv_btn=a,r.layerBtn=s}else r.list_cv_btn=[];return r.saved_filters=t.filter?t.filter:[],r.tags=t.tag?t.tag:[],r}))},findObjectFromArray:function(e,t,r){return e.filter((function(e){return e[r]===t}))}}),Lyte.Mixin.register("crm-detail-view-utils",{executeActionButton:function(e,t,r,i,a,s,o){if("sendMail"==e)if(["SalesOrders","Invoices","Quotes","PurchaseOrders"].contains(t))if(a.Contact_Name){if(store.modelFor(moduleRecordMapping.Contacts.id)){if(store.peekRecord(moduleRecordMapping.Contacts.id,a.Contact_Name.id))return void Lyte.registeredMixins["crm-detail-view-utils"].sendMailForInventoryModules(t,a,store.peekRecord(moduleRecordMapping.Contacts.id,a.Contact_Name.id).Email,s,o)}else store.registerModel(moduleRecordMapping.Contacts.id,{},{extends:"entity"});store.findRecord(moduleRecordMapping.Contacts.id,a.Contact_Name.id).then((function(e){Lyte.registeredMixins["crm-detail-view-utils"].sendMailForInventoryModules(t,a,e[0].Email,s,o)}))}else this.sendMailForInventoryModules(t,a,void 0,s,o);else EntSendMail(t,r,"",i);else if("mailMerge"===e){var n=Crm.getCrmBasePath()+"/MailMerge.do?",l=$L("#lookupdiv")[0],c="action=mergeAction&idlist="+r+"&module="+t,d=csrfParamName+"="+encodeURIComponent(csrfToken);n+=c,mR(n,(function(e){l.style.zIndex=30,l.style.width="550px",freezeBackground(),$(l).empty(),l.innerHTML=e,mailsetCenter("lookupdiv"),JSEvalScript(l)}),d)}else if("addRelatedList"==e){var u=$("[name='rlContentChngd']"),m=$("#topBandPopup");"none"==m.css("display")&&u.length>0&&u.val("false"),$L.fastdom.mutate((function(){"none"==m.css("display")&&loadAjaxTab("","lightblue")}));n=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=addNewRelatedList&module="+t;mR(n,(function(e){$L.fastdom.mutate((function(){m.html(e)})),"none"==m.css("display")&&(commonUtils.showHideLoadingDiv(),showAnimatePopup("topBandPopup"),$("#thirdPartyRowTag").on("click",(function(){$("#thirdPartyRowTag").off("click")})))}))}else if("exportpdf"==e)exportPDF(t,r);else if("printPreview"==e)openPrintTemplatePop(r,t);else if("share"==e){if(0==$("#shareContactPopup").length){$("#show").append('<div id="shareContactPopup"></div>');for(var p=moduleRecordMapping[t].profiles,g=[],f=[],h=[],y="(profile:in:",v=p.length,_=0;_<v;_++)"Administrator"!==p[_].name&&(f.push(p[_].id),g.push(p[_].name));var b={};1===f.length?(y="(profile:equals:"+g[0].toString().replace("(","\\(").replace(")","\\)")+")",b.comparator="equal",b.field="profile.id",b.value=f[0]):(b.value=f,b.comparator="in",b.field="profile.id",y=y+g.join(",").replace("(","\\(").replace(")","\\)")+")"),h.push(b),h.push("and");r=detailView.entityId;C=(C=(C=networkUtils.returnDependencyFiles(["crm-detailview-share-modal.js","lyte-hovercard.js"],crmConstants.jsStaticPathForLyte)).concat(networkUtils.returnDependencyFiles(["crm-detailview-share-modal.css"],crmConstants.lessStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("recordlevelsharing")],crmConstants.jsStaticPath)),commonUtils.showHideLoadingDiv(!0),Lyte.resolvePromises({roles:store.findAll("role",null,!1,!0),filesResolved:Lyte.injectResources(C),shareData:store.triggerAction("entity","share",{type:"GET",module:moduleRecordMapping[t].api_name,entityId:r}),moduleInfo:store.peekRecord("module",moduleRecordMapping[t].id),recordInfo:new Promise((function(e){a?e(a):store.findRecord(moduleRecordMapping[t].id,r).then((function(t){e(t[0])}))}))}).then((function(e){commonUtils.showHideLoadingDiv(!1);var i={comparator:"not_equal",field:"role.name"},a=e.roles.filter((function(e){if(!e.reporting_to)return e}))[0];i.value=a.name,h.push(i);var s=[{users:Array.from(new Set([Crm.userDetails.USER_ID,e.recordInfo.Owner.id])),roles:[a.id],groups:[]}],o={type:"SubordinateRoleUsers",role_id:a.id,include_lite_users:!0};Lyte.Component.render("crm-detailview-share-modal",{userCriteria:h,searchCriteria:y,queryParam:o,module:t,entityId:r,shareData:e.shareData,moduleInfo:e.moduleInfo,excludeModel:s,excludeMembers:s,forceFetch:!0},"#shareContactPopup").show(!1)}),(function(e){commonUtils.showHideLoadingDiv(!1);var r=JSON.parse(e.responseText);"403"==e.status||"400"==e.status?"Scheduler is running"===r.message?(Lyte.Component.render("crm-detailview-share-modal",{onProcess:!0,moduleInfo:{singular_label:moduleRecordMapping[t].singular_label}},"#shareContactPopup"),$L("#crm-detailview-share-modal")[0].ltProp("show",!0)):renderingUtils.displayPermissionDenied():crmui.showMsgBand("error",I18n.getMsg("crm.mb.alert.complete.operation.later"),36e4)}))}}else if(["cliq","slack","cisco"].indexOf(e)>=0)Crm.loadChatIntegrations(void 0,void 0,"record",e,{module:t,id:r});else if("sendDM"===e){var w=Lyte.Router.getRouteInstance().currentModel?Lyte.Router.getRouteInstance().currentModel.entityDetails:void 0;if(w&&!$u.isEmpty(w.socialObj)){var C=networkUtils.returnDependencyFiles(["crm-social-related-list.js"],crmConstants.jsStaticPathForLyte),D=networkUtils.returnDependencyFiles(["crm-social-related-list.css"],crmConstants.cssStaticPathForLyte),L=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("social")]),R=C.concat(D).concat(L);Lyte.injectResources(R,void 0,(function(){Lyte.registeredMixins["crm-social-integration"].sendDmInCanvasView(w.socialObj.dm_id,w.socialObj.profile_id,w.socialObj.TWDMInfo,t,r)}))}}},sendMailForInventoryModules:function(e,t,r,i,a){if(window.addEventListener("message",receiveMessage,!1),"PurchaseOrders"==e){var s=t.Contact_Name?t.Contact_Name.id:"",o=t.Vendor_Name?t.Vendor_Name.id:"";if("ContactMailList"==i){if(t.Contact_Name&&!isEmailValidInAssocCont(t.Contact_Name.name,null,r||(a?"":"null"),"Contacts"))return;var n=Crm.getCrmBasePath()+"/Template.do?step=previewPop&entityId="+encodeURIComponent(t.id)+"&module="+encodeURIComponent(e)+"&contactNameId="+encodeURIComponent(s)+"&vendorId="+encodeURIComponent(o)+"&flag=false&fileName="+encodeURIComponent(e.indexOf("CustomModule")>-1||e.indexOf("LinkingModule")>-1?t.Name:t[crmConstants.moduleDisplayField[e][0]])+"&action=sendMail"}else n=Crm.getCrmBasePath()+"/Template.do?step=previewPop&entityId="+encodeURIComponent(t.id)+"&module="+encodeURIComponent(e)+"&contactNameId="+encodeURIComponent(s)+"&vendorId="+encodeURIComponent(o)+"&flag=true&fileName="+encodeURIComponent(e.indexOf("CustomModule")>-1||e.indexOf("LinkingModule")>-1?t.Name:t[crmConstants.moduleDisplayField[e][0]])+"&action=sendMail";adjustScreenAndOpen(n)}else{s=t.Contact_Name?t.Contact_Name.id:"";if(t.Contact_Name&&!isEmailValidInAssocCont(t.Contact_Name.name,null,r||(a?"":"null"),"Contacts"))return;n=Crm.getCrmBasePath()+"/Template.do?step=previewPop&entityId="+encodeURIComponent(t.id)+"&module="+encodeURIComponent(e)+"&contactNameId="+encodeURIComponent(s)+"&flag=false&fileName="+encodeURIComponent(e.indexOf("CustomModule")>-1||e.indexOf("LinkingModule")>-1?t.Name:t[crmConstants.moduleDisplayField[e][0]])+"&action=sendMail";n=Crm.getPortalURL(n),adjustScreenAndOpen(n,e)}},executeRelatedListActions:function(e,t,r,i,a){var s=null;if(!t||"SURVEYPERSONALITY"!==t.personality_name||"createsurvey"!==e&&"sendsurvey"!==e&&"attendsurvey"!==e){if(t&&t.module){var o=Object.keys(moduleApiMapping).filter((function(e){return moduleApiMapping[e]==t.module.api_name}));o.length&&(o="Deals"==t.module.api_name?o[1]:o[0])}}else s=store.peekRecord("zsurvey_rl",t.personality_name).ACTIONS[0].URL;switch(e){case"attachDocuments":openZDocsLinkDialog(Crm.userDetails.ZGID);break;case"teamDrivePicker":var n={WDDomainURL:httpprotocol+RebrandLinkUtil.getProperty("teamdriveURL"),primaryActionCallBack:crmRelatedList.addAttachmentsFromTeamDrive,countToSelectMaxFiles:10,width:"850px",height:"calc( "+renderingUtils.windowHeight+"px - 3rem - 20px )",disableFolderSelection:!1,canShare:!0,service:"ZohoCRM",showSearch:!0,zsoid:crmZgid};Crm.trackSpotLightAction("Workdrive Picker Click",{Place:"related list"}),n.shareOptions={showshareDialog:!0,shareFields:{collaboratorShare:!1,teamShare:!0,orgShare:!1,externalShare:!0},defaultShare:"teamShare",externalShareTag:"crm_team"};var l=RebrandLinkUtil.getProperty("TD_JS_STATIC_URL");Lyte.removeFromCache([l]),Lyte.injectResources([l],void 0,(function(){(new WorkDrive).showResourcePicker(n)}));break;case"attachDesktop":showCustomizePopup("Attach",t?t.personality_name.toLowerCase()+"_"+t.id:"",void 0,"");break;case"attachZDocs":openForDocs("zdoc",RebrandLinkUtil.properties.docsURL);break;case"attachGDocs":(P=window.location.hostname)==RebrandLinkUtil.properties.CRMURL?openForDocs("gdoc",RebrandLinkUtil.properties.GadGetsURL,RebrandLinkUtil.properties.CRMURL,!1):openForDocs("gdoc",RebrandLinkUtil.properties.GadGetsURL,P,!1);break;case"cloudPicker":var c={feature:"attachments",cloud_services:"gdrive,box,skydrive,dropbox,evernote",callback:crmRelatedList.addAttachmentsFromCloudPicker,max_file_selection:5};!0!==featuresAvailable.CLOUDPICKER_GADGETS&&(c.cloud_services="gdrive,box,skydrive"),Lyte.registeredMixins["crm-cloud-picker-mixin"].loadCloudPicker(c);break;case"attachLink":var d=networkUtils.returnDependencyFiles(["editlinkurl.js"],crmConstants.jsStaticPathForLyte),u=networkUtils.returnDependencyFiles(["linkattachment.css"],crmConstants.cssStaticPathForLyte),m=d.concat(u);Lyte.injectResources(m,void 0,(function(){Lyte.Component.render("crm-linkattachment",{module:moduleRecordMapping[Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()].api_name,record:i.id,header:I18n.getMsg("crm.attach.link.from.url")},"#show"),document.getElementById("showLinkUrlPop").ltProp("show",!0)}));break;case"addProducts":case"add":case"addCampaigns":addMultiValue(i.id,r,o,t.personality_name.toLowerCase()+"_"+t.id,void 0,void 0,t.id);break;case"addNew":var p={module:o,primid:i.id,primmodule:r,returnAnchor:t.personality_name.toLowerCase()+"_"+t.id,listRelationId:t.id,fillUpModule:r,entityid:i.id,relmodule:r,entityname:r.indexOf("CustomModule")>-1||r.indexOf("LinkingModule")>-1?i.Name:i[crmConstants.moduleDisplayField[r][0]]};if("REPORTINGCONTACTSPERSONALITY"===t.personality_name&&(null==i.Account_Name||null==i.Account_Name||0==Object.keys(i.Account_Name).length)){var g=Crm.moduleInfo.Contacts.translatedSingularLabel,f=Crm.moduleInfo.Accounts.translatedSingularLabel;return void crmui.showMsgBand("error",I18n.getMsg("crm.contact.hierarchy.new_reporting_contact_error",[g,f]),"7000")}if("true"!=p.isCustLookup){var h=$L("#accountId")[0];"Accounts"==p.relmodule||"Contacts"==p.relmodule?p.fillUpFieldId=$L("#id")[0].value:h&&(p.fillUpFieldId=h.value)}Lyte.Router.transitionTo({route:"crm.tab.module.create",dynamicParams:[o]}).data=p;break;case"addPotentialsProducts":var y=$("#parentCurrencyISOCode").val(),v=$("#parentExchangeRate").val();addMultiValue(i.id,r,o,t.personality_name.toLowerCase()+"_"+t.id,y,v,t.id);break;case"importListPrice":p={module:o,priceBookId:i.id,step:"1"};Lyte.Router.transitionTo({route:"crm.settings.import",queryParams:p}).data={itsRelatedModule:"true",currStep:"sourceType",parentModule:r,parentId:i.id};break;case"editProducts":editAllValues(i.id,r,o,void 0,void 0,t.id,i.Full_Name);break;case"newTask":case"Canvas_Custom_newTask":if(!t){var _=store.peekAll("related_list").filterBy({personality_name:"TASKSPERSONALITY"});t={personality_name:"TASKSPERSONALITY",id:_[0].id}}selectAction("NewTask",t.personality_name.toLowerCase()+"_"+t.id,r,i.id,a.target,a);break;case"newEvent":case"Canvas_Custom_newEvent":Events.globalCreate(a,"relatedlist_new",a.target);break;case"newAppointment":case"Canvas_Custom_newAppointment":if(!t){_=store.peekAll("related_list").filterBy({personality_name:"APPOINTMENTSPERSONALITY"});t={personality_name:"APPOINTMENTSPERSONALITY",id:_[0].id}}Events.appointmentParams={},Events.appointmentParams.listRelationId=t.id,Events.appointmentParams.entityid=i.id,Events.appointmentParams.relmodule=r,Events.appointmentParams.entityname=$("#entityName").val(),Events.globalCreate(a,"relatedlist_new","Appointments");break;case"logCall":case"Canvas_Custom_logCall":if(isNewCallView){var b=t&&"CALLSPERSONALITY"===t.personality_name||Crm.isActivitySplitDone?"relatedlist_new_canvas":"relatedlist_new";Crm.globalCreate(a,b,a.target)}else{if(!t){_=store.peekAll("related_list").filterBy({personality_name:"CALLSPERSONALITY"});t={personality_name:"CALLSPERSONALITY",id:_[0].id}}selectAction("NewCall",t.personality_name.toLowerCase()+"_"+t.id,r,i.id,a.target,a)}break;case"sendMailEvent":EntSendMail(r,i.id,"",moduleRecordMapping[r].singular_label);break;case"associateMxN":(D=JSON.parse('{"fldName":""}')).fldName=t.mxnfield,D.relatedlist=!0,multiLookupsView.frameMLJSON(D),(L=multiLookupsView.getParamJson(D.fldName)).entityId=i.id,L.relatedlist=!0,L.searchmodule=t.connectedmodule,Crm.trackSpotLightAction("Multi Select Lookup - Add Click",{Module:L.searchmodule}),L.select=!1,L.fldName=t.mxnfield,L.linkingmodule=t.linkingmodule,L.relid=t.id,multiLookupsView.submitMultiLookupForm("addmore",Crm.getCrmBasePath()+"/Search.do","topBandPopup",L);break;case"dissociateMxN":(D={}).fldName=t.mxnfield,multiLookupsView.frameMLJSON(D),(L=multiLookupsView.getParamJson(D.fldName)).entityId=i.id,L.link="edit",L.relatedlist=!0,L.searchmodule=t.connectedmodule,Crm.trackSpotLightAction("Multi Select Lookup - Edit Click",{Module:L.searchmodule}),L.select=!0,L.fldName=t.mxnfield,L.linkingmodule=t.linkingmodule,L.relid=t.id,multiLookupsView.submitMultiLookupForm("addmore",Crm.getCrmBasePath()+"/Search.do","topBandPopup",L);break;case"editLookupRel":(D=JSON.parse('{"fldName":""}')).fldName=t.id,D.relatedlist=!0,D.lookuprel=!0,multiLookupsView.frameMLJSON(D),(L=multiLookupsView.getParamJson(D.fldName)).entityId=i.id,L.link="edit",L.relatedlist=!0,L.mlaction="edit";var w=o;L.searchmodule=w,Crm.trackSpotLightAction("Multi Select Lookup - Edit Click",{Module:L.searchmodule}),L.select=!0,L.linkingmodule=w,L.relid=t.id,multiLookupsView.submitMultiLookupForm("edit",Crm.getCrmBasePath()+"/Search.do","topBandPopup",L);break;case"associateLookupRel":if("REPORTINGCONTACTSPERSONALITY"===t.personality_name){var C=$("#subvalue_ACCOUNTID");if(!C[0]||C[0]&&""===C[0].text){g=Crm.moduleInfo.Contacts.translatedSingularLabel,f=Crm.moduleInfo.Accounts.translatedSingularLabel;return void crmui.showMsgBand("error",I18n.getMsg("crm.contact.hierarchy.assign_reporting_contact_error",[g,f]),"7000")}}var D,L;(D=JSON.parse('{"fldName":""}')).fldName=t.id,D.relatedlist=!0,D.lookuprel=!0,multiLookupsView.frameMLJSON(D),(L=multiLookupsView.getParamJson(D.fldName)).entityId=i.id,L.relatedlist=!0,L.searchmodule=o,L.lookuprel=!0,L.select=!1,L.linkingmodule=null,L.relid=t.id,multiLookupsView.submitMultiLookupForm("addmore",Crm.getCrmBasePath()+"/Search.do","topBandPopup",L);break;case"newPotential":var R="";h=$L("#accountId")[0];"Accounts"==r||"Contacts"==r?R=$L("#id")[0].value:h?R=h.value:"Potentials"!=r&&"Deals"!=r||!i.Account_Name||(R=i.Account_Name.id);p={module:o,primid:i.id,primmodule:r,returnAnchor:t.personality_name.toLowerCase()+"_"+t.id,listRelationId:t.id,isCustLookup:!1,entityid:i.id,fillUpModule:r,fillUpFieldId:encodeURIComponent(R),relmodule:r,entityname:r.indexOf("CustomModule")>-1||r.indexOf("LinkingModule")>-1?i.Name:i[crmConstants.moduleDisplayField[r][0]]};Lyte.Router.transitionTo({route:"crm.tab.module.create",dynamicParams:["Deals"===o?"Potentials":o]}).data=p;break;case"newPotentialForContacts":"NaN"==(p={module:o,primid:i.id,primmodule:r,returnAnchor:t.personality_name.toLowerCase()+"_"+t.id,listRelationId:t.id,recordNum:$("#recordNum").val(),relmodule:r,fillUpModule:r,entityid:i.id,entityname:r.indexOf("CustomModule")>-1||r.indexOf("LinkingModule")>-1?i.Name:i[crmConstants.moduleDisplayField[r][0]]}).recordNum&&(p.recordNum="null"),Lyte.Router.transitionTo({route:"crm.tab.module.create",dynamicParams:["Deals"===o?"Potentials":o]}).data=p;break;case"newCompetitor":selectAction("Competitor",t.personality_name.toLowerCase()+"_"+t.id,void 0,void 0,t.id,a);break;case"newProject":selectAction("Project",t.personality_name.toLowerCase()+"_"+t.id,void 0,void 0,void 0,a);break;case"newAssociateProject":selectAction("Associate Project",t.personality_name.toLowerCase()+"_"+t.id,void 0,void 0,void 0,a);break;case"importAction":crmRelatedList.importAction(a,a.target);break;case"updateCampaignStatus":crmRelatedList.showCampaignStatusDiv(t.id);break;case"importOrgAction":crmRelatedList.importOrgAction(a,a.target);break;case"hideRLPersonality":CustomRelatedListObj.doCustomRleatedList(t.personality_name.toLowerCase()+"_"+t.id,"hide");break;case"reorderRLPersonality":CustomRelatedListObj.doCustomRleatedList(t.personality_name.toLowerCase()+"_"+t.id,"reorder");break;case"editRLPersonality":CustomRelatedListObj.doCustomRleatedList(t.personality_name.toLowerCase()+"_"+t.id,"edit");break;case"deleteRLPersonality":CustomRelatedListObj.doCustomRleatedList(t.personality_name.toLowerCase()+"_"+t.id,"del");break;case"addContactRoles":p={returnAnchor:t.personality_name.toLowerCase()+"_"+t.id,accId:i.Account_Name?i.Account_Name.id:""};Lyte.Router.transitionTo({route:"crm.tab.module.entity.add-contact-role",dynamicParams:["Potentials",i.id],queryParams:p});break;case"editContactRoles":p={returnAnchor:t.personality_name.toLowerCase()+"_"+t.id,accId:i.Account_Name?i.Account_Name.id:""};Lyte.Router.transitionTo({route:"crm.tab.module.entity.edit-contact-role",dynamicParams:["Potentials",i.id],queryParams:p});break;case"createsurvey":var P="http://"+s;networkUtils.openUrl(P,"_blank");break;case"sendsurvey":case"attendsurvey":var I=null,S=(p={action:"surveyDetails",from:e,entityId:i.id,module:this.getData("module")},$("crm-zsurvey-rl-actions").attr("ent-id-for-zmail"));S&&(I=S,p.entIdForZMail=I);var M=a.target;M.setAttribute("data-params",JSON.stringify(p)),ZSurvey.showSurveyDetails(M)}},recordDeletePopup:function(e,t,r,i,a,s,o){var n,l,c,d=[{type:"reject",text:I18n.getMsg("crm.button.cancel"),appearance:"default",class:"PupHome_cancelbtn"}],u=moduleRecordMapping[r]?moduleRecordMapping[r].plural_label:r;s&&"multiselectlookup"==s.type&&(l=e[store.peekRecord("field",s.mxnfield).api_name]?e[store.peekRecord("field",s.mxnfield).api_name][crmConstants.moduleDisplayField[r][0]]:crmConstants.moduleDisplayField[r]?e[crmConstants.moduleDisplayField[r][0]]:void 0,c=e[store.peekRecord("field",s.mxnfield).api_name]?e[store.peekRecord("field",s.mxnfield).api_name].Name:e.Name);var m=s&&"multiselectlookup"==s.type?r.indexOf("CustomModule")>-1||r.indexOf("LinkingModule")>-1?c:l:r.indexOf("CustomModule")>-1||r.indexOf("LinkingModule")>-1?e.Name:e[crmConstants.moduleDisplayField[r][0]],p=i&&(i.indexOf("CustomModule")>-1||i.indexOf("LinkingModule")>-1?a.Name:a[crmConstants.moduleDisplayField[i][0]]);switch(t){case 1:n=I18n.getMsg("crm.mxnLookup.dissociateselectedmessage",[m,moduleRecordMapping[r].singular_label,p,moduleRecordMapping[i].singular_label]),d.push({type:"accept",text:I18n.getMsg("crm.confirm.deassociate"),appearance:"failure",class:"PupHome_dissociatebtn"});break;case 2:n=I18n.getMsg("crm.warning.delete.record",m),d.push({type:"accept",text:I18n.getMsg("crm.button.move.to.trash"),appearance:"failure",class:"PupHome_button_deletebtn"});break;case 3:n=I18n.getMsg("crm.warning.deassociateordelete.entity",u),d.push({type:"accept",text:I18n.getMsg("crm.button.dissociate"),appearance:"failure",class:"PupHome_dissociatebtn"}),d.push({type:"accept",text:I18n.getMsg("crm.mb.label.move.to.trash"),appearance:"failure",class:"PupHome_button_deletebtn"})}var g=this,f=$L("#detailViewUtilAlert"),h={ltPropContentAlign:"center",ltPropTop:"0px",ltPropHeading:n,ltPropButtons:d,ltPropButtonPosition:"center",id:"detailViewUtilAlert",ltPropWrapperClass:"crmAlert crmAlertNoContent",ltPropShowCloseButton:!1};if(o&&isRelatedRecordsModule(r)?h.ltPropSecondaryMessage=I18n.getMsg("crm.label.note")+" : "+I18n.getMsg("crm.warning.related.modules",getAllRelatedChildModulesPluralLabel(r)):delete h.ltPropSecondaryMessage,0==f.length?f.push(Lyte.Component.render("lyte-alert",h,"body")):f[0].setData(h),s&&"multiselectlookup"!=s.type&&("custom_lookup"==s.type||Lyte.registeredMixins["crm-detail-view-utils"].customRelatedList(r,i))&&"Competitors"!=s.api_name){var y=Object.keys(moduleRecordMapping).filter((function(e){return moduleRecordMapping[e].api_name==s.module.api_name}))[0];if(null==store.peekRecord("module",moduleRecordMapping[y].id).fields&&y)commonUtils.showHideLoadingDiv(!0),store.findRecord("module",moduleRecordMapping[y].id,void 0,void 0,void 0,{getFields:!0}).then((function(){commonUtils.showHideLoadingDiv(),f[0].ltProp("show",!0)}));else 0==store.peekRecord("module",moduleRecordMapping[y].id).fields.filterBy({data_type:"lookup"}).filter((function(e){return e.lookup.api_name==s.api_name})).length?(commonUtils.showHideLoadingDiv(!0),store.findRecord("module",moduleRecordMapping[y].id,void 0,void 0,void 0,{getFields:!0}).then((function(){commonUtils.showHideLoadingDiv(),f[0].ltProp("show",!0)}))):f[0].ltProp("show",!0)}else f[0].ltProp("show",!0);f[0].setMethods({onShow:function(e){e.childComp.querySelector(".PupHome_cancelbtn").setAttribute("data-zcqa","PupHome_cancelbtn");var t=e.childComp.querySelector(".PupHome_button_deletebtn");t&&t.setAttribute("data-zcqa","PupHome_button_deletebtn");var r=e.childComp.querySelector(".PupHome_dissociatebtn");r&&r.setAttribute("data-zcqa","PupHome_dissociatebtn")},onAccept:function(t){if(commonUtils.showHideLoadingDiv(!0),t==I18n.getMsg("crm.confirm.deassociate")||t==I18n.getMsg("crm.button.dissociate"))if("Contact_Roles"==s.api_name){var o=Crm.getCrmBasePath()+"/potentials/deleteContPotRel.do?module=Potentials&whoId="+e.id+"&whatId="+a.id+"&nextStep=relatedlist&isajax=true#"+s.personality_name.toLowerCase()+"_"+s.id;sortRelatedList(o,"",e.id)}else if("multiselectlookup"==s.type)(e=e.isTemplate?e.parentCompRecord:e).$.destroyRecord().then((function(){Lyte.triggerEvent("relatedList",{id:s.id,type:"unassign",record_id:e.id}),commonUtils.showHideLoadingDiv()}),(function(e){"NO_PERMISSION"==JSON.parse(e.response).code?renderingUtils.displayPermissionDenied():(Lyte.triggerEvent("relatedList",{id:s.id}),commonUtils.showHideLoadingDiv())}));else if("custom_lookup"==s.type||Lyte.registeredMixins["crm-detail-view-utils"].customRelatedList(r,i))if("Activities"==r)store.addField(moduleRecordMapping.Activities.id,"What_Id","object"),this.disassicateProcess(e,"What_Id",r);else{var n=store.peekRecord("module",moduleRecordMapping[Object.keys(moduleRecordMapping).filter((function(e){return moduleRecordMapping[e].api_name==s.module.api_name}))[0]].id),l=n.fields.filterBy({data_type:"lookup"}).filter((function(e){return"custom_lookup"==s.type?e.lookup.api_name==s.api_name&&e.lookup.module.api_name==moduleApiMapping[i]:e.lookup.module.api_name==moduleApiMapping[i]}))[0];if(!Crm.userDetails.permissions.hasOwnProperty("Crm_Implied_Edit_"+n.module_name))return renderingUtils.displayPermissionDenied(void 0,(function(){this.cxProp("title",I18n.getMsg("crm.mxnlookup.remove.title",n.plural_label))}),I18n.getMsg("crm.mxnlookup.lookuprel.permissiondeniedwarning.new",[n.singular_label,m,Crm.appName])),void commonUtils.showHideLoadingDiv();e.Layout&&l[e.Layout.id]?l[e.Layout.id].required?g.showLookupDisassociateError(n.plural_label,l.field_label):0==l[e.Layout.id].required?g.disassicateProcess(e,l.api_name,r):store.findRecord("layout",e.Layout.id,{module:n.api_name}).then((function(){l[e.Layout.id]&&l[e.Layout.id].required?g.showLookupDisassociateError(n.plural_label,l.field_label):g.disassicateProcess(e,l.api_name,r)})):n.layouts&&n.layouts.length&&l[n.layouts[0].id]?l[n.layouts[0].id].required?g.showLookupDisassociateError(n.plural_label,l.field_label):g.disassicateProcess(e,l.api_name,r):store.findAll("layout",{module:n.api_name}).then((function(){l[n.layouts[0].id]&&l[n.layouts[0].id].required?g.showLookupDisassociateError(n.plural_label,l.field_label):g.disassicateProcess(e,l.api_name,r)}))}else store.findRecord(moduleRecordMapping[i].id,a.id,!1,!1,!1,{type:"DELETE",id:e.id,module:moduleRecordMapping[r].api_name}).then((function(){"canvas"==Lyte.Router.getRouteInstance().routeName&&(Lyte.triggerEvent("relatedList",{module:r,type:"unassign",record_id:e.id}),commonUtils.showHideLoadingDiv())}),(function(e){"NO_PERMISSION"==JSON.parse(e.response).code?renderingUtils.displayPermissionDenied():(Lyte.triggerEvent("relatedList",{module:r}),commonUtils.showHideLoadingDiv())}));else if(s&&"Competitors"==s.api_name){o=Crm.getCrmBasePath()+"/potentials/DeletingCompetitor.do?competitorid="+e.id+"&nextStep=relatedlist&isajax=true#"+s.personality_name.toLowerCase()+"_"+s.id;sortRelatedList(o,"",e.id)}else s&&"Attachments"===s.api_name?store.findRecord(moduleRecordMapping[i].id,a.id,!1,!1,!1,{type:"DELETE",id:e.id,module:moduleRecordMapping[r].api_name}).then((function(){Lyte.triggerEvent("relatedList",{module:"Attachments",type:"unassign",record_id:e.id}),commonUtils.showHideLoadingDiv()}),(function(e){"NO_PERMISSION"==JSON.parse(e.response).code?renderingUtils.displayPermissionDenied():JSON.parse(e.response).data&&"INVALID_DATA"===JSON.parse(e.response).data[0].code?Lyte.triggerEvent("recordDelete",{module:r}):(commonUtils.showHideLoadingDiv(),Lyte.triggerEvent("relatedList",{module:r}))})):e.$.destroyRecord().then((function(){if(Crm.canvasScroll){var t=$("#"+Crm.canvasScroll)[0],i=findPosY(t),a=$("#detailcanvascontainer");a.animate({scrollTop:i-a.offset().top-20},{duration:1e3,complete:"complete"})}Crm.canvasScroll=null;var s=!1;if("canvas"==Lyte.Router.getRouteInstance().routeName&&$L("crm-detailview-canvas")[0].component.data.record.id==e.id)if(s=!0,crmNavig[crmNavig.customViewKey]&&crmNavig[crmNavig.customViewKey].recordId){var o=crmNavig[crmNavig.customViewKey].recordId.map((function(e){return e.id})).indexOf(e.id);if(o>0){if(crmNavig[[crmNavig.customViewKey]].recordId.splice(o,1),crmNavig[crmNavig.customViewKey].recordId[o]&&"EOA"!=crmNavig[crmNavig.customViewKey].recordId[o])var n=crmNavig[crmNavig.customViewKey].recordId[o];else{n=crmNavig[crmNavig.customViewKey].recordId[o-1];o-=1}if(n&&n.id)store.findRecord(moduleRecordMapping[r].id,n.id).then((function(e){var t=(e=null!=e.id?e:e[0]).$canvas_id;crmTab.deleteFromCache(r),store.unloadAll(moduleRecordMapping[r].id),t?Lyte.Router.transitionTo({route:"crm.tab.module.entity.canvas",dynamicParams:[n.module,e.id,t]}).data={FROM_INDEX:crmListView.getObject().fromIndex,TO_INDEX:crmListView.getObject().toIndex,recordNum:o,cvid:crmNavig.customViewKey,fromDel:!0,navig:!0}:Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[n.module,e.id],queryParams:{redirect:"false"},target:"_blank"}).data={FROM_INDEX:crmListView.getObject().fromIndex,TO_INDEX:crmListView.getObject().toIndex,recordNum:o,cvid:crmNavig.customViewKey,fromDel:!0,navig:!0}}));else Lyte.triggerEvent("recordDelete",{module:r})}else Lyte.triggerEvent("recordDelete",{module:r})}else Lyte.triggerEvent("recordDelete",{module:r});s||Lyte.triggerEvent("relatedList",{module:r,type:"unassign",record_id:e.id}),commonUtils.showHideLoadingDiv()}),(function(t){if("INVALID_DATA"===JSON.parse(t.response).code&&"The product cannot be deleted as it is involved in inventory record"===JSON.parse(t.response).message){var i="<div onclick='sE()' class='w500 p20'><div class='floatL pL20 w430'><div class='f20'><h2 style='color:#E20000';>"+I18n.getMsg("crm.cannot.delete.product.detailview")+"</h2></div><div class='mT10'>"+I18n.getMsg("crm.cannot.delete.product.reason.detailView")+"</div></div><br class='clearB'><div  class='alignright mT20'><input type='button' id='popupok' class='primarybtn' value='"+I18n.getMsg("crm.button.ok")+"' onclick=\"hide('popupnew');removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30\"></div></div>";renderingUtils.popUpWithFreeze(i),e.$.rollBack()}"NO_PERMISSION"==JSON.parse(t.response).code?(renderingUtils.displayPermissionDenied(),e.$.rollBack()):JSON.parse(t.response).data&&"INVALID_DATA"===JSON.parse(t.response).data[0].code?Lyte.triggerEvent("recordDelete",{module:r}):(commonUtils.showHideLoadingDiv(),Lyte.triggerEvent("relatedList",{module:r}))}))}})},customRelatedList:function(e,t){return!("Leads"==t&&"Products"==e||"Leads"==t&&"Campaigns"==e||"Accounts"==t&&"Products"==e||"Contacts"==t&&"Products"==e||"Contacts"==t&&"Campaigns"==e||"Deals"==t&&"Products"==e||"Potentials"==t&&"Products"==e||"Products"==t&&"Leads"==e||"Products"==t&&"Accounts"==e||"Products"==t&&"Contacts"==e||"Products"==t&&"Deals"==e||"Products"==t&&"Potentials"==e||"Products"==t&&"PriceBooks"==e||"Campaigns"==t&&"Leads"==e||"Campaigns"==t&&"Contacts"==e||"PriceBooks"==t&&"Products"==e)},prefetchrecordfornavigation:function(e){if(!e||!e.recordNum)return!1;e.recordNum=parseInt(e.recordNum);var t={},r=this.getRecordPage(e.recordNum,crmListView.getObject().currentOption);t.toIndex=r*crmListView.getObject().currentOption,t.fromIndex=t.toIndex-crmListView.getObject().currentOption+1,t.fileName=Crm.getCrmBasePath()+"/ShowSelectedCustomView.do",t.fromDV=!0,t.mod=!0,t.module=crmListView.getObject().module;var i=0,a=Crm.getCrmBasePath()+"/NavigateByRecords.do";if(crmNavig[crmNavig.customViewKey]&&!crmNavig[crmNavig.customViewKey].recordId[parseInt(e.recordNum)+1]&&t.toIndex<e.recordNum+1){for(var s in r=this.getRecordPage(e.recordNum+1,crmListView.getObject().currentOption),t.toIndex=r*crmListView.getObject().currentOption,t.fromIndex=t.toIndex-crmListView.getObject().currentOption+1,t)/\b(calleeObj|clickId)\b/.test(s)||void 0!==t[s]&&(a+=0===i?"?":"&",a+=s+"="+encodeURIComponent(t[s]),i++);crmNavig.fetchNextSet(a,t.fromIndex,t.toIndex,t.module)}if(crmNavig[crmNavig.customViewKey]&&!crmNavig[crmNavig.customViewKey].recordId[parseInt(e.recordNum)-1]&&t.fromIndex>e.recordNum-1){for(var s in r=this.getRecordPage(e.recordNum-1,crmListView.getObject().currentOption),t.toIndex=r*crmListView.getObject().currentOption,t.fromIndex=t.toIndex-crmListView.getObject().currentOption+1,t)/\b(calleeObj|clickId)\b/.test(s)||void 0!==t[s]&&(a+=0===i?"?":"&",a+=s+"="+encodeURIComponent(t[s]),i++);crmNavig.fetchNextSet(a,t.fromIndex,t.toIndex,t.module)}},getRecordPage:function(e,t){return parseInt((e-1)/t)+1},showLookupDisassociateError:function(e,t){_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:"x",ltPropSecondaryMessage:"x",ltPropType:"info",ltPropButtons:[{type:"accept",text:I18n.getMsg("Ok"),appearance:"default"}]},show:function(r){var i=r.childComp.querySelector(".alertSecondaryMsg");i.innerHTML=I18n.getMsg("crm.mxnlookup.lookuprel.lookupfieldmandatory.warning1",[e,t,e])+'<div class="mB10"></div>'+I18n.getMsg("crm.mxnlookup.lookuprel.lookupfieldmandatory.warning2",[e,t]);var a=r.childComp.querySelector(".alertPrimaryMsg");a.innerHTML=I18n.getMsg("crm.mxnlookup.remove.title",e),a.style.textAlign="left",i.style.textAlign="left"}}),commonUtils.showHideLoadingDiv()},disassicateProcess:function(e,t,r){(e=store.pushPayload(moduleRecordMapping[r].id,e.$.toJSON())).$.set(t,null),e.$.save().then((function(){_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.mxnlookup.dissociation.success.msg",[1,moduleRecordMapping[r].singular_label])}}),Lyte.triggerEvent("relatedList",{module:r,type:"unassign",record_id:e.id}),commonUtils.showHideLoadingDiv()}),(function(e){"NO_PERMISSION"==JSON.parse(e.response).code?renderingUtils.displayPermissionDenied():(Lyte.triggerEvent("relatedList",{module:r}),commonUtils.showHideLoadingDiv())}))},getAttachmentActions:function(e,t){var r=[];return r.push({"data-cid":"attachDesktop",label:I18n.getMsg("crm.attach.upload.file"),zcqa:"Detail_add_a_destop",name:"Upload File"}),featuresAvailable.Attach_Zoho_Docs&&featuresAvailable.Zoho_Docs_Intergration&&"false"==isSandboxAcc&&r.push({"data-cid":"attachDocuments",label:moduleRecordMapping.Documents.singular_label,zcqa:"Detail_add_a_documents",name:"Document"}),"skyDesk"!==RebrandLinkUtil.properties.DeploymentLocation&&featuresAvailable.Attach_TeamDrive&&r.push({"data-cid":"teamDrivePicker",label:I18n.getMsg("crm.label.teamdrive"),zcqa:"Detail_add_a_Zdrivelink",name:"Zoho WorkDrive"}),featuresAvailable.Attach_Zoho_Docs&&(r.push({"data-cid":"attachZDocs",label:I18n.getMsg("crm.label.addons.zdocs",Crm.brandName),zcqa:"Detail_add_a_zohodocs",name:"Zoho Docs"}),(e||"RL_Attachments"!==t)&&"true"===RebrandLinkUtil.properties.GOOGLE_DRIVE_ENABLED&&r.push({"data-cid":"attachGDocs",label:I18n.getMsg("crm.label.addons.gdocs"),zcqa:"Detail_add_a_googledrive",name:"Google Drive"})),featuresAvailable.Attach_Google_Docs&&"true"==RebrandLinkUtil.properties.CLOUD_PICKER_ENABLED&&!e&&r.push({"data-cid":"cloudPicker",label:I18n.getMsg("crm.attach.cloud.picker"),zcqa:"Detail_add_from_colud",name:"Cloud Picker"}),!e&&r.push({"data-cid":"attachLink",label:I18n.getMsg("crm.attach.link.url"),zcqa:"Detail_add_a_link",name:"Link(URL)"}),r},getRelatedListActions:function(e,t){if(e.visible&&!["NOTESPERSONALITY","HISTORYPERSONALITY","ZINVOICEPERSONALITY","ZEXPENSEPERSONALITY","ZSUBSCRIPTIONSPERSONALITY"].contains(e.personality_name)&&(e.actions=[],"ACTIVITYPERSONALITY"===e.personality_name||"ATTACHMENTSPERSONALITY"===e.personality_name||"COMPETITORSPERSONALITY"===e.personality_name||e.record_operations.edit||e.record_operations.assign||e.record_operations.create||e.record_operations.disassociate)){var r=this.getModuleNameFromRelatedlist(e),i=!1;!e.mxnfield&&"multiselectlookup"!==e.type&&r&&r.indexOf("CustomModule")>-1&&(i=!0);var a=12===e.visibility,s=12===e.visibility;if(t="Deals"===t?"Potentials":t,e.personality_name.includes("_LINKINGMODULE")||"INVITEDEVENTSPERSONALITY"===e.personality_name||"POTSTAGEHISTPERSONALITY"===e.personality_name||e.personality_name.includes("HISTORYPERSONALITY")||e.personality_name.includes("REPORTINGCONTACTSPERSONALITY")||e.personality_name.includes("CHILDCAMPAIGNSPERSONALITY")||"CHILDACCOUNTSPERSONALITY"===e.personality_name||"ATTACHMENTSPERSONALITY"===e.personality_name||"EMAILSPERSONALITY"===e.personality_name||"APPOINTMENTSPERSONALITY"===e.personality_name||"JOBSHEETSPERSONALITY"===e.personality_name||a||"CONTACTSPERSONALITY"===e.personality_name&&"Accounts"===t||"POTENTIALSPERSONALITY"===e.personality_name&&"Contacts"===t||(e.record_operations.bulk_edit&&e.actions.push(this.getActionJson("editLookupRel",t+"_"+r+"_Edit",I18n.getMsg("Edit"))),e.record_operations.assign&&e.actions.push(this.getActionJson("associateLookupRel",t+"_"+r+"_Assign",I18n.getMsg("crm.button.assign")))),"ACTIVITYPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("newTask","Detail_createtask",I18n.getMsg("crm.button.task.new"))),e.actions.push(this.getActionJson("newEvent","Detail_createevent",I18n.getMsg("crm.button.event.new",I18n.getMsg("Meeting")))),e.actions.push(this.getActionJson("logCall","Detail_createcall",I18n.getMsg("crm.button.log.a.call")));else if("TASKSPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("newTask","Detail_createtask",I18n.getMsg("crm.button.task.new")));else if("EVENTSPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("newEvent","Detail_createevent",I18n.getMsg("crm.button.event.new",I18n.getMsg("Meeting"))));else if("CALLSPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("logCall","Detail_createcall",I18n.getMsg("crm.button.log.a.call")));else if(!a||e.personality_name.includes("LINKINGMODULE")&&"multiselectlookup"===e.type)if("ATTACHMENTSPERSONALITY"===e.personality_name)e.actions=this.getAttachmentActions(void 0,"RL_Attachments");else if("CAMPAIGNSPERSONALITY"===e.personality_name)s?e.actions.push(this.getActionJson("addNew","addNew"+t+"_"+r,I18n.getMsg("crm.button.new"))):e.actions.push(this.getActionJson("addCampaigns","Detail_add_to_campaigns",I18n.getMsg("crm.button.add.product",moduleRecordMapping[r].plural_label)));else if("POTENTIALSPERSONALITY"===e.personality_name){var o="";o=s||"Contacts"!==t?"newPotential":"newPotentialForContacts",e.actions.push(this.getActionJson(o,"link_CreateNewPotential",I18n.getMsg("crm.module.new",moduleRecordMapping[r].singular_label)))}else if("REPORTINGCONTACTSPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("addNew","addNew_"+t+"_"+r,I18n.getMsg("crm.button.new")));else if("CHILDACCOUNTSPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("addNew","addNew_"+t+"_"+r,I18n.getMsg("crm.button.new")));else if("COMPETITORSPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("newCompetitor","link_CreateNewcompetitor",I18n.getMsg("crm.button.new")));else if("CONTACTSROLESPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("addContactRoles","link_CreateNewcontactrole",I18n.getMsg("crm.button.add.contact.role",moduleRecordMapping[r].plural_label))),e.actions.push(this.getActionJson("editContactRoles","link_CreateEditcontactrole",I18n.getMsg("crm.edit.all")));else if("PRICEBOOKSPERSONALITY"===e.personality_name)s?e.actions.push(this.getActionJson("addNew","addNew_"+t+"_"+r,I18n.getMsg("crm.button.new"))):(e.actions.push(this.getActionJson("addProducts","link_CreateNewPbookmodule",I18n.getMsg("crm.add.to.pricebooks",moduleRecordMapping[r].plural_label))),e.actions.push(this.getActionJson("editProducts","link_CreateEditbookmodule",I18n.getMsg("crm.edit.all"))));else if("ACCOUNTSPERSONALITY"===e.personality_name)e.actions.push(this.getActionJson("addNew","addNew_"+t+"_"+r,I18n.getMsg("crm.button.new")));else if("PRODUCTSPERSONALITY"===e.personality_name){var n="PriceBooks"===t,l=0!=Object.keys(Crm.userDetails.CURRENCY_DETAILS).length;s?e.actions.push(this.getActionJson("addNew","addNew_"+t+"_"+r,I18n.getMsg("crm.button.new"))):("Vendors"==t?e.actions.push(this.getActionJson("addNew","addNew_"+t+"_"+r,I18n.getMsg("crm.button.new"))):l&&"Potentials"===t?e.actions.push(this.getActionJson("addPotentialsProducts","addProdDtVw",I18n.getMsg("crm.add.products",moduleRecordMapping[r].plural_label))):e.actions.push(this.getActionJson("addProducts","link_CreateNewPbookmodule",I18n.getMsg("crm.add.products",moduleRecordMapping[r].plural_label))),"PriceBooks"!==t||clientPortalName||e.actions.push(this.getActionJson("importListPrice","List Price",I18n.getMsg("crm.module.import",I18n.getMsg("List Price")))),n&&e.actions.push(this.getActionJson("editProducts","Detail_editProdDtVw",I18n.getMsg("crm.edit.all"))))}else"APPOINTMENTSPERSONALITY"===e.personality_name?e.actions.push(this.getActionJson("newAppointment","Detail_createApppointment",I18n.getMsg("crm.module.new",moduleRecordMapping[r].singular_label))):"JOBSHEETSPERSONALITY"===e.personality_name?e.actions.push(this.getActionJson("newJobSheet","Detail_createJobSheet",I18n.getMsg("crm.module.new",moduleRecordMapping[r].singular_label))):i?(e.actions.push(this.getActionJson("editLookupRel",t+"_"+r+"_Edit",I18n.getMsg("Edit"))),e.actions.push(this.getActionJson("associateLookupRel",t+"_"+r+"_Assign",I18n.getMsg("crm.button.assign")))):"CONTACTSPERSONALITY"!==e.personality_name&&"LEADSPERSONALITY"!==e.personality_name&&"CASESPERSONALITY"!==e.personality_name&&"SALESORDERSPERSONALITY"!==e.personality_name&&"QUOTESPERSONALITY"!==e.personality_name&&"PURCHASEORDERSPERSONALITY"!==e.personality_name&&"INVOICESPERSONALITY"!==e.personality_name&&"SOLUTIONSPERSONALITY"!==e.personality_name&&"VENDORSPERSONALITY"!==e.personality_name&&!i||e.personality_name.includes("_LINKINGMODULE")?e.personality_name.includes("_LINKINGMODULE")&&(e.actions.push(this.getActionJson("dissociateMxN",t+"_"+r+"_CreateNew",I18n.getMsg("Edit"))),e.actions.push(this.getActionJson("associateMxN","link_CreateNewProductNopotential",I18n.getMsg("crm.button.assign")))):"Contacts"!==t||"Vendors"==t||"Visits"==t||i?"Potentials"===t&&"Vendors"!==r&&"Contacts"!==r&&"Leads"!==r&&"Solutions"!==r?e.actions.push(this.getActionJson("newPotential","link_CreateNew_"+t+"_"+r,I18n.getMsg("crm.button.new"))):"Visits"!==r&&e.actions.push(this.getActionJson("addNew","addNew"+t+"_"+r,I18n.getMsg("crm.button.new"))):e.actions.push(this.getActionJson("newPotential","link_CreateNew_"+t+"_"+r,I18n.getMsg("crm.button.new")));else e.actions.push(this.getActionJson("addNew","addNew"+t+"_"+r,I18n.getMsg("crm.button.new"))),e.actions.push(this.getActionJson("editLookupRel",t+"_"+r+"_Edit",I18n.getMsg("Edit"))),e.actions.push(this.getActionJson("associateLookupRel",t+"_"+r+"_Assign",I18n.getMsg("crm.button.assign")))}},getActionJson:function(e,t,r){var i={};return i.data_zcqa=t,i["data-cid"]=e,i.label=r,i},getModuleNameFromRelatedlist:function(e){if(e&&e.module)return"Email_Sentiment"==e.api_name?"EmailSentiment":e.connectedmodule?e.connectedmodule:e.module.id&&store.peekRecord("module",e.module.id)?store.peekRecord("module",e.module.id).module_name:void 0},isStandardLookup:function(e){return"default"===e.type&&10===e.visibility&&!["ACTIVITYPERSONALITY","TASKSPERSONALITY","EVENTSPERSONALITY","CALLSPERSONALITY","COMPETITORSPERSONALITY","PRODUCTSPERSONALITY","CAMPAIGNSPERSONALITY","PRICEBOOKSPERSONALITY","CONTACTSPERSONALITY","LEADSPERSONALITY","POTENTIALSPERSONALITY","ACCOUNTSPERSONALITY","CONTACTSROLESPERSONALITY"].contains(e.personality_name)},renderStageComponent:function(){var e=$("#stageContain");if(0!==e.length){var t,r="";returnJson.entMetaData.crtdTimeNew&&(t=Utils.getDateInUserDatePattern(new CrmDate(returnJson.entMetaData.crtdTimeNew).dateObject,!0));var i=returnJson.entityMapJson.STAGE,a=i.val,s=a.length,o=returnJson.Potentials.fieldDependency;if(o&&JSON.parse(o).PIPELINE){var n=JSON.parse(o).PIPELINE.STAGE,l=$("#subvalue_PIPELINE").text();if(n&&l){for(var c=n[l],d=c.length,u=[],m=0;m<d;m++)for(var p=c[m],g=0;g<s;g++)p===a[g].content&&u.push(a[g]);var f=u.length;f>0&&(a=u,s=f)}}var h=[],y=[],v=[],_=-1,b=!1,w=!0,C=!1,D=!1;for(g=0;g<s;g++){a[g].selectedStepItem="";var L=null;if("-None-"!==a[g].content){if(i.colorcode_enabled&&(a[g].colorCode="transparent"===a[g].colorCode?"#ffffff":a[g].colorCode),a[g].content===i.plainValue){if(a[g].selectedStepItem="stageStepItemSelected",_=C?g-1:g,"Open"===a[g].fctype&&returnJson.entityMapJson.CLOSINGDATE&&returnJson.entityMapJson.CLOSINGDATE.defaultvalue){var R=(new Date-new Date(returnJson.entMetaData.crtdTimeNew))/(new CrmDate(returnJson.entityMapJson.CLOSINGDATE.defaultvalue).dateObject-new Date(returnJson.entMetaData.crtdTimeNew)+864e5)*100;r=R>75||R<0?"stage_redIcon":R>50?"stage_orangeIcon":R>25?"stage_yellowIcon":"stage_greenIcon"}(!returnJson.entityMapJson.CLOSINGDATE||"true"===returnJson.entityMapJson.CLOSINGDATE.readonly||!returnJson.entityMapJson.CLOSINGDATE.defaultvalue||detailView.changedBCJson&&detailView.changedBCJson.hidden&&!detailView.changedBCJson.hidden.SECURITY_EDIT_ALLOWED||"false"===String(allowEditProf))&&(b=!0,returnJson.entityMapJson.CLOSINGDATE&&returnJson.entityMapJson.CLOSINGDATE.defaultvalue||(w=!1))}if("Closed Won"===a[g].fctype){var P={name:a[g].content,val:a[g].pbty+":"+a[g].content,selectedStepItem:a[g].selectedStepItem};L="Closed",i.colorcode_enabled&&(P.colorCode=a[g].colorCode),y.push(P)}else if("Closed Lost"===a[g].fctype){var I={name:a[g].content,val:a[g].pbty+":"+a[g].content,selectedStepItem:a[g].selectedStepItem};L="Omitted",i.colorcode_enabled&&(I.colorCode=a[g].colorCode),v.push(I)}a[g].name&&(i.colorcode_enabled?h.push({name:a[g].content,val:a[g].pbty+":"+a[g].content,fccat:L||a[g].fctype,selectedStepItem:a[g].selectedStepItem,colorCode:a[g].colorCode}):h.push({name:a[g].content,val:a[g].pbty+":"+a[g].content,fccat:L||a[g].fctype,selectedStepItem:a[g].selectedStepItem}))}else C=!0}i.colorcode_enabled&&e.addClass("colorEnableDetailviewStage"),-1===_&&(_=s,_=C?s-1:s,h.push({name:i.plainValue,val:i.defaultvalue,fccat:"",colorCode:i.color_code}));var S=$L("#nbaDetails");S&&"Open"!==h[_].fccat&&S.hide();var M=y.length>0,k=v.length>0,T=M&&k,E="";if(returnJson.Potentials.disableStageNavigator&&(M=!1,k=!1,E=detailView.disableNavigatorMsg),(detailView.changedBCJson&&detailView.changedBCJson.hidden&&!detailView.changedBCJson.hidden.SECURITY_EDIT_ALLOWED||"false"===String(allowEditProf))&&(D=!0),0===$("crm-stage-detailview").length)Lyte.Component.render("crm-stage-detailview",{stepBigArray:h,closedWonArray:y,closedLostArray:v,closingDate:$("#value_CLOSINGDATE").text(),createdTime:t,selectIndex:_,index:_>=5?_:0,closedWonNeed:M,closedLostNeed:k,tootTip:E,dateICON:r,noDateEdit:b,closingDateNeed:w,noStageEdit:D,thumpsNeed:T},"#stageContain");else{var A=$("#value_CLOSINGDATE").text(),F=$L("crm-stage-detailview").e[0],U=$L(".stageMenuDropdownLyte .stageMenuDropdownLyteItem");F.component.setData("selectIndex",_),F.component.setData("closingDate",A),F.component.setData("dateICON",r),F.component.setData("closedWonArray",y),F.component.setData("closedLostArray",v),F.component.setData("closingDateNeed",w),U.removeClass("stageStepItemSelected"),U.eq(_).addClass("stageStepItemSelected"),setTimeout((function(){Lyte.registeredMixins["crm-detail-view-utils"].scrollStageComponent($L(".stage-step-containerDivParent .stage-step-item.lyteActive"))}),50),$("#stageIndicator_CLOSINGDATE").text(A)}}},scrollStageComponent:function(e){if(e.length>0){var t=e.closest(".stage-step-containerDivParent"),r=e.prev(),i=r.length?r.position().left:e.position().left,a=t.scrollLeft();t.animate({scrollLeft:i+a},1e3),setTimeout((function(){Lyte.registeredMixins["crm-detail-view-utils"].setDisableForNextPrev()}),1050)}},setDisableForNextPrev:function(){var e,t=$L(".stage-step-container-lytestep"),r=$L(".stage-step-containerDivParent");e=Crm.userDetails.RTL_ENABLED?-r.scrollLeft():r.scrollLeft();var i,a=r.outerWidth(),s=t.find(".stage-backward-cont"),o=t.find(".stage-forward-cont"),n=r.find(".stage-step-item"),l=n.length,c=0;for(i=0;i<l;i++)c+=$L(n[i]).outerWidth();c=Math.round(c),e<=0?(o.removeClass("eventNone").addClass("stageRightShadow"),s.addClass("eventNone").removeClass("stageLeftShadow")):c<=e+a+4?(s.removeClass("eventNone").addClass("stageLeftShadow"),o.addClass("eventNone").removeClass("stageRightShadow")):(s.removeClass("eventNone").addClass("stageLeftShadow"),o.removeClass("eventNone").addClass("stageRightShadow"))}}),Lyte.Mixin.register("crm-cloud-picker-mixin",{loadCloudPicker:function(e){var t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("cloudpicker")]),r=networkUtils.returnDependencyFiles(["crmcloudpicker.js"],crmConstants.jsStaticPathForLyte),i=t.concat(r);Lyte.injectResources(i,void 0,(function(){Lyte.Component.render("crm-cloud-picker",{options:e,showCloudPicker:!0},"#show")}))}}),Lyte.Mixin.register("segmentation-utils",{getFeatureRelatedErrorMsg:function(e,t,r,i,a){if("INTERNAL_ERROR"===e)return I18n.getMsg("crm.label.cf.error.internal");if("FEATURE_NOT_SUPPORTED"===e)return I18n.getMsg("crm.segmentation.feature.unavailable");if("LIMIT_EXCEEDED"===e){if(t.resource&&"fields"===t.resource.type)return I18n.getMsg("crm.segmentation.free.cf.unavailable");if(t.module)return I18n.getMsg("crm.segmentation.publish.module.duplicates");if("publish"===t.type)return I18n.getMsg("crm.segmentation.publish.limit.exceed");if("draft"===t.type)return I18n.getMsg("crm.segmentation.draft.limit.exceed")}return"DAILY_LIMIT_EXCEEDED"===e?I18n.getMsg("crm.segmentation.publish.republish.limit.exceed"):this.getApiKeysVsErrorMsg.call(this,e,t,r,i,a)},getApiKeysVsErrorMsg:function(e,t,r,i,a){if(t.resource){var s=t.resource[0];return i===s.api_name+" API Name already exists. Please disable translation and change the API Name and after that create the Segmentation process."?I18n.getMsg("crm.segmentation.cf.api.name.duplicate.translation",[s.api_name]):i===s.api_name+" API Name and field label already exists. Please disable translation and change the API Name, field label and after that create the Segmentation process."?I18n.getMsg("crm.segmentation.cf.name.field.duplicate.translation",[s.api_name]):i===s.api_name+" field label already exists. Please disable translation and change the Field Label and after that create the Segmentation process."?I18n.getMsg("crm.segmentation.cf.field.label.duplicate.translation",[s.api_name]):this.getCustomFieldError(s.api_name,s)}if(t.resource_path_index)return i;if("name"===t.api_name&&!t.parent_api_name)return"DUPLICATE_DATA"===e?I18n.getMsg("crm.segmentation.segment.duplicate"):I18n.getMsg("crm.segmentation.name.blank",I18n.getMsg("crm.segmentation.name.title"));if("api_name"===t.api_name||"id"===t.api_name){if("INVALID_DATA"===e){if(t.json_path.indexOf("link_field")>0)return I18n.getMsg("crm.segmentation.link.field.err");if(t.json_path.indexOf("recency_field.")>0)return I18n.getMsg("crm.segmentation.recency.field.required");if(t.json_path.indexOf("frequency_field.")>0)return I18n.getMsg("crm.segmentation.frequency.field.required");if(t.json_path.indexOf("monetary_field.")>0)return I18n.getMsg("crm.segmentation.monetary.field.required");if(t.json_path.indexOf("link_module.")>0)return I18n.getMsg("crm.segmentation.link.module.required");if(t.json_path.indexOf("module.")>0)return I18n.getMsg("crm.segmentation.module.required")}}else if("score_details"===t.api_name){if(["MANDATORY_NOT_FOUND","DEPENDENT_FIELD_MISSING"].contains(e))return I18n.getMsg("crm.segmentation.criterias.missing");if("INVALID_DATA"===e&&t.length)return I18n.getMsg("crm.segmentation.criteria.count.mismatch")}else if("status"===t.api_name){if("INVALID_DATA"===e)return I18n.getMsg("crm.segmentation.deactivation.error")}else if("labels"===t.api_name){if("INVALID_DATA"===e&&t.minimum_length&&t.maximum_length)return I18n.getMsg("crm.segmentation.label.count")}else{if("labels"===t.parent_api_name)return this.validateLabels.call(this,r.labels,r.max_score);if("CANNOT_PROCESS"===e&&"delete"===a)return I18n.getMsg("crm.segmentation.custom.field.dependency")}},getCustomFieldError:function(e,t){return 2===t._change.length?I18n.getMsg("crm.segmentation.cf.name.field.duplicate",[e]):"api_name"===t._change[0]?I18n.getMsg("crm.segmentation.cf.api.name.duplicate",[e]):I18n.getMsg("crm.segmentation.cf.field.label.duplicate",[I18n.getMsg(e)])},validateLabels:function(e,t){for(var r=e.length,i=[],a=[],s=[],o=[],n=[],l=[],c=[],d=0;d<r;d++){var u=e[d],m=u.name;if(c[d]=m,i[d]=this.getMinValue(u.recency),a[d]=this.getMaxValue(u.recency),i!==a&&i>a)return I18n.getMsg("crm.segmentation.label.invalid.score",[c[d],I18n.getMsg("crm.segmentation.recency")]);if(i>t&&a>t)return I18n.getMsg("crm.segmentation.label.invalid.score.range",[c[d],I18n.getMsg("crm.segmentation.recency")]);if(s[d]=this.getMinValue(u.frequency),o[d]=this.getMaxValue(u.frequency),s!==o&&s>o)return I18n.getMsg("crm.segmentation.label.invalid.score",[c[d],I18n.getMsg("crm.segmentation.frequency")]);if(s>t&&o>t)return I18n.getMsg("crm.segmentation.label.invalid.score.range",[c[d],I18n.getMsg("crm.segmentation.frequency")]);if(n[d]=this.getMinValue(u.monetary),l[d]=this.getMaxValue(u.monetary),n!==l&&n>l)return I18n.getMsg("crm.segmentation.label.invalid.score",[c[d],I18n.getMsg("crm.segmentation.monetary")]);if(n>t&&l>t)return I18n.getMsg("crm.segmentation.label.invalid.score.range",[c[d],I18n.getMsg("crm.segmentation.monetary")])}for(d=0;d<r;d++)for(var p=d+1;p<r;p++){var g=!1,f=!1,h=!1;if((i[p]>=i[d]&&i[p]<=a[d]||a[p]>=i[d]&&a[p]<=a[d])&&(g=!0),(s[p]>=s[d]&&s[p]<=o[d]||o[p]>=s[d]&&o[p]<=o[d])&&(f=!0),(n[p]>=n[d]&&n[p]<=l[d]||l[p]>=n[d]&&l[p]<=l[d])&&(h=!0),c[d].trim()===c[p].trim())return I18n.getMsg("crm.segemnt.label.name.exist",[c[d]]);if(""===c[d].trim())return I18n.getMsg("crm.segmentation.label.name.empty");if(g&&f&&h)return I18n.getMsg("crm.segment.duplicate.label")}},getSegmentStatusForApi:function(e){return{published:"published",publishedInactive:"inactive",drafted:"draft"}[e]},getSegmentStatus:function(e){return{published:"published",inactive:"publishedInactive",draft:"drafted"}[e]},showSegmentsList:function(){store.unloadAll("segments");var e=getElemById("createSegment");e&&e.setData("isSegmentCreated",!1),Lyte.Router.transitionTo({route:"crm.settings.section.segmentation.index"})},removeErrorMsg:function(e,t,r){document.getElementsByClassName(e)[0].classList.add("dN"),document.getElementsByClassName(t)[0].classList.remove(r)},showErrorMsg:function(e,t,r){document.getElementsByClassName(e)[0].classList.remove("dN"),(t=document.getElementsByClassName(t)[0]).classList.add(r),t.focus()},getMinValue:function(e){var t=e,r=e.indexOf("-");return-1!==r&&(t=e.substring(0,r)),t},getMaxValue:function(e){var t=e,r=e.indexOf("-");return-1!==r&&(t=e.substring(r+1)),t},saveSegmentation:function(e,t,r,i){var a,s,o=store.peekRecord("segments",e);o.$.set("status",t?"published":"drafted"),commonUtils.showHideLoadingDiv(!0),o.$.save({isCriteriaModified:i.getData("isCriteriaModified")}).then((function(){if(o.slider_details=[],i.showSegmentsList(),a=I18n.getMsg("crm.segmentation.success.draft",[o.module.plural_label]),(s=i.getRecordById(store.peekAll("module"),o.module.id))&&moduleRecordMapping[s[0].module_name]&&(store.peekRecord("module",moduleRecordMapping[s[0].module_name].id).fields=void 0),commonUtils.showHideLoadingDiv(!1),t&&!r)return a='<div class="mB5 crm-font-bold">'+I18n.getMsg("crm.segmentation.success.create.heading")+'</div><div class="mB5">'+I18n.getMsg("crm.segmentation.success.create1",o.module.plural_label)+"</div>"+I18n.getMsg("crm.segmentation.success.create2",o.module.plural_label),void _cruxUtils.showCustomMessage({params:{ltPropMessage:a,ltPropYield:!0,ltPropDuration:"6000"}});r&&(a=I18n.getMsg("crm.segmentation.success.update")),i.showAlertBox("success",a)}),(function(e){commonUtils.showHideLoadingDiv(!1),o.$.rollBackAttributes("status"),i.setData("isBtnDisable",!1);var t=JSON.parse(e.response),r=t.segmentations?t.segmentations[0]:t,a=i.getFeatureRelatedErrorMsg.call(i,r.code,r.details,o,r.message);i.showAlertBox("error",a||r.message)}))},rfmSliderHandlerValues:function(e){return this.getRFMSliderDivision(5,e)},getRFMSliderDivision:function(e,t){var r,i=[],a=r=3===e?35:100/e,s=1;for(e-=1;e;){var o={};o.value=a,a+=r,o.class="rfmRanger some1 rfm_multiSliderState",o.id=t+s,s++,i.push(o),e--}return i[0].min=5,i[i.length-1].max=95,i},showAlertBox:function(e,t,r){var i=document.getElementById("segmentationAlertBox");if(r=r||4e3,!i){var a=document.createElement("lyte-messagebox");a.set("id","segmentationAlertBox"),document.getElementById("setupshow").appendChild(a),i=a}i.ltProp({type:e,message:t,duration:r,transition:{animation:"slideFromTop"},show:!0})},showNoResultInSerach:function(e){e.length>0?this.setData("showNoResult",!1):this.setData("showNoResult",!0)},resetSearchText:function(e){var t=getElemById(e);t&&t.setValue("")},validateName:function(e){return!/[\^~`#%^&*+={}[\]|;"<>\\]+/g.test(e)},unloadComputeModel:function(e){var t=getElemById("segmentScore").component,r=store.peekRecord("segments",this.getData("segmentId"));if("ALL"===e)r.slider_details=[],t.setData({showRecencyFromToRange:!1,showFrequencyFromToRange:!1,showMonetaryFromToRange:!1,showRecencyComputed:!1,showFrequencyComputed:!1,showMonetaryComputed:!1});else{if(r.slider_details)for(var i=r.slider_details.length,a=0;a<i;a++)if(r.slider_details[a].score_type===e){r.slider_details.splice(a,1);break}var s=e.charAt(0).toLocaleUpperCase()+e.slice(1).toLowerCase();t.setData("show"+s+"FromToRange",!1)}switch(t.setData("disableCompute",!1),t.setData("isCompute",!0),t.setData("showRecencyPopUp",!1),t.setData("showFrequencyPopUp",!1),t.setData("showMonetaryPopUp",!1),e){case"recency":t.setData("showRecencyComputed",!1);break;case"frequency":t.setData("showFrequencyComputed",!1);break;case"monetary":t.setData("showMonetaryComputed",!1)}},checkDuplicateSegmentName:function(e,t){if(t)var r=store.peekAll("segments").filter((function(e){return t!==e.id})).map((function(e){return e.name.toLocaleLowerCase()}));else r=store.peekAll("segments").map((function(e){return e.name.toLocaleLowerCase()}));return r.contains(e.toLocaleLowerCase().trim())},getSegmentationDetails:function(e,t,r){var i=!1;r&&(r.isProductionDiff||r.isSandboxDiff)&&(i=!0);var a=this;return store.unloadAll("segments"),(i?store.findRecord("segments",e,null,!1,!1,r):store.findRecord("segments",e)).then((function(s){var o=i?s.hasOwnProperty("segments")?s.segments[0]:null:store.peekRecord("segments",e);if(!(r&&r.isFromSandbox||!o||"publishedInactive"!==o.status))return{noPermission:!0,heading:"crm.segment.access.denied",msg:I18n.getMsg("crm.segmentation.no.permission.deactivated",[o.name]),noNeedI18N:!0};if(!o)return{noPermission:!0,heading:"crm.segmentation.deleted.access",msg:"crm.segmentation.no.permission.deleted"};if(o.labels.forEach((function(e){e.rMin=a.getMinValue(e.recency),e.rMax=a.getMaxValue(e.recency),e.fMin=a.getMinValue(e.frequency),e.fMax=a.getMaxValue(e.frequency),e.mMin=a.getMinValue(e.monetary),e.mMax=a.getMaxValue(e.monetary)})),t)return commonUtils.showHideLoadingDiv(!1),{labels:o.labels,segment:o,isEdit:!0,segmentId:e,isLabelsEdit:t};var n={segmentId:o.id,segmentName:o.name};return i?store.findAll("module",null,!1,!1,r).then((function(e){return commonUtils.showHideLoadingDiv(!1),n.segmentModuleDetails=a.getRecordById(e.module,o.module.id)[0],n.lookUpModuleDetails=a.getRecordById(e.module,o.link_module.id)[0],a.populateSegmentFields(n,o,i,r)}),(function(e){commonUtils.showHideLoadingDiv(!1);var t=JSON.parse(e.response);a.showAlertBox("warning",I18n.getMsg(t.message))})):(n.segmentModuleDetails=store.peekRecord("module",o.module.id),n.lookUpModuleDetails=store.peekRecord("module",o.link_module.id),a.populateSegmentFields(n,o,i,r))}),(function(e){var t=JSON.parse(e.response);if("NOT_SUPPORTED_FEATURE"===t.code||"NO_PERMISSION"===t.code||"INVALID_MODULE"===t.code)return{noPermission:!0,msg:"crm.security.error"}}))},populateSegmentFields:function(e,t,r,i){if(e.segmentModuleDetails&&e.lookUpModuleDetails&&e.segmentModuleDetails.visible&&e.lookUpModuleDetails.visible){var a=this,s=e.segmentModuleDetails.plural_label;e.allModulesArray=[e.segmentModuleDetails.api_name,e.lookUpModuleDetails.api_name],e.segmentAndLookupModule=s,e.isCreate=!1,e.viewCriClass="",e.addCriClass="dN",e.linkingField=t.link_field,e.recencyField=t.recency_field,e.frequencyField=t.frequency_field,e.status=t.status,e.monetaryField=t.monetary_field,e.score=t.max_score,e.rangeMax=e.score;var o=t.global_criteria;o?(e.setGlobalCriteria=o,e.isBasedOnCriteria=!0,e.isBasedOnAllRecords=!1):(e.isBasedOnCriteria=!1,e.isBasedOnAllRecords=!0),t.link_module_criteria?(e.setConCriteria=t.link_module_criteria,e.hasContrubuteModuleCriteria=!0,e.contributeModuleAllRecords=!1):(e.hasContrubuteModuleCriteria=!1,e.contributeModuleAllRecords=!0),e.byManual="manual"===t.score_type,e.automatic="automatic"===t.score_type,e.criteriaType="automatic"===t.score_type?I18n.getMsg("crm.dumprequest.automatic"):I18n.getMsg("crm.dumprequest.manual"),e.isFrequencyBasedOnField="$Count_Of"!==e.frequencyField.api_name,e.isFrequencyBasedOnField&&(e.showFrequencyDropDown=!0),e.isFrequencyBasedOnCount=!e.isFrequencyBasedOnField,e.isEdit=!0,e.isEditCompute=!0,"published"===e.status?(e.showRecencyComputed=!0,e.showFrequencyComputed=!0,e.showMonetaryComputed=!0):(e.showRecencyComputed=!1,e.showFrequencyComputed=!1,e.showMonetaryComputed=!1),e.computeToolTip=I18n.getMsg("crm.segmentation.compute.tooltip2"),e.scoreSliderValue=[{value:e.score,min:3,max:5,id:"scoreSlider",class:"scoreSlider"}],e.labels=t.labels,e.segmentLabels=e.labels.length;var n=[];t.score_details.forEach((function(e){n.push(e)})),e.recRangeArr=[],e.freqRangeArr=[],e.monRangeArr=[],e.rSliderDivision=[],e.fSliderDivision=[],e.mSliderDivision=[];var l=1,c=n.length;if(e.automatic)for(var d=0;d<c;d++){var u=n[d],m={};-1!==["recency","frequency","monetary"].indexOf(u.type)&&u.score!==e.score&&(m.value=u.criteria.max,m.class="rfmRanger some1",m.id=u.type+l,1===u.score?m.min=5:u.score===e.score-1&&(m.max=95),"recency"===u.type?e.rSliderDivision.push(m):"frequency"===u.type?e.fSliderDivision.push(m):e.mSliderDivision.push(m)),l++}else{for(var p=0;p<c;p++){"recency"===(u=n[p]).type?e.recRangeArr.push(u):"frequency"===u.type?e.freqRangeArr.push(u):e.monRangeArr.push(u)}e.recRangeArr=$u.sortBy(e.recRangeArr,"score").reverse(),e.freqRangeArr=$u.sortBy(e.freqRangeArr,"score").reverse(),e.monRangeArr=$u.sortBy(e.monRangeArr,"score").reverse()}if(r){var g=i;return g.apiVersion=this.getNewApiVersion().apiVersion,Lyte.resolvePromises([store.findAll("field",{module:e.segmentModuleDetails.api_name,type:"all"},!1,!1,g),store.findAll("field",{module:e.lookUpModuleDetails.api_name,type:"all"},!1,!1,g)]).then((function(i){var a=i[0].field,s=i[1].field,o=a.concat(s);return e.newSegment=t,{segmentRecord:e,segmentedModuleFields:a,lookUpModuleFields:s,segmentId:e.segmentId,isEdit:!0,cacheFields:o,noCache:r}}),(function(e){commonUtils.showHideLoadingDiv(!1);var t=JSON.parse(e.response);a.showAlertBox("warning",I18n.getMsg(t.message))}))}var f=this.getNewApiVersion(),h=[store.findAll("field",{module:e.segmentModuleDetails.api_name,type:"all"},!1,!0,f),store.findAll("field",{module:e.lookUpModuleDetails.api_name,type:"all"},!1,!0,f)];if("published"===e.status&&e.automatic){var y={compute:[{segmentation:{id:e.segmentId}}]};h.push(store.triggerAction("segments","compute",y,null,"POST"))}return Lyte.resolvePromises(h).then((function(i){commonUtils.showHideLoadingDiv(!1);var a=i[0],s=i[1];return e.newSegment=t,t.slider_details=i[2]&&i[2].compute?i[2].compute:[],{segmentRecord:e,segmentedModuleFields:a,lookUpModuleFields:s,segmentId:e.segmentId,isEdit:!0,cacheFields:null,noCache:r}}),(function(e){commonUtils.showHideLoadingDiv(!1);var t=JSON.parse(e.response);if("NO_PERMISSION"===t.code)return{noPermission:!0,heading:"crm.social.setup.denied",msg:"crm.segmentation.hidden.module"};a.showAlertBox("warning",I18n.getMsg(t.message))}))}return{noPermission:!0,heading:"crm.social.setup.denied",msg:"crm.segmentation.hidden.module"}},populateSegmentationDetails:function(e,t){if(e.noPermission||t)return e;var r,i=[],a=[],s=[],o=[],n=e.segmentRecord,l=e.lookUpModuleFields;l&&(r=(l=l.filter((e=>null===e.crypt))).length);for(var c=[CrmField.UITYPES.LOOK_UP_ENTITY,CrmField.UITYPES.CONTACT_ID,CrmField.UITYPES.CONTACT_LOOKUP,CrmField.UITYPES.ACCOUNT_NAME_LOOKUP,CrmField.UITYPES.CAMPAIGN_NAME_LOOKUP,CrmField.UITYPES.PRODUCT_NAME_LOOKUP,CrmField.UITYPES.VENDOR_NAME_LOOKUP,CrmField.UITYPES.OWNER,CrmField.UITYPES.USERLOOKUP,CrmField.UITYPES.PRODUCT_HANDLER,46],d=0;d<r;d++)c.indexOf(l[d].ui_type)>-1&&Object.keys(l[d].lookup).length&&l[d].lookup.module&&l[d].lookup.module.api_name===n.segmentModuleDetails.api_name&&i.push(l[d]),l[d].ui_type===CrmField.UITYPES.DATE||l[d].ui_type===CrmField.UITYPES.DATE_TIME_LONG||l[d].ui_type===CrmField.UITYPES.CREATED_TIME?a.push(l[d]):([CrmField.UITYPES.FORMULA,CrmField.UITYPES.AGGREGATE_FIELD].includes(l[d].ui_type)&&"currency"===l[d].formula.return_type||l[d].ui_type===CrmField.UITYPES.CURRENCY||l[d].ui_type===CrmField.UITYPES.CURRENCY_ROUND_OFF||l[d].ui_type===CrmField.UITYPES.CURRENCY_ROUND_DOWN||l[d].ui_type===CrmField.UITYPES.CURRENCY_ROUND_UP)&&s.push(l[d]);var u={};u.recencyFields=a,u.monetaryFields=s,u.lookUpFields=i,u.linkingModuleFields=l,n.conModuleFields=l,n.segModuleFields=e.segmentedModuleFields.filter((function(e){if(0!==e.show_type&&-1===["Recency","Frequency","Monetary","Segment_Label"].indexOf(e.api_name))return!0}));var m=n.segModuleFields.length;for(d=0;d<m;d++)null!==n.segModuleFields[d].crypt||n.segModuleFields[d].ui_type!==CrmField.UITYPES.NUMERIC_FIELD||["Recency","Frequency","Monetary"].indexOf(n.segModuleFields[d].field_label)>-1||o.push(n.segModuleFields[d]);o.length&&(u.frequencyFields=o);var p=[{module:n.lookUpModuleDetails.api_name,fields:l},{module:n.segModuleFields.api_name,fields:n.segModuleFields}];u.allFieldsList=p,n.editSegmentDetails=u,n.globalCriteriaFields=p,e.cacheFields?(n.lookUpFieldDetails=this.getRecordById(e.cacheFields,n.linkingField.id)[0],n.recencyCriField=this.getRecordById(e.cacheFields,n.recencyField.id),n.monetaryCriField=this.getRecordById(e.cacheFields,n.monetaryField.id)):(n.lookUpFieldDetails=store.peekRecord("field",n.linkingField.id),n.recencyCriField=[store.peekRecord("field",n.recencyField.id)],n.monetaryCriField=[store.peekRecord("field",n.monetaryField.id)]);var g={api_name:"$Count_Of",id:null};if(g.field_label=I18n.getMsg("crm.dashboard.funnel.count.of",[n.lookUpModuleDetails.plural_label]),g.display_label=g.field_label,g.ui_type=CrmField.UITYPES.NUMERIC_FIELD,g.json_type="integer",g.data_type="integer",g.visible=!0,n.isFrequencyBasedOnCount)n.frequencyCriField=[],n.frequencyCriField.push(g),n.customFrequencyCriField=n.frequencyCriField;else{e.cacheFields?n.frequencyCriField=this.getRecordById(e.cacheFields,n.frequencyField.id):n.frequencyCriField=[store.peekRecord("field",n.frequencyField.id)];var f=n.conModuleFields.length;for(d=0;d<f;d++){if([CrmField.UITYPES.CURRENCY,CrmField.UITYPES.CURRENCY_ROUND_OFF,CrmField.UITYPES.CURRENCY_ROUND_DOWN,CrmField.UITYPES.CURRENCY_ROUND_UP,77].indexOf(n.conModuleFields[d].ui_type)>-1){n.customFrequencyCriField=[],n.customFrequencyCriField.push(g);break}}}return n.noCache=e.noCache,e.segmentRecord},getRecordById:function(e,t){return e.filter((function(e){return e.id===t}))},getAssociationsObj:function(e,t,r,i,a){for(var s=e.length,o={},n=0;n<s;n++){e[n].type="workflow_field_update"===e[n].type?"field_update":e[n].type,e[n].type=e[n].action?e[n].type+"_"+e[n].action:e[n].type;var l=r.getData("associationConstants");t.indexOf(e[n].type)>-1?(e[n].dynamicParam=l[e[n].type].dynamicParam?0!==l[e[n].type].dynamicParam.length?[i]:[]:void 0,"email_template"===e[n].type||"inventory"===e[n].type?(e[n].queryParam=objectUtils.cloneObject(l[e[n].type].queryParam),e[n].queryParam.templateId=e[n].id,e[n].queryParam.module&&(e[n].queryParam.module=i)):"lookup_filter_criteria"===e[n].type?e[n].dynamicParam.push(a):e[n].dynamicParam&&e[n].rule_id?e[n].dynamicParam.push(e[n].rule_id):e[n].dynamicParam&&-1===["custom_button","layout_rule","formula_field"].indexOf(e[n].type)?e[n].dynamicParam.push(e[n].id):"canvas_rules"===e[n].type&&(e[n].queryParam={ruleId:e[n].id}),l[e[n].type].queryParam&&l[e[n].type].queryParam.module&&(e[n].queryParam?e[n].queryParam.module=i:e[n].queryParam={module:i}),o[e[n].type]?o[e[n].type].items.push(e[n]):(o[e[n].type]={},o[e[n].type].items=new Array(e[n]),Lyte.objectUtils(o[e[n].type],"add",l[e[n].type]))):"layouts"!==e[n].type&&(o[e[n].type]?o[e[n].type].items.push(e[n]):(o[e[n].type]={},o[e[n].type].items=new Array(e[n]),Lyte.objectUtils(o[e[n].type],"add",l[e[n].type])))}return o},getSliderDetailsForType:function(e,t){for(var r=e.length,i=0;i<r;i++)if(e[i].type===t)return e[i]},createSegmentationCriteria:function(e,t,r){var i=[];for(let s=t;s>0;s--){var a=store.createRecord("segment_criteria");a.$.set("type",e),a.$.set("score",s),a.$.set("segments",store.peekRecord("segments",r)),i.push(a)}return i},resetSegmentationCriteria:function(e,t){var r=e.length;for(let s=0;s<r;s++){var i=this.getCrietriaArrayForType(e[s],t),a=i.length;for(let e=0;e<a;e++)i[e].criteria&&i[e].$.set("criteria",void 0)}},checkAllCriteriaEntered:function(e){var t=e.length,r=!0;for(let i=0;i<t;i++)if(!e[i].criteria){r=!1;break}return r},checkCriteriaEntered:function(e){var t=e.length,r=!1;for(let i=0;i<t;i++)if(e[i].criteria){r=!0;break}return r},getCrietriaArrayForType:function(e,t){return store.peekRecord("segments",t).score_details.filter((function(t){if(t.type===e)return!0}))},getValueForPercentile:function(e,t){var r=e.length;for(let i=0;i<r;i++)if(e[i].percentile===t)return e[i].value},getUsersForScore:function(e,t){var r=e.length;for(let i=0;i<r;i++)if(e[i].score===t)return e[i].users_count},editFrequencyCriteria:function(e,t,r){let i=e.length;for(let a=0;a<i;a++)"frequency"===e[a].type&&this.changeFieldsValue(e[a].criteria,t,r);return e},changeFieldsValue:function(e,t,r){var i=e.group;if(i){let e=i.length;for(let a=0;a<e;a++)this.changeFieldsValue(i[a],t,r)}else e.field.api_name=t,e.field.id=r},getFieldDetailsFromCriteria:function(e){var t={},r=e.group;if(r){let e=r.length;for(let a=0;a<e;a++){var i=this.getFieldDetailsFromCriteria(r[a]);if(i){t=i;break}}}else t.api_name=e.field.api_name,t.id=e.field.id;return t},getRecordByScore:function(e,t){var r=e.length;for(let i=0;i<r;i++)if(e[i].score===t)return e[i]},addOrDeleteCriteria:function(e,t,r,i){var a=i.getCrietriaArrayForType("recency",r),s=i.getCrietriaArrayForType("frequency",r),o=i.getCrietriaArrayForType("monetary",r);if(e!==t&&a.length!==t){var n=a.length;if(e<t)for(var l=n;l<t;l++){var c=l+1;store.createRecord("segment_criteria",{score:c,type:"recency",segments:store.peekRecord("segments",r)}),store.createRecord("segment_criteria",{score:c,type:"frequency",segments:store.peekRecord("segments",r)}),store.createRecord("segment_criteria",{score:c,type:"monetary",segments:store.peekRecord("segments",r)})}else for(l=n;l>t;l--){var d=[];d.push(i.getRecordByScore(a,l).id),d.push(i.getRecordByScore(s,l).id),d.push(i.getRecordByScore(o,l).id),store.deleteMany("segment_criteria",d)}}},removeOldValues:function(e){for(var t=e.length,r=0;r<t;r++)(e[r].hasOwnProperty("_delete")||e[r].$&&"removed"==e[r].$.partialType)&&(e.removeFirstOccurenceOfElement(e[r]),t--,r--);return e},resetAllManualCriteria:function(e,t,r,i){for(var a=e.concat(t).concat(r),s=a.length,o=0;o<s;o++){var n=store.createRecord("segment_criteria");n.$.set("type",a[o].type),n.$.set("score",a[o].score),n.$.set("criteria",a[o].criteria),n.$.set("segments",i),store.unloadRecord("segment_criteria",a[o].id)}},fillAutomaticCriteria:function(e,t){var r=e.length,i=!1;for(let c=0;c<r;c++){var a=e[c].score,s=e[c].type,o=t.score_details,n=o?o.filterBy({score:a}).filterBy({type:s}):[];if(1===n.length){var l=n[0];JSON.stringify(l.criteria)!==JSON.stringify(e[c].criteria)&&(i=!0),l.$.set("type",s),l.$.set("score",a),l.$.set("criteria",e[c].criteria)}else(n=store.createRecord("segment_criteria")).$.set("type",s),n.$.set("score",a),n.$.set("criteria",e[c].criteria),n.$.set("segments",t)}return i},pauseTheTransaction:function(e){var t=e.pause();return Lyte.Component.render("crm-segment-confirmation",{cancelButton:I18n.getMsg("crm.admin.email.sharing.confirmation.message2"),proceedButton:I18n.getMsg("crm.button.yes.move.away"),heading:I18n.getMsg("crm.event.layout.leavepage.confirm.message2"),message:I18n.getMsg("crm.cancel.segment")},"#result").setMethods({callBackMethod:function(){store.unloadAll("segments"),t.resume()},callCancelMethod:function(){t.abort()}}),!1},filterSliderDetails:function(e,t){if(t)for(var r=t.length,i=0;i<r;i++)if(t[i].score_type===e)return t[i]},checkValueExist:function(e,t){if(e)for(var r=e.length,i=0;i<r;i++)if(e[i].score_type===t)return!0;return!1},getNewApiVersion:function(){return{apiVersion:"2.2"}},getLabelsDefaultLength:function(e){return 4===e||5===e?8:6},removeUnwantedCriteriaRecords:function(e){return e.filter((function(e){return 1!==Object.keys(e).length||"removed"!==e.$.partialType||(e.$.deleteRecord(),!1)}))},getDefaultStageCriteria:function(e){var t=this.getStageFieldApiName(),r=e.find((e=>e.api_name===t));return{comparator:"equal",field:{api_name:t,id:r.id,data_type:r.data_type},value:"${CLOSEDWON}"}},checkStageFieldPermission:function(e){var t=this.getStageFieldApiName(),r=e.find((e=>e.api_name===t)).profiles.find((e=>e.name===Crm.userDetails.PROFILE_NAME));return r&&"hidden"!==r.permission_type},maxLookupLimit:function(){return 5},countLookupFieldsCount:function(e,t){var r=$L("#"+e),i=$L("#"+t);this.setData("lookUpFieldsInCriteria",[]),r.length&&this.countLookUpFields(r[0].component.data.setCriteriaObj),i.length&&this.countLookUpFields(i[0].component.data.setCriteriaObj)},countLookUpFields:function(e){var t,r;if(!e)return 0;e.forEach((e=>{t=this.getData("lookUpFieldsInCriteria"),r=store.peekRecord("field",e.field.id),"lookup"!==CrmField.getDataType(r.ui_type)||t.includes(r.id)||Lyte.arrayUtils(t,"push",r.id)})),t=this.getData("lookUpFieldsInCriteria"),Lyte.arrayUtils(t,"splice",0,t.length,t)},getStageFieldApiName:function(){return"Stage"}}),Lyte.Mixin.register("crm-vision-create",{actions:{onmouseleave:function(e){return crmui.hideTooltip(e)},onmouseenter:function(e,t){var r,i=$L(t)[0].component;if("summaryToolTip"===e){var a=i.getData("viewVisions"),s=I18n.getMsg("crm.module.createdby")+" : "+a.created_by.name+" "+I18n.getMsg("crm.zia.vision.on")+" "+Lyte.Component.registeredHelpers.getLastModified(a.created_time)+" "+Lyte.Component.registeredHelpers.getLocaleTimeString(a.created_time)+",<br>"+I18n.getMsg("crm.module.modifiedby")+" : "+a.modified_by.name+" "+I18n.getMsg("crm.zia.vision.on")+" "+Lyte.Component.registeredHelpers.getLastModified(a.modified_time)+" "+Lyte.Component.registeredHelpers.getLocaleTimeString(a.modified_time);return crmui.showTooltip({content:s,isHTML:!0,position:"left"})}switch(e){case"limit":r=I18n.getMsg("crm.zia.vision.max.limit",i.getData("maxLimit"));break;case"fail":r=I18n.getMsg("crm.zia.vision.model.fail.msg");break;case"gallery":r=I18n.getMsg("crm.zia.vision.gallery.message")}return crmui.showTooltip(r)},onmouseover:function(e){var t;switch(e){case"image_approval":t=I18n.getMsg("crm.zia.vision.image.approval.msg");break;case"record_approval":t=I18n.getMsg("crm.zia.vision.record.approval.msg")}return crmui.showTooltip(t)}},labelnameValidateHighlighter(e){$L("#labelName")[0].component.validate(),$L("crm-ziavision-trainingcriteria-header")[e].component.setData("highlightLabelNameError",!0)},notAllowedSplCharChecker:function(e){var t="";if(""!==e)for(var r=new Array("!","@","#","$","%","^","&","*","(",")","_","+","=","-","`","~","'",";",",",".","/",":",'"',"<",">","?","{","}","|","[","]","\\"),i=r.length,a=0;a<i;a++)e.indexOf(r[a])>=0&&(t+=r[a]);return t},deepCopyOfAnObject:e=>JSON.parse(JSON.stringify(e)),delInCriteriaArray(e,t,r){var i,a=$L("crm-ziavision-trainingdetails-criteria")[0].component,s=a.data.criteriaArray,o=s.length;if(0===e.data.files_arr.length||0===t)for(var n=0;n<o;n++){if(s[n].criteriaIndex===e.getData("criteriaindex")){Lyte.arrayUtils(a.getData("criteriaArray"),"removeAt",n,1),i=n,"label"===r&&l();break}if(s[n].criteriaIndex>e.getData("criteriaindex")){i=n,l();break}}function l(){for(var e=s.length,t=i;t<e;t++){var r=s[n];r.criteriaIndex=r.criteriaIndex-1,Lyte.arrayUtils(a.getData("criteriaArray"),"replaceAt",t,r)}}},setcriteriaTextPattern:function(){var e=$L("crm-ziavision-trainingdetails-criteria")[0].component,t=e.getData("criteriaArray");if(e.setData("criteriaTextPattern",[]),1===t.length)a();else if(2===t.length)a(),s();else if(t.length>2){a(),s();for(var r=t.length,i=3;i<=r;i++)o(i-1)}function a(){var r=t[0].labelName+" is "+t[0].type;Lyte.arrayUtils(e.getData("criteriaTextPattern"),"insertAt",0,r),Lyte.arrayUtils(e.getData("criteriaTextPattern"),"push",")"),Lyte.arrayUtils(e.getData("criteriaTextPattern"),"unshift","(")}function s(){var r=t[1].labelName+" is "+t[1].type;Lyte.arrayUtils(e.getData("criteriaTextPattern"),"insertAt",2,t[0].comparator),Lyte.arrayUtils(e.getData("criteriaTextPattern"),"insertAt",3,r)}function o(r){var i=t[r].labelName+" is "+t[r].type;Lyte.arrayUtils(e.getData("criteriaTextPattern"),"push",t[r-1].comparator),Lyte.arrayUtils(e.getData("criteriaTextPattern"),"push",i),Lyte.arrayUtils(e.getData("criteriaTextPattern"),"push",")"),Lyte.arrayUtils(e.getData("criteriaTextPattern"),"unshift","(")}t.length>0&&this.objDetGetLabels()},objDetGetLabels:function(){var e=$L("crm-ziavision-trainingcriteria-header"),t=$L("crm-ziavision-creationpage"),r=$L("crm-ziavision-trainingdetails-criteria"),i=e.length,a=t[0].component.getData("isEdit"),s=[];if(i>0)for(var o=0;o<i;o++){var n=e[o].component.data,l=[];if((f={}).name=n.label_name,n.label_id)f.id=n.label_id;else{var c=n.label_name?n.label_name.trim().toLowerCase():"";c=(c="{{".concat(c)).concat("}}"),f.reference_id=c?c.replace(/ /g,"_"):""}a&&n.api_name&&n.api_name.trim().length>0&&(f.api_name=n.api_name);var d=[];n.files_arr&&n.files_arr.length>0&&(d=n.files_arr);var u=d&&d.length>0?d.length:0;if(u>0){e[o].component.setData("visionUpload_type_error",!1);for(var m=0;m<u;m++)d[m].isDelete&&(d[m]._delete=null),delete d[m].isDelete,delete d[m].isTagAddedInEdit,l.push(d[m])}f.model_tags=l,s.push(f)}var p=r[0].component.data.removed_obj_detection_label_details;if(p&&p.length>0){var g=p.length;for(o=0;o<g;o++){var f;if(p[o].isDelete)(f={}).id=p[o].labelId,f._delete=null,s.push(f)}}var h={};h.labels=s,this.objDetGetPatternCriteria(),h.pattern_criteria=t[0].component.getData("pattern_criteria"),t[0].component.$node.getData("visions").$.set("training_details",h)},objDetGetPatternCriteria:function(){var e=$L("crm-ziavision-creationpage"),t=$L("crm-ziavision-trainingdetails-criteria")[0].component.getData("criteriaTextPattern"),r=$L("crm-ziavision-trainingcriteria-header"),i=[],a={},s=t.length;if(s>1){for(var o=0;o<s;o++)if(")"===t[o]){for(var n,l=i[i.length-1],c=[];"("!==l;)"and"!==l&&"or"!==l?c.push(d(l)):n=l,i.pop(),"("===(l=i[i.length-1])&&i.pop();i.push(u(c,n))}else i.push(t[o]);a=i[0]}function d(t){if(t.group)return t;var i={comparator:"equal",label:{}},a=!0;if(t.includes("is detected"))if(t.includes("is not detected"))t.lastIndexOf("is detected")>t.lastIndexOf("is not detected")?(s=t.lastIndexOf("is detected"),a=!0):t.lastIndexOf("is not detected")>t.lastIndexOf("is detected")&&(s=t.lastIndexOf("is not detected"),a=!1);else{var s=t.lastIndexOf("is detected");a=!0}else if(t.includes("is not detected"))if(t.includes("is detected"))t.lastIndexOf("is detected")>t.lastIndexOf("is not detected")?(s=t.lastIndexOf("is detected"),a=!0):t.lastIndexOf("is not detected")>t.lastIndexOf("is detected")&&(s=t.lastIndexOf("is not detected"),a=!1);else{s=t.lastIndexOf("is not detected");a=!1}for(var o=r.length,n=t.slice(0,s-1),l=0;l<o;l++){var c=r[l];n===c.component.data.label_name&&(c.component.data.label_id&&c.component.data.label_id.length>0&&(i.label.id=c.component.data.label_id),e[0].component.getData("isEdit")&&c.component.data.api_name&&(i.label.api_name=c.component.data.api_name))}if(!i.label.id){var d=n?n.trim().toLowerCase():"";d=(d="{{".concat(d)).concat("}}"),i.label.reference_id=d?d.replace(/ /g,"_"):""}return i.value=a?"${DETECTED}":"${NOT_DETECTED}",i}function u(e,i){var a={};return i&&(a.group_operator=i,e=e.reverse(),a.group=e),3===t.length&&1===r.length&&(a=e[0]),a}e[0].component.setData("pattern_criteria",a)},patternCriToTextPattern:function(e,t){t=t;var r=[];if(e.group)!function e(t,i,a){if(void 0!==t){i||(i={});var n=t.group_operator;if(!n&&t.label)i=s(t,a);else{var l=t.group;if(l){Lyte.arrayUtils(r,"push","(");for(var c=l.length,d=0;d<c;d++){var u={};if(0!==d&&Lyte.arrayUtils(r,"push",t.group_operator.toLowerCase()),u=e(l[d],i,n),0!==Object.keys(u).length||u.constructor!==Object){var m=o(u),p=m.labelName+" is "+m.type;Lyte.arrayUtils(r,"push",p)}}Lyte.arrayUtils(r,"push",")")}}}return i}(e);else{Lyte.arrayUtils(r,"push","(");var i=o(s(e)),a=i.labelName+" is "+i.type;Lyte.arrayUtils(r,"push",a),Lyte.arrayUtils(r,"push",")")}function s(e,t){var r={};return r.comparator=t&&t.length>0?t.toLowerCase():"",r.labelId=e.label.id,r.type="${DETECTED}"===e.value?"detected":"not detected",r}function o(e){for(var r=t.length,i=0;i<r;i++)e.labelId!==t[i].id&&e.labelId!==t[i].reference_id||(e.labelName=t[i].name,e.model_tags=t[i].model_tags);return e}return r},calculateCount:function(e){for(var t=e.length,r=0,i=0;i<t;i++)r+=e[i].count;return r},saveVision:function(e,t,r){r.setData("saveDisable",!0),r.setData("saveButtonTriggered",!0);var i={};i.module=!0===e.vision_module.api_name.includes("CustomModule")?"CustomModule":e.vision_module.api_name,i.layout=e.layout,i.validation_type=e.validation_type,i.field=void 0!==e.vision_fields?e.vision_fields.api_name:"None",i.failure_action=void 0!==e.action?e.action.key:"None",r.getData("is_gallery_selected")?i.training_data="Gallery":i.training_data="Custom Data",i.location=!1===r.getData("isEdit")?"create":"edit",Crm.client_tracking("Zia Vision SaveButton",i);var a={};return r.getData("is_gallery_selected")?(a.type="gallery",a.type="gallery"):(a.type="desktop",a.category="desktop"),Crm.client_tracking("Zia Vision Upload",a),e.$.save(t).then((function(e){var t=e.visions,i=r.getData("deleteTrigTags"),a=i.length;if(a>0)for(var s=0;s<a;s++){var o=r.getDetails(i[s],"DELETE");r.deleteUploadData(o)}commonUtils.showHideLoadingDiv(!1),Lyte.Router.transitionTo({route:"crm.settings.section.zia.vision.view",dynamicParams:[t.id]})}),(function(e){commonUtils.showHideLoadingDiv(!1),r.setData("saveDisable",!1),r.setData("saveButtonTriggered",!1);var t=JSON.parse(e.response);if(t.visions&&t.visions[0].code&&"LIMIT_EXCEEDED"===t.visions[0].code){var i=I18n.getMsg("crm.zia.vision.max.limit",t.visions[0].details.limit);r.getData("maxLimit")<store.model.visions.data.length&&(i=i+" "+I18n.getMsg("crm.zia.vision.limit.exceed")),renderingUtils.showCustomAlert(i)}else if(t.visions&&t.visions[0].code&&"NOT_ALLOWED"===t.visions[0].code&&"failure_action"===t.visions[0].details.api_name)renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.save.action.error"));else if(t.visions&&t.visions[0].code&&"INVALID_DATA"===t.visions[0].code&&"id"===t.visions[0].details.api_name&&"$.visions[0].vision.id"===t.visions[0].details.json_path)renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.access.error"));else if(t.visions&&"NO_PERMISSION"===t.visions[0].code)t.details&&t.details.permissions&&"Crm_Implied_View_Record_Image"===t.details.permissions[0]?renderingUtils.displayPermissionDenied(t):renderingUtils.displayPermissionDenied();else if(t.visions&&"NOT_ALLOWED"===t.visions[0].code&&"$.visions[0].field.id"===t.visions[0].details.json_path)renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.image.count.limit.exceed.error"));else if(!t.visions||("INVALID_FIELD"!==t.visions[0].code&&"INVALID_LAYOUT_ID"!==t.visions[0].code&&"INVALID_DATA"!==t.visions[0].code||"$.visions[0].field.id"!==t.visions[0].details.json_path)&&"$.visions[0].layout.id"!==t.visions[0].details.json_path&&"$.visions[0].criteria"!==t.visions[0].details.json_path)t.visions&&"INVALID_MODULE"===t.visions[0].code&&"$.visions[0].module.api_name"===t.visions[0].details.json_path?renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.module.invalid.error")):renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.common.error"));else{var a;a="$.visions[0].layout.id"===t.visions[0].details.json_path?"layout":"field",renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.fieldOrLayout.invalid.error",a))}}))},getFields:function(e,t){for(var r=[],i=e.length,a=store.peekAll("visions"),s=[],o=a.length-1,n=0;n<o;n++)a.hasOwnProperty(n)&&a[n].vision_module.api_name===t&&s.push(a[n].vision_fields.api_name);for(var l=0;l<i;l++){if(e.hasOwnProperty(l))if(("profileimage"===e[l].data_type||"imageupload"===e[l].data_type&&1===e[l].length)&&!0===e[l].visible)if(!s.contains(e[l].api_name))(c={}).api_name=e[l].api_name,c.id=e[l].id,c.field_label=e[l].field_label,r.push(c)}if(r.length<1){var c={field_label:"None",id:"none"};r.push(c)}return r},getModules:function(e,t,r){var i=[];if(e){var a=store.peekAll("visions");for(var s in a)a.hasOwnProperty(s)&&void 0!==a[s].vision_module&&i.push(a[s].vision_module.id)}var o=store.peekAll("module");void 0!==r&&(e?i.deleteElementAt(i.indexOf(r)):i=r);for(var n=[],l=o.length,c=["Forecasts","Emails","Visits","Activities","Tasks","Events","Calls","Services","Appointments","JobSheets","Campaigns"],d=0;d<l;d++)if((!t||o[d].viewable)&&o[d].presence_sub_menu&&o[d].visible&&-1===c.indexOf(o[d].module_name)&&"linking"!==o[d].generated_type){var u=!0;if(i.length>0){var m=i.indexOf(o[d].id);if(e)u=m<0||i.indexOf(o[d].id,m+1)<0;else u=m<0}if(u){var p={};p.module_name=o[d].module_name,p.id=o[d].id,p.api_name=o[d].api_name,p.plural_label=o[d].plural_label,n.push(p)}}return n},getImagesMixin:function(e,t,r){var i=e.newValue;if(""!==i){commonUtils.showHideLoadingDiv(!0),t.getApprovalData(i,"1","10",(function(e){commonUtils.showHideLoadingDiv(!1),void 0!==e.vision_approvals?(e.vision_approvals.length>10&&e.vision_approvals.pop(),t.data.page=e.meta.page,t.data.more_record=e.meta.more_records,"myJobs"===r&&t.setData("selectedVision.approval_count",e.meta.count),t.setData("selectedVision.approvals",e.vision_approvals),t.getApprovalImages(i,"1",e.vision_approvals)):(t.setData("selectedVision.approvals",[]),"myJobs"===r&&t.setData("selectedVision.approval_count",0)),"imageApproval"===r&&t.setData("isMultiSelected",!1)}))}},getVision:function(e){var t=store.peekRecord("visions",e);return t?!t.criteria&&null!==t.criteria||"image_validation"===t.validation_type&&(!t.desired_set&&null!==t.desired_set||!t.undesired_set&&null!==t.undesired_set)||"object_detection"===t.validation_type&&!t.training_details&&null!==t.training_details?store.findRecord("visions",e):void 0:store.findRecord("visions",e).then((function(e){return e&&e.length?store.peekRecord("module",e[0].vision_module.id).fields?void 0:store.findRecord("module",e[0].vision_module.id,void 0,void 0,void 0,{getFields:!0}):void 0}))},getAvailableNames:function(e){var t=[],r=store.peekAll("visions"),i=r.length;if(e)for(var a=0;a<i;a++)r[a].id!==e&&r[a].created_by&&t.push(r[a].name);else for(a=0;a<i;a++)r[a].created_by&&t.push(r[a].name);return t},getApprovalImages:function(e,t,r,i){function a(e){var t=e.vision_approvals,i=t.length;i>5&&(i-=1);for(var a=0;a<i;a++)if(t.hasOwnProperty(a))for(var s in r)if(r.hasOwnProperty(s)&&t[a].id===r[s].id){var o=r[s];o.image=t[a].image,Lyte.arrayUtils(r,"removeAt",s,1),Lyte.arrayUtils(r,"insertAt",s,o);break}}var s=t,o="4";return"myJobs"!==i&&(s=2*t-1,o="5"),store.triggerAction("visions","approvals_images",{id:e},{field:"image",page:s,per_page:o}).then((function(t){if(commonUtils.showHideLoadingDiv(!1),t.vision_approvals.length>0&&(a(t),t.meta.more_records&&"myJobs"!==i))return store.triggerAction("visions","approvals_images",{id:e},{field:"image",page:s+1,per_page:o}).then((function(e){commonUtils.showHideLoadingDiv(!1),e.vision_approvals.length>0&&a(e),setZiaVisionPageHeight()}),(function(e){var t=JSON.parse(e.response);t&&"NO_PERMISSION"===t.code?renderingUtils.displayPermissionDenied():renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.oops"))}));setZiaVisionPageHeight()}),(function(e){var t=JSON.parse(e.response);t&&"NO_PERMISSION"===t.code?renderingUtils.displayPermissionDenied():renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.oops"))}))},getAllFields:function(e,t,r){return Lyte.resolvePromises({module:store.findRecord("module",e,void 0,void 0,void 0,{getFields:!0}),unused:store.findAll("field",{module:t,type:"Unused"})}).then((function(e){if(e.module){var t=(void 0!==e.module.module_name?e.module:e.module[0]).fields;return e.unused&&e.unused.map((function(e){e.unused=!0,t.push(e)})),r(t)}}))},getFieldsForConfig:function(e,t){var r={resource:"zia_vision"};r.module=e;var i={};i.params=r;return networkUtils.lyteInitiateRequest("/crm/v2/definition","GET",i).then((function(r){if(r.definition){var i;i=r.definition.criteria_fields?r.definition.criteria_fields[0]:r.definition.criteriaFields[0];var a=e;for(var s in Crm.moduleInfo){if(Crm.moduleInfo.hasOwnProperty(s))if(Crm.moduleInfo[s].sysRefName===e){a=s;break}}for(var o=(i=i[a]).length,n=0;n<o;n++)i[n].api_name=i[n].sys_ref_name,"SMOWNERID"===i[n].column_name&&(i[n].data_type="ownerlookup"),i[n].ui_type=i[n].uitype;return t(i)}})).catch((function(e){var t=JSON.parse(e.responseText);"INTERNAL_ERROR"===t.code||"PERMISSION_DENIED"===t.code?renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")):renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("error.database.problem"))}))},getDetectedAndNotDetectedLabels:function(e){for(var t={},r=[],i=[],a=e.length,s=0;s<a;s++){var o=e[s];"detected"===o.type?r.push(o):i.push(o)}return t.detected_labels=r,t.notdetected_labels=i,t},renderDetailViewPopUp:function(e,t){e.setData("totApprovals",t);var r=t[0].record;e.setData("selectedRecord",r),e.setData("selectedRecordName",r.name);var i={};i.id=returnJson.tabId?returnJson.tabId:Lyte.Router.getRouteInstance().currentModel.tabId,i.id||(i.id=moduleRecordMapping[Lyte.Router.getRouteInstance().currentModel.module].id),i.api_name=store.peekRecord("module",i.id).api_name,i.plural_label=store.peekRecord("module",i.id).plural_label;var a={};a.recordModule=i,a.selectedRecord=e.getData("selectedRecord"),a.selectedRecord.module=i,a.isMyJobsPage=!1,a.record_approvals=e.getData("record_approvals"),a.image_approvals=e.getData("image_approvals"),a.records=e.getData("totRecords"),a.editAllowed=e.getData("editAllowed"),a.record_approvals&&a.record_approvals.length>0?a.action="record_approval":a.action="image_approval",a.showReviewButtons=!e.getData("isEdit"),a.readOnly=e.getData("readOnly"),a.moduleName=e.getData("moduleName"),a.isSaveAndNew=e.getData("isSaveAndNew"),e.getDisplayMessage(e),a.selectedRecordName=a.selectedRecord.name,a.displayMessage=e.getData("displayMessage"),a.record_approvals&&a.record_approvals.length>0?(a.showRecActions=!0,a.showImgActions=!1,a.approvals=e.getData("record_approvals"),a.selected_action="record_approval"):(a.selected_action="image_approval",a.approvals=e.getData("image_approvals"),a.showImgActions=!0,a.showRecActions=!1),Lyte.Component.render("crm-ziavision-myjobslistview",a,"#detailPopUpModal")},approvalsCallbackAndImageFetch:function(e,t,r){for(var i=this,a=t.vision_approvals,s=a.length,o=[],n=0;n<s;n++){var l=a[n].vision;-1===o.indexOf(l.id)&&o.push(l.id)}store.batch((function(){o.forEach((function(e){store.findRecord("visions",e)}))})).then((function(s){for(var o,n=s.length,l=[],c=0;c<n;c++){var d=s[c][0].$.toJSON(),u=d.id;o=d.validation_type;for(var m=a.length,p=0;p<m;p++){if(a[p].vision.id===u)if(a[p].vision=d,"object_detection"===o){var g=d.training_details,f=i.patternCriToTextPattern(g.pattern_criteria,g.labels);a[p].rule_pattern=f}else{var h=null,y=!0;null!==d.desired_set&&d.desired_set.labels.length>0?h=d.desired_set.labels:null!==d.undesired_set&&d.undesired_set.labels.length>0&&(h=d.undesired_set.labels,y=!1);var v=i.labelsToTextPatternMatch(h,y);a[p].rule_pattern_match=v}}}i.splitApprovals(a,i),e.fields="image",store.triggerAction("visions","record_approvals",{},e).then((function(e){var s=e.vision_approvals;i.setApprovalImages(s,a),r||i.renderDetailViewPopUp(i,a),$L("#myJobsVisionPop")[0].ltProp("show",!0);var n=$L("#crm-ziavision-myjobslistview")[0].component;n.setData("approvalsInfo",t.meta);var c=n.getData("selected_action");n.setData("selected_action",""),n.setData("selected_action",c),n.setData("visionFullDetails",l),"record_approval"===c?(n.setData("record_approvals",i.getData("record_approvals")),n.setData("approvals",[].concat(i.getData("record_approvals")))):(n.setData("image_approvals",i.getData("image_approvals")),n.setData("approvals",[].concat(i.getData("image_approvals")))),"object_detection"===o&&(n.setData("approvalDetailsArray",a),i.addMarkers(a))}),(function(e){i.approvalsErrorHandler(e)}))}))},getApprovalData:function(e,t,r,i){return store.triggerAction("visions","approvals",{id:e},{page:t,per_page:r}).then((function(e){commonUtils.showHideLoadingDiv(!1),i(e)}),(function(e){commonUtils.showHideLoadingDiv(!1);var t=JSON.parse(e.response);t&&"NO_PERMISSION"===t.code?renderingUtils.displayPermissionDenied():renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.oops"))}))},reviewApproval:function(e,t,r,i,a){return store.triggerAction("visions","reviews",{id:t,reviewJson:r}).then((function(e){i(e)}),(function(e){a(JSON.parse(e.response))}))},nextTransitionCheck:function(e,t,r){var i=$L("#vision_creation_page")[0].component,a=i.getData("saveDisable"),s=i.getData("saveButtonTriggered");if(i.data)if(i.data.criteriaSelected){if(!a&&(s||"crm.settings.section.zia.vision.image-validate"===e.target)){var o=document.querySelector("#visionCruxCriteriaEditorComp").component.getCriteria();if(null===o||!1===o){if(!i.getData("isCriteriaEditPatternOpen"))return void e.abort()}else if(void 0===o)return crmui.showMsgBand("error",I18n.getMsg("crm.zia.vision.error.criteria"),3500),void e.abort();i.data.visions.$.set("criteria",o)}}else Lyte.objectUtils(i.data.visions,"add","criteria",null);if("crm.settings.section.zia.vision.image-validate"!==e.target&&!a&&!s&&"crm.settings.section.section-error"!==e.target){if(!r&&"crm.settings.section.zia.vision.view"===e.target)return;var n=store.peekRecord("visions",t),l=n.$.getDirtyAttributes();if(!l.length||1!==l.length||"name"!==l[0]||void 0!==n.name&&""!==n.name.trim()){var c=e;c.pause(),_cruxUtils.showCustomAlert({params:{ltPropWrapperClass:"visionConfirmationPop",ltPropHeading:I18n.getMsg("crm.zia.vision.unsave.title"),ltPropSecondaryMessage:I18n.getMsg("crm.zia.vision.unsave.msg"),ltPropType:"confirm",ltPropButtonPosition:"right",ltPropButtons:[{type:"reject",text:I18n.getMsg("crm.button.stay.here"),appearance:"default"},{type:"accept",text:I18n.getMsg("crm.button.yes.move.away"),appearance:"failure"}]},ltPropContentAlign:"Left",ltPropShowCloseButton:!1,ltPropYield:"true",yieldName:"alert",accept:function(){i.methods.redirectToOut(c,i)},reject:function(){i.methods.abortToOut(c)}})}else n.$.rollBack()}},commonErrorAlerts:function(e,t){return 403===e.status?renderingUtils.displayPermissionDenied():renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.oops")),t.abort(),!1},setCriteriaMethods:function(e,t){e.setMethods({onChange:function(){t.getData("isCriteriaEditPatternOpen")||t.setData("saveDisable",!1)},onEditPattern:function(){t.setData("saveDisable",!0),t.setData("isCriteriaEditPatternOpen",!0)},onSavePattern:function(){t.setData("saveDisable",!1),t.setData("isCriteriaEditPatternOpen",!1)},onCancelPattern:function(){t.setData("saveDisable",!1),t.setData("isCriteriaEditPatternOpen",!1)}})},allowImagesMixin:function(e,t){var r=e.getData("visionId"),i=e.getData("approvalId"),a=[],s={},o={};(o.page="myJobs"===t?"my_jobs":"entity_page",s.image_status="approve",o.type="approve_image","record_approval"===e.getData("action")&&"approved"!==e.getData("record_status")&&(s.record_status="approve",o.type="approve_record_and_image"),a.push(s),o.isBulk=!1,Crm.client_tracking("Zia Vision Approval",o),e.reviews(e,a,r,i),"errorPopup"!==t)&&(0===$L(".imgValidatorItm").length&&e.setData("approval",[]))},ignoreImagesMixin:function(e,t){var r=e.getData("visionId"),i=e.getData("approvalId"),a=[],s={},o={};(o.page="entity_page",s.image_status="reject",o.type="reject_image","record_approval"===e.getData("action")&&"approved"!==e.getData("record_status")&&(s.record_status="approve",o.type="approve_record_reject_image"),a.push(s),o.isBulk=!1,Crm.client_tracking("Zia Vision Approval",o),e.reviews(e,a,r,i),"errorPopup"===t)&&(0===$L(".imgValidatorItm").length&&e.setData("approval",[]))},getDataForMyJobs:function(e){var t=[];return store.triggerAction("visions","approval_counts").then((function(r){var i=r.vision_count,a=store.peekRecord("visions",i[0].id);e[0].selectedVision=a;var s=[];(m={}).module_name=a.vision_module.module_name,m.id=a.vision_module.id,m.api_name=a.vision_module.api_name,m.plural_label=a.vision_module.plural_label,s.push(m);var o=[];o.push(a.vision_module.module_name);var n=0;i&&(n=i.length);for(var l={},c=0;c<n;c++){var d=store.peekRecord("visions",i[c].id);d.approval_count=i[c].count;var u,m,p=d.vision_module.module_name;if(l[p]||(l[p]=[]),d.vision_module.api_name)(u={}).id=d.id,u.label=d.name,u.approval_count=d.approval_count,t.push(u),l[p].push(u);if(-1===o.indexOf(p))(m={}).module_name=p,o.push(m.module_name),m.id=d.vision_module.id,m.api_name=d.vision_module.api_name,m.plural_label=d.vision_module.plural_label,s.push(m)}(e[0].moduleVisionMap=l,e[0].visionRules=e[0].moduleVisionMap[e[0].selectedVision.vision_module.module_name],e[0].visionRules)||(e[0].visionRules=[],(u={}).id=e[0].selectedVision.id,u.label=e[0].selectedVision.name,u.approval_count=e[0].selectedVision.approval_count,e[0].visionRules.push(u));return e[0].visionModules=s,e[0].selectedModule=e[0].selectedVision.vision_module.id,e[0].selectedRule=e[0].selectedVision.id,e}))},getmyJobsApprovals:function(e,t,r,i){var a={};if(a.page=e,a.per_page=t,"All"!==i){var s={};s.value=i,s.api_name="module.api_name",s.comparator="equals",a.filters=s}return store.triggerAction("visions","total_records",{},a).then((function(e){return commonUtils.showHideLoadingDiv(!1),r(e)}),(function(e){if(commonUtils.showHideLoadingDiv(!1),e&&e.response){var t=JSON.parse(e.response);"INVALID_MODULE"===t.code?renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.reviewprocess.invalid.module")):"NO_PERMISSION"===t.code?renderingUtils.displayPermissionDenied():renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("error.database.problem"))}}))},getMyJobsGroupCount:function(e,t,r){var i={};if("All"!==e){var a={};a.value=e,a.api_name="module.api_name",a.comparator="equals",i.filters=a}return store.triggerAction("visions","approval_recordCount",{},i).then((function(e){return t(e.group_count)}),(function(){return r(JSON.parse(data.response))}))},approvalsErrorHandler:function(e){commonUtils.showHideLoadingDiv(!1);var t=JSON.parse(e.response);t.vision_approvals&&t.vision_approvals[0]&&"NO_PERMISSION"===t.vision_approvals[0].code?renderingUtils.displayPermissionDenied():renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.oops"))},getMyJobsRecApprovals:function(e,t,r){return store.triggerAction("visions","record_approvals",{},e).then((function(e){if(commonUtils.showHideLoadingDiv(!1),e.vision_approvals&&e.vision_approvals[0])return r(e);renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.message.fail.validated"),I18n.getMsg("crm.zia.vision.action.performed"),!0)}),(function(e){commonUtils.showHideLoadingDiv(!1);var t=JSON.parse(e.response);t.vision_approvals&&t.vision_approvals[0]&&"NO_PERMISSION"===t.vision_approvals[0].code?renderingUtils.displayPermissionDenied():renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.oops"))}))},setApprovalImages:function(e,t){for(var r=e.length,i=0;i<r;i++)if(e.hasOwnProperty(i))for(var a in t)if(t.hasOwnProperty(a)&&e[i].id===t[a].id){var s=t[a];s.image=e[i].image,Lyte.arrayUtils(t,"removeAt",a,1),Lyte.arrayUtils(t,"insertAt",a,s);break}},get_detected_undetected_labels:function(e){for(var t=e.object_details,r=t.length,i=[],a=[],s=e.vision.training_details.labels,o=s.length,n=0;n<o;n++){var l=s[n],c=l.id,d=l.name,u=0,m={};m.labelname=d,m.id=c;for(var p=0;p<r;p++){t[p].label.id===c&&(u=t[p].count)}m.count=u,0===u?i.push(m):a.push(m)}e.detectedLabels=a,e.undetectedLabels=i},get_training_label_details:function(e,t){var r=this.get_training_details(e);return this.update_other_label_details(r,t)},get_training_details:function(e,t,r){if(void 0!==e){t||(t=[]);var i=e.group_operator;if(!i&&e.label)t.push(this.construct_group_obj(e,r));else{var a=e.group;a&&(this.get_training_details(a[0],t,i),this.get_training_details(a[1],t,i))}}return t},construct_group_obj:function(e,t){var r={};return r.comparator=void 0!==t?t.toLowerCase():"",r.labelId=e.label.id,r.apiName=null!==e.label.api_name?e.label.api_name:"",r.isDetected="${DETECTED}"===e.value,r.isNotDetected="${NOT_DETECTED}"===e.value,r.isDelete=!1,r},update_other_label_details:function(e,t){if(e)for(var r=e.length,i=t.length,a=0;a<r;a++)for(var s=0;s<i;s++)if(e[a].labelId===t[s].id||e[a].labelId===t[s].reference_id){r>=2&&a<r-1&&(e[a].comparator=e[a+1].comparator),e[a].labelName=t[s].name;var o=t[s].model_tags;e[a].show_tags=o.length>0,e[a].tags=o,e[a].index=a+1}return this.addParenthesisToCriteria(e)},addParenthesisToCriteria:function(e){var t=[];if(e){var r=e.length,i=")";switch(r){case 1:e[0].openingBrackets="(",e[0].closingBrackets=i;break;case 2:e[0].openingBrackets="(",e[r-1].closingBrackets=i;break;case 3:e[0].openingBrackets="((",e[1].closingBrackets=i,e[2].closingBrackets=i}t=e}return t},has_gallery_selected:function(e){for(var t=e.length,r=0;r<t;r++)for(var i=e[r].model_tags,a=i.length,s=0;s<a;s++){if("gallery"===i[s].type)return!0}return!1},addMarkers:function(e,t){for(var r=e.length,i=0;i<r;i++){var a=e[i].id,s=e[i].object_details,o=e[i].image_details,n=s.length;if(o&&n>0)for(var l=0;l<n;l++){var c=s[l].label,d=o.width,u=o.height,m=s[l].x1,p=s[l].x2,g=s[l].y1,f=s[l].y2,h=s[l].confidence,y=c.name;if(t)var v=$("#"+t);else v=$("#visionApprovalImg_"+a);v.parent().find(".previewMarker").remove(),_(v,m,p,g,f,d,u,h,y)}}function _(e,t,r,i,a,s,o,n,l){var c=r-t,d=a-i;setTimeout((function(){!function(e,t,r,i,a,s,o,n,l){if(e[0]){var c=e[0].getBoundingClientRect().width,d=e[0].getBoundingClientRect().height,u=e.parent(),m=u.innerWidth(),p=u.innerHeight(),g=c/t*s,f=d/r*o;if(c===m&&d===p)var h=c/t*i,y=d/r*a;else if(c===m)h=c/t*i,y=d/r*a+(p-d)/2;else if(d===u.innerHeight())h=c/t*i+(m-c)/2,y=d/r*a;var v='<div class="previewMarker detection_sec" style="left: '+h+"px;top: "+y+"px;width: "+g+"px;height: "+f+'px;"><div class="previewDetail"><span>'+l+"</span><span> - </span><span>"+n+"%</span></div></div>";u.append(v)}}(e,s,o,t,i,c,d,n,l)}),200)}},splitApprovals:function(e,t){for(var r=e.length,i=[],a=[],s=0;s<r;s++){if("waiting_for_approval"===e[s].record_status&&"pending_record_approval"!==e[s].image_status)e[s].vision=store.peekRecord("visions",e[s].vision.id),"object_detection"===e[s].vision.validation_type&&this.get_detected_undetected_labels(e[s]),a.push(e[s]);else e[s].vision=store.peekRecord("visions",e[s].vision.id),"object_detection"===e[s].vision.validation_type&&this.get_detected_undetected_labels(e[s]),i.push(e[s])}t.setData("record_approvals",a),t.setData("image_approvals",i),a.length>0?t.setData("approvals",t.getData("record_approvals")):t.setData("approvals",t.getData("image_approvals"))},getDisplayMessage:function(e){switch(e.getData("action")){case"image_processing":e.setData("displayMessage",I18n.getMsg("crm.zia.vision.processing.msg"));break;case"do_not_create":e.setData("displayMessage",I18n.getMsg("crm.zia.vision.message.not.create"));break;case"record_approval":e.getData("isSaveAndNew")?e.setData("displayMessage",I18n.getMsg("crm.zia.vision.message.record.approval1")):e.setData("displayMessage",I18n.getMsg("crm.zia.vision.message.record.approval"));break;case"image_approval":e.getData("isSaveAndNew")?e.setData("displayMessage",I18n.getMsg("crm.zia.vision.message.image.approval1")):e.setData("displayMessage",I18n.getMsg("crm.zia.vision.message.image.approval"));break;case"create_without_image":e.getData("isSaveAndNew")?e.setData("displayMessage",I18n.getMsg("crm.zia.vision.message.without.image1")):e.getData("isAjaxEdit")?e.setData("displayMessage",I18n.getMsg("crm.zia.vision.message.without.image.ajax")):e.setData("displayMessage",I18n.getMsg("crm.zia.vision.message.without.image"))}},renderVisionErrorPopUpForOtherFields:function(e,t,r,i,a,s,o,n){var l,c=$("crm-zia-vision-error-popup");if(c&&0!==c.length&&c.remove(),i||(i=!1),void 0===n)if("crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route)d=Lyte.Router.getRouteInstance().currentModel.entityDetails.image_vision_approvals[o];else{var d=[];e?d=detailView.changedBCJson.hidden.vision_approvals[o]:i&&(d=Lyte.Router.getRouteInstance().currentModel.vision_approvals[o]);for(var u=d.length,m=0;m<u;m++)if(d[m].attachment_id===s){n=d[m].failure_action;break}}e?l=detailView.changedBCJson.hidden.vision_approvals[o][0].vision_id:i&&(l=Lyte.Router.getRouteInstance().currentModel.vision_approvals[o][0].vision_id),Lyte.Component.render("crm-zia-vision-error-popup",{isDetailPage:e,fieldName:o,isOnClick:t,attachmentId:s,moduleName:r,entityId:a,isEdit:i,action:n,visionId:l},"#zia-vision-popup"),document.querySelector("crm-zia-vision-error-popup").setMethods({onDelete:function(e){this.executeMethod("deleteImageFromPreview",e)}.bind(this)}),Crm.userDetails.permissions.Crm_Implied_Approve_Actions&&"do_not_create"!==n||$L("#visionModal")[0].ltProp("show",!0)},visionMyJobsPageChange:function(e,t){if(commonUtils.showHideLoadingDiv(!0),t)for(var r=Math.ceil(e.getData("jobs_count").image_validation/e.getData("recordPerPage")),i=1;i<=r;i++)if(e.getData("initialIndex")<i*e.data.recordPerPage){e.setData("initialIndex",(i-1)*e.data.recordPerPage),e.setData("page",i);break}var a=$L("#crm-ziavision-myjobslistview")[0].component;e.getmyJobsApprovals(e.getData("page"),e.getData("recordPerPage"),(function(t){a.setData("records",t.total_records),a.setData("recordInfo",t.meta),a.setData("index",(e.data.page-1)*e.data.recordPerPage),a.setData("page",e.getData("page")),commonUtils.showHideLoadingDiv(!1)}),a.getData("selectedModule"))},triggerBulkReviews:function(e,t){var r=e.getData("selectedAppObj"),i=e.getData("selectedRecord"),a=store.peekRecord("module",i.module.id),s=e.getData("action");return store.triggerAction("visions","bulk_reviews",{failure_action:s,recordObj:i,moduleObj:a,reviewJson:r}).then((function(e){commonUtils.showHideLoadingDiv(!1),t(e)}),(function(e){commonUtils.showHideLoadingDiv(!1);var t=$L("#myJobsVisionPop");if(t.length&&(t[0].ltProp("show",!1),$L("crm-ziavision-myjobslistview")[0].component.setData("disaleAllButns",!1)),e&&e.response){var r="vision_record_approval";"image_approval"===s&&(r="vision_image_approval");var i=JSON.parse(e.response);!i[r]||"INVALID_DATA"!==i[r][0].code&&"UNAPPROVABLE"!==i[r][0].code?i[r]&&"NO_PERMISSION"===i[r][0].code?renderingUtils.displayPermissionDenied():renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.oops")):renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.message.fail.validated"),I18n.getMsg("crm.zia.vision.action.performed"),!0)}else renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.oops"))}))},constructImagePreview:function(e,t,r){e.constructSizeMinimizedImage(r).then((function(e){var i=[];i[0]={downloadUrl:r,original_src:r,src:e.url,uploadid:t.id,filename:t.image_name};var a={currentId:t.id,selector:"myJobsPreview_"+t.id,downloadImage:!0,zoom:!0};Lyte.Component.render("crm-image-preview",{imageData:i,isEditable:"false",previewConfiguration:a,id:"myJobsImagePreview"},"body");var s=$L("crm-image-preview#myJobsImagePreview")[0];s.setMethods({onClose:function(){s.remove()}});var o={lytecboxHref:r,lytecboxDlink:r,lytecboxTitle:t.image_name};$L(s).find(".imagePreviewTest")[0].launch(o),commonUtils.showHideLoadingDiv(!1)}))},setCreatePageErrorToFalse:function(e){e.component.setData("visionLabelName_error",!1),e.component.setData("labelNameNotAllowedSplCharError",!1),e.component.setData("visionUpload_type_error",!1),e.component.setData("visionLabelName_error_onclick_uploadImg",!1)},labelNameValidator:function(e,t){var r=$L("crm-ziavision-trainingcriteria-header");if(void 0===e.name||""===e.name.trim()||e.name.length>30)r[t].component.setData("visionLabelName_error",!0),this.labelnameValidateHighlighter(t);else if(""!==e.name.trim()){var i=this.notAllowedSplCharChecker(e.name);""!==i&&(r[t].component.setData("labelNameSplCharErrorMsg",I18n.getMsg("crm.zia.vision.objectname.not.allowed.splchar.error",i)),r[t].component.setData("labelNameNotAllowedSplCharError",!0),this.labelnameValidateHighlighter(t))}},deleteVisionFailed:function(e,t){var r=JSON.parse(e.response);r.visions&&r.visions[0].code&&"INVALID_DATA"===r.visions[0].code?renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.delete.error")):(t.$.rollBack(),r.visions&&"CANNOT_DELETE"===r.visions[0].code?$L("#deleteVisionModalRefresh")[0].ltProp("show",!0):r&&"NO_PERMISSION"===r.code?renderingUtils.displayPermissionDenied():crmui.showMsgBand("error",I18n.getMsg("crm.zia.vision.deleted.error"),4e3))},enableSaveButton:function(){var e=$L("crm-ziavision-creationpage");e&&e[0]&&e[0].component.data.isEdit&&e[0].component.setData("saveDisable",!1)},calculateFileArrCount:function(e){for(var t=e.files_arr.length,r=0,i=0;i<t;i++)(void 0!==e.files_arr[i].isDelete&&!e.files_arr[i].isDelete||null!==e.files_arr[i]._delete)&&(r+=1);return r},traininDataDetailsValidator:function(e){var t=$L("crm-ziavision-trainingcriteria-header"),r=$L("crm-ziavision-creationpage");(t[e].component.getData("visionLabelName_error")||t[e].component.getData("labelNameNotAllowedSplCharError")||t[e].component.getData("visionUpload_type_error"))&&((t[e].component.getData("visionLabelName_error")||t[e].component.getData("labelNameNotAllowedSplCharError"))&&t[e].component.getData("visionUpload_type_error")&&(this.setCreatePageErrorToFalse(t[e]),t[e].component.setData("trainingData_empty_error",!0),this.labelnameValidateHighlighter(e)),r[0].component.setData("trainingData_validation_failure",!0))}}),Lyte.Mixin.register("crm-vision-validation",{getDetails:function(e,t,r){var i={};i["X-ZCSRF-TOKEN"]=csrfParamName+"="+csrfToken,i["X-CRM-ORG"]=crmZgid;var a=window.location.host;if(window.clientPortalName&&(i["X-CRMPORTAL"]=window.clientPortalName),"SAMPLE_DATA"===t)return{url:s="https://"+a+"/crm/zia/vision/v2/configs/"+e+"/images",headers:i};if("GET"===t){if(["100","101","102","103"].indexOf(e)>-1)var s="https://"+a+"/crm/zia/vision/v2/images/gallery/"+e,o={page_no:r};else{var s="https://"+a+"/crm/zia/vision/v2/tags/"+e+"/images";o={page_no:r}}return{url:s,param:o,headers:i}}return"DELETE"===t?{url:s="https://"+a+"/crm/zia/vision/v2/images/tags",headers:i}:void 0},deleteUploadData:function(e,t,r){return new Promise((function(){$L.ajax({url:e.url,type:"DELETE",headers:e.headers,data:JSON.stringify(t),xhrFields:{withCredentials:!0},success:function(e){commonUtils.showHideLoadingDiv(!1);var i=e.response;if(i.deleted_tag_ids&&i.deleted_tag_ids.length===t.tag_ids.length){if(!r)return;r()}},error:function(){commonUtils.showHideLoadingDiv(!1)}})}))},getUploadData:function(e,t,r){return new Promise((function(){$L.ajax({url:e.url,type:"GET",headers:e.headers,data:e.param,xhrFields:{withCredentials:!0},success:function(e){t(e)},error:function(){r()}})}))},showSampleImages:function(e){var t=e.getData("visionId"),r=Lyte.registeredMixins["crm-vision-validation"].getDetails(t,"SAMPLE_DATA","1");e.getUploadData(r,(function(t){t&&t.image_details&&(e.setData("validationImages",[]),e.setData("validationImages",t.image_details.slice(0,6)),$L("#visionSamplesModal")[0].ltProp("show",!0))}),(function(){renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.error.common.di"))}))}}),Lyte.Mixin.register("crm-vision-match-utils",{setcriteriaTextPatternForMatch:function(){var e=$L("crm-ziavision-trainingdetails-criteria")[0].component,t=e.getData("criteriaArrayForMatch"),r=e.getData("isDesired")?"matched":"not matched";if(e.setData("criteriaTextPatternForMatch",[]),1===t.length)s();else if(2===t.length)s(),o();else if(t.length>2){s(),o();for(var i=t.length,a=3;a<=i;a++)n(a-1)}function s(){var i=t[0].labelName+" is "+r;Lyte.arrayUtils(e.getData("criteriaTextPatternForMatch"),"insertAt",0,i),Lyte.arrayUtils(e.getData("criteriaTextPatternForMatch"),"push",")"),Lyte.arrayUtils(e.getData("criteriaTextPatternForMatch"),"unshift","(")}function o(){var i=t[1].labelName+" is "+r;Lyte.arrayUtils(e.getData("criteriaTextPatternForMatch"),"insertAt",2,"or"),Lyte.arrayUtils(e.getData("criteriaTextPatternForMatch"),"insertAt",3,i)}function n(i){var a=t[i].labelName+" is "+r;Lyte.arrayUtils(e.getData("criteriaTextPatternForMatch"),"push","or"),Lyte.arrayUtils(e.getData("criteriaTextPatternForMatch"),"push",a),Lyte.arrayUtils(e.getData("criteriaTextPatternForMatch"),"push",")"),Lyte.arrayUtils(e.getData("criteriaTextPatternForMatch"),"unshift","(")}t.length>0&&this.setTrainDataForMatch()},setTrainDataForMatch:function(){var e=[],t=$L("crm-ziavision-trainingcriteria-header"),r=t.length,i=$L("crm-ziavision-creationpage"),a=$L("crm-ziavision-trainingdetails-criteria"),s=i[0].component.getData("isEdit"),o=!1;if(r>0){for(var n=0;n<r;n++){var l=t[n].component.data;(y={}).name=l.label_name,l.label_id&&(y.id=l.label_id),s&&l.api_name&&l.api_name.trim().length>0&&(y.api_name=l.api_name);var c=[],d=[];l.files_arr&&l.files_arr.length>0&&(a[0].component.data.desiredSelected?c=l.files_arr:d=l.files_arr);var u=c.length,m=d.length,p=[];if(u>0){o=!0;for(var g=0;g<u;g++)c[g].isDelete&&(c[g]._delete=null),delete c[g].isDelete,delete c[g].isTagAddedInEdit,p.push(c[g])}if(m>0)for(g=0;g<m;g++)d[g].isDelete&&(d[g]._delete=null),delete d[g].isDelete,delete d[g].isTagAddedInEdit,p.push(d[g]);p.length>0&&(y.model_tags=p,e.push(y))}var f=a[0].component.data.removed_image_validation_label_details;if(f&&f.length>0){var h=f.length;for(n=0;n<h;n++){var y;if(f[n].isDelete)(y={}).id=f[n].labelId,y._delete=null,e.push(y)}}var v={},_={};o?v.labels=e:_.labels=e;var b=i[0].component.$node.getData("visions");b.$.set("desired_set",v),b.$.set("undesired_set",_)}},matchImgGetPatternCriteria:function(){var e=$L("crm-ziavision-creationpage"),t=$L("crm-ziavision-trainingdetails-criteria")[0].component,r=e[0].component.getData("imgValidation")?t.getData("criteriaTextPatternForMatch"):t.getData("criteriaTextPattern"),i=$L("crm-ziavision-trainingcriteria-header"),a=[],s={},o=r.length;if(o>1){for(var n=0;n<o;n++)if(")"===r[n]){for(var l,c=a[a.length-1],d=[];"("!==c;)"and"!==c&&"or"!==c?d.push(u(c)):l=c,a.pop(),"("===(c=a[a.length-1])&&a.pop();a.push(m(d,l))}else a.push(r[n]);s=a[0]}function u(t){if(t.group)return t;var r={comparator:"equal",label:{}},a=!0;if(t.includes("is matched"))if(t.includes("is not matched"))t.lastIndexOf("is matched")>t.lastIndexOf("is not matched")?(s=t.lastIndexOf("is matched"),a=!0):t.lastIndexOf("is not matched")>t.lastIndexOf("is matched")&&(s=t.lastIndexOf("is not matched"),a=!1);else{var s=t.lastIndexOf("is matched");a=!0}else if(t.includes("is not matched"))if(t.includes("is matched"))t.lastIndexOf("is matched")>t.lastIndexOf("is not matched")?(s=t.lastIndexOf("is matched"),a=!0):t.lastIndexOf("is not matched")>t.lastIndexOf("is matched")&&(s=t.lastIndexOf("is not matched"),a=!1);else{s=t.lastIndexOf("is not matched");a=!1}for(var o=i.length,n=t.slice(0,s-1),l=0;l<o;l++){var c=i[l];n===c.component.data.label_name&&(c.component.data.label_id&&c.component.data.label_id.length>0&&(r.label.id=c.component.data.label_id),e[0].component.getData("isEdit")&&c.component.data.api_name&&(r.label.api_name=c.component.data.api_name))}if(!r.label.id){var d=n?n.trim().toLowerCase():"";d=(d="{{".concat(d)).concat("}}"),r.label.reference_id=d?d.replace(/ /g,"_"):""}return r.value=a?"${MATCHED}":"${NOT_MATCHED}",r}function m(e,t){var a={};return t&&(a.group_operator=t,e=e.reverse(),a.group=e),3===r.length&&1===i.length&&(a=e[0]),a}e[0].component.setData("pattern_criteria",s)},delIncriteriaArrayForMatch(e,t,r){var i,a=$L("crm-ziavision-trainingdetails-criteria")[0].component,s=a.data.criteriaArrayForMatch,o=s.length;if(0===e.data.files_arr.length||0===t)for(var n=0;n<o;n++){if(s[n].criteriaIndex===e.getData("criteriaindex")){Lyte.arrayUtils(a.getData("criteriaArrayForMatch"),"removeAt",n,1),i=n,"label"===r&&l();break}if(s[n].criteriaIndex>e.getData("criteriaindex")){i=n,l();break}}function l(){for(var e=s.length,t=i;t<e;t++){var r=s[n];r.criteriaIndex=r.criteriaIndex-1,Lyte.arrayUtils(a.getData("criteriaArrayForMatch"),"replaceAt",t,r)}}},labelsToTextPatternMatch(e,t){var r=e.length,i=[],a=t?"matched":"not matched";if(1===r)o();else if(2===r)o(),n();else if(r>2){o(),n();for(var s=3;s<=r;s++)l(s-1)}function o(){var t=e[0].name+" is "+a;Lyte.arrayUtils(i,"insertAt",0,t),Lyte.arrayUtils(i,"push",")"),Lyte.arrayUtils(i,"unshift","(")}function n(){var t=e[1].name+" is "+a;Lyte.arrayUtils(i,"insertAt",2,"or"),Lyte.arrayUtils(i,"insertAt",3,t)}function l(t){var r=e[t].name+" is "+a;Lyte.arrayUtils(i,"push","or"),Lyte.arrayUtils(i,"push",r),Lyte.arrayUtils(i,"push",")"),Lyte.arrayUtils(i,"unshift","(")}return i}}),Lyte.Mixin.register("crm-assignment-threshold-common",{isMatchedInArray:function(e,t){return t.some((function(t){return e===t}))},isValidRestrictionModule:function(e){return this.isValidRestrictionModuleByApiName(e)||this.isValidRestrictionModuleByModuleName(e)},isValidRestrictionModuleByApiName:function(e){var t=this.getRestrictionModuleObjs()[2];return this.isMatchedInArray(e,t)},isValidRestrictionModuleByModuleName:function(e){var t=this.getRestrictionModuleObjs()[3];return this.isMatchedInArray(e,t)},isValidVisibleRestrictionModule:function(e){var t=this.getRestrictionModuleObjs()[1];return this.isMatchedInArray(e,t)},getUseridsFilterParam:function(e){return'{"group":[{"comparator":"equal","field":{"api_name":"restrict_to.user.id","id":null},"value":"'+e+'"}]}'},getActiveRestrictionModules:function(){if(Crm&&Crm.restrictionEnabledModules)return Promise.resolve(Crm.restrictionEnabledModules);var e=[];return store.findAll("assignment_threshold",{status:"active"}).then((function(t){return t&&t.length>0&&t.forEach((function(t){var r=t.module.api_name;e.contains(r)||e.push(r)})),e}))},isConfiguredRestrictionModule:function(e){if(this.isValidRestrictionModule(e)){if(!this.checkPermissionForAssignment(e))return Crm&&Crm.restrictionEnabledModules&&Crm.restrictionEnabledModules.contains(e)?Promise.resolve(!0):Promise.resolve(!1);for(var t=this.getModuleRecord(null,e).api_name,r=store.peekAll("assignment_threshold"),i=r.length,a=0;a<i;a++){if(r[a].module.api_name===t)return Promise.resolve(!0)}return Crm.isRestrictionEnabled?Crm.threshold&&Crm.threshold.configCount[t]||0==Crm.threshold.configCount[t]?Promise.resolve(this.isThresholdConfigInLocalData(t)):store.findAll("assignment_threshold",{module:t}).then((function(e){return!!(e&&e.length>0)})):Promise.resolve(!1)}return Promise.resolve(!1)},isThresholdConfigInLocalData:function(e){return!!(Crm.threshold.configCount[e]&&Crm.threshold.configCount[e]>0)||0!=Crm.threshold.configCount[e]&&void 0},checkPermissionForAssignment:function(e){var t="Crm_Implied_Manage_AR_"+e;return t=Crm.userDetails.permissions[t]},setThresholdModuleConfigCount:function(e,t){Crm.threshold.configCount[e]=t},resetThresholdModuleConfigCount:function(){Crm.threshold.configCount={}},appendThresholdModuleConfigCount:function(e,t){let r=Crm.threshold.configCount[e];r=null==r?0:r,Crm.threshold.configCount[e]=r+t},saveModuleObj:function(e,t,r){if(null===r&&null===t)return e;var i=this.getModuleRecord(t,r);return e.api_name=i.api_name,e.module_name=i.module_name,e.plural_label=i.plural_label,e.singular_label=i.singular_label,e},getModuleRecord:function(e,t){if(null!==t||null!==e){var r={};return"Potentials"===e&&(e="Deals"),"Deals"===t&&(t="Potentials"),e?r.api_name=e:t&&(r.module_name=t),store.peekAll("module").filterBy(r)[0]}},getValidRestrictionModules:function(){return["Leads","Contacts","Accounts","Deals","Cases"]},restrictionGrantCheck:function(e,t,r){try{if(!Crm.isRestrictionEnabled||!this.isValidRestrictionModule(e))return Promise.resolve({allow:!0});var i={actionName:"permit_threshold",owner_id:t};r&&"undefined"!==r&&"null"!==r&&(i.record_id=r);var a=this.getModuleRecord(null,e);if(null==a&&(a=this.getModuleRecord(e,null)),null==a)return Promise.resolve({allow:!0});var s=a.id;return store.model[s]?store.triggerAction(s,"permit_threshold",i).then((function(e){return e?e.permit_threshold:{allow:!0}}),(function(){return{allow:!0}})):store.findRecord("module",s).then((function(){return store.triggerAction(s,"permit_threshold",i).then((function(e){return e?e.permit_threshold:{allow:!0}}))}),(function(){return{allow:!0}}))}catch(e){return Promise.resolve({allow:!0})}},getRestrictionModuleObjs:function(){for(var e=store.peekAll("module"),t=[],r=[],i=[],a=[],s=e.length,o=this.getValidRestrictionModules(),n=0;n<s;n++){var l=e[n].api_name,c=e[n].module_name,d=e[n].visible;c&&(this.isMatchedInArray(l,o)||c.startsWith("CustomModule"))&&(d&&(t.push(e[n]),a.push(l)),r.push(l),i.push(c))}return[t,a,r,i]},getRecordPeriodName:function(e){var t=e.split(".");return t.length>1?t[2]:e},getRecordPeriodKey:function(e){var t=e=e.toLocaleLowerCase();return"day"==e?t="crm.report.day":"week"==e?t="crm.report.week":"month"==e&&(t="crm.report.month"),t},makeUserAPIRequest:function(e){if(!e||e.length<=0)return Promise.resolve({});var t=e.length;let r=Math.floor(t/100)+1,i=0;for(var a=[];r>0;){var s="";for(let r=0;i<t&&r<100;r++,i++)s+=e[i]+",";if(""!=s&&s.length>0){let e={ids:s=s.substring(0,s.length-1)};a.push(store.findAll("user",e))}r--}return Promise.all(a).then((function(e){return e}))},isThresholdLimitReached:function(e,t){if(!Crm.isRestrictionEnabled||t&&!this.isValidRestrictionModule(t)||Crm.restrictionEnabledModules&&0==Crm.restrictionEnabledModules.length)return Promise.resolve({allow:!1});if(!e||0==e.length)return Promise.resolve({allow:!1});var r={},i=this.getUseridsFilterParam(e);return r.filters=i,r.status="active",t&&(r.module=t),store.findAll("assignment_threshold",r,!1,!1).then((function(e){if(!e||!e.assignment_threshold||0==e.assignment_threshold.length)return!1;if(e&&e.assignment_threshold&&e.assignment_threshold.length>0){let t=[],r={},a=e.assignment_threshold,s=a.length;for(let e=0;e<s;e++){let i=a[e],s=i.module.api_name,o=i.default_assignee.id,n={};i&&i.id&&(n.id=i.id),n.module=s,t.push(n),r[s]||(r[s]=[]),r[s+""].push(o)}let o=[],n=t.length;for(let e=0;e<n;e++){let r=t[e].id,a={module:t[e].module};a.filters=i,o.push(store.findAll("assignment_threshold_userdetails",a,!1,!1,{getAllUsers:!0,restrictionId:r}))}let l=[];return Promise.all(o).then((function(e){let t=e.length;for(let r=0;r<t;r++)l=e[r]?l.concat(e[r]):l;let r=l.length;for(let e=0;e<r;e++){if(l[e].record_allow_count<=l[e].record_assigned_count)return!0;if(l[e].backlog_allow_count<=l[e].backlog_count)return!0}}))}return!1}))}}),Lyte.Mixin.register("recommendation-util",{modelLoaderForEdit:function(e){var t=this.gettingValidModuleList();return e.module_list=t,e.module_listwhat=t,e.name=e.recommendationJson.name,e.whatModuleList=this.getWhatModuleList(),e.whatModuleId=e.recommendationJson.what_module.id,e.whatModule=e.recommendationJson.what_module,e.whatFields=e.recommendationJson.what_module.fields,e.whatCriteriaIsEnable=null!==e.recommendationJson.what_criteria,e.whatCriteriaIsEnable&&(e.whatCriteria=e.recommendationJson.what_criteria),e.whomModuleList=this.getWhomModuleList(e.recommendationJson.id,e.whatModuleId),e.whomModuleId=e.recommendationJson.whom_module.id,e.whomModule=e.recommendationJson.whom_module,e.whomFields=e.recommendationJson.whom_module.fields,e.whomCriteriaIsEnable=null!==e.recommendationJson.whom_criteria,e.whomCriteriaIsEnable&&(e.whomCriteria=e.recommendationJson.whom_criteria),e.basedOnModuleList=this.getBasedOnModuleList(e.whatModuleId,e.whomModuleId),e.basedOnModuleId=e.recommendationJson.based_module.id,e.basedOnModule=e.recommendationJson.based_module,e.basedOnFields=e.recommendationJson.based_module.fields,e.basedOnFieldId=e.recommendationJson.based_timestamp?e.recommendationJson.based_timestamp.id:void 0,e.basedOnField=e.recommendationJson.based_timestamp?e.recommendationJson.based_timestamp:void 0,e.basedOnCriteria=e.recommendationJson.based_criteria?e.recommendationJson.based_criteria:"{}",e.recommendationsJson=store.peekRecord("recommendations",e.componentId),e.editCruxType="view",e.uiEditMode="inEditMode",e},getWhomModuleList:function(e,t){var r=store.peekAll("recommendations").filter((function(t){return t.id!==e})).map((function(e){return e.whom_module.id})),i=store.peekAll("recommendation_gallery"),a=[];return i.filter((function(e){return e.what_module.id===t})).map((function(e){r.contains(e.whom_module.id)||(a[e.whom_module.id]=e.whom_module)})),Object.values(a)},getWhatModuleList:function(){var e=store.peekAll("recommendation_gallery"),t=[];return e.map((function(e){t[e.what_module.id]=e.what_module})),Object.values(t)},getBasedOnModuleList:function(e,t){var r=store.peekAll("recommendation_gallery"),i=[];return r.filter((function(t){return t.what_module.id===e})).filter((function(e){return e.whom_module.id===t})).map((function(e){i[e.based_module.id]=e.based_module})),Object.values(i)},gettingValidModuleList:function(){var e=store.peekAll("module"),t=[],r=["Visits","Forecasts","Services","Appointments","JobSheets"];return e.forEach((function(e){e.api_supported&&e.presence_sub_menu&&!r.contains(e.module_name)&&"Activities"!==Crm.activityGrp[e.api_name]&&"linking"!==e.generated_type&&0!==e.profiles.filter((function(e){return e.name===Crm.userDetails.PROFILE_NAME})).length&&!0===e.visible&&t.push(e)})),t},loadUnUseFieldForViewAndEdit:function(e,t){var r=store.peekRecord("recommendations",e);if(void 0===r){var i=Lyte.Router.getRouteInstance();return Lyte.Router.transitionTo("crm.settings.section.zia.recommendation.error",null).data={errorMsg:"crm.recommendation.error.module.permissions"},void i.transition.abort()}var a=[];a.push(r.what_module.api_name),a.push(r.whom_module.api_name),a.push(r.based_module.api_name);var s=[];return t||a.forEach((function(e){var t=store.findAll("field",{module:e,type:"unused"},!1,!0,{apiVersion:"2.1"}).then((function(e){e&&e.map((function(e){e.unused=!0}))}));s.push(t)})),{componentId:e,editView:!0,recommendationJson:r,prom1:Lyte.resolvePromises(s),portalsInfo:void 0}},loadRecommendationModuleForEditAndView:function(e,t,r){var i=[],a=[],s=[];return r||(s.push(t.what_module.id),s.push(t.whom_module.id),s.push(t.based_module.id)),s.forEach((function(e){var t=e;if(!i.contains(t)){i.push(t);var r=void 0===store.peekRecord("module",t).fields||0===store.peekRecord("module",t).fields.length?store.findRecord("module",t,void 0,void 0,void 0):store.peekRecord("module",t);a.push(r)}})),e.transition.pause(),(t=t.id.length>10&&void 0===t.suggestion_type?store.findRecord("recommendations",t.id):Promise.resolve(store.peekRecord("recommendations",t.id))).then((function(){e.transition.resume()}),(function(){Lyte.Router.transitionTo("crm.settings.section.zia.recommendation.error",null).data={errorMsg:"crm.recommendation.error.module.permissions"},e.transition.abort()})),{prom1:Lyte.resolvePromises(a)}},collectProductId:function(e){var t=[];return e.first_buy&&e.first_buy.recommended&&e.first_buy.recommended.map((function(e){t.push(e.id)})),e.next_buy&&e.next_buy.recommended&&e.next_buy.recommended.map((function(e){t.push(e.id)})),e.rebuy&&e.rebuy.map((function(e){t.push(e.recommended.id)})),e.frequently_bought_together&&e.frequently_bought_together.map((function(e){t.push(e.primary_product.id),e.recommended.map((function(e){t.push(e.id)}))})),e.customer_also_bought&&e.customer_also_bought.map((function(e){t.push(e.primary_product.id),e.recommended.map((function(e){t.push(e.id)}))})),$u.uniq(t)},dataPageInitLoader:function(e,t,r){var i=r;if(void 0!==i){var a=Lyte.registeredMixins["recommendation-util"].collectProductId(i),s=null;window.clientPortalName&&(s={headers:{"X-CRMPORTAL":window.clientPortalName}}),Lyte.resolvePromises({productMeta:store.peekRecord("module",i.what_to.id).fields&&0!==store.peekRecord("module",i.what_to.id).fields.length?Promise.resolve(store.peekRecord("module",i.what_to.id)):store.findRecord("module",i.what_to.id),recommendationDetailPageRecords:i,productGetRecord:networkUtils.lyteInitiateRequest("/crm/v2/"+i.what_to.api_name+"?ids="+a.toString(),"GET",s),recommendations:store.peekRecord("recommendations",i.recommendation_id)?Promise.resolve(store.peekRecord("recommendations",i.recommendation_id)):store.findRecord("recommendations",i.recommendation_id)}).then((function(t){Lyte.registeredMixins["recommendation-util"].renderRecommendationProcess(e,t)}))}},resizeGallaryPage:function(e){var t=renderingUtils.windowHeight-$L(".galleryTableRecom").offset().top+30,r=$L("#wmstoolbar"),i=$L("#tabLayer"),a=$L("#setupInnerLinks"),s=r.outerHeight()?r.outerHeight():28,o=i.outerHeight()?i.outerHeight():52,n=a.outerHeight()?a.outerHeight():85;e.setData("tableHeight",t);var l=renderingUtils.windowHeight-(o+s+n+$L(".recommendationGalleryTitle").outerHeight()+$L(".recGalBtnSec").outerHeight()+102);e.setData("offToph",l)},businessCardJsonLoader:function(e,t,r){if(e.id)e.businessCardJson={data:t[e.id],fields:r};else if(0!==e.length){var i=[];e.forEach((function(e){e.businessCardJson={data:t[e.id],fields:r},i.push(e)})),e=i}return e},renderRecommendationProcess:function(e,t){var r=Lyte.registeredMixins["recommendation-util"],i={},a=[],s={},o=t.recommendationDetailPageRecords,n=t.recommendations,l=t.productGetRecord,c=t.productMeta[0]?t.productMeta[0]:t.productMeta;l.data.forEach((function(e){i[e.id]=e}));var d=[];n.selected_view[0].fields.forEach((function(e){var t=c.fields.filter((function(t){return e.id===t.id}));0!==t.length&&d.push(t[0].$.toJSON())}));var u=o.first_buy,m=o.frequently_bought_together,p=o.rebuy,g=o.next_buy,f=o.customer_also_bought;u&&u.recommended&&u.recommended.length&&u.recommended.forEach((function(e){(s={}).source=r.businessCardJsonLoader(e,i,d),s.type="First buy",s.displayType="crm.filter.label.firstbuy"===n.suggestion_type.first_buy.label?I18n.getMsg("crm.filter.label.firstbuy"):n.suggestion_type.first_buy.label,s.products=[s.source],s.count=s.products.length-1,s.reference_records=u.reference_records,a.push(s)})),m&&m.forEach((function(e){e.recommended.forEach((function(t){(s={}).source=r.businessCardJsonLoader(e.primary_product,i,d),s.type="Bought Together",s.displayType="crm.filter.label.fbt"===n.suggestion_type.frequently_bought_together.label?I18n.getMsg("crm.filter.label.fbt"):n.suggestion_type.frequently_bought_together.label,s.products=r.businessCardJsonLoader([e.primary_product,t],i,d),s.count=2,s.reference_records=e.reference_records,a.push(s)}))})),p&&p.map((function(e){var t,o=new CrmDate(e.next_purchase_date),l=new CrmDate,c=Math.floor((Date.UTC(l.userDisplayYear,l.userDisplayMonth,l.userDisplayDate)-Date.UTC(o.userDisplayYear,o.userDisplayMonth,o.userDisplayDate))/864e5),u=Math.abs(c);t=0===c?I18n.getMsg("crm.recommendation.rebuy.today"):c<0?I18n.getMsg(1===u?"crm.recommendation.rebuy.within.day":"crm.recommendation.rebuy.within.days",u):I18n.getMsg(1===u?"crm.recommendation.rebuy.ago.day":"crm.recommendation.rebuy.ago.days",u);var m=o.userDisplayMonthName+" "+o.userDisplayDate+", "+o.userDisplayYear;(s={}).source=r.businessCardJsonLoader(e.recommended,i,d),s.type="Rebuy",s.displayType="crm.filter.label.rebuy"===n.suggestion_type.rebuy.label?I18n.getMsg("crm.filter.label.rebuy"):n.suggestion_type.rebuy.label,s.date=e.next_purchase_date,s.reasons=e.reasons,s.diffDays=Math.abs(c),s.displayDiffDays=t,s.dateString=m,s.products=[s.source],s.count=s.products.length-1,c<=6&&a.push(s)})),g&&g.recommended&&g.recommended.length&&g.recommended.forEach((function(e){(s={}).source=r.businessCardJsonLoader(e,i,d),s.type="Next Buy",s.displayType="crm.filter.label.nextbuy"===n.suggestion_type.next_buy.label?I18n.getMsg("crm.filter.label.nextbuy"):n.suggestion_type.next_buy.label,s.products=[s.source],s.count=s.products.length-1,s.reference_records=g.reference_records,a.push(s)})),f&&f.forEach((function(e){e.recommended.forEach((function(t){var s={};s.source=r.businessCardJsonLoader(e.primary_product,i,d),s.type="Already bought",s.displayType="crm.filter.label.cwbab"===n.suggestion_type.customer_also_bought.label?I18n.getMsg("crm.filter.label.cwbab"):n.suggestion_type.customer_also_bought.label,s.products=[r.businessCardJsonLoader(t,i,d)],s.count=e.count,s.reference_records=e.reference_records,a.push(s)}))}));var h=[];["First buy","Rebuy","Next Buy","Already bought","Bought Together","Products for user"].map((function(e){var t=a.filter((function(t){return t.type===e}));0!==t.length&&t.forEach((function(e){h.push(e)}))}));var y={what_to:o.what_to,whom_to:o.whom_to,data:h};e.renderAfterProcess(y)},actionPerformed:function(e){var t=$L(e),r=t.next(".recommendationStep");r.length<1&&(r=t.next().next(".recommendationStep"));var i=r.is(":visible");if(i)var a=t.outerHeight()-20-t.find(".recommendationRound").outerHeight()+30;$L(".thisisCurrentActiveClass").removeClass("thisisCurrentActiveClass"),$L(e).find(".recommendationFieldStep").addClass("thisisCurrentActiveClass"),i&&t.find(".vertLine").css({height:a,opacity:"1"})},showLoader:function(e){$('<div id="wave" class="waverecommendation mT15 mB10"><div class="dIB mR10 col666 proxima">Loading</div><span class="zvoice-dot"></span><span class="zvoice-dot"></span><span class="zvoice-dot"></span></div>').insertAfter(e)},removeLoader:function(){$(".waverecommendation").remove()},criteriaIsModified:function(e,t){return null===e&&(e=void 0),null===t&&(t=void 0),!$u.isEqual(t,e)},showGroupByPopupfunc:function(){this.setData("isShowPopOver",!1),this.setData("isShowPopOver",!0);var e=this.getData("selectedRecords"),t=this.getData("recommendationAnalyticRecord"),r=this.getData("selectedRecordsTemp");this.setData("displayVal",(0===e.length?I18n.getMsg("gs.custom"):e.length)+" "+t.what_module.plural_label);var i=_.isEqual(e,r);this.setData("isCancelBtnEnable",i),this.setData("isApplyBtnEnable",i)},toggleDropDownFunc:function(e){if(!0===e.ltProp("show"))return e.setData("ltPropValue",""),e.toggle(),!1},closeModalFunc:function(){this.setData("selectedRecords",this.getData("selectedRecordsTemp").map((function(e){return e})));var e=this.getData("selectedRecords");if(0===e.length)return this.setData("groupByOption",this.getData("oldGroupByOption")),void this.setData("isShowPopOver",!1);this.setData("displayVal",(0===e.length?I18n.getMsg("gs.custom"):e.length)+" "+this.getData("recommendationAnalyticRecord").what_module.plural_label),this.setData("isShowPopOver",!1)},applyGroupByFunc:function(){var e=this;e.setData("displayVal",e.getData("selectedRecords").length+" "+e.getData("recommendationAnalyticRecord").what_module.plural_label),e.fetchDataFromApi(e.getData("groupByOption"))},actions:{toggleDropDown:function(e){this.toggleDropDownFunc(e)},showGroupByPopup:function(){this.showGroupByPopupfunc()},closeModal:function(){this.closeModalFunc()},applyGroupBy:function(){this.chartCleanUp(),this.applyGroupByFunc()}},methods:{addToSelectedRecords:function(e,t){var r=this.getData("records").filter((function(e){return e.id===t})),i=this.getData("selectedRecords"),a=this.getData("selectedRecordsTemp");this.setData("searchRecordInputValue",""),Lyte.arrayUtils(i,"push",r);var s=_.isEqual(i,a);this.setData("isCancelBtnEnable",s),this.setData("isApplyBtnEnable",s||0===i.length)},removeFromSelectedRecords:function(e,t){var r=this.getData("selectedRecords");r.forEach((function(e,i){e.id===t&&Lyte.arrayUtils(r,"removeAt",i,1)})),this.getData("records").length>1&&this.setData("noRecordsFoundHeader",!1);var i=this.getData("selectedRecords"),a=this.getData("selectedRecordsTemp"),s=_.isEqual(i,a);this.setData("isCancelBtnEnable",s),this.setData("isApplyBtnEnable",s||0===i.length)},onSearchRecords:function(e){var t=this;if(t.setData("records",[]),t.setData("noRecordsFoundHeader",!0),e.newValue.length>1){t.setData("searchRecordNoResult",I18n.getMsg("crm.chosen.searching.text"));var r=!1,i=this.getData("recommendationAnalyticRecord"),a=i.what_module.display_field.api_name,s=store.peekRecord("module",i.what_module.id);s.$.triggerAction("searchRecordsByName",{url:"/crm/v2/"+s.api_name+"/search?criteria=("+s.display_field.api_name+"%3Astarts_with%3A"+e.newValue+")"},{},"GET").then((function(e){if(e.hasOwnProperty("data")){t.setData("records",[]);var s=t.getData("records"),o=t.getData("selectedRecords");e.data.map((function(e){return{name:e[a],id:e.id,type:"module"}})).forEach((function(e,i){(o.length<1||o.every((function(t){return t.id!==e.id})))&&i<=10&&(r=!0,Lyte.arrayUtils(s,"push",e),t.setData("noRecordsFoundHeader",!1))}))}if(!1===r){var n=i.what_module.plural_label.toLowerCase();t.setData("noRecordsFoundHeader",!0),t.setData("searchRecordNoResult",I18n.getMsg("crm.module.empty.message",n))}}))}else{var o=I18n.getMsg("crm.chosen.minimum.input.text",2-e.newValue.length);t.setData("searchRecordNoResult",o)}}},editGroupByOptionChange:function(e){var t=e.newValue;this.setData("oldGroupByOption",e.oldValue),Crm.client_tracking("Zia RA - Drop Down Click Rate",{Type:t}),"custom"!==t?(this.setData("selectedRecordsTemp",[]),this.setData("selectedRecords",[]),this.chartCleanUp(),this.setData("displayVal","most"===t?I18n.getMsg("zia.recommendation.analytic.most",this.getData("recommendationAnalyticRecord").what_module.plural_label):I18n.getMsg("zia.recommendation.analytic.least",this.getData("recommendationAnalyticRecord").what_module.plural_label)),this.fetchDataFromApi(t)):(this.setData("displayVal",I18n.getMsg("gs.custom")),this.setData("isShowPopOver",!1),this.setData("isShowPopOver",!0))}.observes("groupByOption"),_unbindCharts:function(e){thirdPartyUtils.unbindHighcharts(e),thirdPartyUtils.unbindZohoCharts(e)}}),store.registerModel("recommendations",{default:Lyte.attr("boolean"),id:Lyte.attr("string"),name:Lyte.attr("string"),what_module:Lyte.belongsTo("module",{serialize:"record",inverse:"what_module"}),what_criteria:Lyte.attr("object",{default:null}),whom_module:Lyte.belongsTo("module",{serialize:"record",inverse:"whom_module"}),whom_criteria:Lyte.attr("object",{default:null}),based_module:Lyte.belongsTo("module",{serialize:"record",inverse:"based_module"}),based_timestamp:Lyte.belongsTo("field",{serialize:"record",inverse:"based_timestamp"}),based_criteria:Lyte.attr("object"),is_workflow_enable:Lyte.attr("boolean",{default:!1}),suggestion_type:Lyte.attr("object"),selected_view:Lyte.attr("array"),active:Lyte.attr("boolean"),created_time:Lyte.attr("string"),modified_time:Lyte.attr("string"),created_by:Lyte.attr("object"),modified_by:Lyte.attr("object"),first_buy:Lyte.attr("object"),next_buy:Lyte.attr("object"),rebuy:Lyte.attr("object"),customer_also_bought:Lyte.attr("object"),frequently_bought_together:Lyte.attr("object"),first_buy_active:Lyte.attr("boolean"),first_buy_label:Lyte.attr("string"),first_buy_user_type:Lyte.attr("array",{default:[]}),first_buy_notification:Lyte.attr("array",{default:[]}),next_buy_active:Lyte.attr("boolean"),next_buy_label:Lyte.attr("string"),next_buy_user_type:Lyte.attr("array",{default:[]}),next_buy_notification:Lyte.attr("array",{default:[]}),rebuy_active:Lyte.attr("boolean"),rebuy_label:Lyte.attr("string"),rebuy_user_type:Lyte.attr("array",{default:[]}),rebuy_notification:Lyte.attr("array",{default:[]}),customer_also_bought_active:Lyte.attr("boolean"),customer_also_bought_label:Lyte.attr("string"),customer_also_bought_user_type:Lyte.attr("array",{default:[]}),customer_also_bought_notification:Lyte.attr("array",{default:[]}),frequently_bought_together_active:Lyte.attr("boolean"),frequently_bought_together_label:Lyte.attr("string"),frequently_bought_together_user_type:Lyte.attr("array",{default:[]}),frequently_bought_together_notification:Lyte.attr("array",{default:[]}),selected_view_fields_1:Lyte.belongsTo("field",{serialize:"record",inverse:"selected_view_fields_1"}),selected_view_fields_2:Lyte.belongsTo("field",{serialize:"record",inverse:"selected_view_fields_2"}),selected_view_fields_3:Lyte.belongsTo("field",{serialize:"record",inverse:"selected_view_fields_3"})},{actions:{configure_notification:{}}}),store.registerAdapter("recommendations",{namespace:"crm/v2.2/",buildURL:function(e,t,r,i,a,s,o){return a=o&&"/"===o.url[0]?a.slice(0,a.indexOf("/",8))+o.url:a.replace("recommendations","settings/zia/recommendations")},methodForRequest:function(e){return"PATCH"===e?"PUT":e},headersForRequest:function(e,t,r,i){var a=this.$super.headersForRequest();return"configure_notification"===i&&(a["Content-Type"]="application/json;charset=UTF-8"),a}}),store.registerSerializer("recommendations",{normalizeResponse:function(e,t,r,i,a,s,o,n){if(r&&n&&!r.recommendations){var l={};return"updateRecord"===t&&(l.id=r.recommendations.details.id),l.recommendations=r.recommendations,l}if(200===a||201===a){var c=[];return"createRecord"!==t&&"updateRecord"!==t||!r.recommendations[0].details||(r.recommendations=[r.recommendations[0].details]),("findAll"===t||("createRecord"===t||"updateRecord"===t)&&r.recommendations[0].details||"findRecord"===t)&&(r.recommendations.each((function(e){var t=e,r={};if(r.id=t.id,r.name=t.name,r.what_module=t.what_to.module.id,r.based_module=t.based_on.module.id,r.whom_module=t.whom_to.module.id,null!==t.what_to.criteria&&(r.what_criteria=t.what_to.criteria),null!==t.whom_to.criteria&&(r.whom_criteria=t.whom_to.criteria),void 0!==t.based_on.completion_time_field&&void 0!==t.based_on.completion_time_field.id&&(r.based_timestamp=t.based_on.completion_time_field),null!==t.based_on.criteria&&(r.based_criteria=t.based_on.criteria),r.is_workflow_enable=void 0!==t.is_workflow_enable&&t.is_workflow_enable,t.suggestion_type&&(r.suggestion_type=t.suggestion_type,r.first_buy=t.suggestion_type.first_buy,r.first_buy_active=t.suggestion_type.first_buy.active,r.first_buy_label="crm.filter.label.firstbuy"===t.suggestion_type.first_buy.label?I18n.getMsg("crm.filter.label.firstbuy"):t.suggestion_type.first_buy.label,r.first_buy_user_type=t.suggestion_type.first_buy.user_type?t.suggestion_type.first_buy.user_type:[],r.rebuy=t.suggestion_type.rebuy,r.rebuy_active=t.suggestion_type.rebuy.active,r.rebuy_label="crm.filter.label.rebuy"===t.suggestion_type.rebuy.label?I18n.getMsg("crm.filter.label.rebuy"):t.suggestion_type.rebuy.label,r.rebuy_user_type=t.suggestion_type.rebuy.user_type?t.suggestion_type.rebuy.user_type:[],r.next_buy=t.suggestion_type.next_buy,r.next_buy_active=t.suggestion_type.next_buy.active,r.next_buy_label="crm.filter.label.nextbuy"===t.suggestion_type.next_buy.label?I18n.getMsg("crm.filter.label.nextbuy"):t.suggestion_type.next_buy.label,r.next_buy_user_type=t.suggestion_type.next_buy.user_type?t.suggestion_type.next_buy.user_type:[],r.customer_also_bought=t.suggestion_type.customer_also_bought,r.customer_also_bought_active=t.suggestion_type.customer_also_bought.active,r.customer_also_bought_label="crm.filter.label.cwbab"===t.suggestion_type.customer_also_bought.label?I18n.getMsg("crm.filter.label.cwbab"):t.suggestion_type.customer_also_bought.label,r.customer_also_bought_user_type=t.suggestion_type.customer_also_bought.user_type?t.suggestion_type.customer_also_bought.user_type:[],r.frequently_bought_together=t.suggestion_type.frequently_bought_together,r.frequently_bought_together_active=t.suggestion_type.frequently_bought_together.active,r.frequently_bought_together_label="crm.filter.label.fbt"===t.suggestion_type.frequently_bought_together.label?I18n.getMsg("crm.filter.label.fbt"):t.suggestion_type.frequently_bought_together.label,r.frequently_bought_together_user_type=t.suggestion_type.frequently_bought_together.user_type?t.suggestion_type.frequently_bought_together.user_type:[]),t.selected_view&&(r.selected_view=t.selected_view,t.selected_view[0].fields&&t.selected_view[0].fields.length)){var i=t.selected_view[0].fields;r.selected_view_fields_1=i[0].id,r.selected_view_fields_2=i[1].id,r.selected_view_fields_3=i[2].id}r.created_by=t.created_by,r.created_time=t.created_time,r.modified_by=t.modified_by,r.modified_time=t.modified_time,r.active=t.active,c.push(r)})),r.recommendations=c),(("createRecord"===t||"updateRecord"===t)&&r.recommendations[0]||"findRecord"===t)&&("createRecord"===t&&(r.recommendations[0].created_by=r.recommendations[0].created_by?r.recommendations[0].created_by:{id:Crm.userDetails.USER_ID,name:Crm.userDetails.DISPLAY_NAME},r.recommendations[0].created_time=r.recommendations[0].created_time?r.recommendations[0].created_time:Date.now()),r.recommendations[0].modified_by=r.recommendations[0].modified_by?r.recommendations[0].modified_by:{id:Crm.userDetails.USER_ID,name:Crm.userDetails.DISPLAY_NAME},r.recommendations[0].modified_time=r.recommendations[0].modified_time?r.recommendations[0].modified_time:Date.now(),r.recommendations=r.recommendations[0]),r}return 403===a||(204===a&&(r.recommendations=[]),204===a&&(r.recommendations=[])),r},serialize:function(e,t,r,i){if(i&&i.payLoad)return i.payLoad;if("createRecord"===e||"updateRecord"===e){var a=[],s={},o=t.recommendations;"updateRecord"===e&&(s.id=o.id),void 0!==o.name&&(s.name=o.name);var n=o.what_module;if(void 0!==n){var l={};l.module={id:n.id,api_name:n.api_name},s.what_to=l}var c=o.what_criteria;void 0!==c&&(s.what_to=s.what_to?s.what_to:{},s.what_to.criteria=c);var d=o.whom_module;if(void 0!==d){var u={};u.module={id:d.id,api_name:d.api_name},s.whom_to=u}var m=o.whom_criteria;void 0!==m&&(s.whom_to=s.whom_to?s.whom_to:{},s.whom_to.criteria=m);var p=o.based_module;if(void 0!==p){var g={};g.module={id:p.id,api_name:p.api_name},s.based_on=g}var f=o.based_timestamp;void 0!==f&&(s.based_on=s.based_on?s.based_on:{},s.based_on.completion_time_field={id:f.id,api_name:f.api_name});var h=o.based_criteria;void 0!==h&&(s.based_on=s.based_on?s.based_on:{},s.based_on.criteria=h);var y={};y.first_buy=void 0!==o.first_buy_active||void 0!==o.first_buy_label||void 0!==o.first_buy_user_type,y.rebuy=void 0!==o.rebuy_active||void 0!==o.rebuy_label||void 0!==o.rebuy_user_type,y.next_buy=void 0!==o.next_buy_active||void 0!==o.next_buy_label||void 0!==o.next_buy_user_type,y.customer_also_bought=void 0!==o.customer_also_bought_active||void 0!==o.customer_also_bought_label||void 0!==o.customer_also_bought_user_type,y.frequently_bought_together=void 0!==o.frequently_bought_together_active||void 0!==o.frequently_bought_together_label||void 0!==o.frequently_bought_together_user_type,(y.first_buy||y.rebuy||y.next_buy||y.customer_also_bought||y.frequently_bought_together)&&(s.suggestion_type={}),Object.keys(y).forEach((function(e){y[e]&&(s.suggestion_type[e]={},void 0!==o[e+"_active"]&&(s.suggestion_type[e].active=o[e+"_active"]),void 0!==o[e+"_label"]&&(s.suggestion_type[e].label=o[e+"_label"]),void 0!==o[e+"_user_type"]&&(s.suggestion_type[e].user_type=o[e+"_user_type"]))}));var v=o.selected_view;void 0!==v&&(s.selected_view=v),void 0!==o.active&&(s.active=o.active),a.push(s),t.recommendations=a}return t},payloadKey:function(e){return e}}),Lyte.Mixin.register("similarity-utils",{getSupportedModules:function(){return store.findAll("module",{feature_name:"similarity"},!1,!1)},lazyFindAll:function(e){return 0===store.peekAll(e).length?store.findAll(e):store.peekAll(e)},lazyFindRecordWithProperty:function(e,t,r){var i=store.peekRecord(e,t);return void 0!==i&&i.hasOwnProperty(r)?store.peekRecord(e,t):store.findRecord(e,t)},routeChangeConfirm:function(e,t){var r=e.pause(),i="create"===t.routeName?"Create":"Edit";_cruxUtils.showCustomAlert({params:{ltPropHeading:I18n.getMsg("crm.zia.vision.unsave.title"),ltPropSecondaryMessage:I18n.getMsg("crm.zia.vision.unsave.msg"),ltPropButtons:[{type:"reject",text:I18n.getMsg("Cancel"),appearance:"default","data-zcqa":"stayInConfigPage"},{type:"accept",text:I18n.getMsg("crm.button.yes.move.away"),appearance:"failure","data-zcqa":"leaveConfigPage"}]},accept:function(){r.resume(),Crm.client_tracking("Zia Similarity Configure",{Action:"CancelConfirm",view:i})},reject:function(){r.abort(),Crm.client_tracking("Zia Similarity Configure",{Action:"CancelReject",view:i})}})},showErrorResponse:function(e,t){var r=e.code;if(["LIMIT_EXCEEDED","DUPLICATE_DATA","NO_PERMISSION","NOT_SUPPORTED"].contains(r))switch(r){case"LIMIT_EXCEEDED":var i=!e.details.module,a=e.details.limit;return void _cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("cpq.pr.rangelimitreached"),ltPropSecondaryMessage:i?I18n.getMsg("zia.similarity.limit.config",a):I18n.getMsg("zia.similarity.limit.module",a),ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.mb.newversion.msg4"),appearance:"primary"}]}});case"DUPLICATE_DATA":return void _cruxUtils.showCustomAlert({params:{ltPropContentAlign:"center",ltPropSecondaryMessage:I18n.getMsg("crm.canvas.rules.name.duplicate",""),ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.mb.newversion.msg4"),appearance:"primary"}]}});case"NO_PERMISSION":case"NOT_SUPPORTED":return void renderingUtils.displayPermissionDenied()}else _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("zia.similarity.message.fail",I18n.getMsg(t)),ltPropType:"error"}})},getAllowedFieldUITypes:function(){return[1,20,21,22,24,25,27,30,32,33,34,36,37,38,40,46,52,127,132,133,143,144,145,200]}}),store.registerModel("similarity",{id:Lyte.attr("string"),name:Lyte.attr("string"),module:Lyte.attr("object"),criteria:Lyte.attr("object",{default:null}),active:Lyte.attr("boolean"),selected_views:Lyte.attr("array")}),store.registerAdapter("similarity",{namespace:"crm/v2.2/",buildURL:function(e,t,r,i,a){return a=a.replace("similarity","settings/zia/similarities")},methodForRequest:function(e){return"PATCH"===e?"PUT":e}}),store.registerSerializer("similarity",{payloadKey:function(e){if(e)return e},normalizeResponse:function(e,t,r,i,a){var s;return 201===a||"deleteRecord"===t||"updateRecord"===t?((s={similarity:{}}).similarity.id=r.zia_similarities[0].details.id,s):200!==a||"findAll"!==t&&"findRecord"!==t?(204===a&&(r.similarity=[]),r):((s={}).similarity=r.zia_similarities,s.similarity.forEach((function(e){e.module=store.peekRecord("module",e.module.id)})),"findAll"===t&&(ZiaConfig.similarityFeatureLimit=r.info.limit),s)},serialize:function(e,t){if("createRecord"===e||"updateRecord"===e){var r={};return r.zia_similarities=[t.similarity],r}return t},serializeRecord:function(e,t){return e.headers["Content-Type"]="application/json;charset=UTF-8",t}}),Lyte.Mixin.register("orchestration",{licenceTypeVsNoOfOrchestrations:{A:3,U:5,C:3,Z:3,D:1},constants:{connectivity:{lookupType:"lookup_field",referenceType:"reference"},supportedModulesRegex:{LeadsContacts:new RegExp("^Leads$|^Contacts$"),LeadsContactsCustom:new RegExp("^Leads$|^Contacts$|^CustomModule"),LeadsContactsAccounts:new RegExp("^Leads$|^Contacts$|^Accounts$")}},currentProcessId:"",unresolvedOrchAPICount:0,currRequestCustomDataType:"",activityModuleList:["Events","Calls","Tasks"],fetchOrchestrationChildModules:function(){return moduleRecordMapping.Orchestration&&moduleRecordMapping.Orchestration.child_module?moduleRecordMapping.Orchestration.child_module.filter((function(e){return"ENTITIES"==e.module_type||e.show_as_tab})):[]},getOrchestrationsCountForLicense:function(){return store.peekAll("orchestration_meta")[0].available_limit},getChartData:function(){var e={canvas:{width:0,height:0}};return e.nodes=this.getNodes(),e.connections=this.getConnections(),e},getNodes:function(){var e=document.getElementById("Orchbuilder"),t=e.querySelector("#OrchbuilderCanvas").style,r=parseInt(t.left,10),i=parseInt(t.top,10);return e.getElementsByClassName("window").map((function(e){var t=e.style,a={};return a.id=e.dataset.stateid,a.pos_x=parseInt(t.left,10)+r,a.pos_y=parseInt(t.top,10)+i,a}))},getConnections:function(){var e=[],t=Lyte.registeredMixins.orchestration_builder.Orchestration.instance.getAllConnections();return $.each(t,(function(t,r){var i=r.getOverlay("label").canvas,a=r.getUuids(),s=a[0],o=a[1],n={transition:{id:i.dataset.transid},from:{state:{id:i.dataset.sourceid},end_point:s.split("_")[2]},to:{state:{id:i.dataset.targetid},end_point:o.split("_")[2]}};e.push(n)})),e},saveChartDataToServer:function(e){(e=e||Lyte.registeredMixins.orchestration_action.getProcessData()).$.set("chart_data",Lyte.registeredMixins.orchestration.getChartData()),e.$.set("autoSaveStatusText",I18n.getMsg("crm.saving")),store.triggerUpdate("orchestration_process",e.id,["chart_data"]).then((function(){e.$.set("autoSaveStatusText",I18n.getMsg("crm.success.save.status",Utils.getCurrentCrmTimeInUserFormat()))}))},getGroupedOrchestration:function(e){var t={};return e.forEach((function(e){t[e.group_id]?t[e.group_id].push(e):t[e.group_id]=[e]})),t},getDisplayableOrchestrationsList:function(e){var t=[],r=this;return Object.keys(e).forEach((function(i){var a=e[i],s=r.getDisplayableOrchestrationInList(a);t.push(s)})),t.sort((function(e,t){return e.sequence_number-t.sequence_number})),t},getSupportedModules:function(){var e=[],t=this,r=["Leads","Contacts","Accounts","Potentials","Tasks","Events","Calls","Products","Quotes","SalesOrders","PurchaseOrders","Invoices","Campaigns","Vendors","PriceBooks","Cases","Solutions"];return store.peekAll("module").forEach((function(i){if(i.module_name){var a=-1!==t.activityModuleList.indexOf(i.module_name)&&moduleRecordMapping.Activities.visible;(-1!==r.indexOf(i.module_name)&&i.visible||a||0===i.module_name.indexOf("CustomModule")&&i.visible&&!crmTab.isZBCustomModule(i.module_name)&&!crmTab.isZECustomModule(i.module_name)&&!crmTab.isZSCustomModule(i.module_name))&&e.push(i)}})),e},callSetupAction:function(e){var t=Crm.getCrmBasePath()+"/SetupAction.do?action="+e,r={};r[csrfParamName]=csrfToken,(new crmRequestPool).doAjax(t,(function(e){"object"!=typeof e&&(e=JSON.parse(e))}),r)},getDisplayableOrchestrationInList:function(e){var t,r;return e.forEach((function(e){t?(("draft"===e.status||"draft"!==t.status&&"active"===e.status||"draft"!==t.status&&"active"!==t.status&&Utils.compareDateandTime(t.modified_time,e.modified_time))&&(t=e),"active"!==r.status&&"draft"!==e.status&&("active"===e.status||"draft"===r.status||Utils.compareDateandTime(r.modified_time,e.modified_time))&&(r=e)):(t=e,r=e)})),t.statusDominatingProcess=r,t.records_count=r.records_count,t},responseHandlerForAPI:function(e){if(commonUtils.showHideLoadingDiv(),e&&400===e.status&&e.responseText){var t,r=JSON.parse(e.responseText);if(r.orchestrations?t=r.orchestrations[0].message:r.states?t=r.states[0].message:r.transitions&&(t=r.transitions[0].message),"server and client are not in sync"===t){var i=$L("#orchSyncModal");i.length&&(i[0].ltProp("show",!0),Lyte.registeredMixins.orchestration_config.domElements.orchSyncModal.show=!0)}else"No such orchestration exists"===t&&this.transitionToOrchestrationIndex();Lyte.registeredMixins.orchestration.currRequestCustomDataType=""}e&&401==e.status&&(renderingUtils.displayPermissionDenied(),Lyte.registeredMixins.orchestration.currRequestCustomDataType="")},transitionToOrchestrationIndex:function(){Lyte.Router.getRouteInstance().transition.data.noNeedToShowErrorMsg?Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.orchestration.index-orchestration"):Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.orchestration.index-orchestration").data={invalidProcess:!0}},routeErrorHandling:function(e){if(e.response){var t=JSON.parse(e.response);t.orchestrations&&(t=t.orchestrations[0]);var r=$(".dummy_Body");switch(t.code){case"INVALID_DATA":this.transitionToOrchestrationIndex();break;case"NO_PERMISSION":renderingUtils.displayPermissionDenied(),r.hide();break;case"FEATURE_NOT_SUPPORTED":renderingUtils.displayPermissionDenied(void 0,void 0,I18n.getMsg("crm.zes.mobile.error.feature")),r.hide();break;default:crmui.showMsgBand("error",I18n.getMsg("error.database.problem"),3e3),r.hide()}}else crmui.showMsgBand("error",I18n.getMsg("error.database.problem"),3e3),$(".dummy_Body").hide()},getCachedOrchestrationList:function(){return store.peekAll("orchestration_process").filter((function(e){return!e.$.isNew}))},unloadAllOrchestrationsExcept:function(e){store.peekAll("orchestration_process").map((function(e){return e.id})).each((function(t){t!==e&&store.unloadRecord("orchestration_process",t)}))}}),Lyte.Mixin.register("chat-setup-mixin",{getDependencies:function(){return networkUtils.returnDependencyFiles(["chat-setup-store.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-chat-setup.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-chat-setup.css"],crmConstants.cssStaticPathForLyte),r=e.concat(t);return r=r.concat(networkUtils.returnDependencyFiles(["zohocrm_chatIntegration.js",networkUtils.getI18nJSUrl("chatintegrations")],crmConstants.jsStaticPath))},beforeModel:function(){if(!Crm.userDetails.IS_ADMIN)return renderingUtils.displayPermissionDenied(),Lyte.Router.getRouteInstance().transition.abort(),!1;var e,t="cliq"===this.routeName,r=this.transition.data;if(r&&(e=r.integrationEnabled),t&&"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()&&!e){CrmPlusImpl.trigger("enableApplication",["ZohoCliq",function(){Lyte.Router.transitionTo("crm.settings.section.extensions.zoho-extensions.cliq")}])}if("C"!==Crm.userDetails.LICENSE_TYPE&&"Z"!==Crm.userDetails.LICENSE_TYPE&&"Y"!==Crm.userDetails.LICENSE_TYPE){var i=this;store.triggerAction("rso_configuration","get_rso_info",{},{},"GET").then((function(e){if(null!=e.remote_sales_office){var t,r=e.remote_sales_office.length;1===r?t="zoho_cliq"===e.remote_sales_office[0].service:2===r&&(t="zoho_cliq"===e.remote_sales_office[0].service||"zoho_cliq"===e.remote_sales_office[1].service),t&&i.transitionTo("crm.settings.section.extensions.zoho-extensions.remote-sales-office.information")}}))}},model:function(){var e="cliq"===this.routeName?this.routeName:"cisco",t=this.transition,r=t.info.queryParams,i=function(e){var t={type:"cisco"};return t.active="FEATURE_ALREADY_ENABLED"===e,t};if("cisco"===e&&r.activate)return store.triggerAction("chat_setting","toggleIntegration",{type:"cisco",active:!0}).then((function(){return{type:e,active:!0}}),(function(e){return chatIntegration.handleErrorResponse(e,void 0,void 0,i)}));return store.findAll("chat_setting",{type:e},!1).then((function(e){return e[0]}),(function(e){var r=JSON.parse(e.response);(r&&"PERMISSION_DENIED"===r.code||"FEATURE_NOT_SUPPORTED"===r.code)&&(renderingUtils.displayPermissionDenied(),t.abort())}))},renderTemplate:function(){return{outlet:"cliq"===this.routeName?"#result":"#internalExtensionDetail",component:"crm-chat-setup"}}}),Lyte.Mixin.register("crm-module-mixin",{setProperty:function(e,t){var r=e.id,i=e.sections;if(i){var a=i.length,s=[],o=e.module?e.module.id:void 0;if(t&&t.set_available_user_layout&&("active"===e.status||"hidden"===e.status))var n=store.peekRecord("user",Crm.userDetails.USER_ID).profile.name,l=e.profiles.find((e=>e.name===n));for(var c=0;c<a;c++){var d=i[c];t&&t.apiVersion&&"2.2"==t.apiVersion&&(d.uid=d.id),d.id=r+"_"+c;for(var u=d.fields,m=u.length,p=0;p<m;p++){var g=u[p];if(d.isSubformSection&&(g.subform_api=!0),t&&t.moduleSet&&(t.subformModuleSet||!g.subform_api||g.subform_api&&"subform"===g.data_type)&&(g.module=o?[o]:[]),l&&(g.available_in_user_layout=!0),s.push(g.id),g.lookup&&g.lookup.query_details){const e=store.peekRecord("field",g.id);e&&e.lookup&&e.lookup.query_details&&(g.lookup.query_details.criteria=e.lookup.query_details.criteria||g.lookup.query_details.criteria)}if("used"===d.type||d.screen||!t||"lyteCreate"!==t.from){if(g.pick_list_values&&g.pick_list_values.length){if(store.model.field.fieldList.hasOwnProperty(r))if(validationUtils.isNotEmpty(g[r])){(h=g[r]).pick_list_values=g.pick_list_values,h.default_value=g.default_value,g[r]=h}else g[r]={pick_list_values:g.pick_list_values,default_value:g.default_value};else store.addField("field",r,"object"),g[r]={pick_list_values:g.pick_list_values,default_value:g.default_value};var f=store.peekAll("field").filterBy({id:g.id});!f[0]||!f[0].pick_list_values||t&&0==t.peekField||(g.pick_list_values=f[0].pick_list_values),g.enable_colour_code&&(g.picklist_colour_codes=g.pick_list_values.slice(0)),g.colour_code_enabled=g.enable_colour_code}if(null!=g.sequence_number)if(store.model.field.fieldList.hasOwnProperty(r))if(validationUtils.isNotEmpty(g[r])){var h;(h=g[r]).sequence_number=g.sequence_number,h.required=g.required,"boolean"===g.data_type&&g.default_value&&(h.default_value=g.default_value),g[r]=h}else g[r]={sequence_number:g.sequence_number,required:g.required},"boolean"===g.data_type&&g.default_value&&(g[r].default_value=g.default_value);else store.addField("field",r,"object"),g[r]={sequence_number:g.sequence_number,required:g.required},"boolean"===g.data_type&&g.default_value&&(g[r].default_value=g.default_value);g.convert_mapping&&(void 0===g[r]&&(g[r]={}),g[r].convert_mapping=g.convert_mapping)}}}store.model.layout.fieldList.hasOwnProperty("fields")&&(e.fields=s)}},getfieldattributeType:function(e){var t;return t=116==e.ui_type&&crmConstants.entityforumlaMapping[e.formula.return_type]?crmConstants.entityforumlaMapping[e.formula.return_type]:crmConstants.entityuiTypeMapping[e.ui_type]?crmConstants.entityuiTypeMapping[e.ui_type]:crmConstants.entitycolumnMapping[e.column_name]?crmConstants.entitycolumnMapping[e.column_name]:crmConstants.entityjsonTypeMapping[e.json_type]?crmConstants.entityjsonTypeMapping[e.json_type]:"string"==e.json_type&&"currency"==e.data_type?"number":e.json_type?e.json_type:"string","REMINDAT"==e.column_name&&(t="object"),t},unloadProperty:function(e,t){var r=t&&Array.isArray(t)?Array.from(t):t;r&&e&&r.forEach((function(t){store.unloadRecord(e,t.id)}))},unloadModuleProperty:function(e){for(var t in moduleRecordMapping)moduleRecordMapping[t][e]&&(moduleRecordMapping[t][e]=void 0)},addSubformFieldsintoLyteModel:function(e){var t,r=!1;e&&e.forEach((function(e){var i={};i.id=Lyte.attr("string"),r=!1,e.isSubformSection&&e.fields&&e.fields.forEach((function(e){"subform"===e.data_type?(r=!0,t=e.subform.id):e.subform||(i[e.api_name]=Lyte.attr(Lyte.registeredMixins["crm-module-mixin"].getfieldattributeType(e)),i[e.api_name].fieldID=e.id,i[e.api_name].uiType=e.ui_type,i[e.api_name].columnName=e.column_name,i[e.api_name].fieldType=e.data_type,i[e.api_name].length=e.length)}));var a=store.model[t];if(a&&r&&Lyte.Component.registeredHelpers.isNotEmpty(i))for(var s in i.__CUSTOM_sequence_NUMBER__={type:"string"},i.removedRow={type:"string"},i)a.fieldList[s]||store.addField(t,s,i[s].type,i[s])}))}}),Lyte.Mixin.register("crm-create-mixin",{getLayoutPromise:function(e,t,r,i,a,s,o,n,l){if(s&&(freezeBackground(),commonUtils.showHideLoadingDiv(!0)),e){var c={},d={},u={layoutId:e,moduleSet:!0,peekField:!1,from:"lyteCreate"};if(l&&(u.mode=l),void 0!==s?n?(d.moduler=store.findRecord("module",moduleRecordMapping[r].id,void 0,void 0,!0,u),d.wizard=store.findRecord("wizard",s,{layout_id:e,from_cache:!0})):(d.moduler=store.findRecord("module",moduleRecordMapping[r].id,void 0,void 0,!0,u),d.wizard=store.findRecord("wizard",s,{layout_id:e,from_cache:!0}).then((function(e){return i&&"string"!=typeof i&&(store.pushPayload(moduleRecordMapping[r].id,i[moduleRecordMapping[r].id][0]),i.meta&&(c.originalData=i.meta.original)),e}))):d.layout=store.findRecord("module",moduleRecordMapping[r].id,{include_inner_details:"lookup.query_details.criteria"},void 0,!0,u).then((function(t){return i&&"string"!=typeof i&&(store.pushPayload(moduleRecordMapping[r].id,i[moduleRecordMapping[r].id][0]),i.meta&&(c.originalData=i.meta.original)),t?t[0].layouts.filter((function(t){return t.id===e})):void 0})),s){if(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.WLRINVOLVEDMODULES&&-1!==Crm.userDetails.WLRINVOLVEDMODULES.indexOf(r)){var m={comparator:"equal",api_name:"wizard.id",value:s||"null"};d.layout_rules=store.findAll("layout_rule",{module:t,filters:JSON.stringify(m)},!1,!1,e)}}else(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(r))&&(d.layout_rules=new Promise((function(r){return store.findAll("layout_rule",{module:t},!1,!1,e).then((function(e){r(e)}),(function(){r()}))})));(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(r))&&(d.validation_rules=new Promise((function(r){return store.findAll("validation_rule",{layout_id:e,module:t,download_rules:!0},!1).then((function(e){r(e)}),(function(){r()}))}))),i&&!a&&(d.current_record=store.findRecord(moduleRecordMapping[r].id,i,{approved:"both",converted:"both"}).then((function(e){return e.$.meta&&(c.originalData=e.$.meta.original),e})));var p=store.peekRecord("layout",e);return p&&"Campaigns"===r&&("Zoho Survey"!==p.name||"2"!==p.status&&"campaign_integration"!==p.source||(d.surveyDepartments=store.triggerAction("module","survey_departments",{type:"GET"})),"system"!==p.generated_type||"webinar"!==p.created_for&&"Zoho Webinar"!==p.name||"campaign_integration"!==p.source||(d.webinarIntegration=new Promise((function(e){return store.findAll("webinar").then((function(t){e(t)}),(function(){e()}))})))),Lyte.resolvePromises(d).then((function(t){if(s)if(c.wizard=t.wizard,c.wizard&&c.wizard.length){var i=c.wizard.filter((function(e){return!!e.profiles.mapBy("id").contains(userInfo.users[0].profile.id)}));c.wizard=i}else store.unloadRecord("wizard-container",e);else c.layout=t.layout;if(t&&t.layout_rules&&t.layout_rules.layout_rule){for(var a=t.layout_rules.layout_rule.length,o=0;o<a;o++)t.layout_rules.layout_rule[o].id=e+"_"+o,t.layout_rules.layout_rule[o].layout=e;store.pushPayload("layout_rule",t.layout_rules.layout_rule),c.layout_rule=t.layout_rules.layout_rule}return(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(r))&&(c.validation_rule=t.validation_rules),t.surveyDepartments&&(c.survey_departments=t.surveyDepartments?t.surveyDepartments.survey_departments:[]),t.webinarIntegration&&(c.webinarIntegration=t.webinarIntegration?t.webinarIntegration[0]:void 0),c}))}return"Tasks"!=r||store.model[moduleRecordMapping[r].id]&&moduleRecordMapping[r].fields?i?store.findRecord(moduleRecordMapping[r].id,i,{approved:"both",converted:"both"},void 0,!1).then(function(e){var i,a=e[moduleRecordMapping[r].id][0];if(a){if(!o&&(!a.Layout||validationUtils.isEmpty(a.Layout))){var s=moduleRecordMapping[r].layouts.filter((function(e){return e.status>=0||"active"===e.status}))[0];i=s?s.id:i}return this.getLayoutPromise(o||(i||a.Layout.id),t,r,e,!0,!validationUtils.isNotEmpty(a.Wizard)||this.transition.data.layoutId||"draft"!==a.$state&&"save"!==a.$state?void 0:a.Wizard.id)}}.bind(this)):void 0:store.findRecord("module",moduleRecordMapping.Tasks.id).then(function(e){return i?store.findRecord(moduleRecordMapping[r].id,i,{approved:"both",converted:"both"},void 0,!1).then(function(i){var a=i[moduleRecordMapping[r].id][0];return this.getLayoutPromise(o||e[0].layouts[0].id,t,r,i,!0,a.Wizard&&"draft"===a.$state&&!this.transition.data.layoutId?a.Wizard.id:void 0)}.bind(this)):this.getLayoutPromise(e[0].layouts[0].id,t,r,i,a,s,o)}.bind(this))},initEnrichDataFetchProcess:function(e,t,r){var i=Lyte.Router.getRouteInstance().currentModel.auto_enrichment_id;if(i){var a=store.peekRecord("auto_enrichment",i);if(a.enrichUsedCount>=a.enrichLimitCount)return;var s={Company:"c",Website:"w",Email:"e",Account_Name:"c"};void 0===Crm.lc_AE_data.recordObj.recordidentification?Crm.lc_AE_data.recordObj.recordidentification=s[t]+"|:|"+e:Crm.lc_AE_data.recordObj.recordidentification=Crm.lc_AE_data.recordObj.recordidentification+"||"+s[t]+"|:|"+e;var o={Company:"companyname",Website:"companywebsite",Email:"emailid",Account_Name:"companyname"};if($L(this.$node).parents("crm-create-layout")[0]){var n=Crm.lc_AE_data.lastEnrichFieldsAndData;(validationUtils.isEmpty(n)||n[o[t]]!==e)&&(n[o[t]]=e,Crm.lc_AE_data.lastEnrichFieldsAndData=n,r=!0)}if(Crm.lc_AE_data.recordObj[o[t]]=e,r&&!validationUtils.isEmpty(Crm.lc_AE_data.recordObj)){var l=Crm.lc_AE_data.recordObj.recordidentification,c=/^[\x00-\xFF]*$/.test(l),d=Crm.lc_AE_data.recordObj.emailid,u=validationUtils.isValidEmail(d);if(!c)return void renderingUtils.showCustomAlert(I18n.getMsg("crm.auto.enrich.otherlanguage.unsupported"));if(d&&d.length>0&&!u)return;var m=$L(".LeadEnrichmentLinkhere");m.is(":visible")&&(m.addClass("onprocessEnrichment"),m.attr({onmouseenter:"zctt.showtt('"+I18n.getMsg("crm.data.enrich.fetching.info")+"')",onmouseleave:"zctt.hidett()",onClick:""})),clearTimeout(this.diTimeout),this.diTimeout=setTimeout(function(){this.getDataFromDI()}.bind(this),100)}}},lastEnrichFieldsAndData:{},getDataFromDI:function(e){this.requestObj&&(this.requestObj.abort(),this.requestObj=null),void 0!==e&&(Crm.lc_AE_data.recordObj=e);var t={action:"fetch",reqjson:JSON.stringify({callback:"server",identification:this.getData("moduleData.module_name"),recordlist:[Crm.lc_AE_data.recordObj]})},r=this;Crm.lc_AE_data.recordObj&&Crm.lc_AE_data.recordObj.recordidentification&&(CAEExec.lastRecordIdentify=Crm.lc_AE_data.recordObj.recordidentification),void 0===CAEExec.enrichStatus||1===CAEExec.enrichStatus?CAEExec.enrichStatus=0:2!==CAEExec.enrichStatus&&4!==CAEExec.enrichStatus||(CAEExec.enrichStatus=3),this.requestObj=new crmRequestPool,this.requestObj.initiate({action:"/crm/v2/settings/auto_enrichment/getEnrichDatafromDI",type:"POST",data:t,headers:{"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken},success:function(e){r.requestObj=null;var t=null;t=e.auto_enrichment?e.auto_enrichment:e,document.getElementsByTagName("crm-create-layout")[0]&&(Crm.lc_AE_data.enrichedData=t,t.status&&(t.status.indexOf("completed")>-1||t.status.indexOf("success")>-1)?r.setEnrichDataAndNotify(t):validationUtils.isEmpty(t)?($("#loadingDotDiv,#enrichDataSearchDiv,#enrichPopupSaveBtn,#enrichPopupCancelBtn").hide(),$("#enrichPopupDoneBtn,#connectProbInfoDiv").show(),CAEExec.init()):($("#waitEnrichInfoDiv,#enrichDataSearchDiv,#enrichPopupSaveBtn,#enrichPopupCancelBtn").hide(),$("#enrichPopupDoneBtn").show(),$("#dataSyncInfoDiv").text(I18n.getMsg("crm.auto.enrich.no.data",moduleRecordMapping[Lyte.Router.getRouteInstance("crm.tab.module").getDynamicParam()].singular_label)).show(),$("#loadingDotDiv").hide()))},error:function(e){if("abort"!==e.statusText&&"entityCreate"!==CAEExec.modeOfRecord)return renderingUtils.showCustomAlert(I18n.getMsg("crm.translation.error.history")),!1}})},recordObj:{},setEnrichDataAndNotify:function(e){var t=e.recordlist[0],r=t.recordidentification,i=$L("#createEnrichLink");if(Crm.lc_AE_data.recordObj.recordidentification===r)if(i.css("display","inline-block"),CAEExec.enrichedData=e,0===CAEExec.enrichStatus?CAEExec.enrichStatus=1:3===CAEExec.enrichStatus&&(CAEExec.enrichStatus=4),"notfound"!=t.status){i.is(":visible")&&(i.removeClass("onprocessEnrichment"),i.attr({onmouseenter:"",onmouseleave:""})),this.setBasedOnInfoForToolTip(t);var a=$L("#enrichPopupDiv"),s=$L("#enrichMapDiv"),o=a.is(":visible"),n=s.is(":visible");o&&n?_cruxUtils.showCustomAlert({params:{id:"enrichedDataRefreshDiv",ltPropSecondaryMessage:I18n.getMsg("crm.auto.enrich.confirm.refresh"),ltPropWrapperClass:"cruxEnrichBold enrichRefreshAlertWrapper",ltPropButtons:[{type:"reject",text:I18n.getMsg("crm.label.auto.enrich.deactivate.confirm.no"),appearance:"error"},{type:"accept",text:I18n.getMsg("crm.auto.enrich.confirm.refresh.yes")}],ltPropPrimaryMessage:I18n.getMsg("crm.label.auto.enrich.refresh.latest.data"),ltPropButtonPosition:"right"},accept:function(){$L("crm-create-layout")[0].component.showEnrichCompValues()}}):o&&!n&&this.showEnrichCompValues()}else i.is(":visible")&&(i.hasClass("onprocessEnrichment")&&(i.removeClass("onprocessEnrichment"),i.attr({onmouseenter:"",onmouseleave:""})),i.hide());setTimeout((function(){0===$("#enrichmentInnerTableDiv").find("input:checked").length?$("#enrichPopupSaveBtn").addClass("disabled").prop("disabled",!0):$("#enrichPopupSaveBtn").removeClass("disabled").prop("disabled",!1)}),2e3)},setBasedOnInfoForToolTip:function(e){for(var t=e.recordidentification.split("||"),r=t.length,i=[],a={c:"crm.security.user.orgName",w:"crm.phonebridge.website",e:"crm.email.chk"},s=0;s<r;s++){var o=t[s].split("|:|");i.push(I18n.getMsg(a[o[0]])),i.push(o[1])}var n=document.getElementsByTagName("crm-create-layout")[0];1===r?n.setData("tooltipInfo",I18n.getMsg("crm.auto.enrich.found.info1",i)):2===r?n.setData("tooltipInfo",I18n.getMsg("crm.auto.enrich.found.info2",i)):3===r&&n.setData("tooltipInfo",I18n.getMsg("crm.auto.enrich.found.info3",i))},getModulePromise:function(e,t,r,i,a,s,o,n){var l,c,d,u,m,p={},g={};p.batchRequest1=this.getLayoutPromise(e,t,r,i,!!a,a,s,o,n),"Activities"!=r&&"Calls"!=r&&"Tasks"!=r&&"Events"!=r&&(d=!0,store.clearCachedQuery("custom_button",{module:t}),g.custom_button=new Promise((function(e){return store.findAll("custom_button",{module:t}).then((function(t){e(t)}),(function(){e()}))}))),"Quotes"!=r&&"Purchase Orders"!=r&&"Sales Orders"!=r&&"Invoices"!=r||(l=!0,g.tax_detail=store.findAll("tax-detail")),Crm.userDetails.CLIENT_ACCOUNT||!featuresAvailable.Data_Enrichment||"Leads"!==r&&"Contacts"!==r&&"Accounts"!==r||(c=!0,g.auto_enrichment=new Promise((function(e){return store.findAll("auto_enrichment",{module:r},!1,!0).then((function(t){e(t)}),(function(){e()}))}))),"Potentials"!=r&&"Deals"!=r||(u=!0,g.fc_category=new Promise((function(e){return store.findAll("dummy",{module:"Deals"},!1,!1,{url:"/crm/v2.1/settings/stages"}).then((function(t){e(t)}),(function(){e()}))})));var f=RebrandLinkUtil.getProperty("DeploymentLocation");if("Accounts"===r&&"China"===f&&(m=!0,g.skyEyeIntegration=new Promise((function(e){return store.findAll("dummy",{},!1,!1,{url:"/crm/v2/__internal/settings/skyeye"}).then((function(t){e(t)}),(function(){e()}))}))),validationUtils.isNotEmpty(Crm.userDetails.CURRENCY_DETAILS)){var h=store.peekRecord("user",Crm.userDetails.USER_ID);h&&!h.Currency&&(g.currentUser=new Promise((function(e){return store.findRecord("user",Crm.userDetails.USER_ID).then((function(t){e(t)}),(function(){e()}))})))}return p.batchRequest2=Lyte.resolvePromises(g).then((function(e){var t={};return d&&(t.custom_button=e.custom_button),l&&(t.tax=e.tax_detail),c&&(t.auto_enrichment=e.auto_enrichment),u&&(t.fc_category=e.fc_category),m&&(t.skyEyeIntegration=e.skyEyeIntegration),t.currentUser=store.peekRecord("user",Crm.userDetails.USER_ID),t})),Lyte.resolvePromises(p).then((function(e){for(var t={},r=1;r<=2;r++)for(var i in e["batchRequest"+r])t[i]=e["batchRequest"+r][i];return t}))},framesSubformPromiseObject:function(e){for(var t=[],r=e.length,i=0;i<r;i++)if(e[i].isSubformSection||"subforms"===e[i].type)for(var a=e[i].fields,s=a.length,o=0;o<s;o++)if("subform"==a[o].data_type){var n=a[o].api_name;e[i].subform_apiname=n,t&&t.push(n);break}this.setData("currsubformApinames",t)},hideEmptySection:function(e){for(var t=this.getData("initRoute"),r=e.fields,i=!1,a=r.length,s=0;s<a;s++)if(r[s]&&r[s].visible&&Lyte.Component.registeredHelpers.getViewtype(r[s].view_type,t)){i=!0;break}i||(Lyte.Component.set(e,"isvalidSection",!1),e.haveValidFields=!1)},haveValidFldsinSection:function(e,t){for(var r=this.getData("initRoute"),i=e.fields,a=!1,s=i.length,o=0;o<s;o++)i[o]&&i[o].visible&&Lyte.Component.registeredHelpers.getViewtype(i[o].view_type,r)&&(a=i[o].api_name!=t,e.haveValidFields=!0);return a},getuserCurrencydata:function(e,t,r){var i,a={};if(r&&r.Currency)i=r.Currency;else{var s=store.peekRecord("user",Crm.userDetails.USER_ID);i=s?s.Currency:void 0}var o=(i=e||i)||(Crm.userDetails.defaultOrgCurrency?Crm.userDetails.defaultOrgCurrency:Crm.userDetails.BASE_CURRENCY?Crm.userDetails.BASE_CURRENCY:"");a.currentCurrency=o,a.currencyDetails=Crm.userDetails.CURRENCY_DETAILS;var n={};for(var l in Lyte.Component.registeredHelpers.isNotEmpty(a.currencyDetails)||(o&&"string"==typeof o?n.symbol=o:n=o),a.currencyDetails)if(l===a.currentCurrency||a.currencyDetails[l]&&a.currencyDetails[l].symbol===a.currentCurrency){(n=a.currencyDetails[l]).key=l;break}var c=n?n.er&&n.decimals?Number(n.er).toFixed(n.decimals):n.er:"";return n&&c&&(n.updatedER=c),n&&Object.keys(n).length||((n=n||{}).symbol=o),n},expandTextarea:function(e,t,r,i){var a,s,o,n=$(e),l="subform"==r?165:354,c=18,d=0,u=n.val(),m=n.parents("lyte-input");$L.fastdom.measure((function(){i.textContent=u,a=i.offsetHeight,s=e.offsetWidth,o=e.clientWidth+3})),$L.fastdom.mutate(function(){if(0==a&&t&&"focus"==t.type)d=54;else if(0==a&&t&&"focusout"==t.type)d=c;else{d=c*(a/c)+54,"subform"===r&&a&&(this.data.databindSubform.expandTAonDrag=!0)}"subform"===r&&t&&"focusout"===t.type&&(d=a<c?c:a+36);var e=d>=l?l:d;n.css("height",e),m&&m.css("height",e),s>o?m.addClass("has-scroll"):m.removeClass("has-scroll")}.bind(this))},validateSubformData:function(e){if(Crm.userDetails.isMandatorySubFormEnabled){var t=document.querySelectorAll("crm-create-subformsection"),r=t?t.length:0;if(r>0)for(var i=0;i<r;i++){var a=!1,s=t[i],o=s.component.data;if(o.subformsectionData.isvalidSection){var n=o.subFieldsarray,l=n.length,c=o.dataBind[o.apiName];if(0===c.length&&!o.isMandatorySubform){var d=s.component.$node.component.data,u=store.createRecord(d.subformId,{},!0);o.dataBind[o.apiName].add(u),c=o.dataBind[o.apiName]}for(var m=_.clone(c),p=m.length,g=0;g<p;g++){for(var f=!1,h=0;h<l;h++)if(500!==n[h].ui_type&&"SERIAL_NUMBER"!==n[h].column_name&&(2!==n[h].ui_type||"-None-"!==m[g][n[h].api_name])&&(100!==n[h].ui_type||"[]"!==m[g][n[h].api_name])&&m[g][n[h].api_name]){f=!0,a=!0;break}if(f)for(v=(y=o.mandatoryFields).length,b=0;b<v;b++){(L=e[o.apiName][0].$.model.fieldList[y[b].api_name]).mandatory=!0,store.addField(e[o.apiName][0].$.model._name,y[b].api_name,L.type,L,!1),e[o.apiName][0].$.model.fieldList[y[b].api_name].mandatory=!0}else if(c.length>1)c.remove(m[g]);else if(1===c.length)for(var y,v=(y=o.mandatoryFields).length,b=0;b<v;b++){(L=e[o.apiName][0].$.model.fieldList[y[b].api_name]).mandatory=!1,store.addField(e[o.apiName][0].$.model._name,y[b].api_name,L.type,L,!1)}}if(a)for(C=(w=o.mandatoryAggregateFields).length,D=0;D<C;D++){(L=e.$.model.fieldList[w[D].api_name]).mandatory=!0,store.addField(e.$.model._name,w[D].api_name,L.type,L,!1)}else for(var w,C=(w=o.mandatoryAggregateFields).length,D=0;D<C;D++){var L;(L=e.$.model.fieldList[w[D].api_name]).mandatory=!1,store.addField(e.$.model._name,w[D].api_name,L.type,L,!1)}}}}},isErrorExistInData:function(e,t,r,i,a){var s=!1,o=this.getData("currsubformApinames");if(validationUtils.isNotEmpty(i))for(var n in i){var l=0;i[n].forEach((function(t){if(e[n][l].id==t.recId){var r=e[n][l].$.model.fieldList;for(var i in t.errorObj)"picklist"!=r[i].fieldType&&"multiselectpicklist"!==r[i].fieldType&&"lookup"!==r[i].fieldType||"ERR02"!=t.errorObj[i].code||e[n][l].$.error[i]||!r[i].mandatory||(e[n][l].$.isError=!0,e[n][l].$.error[i]=t.errorObj[i])}l++}))}if(o.length>0){var c=this.data.moduleSections||[];c=(c=this.data.moduleSections.filter((function(e){return e.isSubformSection||"subforms"===e.type})))||[],o.forEach((function(t){var r=c.filter((function(e){return e.subform_apiname===t}))[0];r&&r.isvalidSection?e[t].forEach((function(e){e.show=!1,Lyte.Component.registeredHelpers.isNotEmpty(e.$.error)&&(s=!0)})):r&&!r.isvalidSection&&e[t].forEach((function(e){if(validationUtils.isNotEmpty(e.$.error))for(var t in e.$.error)delete e[t];store.$.clrRecErr(e.$)}))}))}return e.$.isError&&validationUtils.isNotEmpty(e.$.error)||s||validationUtils.isNotEmpty(e.lookupError)?(this.validateSubform(t,r,a),this.failureFun(e.$.error,t,void 0,void 0,void 0,r,a),this.focusErrorField(t),!(t.skipMandatoryCheck&&!t.isValidErrorPresent)):this.checkAllMandatorySubForms(r,t)?void 0:(this.focusErrorField(t),!0)},getLatestErrorFocusField:function(e,t,r,i,a,s,o){return 0==e.prevOfftop||e.prevOfftop>t?(e.prevOfftop=t,e.prevOffLeft=r,e.firstErrorfield=i,e.issubform=a,e.isaggField=s,e.isSubformSection=o):e.prevOfftop==t&&e.prevOffLeft>r&&(e.prevOfftop=t,e.prevOffLeft=r,e.firstErrorfield=i),e},setErrorObject:function(e,t,r,i,a){if(t.isError=!0,r){var s=$L(e).parents("crm-create-subformsection")[0];s&&!s.component.data.aggerrorDetails&&Lyte.Component.set(s.component.data,"aggerrorDetails",{}),Lyte.Component.set(s.component.data.aggerrorDetails,i,t),a||(e.querySelector("input").classList.add("cuserrorAborder"),e.classList.add("lcAggError"))}else Lyte.Component.set(e.component.data,"errorDetails",t)},focusErrorField:function(e){$L.fastdom.measure((function(){if(e&&e.firstErrorfield){if(e.firstErrorfield.component&&e.firstErrorfield.getData("isNoErrorFocus"))return;var t;if(e.isaggField)e.firstErrorfield&&e.firstErrorfield.focus();else if(e.firstErrorfield&&e.firstErrorfield.component){var r=e.firstErrorfield.component.data,i=r.moduledataUicomp?r.moduledataUicomp.data_type:r.subformFields?r.subformFields.data_type:"";if(r.moduledataUicomp&&"Native__Survey__Extn__Survey"==r.moduledataUicomp.api_name)i=(a=e.firstErrorfield.querySelector("lyte-dropdown"))&&"-None-"==a.ltProp("selected")?"picklist":i;switch(e.firstErrorfield.getData("lyteViewPort")&&e.firstErrorfield.setData("lyteViewPort",!1),i){case"multiselectpicklist":(t=(a=e.firstErrorfield.querySelector("lyte-dropdown"))?a.querySelector("input"):void 0)&&t.focus(),a&&a.toggle();break;case"picklist":var a;(a=e.firstErrorfield.querySelector("lyte-dropdown"))&&((t=a?a.querySelector(".lyteDummyEventContainer"):void 0)&&t.focus(),a&&a.toggle());break;default:var s;if(e.isSubformSection||((s=e.firstErrorfield.component.getData("errorDetails")).inFocusNow=!0,e.firstErrorfield.component.setData("errorDetails",s)),t=e.firstErrorfield.querySelector("lyte-input")){t.blur(),t.focus();var o=$L(t).parents(".FValue");o&&o[0]&&o[0].classList.contains("cuserrorFborder")&&(o[0].classList.remove("cuserrorFborder"),setTimeout((function(){o&&o[0]&&o[0].classList.add("cuserrorFborder")}),500))}else{var n=e.firstErrorfield.getData("moduledataUicomp.data_type");e.isSubformSection&&void 0===n&&(n=r.subformFields.data_type),(Crm.userDetails.isPhoneNoNewView&&"phone"===n||"multiselectlookup"===n)&&e.firstErrorfield.querySelector("input").focus(),e.isSubformSection&&301===r.subformFields.ui_type&&(e.firstErrorfield.component.setData("errorDetails",s),(t=e.firstErrorfield.querySelector("lyte-checkbox"))&&(t.blur(),t.focus()))}}}}}))},handleValidationRuleCondition:function(e,t,r,i,a,s,o){var n=e.primary_condition,l=i.checkCriteriaMatch(n,a,void 0,r,i);void 0!==l&&("success"===r&&l?i.handleExecutionType(e,t,i,a,r,s,o):"failure"!==r||l||i.handleExecutionType(e,t,i,a,r,s,o))},handleExecutionType:function(e,t,r,i,a,s,o){var n=e.sub_conditions.length,l=store.peekRecord("field",s);if(n>0)for(var c=0;c<n;c++){var d=e.sub_conditions[c];if(r.checkCriteriaMatch(d.criteria,i,!0,a,r)){l.isSecVal=!0,o.push({message:d.alert,targetField:t,targetFieldId:s});break}}else l.isSecVal=!0,o.push({message:e.alert,targetField:t,targetFieldId:s})},setValidationError:function(e,t,r,i,a){var s=r.getData("moduleData.fields").filter((function(e){return e.id==i}))[0],o=r.getData("module")+"_fldRow_"+s.column_name,n=$L("crm-create-fields#"+o)[0],l={isError:!0};if(l.inFocusNow=!a,l.isVRError=!0,l.message=$ESAPI.encoder().encodeForHTML(e),!n&&!(n=(n=document.querySelectorAll(".aggField."+t))&&n.length>=1?n[0]:void 0)&&validationUtils.isNotEmpty(s.subform)){var c=r.getData("moduleData.aggerrorDetails");r.setData("moduleData.aggerrorDetails",validationUtils.isNotEmpty(c)?c:{}),Lyte.Component.set(r.getData("moduleData.aggerrorDetails"),t,l)}if(!!n&&!!n.classList.contains("aggField")){var d=$L(n).parents("crm-create-subformsection")[0];if(d&&!d.component.data.aggerrorDetails&&Lyte.Component.set(d.component.data,"aggerrorDetails",{}),Lyte.Component.set(d.component.data.aggerrorDetails,t,l),a)return;n.querySelector("input").classList.add("cuserrorAborder"),n.classList.add("lcAggError")}else{var u=n?n.component.data:void 0,m="edit"==r.getData("initRoute")?"edit":"create";if(s.view_type[m]&&s.visible&&!s.read_only)if(u){if(n&&n.getData("lyteViewPort")&&n.setData("lyteViewPort",!1),Lyte.Component.set(u,"errorDetails",l),a)return;if("picklist"==s.data_type){var p=n.querySelector("lyte-dropdown");(p=p?p.querySelector(".lyteDummyEventContainer"):void 0)&&(p.focus(),setTimeout((function(){$(p).blur()}),500))}else{var g="boolean"===s.data_type?n.querySelector("lyte-checkbox"):n.querySelector("lyte-input");g?g.focus():Crm.userDetails.isPhoneNoNewView&&"phone"===s.data_type&&n.querySelector("input").focus()}}else s.$.set("errorDetails",l)}},resetCustomLookupData:function(e){var t=this.getData("moduleData"),r=t.additionalFielddata.lookup;r&&r.length&&r.forEach(function(r){var i=t.fields.filter((function(e){return e.id===r.fieldId}))[0];!i||"Accounts"==i.lookup.module.api_name&&!i.custom_field||e[i.api_name]&&e[i.api_name].id||(i.$.set("lookupSingle",""),i.$.set("selectedId",""))}.bind(this))},validateCreateform:function(e,t,r,i,a,s){s=s||event;var o={};this.setData("disableFormbuttons",!0);var n=this.getData("dataBind"),l=this.getData("module"),c="crm-create-fields[record-name='"+n.$.model._name+"']",d=$L(c)[0];d&&d.component.checkLayoutrules(d),this.setData("moduleData.surveyTexterrorDetails",{});var u=this.getData("currsubformApinames"),m=this,p=m.getData("isWizard");if(Crm.userDetails.isLookupFilterEnabled&&p){var g=document.querySelector("crm-create-layout").component,f=($=store.peekRecord("wizard-container",g.data.selectedLayoutid.split(";")[0])).field_array,h=f.length;let e={};for(var y=0;y<h;y++){var v=f[y];if("lookup"===v.data_type&&v.lookup.revalidate_filter_during_edit&&v.selectedId){const t={id:v.selectedId,name:v.lookupSingle};e[v.api_name]=t}else if("userlookup"===v.data_type&&v.lookup.revalidate_filter_during_edit&&n[v.api_name]){let t={id:n[v.api_name].id,name:n[v.api_name].name||n[v.api_name].full_name};e[v.api_name]=t}if("subform"===v.data_type){for(var b=!1,w=(k=v.subformFields).length,C=0;C<w;C++){if("lookup"===(T=k[C]).data_type&&T.lookup.revalidate_filter_during_edit&&T.selectedId){b=!0;break}}if(b)for(var D="__CUSTOM_sequence_NUMBER__",L=(E=n.$.get(v.api_name)).length,R=0;R<L;R++){var P=E[R];Lyte.Component.set(P,D,Math.floor(100*Math.random()).toString())}}}validationUtils.isEmpty(e)||(o.$lookupFilterEditData=e)}else if(Crm.userDetails.isLookupFilterEnabled&&this.checkLyteConvertionSupport(l)){var I=document.querySelector("crm-create-layout").component.data.selectedLayoutid,S=store.peekRecord("layout",I).fields,M=S.length;let e={};for(y=0;y<M;y++){let t=S[y];if("lookup"===t.data_type&&t.lookup.revalidate_filter_during_edit&&t.selectedId){const r={id:t.selectedId,name:t.lookupSingle};e[t.api_name]=r}else if("userlookup"===t.data_type&&t.lookup.revalidate_filter_during_edit&&n[t.api_name]){let r={id:n[t.api_name].id,name:n[t.api_name].name||n[t.api_name].full_name};e[t.api_name]=r}if("subform"===t.data_type){var k;for(b=!1,w=(k=t.subformFields).length,C=0;C<w;C++){var T;if("lookup"===(T=k[C]).data_type&&T.lookup.revalidate_filter_during_edit&&T.selectedId){b=!0;break}}if(b){var E;for(D="__CUSTOM_sequence_NUMBER__",L=(E=n.$.get(t.api_name)).length,R=0;R<L;R++){P=E[R];Lyte.Component.set(P,D,Math.floor(100*Math.random()).toString())}}}}validationUtils.isEmpty(e)||(o.$lookupFilterEditData=e)}m.clearUIError();var A={};Crm.userDetails.isMandatorySubFormEnabled&&!i&&this.validateSubformData(n),u.length>0&&u.forEach((function(e){A[e]=[],n[e].forEach((function(t){A[e].push({recId:t.id,errorObj:Lyte.deepCopyObject(t.$.error)}),store.$.clrRecErr(t.$)}))})),m.setData("errorfieldFocused",!1);var F={firstErrorfield:null,prevOfftop:0,prevOffLeft:0},U=m.getData("initRoute"),O=document.querySelector("crm-create-avatarupload"),x=O?O.querySelector("#photoID"):null,N="crm-create-layout#"+store.peekRecord("module",n.$.model._name).module_name+"LC_layoutNode",j=$L(N)[0];if(j){j.setData("disableFormbuttons",!0);var z=j.component.data.avatarApiname;if(x&&x.value||!z||!n[z]||!O||n.$.set(z,null),j.component.data.isWizard){var $,q=[];if(($=store.peekRecord("wizard-container",j.component.data.selectedLayoutid.split(";")[0]))&&$.chart_data){q=$.chart_data.screen_connections;var B=j.getData("screenHistory"),V=(B=B||[]).map((e=>e.id)),H=[];if(V.length>1){var J="save"!==e||i?V.length:V.indexOf(j.getData("activeScreen.id"));for(y=0;y<J;y++){var W=V[y],G=V[y+1];for(var Y in q)if(q[Y].source_screen.id===W&&q[Y].target_screen.id===G){H.push(Y);break}}}n.$.set("$wizard_connection_path",H)}}}if(j&&n&&(!n.Layout||"object"==typeof n.Layout)&&(p||"edit"!==U||j.getData("transitionData.layoutId"))){var Z=j.component.data.selectedLayoutid.split(";"),Q=Z[0];Lyte.Component.set(n,"Layout",{id:Q}),Z[1]&&Lyte.Component.set(n,"Wizard",{id:Z[1]})}if(j&&"edit"!==U&&"Campaigns"===this.getData("module")){var K=j.getData("selectedLayoutid").split(";"),X=store.peekRecord("layout",K[0]);X&&"survey"===X.created_for&&this.setZohoSurveyDetailsInEntity(n)}if(this.revertOriginalData(),this.getData("moduleData.task_rec_rule")){var ee={RRULE:this.getData("moduleData.task_rec_rule")};n.$.set("Recurring_Activity",ee)}else delete n.Recurring_Activity;var te,re=this.getData("moduleData.fields"),ie=re.length;for(te=0;te<ie;te++)if(re[te]&&"lookup"===re[te].data_type){var ae=re[te].api_name;if(n[re[te].api_name]&&re[te].lookupSingle&&(re[te].lookupSingle!==n[re[te].api_name].name||!n[re[te].api_name].id)){re[te].selectedId&&(re[te].$.set("removeSelectedId",!0),re[te].$.set("selectedId",""));var se=re[te].column_name,oe=n.lookupError;if("PARENT_CAMPAIGNID"===se)continue;var ne=re[te].lookup?re[te].lookup.module.api_name:void 0,le=ne?moduleRecordMapping[ne].singular_label:"";oe||(oe={}),le=$ESAPI.encoder().encodeForHTML(le);var ce=I18n.getMsg("crm.label.lookup.norecord",le),de=" "+I18n.getMsg("crm.label.create.new")+" "+le;oe[ae]={message:ce,createMsg:de},Lyte.Component.set(this.getData("dataBind"),"lookupError",oe)}}var ue=n.$&&n.$.model&&n.$.model.fieldList?n.$.model.fieldList:void 0;if(ue){ue=ue||{};var me="edit"===U?"edit":"create";for(var pe in ue)if(ue[pe]&&ue[pe].fieldID&&ue[pe].mandatory){var ge=store.peekRecord("field",ue[pe].fieldID);if(ge&&(!ge.visible||!ge.view_type[me]||ge.read_only)){var fe=ue[pe];fe.mandatory=!1,store.addField(n.$.model._name,pe,fe.type,fe)}}}if(n.$.validate(),this.isErrorExistInData(n,F,i,A)||n.isblankSurveyNameError)return delete n.isblankSurveyNameError,j.setData("disableFormbuttons",!1),m.getMethods("onQuickCreateSaveFailure")&&m.executeMethod("onQuickCreateSaveFailure",r,"beforeSave"),void s.preventDefault();m.executeValidationRule(m,!!p,(function(l){if(l)return _cruxUtils.showCustomMessage({params:{ltPropType:"error",id:"create_record_messagebox",ltPropOffset:{top:"100px"},ltPropDuration:5e3,ltPropMessage:I18n.getMsg("crm.label.vr.function.InternalServerError"),ltPropShow:!0}}),void j.setData("disableFormbuttons",!1);if(m.getData("vrPassed"))return!0!==Crm.isCalendarSchedule&&Crm.trackSpotLightAction("Validation Rules - Records Invoked",{Module:m.getData("module")}),j.setData("disableFormbuttons",!1),void s.preventDefault();if("Potentials"==m.getData("module")&&!i&&m.handleOmitedStageInPotential())return;var c=m.getData("moduleData.invokeRemoveAllCall"),d=c&&c.length?c.length:0;if(d&&"edit"==m.getData("initRoute")){for(var u=[],p=0;p<d;p++)n[c[p].apiName].length&&u.push({mlData:Lyte.deepCopyObject(n[c[p].apiName]),mlApiname:c[p].apiName}),n.$.set(c[p].apiName,[]);m.setData("moduleData.addedMLRecords",u)}t?t():function(t){n.$se_module&&(o.$se_module=n.$se_module);var i=m.getData("initRoute"),l=m.getData("moduleData");t?(delete n.$state,"custom_button"!==e&&m.wizard_showHideLoadingDiv(!0),Lyte.Component.set(n,"$state","draft")):"draft"===n.$state&&(Lyte.Component.set(n,"$state","save"),commonUtils.showHideLoadingDiv(!0));validationUtils.isEmpty(n.Wizard)||Lyte.Component.set(n,"$wizard_connection_path",JSON.parse(JSON.stringify(n.$wizard_connection_path)));commonUtils.showHideLoadingDiv(!0),l.external_search_acc_CompanyId&&m.setSkyEyeCompanyInRecord(n,l);var c={};if("edit"===i){if(c.affected_data=!0,l.changeOwnerDetails&&l.changeOwnerDetails.length){var d,u=l.changeOwnerDetails[0];if(validationUtils.isNotEmpty(u)&&validationUtils.isNotEmpty(u.queryParams)){var p=u.queryParams;d=p.related_modules?p.related_modules:[],n.Owner&&n.Owner.id===p.owner_id&&(n.Owner.$notify=p.notify,n.Owner.$related_modules=d)}}}else if("clone"===i){if(C=$L("crm-create-layout")[0]){var g=C.component.data,f=Lyte.deepCopyObject(g.initialCreatebject),h=n.$.toJSON(),y=(Crm.curr_sub_Form_DetailS&&Crm.curr_sub_Form_DetailS.apiNames[0]&&Lyte.deepCopyObject(Crm.curr_sub_Form_DetailS.orgCloneSubformData),function(e,t,r,i,a){var s={},o=(a=a||{},Crm.curr_sub_Form_DetailS?Crm.curr_sub_Form_DetailS.apiNames:void 0);for(var l in t)if("Owner"===l||"Layout"===l)e[l]&&t[l]&&t[l].id!==e[l].id&&(s[l]=t[l]);else if(i[l]&&"multiuserlookup"===i[l].fieldType)s[l]=t[l]&&t[l].length?t[l]:[];else if(_.isEqual(t[l],e[l])||o&&-1!==o.indexOf(l)){if(o&&-1!==o.indexOf(l))s[l]=n[l];else if(i[l]&&"picklist"===i[l].fieldType&&t[l]&&e[l]&&_.isEqual(t[l],e[l])&&i[l].fieldID){var c=store.peekRecord("field",i[l].fieldID);c&&c.default_value&&c.default_value===t[l]&&(s[l]=t[l])}else if(a.hasOwnProperty(l)&&!s.hasOwnProperty(l)){var d=a[l];_.isEqual(t[l],d)||(s[l]=t[l])}}else s[l]=t[l];return s}(f,h,0,n.$.model.fieldList,g.cscriptOrgValues)),v={};v.parent_id=g.entityrecordData.id,v.type="POST",v.dataToSend=y,o.cloneData=v}}"clone"!==i&&m.setEnrichStatsInRecord(n,l.module_name,m);if(l.skyEyeIntegrationEnabled)if("edit"===i&&n.$.getDirtyAttributes().includes("Account_Name")&&!l.external_search_acc_CompanyId&&n.$skyeye_account_id)n.$.set("$skyeye_account_id","");else if("clone"===i&&n.$skyeye_account_id){!(!o.cloneData||!o.cloneData.dataToSend||o.cloneData.dataToSend.hasOwnProperty("Account_Name"))&&void 0===l.external_search_acc_CompanyId&&(o.cloneData.dataToSend.$skyeye_account_id=n.$skyeye_account_id)}var b=m.getData("moduleSections")||[],w="edit"==i?"edit":"create";if(b.forEach((function(e){("used"===e.type||e.screen)&&(e.fields||[]).forEach((function(t){!t.isLayoutMandatory||e.isvalidSection&&t.view_type[w]||n.hasOwnProperty(t.api_name)&&n[t.api_name]||!j||j.setData("skipMandatory",!0)}))})),m.data.isWizard){var C;let e=(C=document.querySelector("crm-create-layout")).getData("currentWizardButton"),t=n.$.isNew;e&&("saveasdraft"===e.type?n.$state="draft":t&&"save"===e.type?n.$state="save":t&&"save"!==e.type?n.$state="draft":t||"save"!==n.$state?t||"save"===e.type?n.$state="save":n.$state="draft":n.$state="save")}n.$.save(o,c,{skipValidation:t,validateOnSave:t}).then((function(i){"undefined"!=typeof EmailComposeUtil&&EmailComposeUtil&&EmailComposeUtil.removeDraftDOMElement();var s=m.getData("module");if(!Crm.isHeadless&&isWFKafkaUser()){var o=Object.keys(i)[0];detailView.isWFExecInKafka=i[o].isWFScheduler,detailView.isWFExecInKafka&&(detailView.singleRecordLyteOffloading=!0,detailView.refreshInWms=!0,automationActionsNotificationScheduler.singleRecordOffloadTimeout=setTimeout((function(){if(detailView.refreshInWms){detailView.refreshInWms=!1,detailView.singleRecordLyteOffloading=!1;var e=i[o].wfOffloadedJobid;detailView.currWFOffloadingJobIds.push(e),-1!=detailView.currWFOffloadingJobIds.indexOf(e)&&automationActionsNotificationScheduler.showAutomationSchNotificationProgress()}}),8e3))}if("custom_button"!==e&&(m.wizard_showHideLoadingDiv(!1),commonUtils.showHideLoadingDiv(!1)),Crm.trackSpotLightAction("MPL - Record Edited",{Module:s}),m.succFun(i,e,n.$state,j,t),m.focusErrorField(F),a){var l=document.querySelector("crm-create-layout").getData("dataBind").$.model._name;store.findRecord(l,i[l].id).then((function(e){var t=document.querySelector("crm-create-layout");t.component.methods.resetSubformData(e[0],t),t.setData("dataBind",e[0])}))}"Leads"!=s&&"Contacts"!=s&&"Potentials"!=s||Crm.trackSpotLightAction(s+" - Added"),m.getMethods("onQuickCreateSaveSuccess")&&m.executeMethod("onQuickCreateSaveSuccess",r,"afterSave")}),(function(i){if(commonUtils.showHideLoadingDiv(!1),m.wizard_showHideLoadingDiv(!1),"500"==i.status)return crmHistory.handleAjaxErrorLyte=!0,void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("error.database.problem"));m.validateSubform(F),m.failureFun(i,F,n,e,j,t),m.focusErrorField(F),j.setData("disableFormbuttons",!1),m.getMethods("onQuickCreateSaveFailure")&&m.executeMethod("onQuickCreateSaveFailure",r,"afterSave"),s.preventDefault()}))}(i)}),!1,[void 0])},executeValidationRule:function(e,t,r,i,a){var s=e.getData("dataBind"),o="crm-create-layout#"+store.peekRecord("module",s.$.model._name).module_name+"LC_layoutNode",n=$L(o)[0],l=n?n.getData("validationRules"):void 0,c="edit"==e.getData("initRoute")?"edit":"create",d=e.getData("moduleData.fields"),u=(e.getData("currentLayout")?e.getData("currentLayout"):e.getData("selectedLayoutid")).split(";")[0],m=[];if(e.setData("vrPassed",!1),e.setData("moveToScreenOnVRFailure",t),l){var p=0,g=l.filter((function(e){var t=e.layout.id?e.layout.id:e.layout;return u==t&&e.active&&"function"==e.validation_type})),f=l.filter((function(e){var t=e.layout.id?e.layout.id:e.layout;return u==t&&e.active&&"criteria"==e.validation_type}));if(f.length+g.length){var h=[],y=0;g.forEach((function(t){var r=t.field.api_name,i=d.filter((function(e){return e.id==t.field.id}))[0];if(i.errorDetails&&(i.errorDetails={}),i.aggerrorDetails&&(i.aggerrorDetails={}),a.some((function(e){return void 0===e||store.peekRecord("wizard-screen",e).segments.mapBy("id").some((function(e){return void 0!==i[e]}))}))){var o=e.data.isWizard||_(i);if(i&&o&&i.visible&&i.view_type[c]&&!i.read_only&&e.fieldInPath(i)){++y;var n={};n.column_name=i.column_name,n.uitype=i.ui_type,n.value=""===s[r]||void 0===s[r]?"":s[r]+"",n.api_name=i.api_name,n.field_label=i.field_label,n.id=t.associated_function.id,n._targetFieldid=i.id,n.record=e.filterValidUITypes(s,e.getData("initRoute"),d),n.value&&[24,14,30,333,786].contains(n.uitype)&&(n.value=n.record[n.api_name]),h.push(n)}}}));var v=y+f.length;function _(t){var r=!1;return e.data.moduleSections&&e.data.moduleSections.forEach((function(e){e.type&&"used"===e.type&&e.fields&&e.fields.some((function(i){i.id===t.id&&e.isvalidSection&&(r=!0)}))})),r}y&&store.triggerAction(s.$.model._name,"execute",{type:"POST",jsonData:h}).then((function(t){t&&t.functions&&e.handleVRFunctionResponse(e.getData("module"),t.functions,h,e,m,i),v==(p+=y)&&b(e)}),(function(t){b(e,t)})),f.forEach((function(t){var r,i;if(t.field){r=t.field.api_name,i=t.field.id;var a=d.filter((function(e){return e.id==i}))[0];delete a.isSecVal,a.errorDetails&&(a.errorDetails={}),a.aggerrorDetails&&(a.aggerrorDetails={});var o=e.data.isWizard||_(a);a&&o&&a.visible&&!a.read_only&&a.view_type[c]&&t.conditions&&e.fieldInPath(a)&&t.conditions.forEach((function(o){a.isSecVal||e.handleValidationRuleCondition(o,r,t.execution_type,e,s,i,m)}))}++p,v==p&&b(e)})),0==y&&0==f.length&&b(e)}else b(e)}else b(e);function b(e,t){var a,s=e.getData("isWizard");if(0!==m.length)if(s){if(e.getData("moveToScreenOnVRFailure")&&!m.some((function(t){if(e.getErrorFieldObj(t.targetField))return!0}))){var o=document.querySelector("crm-create-layout");o.component.getData("screenHistory").some((function(e){return store.peekRecord("wizard-screen",e.id).segments.some((function(t){if(t.fields){var r=t.fields.sortBy(t.id+".sequence_number").mapBy("id"),i=!1,s=999;if(m.forEach((function(e){var t=r.indexOf(e.targetFieldId);-1!==t&&t<s&&(i=!0,s=t,a=e)})),i)return o.component.setData("growCrumb",!1),o.component.setData("activeScreen",store.peekRecord("wizard-screen",e.id)),document.querySelector("lyte-step").goto(e.index),!0}return!1}))}))}else{store.peekRecord("wizard-screen",document.querySelector("crm-create-layout").component.getData("screenHistory")[document.querySelector("lyte-step").ltProp("selected")].id).segments.some((function(e){if(e.fields){var t=e.fields.sortBy(e.id+".sequence_number").mapBy("id"),r=999;m.forEach((function(e){var i=t.indexOf(e.targetFieldId);-1!==i&&i<r&&(r=i,a=e)}))}}))}i&&(a=void 0),m.forEach((function(t){t!==a&&e.setValidationError(t.message,t.targetField,e,t.targetFieldId,i)})),a&&(e.setData("vrPassed",!0),e.setValidationError(a.message,a.targetField,e,a.targetFieldId,!1))}else e.setData("vrPassed",!0),m.forEach((function(t){e.setValidationError(t.message,t.targetField,e,t.targetFieldId,i)}));r(t)}},succFun:function(e,t,r,i,a){var s,o=this,n=o.getData("dataBind");if(null==e&&"edit"==o.getData("initRoute"))s={id:n.id},o.handleNavigation(o,i,t,s);else{for(var l in e)s=e[l];var c=0,d=0,u=o.getData("moduleData"),m=0;if("edit"===o.getData("initRoute")&&u.changeOwnerDetails&&u.changeOwnerDetails.length){var p=o.getData("untoucheddataBind");m=p&&p.Owner&&p.Owner.id===u.changeOwnerDetails[0].queryParams.owner_id?0:u.changeOwnerDetails.length}m=0;var g=0,f=0,h=0,y=i.component.data,v=this.getData("moduleData.invokeRemoveAllCall");if((v=[])&&v.length&&"edit"==this.getData("initRoute")&&n[y.moduleData.display_field.api_name]&&(f=v.length,++g),o.getData("isstageSave")&&o.getData("reasonforLoss")&&Crm.userDetails.permissions&&Crm.userDetails.permissions.Crm_Implied_Create_Notes&&++h,m||g||h){if(h){var _={Note_Title:n.Stage,Note_Content:o.getData("reasonforLoss"),Parent_Id:{id:s.id},se_module:"Potentials"};store.createRecord("note",_,!0).$.save().then((function(){++d,g+m+h==d&&o.handleNavigation(o,i,t,s)}),(function(){++d,g+m+h==d&&o.handleNavigation(o,i,t,s);crmui.showMsgBand("error","Notes API failed due to invalid data - Reason for Loss not updated",3e3)}))}for(var b=0;b<m;b++){var w=u.changeOwnerDetails[b];validationUtils.isNotEmpty(w)&&w.customData&&(w.customData.qParams=w.queryParams),store.triggerAction(n.$.model._name,"change_owner",w.customData).then((function(){++d,g+m+h===d&&o.handleNavigation(o,i,t,s)}),(function(e){if(++d,g+m+h==d&&o.handleNavigation(o,i,t,s),e&&e.responseText){var r=JSON.parse(e.responseText),a="";"INVALID_DATA"===r.code&&"body"===r.message?a="Change Owner Not succesfull - INVALID DATA sent":r.message&&(a="Change Owner Not succesfull - "+r.message),crmui.showMsgBand("error",a,3e3)}}))}if(g){var C={},D=Crm.getCrmBasePath()+"/EditCommonModule.do";C.layoutId=y.selectedLayoutid,C["property(module)"]=y.moduleName,C.module=y.moduleName,C.newModel=!0,C.notify=void 0,C.operation="edit",C.ActionType="Edit",C["property(id)"]=n.id,y.moduleData.fields.filter((function(e){if(e.system_mandatory){var t="property("+e.display_label+")";C[t]=n[e.api_name]}}));for(var L=0;L<f;L++){var R=v[L].colName;C["property("+R+")"]="-all-";var P="property("+Crm.getLookupIdName(v[L].lookupModule)+":"+R+")";C[P]="-all-"}networkUtils.lyteInitiateRequest(D,"POST",{params:C}).then((function(){var e=y.moduleData.addedMLRecords;(e&&e.length?e.length:0)?(e.forEach((function(e){n.$.set(e.mlApiname,e.mlData)})),n.$.save(void 0,void 0,{skipValidation:a,validateOnSave:a}).then((function(){++d,g+m+h==d&&o.handleNavigation(o,i,t,s)}))):(++d,g+m+h==d&&o.handleNavigation(o,i,t,s))}))}}else if(o.data.isWizard&&"save"===t&&validationUtils.isNotEmpty(i.component.data.ack_message)&&i.component.data.ack_message.content){document.getElementById("lt_wizard_button_acknowledgement").ltProp({transition:{animation:"slideFromTop",duration:"0.3"},offset:{top:"0",left:"center"},show:!0}),commonUtils.showHideLoadingDiv(!1)}else o.handleNavigation(o,i,t,s);var I=[],S=[];if(I&&I.length||S&&S.length){var M,k,T={multiLookup:[]},E=[],A=[],F=[],U=[],O=[];I.forEach((function(e){var t=e.component.data;if(t&&t.multiselRecords&&t.multiselRecords.length||t.multiselRecords&&0==t.multiselRecords.length&&"edit"==o.getData("initRoute")){var r=t.moduledataUicomp.multiselectlookup;if(E.push(t.multiselRecords),"edit"==o.getData("initRoute")){var i=[];t.multiselRecords.forEach((function(e){i.push(e.id)})),A.push(i)}k=t.prevSelectedarray,U.push(r.linking_module.id),T.multiLookup.push(store.findRecord("module",r.linking_module.id)),c++}})),T.multiuserLookup=[],S.forEach((function(e){var t=e.component.data;if(t&&t.userRecordids&&t.userRecordids.length||t.userRecordids&&0==t.userRecordids.length&&"edit"==o.getData("initRoute")){var r=t.moduledataUicomp.multiuserlookup;F.push(t.userRecordids),M=t.untouchedMultiuserdata,O.push(r.linking_module.id),T.multiuserLookup.push(store.findRecord("module",r.linking_module.id)),c++}})),T.multiLookup.length&&Lyte.resolvePromises(T.multiLookup).then((function(e){var t=e.length;o.setData("validPromisefield",o.getData("validPromisefield")+t);for(var i=0;i<t;i++){var a,l,c=e[i],d=E[i],u=A[i],m=U[i];if(d&&d.length||"edit"==o.getData("initRoute"))if(c[0].fields.forEach((function(e){"lookup"==e.data_type&&(n.$.model.fieldList[e.api_name]?l=e.api_name:a=e.api_name)})),"edit"==o.getData("initRoute")){for(var p=[],g=[],f=[],h=!1,y=k?k.length:0,v=0;v<y;v++)u.contains(k[v])?p.push(k[v]):f.push(k[v]);for(var _=u.length,b=0;b<_;b++)p.contains(u[b])||f.contains(u[b])||g.push(u[b]);g&&g.length&&(h=!0,o.setData("completepromiseLength",o.getData("completepromiseLength")+g.length),g.forEach((function(e){var t=store.createRecord(m);t.$.set(a,{id:s.id}),t.$.set(l,{id:e}),r&&t.$.set("$state",r),t.$.save().then((function(){N()}),(function(){x()}))}))),f&&f.length&&(h=!0,o.setData("completepromiseLength",o.getData("completepromiseLength")+f.length),store.batch((function(){f.forEach((function(e){var t={group_operator:"AND",group:[{comparator:"equal",field:{api_name:a},value:s.id},{comparator:"equal",field:{api_name:l},value:e}]};store.findAll(m,{filters:JSON.stringify(t)}).then((function(e){var t=e&&e[0]?e[0]:void 0;t&&(t.$.deleteRecord(),t.$.save().then((function(){N()}),(function(){x()})))}))}))}))),h||(o.setData("completepromiseLength",o.getData("completepromiseLength")+1),N())}else o.setData("completepromiseLength",o.getData("completepromiseLength")+d.length),d.forEach((function(e){var t=store.createRecord(m);t.$.set(a,{id:s.id}),t.$.set(l,{id:e.id}),r&&t.$.set("$state",r),t.$.save().then((function(){N()}),(function(){x()}))}))}})),T.multiuserLookup.length&&Lyte.resolvePromises(T.multiuserLookup).then((function(e){var t=e.length;o.setData("validPromisefield",o.getData("validPromisefield")+t);for(var r=0;r<t;r++){var i,a,l=e[r],c=F[r],d=O[r];if(l[0].fields.forEach((function(e){"lookup"!=e.data_type&&"userlookup"!=e.data_type||(n.$.model.fieldList[e.api_name]?a=e.api_name:i=e.api_name)})),"edit"==o.getData("initRoute"))if(c&&c.length||M&&M.length){for(var u=[],m=[],p=[],g=!1,f=M.length,h=0;h<f;h++)c.contains(M[h].id)?u.push(M[h].id):p.push(M[h].id);for(var y=c.length,v=0;v<y;v++)u.contains(c[v])||p.contains(c[v])||m.push(c[v]);m&&m.length&&(g=!0,o.setData("completepromiseLength",o.getData("completepromiseLength")+m.length),m.forEach((function(e){var t=store.createRecord(d);t.$.set(i,{id:s.id}),t.$.set(a,{id:e}),t.$.save().then((function(){N()}),(function(){x()}))}))),p&&p.length&&(g=!0,o.setData("completepromiseLength",o.getData("completepromiseLength")+p.length),store.batch((function(){p.forEach((function(e){var t={group_operator:"AND",group:[{comparator:"equal",field:{api_name:i},value:s.id},{comparator:"equal",field:{api_name:a},value:e}]};store.findAll(d,{filters:JSON.stringify(t)}).then((function(e){var t=e&&e[0]?e[0]:void 0;t&&(t.$.deleteRecord(),t.$.save().then((function(){N()}),(function(){x()})))}))}))}))),g||(o.setData("completepromiseLength",o.getData("completepromiseLength")+1),N())}else o.setData("completepromiseLength",o.getData("completepromiseLength")+1),N();else c&&c.length&&(o.setData("completepromiseLength",o.getData("completepromiseLength")+c.length),c.forEach((function(e){var t=store.createRecord(d);t.$.set(i,{id:s.id}),t.$.set(a,{id:e}),t.$.save().then((function(){N()}),(function(){x()}))})))}})),o.getData("promiseLength")==o.getData("completepromiseLength")&&o.getData("validPromisefield")==c&&o.handleNavigation(o,i,t,s)}}function x(){Lyte.Component.registeredHelpers.log("Error in record creation")}function N(){o.setData("promiseLength",o.getData("promiseLength")+1),o.getData("promiseLength")==o.getData("completepromiseLength")&&o.getData("validPromisefield")==c&&o.handleNavigation(o,i,t,s)}},handleNavigation:function(e,t,r,i){commonUtils.showHideLoadingDiv(!0);var a=t,s=e.getData("dataBind");const o=e.getData("moduleData").id,n=e.getData("moduleData").module_name;if(fileupload.uploadDeleteObject={},"transition"!==r&&"custom_button"!==r){store.unloadRecord(o,i.id);var l=e.getData("entityrecordData");"clone"===e.getData("initRoute")&&validationUtils.isNotEmpty(l)&&!l.$.isNew&&store.unloadRecord(o,l.id);var c=e.getData("currsubformApinames");c&&c.length&&c.forEach((function(t){var r=e.getData("dataBind").$.model.fieldList[t].relatedTo;store.unloadAll(r)}))}if("Campaigns"===n&&a){var d=a.getData("moduleData.fields").filter((function(e){return"Native__Survey__Extn__Survey_Type"===e.api_name}))[0];d&&d.isNewSurveyField&&store.findAll("dummy",{},!1,!1,{url:"/crm/v2.2/Campaigns/"+i.id+"/actions/survey_status"}).then((function(e){e&&e.survey_status&&e.survey_status.editor_url&&networkUtils.openUrl(e.survey_status.editor_url,"blank")}))}if(!Crm.isDataEnrichAvailable||"Leads"!==n&&"Contacts"!==n&&"Accounts"!==n||(CAEExec.init(),Crm.isDataEnrichAvailable=!1),e.showValidationMsgBox(i,n),"save"===r)if(a&&a.component.data.transitionData&&a.component.data.transitionData.fillUpModule&&a.component.data.transitionData.entityid){var u=a.component.data.transitionData;Crm.scrollToElem=u.returnAnchor;if(["Campaigns","Products"].contains(u.relmodule)&&u.module!=u.relmodule){var m={};m.relmodule=u.relmodule,m.listRelationId=u.listRelationId,m.entityid=u.entityid,m.newentityID=i.id,m.type="PUT",store.triggerAction(o,"relatedListmap",m)}"Campaigns"==u.fillUpModule&&"Campaigns"===u.module?Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[n,i.id]}):crmHistory.backOneLevel()}else if("edit"===e.getData("initRoute"))if("listView"===Crm.editReqFrom){var p=e.getData("entityrecordData");p&&p.canvasid?Lyte.Router.transitionTo({route:"crm.tab.module.entity.canvas",dynamicParams:[n,p.id,p.canvasid]}):Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[n,i.id]})}else crmHistory.backOneLevel();else"Tasks"===n?Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:["Activities",i.id],queryParams:{sub_module:"Tasks"}}):"Events"!==n&&Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[n,i.id]});else if("saveAndNew"===r)"create"===e.getData("initRoute")?Lyte.Router.getRouteInstance().refresh({refreshTemplate:!0}).data=Lyte.Router.getRouteInstance().transition.data:"Tasks"===n?Lyte.Router.transitionTo({route:"crm.tab.module.create",dynamicParams:["Activities"],queryParams:{sub_module:"Tasks"}}):Lyte.Router.transitionTo({route:"crm.tab.module.create",dynamicParams:[n]});else if("saveasdraft"===r)Lyte.Router.transitionTo({route:"crm.tab.module.actions.draft",dynamicParams:[n]});else if("custom_button"===r){var g=$L("crm-create-buttons")[0].component;if(g){var f=g.custombuttonWizardDetails;f&&(f.custombuttonEmptymodal.recordId=i.id,g.callCustomFunction(f.buttonId,void 0,f.custombuttonEmptymodal,!0))}}else if(s.$screenId){a.setData("disableFormbuttons",!1),a.component.setData("activeScreen",store.peekRecord("wizard-screen",s.$screenId));var h=$L("crm-create-fields")[0];h&&h.component.processLayoutRules(h)}},validateSubform:function(e,t,r){for(var i=this,a=i.getData("currsubformApinames"),s=a.length,o=i.getData("dataBind"),n=0;n<s;n++){var l=o[a[n]];Crm.userDetails.isMandatorySubFormEnabled&&i.checkMandatorySubForm(a[n],t,e),null!=l&&l.forEach((function(s,o){s.$.isError&&(s.show||Lyte.Component.set(s,"show",!0),i.handleClientErrors(s.$.error,!0,o,e,s,t,r,a[n]))}))}},getFinalErrorObjectDetails:function(e,t){if(e&&e.details&&e.details.json_path){for(var r=e.details.json_path.split("."),i=r.length,a=t.$.model.fieldList,s=e.details.api_name,o=0;o<i;o++){var n=r[o];if(-1!==n.indexOf("[")){var l=n.split("[");l&&l[0]&&a[l[0]]&&"relation"===a[l[0]].type&&(e.details.parent_api_name=l[0],e.details.index=Number(l[1].split("]")[0]))}if(n===s){var c=o-1,d=r[c];if(e.details.parent_api_name)u(store.modelFor(t.$.model.fieldList[e.details.parent_api_name].relatedTo).fieldList,d,c,r,n);else u(t.$.model.fieldList,d,c,r,n)}}function u(t,r,i,a,s){if(t[s]&&"id"!==s)e.details.api_name=s;else for(var o=!1;!o;)-1!==r.indexOf("[")&&(r=r.split("[")[0]),t[r]&&"id"!==r?(o=!0,e.details.api_name=r):(r=a[i-1],i-=1),void 0===r&&(o=!0)}return e}return e},failureFun:function(e,t,r,i,a,s,o){if(e.onreadystatechange){var n,l=e.responseText?JSON.parse(e.responseText):"";if(l.data){for(var c in l)n=l[c];for(var d=n?n.length:0,u=0;u<d;u++){var m=this.getFinalErrorObjectDetails(n[u],r),p=(m=this.getFinalErrorObjectDetails(m,r)).details?m.details.api_name:"";this.handleServerErrors(m,p,t,this,r,i,a)}}else switch(l.code){case"NO_PERMISSION":renderingUtils.displayPermissionDenied();break;case"INVALID_DATA":"can't update the converted record"===l.message&&Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[this.getData("moduleData").module_name,this.getData("dataBind").id]}),"the id given seems to be invalid"===l.message&&($L("crm-create-entity")[0].remove(),Lyte.Component.render("crm-permission-error",{brandName:Crm.appName},"#show"))}}else this.handleClientErrors(e,!1,void 0,t,void 0,s,o)},handleBreadCrumbServerErrorsForSubforms:function(e){for(var t=document.querySelector("crm-create-layout"),r=t.component.getData("screenHistory"),i=r?r.length:0,a=document.querySelector("lyte-step"),s=a?a.ltProp("selected"):void 0,o=0;o<i;o++)for(var n=store.peekRecord("wizard-screen",r[o].id).segments,l=n.length,c=0;c<l;c++){if("subforms"===n[c].type)for(var d=n[c].fields.mapBy("api_name"),u=d.length,m=0;m<u;m++)if(e===d[m]&&s!==r[o].index)return t.component.setData("growCrumb",!1),t.component.setData("activeScreen",store.peekRecord("wizard-screen",r[o].id)),void a.goto(r[o].index)}},handleBreadCrumbServerErrors:function(e,t){var r=this.getErrorFieldObj(e);if(r)return r;for(var i=document.querySelector("crm-create-layout"),a=i.component.getData("screenHistory"),s=a?a.length:0,o=document.querySelector("lyte-step"),n=o?o.ltProp("selected"):void 0,l=[],c=0;c<s;c++)for(var d=store.peekRecord("wizard-screen",a[c].id).segments,u=d.length,m=0;m<u;m++){var p=d[m].type;if("fields"==p||"subforms"==p){var g=d[m].fields.mapBy("api_name"),f=(d[m].fields.mapBy("id"),g.length);l=l.concat(g);for(var h=0;h<f;h++)if(e==g[h])return n!==a[c].index&&(i.component.setData("growCrumb",!1),i.component.setData("activeScreen",store.peekRecord("wizard-screen",a[c].id)),o.goto(a[c].index)),this.getErrorFieldObj(e)}}if(r||"FILTER_CRITERIA_NOT_SATISFIED"!==t.code){if(t&&store.modelFor(i.getData("moduleId")).fieldList[t.details.api_name]){i.component.data.screenHistory[n].name;var y=i.component.data.screenHistory[i.component.data.screenHistory.length-1].name,v=document.getElementById("postErrorPop");"save"===i.component.data.dataBind.$state?i.component.setData("invalidDataErrorMsg",I18n.getMsg("crm.wizard.update.invaliddata.desc")):i.component.setData("invalidDataErrorMsg",I18n.getMsg("crm.wizard.save.invaliddata.desc",$ESAPI.encoder().encodeForHTML(y))),v.ltProp("offset",{top:"0",left:"center"}),v.ltProp("transition",{animation:"slideFromTop",duration:"0.4"}),v.ltProp({show:!0});var _=document.querySelector("crm-create-buttons");_&&_.setData("fieldsFilled",l)}}else renderingUtils.showMsgBox(t.message,"error")},getErrorFieldObj:function(e){if(e){var t=store.modelFor(this.getData("dataBind.$.model._name")).fieldList[e],r="crm-create-fields#"+(this.getData("module")?this.getData("module"):this.getData("moduleName"))+"_fldRow_"+t.columnName,i=document.querySelectorAll(r);if(-1===e.indexOf("$"))return i&&i.length||(i=document.querySelectorAll(".aggField."+e)),i=i&&i.length>=1?i[0]:void 0}},getActualClientError:function(e){return e&&-1!==e.indexOf("You do not have sufficient permission to associate this record. Contact your administrator.")?I18n.getMsg("crm.crud.lookup.inaccessible.record"):e},showValidationMsgBox:function(e,t){if(e&&e.$approval_state&&"review_process_pending"===e.$approval_state){var r=$L("crm-reviewprocess-reviewpop");0!==r.length&&r[0].remove(),Lyte.Component.render("crm-reviewprocess-reviewpop",{moduleName:moduleRecordMapping&&moduleRecordMapping[t]?moduleRecordMapping[t].plural_label:t},"#tabLayer"),$L("#rpRecordInReview")[0].ltProp("show",!0)}if(e&&e.$approval_state&&["zia_vision_validation","zia_vision_rejected"].contains(e.$approval_state)){var i=Crm.getVisionMyJobsDependency();Lyte.injectResources(i,void 0,(function(){!function(){var e=$("crm-zia-vision-error-popup");0!==e.length&&e.remove();Crm.client_tracking("Zia Vision Entity Validation Failure",{type:"image_processing"}),Lyte.Component.render("crm-zia-vision-error-popup",{moduleName:moduleRecordMapping&&moduleRecordMapping[t]?moduleRecordMapping[t].plural_label:t,action:"image_processing",isSaveAndNew:!0},"#tabLayer"),$L("#visionApproval_messageBox")[0].ltProp("show",!0)}()}))}},handleServerErrors:function(e,t,r,i,a,s,o){(function e(t,r,i,a,s,o,n){var l;if(t.code&&"MULTIPLE_OR_MULTI_ERRORS"===t.code){if(t.details&&t.details.errors){var c=!0;if(!t.details.errors.some((function(e){if(e.details&&a.getErrorFieldObj(e.details.api_name))return!0}))){var d=document.querySelector("crm-create-layout");c=d.component.getData("screenHistory").some((function(e){return store.peekRecord("wizard-screen",e.id).segments.some((function(r){if(r.fields){var i=r.fields.mapBy("api_name");return t.details.errors.some((function(t){if(t.details&&-1!==i.indexOf(t.details.api_name))return d.component.setData("growCrumb",!1),d.component.setData("activeScreen",store.peekRecord("wizard-screen",e.id)),document.querySelector("lyte-step").goto(e.index),!0}))}}))}))}c?t.details.errors.forEach((function(t){t.details&&a.getErrorFieldObj(t.details.api_name)&&e(t,t.details?t.details.api_name:"",i,a,s,o,n,a)})):a.handleBreadCrumbServerErrors(void 0,{details:{api_name:"Owner"}})}return}if(t.details&&void 0!==t.details.index){a.handleBreadCrumbServerErrorsForSubforms(r,t);var u=a.getData("dataBind")[t.details.parent_api_name],m=0,p=0;c=!1;u.forEach((function(e){p++;var r=!1,i=e.$.model.fieldList;if(Object.keys(i).forEach((function(t){i[t].fieldID&&void 0!==e[t]&&(r=!0)})),r&&++m-1===t.details.index&&!c){Lyte.Component.set(e,"show",!0);var s=a.getData("module")+"_"+t.details.parent_api_name+"_R"+p+"_"+t.details.api_name;l=document.getElementById(s),c=!0}}))}else{if(t.details&&t.details.api_name&&"Layout"==t.details.api_name&&"INVALID_DATA"==t.code){var g=$L("#lt_create_alert_comp")[0];if(g){var f={};return f.header=I18n.getMsg("crm.label.creator.noPermission"),f.content=I18n.getMsg("crm.recordcreation.layout.permission.denied"),f.buttonData=[{type:"accept",text:I18n.getMsg("crm.button.ok"),appearance:"primary"}],$L("crm-create-entity")[0].component.setData("ltalertInfo",f),void g.ltProp("show",!0)}}var h=s.$.model.fieldList;if("INVALID_DATA"===t.code&&t.message&&-1!==t.message.indexOf("Record can't be created as child for the given parent record"))return void crmui.showMsgBand("error",I18n.getMsg("crm.tooltip.child.campaign.limit.reached",crmTab.getDisplayName("Campaigns",!1)),3e3);if("INVALID_DATA"===t.code&&n&&"clone"===n.getData("initRoute")&&h[r]&&t.details)if("multiuserlookup"===h[r].fieldType&&"DISABLED"===t.details.user_status){if(validationUtils.isNotEmpty(s[r])&&s[r].users){var y,v=n.getData("moduleData.fields").filter((function(e){return e.api_name===r}))[0];if(v){var _=[];s[r].users.forEach((function(e){var t=e[v.multiuserlookup.connectedlookup_apiname];t&&_.push(t.id)})),y=_.join(",")}if(y)return store.findAll("user",{ids:y}).then((function(e){var t=[],i=[];if(e&&e.length){e.forEach((function(e){"disabled"===e.status&&(t.push(e.full_name),i.push(e.id))}));var a=$L("#inactiveMultiUsermodal")[0];if(a){var s="Inactive users are selected in <b>"+$ESAPI.encoder().encodeForHTML(v.field_label)+"</b>.";n.setData({"moduleData.inactiveMUserWarningmsg":s,"moduleData.inactiveMUserIds":i,"moduleData.inactiveMultiUsersarr":t}),a.setData("multiUserFieldApi",r);var o={left:"center",top:"0px"},l={animation:"slideFromTop",duration:"0.3"};a.ltProp("transition",l),a.ltProp("offset",o),a.ltProp("showCloseButton",!1),a.ltProp("show",!0)}}}))}}else if("ownerlookup"===h[r].fieldType&&"DISABLED"===t.details.user_status)return void renderingUtils.displayPermissionDenied(void 0,void 0,I18n.getMsg("crm.alert.assign.active.user"));if(void 0===(l=a.handleBreadCrumbServerErrors(r,t))&&store.modelFor(moduleRecordMapping[a.getData("module")].id).fieldList[t.details.api_name])return}if(!l&&!["DUPLICATE_LINKING_DATA","SAME_LINKING_DATA","SELF_REFERENCE_LINKING_DATA_INPUT","CANNOT_PERFORM_ACTION","BLOCKED_RECORD","DEPENDENT_SERVICE_ERROR"].contains(t.code))return;var b=l&&l.component&&l.component.data.fieldLabel?l.component.data.fieldLabel:"",w={isError:!0},C=l?l.getBoundingClientRect():"",D=C.top,L=C.left;["BLOCKED_RECORD"].contains(t.code)||(i=a.getLatestErrorFocusField(i,D,L,l));l&&l.getData("lyteViewPort")&&l.setData("lyteViewPort",!1);switch(t.code){case"MANDATORY_NOT_FOUND":w.code="ERR02",w.message=I18n.getMsg("crm.field.empty.check",$ESAPI.encoder().encodeForHTML(b)),Lyte.Component.set(l.component.data,"errorDetails",w),l.querySelector(".FValue").classList.add("cuserrorFborder");break;case"INVALID_DATA":t.message&&"invalid data"!==t.message?w.message=a.getActualClientError(t.message):t.message&&"invalid data"===t.message&&t.details&&t.details.info_message?w.message=t.details.info_message:w.message=I18n.getMsg("crm.field.valid.check",$ESAPI.encoder().encodeForHTML(b));var R,P,I=a.getData("dataBind.$.model.fieldList");if(t.details.parent_api_name){var S=store.modelFor(I[t.details.parent_api_name].relatedTo).fieldList[t.details.api_name];R=S.fieldType,P=S.type}else R=I[t.details.api_name].fieldType,P=I[t.details.api_name].type;if(w.message=t.details.maximum_length&&"multiselectlookup"===R?I18n.getMsg("crm.listview.maximum.records.alert",t.details.maximum_length):w.message,!t.details.maximum_length||"fileupload"!=R&&"imageupload"!=R)t.details.maximum_length&&("text"===R||"string"===P?w.message=I18n.getMsg("crm.iamexception.maxlen",[t.details.maximum_length,$ESAPI.encoder().encodeForHTML(b)]):"number"!==P&&"phone"!==R||(w.message=I18n.getMsg("crm.field.length.check",$ESAPI.encoder().encodeForHTML(b)))),t.message&&"invalid data"===t.message&&"lookup"===R&&(w.message=I18n.getMsg("crm.crud.lookup.inaccessible.record")),Lyte.Component.set(l.component.data,"errorDetails",w),!t.details.parent_api_name&&l.querySelector(".FValue").classList.add("cuserrorFborder");else{var M=I18n.getMsg("crm.attachment.fileUploadField.Maxlen.check.field",[t.details.maximum_length,$ESAPI.encoder().encodeForHTML(b)]);w.message=M,l.component.data.errorDetails=w,crmui.showMsgBand("error",M,3e3)}break;case"DUPLICATE_LINKING_DATA":Crm.getCrmBasePath(),a.getData("module"),t.details.id;store.findRecord(moduleRecordMapping[a.getData("module")].id,t.details.id,{approved:"both"},!0).then((function(e){var r=I18n.getMsg("crm.linking.module.duplicate.warning",[a.getData("module"),t.details.id,e[0].Name,Crm.getCrmBasePath()]);renderingUtils.showCustomAlert(r,"",!0)}));break;case"SAME_LINKING_DATA":case"SELF_REFERENCE_LINKING_DATA_INPUT":var k=I18n.getMsg("crm.linking.module.sameassociation.warning");renderingUtils.showCustomAlert(k,"",!0);break;case"DUPLICATE_DATA":t.details&&t.details.more_records&&"default"==a.getData("moduleData.generated_type")?(w.message=I18n.getMsg("crm.duplicate.value.not.allowed")+" "+I18n.getMsg("crm.duplicate.value.available.multiple",[a.getData("singularLabel").toLowerCase(),$ESAPI.encoder().encodeForHTML(b)]),w.more_records=!0):w.message=I18n.getMsg("crm.duplicate.value.not.allowed")+" "+I18n.getMsg("crm.duplicate.value.available",[a.getData("singularLabel").toLowerCase(),$ESAPI.encoder().encodeForHTML(b)]),w.duplicateFdetails={},w.duplicateFdetails.id=t.details&&t.details.duplicate_record?t.details.duplicate_record.id:void 0,w.duplicateFdetails.key=t.details.api_name,w.duplicateFdetails.dupFieldLabel=b,w.duplicateFdetails.modLabel=a.getData("singularLabel"),w.duplicateFdetails.moduleN=a.getData("module"),w.duplicateFdetails.detailsFromserver=t.details,Lyte.Component.set(l.component.data,"errorDetails",w),l.querySelector(".FValue").classList.add("cuserrorFborder");break;case"CANNOT_PERFORM_ACTION":renderingUtils.displayPermissionDenied({responseText:'<div id="errorMsg" style="display:none;">Insufficient privileges to perform this operation.</div>'});break;case"RECORD_IN_BLUEPRINT":i&&i.firstErrorfield&&i.firstErrorfield.component&&i.firstErrorfield.setData("isNoErrorFocus",!0),crmui.showMsgBand("error",I18n.getMsg("crm.process.criteria.pop.info"),3e3);break;case"DEPENDENT_SERVICE_ERROR":case"CANNOT_PROCESS":"error"===t.status&&t.details&&"UNAUTHORIZED_CAMPAIGN_USER"===t.details.dependency_error?crmui.showMsgBand("error",I18n.getMsg("crm.campaign.non.campaign.user.error.dynamic",Crm.integrationsAppName.ZOHO_CAMPAIGNS),3e3):t.message&&"error"===t.status&&crmui.showMsgBand("error",t.message,3e3);break;case"BLOCKED_RECORD":var T=document.querySelector("#emailblValidation");if(T){var E={left:"center",top:"0px"},A={animation:"slideFromTop",duration:"0.3"};T.ltProp("transition",A),T.ltProp("offset",E),T.ltProp("showCloseButton",!1),T.ltProp("show",!0)}$("#createskipblocklistValidation").on("click",(function(){T.ltProp("show",!1);var e="draft"===s.$state;e&&a.wizard_showHideLoadingDiv(!0),document.querySelector("crm-create-layout").setData("disableFormbuttons",!0),s.$.save({skipblocklistValidation:!0},void 0,{skipValidation:e,validateOnSave:e}).then((function(t){a.wizard_showHideLoadingDiv(!1);var r=a.getData("module");Crm.trackSpotLightAction("MPL - Record Edited",{Module:r}),a.succFun(t,o,s.$state,n,e),a.focusErrorField(i),"Leads"!=r&&"Contacts"!=r&&"Potentials"!=r||Crm.trackSpotLightAction(r+" - Added")}),(function(e){a.wizard_showHideLoadingDiv(!1),a.validateSubform(i),a.failureFun(e,i,s),a.focusErrorField(i),n.setData("disableFormbuttons",!1),event.preventDefault()}))}));break;case"LIMIT_EXCEEDED":l.component.data&&"556"===l.component.data.uiType?l.querySelector("crm-image-upload-create").component.constructErrorDiv(I18n.getMsg("crm.imageupload.allowed.field.length",t.details.limit)):(w.message=t.message&&"invalid data"!==t.message?t.message:I18n.getMsg("crm.field.valid.check",b),Lyte.Component.set(l.component.data,"errorDetails",w),t.details.parent_api_name||l.querySelector(".FValue").classList.add("cuserrorFborder"));break;case"MAPPING_MISMATCH":w.message=t&&t.message&&"invalid data"!==t.message?t.message:I18n.getMsg("crm.field.valid.check",b),t&&t.details&&("Pipeline"===t.details.mapped_field&&"Stage"===t.details.api_name?w.message="Pipeline "+I18n.getMsg("doesn't contain")+" "+I18n.getMsg("crm.label.the")+" Stage":("Layout"===t.details.mapped_field&&"Pipeline"===t.details.api_name||"Pipeline"===t.details.mapped_field&&"Layout"===t.details.api_name)&&(w.message="Layout "+I18n.getMsg("doesn't contain")+" "+I18n.getMsg("crm.label.the")+" Pipeline")),Lyte.Component.set(l.component.data,"errorDetails",w),t.details.parent_api_name||l.querySelector(".FValue").classList.add("cuserrorFborder");break;case"FILTER_CRITERIA_NOT_SATISFIED":var F;if(t.details.parent_api_name){var U=a.getData("moduleData.currsubformApinames").filter((function(e){return e===t.details.parent_api_name})),O=a.getData("moduleData.fields").filter((function(e){return"subform"===e.data_type&&e.subform.module===U[0]}));F=O[0].subformFields.filter((function(e){return e.api_name===t.details.api_name}))}else F=a.getData("moduleData.fields").filter((function(e){return e.api_name===t.details.api_name}));var x="";if(221===F[0].ui_type||55===F[0].ui_type)x=I18n.getMsg("crm.field.label.user.lookup");else if(moduleRecordMapping[F[0].lookup.module.api_name])x=moduleRecordMapping[F[0].lookup.module.api_name].singular_label;else if(moduleDetailedInfo.modules){const e=F[0].lookup.module.api_name;let t=moduleDetailedInfo.modules.filter((function(t){return t.api_name===e}))[0];t&&t.singular_label&&(x=t.singular_label)}w.message=I18n.getMsg("crm.lookupfilter.entity.errormsg",x),Lyte.Component.set(l.component.data,"errorDetails",w),l.querySelector(".FValue").classList.add("cuserrorFborder");break;default:w.message=t.message&&"invalid data"!==t.message?t.message:I18n.getMsg("crm.field.valid.check",$ESAPI.encoder().encodeForHTML(b)),Lyte.Component.set(l.component.data,"errorDetails",w),!t.details.parent_api_name&&l.querySelector(".FValue").classList.add("cuserrorFborder")}})(e,t,r,i=i||this,a,s,o),i.setData("reasonforLoss","")},handleClientErrors:function(e,t,r,i,a,s,o,n){var l=this,c=t?a.lookupError:this.getData("dataBind.lookupError");if(c)for(var d in c)e[d]=c[d];for(var u in e){var m=e[u];if(s&&"ERR02"==m.code)i.isValidErrorPresent||(i.skipMandatoryCheck=!0);else{i.isValidErrorPresent=!0;var p=document.querySelector("crm-create-layout"),g=p.component;if(!o||"ERR08"!=m.code&&"ERR03"!=m.code){var f;if(t){var h="crm-create-subformfields#"+l.getData("moduleData").module_name+"_"+n+"_R"+(r+1)+"_"+u;f=$L(h)[0]}else f=this.handleBreadCrumbServerErrors(u);if(!f){var y=p.component.getData("currsubformApinames");return y.length>0&&y.forEach((function(e){p.component.data.dataBind[e].forEach((function(e){store.$.clrRecErr(e.$)}))})),delete g.data.dataBind.$.error[u],!0}var v=f&&f.component&&f.component.data.fieldLabel?f.component.data.fieldLabel:"",_=f?!!f.classList.contains("aggField"):"";$L.fastdom.measure(function(e,t,r){var a=e?e.getBoundingClientRect():"",s=a.top,o=a.left;i=0==m.code?i:l.getLatestErrorFocusField(i,s,o,e,t,r)}.bind(l,f,t,_));var b={};if(b.code=m.code,"ERR02"===m.code&&f&&f.component){var w,C,D=f.component.data;validationUtils.isNotEmpty(D.dataBind)?(C=D.dataBind,w=D.moduledataUicomp):validationUtils.isNotEmpty(D.databindSubform)&&(C=D.databindSubform,w=D.subformFields);var L=C?C.lookupError:void 0;if(!t&&validationUtils.isNotEmpty(L)&&w&&"lookup"===w.data_type&&validationUtils.isNotEmpty(L[w.api_name]))return}switch(m.code){case"ERR02":D=f.component.data;if(!(D=_||t?void 0:D)||"Events"===D.modulenameUicomp||"Who_Id"!==D.moduledataUicomp.api_name&&"What_Id"!==D.moduledataUicomp.api_name)if(D&&"Events"===D.modulenameUicomp&&"What_Id"===D.moduledataUicomp.api_name){var R=f.component.data.currentRelatedToOption,P=f.querySelectorAll("crm-create-fields");switch(R){case"None":b.message=I18n.getMsg("crm.field.empty.check",I18n.getMsg("crm.right.panel.relatedto")),l.setErrorObject(f,b,_,u,t);break;case"Leads":var I=P[0];b.message=I18n.getMsg("crm.field.empty.check",I18n.getMsg("Leads")),l.setErrorObject(I,b,_,u,t);break;case"Contacts":if(!this.getData("dataBind").Who_Id){I=P[0];b.message=I18n.getMsg("crm.field.empty.check",I18n.getMsg("crm.label.title.contact")),l.setErrorObject(I,b,_,u,t);break}case"Others":var S=(I=P[0]).component.data.multiFieldDropdownDispVal;b.message=I18n.getMsg("crm.field.empty.check",I18n.getMsg(S)),l.setErrorObject(I,b,_,u,t)}}else b.message=I18n.getMsg("crm.field.empty.check",$ESAPI.encoder().encodeForHTML(v)),l.setErrorObject(f,b,_,u,t);else"Who_Id"===D.moduledataUicomp.api_name?"Leads"!==D.currentRelatedToOption&&"Contacts"!==D.currentRelatedToOption||(b.message=I18n.getMsg("crm.field.empty.check",D.ctDropdownDispVal),l.setErrorObject(f,b,_,u,t)):"What_Id"===D.moduledataUicomp.api_name?(b.message=I18n.getMsg("crm.field.empty.check",D.multiFieldDropdownDispVal),l.setErrorObject(f,b,_,u,t)):(b.message=I18n.getMsg("crm.field.empty.check",$ESAPI.encoder().encodeForHTML(v)),l.setErrorObject(f,b,_,u,t));break;case"ERR03":case"ERR08":b.message=I18n.getMsg("crm.field.valid.check",$ESAPI.encoder().encodeForHTML(v)),l.setErrorObject(f,b,_,u,t);break;case"ERR04":b.message=I18n.getMsg("crm.field.valid.decimal.check2",[$ESAPI.encoder().encodeForHTML(v),m.allowedDecimal]),l.setErrorObject(f,b,_,u,t);break;case"ERR06":var M=!1;(D=f.component.data)&&D.moduledataUicomp&&["QUESTIONS","ANSWERS","ADDCOMMENT"].contains(D.moduledataUicomp.column_name)&&"Solutions"===D.modulenameUicomp&&(M=!0),b.message="Campaign_Name"===u||"Native__Campaigns__Extn__Campaign_Subject"===u||"Native__Campaigns__Extn__Sender_Name"===u?I18n.getMsg("crm.criteria.editor.no.of.characters.exceed",[$ESAPI.encoder().encodeForHTML(v),m.expected]):M?I18n.getMsg("crm.iamexception.maxlen",[D.moduledataUicomp.length,$ESAPI.encoder().encodeForHTML(v)]):I18n.getMsg("crm.field.length.check",[$ESAPI.encoder().encodeForHTML(v)]),l.setErrorObject(f,b,_,u,t);break;default:b.message=m.message?m.message:"invalid data in Client",b.msg2=m.createMsg?m.createMsg:void 0,"mxncloneproceed"===m.code&&(b.message=""),l.setErrorObject(f,b,_,u,t)}}else t?delete a.$.error[u]:delete g.data.dataBind.$.error[u]}}},wizard_showHideLoadingDiv:function(e){var t=$L(".wiz_loading"),r=$("body");e?(t.show(),r.addClass("oH")):(t.hide(),r.removeClass("oH"))},bindDateTimetoNode:function(e,t,r,i){var a,s,o=t.$node.querySelector('lyte-input[lt-prop-type="date"]'),n=t.$node.querySelector('lyte-input[lt-prop-type="time"]');e&&(s=-1==e.indexOf("TV")?(a=e.split(" ")).length>=2?2==a.length?a[1]:a[1]+" "+a[2].toUpperCase():"":(a=e.split("TV")).length>=2?a[1]:"",o&&n&&(o.component.setData("ltPropCurrentDate",a[0]),n.component.setData("ltPropDefaultTime",s)));i&&!e&&(n.component.setData("ltPropDefaultTime",this.getData("userTimeobj.currTime")),$L(o.querySelector("input")).val(""),o.component.setData("ltPropCurrentDate",""),Lyte.Component.set(t.getData("dataBind"),r,void 0))},handleEntityRecordChanges:function(e,t){var r=this,i=r.getData("moduleData.module_name");if(e){function a(e,a){e.forEach((function(e){var s="#"+i+"_fldRow_"+e.columnName+" crux-user-dropdown",o=t[e.apiName],n=r.$node.querySelector(s);if("edit"==r.getData("initRoute")&&8==r.getData("uiType")&&r.setData("editOwnerlabel",o.name?o.name:o.full_name),n&&Lyte.Component.registeredHelpers.isNotEmpty(o))if(a){(d={}).id=o.id,d.full_name=o.name?o.name:o.full_name,n.component.setData("cxPropSelectedUser",d),t[e.apiName]=d,r.setCScriptSkipFlagForField(e.fieldId),o.id===d.id&&o.full_name===d.full_name||(t[e.apiName]=d);var l=store.peekRecord("field",e.fieldId);if(l&&delete l.skipCscriptExecutionforField,"userlookup"===r.data.moduledataUicomp.data_type){var c=r.$node.querySelector(".lcSingleUser");c&&c.classList.remove("lcSingleUser")}}else{o=o.users;var d=[],u=[];o.forEach((function(t){t=t[e.connectingApiname];var r={};r.id=t.id,u.push(t.id),r.full_name=t.name,d.push(r)})),n.component.setData("cxPropSelectedUsers",d),n._callee.component.setData("userRecordids",u)}}))}function s(e,t){var r=t.getData("whatIdSelectedObj");if("Events"===t.getData("modulenameUicomp")||"Events"!==t.getData("modulenameUicomp")&&("Who_Id"===t.getData("moduledataUicomp").api_name||"What_Id"===t.getData("moduledataUicomp").api_name)){if("What_Id"===t.getData("moduledataUicomp").api_name){var i=t.getData("whatIdModuleArray");i&&i.length>0&&(t.setData("ctSelectedValue",r.module_name),t.setData("currentCtSelectedValue",r.module_name),t.setData("currentWhatIdValue",moduleRecordMapping[r.module_name].id),"Events"===t.getData("modulenameUicomp")&&"modelListField"===t.getData("whatIdSelectedOption")&&t.setData("modId",moduleRecordMapping[i[0].module_name].id),t.setData("currentWhatIdModuleApiName",moduleApiMapping[r.module_name]))}return"Events"!==t.getData("modulenameUicomp")||(!e||t.getData("whatIdSelectedOption"))&&e||(t.setData("currentRelatedToOption","None"),t.setData("selectedCurrentRelatedToOption","None")),!0}return!1}e.picklist&&e.picklist.length&&e.picklist.forEach((function(e){var t="#"+i+"_fldRow_"+e.columnName+" lyte-dropdown",a=r.$node.querySelector(t);if(a){var s=a.ltProp("selected");a&&a.ltProp("displayValue",s),"-None-"!=s&&a.classList.contains("noneSelected")&&a.classList.remove("noneSelected"),"-None-"==s&&!a.classList.contains("noneSelected")&&a.classList.add("noneSelected")}})),e.datetime&&e.datetime.length&&e.datetime.forEach((function(e){var i=t[e.apiName];r.bindDateTimetoNode(i,r,e.apiName)})),e.userlookup&&e.userlookup.length&&a(e.userlookup,!0),e.multiuserlookup&&e.multiuserlookup.length&&a(e.multiuserlookup,!1),e.ownerlookup&&e.ownerlookup.length&&a(e.ownerlookup,!0),e.lookup&&e.lookup.length&&e.lookup.forEach((function(e){var a="#"+i+"_fldRow_"+e.columnName,o="CRM-CREATE-FIELDS"==r.$node.tagName?r.$node:r.$node.querySelector(a),n=t[e.apiName];if(o){var l=t,c=o.getData("whatIdSelectedObj");if(("Who_Id"===e.apiName||"What_Id"===e.apiName)&&("Events"!==o.getData("modulenameUicomp")?"Who_Id"===e.apiName&&o&&Lyte.Component.registeredHelpers.isNotEmpty(t.What_Id):"What_Id"===e.apiName&&o&&Lyte.Component.registeredHelpers.isNotEmpty(t.Who_Id))||validationUtils.isNotEmpty(n))if(l.$se_module){if("Events"===o.getData("modulenameUicomp")){var d,u=o.getData("selectedParticipents"),m=o.getData("selectedWhoWhatObj"),p=l.Participants,g=p.length;if("Who_Id"===(d=l.$se_module&&"Contacts"===l.$se_module?"Who_Id":"What_Id")||"What_Id"===d&&"Leads"===l.$se_module){for(var f=0;f<g;f++)if(m[d].id===p[f].participant){if("Who_Id"===d){u.Contacts=m[d];break}u.Leads=m[d];break}if(m[d]&&m[d].Email&&m[d].Email.length>0&&(l.Who_Id&&Object.keys(l.Who_Id).length&&(0!==Object.keys(u.Contacts).length&&o.setData("contactParticipentChecked",!0),o.setData("contactRadiobutton",l.Who_Id)),l.What_Id&&Object.keys(l.What_Id).length)){u=o.getData("selectedParticipents");"Leads"===l.$se_module&&(0!==Object.keys(u.Leads).length&&o.setData("leadParticipentChecked",!0),o.setData("leadsRadiobutton",l.What_Id))}}o.setData("selectedParticipents",u)}if("Events"!==o.getData("modulenameUicomp")&&("Who_Id"===o.getData("moduledataUicomp").api_name||"What_Id"===o.getData("moduledataUicomp").api_name)||"Events"===o.getData("modulenameUicomp")){var h="",y=o.getData("whatIdModuleArray"),v=y.length;if("Leads"===l.$se_module)h="Leads";else if("Contacts"===l.$se_module)h="Contacts";else for(var _=0;_<v;_++)if(y[_].api_name===l.$se_module){h=y[_].module_name;break}}if("Events"!==o.getData("modulenameUicomp")){if("Who_Id"===o.getData("moduledataUicomp").api_name){var b='crm-create-fields[record-name="'+t.$.model._name+'"].What_Id',w=document.querySelector(b);if(l.Who_Id){if(o.setData("currentRelatedToOption","Contacts"),o.setData("selectedCurrentRelatedToOption","Contacts"),o.setData("currentModuleId",moduleRecordMapping.Contacts.id),w&&w.setData("whoAndWhatDisability",!1),"Contacts"!==h)o.setData("currentPossibleSeModule",h);else(P=o.getData("whatIdModuleArray"))&&P.length>0&&o.setData("currentPossibleSeModule",c.module_name);o.setData("lookupSingle",l.Who_Id.name),o.setData("editInit",!0),o.setData("selectedSingleId",l.Who_Id.id)}else if(l.What_Id&&"Leads"===h)o.setData({modId:moduleRecordMapping.Leads.id,isSingle:!0}),o.setData("currentRelatedToOption","Leads"),o.setData("selectedCurrentRelatedToOption","Leads"),o.setData("currentModuleId",moduleRecordMapping.Leads.id),w&&w.setData("whoAndWhatDisability",!0),o.setData("lookupSingle",l.What_Id.name),o.setData("editInit",!0),o.setData("selectedSingleId",l.What_Id.id);else if(l.What_Id&&"Leads"!==h){var C,D;D=(C=o.getData("moduleData").fields).length;for(f=0;f<D;f++)if("What_Id"===C[f].api_name){Lyte.objectUtils(o.getData("moduleData").fields[f],"add","currentPossibleSeModule",h);break}}}else if("What_Id"===o.getData("moduledataUicomp").api_name&&l.What_Id)if("Leads"!==h){var L,R;o.setData("ctSelectedValue",h),o.setData("currentCtSelectedValue",h),o.setData("currentPossibleSeModule",h),R=(L=o.getData("moduleData").fields).length;for(f=0;f<R;f++)if("Who_Id"===L[f].api_name){Lyte.objectUtils(o.getData("moduleData").fields[f],"add","currentPossibleSeModule",h);break}o.setData("currentWhatIdValue",moduleRecordMapping[h].id),o.setData("modId",moduleRecordMapping[h].id),o.setData("currentWhatIdModuleApiName",moduleApiMapping[h]),o.setData("whoAndWhatDisability",!1),o.setData("lookupSingle",l.What_Id.name),o.setData("editInit",!0),o.setData("selectedSingleId",l.What_Id.id)}else{(P=o.getData("whatIdModuleArray"))&&P.length>0&&(o.setData("ctSelectedValue",c.module_name),o.setData("currentCtSelectedValue",c.module_name)),o.setData("whoAndWhatDisability",!0)}else if("What_Id"===o.getData("moduledataUicomp").api_name&&!l.What_Id){var P;(P=o.getData("whatIdModuleArray"))&&P.length>0&&o.setData("currentPossibleSeModule",c.module_name)}}else if("Events"===o.getData("modulenameUicomp")){m=o.getData("selectedWhoWhatObj");var I=!1,S=!1;l.What_Id&&Object.keys(l.What_Id).length&&(S=!0),l.Who_Id&&Object.keys(l.Who_Id).length&&(I=!0),void 0!==o.getData("whatIdSelectedOption")&&null!==o.getData("whatIdSelectedOption")||("Leads"===h?(o.setData("currentRelatedToOption","Leads"),o.setData("selectedCurrentRelatedToOption","Leads")):"Contacts"===h||"Contacts"!==h&&I?(o.setData("currentRelatedToOption","Contacts"),o.setData("selectedCurrentRelatedToOption","Contacts")):(o.setData("currentRelatedToOption","Others"),o.setData("selectedCurrentRelatedToOption","Others"))),"Leads"===o.getData("whatIdSelectedOption")?(o.setData("currentModuleId",moduleRecordMapping.Leads.id),o.setData("lookupSingle",l.What_Id.name),o.setData("editInit",!0),o.setData("selectedSingleId",l.What_Id.id),o.setAddressForLocField(m.What_Id)):"Contacts"===o.getData("whatIdSelectedOption")?(o.setData("currentModuleId",moduleRecordMapping.Contacts.id),I&&(o.setData("lookupSingle",l.Who_Id.name),o.setData("editInit",!0),o.setData("selectedSingleId",l.Who_Id.id),o.setAddressForLocField(m.Who_Id))):"modelListField"===o.getData("whatIdSelectedOption")&&(S?(o.setData("currentWhatIdValue",moduleRecordMapping[h].id),o.setData("modId",moduleRecordMapping[h].id),o.setData("currentWhatIdModuleApiName",moduleApiMapping[h]),o.setData("ctSelectedValue",h),o.setData("currentCtSelectedValue",h),o.setData("lookupSingle",l.What_Id.name),o.setData("editInit",!0),o.setData("selectedSingleId",l.What_Id.id),o.setData("currentPossibleSeModule",h),o.setAddressForLocField(m.What_Id)):(o.setData("ctSelectedValue",c.module_name),o.setData("currentCtSelectedValue",c.module_name),o.setData("currentWhatIdValue",c.id),o.setData("modId",c.id),o.setData("currentWhatIdModuleApiName",moduleApiMapping[c.module_name]),o.setData("currentPossibleSeModule",c.module_name)))}}else s(!1,o)||(o.component.setData("lookupSingle",n.name),n.id&&o.component.setData({editInit:!0,selectedSingleId:n.id}));else s(!0,o)}})),e.multiselectlookup&&e.multiselectlookup.length&&e.multiselectlookup.forEach((function(e){var a,s="#"+i+"_fldRow_"+e.columnName,o="CRM-CREATE-FIELDS"==r.$node.tagName?r.$node:r.$node.querySelector(s),n=t[e.apiName],l=n&&n.length?n.length:0;o&&l&&(a=1==l?n[0][e.connectingApiname].name:2==l?n[0][e.connectingApiname].name+", "+n[1][e.connectingApiname].name:n[0][e.connectingApiname].name+", "+n[1][e.connectingApiname].name+".. &More",o.component.setData("lookupListstring",a))}))}},fieldInPath:function(e){var t=$L("crm-create-layout")[0];if(t){var r=t.getData("screenHistory");if(r&&r.length)return r.some((function(t){return store.peekRecord("wizard-screen",t.id).segments.mapBy("id").some((function(t){return void 0!==e[t]}))}))}return!0},checkCriteriaMatch:function(e,t,r,i,a){if(!e.group_operator&&null==e.length)return p(e,r,a,i);if(e.group_operator){var s=[],o=0;d=e.group_operator;for(var n=e.group,l=n.length,c=0;c<l;c++)n[c].group_operator?s[o++]=a.checkCriteriaMatch(n[c],t,r,i,a):s[o++]=p(n[c],r,a,i);if(void 0===s[0]||void 0===s[1])return;switch(d){case"and":return s[0]&&s[1];case"or":return s[0]||s[1]}}else{s=[],o=0;var d,u=e;for(var m in u)null==u[m].length||"string"==typeof u[m]?"object"==typeof u[m]?s[o++]=p(u[m],r,a):"string"==typeof u[m]&&(d=u[m]):"function"!=typeof u[m]&&(s[o++]=a.checkCriteriaMatch(u[m],t,r,i,a));if(void 0===s[0]||void 0===s[1])return;switch(d){case"and":return s[0]&&s[1];case"or":return s[0]||s[1]}}function p(e,r,i,a){var s=t,o=e.field.api_name,n=e.field.id,l="edit"===i.getData("initRoute")?"edit":"create",c=function(e,t){var r=e.getData("moduleData.fields");if(r){var i=r.filter((function(e){return e.id==t}));return 1===i.length?i[0]:void 0}}(i,n);if(void 0!==c&&("Owner"===c.api_name||c.visible&&i.fieldInPath(c))){var d=function(e,t,r,i){return validationUtils.isEmpty(t.$.error[e])?"failure"!==i?"text"===r.data_type&&"string"==typeof t[e]?t[e].trim():t[e]:"text"===r.data_type&&"string"==typeof t[e]?""===t[e].trim()?void 0:t[e].trim():"picklist"===r.data_type&&"-None-"===t[e]?void 0:t[e]:t.$.error[e].value}(o,s,c,a);if(d=void 0===d&&"edit"!==l&&c.default_value?c.default_value:d,Crm.canvas&&Crm.canvas.stageStrip&&"Stage"===o&&(d=store.peekAll("stage").filter((function(e){return e.id===Crm.canvas.selectedStageId}))[0].display_label),"phone"===c.data_type&&Crm.userDetails.isPhoneNoNewView){var u="crm-create-fields#"+store.peekRecord("module",s.$.model._name).module_name+"_fldRow_"+c.column_name,m=$L(u)[0];if(m){m.component.data.lyteViewPort&&m.component.setData("lyteViewPort",!1);var p=m.querySelector("crm-phone-field input");p&&p.value&&p.value.trim()&&(d=p.value.trim())}}var g=e.value;if("STAGE"===c.column_name){for(var f=c.pick_list_values,h=[],y=f.length,v=0;v<y;v++)("${OPEN}"!==g||"Open"!==f[v].forecast_type&&"Open"!==f[v].deal_category)&&("${CLOSEDWON}"!==g||"Closed Won"!==f[v].forecast_type&&"Closed Won"!==f[v].deal_category)&&("${CLOSEDLOST}"!==g||"Closed Lost"!==f[v].forecast_type&&"Closed Lost"!==f[v].deal_category)||h.push(f[v].display_value);h.length>0&&(g=h)}var _,b,w=i.checkComparator(d,g,e.comparator,s,o,a,n,r,i);return r?(i.getData("moduleSections")&&i.getData("moduleSections").filter((function(e){e.fields&&e.fields.some((function(t){t.api_name==o&&t.id==n&&(_=t,b=e)}))})),_&&(b&&!1===b.isvalidSection||!_.view_type[l]||!_.visible||_.read_only)?void 0:w):w}}},checkComparator:function(e,t,r,i,a,s,o,n,l,c){var d,u=i.$.model.fieldList[a];if(!u&&!c)return!0;if(e=e&&"string"==typeof e?e.trim():e,"date"==u.type&&e){Lyte.Component.registeredHelpers.isNotEmpty(i.$.error[a])&&(e=i.$.error[a].errorValue);var m=-1!=["dd.mm.yyyy.","yyyy. mm. dd","yyyy.mm.dd","yyyy'年'mm'月'dd'日'"].indexOf(Crm.userDetails.DATE_PATTERN.toLowerCase());if("${TODAY}"==t){r="equal";var p=Utils.convertUsrtoDefaultDatePattern($L.moment().toDate(),m);t=Utils.getDateInGivenPattern(p,"yyyy-mm-dd")}else if("${TOMORROW}"==t){r="equal",(g=new Date).setDate(g.getDate()+1);p=Utils.convertUsrtoDefaultDatePattern(g,m);t=Utils.getDateInGivenPattern(p,"yyyy-mm-dd")}else if("${TOMORROWPLUS}"==t){r="greater_equal",(g=new Date).setDate(g.getDate()+1);p=Utils.convertUsrtoDefaultDatePattern(g,m);t=Utils.getDateInGivenPattern(p,"yyyy-mm-dd")}else if("${YESTERDAY}"==t){r="equal",(g=new Date).setDate(g.getDate()-1);p=Utils.convertUsrtoDefaultDatePattern(g,m);t=Utils.getDateInGivenPattern(p,"yyyy-mm-dd")}else if("${YESTERDAYMINUS}"==t){r="less_equal",(g=new Date).setDate(g.getDate()-1);p=Utils.convertUsrtoDefaultDatePattern(g,m);t=Utils.getDateInGivenPattern(p,"yyyy-mm-dd")}else if("${LASTMONTH}"==t){r="between";var g=new Date,f=new Date(g.getFullYear(),g.getMonth()-1,1),h=new Date(g.getFullYear(),g.getMonth(),0);t=[];var y=Utils.convertUsrtoDefaultDatePattern(f,m);t[0]=Utils.getDateInGivenPattern(y,"yyyy-mm-dd");var v=Utils.convertUsrtoDefaultDatePattern(h,m);t[1]=Utils.getDateInGivenPattern(v,"yyyy-mm-dd")}else if("${THISMONTH}"==t){r="between";g=new Date,f=new Date(g.getFullYear(),g.getMonth(),1),h=new Date(g.getFullYear(),g.getMonth()+1,0);t=[];y=Utils.convertUsrtoDefaultDatePattern(f,m);t[0]=Utils.getDateInGivenPattern(y,"yyyy-mm-dd");v=Utils.convertUsrtoDefaultDatePattern(h,m);t[1]=Utils.getDateInGivenPattern(v,"yyyy-mm-dd")}else if("${NEXTMONTH}"==t){r="between";g=new Date,f=new Date(g.getFullYear(),g.getMonth()+1,1),h=new Date(g.getFullYear(),g.getMonth()+2,0);t=[];y=Utils.convertUsrtoDefaultDatePattern(f,m);t[0]=Utils.getDateInGivenPattern(y,"yyyy-mm-dd");v=Utils.convertUsrtoDefaultDatePattern(h,m);t[1]=Utils.getDateInGivenPattern(v,"yyyy-mm-dd")}else if("${LASTWEEK}"==t){r="between";var _=(S=(I=new Date).getDate()-7-I.getDay())+6,b=new Date(I.setDate(S)),w=new Date(I.setDate(_));t=[];y=Utils.convertUsrtoDefaultDatePattern(b,m);t[0]=Utils.getDateInGivenPattern(y,"yyyy-mm-dd");v=Utils.convertUsrtoDefaultDatePattern(w,m);t[1]=Utils.getDateInGivenPattern(v,"yyyy-mm-dd")}else if("${THISWEEK}"==t){r="between";_=(S=(I=new Date).getDate()-I.getDay())+6,b=new Date(I.setDate(S)),w=new Date(I.setDate(_));t=[];y=Utils.convertUsrtoDefaultDatePattern(b,m);t[0]=Utils.getDateInGivenPattern(y,"yyyy-mm-dd");v=Utils.convertUsrtoDefaultDatePattern(w,m);t[1]=Utils.getDateInGivenPattern(v,"yyyy-mm-dd")}else if("${NEXTWEEK}"==t){r="between";_=(S=(I=new Date).getDate()+7-I.getDay())+6,b=new Date(I.setDate(S)),w=new Date(I.setDate(_));t=[];y=Utils.convertUsrtoDefaultDatePattern(b,m);t[0]=Utils.getDateInGivenPattern(y,"yyyy-mm-dd");v=Utils.convertUsrtoDefaultDatePattern(w,m);t[1]=Utils.getDateInGivenPattern(v,"yyyy-mm-dd")}else if(t.match("AGEINDAYS")||t.match("DUEINDAYS")){t.match("AGEINDAYS")&&(k=!0);try{M=t.substring(t.indexOf("+")+1)}catch(e){murphy.error(e)}k&&(M="-"+M);p=Utils.convertUsrtoDefaultDatePattern(new Date,m);p=Utils.getDateInGivenPattern(p,"yyyy-mm-dd"),M=parseInt(M),(g=new Date).setDate(g.getDate()+M);var C=Utils.convertUsrtoDefaultDatePattern(g,m);switch(t=C=Utils.getDateInGivenPattern(C,"yyyy-mm-dd"),r){case"greater_than":case"greater_equal":k&&(r="greater_equal"==r?"less_equal":"less_than");break;case"less_than":case"less_equal":k?(r="between",(t=[])[0]=C,t[1]=p):(r="between",(t=[])[0]=p,t[1]=C)}}if(!Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),e))return!1;p=Utils.convertUsrtoDefaultDatePattern(e,m);e=Utils.getDateInGivenPattern(p,"yyyy-mm-dd")}else if("datetime"==u.type&&e){var D,L;if(Lyte.Component.registeredHelpers.isNotEmpty(i.$.error[a])&&(e=i.$.error[a].errorValue),e.indexOf("TV")>=0)D=(L=e.split("TV"))[0];else{var R=Crm.userDetails.DATE_PATTERN.toUpperCase()+" "+Crm.userDetails.TIME_FORMAT.toUpperCase().replace(":MM",":mm");D=$L.moment(e,R).format(Crm.userDetails.DATE_PATTERN.toUpperCase()),(L=[])[0]=D,L[1]=Crm.userDetails.TIME_FORMAT.split(" ")>1?$L.moment(e,R).format(Crm.userDetails.TIME_FORMAT.toUpperCase().replace(":MM",":mm")):$L.moment(e,R).format(Crm.userDetails.TIME_FORMAT),L[1]=L[1]?L[1].toUpperCase():L[1]}var P=Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),D);m=-1!=["dd.mm.yyyy.","yyyy. mm. dd","yyyy.mm.dd","yyyy'年'mm'月'dd'日'"].indexOf(Crm.userDetails.DATE_PATTERN.toLowerCase());if("${TODAY}"==t){r="between";g=new Date,f=new Date(g.setHours(0,0,0,0)),h=new Date(g.setHours(23,59,59,999));t=[];y=Utils.convertUsrtoDefaultDatePattern(f,m);t[0]=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(y)+Crm.userDetails.TIME_ZONE.replace(".",":");v=Utils.convertUsrtoDefaultDatePattern(h,m);t[1]=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(v)+Crm.userDetails.TIME_ZONE.replace(".",":")}else if("${TOMORROW}"==t){r="between";g=new Date((new Date).setDate((new Date).getDate()+1)),f=new Date(g.setHours(0,0,0,0)),h=new Date(g.setHours(23,59,59,999));t=[];y=Utils.convertUsrtoDefaultDatePattern(f,m);t[0]=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(y)+Crm.userDetails.TIME_ZONE.replace(".",":");v=Utils.convertUsrtoDefaultDatePattern(h,m);t[1]=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(v)+Crm.userDetails.TIME_ZONE.replace(".",":")}else if("${TOMORROWPLUS}"==t){r="greater_equal",(g=new Date).setDate(g.getDate()+1),g.setHours(0,0,0,0);p=Utils.convertUsrtoDefaultDatePattern(g,m);t=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(p)+Crm.userDetails.TIME_ZONE.replace(".",":")}else if("${YESTERDAY}"==t){r="between";g=new Date((new Date).setDate((new Date).getDate()-1)),f=new Date(g.setHours(0,0,0,0)),h=new Date(g.setHours(23,59,59,999));t=[];y=Utils.convertUsrtoDefaultDatePattern(f,m);t[0]=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(y)+Crm.userDetails.TIME_ZONE.replace(".",":");v=Utils.convertUsrtoDefaultDatePattern(h,m);t[1]=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(v)+Crm.userDetails.TIME_ZONE.replace(".",":")}else if("${YESTERDAYMINUS}"==t){r="less_equal",(g=new Date).setDate(g.getDate()-1);p=Utils.convertUsrtoDefaultDatePattern(g,m);t=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(p)+Crm.userDetails.TIME_ZONE.replace(".",":")}else if("${LASTMONTH}"==t){r="between";g=new Date,f=new Date(g.getFullYear(),g.getMonth()-1,1),h=new Date(g.getFullYear(),g.getMonth(),0);t=[];y=Utils.convertUsrtoDefaultDatePattern(f,m);t[0]=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(y)+Crm.userDetails.TIME_ZONE.replace(".",":");v=Utils.convertUsrtoDefaultDatePattern(h,m);t[1]=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(v)+Crm.userDetails.TIME_ZONE.replace(".",":")}else if("${THISMONTH}"==t){r="between";g=new Date,f=new Date(g.getFullYear(),g.getMonth(),1),h=new Date(g.getFullYear(),g.getMonth()+1,0);t=[];y=Utils.convertUsrtoDefaultDatePattern(f,m);t[0]=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(y)+Crm.userDetails.TIME_ZONE.replace(".",":");v=Utils.convertUsrtoDefaultDatePattern(h,m);t[1]=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(v)+Crm.userDetails.TIME_ZONE.replace(".",":")}else if("${NEXTMONTH}"==t){r="between";g=new Date,f=new Date(g.getFullYear(),g.getMonth()+1,1),h=new Date(g.getFullYear(),g.getMonth()+2,0);t=[];y=Utils.convertUsrtoDefaultDatePattern(f,m);t[0]=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(y)+Crm.userDetails.TIME_ZONE.replace(".",":");v=Utils.convertUsrtoDefaultDatePattern(h,m);t[1]=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(v)+Crm.userDetails.TIME_ZONE.replace(".",":")}else if("${LASTWEEK}"==t){r="between";_=(S=(I=new Date).getDate()-7-I.getDay())+6,b=new Date(I.setDate(S)),w=new Date(I.setDate(_));t=[];y=Utils.convertUsrtoDefaultDatePattern(b,m);t[0]=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(y)+Crm.userDetails.TIME_ZONE.replace(".",":");v=Utils.convertUsrtoDefaultDatePattern(w,m);t[1]=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(v)+Crm.userDetails.TIME_ZONE.replace(".",":")}else if("${THISWEEK}"==t){r="between";_=(S=(I=new Date).getDate()-I.getDay())+6,b=new Date(I.setDate(S)),w=new Date(I.setDate(_));t=[];y=Utils.convertUsrtoDefaultDatePattern(b,m);t[0]=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(y)+Crm.userDetails.TIME_ZONE.replace(".",":");v=Utils.convertUsrtoDefaultDatePattern(w,m);t[1]=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(v)+Crm.userDetails.TIME_ZONE.replace(".",":")}else if("${NEXTWEEK}"==t){r="between";var I,S;_=(S=(I=new Date).getDate()+7-I.getDay())+6,b=new Date(I.setDate(S)),w=new Date(I.setDate(_));t=[];y=Utils.convertUsrtoDefaultDatePattern(b,m);t[0]=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(y)+Crm.userDetails.TIME_ZONE.replace(".",":");v=Utils.convertUsrtoDefaultDatePattern(w,m);t[1]=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(v)+Crm.userDetails.TIME_ZONE.replace(".",":")}else if(t.match("AGEINDAYS")||t.match("DUEINDAYS")){var M,k=!1;try{M=t.substring(t.indexOf("+")+1)}catch(e){murphy.error(e)}t.match("AGEINDAYS")&&(k=!0,M="-"+M),M=parseInt(M);g=new Date((new Date).setDate((new Date).getDate()+M)),f=new Date(g.setHours(0,0,0,0)),h=new Date(g.setHours(23,59,59,999));t=[];y=Utils.convertUsrtoDefaultDatePattern(f,m);t[0]=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(y)+Crm.userDetails.TIME_ZONE.replace(".",":");v=Utils.convertUsrtoDefaultDatePattern(h,m);t[1]=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(v)+Crm.userDetails.TIME_ZONE.replace(".",":");var T=$L.moment($L.moment().toDate().setHours(0,0,0,0)).toDate(),E=$L.moment($L.moment().toDate().setHours(23,59,59,999)).toDate();T=Utils.convertUsrtoDefaultDatePattern(T,m);T=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(T)+Crm.userDetails.TIME_ZONE.replace(".",":");E=Utils.convertUsrtoDefaultDatePattern(E,m);switch(E=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(E)+Crm.userDetails.TIME_ZONE.replace(".",":"),r){case"equal":r="between";break;case"not_equal":r="not_between";break;case"greater_than":case"greater_equal":k?(t=t[0],r="greater_equal"==r?"less_equal":"less_than"):t=t[1];break;case"less_than":case"less_equal":k?(r="between",t[1]=E):(r="between",t[0]=T)}}if(!P)return!1;var A=Utils.convertUsrtoDefaultDatePattern(D,m);if(L[1]){var F=Lyte.registeredMixins["crm-date-datetime-mixin"].getfinalTimeObjectfromTime(L[1]);validationUtils.isNotEmpty(F)&&(A.setHours(F.hrs),A.setMinutes(F.mins))}e=Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(A)+Crm.userDetails.TIME_ZONE.replace(".",":")}else if("number"==u.type){if(null==e?Lyte.Component.registeredHelpers.isNotEmpty(i.$.error[a])?e=isNaN(parseFloat(i.$.error[a].value))?"${EMPTY}"!=t&&"${NOTEMPTY}"!=t?0:void 0:parseFloat(i.$.error[a].value):"failure"!==s&&(e="${EMPTY}"!=t&&"${NOTEMPTY}"!=t?0:e):Lyte.Component.registeredHelpers.isNotEmpty(i.$.error[a])&&(e=isNaN(parseFloat(i.$.error[a].value))?"${EMPTY}"!=t&&"${NOTEMPTY}"!=t?0:void 0:parseFloat(i.$.error[a].value)),"currency"==u.fieldType&&(t||0===t)&&"number"==typeof t){var U=Crm.userDetails.CURRENCY_DETAILS;i.Currency&&U&&U[i.Currency]&&(t=U[i.Currency].er*t)}}else if("lookup"===u.fieldType)validationUtils.isNotEmpty(e)&&(e=e.name);else if("userlookup"===u.fieldType||"ownerlookup"===u.fieldType){if("${EMPTY}"===t&&!validationUtils.isNotEmpty(e))return!1;if("${NOTEMPTY}"===t||"not_equal"===r&&"${EMPTY}"===t&&validationUtils.isNotEmpty(e))return!0;5678!==e&&(validationUtils.isNotEmpty(e)&&(e=e.id),t=t.id?t.id:Crm.userDetails.USER_ID)}else if("bigint"===u.fieldType&&"object"===u.type){if(validationUtils.isNotEmpty(e)&&(e=e.id),t.id)t=t.id;else{var O=[];t.forEach((function(e){O.push(e.id)})),t=O}r="equal"==r?"contains":"not_equal"==r?"not_contains":r}switch(s&&(d=l.chkFieldemptyVR(e,s,n)),t&&"string"==typeof t&&t.indexOf("${NOC")>=0&&(t=t.replace("${NOC","").replace("}",""),e=s?e?e.length||0:void 0!==e?void 0:e:e?e.length:0),r){case"between":case"not_between":if(1==d||0==d)return d;if(t&&2==t.length){if("string"==typeof t[0]&&"string"==typeof t[1]&&t[0].indexOf("${NOC")>=0&&t[1].indexOf("${NOC")>=0){var x=t[0].replace("${NOC","").replace("}",""),N=t[1].replace("${NOC","").replace("}",""),j=(e=e?e.length:0)>=x.trim()&&e<=N.trim();return"between"==r?j:!j}j=e>=("string"==typeof t[0]?t[0].trim():t[0])&&e<=("string"==typeof t[1]?t[1].trim():t[1]);return"between"==r?j:!j}break;case"less_equal":return 1==d||0==d?d:"datetime"==u.type||"date"==u.type?new Date(e)<=new Date(t):Number(e)<=Number(t);case"less_than":return 1==d||0==d?d:"datetime"==u.type||"date"==u.type?new Date(e)<new Date(t):Number(e)<Number(t);case"greater_equal":return 1==d||0==d?d:"datetime"==u.type||"date"==u.type?new Date(e)>=new Date(t):Number(e)>=Number(t);case"greater_than":return 1==d||0==d?d:"datetime"==u.type||"date"==u.type?new Date(e)>new Date(t):Number(e)>Number(t);case"equal":case"not_equal":return l.equalCheckBasedOnType(e,t,typeof t,r,i,a,s,o,n,l);case"starts_with":case"ends_with":return 1==d||0==d?d:t&&"string"==typeof t?(t=t?t.toLowerCase():t,!(!e||"string"!=typeof e)&&(e=e.toLowerCase(),"starts_with"===r?e.startsWith(t):e.endsWith(t))):!!Array.isArray(t)&&t.some((function(t){return t=t&&"string"==typeof t?t.toLowerCase():t,!(!e||"string"!=typeof e)&&(e=e.toLowerCase(),"starts_with"===r?e.startsWith(t):e.endsWith(t))}));case"contains":case"not_contains":if(1==d||0==d)return d;if(""==e&&"failure"==s)return!0;if(null==s&&"not_contains"==r&&!e)return!0;if(e){if("string"==typeof t){t=t?t.toLowerCase():t;var z=-1!=(e=e?e.toLowerCase():e).indexOf(t);return"contains"==r?z:!z}if(Array.isArray(t)&&t.length)return t.some((function(t){if(t=t&&"string"==typeof t?t.toLowerCase():t,"string"==typeof e){var i=-1!=(e=e.toLowerCase()).indexOf(t);return"contains"==r?i:!i}return!1}));if("object"==typeof t&&t.length){var $=t.contains(e);return"contains"==r?$:!$}}return!1}},chkFieldemptyVR:function(e,t,r){if(null==e&&t&&!r)return"failure"===t},equalCheckBasedOnType:function(e,t,r,i,a,s,o,n,l,c){var d;if("${NOTEMPTY}"==t?(i="not_equal",t="",e=p(e="-None-"==e||null==e?"":e)):"${EMPTY}"==t&&(t="",e=p(e="-None-"==e||null==e?"":e)),t&&"string"==typeof t&&t.indexOf("${NOC")>=0&&(t=t.replace("${NOC","").replace("}",""),e=e?e.length:0),o&&(d=c.chkFieldemptyVR(e,o,l)),1==d||0==d)return d;switch(r){case"string":var u=(e&&isNaN(e)?e.toString().toLowerCase():e)==(t&&isNaN(e)?t.toLowerCase():t);return"equal"==i?u:!u;case"boolean":case"number":u=e==t;return"equal"==i?u:!u;case"array":case"object":var m=!1;return t.forEach((function(t){(t=t&&"string"==typeof t?t.toLowerCase():t,(e=e&&"string"==typeof e?e.toLowerCase():e)&&"string"==typeof e)&&(t==e&&!m&&(m=!0))})),"equal"==i?m:!m}function p(e){return"0"==e&&(e="notEmpty"),e}},setinitialPicklistdata:function(e,t,r,i,a,s){var o=[];o[0]={};var n=a.length;if(r)if(r=r||("multiselectpicklist"==e.data_type?"[]":"-None-"),"multiselectpicklist"==e.data_type){if(r="string"==typeof r?JSON.parse(r):r,(o=a.filter((function(e){return r.contains(e.display_value)}))).length&&o.length!=r.length){var l=JSON.parse(JSON.stringify(o[0])),c=["display_value","actual_value","maps","type"];for(var d in l)c.contains(d)||delete l[d];for(var u=l.maps.length,m=0;m<u;m++)l.maps[m].pick_list_values=[];r.forEach((function(e){if(!o.filter((function(t){return t.display_value==e})).length){var t=l;t.display_value=t.actual_value=e,o.push(t)}}))}else if(e.default_value&&"clone"===this.getData("initRoute")&&r&&!r.length){for(var p=0;p<n;p++)if(a[p].display_value==e.default_value){o[0]=a[p];break}}else if(0===o.length&&o.length!=r.length){l=JSON.parse(JSON.stringify(a[0])),c=["display_value","actual_value","maps","type"];for(var d in l)c.contains(d)||delete l[d];for(u=l.maps.length,m=0;m<u;m++)l.maps[m].pick_list_values=[];r.forEach((function(e){if(!o.filter((function(t){return t.display_value==e})).length){var t=l;t.display_value=t.actual_value=e,o.push(t)}}))}}else o=a.filter((function(e){return r==e.display_value}));else if(e.default_value||"Currency"==e.api_name)for(p=0;p<n;p++){if("edit"===this.getData("initRoute")&&"-None-"===a[p].display_value&&!s){o[0]=a[p];break}if(a[p].display_value==e.default_value){o[0]=a[p];break}if("Currency"==e.api_name&&t&&a[p].display_value==t.key){o[0]=a[p];break}}else o[0]=a[0];return o},setdropdownProperties:function(e,t,r,i,a,s,o,n){var l,c,d,u=this,m=this.getData("moduleData.renderedLayoutId");if("SALUTATION"==a){d=(c=$L(".cruxCompClass_SALUTATION lyte-dropdown")).parents("crm-create-fields")[0],c=c[0]}else l=t+" lyte-dropdown",c=document.querySelector(l),d=document.querySelector(t);var p,g=this.getData("initialCreatebject"),f=this.getData("dataBind");if(("subform"===n&&(f=this.getData("databindSubform")),"Stage"===o&&"FORECAST_CATEGORY"===a)&&((J=this.getData("moduleData"))&&J.fields)){var h=J.fields.filter((function(e){return"Stage"===e.api_name}))[0];if(h&&"STAGE"===h.column_name){var y=h[m];if(y&&y.pick_list_values&&f[o]){var v=y.pick_list_values.filter((function(e){return e.display_value===f[o]}))[0];v&&v.forecast_category&&(p=v.forecast_category)}}}var _,b=this.getData("initRoute");if(!g||!Object.keys(g).length){var w="crm-create-layout#"+store.peekRecord("module","subform"===n?this.data.moduleData.id:f.$.model._name).module_name+"LC_layoutNode",C=$L(w)[0];g=C?C.getData("initialCreatebject"):void 0}if(d&&c&&d.component.data.moduledataUicomp&&!d.component.data.moduledataUicomp.read_only){var D=(E=d.component.data).moduledataUicomp.data_type;if(!e){var L=d.component.getData("orginalPicklistdata");if("multiselectpicklist"!==D&&g[i])!L.filter((function(e){return e.display_value==g[i]}))[0]&&L.push(u.createDummyPLobject(L[0],g[i]));e=L}var R=E.moduledataUicomp[m];if(e=u.getOriginalPicklistValues(e,R&&R.pick_list_values?R.pick_list_values:E.moduledataUicomp.pick_list_values,i,o),R&&R.default_value)($=e.filter((function(e,t){if(e.display_value===R.default_value)return z=t,!0}))[0])&&z&&(Lyte.arrayUtils(e,"removeAt",z,1),Lyte.arrayUtils(e,"insertAt",0,$));if("multiselectpicklist"===D&&g[i]&&"create"!==b&&f[o]==g[o])(q={plOptions:e,exitRecordVal:g[i]}).orgPLValues=R&&R.pick_list_values?R.pick_list_values:E.moduledataUicomp.pick_list_values,e=X(q);d.component.setData("moduledataUicomp.dpick_list_values",e);var P=[],I=!1;if("multiselectpicklist"===D){if(g[i]&&"create"!==b){var S=JSON.parse(g[i]);S.length&&e.forEach((function(e){S.contains(e.display_value)&&(P.push(e),I=!0)}))}P.length||(P[0]=e[0])}else{(F=e.filter((function(e){return e.display_value==g[i]}))[0])&&"-None-"===F.display_value&&R&&R.default_value&&(F=void 0);var M="create"!==b&&g[i]&&F||e[0];P[0]=M}if(Y="multiselectpicklist"==D?E.moduleData.additionalFielddata.multiselectpicklist.filter((function(e){return e.fieldId==E.moduledataUicomp.id}))[0]:E.moduleData.additionalFielddata.picklist.filter((function(e){return e.fieldId==E.moduledataUicomp.id}))[0],this.getData("isscreenSwitch")&&Y&&Y.renderedCount>1){var k=e.filter((function(e){return e.display_value==f[i]}));P[0]=k&&k[0]?k[0]:P[0]}if(p&&p.id)(V=e.filter((function(e){return e.id===p.id}))[0])&&P&&P[0]&&(P[0]=V);if(c.component.setData("ltPropOptions",P),"multiselectpicklist"!=d.component.data.moduledataUicomp.data_type)(!this.getData("isscreenSwitch")||Y&&1==Y.renderedCount)&&(c.component.setData("ltPropSelected",P[0].display_value),c.component.setData("ltPropDisplayValue",P[0].display_value)),"-None-"==P[0].display_value?(c&&c.classList.add("noneSelected"),Lyte.Component.set(f,i,E.moduledataUicomp.required?"":P[0].display_value)):(c&&c.classList.remove("noneSelected"),Lyte.Component.set(f,i,P[0].display_value)),"initialRender"===n&&this.executeCscriptWrapper(f,i),!0===E.moduledataUicomp.enable_colour_code&&(P[0]&&"-None-"!==P[0].display_value?(d.component.setData("moduledataUicomp.color_code",P[0].colour_code),d.component.setData("moduledataUicomp.pkcolor_enabled_class","colorEnabledPicklist")):d.component.setData("moduledataUicomp.pkcolor_enabled_class","colorEnabledPicklist colorEnabledPKNone"));else if(0==r){if(O=(U=d.component.data).dataBind[U.apiName])if("string"==typeof O)(N=JSON.parse(O)).length?e.filter((function(e){return e.display_value==N[0]}))[0]?x=1:(x=0,Lyte.Component.set(f,i,"[]")):x=0;else x=O.length;else x=0;x?c.ltProp("placeholder",""):c.ltProp("placeholder",I18n.getMsg("crm.label.picklist.none"))}else if(1==r)if(I){var T=(_=[],P.forEach((function(e){_.push(e.display_value)})),JSON.stringify(_));Lyte.Component.set(f,i,T)}else Lyte.Component.set(f,i,"[]");"SALUTATION"==a&&d.querySelector("lyte-input").focus(),K(P[0],E.moduledataUicomp)}else if(d&&c&&d.component.data.subformFields&&!d.component.data.subformFields.field_read_only){var E=d.component.data;f=E.databindSubform;D=E.subformFields.data_type;if(g&&g[E.parentSubformdata.subform_apiname]&&(g=g[E.parentSubformdata.subform_apiname].filter((function(e){return e.id===f.id}))[0]),g=g||{},!e){L=d.component.data.subformFields.pick_list_values;if("multiselectpicklist"!==D&&g[i])L.filter((function(e){return e.display_value===g[i]}))[0]||L.push(u.createDummyPLobject(L[0],g[i]));e=L}R=E.subformFields[m];e=u.getOriginalPicklistValues(e,R&&R.pick_list_values?R.pick_list_values:E.subformFields.pick_list_values,i,o),d.component.data.dpick_list_values=e,d.component.data.oldPickListValue=void 0;var A,F=e.filter((function(e){return e.display_value===g[i]}))[0];M="create"!==b&&g[i]&&F||e[0];if((P=[])[0]=M,E.subformFields.enable_colour_code&&P[0]&&(d.component.setData("pkColorCode",P[0].colour_code),"-None-"===P[0].display_value?d.component.setData("pkColorEnabledClass","colorEnabledPicklist colorEnabledPKNone"):d.component.setData("pkColorEnabledClass","colorEnabledPicklist")),c.component.setData("ltPropOptions",P),A="multiselectpicklist"==D?E.moduleData.addSubFormFielddata.multiselectpicklist.filter((function(e){return e.fieldId===E.subformFields.id}))[0]:E.moduleData.addSubFormFielddata.picklist.filter((function(e){return e.fieldId===E.subformFields.id}))[0],"multiselectpicklist"!==d.component.data.subformFields.data_type)(!this.getData("isscreenSwitch")||A&&1===A.renderedCount)&&(c.component.setData("ltPropSelected",P[0].display_value),c.component.setData("ltPropDisplayValue",P[0].display_value)),"-None-"===P[0].display_value?(c&&c.classList.add("noneSelected"),E.subformFields.required?Lyte.Component.set(f,i,""):Lyte.Component.set(f,i,P[0].display_value)):(c&&c.classList.remove("noneSelected"),Lyte.Component.set(f,i,P[0].display_value));else if(!1===r){var U,O,x,N;if(O=(U=d.component.data).databindSubform[U.subformFields.api_name])if("string"==typeof O)(N=JSON.parse(O)).length?e.filter((function(e){return e.display_value===N[0]}))[0]?x=1:(x=0,Lyte.Component.set(f,i,"[]")):x=0;else x=O.length;else x=0;x?c.ltProp("placeholder",""):c.ltProp("placeholder",I18n.getMsg("crm.label.picklist.none"))}else c.component.setData("ltPropSelected","[]"),c.component.setData("ltPropPlaceholder",I18n.getMsg("crm.label.picklist.none")),Lyte.Component.set(f,i,"[]");K(P[0],E.subformFields,!0,E)}else{var j=this.getData("moduleData").fields.filter((function(e){return e.api_name==i}));if(j&&j[0]&&!j[0].read_only){e||(e=j[0].orginalPicklistdata?j[0].orginalPicklistdata:this.filterValidPickListValues(s,j[0]));var z,$,q,B,V,H=j[0][m];if(e=u.getOriginalPicklistValues(e,H&&H.pick_list_values?H.pick_list_values:j[0].pick_list_values,i,o),H&&H.default_value)($=e.filter((function(e,t){if(e.display_value===H.default_value)return z=t,!0}))[0])&&z&&(Lyte.arrayUtils(e,"removeAt",z,1),Lyte.arrayUtils(e,"insertAt",0,$));if("multiselectpicklist"===j[0].data_type&&g[i]&&"create"!==b&&f[o]==g[o])(q={plOptions:e,exitRecordVal:g[i]}).orgPLValues=H&&H.pick_list_values?H.pick_list_values:j[0].pick_list_values,e=X(q);if(j[0].dpick_list_values=e,"SALUTATION"===a){var J,W=(J=this.data&&this.data.moduleData&&this.data.moduleData.fields||[]).filter((function(e){return"FIRSTNAME"===e.column_name}))[0];W&&(W.dpick_list_values=e)}if(p&&p.id)(V=e.filter((function(e){return e.id===p.id}))[0])&&(B=V);if("picklist"==j[0].data_type){if("Calls"==this.getData("moduleName"))Lyte.Component.set(f,i,e[0].display_value);else{var G=B&&B.display_value||e[0].display_value;if("create"==b&&this.getData("isscreenSwitch")){var Y,Z=this.getData("moduleData.additionalFielddata");Z&&"multiselectpicklist"==D?Y=Z.multiselectpicklist.filter((function(e){return e.fieldId==j[0].id}))[0]:Z&&(Y=Z.picklist.filter((function(e){return e.fieldId==j[0].id}))[0]),G=Y&&Y.renderedCount>=1&&f[i]?f[i]:G}M="create"!==b&&g[i]?e.filter((function(e){return e.display_value==g[i]})).length?g[i]:e[0].display_value:G;Lyte.Component.set(f,i,B&&B.display_value||M)}"initialRender"===n&&this.executeCscriptWrapper(f,i)}else{if(0==r&&j[0].default_value)if(e.filter((function(e){return e.display_value==j[0].default_value})).length){var Q=[j[0].default_value];Lyte.Component.set(f,i,JSON.stringify(Q))}else j[0].dontSetDefaultValue=!0,Lyte.Component.set(f,i,"[]");else Lyte.Component.set(f,i,"[]")}K(B||e[0],j[0])}}function K(e,t,i,a){var o=e&&e.maps?e.maps.length:0;if(t&&"STAGE"===t.column_name){var l=e?e.probability:void 0;void 0!==l&&Lyte.Component.set(f,"Probability","-None-"===f[t.api_name]?void 0:l),u.setExpectedRevenue()}for(var c=0;c<o;c++){var d,m;if(i&&void 0!==a.apiName){var p=a.apiName;if(void 0===f[p])d=(g=f.$.model.fieldList[e.maps[c].api_name])?g.columnName:void 0;else d=f[p].model.fieldList[e.maps[c].api_name].columnName;m="crm-create-subformfields#"+a.moduleName+"_"+p+"_R"+(a.indexVal+1)+"_"+e.maps[c].api_name}else{var g;d=(g=f.$.model.fieldList[e.maps[c].api_name])?g.columnName:void 0,m="crm-create-fields#"+u.getData("moduleData.module_name")+"_fldRow_"+d}if(d)e.maps[c].pick_list_values.length>0?u.setdropdownProperties(e.maps[c].pick_list_values,m,r,e.maps[c].api_name,d,s,t.api_name,n):u.setdropdownProperties(void 0,m,r,e.maps[c].api_name,d,s,t.api_name,n)}}function X(e){var t=e.exitRecordVal,r=t||[],i=e.orgPLValues;return t&&"string"==typeof t&&(r=JSON.parse(t)),(r=r||[]).forEach((function(t){if(!e.plOptions.filter((function(e){return e.display_value===t}))[0]){var r=i.filter((function(e){return e.display_value==t}))[0];if(!r)for(var a=(r=u.createDummyPLobject(i[0],t)).maps?r.maps.length:0,s=0;s<a;s++)if("PIPELINE"===curntFldObj.column_name&&"Stage"===optn.maps[s].api_name){var o=u.getData("dataBind.Stage");r.maps[s].pick_list_values=[{actual_value:o,display_value:o}]}else r.maps[s].pick_list_values=[];e.plOptions.push(r)}})),e.plOptions}},toggleOptionsDropdown:function(e){var t=e.id.substr(e.id.indexOf("-")+1);$L("lyte-dropdown#"+t)[0].toggle()},getOriginalPicklistValues:function(e,t,r,i){var a=[];return"Pipeline"===i&&"Stage"===r?e.forEach((function(e){var r=t.filter((function(t){return t.display_value===e.display_value}));r[0]&&a.push(r[0])})):t.forEach((function(t){e.filter((function(e){return e.display_value==t.display_value}))[0]&&a.push(t)})),a},createDummyPLobject:function(e,t){var r=Lyte.deepCopyObject(e);r.actual_value=r.display_value=t;var i=["display_value","actual_value","maps","type"];for(var a in r)i.contains(a)||delete r[a];return r},toggleMandatoryInSubformRecord:function(e,t,r,i){i=i||!1;var a=e.getData("dataBind"),s=a[t];r.forEach((function(t){if(Lyte.Component.registeredHelpers.getViewtype(t.view_type,e.getData("initRoute"))&&t.visible&&"subform"!==t.data_type&&!t.subform)s.forEach((function(r){for(var a in r.$.model.fieldList)t.api_name==a&&(e.toggleMandatoryInRecord?e.toggleMandatoryInRecord(i,r,a,t,!0):e.component.toggleMandatoryInRecord(i,r,a,t,!0))}));else if("subform"===t.data_type){(t.aggFields||[]).forEach((function(t){e.toggleMandatoryInRecord?e.toggleMandatoryInRecord(i,a,t.api_name,t):e.component.toggleMandatoryInRecord(i,a,t.api_name,t)}))}}))},toggleMandatoryInRecord:function(e,t,r,i,a){if(i.required&&i.visible){var s=t,o=s.$.model.fieldList[r];o.mandatory=e,store.addField(s.$.model._name,r,o.type,o,a)}},setDateTimeLbind:function(e,t){var r=this.data,i=this.$node.querySelector('lyte-input[lt-prop-type="date"]'),a=this.$node.querySelector('lyte-input[lt-prop-type="time"]'),s=i.ltProp("currentDate");if(a){(!s&&a.ltProp("defaultTime")&&e||e&&!Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),s))&&i.ltProp("currentDate",Utils.getDateInUserDatePattern(new Date));var o=(s=i.ltProp("currentDate"))?s+"TV"+a.ltProp("defaultTime"):void 0;t?r.databindSubform[r.subformFields.api_name]=o:i.ltProp("currentDate")?Lyte.Component.set(r.dataBind,r.moduledataUicomp.api_name,o):Lyte.Component.set(r.dataBind,r.moduledataUicomp.api_name,"")}else i&&t&&(r.databindSubform[r.subformFields.api_name]=s);"DUEDATE"==r.columnName&&"Tasks"==r.modulenameUicomp&&r.dataBind.Due_Date&&this.setData("moduleData.recurring_read_Only",!1)},togglePlaceholder:function(e,t,r,i){var a,s=this.getData("initialPicklistdata"),o=JSON.parse(r),n=[];if(o.length){var l=s.length;for(a=0;a<l&&(!o.contains(s[a].display_value)||(n.push(s[a].display_value),n.length!=o.length));a++);i.setData("ltPropSelected","[]"),i.setData("ltPropSelected",JSON.stringify(n))}var c=this.$node.component.data,d=c.dataBind?c.dataBind:c.databindSubform,u=c.dataBind?c.apiName:c.subformFields.api_name;(validationUtils.isNotEmpty(d.$.error[u])&&"ERR02"==d.$.error[u].code?0:d[u]?"string"==typeof d[u]?JSON.parse(d[u]).length:d[u].length:0)>=1?this.$node.querySelector("lyte-dropdown").ltProp("placeholder",""):this.$node.querySelector("lyte-dropdown").ltProp("placeholder","None")},lookupInit:function(e,t,r,i,a){var s=e.data.module;if(s.module_name){e.setData("moduleName",s.module_name);var o=s.display_field.api_name;if(e.setData("displayField",o),r)e.getCustomView(s,e);else if(e.data.selectedSingleId)new Promise((function(t){e.setSelectedId(s.id,e.data.selectedSingleId,t)})).then((function(){e.beforeShowFunc(i,a,!0)}));else e.beforeShowFunc(i,a,!0)}else store.findRecord("module",t).then((function(t){s=t[0],e.setData({module:s,moduleName:s.module_name});var o=s.display_field.api_name;(e.setData("displayField",o),r)?e.getCustomView(s,e):e.data.selectedSingleId?new Promise((function(t){e.setSelectedId(s.id,e.data.selectedSingleId,t)})).then((function(){e.beforeShowFunc(i,a,!0)})):e.beforeShowFunc(i,a,!0)}),(function(e){if(403===e.status)return renderingUtils.displayPermissionDenied(void 0,void 0,void 0,10100),!1}))},getCustomView:function(e,t){store.findAll("custom_view",{module:e.api_name}).then((function(r){for(var i,a=r.length,s=0;s<a;s++)if("ALLVIEWS"===r[s].system_name&&r[s].name.startsWith("All")){i=r[s].id,t.setData("customViewId",i);break}i=i||e.custom_view.id,store.findRecord("custom_view",i,{module:e.api_name}).then((function(r){e.custom_view=r,t.setData("module",e),t.getRecs()}))}),(function(e){403===e.status&&(commonUtils.showHideLoadingDiv(!1),renderingUtils.displayPermissionDenied())}))},setRelatedComponent:function(e){e.getData("relatedFieldComp");for(var t,r=e.getData("moduleName"),i=e.getData("relations"),a=i.length,s=e.getData("moduledataUicomp"),o=s.api_name,n=0,l=0;l<a;l++){if(i[l].thisModule===r&&"Reporting_To"!==o){t=i[l],e.relation=!0;break}if(i[l].thisModule===r&&o===i[l].label){t=i[l],e.relation=!0;break}}if(e.setData({relatedTo:t}),e.relation&&(t.thisCustom||!s.custom_field)){var c=e.getData("moduleData").fields,d=(a=c.length,[]),u=[],m=0;for(l=0;l<a;l++)if("Who_Id"===this.getData("moduledataUicomp").api_name||"What_Id"===this.getData("moduledataUicomp").api_name){if((t.relatedCustom||!c[l].custom_field)&&"lookup"===c[l].data_type&&"PARENTACCOUNTID"!==c[l].column_name){var p,g=!1;if("Events"===this.getData("modulenameUicomp")||"Events"!==this.getData("modulenameUicomp")&&"Who_Id"===this.getData("moduledataUicomp").api_name?"se_module"===c[l].lookup.module.api_name&&("Contacts"===t.thisModule?t.relatedModule1===this.getData("currentPossibleSeModule")&&(p="Accounts",g=!0):"Potentials"!==t.thisModule&&"Quotes"!==t.thisModule&&"SalesOrders"!==t.thisModule&&"Campaigns"!==t.thisModule||(p="Contacts",g=!0)):"Events"!==this.getData("modulenameUicomp")&&"What_Id"===this.getData("moduledataUicomp").api_name&&"Contacts"===c[l].lookup.module.api_name&&("Potentials"!==t.thisModule&&"Quotes"!==t.thisModule&&"SalesOrders"!==t.thisModule&&"Campaigns"!==t.thisModule||(p="Contacts",g=!0)),g){var f;d[n]={apiName:c[l].api_name,index:l},d[n].relatedTo=t,f=moduleRecordMapping[p].id;var h=store.peekRecord("module",f);d[n].module=h,d[n]&&d[n].module&&!d[n].module.related_lists&&-1===u.indexOf(h.id)&&(u[m]=h.id,m++),n++}}}else if((t.relatedCustom||!c[l].custom_field)&&"lookup"===c[l].data_type&&"PARENTACCOUNTID"!==c[l].column_name&&(t.relatedModule1===c[l].lookup.module.api_name||t.relatedModule2===c[l].lookup.module.api_name)){d[n]={apiName:c[l].api_name,index:l},d[n].relatedTo=t;h=store.peekRecord("module",c[l].lookup.module.id);d[n].module=h,d[n]&&d[n].module&&!d[n].module.related_lists&&-1===u.indexOf(h.id)&&(u[m]=h.id,m++),n++}e.setData({relatedFieldComp:d}),d.length&&(e.promise=new Promise((function(t){e.returnRelComp(e,u,t)})))}},returnRelComp:function(e,t,r){var i=this.getData("relatedFieldComp"),a=t.length;store.batch((function(){for(var e=0;e<a;e++)store.findRecord("module",t[e],void 0,void 0,void 0)})).then((function(){a=i.length;for(var t=0;t<a;t++){i[t].module=store.peekRecord("module",i[t].module.id);for(var s=e.getData("module"),o=i[t].module.related_lists,n=o.length,l=0;l<n;l++)o[l].api_name!==s.module_name&&o[l].api_name!==s.api_name||(i[t].relation={relationId:o[l].id,api_name:s.api_name},e.setData({relatedFieldComp:i}));r()}}))},setLookupHeader:function(e,t,r){t=t||{};var i=this.getData("columnList")&&t.lookup_field_properties?t.lookup_field_properties:t.custom_view,a=i.fields,s=a.length,o=!1;e.getData("fieldProperties",i);for(var n=e.data.fieldsId,l=[],c=[],d=[],u=0;u<s;u++)c[u]=a[u].id;for(var m=0,p=0;m<s;m++){u=n.indexOf(c[m]);c[m]===t.display_field.id&&r&&(o=!0),-1!==u&&t.fields[u].visible&&(l[p]=t.fields[u],d[p]={id:t.fields[u].id,api_name:t.fields[u].api_name,field_label:t.fields[u].field_label},"Full_Name"===t.fields[u].api_name&&(l[p].field_label=t.singular_label+" "+I18n.getMsg("crm.follow.label.name"),d[p].field_label=l[p].field_label),p++)}return e.setData({header:l,selFields:d}),o},relatedRecords:function(e,t,r){for(var i,a,s=this.getData("moduleData"),o=t.length,n=0;n<o;n++)(a=(i=s.fields[t[n].index]).selectedId)&&t[n].relation&&(t[n].currentRelationQuery={relatedId:a,relationId:t[n].relation.relationId},t[n].lookupSingle=i.lookupSingle,r=void 0!==r?r:n);return r},constructQueryparam:function(e,t,r){var i=t.filters?JSON.parse(t.filters):{},a=e.getData("ddValue"),s={};if(a=a||0,s=JSON.parse(JSON.stringify(t)),r&&r.length&&-1!=a)if(r[a].relatedTo.relatedModule2&&r[1]){var o,n={},l=e.getData("moduleData"),c=l.fields[r[0].index],d=l.fields[r[1].index],u=c.selectedId,m=d.selectedId,p="Contacts"===r[0].module.module_name?"Contact_Name":"Account_Name",g="Contacts"===r[1].module.module_name?"Contact_Name":"Account_Name";o=[{field:{api_name:p,id:c.id},comparator:"equal",value:u},{field:{api_name:g,id:d.id},comparator:"equal",value:m}],u&&m?n.filters={group_operator:"OR",group:o}:u?n.filters=o[0]:m&&(n.filters=o[1]),i&&(i="AND"===i.group_operator&&"OR"===i.group[0].group_operator?{group_operator:"AND",group:[n.filters,i.group[1]]}:t.filters?{group_operator:"AND",group:[n.filters,i]}:n.filters),s.filters=JSON.stringify(i)}else{(n=r[a].currentRelationQuery)&&n.relationId&&(s.relationId=n.relationId,s.relatedId=n.relatedId)}return s},relatedRecordsRequest:function(e,t,r,i){var a=e.getData("queryParamObject"),s=e.getData("relatedFieldComp"),o=this.getData("isLookupAdvancedSearchEnabled");a.page=1,a.per_page=11,e.setData("ddValue",t);var n={},l=e.getData("modId"),c=e.getData("apiName"),d=e.getData("fldId");return n=e.getactiveProducts(a),n=e.constructQueryparam(e,n,s),e.getData("showAll")&&"Reporting_To"!==c?(e.setData("show",!0),void e.setData("ddValue",-1)):new Promise(function(t,s){store.findAll(l,n,!1,!1).then((function(n){n=(n=n[l])&&n.length?n:[],e.setData("repRecord",n);var c=document.querySelector("#"+d+"_input");if(c){var u=c.querySelector("lyte-input");u&&u.classList.contains("lyteInputFocus")}var m=n.length;a.page=Math.ceil(m/11),a.per_page=11,e.setData("queryParamObject",a),i&&(o?e.setSelected(n):e.rendHome(),r||(e.setData("show",!0),e.getData("showAll")&&(e.setData("ddValue",-1),e.setData("showAll",!1))),!n||n.length<11?e.setNavigator(n.length):e.setNavigator(n.length,!0)),u||i?t():s()}),(function(t){e.rejectFunc(t),s&&s()}))}.bind(this))},rejectFunc:function(e){"NO_PERMISSION"!==JSON.parse(e.response).code&&400!==e.status||renderingUtils.displayPermissionDenied(),this.setData("show",!1)},scrollRequest:function(e,t,r,i,a){if(!e.scrl&&r.scrollTop+r.offsetHeight>=r.scrollHeight-30){if(t.page+=1,t.per_page=11,e.scrl=!0,a){var s=e.$node.querySelector("#modalElem").component.childComp.querySelector(".lookupFetchLoad");s&&(s.style.display="block")}var o=e.data.module.id,n=e.getactiveProducts(t),l=this.getData("relatedFieldComp"),c=e.getData("apiName");(a||"Reporting_To"===c)&&(n=this.constructQueryparam(this,n,l));var d=this.getData("fldId")+"_load_img",u=document.querySelector("#"+d);u&&(u.classList.remove("dN"),u.classList.add("dIB")),store.findAll(o,n,!1,!1).then((function(r){(r=r[o])&&r.length?(i=i.concat(r),e.setData("record",i),a?Lyte.arrayUtils(e.data.displayArray,"push",r):Lyte.arrayUtils(e.data.ften,"push",r),e.setData("queryParamObject",t),r={}):e.noMoreScroll=!0,setTimeout((function(){e.scrl=!1}),20),a&&s&&(s.style.display="none"),u&&(u.classList.remove("dIB"),u.classList.add("dN"))}),(function(t){e.rejectFunc(t)}))}},cloneCase:function(e,t,r){var i=e.getData("moduledataUicomp"),a=i.multiselectlookup.api_name,s=e.getData("apiName"),o=e.getData("module"),n=document.querySelector("CRM-CREATE-LAYOUT").component.data,l=i.module[0].id;t=t||n.entityrecordData.id,store.triggerAction(l,"fetchrelatedList",{entityid:t,relapiname:a}).then((function(t){for(var i=t.data,a=[],n=i.length,c=0;c<n;c++)a[c]=i[c][s].id;var d=a.toString(),u=[],m=[],p=o.display_field.api_name;l=o.id,store.findAll(l,{ids:d},!1,!1).then((function(t){t=(t=t[l])||[];var i=a.slice();e.setData({selectedArray:a}),n=t.length;for(var s=0,o=0;s<n;s++)-1!==a.indexOf(t[s].id)&&(u[o]=t[s][p],m[o]=t[s],o++);e.setData({lookupList:u,multiselRecords:m}),e.setData("dispInit",!0),r?(e.setData({initComp:!0}),e.initcomp=!0,e.getData("dispInit")&&e.setData({toShow:"sel"}),e.editcloneSetdata(t,a,e.data.initRoute)):e.setData("prevSelectedarray",i)}))}))},newCreate:function(e,t){var r=e.getData("fldId"),i=e.getData("module"),a=this.getData("relatedFieldComp"),s=this.getData("moduleData"),o=this.getData("moduledataUicomp.id"),n=e.getData("currentLayout"),l=e.getData("lookupSingle");if(n=n?n.split(";")[0]:null,e.saveUnsel=!0,e.setData("tempClose",!0),e.setData("show",!1),i.module_name)var c=Crm.getCrmBasePath()+"/QuickCreateAction.do?module="+i.module_name+"&searchmodule="+i.module_name+"&fldName="+r+"&fldId="+r+"&fldLabel="+i.module_name+"&fldValue="+encodeURIComponent(l)+"&newModel="+!0+"&folLayoutId="+n+"&folLookupFieldId="+o;if(this.data.productId&&(c+="&productId="+this.data.productId),this.getData("accDetails")&&this.getData("accDetails").length>0&&(c+="&accDetails="+this.data.accDetails),"Reporting_To"===this.getData("apiName")){var d=a&&a[0]?a[0].index:void 0,u=void 0!==d?s.fields[d].lookupSingle:"",m=void 0!==d?s.fields[d].selectedId:"";if(m){var p={accounts:[{id:m,name:u}]};c=(c=(c=(c=c+"&productId="+m)+"&entityId="+window[i.module_name].entityId)+"&accDetails="+encodeURIComponent(JSON.stringify(p)))+"&accountid="+m+"&accountname="+encodeURIComponent(u)}}c=Crm.getPortalURL(c),1==this.getData("isfromOutlookRightPanel")&&(c+="&isfromOutlookRightPanel=true"),s.currencyData&&s.currencyData.key&&(c=c+"&currencyISOCode="+s.currencyData.key),(e=$("#searchCreatePopup")).removeClass("fromAutoComplete"),(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(this.getData("module.module_name")))&&Crm.downloadValidationRules(c,this.getData("module.module_name")),Crm.userDetails.isLookupAdvancedSearchEnabled&&(c+="&openInAdvSearch=true");var g=this.getData("modulenameUicomp"),f=this.getData("moduledataUicomp.id"),h=$("#"+r+"_img");h&&h.data({label:r,cid:"showLookup",lookupModule:i.module_name,module:g});var y=$("#"+r);y&&y.data({colname:f.column_name,contentType:"Lookup",customfield:f.custom_field,displaylabel:f.display_label,fieldid:f.id,label:f.display_label,lookupModule:i.module_name,name:f.display_label}),t?commonUtils.openCustomLookup(c,void 0,"searchCreatePopup",void 0,void 0,void 0,void 0,void 0,(function(){if(l){var e=$("#ac-recordname").children().find("input"),t=e.attr("maxlength");l.length>t&&(l=l.substring(0,t)),e.val(l)}})):commonUtils.openCustomLookup(c,void 0,"searchCreatePopup")},saveNewRecord:function(e,t){var r=e.getData("save"),i=e.getData("modId"),a=e.getData("newCreatedid"),s=e.getData("isSingle");if(r||a)if(s)a?store.findRecord(i,a,{approved:"both"}).then((function(r){var i,a=e.getData("displayField");r[0]&&r[0].id&&(i="Full_Name"===(a=e.getData("displayField"))?r[0].First_Name?r[0].First_Name+" "+r[0].Last_Name:r[0].Last_Name:r[0][a],t?e.setData({lookupSingle:i,selectedSingle:r[0].id,selectedSingleRecord:r[0]}):e.setData({lookupSingle:i,selectedSingle:r[0],selectedSingleId:r[0].id}))}),(function(e){o.rejectFunc(e)})):r&&e.showLookupFunc(e,t,!0),e.setData({saveAndAssociate:!1,save:!1,newCreatedid:""});else{var o=e||{},n=o.getData("queryParamObject");o.getData("selectCount");this.$node.classList.remove("currentLookupModal"),n=n.sort_order&&!s?n:{page:1,per_page:11},store.findAll(i,{page:1,per_page:1,approved:"both"},!1,!1).then((function(e){e=e[i];var t=o.getData("unselectedArray"),a=o.getData("unselId"),s=!r,l=r?l:l+1;t[t.length]={id:e[0].id,check:s},a[a.length]=e[0].id,o.setData({unselectedArray:t,unselId:a,selectCount:l+1}),n.approved="both";var c=o.getactiveProducts(n);store.findAll(i,c,!1,!1).then((function(e){e=(e=e[i])&&e.length?e:[],o.setData({record:e,currPage:0}),o.filtered=!1,o.setData("show",!0),o.rendHome()}))})),o.setData({saveAndAssociate:!1,save:!1,newCreatedid:"",queryParamObject:n})}},showLookupFunc:function(e,t,r){if(r="Reporting_To"!==e.getData("apiName")&&r,t||this.getData("renderLookup")){e.setData("show",!1);var i=(e=t?e:this.$node.querySelector("crm-create-lookupmodal").component).data.isSingle,a=e.data.module,s=a.module_name,o=a.id;if(i){var n=store.peekRecord("module",o),l={page:1,per_page:11};store.findRecord("custom_view",n.custom_view.id,{module:n.api_name}).then((function(t){n.custom_view=t,e.setLookupHeader(e,n),(t=t&&t.length?t[0]:t)&&t.sort_by&&(l.sort_by=t.sort_by.api_name,l.sort_order=t.sort_order);var i=e.getactiveProducts(l);store.findAll(moduleRecordMapping[s].id,i,!1,!1).then((function(t){t=(t=t[moduleRecordMapping[s].id])&&t.length?t:[],e.setData({record:t,queryParamObject:l}),e.setData("show",!1),!r&&e.data.relatedFieldComp[0]&&e.data.relatedFieldComp[0].relatedTo?e.relRecs():e.data.isLookupAdvancedSearchEnabled?(e.setData({displayArray:t,show:!0}),r&&e.setData("ddValue",-1)):(e.setData({show:!0}),r&&e.setData("ddValue",-1),!t||t.length<11?e.setNavigator(t.length):e.setNavigator(t.length,!0),e.rendHome()),commonUtils.showHideLoadingDiv(!1)}),(function(e){403===e.status&&(commonUtils.showHideLoadingDiv(!1),renderingUtils.displayPermissionDenied())}))}),(function(e){403===e.status&&(commonUtils.showHideLoadingDiv(!1),renderingUtils.displayPermissionDenied())}))}else{if("unsel"===e.data.toShow){e.setData("show",!1);l={page:1,per_page:11,approved:"both"};var c=e.getactiveProducts(l);store.findAll(moduleRecordMapping[s].id,c,!1,!1).then((function(t){if(t=(t=t[moduleRecordMapping[s].id])&&t.length?t:[],commonUtils.showHideLoadingDiv(!1),e.setData("record",t),t){var r,i=[],a=[],o=[];r=t.length;for(var n=0;n<r;n++)i[n]={id:t[n].id,check:!1},a[n]=t[n],o[n]=t[n].id;e.setData({record:t,unselectedArray:i,curSel:i,displayArray:a,recsId:o,unselId:o,next:[0,10],currentPage:0,queryParamObject:l}),!t||t.length<11?e.setNavigator(r):e.setNavigator(r,!0),e.rendHome(),e.getData("show")&&e.setData("show",!1),e.setData("show",!0)}}))}else if("sel"===e.data.toShow){var d=e.data.selectedArray;(l=e.data.queryParamObject).ids=d.toString(),l.page=1,e.setData({show:!1,preselRecord:[],queryParamObject:l});c=e.getactiveProducts(l);store.findAll(moduleRecordMapping[s].id,c,!1,!1).then((function(t){commonUtils.showHideLoadingDiv(!1),t=(t=t[moduleRecordMapping[s].id])&&t.length?t:[],e.setData({preselRecord:t}),e.rendHome(),e.setData({show:!0}),e.setNavigator(d.length)}))}e.setData("highlightArray",[])}}else{"lookup"===e.getData("moduledataUicomp").data_type?e.setData("isSingle",!0):e.setData("isSingle",!1),e.setData("renderLookup",!0),e.setData("dispInit",!0),r&&e.setData("showAll",!0)}},getactiveProducts:function(e,t){var r=Lyte.deepCopyObject(e),i=this.getData("module"),a=this.getData("onlyactiveProducts"),s=this.getData("modulenameUicomp"),o=this.getData("moduledataUicomp.custom_field"),n=this.getData("initRoute"),l=store.peekRecord("field",t||this.data.moduledataUicomp.id),c="CRM-CREATE-FIELDS"===this.$node.tagName;if("Products"===i.module_name&&a)r.product_active=!0,r=this.filterConstructor(Lyte.deepCopyObject(r),void 0,void 0,!0);else if(i.module_name!==s||o||"edit"!==n)l&&l.lookup&&l.lookup.query_details&&l.lookup.query_details.criteria?r=this.filterConstructor(r,l.lookup.query_details.criteria,"static_lookup_filter"):c&&(r=this.filterConstructor(Lyte.deepCopyObject(r),void 0,void 0,!0));else{var d=this.getData("dataBind.id");r=this.filterConstructor(r,{field:{api_name:"id"},comparator:"not_equal",value:[d]},"id",c)}return r.approved="both",r.approval_state="approved,approval_process_pending,approval_process_rejected",Lyte.deepCopyObject(r)},filterConstructor:function(e,t,r,i){var a,s,o,n,l={},c=[],d=this.getData("displayField");if(e.filters){if("AND"===(a=JSON.parse(e.filters)).group_operator)(c=a.group).forEach((function(e,t){if(e.field)if(e.field.api_name===r)o=t;else if(e.field.api_name===d&&i){var a=[];a[0]={field:{api_name:d},comparator:"starts_with",value:e.value},a[1]={field:{api_name:d},comparator:"contains",value:" "+e.value},a[2]={field:{api_name:d},comparator:"contains",value:"-"+e.value},a[3]={field:{api_name:d},comparator:"contains",value:":"+e.value},a[4]={field:{api_name:d},comparator:"contains",value:","+e.value},a[5]={field:{api_name:d},comparator:"contains",value:";"+e.value},a[6]={field:{api_name:d},comparator:"contains",value:"("+e.value},a[7]={field:{api_name:d},comparator:"contains",value:"["+e.value},a[8]={field:{api_name:d},comparator:"contains",value:"{"+e.value},s={group_operator:"OR",group:a},n=t}})),o||(c[c.length]=t),n&&(c[n]=s),a.group=c,e.filters=JSON.stringify(a);else if(a.field.api_name!==r){if(a.field.api_name===d&&i){var u=[];u[0]={field:{api_name:d},comparator:"starts_with",value:a.value},u[1]={field:{api_name:d},comparator:"contains",value:" "+a.value},u[2]={field:{api_name:d},comparator:"contains",value:"-"+a.value},u[3]={field:{api_name:d},comparator:"contains",value:":"+a.value},u[4]={field:{api_name:d},comparator:"contains",value:","+a.value},u[5]={field:{api_name:d},comparator:"contains",value:";"+a.value},u[6]={field:{api_name:d},comparator:"contains",value:"("+a.value},u[7]={field:{api_name:d},comparator:"contains",value:"["+a.value},u[8]={field:{api_name:d},comparator:"contains",value:"{"+a.value},a={group_operator:"OR",group:u}}r?(l.group_operator="AND",l.group=[a,t],e.filters=JSON.stringify(l)):e.filters=JSON.stringify(a)}}else t&&(e.filters=JSON.stringify(t));return e},setCustomValidationsforfields:function(e,t,r,i,a){var s=r.$.model.fieldList[t.api_name];if(s){if(t.required?"picklist"==t.data_type&&i?(s.mandatory=!0,s.validation="picklistValidation"):(s.mandatory=!0,s.validation="emptyValueValidation"):s.mandatory=!1,"email"==t.data_type)s.validation="emailValidation";else if("website"==t.data_type)s.validation="websiteValidation";else if("date"==t.data_type||"datetime"==t.data_type)s.validation="datetimeValidation",s.fieldLabel=t.field_label;else if("currency"==t.data_type||"double"==t.data_type&&"EXCHANGERATE"!=t.column_name)s.validation="decimalValidation",s.decimal_place=t.decimal_place,s.length=t.length,r[t.api_name]&&t.read_only&&"string"!=s.type&&"expected-revenue"!=s.type&&r.$.set(t.api_name,Number(r[t.api_name].toFixed(t.decimal_place)));else if("phone"==t.data_type||"FAX"===t.column_name)s.validation="phonenumValidation",s.length=t.length;else if(("integer"===t.data_type||"bigint"===t.data_type&&"PARTICIPANTID"!==t.column_name)&&"LAYOUTID"!==t.column_name&&"WIZARDID"!==t.column_name)s.validation="integerValidation",s.length=t.length;else if("TWITTER"===t.column_name)s.validation="twitteridValidation";else if("Campaign_Name"===t.api_name||"Native__Campaigns__Extn__Campaign_Subject"===t.api_name||"Native__Campaigns__Extn__Sender_Name"===t.api_name){"campaign"===store.peekRecord("layout",a).created_for&&(s.maxLength="Native__Campaigns__Extn__Sender_Name"===t.api_name?100:125,s.validation="campaignNameValidation")}s.validation||"string"!==s.type||(s.validation="basicFieldLengthValidator"),"SMOWNERID"===t.column_name&&Crm.userDetails.LITE&&Crm.userDetails.LITE.IS_LITE_USER&&(s.mandatory=!0),store.addField(e,t.api_name,s.type,s,!0)}},checkEmailforCaseOrigin:function(e,t){var r=e.$.model.fieldList.Email;if(validationUtils.isNotEmpty(r)){var i,a=this.getData("moduleData.fields"),s=this.getData("moduleData.renderedLayoutId"),o=(a=a||[]).filter((function(e){return"CASEORIGIN"===e.column_name&&(i=e),"EMAIL"===e.column_name}));o=o&&o[0]?o[0]:{};var n=i&&i[s]?i[s].pick_list_values:void 0;n=n&&n.length?n.filter((function(e){return e.display_value===t}))[0]:void 0;var l="edit"===this.getData("initRoute")?"edit":"create";if(n&&"Email"===n.actual_value&&validationUtils.isNotEmpty(o)&&o.view_type[l]&&!o.read_only){var c="crm-create-fields#"+this.getData("moduleData.module_name")+"_fldRow_EMAIL",d=$L(c)[0];r.mandatory=!!d}else r.mandatory=!1;store.addField(e.$.model._name,"Email",r.type,r)}},unloadWizardComponents:function(){store.unloadAll("wizard-screen"),store.unloadAll("wizard-segment"),store.unloadAll("wizard-button"),store.unloadAll("transition")},clearMandatoryData:function(e){var t=Object.assign({},e.$.error);for(var r in t)if(e.$.error.hasOwnProperty(r)&&"ERR02"===e.$.error[r].code){var i=e.$.model.fieldList[r];i.mandatory=!1,store.addField(e.$.model._name,r,i.type,i),e.$.set(r,void 0)}},unloadCurrentModuleRecords:function(e){e&&e.$.rollBack()},validateLayoutswitchingForSubForm:function(e,t){e.forEach(function(e){var r=this.getData("modifiedCreatebject"),i=this.getData("dataBind")[e],a=[];if(i&&i.length&&i.forEach((function(e){a.push(e.$.toJSON())})),r[e]=a,this.setData("modifiedCreatebject",r),t){var s=this.getData("initialCreatebject");s[e]=a,this.setData("initialCreatebject",s)}}.bind(this))},revertOriginalData:function(){var e=this.getData("originalData"),t=this.getData("dataBind");for(var r in e)"multi-picklist"==t.$.model.fieldList[r].type&&t[r]&&"string"!=typeof t[r]&&(t[r]=JSON.stringify(t[r]))},rollBackCreateEntityRecord:function(){var e=this.component?this.component.querySelector("crm-create-layout"):void 0;if(e){var t=e.getData("dataBind");if(t&&validationUtils.isNotEmpty(t.$)){var r=e.getData("currsubformApinames"),i=[];r&&r.length&&t&&r.forEach((function(e){t.$.model.fieldList[e]&&"relation"==t.$.model.fieldList[e].type&&t.$.model.fieldList[e].relatedTo&&i.push(t.$.model.fieldList[e].relatedTo)})),(t=store.peekRecord(t.$.model._name,t.id))&&t.$.rollBack();for(var a=i&&i.length?i.length:0,s=0;s<a;s++)store.rollBack(i[s])}}},validateAndFocusMandatorySubform:function(e,t,r,i){for(var a,s=!0,o=e.querySelectorAll("crm-create-subformfields"),n=o.length,l=0;l<n;l++){var c=o[l].component.data;c.subformFields.read_only||"SERIAL_NUMBER"===c.subformFields.column_name||(c.subformFields.read_only||(s=!1),Lyte.Component.set(e.component.data,"mandatoryError",!0),void 0===a&&(a=o[l],$L.fastdom.measure(function(e,t,r){var a=e?e.getBoundingClientRect():"",s=a.top,o=a.left;i=this.getLatestErrorFocusField(i,s,o,e,t,r,!0)}.bind(this,o[l],!0,!1))))}s||(t.mandatoryError=!0,r.isValidMandatorySubforms=!1)},checkMandatorySubForm:function(e,t,r){if(Crm.userDetails.isMandatorySubFormEnabled){var i=document.querySelector("#"+this.data.module+"_SubForm_"+e);if(!t&&i){var a=i.component.data,s={isValidMandatorySubforms:!0},o=a.subformsectionData.isvalidSection;if(!o){var n="crm-create-layout#"+this.getData("module")+"LC_layoutNode";$L(n)[0].component.data.skipMandatory=!0}if(a.isMandatorySubform&&o){Lyte.Component.set(i.component.data,"mandatoryError",!1);for(var l=a.subFieldsarray,c=l.length,d=a.dataBind[a.apiName],u=!0,m=d.length,p=0;p<m;p++){for(var g=!1,f=0;f<c;f++)if(500!==l[f].ui_type&&"SERIAL_NUMBER"!==l[f].column_name&&(2!==l[f].ui_type||"-None-"!==d[p][l[f].api_name])&&(100!==l[f].ui_type||"[]"!==d[p][l[f].api_name])&&d[p][l[f].api_name]){g=!0;break}g||(u=!1)}u||this.validateAndFocusMandatorySubform(i,a,s,r)}}}},checkAllMandatorySubForms:function(e,t){if(Crm.userDetails.isMandatorySubFormEnabled){var r=document.querySelectorAll("crm-create-subformsection"),i=r?r.length:0,a={},s="crm-create-layout#"+this.getData("module")+"LC_layoutNode",o=$L(s)[0];if(a.isValidMandatorySubforms=!0,!e&&i>0){for(var n=0;n<i;n++){var l=!0,c=r[n],d=c.component.data,u=d.subformsectionData.isvalidSection;if(!u&&o&&(o.component.data.skipMandatory=!0),d.isMandatorySubform&&u){Lyte.Component.set(c.component.data,"mandatoryError",!1);for(var m=d.subFieldsarray,p=m.length,g=d.dataBind[d.apiName],f=g.length,h=0;h<f;h++){for(var y=!1,v=0;v<p;v++)if(500!==m[v].ui_type&&"SERIAL_NUMBER"!==m[v].column_name&&(2!==m[v].ui_type||"-None-"!==g[h][m[v].api_name])&&(100!==m[v].ui_type||"[]"!==g[h][m[v].api_name])&&g[h][m[v].api_name]){y=!0;break}y||(l=!1)}l||this.validateAndFocusMandatorySubform(c,d,a,t)}}if(!a.isValidMandatorySubforms)return!1}}return!0},clearUIError:function(){for(var e=document.querySelectorAll("crm-create-fields,crm-create-subformsection,crm-create-subformfields"),t=e.length,r=0;r<t;r++){if(validationUtils.isNotEmpty(e[r].component.data.errorDetails))Lyte.Component.set(e[r].component.data,"errorDetails",{});else if(validationUtils.isNotEmpty(e[r].component.data.aggerrorDetails)){Lyte.Component.set(e[r].component.data,"aggerrorDetails",{});var i=e[r].component.$node.querySelector(".cuserrorAborder");if(i){i.classList.remove("cuserrorAborder");var a=$L(i).parents(".lcAggError")[0];a&&a.classList.remove("lcAggError")}}var s=e[r].firstElementChild;if(s&&s.classList&&(s.classList.contains("highL")&&s.classList.remove("highL"),s.classList.contains("errorFieldP"))){var o=s.querySelector(".FValue.uploadDoc");if(o){s.classList.remove("errorFieldP");var n=o.querySelector("span.errMsg");n&&n.remove()}}}},handleOneLayoutrule:function(e,t,r,i){var a=r.component.data.dataBind,s=e.getData("isWizard");s&&!a.Owner&&(a.Owner=5678);var o=[];t&&t.forEach((function(t){t.screen&&r&&r.component.data.activeScreen&&t.screen.id!==r.component.data.activeScreen.id||(t.actions&&t.actions.length&&o.push(t.actions),e.handleOneLayoutruleQuery(e,t,a,r,i))})),s&&5678===a.Owner&&delete a.Owner;var n=o&&o.length?o.length:0;if(n)for(var l=0;l<n;l++)for(var c=o[l],d=o[l].length,u=0;u<d;u++){var m=c[u];validationUtils.isNotEmpty(m)&&("Mandatory_Fields"==m.type?g(1,m.fields):"Show_Fields"==m.type?g(2,m.fields):"Show_Sections"==m.type&&p(m.sections))}function p(t){var a=e.getData("moduleSections");a=a||[],(t=t||[]).forEach((function(t){var s=a.filter((function(e){if(e.name==t)return e}));(s=s&&s[0]?s[0]:void 0)&&(s.fields||[]).forEach((function(t){!t.required||t.visible&&t.view_type[i]&&!t.read_only||e.revertMandatoryForHiddenField(r,t)}))}))}function g(t,a){var s=e.getData("moduleData.fields").filter((function(e){return a.filter((function(t){return t.id==e.id})).length}));s.length&&s.forEach((function(a){a.isCurrentFieldHiddenInLR&&(a.ShowFldsValidatedAndPassed||e.handleCurrentFieldInLR(a,r,i),delete a.isCurrentFieldHiddenInLR),1===t?(a.MandFldsValidatedAndPassed=!1,delete a.clearedRecordError):a.ShowFldsValidatedAndPassed=!1,!a.required||a.visible&&a.view_type[i]&&!a.read_only||e.revertMandatoryForHiddenField(r,a)}))}},revertMandatoryForHiddenField:function(e,t){var r=e.component.data.dataBind,i=r.$.model.fieldList[t.api_name];i&&i.mandatory&&(i.mandatory=!1,store.addField(r.$.model._name,t.api_name,i.type,i))},handleOneLayoutruleQuery:function(e,t,r,i,a){var s=t.criteria;if(t.actions&&t.actions.length){var o=e.checkCriteriaMatch(s,r,void 0,void 0,e);void 0===o&&(o=!1),e.triggerLayoutruleActions(e,t,r,o,i,a)}},handleCurrentFieldInLR:function(e,t,r){var i,a,s=e.api_name;if(this.getData("moduleSections").filter((function(t){t.fields&&t.fields.some((function(r){if(r.id===e.id)return i=r,a=t,r}))})),i){var o=i,n=t.component.data.dataBind,l=a||void 0,c=t.component,d=JSON.parse(JSON.stringify(i.view_type));d[r]=!1,i.isHiddenInLayoutRules=!0,Lyte.Component.set(i,"view_type",d),l&&!l.isSubformSection&&this.hideEmptySection(l),this.toggleMandatoryInRecord(!1,n,s,o),c.setData("skipMandatory",!0)}},triggerLayoutruleActions:function(e,t,r,i,a,s){t.actions&&t.actions.forEach((function(t){switch(t.type){case"Show_Fields":case"Mandatory_Fields":t.fields&&t.fields.forEach((function(o){e.handleLayoutruleActions(t.type,t,o,r,e,i,a,s)}));break;case"Show_Buttons":if(t.buttons){var o=t.buttons[0];if(!(u=document.querySelector("crm-create-wizard-buttons"))||!u.component)break;for(var n=(m=u.component.data.buttons).length,l=0;l<n;l++){var c=m[l],d=document.querySelector("[id="+CSS.escape(c.id)+"]");d&&o===c.id&&(d.style.display=i?"none":"inline")}}break;case"Enable_Buttons":if(t.buttons){var u;o=t.buttons[0];if(!(u=document.querySelector("crm-create-wizard-buttons"))||!u.component)break;var m;for(n=(m=u.component.data.buttons).length,l=0;l<n;l++){if(o==(c=m[l]).id){var p=document.querySelector("[id="+CSS.escape(c.id)+"]");i?($(p).css("pointer-events","none"),p.classList.add("disable")):($(p).css("pointer-events","auto"),p.classList.remove("disable"))}}}break;case"Show_Sections":t.sections&&t.sections.forEach((function(t){var s=e.getData("moduleSections").filter((function(e){if(e.name==t)return e}));if((s=s&&s[0]?s[0]:void 0)&&!s.isSubformSection){if(!i&&s.isValidSectionByLayoutRule)return;var o=s.fields;i?0==s.isvalidSection&&Lyte.Component.set(s,"isvalidSection",!0):Lyte.Component.set(s,"isvalidSection",!1),o.forEach((function(t){var s=t.api_name;"EMAIL"===t.column_name&&"Cases"===a.getData("moduleData.module_name")&&e.checkEmailforCaseOrigin(r,r.Case_Origin),i?e.toggleMandatoryInRecord(!0,r,s,t):e.toggleMandatoryInRecord(!1,r,s,t)})),i&&s&&!s.isSubformSection&&0==s.haveValidFields&&Lyte.Component.set(s,"isvalidSection",!1),s.isValidSectionByLayoutRule=!!i,s.hiddenbyLR=!i}}));break;case"Show_Subforms":t.subforms&&t.subforms.forEach((function(t){var r=e.getData("moduleSections").filter((function(e){if(e.subform_apiname===t&&(e.isSubformSection||e.screen))return e}));if(r=r&&r[0]?r[0]:void 0){if(!i&&r.isValidSectionByLayoutRule)return;i?r.isvalidSection||Lyte.Component.set(r,"isvalidSection",!0):Lyte.Component.set(r,"isvalidSection",!1),e.toggleMandatoryInSubformRecord(e,t,r.fields,i),r.isValidSectionByLayoutRule=!!i}}))}}))},handleLayoutruleActions:function(e,t,r,i,a,s,o,n){var l,c,d=r.api_name;this.getData("moduleSections").filter((function(e){(e.type&&"used"===e.type||e.screen)&&e.fields&&e.fields.some((function(t){if(t.id==r.id)return l=t,c=e,t}))}));var u=c||void 0;if(l){var m=l;switch(e){case"Mandatory_Fields":if(m.isLayoutMandatory)return;if(s!=m.required){if(!m.read_only&&m.visible&&u.isvalidSection&&!l.MandFldsValidatedAndPassed){var p=i.$.model.fieldList[d];l.MandFldsValidatedAndPassed=s,p.mandatory=s,p.mandatory&&!p.validation&&(p.validation="emptyValueValidation"),store.addField(i.$.model._name,d,p.type,p),Lyte.Component.set(m,"required",s),"picklist"==m.data_type&&(s?"-None-"==i[d]&&Lyte.Component.set(i,d,""):"-None-"==i[d]?(Lyte.Component.set(i,d,"1"),Lyte.Component.set(i,d,"-None-")):i[d]||"STAGE"===p.columnName||Lyte.Component.set(i,d,"-None-")),!s&&validationUtils.isNotEmpty(m.errorDetails)&&"ERR02"===m.errorDetails.code&&(l.clearedRecordError=Lyte.deepCopyObject(m.errorDetails),Lyte.Component.set(m,"errorDetails",{})),s&&validationUtils.isNotEmpty(l.clearedRecordError)&&Lyte.Component.set(m,"errorDetails",l.clearedRecordError)}}else s&&(l.MandFldsValidatedAndPassed=s,validationUtils.isNotEmpty(l.clearedRecordError)&&Lyte.Component.set(m,"errorDetails",l.clearedRecordError));break;case"Show_Fields":if(s&&l.view_type[n]&&(l.ShowFldsValidatedAndPassed=!0),s!=l.view_type[n]){var g=JSON.parse(JSON.stringify(l.view_type)),f=o.component;if(s){g[n]=!0,l.isHiddenInLayoutRules=!1,l.ShowFldsValidatedAndPassed=!0,l.disableLyteViewPortForField=!0,Lyte.Component.set(l,"view_type",g),"EMAIL"===l.column_name&&"Cases"===f.data.moduleData.module_name&&a.checkEmailforCaseOrigin(i,i.Case_Origin);var h=a.haveValidFldsinSection(u,l.api_name);!u||u.isvalidSection||h||u.hiddenbyLR||!u.haveValidFields||Lyte.Component.set(u,"isvalidSection",!0),a.toggleMandatoryInRecord(!0,i,d,m),f.setData("skipMandatory",!1)}else if(!l.ShowFldsValidatedAndPassed){if(a.data.apiName===l.api_name&&"lookup"===l.data_type)return l.isCurrentFieldHiddenInLR=!0,void(l.view_type[n]=!1);g[n]=!1,l.isHiddenInLayoutRules=!0,Lyte.Component.set(l,"view_type",g),"EMAIL"===l.column_name&&"Cases"===f.data.moduleData.module_name&&a.checkEmailforCaseOrigin(i,i.Case_Origin),u&&!u.isSubformSection&&a.hideEmptySection(u),a.toggleMandatoryInRecord(!1,i,d,m),f.setData("skipMandatory",!0)}}}}},processLayoutRules:function(){var e,t,r,i=this,a=this.getData("dataBind"),s="crm-create-layout#"+store.peekRecord("module",a.$.model._name).module_name+"LC_layoutNode",o=$L(s)[0];if(o&&(e=o.component.data.layoutRules,t=o.component.data.selectedLayoutid,r=o.component.data.moduleSections),t&&o.component.data.isWizard&&(t=t.split(";")[0]),e){var n="edit"==i.getData("initRoute")?"edit":"create";e.forEach((function(e){if((e.layout.id?e.layout.id:e.layout)==t){var r=i.getData("moduleData.fields").filter((function(t){return t.id==e.primary_field.id}))[0];(o&&o.component.data.isWizard||r&&r.visible&&(r.view_type[n]||r.isHiddenInLayoutRules))&&i.handleOneLayoutrule(i,e.queries,o,n)}})),r&&r.length&&(this.data.moduleData.createTabIndex=1,r.forEach(function(e){delete e.isValidSectionByLayoutRule,e&&e.isvalidSection&&this.setTabIndexForFields(this.data.moduleData,e,n,void 0,void 0,!0)}.bind(this)))}},deserializeData:function(e,t,r,i,a){if("string"===a&&e?e=e.toString():!e||isNaN(e)||"integer"!==a&&"double"!==a?"boolean"===a&&(e=!!e):e=Number(e),!e||"multi-picklist"==t||"tax"==t||"phone"==t){if("multi-picklist"!=t&&"tax"!=t)return"time-in-hrs"==t?0===e?"0":e:"time-in-minutes"==t&&0===e?"0":e;if("string"==typeof e)return-1!=e.indexOf("; ")?JSON.stringify(e.split("; ").filter((function(e){if(e)return e}))):e?JSON.stringify(e.split().filter((function(e){if(e)return e}))):e;if(!e)return JSON.stringify([]);if(!e.length)return JSON.stringify(e);if("string"==typeof e[0])return JSON.stringify(e.filter((function(e){if(e)return e})));if("object"==typeof e[0]){var s=e.map((function(e){return e.value}));return JSON.stringify(s.filter((function(e){if(e)return e})))}}if("date"==t)return e=e.replace(/[+-]\d{2}:\d{2}/,""),CrmDateUtils.convertDateToUserPattern(CrmDateUtils.getDateObjectFromString(e,"YYYY-MM-DD"));if("datetime"==t)return e=e.replace(/[+-]\d{2}:\d{2}/,""),this.getDateTimeForForm(new Date(e),!0);if("relation"==t&&"hasMany"==r.relType&&e.length>0){for(var o=i.model?i.model.fieldList:{},n=e.length,l=0;l<n;l++)for(var c in o=validationUtils.isEmpty(o)?i[l].$.model.fieldList:o)"date"!=o[c].type&&"datetime"!=o[c].type&&"phone"!=o[c].type&&"multi-picklist"!=o[c].type&&"tax"!=o[c].type&&"time-in-hrs"!==o[c].type&&"time-in-minutes"!==o[c].type||e[l].hasOwnProperty(c)&&(i[l][c]=this.deserializeData(e[l][c],o[c].type,o[c]));return i}if("time-in-hrs"==t){if(e)return Utils.convertTimeInDoubleToReadableForm(e,"hr");if(0===e)return"0"}else if("time-in-minutes"==t){if(e)return Utils.convertTimeInDoubleToReadableForm(e);if(0===e)return"0"}return e},getDateTimeForForm:function(e,t){var r=Utils.getDateInUserDatePattern(e);if("HH:mm"==Crm.userDetails.TIME_FORMAT)return r+"TV"+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes());var i=Utils.convertTo12HoursFormatTimeObj(e,t);return r+"TV"+i.hrs+":"+i.mins+" "+i.meridiem},formulaWorkerExecution:function(e,t,r,i,a){var s=t.api_name,o=[32,36,38,39,40,52,77,143,144,145,117],n=e?e.length:0,l=Crm.userDetails;l.am=I18n.getMsg("AM"),l.pm=I18n.getMsg("PM");for(var c=0;c<n;c++)if(e[c].fieldsInvolved.contains(s)||e[c].fieldsInvolved.contains("_NO_VALID_FIELDS")||a){var d=e[c].formulaObj.expression;d=crmFormulaInit.prototype.removeWhiteSpaces(d);for(var u=e[c].fieldsInvolved,m=u.length,p=!1,g=0;g<m;g++){var f=r[u[g]];validationUtils.isNotEmpty(r.$.error[u[g]])&&(f="ERR02"==r.$.error[u[g]].code?f:r.$.error[u[g]].value);var h=r.$.model.fieldList[u[g]],y=h?store.peekRecord("field",h.fieldID):void 0;if(f=void 0===f&&y&&y.default_value?y.default_value:f,(f=h&&"picklist"==h.fieldType&&"-None-"==f?"":f)&&"string"==typeof f&&f.length>0){if(h&&"datetime"==h.fieldType){var v=f.split("TV");f=new CrmDate(CrmDateUtils.getDateObjectFromString(v[0])).getDateInPattern("MMM D,YYYY")+" "+v[1]}else if(h&&"date"==h.fieldType){f=new CrmDate(CrmDateUtils.getDateObjectFromString(f)).getDateInPattern("MMM D,YYYY")}else h&&"multiselectpicklist"===h.fieldType&&-1!==f.indexOf("[")&&(f=JSON.parse(f).join(";"));f=f.replace(/'/g,"\\'").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/,/g,"\\,")}f&&"object"==typeof f&&h&&"lookup"!=h.fieldType&&(f=f.name?f.name:f.full_name?f.full_name:""),h&&"lookup"==h.fieldType&&(f=i||(validationUtils.isNotEmpty(f)?f.name:"")),f?(d=d.replace("${"+u[g]+"}",f),p=!0):(h&&"datetime"!==h.fieldType&&"date"!==h.fieldType||"_NO_VALID_FIELDS"==u[g])&&(f=h&&$L.inArray(h.uiType,o)>=0?0:"",d=d.replace("${"+u[g]+"}",f),p=!0)}p&&crmFormulaInit.prototype.createLFormulaWorker.postMessage({toConvert:d,userDetails:l,fromLyteC:{sourcefieldData:t,sourceRecord:r.$.toJSON(),fldData:e[c],sourceRecordKeys:{id:r.id,model:r.$.model._name}}}),crmFormulaInit.prototype.createLFormulaWorker.onmessage=function(e){var t=e.data.fromLyteC,r=t?t.fldData.formulaObj:void 0;if(r&&("datetime"==r.return_type||"date"==r.return_type)){var i=(a=e.data.resFromFormulaWorker).split(" ")[0];a=i&&!Utils.isValidDate(Crm.userDetails.DATE_PATTERN,i)?new Date(a):new Date(Utils.convertUsrtoDefaultDatePattern(a)),a="date"==r.return_type?Utils.getDateInUserDatePattern(a,!1):Utils.getDateTimeInUserFormat(a,!0,"false"),e.data.resFromFormulaWorker=a}if(r&&r.expression.startsWith("Datepart"))try{var a=e.data.resFromFormulaWorker;a=CrmDateUtils.convertDateToUserPattern(new Date(a)),e.data.resFromFormulaWorker=a}catch(e){murphy.error(e)}if(t){var s=store.peekRecord(t.sourceRecordKeys.model,t.sourceRecordKeys.id);if(s.$.model.fieldList[t.fldData.formulaApiname]){var o=e.data.resFromFormulaWorker;switch(o="string"==typeof o&&o.trim()?o.trim():"",s.$.model.fieldList[t.fldData.formulaApiname].type){case"number":o=isNaN(parseFloat(o))?void 0:parseFloat(o);break;case"boolean":o="true"===o}var n=t.fldData.formulaObj.return_type;"currency"!=n&&"double"!=n&&"number"!=n||(o=parseFloat(parseFloat(o).toFixed(t.fldData.decimalPlace)),o=isNaN(o)?void 0:o),void 0!==o&&s.$.set(t.fldData.formulaApiname,o)}}}}},handleEditPromise:function(e,t){var r=this.parent.parent.currentModel.module,i=!this.transition.data.layoutId&&e.data&&e.data[0]&&("draft"===e.data[0].$state||!validationUtils.isEmpty(e.data[0].Wizard)),a=e.data&&e.data[0]&&"save"===e.data[0].$state,s=this.parent.parent.getDynamicParam();if("PriceBooks"!=s&&"Activities"!=s&&"Quotes"!=s&&"Invoices"!=s&&"SalesOrders"!=s&&"PurchaseOrders"!=s){var o=moduleRecordMapping[s].id,n=store.peekRecord("module",o);if(!n||!(i&&n.creatable||n.editable))return crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),void this.transition.abort()}if(i){var l,c;if(this.isWizard=!0,c=e.data[0].Layout?e.data[0].Layout:{id:e.layout_jsonarrayObj.currLayoutId},l=c.id,!e.data[0].$editable)return crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),void this.transition.abort();var d=this;return this.getModulePromise(l,r.api_name,s,e.data[0],e.data[0].Wizard.id,void 0,!0).then((function(o){for(var n,u=e.data[0],m=Object.keys(u),p=m.length,g=["date","datetime","multi-picklist","phone"],f={},h=store.modelFor(r.id),y=h.fieldList,v=0;v<p;v++)null==u[m[v]]?u[m[v]]=void 0:y[m[v]]&&u[m[v]]&&g.indexOf(y[m[v]].type)>-1?f[m[v]]=u[m[v]]:y[m[v]]&&"relation"==y[m[v]].type&&"hasMany"==y[m[v]].relType&&u[m[v]]&&u[m[v]].length&&(f[m[v]]=u[m[v]].slice(0));return u&&u.$process_flow?(store.pushPayload(r.id,u),d.getEntityRecordBluePrintProcessInfo(u.id,s).then(function(e){return n=e&&e.blueprint?e.blueprint:void 0,_()}.bind(this))):_();function _(){var s=h.relations;for(var m in s){var p=s[m];p&&p.length&&"hasMany"==p[0].relType&&!u[p[0].relKey]&&(u[p[0].relKey]=[])}store.pushPayload(r.id,u);var g,y,v=[],_=store.peekRecord("wizard-container",l);if(!_||!_.chart_data)return crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),void d.transition.abort();if(y=_.chart_data.nodes.length,o.layout=[],u.$wizard_connection_path&&u.$wizard_connection_path.length){var b,w=store.peekRecord("wizard-container",l),C=u.$wizard_connection_path,D=0;C.forEach((function(e,t){if(0===t){var r={id:(i=w.chart_data.screen_connections[e]).source_screen.id,name:i.source_screen.display_label,index:D++};v.push(r)}var i;r={id:(i=w.chart_data.screen_connections[e]).target_screen.id,name:i.target_screen.display_label,index:D++};v.push(r),b=i.target_screen.id})),g=(P=store.peekRecord("wizard-screen",b)).segments}else for(var L=0;L<y;L++){var R=_.chart_data.nodes[L];if(R.start_node){var P;g=(P=store.peekRecord("wizard-screen",R.screen.id)).segments,v.push({id:P.id,name:P.name,index:0});break}}o.layout.push(store.peekRecord("layout",l));var I=i&&!a?"create_clone":"edit";return o.custom_button&&o.custom_button.length&&(o.custom_button=o.custom_button.filter((function(e){return e.position===I}))),{initRoute:"edit",entityrecordData:store.peekRecord(r.id,e.data[0].id),transitionData:t,layoutRules:o.layout_rule,validationRules:o.validation_rule,customButtons:o.custom_button,moduleData:r,moduleId:r.id,moduleName:r.module_name,currsubformApinames:r.currsubformApinames?r.currsubformApinames:[],layoutddData:[{uservalue:c.name,systemvalue:c.id,id:c.id}],layoutddSelected:c.name,selectedLayoutid:c.id+";"+e.data[0].Wizard.id,moduleSections:g,layoutDet:c,isWizard:!0,screenHistory:v,originalData:f,fcCategory:o.fc_category?o.fc_category.stages:[],bluePrintProcessInfo:n||void 0,currentModuleAutoEnrichment:o.auto_enrichment}}}))}return e},handleOmitedStageInPotential:function(){var e=this.getData("dataBind");if(e.Stage){var t=this.getData("moduleData.fields").filter((function(e){return"STAGE"==e.column_name}))[0];if(t&&"Stage"==t.api_name){var r=t.pick_list_values.filter((function(t){return t.display_value==e.Stage}))[0];if(r&&r.id){r=this.getData("fcCategory")?this.getData("fcCategory").filter((function(e){return e.id==r.id}))[0]:void 0;var i=this.getData("initRoute");if(r&&("Closed Lost"===r.deal_category||"Closed Lost"===r.forecast_type)&&(e.Stage!==t.old_Stage_Value||"create"===i||"clone"===i)&&!this.getData("isstageSave")){var a=document.querySelector("#verifyStageDetailsmodal");if(a){var s=a.closest("crm-create-buttons");s&&r.colour_code&&Lyte.Component.set(s.component.data.stageDetails,"plColorCode",r.colour_code);var o={left:"center",top:"0px"},n={animation:"slideFromTop",duration:"0.3"};return a.ltProp("transition",n),a.ltProp("offset",o),a.ltProp("showCloseButton",!1),a.ltProp("show",!0),!0}}}}}return!1},closeStageDetailsmodal:function(){this.setData("isstageSave",!1),this.setData("disableFormbuttons",!1),this.setData("reasonforLoss","");var e=document.querySelector("crm-create-wizard-buttons");e&&e.component&&e.component.setData("disableFormbuttons",!1);var t=document.querySelector("#verifyStageDetailsmodal");t&&t.ltProp("show",!1)},shownoresultsForSearch:function(e,t,r,i,a,s){var o=function(){if(!document.querySelector(".noresultstyleCPage")){var e="."+this.$node.component.data.picklistsearchKey,t=document.querySelector(e),r=document.createElement("div");r.setAttribute("class","noresultstyleCPage");var i=I18n.getMsg("crm.label.no.options.found");this.data.moduledataUicomp&&"Native__Survey__Extn__Survey"===this.data.moduledataUicomp.api_name&&(i=I18n.getMsg("crm.zsurvey.list.empty.msg"),r.classList.add("lzsurveyNoResults")),r.textContent=i,t.appendChild(r)}};if(s){var n,l=e,c=a,d=[],u=[];if(l.forEach((function(e){/lyte-drop-label/i.test(e.tagName)?-1===d.indexOf(e)&&d.push(e):-1===u.indexOf(e)&&u.push(e)})),d.forEach((function(e){var t=Array.from(e.parentNode.children);t.shift(),t.forEach((function(e){/lyte-drop-item/i.test(e.tagName)&&(e=e.children[0]);var t=c.indexOf(e);-1!==t&&(c.splice(t,1),l.push(e))}))})),u.forEach((function(e){var t;t=/span/i.test(e.tagName)?e.parentNode.parentNode.children[0]:e.parentNode.children[0];var r=c.indexOf(t);-1!==r&&(c.splice(r,1),l.push(t))})),c.forEach((function(e){/span/i.test(e.tagName)&&(e=e.parentNode),e.classList.add("lyteSearchHidden"),/lyte-drop-label/i.test(e.tagName)&&e.parentNode.classList.add("lyteSearchHidden")})),l.forEach((function(e,t){/span/i.test(e.tagName)&&(e=e.parentNode),i&&"zsurvey___crm__SYSTEM__NONE"===e.getAttribute("data-value")?(e.classList.add("lyteSearchHidden"),n=t):(e.classList.remove("lyteSearchHidden"),/lyte-drop-label/i.test(e.tagName)&&e.parentNode.classList.remove("lyteSearchHidden"))})),void 0!==n&&l.splice(n,1),l&&l.length)(p=document.querySelector(".noresultstyleCPage"))&&p.remove();else o.call(this);return!1}var m=!0;if("string"==typeof i&&i.length&&!i.trim()&&((e=e.concat(a)).forEach((function(e){e.classList.remove("lyteSearchHidden")})),m=!1),0===e.length)o.call(this);else{var p=document.querySelector(".noresultstyleCPage"),g=e[0];m&&g&&($L(g).parent().find(".lyteDropdownSelection").removeClass("lyteDropdownSelection"),$L(g).addClass("lyteDropdownSelection")),p&&p.remove()}return m},autoFocusSearchField:function(){var e=this.getData("picklistsearchKey");if(e){var t="."+e+" lyte-search lyte-input",r=document.querySelector(t);r&&r.focus()}},calculatorOperationCreate:function(e,t,r,i){var a=$(e),s=a.parents(".FValue").find(".resultValue"),o=t.which?t.which:t.keyCode,n=a.val(),l=!(!t.ctrlKey&&!t.metaKey);if("keypress"===t.type){if(!([43,45,42,47,13,40,41,46,8,9,97,118,99].indexOf(o)>-1||o>=48&&o<=57))return t.preventDefault(),!1;if(13===o)return a.trigger("blur"),t.preventDefault(),!1;if(-1!==[97,99,118].indexOf(o)&&!l)return t.preventDefault(),!1}else if("keyup"===t.type)this.calculationProcessAreaCreate(a);else if("blur"===t.type){if(n=crmTemplate.memberDataStoreLI,""!==s.attr("data-valueRes")){var c=s.attr("data-valueRes");""!==c&&""!==n?(!0===crmTemplate.setPreviousValueToContainer&&a.attr("data-finalValue",n+" = "+c),a.val(c),s.attr("data-valueRes","").addClass("vh"),Lyte.Component.set(i,r.api_name,c)):c&&isNaN(c)&&this.handleCScriptDispatchEvent({fieldID:r.id,uiType:r.ui_type,fldapiName:r.api_name,calledFrom:"onChange"})}else crmTemplate.calculatorProcessingOrder=[],Lyte.Component.set(i,r.api_name,a.val());crmTemplate.memberDataStoreLI=""}},calculationProcessAreaCreate:function(e){var t=e,r=t.parents(".FValue"),i=r.find(".resultValue"),a=t.val(),s=r.attr("data-decimal-length"),o=a=a.replace(/ /g,""),n="";if(-1===o.indexOf(","))if(""===o||o.match(/[a-z]/i))crmTemplate.memberDataStoreLI="",i.addClass("vh"),i.attr("data-valueRes",n);else{var l=crmTemplate.checkBrackets(o);if(/^(\+|\*|\/)/.test(o)&&(o=o.substr(1)),""===a&&i.text(n),""!==o){var c=/^((?!([+\-*/.]{2,})).)*$/.test(o);if(c){if("0"==o)n="0";else if(!0===l){if(-1===o.indexOf("()")){var d=o.length-1;if(crmTemplate.checkCorrectInputEle(o))crmTemplate.checkDotCorrectInput(o)&&(-1===["+","-","*","/","."].indexOf(o[d])||"."!==(o=o.slice(0,-1)))&&(o=crmTemplate.clearLeadingZero(o),(n=new Function("return "+o)())%1!=0&&(n=void 0!==s?Number(Math.round(n+"e"+s)+"e-"+s):Math.round(100*n)/100)),crmTemplate.setPreviousValueToContainer=!0,crmTemplate.memberDataStoreLI=o}}else n=i.text();""===t.val()&&(n="",i.addClass("vh")),i.text(n),i.attr("data-valueRes",n)}!0===/[+\-*/(]/.test(a)&&l&&!0===c&&"+"!==o&&""!==o&&""!==n?i.removeClass("vh"):i.addClass("vh")}else crmTemplate.memberDataStoreLI="",i.addClass("vh")}else crmTemplate.memberDataStoreLI=""},filterValidUITypes:function(e,t,r,i){var a=store.modelFor(e.$.model._name).fieldList,s={},o=!1,n=e.$.toJSON(),l=Object.keys(a),c=l.length,d=["$approved","$state","$transitionid","Data_Source"];"edit"!=(t="edit"===t?"edit":"create")&&d.push("id");for(var u=0;u<c;u++)if(a[l[u]]&&a[l[u]].fieldID&&!["WIZARDID","LAYOUTID","TAGMODULEREFID","LASTACTIVITYTIME","EXCHANGERATE"].contains(a[l[u]].columnName)&&"relation"!==a[l[u]].type&&!d.contains(l[u])&&("picklist"!=a[l[u]].fieldType||"picklist"==a[l[u]].fieldType&&"-None-"!=n[l[u]])){var m=r.filter((function(e){return e.id==a[l[u]].fieldID}))[0];if(m&&m.visible&&m.view_type[t]&&this.fieldInPath(m)){var p;if("customButtons"===i){if("SALUTATION"===a[l[u]].columnName)continue;p=f(n[l[u]],a[l[u]].uiType)}else p=g(n[l[u]],a[l[u]].uiType,l[u]);s[l[u]]=p}}return o&&(s.$se_module=e.$se_module),!d.includes("id")&&e.id&&(s.id=e.id),s;function g(e,t,r){switch(t){case 3:case 8:case 116:case 117:case 123:case 200:case 208:case 209:case 221:case 444:case 20:case 39:case 51:case 55:case 77:case 96:case 99:case 100:case 110:case 111:case 556:case 445:case 66:case 555:case 111:return"";case 4:case 5:case 6:case 7:case 9:case 10:case 12:case 13:case 15:case 133:case 132:case 135:case 136:return Crm.userDetails.VALIDATION_RULE_CF_LOOKUPSUPPORT&&e?("What_Id"==r&&(o=!0),e):"";case 24:return e?Lyte.Transform.date.serialize(e):"";case 14:case 30:case 333:case 786:if(!e)return"";var i=Lyte.Transform.datetime.serialize(e);return Crm&&Crm.userDetails.TIME_ZONE&&(i+=Crm.userDetails.TIME_ZONE.replace(".",":")),i;case 300:case 301:return("true"===e||"1"===e||1==e)+"";case 33:return e?commonUtils.getPlainPhoneNo(e):"";default:return void 0===e||""===e||null===e?"":"string"==typeof e?e.trim():e+""}}function f(e,t){switch(t){case CrmField.UITYPES.ACCOUNT_NAME_LOOKUP:case CrmField.UITYPES.CAMPAIGN_NAME_LOOKUP:case CrmField.UITYPES.PRODUCT_NAME_LOOKUP:case CrmField.UITYPES.CONTACT_LOOKUP:case CrmField.UITYPES.OWNER:case CrmField.UITYPES.VENDOR_NAME_LOOKUP:case CrmField.UITYPES.POTENTIAL_ID:case CrmField.UITYPES.SALESORDER_ID:case CrmField.UITYPES.CONTACT_ID:case CrmField.UITYPES.QUOTE_ID:case 116:case CrmField.UITYPES.AGGREGATE_FIELD:case 123:case CrmField.UITYPES.LOOK_UP_ENTITY:case CrmField.UITYPES.CREATED_TIME:case CrmField.UITYPES.LAYOUT:case CrmField.UITYPES.TAGMODULEREFID:case CrmField.UITYPES.USERLOOKUP:case CrmField.UITYPES.MULTISELECT_LOOK_UP:case CrmField.UITYPES.CREATED_BY:case CrmField.UITYPES.RECORD_CURRENCY:case 51:case CrmField.UITYPES.PRODUCT_HANDLER:case 77:case CrmField.UITYPES.COMMENTCONTENTS:case CrmField.UITYPES.MULTI_PICK_LIST:case CrmField.UITYPES.MULTI_LINE_CF:case CrmField.UITYPES.AUTONUMBER:return"";case CrmField.UITYPES.DATE:return e?Lyte.Transform.date.serialize(e):"";case CrmField.UITYPES.DATE_TIME2:case CrmField.UITYPES.DATE_TIME1:case CrmField.UITYPES.DATE_TIME_LONG:case CrmField.UITYPES.DATETIME:if(!e)return"";var r=Lyte.Transform.datetime.serialize(e);return Crm&&Crm.userDetails.TIME_ZONE&&(r+=Crm.userDetails.TIME_ZONE.replace(".",":")),r;case CrmField.UITYPES.BOOLEAN_DEF:case CrmField.UITYPES.BOOLEAN_DEF_NOT:return("true"===e||"1"===e||!0===e)+"";case CrmField.UITYPES.PHONE:return e?commonUtils.getPlainPhoneNo(e):"";default:return void 0===e||""===e||null===e?"":"string"==typeof e?e.trim():e+""}}},handleVRFunctionResponse:function(e,t,r,i,a,s){var o={},n={},l=!1;try{for(var c=t.length,d=0;d<c;d++){var u=t[d];if("success"==u.status&&u.details){var m="string"==typeof u.details.output?JSON.parse(u.details.output.replace(/'/g,'"')):u.details.output;if(!m.status){l=!0;break}"success"!=m.status&&(m.message?a.push({message:m.message.substring(0,100),targetField:r[d].api_name,targetFieldId:r[d]._targetFieldid}):s||(i.setData("vrPassed",!0),Crm.showErrorMsg($ESAPI.encoder().encodeForHTML(m.message.substring(0,100)),o,e,undefined,undefined,"checkbox"==o.attr("type"))))}else if("INTERNAL_ERROR"==u.code||"INVALID_DATA"==u.code){l=!0;break}}}catch(e){l=!0}s||(l?(i.setData("vrPassed",!0),$("#newRelatedListPopUpDiv").css("z-index","100002").html('<div class="f21 p30  alignleft"><div class="proximas f21">'+I18n.getMsg("crm.validation.rule.function.error.heading")+'</div><div class="f16 mB10 mT10 proxima">'+I18n.getMsg("crm.validation.rule.function.error.title")+'</div><ul class="m0 b0 cutomfunctionalert"><li>'+I18n.getMsg("crm.validation.rule.function.error1")+"</li><li>"+I18n.getMsg("crm.validation.rule.function.error2")+'</li></ul> <br><div class="aligncenter"><input type="button" id="custom_alert_button" class="primarybtn" value="'+I18n.getMsg("crm.mb.newversion.msg4")+'" onclick="crmui.hidePopup(\'newRelatedListPopUpDiv\')"></div></div>',null,!0),crmui.showPopup("newRelatedListPopUpDiv"),$("#FreezeLayer").css("z-index","30")):validationUtils.isEmpty(n)||l||(i.setData("vrPassed",!0),$("#newRelatedListPopUpDiv").removeClass("w800").css("width","30%").html(Handlebars.templates.validationRuleError(n)),crmui.showPopup("newRelatedListPopUpDiv")))},setUploadDetailInRecord:function(){var e=this.getData("dataBind"),t=this.getData("moduledataUicomp.id"),r=this.getData("initRoute");if(fileupload&&validationUtils.isNotEmpty(fileupload.uploadDeleteObject)){var i=fileupload.uploadDeleteObject[t];if(i){var a=e[this.getData("apiName")];if("edit"===r&&a){for(var s=i?i.length:0,o=0;o<s;o++){if(i[o].hasOwnProperty("_delete")){var n=a.findIndex((function(e){return e.attachment_Id==i[o].attachment_id||e.attachment_id==i[o].attachment_id}));-1!=n&&Lyte.arrayUtils(a,"removeAt",n)}!a.filter((function(e){if(e.file_id)return e.file_id==i[o].file_id})).length&&Lyte.arrayUtils(a,"push",i[o]);var l=Array.from(a);a.forEach((function(e,t){e.file_id&&1==Object.keys(e).length&&!i.filter((function(t){return t.file_id==e.file_id})).length&&Lyte.arrayUtils(l,"removeAt",t)}))}Lyte.Component.set(e,this.getData("apiName"),l)}else Lyte.Component.set(e,this.getData("apiName"),i)}}this.uploadMaxLenCheck()},uploadMaxLenCheck:function(){var e=this.$node.component.data,t=e.moduledataUicomp;fileupload.module=e.modulenameUicomp,fileupload.fieldID=t.id;var r="#attachCount_"+e.fileUploadfieldid,i=this.$node.querySelector(r),a=this.$node.querySelector("lyte-button");if(i&&$(i).val()>=t.length){a.ltProp("disabled",!0),a.classList.add("cD"),a.classList.remove("cP");var s=5==t.length?"crm.attachment.fileUploadField.Maxcount.check":"crm.attachment.fileUploadField.Mincount.check";return this.setData("moduledataUicomp.fileUploadTooltipvalue",I18n.getMsg(s)),$(i).val()>t.length&&(e.dataBind.$.error[t.api_name]={code:"ERR_UPLOAD",message:1==t.length?I18n.getMsg("crm.file.upload.maxlength.exceeds",[t.field_label]):I18n.getMsg("crm.attachment.fileUploadField.Maxlen.check.field",[t.length,t.field_label])},e.dataBind.$.isError=!0),!1}a.ltProp("disabled",!1),a.classList.remove("cD"),a.classList.add("cP"),t.read_only&&this.setData("moduledataUicomp.fieldTooltipvalue",I18n.getMsg("crm.lable.read.only")),this.setData("moduledataUicomp.fileUploadTooltipvalue",""),validationUtils.isNotEmpty(e.dataBind.$.error[t.api_name])&&delete e.dataBind.$.error[t.api_name]},deleteCurrentInstanceProperties:function(e,t){delete e.addedMLRecords,delete e.changeOwnerDetails,delete e.invokeRemoveAllCall,delete e.createSpantag,delete e.createTabIndex,delete e.curr_transition_Data,delete e.recurring_read_Only,delete e.task_summary_msg,delete e.task_rec_rule,delete e.task_remsummary_msg,delete e.aggerrorDetails,delete e.renderedLayoutId,delete e.additionalFielddata,delete e.surveyTexterrorDetails,delete e.user_module_fields_FOL,delete e.currencyData,delete e.currentCurrencySymbol,delete e.survey_departments,delete e.zsurvey_subSurvey,delete e.zsurvey_surveyName,delete e.zsurvey_templates,delete e.fields_defaultValue_obj,delete e.bluePrintProcessInfo,delete e.inactiveMUserWarningmsg,delete e.inactiveMUserIds,delete e.inactiveMultiUsersarr,delete e.fieldlabelMaxwidthleft,delete e.fieldlabelMaxwidthright,delete e.isautofocusfieldPresent,delete e.addSubFormFielddata,delete e.isZsurveyEmptyDepartment,delete e.external_search_acc_CompanyId,delete e.skyEyeIntegrationEnabled;for(var r=e.fields.length,i=0;i<r;i++)"lookup"===e.fields[i].data_type&&(delete e.fields[i].isRelatedfieldempty,delete e.fields[i].selectedId,delete e.fields[i].lookupSingle,delete e.fields[i].reportingToread_only,delete e.fields[i].isRelatedListFOLAvailable,delete e.fields[i].modSelectedId,delete e.fields[i].conSelectedId,delete e.fields[i].modLookupSingle,delete e.fields[i].modLookupSingle),delete e.fields[i].survey_dep_options,delete e.fields[i].isNewSurveyField,delete e.fields[i].fieldTooltipvalue,delete e.fields[i].reportingToTooltip,delete e.fields[i].fileUploadTooltipvalue,delete e.fields[i].isBlankSurvey,delete e.fields[i].survey_sub_options,delete e.fields[i].existing_survey_templates,delete e.fields[i].showNewSurveyTextField,delete e.fields[i].survey_template_list,delete e.fields[i].currencyData,delete e.fields[i].errorDetails,delete e.fields[i].lookupStr,delete e.fields[i].orginalPicklistdata,delete e.fields[i].dpick_list_values,delete e.fields[i].recordToBeCreated,delete e.fields[i].isCscriptMandatory,delete e.fields[i].isCscriptReadOnly,delete e.fields[i].isSystemReadOnly,delete e.fields[i].subformFields,delete e.fields[i].aggFields,delete e.fields[i].dontSetDefaultValue,delete e.fields[i].tab_index,delete e.fields[i].hasMorethan100MxNRecords,delete e.fields[i].MandFldsValidatedAndPassed,delete e.fields[i].clearedRecordError,delete e.fields[i].ShowFldsValidatedAndPassed,delete e.fields[i].isLayoutMandatory,delete e.fields[i].conModule_pluralLabel_mxn,delete e.fields[i].old_Stage_Value,delete e.fields[i].is_Lead_SalutationClosed,delete e.fields[i].isSalInputFocused,delete e.fields[i].skipCscriptExecutionforField,delete e.fields[i].isHiddenInLayoutRules,delete e.fields[i].isExecuteCscriptForPhone,delete e.fields[i].isCurrentFieldHiddenInLR,delete e.fields[i].isSetValueFromScript,delete e.fields[i].disableLyteViewPortForField;t&&t.length&&t.forEach((function(e){delete e.isvalidSection,delete e.subformModuleName,delete e.haveValidFields,delete e.isValidSectionByLayoutRule,delete e.isMapDepSupportedSubform}))},handleDropDownChanges:function(e,t,r,i){var a=this.$node.component.data.dataBind;if(i&&(a=this.$node.component.data.databindSubform),"Stage"===t){var s=r.filter((function(t){return t.display_value==e})),o=s&&s[0]?s[0].probability:void 0;null!=o&&Lyte.Component.set(a,"Probability","-None-"==e?void 0:o),this.setExpectedRevenue()}if("Currency"===t){var n=this.getuserCurrencydata(e),l=this.getData("moduleData")?this.getData("moduleData"):this.getData("moduleInfo");l.$.set("currencyData",n),l.$.set("currentCurrencySymbol",n.symbol);for(var c,d=this.getData("moduleData.fields").filter((function(e){if(("currency"==e.data_type||"EXCHANGERATE"==e.column_name)&&validationUtils.isEmpty(e.subform)||"subform"==e.data_type)return"EXCHANGERATE"==e.column_name&&(c=e.api_name),e})),u=d.length,m=this.getData("dataBind"),p=c&&m[c]?m[c]:void 0,g=0;g<u;g++){var f=d[g];if(p=p||l.currencyData.er,"currency"==f.data_type){var h=m[f.api_name],y=m.$.error[f.api_name];if(null!=h||Lyte.Component.registeredHelpers.isNotEmpty(y)){this.setCScriptSkipFlagForField(f.id),this.convertCurrvalues(h,p,n,f,!1,void 0,void 0,y,m,l.module_name);var v="crm-create-fields#"+l.module_name+"_fldRow_"+f.column_name+" lyte-input input";$L(v).trigger("keypress").trigger("keyup").focus().trigger("blur")}}if("subform"==f.data_type){for(var _,b=m[f.api_name],w=b?b.length:0,C=f.subformFields,D=C&&C.length?C.length:0,L=0;L<D;L++)if("currency"==C[L].data_type&&!C[L].subform){for(var R=C[L].api_name,P=0;P<w;P++)for(var I in b[P])if(I==R){h=b[P][I],y=b[P].$.error[I];(null!=h||Lyte.Component.registeredHelpers.isNotEmpty(y))&&(Lyte.Component.set(b[P],"show",!0),this.convertCurrvalues(h,p,n,b[P],!0,I,P,y,b[P],l.module_name,f.api_name));break}_=C[L]}_&&_.$.set("triggerFormulaCalcObserver",!_.triggerFormulaCalcObserver);var S='crm-create-subformsection[subform-id="'+f.subform.id+'"]',M=document.querySelector(S);M&&(M.component.triggerFormulaCalculation&&M.component.triggerFormulaCalculation(void 0,"currConvert",M));for(var k=f.aggFields,T=k&&k.length?k.length:0,E=0;E<T;E++)if("currency"==k[E].data_type){h=m[k[E].api_name],y=m.$.error[k[E].api_name];(null!=h||Lyte.Component.registeredHelpers.isNotEmpty(y))&&(this.setCScriptSkipFlagForField(k[E].id),this.convertCurrvalues(h,p,n,k[E],!1,k[E].api_name,void 0,y,m,l.module_name))}}}m.$.set(c,Number(n.er))}for(var A=r.length,F=0;F<A;F++)if(r[F].display_value===e){var U=r[F].maps?r[F].maps.length:0;if(U>=1)for(var O=0;O<U;O++){var x=a.$.model.fieldList[r[F].maps[O].api_name],N=x?x.columnName:void 0;if(N){var j="crm-create-fields#"+this.getData("modulenameUicomp")+"_fldRow_"+N;if(i){var z=this.$node.component.data;j="crm-create-subformfields#"+z.moduleName+"_"+z.parentSubformdata.subform_apiname+"_R"+(z.indexVal+1)+"_"+r[F].maps[O].api_name}r[F].maps[O].pick_list_values.length>0?this.setdropdownProperties(r[F].maps[O].pick_list_values,j,!0,r[F].maps[O].api_name,N,this.getData("currentLayout"),t,i?"subform":void 0):this.setdropdownProperties(void 0,j,!0,r[F].maps[O].api_name,N,this.getData("currentLayout"),t,i?"subform":void 0)}}break}},convertCurrvalues:function(e,t,r,i,a,s,o,n,l,c,d){if(n&&Lyte.Component.registeredHelpers.isNotEmpty(n))if("ERR04"===n.code&&n.fieldValue)e=n.fieldValue?n.fieldValue:e;else if("ERR03"===n.code)e="NaN";else if("ERR02"===n.code&&void 0===n.value)return;if(!a&&"NaN"==e){var u;u=s?"#AggFld_"+c+"_"+s+" input":"crm-create-fields#"+c+"_fldRow_"+i.column_name+" input";var m=$L(u)[0];m&&(m.value="NaN")}var p=this.convertToCurrentCurrency(e,t,r.er);if(p=Number(p).toFixed(r.decimals),a)i[s]=isNaN(p)?p:Number(p),Lyte.Component.set(l,"__CUSTOM_sequence_NUMBER__",Math.floor(100*Math.random()).toString());else{var g=i.decimal_place;p=null!=r.decimals&&null!=g&&r.decimals>g?Number(p).toFixed(g):p,Lyte.Component.set(l,s||i.api_name,p)}if(s&&a){var f=$L("crm-create-subformfields#"+c+"_"+d+"_R"+(o+1)+"_"+s+" lyte-input")[0];p=isNaN(p)?p:Number(p),f&&p&&f.ltProp("value",p)}},convertToCurrentCurrency:function(e,t,r){return e/t*r},setExpectedRevenue:function(e){var t,r,i=this.getData("dataBind"),a=this;function s(e){if(t=e||i.Amount,validationUtils.isNotEmpty(i.$.error.Probability))r=parseFloat(i.$.error.Probability.value);else if(null==i.Probability){var s=i.Stage;if(s=validationUtils.isNotEmpty(i.$.error.Stage)?i.$.error.Stage.value?i.$.error.Stage.value:"ERR02"==i.$.error.Stage.code?"-None-":i.$.error.Stage.value:s)a.getData("moduleData").fields.filter((function(e){"STAGE"==e.column_name&&e.pick_list_values.forEach((function(e){e.display_value==s&&(r=e.probability)}))}));else r=void 0}else r=i.Probability;var o=function(e,t){return 0==e?"0":roundValue(t*(e/100)+"")}(r,t),n=i.$.model.fieldList.Expected_Revenue;n&&n.hasOwnProperty("decimal_place")&&!isNaN(Number(o))&&0!=o&&n.decimal_place<2&&(o=Number(o).toFixed(n.decimal_place)),Lyte.Component.set(i,"Expected_Revenue",isNaN(Number(o))?void 0:0==o?"0":o)}validationUtils.isEmpty(i.$.error.Amount)&&null!=i.Amount?(e&&this.setCScriptSkipFlagForField(i.$.model.fieldList.Expected_Revenue?i.$.model.fieldList.Expected_Revenue.fieldID:""),s()):validationUtils.isEmpty(i.$.error.Amount)?(e&&this.setCScriptSkipFlagForField(i.$.model.fieldList.Expected_Revenue?i.$.model.fieldList.Expected_Revenue.fieldID:""),Lyte.Component.set(i,"Expected_Revenue",void 0)):(e&&this.setCScriptSkipFlagForField(i.$.model.fieldList.Expected_Revenue?i.$.model.fieldList.Expected_Revenue.fieldID:""),isNaN(i.$.error.Amount.value)?Lyte.Component.set(i,"Expected_Revenue",0):s(i.$.error.Amount.value))},methods:{onDateNavigation:function(e,t,r,i){if(e&&e.target){var a=$L(e.target).closest(".lyteCalCurrentDate");a&&a.length&&i.$node.querySelector(".lyteCalToday").click()}},onCalendarClose:function(e){e&&(e.style.left="",e.style.top=""),this.$node.querySelector("lyte-input").revertToSelected(),this.handleScrollOnDropDownToggle("hide"),this.handleSubformHrzntlScrollforDate("hide")},removeBindToBody:function(e){document.getElementById(e).ltProp("BindToBody",!1)},openDropDownOnEnter:function(e,t){this.setFocusToDropdownOnEnter(e,t),this.handleScrollOnDropDownToggle("hide")},commonDropDownOnShow:function(e,t){if(this.handleScrollOnDropDownToggle("show"),this.autoFocusSearchField(),!!this.$node.querySelector("crux-picklist-component#Crm_Leads_FIRSTNAME_SALUTATION")&&this.data.moduledataUicomp&&t&&t.childComp){var r=t.childComp.querySelector('lyte-drop-item[data-value="-None-"]');r&&r.classList.add("lcsytemNoneValue")}},commonDropDownOnHide:function(e,t){this.handleScrollOnDropDownToggle("hide"),!!this.$node.querySelector("crux-picklist-component#Crm_Leads_FIRSTNAME_SALUTATION")&&this.data.moduledataUicomp&&(this.data.moduledataUicomp.is_Lead_SalutationClosed=!0,this.data.moduledataUicomp.isSalInputFocused||this.setFocusToDropdownOnEnter(e,t),delete this.data.moduledataUicomp.isSalInputFocused)},commonDropDownOnSelect:function(){this.focusDropDownDiv()},timeddOnShow:function(){setTimeout(function(){this.handleScrollOnDropDownToggle("show"),this.handleSubformHrzntlScrollforDate("show")}.bind(this),0)},timeddOnHide:function(e){if(this.handleScrollOnDropDownToggle("hide"),this.handleSubformHrzntlScrollforDate("hide"),e&&e.target){var t=event.target.parentNode;if(/lyte-drop-item/i.test(event.target.tagName)||t&&/lyte-drop-item/i.test(t.tagName))!this.$node.querySelector('lyte-input[lt-prop-type="date"]').ltProp("currentDate")&&this.getMethods("bindTime")&&this.executeMethod("bindTime")}}},actions:{checkDigitsLength:function(e,t,r,i){this.controlDigitsValue(e,t,r,i)},showHideElement:function(e,t){var r=document.getElementById(e);r&&r.ltProp("show")!==t&&r.ltProp("show",t)}},setFocusToDropdownOnEnter:function(e,t){if(e&&0===e.clientX&&0===e.clientY&&t&&t.$node){var r=t.$node.querySelector("div .lyteDummyEventContainer");r&&r.focus()}},setInitialQueryParam:function(e,t){if(-1===["CustomModule5001","CustomModule5002","CustomModule5003","CustomModule5004"].indexOf(e)){var r=this.parent.getDynamicParam(),i=(e=this.parent.parent.getDynamicParam(),{}),a=moduleRecordMapping[e].id;!store.model[a]&&store.registerModel(a,{},{extends:"entity"});var s=store.peekRecord(a,r),o=this.transition.info;if(s||store.findRecord(a,r).then((function(e){s=e[0]})),"Activities"==e&&(i.sub_module=this.parent.parent.getQueryParams().sub_module),s&&s.Layout&&s.Layout.id)i.layoutId=s.Layout.id;else for(var n=Crm.userDetails.PROFILE_NAME,l=moduleRecordMapping[e].layouts,c=l.length,d=0;d<c;d++)for(var u=l[d].profiles.length,m=0;m<u;m++)if(l[d].profiles[m].default&&l[d].profiles[m].name===n){i.layoutId=l[d].id;break}if(t&&s&&"draft"===s.$state&&s.Wizard&&s.Wizard.id&&(i.wizardId=s.Wizard.id),i.layoutId)return this.transition.data.skipModuleReqTrigger=!0,this.transition.abort(),this.replaceWith(o.route,o.dynamicParams[0],o.dynamicParams[1],i).data=this.transition.data}},createglobalhide:function(e){var t=e.target,r=t.parentElement;$L(t).parents("crm-entity-lookup")[0]||$L(t).parents(".imguploadDoc")[0]||$L(t).parents(".fileUploadLi")[0]&&r&&r.classList.contains("svgIconBoxFileUpload")||"deletelink"===t.id||t.classList.contains("lyteScrollContainer")||e.stopPropagation(),app.globalClickhandling(e)},controlDigitsValue:function(e,t,r,i){switch(t.keyCode){case 8:case 9:case 13:case 16:case 39:case 37:break;default:var a=r.querySelector("input"),s=$L(a).val(),o=s.length;if(setTimeout((function(){if(a.value){var t=a.value.length;-1==a.value.indexOf(".")&&t>o&&(a.value=a.value.substr(0,e))}}),10),a.value&&a.value.substring(a.selectionStart,a.selectionEnd))break;if(-1!=s.indexOf(".")&&(o&&o--,190==t.keyCode)){36!=i&&143!=i&&144!=i&&145!=i&&t.preventDefault();break}if(o>=e){if(190==t.keyCode&&-1==s.indexOf("."))break;if((t.ctrlKey||t.metaKey)&&(65==t.which||67==t.which||88==t.which||90==t.which))break;t.preventDefault()}}},createDebounceSearch:function(e,t){return function(){var r=this,i=arguments,a=function(){e.call(r,i)};clearTimeout(this.getData("debounceTimer")),this.setData("debounceTimer",setTimeout(a,t))}.bind(this)},bindEventsForCalculatorOperation:function(e,t,r){var i=e.querySelector("input"),a=$L(e).find("input"),s=this;a.off("keypress keyup blur").on("keypress keyup blur",(function(e){s.calculatorOperationCreate(i,e,t,r)}))},checkLyteConvertionSupport:function(e){var t=!1;return(Crm.userDetails.isLyteCreateSupported||Crm.userDetails.IS_DEVELOPMENT_SETUP)&&(crmConstants.lyteCreatePartialModules.contains(e)||e.indexOf("CustomModule")>-1&&!["CustomModule5001","CustomModule5002","CustomModule5003","CustomModule5004","CustomModule5005","CustomModule5006","CustomModule5007","CustomModule5008","CustomModule5009","CustomModule5010"].contains(e)||e.indexOf("LinkingModule")>-1)&&(t=!0),t||crmConstants.lyteCreateFullModules.contains(e)},filterValidPickListValues:function(e,t){var r=e.indexOf(";")>-1?e.split(";")[0]:e,i=t[r]&&t[r].pick_list_values?t[r].pick_list_values:t.pick_list_values;if(!(i&&i.length||"FIRSTNAME"!==t.column_name)){var a=t.orginalPicklistdata&&t.orginalPicklistdata.length?t.orginalPicklistdata:[];if((!a||!a.length)&&this.data){var s=(this.data.moduleData&&this.data.moduleData.fields&&this.data.moduleData.fields.length?this.data.moduleData.fields:[]).filter((function(e){return"SALUTATION"===e.column_name}))[0];s&&(a=this.filterValidPickListValues(e,s),s[r]&&s[r].default_value&&t.$.set("default_value",s[r].default_value))}t.pick_list_values=a,i=a}var o=i.filter((function(e){return"used"==e.type}));return o&&o.length?o:i},getRelatedlistapiname:function(e){if(e&&e.listRelationId)return this.getData("moduleData.fields").filter((function(t){return t.lookup&&t.lookup.id==e.listRelationId}))[0]},setLookupRelatedRecord:function(e,t){var r=this,i=this.getData("dataBind");store.findRecord(moduleRecordMapping[e.fillUpModule].id,e.entityid,{approved:"both"},!0,!0).then((function(a){var s;if(t.$.set({lookupSingle:e.entityname,selectedId:e.entityid}),t.$.set("isRelatedListFOLAvailable",!t.isRelatedListFOLAvailable),t.custom_field)r.setCurrencyDetailsonLookupSelect(a[0],store.peekRecord("module",t.lookup.module.id),r.getData("moduleData"),r.getData("initRoute"),t);else if(r.data.isWizard&&i.$.set(t.api_name,{id:e.entityid,name:e.entityname}),"Reporting_To"==t.api_name?r.getData("moduleData.fields").filter((function(e){"Account_Name"==e.api_name&&validationUtils.isNotEmpty(a[0].Account_Name)&&e.$.set({lookupSingle:a[0].Account_Name.name,selectedId:a[0].Account_Name.id}),"Vendor_Name"==e.api_name&&validationUtils.isNotEmpty(a[0].Vendor_Name)&&e.$.set({lookupSingle:a[0].Vendor_Name.name,selectedId:a[0].Vendor_Name.id})})):"Deal_Name"==t.api_name?r.getData("moduleData.fields").filter((function(e){if("Account_Name"==e.api_name&&validationUtils.isNotEmpty(a[0].Account_Name)&&e.$.set({lookupSingle:a[0].Account_Name.name,selectedId:a[0].Account_Name.id}),"Related_To"==e.api_name){var t=a[0].Related_To||a[0].Contact_Name||a[0].Reporting_To;validationUtils.isNotEmpty(t)&&e.$.set({lookupSingle:t.name,selectedId:t.id})}})):"Related_To"!=t.api_name&&"Contact_Name"!=t.api_name||r.getData("moduleData.fields").filter((function(t){if("Account_Name"==t.api_name&&validationUtils.isNotEmpty(a[0].Account_Name)&&t.$.set({lookupSingle:a[0].Account_Name.name,selectedId:a[0].Account_Name.id}),"Cases"===e.module&&"Contacts"===e.relmodule&&a[0][t.api_name]&&("PHONE"===t.column_name||"EMAIL"===t.column_name)){var r="PHONE"===t.column_name&&a.$.meta&&a.$.meta.original?a.$.meta.original[t.api_name]:a[0][t.api_name];i.$.set(t.api_name,r)}})),"Contact_Name"!=t.api_name&&"Related_To"!=t.api_name&&"Reporting_To"!=t.api_name||i[t.api_name]?a&&a[0]&&a[0][t.api_name]&&validationUtils.isNotEmpty(a[0][t.api_name])&&!i[t.api_name]&&t.$.set({lookupSingle:a[0][t.api_name].name,selectedId:a[0][t.api_name].id}):(s="Contact_Name"==t.api_name?a&&a[0]&&a[0][t.api_name]?t.api_name:a&&a[0]&&a[0].Related_To?"Related_To":"Reporting_To":"Related_To"==t.api_name?a&&a[0]&&a[0][t.api_name]?t.api_name:a&&a[0]&&a[0].Contact_Name?"Contact_Name":"Reporting_To":"Reporting_To",a&&a[0]&&a[0][t.api_name]&&validationUtils.isNotEmpty(a[0][t.api_name])&&t.$.set({lookupSingle:a[0][s].name,selectedId:a[0][s].id})),"Contacts"!==r.getData("moduleName")||"Account_Name"!==t.api_name&&"Reporting_To"!==t.api_name)r.setCurrencyDetailsonLookupSelect(a[0],store.peekRecord("module",t.lookup.module.id),r.getData("moduleData"),r.getData("initRoute"),t);else{var o={moduleName:"Contacts",lookupMod:store.peekRecord("module",t.lookup.module.id),fldData:t,recData:a[0]};r.autoFillAddress(!0,o)}}))},setZohoSurveyDetailsInEntity:function(e){var t=this.getData("moduleData"),r=e.Native__Survey__Extn__Survey_Department,i=e.$.model.fieldList,a=t.survey_departments.filter((function(e){return e.name==r}))[0];if(a&&e.$.set("Native__Survey__Extn__Department_ID",a.id),"New Survey"==e.Native__Survey__Extn__Survey_Type)switch(["$survey_name","$survey_template_id","$survey_sub_type"].forEach((function(t){!i[t]&&store.addField(e.$.model._name,t,"string")})),e.$.set("$survey_name",t.zsurvey_surveyName),e.$survey_name&&("string"!=typeof e.$survey_name||e.$survey_name.trim())||(t.$.set("surveyTexterrorDetails",{isError:!0,message:I18n.getMsg("crm.field.empty.check",I18n.getMsg("New Survey Name"))}),e.isblankSurveyNameError=!0),t.zsurvey_subSurvey){case"Blank Survey":if(e.$.set("$survey_sub_type","blank_survey"),i.Native__Survey__Extn__Survey.mandatory){var s=i.Native__Survey__Extn__Survey;s.mandatory=!1,store.addField(e.$.model._name,"Native__Survey__Extn__Survey",i.Native__Survey__Extn__Survey.type,s),e.$.set("Native__Survey__Extn__Survey",t.zsurvey_surveyName)}break;case"Template Gallery":e.$.set("$survey_sub_type","template_gallery");for(var o=t.zsurvey_templates?t.zsurvey_templates.length:0,n=!1,l=0;l<o;l++){for(var c=t.zsurvey_templates[l].templates,d=c?c.length:0,u=0;u<d;u++)if(c[u].name===e.Native__Survey__Extn__Survey){n=!0,e.$.set("$survey_template_id",c[u].id);break}if(n)break}break;case"Copy from Existing":e.$.set("$survey_sub_type","copy_from_existing")}if("Associate Existing Survey"==e.Native__Survey__Extn__Survey_Type||"New Survey"==e.Native__Survey__Extn__Survey_Type&&"copy_from_existing"==e.$survey_sub_type)for(var m=a.mappings?a.mappings.length:0,p=0;p<m;p++)for(var g=a.mappings[p].surveys?a.mappings[p].surveys.length:0,f=0;f<g;f++){var h=a.mappings[p].surveys[f];if(h.name==e.Native__Survey__Extn__Survey){e.$.set("Native__Survey__Extn__Survey_URL",h.url);break}}},getTasksOptionsObject:function(){return{recurringType:"dynamicTime",endLessActivity:!1,freq:{N:!1,D:!0,WD:!0,W:!0,M:!0,Y:!0,C:!0,CD:!0,CW:!0,CM:!0,CY:!0},freqFields:{D:{ends:{never:!0,after:!0,on:!0,afterMaxLimit:999,afterMinLimit:1}},WD:{ends:{never:!0,after:!0,on:!0,afterMaxLimit:999,afterMinLimit:1}},W:{ends:{never:!0,after:!0,on:!0,afterMaxLimit:999,afterMinLimit:1}},M:{ends:{never:!0,after:!0,on:!0,afterMaxLimit:999,afterMinLimit:1}},Y:{ends:{never:!0,after:!0,on:!0,afterMaxLimit:999,afterMinLimit:1}},CD:{repeatEvery:{interval:!0,daysType:!0,repeatEveryMaxLimit:999,repeatEveryMinLimit:1},ends:{never:!0,after:!0,on:!0,afterMaxLimit:999,afterMinLimit:1}},CW:{repeatEvery:{interval:!0,repeatEveryMaxLimit:999,repeatEveryMinLimit:1},repeatOn:{weekSelection:!0},ends:{never:!0,after:!0,on:!0,afterMaxLimit:999,afterMinLimit:1}},CM:{repeatEvery:{interval:!0,repeatEveryMaxLimit:999,repeatEveryMinLimit:1},repeatOn:{dayOfMonth:!0,dayOfWeekOfMonth:!0,rescheduleCheckbox:!0},ends:{never:!0,after:!0,on:!0,afterMaxLimit:999,afterMinLimit:1}},CY:{repeatEvery:{interval:!0,repeatEveryMaxLimit:999,repeatEveryMinLimit:1},repeatOn:{dayOfMonth:!0,dayOfWeekOfMonth:!0,rescheduleCheckbox:!0},ends:{never:!0,after:!0,on:!0,afterMaxLimit:999,afterMinLimit:1}}}}},newEditRequestData:function(e){var t=this.transition.data?objectUtils.cloneObject(this.transition.data):{};Crm.editReqFrom=t.reqFrom?t.reqFrom:t.returnAnchor||t.goTo?"":"listView",delete t.backOneLevel;var r={};"Activities"==e&&(e=this.parent.parent.getQueryParams().sub_module),r.module=e,r.format="json",r=Object.assign(r,t);for(var i=moduleRecordMapping[e].id,a=store.peekRecord("module",i),s=a?a.layouts.filter((function(e){return e.status>=0||"active"===e.status})):[],o=s?s.length:0,n=[],l=0;l<o;l++)n.push({id:s[l].id,name:s[l].name});var c,d,u=[],m=this.parent.parent.transition.data;m.layoutName&&m.layoutId?(u.push({uservalue:m.layoutName,systemvalue:m.layoutId,id:m.layoutId}),c=m.layoutName,d=m.layoutId):1==n.length&&(u.push({uservalue:n[0].name,systemvalue:n[0].id,id:n[0].id}),c=n[0].name,d=n[0].id);var p=this.parent.getDynamicParam();commonUtils.showHideLoadingDiv(!0);var g=this;return this.getModulePromise(void 0,a.api_name,e,p,void 0,d).then(function(t){var s,o=store.peekRecord(i,p);return o?o&&o.$converted?this.handleConvertedRecordError(e,o.id):o&&o.$process_flow?this.getEntityRecordBluePrintProcessInfo(o.id,e).then(function(e){return s=e&&e.blueprint?e.blueprint:void 0,n()}.bind(this)):n():this.handleRecNotAvailablityError();function n(){var n=o&&("draft"===o.$state||!validationUtils.isEmpty(o.Wizard)),l=o&&"save"===o.$state;if(l&&!validationUtils.isEmpty(o.Wizard)&&o.Wizard.id){var m=store.peekRecord("wizard",o.Wizard.id).profiles.filter((function(e){return e.name===Crm.userDetails.PROFILE_NAME}));(!m||!m.length||g.transition.data&&g.transition.data.layoutId)&&(n=!1)}if(!a||!(n&&a.creatable||a.editable)||o&&(!o.$editable||o.$stop_processing))return crmHistory.handleAjaxErrorLyte=!0,!o||o.$editable&&!o.$stop_processing?renderingUtils.displayPermissionDenied():renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.label.insufficient.privileges")),void g.transition.abort();if(t.editEntitydata=[],t.editEntitydata.push(o),t.layout=[],!d)if(o.Layout)d=o.Layout.id;else{var p=store.peekRecord("module",moduleRecordMapping[e].id).layouts.filter((function(e){return e.status>=0||"active"===e.status}))[0];d=p?p.id:d}var f=store.peekRecord("layout",d),h=[];if(n){var y;g.isWizard=!0;var v,_=store.peekRecord("wizard-container",d);if(!_||!_.chart_data)return crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),void g.transition.abort();if(v=_.chart_data.nodes.length,t.layout=[],o.$wizard_connection_path&&o.$wizard_connection_path.length){var b,w=store.peekRecord("wizard-container",d),C=o.$wizard_connection_path,D=0;C.forEach((function(e,t){if(0===t){var r={id:(i=w.chart_data.screen_connections[e]).source_screen.id,name:i.source_screen.display_label,index:D++};h.push(r)}var i;r={id:(i=w.chart_data.screen_connections[e]).target_screen.id,name:i.target_screen.display_label,index:D++};h.push(r),b=i.target_screen.id})),y=(P=store.peekRecord("wizard-screen",b)).segments}else for(var L=0;L<v;L++){var R=_.chart_data.nodes[L];if(R.start_node){var P;y=(P=store.peekRecord("wizard-screen",R.screen.id)).segments,h.push({id:P.id,name:P.name,index:0});break}}}t.layout.push(f);var I=n&&!l?"create_clone":"edit";return t.custom_button&&t.custom_button.length&&(t.custom_button=t.custom_button.filter((function(e){return e.position==I}))),d=n?d+";"+o.Wizard.id:d,{initRoute:"edit",entityrecordData:t.editEntitydata?t.editEntitydata[0]:{},transitionData:r,layoutRules:t.layout_rule,validationRules:t.validation_rule,customButtons:t.custom_button,moduleData:a,moduleId:i,moduleName:e,currsubformApinames:a.currsubformApinames?a.currsubformApinames:[],layoutddData:u,layoutddSelected:c,selectedLayoutid:n?d+";"+t.editEntitydata[0].Wizard.id:d,moduleSections:n?y:t.layout[0].sections,layoutDet:t.layout,isWizard:!!n,screenHistory:h,originalData:t.originalData||{},surveyDepartments:t.survey_departments?t.survey_departments:[],webinarIntegration:t.webinarIntegration?t.webinarIntegration:void 0,fcCategory:t.fc_category?t.fc_category.stages:[],skyEyeIntegration:!!(t.skyEyeIntegration&&validationUtils.isNotEmpty(t.skyEyeIntegration)&&t.skyEyeIntegration.configured),bluePrintProcessInfo:s||void 0,currentModuleAutoEnrichment:t.auto_enrichment}}}.bind(this))},checkCriteriaMatchForCanvas:function(e,t,r){if(!e.group_operator&&void 0===e.length)return c(e,r);if(e.group_operator){var i,a=[],s=0;i=e.group_operator;for(var o=e.group,n=o.length,l=0;l<n;l++)o[l].group_operator?a[s++]=r.checkCriteriaMatchForCanvas(o[l],t,r):a[s++]=c(o[l],r);switch(i){case"AND":return a[0]&&a[1];case"OR":return a[0]||a[1]}}function c(e,r){var i=t;if(!e.field)return!1;var a=e.field.api_name;if(a=a.split(".")[0],!i.$.model.fieldList[a]||!store.peekRecord("field",i.$.model.fieldList[a].fieldID).visible)return!1;var s,o=validationUtils.isEmpty(i.$.error[a])?i[a]:i.$.error[a].value,n=e.value;if(o&&"phone"===i.$.model.fieldList[a].type&&"en_US"===Crm.userDetails.COUNTRY_LOCALE&&o.startsWith("(")&&o.includes(")")&&(o=o.replace(/[^a-zA-Z0-9]/g,"")),o&&"Data_Processing_Basis_Details.Data_Processing_Basis"===e.field.api_name&&(o=o.Data_Processing_Basis),"Stage"===e.field.api_name&&"STAGE"===i.$.model.fieldList[a].columnName){for(var l=store.peekRecord("field",i.$.model.fieldList[a].fieldID).pick_list_values,c=[],d=l.length,u=0;u<d;u++)("${OPEN}"!==n||"Open"!==l[u].forecast_type&&"Open"!==l[u].deal_category)&&("${CLOSEDWON}"!==n||"Closed Won"!==l[u].forecast_type&&"Closed Won"!==l[u].deal_category)&&("${CLOSEDLOST}"!==n||"Closed Lost"!==l[u].forecast_type&&"Closed Lost"!==l[u].deal_category)||c.push(l[u].display_value);c.length>0&&(n=c)}if("Tag"===e.field.api_name)switch(Array.isArray(n)||"object"!=typeof n||(n=Array(n)),e.comparator){case"equal":if("${EMPTY}"===n)s=0===o.length;else{var m=n.map((function(e){return e.id})),p=o.map((function(e){return e.id}));s=m.intersection(p).length===m.length}break;case"not_equal":if("${EMPTY}"===n)s=0!==o.length;else{m=n.map((function(e){return e.id})),p=o.map((function(e){return e.id}));s=m.intersection(p).length!==m.length}}else s=r.checkComparator(o,n,e.comparator,i,a,void 0,void 0,void 0,r,!0);return s}},setDatePatternAndPlaceholder:function(){var e=Crm.userDetails.DATE_PATTERN.toUpperCase();this.setData("userDateformat",e.replace(/'/g,""))},getEntityRecordBluePrintProcessInfo:function(e,t){var r=store.peekRecord(moduleRecordMapping[t].id,e,{approved:"both"});return r&&r.$process_flow?r.$.triggerAction("blueprint"):void 0},autoFillAddress:function(e,t){var r,i,a,s,o=this.getData("moduleData.fields"),n=this.getData("apiName");e?(r=t.lookupMod,i=t.fldData,a=t.recData,s=t.moduleName):(r=this.getData("module"),i=this.getData("moduledataUicomp"),a=this.getData("selectedSingle"),s=this.getData("modulenameUicomp"));var l=this.getData("dataBind"),c=o.map((function(e){return e.column_name}));if("Accounts"!==s&&"Contacts"!==s||!r||"Accounts"!==r.api_name&&"Contacts"!==r.api_name||i.custom_field)"Cases"!==s||"Related_To"!==n||i.custom_field||(a&&a.Phone&&!l.Phone&&l.$.set("Phone",a.Phone),a&&a.Email&&!l.Email&&l.$.set("Email",a.Email));else{if(s===r.api_name&&"Accounts"===s)return;for(var d,u,m,p="Accounts"===s?["BILLINGSTREET","BILLINGCITY","BILLINGSTATE","BILLINGCODE","BILLINGCOUNTRY","SHIPPINGSTREET","SHIPPINGCITY","SHIPPINGSTATE","SHIPPINGCODE","SHIPPINGCOUNTRY"]:["MAILINGSTREET","MAILINGCITY","MAILINGSTATE","MAILINGZIP","MAILINGCOUNTRY","OTHERSTREET","OTHERCITY","OTHERSTATE","OTHERZIP","OTHERCOUNTRY"],g={Mailing_Street:"Billing_Street",Mailing_City:"Billing_City",Mailing_State:"Billing_State",Mailing_Zip:"Billing_Code",Mailing_Country:"Billing_Country",Other_Street:"Shipping_Street",Other_City:"Shipping_City",Other_State:"Shipping_State",Other_Zip:"Shipping_Code",Other_Country:"Shipping_Country",Billing_Street:"Mailing_Street",Billing_City:"Mailing_City",Billing_State:"Mailing_State",Billing_Code:"Mailing_Zip",Billing_Country:"Mailing_Country",Shipping_Street:"Other_Street",Shipping_City:"Other_City",Shipping_State:"Other_State",Shipping_Code:"Other_Zip",Shipping_Country:"Other_Country"},f=p.length,h={},y={},v=0;v<5;v++)if(-1!==(m=c.indexOf(p[v])))if(d=o[m].api_name,!a[u=s===r.api_name?d:g[d]]||l[d]&&"Accounts"!==s){if(a[u]){h={};break}}else h[d]=a[u];for(v=5;v<f;v++)if(-1!==(m=c.indexOf(p[v])))if(d=o[m].api_name,!a[u=s===r.api_name?d:g[d]]||l[d]&&"Accounts"!==s){if(a[u]){y={};break}}else y[d]=a[u];Object.keys(h).forEach((function(e){l.$.set(e,h[e])})),Object.keys(y).forEach((function(e){l.$.set(e,y[e])}))}this.setCurrencyDetailsonLookupSelect(a,r,this.getData("moduleData"),this.getData("initRoute"),i)},setCurrencyDetailsonLookupSelect:function(e,t,r,i,a){var s=["Cases","Leads"],o=!1;if(s.contains(t.module_name)&&s.contains(r.module_name)&&(o=!0),"edit"!==i&&(o||!a.custom_field&&"Contacts"!==r.module_name&&"PARENTACCOUNTID"!==a.column_name&&("Contacts"===t.module_name||"Accounts"===t.module_name))){var n=r.fields.filter((function(e){return"CURRENCYISOCODE"===e.column_name}))[0],l=this.getData("dataBind");if(n&&e.Currency&&e.Currency!==l.Currency&&n[r.renderedLayoutId]){l.$.set(n.api_name,e.Currency);var c="crm-create-fields#"+r.module_name+"_fldRow_"+n.column_name+" lyte-dropdown",d=$L(c)[0];d&&d.ltProp({selected:e.Currency,displayValue:e.Currency});var u=n[r.renderedLayoutId].pick_list_values;this.handleDropDownChanges(e.Currency,n.api_name,u)}}},loadResources:function(e,t){this.lyteConvertionSupported=this.checkLyteConvertionSupport(t);var r=[],i=["crm-existing-email-quickinfo.js","crm-image-upload-ziaError.js","crm-vision-helper.js","crm-image-upload.js","crm-image-mixin.js","crm-image-preview.js","crm-image-upload-create.js","lyte-scrollTo.js","exif-plugin.js","lyte-cropper.js","lyte-colorbox.js"],a=["crm-existing-email-quickinfo.css","crm-custom-rl.css","crm-image-upload-ziaError.css"],s="crm.tab.module.create"===this.transition.target,o="crm.tab.module.entity.edit"===this.transition.target,n="crm.tab.module.entity.clone"===this.transition.target;s||n?(i.push("crm-reviewprocess-detail.js"),i.push("crm-ziavision-myjobs.js")):o&&(i.push("crm-project-sync-task.js"),a.push("crm-zprojects-sync-task.css")),Crm.userDetails.RTL_ENABLED?a.push("crux-column-list-rtl.css"):a.push("crm-list-view-crux.css");var l=networkUtils.returnDependencyFiles(i,crmConstants.jsStaticPathForLyte);s&&crmTab.isZBCustomModule(t)&&(l=l.concat(networkUtils.returnDependencyFiles(["crm_finance_suite.js"],crmConstants.jsStaticPath)));var c=networkUtils.returnDependencyFiles(a,crmConstants.cssStaticPathForLyte);if(Crm.userDetails.RTL_ENABLED&&(c=c.concat(networkUtils.returnDependencyFiles(["crm-image-upload-rtl.css"],crmConstants.cssStaticPathForLyte))),c=c.concat(networkUtils.returnDependencyFiles(["crm-image-upload.css","crm-image-preview.css","crm-image-upload-create.css"],crmConstants.cssStaticPathForLyte)),(this.transition.data.isWizard||this.lyteConvertionSupported||e.queryParams.wizardId||o)&&(l=l.concat(networkUtils.returnDependencyFiles(["crm-create-resources.js","crm-wizard-common-helpers.js","crm-entity-lookup.js","crux-tag.js","lyte-scrollTo.js"],crmConstants.jsStaticPathForLyte)),this.lyteConvertionSupported&&"Campaigns"===t&&(l=l.concat(networkUtils.returnDependencyFiles(["crm-webinar-data-store.js"],crmConstants.jsStaticPathForLyte))),c=(c=Crm.userDetails.RTL_ENABLED?c.concat(networkUtils.returnDependencyFiles(["crm-create-resources.css","crm-create-resources-rtl.css"],crmConstants.cssStaticPathForLyte)):c.concat(networkUtils.returnDependencyFiles(["crm-create-resources.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-change-owner.css"],crmConstants.lessStaticPathForLyte)),(s||o||n)&&(o||this.transition.data.isWizard||e.queryParams.wizardId))){var d=networkUtils.returnDependencyFiles(["zohocrm_wizard_record_create.js"]);r=r.concat(d)}if(s&&"Quotes"===t&&Crm.isCpqActivated()&&(l=(l=l.concat(networkUtils.returnDependencyFiles(["crm-cpq-general.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-cpq-general.css"],crmConstants.cssStaticPathForLyte))),"Services"===t&&(l=(l=(l=l.concat(networkUtils.returnDependencyFiles(["zohocrm_services.js"]))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")]))).concat(networkUtils.returnDependencyFiles(["service-user-lookup.js"],crmConstants.jsStaticPathForLyte))),o&&("Calls"===this.parent.parent.getDynamicParam()||"Activities"===this.parent.parent.getDynamicParam()&&"Calls"===this.parent.parent.getQueryParams().sub_module)){var u=isNewCallView?["zcrm_callsnew.js","zcrm_callsnew1.js"]:["zcrm_callsold.js"],m=networkUtils.returnDependencyFiles(u);r=r.concat(m)}Crm.userDetails.isPhoneNoNewView&&(r=r.concat(Crm.returnPhoneFieldDependencyFiles())),r=r.concat(l.concat(c));var p=[networkUtils.getI18nJSUrl("imageupload")];return(s||o||n)&&((this.transition.data.isWizard||e.queryParams.wizardId)&&p.push(networkUtils.getI18nJSUrl("wizardrecordcreate")),p.push(networkUtils.getI18nJSUrl("businesshours")),p.push(networkUtils.getI18nJSUrl("changeOwner")),p.push(networkUtils.getI18nJSUrl("ziavision"))),r=r.concat(networkUtils.returnDependencyFiles(p))},showEnrichCompValues:function(){CAEExec.enrichFieldCount=0;var e=this.setProperEnrichData();CAEExec.modeOfRecord="entityCreate",$("#basedOnFieldInfoDiv").html(this.getBasedOnFieldsInfo());var t=Lyte.Router.getRouteInstance().currentModel.auto_enrichment_id,r=[],i=this.getData("moduleData").module_name,a=store.peekRecord("auto_enrichment",t).fields_map,s=a.length;CAEExec.enrichFieldMappingCount=s;for(var o=0;o<s;o++){var n=a[o],l=n.crm_field;if(l){var c=store.peekRecord("field",l.id);if(void 0!==c){var d=n.enrich_field?n.enrich_field.name:void 0;if(!1===c.read_only&&void 0!==e[d]){var u={},m=this.getData("dataBind")[c.api_name];if(m&&m.toLowerCase()===e[d].toLowerCase())continue;m&&"picklist"===c.data_type&&"-None-"===m&&(m=void 0),u.crmFieldColName=c.column_name,u.displayLabel=c.field_label,u.currentFieldVal=m,u.isValueEmpty=!0,m&&(u.isValueEmpty=!1),u.enrichFieldVal=e[d],u.enrichFieldRefName=d,u.crmFieldRefName=c.api_name,r.push(u),CAEExec.enrichFieldCount=CAEExec.enrichFieldCount+1}c&&!0!==c.readonly||(CAEExec.enrichFieldCount=CAEExec.enrichFieldCount+1)}}}if(r.length>0){e.dataId&&(CAEExec.enrichDataId=e.dataId);var p=$("#enrichmentInnerTableDiv"),g=$("#enrichPopupSaveBtn"),f=$(Handlebars.templates.EnrichDataMapping(r));p.empty().prepend(f),0===$("#enrichMapDiv").find("tbody").find("input:checked").length?g.addClass("disabled").prop("disabled",!0):g.removeClass("disabled").prop("disabled",!1),$("#waitEnrichInfoDiv,#enrichPopupDoneBtn").hide(),g.attr("onClick","crmTemplate.assignEnrichmentDataDetails()").removeClass("disabled").prop("disabled",!1),g.show(),Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM&&$("#enrichMapLink").attr("onClick","Crm.trackSpotLightAction('Data Enrichment - Configure Field Mapping Click',{'Module':'"+i+"'});").show(),$("#enrichDataSearchDiv,#enrichMapDiv,#enrichPopupCancelBtn").show(),$L("#dataSyncInfoDiv").hide()}else validationUtils.isEmpty(e)?($("#waitEnrichInfoDiv,#enrichDataSearchDiv,#enrichPopupSaveBtn,#enrichPopupCancelBtn").hide(),$("#enrichPopupDoneBtn").show(),$("#dataSyncInfoDiv").text(I18n.getMsg("crm.auto.enrich.no.data",this.getData("moduleData").singular_label)).show()):($("#enrichDataSearchDiv,#enrichPopupSaveBtn,#enrichPopupCancelBtn").hide(),$("#enrichPopupDoneBtn").show(),$("#dataSyncInfoDiv").text(I18n.getMsg("crm.auto.enrich.no.new.data",this.getData("moduleData").singular_label)).show());$("#loadingDotDiv").hide()},getAutoEnrichData:function(){hideMenu();var e=Lyte.Router.getRouteInstance().currentModel.auto_enrichment_id;if(e){var t=store.peekRecord("auto_enrichment",e);if(t.enrichUsedCount>=t.enrichLimitCount){var r="";return $L("#enrichLimitAlertDiv").length||(r='<div id="enrichLimitAlertDiv" class="newpopup w550 is-scroll ppTop dN"><h2 class="pp-header">'+I18n.getMsg("crm.data.enrich.heading.limit.reached")+'</h2><div class="pp-content"><div class="crm-font-regular dIB col333 mB10 w100p" style="font-size:15px">'+I18n.getMsg("crm.data.enrich.limit.reached.info")+'</div><div  class="crm-font-regular dIB col333" style="font-size:15px">'+I18n.getMsg("crm.data.enrich.limit.reached.info1")+' <span class="crm-font-regular dIB cP" style="color:rgb(44, 123, 208);font-size:15px">'+RebrandLinkUtil.getProperty("SUPPORTMAILID")+'</span></div></div><div class="pp-footer pT0"><input type="button" class="primarybtn" value="'+I18n.getMsg("crm.livedesk.okay")+'" onclick="crmui.hidePopup(&#39;enrichLimitAlertDiv&#39;)"></div></div>',$("body")[0].append(r)),crmui.showPopup("enrichLimitAlertDiv"),!1}Crm.trackSpotLightAction("Data Enrichment - Enrich Data Click",{Module:this.getData("moduleData").module_name,Place:"Create"}),Crm.client_tracking("Data Enrichment - Enrich Data Click",{Module:this.getData("moduleData").module_name,Place:"Create"}),$L("#createEnrichLink").css("display","none"),$L("#enrichMapDiv").empty(),$("#show").prepend($(Handlebars.templates.AutoEnrichPopup())),crmui.showPopup({id:"enrichPopupDiv"}),this.showEnrichCompValues()}},handleLyteCreateAfterModelchanges:function(e,t,r){var i="";switch(r){case"create":i="crm.title.entity.create";break;case"edit":i="crm.title.entity.edit";break;case"clone":i="crm.title.entity.clone"}if(this.setTitle(I18n.getMsg(i,[moduleRecordMapping[t].singular_label,Crm.appName])),I18n.properties.COUNTRY_LIST2=I18n.properties.COUNTRY_LIST2.filter((function(e){return null!==e})),e&&!e.isWizard)if(e.layoutDet&&e.layoutDet.length){var a=e.layoutDet[0];a&&!a.visible&&(this.isLayoutPermissionError=!0)}else this.isInvalidLayoutError=!0;if(e&&e.webinarIntegration&&e.webinarIntegration.org&&"Free"===e.webinarIntegration.org.licence){var s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zohowebinar")]),o=networkUtils.returnDependencyFiles(["crm-webinar-common.js"],crmConstants.jsStaticPathForLyte),n=networkUtils.returnDependencyFiles(["crm-webinar-common.css"],crmConstants.cssStaticPathForLyte);Lyte.injectResources(s.concat(o.concat(n)),void 0,(function(){Lyte.Component.render("crm-webinar-trial-expiry-modal",e,"#show")})),this.transition.abort()}"Campaigns"===t&&"true"===window.isSandboxAcc&&e.layoutDet&&e.layoutDet[0]&&["survey","webinar","campaign","backstage"].contains(e.layoutDet[0].created_for)&&(crmui.showMsgBand("error",I18n.getMsg("crm.campaign.integ.sandbox.not.supported",crmTab.getDisplayName("Campaigns",!1).toLowerCase()),3e3),this.transition.abort(),this.transitionTo({route:"crm.tab.module.custom-view.list",dynamicParams:["Campaigns",moduleRecordMapping.Campaigns.cvid]}));var l=e.currentModuleAutoEnrichment&&e.currentModuleAutoEnrichment[0]?e.currentModuleAutoEnrichment[0]:void 0;if(!Crm.userDetails.CLIENT_ACCOUNT&&l&&l.active){e.auto_enrichment_id=l.id,Crm.isDataEnrichAvailable=!0;var c=[],d=store.peekRecord("auto_enrichment",l.id);if(d&&!d.hasOwnProperty("enrichUsedCount")&&!d.hasOwnProperty("enrichLimitCount"))return c.push(store.findAll("dummy",void 0,!1,!1,{url:"crm/v2.1/__features/data_enrichment",method:"GET"})),Lyte.resolvePromises(c).then((function(t){var r=t[0]&&t[0].__features?t[0].__features[0].details:"";return r?(r.used_count&&(d.enrichUsedCount=r.used_count.total),r.limits&&(d.enrichLimitCount=r.limits.total)):(delete e.currentModuleAutoEnrichment,delete e.auto_enrichment_id,Crm.isDataEnrichAvailable=!1),d}))}else Crm.isDataEnrichAvailable=!1},getLyteCreateComponentForCscript:function(){if(["crm.tab.module.entity.edit","crm.tab.module.create","crm.tab.module.entity.clone"].contains(Lyte.Router.getRouteInstance().transition.info.route)){var e=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];return moduleRecordMapping[e]?$L("crm-create-layout#"+e+"LC_layoutNode")[0]:null}return null},setCscriptSubFormDataForLyte:function(e,t,r,i,a){if(t&&t.length){var s=function(e,t,r,a){$L.each(e,function(e,s){if(n[e]){var o=store.peekRecord("field",n[e].fieldID);if(o&&!o.read_only&&o.visible){var l="crm-create-subformfields#"+i.moduleName+"_"+r+"_R"+(a+1)+"_"+e;this.setCscriptDataForLyte(e,s,o,t,i.moduleName,!0,l),Lyte.Component.set(t,"show",!0);var c=$L(l)[0];c&&c.component&&c.component.didConnect()}}}.bind(this))},o=r[e],n=store.modelFor(a).fieldList,l="#"+i.moduleName+"_SubForm_"+e,c=$L(l)[0];t.forEach(function(t,r){o[r]||c&&c.component.createnewRow(c.querySelector("#addbutnSub")),o[r]&&s.call(this,t,o[r],e,r)}.bind(this))}},setCscriptDataForLyte:function(e,t,r,i,a,s,o,n){var l=function(o,l,c){var d;d=s&&c?c:"crm-create-fields#"+a+"_fldRow_"+r.column_name;var u=$L(d)[0];if(u){var m=u.component.data;if(o){var p=u.component.filterValidPickListValues(m.currentLayout,m.subformFields?m.subformFields:m.moduledataUicomp);if("string"==typeof t){var g=p.filter((function(e){return e.display_value===t}))[0];if(!g&&"skyEye"===n){var f=m.initialPicklistdata||[],h=(f=Lyte.deepCopyObject(f)).filter((function(e){return e.display_value===t}))[0];if(h)g=h;else{var y=Lyte.deepCopyObject(p[0]);y.actual_value=y.display_value=t;var v=["display_value","actual_value","maps","type"];for(var _ in y)v.contains(_)||delete y[_];for(var b=y.maps?y.maps.length:0,w=0;w<b;w++)y.maps[w].pick_list_values=[];f.push(y),g=y}u.setData("initialPicklistdata",f)}if(g){if(l){var C=m.subformFields,D=m.currentLayout.split(";")[0];u.setData("initialPicklistdata",this.setinitialPicklistdata(C,m.moduleData.currencyData,t,m.initRoute,C[D]?C[D].pick_list_values:C.pick_list_values))}i.$.set(e,t),l||u.component.handleEntityRecordChanges(m.cadditionalFielddata,m.dataBind),u.getMethods("getDropdownvalue")&&u.component.executeMethod("getDropdownvalue",{},t,!0)}}else{var L=p.filter((function(e){return t.contains(e.display_value)})).mapByKey("display_value");if(L.length){if(l){C=m.subformFields,D=m.currentLayout.split(";")[0];u.setData("initialPicklistdata",this.setinitialPicklistdata(C,m.moduleData.currencyData,JSON.stringify(L),m.initRoute,C[D]?C[D].pick_list_values:C.pick_list_values))}i.$.set(e,JSON.stringify(L))}else t&&!t.length&&i.$.set(e,JSON.stringify([]))}}else u.component.handleEntityRecordChanges(m.cadditionalFielddata,m.dataBind)}};if(r)switch(r.data_type){case"ownerlookup":if(t&&t.id&&store.peekRecord("user",t.id)){var c=store.peekRecord("user",t.id),d={id:c.id,full_name:c.full_name||c.name};if(!i[e]||!$u.isEqual(Lyte.deepCopyObject(i[e]),d)){i.$.set(e,d),l.call(this);var u=store.peekRecord("user",d.id),m="crm-create-fields#"+a+"_fldRow_"+r.column_name,p=$L(m)[0];p&&p.component&&p.component.executeUserFieldsofLookup&&p.component.executeUserFieldsofLookup(u)}}break;case"multiuserlookup":case"multiselectlookup":break;case"lookup":if(t&&t.name&&t.id){d={id:t.id,name:t.name};i.$.set(e,d),l.call(this,void 0,s)}break;case"multiselectpicklist":Array.isArray(t)&&l.call(this,!0,s,o);break;case"picklist":(t=t&&"string"==typeof t&&t.trim()?t:"-None-")&&"string"==typeof t&&l.call(this,!0,s,o);break;case"integer":case"currency":case"double":(0===t||t&&!isNaN(t))&&("currency"===r.data_type||"double"===r.data_type?i.$.set(e,Number(Number(t).toFixed(r.decimal_place))):i.$.set(e,Number(t)));break;case"boolean":i.$.set(e,t+""=="true");break;case"datetime":var g=$L.moment(apiDateTimeFormat(t));if("skyEye"===n&&(g=$L.moment(apiDateFormat(t))),g){r.isSetValueFromScript=!0;var f=this.getDateTimeForForm(g.getDObj(),!0);""===t&&(f=""),i.$.set(e,f),delete r.isSetValueFromScript;var h={};h.moduleName=a,h.value=f,h.fldMeta=r,this.triggerCScriptUIUpdate(h)}break;default:r.isSetValueFromScript=!0,"string"===r.json_type?(t=null!=t?""+t:"",i.$.set(e,t.slice(0,r.length))):i.$.set(e,t),delete r.isSetValueFromScript}},executeCscriptUIHandlers:function(e,t){var r=this.getLyteCreateComponentForCscript();if(r&&t){var i=r.component.data,a=i.moduleData.fields.filter((function(e){return e.api_name===t.field_name}))[0],s=store.modelFor(i.moduleData.id).fieldList[t.field_name];if("setRequired"===e&&("string"==typeof t.value&&(t.value="true"===t.value),e=t.value?"MANDATE":"UNMANDATE"),a){switch(e){case"ERROR":var o={code:"ERR02",isError:!0,message:$ESAPI.encoder().encodeForHTML(t.message),isCscriptError:!0};a.$.set("errorDetails",o);break;case"MANDATE":s&&!s.mandatory&&(s.mandatory=!0,a.$.set({required:!0,isCscriptMandatory:!0}),s.validation||(s.validation="emptyValueValidation"),store.addField(i.moduleData.id,t.field_name,s.type,s));break;case"UNMANDATE":s&&s.mandatory&&a.isCscriptMandatory&&(s.mandatory=!1,a.$.set({required:!1,isCscriptMandatory:!1,errorDetails:{}}),store.addField(i.moduleData.id,t.field_name,s.type,s));break;case"MaxLength":s&&(s.length=t.value,a.$.set("length",t.value));break;case"ReadOnly":s&&!a.isSystemReadOnly&&("string"==typeof t.value&&(t.value="true"===t.value),a.$.set("read_only",t.value),a.$.set("isCscriptReadOnly",t.value))}return!0}return!1}return!1},executeCscriptButtonHandlers:function(e,t,r){var i=this.getLyteCreateComponentForCscript();if(i){var a=i.querySelector("crm-create-buttons");if(a){var s=a.component.data.buttons;if(s&&s.length){var o;"record_save"===e?o="save":"record_save_and_new"===e?o="saveAndNew":"record_cancel"===e&&(o="cancel");var n=s.filter((function(e){return e.name===o}))[0];if(n)switch(t){case"Click":var l=a.querySelector("#"+n.id);l&&l.click();break;case"Enable":n.butnDisabled&&Lyte.objectUtils(n,"add","butnDisabled",!1);break;case"Disable":n.butnDisabled||Lyte.objectUtils(n,"add","butnDisabled",!0);break;case"SetValue":r&&Lyte.objectUtils(n,"add","label",r)}}}return!0}return!1},setViewPortDebounceTime:function(e){if(Lyte.Component.viewPortSettings){var t,r=0;if(e){var i=this.getData("moduleData.fields");r=i&&i.length?i.length:0}else r=LyteComponent.pendingViewPortElements&&LyteComponent.pendingViewPortElements.length?LyteComponent.pendingViewPortElements.length:0;r<100?t=0:r>=100&&r<200?t=25:r>=200&&r<300?t=50:r>=300&&(t=100),(e||Lyte.Component.viewPortSettings.debounce!==t)&&(Lyte.Component.viewPortSettings.debounce=t)}},handleScrollOnDropDownToggle:function(e){var t=$L(this.$node).parents("html");if("show"!==e&&(t=t&&t.length?t:$L("html")),t)if("show"===e){var r=renderingUtils.windowHeight>=$L(document).height()?0:renderingUtils.getScrollBarWidthValue;t.css({overflow:"hidden","margin-right":r})}else t.css({overflow:"","margin-right":""})},handleSubformHrzntlScrollforDate:function(e){var t=this.$node.closest("crm-create-subformsection lyte-table-structure");t&&("show"===e?t.classList.add("preventWheel"):t.classList.remove("preventWheel"))},focusDropDownDiv:function(){var e=this.$node.querySelector("div .lyteDummyEventContainer");e&&e.focus()},resetPicklistSearchKey:function(){var e=this.$node.component.data.picklistsearchKey;if(e){var t="lyte-drop-box."+e+" lyte-search",r=document.querySelector(t);r&&r.setValue("")}},getEnrichStatusApiString:function(e){switch(e){case 0:return"auto_enrich_req_waiting";case 1:return"auto_enrich_ready";case 2:return"auto_enrich_resolved";case 3:return"auto_enrich_req_waiting_async";case 4:return"auto_enrich_not_found";case 5:return"auto_enrich_not_found_async";case 6:return"auto_enrich_ready_async";default:return""}},getEnrichStatusValueFromString:function(e){switch(e){case"auto_enrich_req_waiting":return"0";case"auto_enrich_ready":return"1";case"auto_enrich_resolved":return"2";case"auto_enrich_req_waiting_async":return"3";case"auto_enrich_not_found":return"4";case"auto_enrich_not_found_async":return"5";case"auto_enrich_ready_async":return"6";default:return"0"}},setEnrichStatsInRecord:function(e,t,r){if(Crm.isDataEnrichAvailable&&("Leads"===t||"Contacts"===t||"Accounts"===t)&&void 0!==CAEExec.enrichStatus){var i=e.$.model;i.fieldList.$data_enrichment_stats||store.addField(i._name,"$data_enrichment_stats","object");var a={};a.increase_enrich_count=CAEExec.isIncludeEnrichCount(),a.enrich_status=r.getEnrichStatusApiString(CAEExec.enrichStatus),e.$.set("$data_enrichment_stats",a)}},setSkyEyeCompanyInRecord:function(e,t){var r=e.$.model;r.fieldList.$skyeye_account_id||store.addField(r._name,"$skyeye_account_id","string"),e.$.set("$skyeye_account_id",t.external_search_acc_CompanyId)},setTabIndexForFields:function(e,t,r,i,a,s,o){var n=e.createTabIndex;if(s&&("used"===t.type||t.screen)){i=[],a=[],o=[];var l=this.data.isWizard?t.id:e.renderedLayoutId;("used"===t.type||t.screen?t.fields.sort(function(e,t){return e[l].sequence_number-t[l].sequence_number}.bind(this)):t.fields).forEach(function(s){s.view_type[r]&&Lyte.Component.registeredHelpers.isValidCreateField(s,this.data.initRoute,e.module_name)&&(!t.isSubformSection||t.isSubformSection&&validationUtils.isNotEmpty(s.subform))&&(1===t.column_count?o.push(s):s[l].sequence_number%2!=0?i.push(s):a.push(s))}.bind(this))}for(var c=0,d=i.length,u=0;u<d;u++)if("formula"!==i[u].data_type&&"autonumber"!==i[u].data_type){if(i[u].$.set("tab_index",n),n=h(i[u].data_type,n),2===t.tab_traversal)for(var m=a.length,p=c;p<m;p++){if(c++,"formula"!==a[p].data_type&&"autonumber"!==a[p].data_type){a[p].$.set("tab_index",n),n=h(a[p].data_type,n);break}a[p].$.set("tab_index",-1)}}else i[u].$.set("tab_index",-1);m=a.length;for(var g=c;g<m;g++)"formula"!==a[g].data_type&&"autonumber"!==a[g].data_type?(a[g].$.set("tab_index",n),n=h(a[g].data_type,n)):a[g].$.set("tab_index",-1);var f=o.length;for(g=0;g<f;g++)"formula"!==o[g].data_type&&"autonumber"!==o[g].data_type?(o[g].$.set("tab_index",n),n=h(o[g].data_type,n)):o[g].$.set("tab_index",-1);function h(e,t){return e&&t&&(t=e.includes("lookup")?t+4:t+1),t}e.$.set("createTabIndex",n)},lytecrudRouteErrorHandling:function(e,t){var r=e||{};if(this.lyteConvertionSupported&&r.status&&200!==r.status&&201!==r.status){var i=r.response?JSON.parse(r.response):void 0;400===r.status&&i&&"INVALID_LAYOUT_ID"===i.code&&(this.isInvalidLayoutError=!0,t.resume())}},setCScriptSkipFlagForField:function(e){var t=store.peekRecord("field",e);t&&(t.skipCscriptExecutionforField=!0)},isCscriptExeSupportedField:function(e,t){return!(!e||!t)&&(["text","picklist","ownerlookup","email","phone","website","integer","currency","textarea","lookup","date","datetime","bigint","double","boolean"].includes(e.data_type)&&![51,208,207].includes(e.ui_type)&&!["SALUTATION","ADJUSTMENT","ADJUSTMENT"].includes(e.column_name)&&e.view_type[t]&&e.visible&&!e.read_only)},formHandlerWrapperForLyteConversion:function(e,t,r){if(e&&t){var i=e.component.data,a=i.dataBind,s=Lyte.deepCopyObject(i.cscriptOrgValues)||{},o=!1,n=Lyte.deepCopyObject(i.initialCreatebject);void 0===i.recordListenerid&&"clone"===i.initRoute&&(o=!0);var l=store.modelFor(a.$.model._name).fieldList;$L.each(t,(function(e,t){if(l[e])if("relation"===l[e].type&&"hasMany"===l[e].relType)Lyte.registeredMixins["crm-create-mixin"].setCscriptSubFormDataForLyte(e,t,a,i,l[e].relatedTo);else{var c=store.peekRecord("field",l[e].fieldID);if(c&&(!c.read_only||c.isCscriptReadOnly)&&c.visible){o&&(s[e]=n[e]),Lyte.registeredMixins["crm-create-mixin"].setCscriptDataForLyte(e,t,c,a,i.moduleData.module_name,void 0,void 0,r);var d="crm-create-fields#"+i.moduleData.module_name+"_fldRow_"+c.column_name,u=$L(d)[0];u&&u.component.checkLayoutrules(u)}}})),o&&s&&(i.cscriptOrgValues=s)}},bindRecordErrorValuesToNode:function(e,t,r){if(e&&(["date","datetime"].contains(t)||[36,22,143,144,145].contains(r))){var i=this.$node.querySelector("lyte-input"),a=e.value||"";switch(t){case"date":case"datetime":if("date"===(i?i.getAttribute("lt-prop-type"):""))if(o=i.querySelector("input"))if("datetime"===t){var s=!1;s=""===a||s,this.bindDateTimetoNode(a,this,this.data.apiName,s)}else o.value=a;break;default:var o;(o=i?i.querySelector("input"):"")&&o.value!=a&&(o.value=a)}}},loadRouteDependencies:function(){var e=[];return e=(e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("CreateEditCloneRecord")]))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AutoEnrichment")]))).concat(networkUtils.returnDependencyFiles(["crm-create-dependencies.js"],crmConstants.jsStaticPathForLyte))},executeCscriptWrapper:function(e,t){if(CScriptLib){var r=e.$.model.fieldList[t];if(r){var i=store.peekRecord("field",r.fieldID);if(!i||!Lyte.Component.registeredHelpers.isValidCreateField(i,this.data.initRoute,this.data.moduleName||this.data.modulenameUicomp)||i.skipCscriptExecutionforField)return void(i&&delete i.skipCscriptExecutionforField);if(!this.isCscriptExeSupportedField(i,"edit"===this.data.initRoute?"edit":"create"))return;if(Crm.userDetails.isPhoneNoNewView&&i&&"phone"===i.data_type&&!i.isExecuteCscriptForPhone)return;i&&(delete i.isExecuteCscriptForPhone,this.clearCscriptInlineError(i)),"lookup"!==r.fieldType?(CScript.dispatchEvent("onChange",void 0,t),CScript.dispatchEvent("onChange",r.fieldID,CreatePageHandler.field_read.call({field_name:t}))):r.isLookupChanged=!0}}},setEntichDataOnInit:function(e){if(e&&e.auto_enrichment_id&&Crm.isDataEnrichAvailable&&("Leads"===e.moduleName||"Contacts"===e.moduleName||"Accounts"===e.moduleName)){var t=e.entityrecordData||{};t.id&&(CAEExec.currentEntityId=t.id),CAEExec.enrichId=e.auto_enrichment_id;var r=store.peekRecord("auto_enrichment",e.auto_enrichment_id);r&&(void 0!==r.enrichLimitCount&&(CAEExec.enrichLimitCount=r.enrichLimitCount),void 0!==r.enrichUsedCount&&(CAEExec.enrichUsedCount=r.enrichUsedCount),Crm.enrichPermission=!0),t.$data_enrichment_stats&&t.$data_enrichment_stats.enrich_status&&(CAEExec.enrichStatusForRecord=this.getEnrichStatusValueFromString(t.$data_enrichment_stats.enrich_status))}else Crm.isDataEnrichAvailable=!1,Crm.autoEnrichJSONData={}},triggerDataEnrichment:function(){if(!Crm.userDetails.CLIENT_ACCOUNT){var e={Leads:["Company","Email","Website"],Contacts:["Account_Name","Email"],Accounts:["Account_Name","Website"]}[this.getData("modulenameUicomp")];if("clone"!==this.getData("initRoute")&&void 0!==e&&e.contains(this.getData("apiName"))){var t=e.length,r=this.getData("dataBind");Crm.lc_AE_data.recordObj={};for(var i=0;i<t;i++){var a,s=e[i];a=r.$.error&&r.$.error[s]?r.$.error[s].value:r[s];var o=store.modelFor(r.$.model._name);validationUtils.isNotEmpty(o)&&o.fieldList&&o.fieldList[s]&&"lookup"===o.fieldList[s].fieldType&&a&&"object"==typeof a&&a.name&&(a=a.name),a&&this.initEnrichDataFetchProcess(a,s,false)}}}},triggersubfldMousedownaction:function(e){var t=e||this.$node;if(t){var r=$L(t).closest(".subFrmLayout")[0],i=r.clientWidth,a=r.querySelector(".lyteTableScroll"),s=a.scrollLeft,o=t.getBoundingClientRect();if(o.left+o.width>i){a.scrollLeft=s+o.width+20;var n=t.querySelector("lyte-input");n&&(n.blur(),setTimeout((function(){n.focus()}),0))}}},clearDateTimeErrInDataBind:function(e,t,r,i){if(e&&("date"===e.fieldType||"datetime"===e.fieldType)&&t&&"ERR02"===t.code){if("Native__Backstage__Extn__Event_Start_Date"===i)d("Native__Backstage__Extn__Event_End_Date");else if("Native__Backstage__Extn__Event_End_Date"===i)d("Native__Backstage__Extn__Event_Start_Date");else{var a=crmConstants.dateTimeComparisonFieldsMapping.filter((function(t){if(t.start===e.columnName||t.end===e.columnName)return t}));if(a.length&&a[0]){var s,o=a[0],n=o.start===e.columnName?o.end:o.start,l=!1;for(var c in r.$.model.fieldList){if(r.$.model.fieldList[c].columnName===n&&(l=!0,s=c),l)break}d(s)}}function d(e){if(r.$.error&&r.$.error[e]){var t=r.$.error[e];!t||"ERRDATE01"!==t.code&&"ERRDATE02"!==t.code||delete r.$.error[e]}}}},handleRecNotAvailablityError:function(){$L("#show").empty(),Lyte.Component.render("crm-permission-error",{brandName:Crm.appName,isEntityPresence:1},"#show"),this.transition.abort()},handleCScriptDispatchEvent:function(e){if(CScriptLib){if([36,143,144,145].contains(e.uiType)&&"onChange"!==e.calledFrom)return;CScript.dispatchEvent("onChange",void 0,e.fldapiName),CScript.dispatchEvent("onChange",e.fieldID,CreatePageHandler.field_read.call({field_name:e.fldapiName}))}},executeUserFieldsofLookup:function(e,t){var r=this.$node.component.data,i=r.apiName||t;if(r.associationDetails&&r.associationDetails.contains(i)&&e&&!0===Crm.userDetails.FIELD_OF_LOOKUP_ENABLED&&!0===Crm.userDetails.FIELD_OF_LOOKUP_AVAIALBLE){var a=this.getData("moduleData.user_module_fields_FOL"),s="edit"===r.initRoute?"edit":"create",o=r.moduleData.fields.filter((function(e){if(e.visible&&e.view_type[s]&&e.association_details&&validationUtils.isNotEmpty(e.association_details)&&e.association_details.lookup_field.api_name===i)return e})),n={};o&&o.length&&(n.fields=o.mapByKey("association_details").mapByKey("related_field").mapByKey("api_name").join()),store.findRecord("user",e.id,n,void 0,void 0,{usersAPIversion:"v2.2"}).then(function(t){t&&t[0]&&(e=t[0],a?this.executeFieldsOfLookup(e,"user",void 0,void 0,!0,a,i):store.findAll("field",{module:"users"},void 0,void 0,{apiVersion:"2.2"}).then(function(t){this.setData("moduleData.user_module_fields_FOL",t),this.executeFieldsOfLookup(e,"user",void 0,void 0,!0,t,i)}.bind(this)))}.bind(this))}},executeFieldsOfLookup:function(e,t,r,i,a,s,o){var n=this.$node.component.data,l=o||n.apiName;if(n.associationDetails&&n.associationDetails.contains(l)&&!0===Crm.userDetails.FIELD_OF_LOOKUP_ENABLED&&!0===Crm.userDetails.FIELD_OF_LOOKUP_AVAIALBLE){var c;c="user"===t?store.modelFor("user")?store.modelFor("user").fieldList:void 0:store.modelFor(moduleRecordMapping[t].id).fieldList;var d="edit"===n.initRoute?"edit":"create",u=n.moduleData.fields.filter((function(e){if(e.visible&&e.view_type[d]&&e.association_details&&validationUtils.isNotEmpty(e.association_details)&&e.association_details.lookup_field.api_name===l)return e})),m=[];if(!a){var p=store.peekRecord("layout",i).fields;p=p?p.map((function(e){return e.id})):[];var g=u.map((function(e){return e.association_details.related_field.id}));(m=(m=store.peekRecord("module",r).fields)||[]).length&&(m=m.filter((function(e){return g.contains(e.id)&&e.visible&&p.contains(e.id)})).map((function(e){return e.id})))}u.forEach(function(t){var r=n.dataBind.$.model.fieldList[t.api_name],i=t.association_details.related_field,o=c[i.api_name]?c[i.api_name].type:void 0;if(!o&&a){var l=s.filter((function(e){return e.api_name===i.api_name}))[0];l&&(o=Lyte.registeredMixins["crm-module-mixin"].getfieldattributeType(l))}if(m.contains(i.id)||a)if("date"===r.type){if(t.isSetValueFromScript=!0,e[i.api_name]){u=(u=e[i.api_name]).replace(/[+-]\d{2}:\d{2}/,"");var d=CrmDateUtils.convertDateToUserPattern(CrmDateUtils.getDateObjectFromString(u,"YYYY-MM-DD"));Lyte.Component.set(n.dataBind,t.api_name,d||void 0)}else Lyte.Component.set(n.dataBind,t.api_name,void 0);delete t.isSetValueFromScript}else if("datetime"===r.type){if(t.isSetValueFromScript=!0,e[i.api_name]){var u;u=(u=e[i.api_name]).replace(/[+-]\d{2}:\d{2}/,"");var p=this.getDateTimeForForm(new Date(u),!0);Lyte.Component.set(n.dataBind,t.api_name,p||void 0)}else Lyte.Component.set(n.dataBind,t.api_name,void 0);t.$.set("obsDateTime",!t.obsDateTime),delete t.isSetValueFromScript}else if(r.type===o||"object"!==o&&"relation"!==o)if("lookup"===t.data_type&&"object"===o)Lyte.Component.set(n.dataBind,t.api_name,e[i.api_name]),t.$.set("fromFieldsofLookup",!0),t.$.set("lookupSingle",e[i.api_name]?e[i.api_name].name:""),t.$.set("selectedId",e[i.api_name]?e[i.api_name].id:"");else if("multi-picklist"===o&&e[i.api_name]){var g;if("string"==typeof e[i.api_name]&&-1===e[i.api_name].indexOf(";")){var f=JSON.parse(e[i.api_name]);g=f&&f.length?h(f):""}else"string"!=typeof e[i.api_name]&&e[i.api_name].length&&(g=h(e[i.api_name]));function h(e){var t="",r=e?e.length:0;return e.forEach((function(e,i){t+=e+(i!==r-1?";":"")})),t}Lyte.Component.set(n.dataBind,t.api_name,g)}else if("currency"===r.fieldType&&e&&e[i.api_name]){if(t.isSetValueFromScript=!0,n.dataBind.Currency&&e.Currency&&e.Currency!==n.dataBind.Currency){var y=this.getuserCurrencydata(n.dataBind.Currency),v=this.convertToCurrentCurrency(e[i.api_name],e.Exchange_Rate,y.er);v=isNaN(v)?e[i.api_name]:v,v=Number(v).toFixed(t.decimal_place),Lyte.Component.set(n.dataBind,t.api_name,v)}else if(!e.Currency&&n.dataBind.Currency&&n.dataBind.Currency!==Crm.userDetails.BASE_CURRENCY&&Crm.userDetails.BASE_CURRENCY){y=this.getuserCurrencydata(n.dataBind.Currency);var _=this.getuserCurrencydata(Crm.userDetails.BASE_CURRENCY);v=this.convertToCurrentCurrency(e[i.api_name],_.er,y.er);v=isNaN(v)?e[i.api_name]:v,v=Number(v).toFixed(t.decimal_place),Lyte.Component.set(n.dataBind,t.api_name,v)}else Lyte.Component.set(n.dataBind,t.api_name,Number(e[i.api_name]).toFixed(t.decimal_place));delete t.isSetValueFromScript;var b="crm-create-fields#"+n.modulenameUicomp+"_fldRow_"+t.column_name+" lyte-input input";$L(b).trigger("keypress").trigger("keyup").focus().trigger("blur")}else t.isSetValueFromScript=!0,Lyte.Component.set(n.dataBind,t.api_name,e&&void 0!==e[i.api_name]?e[i.api_name]:void 0),delete t.isSetValueFromScript;else"string"===r.type&&e[i.api_name]&&validationUtils.isNotEmpty(e[i.api_name])&&Lyte.Component.set(n.dataBind,t.api_name,e[i.api_name].name)}.bind(this))}},fillSkeEyeCompanyResponse:function(e){var t=this.getLyteCreateComponentForCscript(),r=this.data.dataBind.$.model.fieldList,i=(e=e||{},{});for(var a in r){var s=r[a];if(s&&e.hasOwnProperty(s.columnName)&&e[s.columnName]&&"null"!==e[s.columnName]&&(i[a]=e[s.columnName],"date"===s.fieldType||"datetime"===s.fieldType)){var o=$L.moment(Number(e[s.columnName]))._dateObj,n=Utils.getDateInUserDatePattern(o);i[a]=n}}t&&Object.keys(i).length&&this.formHandlerWrapperForLyteConversion(t,i,"skyEye")},handleConvertedRecordError:function(e,t){Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[e,t]})},cscriptReadFormClientHandler:function(e){if(!e)return{Data:{}};var t=e.component.data;if(t&&t.supportClientscript){var r=t.dataBind.$.toJSON();if(validationUtils.isNotEmpty(t.dataBind.$.error)){var i=t.dataBind.$.error;for(var a in i)r[a]=i[a]?i[a].value:r[a]}var s=t.dataBind.$.model.fieldList,o="clone"===t.initRoute?"create":t.initRoute;function n(e,r){if(e){for(var i in e){var a=!0;if(e[i]&&e[i].fieldID){var s=store.peekRecord("field",e[i].fieldID);if("datetime"===e[i].fieldType&&r[i]&&r[i].indexOf("TV")>-1){var n=r[i].split("TV");2===n.length&&(r[i]=n[0]+" "+n[1])}"picklist"===e[i].fieldType&&"-None-"===r[i]&&(r[i]=null),"multiselectpicklist"===e[i].fieldType&&r[i]&&"string"==typeof r[i]&&(r[i]=JSON.parse(r[i])),s&&s.view_type[o]&&Lyte.Component.registeredHelpers.isValidCreateField(s,t.initRoute,t.moduleData.module_name)||(delete r[i],a=!1)}else delete r[i],a=!1;a&&(r[i]=r[i]||null)}return r}return r}if(s)for(var l in s)if(s[l]&&(s[l].fieldID||"relation"===s[l].type)){var c=store.peekRecord("field",s[l].fieldID);if("relation"===s[l].type&&r[l]&&r[l].length){var d=[];r[l].forEach((function(e){var t=n(store.modelFor(s[l].relatedTo).fieldList,store.peekRecord(s[l].relatedTo,e).$.toJSON());d.push(t)})),r[l]=d;continue}if("datetime"===s[l].fieldType&&r[l]&&r[l].indexOf("TV")>-1){var u=r[l].split("TV");2===u.length&&(r[l]=u[0]+" "+u[1])}if(("imageupload"===s[l].fieldType||"fileupload"===s[l].fieldType||"picklist"===s[l].fieldType&&"-None-"===r[l])&&(r[l]=null),"multiselectpicklist"===s[l].fieldType&&r[l]&&"string"==typeof r[l]&&(r[l]=JSON.parse(r[l])),"multiuserlookup"!==s[l].fieldType&&"userlookup"!==s[l].fieldType||(r[l]=null),"multiselectlookup"===s[l].fieldType){var m="";if(r[l]?r[l].length:0){var p="crm-create-fields#"+t.moduleName+"_fldRow_"+s[l].columnName,g=$L(p)[0];if(g&&g.component){g.component.data.lyteViewPort&&g.component.setData("lyteViewPort",!1);var f=g.querySelector(".createmxnlookupDIV input");f&&f.value&&(m=f.value)}}r[l]=m||null}else if("lookup"===s[l].fieldType&&r[l]&&validationUtils.isNotEmpty(r[l])){var h={};r[l].id&&(h.id=r[l].id),r[l].name&&(h.name=r[l].name),r[l]=h}else if("ownerlookup"===s[l].fieldType&&r[l]&&validationUtils.isNotEmpty(r[l])){var y={};r[l].id&&(y.id=r[l].id),(r[l].name||r[l].full_name)&&(y.name=r[l].name||r[l].full_name),r[l]=y}var v=!1;c&&c.view_type[o]&&Lyte.Component.registeredHelpers.isValidCreateField(c,t.initRoute,t.moduleData.module_name)?!r[l]&&c&&c.default_value&&(r[l]=c.default_value):(!c||c&&!c.isHiddenInLayoutRules)&&(delete r[l],v=!0),r.hasOwnProperty(l)?(c&&c.isHiddenInLayoutRules||void 0===r[l])&&(r[l]=null):v||(r[l]=null)}else delete r[l];var _=[];r=r||{};for(var b in r)_.push([b,r[b]]);_=_.sort((function(e,t){var r=e[0].toUpperCase(),i=t[0].toUpperCase();return r<i?-1:r>i?1:0}));var w={};return _.forEach((function(e){w[e[0]]=e[1]})),{Data:w}}},triggerCScriptUIUpdate:function(e){var t=(e=e||{}).fldMeta,r=e.value,i="crm-create-fields#"+e.moduleName+"_fldRow_"+(t=t||{}).column_name,a=$L(i)[0];t&&a&&a.component&&a.component.bindRecordErrorValuesToNode&&!a.component.data.lyteViewPort&&a.component.bindRecordErrorValuesToNode({value:r},t.data_type,t.ui_type)}}),Lyte.Mixin.register("crm-date-datetime-mixin",{getDateTimeWithTimezone:function(e){function t(e){return e<10?"0"+e:e}var r;return e&&(r=e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+"T"+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())),r},getcurrentTime:function(e){var t=Crm.userDetails.TIME_FORMAT.split(" "),r={};r.format=t.length>1?"12":"24";var i,a=(new Date).getHours();switch((a=e?a+e:a)>=24&&(a-=24),r.format){case"12":var s=a>=12?I18n.getMsg("PM"):I18n.getMsg("AM");i=a>12?o(a-12)+":00 "+s:o(0===a?12:a)+":00 "+s;break;case"24":i=o(a)+":00"}function o(e){return e<10?"0"+e:e}return r.currTime=i,"12"===r.format?(r.startTime="00:00 "+I18n.getMsg("AM"),r.endTime="11:59 "+I18n.getMsg("PM")):(r.startTime="00:00",r.endTime="23:59"),r.meridian={AM:I18n.getMsg("AM"),PM:I18n.getMsg("PM")},r},getfinalTimeObjectfromTime:function(e){if(e){var t={},r=Crm.userDetails.TIME_FORMAT.split(" ").length>1?"12":"24",i=e.split(" "),a=i[0].split(":");return"12"==r?(i[1]&&(i[1]=i[1].toUpperCase(),t.hrs=i[1]==I18n.getMsg("AM").toUpperCase()?12==a[0]?0:a[0]:12+(12==a[0]?0:Number(a[0]))),t.mins=a[1]):(t.hrs=a[0],t.mins=a[1]),t}},convertTimeTo24HoursFormat:function(e,t){return void 0===t?e:"am"===(t=t.toLowerCase())?0===e?12:12===e?0:e:"pm"===t?12===e?e:e+12:t===I18n.getMsg("AM")||I18n.getMsg("am")===t?0===e?12:12===e?0:e:t===I18n.getMsg("PM")||I18n.getMsg("pm")===t?12===e?e:e+12:void 0},convertdateToDBformat:function(e){return $L.moment(e).format("YYYY-MM-DD")},getCurrentMonthForOrgTimeZone:()=>crmCalendar.monthName[(new CrmDate).dateObject.getMonth()].html}),Lyte.Mixin.register("crm-utilities",{flatten:function(e){for(var t=[],r=e.length,i=0;i<r;i++)Array.isArray(e[i])?t=t.concat(this.flatten(e[i])):t.push(e[i]);return t},isNull:function(e){return null===e},executeFunctionByName:function(e,t){for(var r=Array.prototype.slice.call(arguments,2),i=e.split("."),a=i.pop(),s=i.length,o=0;o<s;o++)t=t[i[o]];return t[a].apply(t,r)}}),Lyte.Mixin.register("crm-wizard-util-mixin",{checkForUnsavedChanges:function(e){var t=e.pause(),r=document.querySelector("crm-wizard-builder"),i=r?store.peekRecord("wizard",r.component.getData("wizardId")):void 0;if(e.data&&e.data.confirm_exit)$(".setupleftmenutable .setupleftmenutd").show(),$(".new_setupview").removeClass("newSetupRightShow"),t.resume();else if(i&&r.component.isDirty(i)||r&&r.component.wizardFlowHandler&&r.component.wizardFlowHandler.dirty){var a=!1;i.containers.forEach((function(e){e.screens&&e.screens.length&&(a=!0)})),a?(r.component.executeMethod("alertTrigger",!0,I18n.getMsg("crm.settings.wizard.exit.confirm.banner"),I18n.getMsg("crm.settings.wizard.exit.confirm.description"),"error","","","confirmExit",[],[{type:"accept",text:I18n.getMsg("crm.label.yes"),appearance:"failure"},{type:"reject",text:I18n.getMsg("crm.label.no")}]),t.abort()):($(".setupleftmenutable .setupleftmenutd").show(),$(".new_setupview").removeClass("newSetupRightShow"),t.resume())}else $(".setupleftmenutable .setupleftmenutd").show(),$(".new_setupview").removeClass("newSetupRightShow"),t.resume()},isDirty:function(e){var t=!1;return!!e.$.getCurrentState()||(e.containers.forEach((function(e){e.$.getCurrentState()?t=!0:e.screens&&e.screens.forEach((function(e){e.$.getCurrentState()?t=!0:(e.segments.forEach((function(e){e.$.getCurrentState()?t=!0:"buttons"===e.type&&e.buttons.length&&e.buttons.forEach((function(e){(e.$.getCurrentState()||e.$.isDirty()||e.transition&&e.transition.dirty)&&(t=!0)}))})),e.conditional_rules&&e.conditional_rules.forEach((function(e){(e.$.getCurrentState()||e.$.isDirty()||e.$.isNew)&&(t=!0)})))}))})),t)},sortElements:function(e){e.hasOwnProperty("containers")&&e.containers.forEach((function(e){e.screens&&e.screens.forEach((function(e){e.segments.sort((function(e,t){return e.sequence_number<t.sequence_number?-1:e.sequence_number>t.sequence_number?1:0})),e.segments.forEach((function(e){"buttons"===e.type&&e.buttons.sort((function(e,t){return e.sequence_number<t.sequence_number?-1:e.sequence_number>t.sequence_number?1:0}))}))}))}))},getSegmentsByType:function(e,t){var r=-1,i=[],a=e.length;for(r=0;r<a;r++)e[r].type===t&&i.push(e[r]);return i.length?i:void 0},showToastMessage:function(e,t){this.toasterElement.ltProp({type:e,show:!0,message:t})},fetchWizardModelData:function(e,t,r,i){store.unloadAll("wizard");var a={};return r&&(a.hostUrl=r,r.headers&&(a.headers=r.headers,r.headers)),Lyte.resolvePromises({wizard:store.findRecord("wizard",e,{layout_id:t},!1,"",a)}).then((function(r){if(r.wizard[0]){var i={},a=r.wizard[0];if(i.limits=r.wizard.$.meta.limits,!a){let e={desc:I18n.getMsg("crm.settings.wizard.not.found.desc"),Heading:I18n.getMsg("crm.settings.wizard.not.found.heading")};return r.deleteAlert=e,r}Lyte.registeredMixins["crm-wizard-util-mixin"].sortElements(a),i.wizardId=e,i.wizardName=a.name,i.primaryModule=a.module,i.selectedLayoutId=t,i.id="wizBuilder",i.layouts=[],i.builderScreenMap={};var s={};return a.containers.forEach((function(e,r){var a=e.layout;i.layouts[r]=a,t&&a.id&&a.id.toString()==t.toString()&&(i.layouts[r].active=!0,i.selectedLayoutId=a.id),s[a.id]=e})),i.builderScreenMap=s,i.profiles=a.profiles,i}})).catch((function(e){let t={};return t=e.response&&e.response.indexOf("Invalid Wizard ID")>0?{desc:I18n.getMsg("crm.settings.wizard.not.found.desc"),Heading:I18n.getMsg("crm.settings.wizard.not.found.heading")}:e.response&&e.response.indexOf("Invalid layout id")>0?{desc:I18n.getMsg("crm.settings.wizard.layout.not.found.desc"),Heading:I18n.getMsg("crm.zmail.users.backup.error")}:{desc:I18n.getMsg("crm.copy.error.mail.internal.error"),Heading:I18n.getMsg("crm.zmail.users.backup.error")},e.deleteAlert=t,e}))}}),Lyte.Mixin.register("reviewprocess",{getFieldsData:function(e,t,r){var i;t||(i=e.module?e:e[0],t=i.module.api_name,r=i.layout.id);var a=CrmField.UITYPES;return store.findRecord("layout",r,{module:t,skip_permission:!0},!1,!1).then((function(e){if(e){for(var r=e.layout[0].sections,i=r.length,s=[],o=[0,1,10,11,12,13,14],n={Cases:["COMMENTCOUNT"],Leads:["EMAILOPTOUT","PREDICTIONSCORE","FIRSTNAME","FULLNAME","TAGMODULEREFID","SALUTATION","RATING"],Contacts:["EMAILOPTOUT","SALUTATION","FIRSTNAME","FULLNAME"],Accounts:["RATING"],Deals:["PREDICTIONSCORE","PROBABILITY","FORECASTCATEGORY","FORECAST_CATEGORY"]},l={Solutions:["QUESTIONS","ANSWERS"]},c={Leads:Crm.moduleInfo.Leads.translatedSingularLabel+" "+I18n.getMsg("crm.label.NAME"),Contacts:Crm.moduleInfo.Contacts.translatedSingularLabel+" "+I18n.getMsg("crm.label.NAME")},d=[66,3,51,a.ACCOUNT_NAME_LOOKUP,a.CAMPAIGN_NAME_LOOKUP,a.PRODUCT_NAME_LOOKUP,a.CONTACT_LOOKUP,a.VENDOR_NAME_LOOKUP,a.LECT_LOOK_UP,a.OWNER,a.USERLOOKUP,a.MULTISELECT_USERLOOKUP,a.MULTISELECT_LOOK_UP,a.POTENTIAL_ID,a.SALESORDER_ID,a.CONTACT_ID,a.QUOTE_ID,a.ROLE_NAME,a.LOOK_UP_ENTITY,a.CREATED_BY,a.CREATED_TIME,42,43,44,46,50,51,62,77,210,208,207,135,136,a.LAYOUT_LOOKUP,117,50,134,55,201,99,209,26,116,11,111,123,a.POLYMORPHIC_LOOK_UP_ENTITY,999,103,53,101,102,556,47],u=0;u<i;u++){var m=r[u],p=m.fields,g=p.length;if(m.isSubformSection){for(var f,h="",y=0;y<g;y++){if("subform"===(b=p[y]).data_type){h=b.api_name,f=b.field_label;break}}if(h&&""!==h)for(y=0;y<g;y++){if(!("subform"===(b=p[y]).data_type||b.subform&&b.subform.module||-1!=o.indexOf(b.show_type)||-1!=d.indexOf(b.ui_type)||b.field_read_only||n[t]&&-1!=n[t].indexOf(b.column_name))){var v=h+"."+b.api_name,_=b.field_label+"("+f+")";s.push({name:_,value:v})}}}else for(y=0;y<g;y++){var b=p[y];!(-1==o.indexOf(b.show_type)&&-1==d.indexOf(b.ui_type)||l[t]&&-1!=l[t].indexOf(b.column_name))||b.field_read_only||n[t]&&-1!=n[t].indexOf(b.column_name)||"EMAILOPTOUT"==b.column_name||("LASTNAME"==b.column_name&&(b.field_label=c[t]),s.push({name:b.field_label,value:b.api_name}))}}return s}}))},returnValidLayouts:function(e){for(var t=e.length,r=[],i=0;i<t;i++)-3!=e[i].status&&r.push(e[i]);return r},returnLayouts:function(e){for(var t=e.length,r=[],i=0;i<t;i++)r.push(e[i]);return r},getUserDateFormat:function(e){var t=Utils.ISO8601toDateObject(e),r=new Date;return Utils.convertToUserTimezone(r),Utils.getDateInGivenPattern(t,"mm-dd-yyyy")==Utils.getDateInGivenPattern(r,"mm-dd-yyyy")?Utils.getTimeInUserFormat(t,!0):Utils.getDateInUserDatePattern(t)},getCriteriaFields:function(e,t,r){var i={resource:"review_process"};i.module=e,i.layout_id=t;var a={};a.params=i;return networkUtils.lyteInitiateRequest("/crm/v2/definition","GET",a).then((function(t){if(!r){var i;i=t.definition.criteria_fields?t.definition.criteria_fields[0]:t.definition.criteriaFields[0];var a=e;for(var s in Crm.moduleInfo){if(Crm.moduleInfo.hasOwnProperty(s))if(Crm.moduleInfo[s].sysRefName===e){a=s;break}}return i=i[a]}t.definition.criteria_fields?r.actions.loadCriteriaEditor(r,t.definition.criteria_fields[0],e):r.actions.loadCriteriaEditor(r,t.definition.criteriaFields[0],e)})).catch((function(e){var t=JSON.parse(e.responseText);"INTERNAL_ERROR"===t.code||"PERMISSION_DENIED"===t.code?renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")):renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("error.database.problem"))}))},getModules:function(e,t){return store.findAll("module").then((function(r){for(var i,a=[],s=["Leads","Contacts","Accounts","Potentials","Vendors","Quotes","PurchaseOrders","SalesOrders","Products","Cases","Solutions","PriceBooks","Invoices"],o=r.length,n=0;n<o;n++)if(r[n].visible&&(!r[n].parent_module||r[n].parent_module.id)){var l=r[n].module_name;if(l&&(0===l.indexOf("CustomModule")||s.indexOf(l)>-1)&&!crmTab.isZBCustomModule(l)&&!crmTab.isZECustomModule(l)&&!crmTab.isZSCustomModule(l)){if(e&&!i){var c=[],d={module:r[n].api_name,skip_permission:!0};i=store.findAll("layout",d).then((function(e){for(var t=e.length,r=0;r<t;r++)c.push(e[r]);return c}))}a.push(r[n])}}return t&&t.setData("modules",a),i||a}))},getLayoutDetails:function(e){if(e&&("string"==typeof e||e instanceof String)){var t=this;return store.findAll("layout",{module:e,skip_permission:!0}).then((function(e){return t.returnLayouts(e)})).catch((function(e){var t=JSON.parse(e.responseText);"NO_PERMISSION"===t.code||"PERMISSION_DENIED"===t.code||"INVALID_MODULE"===t.code?(renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),setTimeout((function(){Utils.windowLocationReload()}),3e3)):renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("error.database.problem"))}))}},checkForOpenRules:function(e){var t=$L("crm-reviewprocess-addrpconfig").e,r=$L("crm-reviewprocess-createconfig").e[0],i=t.length;if(i<1||r.getData("isInvalidProcessName")||!e&&$L(".rPfieldCont").is(":visible"))return!0;for(var a=0;a<i;a++){var s=t[a];if(!(s.getData("setCriteria")||s.getData("showFinalCriteria")||1==s.getData("criteriaVal")&&s.getData("allRecordsCriteria"))||0===Object.keys(s.getData("selectedReviewers")).length)return!0}return r.setData("isProcessSaveEnabled",!0),!1},getRpViewComponents:function(e){var t={};if(e)for(var r=e.length,i=0;i<r;i++){var a=e[i],s=[];t.hasOwnProperty(a.prefix)&&(s=t[a.prefix]),s.push(a),t[a.prefix]=s}return t},getSelectedReviewers:function(e){for(var t=[],r=e.length,i={user:I18n.getMsg("crm.label.users"),role:I18n.getMsg("roles"),user_group:I18n.getMsg("groups"),territory:I18n.getMsg("Territories"),RecordOwner:I18n.getMsg("crm.label.recordOwner")},a=0;a<r;a++){var s=e[a].type;"user"===s?e[a].image="//"+RebrandLinkUtil.getProperty("CONTACTS_URL")+"/file?ID="+e[a].zuid+"&fs=thumb":"RecordOwner"===s&&(e[a].name=I18n.getMsg("crm.label.recordOwner")),e[a].prefix=i[s],t.push(e[a])}return t},getDateTimeForRp:function(e){var t=new Date;Utils.convertToUserTimezone(t);var r=Utils.ISO8601toDateObject(e);return r.getDate()===t.getDate()&&t.getMonth()==t.getMonth()&&r.getFullYear()===t.getFullYear()?Utils.getTimeInUserFormat(r,!0):Utils.getDateInUserDatePattern(r)},getLimits:function(){return{process:{A:10,U:50,C:50,Z:25,D:3},fields:{A:25,U:50,C:50,Z:25,D:25},reviewers:{A:5,U:5,C:5,Z:5,D:5}}},showDelugePopUp:function(e,t,r){var i=new AutomationActionsHelper.ActionClass;if(i.module=e,i.source="ReviewProcess",i.action="Deluge",i.title="crm.wf.report.deluge",i.licenceLimit=1,i.licenseLimitWarning="crm.reviewprocess.action.deluge.limit",AutomationActionsHelper.initializeInstance(i),"Create"===t){var a={actionPage:"commonActionPage",fromSource:"ReviewProcess"};a.ruleType=e,a.step="selectWFDeluge",(new crmRequestPool).initiate({type:AutomationActionsHelper.GET_REQUEST_TYPE,action:AutomationActionsHelper.WORKFLOW_URL,data:a,success:function(e){AutomationActionsHelper.handleSelectActionResp(e)}})}else"Update"===t&&(i.actionId=r,AutomationActionsHelper.showEditWFActionItem(i))},selectDelugeCallback:function(e,t,r){var i=$("#commonActionPage");i&&i.is(":visible")&&crmui.hidePopup("commonActionPage");var a={};a.id=t,a.name=r;var s=$L("crm-reviewprocess-createconfig").e[0],o=s.getData("lastSelectedFunctionType"),n=s.getData("lastSelectedFunctionIndex"),l=s.getData("processRecord.actions.execute_on."+o),c=s.getData("functionsList")[n];l||(l={}),Lyte.objectUtils(l,"add","function",a),Lyte.objectUtils(c,"add","isModified",!0),Lyte.objectUtils(c,"add","actionObject",a),s.setData("functionsList",c),s.setData("processRecord.actions.execute_on."+o,l),s.setData("noOfFunctionConfigured",this.noOfFunctionConfigured(s))},noOfFunctionConfigured:function(e){var t=e.getData("functionsList"),r=0;return t.forEach((function(e){e.actionObject&&(r+=1)})),r}}),Lyte.Component.registerHelper("getKeys",(function(e){return"object"==typeof e?Object.keys(e):[]})),store.registerModel("user",{fields:Lyte.attr("array"),name:Lyte.attr("string"),zuid:Lyte.attr("string"),alias:Lyte.attr("string"),customize_info:Lyte.attr("object"),confirm:Lyte.attr("boolean"),date_format:Lyte.attr("string"),decimal_separator:Lyte.attr("string"),number_separator:Lyte.attr("string"),default_tab_group:Lyte.attr("string"),email:Lyte.attr("string"),ezuid:Lyte.attr("string"),first_name:Lyte.attr("string"),full_name:Lyte.attr("string"),imap_status:Lyte.attr("boolean"),last_name:Lyte.attr("string"),profile:Lyte.belongsTo("profile",{inverse:"users",serialize:"record"}),createdByProfile:Lyte.hasMany("profile"),modifiedByProfile:Lyte.hasMany("profile"),Reporting_To:Lyte.attr("object"),role:Lyte.belongsTo("role",{serialize:"partial"}),forecast_data:Lyte.hasMany("forecast_data"),rtl_enabled:Lyte.attr("boolean"),status:Lyte.attr("string"),display_status:Lyte.attr("string"),telephony_enabled:Lyte.attr("boolean"),personal_account:Lyte.attr("boolean"),time_zone:Lyte.attr("string"),phone:Lyte.attr("string"),mobile:Lyte.attr("string"),fax:Lyte.attr("string"),website:Lyte.attr("string"),dob:Lyte.attr("string"),city:Lyte.attr("string"),country:Lyte.attr("string"),street:Lyte.attr("string"),state:Lyte.attr("string"),zip:Lyte.attr("string"),ntc_enabled:Lyte.attr("boolean"),ntc_notification_type:Lyte.attr("array"),language:Lyte.attr("string"),locale:Lyte.attr("string"),country_locale:Lyte.attr("string"),_users:Lyte.hasMany("user"),time_format:Lyte.attr("string"),time_zone:Lyte.attr("string"),theme:Lyte.attr("object"),name_format:Lyte.attr("string"),signature:Lyte.attr("string"),territories:Lyte.hasMany("territory"),category:Lyte.attr("string"),Currency:Lyte.attr("string"),shift_hour:Lyte.hasMany("shift_hour"),effective_shift_hour:Lyte.belongsTo("shift_hour"),current_shift_hour:Lyte.belongsTo("shift_hour")},{actions:{search:{endPoint:"search"},convert:{},get_unassigned:{},get_assigned:{},transfer_and_delete:{},grouped_counts:{},count:{}}}),store.registerAdapter("user",{xhrReq:new XMLHttpRequest,namespace:"crm/v2",buildURL:function(e,t,r,i,a,s,o){if(a=a.replace(e,e+"s"),"action"===t){if("transfer_and_delete"!==s&&"count"!==s)for(var n in"grouped_counts"!==s&&(a=a.replace("/actions","")),o)o.hasOwnProperty(n)&&(r[n]=o[n]);"grouped_counts"===s&&(a=a.replace("v2","v2.2"))}return void 0===o||void 0===o.tempApiVersion||"V2.1"!==o.tempApiVersion&&"V2.2"!==o.tempApiVersion||(a=a.replace("v2","V2.1"===o.tempApiVersion?"v2.1":"v2.2")),void 0!==r.SandboxAccount&&(a=a.replace("crm/","crm/"+crmPortal+"/sandbox/diff/"),delete r.SandboxAccount),"updateRecord"===t&&(a=a.slice(0,a.lastIndexOf("/"))),r&&r.filters&&void 0!==r.filters[0].comparator&&(a=a.replace("v2","v2.2")),void 0===r||void 0===r.shiftApiVersion||a.includes("v2.2")?o&&o.shiftApiVersion&&!a.includes("v2.2")?a=a.replace("v2",o.shiftApiVersion):o&&"usersCount"===o?a=(a=a.replace("v2","v2.2")).replace("users","users/actions/count"):void 0===r||"ActiveLiteUser"!==r.type&&!0!==r.include_lite_users&&"true"!==r.include_lite_users?i&&void 0!==i.category&&(a=(a=a.replace("v2","v2.2")).concat("/actions/convert")):a=-1!==a.indexOf("v2.1")?a.replace("v2.1","v2.2"):-1!==a.indexOf("v2.2")?a:a.replace("v2","v2.2"):(a=a.replace("v2",r.shiftApiVersion),delete r.shiftApiVersion),void 0!==o&&void 0!==o.actual_api&&"unassigned_users"===o.actual_api&&(a=(a=a.replace("v2","v2.1")).replace("/users","/settings/automation/assignment_thresholds/actions/unassigned_users"),r.module=o.other_module,o.temp_ids&&(r.temp_ids=o.temp_ids)),void 0!==o&&o.usersAPIversion&&!a.includes("v2.2")&&(a=a.replace("v2","v2.2")),a},methodForRequest:function(e,t,r,i,a){return"action"===t?"transfer_and_delete"===a?"POST":"GET":"liteConvert"===i?"POST":"PATCH"===e&&"updateRecord"===t?"PUT":e},processRequest:function(e,t,r,i,a){var s=this;if("action"===e){if("search"===(r=JSON.parse(r)).type||"count"===r.type)return new Promise((function(t,i){var o=s.xhrReq,n="search"===r.type?"/"+s.namespace+"/users/search?":"/"+s.namespace+"/users/actions/count?";for(var l in"count"===r.type&&a&&(r.customData=a),void 0!==r.customData&&void 0!==r.customData.tempApiVersion&&"V2.1"===r.customData.tempApiVersion?n=n.replace("v2","v2.1"):void 0!==r.customData&&void 0!==r.customData.tempApiVersion&&"V2.2"===r.customData.tempApiVersion&&(n=n.replace("v2","v2.2")),void 0===r.customData||"ActiveLiteUser"!==r.customData.type&&!0!==r.customData.include_lite_users&&"true"!==r.customData.include_lite_users||(n=-1!==n.indexOf("v2.1")?n.replace("v2.1","v2.2"):-1===n.indexOf("v2.2")?n.replace("v2","v2.2"):n),void 0!==r.customData&&void 0!==r.customData.SandboxAccount&&(n=n.replace("crm/","crm/"+crmPortal+"/sandbox/diff/")),void 0!==a&&void 0!==a.actual_api&&"unassigned_users"===a.actual_api&&(n=(n=n.replace("v2/","v2.1/")).replace("/users/search","/settings/automation/assignment_thresholds/actions/unassigned_users_search"),r.customData.module=a.other_module,delete r.customData.actual_api,delete r.customData.other_module),r.customData)"tempApiVersion"!==l&&(n+=l+"="+encodeURIComponent(r.customData[l])+"&");o.open("GET",n);var c=store.adapter.application.headersForRequest(e,void 0,r.customData);for(var d in c)o.setRequestHeader(d,c[d]);o.onload=function(){this.status>=200&&this.status<300?t(o.response):i({status:this.status,statusText:o.statusText})},o.onerror=function(){i({status:this.status,statusText:o.statusText})},o.send()}));if(a){var o;if(a.group_by)return;return a.transfer_and_delete?o="/"+s.namespace+"/users/actions/transfer_and_delete":a.get_unassigned?o="/"+s.namespace+".2/users/actions/get_unassigned":a.get_assigned&&(o="/"+s.namespace+".2/users/actions/get_assigned"),new Promise((function(e,t){var r=s.xhrReq;r.open("POST",o);var i=store.adapter.application.headersForRequest();for(var n in i)r.setRequestHeader(n,i[n]);r.onload=function(){this.status>=200&&this.status<300?e(r.response):t({status:this.status,statusText:r.statusText})},r.onerror=function(){t({status:this.status,statusText:r.statusText})},r.send(JSON.stringify(a))}))}}else if(a&&a.isFromShiftHours)return new Promise((function(t,r){var i=s.xhrReq,o="/"+s.namespace+"/users?";for(var n in o=o.replace("v2","v2.2"),a.param)o+=n+"="+encodeURIComponent(a.param[n])+"&";o.includes("include_lite_users")||(o+="include_lite_users=true&"),i.open("GET",o);var l=store.adapter.application.headersForRequest(e,void 0,a.param);for(var c in l)i.setRequestHeader(c,l[c]);i.onload=function(){this.status>=200&&this.status<300?t(i.response):r({status:this.status,statusText:i.statusText})},i.onerror=function(){r({status:this.status,statusText:i.statusText})},i.send()}))}}),store.registerSerializer("user",{varPayloadKey:"users",serializeUserData:function(e){for(var t in e)void 0===e[t]&&(e[t]=null)},normalizeUserData:function(e){for(var t in e)null===e[t]&&(e[t]=void 0)},serialize:function(e,t,r,i,a,s,o){if("action"===e)return"search"===o?{type:"search",customData:i}:"count"===o?{type:"count"}:{};t.users=[t.user],delete t.user;var n=t.users;return n&&(n.constructor===Array?n.forEach(function(e){this.serializeUserData(e)}.bind(this)):n.constructor===Object&&this.serializeUserData(n)),t},normalizeResponse:function(e,t,r,i,a){if("createRecord"===t){var s=r.users[0];return"success"===s.status&&(s.id=s.details.id,s.email=s.details.email),r.users=r.users[0],r}if("updateRecord"===t&&200===a)r.users={id:i};else if("updateRecord"===t&&400===a)_cruxUtils.showCustomMessage({params:{ltPropType:"error",ltPropMessage:r.message,ltPropDuration:"3000",ltPropShow:!0}});else if(!validationUtils.isEmpty(r)||"findRecord"!==t&&"findAll"!==t){if(r&&void 0!==r.count)r.meta={count:r.count},r.users=[],delete r.count;else if(("findRecord"===t||"findAll"===t)&&window.clientPortalName&&!validationUtils.isEmpty(r))for(var o=Crm.userDetails.NAME_FORMAT.split(","),n=r.users.length,l=o.indexOf("First Name"),c=o.indexOf("Last Name"),d=0;d<n;d++){var u=r.users[d],m=u.last_name?u.last_name:u.first_name;m=l>c?(u.first_name?u.first_name:"")+" "+(u.last_name?u.last_name:""):(u.last_name?u.last_name:"")+" "+(u.first_name?u.first_name:""),r.users[d].full_name=m.trim()}}else r.users=[];var p=r.users;return p&&(p.constructor===Array?p.forEach(function(e){this.normalizeUserData(e)}.bind(this)):p.constructor===Object&&this.normalizeUserData(p)),r},payloadKey:function(){return this.varPayloadKey},normalize:function(e,t,r){if(!r||null!=r.image_link&&null!=r.image_link||(r.image_link=""),"findAll"===t){var i=r.territories,a=i?i.length:0;if(a)for(var s=0;s<a;s++)Object.keys(i[s]).includes("manager")&&delete i[s].manager}return r}}),store.registerModel("canvasview",{width:Lyte.attr("number"),canvas_status:Lyte.attr("number"),row_size:Lyte.attr("number"),name:Lyte.attr("string"),module:Lyte.attr("string"),layout_id:Lyte.attr("string"),thumbnail_id:Lyte.attr("string"),modifiedby_name:Lyte.attr("string"),modified_time:Lyte.attr("string"),modified_by:Lyte.attr("string"),id:Lyte.attr("string"),feature_name:Lyte.attr("string"),createdby_name:Lyte.attr("string"),created_time:Lyte.attr("string"),created_by:Lyte.attr("string"),components:Lyte.attr("array"),children:Lyte.attr("array"),ui:Lyte.attr("object"),autoSave:Lyte.attr("boolean"),action:Lyte.attr("string"),profiles:Lyte.attr("array",{default:[]}),removeProfiles:Lyte.attr("array",{default:[]}),canvas_rules:Lyte.attr("boolean",{default:!1}),type:Lyte.attr("string")}),store.registerAdapter("canvasview",{namespace:"crm/v2/customization",buildURL:function(e,t,r,i,a){return a=a.replace("canvasview","views"),"updateRecord"===t&&(a=a.slice(0,a.lastIndexOf("views")+"views".length)),a},methodForRequest:function(e){return"PATCH"==e?"PUT":e}}),store.registerSerializer("canvasview",{normalizeResponse:function(e,t,r){return"findAll"==t?(r.views=r.views.viewsJson,delete r.views.viewsJson):"updateRecord"===t?(r.id=r.views.details.id,delete r.views):"createRecord"===t?(r.views={id:r.views.details.id},delete r.canvasview):"update"===t&&(r.ids=r.views.details.ids,delete r.views),r},payloadKey:function(){return"views"},extractMeta:function(e){var t=e.info;return delete e.info,t},serialize:function(e,t){if("updateRecord"===e){var r=[],i=t.canvasview.id,a=(s=store.peekRecord("canvasview",i)).action;return s.$.set("action",""),o="rollback"===a?{id:s.id,module:s.module,feature_name:s.feature_name,action:"rollback"}:"save"===a?{id:s.id,name:s.name,ui:s.ui,width:s.width,row_size:s.row_size,feature_name:s.feature_name,components:s.components,module:s.module,layoutId:s.layoutId,autoSave:s.autoSave,type:s.type}:"rename"===a?{feature_name:s.feature_name,action:"rename",id:s.id,name:s.name,module:s.module}:"updateStatus"===a?{feature_name:s.feature_name,name:s.name,action:"updateStatus",id:s.id,canvas_status:s.canvas_status}:{layoutId:s.layout_id,canvasId:s.id,action:"setDefault",feature:s.feature_name,module:s.module},r.push(o),{views:r}}if("createRecord"===e){r=[];var s,o={name:(s=store.peekRecord("canvasview",t.canvasview.$.pK)).name,ui:s.ui,feature_name:s.feature_name,row_size:s.row_size,width:s.width,components:s.components,module:s.module,layoutId:s.layoutId,autoSave:s.autoSave,type:s.type,thumbnail_id:s.thumbnail_id};return t.canvasview.id&&(o.canvasId=t.canvasview.id),r.push(o),{views:r}}if("update"===e){r=[];for(var n,l=t.canvasview?t.canvasview.length:0,c=0;c<l;c++){n=t.canvasview[c].id;o={id:(s=store.peekRecord("canvasview",n)).id,feature_name:"DetailView",module:s.module,layoutId:s.layout_id,profiles:s.profiles,removeProfiles:s.removeProfiles,action:"canvasAssignment"};r.push(o)}return{views:r}}return t}}),store.registerModel("blueprint",{id:Lyte.attr("string"),name:Lyte.attr("string"),module:{id:Lyte.attr("string"),name:Lyte.attr("string")},layout:{id:Lyte.attr("string"),name:Lyte.attr("string")},field:{id:Lyte.attr("string"),name:Lyte.attr("string")},created_by:{id:Lyte.attr("string"),name:Lyte.attr("string")},modified_by:{id:Lyte.attr("string"),name:Lyte.attr("string")},created_time:Lyte.attr("string"),modified_time:Lyte.attr("string"),active:Lyte.attr("boolean")}),store.registerAdapter("blueprint",{namespace:"crm/v2.1/settings/",headersForRequest:function(){return{"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken,"X-CRM-ORG":crmZgid}}}),store.registerSerializer("blueprint",{payloadKey:function(){return"blueprints"}}),store.registerModel("custom_link",{id:Lyte.attr("string"),name:Lyte.attr("string"),modified_by:Lyte.attr("object"),modified_time:Lyte.attr("string"),profiles:Lyte.attr("array"),url:Lyte.attr("string"),url_encoding:Lyte.attr("string")}),store.registerAdapter("custom_link",{namespace:"crm/v2/settings"}),store.registerSerializer("custom_link",{serialize:function(e,t){return t.custom_links=[t.custom_links],t},normalizeResponse:function(e,t,r,i,a){return"updateRecord"==t&&200==a&&(r.custom_links={id:i}),(null===r||$u.isEmpty(r))&&(r={custom_links:[]}),r}}),Lyte.registerDataType("date",{extends:"string",serialize:function(e){var t=Utils.isValidDate("yyyy-mm-dd",e);if(e)return t?e:e&&"string"==typeof e&&e.trim()?apiDateFormat(e):""},deserialize:function(e){if(e&&Utils.isValidDate("yyyy-mm-dd",e)){e=e.replace(/[+-]\d{2}:\d{2}/,"");var t=Lyte.registeredMixins["crux-element-validation"],r=/^(.*)T/.exec(e);r&&(e=r[1]);var i=t.getDateInUserDatePattern(t.getDateObjectFromString(e,"YYYY-MM-DD"),Crm.userDetails.DATE_PATTERN);if(i){var a=i.slice(0,3);return i.replace(a,I18n.getMsg(a))}}return e}}),Lyte.registerDataType("datetime",{extends:"string",serialize:function(e){if(e&&"canvas"===Lyte.Router.getRouteInstance().routeName&&e.indexOf("T")<0)return apiDateTimeFormat(e);if(e){var t=e.replace(/[+-]\d{2}:\d{2}/,"");if(e==Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(new Date(t)))return e;var r=e.split("TV");e=r.length>1?r[0]+" "+r[1]:e;var i=-1!=["dd.mm.yyyy.","yyyy. mm. dd","yyyy.mm.dd","yyyy'年'mm'月'dd'日'"].indexOf(Crm.userDetails.DATE_PATTERN.toLowerCase()),a=Utils.convertUsrtoDefaultDatePattern(r[0],i);if(a&&r[1]){var s=Lyte.registeredMixins["crm-date-datetime-mixin"].getfinalTimeObjectfromTime(r[1]);validationUtils.isNotEmpty(s)&&(a.setHours(s.hrs),a.setMinutes(s.mins))}return Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(a)}},deserialize:function(e){if(e&&"string"==typeof e&&e.match("T")){var t=(e=e.replace(/[+-]\d{2}:\d{2}/,"")).split("-"),r=new Date(t[0],t[1]-1,t[2].split("T")[0]),i=(e=e.split("T"))[1]?e[1].split(":"):"";i&&(r.setHours(i[0]),r.setMinutes(i[1]));var a=Utils.getDateTimeInUserFormat(r,!0),s=a.slice(0,3);return a.replace(s,I18n.getMsg(s))}return e}}),Lyte.registerDataType("datetimeorg",{extends:"string",serialize:function(e){if(e){var t=e.replace(/[+-]\d{2}:\d{2}/,"");if(e==Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(new Date(t)))return e;var r=e.split("TV");e=r.length>1?r[0]+" "+r[1]:e;var i=-1!=["dd.mm.yyyy.","yyyy. mm. dd","yyyy.mm.dd","yyyy'年'mm'月'dd'日'"].indexOf(Crm.userDetails.DATE_PATTERN.toLowerCase()),a=Utils.convertUsrtoDefaultDatePattern(r[0],i);if(r[1]){var s=Lyte.registeredMixins["crm-date-datetime-mixin"].getfinalTimeObjectfromTime(r[1]);validationUtils.isNotEmpty(s)&&(a.setHours(s.hrs),a.setMinutes(s.mins))}return Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(a)}},deserialize:function(e){return e&&"string"==typeof e&&e.match("T")?new CrmDate(new Date(e),!0).getDateTimeInUserPattern():e}}),Lyte.registerDataType("multi-picklist",{extends:"string",deserialize:function(e){return e&&"string"!=typeof e&&(e=null!=e[0]&&"string"==typeof e[0]?e.join("; "):e.map((function(e){return e.value})).join("; ")),e},serialize:function(e){return"canvas"===Lyte.Router.getRouteInstance().routeName?e=e.split("; "):e&&"string"==typeof e?JSON.parse(e):e}}),Lyte.registerDataType("tax",{extends:"string",deserialize:function(e){var t="",r=e.length;if(e&&r){for(var i=0;i<r;i++)e[i].value&&(t+=e[i].value+";");return t=t.substring(0,t.length-1)}}}),Lyte.registerDataType("territory",{extends:"array",deserialize:function(e){return e}}),Lyte.registerDataType("phone",{extends:"string",deserialize:function(e){var t=e;return"en_US"==Crm.userDetails.COUNTRY_LOCALE&&t.match(/[0-9]/)&&(t="(",10==e.length?t+=e.substring(0,3)+") "+e.substring(3,6)+"-"+e.substring(6,10):9==e.length?t+=e.substring(0,5)+")-"+e.substring(5,9):t=e),t},serialize:function(e){return e?e.replace(/[\u202c]/g,""):e}}),Lyte.registerDataType("user-view-date-time",{extends:"string",deserialize:function(e){if(e){e=e.replace(/[+-]\d{2}:\d{2}/,"");var t=new Date(e),r=(e=e.split("T"))[1].split(":");t.setHours(r[0]),t.setMinutes(r[1]);var i=t,a=Utils.getDateInUsrViewFormat(i),s=(a+=" "+Utils.getTimeInUserFormat(i,!0)).slice(0,3);return a.replace(s,I18n.getMsg(s))}return e}}),Lyte.registerDataType("time-in-minutes",{extends:"string",deserialize:function(e){if(e)return Utils.convertTimeInDoubleToReadableForm(e)}}),Lyte.registerDataType("time-in-hrs",{extends:"string",deserialize:function(e){if(e)return Utils.convertTimeInDoubleToReadableForm(e,"hr")}}),Lyte.registerDataType("millisec-to-time",{extends:"string",deserialize:function(e){if(e)return Utils.getTimefromMillisecs(e)}}),Lyte.registerDataType("exchange-rate",{extends:"string",deserialize:function(e){if(e)return Number(e).toFixed(9)}}),Lyte.registerDataType("expected-revenue",{extends:"string",deserialize:function(e){if(e)return e+""}}),Lyte.registerDataType("multi-user",{extends:"object",deserialize:function(e){if(e)return e.length?{users:e}:void 0},serialize:function(e){return e?e.users:e}}),Lyte.Security.ignoreSanitizer=!0,Lyte.Router.configureDefaults({history:"html5",deferInit:!0,queryParamOptions:{sticky:!1}}),Lyte.setConfig("stateHandling",!0),app.crmNamespace="/crm",void 0!==window.clientPortalName&&window.clientPortalName?app.crmNamespace="/portal/"+window.clientPortalName+"/crm":crmPortal&&(app.crmNamespace+="/"+crmPortal),Lyte.Router.configureRoutes((function(){this.route("crm",{path:app.crmNamespace},(function(){this.route("crm-mobile-intermediatepage",{path:"/mobilepage"}),this.route("tab",(function(){this.route("forms"),this.route("projects",{path:"/Projects"}),this.route("marketplace",{path:"/Marketplace"}),this.route("google-adwords",{path:"/Google AdWords"},(function(){this.route("adword-accounts",{path:"/account-summary"}),this.route("adword-view",{path:"/account-summary/view"}),this.route("adword-offline",{path:"/offline"}),this.route("adword-metrics",{path:"/reports"})})),newForecastsEnabled?this.route("newForecasts",{path:"/Forecasts"},(function(){this.route("index",{path:"/"}),this.route("list",{path:"/list"}),this.route("bread-crum",{path:"/breadcrum"}),this.route("create"),this.route("view",{path:"/:id"}),this.route("edit",{path:"/:id/edit"}),this.route("clone",{path:"/:id/clone"})})):this.route("forecasts",{path:"/Forecasts"},(function(){this.route("index",{path:"/"}),this.route("create"),this.route("editSettings"),this.route("pipeline")})),"undefined"!=typeof newReportsEnabled&&newReportsEnabled?this.route("newReports",{path:"/Reports"},(function(){this.route("index",{path:"/"},(function(){this.route("list"),this.route("schedule",(function(){this.route("list",{path:"/"})}))})),this.route("schedule-create",{path:"/schedule/create"}),this.route("schedule-edit",{path:"/schedule/:id/edit"}),this.route("create"),this.route("edit",{path:"/:id/edit"}),this.route("view",{path:"/:id"}),this.route("clone",{path:"/:id/clone"}),this.route("records",{path:"/:id/records"})})):this.route("reports",{path:"/Reports"},(function(){this.route("index",{path:"/"}),this.route("create"),this.route("edit",{path:"/:id/edit"}),this.route("view",{path:"/:id"}),this.route("records",{path:"/:id/records"}),this.route("redirect-to-index",{path:"/schedule/create"}),this.route("redirect-to-index",{path:"/schedule/:id/edit"})})),this.route("messages",{path:"/Messages"},(function(){this.route("begin",{path:"/begin"}),this.route("custom-view",{path:"/custom-view/:cv_id"},(function(){this.route("list")})),this.route("view",{path:"/:id"})})),this.route("dashboards",{path:"/Dashboards"},(function(){this.route("index",{path:"/"}),this.route("view",{path:"/:id"},(function(){this.route("expand")})),this.route("dashboardId",{path:"/:id/components"},(function(){this.route("records",{path:"/:id/records"})}))})),this.route("approvals",{path:"/Approvals"},(function(){this.route("index",{path:"/"}),this.route("logs"),this.route("view")})),this.route("module",{path:"/:moduleId"},(function(){this.route("index-module",{path:"/"}),this.route("begin"),this.route("create"),this.route("quick-create"),this.route("modal-create"),this.route("associate-search"),this.route("fields-value-collector"),this.route("promo"),this.route("actions",(function(){this.route("approvals"),this.route("mass-tools"),this.route("deduplicate",(function(){this.route("index-deduplicate",{path:"/"}),this.route("list-conflicts"),this.route("merge"),this.route("show-duplicates")})),this.route("generate-po"),this.route("add-to-campaigns"),this.route("draft")})),this.route("custom-view",{path:"/custom-view/:cv_id"},(function(){this.route("list"),this.route("kanban"),this.route("zia"),this.route("canvas",{path:"/canvas/:viewid"})})),this.route("entity",{path:"/:entity_id"},(function(){this.route("detail",{path:"/"}),this.route("canvas",{path:"/canvas/:canvasId"}),this.route("edit"),this.route("clone"),this.route("convert"),this.route("find-and-merge"),this.route("add-contact-role"),this.route("edit-contact-role")}))})),this.route("zohocpq",{path:"/:productName"},(function(){this.route("index-zohocpq",{path:"/"}),this.route("configurator-create",{path:"/create"}),this.route("configurator-edit",{path:"/:recordId/edit"})})),this.route("voc",(function(){this.route("analytics",(function(){this.route("view",{path:"/:analytics_id"})}))}))})),this.route("settings",(function(){this.route("index"),this.route("editor"),this.route("import"),this.route("migration",(function(){this.route("index",{path:"/:migration_id"},(function(){this.route("extract-data"),this.route("map-modules"),this.route("map-fields"),this.route("report-and-review"),this.route("complete"),this.route("file-upload")})),this.route("api-login")})),this.route("create-home-customization",{path:"/home-customization/create"}),this.route("edit-home-customization",{path:"/home-customization/:id/edit"}),this.route("clone-home-customization",{path:"/home-customization/:id/clone"}),this.route("section",{path:"/"},(function(){this.route("users",(function(){this.route("view",{path:"/:user_id"})})),this.route("widget",{path:"/widget/:widget_id"}),this.route("manage-tags"),this.route("data-migration"),this.route("import-history"),this.route("export-data"),this.route("data-backup"),this.route("telephony",(function(){this.route("configuration",{path:"/:providerName/configuration"}),this.route("marketplace"),this.route("summary",{path:"/:providerName/summary"}),this.route("phonebridgegroup",{path:"/:providerName/phonebridgegroup"},(function(){this.route("createpbxgroup",{path:"/create"}),this.route("editpbxgroup",{path:"/:groupId/edit"}),this.route("viewpbxgroup",{path:"/:groupId"})}))})),this.route("wizard",(function(){this.route("index-wizard",{path:"/"}),this.route("view-wizard",{path:"/:wizardId"}),this.route("create-wizard",{path:"/create"})})),this.route("widget-telephony",{path:"/widget-telephony"},(function(){this.route("marketplace",{path:"/marketplace"}),this.route("configuration",{path:"/:providerName/configuration"}),this.route("summary",{path:"/:providerName/summary"})})),this.route("segmentation",(function(){this.route("index"),this.route("create"),this.route("edit",{path:"/:segmentId/edit"})})),this.route("workflow-rules",(function(){this.route("index-workflow-rule",{path:"/"}),this.route("summary-workflow-rules",{path:"/show-summary"}),this.route("create-workflow-rule",{path:"/create"}),this.route("view-workflow-rule",{path:"/:ruleId"})})),this.route("workflow-insights"),this.route("approval-process",(function(){this.route("index-approval-process",{path:"/"}),this.route("create-approval-process",{path:"/create"}),this.route("view-approval-process",{path:"/:processId"})})),this.route("blueprint-usage"),this.route("blueprint-setting"),this.route("blueprint",(function(){this.route("index-blueprint",{path:"/"}),this.route("create-blueprint",{path:"/create"}),this.route("view-blueprint",{path:"/:processId"})})),this.route("assignment-rule",{path:"/assignment-rules"},(function(){this.route("index-assignment-rule",{path:"/"}),this.route("create-assignment-rule",{path:"/:ruleId/entries"}),this.route("view-assignment-rule",{path:"/:ruleId"})})),this.route("zia-reasoning"),this.route("assignment-thresholds",{path:"/assignment-thresholds"},(function(){this.route("index-assignment-thresholds",{path:"/"}),this.route("create-assignment-thresholds",{path:"/create"}),this.route("edit-assignment-thresholds",{path:"/:restrictionId"})})),this.route("extensions",(function(){this.route("all-extensions",{path:"/all"},(function(){this.route("slack"),this.route("sales-navigator",{path:"/salesnavigator"}),this.route("meeting-integration"),this.route("dynamicExtn",{path:"/:namespace"}),this.route("cisco-teams",{path:"/ciscoteams"})})),this.route("zoho-extensions",{path:"/zoho"},(function(){this.route("zoho-apps",{path:"/apps"}),this.route("visit"),this.route("survey"),this.route("desk"),this.route("reports"),this.route("zanalytics"),this.route("writer"),this.route("motivator"),this.route("creator"),this.route("circuits",(function(){this.route("circuitswelcome",{path:"/welcome"}),this.route("main",{path:"/"},(function(){this.route("myCircuits",{path:"myCircuits"}),this.route("executionLog",{path:"executionLogs"})}))})),this.route("finance-suite"),this.route("projects"),this.route("cliq"),this.route("showtime"),this.route("webinar",{path:"/webinar"}),this.route("meeting"),this.route("campaigns",(function(){this.route("campaigns-field-mapping"),this.route("crm-to-campaign-settings"),this.route("syncs")})),this.route("forms"),this.route("backstage"),this.route("crossorg",{path:"/:service/crossorg"}),this.route("remote-sales-office",(function(){this.route("information"),this.route("users")})),this.route("pagesense"),this.route("assist"),this.route("contracts")})),this.route("google-extensions",{path:"/google"},(function(){this.route("google-contacts",{path:"/contacts"}),this.route("google-calendars",{path:"/calendar"}),this.route("google-apps",{path:"/:appName"})})),this.route("ms-extensions",{path:"/microsoft"},(function(){this.route("ms-word",{path:"/word"}),this.route("ms-outlook",{path:"/outlook"}),this.route("ms-office",{path:"/office-365"})})),this.route("social-extensions",{path:"/social"},(function(){this.route("social-lead-gen",{path:"/lead-gen"}),this.route("social-brands",{path:"/brands"},(function(){this.route("index-brands",{path:"/"})})),this.route("social-admin-settings",{path:"/admin-settings"},(function(){this.route("index-permissions",{path:"/"})})),this.route("social",{path:"/:appName"})})),this.route("skyeye")})),this.route("sales-signals",{path:"/sales-signals"},(function(){this.route("index-sales-signals",{path:"/"}),this.route("manage-sales-signals",{path:"/manage"})})),this.route("client-portal",(function(){this.route("begin-portal",{path:"/begin"}),this.route("create-portal",{path:"/create"}),this.route("user-types",(function(){this.route("create-user-type",{path:"/create"}),this.route("summary",{path:"/:userTypeId"}),this.route("edit",{path:"/:userTypeId/edit"}),this.route("users",{path:"/:userTypeId/users"})}))})),this.route("messages",{path:"/messages"},(function(){this.route("services",{path:"/services"}),this.route("channels",{path:"/channels"}),this.route("templates",{path:"/templates"})})),this.route("schedules"),this.route("web-tabs",{path:"/web-tabs"},(function(){this.route("index-webtabs",{path:"/"}),this.route("create-webtabs",{path:"/create"}),this.route("edit-webtabs",{path:"/:webtabsId/edit"})})),this.route("email-settings"),this.route("email-sharing"),this.route("email-compose-settings"),this.route("email-sharing-preference"),this.route("email-preference"),this.route("email-configuration",{path:"/email-configuration"},(function(){this.route("email-compose-settings"),this.route("email-settings",(function(){this.route("email-index",{path:"/"}),this.route("email-create",{path:"/create"})})),this.route("email-sharing",{path:"/email-sharing"},(function(){this.route("email-sharing-preference",{path:"/email-sharing-preference"})})),this.route("organization-emails"),this.route("email-preference")})),this.route("email-intelligence",{path:"/email-intelligence"},(function(){this.route("email-insights"),this.route("sentiment-model")})),this.route("email-deliverability",{path:"/email-deliverability"},(function(){this.route("email-auth"),this.route("email-relay")})),this.route("email-parser",(function(){this.route("index-email-parser",{path:"/"}),this.route("create-email-parser",{path:"/create"}),this.route("edit-email-parser",{path:"/:ruleId"})})),this.route("email-auth"),this.route("bcc-dropbox"),this.route("email-insights"),this.route("email-relay"),this.route("api-settings",{path:"/api"}),this.route("api-graph-view",{path:"/api/usage/graph-view"}),this.route("api-table-view",{path:"/api/usage/table-view"}),this.route("api-paid",{path:"/api/paid"}),this.route("api-modules",{path:"/api/modules"}),this.route("api-module-detail",{path:"/api/modules/:moduleName"}),this.route("zsc-key"),this.route("personal-settings"),this.route("workflow-alerts",(function(){this.route("index-workflow-alert",{path:"/"}),this.route("create-workflow-alert",{path:"/create"}),this.route("edit-workflow-alert",{path:"/:alertId/edit"}),this.route("view-workflow-alert",{path:"/:alertId"})})),this.route("workflow-tasks",(function(){this.route("index-workflow-task",{path:"/"}),this.route("create-workflow-task",{path:"/create"}),this.route("edit-workflow-task",{path:"/:taskId/edit"}),this.route("view-workflow-task",{path:"/:taskId"})})),this.route("workflow-field-updates",(function(){this.route("index-workflow-field-update",{path:"/"}),this.route("create-workflow-field-update",{path:"/create"}),this.route("edit-workflow-field-update",{path:"/:id/edit"}),this.route("view-workflow-field-update",{path:"/:id"})})),this.route("workflow-webhooks",(function(){this.route("index-workflow-webhook",{path:"/"}),this.route("create-workflow-webhook",{path:"/create"}),this.route("edit-workflow-webhook",{path:"/:webhookId/edit"}),this.route("view-workflow-webhook",{path:"/:webhookId"})})),this.route("workflow-deluge"),this.route("case-escalation-rule",{path:"/escalation-rules"},(function(){this.route("index-case-escalation-rule",{path:"/"}),this.route("view-case-escalation-rule",{path:"/:ruleId"})})),this.route("webform",(function(){this.route("index-webform",{path:"/"}),this.route("create-webform",{path:"/create"}),this.route("edit-webform",{path:"/:id/edit"}),this.route("clone-webform",{path:"/:id/clone"}),this.route("view-webform",{path:"/:id"},(function(){this.route("preview-webform",{path:"/preview"}),this.route("webform-analytics",{path:"/analytics/:id"})})),this.route("module-analytics",{path:"/analytics/:dashboardid"})})),this.route("abtesting",(function(){this.route("index-abtesting",{path:"/"}),this.route("create-abtesting",{path:"/create"}),this.route("edit-abtesting",{path:"/:id/edit"}),this.route("view-abtesting",{path:"/:id"},(function(){this.route("preview-abtesting",{path:"/preview"}),this.route("analytics-abtesting",{path:"/analytics/:id"})}))})),this.route("mobile-apps",(function(){this.route("mobileapps-index",{path:"/"}),this.route("mobileapp-upload",{path:"/upload"}),this.route("mobile-app",{path:"/:appId"},(function(){this.route("mobileapp-view",{path:"/"}),this.route("mobileapp-share",{path:"/share"})}))})),this.route("mobile-users"),this.route("web-apps",(function(){this.route("webapps-index",{path:"/"}),this.route("webapp-details",{path:"/:id"}),this.route("webapp-upload",{path:"/upload"})})),this.route("sdks"),this.route("auto-response-rules",(function(){this.route("index-auto-response-rules",{path:"/"})})),this.route("unsubscribe-form"),this.route("unsubscribe-link",(function(){this.route("create-unsubscribe-link",{path:"/create"})})),this.route("crm-variables",{path:"/crmvariables"},(function(){this.route("index-crm-variable",{path:"/"}),this.route("create-crm-variable",{path:"/create"}),this.route("edit-crm-variable",{path:"/:id"})})),this.route("company-details",(function(){this.route("view-shift-hours",{path:"/:shift_id"})})),this.route("booking",{path:"/booking"},(function(){this.route("create-booking",{path:"/create"}),this.route("edit-booking",{path:"/:booking_id/edit"}),this.route("clone-booking",{path:"/:booking_id/clone"}),this.route("index",{path:"/"})})),this.route("fiscal-year"),this.route("business-hours",(function(){this.route("index",{path:"/"}),this.route("create-shift-hours",{path:"/createShiftHours"}),this.route("view-shift-hours",{path:"/:shift_id"}),this.route("edit-shift-hours",{path:"/:shift_id/edit"})})),this.route("holidays"),this.route("currencies"),this.route("hierarchy-preference"),this.route("crm-templates",{path:"/templates"}),this.route("groups",(function(){this.route("index-groups",{path:"/"}),this.route("create-group",{path:"/create"}),this.route("view-group",{path:"/:group_id"}),this.route("edit-group",{path:"/:group_id/edit"})})),this.route("activate-users"),this.route("profiles",(function(){this.route("index-profiles",{path:"/"}),this.route("view-profile",{path:"/:profileId"})})),this.route("roles",{path:"/roles"},(function(){this.route("index-roles",{path:"/"}),this.route("create-role",{path:"/create"}),this.route("view-role",{path:"/:roleId"}),this.route("edit-role",{path:"/:roleId/edit"}),this.route("delete-role",{path:"/:roleId/delete"})})),this.route("data-sharing",(function(){this.route("index-data-sharing",{path:"/"}),this.route("edit-default-data-sharing",{path:"/edit"}),this.route("create-data-sharing",{path:"/create"}),this.route("edit-data-sharing",{path:"/:id/edit"})})),this.route("zmail-users"),this.route("custom-view",(function(){this.route("create-custom-view",{path:"/create"}),this.route("cvid",{path:"/:cv_id/"},(function(){this.route("clone-custom-view",{path:"/clone"}),this.route("edit-custom-view",{path:"/edit"})}))})),this.route("modules",(function(){this.route("index-modules",{path:"/"},(function(){this.route("create-module",{path:"/create"})})),this.route("module",{path:"/:moduleName"},(function(){this.route("canvas",{path:"/layouts/:layoutId/canvas"},(function(){this.route("create"),this.route("edit",{path:"/:viewid/edit"}),this.route("clone",{path:"/:viewid/clone"})})),this.route("layouts",(function(){this.route("index-layouts",{path:"/"}),this.route("view-layout",{path:"/:layoutId"}),this.route("clone-layout",{path:"/:layoutId/clone"})})),this.route("jobsheet-layouts"),this.route("layout-rules",{path:"/layout-rules"},(function(){this.route("index-layout-rules",{path:"/"}),this.route("view-layout-rule",{path:"/:layoutRuleId"})})),this.route("validation-rules",{path:"/validation-rules"},(function(){this.route("index-validation-rules",{path:"/"}),this.route("view-validation-rule",{path:"/:validationRuleId"})})),this.route("preferences-module",{path:"/preferences"}),this.route("summary-module",{path:"/summary"}),this.route("field-listing"),this.route("field-permissions"),this.route("links-and-buttons",(function(){this.route("index-links-and-buttons",{path:"/"}),this.route("create-links-and-buttons",{path:"/create"}),this.route("edit-links-and-buttons",{path:"/:buttonId"})})),this.route("map-dependency",(function(){this.route("index-map-dependency",{path:"/"}),this.route("create-map-dependency",{path:"/create"}),this.route("edit-map-dependency",{path:"/:uid"})})),this.route("conversion-mapping"),this.route("field-privacy")}))})),this.route("pipelines"),this.route("schedule-mass-email"),this.route("autoresponders",{path:"/auto-responders"},(function(){this.route("index-autoresponder",{path:"/"}),this.route("create-autoresponder",{path:"/create"}),this.route("edit-autoresponder",{path:"/:id/edit"}),this.route("view-autoresponder",{path:"/:id"}),this.route("create-folder",{path:"/folder/create"}),this.route("edit-folder",{path:"/folder/:id"})})),this.route("manage-mass-mail",{path:"/manage-mass-mail"},(function(){this.route("index-mass-mail",{path:"/"}),this.route("create-mass-mail",{path:"/create"}),this.route("edit-mass-mail",{path:"/:id/edit"}),this.route("view-mass-mail",{path:"/:id"})})),this.route("storage"),this.route("recyclebin"),this.route("auditlog"),this.route("admincenter",{path:"/admintools"},(function(){this.route("index-admincenter",{path:"/"}),this.route("admincenter-history",{path:"/history"}),this.route("admincenter-deletiontool",{path:"/deletiontool"}),this.route("admincenter-tools",{path:"/tools"})})),this.route("remove-sample-data"),this.route("sandbox",(function(){this.route("sandbox-list",{path:"/"}),this.route("sandbox-detail",{path:"/:id"}),this.route("sandbox-deployment-logs",{path:"/deployments-logs"})})),this.route("copy-customization"),this.route("home-customization",(function(){this.route("index-home-customization",{path:"/"})})),this.route("translation-settings"),this.route("translation-history"),"undefined"!=typeof isMultiScoreAvail&&isMultiScoreAvail?this.route("scoring-rules",(function(){this.route("index-scoring-rule",{path:"/"}),this.route("create-scoring-rule",{path:"/create/:moduleName"}),this.route("edit-scoring-rule",{path:"/:ruleId"}),this.route("clone-scoring-rule",{path:"/:ruleId/clone"})})):this.route("scoring-rules"),this.route("phonebridge-token"),this.route("phonebridge-platform"),this.route("tab-groups"),this.route("allowed-ips",(function(){this.route("index-allowed-ips",{path:"/"}),this.route("create-allowed-ips",{path:"/create"}),this.route("edit-allowed-ips",{path:"/:authDomainId"})})),this.route("crm-widgets",{path:"/widgets"}),this.route("crm-cscript",{path:"/cscript"}),this.route("crm-static-resource",{path:"/static-resource"}),this.route("crm-trusted-domain",{path:"/trusted-domain"}),this.route("functions",(function(){this.route("myFunctions",{path:"/myFunctions"}),this.route("functionsdashboard",{path:"/dashboard"}),this.route("functionsfailures",{path:"/failures"}),this.route("functionsgallery",{path:"/gallery"}),this.route("functionscredits",{path:"/credits"})})),this.route("connections"),this.route("territories",(function(){this.route("index-territories",{path:"/"}),this.route("create-territory",{path:"/create"}),this.route("edit-territory",{path:"/:territoryId/edit"})})),this.route("territory-rules"),this.route("territory-assign"),this.route("organization-emails"),this.route("game-settings"),this.route("macro",(function(){this.route("index",{path:"/"}),this.route("create"),this.route("view",{path:"/:id"}),this.route("edit",{path:"/:id/edit"})})),this.route("zia",(function(){this.route("admin-panel"),this.route("untitlerecommendation"),this.route("similarity",(function(){this.route("list",{path:"/list"}),this.route("create",{path:"/create"}),this.route("view",{path:"/:id"}),this.route("edit",{path:"/:id/edit"}),this.route("error",{path:"/error"})})),this.route("recommendation",(function(){this.route("create",{path:"/create"}),this.route("index",{path:"/list"}),this.route("edit",{path:"/:id/edit"}),this.route("view",{path:"/:id"}),this.route("error",{path:"/error"}),this.route("gallery",{path:"/gallery"})})),this.route("recommendation-analytics",(function(){this.route("view",{path:"/:id"}),this.route("error",{path:"/error"})})),this.route("reminder",{path:"/reminder"}),this.route("inemailnew",{path:"/inemailnew"}),this.route("besttime",(function(){this.route("analytics",{path:"/analytics"})})),this.route("autosuggestion",{path:"/autosuggestion"}),this.route("notification",(function(){this.route("recommendation",{path:"/recommendation"})})),this.route("anomaly"),this.route("ziaforemail"),this.route("sentiment-model"),this.route("zia-voice",(function(){this.route("index",{path:"/"}),this.route("view",{path:"/:id"}),this.route("create",{path:"/create"}),this.route("edit",{path:"/:id/edit"})})),this.route("prediction",(function(){this.route("create"),this.route("view",{path:"/:id"}),this.route("edit",{path:"/:id/edit"}),this.route("defaultprediction",{path:"/default"}),this.route("index",{path:"/"})})),this.route("prediction-analytics"),this.route("vision",(function(){this.route("create",{path:"/create"}),this.route("view",{path:"/:id"}),this.route("edit",{path:"/:id/edit"}),this.route("index",{path:"/"}),this.route("image-validate",{path:"/validate/:id"})}))})),this.route("voice-of-customer"),this.route("inventory-management"),this.route("data-enrichment",{path:"/data-enrichment"},(function(){this.route("index-data-enrichment",{path:"/"}),this.route("view-data-enrichment",{path:"/:id/"})})),this.route("settings-wildcard",{path:"/*wildcard"}),this.route("section-error",{path:"/*error-page-url"}),this.route("compliance",(function(){this.route("consent-dashboard",(function(){this.route("list-view")})),this.route("privacy-preference"),this.route("consent-form"),this.route("hipaa")})),this.route("review-process",(function(){this.route("index-review-process",{path:"/"}),this.route("create-review-process",{path:"/create/:module"}),this.route("edit-review-process",{path:"/:id"})})),this.route("review-usage",(function(){this.route("index-review-usage",{path:"/"}),this.route("view-review-usage",{path:"/view/:dashboardid"})})),this.route("attributions",{path:"/attributions"}),this.route("index",{path:"/index"}),this.route("orchestration",{path:"/commandcenter"},(function(){this.route("index-orchestration",{path:"/"}),this.route("edit-orchestration",{path:"/:id"}),this.route("orchestration-reports",{path:"/:id/reports"})})),this.route("canvas-builder",(function(){this.route("listview"),this.route("detailview"),this.route("canvasrules")})),this.route("competitor-alerts",(function(){this.route("competitor-alerts-index",{path:"/"}),this.route("competitor-alert-create",{path:"/create"}),this.route("competitor-alert-record",{path:"/:alertId"},(function(){this.route("competitor-alert-view",{path:"/"}),this.route("competitor-alert-edit",{path:"/edit"})}))})),this.route("zohocpq",{path:"zohocpq/:configurationName"},(function(){this.route("index-zohocpq",{path:"/"}),this.route("configurator-create",{path:"/create"}),this.route("configurator-edit",{path:"/:recordId/edit"})}))})),this.route("canvas",(function(){this.route("begin"),this.route("gallery",(function(){this.route("list"),this.route("mapping",{path:"/:galleryid"})})),this.route("create",{path:"/create"}),this.route("manage"),this.route("clone",{path:"/:viewid/clone"}),this.route("edit",{path:"/:viewid/edit"})}))})),this.route("crm-calendar",{path:"/calendar"}),this.route("global-search",{path:"/search"}),this.route("wildcard",{path:"/*wildcard"}),this.route("crm-error",{path:"/*error-page-url"}),this.route("emailAdminTool"),this.route("deletionAdminTool"),this.route("offlineBackupAdminTool"),this.route("dcMigrationAdminTool"),this.route("cpqadmintool"),this.route("exportAuditLogAdminTool"),this.route("gamification",{path:"/gamification"},(function(){this.route("rules",{path:"/rules"},(function(){this.route("list",{path:"/list"}),this.route("dashboards",{path:"/:id"}),this.route("index",{path:"/"})})),this.route("team",{path:"/team"}),this.route("game",{path:"/game"},(function(){this.route("index",{path:"/"}),this.route("scoreboard",{path:"/:game_id/scoreboard"}),this.route("point-summary",{path:"/:game_id/point_summary"})})),this.route("dashboards",{path:"/dashboards"},(function(){this.route("index",{path:"/"})})),this.route("achievements",{path:"/achievements"}),this.route("targets",{path:"/targets"},(function(){this.route("dashboard",{path:"/:id"}),this.route("index",{path:"/"}),this.route("list")})),this.route("tvchannel",{path:"/tvchannel"},(function(){this.route("slides",{path:"/slides"}),this.route("index",{path:"/"}),this.route("live",{path:"/live"})})),this.route("home",{path:"/home"})}))})),this.route("crm-print",{path:app.crmNamespace+"/tab/:moduleId"},(function(){this.route("export-pdf",{path:"/:entity_id/export-pdf"}),this.route("send-mail",{path:"/:entity_id/send-mail"})})),this.route("zia-voice"),this.route("review-usage"),this.route("crossorg",{path:"crm/settings/section/extensions/zoho-extensions"}),this.route("gamification",{path:"/gamification"},(function(){this.route("rules",{path:"/rules"})}))})),Lyte.addEventListener("onBeforeInject",(function(e){var t=e.tag;"SCRIPT"==t.tagName&&app.crossOriginEnabled&&t.getAttribute("src").includes("/crm/")&&t.setAttribute("crossorigin",app.crossOriginEnabled)})),Lyte.addEventListener("beforeTemplateDestroy",(function(e){var t=e.outlet;thirdPartyUtils.unbindChildEvents(t),!Lyte.Router.getRouteInstance().transition.preservePopup&&$("#profilePageCOBForm").length<1&&(removeFreezeLayer(),hideFreezeLayer())})),Lyte.Router.beforeRouteTransition=function(e,t,r){if(Crm.userDetails.isNewEditor&&"undefined"!=typeof EmailSendingUtil&&EmailSendingUtil.composeActive){var i=document.getElementsByTagName("crm-emailrelatedlist-attachment")[0];i&&i.component&&i.component.setData("showRelPop",!1),EmailCompose.etMinimiseCompose(),EmailComposeUtil.hideAllComposeRelatedPopup()}if(CScriptLib){var a=document.querySelectorAll("crm-cscript-create")[0];if(a&&(!0===a.getData("scr_editor_available")||!0===a.getData("show_create_popup")))return a.component.flush_all(a.getData("scr_editor_available")),t.abort(),void history.go(1);crmHistory.loaded&&CScriptLib&&_cscript&&_cscript._preview&&window.parent.document.dispatchEvent(new CustomEvent("CSCRIPT_PREVIEW",{detail:{type:"route_change"}})),CScript.Engine.Destroy()}if(e&&e.info&&e.info.route&&e.info.dynamicParams&&"crm.settings.section.zohocpq.configurator-create"===e.info.route&&("priceRules"===e.info.dynamicParams[0]||"productConfigurator"===e.info.dynamicParams[0])&&t&&t.info&&t.info.route&&"crm.settings.section.zohocpq.index-zohocpq"===t.info.route&&r&&r.fromHistory&&("back"===r.fromHistory||"reload"===r.fromHistory)){t.abort();var s="crm-cpqpricerulecontainer",o="showErrorPopupFromRouteJs";return"productConfigurator"===e.info.dynamicParams[0]&&(s="crm-productconfigurator-header",o="showCancelPopupForOtherTransitions"),void $L(s)[0].component.executeMethod(o)}if(e&&e.info&&e.info.route&&e.info.dynamicParams&&"crm.settings.section.zohocpq.configurator-edit"===e.info.route&&("priceRules"===e.info.dynamicParams[0]||"productConfigurator"===e.info.dynamicParams[0])&&t&&t.info&&t.info.route&&"crm.settings.section.zohocpq.index-zohocpq"===t.info.route&&r&&r.fromHistory&&("back"===r.fromHistory||"reload"===r.fromHistory)){s="crm-cpqpriceruleheader",o="showErrorPopupFromRouteJs";if("productConfigurator"===e.info.dynamicParams[0]&&(s="crm-productconfigurator-header",o="showCancelPopupForOtherTransitions"),$L(s)[0].component.executeMethod("checkChangesForOtherTransitions"))return t.abort(),"priceRules"===e.info.dynamicParams[0]&&(s="crm-cpqpricerulecontainer"),void $L(s)[0].component.executeMethod(o)}else e&&e.info&&e.info.route&&"crm.settings.section.zohocpq.index-zohocpq"===e.info.route&&t&&t.info&&t.info.route&&t.info.dynamicParams&&"crm.settings.section.zohocpq.configurator-create"===t.info.route&&("priceRules"===t.info.dynamicParams[0]||"productConfigurator"===t.info.dynamicParams[0])&&r&&r.fromHistory&&("back"===r.fromHistory||"reload"===r.fromHistory)&&(t.abort(),"priceRules"===t.info.dynamicParams[0]?Lyte.Router.transitionTo("crm.settings.section.zohocpq.index-zohocpq","priceRules").data={redirect:!0}:Lyte.Router.transitionTo("crm.settings.section.zohocpq.index-zohocpq","productConfigurator").data={redirect:!0});var n=$L("crm-entity-lookup")[0];if(void 0!==n&&n.component.actions.checkBrowserBack(),app.prevTransition=e?e.info:{},app.nextTransition=t,Crm.userDetails.isNewEditor&&"undefined"!=typeof EmailSendingUtil&&EmailSendingUtil.composeActive){var l=$L("#ecwDraftPop")[0];l&&l.ltProp("show",!1),EmailCompose.etMinimiseCompose()}(t.target.indexOf("custom-view")>-1||t.target.indexOf("crm.settings.import")>-1||t.target.indexOf("import")>-1||t.target.indexOf("settings")>-1||t.target.indexOf("entity.detail")>-1)&&app.newSubVersion!=crmConstants.subVersion&&(history.pushState(t.data,document.title,t.url),Utils.windowLocationReload()),r.fromHistory&&e&&"crm.tab.module.create"===t.target&&"crm.tab.module.create"===e.target&&Lyte.registeredMixins["crm-create-mixin"].checkLyteConvertionSupport(t.info.dynamicParams[0])&&(t.data.isRefresh=!0),commonUtils.showHideLoadingDiv(!0),r.initial&&t.data&&!0!==t.data.showError&&(t.data=void 0),r.fromHistory&&-1!=t.target.indexOf("custom-view")&&!crmHistory.doNotReload&&(crmHistory.transitionError?crmHistory.transitionError=!1:(t.data=t.data?t.data:{},t.data.reloadAll=!0)),crmHistory.doNotReload=!1;var c=["crm.tab.module.custom-view.list","crm.tab.module.custom-view.zia","crm.tab.module.custom-view.kanban","crm.tab.module.custom-view.canvas","crm.tab.messages.custom-view.list"];if(r.fromHistory&&e&&c.contains(e.target)){var d=e.info.dynamicParams[0];Lyte.registeredMixins["crm-view-utils"]&&Lyte.registeredMixins["crm-view-utils"].hideMoreActions(d)}r.fromHistory&&crmHistory.loaded&&!crmHistory.fromProgBack&&(crmHistory.length=crmHistory.length-2,crmHistory.length<-1&&(crmHistory.length=0)),crmHistory.fromProgBack=!1,$(".select2-container--open").prev("select").select2("close"),$("[data-type='popUp'], #viewInviteesPop, #emailInviteesPop, #eventCreatePopup, #createEditCallDiv, #topBandPopup, #searchCreatePopup, #deletepopup, #custom_alert_popup, #bulkUpdateFldsList, #templateComponentDIV, #templatePreviewDIV, #templateAnalyticsDIV, #unsupportedMergeFieldPop").hide(),crmui.hidePopup("newRelatedListPopUpDiv");var u=$L("#crmPortalFailureListPopup");u.length>0&&u[0]&&u[0].remove(),$("#lyteCallForm").html(""),"crm.tab.module.entity.canvas"===t.info.route&&$("#entityLookupdiv").remove(),$("#freezeBackGround").hide(),"true"==t.info.queryParams.headless||$("#recentMailsDiv").is(":visible")||hideMenu(),$("#shownotes").hide();var m=t.target;if(t.data=t.data||{},app.store=new crmStore,e&&c.contains(e.target)&&c.contains(t.target)&&Lyte.Router.__lp.trans.R.forEach((function(e){delete e._fetchStatus})),t.data.backOneLevel&&"crm.settings.section.mobile-apps.mobile-app.mobileapp-view"!==e.target)"crm.tab.module.begin"===m&&e&&"crm.tab.module.begin"!==e.target&&t.data&&t.data.changeView?t.data={}:"crm.settings.section.email-configuration.email-sharing"===m&&e&&"crm.settings.section.email-configuration.email-sharing.email-sharing-preference"===e.target&&(t.data=t.data||{},t.data.from_preference=!0);else{if(e&&e.target&&"crm.settings.section.extensions.all-extensions"===m)(w=e.target.split("."))[5]&&Object.values(crmSetup.zohoExtensionsRouteMapping).indexOf(w[5])>-1&&(t.data.showInstalled=!0);if(!e||"crm.tab.module.entity.find-and-merge"!=t.target||"crm.tab.module.entity.canvas"!=e.target&&"crm.tab.module.entity.detail"!=e.target||(Crm.ViewedCanvasState=e.url),t&&!newForecastsEnabled&&t.info&&t.info.route&&("crm.tab.module.entity.detail"===t.info.route||"crm.tab.module.entity.edit"===t.info.route)&&t.info.dynamicParams.contains("Forecasts"))this.replaceWith("crm.tab.forecasts");else{switch(m){case"crm.settings.section.email-configuration.email-sharing":e&&"crm.settings.section.email-configuration.email-sharing.email-sharing-preference"===e.target&&(t.data=t.data||{},t.data.from_preference=!0);break;case"crm.tab.messages.view":case"crm.tab.module.entity.detail":if(e)switch(y=e.toolTip,e.target){case"crm.tab.messages.view":case"crm.tab.module.entity.detail":case"crm.tab.module.entity.edit":case"crm.tab.module.create":e.info.dynamicParams[0]!=t.info.dynamicParams[0]||t.data.fromRL?_=Crm.newHistoryArr.push(Crm.getRouteObject(e))-1:(_=e.data&&e.data.backOneLevel?e.data.backOneLevel.historyIndex:Crm.newHistoryArr.push({route:"crm.tab.module",dynamicParams:[t.info.dynamicParams[0]],toolTip:moduleRecordMapping[t.info.dynamicParams[0]].plural_label})-1,y=Crm.newHistoryArr[_]?Crm.newHistoryArr[_].toolTip:""),Crm.isActivitySplitDone&&"crm.tab.module.entity.detail"===e.target&&moduleRecordMapping&&moduleRecordMapping[e.info.dynamicParams[0]]&&moduleRecordMapping[t.info.dynamicParams[0]]&&moduleRecordMapping.Activities&&!1===moduleRecordMapping.Activities.show_as_tab&&moduleRecordMapping[t.info.dynamicParams[0]].parent_module&&"Activities"===moduleRecordMapping[t.info.dynamicParams[0]].parent_module.module_name&&"Activities"===e.info.dynamicParams[0]&&(Crm.newHistoryArr.deleteElementAt(_),(_-=1)>-1&&Crm.newHistoryArr[_]&&Crm.newHistoryArr[_].dynamicParams&&"Activities"==Crm.newHistoryArr[_].dynamicParams[0]&&(Crm.newHistoryArr[_].dynamicParams[0]=t.info.dynamicParams[0],Crm.newHistoryArr[_].toolTip="Activities"===Crm.newHistoryArr[_].toolTip?t.info.dynamicParams[0]:Crm.newHistoryArr[_].toolTip));break;case"crm.tab.module.begin":if("Home"!==e.info.dynamicParams[0]){y=moduleRecordMapping[t.info.dynamicParams[0]].plural_label,_=Crm.newHistoryArr.push({route:"crm.tab.module.index-module",dynamicParams:[t.info.dynamicParams[0]]})-1;break}case"crm.tab.module.custom-view.canvas":case"crm.tab.module.custom-view.list":case"crm.tab.module.custom-view.kanban":case"crm.tab.module.custom-view.zia":case"crm.global-search":case"crm.tab.module.actions.approve":case"crm.tab.module.actions.mass-tools":case"crm.tab.reports.records":case"crm.tab.dashboards.dashboardId.records":case"crm.tab.forecasts.pipeline":case"crm.tab.module.actions.approvals":case"crm.tab.module.actions.add-to-campaigns":case"crm.tab.messages.custom-view.list":_=Crm.newHistoryArr.push(Crm.getRouteObject(e))-1;break;case"crm.tab.module.entity.canvas":_=e.info.dynamicParams[0]!=t.info.dynamicParams[0]?Crm.newHistoryArr.push(Crm.getRouteObject(e))-1:e.data.backOneLevel.historyIndex;break;case"crm.settings.section.compliance.consent-dashboard.list-view":y=I18n.getMsg("crm.label.gdpr.compliance"),_=Crm.newHistoryArr.push(Crm.getRouteObject(e))-1;break;default:"crm.tab.messages.view"===m?(y=moduleRecordMapping.Messages.plural_label,_=Crm.newHistoryArr.push(Crm.getRouteObject(e))-1):(y=moduleRecordMapping[t.info.dynamicParams[0]].plural_label,_=Crm.newHistoryArr.push({route:"crm.tab.module.index-module",dynamicParams:[t.info.dynamicParams[0]]})-1)}else{var p=t.info.dynamicParams[0];if("crm.tab.module.entity.detail"==m&&null==moduleRecordMapping[p]&&moduleRecordMapping[p+"/"+t.info.dynamicParams[1]])return void setTimeout((function(){Lyte.Router.replaceWith("crm.tab.module",p+" "+t.info.dynamicParams[1])}),0);var g=moduleRecordMapping[p];if(g)y=g.plural_label,_=Crm.newHistoryArr.push({route:"crm.tab.module",dynamicParams:[t.info.dynamicParams[0]]})-1;else if(p.startsWith("CustomModule")){var f=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),h=window.location.pathname.split(f)[1];return void(this.replaceWith("crm.crm-error",h).data={showError:!0,module:p,errorMsg:I18n.getMsg("module.not.available")})}}Crm.newHistoryArr[_]&&(Crm.newHistoryArr[_].toolTip=y);break;case"crm.tab.module.entity.canvas":var y;if(e)switch(y=e.toolTip,e.target){case"crm.tab.messages.view":case"crm.tab.module.entity.detail":t.data&&t.data.replaced?(delete t.data.replaced,_=e.data.backOneLevel.historyIndex):_=e.info.dynamicParams[0]!=t.info.dynamicParams[0]?Crm.newHistoryArr.push(Crm.getRouteObject(e))-1:e.data.backOneLevel.historyIndex;break;case"crm.tab.module.entity.canvas":case"crm.tab.module.entity.edit":case"crm.tab.module.create":e.info.dynamicParams[0]!=t.info.dynamicParams[0]||t.data.fromRL?_=Crm.newHistoryArr.push(Crm.getRouteObject(e))-1:(_=e.data&&e.data.backOneLevel?e.data.backOneLevel.historyIndex:Crm.newHistoryArr.push({route:"crm.tab.module",dynamicParams:[t.info.dynamicParams[0]],toolTip:moduleRecordMapping[t.info.dynamicParams[0]].plural_label})-1,y=Crm.newHistoryArr[_].toolTip);break;case"crm.tab.module.begin":if("Home"!==e.info.dynamicParams[0]){y=moduleRecordMapping[t.info.dynamicParams[0]].plural_label,_=Crm.newHistoryArr.push({route:"crm.tab.module.index-module",dynamicParams:[t.info.dynamicParams[0]]})-1;break}case"crm.tab.module.custom-view.canvas":case"crm.tab.module.custom-view.list":case"crm.tab.module.custom-view.kanban":case"crm.tab.module.custom-view.zia":case"crm.global-search":case"crm.tab.module.actions.approve":case"crm.tab.module.actions.mass-tools":case"crm.tab.reports.records":case"crm.tab.dashboards.dashboardId.records":case"crm.tab.forecasts.pipeline":case"crm.tab.module.actions.approvals":case"crm.tab.module.actions.add-to-campaigns":_=Crm.newHistoryArr.push(Crm.getRouteObject(e))-1;break;case"crm.settings.section.compliance.consent-dashboard.list-view":y=I18n.getMsg("crm.label.gdpr.compliance"),_=Crm.newHistoryArr.push(Crm.getRouteObject(e))-1;break;default:y=moduleRecordMapping[t.info.dynamicParams[0]].plural_label,_=Crm.newHistoryArr.push({route:"crm.tab.module.index-module",dynamicParams:[t.info.dynamicParams[0]]})-1}else{p=t.info.dynamicParams[0];if("crm.tab.module.entity.detail"==m&&null==moduleRecordMapping[p]&&moduleRecordMapping[p+"/"+t.info.dynamicParams[1]])return void setTimeout((function(){Lyte.Router.replaceWith("crm.tab.module",p+" "+t.info.dynamicParams[1])}),0);y=moduleRecordMapping[p].plural_label,_=Crm.newHistoryArr.push({route:"crm.tab.module",dynamicParams:[t.info.dynamicParams[0]]})-1}Crm.newHistoryArr[_].toolTip=y;break;case"crm.settings.clone-home-customization":if(!e){_=Crm.newHistoryArr.push({route:"crm.settings.section.home-customization.index-home-customization"})-1;break}_=Crm.newHistoryArr.push(Crm.getRouteObject(e))-1;break;case"crm.settings.section.macro.view":if(!e){_=Crm.newHistoryArr.push({route:"crm.settings.section.macro.index",queryParams:{module:t.info.queryParams.module}})-1;break}case"crm.tab.module.entity.find-and-merge":if(!e||e.target===m){_=Crm.newHistoryArr.push({route:"crm.tab.module.entity.detail",dynamicParams:[t.info.dynamicParams[0],t.info.dynamicParams[1]]})-1;break}case"crm.settings.section.extensions.zoho-extensions.zanalytics":case"crm.settings.section.extensions.zoho-extensions.reports":case"crm.settings.section.extensions.zoho-extensions.creator":case"crm.settings.section.extensions.zoho-extensions.circuits":case"crm.settings.section.extensions.zoho-extensions.projects":case"crm.settings.section.extensions.zoho-extensions.survey":case"crm.settings.section.extensions.zoho-extensions.finance-suite":case"crm.settings.section.extensions.zoho-extensions.desk":case"crm.settings.section.extensions.zoho-extensions.writer":case"crm.settings.section.extensions.zoho-extensions.motivator":case"crm.settings.section.extensions.zoho-extensions.webinar":case"crm.settings.section.extensions.zoho-extensions.meeting":case"crm.settings.section.extensions.zoho-extensions.cliq":case"crm.settings.section.extensions.zoho-extensions.showtime":case"crm.settings.section.extensions.zoho-extensions.forms":case"crm.settings.section.extensions.zoho-extensions.campaigns":case"crm.settings.section.extensions.zoho-extensions.campaigns.syncs":case"crm.settings.section.extensions.zoho-extensions.campaigns.campaigns-field-mapping":case"crm.settings.section.extensions.zoho-extensions.campaigns.crm-to-campaign-settings":case"crm.settings.section.extensions.zoho-extensions.backstage":case"crm.settings.section.extensions.zoho-extensions.pagesense":case"crm.settings.section.extensions.zoho-extensions.assist":case"crm.settings.section.extensions.zoho-extensions.contracts":case"crm.settings.section.extensions.zoho-extensions.cpq":_=e?e.target===m||"crm.settings.section.extensions.zoho-extensions.campaigns"===e.target&&m.indexOf("crm.settings.section.extensions.zoho-extensions.campaigns.")>=0?e.data?e.data.backOneLevel.historyIndex:1:Crm.newHistoryArr.push(Crm.getRouteObject(e))-1:Crm.newHistoryArr.push({route:"crm.settings.section.extensions.zoho-extensions.zoho-apps"})-1;break;case"crm.tab.module.create":if(e&&("crm.tab.module.entity.edit"===e.info.route||"crm.tab.module.entity.clone"===e.info.route||"crm.tab.module.entity.create"===e.info.route)){_=e.data.backOneLevel.historyIndex;break}case"crm.settings.section.macro.index":if(e){if("crm.settings.section.macro.edit"===e.target||"crm.settings.section.macro.view"===e.target){if((v=Crm.newHistoryArr[e.data.backOneLevel.historyIndex]).data&&v.data.backOneLevel){_=v.data.backOneLevel.historyIndex;break}break}if("crm.settings.section.macro.create"===e.target){var v;_="crm.settings.section.macro.index"===(v=Crm.newHistoryArr[e.data.backOneLevel.historyIndex]).route?v.data.backOneLevel.historyIndex:e.data.backOneLevel.historyIndex;break}}case"crm.tab.module.actions.mass-tools":case"crm.tab.module.actions.deduplicate":case"crm.tab.module.actions.approvals":case"crm.tab.module.entity.clone":case"crm.tab.module.entity.convert":case"crm.tab.module.entity.edit":case"crm.settings.section.macros":case"crm.settings.section.macros.create":case"crm.settings.section.manage-tags":case"crm.settings.section.auto-responders":case"crm.settings.section.schedule-mass-email":case"crm.tab.module.actions.deduplicate.index-deduplicate":case"crm.tab.module.actions.deduplicate.list-conflicts":case"crm.tab.module.actions.deduplicate.merge":case"crm.tab.module.actions.deduplicate.show-duplicates":case"crm.tab.reports":case"crm.settings.section.custom-view.cvid.edit-custom-view":case"crm.settings.section.custom-view.cvid.clone-custom-view":case"crm.settings.section.custom-view.create-custom-view":case"crm.settings.section.autoresponders.index-autoresponder":case"crm.settings.section.manage-mass-mail.index-autoresponder":case"crm.settings.section.manage-mass-mail.create-autoresponder":case"crm.settings.section.manage-mass-mail.view-autoresponder":case"crm.settings.section.manage-mass-mail.edit-autoresponder":case"crm.settings.section.autoresponders.create-autoresponder":case"crm.settings.section.autoresponders.view-autoresponder":case"crm.settings.section.autoresponders.edit-autoresponder":case"crm.settings.section.autoresponders.create-folder":case"crm.settings.section.autoresponders.edit-folder":case"crm.settings.section.workflow-alerts.create-workflow-alert":case"crm.settings.section.workflow-alerts.edit-workflow-alert":case"crm.settings.section.workflow-field-updates.create-workflow-field-update":case"crm.settings.section.workflow-field-updates.edit-workflow-field-update":case"crm.settings.section.workflow-tasks.create-workflow-task":case"crm.settings.section.workflow-tasks.edit-workflow-task":case"crm.settings.section.workflow-webhooks.create-workflow-webhook":case"crm.settings.section.workflow-webhooks.edit-workflow-webhook":case"crm.settings.section.workflow-rules.create-workflow-rule":case"crm.settings.section.workflow-rules.view-workflow-rule":case"crm.settings.section.assignment-rule.view-assignment-rule":case"crm.settings.section.assignment-rule.create-assignment-rule":case"crm.settings.section.modules.module.canvas.create":case"crm.settings.section.modules.module.canvas.edit":case"crm.settings.section.booking.create-booking":case"crm.settings.section.macro.create":case"crm.settings.section.macro.edit":case"crm.settings.canvas.edit":case"crm.tab.module.entity.add-contact-role":case"crm.tab.module.entity.edit-contact-role":case"crm.tab.forecasts.pipeline":case"crm.global-search":case"crm.settings.section.assignment-thresholds.edit-assignment-thresholds":case"crm.settings.section.assignment-thresholds.create-assignment-thresholds":var _;if(e)_=e.target===m||"crm.tab.module.entity.edit"===m&&"crm.tab.module.entity.clone"===e.target?e.data.backOneLevel.historyIndex:Crm.newHistoryArr.push(Crm.getRouteObject(e))-1;else if("crm-global-search"===m&&(_=Crm.newHistoryArr.push({route:"crm.tab.module",dynamicParams:["Home"]})-1),/crm.tab.module.entity/.test(m))_=Crm.newHistoryArr.push({route:"crm.tab.module.entity.detail",dynamicParams:[t.info.dynamicParams[0],t.info.dynamicParams[1]]})-1;else if(/crm.tab.module/.test(m))_=Crm.newHistoryArr.push({route:"crm.tab.module",dynamicParams:[t.info.dynamicParams[0]||"Home"]})-1;else if(/crm.settings.section.workflow-/.test(m)||/crm.settings.section.assignment-rule./.test(m)||/crm.settings.section.assignment-thresholds./.test(m))m.replace("create","index"),m.replace("edit","index"),m.replace("view","index"),_=Crm.newHistoryArr.push({route:m})-1;else if(t.info.queryParams.module)_=Crm.newHistoryArr.push({route:"crm.tab.module",dynamicParams:[t.info.queryParams.module]})-1;else{var b=t.info.route.match(/crm.tab.google-adwords|crm.tab.marketplace|crm.tab.projects|crm.tab.reports|crm.tab.forecasts|crm.tab.dashboards|crm.tab.approvals/);_=b&&b.length>0?Crm.newHistoryArr.push({route:b[0]})-1:Crm.newHistoryArr.push({route:"crm.tab.module.begin",dynamicParams:["Home"]})-1}break;case"crm.tab.reports.records":t.data.isAjax=!1;break;case"crm.tab.module.begin":return void(e&&"crm.tab.module.begin"!==e.target&&t.data&&t.data.changeView&&(t.data={}));case"crm.tab.messages.custom-view.list":case"crm.tab.module.custom-view.list":e&&t.data&&"crm.tab.module.custom-view.list"!==e.target&&"crm.tab.module.custom-view.kanban"!==e.target&&"crm.tab.module.custom-view.canvas"!==e.target&&delete t.data.fetchOnlyBody;break;case"crm.settings.section.extensions.all-extensions":var w;if(e&&e.target)(w=e.target.split("."))[5]&&Object.values(crmSetup.zohoExtensionsRouteMapping).indexOf(w[5])>-1&&(t.data.showInstalled=!0);return;case"crm.settings.section.modules.module.links-and-buttons.create-links-and-buttons":case"crm.settings.section.modules.module.links-and-buttons.edit-links-and-buttons":t.data.module=t.info.dynamicParams[0];break;case"crm.settings.section.web-apps.webapp-details":e?(_=Crm.newHistoryArr.push(Crm.getRouteObject(e))-1,t.info.queryParams=e.info.queryParams):_=Crm.newHistoryArr.push({route:"crm.settings.section.web-apps.webapps-index"})-1;break;case"crm.settings.section.mobile-apps.mobile-app.mobileapp-view":_=e?Crm.newHistoryArr.push(Crm.getRouteObject(e))-1:Crm.newHistoryArr.push({route:"crm.settings.section.mobile-apps.mobileapps-index"})-1;break;case"crm.settings.section.mobile-apps.mobileapp-upload":e?(_=Crm.newHistoryArr.push(Crm.getRouteObject(e))-1,t.info.queryParams=e.info.queryParams):_=Crm.newHistoryArr.push({route:"crm.settings.section.mobile-apps.mobileapps-index"})-1;break;case"crm.settings.section.web-apps.webapp-upload":e?(_=Crm.newHistoryArr.push(Crm.getRouteObject(e))-1,t.info.queryParams=e.info.queryParams):_=Crm.newHistoryArr.push({route:"crm.settings.section.web-apps.webapps-index"})-1;break;case"crm.settings.section.web-apps.webapps-index":e&&"crm.settings.section.web-apps.webapp-details"===e.info.route?(_=Crm.newHistoryArr.push(Crm.getRouteObject(e))-1,t.info.queryParams=e.info.queryParams):_=Crm.newHistoryArr.push({route:"crm.settings.section.web-apps.webapps-index"})-1;break;default:return}app.store=new crmStore({maxLength:undefined}),t.data.backOneLevel={historyIndex:_}}}};var CrmRouter={hiddenSetupRoutes:{"crm.settings.section.workflow-rules.create-workflow-rule":!0,"crm.settings.section.workflow-rules.view-workflow-rule":!0,"crm.settings.section.blueprint.create-blueprint":!0,"crm.settings.section.blueprint.view-blueprint":!0,"crm.settings.section.attributions":!0,"crm.settings.section.profiles.view-profile":!0,"crm.settings.create-home-customization":!0,"crm.settings.edit-home-customization":!0,"crm.settings.clone-home-customization":!0,"crm.settings.section.crm-templates":!0,"crm.settings.section.widget-telephony.summary":!0,"crm.settings.section.telephony.summary":!0,"crm.settings.section.telephony.summary":!0,"crm.settings.section.telephony.phonebridgegroup.viewpbxgroup":!0,"crm.settings.section.telephony.phonebridgegroup.createpbxgroup":!0,"crm.settings.section.telephony.phonebridgegroup.editpbxgroup":!0,"crm.settings.section.telephony.configuration":!0,"crm.settings.section.widget-telephony.configuration":!0,"crm.settings.section.orchestration.create-orchestration":!0,"crm.settings.section.orchestration.edit-orchestration":!0,"crm.settings.section.orchestration.orchestration-reports":!0}};if(Lyte.Router.afterRouteTransition=function(e){if(!e.permError&&app.prevTransition&&app.prevTransition.route&&200===e.state&&-1===e.target.indexOf("crm.settings")&&-1===e.target.indexOf("crm.settings.section.zohocpq")&&Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crmsetup.css"],crmConstants.cssStaticPath)),e.target.indexOf("crm.settings")>-1){var t=document.getElementById("ziaSetupOnBoardDiv");!Crm.userDetails.isZiaSetupMigRan||Crm.userDetails.CUSTOMIZE_INFO.ZIADIRECTORY_MOVEMENT_VIEWED||t.classList.contains("dNShowOnboardVid")||Lyte.Component.render("crm-ziasetup-onboard",{},"#ziaSetupOnBoardDiv")}crmHistory.loaded=!0,crmHistory.length++;var r=e.target.indexOf("crm.tab.newForecasts.view")>-1;switch("undefined"!=typeof detailView&&detailView.refreshInWms&&detailView.refreshCanvasView?commonUtils.showHideLoadingDiv(!0):r||commonUtils.showHideLoadingDiv(),$("html").addClass("page_initial_loading_hide"),$(".dummy_Body").hide(),e.target){case"crm.global-search":e.toolTip=I18n.getMsg("crm.label.search.result");break;case"crm.tab.module.actions.mass-tools":e.toolTip=I18n.getMsg({"mass-transfer":"crm.permission.mass.transfer.CustomModule","mass-delete":"crm.permission.mass.delete.CustomModule","mass-email":"crm.permission.mass.email.leads","mass-update":"crm.permission.mass.update.CustomModule"}[e.info.queryParams.type]);break;case"crm.tab.module.entity.detail":e.toolTip=document.getElementById("entityName")?document.getElementById("entityName").value:"entity";break;case"crm.tab.module.begin":"Home"===e.info.dynamicParams[0]&&(e.toolTip=moduleRecordMapping.Home.plural_label);break;case"crm.tab.forecasts.pipeline":"true"===e.info.queryParams.closed?moduleRecordMapping.Deals?e.toolTip=I18n.getMsg("crm.label.forecast.closed",moduleRecordMapping.Deals.plural_label):e.toolTip=I18n.getMsg("crm.label.forecast.closed",moduleRecordMapping.Potentials.plural_label):moduleRecordMapping.Deals?e.toolTip=I18n.getMsg("crm.label.forecast.pipeline",moduleRecordMapping.Deals.plural_label):e.toolTip=I18n.getMsg("crm.label.forecast.pipeline",moduleRecordMapping.Potentials.plural_label);break;case"crm.tab.module.actions.approve":e.toolTip=I18n.getMsg("crm.title.web.lead.approval",e.info.dynamicParams[0]);break;case"crm.tab.module.custom-view.list":case"crm.tab.module.custom-view.kanban":case"crm.tab.module.custom-view.zia":moduleRecordMapping[e.info.dynamicParams[0]]&&(e.toolTip=moduleRecordMapping[e.info.dynamicParams[0]].plural_label)}"undefined"!=typeof CrmPlusLib&&CrmPlusLib.isLoadedInCrmplusFrame&&(CrmPlusLib.parent.notifyURLChange(),CrmPlusLib.changeBrowserTitle(document.title))},/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream){var style=document.createElement("style");style.innerHTML="* { -webkit-tap-highlight-color:  rgba(255, 255, 255, 0); } [click], link-to, a { -webkit-tap-highlight-color: rgba(0, 0, 0, 0.4); } ",document.head.appendChild(style)}var ps=history.pushState,rs=history.replaceState;function urlLengthCheck(){if(app.nextTransition&&app.nextTransition.info&&-1!=["crm.tab.module.custom-view.canvas","crm.tab.module.custom-view.list","crm.tab.module.custom-view.kanban","crm.tab.messages.custom-view.list"].indexOf(app.nextTransition.info.route)){var e={route:app.nextTransition.info.route,queryParams:Object.assign({},app.nextTransition.info.queryParams),dynamicParams:Array.from(app.nextTransition.info.dynamicParams)};delete e.queryParams.filters,delete e.queryParams.cross_filters,arguments[2]=Lyte.Router.getURL(e)}return arguments}function eliminateDuplicates(e){var t,r=e.length,i=[],a={};for(t=0;t<r;t++)a[e[t]]=0;for(t in a)i.push(t);return i}function havevalidLength(e,t,r){if(e&&e.length){var i=(t+="").length;return r&&-1!==t.indexOf(".")&&(i=i?--i:i),i<=e.length}return!0}function getcurrentFieldAtributes(e,t){var r=t.$&&t.$.model&&t.$.model.fieldList?t.$.model.fieldList:{};if(r)return r[e]}history.pushState=function(){app.historyLength++,ps.apply(history,urlLengthCheck.apply(history,arguments))},history.replaceState=function(){rs.apply(history,urlLengthCheck.apply(history,arguments))},store.addEventListener("afterRequest",(function(e){app.newSubVersion=e.getResponseHeader("clientsubversion")?e.getResponseHeader("clientsubversion"):crmConstants.subVersion})),Lyte.Router.registerRoute("crm",{queryParams:["headless","callbackcode"],getResources:function(){var e=Crm.userDetails.LOCALE,t="en_US.js",r="crux_en_US.js";-1!=app.uiCompLocale.indexOf(e)&&(t=e+".js"),-1!=app.cruxCompLocale.indexOf(e)&&(r="crux_"+e+".js");var i=networkUtils.returnDependencyFiles([t,r],crmConstants.jsStaticPathForLyte);if(!Crm.userDetails.DONT_SHOW_MOTIVATOR_TRYNOW&&"true"==Crm.userDetails.isMotivatorEarlyAccessGiven){var a=[];a=(a=a.concat(networkUtils.returnDependencyFiles(["gamescope-trynow-callout.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-trynow-callout.css"],crmConstants.cssStaticPathForLyte)),i=i.concat(a)}if("true"==Crm.userDetails.isGameEOLEnabled&&"true"==Crm.userDetails.isMotivatorEarlyAccessGiven&&"false"==Crm.userDetails.isMotivatorEnabled){var s=[];s=(s=s.concat(networkUtils.returnDependencyFiles(["gamescope-eol.css"],crmConstants.lessStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["lyte-clock.js","gamescope-eol.js"],crmConstants.jsStaticPathForLyte)),i=i.concat(s)}return!0===Crm.userDetails.RTL_ENABLED&&(i=i.concat(networkUtils.returnDependencyFiles(["cscript/crm-cscript-create-rtl.css"],crmConstants.cssStaticPathForLyte))),i=i.concat(networkUtils.returnDependencyFiles(["zohocrm_crm_formulainit.js","zohocrm_transDelUserScheduler.js","zohocrm_wfAuditLog.js"]))},renderTemplate:function(e,t){var r=null!=t&&null!=t.queryParams&&"true"==t.queryParams.headless;if("crm.tab.dashboards.view.expand"===this.transition.info.route||r)$(".dummy_Topband").hide(),$(document.body).css("background-color","transparent");else{var i;if(this.transition.info.route.indexOf("crm.tab")>-1){var a=$(".lyteMenuItems .lyteMenuActive").data("value");if(-1!=this.transition.info.route.indexOf("crm.tab.module"))i=this.getRouteInstance("crm.tab.module").getDynamicParam();else{var s=this.transition.info.route.split(".")[2];i=s.charAt(0).toUpperCase()+s.slice(1)}crmTab.isZBCustomModule(i)?i=crmTab.isBooksIntegrated()?"Zoho Books":"Zoho Invoice":crmTab.isZExpenseSubModule(i)&&(i="Zoho Expense"),window.clientPortalName||!crmTab.isZCpqTab(i)&&!crmTab.isZCpqSubTab(i)||(i="ZohoCPQ"),"OneFeeds"==i?i="Feeds":"Voc"===i&&(i="Voice Of Customer"),"NewReports"===i&&(i=this.getRouteInstance("crm.tab.newReports.records")&&this.getRouteInstance("crm.tab.newReports.records").getQueryParams()&&"viewAppointments"===this.getRouteInstance("crm.tab.newReports.records").getQueryParams().action?"Appointments":"Reports"),"NewForecasts"===i&&(i="Forecasts"),"Reports"===i&&this.getRouteInstance("crm.tab.reports.records")&&this.getRouteInstance("crm.tab.reports.records").getQueryParams()&&"viewAppointments"===this.getRouteInstance("crm.tab.reports.records").getQueryParams().action&&(i="Appointments"),"NewForecasts"===i&&(i="Forecasts"),a!=i&&(e.selected=moduleRecordMapping[i],null==e.selected&&moduleRecordMapping[i.replace(" ","/")]&&(e.selected=moduleRecordMapping[i.replace(" ","/")]))}setTimeout((function(){null!=t&&null!=t.queryParams&&"true"==t.queryParams.headless?($("#mainMenuTabDiv").hide(),$("#wmstoolbar").hide()):($("#mainMenuTabDiv").show(),$("#wmstoolbar").show());var r=document.querySelector("crm-menu");r&&r.component.setData({showProfilePic:!0,clientPortalLogoutUrl:app.crmNamespace+"/logout.do?logout=true&serviceurl=https://"+RebrandLinkUtil.getProperties().CRMURL+app.crmNamespace+"/login.sas"});var i=document.querySelector("crm-tab");i&&i.remove(),r.setData("loadTabGroup",!0),Lyte.Component.render("crm-tab",e,".crmMenuLeft")}),0)}},actions:{willTransition:function(){1==permissionDenied&&(permissionDenied=!1)},onError:function(e,t,r){if($("html").addClass("page_initial_loading_hide"),$(".dummy_Body").hide(),e.status===crmConstants.errorStatusCode)return t.permError=!0,!1;if("string"==typeof e.responseText&&"crm"!==t.target){var i=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),a=window.location.pathname.split(i)[1];return this.replaceWith("crm.crm-error",a).data=e.responseText,!1}}},model:function(){crmTab.tabList=Object.keys(moduleApiMapping);for(var e=store.peekAll("tab_group"),t=0;t<e.length;t++)if(e[t].default){if(window.clientPortalName){var r=e[t].modules.sortBy("sequence_number"),i=r.length;for(t=0;t<i;t++)if(r[t].module_name===Crm.userDetails.CLIENT_TYPE){var a=r[t];r.splice(t,1),r.splice(0,0,a)}return{tabModules:r}}return{tabModules:e[t].modules.sortBy("sequence_number")}}},afterRender:function(e,t){null!=t&&null!=t.queryParams&&"true"==t.queryParams.headless||Lyte.Component.render("crm-calendar-menu",{},"body")}}),Lyte.Router.registerRoute("crm.wildcard",{}),Lyte.Router.registerRoute("crm.settings",{didTransitionCalled:!1,getDependencies:function(){var e=networkUtils.returnDependencyFiles(["crm-setup.js","crm-setup-mixin.js","crm-setup-data.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["setupjson_clientside.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles(["crm-automation-userswrapper.js","crm-superadmin-dd-wrapper.js"],crmConstants.jsStaticPathForLyte),i=networkUtils.returnDependencyFiles(["crm-wf-dependencyfields.js"],crmConstants.jsStaticPathForLyte),a=networkUtils.returnDependencyFiles(["crm-wf-dependencyfields.css"],crmConstants.cssStaticPathForLyte),s=networkUtils.returnDependencyFiles(["crm-setup.css"],crmConstants.cssStaticPathForLyte),o=networkUtils.returnDependencyFiles(["crm-automation-userswrapper.css"],crmConstants.cssStaticPathForLyte),n=networkUtils.returnDependencyFiles(["zohocrm_setup.js","zohocrm_initialimages.js","zohocrm_auth_domain.js","zohocrm_module_settings_common.js","crm_finance_suite.js","zohocrm_macro_common.js"]),l=networkUtils.returnDependencyFiles(["crmsetup.css"],crmConstants.cssStaticPath),c=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("settings")],crmConstants.cssStaticPath);return["E","A","C","U","Z"].contains(Crm.userDetails.LICENSE_TYPE)&&"true"!==window.isSandboxAcc&&(c=c.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("portalmisc")]))),n.concat(s).concat(t).concat(c).concat(o).concat(a).concat(l).concat(e).concat(r).concat(i)},model:function(e){var t=[];return t[0]=store.findAll("settings_customization"),t[1]=setup,t[2]=this,{customizationJson:Lyte.resolvePromises(t)}},afterModel:function(e,t){var r=e.customizationJson[1];crmSetup.Permissioned_Setup_Elements=[],this.metaBinding(r),globalSetpJson||(globalSetpJson=e.customizationJson[0]),"undefined"!=typeof FeedbackChat&&FeedbackChat.enableTracking()},redirect:function(){var e,t=this.transition.target;"crm.settings.section.widget"===t&&(e=this.transition.info.dynamicParams[0]),t.includes("crm.settings.section.extensions.zoho-extensions")&&(t="crm.settings.section.extensions.zoho-extensions"),t.includes("crm.settings.section.assignment-thresholds")&&(t="crm.settings.section.assignment-thresholds");var r=!1;if(globalSetpJson&&void 0!==globalSetpJson){for(var i=globalSetpJson.components.length,a=0;a<i;a++)for(var s=globalSetpJson.components[a],o=s.menus.length,n=0;n<o;n++){var l=s.menus[n];if("system.zia"!==l.api_name||"system.general"!==l.group.api_name)for(var c=l.sub_menus.length,d=0;d<c;d++){var u=l.sub_menus[d],m=!u.show||!l.show||!s.show;if("system.customization"===s.api_name&&"system.canvasbuilder"===l.api_name&&"system.detailview"===u.api_name&&t.indexOf("crm.settings.section.canvas-builder")>-1&&(r=!0,m&&(this.replaceWith("crm.settings.index"),setTimeout((function(){renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))}),2e3))),t.indexOf(u.routeName)>-1&&!r&&(r=!0),t.indexOf(u.routeName)>-1&&m){var p=!0,g=!0;"crm.settings.section.widget"===t&&(g=e===u.dynamicParams[0],p=e===u.dynamicParams[0]),"system.modules"===u.api_name&&(t.indexOf("crm.settings.section.modules.index-modules")>-1?p=!this.transition.data.fromLayoutPage:!t.indexOf(u.routeName+"."+u.indexRoute)>-1&&m&&(p=!1,g=!1)),g&&this.replaceWith("crm.settings.index"),p&&setTimeout((function(){renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))}),1e3)}}}r||void 0===t||!t.includes("crm.settings.section")||"crm.settings.section.zia"===t||t.includes("crm.settings.section.zia.zia-voice")||t.includes("crm.settings.section.email-settings")||t.includes("crm.settings.section.extensions")||t.includes("section-error")||t.includes("settings-wildcard")||"crm.settings.section.import"===t||t.includes("manage-mass-mail")||t.includes("schedule-mass-email")||t.includes("autoresponders")||t.includes("custom-view")||t.includes("webform-builder")||t.includes("api-module-detail")||t.includes("api-table-view")||t.includes("crm.settings.section.widget")||t.includes("macro")||t.includes("manage-tags")||t.includes("competitor-alerts")||t.includes("voice-of-customer")||t.includes("crm.settings.section.booking")||"crm.settings.index"===t||"crm.settings.editor"===t||this.transition.target.includes("crm.settings.section.extensions.social-extensions")||"crm.settings.section.api-modules"===t||"crm.settings.section.api-paid"===t||(this.replaceWith("crm.settings.index"),setTimeout((function(){renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))}),1e3)),crmSetup.mySetupArray=[],globalSetpJson.components.forEach((function(e){e.show&&e.menus.forEach((function(e){var t=objectUtils.cloneObject(e);t.show&&t.sub_menus.forEach((function(e){if(e.show){var t=objectUtils.cloneObject(e);t.menu_name=t.menus.display_label,delete t.menus,crmSetup.mySetupArray.push(t)}}))}))}))}if("crm.settings"===this.transition.target||"crm.settings.section"===this.transition.target){var f=!!this.transition.data.fromeditor;if(f&&this.transition.data.isChangeMade){var h={refreshTemplate:!0};"true"===window.isSandboxAcc&&store.unloadAll("settings_customization"),this.refresh(h).data={fromeditor:f}}else this.replaceWith("crm.settings.index").data={fromeditor:f}}},actions:{willTransition:function(e){if(e.target.indexOf("crm.settings")<0){if("undefined"!=typeof Customization&&Customization&&Customization.canvasRefresh)for(obj in Customization.canvasRefresh)1==Customization.canvasRefresh[obj]&&(e.pause(),window.location.href=e.url)}else e.target;"undefined"!=typeof CrmPlusImpl&&-1===e.target.indexOf("crm.settings")&&CrmPlusImpl.trigger("setupView.onclose")},didTransition:function(){var e=$(".lyteMenuItems .lyteMenuActive"),t=Lyte.Router.getRouteInstance().transition.info,r=t.route.split(".");e&&"crm.settings.section.import"!=t.route&&"crm.settings.import"!=t.route&&document.querySelector("crm-tab").setData("selected",{}),r[3]&&(Crm.trackSpotLightAction("Setup - "+r[3]+" Clicked"),FeedbackChat.pathTracking("setup-"+r[3]))},onBeforeLoad:function(){"undefined"!=typeof CrmPlusImpl&&this.isTransitionToSettings(app.prevTransition.route)&&CrmPlusImpl.trigger("setupView.onbeforeload")},onError:function(e){if(200!==e.status&&this.transition.target.includes("editor"))return Lyte.Router.transitionTo("crm.settings.index").refresh=!0,JSON.parse(e.response)&&JSON.parse(e.response).code&&"NO_PERMISSION"===JSON.parse(e.response).code&&crmui.showMsgBand("error",I18n.getMsg("crm.setup.attribution.NO_PERMISSION"),3e3),!1}},afterRender:function(){"undefined"!=typeof CrmPlusImpl&&this.isTransitionToSettings(app.prevTransition.route)&&CrmPlusImpl.trigger("setupView.onafterload")},beforeModel:function(){crmTab.emptyCache(),this.unloadModuleProperty("actions")},beforeExit:function(){for(var e in moduleRecordMapping)moduleRecordMapping[e].crux_customViewAccessedModules&&this.removeTotalCache(e,moduleRecordMapping[e].cvid);delete customViewObject.filters},isTransitionToSettings:function(e){return void 0===e||-1===e.indexOf("crm.settings")}},{mixins:["crm-setup-mixin","crm-module-mixin","crm-view-utils"]}),Lyte.Router.registerRoute("crm.settings.canvas",{getResources:function(){return networkUtils.returnDependencyFiles(["zcrm_customization_builder.js",networkUtils.getI18nJSUrl("customization"),networkUtils.getI18nJSUrl("scoringRulesChart")])},renderTemplate:function(){Customization.isBuilder=!0},beforeExit:function(){Customization.isBuilder=!1}}),Lyte.Router.registerRoute("crm.settings.clone-home-customization",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_sharehomepage.js"]);return e=e.concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles()))},model:function(){var e={params:{action:"customizeHomePage",operation:"clone",customizationId:this.getDynamicParam()},reject_on_failure:!0};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/HomePageLayout.do","GET",e)},renderTemplate:function(e){return crmSetup.renderHomepageSetupResponse("customizeHomePage",e,"clone")},actions:{onError:function(e){var t="noRolesForHome"!==e.responseText?e.responseText:'<div class="f21"><span id="warningMsg">'+I18n.getMsg("crm.no.roles.for.homepage1")+'</span> <span class="crm-font-regular" id="delItemName"></span><br><span id="showWarning2" class="f13"><b>'+I18n.getMsg("crm.label.note2")+' </b><span id="noteMsg">'+I18n.getMsg("crm.no.roles.for.homepage2")+"</span></span></div>";return renderingUtils.showCustomAlert(t,void 0,!0,(function(){crmHistory.backOneLevel()})),!1}}}),Lyte.Router.registerRoute("crm.settings.create-home-customization",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-list-kanban-container.js","crm-customview-dropdown.js","crm-customview-helpers.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-list-kanban-container.css","crm-customview-dropdown.css"],crmConstants.cssStaticPathForLyte);e=e.concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles())),t=t.concat(networkUtils.returnDependencyFiles(["crm-analytics.css"],crmConstants.cssStaticPathForLyte)),e=e.concat(t);var r=networkUtils.returnDependencyFiles(["zohocrm_sharehomepage.js"]);return e.concat(r)},model:function(){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/HomePageLayout.do","GET",{params:{action:"customizeHomePage",operation:"create"},reject_on_failure:!0})},renderTemplate:function(e){return crmSetup.renderHomepageSetupResponse("customizeHomePage",e,"create")},actions:{onError:function(e){var t="noRolesForHome"!==e.responseText?e.responseText:'<div class="f21"><span id="warningMsg">'+I18n.getMsg("crm.no.roles.for.homepage1")+'</span> <span class="crm-font-regular" id="delItemName"></span><br><span id="showWarning2" class="f13"><b>'+I18n.getMsg("crm.label.note2")+' </b><span id="noteMsg">'+I18n.getMsg("crm.no.roles.for.homepage2")+"</span></span></div>",r=this;return renderingUtils.showCustomAlert(t,void 0,!0,(function(){r.transitionTo("crm.settings.section.home-customization.index-home-customization")})),!1}}}),Lyte.Router.registerRoute("crm.settings.edit-home-customization",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-list-kanban-container.js","crm-customview-dropdown.js","lyte-counter.js","crm-customview-helpers.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-list-kanban-container.css","crm-customview-dropdown.css"],crmConstants.cssStaticPathForLyte);e=e.concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles())),t=t.concat(networkUtils.returnDependencyFiles(["crm-analytics.css"],crmConstants.cssStaticPathForLyte)),e=e.concat(t);var r=networkUtils.returnDependencyFiles(["zohocrm_sharehomepage.js"]);return e.concat(r)},model:function(){var e={params:{action:"customizeHomePage",operation:"edit",customizationId:this.getDynamicParam()}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/HomePageLayout.do","GET",e)},renderTemplate:function(e){crmSetup.renderHomepageSetupResponse("customizeHomePage",e,"edit",this.transition.data)},actions:{willTransition:function(e){var t=!1;if($(".customHomePageContainer").is(":visible")){var r="edit"===CustomHomePage.operation&&!$("#saveCustomization").hasClass("inActiveSec");t="edit"!==CustomHomePage.operation&&("true"===$("#layout_Name").attr("data-changed")||$(".dashBrdContent").length>0)||r}if(t){var i=e.pause(),a="stayonPageConfirmBox",s=$("#"+a);freezeBackground(),mailsetCenter(a),s.find(".leavePage").off("click").click((function(){$("#stayonPageConfirmBox").hide(),i.resume(),removeFreezeLayer(),Events.isPageLayoutModified=!1})),s.find(".stayPage").off("click").click((function(){$("#stayonPageConfirmBox").hide(),e.abort(),removeFreezeLayer()})),s.focus()}}}}),Lyte.Router.registerRoute("crm.settings.editor",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-setup-data.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e,t=networkUtils.returnDependencyFiles(["crm-setup-editors.js"],crmConstants.jsStaticPathForLyte);return e=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-setup-editor.css","crm-setup-editor-rtl.css"],crmConstants.cssStaticPathForLyte):networkUtils.returnDependencyFiles(["crm-setup-editor.css"],crmConstants.cssStaticPathForLyte),t.concat(e)},model:function(){return store.unloadAll("setup_group"),store.findAll("settings_customization",null,null,!0,{action:"editor"})},beforeModel:function(){Crm.trackSpotLightAction("Setup - Editor Visited"),commonUtils.showHideLoadingDiv(!0),crmSetup.loaderDots(),$("html, body").css("overflow","hidden")},afterModel:function(e){this.currentModel={components:e.components}},renderTemplate:function(){return{outlet:"#show",component:"crm-setup-editor"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1),this.setTitle(I18n.getMsg("crm.title.setup.revamp",[Crm.partnerName])),crmSetup.removeLoaderDots()},actions:{willTransition:function(e){var t=this;if(t.component&&t.component.getData("changeFlag")&&!0===t.component.getData("changeFlag")){var r=e.pause(),i="stayonPageConfirmBox",a=$("#"+i);freezeBackground(),mailsetCenter(i),a.find(".leavePage").off("click").click((function(){$("#"+i).hide(),e.target.includes("settings.index")&&(e.data={fromeditor:!0}),r.resume(),removeFreezeLayer()})),a.find(".stayPage").off("click").click((function(){$("#"+i).hide(),e.abort(),removeFreezeLayer()})),a.focus()}else t.component&&(e.data.isChangeMade=t.component.getData("isChangeMade"),e.data.fromeditor="true")},onError:function(e){if(crmSetup.removeLoaderDots(),200!=e.status)return Lyte.Router.transitionTo({route:"crm.settings"}).data={fromeditor:!0,isChangeMade:!0},e.response&&JSON.parse(e.response)&&JSON.parse(e.response).code&&"UNCONFIRMED_EMAIL"==JSON.parse(e.response).code?crmui.showMsgBand("error",I18n.getMsg("workflow.wfDeluge.failures.unConfirmedEmail"),3e3):e.response&&JSON.parse(e.response)&&JSON.parse(e.response).code&&"FEATURE_NOT_SUPPORTED"===JSON.parse(e.response).code?crmui.showMsgBand("error",I18n.getMsg("crm.setup.attribution.FEATURE_NOT_SUPPORTED"),3e3):e.response&&JSON.parse(e.response)&&JSON.parse(e.response).code&&"NO_PERMISSION"===JSON.parse(e.response).code?crmui.showMsgBand("error",I18n.getMsg("crm.setup.attribution.NO_PERMISSION"),3e3):crmui.showMsgBand("error",I18n.getMsg("crm.label.widgets.error.internal"),3e3),!1}}},{mixins:["crm-setup-mixin"]}),Lyte.Router.registerRoute("crm.settings.import",{queryParams:["module","step","parentModule","id"],getDependencies:function(){return networkUtils.returnDependencyFiles(["data-migration-store.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_import.js",networkUtils.getI18nJSUrl("import")]),t=networkUtils.returnDependencyFiles(["import-user-wrapper.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles(["zohocrm_import.css"],crmConstants.cssStaticPath),i=e.concat(t).concat(r),a=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("datamigration")]),s=networkUtils.returnDependencyFiles(["data-migration-component-general.js"],crmConstants.jsStaticPathForLyte),o=networkUtils.returnDependencyFiles(["data-migration-general.css"],crmConstants.cssStaticPathForLyte);if(Crm.userDetails.RTL_ENABLED)o=networkUtils.returnDependencyFiles(["data-migration-general.css","data-migration-general-rtl.css"],crmConstants.cssStaticPathForLyte);var n=networkUtils.returnDependencyFiles(["lyte-step.css"],crmConstants.cssStaticPathForLyte);return a.concat(s).concat(o).concat(n).concat(i)},beforeModel:function(){var e=this.getQueryParams().module;Crm.userDetails.isStorageLimitReached&&"Users"!=e&&(Crm.showStorageExceedPopup(),this.transition.abort())},model:function(e){var t=objectUtils.cloneObject(this.transition.data),r=e.queryParams;if(0==Object.keys(t).length&&"1"!=r.step){var i={module:r.module,step:"1"};return r.parentModule&&(i.module=r.parentModule),void Lyte.Router.transitionTo("crm.settings.import",i)}var a={};if("1"===r.step&&null!=t&&"cancelImport"!==t.currStep){a={module:r.module,step:r.step,currStep:"sourceType"},r.hasOwnProperty("parentModule")&&(a.parentModule=r.parentModule),null!=t&&(a.currStep=t.currStep,null==a.currStep&&(a.currStep="1"),t.parentModule&&(a.parentModule=t.parentModule),t.parentId&&(a.parentId=t.parentId),t.itsRelatedModule&&(a.itsRelatedModule=t.itsRelatedModule));var s={params:a};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/ImportAction.do","GET",s)}if("fileUpload"===r.step){a={module:r.module,step:r.step,currStep:"sourceType"},null!=t&&(a.currStep=t.currStep,a.module=t.module,t.parentModule&&(a.parentModule=t.parentModule),t.parentId&&(a.parentId=t.parentId));s={params:a};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/ImportAction.do","GET",s)}if("showOperation"===r.step&&"cancelImport"!==t.currStep){if(a={module:r.module,step:r.step,importId:r.id,currStep:r.step},null!=t){if("previousShowOperation"===t.currStep)return;a.currStep=t.currStep,a.importId=t.importId,a.charSet=t.charSet,a.module=t.module,t.parentModule&&(a.parentModule=t.parentModule),t.parentId&&(a.parentId=t.parentId)}s={params:a};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/ImportAction.do","POST",s)}if("fieldMapping"===r.step){if(null!=t){if("previousFieldMapping"===t.currStep)return;a.currStep=t.currStep,a.importId=t.importId,a.operation=t.operation,a.ignoreEmpty=t.ignoreEmpty,a.module=t.module,a.findBy=t.findBy,t.sendUserInvitation&&(a.sendUserInvitation=t.sendUserInvitation),t.parentModule&&(a.parentModule=t.parentModule),t.parentId&&(a.parentId=t.parentId),t.layoutId&&(a.layoutId=t.layoutId)}else a={module:r.module,step:r.step,importId:r.id,currStep:"submitOperation",ignoreEmpty:r.ignoreEmpty};s={params:a};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/ImportAction.do","POST",s)}if("showOptions"===r.step&&null!=t&&"cancelImport"!==t.currStep){if(a={module:r.module,importId:r.id,step:r.step},null!=t)for(var o in t)a[o]=t[o];s={params:a};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/ImportAction.do","POST",s)}if(null==t||"cancelImport"!==t.currStep){if(null!=t&&"submitImport"===t.currStep){s={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/ImportAction.do","POST",s)}if(null!=t&&"submitMapping"===t.currStep){s={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/ImportAction.do","POST",s)}if(null!=t&&"sourceType"===t.currStep){s={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/ImportAction.do","POST",s)}a={module:r.module,step:"1",toolTip:r.module,dataScope:"myData"},r.hasOwnProperty("parentModule")&&(a.parentModule=r.parentModule),t.parentModule&&(a.parentModule=t.parentModule),t.parentId&&(a.parentId=t.parentId);s={params:a};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/ImportAction.do","GET",s)}if("Users"!==r.module){var s={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/ImportAction.do","POST",s)}Lyte.Router.getRouteInstance().transitionTo({route:"crm.settings.section.users"});s={params:a={module:r.module,step:r.step,toolTip:r.module,dataScope:"myData"}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/ImportAction.do","GET",s)},renderTemplate:function(e,t){var r=this.transition.data,i=t.queryParams.module,a=t.queryParams.id;if("string"!=typeof e&&(null==e||"object"!=typeof e||e.hasOwnProperty("ERRORMSG")))return!r||"previousFieldMapping"!==r.currStep&&"previousShowOperation"!==r.currStep?void("object"==typeof e&&e.hasOwnProperty("ERRORMSG")?(crmui.showMsgBand("error",I18n.getMsg(e.ERRORMSG),5e3),Import.enableAndDisableButton(["mappingPreviousBtn","mappingSubmitBtn"],"enable"),this.transition.abort()):(!r||r&&"cancelImport"!=r.currStep)&&crmui.showMsgBand("error",I18n.getMsg("crm.import.unexpected.error"),5e3)):void 0;if(r&&"cancelImport"===r.currStep&&"1"===t.queryParams.step){Import.reset();var s=r.module;return r.parentModule&&""!=r.parentModule&&(s=r.parentModule),void("Users"===s?Lyte.Router.getRouteInstance().transitionTo({route:"crm.settings.section.users"}):!r.module||Crm.isActivitySplitDone||"Tasks"!=r.module&&"Events"!=r.module&&"Calls"!=r.module?Lyte.Router.transitionTo({route:"crm.tab.module",dynamicParams:[s]}):Lyte.Router.transitionTo({route:"crm.tab.module",dynamicParams:["Activities"]}))}if("1"===t.queryParams.step)Import.reset();else{if("fileUpload"===t.queryParams.step||r&&"sourceType"===r.currStep)return void $("#show").html(e);if("showOperation"===t.queryParams.step){var o=Import.parentModule,n=Import.parentId,l=$("#charSetAutoDetect");if(l&&l.length>0&&(Import.charSet=l.val()),"Notes"==i||o&&"PriceBooks"==o&&n)Import.skipShowOperation();else{$("#importContainerDiv").css("overflow","auto"),Import.importNotCompleted=!0;var c=$("#sendUserInvitation");$("#ImportDiv, #fileInput, #importMappingDiv, #advanceOptions").hide(),c.hide(),$("#fileUploadSuccuessDiv").addClass("dN"),Import.enableDisableImportOperation(),$("#importOptions").show(),$("#operationPageFileName").text(Import.shortenFileName),Import.showAndPopulateOperationOptions(e),setTimeout((function(){$("input[name=chooseOperation]")[0].focus()}),100),!Import.operation||"overwrite"!==Import.operation&&"overwriteOnly"!==Import.operation?($("#ignoreEmptyDiv").hide(),"Users"===Import.currModule&&c.css("display","block")):($("#ignoreEmptyDiv").show(),Import.toggleFindBy(Import.operation)),"true"===$("#isZCampaignImport")[0].value&&Import.toggleFindBy("overwrite",document.getElementById("importOptionBoth"))}return}if("fieldMapping"===t.queryParams.step){o=Import.parentModule,n=Import.parentId;var d=$("#findBy").val(),u=$("#operation").val();if(Import.operation=u,Import.findByColumn=d,e.hasOwnProperty("FILEDATA")){Import.importNotCompleted=!1,(t={}).module=i,o&&""!=o&&(t.parentModule=o),n&&""!=n&&(t.parentId=n),t.calleeObj="Import",t.clickId="importbtnRevamp",t.id=a,t.step="fieldMapping",Import.importNotCompleted=!0,Import.currModule=i,$("#ImportDiv, #fileInput, #importOptions, #advanceOptions").hide(),$("#fileUploadSuccuessDiv").addClass("dN"),("Notes"==Import.currModule||"Products"==Import.currModule&&null!==Import.parentModule)&&$("#mappingSubmitBtn").val(I18n.getMsg("crm.button.import")),$("#importMappingDiv").show(),$("#mappingPagefileName").text(Import.shortenFileName),!Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM||"L"==Crm.userDetails.LICENSE_TYPE||Import.cfNotAllowedModules.indexOf(Import.currModule)>=0||"Products"===Import.currModule&&Import.parentModule&&"PriceBooks"===Import.parentModule?$("#createFieldButton").hide():$("#createFieldButton").show(),e.hasOwnProperty("LINKING_FIELDS")&&(Import.linkingFieldLabels=e.LINKING_FIELDS),Import.defaultValueSupportedModule.indexOf(Import.currModule)>=0||Import.currModule.startsWith("LinkingModule")||Import.currModule.startsWith("CustomModule")?$("#fieldMappingSectionDiv").show():$("#fieldMappingSectionDiv").hide(),Import.fieldsJson=e.FIELDS,Import.populateFieldMapping(e.FILEDATA),Import.populateCRMFields(e.FIELDS),Import.populateDataFormat(),Import.showFields("All",$("#allFields"));var m=$(".ITF-container"),p=$(window).height()-m.offset().top-$(".footerTableCon").height();m.height(p),Import.FixedHeaderFunct("ITF-container"),$(".ITF-container .itb-body-class").height(p-$(".ITF-container .itb-header-class").outerHeight()),Import.importFieldContainer(),(h=$("#importContainerDiv")).on("keydown",Import.mappingKeyEvent);var g=$(".ITF-container .itb-body-class tbody tr:first-child").find("td:nth-child(2) div.dropDownIcon");if(g.addClass("crmFieldMappingHoverClass"),Import.currentFieldmap=g.find("#fieldChoose"),!Import.fileExtension||"csv"!==Import.fileExtension&&"vcf"!==Import.fileExtension)$(".charsetInfoIcon").hide();else{var f=$("#charSetAutoDetect option[value='"+Import.charSet+"']").text();$("#charSetInMapping").text(f),$(".charsetInfoIcon").show()}Import.fieldAutoMapping(e.FIELDS,e.PREVIOUSMAPPING,!1),Import.setMappedFieldListInDropdown(),h.css("overflow","hidden")}else crmui.showMsgBand("error",I18n.getMsg("crm.import.unexpected.error.file"),5e3);return void Import.enableAndDisableButton(["operationCancelBtn","operationSubmitBtn"],"enable")}if("showOptions"===t.queryParams.step&&r&&"submitMapping"===r.currStep){var h;(h=$("#importContainerDiv")).css("overflow","auto"),Import.importNotCompleted=!0,$("#ImportDiv, #fileInput, #importOptions, #importMappingDiv").hide(),$("#workflowOptionDiv, #workFlowExecutionDiv, #leadSourceOptionDiv, #ownerOptionDiv, #recordOwnerDropDownDiv, #recordUserOptionDiv, #assignmentRuleOptionDiv, #enableApproveOption, #tagConfig").hide();var y=!1;if("overwriteOnly"===Import.operation||"Leads"!=Import.currModule&&"Contacts"!=Import.currModule&&"Cases"!=Import.currModule&&!Import.currModule.startsWith("CustomModule")||(y=!0,$("#enableApproveOption").show()),(e.hasOwnProperty("WORKFLOW")||e.hasOwnProperty("WORKFLOW_RULES")||e.hasOwnProperty("LEADSOURCE")||e.hasOwnProperty("TAGS"))&&(y=!0,Import.showWorkflowAndLeadSourceOption(e)),"overwriteOnly"!==Import.operation&&Crm.userDetails.permissions.hasOwnProperty("Crm_Implied_Change_Owner_"+Import.currModule)&&Crm.userDetails.permissions["Crm_Implied_Change_Owner_"+Import.currModule])if(e.hasOwnProperty("OWNER")&&Object.keys(e.OWNER).length>1||(e.hasOwnProperty("OWNER")&&Object.keys(e.OWNER).length>1||!e.hasOwnProperty("OWNER"))&&e.hasOwnProperty("LARENTRY")){y=!0,Import.showOwnerAndAssignmentRuleOption(e);var v=$("input[name=recordOwnerOption]:checked").val();!v||"users"!=v&&"assignmentRules"!=v||Import.showHideOptionsInImportLastPage(v)}else $("#ownerOptionDiv").hide();return y?($("#advanceOptionPagefileName").text(Import.shortenFileName),$("#advanceOptions").show()):Import.submitImport(),h.off("keydown",Import.mappingKeyEvent),void Import.enableAndDisableButton(["mappingPreviousBtn","mappingSubmitBtn"],"enable")}if("showOptions"===t.queryParams.step&&r&&"submitImport"===r.currStep){freezeBackground();var _=Import.currModule;s=Import.currModule;moduleRecordMapping[_]&&(_=moduleRecordMapping[_].plural_label);var b=I18n.getMsg("crm.import.schedule.success.msg",$ESAPI.encoder().encodeForHTML(_)),w=$("#ImportScheduleMessageDiv");w.find("#heading").html(b),w.show(),w.addClass("showPpTop");var C=$("#importSuccessOKBtn");return setTimeout((function(){C.addClass("popupFocusing").focus()}),100),setTimeout((function(){C.trigger("click")}),5e3),r.parentModule&&""!=r.parentModule&&(s=r.parentModule),void("Users"===s?Lyte.Router.getRouteInstance().transitionTo({route:"crm.settings.section.users"}):!Import.currModule||Crm.isActivitySplitDone||"Tasks"!=Import.currModule&&"Events"!=Import.currModule&&"Calls"!=Import.currModule?Lyte.Router.transitionTo({route:"crm.tab.module",dynamicParams:[s]}):Lyte.Router.transitionTo({route:"crm.tab.module",dynamicParams:["Activities"]}))}}return{outlet:"#show",html:e}},afterRender:function(e,t){$("#fileInput").addClass("helpOverflowHide")},beforeExit:function(){var e=$("#dataTypeDropdown").find("select");e&&e.length>0&&thirdPartyUtils.unbindSelect2(e);var t=$("#polymorphic_modules");t&&t.length>0&&thirdPartyUtils.unbindSelect2(t);var r=$("#polymorpicLookupFieldFindBy");r&&r.length>0&&thirdPartyUtils.unbindSelect2(r),Import.reset()},actions:{didTransition:function(){var e=Lyte.Router.getRouteInstance().transition.info.queryParams.module;document.getElementsByTagName("crm-tab")[0].setData("selected",moduleRecordMapping[e])},willTransition:function(e){if(e.target.indexOf("crm.settings.import")<0&&Import.importNotCompleted){var t=$("#importContainerDiv");t.off("keydown",Import.mappingKeyEvent),t.off("keydown",Import.customFieldCreationKeyEvent),t.off("keydown",Import.popupKeyEvent)}Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall()),$("#fileInput").removeClass("helpOverflowHide")},onBeforeLoad:function(){var e=this.getQueryParams().module;Crm.userDetails.isStorageLimitReached&&"Users"!=e&&(Crm.showStorageExceedPopup(),this.transition.abort())}}}),Lyte.Router.registerRoute("crm.settings.index",{getResources:function(){var e=networkUtils.returnDependencyFiles(["callswf-announcement.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["callswf-announcement.css"],crmConstants.cssStaticPathForLyte),r=networkUtils.returnDependencyFiles(["plugindeprecation-announcement.js"],crmConstants.jsStaticPathForLyte),i=networkUtils.returnDependencyFiles(["plugindeprecation-announcement.css"],crmConstants.cssStaticPathForLyte),a=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("OldApiNotationPluginDepr")]);return e.concat(t).concat(r).concat(i).concat(a)},beforeModel:function(e){Crm.trackSpotLightAction("Setup - Page Visited"),commonUtils.showHideLoadingDiv(!0)},model:function(){if(!globalSetpJson){var e=[];return e[0]=store.findAll("settings_customization"),e[1]=setup,e[2]=this,{customizationJson:Lyte.resolvePromises(e)}}return globalSetpJson},afterModel:function(e){if(e&&!globalSetpJson){var t=e.customizationJson[1];crmSetup.Permissioned_Setup_Elements=[],this.metaBinding(t)}globalSetpJson||(globalSetpJson=e.customizationJson[0]),this.transition.data&&this.transition.data.fromeditor&&this.cancel_layout_action();for(var r=globalSetpJson.components,i=[],a=[],s=r.length,o=0;o<s;o++)o<4?i.push(r[o]):a.push(r[o]);var n=[];n.push(i),n.push(a);var l={globalSetpJson:n,hignEdDivAvailInSetup:hignEdDivAvailInSetup};this.currentModel=l},renderTemplate:function(){return{outlet:"#show",component:"crm-setup"}},afterRender:function(){var e=$("body");if(this.transition.data&&this.transition.data.fromeditor&&($("#mainMenuTabDiv").show(),$("html").css("overflow","")),this.transition.data&&this.transition.data.hasmsg&&crmui.showMsgBand("error",this.transition.data.hasmsg,4e3),$("html, body")[0].scrollTop=0,commonUtils.showHideLoadingDiv(!1),crmSetup.populateHigherEditionArr(),showHigherEdtnFeatureForUser?crmSetup.initShowFeatures():hignEdDivAvailInSetup&&crmSetup.hideAdvancedFeatures(),this.component.querySelector("lyte-autocomplete input").setAttribute("data-zcqa","setup_search"),this.setTitle(I18n.getMsg("crm.title.setup.revamp",[Crm.partnerName])),showwfcallsannouncement&&$("#wfCallsAnnouncementPop").length<1){var t={brandName:Crm.partnerName,dueDate:wfcallsmigrationdate};Lyte.Component.render("callswf-announcement",t,"body"),$("#wfCallsAnnouncementPop")[0].ltProp({show:!0})}showPluginDeprecationAnnouncement&&$("#setupPageApiDeprBanner").length<1&&Lyte.Component.render("plugindeprecation-announcement",void 0,"#pluginoldapideprnotification"),e.css("overflow-x","hidden"),$(".setupLayout").css("overflow-x","auto")},beforeExit:function(){$("body, .setupLayout").css("overflow-x","")},actions:{willTransition:function(e){0==e.data&&(renderingUtils.displayPermissionDenied(),e.abort());for(var t=registeredEntity.length,r=0;r<t;r++)store.unloadAll(registeredEntity[r])}}},{mixins:["crm-setup-mixin"]}),Lyte.Router.registerRoute("crm.settings.migration",{getDependencies:function(){return networkUtils.returnDependencyFiles(["data-migration-store.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){if("crm.settings.migration"!==this.transition.target){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("datamigration")]),t=networkUtils.returnDependencyFiles(["data-migration-component-general.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles(["data-migration-general.css"],crmConstants.cssStaticPathForLyte);if(Crm.userDetails.RTL_ENABLED)r=networkUtils.returnDependencyFiles(["data-migration-general.css","data-migration-general-rtl.css"],crmConstants.cssStaticPathForLyte);var i=networkUtils.returnDependencyFiles(["zohocrm_import.js",networkUtils.getI18nJSUrl("import")]),a=networkUtils.returnDependencyFiles(["lyte-step.css"],crmConstants.cssStaticPathForLyte);return e.concat(t).concat(r).concat(a).concat(i)}},redirect:function(){if("crm.settings.migration"===this.transition.target||"crm.settings.migration.api-login"===this.transition.target&&$L.isEmptyObject(this.transition.data)){var e={route:"crm.settings.section.data-migration"};Lyte.Router.replaceWith(e).data=objectUtils.cloneObject(this.transition.data)}},getRouteInstruction:function(e,t,r){var i=this.getState(e),a=this.getState(t),s=Lyte.registeredMixins["migration-util"].getFromStore("properTransition");return s||r?(s&&Lyte.registeredMixins["migration-util"].addToStore({properTransition:!1}),"continueWithSameTransition"):"stateA"===a||"Honey!IamYourDaddy"===i||"Honey!IamYourDaddy"===a?"continueWithSameTransition":"stateB"!==i||"stateC"!==a||s?"unknown"===i||i>a?"routeToExit":i<a||i===a?"continueWithSameTransition":"routeToExit":"routeToExit"},getState:function(e){return["crm.settings.section.data-migration","crm.settings.section.import"].indexOf(e)>=0?"stateA":["crm.settings.migration.index.file-upload"].indexOf(e)>=0?"stateB":["crm.settings.migration.index.extract-data"].indexOf(e)>=0?"stateC":["crm.settings.migration.index.map-modules","crm.settings.migration.index.map-fields","crm.settings.migration.index.report-and-review"].indexOf(e)>=0?"stateD":["crm.settings.migration.index.complete"].indexOf(e)>=0?"stateE":e.startsWith("crm.settings.migration.index")?"Honey!IamYourDaddy":"unknown"},actions:{willTransition:function(e){var t=Lyte.Router.getRouteInstance().transition.info.route,r=e.info.route,i=e.data?e.data.status:void 0;switch(this.getRouteInstruction(t,r,i)){case"routeToExit":Lyte.registeredMixins["migration-util"].routeToExit()}}}}),Lyte.Router.registerRoute("crm.settings.section",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-setupsidemenu.js","crm-setup-mixin.js","crm-help-link.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-setupsidemenu.css"],crmConstants.cssStaticPathForLyte),r=e.concat(t);return r=r.concat(networkUtils.returnDependencyFiles(["zohocrm_tabsAndFieldsApiNames.js"]))},afterModel:function(){this.currentModel={globalSetpJson:globalSetpJson,mySetupArray:crmSetup.mySetupArray,sidemenuclass:Crm.isHeadless?"dN":""}},renderTemplate:function(e,t){if(-1==this.transition.target.indexOf("crm.settings.section.manage-tags")&&-1==this.transition.target.indexOf("crm.settings.section.schedule-mass-email")&&-1==this.transition.target.indexOf("crm.settings.section.macro")&&-1==this.transition.target.indexOf("crm.settings.section.autoresponders")&&-1==this.transition.target.indexOf("crm.settings.section.custom-view")&&"crm.settings.section.import"!==this.transition.target&&"crm.settings.import"!==this.transition.target)return{outlet:"#show",component:"crm-setupsidemenu"}},afterRender:function(e,t){$("#setup_new_leftmenuDiv").css({height:$(window).height()-($("#setup_new_leftmenuDiv").offset().top+isChatEnabled?26:0)+"px"}),-1==this.transition.target.indexOf("crm.settings.section.manage-tags")&&-1==this.transition.target.indexOf("crm.settings.section.schedule-mass-email")&&-1==this.transition.target.indexOf("crm.settings.section.macro")&&-1==this.transition.target.indexOf("crm.settings.section.autoresponders")&&-1==this.transition.target.indexOf("crm.settings.section.custom-view")&&"crm.settings.section.import"!==this.transition.target&&"crm.settings.import"!==this.transition.target&&(crmSetup.selectLeftMenu(),$("#setupshow").show(),crmSetup.decideOldOrNewAPIDashboard())},redirect:function(){if("crm.settings.section.settings-wildcard"!==this.transition.target&&"crm.settings.section"!==this.transition.target&&"true"==this.transition.info.queryParams.fromHigherEdition){void 0===crmSetup.setupObject[this.transition.info.route]&&crmSetup.constructSetupObj();for(var e=this.transition.target.split("."),t=(e.splice(0,3),"crm.settings.section"),r=0;r<e.length;r++)if(t=t+"."+e[r],crmSetup.setupObject[t]&&crmSetup.setupObject[t].higherEditionTry){var i=document.location.href,a=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/settings");i=i.substr(i.indexOf(a)+a.length+1),this.replaceWith("crm.settings.section.settings-wildcard",i).data={route:t}}}crmSetup.hasChildRoute(this.transition.info.route)&&crmSetup.redirectFirstChild(this.transition.info.route)},actions:{didTransition:function(){var e=$("#setupInnerLinks");CrmRouter.hiddenSetupRoutes.hasOwnProperty(this.transition.target)||("crm.settings.section.extensions.zoho-extensions.desk"==this.transition.target&&this.transition.data&&"promotab"==this.transition.data.from||this.transition.target.startsWith("crm.settings.section.review-process")||(e.show(),$(".setupleftmenutd").show(),$(".new_setupview").removeClass("newSetupRightShow")),$("#setup_new_ContentDiv").removeClass("workflow_rule"));if(crmSetup.SetHeight_setup_inner_content(),"crm.settings.section.data-sharing.index-data-sharing"===this.transition.target){var t=this.transition.data.ruleId;if(t){var r=$("#sharedRuleRow_"+t);if(0===r.length)crmui.showMsgBand("error",I18n.getMsg("crm.sharing.rules.module.permission"),4e3);else{var i="#viewLimitExceed_"+t,a=$(i),s="crm.sharing.rules.limit.support.contact";if(document.getElementById("sharedRuleRow_"+t).scrollIntoViewIfNeeded(),r.addClass("highlightRow"),setTimeout((function(){r.removeClass("highlightRow")}),2900),this.transition.data.isSkipped){if(this.transition.data.isDeleted&&(s="crm.sharing.rules.limit.support.contact.delete",0===a.length)){(a=document.createElement("span")).setAttribute("id","viewLimitExceed_"+t),a.setAttribute("class","svgIcons ico-warning-small-filled dIB vam mB8 mR7 mT4 cP"),a.setAttribute("onmouseenter","crmui.showTooltip({content:'"+I18n.getMsg(s)+"',position: 'center'})"),a.setAttribute("onmouseleave","crmui.hideTooltip()");var o=document.getElementById("criteriaRuleInfo_"+t);o.insertBefore(a,o.childNodes[0]),a=$(i)}void 0!==a&&(setTimeout(function(){crmui.showTooltip({content:I18n.getMsg(s),position:"center",target:i})}.bind(s,i),1),setTimeout((function(){crmui.toolTip_hide()}),5e3))}}}}var n=this.transition.target;this.transition.data&&this.transition.data.reload&&(this.transition.data.reload=!1,Lyte.Router.getRouteInstance(n).refresh()),"crm.settings.section.settings-wildcard"===n?crmSetup.selectSetupTabByRoute(this.transition.data.route,this.transition.info):crmSetup.selectSetupTabByRoute(n,this.transition.info),"crm.settings.section.sandbox.sandbox-list"===n&&!1===Crm.userDetails.isSandboxCreated&&e.hide(),Lyte.Router.getRouteInstance().title||this.setTitle(I18n.getMsg("crm.title.setup.revamp",[Crm.partnerName])),crmLayout.Resize.Setup()},onError:function(e,t,r){if($("html").addClass("page_initial_loading_hide"),$(".dummy_Body").hide(),e.status===crmConstants.errorStatusCode)return t.abort(),!1;if("string"==typeof e.responseText&&"crm.settings.section"!==t.target){var i=window.location.pathname.split(Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/settings/"))[1];return this.replaceWith("crm.settings.section.section-error",i).data=e.responseText,!1}}}}),Lyte.Router.registerRoute("crm.settings.canvas.begin",{queryParams:["module"],renderTemplate:function(e,t){CustomizationLoader.cvGettingStarted(this.getQueryParams().module)},afterRender:function(e,t){var r=$("#show"),i=r.offset().top,a=(r.offset().left,renderingUtils.windowHeight-(i+50));$("#customizedViewEnable").css({top:i,height:a}),crmLayout.Resize.Setup()}}),Lyte.Router.registerRoute("crm.settings.canvas.clone",{queryParams:["module"],renderTemplate:function(e,t){Customization.cloneView(this.transition.info.dynamicParams[0],this.getQueryParams().module),Crm.trackSpotLightAction("Canvas - Clone View Click",{Module:this.getQueryParams().module}),Crm.client_tracking("Canvas - Clone View Click")}}),Lyte.Router.registerRoute("crm.settings.canvas.create",{queryParams:["module"],renderTemplate:function(e,t){var r=$("#grid3").find(".grid-stack-item");if(r.length){$(r).each((function(e,t){var r=$(t).find(".mapped-field"),i=$(t).find(".cd_field.field_valueHolder");if(0==r.length)$(t).find(".grid-stack-item-content").addClass("basic_edit");else{var a=$L(i).toArray().filter((function(e){return!$(e).hasClass("mapped-field")&&!$(e).parents(".cd_mapping_field").hasClass("mapped-field")}));$(a).addClass("basic_edit")}})),jSortable.galleryDeleteElement();var i={components:jSortable.galleryEachNode(),width:$("#grid3").width()},a=$("#gallerymodule").val();hideAnimatePopup("deletepopup"),Customization.generateView(a,void 0,(function(){null!=i&&(jSortable.cdViewEdit(i,!0,!0),Customization.removeSideBarElements(i.components))}),!0),$("#cvfieldMappingdropdown").remove()}else Customization.generateView(this.getQueryParams().module),Crm.trackSpotLightAction("Canvas - Blank Template Click",{Module:this.getQueryParams().module}),Crm.client_tracking("Canvas - Blank Template Click")}}),Lyte.Router.registerRoute("crm.settings.canvas.edit",{queryParams:["module"],renderTemplate:function(e,t){Customization.loadEditorForEdit(this.transition.info.dynamicParams[0],this.getQueryParams().module),Crm.trackSpotLightAction("Canvas - Edit View Click",{Module:this.getQueryParams().module}),Crm.client_tracking("Canvas - Edit View Click")}}),Lyte.Router.registerRoute("crm.settings.canvas.gallery",{}),Lyte.Router.registerRoute("crm.settings.canvas.manage",{queryParams:["module"],renderTemplate:function(e,t){Customization.manageViews(this.getQueryParams().module),Crm.trackSpotLightAction("Canvas - Manage View Click",{Module:this.getQueryParams().module}),Crm.client_tracking("Canvas - Manage View Click")}}),Lyte.Router.registerRoute("crm.settings.canvas.gallery.list",{queryParams:["module"],model:function(e,t){var r={feature:"ListView",module:this.getQueryParams().module};return networkUtils.lyteInitiateRequest("/crm/v2/customization/views/viewsbygroup","GET",{params:r})},renderTemplate:function(e,t){LVCGallery.render(this.getQueryParams().module,e)}}),Lyte.Router.registerRoute("crm.settings.canvas.gallery.mapping",{}),Lyte.Router.registerRoute("crm.settings.migration.api-login",{getResources:function(){var e=networkUtils.returnDependencyFiles(["data-migration-component-api-login.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["data-migration-api-login.css"],crmConstants.cssStaticPathForLyte);if(Crm.userDetails.RTL_ENABLED)t=networkUtils.returnDependencyFiles(["data-migration-api-login.css","data-migration-general-rtl.css"],crmConstants.cssStaticPathForLyte);return e.concat(t)},model:function(){if(this.transition.data&&this.transition.data.details)return this.transition.data.details},afterModel:function(e){var t,r,i,a,s=e.source_system,o={};switch(o.step="abort",s?s.toLowerCase():void 0){case"hubspot":t="crm.migration.source.hubspot",r="migLogoHub",i="HubSpot",a="https://api.hubapi.com";break;case"pipedrive":t="crm.migration.source.pipedrive",r="migLogoPipe",i="pipeDrive",a="https://api.pipedrive.com";break;case"insightly":t="crm.migration.source.insightly",r="migLogoInsight",i="Insightly",a="https://api.insight.ly";break;case"zohocontactmanager":case"zcontactmanager":t="crm.migration.source.contactManager",r="migLogoCntManager",i="ZohocontactManager";break;case"highrise":t="crm.migration.source.highrise",r="migLogoHigh",i="Highrise"}this.currentModel={source_system:s,source_type:e.source_type,portal_name:e.portal_name,portal_status:e.portal_status,abort_step:o,display_name:t,logo_class:r,server_source_const:i,default_instance_url:a}},renderTemplate:function(){return{outlet:"#show",component:"crm-dm-api-login"}},afterRender:function(){this.fileUploadApiMode()}},{mixins:["migration-util"]}),Lyte.Router.registerRoute("crm.settings.migration.index",{getResources:function(){return networkUtils.returnDependencyFiles(["data-migration-component-nav-bars.js"],crmConstants.jsStaticPathForLyte).concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles()))},model:function(){var e=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],t=store.peekRecord("migration",e);if(!t||!t.source_system)return Lyte.resolvePromises({migration:store.findRecord("migration",e).then(function(e){if(!this.getFromStore("sourceModules")){var t={source:e.source_system.toLowerCase()};store.findAll("dummy",t,!1,!1,{url:"crm/bulk/v2/migration/settings/modules"}).then(function(e){return this.addToStore({sourceModules:e.modules})}.bind(this))}}.bind(this))});if(!this.getFromStore("sourceModules")){var r={source:t.source_system.toLowerCase()};store.findAll("dummy",r,!1,!1,{url:"crm/bulk/v2/migration/settings/modules"}).then(function(e){return this.addToStore({sourceModules:e.modules})}.bind(this))}},actions:{onError:function(e,t,r,i){"model"===i&&(t.resume(),Lyte.Router.replaceWith({route:"crm.settings.section.data-migration"}).data={step:"error"})}},afterModel:function(e){var t,r=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],i=(e=store.peekRecord("migration",r)).status?e.status:e.state;switch(i){case"UPLOAD":t=0;break;case"FILEPRCS":t=999;break;case"PENDING":if(this&&this.transition.target)switch(this.transition.target.substring(this.transition.target.lastIndexOf("."))){case".map-fields":t=2;break;case".report-and-review":t=3;break;default:t=1}else t=1;break;case"INITIATE":case"ABORT":case"STARTED":t=4;break;default:return}2===e.source_type&&(t=5),this.currentModel={step:t,id:e.id,state:i,source_type:e.source_type,notify:e.notify}},redirect:function(e){if($L.isEmptyObject(this.transition.data)){if(!e||e&&(!e.migration||!e.state)){var t=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];e=store.peekRecord("migration",t)}this.redirectMigrationBasedOnCurrentStatus(e,this)}},renderTemplate:function(){return{outlet:"#show",component:"crm-dm-nav-bars"}},afterRender:function(){this.migContentHeight()},beforeExit:function(){this.resetFullMigration()}},{mixins:["migration-util"]}),Lyte.Router.registerRoute("crm.settings.migration.index.complete",{getResources:function(){var e=networkUtils.returnDependencyFiles(["data-migration-component-complete.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["data-migration-complete.css"],crmConstants.cssStaticPathForLyte);if(Crm.userDetails.RTL_ENABLED)t=networkUtils.returnDependencyFiles(["data-migration-complete.css","data-migration-general-rtl.css"],crmConstants.cssStaticPathForLyte);var r=networkUtils.returnDependencyFiles(["lyte-tree.js"],crmConstants.jsStaticPathForLyte),i=networkUtils.returnDependencyFiles(["lyte-tree.css"],crmConstants.cssStaticPathForLyte);return e.concat(t).concat(r).concat(i)},model:function(){return store.findRecord("migration",Lyte.Router.getRouteInstance().transition.info.dynamicParams[0])},afterModel:function(e){var t;switch(e.completeData=this.setCompleteTreeData(e,!0),e.state){case"COMPLETED":t="migSuccess";break;case"ABORT":for(var r=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],i=store.peekAll("migration-module"),a=i.length,s=!1,o=0;o<a;o++){var n=i[o];if(n.data_migration.id===r&&"FAILED"===n.status){s=!0;break}}s?t="migFailed":(t="migHalt",e.abortModule=e.completeData.abortModule);break;default:t="migRunning"}e.flag=t},renderTemplate:function(){return{outlet:"#migContentOuter",component:"crm-dm-complete"}},afterRender:function(e){2===e.source_type?this.updateNavigationStep(5,5):this.updateNavigationStep(4,4);var t=$L("crm-dm-wizard-steps")[0].component;"ABORT"!==e.status&&"COMPLETED"!==e.status||t.setData("showEditMigration",!1)},actions:{didTransition:function(){$L("crm-dm-feature-title")[0].component.getData("isMigrationComplete")&&$L(".lstep").find("lyte-step-item").eq(4).removeClass("lyteActive").addClass("lyteCompleted")}}},{mixins:["migration-util","migration-constants"]}),Lyte.Router.registerRoute("crm.settings.migration.index.extract-data",{getResources:function(){var e=networkUtils.returnDependencyFiles(["data-migration-component-extract-data.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["data-migration-extract-data.css"],crmConstants.cssStaticPathForLyte);if(Crm.userDetails.RTL_ENABLED)t=networkUtils.returnDependencyFiles(["data-migration-extract-data.css","data-migration-general-rtl.css"],crmConstants.cssStaticPathForLyte);return e.concat(t)},model:function(){var e=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];return store.peekRecord("migration",e)?store.peekRecord("migration",e):store.findRecord("migration",e)},afterModel:function(e){this.updateNavigationStep(0,999);var t=$("<div/>").html(Crm.userDetails.EMAIL).text(),r=e.notify,i=!1;this.transition.data&&"extract"===this.transition.data.api&&(i=!0),this.currentModel={notify:r,user_mail:t,api:i}},renderTemplate:function(){return{outlet:"#migContentOuter",component:"crm-dm-extract-data"}}},{mixins:["migration-util"]}),Lyte.Router.registerRoute("crm.settings.migration.index.file-upload",{getResources:function(){var e=networkUtils.returnDependencyFiles(["data-migration-component-file-upload.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["data-migration-file-upload.css"],crmConstants.cssStaticPathForLyte);if(Crm.userDetails.RTL_ENABLED)t=networkUtils.returnDependencyFiles(["data-migration-component-file-upload.css","data-migration-general-rtl.css"],crmConstants.cssStaticPathForLyte);return e.concat(t)},model:function(){var e=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];return store.peekRecord("migration",e)?store.peekRecord("migration",e):store.findRecord("migration",e)},afterModel:function(e){var t=e.details?e.details:e,r=e.uploadedfiles?e.uploadedfiles:t.uploadedfiles,i=e.source_system?e.source_system:t.source_system,a=e.character_encoding?e.character_encoding:t.character_encoding;this.currentModel={list_of_uploaded_files:r||[],source_system:i.toLowerCase(),charset:a}},renderTemplate:function(){return{outlet:"#migContentOuter",component:"crm-dm-file-upload"}},afterRender:function(e){this.updateNavigationStep(0,0);var t=e.list_of_uploaded_files;t&&t.length>0&&($L("#browse").addClass("dN"),this.updateWizardStepsAfterFileUpload(!0),$L("#migCsetUpBtn").removeClass("dN"));var r=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],i=Crm.userDetails.USER_ID,a=t?t.length:0;this.bindUploadBtnAndOpts(r,i,a),t.length>0?$("#goSc2")[0].ltProp("disabled",!1):$("#goSc2")[0].ltProp("disabled",!0),this.refreshUploadedFileCnt()}},{mixins:["migration-util","migration-constants"]}),Lyte.Router.registerRoute("crm.settings.migration.index.map-fields",{getResources:function(){var e=networkUtils.returnDependencyFiles(["data-migration-component-map-fields.js","crux-tag.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["data-migration-map-fields.css"],crmConstants.cssStaticPathForLyte);if(Crm.userDetails.RTL_ENABLED)t=networkUtils.returnDependencyFiles(["data-migration-map-fields.css","data-migration-general-rtl.css"],crmConstants.cssStaticPathForLyte);return e.concat(t)},model:function(){var e=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];return store.findRecord("migration",e)},redirect:function(e){var t=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];this.validateMappings($L("crm-dm-wizard-steps")[0].component,e.mapped_modules)||Lyte.Router.replaceWith({route:"crm.settings.migration.index.map-modules",dynamicParams:[t]})},afterModel:function(e){this.transition.data&&(e.transitionData=this.transition.data,e.mapped_modules=this.getMappedModules(e,!0)),e.mapped_modules&&(this.transition.data&&this.transition.data.module?(e.currentModule=this.getFromStore("labelVsApi")[this.transition.data.module],e.currentModuleLabel=this.transition.data.module):(e.currentModule=this.getFromStore("labelVsApi")[e.activeModule],e.currentModuleLabel=e.activeModule))},renderTemplate:function(){return{outlet:"#migContentOuter",component:"crm-dm-map-fields"}},afterRender:function(){if(this.hideOptionToSwitchTab(),this.updateNavigationStep(2,2),this.setWizardSteps(),this.fieldMapTableHgt(),document.querySelector("crm-dm-feature-title").component.setData({migModuleMapTour:!1,migFieldMapTour:!0}),this.transition.data&&this.transition.data.module){var e=$L("#fieldsModuleList");e.find("li").removeClass("field_map_item_active"),e.find("li[data-modulename='"+this.transition.data.module+"']").addClass("field_map_item_active");var t=$L(".field_map_item_active").position().top;e.scrollTop(t)}else{var r=$L("#fieldsModuleList"),i=r.outerHeight(),a=$L(".field_map_item_active").next("li"),s=41*($(a).index()+1);s>i&&r.scrollTop(s-82)}this.showMigrationBackdrop()}},{mixins:["migration-util","migration-constants"]}),Lyte.Router.registerRoute("crm.settings.migration.index.map-modules",{getResources:function(){var e=networkUtils.returnDependencyFiles(["data-migration-component-map-modules.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["zohocrm_crmclient_initialimages.js"]);e=e.concat(t);var r=networkUtils.returnDependencyFiles(["data-migration-map-modules.css"],crmConstants.cssStaticPathForLyte);if(Crm.userDetails.RTL_ENABLED)r=networkUtils.returnDependencyFiles(["data-migration-map-modules.css","data-migration-general-rtl.css"],crmConstants.cssStaticPathForLyte);return e.concat(r)},model:function(){var e=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];store.unloadAll("migration-module");var t="crm/bulk/v2/migration/"+e+"/files";return Lyte.resolvePromises({migration:store.findRecord("migration",e),fileInfo:store.findAll("dummy",void 0,!1,!1,{url:t})})},actions:{onError:function(e,t,r,i){if("model"===i){Lyte.registeredMixins["migration-util"].addToStore({properTransition:!0}),t.resume(),this.routeToIndexRoutes("crm.settings.migration.index.file-upload",Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],{step:"error"});var a=$L("crm-dm-wizard-steps")[0].component;a.setData("errorMessage",I18n.getMsg("crm.migration.general.error")),a.setData("showError",!0)}}},afterModel:function(e){var t=e.fileInfo;t.unmapped_files||(t=this.convertToSupportedFormat(e.fileInfo,"files"),this.addToStore({files:t}));var r=this.setTemplateData(e.migration,t);if(r){var i=r.modules,a=0,s=0,o=0;for(var n in i)i[n]&&(i[n].files&&i[n].files.length>0?a+=1:s+=1,o+=1);var l="all";0===this.getFromStore("files").unmapped_files.length&&(l="mapped"),this.currentModel={filesVsModules:r.filesVsModules,modules:r.modules,response:r.response,unmapped_files:t.unmapped_files,mapped_files:t.mapped_files,unsupported_files:t.unsupported_files,show_pop_over:!1,total_modules:o,mapped_modules:a,unmapped_modules:s,filter:l}}},renderTemplate:function(){return{outlet:"#migContentOuter",component:"crm-dm-map-modules"}},afterRender:function(e){this.removeMigrationBackdrop();var t=this.getFromStore("files");this.refreshGraphInModules(t.unmapped_files?t.unmapped_files.length:0,t.unsupported_files?t.unsupported_files.length:0,t.mapped_files?t.mapped_files.length:0,t.empty_files?t.empty_files.length:0),"mapped"===e.filter?this.showActiveModuleFilter($L(".migFieldFilterOuter").find("lyte-tab-title").eq(1)):this.showActiveModuleFilter($L(".migFieldFilterOuter").find("lyte-tab-title").first()),this.updateNavigationStep(1,1),$L("#listUnMapped").find("li").length&&this.dragAndDropModule(),document.querySelector("crm-dm-map-modules").component.methods.checkforNofiles(),0!==parseInt($L("#unMappedCount").text())&&document.querySelector("#migUnmapped").click(),t.unmapped_files&&t.mapped_files&&0===t.unmapped_files.length&&t.unmapped_files.length===t.mapped_files.length&&document.querySelector("crm-dm-folder-list").component.setData("noModuleMapped",!0),document.querySelector("crm-dm-feature-title").component.setData({migModuleMapTour:!0,migFieldMapTour:!1})}},{mixins:["migration-util","migration-constants"]}),Lyte.Router.registerRoute("crm.settings.migration.index.report-and-review",{getResources:function(){var e=networkUtils.returnDependencyFiles(["data-migration-component-report-and-review.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["data-migration-report-and-review.css"],crmConstants.cssStaticPathForLyte);if(Crm.userDetails.RTL_ENABLED)t=networkUtils.returnDependencyFiles(["data-migration-report-and-review.css","data-migration-general-rtl.css"],crmConstants.cssStaticPathForLyte);return e.concat(t)},model:function(){var e=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],t="crm/bulk/v2/migration/"+e+"/files";return Lyte.resolvePromises({migration:store.findRecord("migration",e),fileInfo:store.findAll("dummy",void 0,!1,!1,{url:t})})},afterModel:function(e){var t=e.fileInfo;t.unmapped_files||(t=this.convertToSupportedFormat(e.fileInfo,"files"),this.addToStore({files:t}));var r=this.processReport(e.migration,t.mapped_files);r&&(this.currentModel={mapped_file_count:t.mapped_files.length,unmapped_file_count:t.unmapped_files.length,unsupported_file_count:t.unsupported_files.length,empty_file_count:t.empty_files.length,moduleVsFieldMappingCount:r,migration:e.migration,mapped_modules:this.getMappedModules(e.migration)})},redirect:function(e){var t=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];this.validateMappings($L("crm-dm-wizard-steps")[0].component,e.mapped_modules)||Lyte.Router.replaceWith({route:"crm.settings.migration.index.map-modules",dynamicParams:[t]})},renderTemplate:function(){return{outlet:"#migContentOuter",component:"crm-dm-report-and-review"}},afterRender:function(e){document.querySelector("crm-dm-feature-title").component.setData({migModuleMapTour:!1,migFieldMapTour:!1}),this.updateNavigationStep(3,3),this.showFieldPies(e.moduleVsFieldMappingCount),this.removeMigrationBackdrop()}},{mixins:["migration-util","migration-constants"]}),Lyte.Router.registerRoute("crm.settings.section.abtesting",{getDependencies:function(){return networkUtils.returnDependencyFiles(["webform.js","webform-model.js","abtesting.js","crm-webform-abtesting-config.js","abtesting-model.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["abtesting-common.css"],crmConstants.cssStaticPathForLyte),t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("webforms")],crmConstants.jsStaticPath).concat(e),r=networkUtils.returnDependencyFiles(["zohocrm_analytics.js"],crmConstants.jsStaticPath),i={parent:networkUtils.returnDependencyFiles(["zohocrm_chart.js"],crmConstants.jsStaticPath),child:[r,networkUtils.returnDependencyFiles(["zohocrm_webformAnalytics_chartRenderer.js"],crmConstants.jsStaticPath)]};return Crm.isZohoChartsEnabled?t=t.concat(networkUtils.returnDependencyFiles(["webform-zcharts-handler.js"],crmConstants.jsStaticPathForLyte)):(i.parent=i.parent.concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles())),t=t.concat(networkUtils.returnDependencyFiles(["webform-highcharts-handler.js"],crmConstants.jsStaticPathForLyte))),t.concat(i)},redirect:function(){if("crm.settings.section.abtesting"==this.transition.target){Crm.client_tracking("WF AB Test - A/B Testing Tab");var e=Object.assign({},this.transition.info);e.route="crm.settings.section.abtesting.index-abtesting",this.replaceWith(e)}},beforeExit:function(){store.unloadAll("webform"),store.unloadAll("abtesting"),Crm.userDetails.RTL_ENABLED&&(Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-webform-rtl.css"],crmConstants.cssStaticPathForLyte)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["webform-builder-RTL.css"],crmConstants.cssStaticPathForLyte)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["webform-builder.css","crm-alert-addresswrapper.css"],crmConstants.cssStaticPathForLyte)))},actions:{willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||["zh","ja","pt","de","es","fr"].contains(Crm.userDetails.LOCALE.substr(0,2))||isMobileBrowser()||"function"!=typeof ZohoHCAsap||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall())}}}),Lyte.Router.registerRoute("crm.settings.section.activate-users",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-userdelete-confirm.js"],crmConstants.jsStaticPathForLyte);return networkUtils.returnDependencyFiles(["crm-userdelete-confirm.css"],crmConstants.cssStaticPathForLyte).concat(e)},model:function(e){var t=null!=this.transition.data.actionType?{params:this.transition.data}:{params:{actionType:"LicenseUsers",fromIndex:0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/License.do","LicenseUsersUpdate"===t.params.actionType?"POST":"GET",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(){setTimeout((function(){var e="",t=$(".activeUserListFixedHead"),r=$("#mainMenuTabDiv").height(),i=$("#setupInnerLinks").height(),a=$(".activeUserList");if(a.is(":visible")){var s=a.offset().top-(r+i),o=$("#setup_new_ContentDiv");o[0].addEventListener("scroll",(function(){var e=Math.round(o.scrollTop()),t=Math.round(o.height()),r=Math.round($("#result").height()),i=$(".activeUserListFixedHead");o.scrollTop()>=s?i.show():i.hide(),Crm.menu.setupScrollBind=!0;var a=$("#isToTriggerNextRequest").val();if(e+t>=r-48&&"true"===a&&void 0!==getObj("actionType")){var n={actionType:getObj("actionType").value,fromIndex:parseInt($("#fromIndexCnt").val())};networkUtils.makeRequest(Crm.getCrmBasePath()+"/License.do","GET",{params:n,success_callback:function(e){$("#activateUsersTable > tbody").append(e);var t=$("#preUserCount");t.val(parseInt(t.val())+parseInt($("#currentPreUserCnt").val())),$("#tempUserCount").val(parseInt(t.val()));var r=$("#totalUserCount");r.val(parseInt(r.val())+parseInt($("#currentUserObjCnt").val()))}})}else"false"==a&&null!=getObj("actionType")&&($(".showOnEnd").removeClass("dN"),$(".licenseUsersUpdate").removeClass("dN"))}))}var n=a.outerWidth();a.find("th").each((function(){var t=$(this),r=Math.round(t.outerWidth()),i=t.text();e=e+'<th style="width:'+r+'px ">'+i+"</th>"})),t.find("tr").html(e),t.css({top:r+i,width:n})}),50)}}),Lyte.Router.registerRoute("crm.settings.section.admincenter",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-admincenter.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AdminCenter")],crmConstants.jsStaticPath))},model:function(e){e.features={};var t=networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/AdminCenter.do","GET",{params:{action:"getInitData"}});return e.features=t,e},afterModel:function(e){this.currentModel={},this.currentModel.showGetStarted=e.features.showGetStarted;for(var t=e.features.supportedFeatures,r=[{apiName:"templates",display:I18n.getMsg("crm.label.templates"),system:"templates",singular:I18n.getMsg("crm.email.label.template"),qp:{feature:"templates"}},{apiName:"custom_views",display:I18n.getMsg("setupsearch.customviews"),system:"customView",singular:I18n.getMsg("crm.label.customview"),qp:{feature:"customView"}},{apiName:"workflows",display:I18n.getMsg("crm.label.workflows"),system:"workflow",singular:I18n.getMsg("Workflow"),qp:{feature:"workflow"}},{apiName:"reports",display:moduleRecordMapping.Reports.plural_label,system:"reports",singular:moduleRecordMapping.Reports.singular_label,qp:{feature:"reports"}}],i=r.length,a=[],s=0;s<i;s++){var o=r[s].system;t[o]&&t[o].isVisible&&a.push(r[s])}this.currentModel.featuresNames=a},renderTemplate:function(){"crm.settings.section.admincenter"===this.transition.target&&this.replaceWith("crm.settings.section.admincenter.index-admincenter")},beforeExit:function(){store.unloadAll("admincenter_history"),store.clearCachedQuery("admincenter_history"),store.unloadAll("admincenter_usage"),store.clearCachedQuery("admincenter_usage")},actions:{onError:function(e){return e.status?(405===e.status?Lyte.Router.transitionTo({route:"crm.settings.index"}).data={hasmsg:I18n.getMsg("crm.label.insufficient.privileges")}:Lyte.Router.transitionTo({route:"crm.settings.index"}).data={hasmsg:I18n.getMsg("crm.label.widgets.error.internal")},!1):(Lyte.Router.transitionTo({route:"crm.settings.index"}).data={hasmsg:I18n.getMsg("crm.label.error.message1")},!1)}}}),Lyte.Router.registerRoute("crm.settings.section.allowed-ips",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-allowed-ips-common.js"],crmConstants.jsStaticPathForLyte);return Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-allowed-ips-rtl.css"],crmConstants.cssStaticPathForLyte))),e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("allowedips")]))},redirect:function(){"crm.settings.section.allowed-ips"===this.transition.target&&this.replaceWith("crm.settings.section.allowed-ips.index-allowed-ips")},beforeExit:function(){store.unloadAll("allowedip_configuration"),store.unloadAll("allowed_ips"),store.unloadAll("added_ips")},didDestroy:function(){Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-allowed-ips.css"],crmConstants.cssStaticPathForLyte)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-view-configure-ip.css"],crmConstants.cssStaticPathForLyte))}}),Lyte.Router.registerRoute("crm.settings.section.api-graph-view",{queryParams:["period","from","to","type"],getDependencies:function(){var e=networkUtils.returnDependencyFiles(["crm-api-dashboard.js"],crmConstants.jsStaticPathForLyte);return networkUtils.returnDependencyFiles(["zohocrm_apidashboard.js"]).concat(e)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("apidashboard_integrationtasks")]);return networkUtils.returnDependencyFiles(networkUtils.includeChartFiles()).concat(e)},beforeModel:function(e){crmSetup.showRevampedAPIDashboard||this.replaceWith("crm.settings.section.api-settings")},model:function(e){var t={},r=ApiDashboard_DateUtil.getToday();t.from=e.queryParams.from||ApiDashboard_Inputs.from||r,t.to=e.queryParams.to||ApiDashboard_Inputs.to||r,t.version=e.queryParams.type||ApiDashboard_Inputs.version||ApiDashboard_Constants.NEW;var i=ApiDashboard_Constants.period[6];ApiDashboard_Inputs.setPeriod(e.queryParams.period||ApiDashboard_Inputs.period||i),t.period=ApiDashboard_Inputs.period,this.ajaxParams=t;return store.findAll("api_dashboard",{from:t.from,to:t.to,version:t.version,period:t.period})},afterModel:function(e){if(e&&403===e.status&&"NO_PERMISSION"===JSON.parse(e.response).code)return renderingUtils.displayPermissionDenied(),void this.transition.abort();this.currentModel={api_dashboard:e}},renderTemplate:function(e,t){return networkUtils.initChart(),{outlet:"#result",html:""}},afterRender:function(e,t){ApiDashboard_Inputs.from=this.ajaxParams.from,ApiDashboard_Inputs.to=this.ajaxParams.to,ApiDashboard_Inputs.version=this.ajaxParams.version,TabsAndFieldsApiNames.setOptionForUsageAndModuleFields(void 0,"?action=topUsage"),ApiResponse.validate(e)?(ApiResponse.api_dashboard_response=e,ApiDashboard_Loader.loadAllChartsWithTimer()):(ApiDashboard_Loader.currentPage=ApiDashboard_Constants.TOP_USAGE,ApiError.throwError(ApiDashboard_Constants.API_DASHBOARD)),this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.api.title",Crm.partnerName),Crm.partnerName]))},actions:{onError:function(e,t,r,i){return t.resume(),!1}}}),Lyte.Router.registerRoute("crm.settings.section.api-module-detail",{queryParams:["step","layoutId"],beforeModel:function(e){"FieldsList"!=e.queryParams.step&&"RelatedList"!=e.queryParams.step&&this.transition.abort()},model:function(e){var t=Crm.getCrmBasePath()+"/EntityFieldCustomize.do";this.ajaxUrl=t;var r={};r.module=e.dynamicParam,r.isDeveloperSpace=!0,r.isModuleListNeeded=!0,r.isFromModule=!0,"RelatedList"==e.queryParams.step&&(r.isRelatedList=!0),e.queryParams.layoutId&&(r.layoutId=e.queryParams.layoutId);var i={params:r};return networkUtils.lyteInitiateRequest(t,"GET",i)},renderTemplate:function(e,t){return{outlet:"#result",html:""}},afterRender:function(e,t){TabsAndFieldsApiNames.setOptionForUsageAndModuleFields(e,this.ajaxUrl,t.dynamicParam)},actions:{willTransition:function(){var e=this.getDynamicParam();e&&moduleRecordMapping[e]&&(this.unloadProperty("field",store.peekRecord("module",moduleRecordMapping[e].id).fields),store.unloadAll("filter"))}}},{mixins:["crm-module-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.api-modules",{model:function(e){var t={action:"moduleList",isDeveloperSpace:!0},r={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","GET",r)},renderTemplate:function(e,t){return{outlet:"#result",html:""}},afterRender:function(e,t){TabsAndFieldsApiNames.setOptionForUsageAndModuleFields(e,"?action=moduleList")}}),Lyte.Router.registerRoute("crm.settings.section.api-paid",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_apidashboard.js"]),t=[];t.push("crm-api-paid.css"),Crm.userDetails.RTL_ENABLED&&t.push("crm-api-paid-rtl.css");var r=networkUtils.returnDependencyFiles(t,crmConstants.cssStaticPathForLyte),i=networkUtils.returnDependencyFiles(["crm-api-credit.js","lyte-dateselect.js","lyte-daterangepicker.js"],crmConstants.jsStaticPathForLyte),a=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("payperapi")]);return e.concat(r).concat(i).concat(a)},model:function(){return store.findAll("dummy",null,!1,!1,{url:"crm/v2/settings/api_dashboard/paid_credits"})},actions:{onError:function(e){if("NO_PERMISSION"===JSON.parse(e.response).code)return $(".dummy_Body").hide(),renderingUtils.displayPermissionDenied(),!1}},afterModel:function(e){var t=e.paid_credits;if(t.slab_details){var r=t.slab_details.length;$.each(t.slab_details,(function(e,t){var i=I18n.getMsg("Next");0===e?i=I18n.getMsg("First"):e===r-1&&(i=I18n.getMsg("zc.editor.table.rowabove"));var a="",s=t.count/1e3;a=s>=1e3?s/1e3+"M":s+"K",t.display_value=i+" "+a}))}t.total_limit=t.api_limit+t.paid_limit,t.enabled&&(t.unused=t.paid_limit-t.last_24_hours);for(var i=t.paid_limit,a=0,s=!0,o=(r=t.slab_details.length,0);o<r&&s;o++){var n=t.slab_details[o],l=n.count;i>l?(a+=n.amount*l/1e3,i-=l):(a+=n.amount*i/1e3,s=!1)}t.currency_symbol=currencyUtils.getCurrencySymbol(t.currencycode),t.billing_date_display=Utils.convertDateToUserPattern(t.billing_date),t.billing_period.from_display=Utils.convertDateToUserPattern(t.billing_period.from),t.billing_period.to_display=Utils.convertDateToUserPattern(t.billing_period.to),t.forecast_amount=a.toFixed(2),t.amount||(t.amount=0),t.last_24_hours||(t.last_24_hours=0),t.amount=t.amount.toFixed(2),t.allowed_paid_limit=t.max_limit-t.api_limit,t.allowed_paid_limit=t.allowed_paid_limit>5e5?5e5:t.allowed_paid_limit},renderTemplate:function(e){var t={newDashboard:!0};return t.superAdmin=Crm.userDetails.IS_SUPER_ADMIN&&Crm.userDetails.CANADD_APICREDITS&&Crm.userDetails.ISPAID_USER&&"production"===Crm.userDetails.orgEnvType&&!Crm.userDetails.isTrialEnabled,t.superAdmin?($("#result").html(Handlebars.templates.TabsAndFieldsApiNames(t)),$("#API_pages_container").html(""),CRMAPITopUsage.cloneTabClass(),$("#paidapi").addClass("selHead"),$("#tabClassCloneContainer").show(),$("#tabClassCloneContainer .tabClass").show(),this.currentModel=e.paid_credits,{outlet:"#API_pages_container",component:"crm-billing-postpaid"}):($(".dummy_Body").hide(),renderingUtils.displayPermissionDenied(),!1)}}),Lyte.Router.registerRoute("crm.settings.section.api-settings",{beforeModel:function(e){crmSetup.showRevampedAPIDashboard&&this.replaceWith("crm.settings.section.api-graph-view")},model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/GenerateAPIKey.do","GET",{params:{action:"developerapi"}})},renderTemplate:function(e,t){return{outlet:"#result",html:""}},afterRender:function(e,t){TabsAndFieldsApiNames.setOptionForUsageAndModuleFields(e,Crm.getCrmBasePath()+"/GenerateAPIKey.do"),document.title=I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.api.title",Crm.partnerName),Crm.partnerName])}}),Lyte.Router.registerRoute("crm.settings.section.api-table-view",{queryParams:["period","from","to","type","order"],getDependencies:function(){return networkUtils.returnDependencyFiles(["zohocrm_apidashboard.js"])},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-api-dashboard-integration-tasks.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-api-dashboard-integration-tasks.css"],crmConstants.lessStaticPathForLyte);e.concat(t);var r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("apidashboard_integrationtasks")]);return e=e.concat(r)},beforeModel:function(e){crmSetup.showRevampedAPIDashboard||this.replaceWith("crm.settings.section.api-settings"),CRMAPITopUsage.isLoaded=!1},model:function(e){var t={},r=ApiDashboard_DateUtil.getToday();t.from=e.queryParams.from||ApiDashboard_Inputs.from||r,t.to=e.queryParams.to||ApiDashboard_Inputs.to||r,t.version=e.queryParams.type||ApiDashboard_Inputs.version||ApiDashboard_Constants.NEW;var i=ApiDashboard_Constants.period[6];ApiDashboard_Inputs.setPeriod(e.queryParams.period||ApiDashboard_Inputs.period||i),t.period=ApiDashboard_Inputs.period,e.queryParams.order?t.order=e.queryParams.order:ApiDashboard_Inputs.version===ApiDashboard_Constants.OLD?t.order=ApiDashboard_Constants.defaultOldColumnOrder.toString():ApiDashboard_Inputs.version===ApiDashboard_Constants.NEW&&(t.order=ApiDashboard_Constants.defaultNewColumnOrder.toString()),this.ajaxParams=t;var a={params:t};return networkUtils.lyteInitiateRequest("/crm/v2/settings/api_dashboard/statistics","GET",a)},renderTemplate:function(e,t){return{outlet:"#result",html:""}},afterRender:function(e,t){ApiDashboard_Inputs.from=this.ajaxParams.from,ApiDashboard_Inputs.to=this.ajaxParams.to,ApiDashboard_Inputs.version=this.ajaxParams.version,ApiDashboard_Inputs.version===ApiDashboard_Constants.OLD?(data.oldColumnOrder=this.ajaxParams.order.split(","),data.columnOrder=data.oldColumnOrder):ApiDashboard_Inputs.version===ApiDashboard_Constants.NEW&&(data.newColumnOrder=this.ajaxParams.order.split(","),data.columnOrder=data.newColumnOrder),TabsAndFieldsApiNames.setOptionForUsageAndModuleFields(null,"?action=statistics"),$("#API_summary_page").empty().hide(),$("#API_calls_filter").show(),ApiDashboard_Loader.loadStatisticsPage(),ApiResponse.validate(e)?("true"===ApiResponse.announcement&&$L("#apiNotifyBar").removeClass("dN").addClass("dB"),ApiResponse.statistics_response=e,ApiStatistics.loadStatisticsTable()):ApiError.throwError(),document.title=I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.api.title",Crm.partnerName),Crm.partnerName])},actions:{onError:function(e,t,r,i){return this.currentModel=e.responseJSON,t.resume(),!1}}}),Lyte.Router.registerRoute("crm.settings.section.approval-process",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_workflow.js"]),t=["zohocrm_workflow.js","zohocrm_automationactions_usage.js",networkUtils.getI18nJSUrl("businesshours")],r=networkUtils.returnDependencyFiles(t);return(r=r.concat(fetchWFParamterComponentFiles())).concat(e)},beforeModel:function(){},redirect:function(){"crm.settings.section.approval-process"===this.transition.target&&(this.transition.info.route="crm.settings.section.approval-process.index-approval-process",this.replaceWith(this.transition.info))},actions:{willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||!ZohoHCAsap.UnInstall||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall())}},afterRender:function(){wfmergefield.initMergeFieldDetl("Approval")},beforeExit:function(){wfmergefield.clearMergeFieldDetl(),"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess()}}),Lyte.Router.registerRoute("crm.settings.section.assignment-rule",{queryParams:["module"],getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_workflow.js"]),t=networkUtils.returnDependencyFiles(["assignmentrules.js"],crmConstants.jsStaticPathForLyte).concat(networkUtils.returnDependencyFiles(["assignment-rules-mixin.js"],crmConstants.jsStaticPathForLyte)),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("assignmentrules"),networkUtils.getI18nJSUrl("businesshours")],crmConstants.jsStaticPath),i=networkUtils.returnDependencyFiles(["assignmentrules.css"],crmConstants.cssStaticPathForLyte);return t.concat(i).concat(e).concat(r)},getDependencies:function(){return networkUtils.returnDependencyFiles(["assignment-rule-models.js","assignment-rules-model-wrapper.js"],crmConstants.jsStaticPathForLyte)},beforeModel:function(){},redirect:function(){if("crm.settings.section.assignment-rule"===this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.assignment-rule.index-assignment-rule",this.replaceWith(e)}},beforeExit:function(){store.unloadAll("assignment_rules"),store.unloadAll("assignmentrule_entries")},actions:{willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||!ZohoHCAsap.UnInstall||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall())}}}),Lyte.Router.registerRoute("crm.settings.section.assignment-thresholds",{queryParams:["module"],getResources:function(){var e=networkUtils.returnDependencyFiles(["assignment-thresholds.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("assignmentrestrictions")],crmConstants.jsStaticPath),r=networkUtils.returnDependencyFiles(["assignment-thresholds.css"],crmConstants.cssStaticPathForLyte),i=e.concat(r).concat(t);return Crm.userDetails.RTL_ENABLED&&i.push(networkUtils.returnDependencyFiles(["assignment-thresholds-rtl.css"],crmConstants.cssStaticPathForLyte)),i},redirect:function(){if("crm.settings.section.assignment-thresholds"===this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.assignment-thresholds.index-assignment-thresholds",this.replaceWith(e)}},beforeExit:function(){store.unloadAll("assignment_threshold"),store.unloadAll("assignment_threshold_userdetails")}}),Lyte.Router.registerRoute("crm.settings.section.attributions",{getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_attributions.js"])},model:function(e){return networkUtils.lyteInitiateRequest("/crm/v2/settings/marketing/Attribution/showsetup","GET",{})},afterModel:function(){$("#overlayHeader,#settingInner").hide(),$("#setupshow,#mainResult").show()},renderTemplate:function(e){return{outlet:"#result",html:Handlebars.templates.AttributionCli(e)}},afterRender:function(e){Attribution.refresh_weightagepop=!0,Attribution.showSetupcalback(e);var t=isChatEnabled?28:0,r=$L("#setup_new_ContentDiv"),i=renderingUtils.windowHeight-(r.offset().top+t);r.css({height:i+"px"})},actions:{onError:function(e,t,r,i){if(e.responseJSON&&e.responseJSON.code&&"FEATURE_NOT_SUPPORTED"===e.responseJSON.code)return renderingUtils.displayPermissionDenied(),!1},willTransition:function(e){if(Attribution.isPageModified){var t=e.pause(),r="stayonPageConfirmBox",i=$("#"+r);freezeBackground(),mailsetCenter(r),i.find(".leavePage").off("click").click((function(){$("#"+r).hide(),t.resume(),removeFreezeLayer(),Attribution.isPageModified=!1,void 0!==Attribution.confdetail&&void 0!==Attribution.confdetail.type||Attribution.emptyRemovePotentialStage()})),i.find(".stayPage").off("click").click((function(){$("#"+r).hide(),e.abort(),removeFreezeLayer()})),i.focus()}}}}),Lyte.Router.registerRoute("crm.settings.section.auditlog",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_wfAuditLog.js"]),t=networkUtils.returnDependencyFiles(["crm-auditlog-user.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles(["crm-auditlog-user.css"],crmConstants.cssStaticPathForLyte),i=t.concat(e).concat(r);return i=i.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")]))},model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/AuditLog.do","GET")},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.audit.log"),Crm.partnerName]))},actions:{willTransition:function(){auditLog.clearFliter()}}}),Lyte.Router.registerRoute("crm.settings.section.auto-response-rules",{actions:{didTransition:function(){if("crm.settings.section.auto-response-rules"==this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.auto-response-rules.index-auto-response-rules",this.replaceWith(e)}}}}),Lyte.Router.registerRoute("crm.settings.section.autoresponders",{queryParams:["module","step"],redirect:function(){if("crm.settings.section.autoresponders"==this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.autoresponders.index-autoresponder",this.replaceWith(e)}}}),Lyte.Router.registerRoute("crm.settings.section.bcc-dropbox",{getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_bccDropbox.js"])},model:function(e){var t={params:{action:"userView"}};this.transition.data&&this.transition.data.action&&(t.params.action=this.transition.data.action);var r="regenerate"===t.params.action?"POST":"GET";return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/BCCDropbox.do",r,t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){$("#result").removeClass("crmEmailConfigDiv"),this.transition.data&&"regenerate"==this.transition.data.action&&bccDropBox.showRenegerationSuccessMsg()}}),Lyte.Router.registerRoute("crm.settings.section.blueprint-setting",{queryParams:["action"],getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_zprocess.js",networkUtils.getI18nJSUrl("blueprint"),networkUtils.getI18nJSUrl("businesshours")]),t=networkUtils.returnDependencyFiles(["crm-blueprint-pushinpushout.css"],crmConstants.cssStaticPathForLyte);return e.concat(networkUtils.returnDependencyFiles(["crm-blueprint-pushinpushout.js","crm-blueprint-dependents.js","crm-alert-recipients.js","crm-alert-addresswrapper.js"],crmConstants.jsStaticPathForLyte),t)},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Workflow||(renderingUtils.displayPermissionDenied(),this.transition.abort())},model:function(e){var t=store.peekAll("module").filter((function(e){return e.isBlueprintSupported&&e.editable}));return t.sort((function(e,t){return e.sequence_number>t.sequence_number?1:-1})),{modules:t,action:e.queryParams.action}},renderTemplate:function(){var e=document.querySelector("crm-blueprint-pushinpushout");return e&&e.remove(),{component:"crm-blueprint-pushinpushout",outlet:"#result"}},beforeExit:function(){this.removeFromCache(networkUtils.returnDependencyFiles(["crm-blueprint-pushinpushout.css"],crmConstants.cssStaticPathForLyte))},actions:{onError:function(e){return commonUtils.showHideLoadingDiv(),e.status===crmConstants.limitExceedsCode&&Search.displayLookupExceedsMsg(e),!1},willTransition:function(e){if(this.transition.target!=e.target){var t=document.querySelector("crm-blueprint-pushinpushout");t&&t.remove()}}}}),Lyte.Router.registerRoute("crm.settings.section.blueprint-usage",{queryParams:["action","reportId"],getResources:function(){var e=["zohocrm_zprocess.js","zcrm_selectUser.js",networkUtils.getI18nJSUrl("businesshours")];Crm.isZohoChartsEnabled?e.push("zohocrm_chart.js"):e.push("highcharts.js");var t=networkUtils.returnDependencyFiles(e);return(t=t.concat(networkUtils.returnDependencyFiles(["crm-blueprint-user-dropdown.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-blueprint-user-dropdown.css"],crmConstants.cssStaticPathForLyte))},model:function(e){var t={};t.action=e.queryParams.action||"showAllUsage",t.reportId=e.queryParams.reportId;var r={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ProcessFlow.do","GET",r)},afterModel:function(e,t){networkUtils.initChart();var r=e;if(ProcessBuilder.isReportPreview=!0,r.HELP_LINK=crmConstants.helpUrl["help.domain.url"]+crmConstants.helpUrl["help.process.automation.usage"],"getUsageReport"===t.queryParams.action){var i=new Date;r.StartDay=i.getDate(),r.StartMonth=i.getMonth()+1,r.StartYear=i.getFullYear()}},renderTemplate:function(e,t){var r=null;if("showAllUsage"===t.queryParams.action||null==t.queryParams.action)r=Handlebars.templates.ProcessUsageList(e),$(".setupleftmenutd").show(),$(".new_setupview").removeClass("newSetupRightShow");else if("getUsageReport"===t.queryParams.action){e.isUser=t.queryParams.reportId&&["AvgProcessTime","AvgStateTime","ProcessEntryCount","ProcessExitCount"].indexOf(t.queryParams.reportId)<0,r=Handlebars.templates.ProcessUsageReport(e)}return{outlet:"#result",html:r}},afterRender:function(e,t){var r=e;if("getUsageReport"===t.queryParams.action)if("RecordsBasedDuration"==t.queryParams.reportId&&($("#customDateRange").removeClass("mL20"),$("#customDateRange").addClass("pT10")),"RecordsBasedStatus"!==t.queryParams.reportId&&"RecordsBasedDuration"!=t.queryParams.reportId||$("#noteDiv").show(),ProcessBuilder.addNoneOptionForSelect(),ProcessBuilder.isProcessFlowDiagram(t.queryParams.reportId),"ReportInFlowDiagram"===t.queryParams.reportId)ProcessBuilder.showReportInFlowDia(r,!0);else{var i="process";"AvgStateTime"===t.queryParams.reportId||"RecordsBasedStatus"===t.queryParams.reportId?i="state":"NoOfTransitionOccured"===t.queryParams.reportId&&(i="transition"),r.Result&&r.Result.length>0?Crm.isZohoChartsEnabled?($(".reportGraph").html(""),CrmChartUtil.renderChart(document.querySelector(".reportGraph"),ProcessBuilder.processJsonForZChart(r),!1)):$(".reportGraph").highcharts(ProcessBuilder.processJsonForChart(r,i)):$(".reportGraph").html("<br><br><br><br><div class='f16 aligncenter'>"+I18n.getMsg("crm.data.not.available")+"</div><br><br>")}},beforeExit:function(){var e=$("#processAutomationUsageReport");e.length&&(thirdPartyUtils.unbindChildEvents(e,!0,!0,!0),ProcessBuilder.resetProcessCreateRelatedObjects())}}),Lyte.Router.registerRoute("crm.settings.section.blueprint",{getDependencies:function(){window.module=void 0;var e=networkUtils.returnDependencyFiles(["zohocrm_zprocess.js","zcrm_selectUser.js",networkUtils.getI18nJSUrl("blueprint")]),t=networkUtils.returnDependencyFiles(["crm-blueprint-dependents.css","crm-alert-addresswrapper.css","cloneBlueprint.css"],crmConstants.cssStaticPathForLyte);t=t.concat(networkUtils.returnDependencyFiles(["crm-picklist-colorpicker.css"],crmConstants.cssStaticPathForLyte));var r=networkUtils.returnDependencyFiles(["crm-blueprint-dependents.js","crm-alert-recipients.js","crm-alert-addresswrapper.js","cloneBlueprint.js"],crmConstants.jsStaticPathForLyte);r=(r=r.concat(networkUtils.returnDependencyFiles(["zohocrm_mbuilder.js"]))).concat(networkUtils.returnDependencyFiles(["crm-event-picklist.js","lyte-colorpicker.js"],crmConstants.jsStaticPathForLyte));var i=networkUtils.returnDependencyFiles(["zohocrm_workflow.js"]);return(e=e.concat(t).concat(r).concat([networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("cloneblueprint"),networkUtils.getI18nJSUrl("businesshours")])]).concat(i)).concat(fetchWFParamterComponentFiles())},getResources:function(){return networkUtils.returnDependencyFiles(["crm-tag-bp.js","crux-tag.js"],crmConstants.jsStaticPathForLyte)},beforeModel:function(){networkUtils.initChart()},beforeExit:function(){var e=$("#createProcessContainer");e.length&&(window.removeEventListener("beforeunload",ProcessBuilder.pageReloadChk),thirdPartyUtils.unbindChildEvents(e,!0,!0,!1),ProcessBuilder.resetProcessCreateRelatedObjects()),this.removeFromCache(networkUtils.returnDependencyFiles(["zohocrm_zprocess.js"],crmConstants.jsStaticPath)),"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess()},actions:{willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall())}}}),Lyte.Router.registerRoute("crm.settings.section.booking",{getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_calendarSchedule.js","i18n/"+Crm.userDetails.jsLocation+"calendarschedule/zohocrm_"+$ESAPI.encoder().encodeForJavaScript(Crm.userDetails.LOCALE)+".js"])},model:function(){return networkUtils.lyteInitiateRequest("/crm/v2/settings/calendar_schedule","GET")},renderTemplate:function(e){return e.isPersonalAccount=Crm.userDetails.PERSONAL_ACCOUNT,Handlebars.registerPartial("EmailSignature",Handlebars.templates.EmailSignature),calendarSchedule.isBusinessHoursCreated=e.info.business_hours_configured,{outlet:"#result",html:Handlebars.templates.ManageCalendarSchedule(e)}},actions:{onError:function(e,t){return renderingUtils.displayPermissionDenied(),t.pause(),!1}},redirect:function(){if("crm.settings.section.booking"===this.transition.target){var e=this.transition.data;this.replaceWith({route:"crm.settings.section.booking.index"}).data=e}}}),Lyte.Router.registerRoute("crm.settings.section.business-hours",{beforeModel:function(){Crm.userDetails.orgTimeZone?"Administrator"!==Crm.userDetails.PROFILE_NAME&&(this.transition.abort(),renderingUtils.displayPermissionDenied()):(this.transition.abort(),Lyte.Router.transitionTo("crm.settings.section.company-details"))},getResources:function(){var e=networkUtils.returnDependencyFiles(["businessHoursCommon.js","businessHoursmixin.js","services-businesshours.js","shift_hours_model.js","business_hours-model.js","crmbusinesshourswrapper.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")])),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crmbusinesshourswrapper-rtl.css"],crmConstants.cssStaticPathForLyte))),e.concat(networkUtils.returnDependencyFiles(["crmbusinesshourswrapper.css"],crmConstants.cssStaticPathForLyte))},redirect:function(){if("crm.settings.section.business-hours"===this.transition.target){var e=this.transition.data;this.transition.target="crm.settings.section.business-hours.index",this.replaceWith({route:"crm.settings.section.business-hours.index"}).data=e}},beforeExit:function(){store.unloadAll("business_hours"),store.unloadAll("shift_hours"),store.unloadAll("businesshours_timezone")}}),Lyte.Router.registerRoute("crm.settings.section.canvas-builder",{}),Lyte.Router.registerRoute("crm.settings.section.case-escalation-rule",{redirect:function(){if("crm.settings.section.case-escalation-rule"==this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.case-escalation-rule.index-case-escalation-rule",this.replaceWith(e)}}}),Lyte.Router.registerRoute("crm.settings.section.client-portal",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-client-portal-user-mixin.js","crm-client-portal-mixin.js","crm-client-portal-user-data-store.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-client-portal.js","crm-image-mixin.js","crm-image-upload-create.js","exif-plugin.js","crm-portals-detail-view-related.js","user_type.js","crm-list-view-modal.js","crm-list-view.js","crm-inner-list.js"],crmConstants.jsStaticPathForLyte);e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-custom-view.js","crm-custom-filter.js","crm-custom-button-wrapper.js","crm-list-helpers.js","crux-smart-filter.js","crux-smart-filter-input.js","crm-list-kanban-container.js","crm-customview-dropdown.js","lyte-counter.js","crm-customview-helpers.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["zohocrm_lookupBusinessCard.js"]));var t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("portals")]),r=[];r=(r=r.concat(networkUtils.returnDependencyFiles(["crm-client-portal.css","crm-list-kanban-container.css","crm-portals-detail-view-related.css","crm-image-upload-create.css","crm-client-portal-send-invite.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-list-view-new.css","custom-view-layer-new.css","custom-view-layer-common.css","crux-smart-filter.css","crm-inner-list-new.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-client-portal-rtl.css","crm-list-view-new-rtl.css","custom-view-layer-new-rtl.css"],crmConstants.cssStaticPathForLyte)));var i=networkUtils.returnDependencyFiles(["zohocrm_clientPortal.js"]),a=-1!==window.location.href.indexOf("csez.zohocorpin.com")||-1!==window.location.href.indexOf("automation.localzoho.com");if(!a)var s=networkUtils.returnDependencyFiles([""],RebrandLinkUtil.getProperty("STORE_JS_STATIC_URL")),o=networkUtils.returnDependencyFiles([""],RebrandLinkUtil.getProperty("STORE_CSS_STATIC_URL"));return a?i.concat(e).concat(r).concat(t):i.concat(s).concat(o).concat(e).concat(r).concat(t)},beforeModel:function(){Lyte.registeredMixins["crm-client-portal-util"].isClientPortalAccessibleForEdition()},redirect:function(){if("crm.settings.section.client-portal"===this.transition.target){Crm.trackSpotLightAction("Client Portal - Clicked");var e=Object.assign({},this.transition.info);if(CLIENT_PORTAL_NAME&&"dummyValue"!==CLIENT_PORTAL_NAME||Crm.userDetails.CLIENT_PORTAL_NAME){var t;this.transition.data&&this.transition.data.refresh&&((t={}).refresh=!0),e.route="crm.settings.section.client-portal.user-types";var r=this.replaceWith(e);t&&t.refresh&&(r.data=t)}else e.route="crm.settings.section.client-portal.begin-portal",this.replaceWith(e)}},renderTemplate:function(){return{outlet:"#result"}},actions:{onError:function(e){var t=JSON.parse(e.response);-1!==t.message.indexOf("Please check if the URL trying to access is a correct one")&&"INVALID_REQUEST"===t.code?(this.transition.abort(),window.location=Crm.getCrmBasePath()+"/iam-security-error"):-1!==t.message.indexOf("No portal exists with the given portal name.")&&"INVALID_DATA"===t.code&&(this.transition.abort(),Utils.windowLocationReload())}},didDestroy:function(){(Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-client-portal-rtl.css"],crmConstants.cssStaticPathForLyte):networkUtils.returnDependencyFiles(["crm-client-portal.css"],crmConstants.cssStaticPathForLyte)).concat(networkUtils.returnDependencyFiles(["crm-client-portal.css","crm-portals-detail-view-related.css","crm-client-portal-send-invite.css","crm-image-upload-create.css"],crmConstants.cssStaticPathForLyte)).forEach((function(e){Lyte.injectResources&&Lyte.injectResources.availableTags&&Lyte.injectResources.availableTags[e]&&(Lyte.injectResources.availableTags[e].tag.remove(),delete Lyte.injectResources.availableTags[e])})),this.removeFromCache(["crm-client-portal.css","crm-portals-detail-view-related.css","crm-client-portal-send-invite.css","crm-client-portal-rtl.css","crm-image-upload-create.css"])}}),Lyte.Router.registerRoute("crm.settings.section.company-details",{getDependencies:function(){return networkUtils.returnDependencyFiles(["org-model.js","definition-model.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-user-company-details.js","modal-scroll-box-shadow.js","shift_hours_model.js","crm-organization-access-url-change-popup.js","org_domain_availablity.js","crm-organization-create-domainpattern.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-user-company-details.css","crm-organization-create-domainpattern.css"],crmConstants.cssStaticPathForLyte),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("companydetails"),networkUtils.getI18nJSUrl("businesshours")],crmConstants.jsStaticPath),i=e.concat(t).concat(r);if(Crm.userDetails.RTL_ENABLED){var a=networkUtils.returnDependencyFiles(["crm-user-company-details-rtl.css"],crmConstants.cssStaticPathForLyte);i=i.concat(a)}return i},model:function(e){return Lyte.resolvePromises({org:store.findAll("org"),adminUsers:store.findAll("user",{type:"ActiveConfirmedAdmins"})})},afterModel:function(e,t){this.currentModel={companyDetails:e.org?e.org[0]:void 0,userDetails:e.adminUsers}},renderTemplate:function(e,t){return{outlet:"#result",component:"crm-companydetail-page"}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.security.orgDetails"),Crm.partnerName]))}}),Lyte.Router.registerRoute("crm.settings.section.competitor-alerts",{getResourcesForAlertForm:function(){var e=networkUtils.returnDependencyFiles(["crm-competitor-alerts-form.js","crux-tag.js","crm-confirm-changes-popup.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-competitor-alerts-form.css"],crmConstants.cssStaticPathForLyte),r=e.concat(t);return Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-competitor-alerts-form-rtl.css"],crmConstants.cssStaticPathForLyte))),r},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-competitors-data-store.js","crm-competitors-utilities.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-competitor-alerts-wrapper.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-competitor-alerts-wrapper.css"],crmConstants.cssStaticPathForLyte),r=e.concat(t);return Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-competitor-alerts-wrapper-rtl.css"],crmConstants.cssStaticPathForLyte))),r.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("competitoralerts")]))},model:function(){return{configurationOptions:store.findAll("competitor_alert_meta"),competitorAlerts:store.findAll("competitor_alert")}},afterModel:function(){this.integrationNotEnabled&&(this.currentModel={competitorAlerts:[],integrationNotEnabled:!0})},renderTemplate:function(){return{outlet:"#result",component:"crm-competitor-alerts-wrapper"}},afterRender:function(){$L("#setup_new_ContentDiv").addClass("helpOverflowHide")},redirect:function(){if(this.transition.data&&this.transition.data.refreshRoute&&this.refresh(),"crm.settings.section.competitor-alerts"===this.transition.target)this.replaceWith("crm.settings.section.competitor-alerts.competitor-alerts-index");else if(this.integrationNotEnabled&&"crm.settings.section.competitor-alerts.competitor-alerts-index"!==this.transition.target){this.replaceWith({route:"crm.settings.section.competitor-alerts.competitor-alerts-index"}).data={showErrorAlert:!0}}},beforeExit:function(){$L("#setup_new_ContentDiv").removeClass("helpOverflowHide")},actions:{willTransition:function(){"undefined"!=typeof ZohoHCAsap&&validationUtils.isNotEmpty(ZohoHCAsap)&&ZohoHCAsap.Action("close")},onError:function(e,t){var r=e&&e.response?JSON.parse(e.response):{};if("INTEGRATION_NOT_ENABLED"===r.code)return this.integrationNotEnabled=!0,t.resume(),!1;var i={NO_PERMISSION:"crm.label.insufficient.privileges",FEATURE_NOT_SUPPORTED:"crm.setup.feature.not.supported",FEATURE_NOT_ENABLED:"crm.setup.feature.not.enabled"},a=r.code&&i[r.code]?i[r.code]:"message.code.0";return crmui.showMsgBand("error",I18n.getMsg(a),3e3),t.abort(),Lyte.Router.transitionTo("crm.settings.index"),!1}}}),Lyte.Router.registerRoute("crm.settings.section.compliance",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zcrm_privacy_settings.js"]);return e=(e=(e=Crm.userDetails.RTL_ENABLED?(e=e.concat(networkUtils.returnDependencyFiles(["privacy-preference.css","crm-permission-dropdown.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["privacy-preference-rtl.css"],crmConstants.cssStaticPathForLyte)):(e=e.concat(networkUtils.returnDependencyFiles(["crm-compliance-landing.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["privacy-preference.css","crm-permission-dropdown.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["privacy-preference.js","crm-permission-dropdown.js","lyte-scrollTo.js","lyte-hovercard.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles()))},getDependencies:function(){return networkUtils.returnDependencyFiles(["compliance-store.js","lyte-hovercard.js"],crmConstants.jsStaticPathForLyte)},topBandLoaded:!1,beforeModel:function(e){$("#result").html("")},model:function(){return store.findAll("privacy_preference")},afterModel:function(e){this.currentModel={},this.currentModel.privacy_preference=e},redirect:function(){!Crm.userDetails.permissions.Crm_Implied_Manage_Compliance_Settings||canShowCompliance&&"false"==canShowCompliance?(renderingUtils.displayPermissionDenied(),this.transition.abort()):Crm.userDetails.permissions.Crm_Implied_Manage_Compliance_Settings&&"crm.settings.section.compliance"===this.transition.info.route&&(this.topBandLoaded=!0,Crm.userDetails.isPrivacyPrefTablesCreated&&!Crm.userDetails.isPrivacySettingEnabled?Lyte.Router.replaceWith({route:"crm.settings.section.compliance.privacy-preference"}):Crm.userDetails.isPrivacyPrefTablesCreated&&"crm.settings.section.compliance.consent-form"!==this.transition.info.route&&"crm.settings.section.compliance.privacy-preference"!==this.transition.info.route&&"crm.settings.section.compliance.consent-dashboard.list-view"!==this.transition.info.route&&Lyte.Router.replaceWith({route:"crm.settings.section.compliance.consent-dashboard"}))},renderTemplate:function(e,t){if(!Crm.userDetails.isPrivacyPrefTablesCreated)return networkUtils.initChart(),$("#settingsEnableSwitch").hide(),$("#watchComplianceVideo").hide(),{outlet:"#result",component:"crm-start-gdpr"}},afterRender:function(e,t){"China"==RebrandLinkUtil.getProperty("DeploymentLocation")&&$("#watchComplianceVideo").remove(),Crm.showZohoCRMStampedEntity||($("#dataCollection").hide(),$("#dataProcessing").hide(),$("#dataRequest").hide(),$("#watchVideoComplianceID").hide()),$("img.contextHelpIcon").attr("onclick","openHelp('Compliance')"),Crm.userDetails.isPrivacyPrefTablesCreated||$(".gdprTopBand").show(),$("#setup_new_ContentDiv").addClass("helpOverflowHide"),$L("#setupInnerLinks").find(".gdpr_tabClass").addClass("oH")},actions:{willTransition:function(e){if(-1===e.info.route.indexOf("crm.settings.section.compliance")&&(setTimeout((function(){$("#result").removeClass("freezeprivacySettingsTabContent")}),200),privacySettings.configJson={},privacySettings.preferenceJson={}),-1!==e.info.route.indexOf("crm.settings.section.compliance")&&-1===e.info.route.indexOf("hipaa")){var t=e.target.split("."),r="crm.settings.section.compliance."+t[t.length-1];$($($(".gdprComplianceSetting,.complianceSettingTabs")[0]).children()[0]).attr("route-selector",r)}$("#setup_new_ContentDiv").removeClass("helpOverflowHide"),$L("#setupInnerLinks").find(".gdpr_tabClass").removeClass("oH")},onError:function(e){403!==e.status&&401!==e.status||($("#privacySettingDiv").hide(),this.replaceWith("crm.settings.index"),setTimeout((function(){renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))}),2e3))},didTransition:function(){this.transition.refresh&&this.refresh();var e=Lyte.Router.getRouteInstance().transition.target;e.includes("hipaa")||"crm.settings.section.compliance"===e||($(".gdprTopBand").show(),$(".complianceAlter").show(),$($($(".gdprComplianceSetting,.complianceSettingTabs")[0]).children()[0]).attr("route-selector",e))}}},{mixins:["crm-compliance"]}),Lyte.Router.registerRoute("crm.settings.section.connections",{getResources:function(){let e=networkUtils.returnDependencyFiles(["zohocrm_connectors.js"]);return e=e.concat(networkUtils.returnDependencyFiles(["connectors-main-view.js"],crmConstants.jsStaticPathForLyte)),e},model:function(){return networkUtils.lyteInitiateRequest("/crm/v2/settings/connectors","GET")},afterModel:function(e){if(e.crm_connectors.error)switch(CrmConnectorObj.error=!0,Object.freeze(CrmConnectorObj),e.crm_connectors.error){case"unconfirmed_email":crmui.showMsgBand("error",I18n.getMsg("crm.custombutton.error.usermail.notconfirmed"),3e3);break;case"permission_denied":crmui.showMsgBand("error",I18n.getMsg("crm.label.cf.error.authorization"),3e3),Lyte.Router.transitionTo("crm.settings.index");break;case"internal_error":default:crmui.showMsgBand("error",I18n.getMsg("crm.label.widgets.error.internal"),3e3)}},renderTemplate:function(){return document.getElementById("result").innerHTML="",{outlet:"#result",component:"connectors-main-view"}},afterRender:function(e){e.crm_connectors.connection_list&&e.crm_connectors.connection_list.connections&&e.crm_connectors.connection_list.connections.length?(CrmConnectorObj.error=!1,CrmConnectorObj.connectionListLength=e.crm_connectors.connection_list.connections.length,$("#connectors_blankpage").hide(),CrmConnectorObj.initializeConnector(),CrmConnectorObj.setHeightWithTimeOut()):CrmConnectorObj.connectionListLength=0},beforeExit:function(){$("#setupInnerLinks").show()}}),Lyte.Router.registerRoute("crm.settings.section.copy-customization",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ResellerConfig.do","GET",{params:{action:"getResellerLoginInfo"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(){$("#setup_new_ContentDiv").addClass("helpOverflowHide")},actions:{willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||["zh","ja","pt","de","es","fr"].contains(Crm.userDetails.LOCALE.substr(0,2))||isMobileBrowser()||"function"!=typeof ZohoHCAsap||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall()),$("#setup_new_ContentDiv").removeClass("helpOverflowHide")}}}),Lyte.Router.registerRoute("crm.settings.section.email-parser.create-email-parser",{queryParams:["tabId","parserName"],model:function(e){var t={action:"newRule",tabId:this.getQueryParams().tabId,parserName:this.getQueryParams().parserName};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/EmailParserAction.do","POST",{params:t})},renderTemplate:function(e){mailparser.createParserRule(null,"fromCreate"),mailparser.newRule(e.mail_parser[0])}}),Lyte.Router.registerRoute("crm.settings.section.crm-cscript",{getDependencies:function(){return networkUtils.returnDependencyFiles(["cscript/crm-cscript-mixin.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["cscript/crm-cscript-setup.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["cscript/crm-cscript-setup.css"],crmConstants.cssStaticPathForLyte),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("cscript")],null);return e.concat(t).concat(r)},model:function(){store.unloadAll("cscript");var e=objectUtils.cloneObject(this.transition.data);return Lyte.resolvePromises({cscript:store.findAll("cscript",{include_extra_details:!0}),page_uuid:e&&e.page_uuid,snippet_uuid:e&&e.snippet_uuid})},renderTemplate:function(){return Crm.trackSpotLightAction("CScript - Visited"),{outlet:"#result",component:"crm-cscript-setup",reRender:!0}}},{mixins:["crm-cscript-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.crm-static-resource",{getDependencies:function(){return networkUtils.returnDependencyFiles(["cscript/crm-cscript-mixin.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-static-resource/crm-static-resource.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-static-resource/crm-static-resource.css"],crmConstants.cssStaticPathForLyte);!0===Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-static-resource/crm-static-resource-rtl.css"],crmConstants.cssStaticPathForLyte)));var r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("StaticResources")],null);return e.concat(t).concat(r)},model:function(){store.unloadAll("static_resources");var e=objectUtils.cloneObject(this.transition.data);return Lyte.resolvePromises({static_resources:store.findAll("static_resources",{page:"1",per_page:"200"}),storage_meta:store.triggerAction("static_resources","getUsage",{},{},"GET"),cur_audit_id:e&&e.cur_audit_id})},renderTemplate:function(){return Crm.trackSpotLightAction("CRM Static Resource - Visited"),{outlet:"#result",component:"crm-static-resource",reRender:!0}}},{mixins:["crm-cscript-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.crm-templates",{queryParams:["type","module","folder","step","templateId","templateName","selectedcategory","fromComponent","relatedModule"],getDependencies:function(){var e=this.getQueryParams().type;if("mail-merge"===e){var t=networkUtils.returnDependencyFiles(["mailmerge.js","mailmerge_folders-store.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles(["mailmerge.css"],crmConstants.cssStaticPathForLyte);return Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["mailmerge-rtl.css"],crmConstants.cssStaticPathForLyte))),t.concat(r)}var i=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailinventorytemplates")]),a=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("editorframework")]);return[i=i.concat(a)]},getResources:function(){var e=this.getQueryParams().type;if("mail-merge"!==e){var t=["zohocrm_template.js","zohocrm_templatenew.js",networkUtils.includeChartFiles()[0]],r=["templateInner.js"],i=template.isLoaded,a=networkUtils.returnDependencyFiles(["crm-templates-common.js"],crmConstants.jsStaticPathForLyte);return a=a.concat(networkUtils.returnDependencyFiles(["crm-templates-common.css","crm-emailtemplate-sendtestmail.css"],crmConstants.cssStaticPathForLyte)),"email"===e&&(t.push("zohocrm_templatestats.js"),t.push("zohocrm_zceditorimages.js"),r.push("crmTemplateStats.js"),r.push("templatestatsHB.js"),i=i&&"undefined"!=typeof crmTemplateStats),a.concat(networkUtils.returnDependencyFiles(t))}},model:function(e){var t=this.transition.data,r=e.queryParams.type||"email";if("mail-merge"===r){e={type:"mailmerge",page:0};return Lyte.resolvePromises({templates:store.findAll("mailmerge_templates",e).catch((function(e){var t=JSON.parse(e.response);"unauthorized"===t.code&&crmui.showMsgBand("error",I18n.getMsg("crm.zti.error.notauthendication"),1e4),"not_supported"===t.code&&crmui.showMsgBand("error",I18n.getMsg("crm.zes.mobile.error.feature"),1e4)})),folders:store.findAll("mailmerge_folders"),modules:store.findAll("mailmerge_modules")})}var i=Crm.getCrmBasePath()+"/Template.do",a="GET",s={},o="email"===r;switch(e.queryParams.step){case"create":s.step=o?"newEmailTemplate":"newInventoryTemplate",Object.keys(t).length>0&&(s.step=t.step,"useGalleryTemplate"===t.step&&(s.inventory=!o,a="POST"),s.fromComponent=t.fromComponent),s.emailTemplateId=e.queryParams.templateId,s.templateName=e.queryParams.templateName,s.selectedcategory=e.queryParams.selectedcategory;break;case"edit":s.step=o?"editEmailTemplate":"editInventoryTemplate",s.emailTemplateId=e.queryParams.templateId;break;case"clone":s.step=o?"cloneEmailTemplate":"cloneInventoryTemplate",s.emailTemplateId=e.queryParams.templateId,s.templateName=e.queryParams.templateName;break;case"showGallery":s.step=o?"showGallery":"showInventoryGallery",s.fromComponent=e.queryParams.fromComponent;break;default:s.step=o?"showAllTemplates":"showInventoryTemplates",s.emailTemplateId=e.queryParams.templateId}s.module=e.queryParams.module&&"undefined"!==e.queryParams.module?e.queryParams.module:void 0,s.folder=e.queryParams.folder&&"undefined"!==e.queryParams.folder?e.queryParams.folder:void 0,s.relatedModule=e.queryParams.relatedModule&&"undefined"!==e.queryParams.relatedModule?e.queryParams.relatedModule:void 0;var n={params:s};return crmHistory.loaded||(n.headers={"is-Page-Load":"true"}),networkUtils.lyteInitiateRequest(i,a,n)},afterModel:function(e,t){if("showGallery"===t.queryParams.step&&template.hideAnimatePopup("createTemplatePop",!0),"mail-merge"===t.queryParams.type){var r=!0;void 0!==e.templates&&e.templates.$.meta.info.more_records&&(r=!0),e.templates=store.peekAll("mailmerge_templates"),e.folders=store.peekAll("mailmerge_folders"),e.hasMoreRecords=r,this.currentModel={mailMergeDetails:e}}},renderTemplate:function(e,t){return"mail-merge"===(t.queryParams.type||"email")?{outlet:"#result",component:"crm-templates-view"}:{outlet:"#result",html:e}},afterRender:function(e,t){if($("#setup_new_ContentDiv").addClass("helpOverflowHide"),$("#setupInnerLinks").hide(),$("#createProcessContainer").is(":visible"))$(".setupleftmenutd").hide(),$(".new_setupview").addClass("newSetupRightShow");else{var r=$("#setup_new_leftmenuDiv");r.show(),$(".setupleftmenutd").removeClass("tempAnimated"),r.removeAttr("class")}"showGallery"===t.queryParams.step&&template.isTemplateEditorEnabled&&(template.showChooseTemplatePage(),thirdPartyUtils.bindSelect2("#selectModule",{minimumResultsForSearch:1/0}),thirdPartyUtils.unbindPerfectScroll("#galleryCtn"),thirdPartyUtils.bindPerfectScroll("#galleryCtn",{wheelSpeed:1,wheelPropagation:!0}),thirdPartyUtils.bindPerfectScrollUpdate("#galleryCtn")),$("#securityError").length&&t.queryParams&&!t.queryParams.step&&template.setCustomTab("email")},actions:{willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall()),$("#setup_new_ContentDiv").removeClass("helpOverflowHide")}},beforeExit:function(){$(".tabClass").hide(),$("#setupInnerLinks").show(),$(".setupleftmenutd, #setup_new_leftmenuDiv").add(".leftCtnTemp").css("display","").removeClass("w0Imp").removeClass("tempAnimated")}}),Lyte.Router.registerRoute("crm.settings.section.crm-triggers",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-triggers.js","function-model.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-triggers.css"],crmConstants.cssStaticPathForLyte),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("triggers")]);return e.concat(t).concat(r)},redirect:function(){if("crm.settings.section.crm-triggers"===this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.crm-triggers.index-crm-triggers",this.replaceWith(e)}}}),Lyte.Router.registerRoute("crm.settings.section.crm-trusted-domain",{getDependencies:function(){return networkUtils.returnDependencyFiles(["cscript/crm-cscript-mixin.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-trusted-domain/crm-trusted-domain.css"],crmConstants.cssStaticPathForLyte);!0===Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-trusted-domain/crm-trusted-domain-rtl.css"],crmConstants.cssStaticPathForLyte)));var t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("TrustedDomains")],null);return networkUtils.returnDependencyFiles(["crm-trusted-domain/crm-trusted-domain.js"],crmConstants.jsStaticPathForLyte).concat(e).concat(t)},model:function(){store.unloadAll("trusted_domains");var e=objectUtils.cloneObject(this.transition.data);return Lyte.resolvePromises({trusted_domains:store.findAll("trusted_domains",{page:"1",per_page:"200"}),cur_audit_id:e&&e.cur_audit_id})},renderTemplate:function(){return Crm.trackSpotLightAction("CRM Trusted Domain - Visited"),{outlet:"#result",component:"crm-trusted-domain"}}},{mixins:["crm-cscript-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.unsubscribe-link",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_unsubscribeform.js"],crmConstants.jsStaticPath),t=networkUtils.returnDependencyFiles(["zohocrm_unsubscribeform.css"],crmConstants.cssStaticPath);return e.concat(t)},model:function(){var e={params:{pageTitle:"crm.unsubscription.link",step:"unsubscribe",isFromBack:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/unsubscribelink.do","GET",e)},renderTemplate:function(e){return{outlet:"#result",html:Handlebars.templates.UnsubscribeForm(e)}},afterRender:function(e){unsubscription.titleForEllipsis(".unsubScriptionEls"),e.onboard&&unsubscription.showOnBoard()}}),Lyte.Router.registerRoute("crm.settings.section.crm-variables",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_variables.css"],crmConstants.cssStaticPath),t=networkUtils.returnDependencyFiles(["zohocrm_variables.js"]);return t=t.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("variables")],crmConstants.jsStaticPath)),e.concat(t)},model:function(){var e={params:{pageTitle:"crm.label.currencies",action:"variables",isFromBack:!0}},t=networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Variables.do","POST",e);return Lyte.resolvePromises(t)},redirect:function(e){if("object"==typeof e&&"NO_PERMISSION"===e.code)(t=Object.assign({},this.transition.info)).route="crm.settings.index",this.replaceWith(t),setTimeout((function(){crmui.showMsgBand("error",I18n.getMsg("crm.label.cf.error.authorization"),3e3)}),100);else if("crm.settings.section.crm-variables"==this.transition.target){var t;(t=Object.assign({},this.transition.info)).route="crm.settings.section.crm-variables.index-crm-variable",this.replaceWith(t)}}}),Lyte.Router.registerRoute("crm.settings.section.crm-widgets",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-widget-container.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){return networkUtils.returnDependencyFiles(["widget/crm-widget-container.css"],crmConstants.lessStaticPathForLyte)},model:function(e){return store.findAll("widgets",{},!1,!0,"isFromWidget").then((function(e){return{crm_widgets:e}}),function(e){commonUtils.showHideLoadingDiv(!1),this.showWidgetErrorMessage(JSON.parse(e.response),!0,!0,void 0,!0),Lyte.Router.transitionTo("crm.settings.index")}.bind(this))},afterModel:function(e,t){var r=$("#setup_new_ContentDiv"),i=renderingUtils.windowHeight-(r.offset().top+26+16);if(!(this.error_key||e&&e.status&&"error"===e.status)&&e&&e.crm_widgets){var a=this.transition.data;a&&a.isAjax||($("#widgetsTabHeader").css("display","block"),r.height(i),thirdPartyUtils.bindSelect2($(".newSelect").find("select")))}},renderTemplate:function(e,t){if(e&&e.crm_widgets&&0!==e.crm_widgets.length){var r=this.transition.data;return r&&r.isAjax?{outlet:"#result",html:""}:{outlet:"#result",component:"crm-widgets-body"}}return{outlet:"#result",component:"crm-widget-welcome"}},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.widgets"),Crm.partnerName]))},actions:{onError:function(e,t,r){return this.error_key=!0,this.currentModel=e.responseJSON,t.resume(),!1}}},{mixins:"crm-widget-utils"}),Lyte.Router.registerRoute("crm.settings.section.currencies",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CurrencyAction.do","GET",{params:{action:"listview"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.currencies"),Crm.partnerName]))}}),Lyte.Router.registerRoute("crm.settings.section.custom-view",{}),Lyte.Router.registerRoute("crm.settings.section.data-backup",{getResources:function(){var e=[RebrandLinkUtil.getProperty("STORE_CSS_STATIC_URL"),RebrandLinkUtil.getProperty("STORE_JS_STATIC_URL")],t=networkUtils.returnDependencyFiles(["crm-data-backup.js","crm-backup-store.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("databackup")],null),i=networkUtils.returnDependencyFiles(["crm-data-backup.css"],crmConstants.cssStaticPathForLyte);return e.concat(t).concat(i).concat(r)},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-backup-store.js"],crmConstants.jsStaticPathForLyte)},actions:{refreshRoute:function(){var e={refreshTemplate:!0};this.refresh(e)},onError:function(e,t,r,i){if("model"===i&&e&&e.responseText){var a=JSON.parse(e.responseText);if(a.code)switch(a.code){case"NO_PERMISSION":return renderingUtils.displayPermissionDenied(),!1}}},willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall())}},model:function(e){return Lyte.resolvePromises({info:store.findAll("backup",null,!1,!0),links:store.findAll("backup",null,!1,!1,{type:"urls"})})},didDestroy:function(){window.zs_store&&Lyte.objectUtils(window,"delete","zs_store")},renderTemplate:function(e){return{outlet:"#result",component:"crm-backup-home"}},afterModel:function(e){if("F"!==Crm.userDetails.LICENSE_TYPE_ACTUAL&&"N"!==Crm.userDetails.LICENSE_TYPE_ACTUAL&&"L"!==Crm.userDetails.LICENSE_TYPE_ACTUAL){var t=Crm.userDetails.ULTIMATE_ADDON_COUNT&&Crm.userDetails.ULTIMATE_ADDON_COUNT>0,r="U"===Crm.userDetails.LICENSE_TYPE_ACTUAL||"C"===Crm.userDetails.LICENSE_TYPE_ACTUAL||t?I18n.getMsg("crm.text.4"):"X"===Crm.userDetails.LICENSE_TYPE_ACTUAL?r=I18n.getMsg("crm.text.1"):I18n.getMsg("crm.text.2"),i=I18n.getMsg("crm.databackup.configure.msg")+"<br>"+("X"===Crm.userDetails.LICENSE_TYPE_ACTUAL?I18n.getMsg("crm.databackup.configure.starter.edition.msg1"):I18n.getMsg("crm.databackup.configure.msg1",r))+" "+I18n.getMsg("crm.databackup.configure.msg2",Crm.userDetails.manageSubscriptionUrl);e.descContent=i,e.isPaidEdition=!0}(e.info&&(!e.info||"STOPPED"!==e.info.status&&"COMPLETED"!==e.info.status&&"EMPTY"!==e.info.status)||(e.toShowConfigure=!0,e.showOnlyButton=!0,e.info&&e.info.id&&(e.showOnlyButton=!1)),e.links.urls&&e.info&&e.info.status&&"INPROGRESS"!==e.info.status)&&(e.toShowLink=!0,e.links.urls.expiry_date&&Lyte.registeredMixins["crm-backup-util"].getDayDiff(e.links.urls.expiry_date)<0&&(e.toShowLink=!1))}}),Lyte.Router.registerRoute("crm.settings.section.data-enrichment",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-dataenrichment.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-dataenrichment.css"],crmConstants.cssStaticPathForLyte),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AutoEnrichment")]);return e.concat(t).concat(r)},model:function(){return store.unloadAll("auto_enrichment"),{auto_enrichment:store.findAll("auto_enrichment")}},redirect:function(){if("crm.settings.section.data-enrichment"===this.transition.target){var e=this.transition.data,t=this.replaceWith({route:"crm.settings.section.data-enrichment.index-data-enrichment"});t.data=e,t.dataEnrich=this.transition.dataEnrich}},actions:{onError:function(e,t,r){var i,a="";return e.response&&(a=JSON.parse(e.response).code),"NOT_SUPPORTED_FEATURE"==a?(i=I18n.getMsg("crm.auto.enrich.edition.not.support"),crmui.showMsgBand("error",i,"4000",""),crmHistory.backOneLevel()):"NO_PERMISSION"==a?(i='<div class="f21"><span id="warningMsg">'+I18n.getMsg("crm.setup.attribution.NO_PERMISSION")+"</span></div>",renderingUtils.showCustomAlert(i,void 0,!0,(function(){crmHistory.backOneLevel()}))):(i='<div class="f21"><span id="warningMsg">'+I18n.getMsg("crm.no.roles.for.homepage1")+'</span> <span class="proxima" id="delItemName"></span><br><span id="showWarning2" class="f13"><b>'+I18n.getMsg("crm.label.note2")+' </b><span id="noteMsg">'+I18n.getMsg("crm.no.roles.for.homepage2")+"</span></span></div>",renderingUtils.showCustomAlert(i,void 0,!0,(function(){crmHistory.backOneLevel()}))),!1}}}),Lyte.Router.registerRoute("crm.settings.section.data-migration",{getDependencies:function(){if("crm.settings.migration"!==this.transition.target)return networkUtils.returnDependencyFiles(["data-migration-store.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("datamigration")]),t=networkUtils.returnDependencyFiles(["data-migration-component-general.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles(["data-migration-general.css"],crmConstants.cssStaticPathForLyte);if(Crm.userDetails.RTL_ENABLED)r=networkUtils.returnDependencyFiles(["data-migration-general.css","data-migration-general-rtl.css"],crmConstants.cssStaticPathForLyte);var i=networkUtils.returnDependencyFiles(["zohocrm_import.js",networkUtils.getI18nJSUrl("import")]),a=networkUtils.returnDependencyFiles(["lyte-step.css"],crmConstants.cssStaticPathForLyte);return e.concat(t).concat(a).concat(r).concat(i)},beforeExit:function(){$L("#setup_new_ContentDiv").removeClass("helpOverflowHide")},model:function(){if(this.transition.data&&"error"===this.transition.data.step)return store.findAll("migration");var e=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];return e?store.findRecord("migration",e):"crm.settings.migration.api-login"!==this.transition.target?store.findAll("migration"):void 0},actions:{onError:function(e,t,r,i){if("model"===i&&e&&e.responseText){var a=JSON.parse(e.responseText);if(a.code)switch(a.code){case"NO_PERMISSION":return renderingUtils.displayPermissionDenied(),!1}}}},redirect:function(e){this.transition.data&&this.transition.data.step&&"abort"===this.transition.data.step?Lyte.Router.getRouteInstance().refresh():"crm.settings.section.data-migration"!==this.transition.target&&($L.isEmptyObject(this.transition.data)&&"crm.settings.migration.api-login"===this.transition.target?Lyte.Router.replaceWith({route:"crm.settings.section.data-migration"}).data={step:"error"}:$L.isEmptyObject(this.transition.data)&&this.redirectMigrationBasedOnCurrentStatus(e,this))},renderTemplate:function(){return{outlet:"#result",component:"crm-dm-select-crm"}},afterRender:function(){$L("#setup_new_ContentDiv").addClass("helpOverflowHide"),this.transition.data&&"error"===this.transition.data.step&&"new"!==this.transition.data.stage?this.showMessageInSelectCRM(I18n.getMsg("crm.migration.id.notFound"),"error"):this.transition.data&&"unknown"===this.transition.data.step&&this.showMessageInSelectCRM(I18n.getMsg("unknown.problem"),"error")}},{mixins:["migration-util","migration-constants"]}),Lyte.Router.registerRoute("crm.settings.section.data-sharing",{redirect:function(){"crm.settings.section.data-sharing"===this.transition.target&&this.replaceWith("crm.settings.section.data-sharing.index-data-sharing")}}),Lyte.Router.registerRoute("crm.settings.section.email-parser.edit-email-parser",{model:function(e){var t={action:"editParser",ruleId:this.getDynamicParam()};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/EmailParserAction.do","POST",{params:t})},renderTemplate:function(e){mailparser.createParserRule({source:e.mail_parser[0].source},"fromEdit"),mailparser.basicView(),mailparser.viewParserDetails(e.mail_parser[0])}}),Lyte.Router.registerRoute("crm.settings.section.email-configuration",{queryParams:["action","frmmode"],getResources:function(){var e=networkUtils.returnDependencyFiles(["mailSubTab.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["mailSubTab.css"],crmConstants.cssStaticPathForLyte))},afterModel:function(){var e=this.__lp.objPath;this.currentModel=crmSetup.getChildSubTabData(e)},renderTemplate:function(){return{outlet:"#inner_result",component:"crm-email-subtab"}},actions:{didTransition:function(){"crm.settings.section.email-configuration.email-settings.email-index"===this.transition.target||"crm.settings.section.email-configuration.email-settings.email-create"===this.transition.target?$L("crm-email-subtab")[0].setData("selected","crm.settings.section.email-configuration.email-settings"):$L("crm-email-subtab")[0].setData("selected",this.transition.target)}}}),Lyte.Router.registerRoute("crm.settings.section.email-deliverability",{queryParams:["action","frmmode"],getResources:function(){var e=networkUtils.returnDependencyFiles(["mailSubTab.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["mailSubTab.css"],crmConstants.cssStaticPathForLyte))},beforeModel:function(e){},model:function(e){},afterModel:function(e){var t=this.__lp.objPath;this.currentModel=crmSetup.getChildSubTabData(t)},renderTemplate:function(e,t){return{outlet:"#inner_result",component:"crm-email-subtab"}},redirect:function(){},afterRender:function(e){}}),Lyte.Router.registerRoute("crm.settings.section.email-insights",{redirect:function(){"crm.settings.section.email-insights"==this.transition.target&&(this.transition.info.route="crm.settings.section.email-intelligence.email-insights",this.replaceWith(this.transition.info))}}),Lyte.Router.registerRoute("crm.settings.section.email-intelligence",{queryParams:["action","frmmode"],getResources:function(){var e=networkUtils.returnDependencyFiles(["mailSubTab.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["mailSubTab.css"],crmConstants.cssStaticPathForLyte))},beforeModel:function(e){},model:function(e){},afterModel:function(e){var t=this.__lp.objPath;this.currentModel=crmSetup.getChildSubTabData(t)},renderTemplate:function(e,t){return{outlet:"#inner_result",component:"crm-email-subtab"}},redirect:function(){},afterRender:function(e){}}),Lyte.Router.registerRoute("crm.settings.section.email-parser",{getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_emailParser.js"])},redirect:function(){if("crm.settings.section.email-parser"===this.transition.target){var e=this.transition.data;this.replaceWith({route:"crm.settings.section.email-parser.index-email-parser"}).data=e}},afterRender:function(){$("#result").removeClass("crmEmailConfigDiv")}}),Lyte.Router.registerRoute("crm.settings.section.email-settings",{queryParams:["action","frmmode"],getResources:function(){networkUtils.returnDependencyFiles(["mailconfig-min.js"],crmConstants.jsStaticPathForLyte)},beforeModel:function(e){["mailSelect","imap","zmail"].contains(this.getQueryParams().action)||this.transition.abort()},redirect:function(){if("crm.settings.section.email-settings"===this.transition.target){var e=this.transition.info.queryParams;e.service=(new Date).getTime(),Lyte.Router.getRouteInstance().replaceWith({route:"crm.settings.section.email-configuration.email-settings",dynamicParams:this.transition.info.dynamicParams,queryParams:e}).data=this.transition.data}},afterRender:function(){$("#result").addClass("crmEmailConfigDiv")},beforeExit:function(){$("#result").removeClass("crmEmailConfigDiv")}}),Lyte.Router.registerRoute("crm.settings.section.email-sharing",{redirect:function(){"crm.settings.section.email-sharing"==this.transition.target&&(this.transition.info.route="crm.settings.section.email-configuration.email-sharing",this.replaceWith(this.transition.info))},beforeExit:function(){$("#result").removeClass("crmEmailConfigDiv")}}),Lyte.Router.registerRoute("crm.settings.section.export-data",{model:function(e){var t={params:{step:"selectModule"}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ExportEntity.do","GET",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.extensions",{redirect:function(){"crm.settings.section.extensions"===this.transition.target&&this.transitionTo("crm.settings.section.extensions.all-extensions")}}),Lyte.Router.registerRoute("crm.settings.section.fiscal-year",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/potentials/EditOrgFiscal.do","GET",{params:{action:"showFiscal"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.case.escalation.rules.businesshours"),Crm.partnerName]))}}),Lyte.Router.registerRoute("crm.settings.section.game-settings",{beforeModel:function(){},model:function(){var e=objectUtils.cloneObject(this.transition.data);if(e&&crmSetup.setupObject[this.transition.info.route]&&!crmSetup.setupObject[this.transition.info.route].higherEditionTry){if(-1==="E,A,R,P,C,Z,U".indexOf(Crm.userDetails.LICENSE_TYPE))return void renderingUtils.displayPermissionDenied();document.title=I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("game.feature.label",Crm.partnerName),Crm.partnerName])}return new Promise((function(t,r){GameLoad.loadSetupJsAndExecute((function(){Gamification.Settings.renderSettings(e,t),commonUtils.showHideLoadingDiv()}))}))},renderTemplate:function(e){return e},afterRender:function(){var e=this.transition.data?this.transition.data:{};if(e.type=e&&e.type?e.type:"param",crmSetup.SetHeight_setup_inner_content(),thirdPartyUtils.bindSelect2($("#"+e.type+"div .chosen-select"),{width:"90px"}),$(".gMenuAnimate").css("width",$(".gameBlueBg").outerWidth()),e.entityid){if(Gamification.GameParams[e.entityid])return Gamification.Settings.toggleSettingsTab("param"),void Gamification.UI.highlight($("#"+e.entityid),!1);if(Gamification.GameBadges[e.entityid])return Gamification.Settings.toggleSettingsTab("badge"),void Gamification.UI.highlight($("#"+e.entityid),!1);var t;if(t=Gamification.Settings.getParamUsingCriteriaID(e.entityid))return Gamification.Settings.editParam(t),void $("div[data-queryid="+e.entityid+"]").find("[data-zcqa=newtrophycrtclick]").trigger("click");(t=Gamification.Settings.getBadgeUsingCriteriaID(e.entityid))&&Gamification.Settings.editBadge(t)}else Gamification.Settings.toggleSettingsTab(e.type);var r=$L("#result");r.addClass("helpOverflowHide"),Crm.userDetails.isMotivatorEarlyAccessGiven&&r.css("height","100%"),Gamification.isFromWMS&&(Gamification.renderMotivatorScreen(),Gamification.isFromWMS=!1)},actions:{willTransition:function(e){-1!==e.info.route.indexOf("crm.settings.section.game-settings")||Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall());var t=$L("#result");t.removeClass("helpOverflowHide"),Crm.userDetails.isMotivatorEarlyAccessGiven&&t.css("height","auto")}}}),Lyte.Router.registerRoute("crm.settings.section.groups",{redirect:function(){"crm.settings.section.groups"===this.transition.target&&this.replaceWith("crm.settings.section.groups.index-groups")}}),Lyte.Router.registerRoute("crm.settings.section.hierarchy-preference",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_forecastTemplate.js"]);return e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("hierarchypreference")],crmConstants.jsStaticPath)),newForecastsEnabled&&(e=(e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Forecasts")]))).concat(networkUtils.returnDependencyFiles(["crm-forecast-hierarchy-pop.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-forecast-hierarchy-pop.css","crm-forecast-common.css"],crmConstants.lessStaticPathForLyte))),e},getDependencies:function(){var e=[];return newForecastsEnabled&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-forecast-config-store.js"],crmConstants.jsStaticPathForLyte))),e},beforeModel:function(e){},model:function(e){var t={action:"hierarchyDetails"},r={params:t};if(newForecastsEnabled&&moduleRecordMapping.Forecasts&&moduleRecordMapping.Forecasts.visible){var i={getconfig:store.findAll("forecast_configuration"),roleInfo:networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Role.do","GET",r)};return Lyte.resolvePromises(i)}return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Role.do","GET",r)},afterModel:function(e,t){newForecastsEnabled&&moduleRecordMapping.Forecasts&&moduleRecordMapping.Forecasts.visible?(e.getconfig&&e.getconfig.id?(e.roleInfo.forecast=!0,"Territory"===e.getconfig.hierarchy.api_name?e.roleInfo.isTerritoryForecast=!0:e.roleInfo.isTerritoryForecast=!1):(e.roleInfo.forecast=!1,e.roleInfo.isTerritoryForecast=!0),this.currentModel=e.roleInfo):(e.forecast=!1,e.isTerritoryForecast=!0,this.currentModel=e)},redirect:function(){},renderTemplate:function(e,t){renderHierarchyPage(e)},afterRender:function(e,t){},actions:{willTransition:function(){},didTransition:function(){}},beforeExit:function(){}}),Lyte.Router.registerRoute("crm.settings.section.holidays",{beforeModel:function(){"Administrator"!==Crm.userDetails.PROFILE_NAME&&(this.transition.abort(),renderingUtils.displayPermissionDenied())},getDependencies:function(){var e=networkUtils.returnDependencyFiles(["businessHoursCommon.js","businessHoursmixin.js","services-businesshours.js","crmbusinesshourswrapper.js","shift_hours_model.js","business_hours-model.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")])),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crmbusinesshourswrapper-rtl.css"],crmConstants.cssStaticPathForLyte))),e.concat(networkUtils.returnDependencyFiles(["crmbusinesshourswrapper.css"],crmConstants.cssStaticPathForLyte))},model:function(){return store.unloadAll("holidays"),store.unloadAll("shift_hours"),Lyte.resolvePromises({holidays:store.findAll("holidays"),shift_hours:store.findAll("shift_hours"),business_hours:store.findAll("business_hours")})},afterModel:function(e,t){if(e.holidays&&"NO_PERMISSION"===e.holidays.code)return e.permissionDenied=!0,void renderingUtils.displayPermissionDenied();e.holidays&&e.holidays[0]&&e.holidays.hasOwnProperty("$")&&(e.holidaysInfo=e.holidays.$.meta);var r=Lyte.registeredMixins["business-hours-utils"];void 0!==t.dynamicParam?t.dynamicParam.year:t.dynamicParam;if(e.holidays[0])e.holidays;else{var i={};!e.shift_hours||$u.isEmpty(e.shift_hours)?(i.isBusinessHoliday=!0,i.button={show:!0,valueYear:(new Date).getFullYear()}):(i.isBusinessHoliday=!1,i.button={show:!0}),e.holidays=i}if(e.holidaysInfo&&e.holidaysInfo.created_years&&e.holidaysInfo.created_years[0]&&(e.fetchedYears=[e.holidaysInfo.created_years.sort()[0]+""]),e.yearDisplayCount=1,e.alreadyCreatedIds=r.getAlreadyCreatedIds({},e.holidays),e.allCreatedYears=r.getAllCreatedYears(e.alreadyCreatedIds,e.shift_hours),e.holidays=r.showCurrentYear(e.holidays,e.holidaysInfo),e.holidaysInfo&&e.holidaysInfo.created_years){r.setShiftIndex(e.holidays,e.holidaysInfo.created_years.sort()[0]),r.setIsShiftHolidaysFirst(e.holidays),e.holidays.length>15&&(e.tempHolidays={},e.tempHolidays[e.holidays[0].year]=e.holidays.slice(0,15),e.holidays.splice(15,31));var a=r.getAvailableYear(),s=r.diffTwoArrays(a,e.allCreatedYears);e.disableHolidayCreateButton=!(s.length>0),e.fetchedYears=[e.holidays[0].year+""]}},renderTemplate:function(e){if(!e.permissionDenied)return{outlet:"#result",component:"crm-holidays-tab",reRender:!0}},afterRender:function(e){if(!e.permissionDenied&&(this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.holidays"),Crm.partnerName])),Lyte.registeredMixins["business-hours-utils"].CrmBusinessHours.is24HrsFrmt=Lyte.registeredMixins["business-hours-utils"].checkUserTimeFormatis24hrs(),e.holidaysInfo&&e.holidaysInfo.created_years)){var t=e.holidaysInfo.created_years;if(e.holidaysInfo.created_years.length>1)try{-1!==t.indexOf(parseInt(this.transition.data.year))?document.getElementById("holidayTabId").openTab("holidaysTab_"+t.indexOf(parseInt(this.transition.data.year))):document.getElementById("holidayTabId").openTab("holidaysTab_0")}catch(e){document.getElementById("holidayTabId").openTab("holidaysTab_0")}else{var r=document.getElementById("holidayTabId");r&&r.openTab("holidaysTab_0")}}},beforeExit:function(){store.unloadAll("holidays"),store.unloadAll("shift_hours")}}),Lyte.Router.registerRoute("crm.settings.section.home-customization",{redirect:function(){"crm.settings.section.home-customization"===this.transition.target&&this.replaceWith("crm.settings.section.home-customization.index-home-customization")},actions:{onError:function(e){var t="noRolesForHome"!==e.responseText?e.responseText:'<div class="f21"><span id="warningMsg">'+I18n.getMsg("crm.no.roles.for.homepage1")+'</span> <span class="crm-font-regular" id="delItemName"></span><br><span id="showWarning2" class="f13"><b>'+I18n.getMsg("crm.label.note2")+' </b><span id="noteMsg">'+I18n.getMsg("crm.no.roles.for.homepage2")+"</span></span></div>",r=this;return renderingUtils.showCustomAlert(t,void 0,!0,(function(){r.transitionTo("crm.settings.section.home-customization.index-home-customization")})),!1}}}),Lyte.Router.registerRoute("crm.settings.section.import-history",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_import.js",networkUtils.getI18nJSUrl("import")]),t=networkUtils.returnDependencyFiles(["zohocrm_import.css"],crmConstants.cssStaticPath),r=networkUtils.returnDependencyFiles(["import-view-upload-history.js"],crmConstants.jsStaticPathForLyte);return e.concat(t).concat(r)},model:function(e){var t=e.queryParams,r={};return r.params=null==t?{actionName:"showHistory",pageTitle:"crm.import.history",isNew:!0}:{actionName:"showHistory"},networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ImportHistory.do","GET",r)},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.email-parser.index-email-parser",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/EmailParserAction.do","POST",{params:{action:"emailParser"}})},renderTemplate:function(e){mailparser.createParserRule(e)},afterRender:function(){$("#result").removeClass("crmEmailConfigDiv")}}),Lyte.Router.registerRoute("crm.settings.section.review-usage.index-review-usage",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["crm-reviewprocess-reviewusage.js","crm-reviewprocess-chart.js","Analytics.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-reviewprocess-dashboard.css"],crmConstants.cssStaticPathForLyte);return e.concat(t)},model:function(){return commonUtils.showHideLoadingDiv(!0),store.findAll("Analytics",{feature_type:"REVIEW_ANALYTICS"})},afterModel:function(e){var t={};t["Rejected reason by record count"]=I18n.getMsg("crm.reviewprocess.rejected.reason.count.history"),t["Review status by record count"]=I18n.getMsg("crm.reviewprocess.history.descrition.status.reviewed"),t["Field status history"]=I18n.getMsg("crm.reviewprocess.field.history.status.count"),t["Average waiting time by review process"]=I18n.getMsg("crm.reviewprocess.status.waitingtime.count.history"),t["Record name by rejection count"]=I18n.getMsg("crm.reviewprocess.status.field.record.count"),t["Waiting time by record name"]=I18n.getMsg("crm.reviewprocess.waitingTime.by.record.descrition");var r={};r["Rejected reason by record count"]=I18n.getMsg("crm.reviewprocess.history.reason.for.rejection"),r["Review status by record count"]=I18n.getMsg("crm.review.status.history.desc"),r["Field status history"]=I18n.getMsg("crm.reviewprocess.field.history"),r["Average waiting time by review process"]=I18n.getMsg("crm.reviewprocess.status.waitingtime.literal"),r["Record name by rejection count"]=I18n.getMsg("crm.reviewprocess.status.field.record.literal"),r["Waiting time by record name"]=I18n.getMsg("crm.reviewprocess.waitingTime.by.record");var i=this;return Lyte.resolvePromises({usageDashboard:e,dashboardDetails:this.getDashBoardComponents(e[0]),rpI18Compnt:r,rpI18Descrition:t}).then((function(e){return i.currentModel=e,i.currentModel}))},renderTemplate:function(){return{outlet:"#result",component:"crm-reviewprocess-dashboard"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)},getDashBoardComponents:function(e){return store.findRecord("Analytics",e.id).then((function(e){return e[0]}))}}),Lyte.Router.registerRoute("crm.settings.section.sales-signals.index-sales-signals",{model:function(){return store.findAll("extensions")},renderTemplate:function(e){var t={};return t.extensions=e,t.info=e.$.meta,crmNTCSettings.otherPlatformsInfo=t.info.other_platforms,Handlebars.registerPartial("topLevelSettings",Handlebars.templates.topLevelSettings),this.currentModel=crmNTCSettings.processSignalsSettingsResponse(t),Handlebars.registerPartial("signalSettingsHeader",Handlebars.templates.signalSettingsHeader),Handlebars.registerPartial("signalSettingsForm",Handlebars.templates.signalSettingsForm),Handlebars.registerPartial("signalSettingsExtRow",Handlebars.templates.signalSettingsExtRow),Handlebars.registerPartial("signalSettingsRow",Handlebars.templates.signalSettingsRow),Handlebars.registerPartial("signalSettingsForChannel",Handlebars.templates.signalSettingsForChannel),Handlebars.registerPartial("signalSettingsHelp",Handlebars.templates.signalSettingsHelp),Handlebars.registerPartial("signalSettingsOtherInfo",Handlebars.templates.signalSettingsOtherInfo),{outlet:"#result",html:Handlebars.templates.NotificationSettings(t)}},afterRender:function(e){var t=$("#ntcSettingInnerScrollDiv"),r=renderingUtils.windowWidth-t.offset().left-45,i=renderingUtils.windowHeight-t.offset().top-200;crmNTCSettings.displayMainSettings(e),this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.ntc.label.settings.notificationTitle"),Crm.partnerName])),Crm.loadChatIntegrationJSForCalAndSS("signals"),4==$("#topbandNotifySettings").find("th").length&&$(".overflowContainer").css({width:r,height:i}),4==$("#topbandNotifySettings").find("th").length&&$(".overflowContainer").css({width:r,height:i}),$("#result").addClass("helpOverflowHide")},beforeModel:function(){Crm.trackSpotLightAction("CRM Signals - Signal Settings",{Place:"Setup",Edition:Crm.userDetails.EDITION_NAME,Profile:Crm.userDetails.PROFILE_NAME}),Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||initAsap("Sales Signals")},actions:{onError:function(e){e&&e.responseJSON&&e.responseJSON.code&&"FEATURE_NOT_AVAILABLE"===e.responseJSON.code&&crmui.showMsgBand("error",I18n.getMsg("crm.setup.attribution.FEATURE_NOT_SUPPORTED"),3e3)},willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||!ZohoHCAsap||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall()),$("#result").removeClass("helpOverflowHide")},onError:function(e){e&&e.responseJSON&&e.responseJSON.code&&"FEATURE_NOT_AVAILABLE"===e.responseJSON.code&&crmui.showMsgBand("error",I18n.getMsg("crm.setup.attribution.FEATURE_NOT_SUPPORTED"),3e3)}}}),Lyte.Router.registerRoute("crm.settings.section.inventory-management",{renderTemplate:function(){return{outlet:"#result",html:Handlebars.templates.HigherEditionFeatures(crmSetup.setupObject["crm.settings.section.inventory-management"])}},afterRender:function(){$("#overlayHeader").hide(),$("#settingInner").hide(),$("#setupshow").show(),$("#mainResult").show(),commonUtils.showHideLoadingDiv()}}),Lyte.Router.registerRoute("crm.settings.section.macro",{getResources:function(){if("undefined"==typeof macro||!Macro.isLoaded){var e=networkUtils.returnDependencyFiles(["crm-alert-recipients.js","crm-alert-addresswrapper.js","crux-tag.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["zohocrm_macro_common.js","zohocrm_macro.js"]);return e.concat(t)}}}),Lyte.Router.registerRoute("crm.settings.section.manage-mass-mail",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_workflow.js","zohocrm_massmailTemplates.js"]),t=networkUtils.returnDependencyFiles(["crm-list-mass-action.css"],crmConstants.lessStaticPathForLyte);return e.concat(t)},redirect:function(){"crm.settings.section.manage-mass-mail"==this.transition.target&&(this.transition.info.route="crm.settings.section.manage-mass-mail.index-mass-mail",this.replaceWith(this.transition.info))}}),Lyte.Router.registerRoute("crm.settings.section.sales-signals.manage-sales-signals",{getResources:function(){return networkUtils.returnDependencyFiles(["crm-manage-signals.js","managesignals.js","manage-signals-helpers.js"],crmConstants.jsStaticPathForLyte)},model:function(){return{}},beforeModel:function(){Crm.trackSpotLightAction("CRM Signals - Signal Settings",{Place:"Setup",Edition:Crm.userDetails.EDITION_NAME,Profile:Crm.userDetails.PROFILE_NAME})},afterModel:function(e){this.currentModel.brandName=Crm.brandName,this.currentModel.signals=store.peekAll("signal").filter(crmNTCSettings.filterOutCustomSignals),this.currentModel.extensions=store.peekAll("extensions").filterBy({type:4}),this.currentModel.widgets=store.peekAll("widgets").filterBy({type:"SALES_SIGNALS"}),this.currentModel.functions=store.peekAll("function").filterBy({category:"salessignals"}).filter(crmNTCSettings.filterOutCustomSignalCF),this.currentModel.extensionsList=store.peekAll("extensions").filterBy({type:4}),this.currentModel.filteredCategory="All"},renderTemplate:function(){return this.parent.currentModel.$.meta.manage_signals?{outlet:"#result",component:"crm-manage-signals"}:(crmui.showMsgBand("error",I18n.getMsg("crm.setup.attribution.FEATURE_NOT_SUPPORTED"),3e3),"")},afterRender:function(e){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.ntc.label.settings.notificationTitle"),Crm.partnerName]))}}),Lyte.Router.registerRoute("crm.settings.section.manage-tags",{queryParams:["module"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-manage-tag.js","crux-tag.js","crm-mass-tool-header.js"],crmConstants.jsStaticPathForLyte);if(Crm.userDetails.RTL_ENABLED)var t=networkUtils.returnDependencyFiles(["crm-manageTag-rtl.css"],crmConstants.cssStaticPathForLyte);else t=networkUtils.returnDependencyFiles(["crm-manageTag.css"],crmConstants.cssStaticPathForLyte);t=t.concat(networkUtils.returnDependencyFiles(["crm-mass-tool-header.css"],crmConstants.lessStaticPathForLyte));var r=e.concat(t);return r.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("tags")])),r},beforeModel:function(){isSandboxAcc&&"true"==isSandboxAcc&&(renderingUtils.displayPermissionDenied(),this.transition.abort())},model:function(e){var t=e.queryParams.module;"Activities"===e.queryParams.module&&void 0===Crm.userDetails.permissions.Crm_Implied_Tags_Tasks&&(t=1==Crm.userDetails.permissions.Crm_Implied_Tags_Events?"Events":"Calls");var r=!1;return Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM&&Crm.userDetails.permissions["Crm_Implied_Edit_"+t]||(r=!0),r||"Activities"!==t?r||Crm.userDetails.permissions["Crm_Implied_Tags_"+t]||(r=!0):Crm.userDetails.permissions.Crm_Implied_Tags_Tasks||Crm.userDetails.permissions.Crm_Implied_Tags_Calls||Crm.userDetails.permissions.Crm_Implied_Tags_Events||(r=!0),r?(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),this.transition.abort(),!1):(CrmTags.isFromActivityModule="Activities"===t,CrmTags.currentModule="Activities"===t?"Tasks":t,t=moduleRecordMapping[CrmTags.currentModule].api_name,store.findAll("tag",{module:t}))},afterModel:function(e,t){this.currentModel={tagCounts:e.$.meta,tagResult:e,moduleName:CrmTags.currentModule,isFromActivityModule:CrmTags.isFromActivityModule,module_info:moduleRecordMapping[t.queryParams.module],apiName:moduleRecordMapping[CrmTags.currentModule].api_name}},renderTemplate:function(e,t){return{outlet:"#show",component:"crm-manage-tag"}},beforeExit:function(){store.unloadAll("tag"),this.removeFromCache(networkUtils.returnDependencyFiles(["crm-manageTag.css"],crmConstants.cssStaticPathForLyte))},actions:{onError:function(e,t){var r=e.response?JSON.parse(e.response):void 0;if(r&&("NOT_SUPPORTED_FEATURE"===r.code||"NO_PERMISSION"===r.code))return crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),!1},willTransition:function(){store.unloadAll("tag")}}}),Lyte.Router.registerRoute("crm.settings.section.mobile-apps",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["crm-zes-mixin.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["crm-mobileapp-store.js"],crmConstants.jsStaticPathForLyte))},getResources:function(){return networkUtils.returnDependencyFiles(["lyte-fileupload.js"],crmConstants.jsStaticPathForLyte).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zesmobileapps")]))},beforeModel:function(){Crm.userDetails.IS_ADMIN||(renderingUtils.displayPermissionDenied(),this.transition.abort())},redirect:function(){"crm.settings.section.mobile-apps"===this.transition.target&&this.replaceWith("crm.settings.section.mobile-apps.mobileapps-index")},beforeExit:function(){store.unloadAll("mobile-app"),delete Lyte.registeredMixins["crm-zes-mixin"].prevSelApps}},{mixins:["crm-zes-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.mobile-users",{queryParams:["page","traverse"],getDependencies:function(){var e=networkUtils.returnDependencyFiles(["crm-zes-mixin.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["crm-mobileapp-user-store.js"],crmConstants.jsStaticPathForLyte))},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-mobile-users.js"],crmConstants.jsStaticPathForLyte);return e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zesmobileapps")]))).concat(networkUtils.returnDependencyFiles(["crm-mobile-users.css"],crmConstants.cssStaticPathForLyte))},beforeModel:function(){Crm.userDetails.IS_ADMIN||(renderingUtils.displayPermissionDenied(),this.transition.abort())},model:function(e){var t={};return e.queryParams.traverse&&(t.traverse=e.queryParams.traverse),store.findAll("zes-user",t,!0)},afterModel:function(e,t){this.currentModel={users:e,record_count:e.$.meta.record_count,previous:e.$.meta.previous,next:e.$.meta.next},t.queryParams.page?(this.currentModel.recordStartIndex=20*(t.queryParams.page-1),this.currentModel.page=t.queryParams.page):this.currentModel.recordStartIndex=0},renderTemplate:function(){return{outlet:"#result",component:"crm-mobile-users"}},actions:{didTransition:function(){commonUtils.showHideLoadingDiv(!1),this.titleOnHover($(".zesUserName"),200),this.titleOnHover($(".zesUserMailId"),220)}}},{mixins:["crm-zes-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.modules",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_mbuilder.js","zohocrm_duplicateCheckPreference.js"]);e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-module-delete-denypop.js","crm-automationcomponentDenyPop.js","crm-client-portal-organize-modules.js","crm-moduledenypop.js","crm-event-picklist.js","lyte-colorpicker.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["zohocrm_fol.js"]))).concat(networkUtils.returnDependencyFiles(["crm-picklist-colorpicker.css"],crmConstants.cssStaticPathForLyte));var t=networkUtils.getI18nJSUrl("staticlookupfilter");e.push(networkUtils.returnDependencyFiles([t],null));var r=networkUtils.getI18nJSUrl("FieldOfLookup");e.push(networkUtils.returnDependencyFiles([r],null));var i=networkUtils.getI18nJSUrl("FORECASTS");e.push(networkUtils.returnDependencyFiles([i],null));var a=networkUtils.getI18nJSUrl("servicesetupkeys");e.push(networkUtils.returnDependencyFiles([a],null));var s=networkUtils.getI18nJSUrl("LineItemSubformMB");e.push(networkUtils.returnDependencyFiles([s],null));var o=networkUtils.getI18nJSUrl("InventoryModulePerm");return e.push(networkUtils.returnDependencyFiles([o],null)),e},model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",{params:{action:"getCustomizationModulesAndFeatures"}})},afterModel:function(e){this.transition.info.dynamicParams.length&&"Services"===this.transition.info.dynamicParams[0]&&"crm.settings.section.modules.module.jobsheet-layouts"===this.transition.target&&!e.showJobsheetLayout?(this.transition.abort(),crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied()):Crm.moduleInfo.hasOwnProperty("Services")&&e.hasOwnProperty("showJobsheetLayout")&&(Crm.moduleInfo.Services.showJobsheetLayout=e.showJobsheetLayout)},redirect:function(){"crm.settings.section.modules"===this.transition.target&&(this.replaceWith("crm.settings.section.modules.index-modules").data=this.transition.data)},renderTemplate:function(e,t){if(!Lyte.Router.getRouteInstance().transition.info.route.includes("crm.settings.section.modules.module.canvas"))return{outlet:"#customizeModuleDiv",html:Handlebars.templates.ModuleCustomization(e)}},afterRender:function(){$("#jobSheetLayoutsLI").hide()}}),Lyte.Router.registerRoute("crm.settings.section.orchestration",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-store.js","webform-model.js","Analytics.js"],crmConstants.jsStaticPathForLyte);return e.push({parent:networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("orchestration")]),child:networkUtils.returnDependencyFiles(["orchestration_config.js"],crmConstants.jsStaticPathForLyte)}),e.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("createrecordaction")])),e},getResources:function(){var e=networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-common.js","orchestration_common.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-common.css"],crmConstants.cssStaticPathForLyte))},beforeExit:function(){Lyte.registeredMixins.orchestration_builder&&Lyte.registeredMixins.orchestration_builder.Orchestration.instance&&(Lyte.registeredMixins.orchestration_builder.Orchestration.instance.reset(),Lyte.registeredMixins.orchestration_builder.Orchestration.instance=null),Lyte.registeredMixins.orchestration_report&&Lyte.registeredMixins.orchestration_report.OrchestrationReport.instance&&(Lyte.registeredMixins.orchestration_report.OrchestrationReport.instance.reset(),Lyte.registeredMixins.orchestration_report.OrchestrationReport.instance=null),window.Jsplumb=null,window.jsPlumb=null,window.Katavorio=null,window.Mottle=null,window.Biltong=null,window.jsPlumbUIComponent=null,window.FaraheyInstance=null,window.jsPlumbInstance=null,window.jsBezier=null,window.jsPlumbUtil=null,window.Farahey=null,store.unloadAll("orchestration_meta"),this.removeFromCache(networkUtils.returnDependencyFiles(["zohocrm_jsplumb.js"],crmConstants.jsStaticPath))},afterRender:function(){var e=$L("#setup_new_ContentDiv"),t=renderingUtils.windowHeight-(e.offset().top+28);LyteComponent.replaceWith=function(){var e=Array.from(arguments),t=e.shift();LyteComponent.ignoreDisconnect=!0;for(var r,i=t.parentNode,a=0;r=e[a];a++)i.insertBefore(r,t);t.remove(),LyteComponent.ignoreDisconnect=!1},e.css({height:t+"px"})}}),Lyte.Router.registerRoute("crm.settings.section.organization-emails",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/OrgEmailAction.do","POST",{params:{pageTitle:"org.email.settings",action:"orgEmail"}})},redirect:function(){"crm.settings.section.organization-emails"==this.transition.target&&(this.transition.info.route="crm.settings.section.email-configuration.organization-emails",this.replaceWith(this.transition.info))},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(){$("#result").addClass("crmEmailConfigDiv")},beforeExit:function(){$("#result").removeClass("crmEmailConfigDiv")}}),Lyte.Router.registerRoute("crm.settings.section.personal-settings",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-user-setup.js","modal-scroll-box-shadow.js","lyte-tree.js","lyte-hovercard.js","org-model.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-user-setup.css"],crmConstants.lessStaticPathForLyte),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours"),networkUtils.getI18nJSUrl("UserSetup"),networkUtils.getI18nJSUrl("ReportingToPopup")]);return e.concat(t).concat(Crm.returnPhoneFieldDependencyFiles()).concat(r)},model:function(e){var t={params:{actionName:"viewUser",userId:Crm.userDetails.USER_ID}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowUser.do","GET",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.security.userDetails"),Crm.partnerName])),showOrHideUserDetail($("#result")),$(".setuprightmenudiv").addClass("personalSettingsNewView"),labelWidthFixed("list","userDetailView")},beforeModel:function(){Crm.trackSpotLightAction("CRM Signals - Personal Settings Click",{Place:"Setup",Edition:Crm.userDetails.EDITION_NAME,Profile:Crm.userDetails.PROFILE_NAME})},didDestroy:function(){$(".setuprightmenudiv").removeClass("personalSettingsNewView")}}),Lyte.Router.registerRoute("crm.settings.section.phonebridge-platform",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PBXRegistration.do","GET",{params:{action:"pbxReg",scope:"",pageTitle:"crm.zti.phonebridge.token.tab.reg"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.phonebridge-token",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/GenerateAuthToken.do","GET",{params:{action:"genAuthToken",scope:"ZTI"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.pipelines",{getResources:function(){var e=[networkUtils.returnDependencyFiles(["crm-multipipeline-components.js","lyte-scrollTo.js"],crmConstants.jsStaticPathForLyte),networkUtils.returnDependencyFiles(["crm-multipipeline-components.css"],crmConstants.cssStaticPathForLyte),networkUtils.returnDependencyFiles(["zohocrm_zprocess.js",networkUtils.getI18nJSUrl("businesshours"),networkUtils.getI18nJSUrl("staticlookupfilter")])];return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_multipipelines.js"]))).concat(networkUtils.returnDependencyFiles(["zohocrm_mbuilder.js"]))).concat(networkUtils.returnDependencyFiles(["crm-event-picklist.js","lyte-colorpicker.js"],crmConstants.jsStaticPathForLyte)),e=(e=Crm.userDetails.RTL_ENABLED?e.concat(networkUtils.returnDependencyFiles(["crm-multipipeline-components-RTL.css","crm-picklist-colorpicker.css"],crmConstants.cssStaticPathForLyte)):e.concat(networkUtils.returnDependencyFiles(["crm-picklist-colorpicker.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-confirm-changes-popup.js"],crmConstants.jsStaticPathForLyte))},getDependencies:function(){return[networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("multipipelines")])]},queryParams:["layoutId"],beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM&&Crm.isMultipipelinesEnabled||(renderingUtils.displayPermissionDenied(),this.transition.abort())},model:function(){if(commonUtils.showHideLoadingDiv(!0),Crm.userDetails.isMultiPipelineActivated){if(store.unloadAll("pick_list_values"),store.unloadAll("pipeline"),this.transition.isAjaxRequest&&this.getQueryParams().layoutId)return(t={pipelines:store.findAll("pipeline",{layout_id:this.getQueryParams().layoutId})}).field=store.findRecord("field",Crm.userDetails.isMultiPipelineActivated,{module:Crm.moduleInfo.Potentials.apiname}),Lyte.resolvePromises(t);store.unloadAll("layout");var e={module:Crm.moduleInfo.Potentials.apiname},t={stages:store.findAll("stage",e),layouts:store.findAll("layout",e),field:store.findRecord("field",Crm.userDetails.isMultiPipelineActivated,e)};return this.getQueryParams().layoutId?(t.pipelines=store.findAll("pipeline",{layout_id:this.getQueryParams().layoutId}),Lyte.resolvePromises(t)):Lyte.resolvePromises(t).then((function(e){return t.pipelines=store.findAll("pipeline",{layout_id:e.layouts[0].id}),Lyte.resolvePromises(t)}))}return null},renderTemplate:function(e){return{outlet:"#result",component:Crm.userDetails.isMultiPipelineActivated&&store.peekRecord("field",Crm.userDetails.isMultiPipelineActivated)?"crm-multipipelines":"crm-pipeline-initial-page"}},afterModel:function(e){commonUtils.showHideLoadingDiv(),e&&store.peekRecord("field",Crm.userDetails.isMultiPipelineActivated)&&(this.currentModel={},this.currentModel.layouts=store.peekAll("layout"),this.currentModel.selectedLayout=this.getQueryParams().layoutId?this.getQueryParams().layoutId:this.getFirstAvailableLayout(this.currentModel.layouts),this.currentModel.limit_reached=this.isPipelineLimitReached(this.currentModel.layouts),this.currentModel.pipelines=e.pipelines&&e.pipelines.length>0?this.processPipelines(e.pipelines[0].pick_list_values.slice(0)):[],this.currentModel.isDeactive=store.peekRecord("layout",this.currentModel.selectedLayout).status<0,this.currentModel.isRestrictedEdition="N"===Crm.userDetails.LICENSE_TYPE||"L"===Crm.userDetails.LICENSE_TYPE||"F"===Crm.userDetails.LICENSE_TYPE||"R"===Crm.userDetails.LICENSE_TYPE||"E"===Crm.userDetails.LICENSE_TYPE)},afterRender:function(e){if(Crm.userDetails.isMultiPipelineActivated&&store.peekRecord("field",Crm.userDetails.isMultiPipelineActivated)){var t=$(".pipelineWraperInner");this.pipelineWraperScroll(t),crmLayout.Resize.pipelineStagesHght(),e.isDeactive||crmui.hideTooltip(),this.transition.isCreateSuccess&&(this.showCreationSuccessMsg("stdCreated"===this.transition.isCreateSuccess),t.animate({scrollLeft:$(".pipelineWraper").outerWidth()+20-t.outerWidth()},800)),this.transition.unSavedChanges&&($L("#addNewPipeBtn").removeClass("warnCreate"),this.transition.showCreatePopup&&document.querySelector("crm-multipipelines").component.executeMethod("showCreatePopup"))}Crm.client_tracking("Pipeline - Pipelines Click ",{Place:"Setup"})},actions:{onError:function(e){if(403===e.status)renderingUtils.displayPermissionDenied();else if(e.response){var t=JSON.parse(e.response);t.message="INVALID_MODULE"===t.code?I18n.getMsg("crm.pipeline.module.hidden.alert",I18n.getMsg(moduleRecordMapping.Deals.plural_label)):t.message;var r=t.message?t.message:I18n.getMsg("crm.skyeye.setup.msg.error");renderingUtils.showCustomAlert(r,void 0,!1,(function(){renderingUtils.ajaxErrorBackForLyte()}))}return commonUtils.showHideLoadingDiv(),!1},willTransition:function(e){$L("#addNewPipeBtn").hasClass("warnCreate")&&!e.ignore&&(e.pause(),e.unSavedChanges=!0,Lyte.Component.render("crm-confirm-changes-popup",{transitionObject:e,popupHeader:I18n.getMsg("crm.event.layout.leavepage.confirm.message2"),popupContent:I18n.getMsg("crm.email.wfrule.create.cancel.msg")},"#confirmChanges"),document.querySelector("crm-multipipelines").component.setData("selectedLayout",this.currentModel.selectedLayout))}},isPipelineLimitReached:function(e){var t=0,r=Crm.userDetails.isTrialEnabled?crmConstants.Pipelines.max_limit.Trial:crmConstants.Pipelines.max_limit[Crm.userDetails.LICENSE_TYPE]?Crm.userDetails.ULTIMATE_ADDON_COUNT?crmConstants.Pipelines.max_limit.U:crmConstants.Pipelines.max_limit[Crm.userDetails.LICENSE_TYPE]:crmConstants.Pipelines.default_max_limit;if(this.transition.isAjaxRequest&&this.getQueryParams().layoutId)t=store.peekRecord("field",Crm.userDetails.isMultiPipelineActivated).pick_list_values.length;else for(var i=e.length,a=store.peekRecord("field",Crm.userDetails.isMultiPipelineActivated),s=0;s<i;s++)t+=a[e[s].id]?a[e[s].id].pick_list_values.length:0;return t>=r},processPipelines:function(e){for(var t=e.length,r=0;r<t;r++){for(var i=e[r],a=i.maps.length,s=[],o=0;o<a;o++){var n=i.maps[o];s[o]={id:n.id,display_value:n.display_value,fc_category:n.forecast_category.name,fc_probability:store.peekRecord("stage",n.id).probability,forecast_type:n.forecast_type,colour_code:n.colour_code},void 0!==n.colour_code&&Lyte.Component.set(i,"stageColorEnabled",!0)}i.setMinHeight=s.length>4,Lyte.Component.set(i,"stages",s)}return e},showCreationSuccessMsg:function(e){e?$L("#firstTimecreateNewPipelinePop")[0].ltProp("show",!0):crmui.showMsgBand("success",I18n.getMsg("crm.pipeline.create.message"),2e3)},pipelineWraperScroll:function(e){var t=$L(e).scrollLeft(),r=$L(e).outerWidth(),i=$L(".pipelineWraper").width();i>r?(i==r+t-15?($L(e).removeClass("pipelineWraperHasScroll"),$L(".pipeLineScrollArrowRight").css("display","none")):($L(e).addClass("pipelineWraperHasScroll"),$L(".pipeLineScrollArrowRight").css("display","block")),0==t?($L(e).removeClass("pipelineWraperHasLeftScroll"),$L(".pipeLineScrollArrowLeft").css("display","none")):($L(e).addClass("pipelineWraperHasLeftScroll"),$L(".pipeLineScrollArrowLeft").css("display","block"))):($L(".pipeLineScrollArrowLeft, .pipeLineScrollArrowRight").css("display","none"),$L(e).removeClass("pipelineWraperHasLeftScroll"))},getFirstAvailableLayout:function(e){for(var t=e.length,r=0;r<t;r++){var i=e[r];if(-3!==i.status&&13!==i.status)return i.id}}}),Lyte.Router.registerRoute("crm.settings.section.profiles",{redirect:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Profiles&&featuresAvailable.Profiles?"crm.settings.section.profiles"===this.transition.target&&this.replaceWith("crm.settings.section.profiles.index-profiles"):(renderingUtils.displayPermissionDenied(),this.transition.abort())},beforeExit:function(){app.refetchModulesMeta=!0}}),Lyte.Router.registerRoute("crm.settings.section.recyclebin",{getResources:function(){var e=[],t=networkUtils.returnDependencyFiles(["crm-recyclebin.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles(["crm-recyclebin.css"],crmConstants.cssStaticPathForLyte);return e=e.concat(t.concat(r))},beforeModel:function(){var e=$L("crm-recyclebin-notification-popup");e.length>0&&e[0].remove()},model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowRBList.do","GET")},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.topmenu.recyclebin"),Crm.partnerName])),loadRecycleBinTotalRecCount()}}),Lyte.Router.registerRoute("crm.settings.section.remove-sample-data",{queryParams:["migrationId"],getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_import.js",networkUtils.getI18nJSUrl("import")])},renderTemplate:function(e,t){var r="$('#rollbackSampData').hide();Crm.trackSpotLightAction('Customer OnBoarding - Delete Sample Data',{'Place':'Setup'});Crm.client_tracking('Customer OnBoarding - Delete Sample Data',{'Place':'Setup'});Lyte.Router.transitionTo('crm.settings.index');Lyte.Router.getRouteInstance('crm.settings.section.remove-sample-data').actions.deleteSampleData('"+this.getQueryParams().migrationId+"');",i=$("<div></div>").attr("data-onclick",r);showDeletePopup(I18n.getMsg("crm.remove.sample.data.message"),I18n.getMsg("crm.yes.proceed"),"","",i[0],"removeSampleData")},afterRender:function(e,t){document.title=I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("cob.remove.sampledata"),Crm.partnerName])},actions:{deleteSampleData:function(e){store.findAll("dummy",null,!1,!1,{url:"/crm/bulk/v2/migration/"+e,method:"DELETE"}).then((function(e){if(e&&e.dummy&&"SUCCESS"===e.dummy.code){var t=$L("crm-setup")[0].component;if(t){var r,i=t.getData("globalSetpJson");if(i&&i[1])for(r in i[1])if(void 0!==i[1][r].api_name&&"system.dataadministration"===i[1][r].api_name){for(var a=i[1][r].menus,s=-1,o=a.length,n=0;n<o;n++)if("system.removesampledata"===a[n].api_name){s=n;break}-1!==s&&Lyte.arrayUtils(i[1][r].menus,"removeAt",s,1);break}}crmui.showMsgBand("warning",I18n.getMsg("crm.remove.sample.data.initiated"),5e3)}else crmui.showMsgBand("warning",I18n.getMsg("crm.migration.contactFormError"),5e3)}))}}}),Lyte.Router.registerRoute("crm.settings.section.review-process",{getResources:function(){var e;return e=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-reviewprocess-view-rtl.css","crm-reviewprocess-view.css"],crmConstants.cssStaticPathForLyte):networkUtils.returnDependencyFiles(["crm-reviewprocess-view.css"],crmConstants.cssStaticPathForLyte),networkUtils.returnDependencyFiles(["crm-reviewprocess-errMsg.js"],crmConstants.jsStaticPathForLyte).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reviewprocess"),networkUtils.getI18nJSUrl("businesshours")])).concat(e)},renderTemplate:function(){return{outlet:"#result",component:"crm-reviewprocess-errormsg"}},afterRender:function(){"P"!==Crm.userDetails.LICENSE_TYPE&&"S"!==Crm.userDetails.LICENSE_TYPE||(this.transition.abort(),$L("#rpNotSupportPop").e.ltProp({width:"500px",show:!0,showCloseButton:!1}))}}),Lyte.Router.registerRoute("crm.settings.section.review-usage",{getResources:function(){return networkUtils.returnDependencyFiles(["crm-reviewprocess-errMsg.js"],crmConstants.jsStaticPathForLyte).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reviewprocess")])).concat(networkUtils.returnDependencyFiles(["zohocrm_analytics.js"],crmConstants.jsStaticPath)).concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles()))},renderTemplate:function(){return CrmAnalytics.initChart(),{outlet:"#result",component:"crm-reviewprocess-errormsg"}},afterRender:function(){"P"!==Crm.userDetails.LICENSE_TYPE&&"S"!==Crm.userDetails.LICENSE_TYPE||(this.transition.abort(),$L("#rpNotSupportPop").e.ltProp({width:"500px",show:!0,showCloseButton:!1}))}}),Lyte.Router.registerRoute("crm.settings.section.roles",{getResources:function(){if(Crm.userDetails.permissions.Crm_Implied_Manage_Roles&&featuresAvailable.Roles){var e=networkUtils.returnDependencyFiles(["crm-roles-resources.js","lyte-tree.js","org-model.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-roles-resources.css"],crmConstants.cssStaticPathForLyte);if(Crm.userDetails.RTL_ENABLED){var r=networkUtils.returnDependencyFiles(["crm-roles-rtl.css"],crmConstants.cssStaticPathForLyte);t=t.concat(r)}var i=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ReportingToPopup"),networkUtils.getI18nJSUrl("Roles")]);return e.concat(t).concat(i)}},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Roles&&featuresAvailable.Roles||(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),this.transition.abort())},redirect:function(){"crm.settings.section.roles"===this.transition.target&&this.replaceWith("crm.settings.section.roles.index-roles")}}),Lyte.Router.registerRoute("crm.settings.section.sales-signals",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-signal-model.js","crm-widget-container.js","custom-function-model.js","function-model.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e,t=networkUtils.returnDependencyFiles(["crm-signal-panel.js","managesignals.js","manage-signals-helpers.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles(["custom-function-functionlist.js","custom-function-editor.js","crm-function-components-wrapper.js","crm-functions-helper.js"],crmConstants.jsStaticPathForLyte),i=networkUtils.returnDependencyFiles(["zohocrm_signalsettings.js",networkUtils.getI18nJSUrl("customfunctions"),"zcrm_custom_functions.min.js"]);return e=(e=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-manage-signals-rtl.css","crm-manage-signals.css","function-common.css"],crmConstants.cssStaticPathForLyte):networkUtils.returnDependencyFiles(["crm-manage-signals.css","function-common.css","custom-function-functionlist.css","custom-function-editor.css","crm-reviewprocess-customfunction.css"],crmConstants.cssStaticPathForLyte)).concat(networkUtils.returnDependencyFiles(["widget/crm-widget-container.css"],crmConstants.lessStaticPathForLyte)),t.concat(r).concat(i).concat(e)},model:function(){return store.findAll("extensions")},redirect:function(){if("crm.settings.section.sales-signals"===this.transition.target){var e=this.transition.data;this.replaceWith({route:"crm.settings.section.sales-signals.index-sales-signals"}).data=e}}}),Lyte.Router.registerRoute("crm.settings.section.sandbox",{getDependencies:function(){return networkUtils.returnDependencyFiles(["sandbox.js","crm-organization-create-domainpattern.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e,t=networkUtils.returnDependencyFiles(["sandbox-min.js"]),r=networkUtils.returnDependencyFiles(["sandbox-min.css"],crmConstants.cssStaticPath),i=networkUtils.returnDependencyFiles(["crm-sandbox-accessibleto.css"],crmConstants.cssStaticPathForLyte),a=networkUtils.returnDependencyFiles(["crm-organization-create-domainpattern.css"],crmConstants.cssStaticPathForLyte),s=networkUtils.returnDependencyFiles(["crm-sandbox-list.js","lyte-dateselect.js","lyte-daterangepicker.js"],crmConstants.jsStaticPathForLyte);if(Crm.userDetails.RTL_ENABLED){e=networkUtils.returnDependencyFiles(["crm-sandbox-rtl.css"],crmConstants.cssStaticPathForLyte);var o=networkUtils.returnDependencyFiles(["crm-create-sandbox.css","crm-list-view-crux.css"],crmConstants.cssStaticPathForLyte),n=networkUtils.returnDependencyFiles(["crm-sandbox-list.css"],crmConstants.cssStaticPathForLyte);e=(e=e.concat(o)).concat(n)}else e=networkUtils.returnDependencyFiles(["crm-sandbox-list.css"],crmConstants.cssStaticPathForLyte);var l=networkUtils.returnDependencyFiles(["crm-sandbox-accessibleto.js"],crmConstants.jsStaticPathForLyte),c=networkUtils.returnDependencyFiles(["crm-sandbox-users.js"],crmConstants.jsStaticPathForLyte),d=networkUtils.returnDependencyFiles(["crm-sandbox-users.css"],crmConstants.cssStaticPathForLyte),u=networkUtils.returnDependencyFiles(["crm-sandbox-deploymentlogs.css","lyte-ui-daterangepicker.css"],crmConstants.cssStaticPathForLyte),m=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("sandbox")]);return t.concat(r).concat(i).concat(a).concat(s).concat(l).concat(c).concat(u).concat(d).concat(e).concat(m)},model:function(){if(Crm.isMultiSandboxEnabled)return store.unloadAll("sandbox"),store.findAll("sandbox",{include_inner_details:"created_by.image_link"})},afterModel:function(e){if("crm.settings.section.sandbox.sandbox-deployment-logs"===this.transition.target&&0===e.length){var t=this.transition.data;this.replaceWith("crm.settings.section.sandbox.sandbox-list").data=t}},redirect:function(){if("crm.settings.section.sandbox"===this.transition.target&&!this.transition.data.refresh){var e=this.transition.data;this.replaceWith("crm.settings.section.sandbox.sandbox-list").data=e}},actions:{onError:function(e){Lyte.Router.getRouteInstance().transition.abort();var t=JSON.parse(e.responseText);"company name not found"!==t.message?"permission denied"!==t.message&&"permission denied"!==t.data||renderingUtils.displayPermissionDenied():Lyte.Router.transitionTo("crm.settings.section.company-details")},didTransition:function(){this.transition.data.refresh&&this.refresh(),commonUtils.showHideLoadingDiv()}}}),Lyte.Router.registerRoute("crm.settings.section.schedule-mass-email",{queryParams:["module"],model:function(e){var t={newModel:!0,step:"showAllSchedules"};t.module=e.queryParams.module;var r={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CreateMassMailScheduler.do","GET",r)},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.schedules",{getDependencies:function(){return networkUtils.returnDependencyFiles(["zohocrm_schedules.js","zcrm_pushComponent.js"])},model:function(e){return networkUtils.lyteInitiateRequest("/crm/v2/settings/schedules","GET")},afterModel:function(e,t){this.currentModel=crm_schedules.alterResponse(e)},renderTemplate:function(e,t){return crm_schedules.schedules_count=e.schedules_count,{outlet:"#result",html:Handlebars.templates.SchedulesConfig(e)}},afterRender:function(e,t){crm_schedules.postRender(e)},beforeExit:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess(),ZohoDRE.resetRequestData()}}),Lyte.Router.registerRoute("crm.settings.section.scoring-rules",{queryParams:["module"],getDependencies:function(){return"undefined"!=typeof scoringRulesSettings||isMultiScoreAvail?isMultiScoreAvail?networkUtils.returnDependencyFiles(["scoringrules_mixin.js"],crmConstants.jsStaticPathForLyte):void 0:networkUtils.returnDependencyFiles(["zohocrm_scoringrule.js"])},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("scoringrules")]);return isMultiScoreAvail&&(e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("scoringrulesnew")]))).concat(networkUtils.returnDependencyFiles(["scoringrules_store.js"],crmConstants.jsStaticPathForLyte))),e},redirect:function(){isMultiScoreAvail&&"crm.settings.section.scoring-rules"===this.transition.target&&this.replaceWith("crm.settings.section.scoring-rules.index-scoring-rule")},model:function(){if(!isMultiScoreAvail){var e=this.getQueryParams().module;return new Promise((function(t){scoringRulesSettings.initRequest("/crm/v2/settings/modules","GET","",(function(r){for(var i=0,a=[],s=r.modules.length;i<s;){if(r.modules[i].scoring_supported&&r.modules[i].visible){var o="Deals"===r.modules[i].module_name?"Potentials":r.modules[i].module_name;o="Meetings"===r.modules[i].module_name?"Events":o,a.push({module_name:o,plural_label:r.modules[i].plural_label})}i++}if(0!=a.length){scoringRulesSettings.supported_modules=a;var n={params:{module:e=void 0!==e?e:a[0].module_name},success_callback:t};return networkUtils.makeRequest("/crm/v2/settings/scoring_rules","GET",n)}var l='<div class="topdivcontainer p30 pL40 pR40" style="position:relative;"><div class="oH"> <div class="darkMainHead fL mB5">'.concat(I18n.getMsg("crm.label.scoring.rules")).concat("</div> </div>");l=(l=l.concat('<div class="cB"> <div class="mT15 content mB30">').concat(I18n.getMsg("crm.label.scoring.rules.records.content"))).concat('</div> <div class="w200"></div></div> <div class="crm-error-page pR pL30"><span class="crm-error-page-icon p0"></span> <h2 style="color:#DD4B39;" class="mL15">').concat(I18n.getMsg("crm.label.scoring.rules.module.not.present.content")).concat("</h2></div></div>"),t(l)}))}))}},afterModel:function(e){if(!isMultiScoreAvail){if("NO_PERMISSION"===e.code)return void renderingUtils.displayPermissionDenied();if("PATTERN_NOT_MATCHED"===e.code)return void renderingUtils.displayPermissionDenied();scoringRulesSettings.supported_modules&&0!=scoringRulesSettings.supported_modules.length&&(scoringRulesSettings.processExtensions(e),e.supported_modules=scoringRulesSettings.supported_modules,e.info.module_singularlabel=moduleRecordMapping[e.info.module].singular_label,e.info.module_plurallabel=moduleRecordMapping[e.info.module].plural_label,scoringRulesSettings.isSchedulerRunning=e.info.isSchedulerRunning,scoringRulesSettings.isScoringRulePresent=e.scoring_rules.length>0)}},renderTemplate:function(e){if(!isMultiScoreAvail)return scoringRulesSettings.supported_modules&&0!=scoringRulesSettings.supported_modules.length?{outlet:"#result",html:Handlebars.templates.ScoringRuleSettings(e)}:{outlet:"#result",html:e}},afterRender:function(e){if(this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.scoring.rules"),Crm.partnerName])),!isMultiScoreAvail){$("#scoring_module option[value="+e.info.module+"]").prop("selected",!0),thirdPartyUtils.bindSelect2(".newSelect select");var t=renderingUtils.windowOuterHeight-(parseInt($("#tabLayer").innerHeight())+28);$("#setup_new_leftmenuDiv").height(t).addClass("oA"),$("#setup_new_ContentDiv").height(t).addClass("oA helpOverflowHide")}},actions:{willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall()),$("#setup_new_ContentDiv").removeClass("helpOverflowHide")}}}),Lyte.Router.registerRoute("crm.settings.section.sdks",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_sdk.js",networkUtils.getI18nJSUrl("sdk")]),t=networkUtils.returnDependencyFiles(["crmSDK-min.css"],crmConstants.cssStaticPath);return e.concat(t)},renderTemplate:function(e,t){return{outlet:"#result",html:Handlebars.templates.CrmSDK()}},actions:{onError:function(e,t,r){return!1}}}),Lyte.Router.registerRoute("crm.settings.section.section-error",{afterModel:function(e,t){this.currentModel=this.transition.data},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.settings-wildcard",{renderTemplate:function(){return{outlet:"#result",html:Handlebars.templates.HigherEditionFeatures(crmSetup.setupObject[this.transition.data.route])}},afterRender:function(){$("#overlayHeader").hide(),$("#settingInner").hide(),$("#setupshow").show(),$("#mainResult").show(),commonUtils.showHideLoadingDiv()}}),Lyte.Router.registerRoute("crm.settings.section.storage",{queryParams:["type"],getDependencies:function(){return networkUtils.returnDependencyFiles(["datastorage-model.js","org-model.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=[RebrandLinkUtil.getProperty("STORE_CSS_STATIC_URL"),RebrandLinkUtil.getProperty("STORE_JS_STATIC_URL")],t=networkUtils.returnDependencyFiles(["datastorage.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles(["datastorage.css"],crmConstants.cssStaticPathForLyte),i=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("datastorage")]),a=t.concat(r).concat(i).concat(e);if(Crm.userDetails.RTL_ENABLED){var s=networkUtils.returnDependencyFiles(["datastorage-rtl.css"],crmConstants.cssStaticPathForLyte);a=a.concat(s)}return a},model:function(e){if("file"===this.getQueryParams().type){var t=store.findAll("storage_analytics"),r=store.triggerAction("storage_analytics","user_details",void 0,void 0,"GET");return Lyte.resolvePromises({storage_details:t,user_details:r})}return Lyte.resolvePromises({data_storage:store.findAll("data_storage").then((function(e){return e}))})},didDestroy:function(){window.zs_store&&Lyte.objectUtils(window,"delete","zs_store")},actions:{onError:function(e){e.constructor!==String&&e.response&&(e=e.response.constructor===String?JSON.parse(e.response).code:e.response.code),"NO_PERMISSION"!==e&&"INVALID_MODULE"!==e&&"INVALID_FORM_ID"!==e||(setTimeout((function(){renderingUtils.displayPermissionDenied()}),0),this.transition&&this.transition.abort())},willTransition:function(){var e=$L("crm-storage-module-cleanup")[0];e&&e.remove();var t=$L("crm-storage-cleanup-warning")[0];t&&t.remove()}},afterModel:function(e,t){"file_new"===t.queryParams.type&&(this.currentModel={file_storage:e})},renderTemplate:function(e,t){return"true"===RebrandLinkUtil.properties.ENABLE_DATA_STORAGE?($("#result").html(""),"file"===t.queryParams.type?(e.user_details=e.user_details.user_details,{outlet:"#result",component:"crm-setup-storage"}):e.data_storage&&"NO_PERMISSION"!==e.data_storage.code?{outlet:"#result",component:"crm-setup-storage"}:void renderingUtils.displayPermissionDenied()):{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.tab-groups",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CustomizeTabGroup.do","GET",{params:{action:"tabGroupList"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.telephony",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-provider-conf.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_phonebridge_home.js"])},model:function(){if(store.peekAll("provider_conf").length<=0){var e=Crm.getCrmBasePath()+"/CtiApiConfig.do",t={params:{mode:"telephonyConfigDetails"}};return networkUtils.lyteInitiateRequest(e,"GET",t)}return null},afterModel:function(e){e&&"object"==typeof e&&store.createRecord("provider_conf",e)},beforeExit:function(){store.peekAll("provider_conf")[0].$.deleteRecord(),ctiApiConfig.providerListData=null},redirect:function(e){var t=store.peekAll("provider_conf")[0];"2"==t.$.get("providerType")&&this.replaceWith("crm.settings.section.widget-telephony.marketplace"),this.transition.target.endsWith("telephony")&&(t.$.get("isEnabled")?this.replaceWith("crm.settings.section.telephony.configuration",this.getURINameFromProviderName(t.$.get("providerName"))):e&&"object"==typeof e&&"singleProvider"===e.view?this.replaceWith("crm.settings.section.telephony.summary",e.providerName):this.replaceWith("crm.settings.section.telephony.marketplace"))},getProviderNameFromURIName:function(e){return e=(e=e.replace(/__/g," ")).replace(/_at_/g,"@")},getURINameFromProviderName:function(e){return e=(e=e.replace(/\s/g,"__")).replace(/@/g,"_at_")}}),Lyte.Router.registerRoute("crm.settings.section.territories",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-userlookup-wrapper-component.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-userlookup-wrapper-component.css"],crmConstants.cssStaticPathForLyte);return e.concat(t)},redirect:function(){"crm.settings.section.territories"===this.transition.target&&this.replaceWith("crm.settings.section.territories.index-territories")},beforeExit:function(){app.refetchModulesMeta=!0}}),Lyte.Component.registerHelper("getTerritorityValue",(function(e){var t=[];return e?(e.forEach((function(e){t.push(e.Name)})),t.join(", ")):""})),Lyte.Router.registerRoute("crm.settings.section.territory-assign",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-list-kanban-container.js","crm-customview-dropdown.js","lyte-counter.js","crm-customview-helpers.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-list-kanban-container.css","crm-customview-dropdown.css"],crmConstants.cssStaticPathForLyte);return e.concat(t)},model:function(e){var t=this.transition.data,r=Object.keys(t).length>0?objectUtils.cloneObject(this.transition.data):{actiontype:"search"},i=Object.keys(t).length>0?"POST":"GET";return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/TerritoryAssignment.do",i,{params:r})},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.territory.title.assign.territories"),Crm.partnerName]))}}),Lyte.Router.registerRoute("crm.settings.section.territory-rules",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/TerritoryConfig.do","GET",{params:{action:"territoryRules"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.territory.view.rules"),Crm.partnerName]))}}),Lyte.Router.registerRoute("crm.settings.section.translation-history",{queryParams:["importId","record_type"],getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_translationbench.js"])},model:function(e){return networkUtils.lyteInitiateRequest("/crm/v2/settings/translations/history?page=1&per_page=30","GET")},renderTemplate:function(e,t){return{outlet:"#result",html:Handlebars.templates.TranslationHistoryDiv(e)}},afterRender:function(e){$("#importedData").append(Handlebars.templates.TranslationHistoryRecordsWithoutDiv(e)),translationHistory.HistoryScroll(),translationHistory.hiddenScroll=!1,translationHistory.historyScrollCheck=0,translationHistory.scrollCount=1,void 0!==this.getQueryParams().importId&&void 0!==this.getQueryParams().record_type&&translationHistory.populateSummary(this.getQueryParams().importId,this.getQueryParams().record_type)},actions:{onError:function(e,t,r){var i=JSON.parse(e.responseText);return i.code.indexOf("NOT_SUPPORTED_FEATURE")>-1?crmui.showMsgBand("error",I18n.getMsg("crm.validation.rule.edition.not.support"),"4000",""):i.code.indexOf("NO_PERMISSION")>-1&&crmui.showMsgBand("error",I18n.getMsg("crm.zti.error.notauthendication"),"4000",""),Lyte.Router.getRouteInstance().replaceWith("crm.settings.index"),!1}}}),Lyte.Router.registerRoute("crm.settings.section.translation-settings",{getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_translationbench.js"])},model:function(e){return networkUtils.lyteInitiateRequest("/crm/v2/settings/translations","GET")},renderTemplate:function(e,t){return{outlet:"#result",html:Handlebars.templates.TranslationSettings(e)}},actions:{onError:function(e,t,r){var i=JSON.parse(e.responseText);return i.code.indexOf("NOT_SUPPORTED_FEATURE")>-1?crmui.showMsgBand("error",I18n.getMsg("crm.validation.rule.edition.not.support"),"4000",""):i.code.indexOf("NO_PERMISSION")>-1&&crmui.showMsgBand("error",I18n.getMsg("crm.zti.error.notauthendication"),"4000",""),Lyte.Router.getRouteInstance().replaceWith("crm.settings.index"),!1}}}),Lyte.Router.registerRoute("crm.settings.section.unsubscribe-form",{beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Unsubscribe_Form||(renderingUtils.displayPermissionDenied(),this.transition&&this.transition.abort())},model:function(){var e={params:{pageTitle:"crm.unsubscription.form",step:"unsubscribe",isFromBack:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Template.do","POST",e)},renderTemplate:function(e){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.users",{queryParams:["type","reqZUID","requestUID"],beforeModel:function(e){},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-user-setup.js","modal-scroll-box-shadow.js","lyte-tree.js","lyte-hovercard.js","org-model.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-user-setup.css"],crmConstants.lessStaticPathForLyte),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours"),networkUtils.getI18nJSUrl("UserSetup"),networkUtils.getI18nJSUrl("ReportingToPopup")]);return e.concat(t).concat(r).concat(Crm.returnPhoneFieldDependencyFiles())},model:function(e){if(this.transition.cachedResponse)return this.transition.cachedResponse;var t=e.queryParams;if(null!=t.type){var r={params:{actionName:t.type}};return this.transition.data&&this.transition.data.territoryId&&(r.params.territoryId=this.transition.data.territoryId),(i=this.transition.info.dynamicParams).length>0&&(r.params.requestUID=i[0]),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Security.do","GET",r)}r={params:{actionName:"viewAllUsers"}};var i=this.transition.info.dynamicParams;return this.transition.data&&this.transition.data.territoryId&&(r.params.territoryId=this.transition.data.territoryId),t.reqZUID&&(r.params.reqZUID=t.reqZUID),i.length>0&&(r.params.requestUID=i[0]),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowAllUsers.do","GET",r)},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e){if(this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.security.usersList"),Crm.partnerName])),"undefined"!=typeof isNeedChangeUID&&1==isNeedChangeUID){var t=Lyte.Router.getRouteInstance();usersArray.length>0?t.transitionTo({route:"crm.settings.section.users.view",dynamicParams:[usersArray[0].userID],queryParams:{type:t.getQueryParams().type}}):t.transitionTo({route:"crm.settings.section.users.view",queryParams:{type:t.getQueryParams().type}})}setuserlistCV()},actions:{willTransition:function(e){Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall())},didTransition:function(){if("crm.settings.section.users"==this.transition.target){if(null==this.getQueryParams().type||"ActiveUsers"==this.getQueryParams().type)this.getQueryParams().type?this.replaceWith("crm.settings.section.users.view",Crm.userDetails.USER_ID,{type:this.getQueryParams().type}):this.replaceWith("crm.settings.section.users.view",Crm.userDetails.USER_ID);else if($("#userlistview").find("tr.userlisttd").length>0){var e=$($("#userlistview").find("tr.userlisttd")[0]).attr("id").split("row_u_")[1];this.getQueryParams().type?this.replaceWith("crm.settings.section.users.view",e,{type:this.getQueryParams().type}):this.replaceWith("crm.settings.section.users.view",e)}var t=$L("#importUsers");if(t.length){var r=$L("#UsersMenuListDiv").closest("table").outerWidth()-90-($L("#adduserbutton").outerWidth()+t.outerWidth());r<=230&&$L("#userlistCV").css({"min-width":r-35+"px","max-width":r+"px"})}}}}}),Lyte.Router.registerRoute("crm.settings.section.review-usage.view-review-usage",{queryParams:["component_id","component_name"],getResources:function(){var e,t=networkUtils.returnDependencyFiles(["crm-reviewprocess-chart.js"],crmConstants.jsStaticPathForLyte);return e=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-reviewprocess-usagecomponent-rtl.css","crm-reviewprocess-usagecomponent.css"],crmConstants.cssStaticPathForLyte):networkUtils.returnDependencyFiles(["crm-reviewprocess-usagecomponent.css"],crmConstants.cssStaticPathForLyte),t.concat(e)},getDependencies:function(){return networkUtils.returnDependencyFiles(["Analytics.js"],crmConstants.jsStaticPathForLyte)},model:function(e){return commonUtils.showHideLoadingDiv(!0),Lyte.resolvePromises({modules:this.getModules(),dashboardid:e.dynamicParam,componentid:e.queryParams.component_id,componentname:e.queryParams.component_name})},afterModel:function(){var e=this;return Lyte.resolvePromises({layoutDetails:e.getLayoutDetails(e.currentModel.modules[0].api_name)}).then((function(t){e.currentModel.layoutDetails=t.layoutDetails}))},renderTemplate:function(){return{outlet:"#result",component:"crm-reviewprocess-usagecomponent"}},getLayoutDetails:function(){return this.getModules(!0)}},{mixins:["reviewprocess"]}),Lyte.Router.registerRoute("crm.settings.section.voice-of-customer",{getDependencies:function(){return networkUtils.returnDependencyFiles(["voc-setup-data-store.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("vocsetup")]),t=networkUtils.returnDependencyFiles(["voc-setup.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles(["voc-setup.css"],crmConstants.lessStaticPathForLyte);return t.concat(r).concat(e)},model:function(){return{voc:store.findAll("voc_setup")}},afterModel:function(e){e.showGetStarted=this.error_key,e.vocSetupInfo=e.voc[0],e.reEnableFlow=!this.error_key&&!e.voc[0].enabled,delete this.error_key},renderTemplate:function(){return{outlet:"#result",component:"crm-voc-setup"}},actions:{onError:function(e,t){var r=JSON.parse(e.response);if("FEATURE_NOT_ENABLED"===r.code)return this.error_key=!0,this.currentModel={voc:[{enabled:!1}]},t.resume(),!1;if("NO_PERMISSION"===r.code){var i=this;renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){i.replaceWith("crm.settings.index")}))}else renderingUtils.showMsgBox(I18n.getMsg("error.unknown.problem"),"error");return this.transition.abort(),!1}}}),Lyte.Router.registerRoute("crm.settings.section.web-apps",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["crm-zes-mixin.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["zes-client-store.js"],crmConstants.jsStaticPathForLyte))},getResources:function(){return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zesmobileapps")])},beforeModel:function(){Crm.userDetails.IS_ADMIN||(renderingUtils.displayPermissionDenied(),this.transition.abort())},redirect:function(){"crm.settings.section.web-apps"===this.transition.target&&this.replaceWith("crm.settings.section.web-apps.webapps-index")},beforeExit:function(){store.clearCachedQuery("user",{type:"ActiveConfirmedUsers"}),store.unloadAll("zes-client")}},{mixins:["crm-zes-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.web-tabs",{getResources:function(){if(Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM){var e=[];return e.push(networkUtils.returnDependencyFiles(["crm-webtabs-resources.js","definition-model.js"],crmConstants.jsStaticPathForLyte)),e.push(networkUtils.returnDependencyFiles(["crm-webtabs-resources.css"],crmConstants.cssStaticPathForLyte)),e}},beforeModel:function(){var e=Crm.userDetails.LICENSE_TYPE,t=("crm.settings.section.web-tabs.create-webtabs"===this.transition.target||"crm.settings.section.web-tabs.edit-webtabs"===this.transition.target)&&-1===["E","A","C","Z","U","D"].indexOf(e);Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM&&!t||(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),this.transition.abort())},redirect:function(){if("crm.settings.section.web-tabs"===this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.web-tabs.index-webtabs",this.replaceWith(e)}}}),Lyte.Router.registerRoute("crm.settings.section.webform",{queryParams:["module"],renderThis:!0,getDependencies:function(){return networkUtils.returnDependencyFiles(["webform.js","webform-model.js","abtesting.js","crm-webform-abtesting-config.js","abtesting-model.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("webforms")],crmConstants.jsStaticPath);if(e=(e=e.concat(networkUtils.returnDependencyFiles(["webform-common-files.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["webform-common-files.css"],crmConstants.cssStaticPathForLyte)),Crm.webformAnalyticsEnabled){e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-webform-analytics-config_new.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-webform-analytics-config_new.css"],crmConstants.cssStaticPathForLyte));var t=networkUtils.returnDependencyFiles(["zohocrm_analytics.js"],crmConstants.jsStaticPath),r={parent:networkUtils.returnDependencyFiles(["zohocrm_chart.js"],crmConstants.jsStaticPath),child:[t,networkUtils.returnDependencyFiles(["zohocrm_webformAnalytics_chartRenderer.js"],crmConstants.jsStaticPath)]};Crm.isZohoChartsEnabled?e=e.concat(networkUtils.returnDependencyFiles(["webform-zcharts-handler.js"],crmConstants.jsStaticPathForLyte)):(r.parent=r.parent.concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles())),e=e.concat(networkUtils.returnDependencyFiles(["webform-highcharts-handler.js"],crmConstants.jsStaticPathForLyte))),e=e.concat(r)}return e},redirect:function(){if("crm.settings.section.webform"===this.transition.target){Crm.trackSpotLightAction("Webforms - Page Visited");var e=Object.assign({},this.transition.info);e.route="crm.settings.section.webform.index-webform",this.replaceWith(e)}},didDestroy:function(){store.unloadAll("webform"),store.unloadAll("webform-analytics")},beforeExit:function(){Crm.userDetails.RTL_ENABLED&&(Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-webform-rtl.css"],crmConstants.cssStaticPathForLyte)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["webform-builder-RTL.css"],crmConstants.cssStaticPathForLyte)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["webform-builder.css","crm-alert-addresswrapper.css"],crmConstants.cssStaticPathForLyte)))},actions:{willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall())}}},{mixins:["webform","webform-analytics-util"]}),Lyte.Router.registerRoute("crm.settings.section.widget-telephony",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-provider-conf.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_phonebridge_home.js"])},model:function(e){if(store.peekAll("provider_conf").length<=0){var t=Crm.getCrmBasePath()+"/CtiApiConfig.do",r={params:{mode:"telephonyConfigDetails"}};return networkUtils.lyteInitiateRequest(t,"GET",r)}return null},afterModel:function(e,t){e&&"object"==typeof e&&store.createRecord("provider_conf",e);var r=store.peekAll("provider_conf")[0];"1"==r.$.get("providerType")&&this.replaceWith("crm.settings.section.telephony.marketplace"),this.transition.target.endsWith("widget-telephony")&&(r.$.get("isEnabled")?this.replaceWith("crm.settings.section.widget-telephony.configuration",r.$.get("providerName")):this.replaceWith("crm.settings.section.widget-telephony.marketplace"))},beforeExit:function(){ctiApiConfig.providerListData=null}}),Lyte.Router.registerRoute("crm.settings.section.widget",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-setup-widget.js"],crmConstants.jsStaticPathForLyte)},beforeModel:function(){if(!featuresAvailable.Crm_Widgets)return crmui.showMsgBand("error",I18n.getMsg("crm.label.widgets.error.feature.unsupported"),3e3),void(Lyte.Router.transitionTo("crm.settings.index").refresh=!0)},model:function(e){return networkUtils.lyteInitiateRequest("/crm/v2/__internal/settings/customize/"+e.dynamicParam+"/actions/check_permission","POST")},renderTemplate:function(e){return e.settings_customization&&(e.settings_customization[0].permission||(renderingUtils.displayPermissionDenied(),this.transition.abort())),{outlet:"#result",component:"crm-setup-widget"}},afterRender:function(e,t){return commonUtils.showHideLoadingDiv(!1),globalSetpJson.components.filterBy({id:t.dynamicParam}).length?(crmui.showMsgBand("error",I18n.getMsg("crm.copy.config.link.expired"),4e3),void(Lyte.Router.transitionTo("crm.settings.index").refresh=!0)):"undefined"!=typeof WidgetHandler&&WidgetHandler.getWidget("Settings",t.dynamicParam)?void WidgetHandler.SetupWidget.render(void 0,t.dynamicParam):(crmui.showMsgBand("error",I18n.getMsg("crm.financesuite.pushnotify.toviewupdate"),1e4),void(Lyte.Router.transitionTo("crm.settings.index").refresh=!0))},actions:{didTransition:function(){commonUtils.showHideLoadingDiv(!1)}}}),Lyte.Router.registerRoute("crm.settings.section.wizard",{getDependencies:function(){if(Crm.client_tracking("Wizards - Explore wizards"),Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM){if(window.module=void 0,Crm.userDetails.RTL_ENABLED)var e=networkUtils.returnDependencyFiles(["crm-wizards-rtl.css","crm-wizards.css"],crmConstants.cssStaticPathForLyte);else e=networkUtils.returnDependencyFiles(["crm-wizards.css"],crmConstants.cssStaticPathForLyte);var t=networkUtils.returnDependencyFiles(["crm-wizards-list.js","crm-wizard-mixin.js","crm-wizard-configuration-helpers.js","crm-wizard-common-helpers.js"],crmConstants.jsStaticPathForLyte);return{parent:t=(t=t.concat(e)).concat(networkUtils.returnDependencyFiles(["i18n/"+Crm.userDetails.jsLocation+"wizards/zohocrm_"+$ESAPI.encoder().encodeForJavaScript(Crm.userDetails.LOCALE)+".js"],crmConstants.jsStaticPath)),child:t}}},beforeExit:function(){store.unloadAll("wizard"),store.unloadAll("wizard-container"),store.unloadAll("wizard-screen"),store.unloadAll("wizard-segment"),store.unloadAll("wizard-button"),store.unloadAll("transition"),store.unloadAll("custom_button"),this.removeFromCache(networkUtils.returnDependencyFiles(["zohocrm_jsplumb.js"],crmConstants.jsStaticPath)),$("body").removeClass("isWizard")},beforeModel:function(){!Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM||Crm.userDetails.ISROMODE?(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),this.transition.abort()):(store.unloadAll("wizard"),store.unloadAll("wizard-container"),store.unloadAll("wizard-screen"),store.unloadAll("wizard-segment"),store.unloadAll("wizard-button"),store.unloadAll("transition"),store.unloadAll("field"),store.unloadAll("layout"))}}),Lyte.Router.registerRoute("crm.settings.section.workflow-insights",{queryParams:["step","processId","module","isFromUsageTab"],getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_wfInsights.js"]);e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("workflowreports")],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles(["crm-workflow-reports-list-view.js"],crmConstants.jsStaticPathForLyte));var t=networkUtils.returnDependencyFiles(["crm-workflow-reports.css"],crmConstants.cssStaticPathForLyte);return Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-workflow-reports-rtl.css"],crmConstants.cssStaticPathForLyte))),e=e.concat(t)},model:function(e){var t=e.queryParams.step||"showInsights";if("getInsightDetails"==t){WFInsights.setDateRangeForListView(),WFInsights.module=e.queryParams.module,WFInsights.setCvidDetails(WFInsights.module);var r={params:{module:e.queryParams.module,isFromUsageTab:e.queryParams.isFromUsageTab?e.queryParams.isFromUsageTab:"false"}};return networkUtils.lyteInitiateRequest("/crm/v2/settings/workflow_rules/"+e.queryParams.processId+"/actions/generate_report","GET",r)}r={params:{step:t}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowRule.do","GET",r)},renderTemplate:function(e,t){var r=e,i="";"object"==typeof r&&"Success"==r.Result?"getInsightDetails"===t.queryParams.step?(r.isWFRLvEnabled=wfNew.isWFRLvEnabled,Handlebars.registerPartial("WFInsightActionDetails",Handlebars.templates.WFInsightActionDetails),i=Handlebars.templates.wfInsightDateFilter(r),i+=Handlebars.templates.WorkflowUsageReportView(r),WFInsights.populateFailureResonsToObject(r)):i=Handlebars.templates.WFInsightListView(r):i="<div class='m30 p30 aligncenter f18'>"+I18n.getMsg("crm.livedesk.error.exp.msg")+"</div>";return{outlet:"#result",html:i}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-rules",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["workflow-suggestion-components.js"],crmConstants.jsStaticPathForLyte),t=getworkflowjsfiles(!0);return e.concat(networkUtils.returnDependencyFiles(t))},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-workflow-reports-list-view.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["crm-workflow-reports.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-workflow-reports-rtl.css"],crmConstants.cssStaticPathForLyte))),e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("workflowreports")],crmConstants.jsStaticPath)),isMultiScoreAvail&&(e=e.concat(networkUtils.returnDependencyFiles(["wf_score_trigger.js"],crmConstants.jsStaticPathForLyte))),e},redirect:function(){if("crm.settings.section.workflow-rules"==this.transition.target)(e=Object.assign({},this.transition.info)).route="crm.settings.section.workflow-rules.index-workflow-rule",this.replaceWith(e);else if("crm.settings.section.workflow-rules.view-workflow-rule"==this.transition.target){var e;if(this.transition.url.includes("/show-summary"))(e=Object.assign({},this.transition.info)).route="crm.settings.section.workflow-rules.index-workflow-rule",this.replaceWith(e)}},beforeExit:function(){wfNew.resetWFObjs(),workflow.searchString=void 0,workflow.moduleSelected=void 0,workflow.statusSelected=void 0,workflow.execSelected=void 0,workflow.executeOnTypeSelected=void 0,Crm.isWorkflowSuggestionEnabled&&store.unloadAll("workflow_suggestion"),thirdPartyUtils.unbindSelect2(".newSelect select"),$.ui.ddmanager.current=null},actions:{willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||!ZohoHCAsap.UnInstall||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall())}}}),Lyte.Router.registerRoute("crm.settings.section.zia-reasoning",{queryParams:["module"],getResources:function(){var e=networkUtils.returnDependencyFiles(["lar-zia-reasoning.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaReasoning")],crmConstants.jsStaticPath),r=networkUtils.returnDependencyFiles(["lar-zia-reasoning.css"],crmConstants.cssStaticPathForLyte);return Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["lar-zia-reasoning-rtl.css"],crmConstants.cssStaticPathForLyte))),e.concat(r).concat(t)},getDependencies:function(){var e=networkUtils.returnDependencyFiles(["assignment-rules-mixin.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["lar-zia-reasoning-models.js"],crmConstants.jsStaticPathForLyte))},model:function(e){var t=e.queryParams.module,r=store.peekRecord("zia_reasoning","assignment_rules");if(void 0!==r)return this.fetchDataForZiaReasoningTab(r,t);var i={resource:"assignment_rules"},a=this;return store.findRecord("zia_reasoning","assignment_rules",i).then((function(e){return a.fetchDataForZiaReasoningTab(e,t)}),(function(e){this.processError(e)}))},beforeModel:function(){this.transition.preservePopup=!0},afterModel:function(e){var t=Lyte.registeredMixins["crm-zia-reasoning-mixin"].constructModelDataForZiaResoningTab(e);this.currentModel=t;var r=$L("crm-assignmentrules-zia-reasoning")[0];void 0!==r&&r.remove()},renderTemplate:function(){return{outlet:"#result",component:"crm-assignmentrules-zia-reasoning"}},beforeExit:function(){store.unloadAll("zia_reasoning")}},{mixins:["crm-zia-reasoning-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.zia",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_ziaconfig.js","zohocrm_chart.js","highcharts.js"]),t=networkUtils.returnDependencyFiles(["zohocrm_ziaconfig.css"],crmConstants.cssStaticPath);return e.concat(t)},beforeModel:function(){Handlebars.registerPartial("ZiaConfigOverAllChkbox",Handlebars.templates.ZiaConfigOverAllChkbox),Handlebars.registerPartial("ZiaConfigChkbox",Handlebars.templates.ZiaConfigChkbox),Handlebars.registerPartial("ziaPredictionSetup",Handlebars.templates.ziaPredictionSetup)},renderTemplate:function(){networkUtils.initChart()},beforeExit:function(){store.unloadAll("prediction")}}),Lyte.Router.registerRoute("crm.settings.section.zmail-users",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ZMailConfig.do","GET",{params:{action:"zmailUsers"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.zohocpq",{getDependencies:function(){return networkUtils.returnDependencyFiles(["cpq-helpers.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocpq.js","lytecombobox.js","lyte-hovercard.js","crm-cpq-settings.js","zohocpq-tab.js"],crmConstants.jsStaticPathForLyte);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("cpq")],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles(["crm-cpq-setting.css","zohocpq.css","zohocpq-tab.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crmsetup.css"],crmConstants.cssStaticPath)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-cpq-rtl.css"],crmConstants.cssStaticPathForLyte))),e},afterModel:function(){var e,t={},r=this.transition.info.dynamicParams,i=r[0];if(t.dynamicParam=i,Lyte.registeredMixins["crm-cpq-utils"].checkModulePermissions(i)){if(this.transition&&this.transition.data&&this.transition.data.type&&(e=this.transition.data.type),"error"!==e)switch(i){case"productConfigurator":t.configName=I18n.getMsg("Product configurator"),t.configDesc=I18n.getMsg("cpq.pc.brief.desc"),t.configCreateButton=I18n.getMsg("crm.module.create",[I18n.getMsg("Product configurator")]);break;case"priceRules":t.configName=I18n.getMsg("cpq.pr.featurename"),t.configDesc=I18n.getMsg("cpq.pr.featuredescription"),t.configCreateButton=I18n.getMsg("cpq.pr.create");break;case"CpqSettings":t.configName=I18n.getMsg("crm.cpq.settings.featurename");break;case"manageSubscriptions":t.configName="Manage Subscriptions",t.configDesc="Install/Deactivate CPQ and payment information",t.configCreateButton="CPQ Installed"}this.currentModel={configuratorInfo:t,dp:r}}else crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),this.transition.abort()},redirect:function(){var e;this.transition&&this.transition.data&&this.transition.data.type&&(e=this.transition.data.type),"crm.settings.section.zohocpq"===this.transition.target&&("error"===e?this.replaceWith("crm.settings.section.zohocpq.index-zohocpq",this.transition.info.dynamicParams[0]).data={type:"error"}:this.replaceWith("crm.settings.section.zohocpq.index-zohocpq",this.transition.info.dynamicParams[0]))},afterRender:function(e){if(e.configuratorInfo&&e.configuratorInfo.configName){var t=I18n.getMsg("crm.title.general.revamped",[e.configuratorInfo.configName,Crm.partnerName]);this.setTitle(t)}},beforeExit:function(){store.modelFor(moduleRecordMapping.Products.id)&&store.unloadAll(moduleRecordMapping.Products.id),store.modelFor("product_configurator")&&store.unloadAll("product_configurator")}}),Lyte.Router.registerRoute("crm.settings.section.zsc-key",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/GenerateAPIKey.do","GET",{params:{action:"serviceKey"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.admincenter.admincenter-deletiontool",{queryParams:["feature"],getResources:function(){var e=networkUtils.returnDependencyFiles(["deletionAdminTool.js"],crmConstants.jsStaticPathForLyte);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-admintools.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-report-dependencies.js"],crmConstants.jsStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-admintools-rtl.css"],crmConstants.cssStaticPathForLyte))),e},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(e){if(e.wfresponse={},"workflow"===e.queryParams.feature){var t=networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/AdminCenter.do","GET",{params:{action:"getWFmodules"}});e.wfresponse=t}return e.feature=e.queryParams.feature,e},afterModel:function(e){this.currentModel={},Lyte.Router.getRouteInstance().parent.currentModel.deletionToolCache&&(this.currentModel=Lyte.Router.getRouteInstance().parent.currentModel.deletionToolCache),e.feature&&(this.currentModel.selected=e.feature),e.wfresponse.workflowmodules&&(this.currentModel.moduleresponse=e.wfresponse),this.currentModel.featuresNames=Lyte.Router.getRouteInstance().parent.currentModel.featuresNames,void 0!==newReportsEnabled&&!1!==newReportsEnabled||(this.currentModel.featureDisabledList=["reports"])},renderTemplate:function(){if(!Lyte.Router.getRouteInstance().parent.currentModel.showPaymentPop)return{outlet:"#result",component:"crm-admindeletiontool"};this.replaceWith("crm.settings.section.admincenter.admincenter-tools")},afterRender:function(){var e=$L(".admc_ctn"),t=e.offset().top,r=renderingUtils.windowHeight-(t+45);e.css("height",r),this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.admin.tools"),Crm.partnerName]))},actions:{onError:function(e){return e.status?(405===e.status?Lyte.Router.transitionTo({route:"crm.settings.index"}).data={hasmsg:I18n.getMsg("crm.label.insufficient.privileges")}:Lyte.Router.transitionTo({route:"crm.settings.index"}).data={hasmsg:I18n.getMsg("crm.label.widgets.error.internal")},!1):(Lyte.Router.transitionTo({route:"crm.settings.index"}).data={hasmsg:I18n.getMsg("crm.label.error.message1")},!1)}}}),Lyte.Router.registerRoute("crm.settings.section.admincenter.admincenter-history",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-admincenterhistory.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["crm-admintools.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-admintools-rtl.css"],crmConstants.cssStaticPathForLyte))),e},model:function(e){return(e={}).history=store.findAll("admincenter_history",{page:1,per_page:50,include_inner_details:"module.plural_label"},!0),e.count=store.findAll("admincenter_usage"),e},afterModel:function(e){this.currentModel={history:e.history};var t=e.count[0];this.currentModel={history:e.history,totalTools:t.tools_count,totalDeletedItems:t.total_resource_entries_count};for(var r=[{display:I18n.getMsg("admincenter.allfeatures"),apiName:"All"}],i=Lyte.Router.getRouteInstance().parent.currentModel.featuresNames,a=i.length,s=0;s<a;s++)r.push(i[s]);this.currentModel.featuresNames=r},renderTemplate:function(){if(!Lyte.Router.getRouteInstance().parent.currentModel.showPaymentPop)return{outlet:"#result",component:"crm-admincenterhistory"};this.replaceWith("crm.settings.section.admincenter.admincenter-tools")},afterRender:function(){var e=$L(".admc_ctn"),t=e.offset().top,r=renderingUtils.windowHeight-(t+45);e.css("height",r),this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.deletion.tools.history"),Crm.partnerName]))},beforeExit:function(){var e=$L("crm-admincenterhistory");if(void 0!==e&&void 0!==e[0]){var t=e[0].component;$L("#admincenterhistory-scroll")[0].removeEventListener("scroll",t.scrollAction)}},actions:{onError:function(e){if(e.responseText){var t=JSON.parse(e.responseText);return"FEATURE_NOT_SUPPORTED"===t.code?Lyte.Router.transitionTo({route:"crm.settings.index"}).data={hasmsg:I18n.getMsg("crm.setup.attribution.FEATURE_NOT_SUPPORTED")}:"NO_PERMISSION"===t.code?Lyte.Router.transitionTo({route:"crm.settings.index"}).data={hasmsg:I18n.getMsg("crm.label.insufficient.privileges")}:Lyte.Router.transitionTo({route:"crm.settings.index"}).data={hasmsg:I18n.getMsg("crm.label.widgets.error.internal")},!1}return Lyte.Router.transitionTo({route:"crm.settings.index"}).data={hasmsg:I18n.getMsg("crm.label.error.message1")},!1}}}),Lyte.Router.registerRoute("crm.settings.section.admincenter.admincenter-tools",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-admincentertools.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["crm-admintools.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-admintools-rtl.css"],crmConstants.cssStaticPathForLyte))),e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AdminCenter")],crmConstants.jsStaticPath))},renderTemplate:function(){return this.currentModel={},Lyte.Router.getRouteInstance().parent.currentModel&&Lyte.Router.getRouteInstance().parent.currentModel.deletionToolCache&&(Lyte.Router.getRouteInstance().parent.currentModel.deletionToolCache={}),this.currentModel.featuresNames=Lyte.Router.getRouteInstance().parent.currentModel.featuresNames,{outlet:"#result",component:"crm-admincentertools"}},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.admin.tools"),Crm.partnerName]))}}),Lyte.Router.registerRoute("crm.settings.section.admincenter.index-admincenter",{getResources:function(){var e=[];return e=(e=Crm.userDetails.RTL_ENABLED?e.concat(networkUtils.returnDependencyFiles(["crm-admintools-rtl.css"],crmConstants.cssStaticPathForLyte)):e.concat(networkUtils.returnDependencyFiles(["crm-admintools.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AdminCenter")],crmConstants.jsStaticPath))},renderTemplate:function(){if(Lyte.Router.getRouteInstance().parent.currentModel.showGetStarted)return{outlet:"#result",component:"crm-admincenter"};this.replaceWith("crm.settings.section.admincenter.admincenter-tools")},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.admin.tools"),Crm.partnerName]))}}),Lyte.Router.registerRoute("crm.settings.section.allowed-ips.create-allowed-ips",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-allowed-ips.js"],crmConstants.jsStaticPathForLyte);return Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-allowed-ips-rtl.css"],crmConstants.cssStaticPathForLyte))),e.concat(networkUtils.returnDependencyFiles(["crm-allowed-ips.css"],crmConstants.cssStaticPathForLyte))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){return Lyte.registeredMixins["crm-allowed-ips-mixin"].getDataForCreate()},afterModel:function(e){if(e.permissionDenied&&(e.permissionDeniedPopup=!0),e.isEdit=!1,e.ipDetails={},e.ipInfo={},e.ipDetails=store.createRecord("allowed_ips"),e.configuration.current_ip){e.ipInfo.current_ip=e.configuration.current_ip,e.ipDetails.ipData=[];var t={};t.ip=e.ipInfo.current_ip,t.name="";var r=[],i={name:""};i.ip_address=e.configuration.current_ip,i.type="static",i._add="true",r.push(i),e.ipDetails.$.set("ip_details",r),e.ipDetails.current_ip=e.ipInfo.current_ip}this.transition.data.hasOwnProperty("type")&&(e.ipDetails.type="users"),e.configuration.type?e.ipInfo.type=e.configuration.type:e.ipInfo.type=[],e.ipDetails.$.set("restrict_to",[]),Lyte.registeredMixins["crm-allowed-ips-mixin"].setSourceType(e,"create")},renderTemplate:function(){return{outlet:"#result",component:"crm-configure-ip"}},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.movetoorg"),Crm.partnerName])),commonUtils.showHideLoadingDiv(!1)}}),Lyte.Router.registerRoute("crm.settings.section.allowed-ips.edit-allowed-ips",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-allowed-ips.js"],crmConstants.jsStaticPathForLyte);return Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-allowed-ips-rtl.css"],crmConstants.cssStaticPathForLyte))),e.concat(networkUtils.returnDependencyFiles(["crm-allowed-ips.css"],crmConstants.cssStaticPathForLyte))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},queryParams:["filters","addedType"],model:function(){var e=this.getDynamicParam(),t={},r=this.getQueryParams().filters;return t.filters=r,Lyte.registeredMixins["crm-allowed-ips-mixin"].getDataForEdit(e,t)},afterModel:function(e){e.permissionDenied&&(e.permissionDeniedPopup=!0),e.isEdit=!0,e.ipDetails=e.allowed_ips[0],e.ipDetails.type=e.ipDetails.restrict_to?e.ipDetails.restrict_to[0].type:"allusers",void 0===e.ipDetails.type&&(e.ipDetails.type="users"),e.ipInfo={},e.configuration.current_ip&&(e.ipInfo.current_ip=e.configuration.current_ip),e.configuration.type?e.ipInfo.type=e.configuration.type:e.ipInfo.type=[],Lyte.registeredMixins["crm-allowed-ips-mixin"].setSourceType(e);for(var t=e.ipDetails.ip_details.length,r=0;r<t;r++)e.ipDetails.ip_details[r]._delete="false","static"===e.ipDetails.ip_details[r].type&&e.ipDetails.ip_details[r].ip_address===e.configuration.current_ip&&(e.currIpAdded="true");e.currIpAdded||(e.currIpAdded="false"),e.ipDetails.restrict_to||(e.ipDetails.restrict_to=[]);var i=e.ipDetails.restrict_to.length;for(r=0;r<i;r++)e.ipDetails.restrict_to[r]._delete="false";e.disableSave="false",e.assignIpShow="true",e.isIpLimitExceed=t>=10?"true":"false"},renderTemplate:function(){return{outlet:"#result",component:"crm-configure-ip"}},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general",[I18n.getMsg("crm.label.movetoorg"),Crm.partnerName])),document.querySelector("crm-configure-ip").component.setData("disableSave","true"),commonUtils.showHideLoadingDiv(!0)}}),Lyte.Router.registerRoute("crm.settings.section.allowed-ips.index-allowed-ips",{getResources:function(){return networkUtils.returnDependencyFiles(["crm-view-configure-ip.js"],crmConstants.jsStaticPathForLyte).concat(networkUtils.returnDependencyFiles(["crm-view-configure-ip.css"],crmConstants.cssStaticPathForLyte))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){var e={},t={},r={},i={};return e.per_page=100,e.page=1,e.filters=JSON.stringify({value:"users",comparator:"equal",api_name:"restrict_to.type"}),t.per_page=100,t.page=1,t.filters=JSON.stringify({value:"roles",comparator:"equal",api_name:"restrict_to.type"}),r.per_page=100,r.page=1,r.filters=JSON.stringify({value:"groups",comparator:"equal",api_name:"restrict_to.type"}),i.per_page=100,i.page=1,i.filters=JSON.stringify({value:"territories",comparator:"equal",api_name:"restrict_to.type"}),Lyte.resolvePromises([app.store.makeRequest("findAll","allowedip_configuration"),app.store.makeRequest("findAll","allowed_ips",e),app.store.makeRequest("findAll","allowed_ips",t),app.store.makeRequest("findAll","allowed_ips",r),app.store.makeRequest("findAll","allowed_ips",i)]).then((function(e){delete window.args;for(var t=1;t<5;t++)e[t]||(e[t]=[]);return{configuration:e[0],allowed_ips:e[1],users_allowed_ips:e[1],roles_allowed_ips:e[2],groups_allowed_ips:e[3],territories_allowed_ips:e[4]}}),(function(){return{configuration:[],allowed_ips:[],users_allowed_ips:[],roles_allowed_ips:[],groups_allowed_ips:[],territories_allowed_ips:[],permissionDenied:!0}}))},afterModel:function(e){if(e.permissionDenied&&(e.permissionDeniedPopup=!0),0===e.allowed_ips.length?e.viewIpConfig=[]:e.viewIpConfig=Lyte.registeredMixins["crm-allowed-ips-mixin"].setDisplayIpDetails(e.allowed_ips),e.viewIpInfo={},e.configuration.current_ip&&(e.viewIpInfo.current_ip=e.configuration.current_ip),e.configuration.type?e.viewIpInfo.type=e.configuration.type:e.viewIpInfo.type=[],e.hasUsers=e.users_allowed_ips.length>0,e.hasRoles=e.roles_allowed_ips.length>0,e.hasGroups=e.groups_allowed_ips.length>0,e.hasTerritories=e.territories_allowed_ips.length>0,this.transition.data.hasOwnProperty("type"))switch(this.transition.data.type){case"allusers":case"users":e.users_allowed_ips=Lyte.registeredMixins["crm-allowed-ips-mixin"].setDisplayIpDetails(e.users_allowed_ips);break;case"roles":e.roles_allowed_ips=Lyte.registeredMixins["crm-allowed-ips-mixin"].setDisplayIpDetails(e.roles_allowed_ips);break;case"groups":e.groups_allowed_ips=Lyte.registeredMixins["crm-allowed-ips-mixin"].setDisplayIpDetails(e.groups_allowed_ips);break;case"territories":e.territories_allowed_ips=Lyte.registeredMixins["crm-allowed-ips-mixin"].setDisplayIpDetails(e.territories_allowed_ips)}e.hasUsers?(e.viewIpConfig=e.users_allowed_ips,this.transition.data.hasOwnProperty("type")||(e.viewIpConfig=Lyte.registeredMixins["crm-allowed-ips-mixin"].setDisplayIpDetails(e.users_allowed_ips))):!e.hasUsers&&e.hasRoles?(e.viewIpConfig=e.users_allowed_ips.concat(e.roles_allowed_ips),this.transition.data.hasOwnProperty("type")||(e.viewIpConfig=Lyte.registeredMixins["crm-allowed-ips-mixin"].setDisplayIpDetails(e.roles_allowed_ips))):e.hasUsers||e.hasRoles||!e.hasGroups?e.hasUsers||e.hasRoles||e.hasGroups||!e.hasTerritories||(e.viewIpConfig=e.users_allowed_ips.concat(e.roles_allowed_ips).concat(e.groups_allowed_ips).concat(e.territories_allowed_ips),this.transition.data.hasOwnProperty("type")||(e.viewIpConfig=Lyte.registeredMixins["crm-allowed-ips-mixin"].setDisplayIpDetails(e.territories_allowed_ips))):(e.viewIpConfig=e.users_allowed_ips.concat(e.roles_allowed_ips).concat(e.groups_allowed_ips),this.transition.data.hasOwnProperty("type")||(e.viewIpConfig=Lyte.registeredMixins["crm-allowed-ips-mixin"].setDisplayIpDetails(e.groups_allowed_ips))),e.showUserLoading=!1,e.showTypeLoading=!1},renderTemplate:function(){return{outlet:"#result",component:"crm-view-configure-ip"}},afterRender:function(e){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.movetoorg"),Crm.partnerName]));var t=document.getElementById("ipConfiguration"),r=e.users_allowed_ips.length,i=e.roles_allowed_ips.length,a=e.groups_allowed_ips.length,s=e.territories_allowed_ips.length,o=document.querySelector("crm-view-configure-ip");null!==o&&(r>0?(o.component.data.usersRecordInfo.page=e.users_allowed_ips.$.meta.page,o.component.data.usersRecordInfo.hasMoreRecords=e.users_allowed_ips.$.meta.more_records):o.component.data.usersRecordInfo.hasMoreRecords=!1,i>0?(o.component.data.rolesRecordInfo.page=e.roles_allowed_ips.$.meta.page,o.component.data.rolesRecordInfo.hasMoreRecords=e.roles_allowed_ips.$.meta.more_records):o.component.data.rolesRecordInfo.hasMoreRecords=!1,a>0?(o.component.data.groupsRecordInfo.page=e.groups_allowed_ips.$.meta.page,o.component.data.groupsRecordInfo.hasMoreRecords=e.groups_allowed_ips.$.meta.more_records):o.component.data.groupsRecordInfo.hasMoreRecords=!1,s>0?(o.component.data.territoriesRecordInfo.page=e.territories_allowed_ips.$.meta.page,o.component.data.territoriesRecordInfo.hasMoreRecords=e.territories_allowed_ips.$.meta.more_records):o.component.data.territoriesRecordInfo.hasMoreRecords=!1),t&&(this.transition.data.hasOwnProperty("type")?t.openTab(this.transition.data.type):r>0?t.openTab("users"):i>0?t.openTab("roles"):a>0?t.openTab("groups"):s>0&&t.openTab("territories")),commonUtils.showHideLoadingDiv(!1)}}),Lyte.Router.registerRoute("crm.settings.section.approval-process.create-approval-process",{beforeModel:function(e){commonUtils.showHideLoadingDiv(!0)},model:function(e){return $.ajax({type:"POST",url:Crm.getCrmBasePath()+"/approvalProcess.do?action=newApprovalProcess&module=All",data:"",success:function(e){return $("#result").find(".select2-hidden-accessible").each((function(){$(this).hasClass("select2-hidden-accessible")&&$(this).select2("destroy")})),e}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){wfForm.chosen_show(),wfForm.initFormClick(),wfForm.inputfieldFocus(),$(".wf_form_focus").find("tr:eq(0) td:eq(1)").addClass("text"),$(".wf_form_focus").find("tr:eq(0) td:eq(1) input").focus(),$("#subTabBottomDiv").hasClass("setBgClr")&&($("#subTabBottomDiv").removeClass("setBgClr"),$("#setup_new_ContentDiv").removeClass("workflow_rule")),commonUtils.showHideLoadingDiv(),getObj("basic")&&$.scrollTo("#basic",{axis:"y",duration:1e3,offset:-50}),thirdPartyUtils.bindSelect2($(".newSelect").find("select"))},beforeExit:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess()}}),Lyte.Router.registerRoute("crm.settings.section.approval-process.index-approval-process",{model:function(e){var t={pageTitle:"crm.label.approval.processes",action:"viewApprovalProcess",isFromBack:!0},r=this.transition.data;if(r){for(var i in r)"highlight"!=i&&"step"!=i&&(t[i]=r[i]);t.toolTip=r.module}var a={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/approvalProcess.do","POST",a)},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){$("#setup_new_ContentDiv").addClass("helpOverflowHide");var r=this.transition.data,i=$("#approvaljsonarrayObj"),a=$("#processId");if(i&&0!=i.length){var s=JSON.parse(i.val());if(s.Approval_jsonarrayObj&&0!=s.Approval_jsonarrayObj.length){var o=$("#List_ApprovalProcess").html(),n=Handlebars.compile(o)(s);$("[name=approval_list]").empty(),$("#approvalListDIV").find("tr:last").after(n),$("#modOpt").val("All"),$("#addProcess").show()}else $("#addProcess").hide(),getObj("reOrderBtn").style.display="none",noData()}var l=r&&r.highlight&&null==r.step?r.highlight:null;if(l){applyMasterToolTip(),workflow.highlightSavedRule(l);var c=(a=$("#"+l)).find("a.link").text().trim();c=$ESAPI.encoder().encodeForHTMLAttribute(c),setTimeout((function(){a.removeClass("lastActiveRow")}),1e4),setTimeout((function(){crmui.showMsgBand("success",I18n.getMsg("crm.approval.save.success.message",c),"5000",$("#setupInnerLinks"))}),100)}},actions:{willTransition:function(){$("#setup_new_ContentDiv").removeClass("helpOverflowHide")}},beforeExit:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess()}}),Lyte.Router.registerRoute("crm.settings.section.approval-process.view-approval-process",{model:function(e){var t={params:{processId:this.getDynamicParam(),isFromBack:!0,action:"editApprovalProcess"}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/approvalProcess.do","POST",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}},beforeExit:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess()}}),Lyte.Router.registerRoute("crm.settings.section.assignment-rule.create-assignment-rule",{queryParams:["module","action","entryId"],getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_workflow.js"])},model:function(e){var t={resource:"assignment_rules"},r=e.queryParams.module,i=store.model.module.data.filterBy({module_name:r})[0].api_name;t.module=i+",Users";var a={};a.params=t;var s=e.dynamicParam,o=store.peekRecord("assignment_rules",s);return Lyte.resolvePromises({metaDefinition:networkUtils.lyteInitiateRequest("/crm/v2/definition","GET",a),groupDetails:Crm.userDetails.permissions.Crm_Implied_Manage_Groups?store.findAll("user_group").then((function(e){return e})):[],ruleEntryDetails:null==o?store.findRecord("assignment_rules",s,{module:i}).then((function(e){return e})):o,entries:store.findRecord("assignmentrule_entries",s,{module:i},"","",{call:"openCloneRuleEntry"})})},afterModel:function(e,t){var r=t.dynamicParam,i=t.queryParams.module,a=(t.queryParams.entryId,t.queryParams.action),s={},o=this.transition.data.ruleName,n=this.transition.data.description,l=e.entries,c=e.ruleEntryDetails;null!=c&&null!=c.name||(c=e.ruleEntryDetails[0]),void 0===o&&(o=c.name),void 0===n&&(s.description=null==c.description?"":c.description),s.ruleName=o,s.description=n,s.ruleId=r,s.module=i,s.displayModule=moduleRecordMapping[i].plural_label;var d=e.groupDetails;s.isGroupsAvailable=!0,void 0!==d&&0!=d.length||(s.isGroupsAvailable=!1);for(var u=e.metaDefinition.definition,m=u.criteriaFields,p=m.length,g=0;g<p;g++){var f=Object.keys(m[g])[0];m[g].hasOwnProperty("Users")?s.userFieldsArray=m[g].Users:void 0===s.recordFieldsArray?s.recordFieldsArray=m[g][f]:s.recordFieldsArray=s.recordFieldsArray.concat(m[g][f])}if("editRuleEntry"===a?(s.source="edit",s.ruleEntryDetails=l[0],s.ruleEntryTextMsg=I18n.getMsg("crm.lar.ruleEntry.edit")):"cloneRuleEntry"===a?(s.source="clone",s.ruleEntryDetails=l[0],s.ruleEntryTextMsg=I18n.getMsg("crm.lar.ruleEntry.clone")):"createRuleEntry"===a&&(s.ruleEntryTextMsg=I18n.getMsg("crm.lar.ruleEntry.create"),l&&l.length>0?s.showHeader=!1:s.showHeader=!0),"createRuleEntry"!==a&&this.manipulateRuleEntryDetails(s),void 0!==s.ruleEntryDetails){void 0!==s.ruleEntryDetails.criteria&&null!==s.ruleEntryDetails.criteria&&s.ruleEntryDetails.criteria.criteriaJSON?s.recordType="recordCriteria":s.recordType="All";var h=s.ruleEntryDetails.assign_to.type;s.ownerType=h,"criteria"===h&&(s.userCriteriaValue=s.ruleEntryDetails.assign_to.criteria)}s.isActionEdited=!1,"createRuleEntry"!==a&&(s.showUserAvailability=!0);var y={fields:[]};(_={})[i]=s.recordFieldsArray,y.fields[0]=_,y.maxCrtCnt=25,y.userTimeFormat=Crm.userDetails.TIME_FORMAT,y.suffix="_c0";var v=Handlebars.templates.criteriaEditor(y);s.criteriaHtml=v;var _;y={fields:[]};(_={})[i]=s.userFieldsArray,y.fields[0]=_,y.maxCrtCnt=25,y.userTimeFormat=Crm.userDetails.TIME_FORMAT,y.suffix="_c1";v=Handlebars.templates.criteriaEditor(y);s.userCriteriaHtml=v,app.arModSpecificDetails||(app.arModSpecificDetails={}),app.arModSpecificDetails[i]?app.arModSpecificDetails[i].isZiaAvailable=u.extraDetails.isZiaAvailable:app.arModSpecificDetails[i]={isZiaAvailable:u.extraDetails.isZiaAvailable},app.assignmentRule||(app.assignmentRule={}),app.assignmentRule.isZiaEnabled=u.extraDetails.isZiaEnabled,app.assignmentRule.isTaskAvailable=u.extraDetails.isTaskAvailable,this.currentModel=s},renderTemplate:function(){return{outlet:"#result",component:"crm-create-assignmentruleentry"}},afterRender:function(){var e=$L("crm-create-assignmentruleentry").e[0].component;if("create"===e.getData("source")&&(e.data.onlineStatus=!0),"shifttiming"===e.data.ruleEntryDetails.availability&&$("#shiftTiming")[0].ltProp("checked",!0),"edit"===e.getData("source")||"clone"===e.getData("source")){var t=e.getData("ruleEntryDetails").criteria;if(t&&t.criteriaJSON&&(Search.setCriteriaValues(t.criteriaJSON,"_c0",!1),Search.afterRenderCriteria()),"criteria"===e.getData("ownerType")){var r=e.getData("ruleEntryDetails").assign_to.criteria;r&&(Search.setCriteriaValues(r.criteriaJSON,"_c1",!1),Search.afterRenderCriteria())}}Search.afterRenderCriteria(),wfmergefield.initMergeFieldDetl("Assignment Rules")},manipulateRuleEntryDetails:function(e){var t=e.ruleEntryDetails;e.entryId=t.id,null!==t.criteria&&t.criteria.criteriaJSON?(e.recordType="recordCriteria",e.criteriaValue=t.criteria):e.recordType="All",this.manipulateAssignToDetails(e);var r=t.availability;null!=r&&(r.indexOf("onlinestatus")>-1&&(e.onlineStatus=!0,e.checkAvailability="yes"),r.indexOf("shifttiming")>-1&&(e.shiftTiming=!0,e.checkAvailability="yes"));var i=t.followup_task;null!=i&&void 0!==i?(e.selectedTaskId=i.id,e.selectedTaskName=i.name):(e.selectedTaskId="",e.selectedTaskName="")},manipulateAssignToDetails:function(e){var t=e.ruleEntryDetails,r=t.assign_to.type;e.ownerType=r;switch(r){case"criteria":e.userCriteriaValue=t.assign_to.criteria;break;case"category":var i=t.assign_to.category;e.ownerType="category";var a="",s=[];i.forEach((function(t){a=t.type,e.categoryType=a;var r={};switch(a){case"user":r.id=t.id,r.full_name=t.name,s.push(r);break;case"role":e.selectedRoleId=t.id,e.selectedRoleName=t.name,e.roleRoundRobinText=!0;break;case"group":e.selectedGroupId=t.id,e.selectedGroupName=t.name,e.groupRoundRobinText=!0}})),"user"===a&&(e.selectedUsers=s,e.userRoundRobinText=!1,s.length>1&&(e.userRoundRobinText=!0));break;case"zia":t.assign_to.assignedToType=I18n.getMsg("crm.intelligence.name"),t.assign_to.assignedToText=I18n.getMsg("crm.assignmentRule.zia.text.msg")}},beforeExit:function(){wfmergefield.clearMergeFieldDetl()},actions:{onError:function(){return this.showHideAlertMessage("warning",!0,I18n.getMsg("crm.unable.to.process.request"),""),$(".dummy_Body").hide(),!1}}},{mixins:["crm-assignment-rules-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.assignment-rule.index-assignment-rule",{queryParams:["module"],model:function(e){var t=e.queryParams.module;e={};void 0!==t&&(t=store.model.module.data.filterBy({module_name:t})[0].api_name,e.module=t);var r={resource:"assignment_rules"},i={};i.params=r;return Lyte.resolvePromises({metaDefinition:networkUtils.lyteInitiateRequest("/crm/v2/definition","GET",i),ruleDetails:store.findAll("assignment_rules",e).then((function(e){return e}))})},afterModel:function(e,t){var r={},i=t.queryParams.module;t={};r.allowedModules=e.metaDefinition.definition.extraDetails.modulesList;var a=e.metaDefinition.definition.extraDetails.assignmentRulesMaxLimit;void 0===i?(r.module=I18n.getMsg("crm.label.AllModules"),r.selectedModuleName=I18n.getMsg("crm.label.AllModules")):(r.module=moduleRecordMapping[i].module_name,r.selectedModuleName=store.model.module.data.filterBy({module_name:i})[0].plural_label),r.assignmentRulesList=e.ruleDetails,r.assignmentRulesLength=r&&r.assignmentRulesList?r.assignmentRulesList.length:0,r.rulesMaxLimit=a,a*r.allowedModules.length<=r.assignmentRulesLength&&(r.showCreateButton=!1),0==r.assignmentRulesLength&&void 0===i&&(r.isRulesConfigured=!1);var s="",o="",n=this.transition.extraDetails;n&&(n.id&&(s=n.id),n.message&&(o=n.message)),""!=s&&(r.highlightId=s),""!=o&&(r.bandMessage=o),this.currentModel=r},renderTemplate:function(){return{outlet:"#result",component:"crm-assignmentrules-listview"}},afterRender:function(){$("#setup_new_ContentDiv").addClass("helpOverflowHide")},actions:{willTransition:function(){$("#setup_new_ContentDiv").removeClass("helpOverflowHide")},onError:function(e){if(null!=e.response){var t={isPermissionDenied:!0},r=$L("crm-assignmentrules-listview");switch(r.length&&r[0].remove(),Lyte.Component.render("crm-assignmentrules-listview",t,"#result"),JSON.parse(e.response).code){case"FEATURE_NOT_SUPPORTED":this.showHideAlertMessage("warning",!0,I18n.getMsg("crm.zes.mobile.error.feature"),"");break;case"INVALID_MODULE":this.showHideAlertMessage("error",!0,I18n.getMsg("crm.label.module.invalid"),I18n.getMsg("crm.label.invalid.module"));break;case"INTERNAL_ERROR":this.showHideAlertMessage("error",!0,I18n.getMsg("crm.assignment.rule.internal.error"),"");break;default:this.showHideAlertMessage("warning",!0,I18n.getMsg("crm.label.insufficient.privileges"),I18n.getMsg("crm.label.creator.noPermission"))}}else this.showHideAlertMessage("warning",!0,I18n.getMsg("crm.unable.to.process.request"),"");return $(".dummy_Body").hide(),!1}}},{mixins:["crm-assignment-rules-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.assignment-rule.view-assignment-rule",{queryParams:["module","action","entryId","ruleName"],getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_workflow.js"])},model:function(e){var t=this.getDynamicParam(),r=e.queryParams.module;return this.fetchViewAssignmentRuleModelData(t,r)},afterModel:function(e,t){var r=t.queryParams.module;this.currentModel=this.fetchViewAssignmentRuleAtferModelData(e,r,this.transition.extraDetails)},renderTemplate:function(){return{outlet:"#result",component:"crm-assignmentrule-entry-listview"}},redirect:function(e){if(e.entriesList&&0===e.entriesList.length){var t=this.transition.data.fromSource;if(void 0!==t&&"ruleEntry"===t)this.transitionTo({route:"crm.settings.section.assignment-rule.index-assignment-rule"});else{var r=this.transition.info;r.queryParams.action="createRuleEntry";var i=Object.assign({},r);i.route="crm.settings.section.assignment-rule.create-assignment-rule",this.replaceWith(i)}}},actions:{onError:function(e){if(null!=e.response){var t={isPermissionDenied:!0},r=$L("crm-assignmentrules-listview");switch(r.length&&r[0].remove(),Lyte.Component.render("crm-assignmentrules-listview",t,"#result"),JSON.parse(e.response).code){case"ID_ALREADY_DELETED":this.showHideAlertMessage("warning",!0,I18n.getMsg("crm.record.not.accessible.message.heading",I18n.getMsg("crm.label.assignment.rule")),"");break;case"FEATURE_NOT_SUPPORTED":this.showHideAlertMessage("warning",!0,I18n.getMsg("crm.zes.mobile.error.feature"),"");break;case"INVALID_MODULE":this.showHideAlertMessage("error",!0,I18n.getMsg("crm.label.module.invalid"),"Invalid Module");break;case"INTERNAL_ERROR":this.showHideAlertMessage("error",!0,I18n.getMsg("crm.assignment.rule.internal.error"),"");break;default:this.showHideAlertMessage("warning",!0,I18n.getMsg("crm.label.insufficient.privileges"),"Permission Denied")}}else this.showHideAlertMessage("warning",!0,I18n.getMsg("crm.unable.to.process.request"),"");return $(".dummy_Body").hide(),!1}}},{mixins:["crm-assignment-rules-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.assignment-thresholds.create-assignment-thresholds",{queryParams:["module"],model:function(e){var t=e.queryParams.module;return Lyte.resolvePromises({metaDefinition:this.makeMetaDefinitionRequest(t)})},renderTemplate:function(){return $("#result_layer2").show(),{outlet:"#result_layer2",component:"crm-threshold-detail-view"}},beforeExit:function(){store.unloadAll("assignment_threshold"),store.unloadAll("assignment_threshold_userdetails")},actions:{onError:function(e,t,r){var i=null,a=r?r.queryParams.module:null;if(a){var s=this.getModuleRecord(null,a);i=s?s.plural_label:null}return this.errorResponseAlert(e,i),$(".dummy_Body").hide(),!1},willTransition:function(e){var t=$L("crm-threshold-detail-view");!!(t&&t.length>0)&&!t[0].getData("initialLoad")&&this.outFocusAlert(e)}},getModuleAccessUsersInRouter:function(e){var t=e.queryParams.module;return this.getModuleAccessUsers(t)},isMatchedInArray:function(e,t){return t.some((function(t){return e===t}))},getUsers:function(){for(var e=[],t=store.peekAll("user"),r=t.length,i=0;i<r;i++){var a={name:t[i].full_name,id:t[i].id,zuid:t[i].zuid,type:"users"};e.push(a)}return e}},{mixins:["crm-assignment-threshold-utils"]}),Lyte.Router.registerRoute("crm.settings.section.assignment-thresholds.edit-assignment-thresholds",{queryParams:["module"],model:function(e){var t=e.queryParams.module;return Lyte.resolvePromises({metaDefinition:this.makeMetaDefinitionRequest(t),restrictionView:this.getRestrictions(e)})},afterModel:function(e,t){let r=e.metaDefinition.definition.extraDetails.threshold_limits.users_per_request,i=e.restrictionView.restrict_to.slice(),a=e.restrictionView.total_count;var s=t.dynamicParam,o=t.queryParams.module,n=this.getModuleRecord(null,o);let l=a/r;if(l=Math.ceil(l)-1,l<=0)return i=i.sortDescOrder("default_assignee"),void(e.users=i);var c={module:n.api_name,per_page:r};const d=[];for(let e=0;e<l;e++){c.page=e+2;let t=store.findAll("assignment_threshold_userdetails",c,!0,!1,{getAllUsers:!0,restrictionId:s});d.push(t)}return Promise.all(d).then((function(t){let r=t.length;for(let e=0;e<r;e++)i=t[e]?i.concat(t[e]):i;i=i.sortDescOrder("default_assignee"),e.users=i}))},renderTemplate:function(){return $("#result_layer2").show(),{outlet:"#result_layer2",component:"crm-threshold-detail-view"}},afterRender:function(){var e=document.getElementById("arCriteriaEditor"),t=document.getElementById("arRestrictDetailView");this.setThresholdCriteriaBind(e,t)},beforeExit:function(){store.unloadAll("assignment_threshold"),store.unloadAll("assignment_threshold_userdetails")},actions:{onError:function(e,t,r){var i=null,a=r?r.queryParams.module:null;if(a){var s=this.getModuleRecord(null,a);i=s?s.plural_label:null}return this.errorResponseAlert(e,i),$(".dummy_Body").hide(),!1},willTransition:function(e){var t=$L("crm-threshold-detail-view");!!(t&&t.length>0)&&!t[0].getData("disableSaveButton")&&this.outFocusAlert(e)}},getModuleFields:function(e){var t=e.queryParams.module,r=this.getModuleRecord(null,t);return store.findAll("field",{module:r.api_name})},getModuleAccessUsersInRouter:function(e){var t=e.queryParams.module;return this.getModuleAccessUsers(null,t)},isMatchedInArray:function(e,t){return t.some((function(t){return e===t}))},getRestrictions:function(e){var t=e.dynamicParam,r=e.queryParams.module,i=this.getModuleRecord(null,r),a=r?{module:i?i.api_name:r}:{};return store.findRecord("assignment_threshold",t,a).then((function(e){return e}))}},{mixins:["crm-assignment-threshold-utils"]}),Lyte.Router.registerRoute("crm.settings.section.assignment-thresholds.index-assignment-thresholds",{queryParams:["module","status"],model:function(e){var t=e.queryParams.module;return Lyte.resolvePromises({metaDefinition:this.makeMetaDefinitionRequest(t),restrictionlistView:this.getRestrictions(e)})},afterModel:function(){this.currentModel.restrictionlistView||(this.currentModel.restrictionlistView=[]);let e=this.transition&&this.transition.transData?this.transition.transData.thresholdId:null;e&&(this.currentModel.highlightId=e)},renderTemplate:function(){return $("#result_layer2").hide(),{outlet:"#result",component:"crm-threshold-list"}},afterRender:function(){if($("#setup_new_ContentDiv").addClass("oHImp"),this.component.component&&this.component.component.methods.resetData(this.component.component),this.currentModel.highlightId){let e=$("#entry_"+this.currentModel.highlightId).position().top-46;$L("#atListTable")[0].scrollTable(0,e)}var e=this.transition&&this.transition.transData?this.transition.transData.alert:null;if(e&&e.message&&e.type){var t=document.getElementById("arMsgBox");t||(t=Lyte.Component.render("lyte-messagebox",{"lt-prop-type":e.type,"lt-prop-message":e.message,id:"arMsgBox",ltPropDuration:"3000"},"#result")),t.setData({"lt-prop-type":e.type,"lt-prop-message":e.message}),t.ltProp("show",!0)}},beforeExit:function(){$("#setup_new_ContentDiv").removeClass("oHImp")},actions:{onError:function(e,t,r){var i=null,a=r?r.queryParams.module:null;if(a){var s=this.getModuleRecord(null,a);i=s?s.plural_label:null}return this.errorResponseAlert(e,i),$(".dummy_Body").hide(),!1}},getModules:function(){return this.getRestrictionModuleObjs()[0]},getRestrictions:function(e){var t=e.queryParams.module,r=e.queryParams.status,i=this.getModuleRecord(null,t),a=t?{module:i?i.api_name:t}:{};return r&&"All"!=r&&(a.status=r.toLowerCase()),store.findAll("assignment_threshold",a,!1,!0,{doUnload:!0}).then((function(e){if(e){var t=[];if(e&&e.length>0)for(var r=e.length,i=0;i<r;i++){var a=store.peekRecord("assignment_threshold",e[i].id);a&&t.push(a)}return t}}))}},{mixins:["crm-assignment-threshold-utils"]}),Lyte.Router.registerRoute("crm.settings.section.auto-response-rules.index-auto-response-rules",{queryParams:["module","ruleId","ruleName","action"],beforeModel:function(){if(null==this.getQueryParams().module){var e=[];store.peekAll("module").forEach((function(t){t.webform_supported&&t.presence_sub_menu&&Crm.userDetails.permissions["Crm_Implied_Web_To_"+t.module_name]&&e.push(t.$.toJSON())})),0===e.length?(renderingUtils.displayPermissionDenied(),this.transition&&this.transition.abort()):(e.sort((function(e,t){return e.sequence_number-t.sequence_number})),this.setQueryParams("module",e[0].module_name))}},model:function(){var e={seModule:this.getQueryParams().module,pageTitle:"crm.common.menu.automation.autoresponse",action:"viewAutoRespRules"};"viewAutoRespRuleEntries"==this.getQueryParams().action&&(e.action=this.getQueryParams().action,e.ruleId=this.getQueryParams().ruleId,e.ruleName=this.getQueryParams().ruleName);var t={params:e};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/autoresprules.do","POST",t)},renderTemplate:function(e){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.autoresponders.create-autoresponder",{queryParams:["module"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-list-kanban-container.js","crm-customview-dropdown.js","lyte-counter.js","crm-customview-helpers.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-list-kanban-container.css","crm-customview-dropdown.css"],crmConstants.cssStaticPathForLyte);return e.concat(t)},model:function(e){this.getDynamicParam();var t=e.queryParams.module||"Leads",r={module:t,toolTip:t,step:"create",newModel:!0};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/AutoResponder.do","POST",{params:r})},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.autoresponders.create-folder",{queryParams:["module"],model:function(e){var t=e.queryParams.module||"Leads",r={module:t,toolTip:t,step:"newFolder",newModel:!0};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/AutoResponder.do","POST",{params:r})},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.autoresponders.edit-autoresponder",{queryParams:["module"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-list-kanban-container.js","crm-customview-dropdown.js","lyte-counter.js","crm-customview-helpers.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-list-kanban-container.css","crm-customview-dropdown.css"],crmConstants.cssStaticPathForLyte);return e.concat(t)},model:function(e){var t=this.getDynamicParam(),r=e.queryParams.module||"Leads",i={responderId:t,module:r,toolTip:r,step:"edit",newModel:!0};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/AutoResponder.do","POST",{params:i})},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.autoresponders.edit-folder",{queryParams:["module"],model:function(e){var t=this.getDynamicParam(),r=e.queryParams.module||"Leads",i={module:r,toolTip:r,step:"editFolder",newModel:!0,folderId:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/AutoResponder.do","POST",{params:i})},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.autoresponders.index-autoresponder",{queryParams:["module","step","folderId"],model:function(e){var t=e.queryParams.module||"Leads",r=(e.queryParams.step&&e.queryParams.step,e.queryParams.folderId,{module:t,toolTip:t,step:"show",newModel:!0});return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/AutoResponder.do","POST",{params:r})},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.autoresponders.view-autoresponder",{queryParams:["module"],model:function(e){var t=this.getDynamicParam(),r=e.queryParams.module||"Leads",i={responderId:t,module:r};return this.transition.info.queryParams.step&&"viewResponder"==this.transition.info.queryParams.step?i.step="viewResponderLyte":(i.step="view",i.toolTip=r,i.newModel=!0),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/AutoResponder.do","POST",{params:i})},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.blueprint.create-blueprint",{queryParams:["module","fieldId","layoutId","isContinuous"],getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_workflow.js"]);return e=e.concat(fetchWFParamterComponentFiles())},beforeModel:function(e){$(".setup-space").hide()},model:function(e){var t=this.getQueryParams().module,r=this.getQueryParams().fieldId,i=this.getQueryParams().layoutId;null!=t&&null!=r&&null!=i&&null!=this.transition.data||this.transitionTo("crm.settings.section.blueprint.index-blueprint");var a={params:{action:"getPickListDetails",module:t,fieldId:r,layoutId:i}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ProcessFlow.do","GET",a)},afterModel:function(e,t){commonUtils.showHideLoadingDiv(),removeFreezeLayer();var r=this.transition.data.processData;r.PicklistValues=e,this.currentModel=r,thirdPartyUtils.unbindChildSelect2($("#pb_creteria_conditions")),$("#pb_creteria_conditions").addClass("pp-content p25");var i=$("#pb_creteria_conditions").clone(!0);i=ProcessBuilder.copySelectValues(i,$("#pb_creteria_conditions")),r.CriteriaContentFromCreatePop=i,ProcessBuilder.unSavedChanges=!0,r=ProcessFlow.initProcessBuilder_beforeRender(e),e.store_processData=r},renderTemplate:function(e,t){return{outlet:"#result",html:Handlebars.templates.ProcessBuilder({Process:ProcessBuilder.Process})}},afterRender:function(e,t){ProcessBuilder.TransitionIdVsDetails={},ProcessFlow.initProcessBuilder_afterRender(e.store_processData),$("#pb_dragAndDropBox").css("display","block"),ProcessBuilder.hideShowAddState(),ProcessBuilder.hideShowStagelist()},beforeExit:function(){wfmergefield.clearMergeFieldDetl(),"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess()}}),Lyte.Router.registerRoute("crm.settings.section.blueprint.index-blueprint",{queryParams:["module"],model:function(e){var t={pageTitle:"crm.label.process.automation",allowMultiClick:"true",action:"showAllProcesses",isFromBack:!0},r=e.queryParams.module;r&&(t.module=r);var i={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ProcessFlow.do","GET",i)},afterModel:function(e){var t=e;ProcessBuilder.ProcessPageCnt=0,ProcessFlow.isAllProcessLoaded=t.IsAllProcessLoaded,t.HELP_LINK=crmConstants.helpUrl["help.domain.url"]+crmConstants.helpUrl["help.process.automation.manage"]},renderTemplate:function(e){return{outlet:"#result",html:Handlebars.templates.ProcessListViewHeader(e)}},afterRender:function(e,t){$("#setup_new_ContentDiv").addClass("helpOverflowHide");var r=e;ProcessBuilder.listViewModule=e.selectedModule,$(".setupleftmenutd").show(),$("#setupInnerLinks").show(),$(".new_setupview").removeClass("newSetupRightShow"),ProcessFlow.processCurrentViewResponse=r,r.SUPPORTED_MODULES&&(ProcessFlow.SUPPORTED_MODULES=r.SUPPORTED_MODULES);var i=Handlebars.templates.ProcessListViewData({processes:r.Processes,isReOrder:r.ALLOWREORDER});""!=i.trim()&&($("#processDataContainer").html(i),ProcessBuilder.bindMoreActions()),ProcessBuilder.RegexValidators=r.RegexValidators;var a=$("#reOrderBtn"),s=$("#noProcessMessageDiv"),o=$("#processDataContainer");a.hide(),s.addClass("hide"),$("#saveReOrderBtn, #cancelReOrderBtn").hide();var n=o.find(".processDataRow").length;0===n?s.removeClass("hide"):n>1&&a.show(),"All"==r.selectedModule?(a.addClass("disabledBtn"),void 0!==a[0]&&(a[0].setAttribute("onmouseover","crmui.toolTip_show(this,'left','"+I18n.getMsg("crm.automation.process.reorder.disabled.msg")+"')"),a[0].setAttribute("onmouseout","crmui.toolTip_hide()"))):(a.removeClass("disabledBtn"),a.removeAttr("onmouseover onmouseout")),$("#setup_new_ContentDiv").off("scroll").on("scroll",(function(){ProcessBuilder.ProcessScrollReqSent||ProcessFlow.isAllProcessLoaded||(ProcessBuilder.ProcessScrollReqSent=!0,ProcessFlow.loadProcesses(void 0,void 0,2))})),$("#bluePrintSearchTxt").off("keyup paste").on("keyup paste",(function(){if(!ProcessBuilder.ProcessSearchReqSent){ProcessBuilder.ProcessSearchReqSent=!0;var e=this;setTimeout((function(){var t=$.trim($(e).val());ProcessFlow.loadProcesses(void 0,void 0,1,t),ProcessBuilder.ProcessSearchReqSent=!1}),1e3)}})),ProcessFlow.PROCESS_LIMIT=r.totalProcessLimit,ProcessFlow.PROCESS_COUNT=r.totalCnt,Crm.trackSpotLightAction("Process Automation - Process Automation Click",{Place:"Setup"}),ProcessFlow.hideCreateProcessOnModuleLengthExceed(r),AutomationActionsHelper.loadCustomFunctionFiles()},actions:{didTransition:function(){this.updateInProgress&&(renderingUtils.showCustomAlert(I18n.getMsg("crm.blueprint.migration.inprogress.republish.alert")),this.updateInProgress=!1),ProcessBuilder.doRefresh&&Utils.windowLocationReload()},willTransition:function(){$("#setup_new_ContentDiv").removeClass("helpOverflowHide")}},beforeExit:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess()}}),Lyte.Router.registerRoute("crm.settings.section.blueprint.view-blueprint",{queryParams:["module","step"],getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_workflow.js"]);return e=e.concat(fetchWFParamterComponentFiles())},model:function(e){var t=this.getQueryParams().module,r=this.getQueryParams().step,i={params:{action:"getProcessDetails",module:t,processId:this.getDynamicParam(),step:r,toolTip:t,isFromBack:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ProcessFlow.do","GET",i)},afterModel:function(e){"Failure"==e.Status&&e.Error&&"UpdateInProgress"===e.Error&&(this.transition.abort(),Lyte.Router.getRouteInstance("crm.settings.section.blueprint.index-blueprint").updateInProgress=!0,history.back())},renderTemplate:function(e,t){if("string"!=typeof e){var r=document.getElementsByTagName("crm-clone-blueprint");if(null!=r&&r.length>0&&r[0].remove(),ProcessBuilder.isReportPreview=!1,"Failure"!=e.Status||!e.Error||"Deleted"!==e.Error){processData=ProcessFlow.initProcessBuilder_beforeRender(e),"clone"==t.queryParams.step?(processData.isCloneProcess=!0,ProcessBuilder.processClone=!0):(processData.isCloneProcess=!1,ProcessBuilder.processClone=!1),e.store_processData=processData;var i=Handlebars.templates.ProcessBuilder({Process:ProcessBuilder.Process});return ProcessBuilder.TransitionIdVsDetails={},{outlet:"#result",html:i}}$("#show").html(Handlebars.templates.ProcessDeleted(e))}else $("body").html(e)},afterRender:function(e,t){"string"!=typeof e&&"Failure"!=e.Status&&(AutomationActionsHelper.loadCustomFunctionFiles(),ProcessFlow.initProcessBuilder_afterRender(e.store_processData))},beforeExit:function(){wfmergefield.clearMergeFieldDetl(),"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess()}}),Lyte.Router.registerRoute("crm.settings.section.booking.clone-booking",{queryParams:["type","module"],model:function(e){var t=e.queryParams,r=networkUtils.lyteInitiateRequest("/crm/v2/settings/calendar_schedule/"+this.getDynamicParam(),"GET"),i={module:t.module},a=networkUtils.lyteInitiateRequest("/crm/v2/settings/layouts","GET",{params:i}),s=networkUtils.lyteInitiateRequest("/crm/v2/settings/meeting","GET"),o=store.findAll("user_group"),n=store.findAll("territory");return Lyte.resolvePromises({calendar_Res:r,fieldObj:a.then((function(e){return{fields:calendarSchedule.getFieldsFromLayoutObj(e)}})),meetingDetails:s,groups:o,territories:n.catch((function(){}))})},afterModel:function(e,t){e.groups={user_groups:e.groups},e.territories={territories:e.territories},t.queryParams.type="team";var r=calendarSchedule.getCalendarScheduleObj(e,t);r.calendar_name=I18n.getMsg("crm.cal.duplicate.calendarname",r.calendar_name).substring(0,50),r.id="null",e.calObj=r,t.queryParams.type=r.schedule_type},renderTemplate:function(e,t){var r=t.queryParams.module;return!0!==$("#"+r+"_config").is(":empty")?(Handlebars.registerPartial("CalScheduleCreateByType",Handlebars.templates.CalScheduleCreateByType),Handlebars.registerPartial("CalScheduleQuestion",Handlebars.templates.CalScheduleQuestion),Handlebars.registerPartial("CalScheduleAssignInfo",Handlebars.templates.CalScheduleAssignInfo),Handlebars.registerPartial("CalScheduleUserInfo",Handlebars.templates.CalScheduleUserInfo),{outlet:"#result",html:Handlebars.templates.CreateCalendarSchedule(e.calObj)}):{outlet:"#"+r+"_config",html:Handlebars.templates.CalScheduleCreateByType(e.calObj)}},afterRender:function(e,t){var r=$("#"+t.queryParams.module+"_config");if(r.is(":empty")&&r.show(),thirdPartyUtils.bindSelect2("select"),e.calObj.userDisplayArr){var i=document.getElementById("addedUsers"+t.queryParams.module).querySelector("crux-user-dropdown");i.cxProp("selectedUsers",e.calObj.userDisplayArr),i.cxProp("selected",e.calObj.userIdArr)}t&&t.queryParams&&"team"===t.queryParams.type&&$("#selectedusers"+t.queryParams.module)[0].setMethods("onUserAdd",(function(){calendarSchedule.changeMeetingTool("team","assign")})),$("#calname").select()}}),Lyte.Router.registerRoute("crm.settings.section.booking.create-booking",{queryParams:["type","module"],model:function(e){var t=e.queryParams,r={type:t.type,module:t.module},i=networkUtils.lyteInitiateRequest("/crm/v2/settings/layouts","GET",{params:r}),a=networkUtils.lyteInitiateRequest("/crm/v2/settings/meeting","GET"),s=store.findAll("user_group"),o=store.findAll("territory");return Lyte.resolvePromises({fields:i.then((function(e){return{fields:calendarSchedule.getFieldsFromLayoutObj(e)}})),meetingDetails:a,groups:s,territories:o.catch((function(){}))})},afterModel:function(e,t){e.groups={user_groups:e.groups},e.territories={territories:e.territories};var r=t.queryParams.type,i=t.queryParams.module,a={},s=[],o=[],n={id:moduleRecordMapping.Events.id,name:"Events",pluralLabel:moduleRecordMapping.Events.plural_label},l={id:moduleRecordMapping.Calls.id,name:"Calls",pluralLabel:moduleRecordMapping.Calls.plural_label};if("user"===r?(void 0!==Crm.userDetails.permissions.Crm_Implied_Create_Events&&o.push(n),void 0!==Crm.userDetails.permissions.Crm_Implied_Create_Calls&&o.push(l)):"team"===r&&(o.push(n),o.push(l)),a=calendarSchedule.getCreateCalObj(r,i),"Events"===i){var c=Crm.userDetails.LICENSE_TYPE,d=e.meetingDetails;Object.keys(d).length>0&&(calendarSchedule.meetingConfZuid=d);var u=Object.keys(d).length>0?JSON.parse(Events.constructMeetingToolSelectBox(d)):void 0;u&&-1!==["R","E","S","X","Y","P","A","C","Z","U","D"].indexOf(c)&&(a.meeting_preferences=u)}if(a.moduleObj=o,a.durObj=calendarSchedule.durationArr,a.incrdurObj=calendarSchedule.incrdurationArr,a.maxevperslotObj=calendarSchedule.maxevperslotArr,a.maxevperdayObj=calendarSchedule.maxevperdayArr,a.buffertimeObj=calendarSchedule.bufferArr,a.id="null",calendarSchedule.callUser=!1,"team"===r){calendarSchedule.assignArr=[];n={users:[]};calendarSchedule.assignArr.push(n);var m=e.groups,p=e.territories;if(void 0!==m){for(var g=(v=m.user_groups)?v.length:0,f=(n={},[]),h=0;h<g;h++){var y={};y.id=v[h].id,y.name=v[h].name,f.push(y)}if(f.length>0)(n={}).groups=f,calendarSchedule.assignArr.push(n)}if(void 0!==p){g=(v=p.territories)?v.length:0;var v,_=[];for(h=0;h<g;h++){var b={};b.id=v[h].id,b.name=v[h].name,_.push(b)}if(_.length>0){var w={};w.territories=_,calendarSchedule.assignArr.push(w)}}a.assignArr=calendarSchedule.assignArr}var C=["Event_Title","Participants","What_Id","Subject","Venue","Description"],D=["What_Id","Subject"],L=[],R=e.fields.fields,P=R.length;for(h=0;h<P;h++){(!1===(S=R[h]).custom_field&&C.contains(S.api_name)||!0===S.custom_field&&133!==S.ui_type&&111!==S.ui_type&&116!==S.ui_type)&&("Events"===i&&"What_Id"!==S.api_name||"Calls"===i&&(D.contains(S.api_name)||2===S.section_id))&&L.push(S)}"Events"===i?(calendarSchedule.eventfields=L,calendarSchedule.tempeventfields=calendarSchedule.eventfields.slice(),a.fields=calendarSchedule.eventfields):"Calls"===i&&(calendarSchedule.callfields=L,calendarSchedule.tempcallfields=calendarSchedule.callfields.slice(),a.fields=calendarSchedule.callfields);g=L.length;var I=["Event_Title","Participants","What_Id","Subject"];for(h=0;h<g;h++){var S=L[h];if(I.contains(S.api_name)){n={};"Event_Title"===S.api_name||"Subject"===S.api_name?n.name=I18n.getMsg("crm.calendarbooking.field.name"):"What_Id"!==S.api_name&&"Participants"!==S.api_name||("Events"===i&&"Participants"===S.api_name?n.name=I18n.getMsg("crm.calendarbooking.field.email"):"Calls"===i&&(n.name=I18n.getMsg("crm.calendarbooking.field.phone")));var M={};M.id=S.id,M.field_label=S.field_label,M.api_name=S.api_name,M.required=!0,n.field_detail=M,s.push(n)}}a.question_details=s,this.calendar_schedule=a},renderTemplate:function(e,t){var r=t.queryParams.module;return!0!==$("#"+r+"_config").is(":empty")?(Handlebars.registerPartial("CalScheduleCreateByType",Handlebars.templates.CalScheduleCreateByType),Handlebars.registerPartial("CalScheduleAssignInfo",Handlebars.templates.CalScheduleAssignInfo),Handlebars.registerPartial("CalScheduleUserInfo",Handlebars.templates.CalScheduleUserInfo),Handlebars.registerPartial("CalScheduleQuestion",Handlebars.templates.CalScheduleQuestion),{outlet:"#result",html:Handlebars.templates.CreateCalendarSchedule(this.calendar_schedule)}):{outlet:"#"+r+"_config",html:Handlebars.templates.CalScheduleCreateByType(this.calendar_schedule)}},afterRender:function(e,t){var r=$("#"+t.queryParams.module+"_config");r.is(":empty")&&r.show(),thirdPartyUtils.bindSelect2("select"),t&&t.queryParams&&"team"===t.queryParams.type&&"Events"===t.queryParams.module&&$("#selectedusersEvents")[0].setMethods("onUserAdd",(function(){calendarSchedule.changeMeetingTool("team","assign")}))},didConnect:function(){thirdPartyUtils.bindSelect2("select")}}),Lyte.Router.registerRoute("crm.settings.section.booking.edit-booking",{queryParams:["type","module"],model:function(e){var t=e.queryParams,r=networkUtils.lyteInitiateRequest("/crm/v2/settings/calendar_schedule/"+this.getDynamicParam(),"GET"),i={module:t.module},a=networkUtils.lyteInitiateRequest("/crm/v2/settings/layouts","GET",{params:i}),s=networkUtils.lyteInitiateRequest("/crm/v2/settings/meeting","GET"),o=store.findAll("user_group"),n=store.findAll("territory");return Lyte.resolvePromises({calendar_Res:r,fieldObj:a.then((function(e){return{fields:calendarSchedule.getFieldsFromLayoutObj(e)}})),meetingDetails:s,groups:o,territories:n.catch((function(){}))})},afterModel:function(e,t){e.groups={user_groups:e.groups},e.territories={territories:e.territories},this.calObj=calendarSchedule.getCalendarScheduleObj(e,t),t.queryParams.type=this.calObj.schedule_type},renderTemplate:function(e,t){var r=t.queryParams.module;return!0!==$("#"+r+"_config").is(":empty")?(Handlebars.registerPartial("CalScheduleCreateByType",Handlebars.templates.CalScheduleCreateByType),Handlebars.registerPartial("CalScheduleQuestion",Handlebars.templates.CalScheduleQuestion),Handlebars.registerPartial("CalScheduleAssignInfo",Handlebars.templates.CalScheduleAssignInfo),Handlebars.registerPartial("CalScheduleUserInfo",Handlebars.templates.CalScheduleUserInfo),{outlet:"#result",html:Handlebars.templates.CreateCalendarSchedule(this.calObj)}):{outlet:"#"+r+"_config",html:Handlebars.templates.CalScheduleCreateByType(this.calObj)}},afterRender:function(e,t){var r=$("#"+t.queryParams.module+"_config");if(r.is(":empty")&&r.show(),thirdPartyUtils.bindSelect2("select"),e.calendar_Res.calendar_schedule[0].active||$("#calsched_savebtn").attr("disabled",!0),this.calObj.userDisplayArr){var i=document.getElementById("addedUsers"+t.queryParams.module).querySelector("crux-user-dropdown");i.cxProp("selectedUsers",this.calObj.userDisplayArr),i.cxProp("selected",this.calObj.userIdArr)}t&&t.queryParams&&"team"===t.queryParams.type&&$("#selectedusers"+t.queryParams.module)[0].setMethods("onUserAdd",(function(){calendarSchedule.changeMeetingTool("team","assign")}))}}),Lyte.Router.registerRoute("crm.settings.section.booking.index",{model:function(){return networkUtils.lyteInitiateRequest("/crm/v2/settings/calendar_schedule","GET")},renderTemplate:function(e){return e.isPersonalAccount=Crm.userDetails.PERSONAL_ACCOUNT,Handlebars.registerPartial("EmailSignature",Handlebars.templates.EmailSignature),{outlet:"#result",html:Handlebars.templates.ManageCalendarSchedule(e)}}}),Lyte.Router.registerRoute("crm.settings.section.business-hours.create-shift-hours",{forceFetch:!1,model:function(){var e=Lyte.registeredMixins["business-hours-utils"];if(!e.unifiedBusinessHourscheck()){var t=store.peekAll("businesshours_timezone"),r=store.peekAll("business_hours")[0];return void 0===t||void 0===r?Lyte.resolvePromises({timezone:store.findAll("businesshours_timezone"),business_hours:store.findAll("business_hours")}):{timezone:t,business_hours:r}}CrmPlusLib.businesshours("post",void 0,e.crmPlusCallBack)},afterModel:function(e){var t=Lyte.registeredMixins["business-hours-utils"];if(!t.unifiedBusinessHourscheck()){if(t.CrmBusinessHours.createRendering=!0,$u.isEmpty(t.CrmBusinessHours.timeZoneMapNew))for(var r=e.timezone.timezone.length,i=e.timezone.timezone,a=0;a<r;a++){var s=i[a],o=Object.keys(s);t.CrmBusinessHours.timeZoneMapNew[o]=s[o]}if(e.business_hours){var n=store.createRecord("shift_hours"),l={shift_hours:{}},c=t.getAllDaysinBH();l.shift_hours.weekdays=c,l.shift_hours.edit=!1,t.constructInitialShiftHoursValue(l.shift_hours,e.business_hours);var d=e.business_hours;"24*7"===d.type?l.shift_hours.business_days=c:l.shift_hours.business_days=$.map(d.business_days,(function(e){return e})),t.CrmBusinessHours.isShiftEdit=!1,l.shift_hours.timeZone=t.CrmBusinessHours.timeZoneMapNew,l.shift_hours.timezone=Crm.userDetails.orgTimeZone,l.shift_hours.is24hrsFmt=t.CrmBusinessHours.is24HrsFrmt,l.shift_hours.from="createShift",t.CrmBusinessHours.nextUsers=[],l.shift_hours.break_hours[0].label_name=I18n.getMsg("crm.label.break.hours");var u={from:"createShift",edit:!1,isNewShift:!1,userType:"activeusers",scopeSelector:'{"scope":".searchBody","search":"lyte-td.userName","target":".searchRow"}',noUsers:!0},m=t.showUserView(u,"none");n.$.set(l.shift_hours),l.shift_hours.id=n.id,e.shiftHours=l.shift_hours,e.crmShiftUserView=m;var p=l.shift_hours.shift_days;e.shiftHoursSelectedDays=p,e.firstBreakDaysCheckBox=JSON.parse(JSON.stringify(p)),e.secBreakDaysCheckBox=JSON.parse(JSON.stringify(p)),e.originalShiftSelectDays=JSON.parse(JSON.stringify(p)),e.originalfirstBreakDaysCheckBox=JSON.parse(JSON.stringify(p)),e.originalsecBreakDaysCheckBox=JSON.parse(JSON.stringify(p)),e.originalHiddenDay=[];for(var g=t.getAllDaysinBH(),f=0;f<7;f++)-1===e.shiftHoursSelectedDays.indexOf(g[f])&&e.originalHiddenDay.push(g[f]);e.hiddenDay=JSON.parse(JSON.stringify(e.originalHiddenDay))}else renderingUtils.displayPermissionDenied()}},renderTemplate:function(){if(!Lyte.registeredMixins["business-hours-utils"].unifiedBusinessHourscheck())return{outlet:"#result",component:"crm-create-shift-hours"}},afterRender:function(){var e=Lyte.registeredMixins["business-hours-utils"];e.unifiedBusinessHourscheck()||(e.CrmBusinessHours.is24HrsFrmt=e.checkUserTimeFormatis24hrs(),e.CrmBusinessHours.createRendering=!1,$("#overlayHeader,#settingInner").hide(),document.querySelector("crm-create-shift-hours").component.executeMethod("enableOrDisableSaveBtn"),$("#shiftname").focus(),this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.case.escalation.rules.businesshours"),Crm.partnerName])))},beforeExit:function(){store.unloadAll("business_hours"),store.unloadAll("businesshours_timezone")}}),Lyte.Router.registerRoute("crm.settings.section.business-hours.edit-shift-hours",{model:function(e){var t=Lyte.registeredMixins["business-hours-utils"];if(!t.unifiedBusinessHourscheck())return store.unloadAll("business_hours"),store.unloadAll("shift_hours"),store.unloadAll("businesshours_timezone"),Lyte.resolvePromises({timezone:store.findAll("businesshours_timezone"),business_hours:store.findAll("business_hours"),shift_hours:store.findRecord("shift_hours",e.dynamicParam)});CrmPlusLib.businesshours("put",e.dynamicParam,t.crmPlusCallBack)},afterModel:function(e){var t=Lyte.registeredMixins["business-hours-utils"];if(!t.unifiedBusinessHourscheck())if(e.shift_hours[0]){if($u.isEmpty(t.CrmBusinessHours.timeZoneMapNew))for(var r=e.timezone.timezone.length,i=e.timezone.timezone,a=0;a<r;a++){var s=i[a],o=Object.keys(s);t.CrmBusinessHours.timeZoneMapNew[o]=s[o]}t.CrmBusinessHours.createRendering=!0,t.CrmBusinessHours.is24HrsFrmt=t.checkUserTimeFormatis24hrs();var n={};e.shift_hours.hasOwnProperty("id")?(n.shift_hours=[],n.shift_hours.push(e.shift_hours)):n.shift_hours=e.shift_hours,n.shift_hours[0].weekdays=t.getAllDaysinBH(),n.shift_hours[0].timeZone=t.CrmBusinessHours.timeZoneMapNew,n.shift_hours[0].is24hrsFmt=t.CrmBusinessHours.is24HrsFrmt,n.shift_hours[0].edit=!0;var l=n.shift_hours[0].shift_days,c=n.shift_hours[0];c.edit=!0,t.CrmBusinessHours.isShiftEdit=!0;var d={};t.correctServerData(c,e.business_hours);var u,m,p,g=c.break_hours,f=!1,h=!0;if(c.same_as_everyday?u="SAE":(f=!0,h=!1,u="DHE"),g&&g.length>0){for(var y=g.length,v=0;v<y;v++)"-1"===g[v].breakvalue?d[v]="-1":d[v]=g[v].same_as_everyday?"SHE":"DHE";"-1"===g[0].breakvalue&&"-1"===g[1].breakvalue&&(c.break_hours[0].label_name=I18n.getMsg("crm.label.break.hours"),c.noBreakHours=!0),"-1"!==g[0].breakvalue&&(c.break_hours[0].label_name=I18n.getMsg("crm.label.break.hours")+" 1",c.break_hours[1].label_name=I18n.getMsg("crm.label.break.hours")+" 2")}m=c.break_hours[0].break_days?n.shift_hours[0].break_hours[0].break_days:l,p=c.break_hours[1].break_days?n.shift_hours[0].break_hours[1].break_days:l;var _=e.business_hours;"24*7"===_.type?c.business_days=t.getAllDaysinBH():c.business_days=$.map(_.business_days,(function(e){return e})),e.shiftHours=c,e.shiftHoursSelectedDays=l,e.shiftTimePart=f,e.SaeTime=h,e.firstBreakDaysCheckBox=m,e.secBreakDaysCheckBox=p,e.breakIdxVsType=d,e.shiftHoursType=u,e.originalShiftSelectDays=JSON.parse(JSON.stringify(e.shiftHours.shift_days)),e.originalfirstBreakDaysCheckBox=JSON.parse(JSON.stringify(m)),e.originalsecBreakDaysCheckBox=JSON.parse(JSON.stringify(p)),e.originalHiddenDay=[];var b=t.getAllDaysinBH();for(v=0;v<7;v++)-1===e.shiftHoursSelectedDays.indexOf(b[v])&&e.originalHiddenDay.push(b[v]);e.hiddenDay=JSON.parse(JSON.stringify(e.originalHiddenDay))}else e.permissionDenied=!0},renderTemplate:function(e){if(e.permissionDenied&&(e.shiftAlertMsg=I18n.getMsg("crm.shift.delete.alert"),e.shiftAlertMsgShow=!0),!Lyte.registeredMixins["business-hours-utils"].unifiedBusinessHourscheck())return{outlet:"#result",component:"crm-create-shift-hours"}},afterRender:function(e){var t=Lyte.registeredMixins["business-hours-utils"];if(!t.unifiedBusinessHourscheck()&&!e.permissionDenied){var r=document.querySelector("crm-create-shift-hours").component;r.setData("shiftSubmit",!0),$("#createSftForm").change((function(){var e=$("#createSftForm"),t=$("#userDetails").data("changed");e.data("changed")||t||e.data("changed",!0)}));var i=$("#shiftname");i.keypress((function(e){var t=$("#shiftsubmit");$("#shift_errMsg").hide(),13===e.keyCode&&renderingUtils.triggerEvent("click",t)})),t.CrmBusinessHours.is24HrsFrmt=t.checkUserTimeFormatis24hrs(),t.CrmBusinessHours.createRendering=!1,r.executeMethod("enableOrDisableSaveBtn","fromEdit"),i.focus(),this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.case.escalation.rules.businesshours"),Crm.partnerName]))}},beforeExit:function(){store.unloadAll("business_hours"),store.unloadAll("shift_hours");var e={fields:"name,timezone,details,break_hours,holiday,shiftCountDet"};Lyte.registeredMixins["business-hours-utils"].clearCacheQuery("shift_hours",this.getDynamicParam(),e)}}),Lyte.Router.registerRoute("crm.settings.section.business-hours.index",{model:function(e){return store.unloadAll("business_hours"),store.unloadAll("shift_hours"),Lyte.resolvePromises({timezone:store.findAll("businesshours_timezone"),business_hours:store.findAll("business_hours"),shift_hours:store.findAll("shift_hours")})},afterModel:function(e){if(e.business_hours&&"NO_PERMISSION"===e.business_hours.code)return e.permissionDenied=!0,void renderingUtils.displayPermissionDenied();e.business_hours||(e.business_hours={}),e.timezone.timezone.find((function(e){var t=Object.keys(e);Lyte.registeredMixins["business-hours-utils"].CrmBusinessHours.timeZoneMapNew[t]=e[t]})),e=Lyte.registeredMixins["business-hours-utils"].renderBusinessHours(e)},renderTemplate:function(e){if(!e.permissionDenied)return{outlet:"#result",component:"crm-business-hours",reRender:!0}},afterRender:function(e){e.permissionDenied||(this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.case.escalation.rules.businesshours"),Crm.partnerName])),Lyte.registeredMixins["business-hours-utils"].CrmBusinessHours.is24HrsFrmt=Lyte.registeredMixins["business-hours-utils"].checkUserTimeFormatis24hrs())}}),Lyte.Router.registerRoute("crm.settings.section.business-hours.view-shift-hours",{model:function(){return store.unloadAll("business_hours"),store.unloadAll("businesshours_timezone"),Lyte.resolvePromises({timezone:store.findAll("businesshours_timezone"),business_hours:store.findAll("business_hours"),shift_hours:store.findRecord("shift_hours",this.getDynamicParam())})},afterModel:function(e){if(e.shift_hours[0]){e.timezone.timezone.find((function(e){var t=Object.keys(e);Lyte.registeredMixins["business-hours-utils"].CrmBusinessHours.timeZoneMapNew[t]=e[t]}));var t=Lyte.registeredMixins["business-hours-utils"];t.CrmBusinessHours.isShiftEdit=!1;var r=e,i=r.shift_hours[0];t.modificationInShiftHoursRes(i,!1);var a=i.break_hours;if(a&&a.length>0)for(var s=a.length,o=0;o<s;o++)t.modificationInShiftHoursRes(a[o],!0);var n=i,l=t.getAllMonthsList(),c=t.getAllDays(),d=n.holiday.length;for(o=0;o<d;o++)for(var u=n.holiday[o],m=u.details.length,p=0;p<m;p++){var g=u.details[p].date.split("-"),f=Number(g[1]);n.holiday[o].details[p].day=g[2]+" "+l[f-1],n.holiday[o].details[p].days=I18n.getMsg(c[new Date(g[0],g[1]-1,g[2]).getDay()])}n.timezonename=t.CrmBusinessHours.timeZoneMapNew[n.timezone].longname;var h=e.business_hours;"24*7"===h.type?i.business_days=t.getAllDaysinBH():i.business_days=$.map(h.business_days,(function(e){return e})),e.shiftHoursDetailView=JSON.parse(JSON.stringify(i));var y={from:"editShift",edit:!1};y.id=i.id,y.name=i.name,y.userType="activeusers",y.scopeSelector='{"scope":".searchBody","search":"lyte-td.userName","target":".searchRow"}',y.assignMsg=I18n.getMsg("bh.shift.assigned.to");var v=e.shift_hours.$.meta;v&&v.hasOwnProperty("total_shift_with_user")&&v.total_shift_with_user>1&&v.hasOwnProperty("total_shift")&&v.total_shift>1?y.isNewShift=!1:y.isNewShift=!0,e.crmShiftUserView=t.showUserView(y),e.crmShiftUserView.hasShiftUser=r.shift_hours[0].users&&r.shift_hours[0].users.length>0,$L("#result").html("")}else e.permissionDenied=!0},renderTemplate:function(e){return e.permissionDenied&&(e.shiftAlertMsg=I18n.getMsg("crm.shift.delete.alert"),e.shiftAlertMsgShow=!0),{outlet:"#result",component:"crm-shift-hours-detail-view",reRender:!0}},afterRender:function(e){if(!e.permissionDenied){for(var t=$L(".BreakHours"),r=t.length,i=0;i<r;i++)t.eq(i).find(".breakBdrRem").last().removeClass("brdB_e1e1e1");this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.case.escalation.rules.businesshours"),Crm.partnerName]))}}}),Lyte.Router.registerRoute("crm.settings.section.canvas-builder.canvasrules",{queryParams:["ruleId"],getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-canvasrule-model.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-manage-canvasrules.js"],crmConstants.jsStaticPathForLyte);return e=(e=(e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-canvasview.js","crm-tag.js","crm-skype-field.js","crm-tag.js","crm-email-field.js","crm-circuits-rl-label.js","crm-recommendation-details-newview.js","similarity-details-page.js","zia-insights.js","zia-helpers.js","prediction-result.js","nba-detail-page.js","crm-image-mixin.js","setup/orchestration/crm-orchestration-detailview-pop.js","crm-salesiq-detail-view.js","crm-rl-users-list.js","crm-emails-related-list.js","email-emotions.js","crm-rl-share-email.js","social_related_list_store.js","recommendation-detailed-main.js","emails_rl_user-model.js","crm-image-preview.js","crm-emailsrl-canvas-view-comp.js","crm-zdesk-rl-label.js","crm-related-list-action-wrapper.js","crm-detail-view-data-privacy.js","crm-custom-button-wrapper.js","sales-navigator.js","crm-social-integ-outer-template.js","crm-macro.js","crm-column-list.js","crm-attachments.js","crm-activity-rel-wrapper.js","crm-detailcanvas-utils.js","crm-activity-rel.js","crm-list-helpers.js","crux-video.js","crux-note.js","lyte-colorbox.js","crux-tag.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customization"),"zohocrm_lookupBusinessCard.js"]))).concat(networkUtils.returnDependencyFiles(["crm-manage-canvasrules.css","crm-canvas-criteria.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customization")]))).concat(networkUtils.returnDependencyFiles(["crm-canvas-builder.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("crossorgs")]))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailsummary")]))},beforeModel:function(){var e=this;if(Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM||(renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),this.transition.abort()),this.getQueryParams().ruleId)return store.findRecord("canvas_rule",this.getQueryParams().ruleId).then((function(e){return store.findRecord("module",e[0].module.id,void 0,!1,!0,{getFields:!0})})).catch((function(){renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.validation.body.alert",I18n.getMsg("crm.auditlog.canvasrules","Canvas"))),e.transition.abort()}))},model:function(){var e=this,t=[];if(t.push(app.store.makeRequest("findAll","canvas_rule",{page:1,per_page:100})),this.getQueryParams().ruleId){var r=store.peekRecord("canvas_rule",this.getQueryParams().ruleId).module.id;t.push(store.findRecord("module",r,void 0,!1,!0,{getFields:!0})),t.push(store.findAll("field",{module:store.peekRecord("module",r).api_name,type:"Unused"}))}return Lyte.resolvePromises(t).then((function(e){var t=[];return e[1]&&e[1][0].fields&&e[1][0].fields.length>0&&((t=e[1][0].fields.slice(0)).map((function(e){e.unused&&delete e.unused})),e[2]&&e[2].length>0&&e[2].map((function(e){e.unused=!0,t.push(e)}))),{canvasrules:e[0],fields:t}})).catch((function(){e.transition.abort(),renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.access.denied"))}))},renderTemplate:function(){return{outlet:"#result",component:"crm-manage-canvasrules"}},afterRender:function(e){if(this.getQueryParams().ruleId){$L("crm-manage-canvasrules")[0].component.setData("createcanvasrule",!0);var t=store.peekRecord("canvas_rule",this.getQueryParams().ruleId),r=moduleRecordMapping[objectUtils.getMatchedKey(moduleApiMapping,t.module.api_name)],i=document.getElementById("canvascriteriaeditor");$L("#canvas_criteria_name").val(t.name).attr("data-zcid",t.zcid),$L("#modulesId")[0].component.setData("ltPropSelected",r.module_name),i.setData("cxPropFields",e.fields.slice(0)),i.setData("cxPropSetCriteria",t.criteria),document.querySelector("crm-canvas-criteria").setData("moduleOpen",!0)}Crm.client_tracking("Manage Canvas Rule Click")}}),Lyte.Router.registerRoute("crm.settings.section.canvas-builder.detailview",{queryParams:["feature"],getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-canvasrule-model.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-canvas-builder.js","crm-canvas-rename-popup.js","user_type.js"],crmConstants.jsStaticPathForLyte);return e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_detailview_canvas.js"],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles(["crm-canvasview.js","crm-tag.js","crm-skype-field.js","crm-email-field.js","crm-circuits-rl-label.js","crm-recommendation-details-newview.js","similarity-details-page.js","zia-insights.js","zia-helpers.js","prediction-result.js","nba-detail-page.js","crm-image-mixin.js","setup/orchestration/crm-orchestration-detailview-pop.js","crm-salesiq-detail-view.js","crm-rl-users-list.js","crm-emails-related-list.js","email-emotions.js","crm-rl-share-email.js","social_related_list_store.js","recommendation-detailed-main.js","emails_rl_user-model.js","crm-image-preview.js","crm-emailsrl-canvas-view-comp.js","crm-related-list-action-wrapper.js","crm-detail-view-data-privacy.js","crm-custom-button-wrapper.js","sales-navigator.js","crm-social-integ-outer-template.js","crm-macro.js","crm-column-list.js","crm-attachments.js","crm-activity-rel-wrapper.js","crm-detailcanvas-utils.js","crm-tag.js","crm-activity-rel.js","crm-list-helpers.js","crux-video.js","crux-note.js","lyte-colorbox.js","crux-tag.js","crm-zdesk-rl-all.js","crm-zdesk-rl-label.js","crm-tag-modal.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zdeskrelatedlist")],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customization"),"zohocrm_lookupBusinessCard.js"]))).concat(networkUtils.returnDependencyFiles(["crm-canvas-builder.css","crm-canvas-rename-popup.css"],crmConstants.cssStaticPathForLyte))},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM||(renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),this.transition.abort())},model:function(){var e=this,t=null;if(!(!e.transition.info.queryParams||!e.transition.info.queryParams.layoutId)){var r=e.transition.info.queryParams.module,i=e.transition.info.queryParams.layoutId;t=app.store.makeRequest("findAll","canvasview",{module:r,feature:"DetailView",layoutId:i})}else t=app.store.makeRequest("findAll","canvasview",{feature:"DetailView"});return t.then((function(e){return{views:e}})).catch((function(t){var r=JSON.parse(t.responseText);"FEATURE_NOT_SUPPORTED"===r.code?(renderingUtils.displayPermissionDenied(),$("#popupnew").find(".mT10").text(I18n.getMsg("crm.label.cf.error.feature.unsupported"))):"FEATURE_NOT_ENABLED"!==r.code&&"NOT_ALLOWED"!==r.code||(renderingUtils.displayPermissionDenied(),$("#popupnew").find(".mT10").text(I18n.getMsg("crm.security.error"))),e.transition.abort()}))},afterModel:function(e){if(e.feature="DetailView",e.maxViewLimit=e.views.$.meta.maxViewLimit,e.views.length<=0)return app.store.makeRequest("findAll","canvas_rule",{page:1,per_page:1}).then((function(t){t.length>0&&(e.canvasRuleAvail=!0)})).catch((function(){}))},renderTemplate:function(){return{outlet:"#result",component:"crm-canvas-builder"}}}),Lyte.Router.registerRoute("crm.settings.section.canvas-builder.listview",{queryParams:["feature"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-canvas-builder.js","user_type.js"],crmConstants.jsStaticPathForLyte);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_detailview_canvas.js"],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customization")]))).concat(networkUtils.returnDependencyFiles(["crm-canvas-builder.css"],crmConstants.cssStaticPathForLyte))},model:function(){var e=this.getQueryParams();return Lyte.resolvePromises({views:store.findAll("canvasview",{feature:e.feature})})},afterModel:function(e){e.feature=this.getQueryParams().feature},renderTemplate:function(){return{outlet:"#result",component:"crm-canvas-builder"}}}),Lyte.Router.registerRoute("crm.settings.section.case-escalation-rule.index-case-escalation-rule",{model:function(e){var t={params:{pageTitle:"crm.pricing.case.escalation.rules",isFromBack:!0,action:"viewEscRules"}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CaseEscalation.do","POST",t)},afterModel:function(e,t){},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){},beforeExit:function(){}}),Lyte.Router.registerRoute("crm.settings.section.case-escalation-rule.view-case-escalation-rule",{queryParams:["entryId"],model:function(e){var t=this.getQueryParams()?this.getQueryParams().entryId:null,r=this.getDynamicParam(),i={};t?(i={action:"viewEscalationsOfEscRuleEntry",ruleId:r,entryId:t,isFromBack:!0},Object.keys(this.transition.data).length&&(i.ruleName=this.transition.data.ruleName)):i={action:"viewEscRuleEntries",ruleId:r,isFromBack:!0};var a={params:i};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CaseEscalation.do","POST",a)},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.crm-variables.create-crm-variable",{queryParams:["groupId"],model:function(e){var t={params:{action:"createVariable",groupId:this.getQueryParams().groupId,isFromBack:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Variables.do","POST",t)},afterModel:function(e){e.constructor===Object&&e.code&&"NO_PERMISSION"===e.code&&cVar.showPermissionDenied(this.transition)},renderTemplate:function(e,t){var r=this.getQueryParams().groupId;e=JSON.stringify(e);t={action:"createVariable",calleeObj:"crmSetup",clickId:"cVarEdit",groupId:r+"",isFromBack:"true",subTab:"crmvariables",tab:"devSpace"};return{outlet:"#result",html:cVar.variableList(e,t)}},afterRender:function(e,t){$("#saveVar").prop("disabled",!0),cVar.updateChosen(),cVar.searchVariable(),cVar.checkforVariableSave(),thirdPartyUtils.bindSelect2($(".newSelect").find("select"))}}),Lyte.Router.registerRoute("crm.settings.section.crm-variables.edit-crm-variable",{queryParams:["groupId"],model:function(e){var t={params:{action:"updateVar",variableId:this.getDynamicParam(),groupId:this.getQueryParams().groupId,isFromBack:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Variables.do","POST",t)},afterModel:function(e){e.constructor===Object&&e.code&&"NO_PERMISSION"===e.code&&cVar.showPermissionDenied(this.transition)},redirect:function(e){if(e.constructor===Object&&e.code&&"INVALID_DATA"===e.code){cVar.showCustomAlert(I18n.getMsg("gs.record.deleted",I18n.getMsg("crm.variable",Crm.appName)));var t=Object.assign({},this.transition.info);t.route="crm.settings.section.crm-variables.index-crm-variable",this.replaceWith(t)}},renderTemplate:function(e,t){var r=this.getQueryParams().groupId;null==r&&(r="1");var i=this.getDynamicParam();e=JSON.stringify(e);t={action:"updateVar",calleeObj:"crmSetup",clickId:"cVarEdit",groupId:r+"",isFromBack:"true",subTab:"crmvariables",tab:"devSpace",variableId:i};return{outlet:"#result",html:cVar.variableList(e,t)}},afterRender:function(){cVar.checkforVariableSave()}}),Lyte.Router.registerRoute("crm.settings.section.crm-variables.index-crm-variable",{model:function(e){var t={params:{pageTitle:"crm.label.currencies",action:"variables",isFromBack:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Variables.do","POST",t)},afterModel:function(e){if("object"==typeof e&&"NO_PERMISSION"===e.code){var t=Object.assign({},this.transition.info);t.route="crm.settings.index",this.replaceWith(t),setTimeout((function(){crmui.showMsgBand("error",I18n.getMsg("crm.label.cf.error.authorization"),3e3)}),100)}},renderTemplate:function(e,t){return{outlet:"#result",html:cVar.variableList(e,t)}},afterRender:function(){if(this.transition.data&&this.transition.data.varid){var e=this.transition.data.varid,t=$("#setup_new_ContentDiv"),r=$("#row_"+e),i=r.offset().top+t.scrollTop()-210;t.animate({scrollTop:i}),r.addClass("trialyellowbox"),setTimeout((function(){r.removeClass("trialyellowbox"),e=void 0}),5e3)}cVar.updateChosen(),cVar.searchVariable(),thirdPartyUtils.bindSelect2($(".newSelect").find("select"))}}),Lyte.Router.registerRoute("crm.settings.section.data-enrichment.index-data-enrichment",{model:function(){var e=store.peekAll("auto_enrichment"),t=!1;if(e&&e.length>0)for(var r=e.length,i=0;i<r;i++){var a=e[i];if(!(a.profiles&&a.profiles.length>0)){t=!0;break}}1==t&&store.findAll("auto_enrichment")},renderTemplate:function(){return{component:"crm-dataenrichment-list",outlet:"#result"}},actions:{onError:function(e){var t,r="";return e.response&&(r=JSON.parse(e.response).code),"NOT_SUPPORTED_FEATURE"==r?(t=I18n.getMsg("crm.auto.enrich.edition.not.support"),crmui.showMsgBand("error",t,"4000",""),crmHistory.backOneLevel()):"NO_PERMISSION"==r?(t='<div class="f21"><span id="warningMsg">'+I18n.getMsg("crm.setup.attribution.NO_PERMISSION")+"</span></div>",renderingUtils.showCustomAlert(t,void 0,!0,(function(){crmHistory.backOneLevel()}))):(t='<div class="f21"><span id="warningMsg">'+I18n.getMsg("crm.no.roles.for.homepage1")+'</span> <span class="proxima" id="delItemName"></span><br><span id="showWarning2" class="f13"><b>'+I18n.getMsg("crm.label.note2")+' </b><span id="noteMsg">'+I18n.getMsg("crm.no.roles.for.homepage2")+"</span></span></div>",renderingUtils.showCustomAlert(t,void 0,!0,(function(){crmHistory.backOneLevel()}))),!1}}}),Lyte.Router.registerRoute("crm.settings.section.data-enrichment.view-data-enrichment",{beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(e){var t=store.peekRecord("auto_enrichment",e.dynamicParam),r=this;if(null==t)throw"no module permission";if(t.fields_to_enrich&&t.fields_to_enrich.length>0){var i=store.peekRecord("auto_enrichment",Lyte.Router.getRouteInstance().getDynamicParam());return r.enrichRecordAndFieldsPromise(i,!0)}return store.findRecord("auto_enrichment",Lyte.Router.getRouteInstance().getDynamicParam()).then((function(e){return r.enrichRecordAndFieldsPromise(e)}))},afterModel:function(e){this.currentModel={};var t=e[0][0];t||(t=e[0]);var r=t.module.api_name,i=this.permittedCrmFieldsToEnrich(e[1]),a=i.length,s={},o=[],n={};a=i.length;for(var l=0;l<a;l++){var c=i[l].api_name;if(c.includes(".")){var d=c.split(".");c=d[1]}i[l].api_name=c,s[i[l].api_name]=i[l];var u={};u.api_name=c,u.display_label=i[l].display_label,u.visible=i[l].visible,o.push(u),n[c]=l}if(t){var m=t.fields_map,p=t.fields_to_enrich,g=[],f=[],h=p.length,y=[];for(l=0;l<h;l++)s[p[l].api_name]&&y.push(s[p[l].api_name].display_label);var v=m.length,_=[];g=[];for(l=0;l<v;l++){var b={},w={};b.enrich_field=m[l].enrich_field,w.enrich_field={name:m[l].enrich_field.name};var C={};m[l].crm_field&&m[l].crm_field.api_name&&s[m[l].crm_field.api_name]&&s[m[l].crm_field.api_name].display_label?(C.api_name=m[l].crm_field.api_name,C.display_label=s[C.api_name].display_label,C.id=m[l].crm_field.id,w.crm_field={api_name:m[l].crm_field.api_name},f.push(n[C.api_name])):w.crm_field=null,b.crm_field=C,_.push(w),g.push(b)}this.currentModel.saveEnrichJson=_,this.currentModel.fieldArrayObj=g,f.sort((function(e,t){return e-t}));for(l=f.length-1;l>=0;l--)o.splice(f[l],1);3===y.length?this.currentModel.fieldsToEnrich=Lyte.Component.registeredHelpers.getI18n("crm.user.hierarchy.role.three",y[0],y[1],y[2]):2===y.length?this.currentModel.fieldsToEnrich=y[0]+" "+Lyte.Component.registeredHelpers.getI18n("crm.label.lowercase.and")+" "+y[1]:this.currentModel.fieldsToEnrich=y[0],t.modified_by&&(this.currentModel.modifiedBy=t.modified_by.name,this.currentModel.modifiedAt=t.modified_time),this.currentModel.moduleElement=o,this.currentModel.autoEnrichment=g,this.currentModel.fieldsMap=s,this.currentModel.currentModule=r;var D=store.peekAll("module"),L=D.length;for(l=0;l<L;l++)D[l].api_name==r&&(this.currentModel.currentModuleDisplay=D[l].plural_label)}commonUtils.showHideLoadingDiv(!1)},renderTemplate:function(e,t){return{component:"crm-dataenrichment-view",outlet:"#result"}},getModuleFields:function(e){return store.findAll("field",{module:e})},enrichRecordAndFieldsPromise:function(e,t){var r=[],i=this.transition.data,a=t?e.module.api_name:e[0].module.api_name;return r.push(e),r.push(this.getModuleFields(i&&i.module?i.module:a)),Lyte.resolvePromises(r)},permittedCrmFieldsToEnrich:function(e){var t=[3,5,6,7,8,9,10,12,13,15,20,24,32,34,36,38,41,51,52,55,77,99,100,104,110,111,116,123,133,200,207,208,209,301,444,445,500,555,556,786,1234],r=[0,1,2,3,8,9,10,17],i=["UNSUBSCRIBEDMODE","UNSUBSCRIBEDTIME"],a=["text","picklist","phone","website","email"];return e.filter((function(e){if(!t.includes(e.ui_type)&&!r.includes(e.show_type)&&!i.includes(e.column_name)&&a.includes(e.data_type))return e}))},actions:{onError:function(e){var t,r="";return"no module permission"==e?r="NO_PERMISSION":e.response&&(r=JSON.parse(e.response).code),"NOT_SUPPORTED_FEATURE"==r?(t=I18n.getMsg("crm.auto.enrich.edition.not.support"),crmui.showMsgBand("error",t,"4000",""),crmHistory.backOneLevel()):"NO_PERMISSION"==r||"INVALID_MODULE"==r?(t='<div class="f21"><span id="warningMsg">'+I18n.getMsg("crm.setup.attribution.NO_PERMISSION")+"</span></div>",renderingUtils.showCustomAlert(t,void 0,!0,(function(){crmHistory.backOneLevel()}))):(t='<div class="f21"><span id="warningMsg">'+I18n.getMsg("crm.no.roles.for.homepage1")+'</span> <span class="proxima" id="delItemName"></span><br><span id="showWarning2" class="f13"><b>'+I18n.getMsg("crm.label.note2")+' </b><span id="noteMsg">'+I18n.getMsg("crm.no.roles.for.homepage2")+"</span></span></div>",renderingUtils.showCustomAlert(t,void 0,!0,(function(){crmHistory.backOneLevel()}))),!1}}}),Lyte.Router.registerRoute("crm.settings.section.data-sharing.create-data-sharing",{getResources:function(){var e=networkUtils.returnDependencyFiles(["i18n/"+Crm.userDetails.jsLocation+"userlist/zohocrm_"+$ESAPI.encoder().encodeForJavaScript(Crm.userDetails.LOCALE)+".js"]);return e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("sharingrules")],crmConstants.jsStaticPath))},queryParams:["module"],model:function(e){var t={params:{action:"newRule",module:this.getQueryParams().module}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/SharingSetting.do","GET",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.sharing.settings"),Crm.appName]));var r=document.getElementById("sharingRuleName");r&&r.focus(),setTimeout((function(){$(".sharingTypeSelect").find("select").select2({placeholder:I18n.getMsg("crm.select")})}),200)},afterModel:function(e){"scheduler running"===e.error&&(renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.sharing.rules.module.execution.progress",moduleRecordMapping[this.getQueryParams().module].singular_label)),commonUtils.showHideLoadingDiv(),this.transition.abort()),"module unavailable"===e.error&&(renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.sharing.rules.module.unavailable")),commonUtils.showHideLoadingDiv(),this.transition.abort())}}),Lyte.Router.registerRoute("crm.settings.section.data-sharing.edit-data-sharing",{getResources:function(){var e=networkUtils.returnDependencyFiles(["i18n/"+Crm.userDetails.jsLocation+"userlist/zohocrm_"+$ESAPI.encoder().encodeForJavaScript(Crm.userDetails.LOCALE)+".js"]);return e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("sharingrules")],crmConstants.jsStaticPath))},queryParams:["module"],model:function(e){var t={params:{action:"editRule",ruleId:this.getDynamicParam(),module:this.getQueryParams().module}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/SharingSetting.do","GET",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.sharing.settings"),Crm.appName]));var r=document.getElementById("sharingRuleName");r&&r.focus(),setTimeout((function(){$(".sharingTypeSelect").find("select").select2({placeholder:I18n.getMsg("crm.select")})}),200)},afterModel:function(e){e.error&&("scheduler running"===e.error&&(renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.sharing.rules.module.execution.progress",moduleRecordMapping[this.getQueryParams().module].singular_label)),this.transition.abort()),"module unavailable"===e.error&&(renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.sharing.rules.module.unavailable")),commonUtils.showHideLoadingDiv(),this.transition.abort()))}}),Lyte.Router.registerRoute("crm.settings.section.data-sharing.edit-default-data-sharing",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/SharingSetting.do","GET",{params:{action:"editAllDefPer"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.sharing.settings"),Crm.appName]))}}),Lyte.Router.registerRoute("crm.settings.section.data-sharing.index-data-sharing",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-userlist.css"],crmConstants.cssStaticPathForLyte);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["i18n/"+Crm.userDetails.jsLocation+"userlist/zohocrm_"+$ESAPI.encoder().encodeForJavaScript(Crm.userDetails.LOCALE)+".js"]))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("sharingrules")],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles(["sharing-rules-list.js","lyte-hovercard.js"],crmConstants.jsStaticPathForLyte))},model:function(e){if(this.transition.data.data)return this.transition.data.data;return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/SharingSetting.do","GET",{params:{action:"showAllRules"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.sharing.settings"),Crm.appName]))},beforeExit:function(){store.unloadAll("sharing_rules")}}),Lyte.Router.registerRoute("crm.settings.section.functions",{getResources:function(){var e,t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customfunctions"),"zcrm_custom_functions.min.js"]);return e=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["function-common-rtl.css"],crmConstants.cssStaticPathForLyte):networkUtils.returnDependencyFiles(["function-common.css"],crmConstants.cssStaticPathForLyte),t.concat(e)},redirect:function(){"crm.settings.section.functions"===this.transition.target&&Lyte.Router.transitionTo("crm.settings.section.functions.myFunctions")}}),Lyte.Router.registerRoute("crm.settings.section.functions.functionscredits",{getDependencies:function(){return networkUtils.returnDependencyFiles(["function-model.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=[];e=Crm.userDetails.RTL_ENABLED?e.concat(networkUtils.returnDependencyFiles(["custom-function-credits-rtl.css"],crmConstants.cssStaticPathForLyte)):networkUtils.returnDependencyFiles(["custom-function-credits.css"],crmConstants.cssStaticPathForLyte);var t=networkUtils.returnDependencyFiles("custom-function-credits.js",crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("functions_credits")]);return e.concat(t).concat(r)},model:function(){return Lyte.resolvePromises({creditsDetails:store.triggerAction("function","credits",{request_type:"GET"})})},afterModel:function(e){if(this.currentModel=e.creditsDetails,this.error_key)try{var t=e.responseText,r=JSON.parse(t);("NO_PERMISSION"===r.code||this.error_key||e&&e.functions_paid_credits&&e.functions_paid_credits.status&&"error"===e.functions_paid_credits.status)&&(Lyte.Router.transitionTo("crm.settings.index"),customFunctionsObj.showErrorMessage(r.code,!0,!0,!0,!0),this.stop_bubble=!0,this.transition.abort())}catch(t){(this.error_key||e&&e.functions_paid_credits&&e.functions_paid_credits.status&&"error"===e.functions_paid_credits.status)&&(Lyte.Router.transitionTo("crm.settings.index"),customFunctionsObj.showErrorMessage(r.code,!0,!0,!0,!0),this.stop_bubble=!0,this.transition.abort())}},renderTemplate:function(e){var t={newDashboard:!0};t.superAdmin=Crm.userDetails.IS_SUPER_ADMIN&&"production"===Crm.userDetails.orgEnvType&&!Crm.userDetails.isTrialEnabled&&Crm.userDetails.ISPAID_USER&&Crm.userDetails.FUNCTIONS_NEW_CREDITS_AVAILABLE;var r=!!Crm.userDetails.hasOwnProperty("IS_DEVELOPMENT_SETUP")&&Crm.userDetails.IS_DEVELOPMENT_SETUP;return t.superAdmin||r?(this.currentModel=e.functions_paid_credits,{outlet:"#result",component:"crm-functions-credits-home"}):($(".dummy_Body").hide(),renderingUtils.displayPermissionDenied(),!1)},actions:{onError:function(e,t){return this.error_key=!0,t.resume(),!1},didTransition:function(){if(this.stop_bubble)return!1}}}),Lyte.Router.registerRoute("crm.settings.section.functions.functionsdashboard",{queryParams:["period"],getDependencies:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customfunctions"),"zcrm_custom_functions.min.js"]),t=networkUtils.returnDependencyFiles(["custom-function-dashboard.js","lyte-dateselect.js","lyte-daterangepicker.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles(["custom-function-dashboard.css","function-common.css"],crmConstants.cssStaticPathForLyte);return Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["function-common-rtl.css"],crmConstants.cssStaticPathForLyte))),e.concat(r).concat(t)},getResources:function(){return networkUtils.returnDependencyFiles(networkUtils.includeChartFiles())},model:function(e){var t=e.queryParams.period;return void 0===t&&(t="past_24_hours"),e.queryParams.period=t,Lyte.resolvePromises({dashboard:networkUtils.lyteInitiateRequest("/crm/v2/settings/functions/dashboard?period="+t,"GET",{skip_load_tab:!0})})},afterModel:function(e){if(this.error_key)try{var t=e.responseText,r=JSON.parse(t);"NO_PERMISSION"===r.code?(customFunctionsObj.showErrorMessage(r.code,!0,!0,!0,!0),Lyte.Router.transitionTo("crm.settings.index"),this.stop_bubble=!0,this.transition.abort()):this.error_key||"NOT_CONFIGURED"==e.dashboard.code?(customFunctionsObj.showErrorMessage(e.dashboard,!1,!0,!0,!0),this.stop_bubble=!0,this.transition.abort(),crmHistory.back()):(this.error_key||e&&e.dashboard&&e.dashboard.status&&"error"==e.dashboard.status)&&(customFunctionsObj.showErrorMessage(e.category,!0,!0,!0,!0),this.stop_bubble=!0,this.transition.abort())}catch(t){(this.error_key||e&&e.gallery&&e.gallery.status&&"error"==e.gallery.status)&&(customFunctionsObj.showErrorMessage(e.category,!0,!0,!0,!0),this.stop_bubble=!0,this.transition.abort())}else e.displayTimeZone=e.dashboard.info.timezone},renderTemplate:function(e,t){return networkUtils.initChart(),e.period=customFunctionsObj.getDashboardOptions(t.queryParams.period),{outlet:"#result",component:"crm-functions-dashboard"}},afterRender:function(e,t){customFunctionsObj.selectClass("cf_dashboard");var r={};e.dashboard&&"NOT_CONFIGURED"==e.dashboard.code&&(customFunctionsObj.showErrorMessage(customFunctionsObj.errorCode.NOT_CONFIGURED_ORG.code,!0,!0,!0,!0),crmHistory.back(),this.stop_bubble=!0,this.transition.abort()),r.dashboard=e.dashboard.dashboard[0],r.info=e.dashboard.info,r.period=t.queryParams.period,customFunctionsObj.loadDashboardView(r),!0===e.dashboard.info.isAnnouncementNeeded&&$L("#dreLimitNotifyBar").removeClass("dN").addClass("dB");var i=I18n.getMsg(window.location.origin+Crm.getCrmBasePath()+"/settings/api/usage/graph-view"),a=unescape(I18n.getMsg("crm.api.dashboard.includedrelimit.announcement1",i));$L("#dreNotifyContent")[0].innerHTML="<span>"+a+"</span>"},actions:{onError:function(e,t){return this.error_key=!0,t.resume(),!1},didTransition:function(){if(this.stop_bubble)return!1}},beforeExit:function(){delete customFunctionsObj.isSec1Rendered,delete customFunctionsObj.isSec2Rendered,delete customFunctionsObj.isSec3Rendered,customFunctionsObj.chartData={}}}),Lyte.Router.registerRoute("crm.settings.section.functions.functionsfailures",{getDependencies:function(){return networkUtils.returnDependencyFiles(["custom-function-failures-model.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customfunctions"),"zcrm_custom_functions.min.js"]),t=networkUtils.returnDependencyFiles(["custom-function-failure.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles(["custom-function-failure.css"],crmConstants.cssStaticPathForLyte);return e.concat(r).concat(t)},model:function(){var e={start:1,limit:100,componentType:"all"};return Lyte.resolvePromises({categoryList:networkUtils.lyteInitiateRequest("/crm/v2/settings/functions/category","GET",{skip_load_tab:!0}),functionFailures:store.findAll("failures",e)})},afterModel:function(e){if(this.error_key)try{var t=e.responseText,r=JSON.parse(t);"NO_PERMISSION"===r.code?(customFunctionsObj.showErrorMessage(r.code,!0,!0,!0,!0),Lyte.Router.transitionTo("crm.settings.index"),this.stop_bubble=!0,this.transition.abort()):(this.error_key||e&&e.functionFailures&&e.functionFailures.status&&"error"==e.functionFailures.status)&&(customFunctionsObj.showErrorMessage(e.category,!0,!0,!0,!0),this.stop_bubble=!0,this.transition.abort())}catch(t){(this.error_key||e&&e.functionFailures&&e.functionFailures.status&&"error"==e.functionFailures.status)&&(customFunctionsObj.showErrorMessage(e.category,!0,!0,!0,!0),this.stop_bubble=!0,this.transition.abort())}else e.displayTimeZone=e.functionFailures.$.meta.info.timezone},renderTemplate:function(e){return customFunctionsObj.constructCFBodyDiv(),e.functionFailures&&e.functionFailures.length>=100?customFunctionsObj.hasNextFailures=!0:customFunctionsObj.hasNextFailures=!1,{outlet:"#result",component:"crm-function-failureslist"}},afterRender:function(){$(".Function_table").height(renderingUtils.windowHeight-310)},beforeExit:function(){store.unloadAll("failures")}}),Lyte.Router.registerRoute("crm.settings.section.functions.functionsgallery",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["custom-function-model.js","function-model.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customfunctions"),"zcrm_custom_functions.min.js"]),r=networkUtils.returnDependencyFiles(["custom-function-gallery.js"],crmConstants.jsStaticPathForLyte);return(Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["custom-function-gallery.css","function-common-rtl.css"],crmConstants.cssStaticPathForLyte):networkUtils.returnDependencyFiles(["custom-function-gallery.css","function-common.css"],crmConstants.cssStaticPathForLyte)).concat(r).concat(t).concat(e)},model:function(){var e={type:"gallery",start:1,limit:100};return store.unloadAll("function"),Lyte.resolvePromises({gallery:store.findAll("function",e)})},afterModel:function(e){if(this.error_key)try{var t=e.responseText,r=JSON.parse(t);"NO_PERMISSION"===r.code?(Lyte.Router.transitionTo("crm.settings.index"),customFunctionsObj.showErrorMessage(r.code,!0,!0,!0,!0),this.stop_bubble=!0,this.transition.abort()):(this.error_key||e&&e.gallery&&e.gallery.status&&"error"==e.gallery.status)&&(customFunctionsObj.showErrorMessage(e.category,!0,!0,!0,!0),this.stop_bubble=!0,this.transition.abort())}catch(t){(this.error_key||e&&e.gallery&&e.gallery.status&&"error"==e.gallery.status)&&(customFunctionsObj.showErrorMessage(e.category,!0,!0,!0,!0),this.stop_bubble=!0,this.transition.abort())}},renderTemplate:function(){return customFunctionsObj.constructCFBodyDiv(),{outlet:"#result",component:"crm-function-gallery"}},afterRender:function(){$(".Function_table").height(renderingUtils.windowHeight-310)}}),Lyte.Router.registerRoute("crm.settings.section.functions.myFunctions",{getDependencies:function(){return networkUtils.returnDependencyFiles(["custom-function-model.js","function-model.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e,t=networkUtils.returnDependencyFiles(["zcrm_custom_functions.min.js",networkUtils.getI18nJSUrl("customfunctions")]),r=networkUtils.returnDependencyFiles(["custom-function-functionlist.js"],crmConstants.jsStaticPathForLyte),i=networkUtils.returnDependencyFiles(["custom-function-editor.js","crm-function-components-wrapper.js","crm-functions-helper.js"],crmConstants.jsStaticPathForLyte),a=networkUtils.returnDependencyFiles(["custom-function-editor.css","crm-reviewprocess-customfunction.css","function-common.css"],crmConstants.cssStaticPathForLyte);return e=networkUtils.returnDependencyFiles(["custom-function-functionlist.css"],crmConstants.cssStaticPathForLyte),Crm.userDetails.RTL_ENABLED&&(a=networkUtils.returnDependencyFiles(["function-common-rtl.css","crm-reviewprocess-customfunction.css"],crmConstants.cssStaticPathForLyte)),r.concat(e).concat(t).concat(i).concat(a)},model:function(){var e={type:"org",start:1};return e.limit=customFunctionsObj.limit,store.unloadAll("function"),Lyte.resolvePromises({categoryList:networkUtils.lyteInitiateRequest("/crm/v2/settings/functions/category","GET",{skip_load_tab:!0}),functionList:store.findAll("function",e)})},afterModel:function(e){if(this.error_key)try{var t=e.responseText,r=JSON.parse(t);"NO_PERMISSION"===r.code?(customFunctionsObj.showErrorMessage(r.code,!0,!0,!0,!0),Lyte.Router.transitionTo("crm.settings.index"),this.stop_bubble=!0,this.transition.abort()):(this.error_key||e&&e.category&&e.category.status&&"error"==e.category.status)&&(customFunctionsObj.showErrorMessage(e.category,!0,!0,!0,!0),this.stop_bubble=!0,this.transition.abort())}catch(t){(this.error_key||e&&e.category&&e.category.status&&"error"==e.category.status)&&(customFunctionsObj.showErrorMessage(e.category,!0,!0,!0,!0),this.stop_bubble=!0,this.transition.abort())}},renderTemplate:function(e){return $("body").append('<div id="createfunctionpopdiv" class="clearfix"></div>'),customFunctionsObj.isFrom="functions","error"==e.categoryList.status&&(crmui.showMsgBand(customFunctionsObj.ERROR,customFunctionsObj.errorCode.UNCONFIRMED_EMAIL.message,customFunctionsObj.ERROR_POPUP_DELAY),Lyte.Router.transitionTo("crm.settings.index")),e.functionList&&e.functionList.length>0&&e.functionList.length>=customFunctionsObj.limit?customFunctionsObj.hasNext=!0:customFunctionsObj.hasNext=!1,customFunctionsObj.fromSource="functions",customFunctionsObj.isCleanUpFuncEnabled=e.categoryList.isCleanUpFuncEnabled,{outlet:"#result",component:"crm-function-mainlist"}},actions:{onError:function(e,t){return this.error_key=!0,t.resume(),!1},didTransition:function(){if(this.stop_bubble)return!1}},afterRender:function(){Crm.userDetails.CUSTOMIZE_INFO.API_NEWS_LETTER||($("#setup_new_ContentDiv").addClass("pR"),$(".apiBandStripCont").removeClass("dN"))},beforeExit:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess(),store.unloadAll("function")}}),Lyte.Router.registerRoute("crm.settings.section.groups.create-group",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Group.do","GET",{params:{action:"newGroup"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.group.new"),Crm.appName]))}}),Lyte.Router.registerRoute("crm.settings.section.groups.edit-group",{model:function(e){var t={params:{action:"editGroup",groupId:this.getDynamicParam()}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Group.do","GET",t)},renderTemplate:function(e,t){return-1!==e.indexOf("EmptyGroup")?{outlet:"#result",html:'<div class="pT30" style=" margin-top: 200px; margin-left:20px;"><div class="crm-error-page pR pL30" style="width: 50%;"><span class="crm-error-page-icon p0"></span> <h2 style="color:#DD4B39; font-size:2.6rem;" class="mL15">'+I18n.getMsg("crm.label.group.notavailable")+'</h2><div class="mt5 f14 mL15 lineHgt20"></div></div></div>'}:{outlet:"#result",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.group.edit"),Crm.appName]))}}),Lyte.Router.registerRoute("crm.settings.section.groups.index-groups",{model:function(e){if(this.transition.data&&this.transition.data.data)return this.transition.data.data;return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Group.do","GET",{params:{action:"groupsList"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.groups"),Crm.appName]))}}),Lyte.Router.registerRoute("crm.settings.section.groups.view-group",{model:function(e){if(this.transition.data&&this.transition.data.data)return this.transition.data.data;var t={params:{action:"viewGroup",groupId:this.getDynamicParam()}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Group.do","GET",t)},renderTemplate:function(e,t){return-1!==e.indexOf("EmptyGroup")?{outlet:"#result",html:'<div class="pT30" style=" margin-top: 200px; margin-left:20px;"><div class="crm-error-page pR pL30" style="width: 50%;"><span class="crm-error-page-icon p0"></span> <h2 style="color:#DD4B39; font-size:2.6rem;" class="mL15">'+I18n.getMsg("crm.label.group.notavailable")+'</h2><div class="mt5 f14 mL15 lineHgt20"></div></div></div>'}:{outlet:"#result",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.group.view"),Crm.appName]))}}),Lyte.Router.registerRoute("crm.settings.section.home-customization.index-home-customization",{getDependencies:function(){if("undefined"==typeof CustomHomePage)return networkUtils.returnDependencyFiles(["zohocrm_sharehomepage.js"])},model:function(e){if(this.transition.cachedResponse)return this.transition.cachedResponse;return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/HomePageLayout.do","GET",{params:{action:"customHomePageList"}})},renderTemplate:function(e,t){crmSetup.renderHomepageSetupResponse("customHomePageList",e)},afterRender:function(){$(".setupleftmenutd,#setupInnerLinks").show(),$(".new_setupview").removeClass("newSetupRightShow")}}),Lyte.Router.registerRoute("crm.settings.section.macro.create",{queryParams:["module"],beforeModel:function(){this.error=!1},model:function(e){var t={params:{step:"newMacroRule",module:e.queryParams.module}};return Crm.isPageLoad&&(t.headers={"is-Page-Load":"true"},Crm.isPageLoad=!1),t.params.cvid=e.queryParams.module?moduleRecordMapping[e.queryParams.module].cvid:"",networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Macro.do","POST",t)},afterModel:function(e){if(commonUtils.showHideLoadingDiv(),"string"!=typeof e){e.reminderDateValues=[],e.reminderMonthValues=[],e.timeFormat=Crm.userDetails.TIME_FORMAT,e.dateFormat=Crm.userDetails.DATE_PATTERN,e.timeSpanName="HH:mm"!=Crm.userDetails.TIME_FORMAT?"h12":"h24";for(var t=1;t<=30;t++)e.reminderDateValues.push(t);for(t=1;t<=12;t++)e.reminderMonthValues.push(t);existingMacros=e.existingMacros,macroId=e.macroId,e.taskSize=0,e.updateFieldSize=0,e.alertSize=0}else this.error=!0},renderTemplate:function(e){return this.error?{outlet:"#show",html:e}:{outlet:"#show",html:Handlebars.templates.MacroCE(e)}},afterRender:function(){Macro.doAlertInit()}}),Lyte.Router.registerRoute("crm.settings.section.macro.edit",{queryParams:["module"],beforeModel:function(e){this.error=!1},model:function(e){var t={params:{step:"editMacro",cvid:crmListView.getObject().cvId,module:e.queryParams.module,ruleId:e.dynamicParam}};return Crm.isPageLoad&&(t.headers={"is-Page-Load":"true"},Crm.isPageLoad=!1),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Macro.do","POST",t)},afterModel:function(e){if("string"!=typeof e&&0==e.isPermissionDenied){existingMacros=e.existingMacros,macroId=e.macroId,e.alertSize=null!=e.Alert?Object.keys(e.Alert).length:0,e.taskSize=null!=e.Task?Object.keys(e.Task).length:0,e.updateFieldSize=null!=e.updateField?Object.keys(e.updateField).length:0,e.timeFormat=Crm.userDetails.TIME_FORMAT,e.dateFormat=Crm.userDetails.DATE_PATTERN,(null!=e.macroName||e.alertSize>0||e.updateFieldSize>0||responseJSONtaskSize>0)&&(e.iseditmacro="true"),e.updateFieldWidth="507px";for(var t=0;t<e.updateFieldSize;t++){var r=e.updateField[t],i=r.Info.uiType;if("24"==i){if(r.Info.fieldValue.indexOf("${EXECUTION_DAY}")>-1){var a=[];r.Info.fieldValue.indexOf("+")>-1?(a.push("${EXECUTION_DAY}","plus"),a.push(r.Info.fieldValue.replace("${EXECUTION_DAY}+",""),"false")):(a.push("${EXECUTION_DAY}","minus"),a.push(r.Info.fieldValue.replace("${EXECUTION_DAY}-",""),"false")),e.updateField[t].Info.fieldValue=a}}else if("786"==i||"333"==i)if(r.Info.fieldValue.indexOf("${EXECUTION_TIME}")>-1){a=[];r.Info.fieldValue.indexOf("+")>-1?(a.push("${EXECUTION_TIME}","plus"),r.Info.fieldValue.indexOf("h")>-1?a.push(r.Info.fieldValue.replace("${EXECUTION_TIME}+","").replace("h",""),"true"):a.push(r.Info.fieldValue.replace("${EXECUTION_TIME}+",""),"false")):(a.push("${EXECUTION_TIME}","minus"),r.Info.fieldValue.indexOf("h")>-1?a.push(r.Info.fieldValue.replace("${EXECUTION_TIME}-","").replace("h",""),"true"):a.push(r.Info.fieldValue.replace("${EXECUTION_TIME}-",""),"false")),e.updateField[t].Info.fieldValue=a}else{e.updateFieldWidth="574px";var s=e.updateField[t].Info.fieldValue,o=s.split(":")[0],n=o.lastIndexOf(" "),l=o.substring(0,n);o=l;n=l.indexOf(o);var c=o;c=s.replace(c,""),o=o.split(" ").join("$"),c=s.replace(l,o),e.updateField[t].Info.fieldValue=c;var d=e.updateField[t].Info.fieldValue.split(" ");(d=Macro.convertTimeField(d))[0]=l,e.updateField[t].Info.fieldValue=d}else"32"!==i&&"38"!==i&&"52"!==i&&"117"!==i||(e.updateField[t].Info.fieldValue=Search.reverseFormatNumber(e.updateField[t].Info.fieldValue))}for(t=0;t<e.taskSize;t++){a=e.Task[t].Info.others.split(" ");if(e.Task[t].Info.relatedRecords=a[0],null!=e.Task[t].Info.macroName&&""!=e.Task[t].Info.macroName){var u={},m=e.Task[t].Info.macroName.split("|");u.remindOption=m[0],m[1].indexOf("AM")>-1||m[1].indexOf("PM")>-1?(u.remindTimeFormat="h12",u.remindTime=m[1].split(" ")[0],u.remindTimePeriod=m[1].split(" ")[1]):(u.remindTimeFormat="h24",u.remindTime=m[1]),u.selectedAlertMethod=m[2],e.Task[t].Info.notifyOwnerUpdate=JSON.stringify(u)}}null!=e.macroShare&&(e.macroShareLength=Object.keys(e.macroShare).length,e.macroKey=Object.keys(e.macroShare)[0],e.selectedValuesLength=null!=e.selectedValues?Object.keys(e.selectedValues).length:0,e.allowedUsers=null!=e.macroShare.allowedUsers?e.macroShare.allowedUsers:0,e.isSharedMacro=e.macroShare.isShared,e.macroCount=null!=e.macroShare.count?Object.keys(e.macroShare.count).length:0,e.selectedSources=e.macroShare.count,Macro.sharedData=e.macroShare.selectedItems,Macro.selectedAccessObj=e.macroShare.sharedData)}},renderTemplate:function(e){return this.error?{outlet:"#show",html:e}:"PermissionDenied"==e||1==e.isPermissionDenied?renderingUtils.displayPermissionDenied():"MacroDeleted"==e?{outlet:"#show",html:Handlebars.templates.MacroDeleted()}:{outlet:"#show",html:Handlebars.templates.MacroCE(e)}},afterRender:function(e){Macro.doAlertInit(),Macro.doFldUptInit(!0),Macro.bindPerfectScroll(),Macro.appendDependencyFieldsInfoOnEdit(e)}}),Lyte.Router.registerRoute("crm.settings.section.macro.index",{queryParams:["module"],beforeModel:function(){this.error=!1},model:function(e){var t={params:{step:"macroShowAllRules",cvid:crmListView.getObject().cvId,module:e.queryParams.module}};return Crm.isPageLoad&&(t.headers={"is-Page-Load":"true"},Crm.isPageLoad=!1),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Macro.do","POST",t)},afterModel:function(e){"string"!=typeof e?(e.MacroListMapLength=Object.keys(e.MacroListMap).length,e.sharedMacroListMapLength=Object.keys(e.sharedMacroListMap).length):this.error=!0},renderTemplate:function(e){return this.error?{outlet:"#show",html:e}:{outlet:"#show",html:Handlebars.templates.MacroList(e)}}}),Lyte.Router.registerRoute("crm.settings.section.macro.view",{queryParams:["module"],beforeModel:function(e){this.error=!1},model:function(e){var t={params:{step:"viewMacro",cvid:crmListView.getObject().cvId,module:e.queryParams.module,ruleId:e.dynamicParam}};return Crm.isPageLoad&&(t.headers={"is-Page-Load":"true"},Crm.isPageLoad=!1),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Macro.do","POST",t)},afterModel:function(e){if("string"!=typeof e){e.alertSize=null!=e.Alert?Object.keys(e.Alert).length:0,e.taskSize=null!=e.Task?Object.keys(e.Task).length:0,e.updateFieldSize=null!=e.updateField?Object.keys(e.updateField).length:0;for(var t=0;t<e.updateFieldSize;t++){var r=e.updateField[t];if(24==r.Info.uiType){if(r.Info.fieldValue.indexOf("${EXECUTION_DAY}")>-1)if(r.Info.fieldValue.indexOf("+")>-1){var i=r.Info.fieldValue.replace("${EXECUTION_DAY}+","");e.updateField[t].Info.fieldValue="0"==i?I18n.getMsg("crm.macro.label.runDate"):"1"==i?I18n.getMsg("crm.macro.label.daysAfterRunDate.singular"):I18n.getMsg("crm.macro.label.daysAfterRunDate.plural",i)}else{i=r.Info.fieldValue.replace("${EXECUTION_DAY}-","");e.updateField[t].Info.fieldValue="0"==i?I18n.getMsg("crm.macro.label.runDate"):"1"==i?I18n.getMsg("crm.macro.label.daysBeforeRunDate.singular"):I18n.getMsg("crm.macro.label.daysBeforeRunDate.plural",i)}}else if(786==r.Info.uiType){var a=r.Info.fieldValue;if(r.Info.fieldValue.indexOf("${EXECUTION_TIME}")>-1)if(r.Info.fieldValue.indexOf("+")>-1)a="0"==(i=r.Info.fieldValue.replace("${EXECUTION_TIME}+",""))?I18n.getMsg("crm.macro.label.runDate"):"1"==i?r.Info.fieldValue.indexOf("h")>-1?I18n.getMsg("crm.macro.label.hoursAfterRunDate.singular"):I18n.getMsg("crm.macro.label.daysAfterRunDate.singular"):r.Info.fieldValue.indexOf("h")>-1?I18n.getMsg("crm.macro.label.hoursAfterRunDate.plural",i.replace("h","")):I18n.getMsg("crm.macro.label.daysAfterRunDate.plural",i);else a="0"==(i=r.Info.fieldValue.replace("${EXECUTION_TIME}-","")).replace("h","")?I18n.getMsg("crm.macro.label.runDate"):"1"==i?r.Info.fieldValue.indexOf("h")>-1?I18n.getMsg("crm.macro.label.hoursBeforeRunDate.singular"):I18n.getMsg("crm.macro.label.daysBeforeRunDate.singular"):r.Info.fieldValue.indexOf("h")>-1?I18n.getMsg("crm.macro.label.hoursBeforeRunDate.plural",i.replace("h","")):I18n.getMsg("crm.macro.label.daysBeforeRunDate.plural",i);e.updateField[t].Info.fieldValue=a}else if((r.Info.uiType==CrmField.UITYPES.LAYOUT||r.Info.uiType==CrmField.UITYPES.PICK_LIST||r.Info.uiType==CrmField.UITYPES.STAGE)&&r.Info.relatedFieldsList&&r.Info.relatedFieldsList.length>0){var s=r.Info.relatedFieldsList;r[14]=void 0;for(var o=s.length,n=r.fldColVsName?r.fldColVsName:{},l=n.STAGE?n.STAGE:"Stage",c=n.PIPELINE?n.PIPELINE:"Pipeline",d=0;d<o;d++)s[d].hasOwnProperty(l)&&(r.Info.Stage=s[d][l],s[d].hasOwnProperty("colorCode")&&(r.Info.colorCode=s[d].colorCode)),s[d].hasOwnProperty(c)&&(r.Info.Pipeline=s[d][c]);0==o&&(r.Info.relatedFieldsList=void 0)}}null!=e.macroShare&&(e.macroShareLength=Object.keys(e.macroShare).length,e.macroKey=Object.keys(e.macroShare)[0],e.selectedValuesLength=null!=e.selectedValues?Object.keys(e.selectedValues).length:0,e.allowedUsers=null!=e.macroShare.allowedUsers?e.macroShare.allowedUsers:0,e.macroCount=null!=e.macroShare.count?Object.keys(e.macroShare.count).length:0,e.selectedSources=e.macroShare.count)}},renderTemplate:function(e){return this.error?{outlet:"#show",html:e}:"PermissionDenied"==e?renderingUtils.displayPermissionDenied():"MacroDeleted"==e?{outlet:"#show",html:Handlebars.templates.MacroDeleted()}:{outlet:"#show",html:Handlebars.templates.MacroView(e)}},afterRender:function(){template.titleForEllipsis(".ellipsistext")}}),Lyte.Router.registerRoute("crm.settings.section.manage-mass-mail.create-mass-mail",{queryParams:["module"],getDependencies:function(){return networkUtils.returnDependencyFiles(["zohocrm_massmail_unification.js"])},beforeModel:function(e){Crm.userDetails.isStorageLimitReached&&(Crm.showStorageExceedPopup("mailAlert"),this.transition.abort()),$("#mainResult").hide()},model:function(e){return MassMailUnificationUtil.redirectURL(e.queryParams,"CreateMassMail")}}),Lyte.Router.registerRoute("crm.settings.section.manage-mass-mail.edit-mass-mail",{queryParams:["massmailStage","module","massmailId","massmailType"],getDependencies:function(){return networkUtils.returnDependencyFiles(["zohocrm_massmail_unification.js"])},beforeModel:function(e){$("#mainResult").hide()},model:function(e){var t=this.transition.info.queryParams;return t.massmailStage=t.massmailStage.toString(),MassMailUnificationUtil.redirectURL(t,"EditMassMail")}}),Lyte.Router.registerRoute("crm.settings.section.manage-mass-mail.index-mass-mail",{queryParams:["module","stage"],getDependencies:function(){return networkUtils.returnDependencyFiles(["zohocrm_massmail_unification.js"])},beforeModel:function(e){$("#mainResult").hide()},model:function(e){var t=this.transition.info.queryParams;return t.stage||(t.stage="scheduled"),MassMailManager.isScheduledMassMailAvailable()||(t.stage="sent"),MassMailUnificationUtil.redirectURL(t,"ManageMassMail")}}),Lyte.Router.registerRoute("crm.settings.section.manage-mass-mail.view-mass-mail",{queryParams:["module","massmailId","massmailStage","mailType","massmailType","massmailConfigId","flwuporder"],dynamicParams:["massmailId"],getDependencies:function(){return networkUtils.returnDependencyFiles(["zohocrm_massmail_unification.js"])},beforeModel:function(e){$("#mainResult").hide()},model:function(e){var t=this.transition.info.queryParams;return"primaryEmail"==t.mailType&&(t.massmailId=this.getDynamicParam()),t.massmailStage=t.massmailStage.toString(),MassMailUnificationUtil.redirectURL(t,"ViewMassMail")}}),Lyte.Router.registerRoute("crm.settings.section.messages.channels",{model:function(){var e={permissionReqs:store.triggerAction("imservice","getFBManagerDetails",{service:"TWILIO"},{},"GET"),credits:store.triggerAction("imservice","credits",{service:"TWILIO"},{},"GET")};return Lyte.resolvePromises(e).then((function(e){return e}))},afterModel:function(e){if(e&&e.credits){var t=e.credits.message_services[0];t&&(this.currentModel.subscription=t.subscription,this.currentModel.autorenewalMessage=t.subscription&&t.subscription.auto_renewal_enabled,this.currentModel.pricing=t.pricing)}if(e&&e.permissionReqs){var r=e.permissionReqs.fb_manager_associations,i=[];r.forEach((function(e){"requested"===e.status&&i.push(e)})),this.currentModel.permissionRequests=i}},renderTemplate:function(){return $("#im_channels_tab").html(""),$L("#im_setup_tabs")[0].openTab("im_channels_tab"),{outlet:"#im_channels_tab",component:"crm-msg-channel"}}}),Lyte.Router.registerRoute("crm.settings.section.messages",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-msg-setup-store.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-msg-utils.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-msg-setup.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles(["crm-msg-setup.css"],crmConstants.cssStaticPathForLyte);Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-msg-rtl.css"],crmConstants.cssStaticPathForLyte)));var i=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("bmmessagessetup")],null),a=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("bmwhatsappsetup")],null);return e.concat(t).concat(r).concat(i).concat(a)},model:function(){var e={imservices:store.findAll("imservice"),imchannels:store.findAll("imchannel")};return Lyte.resolvePromises(e).then((function(e){return e}))},afterModel:function(e){if(this.currentModel={},e.imchannels&&e.imchannels.length>0){switch(e.imchannels[0].status){case"new_fb_requested":case"existing_fb_requested":case"existing_fb_rejected":case"fb_approved":case"number_requested":case"number_associated":this.currentModel.showCreate=!0;break;case"manually_created":this.currentModel.showCreate=!0,this.currentModel.manualCreation=!0}this.currentModel.isChannelsAvailable=!0,this.currentModel.selectedService="TWILIO"}},renderTemplate:function(){return{outlet:"#result",component:"crm-msg-setup"}},afterRender:function(e){!e.showCreate&&e.isChannelsAvailable?this.transitionTo("crm.settings.section.messages.channels"):this.transitionTo("crm.settings.section.messages.services")},actions:{didTransition:function(){"crm.settings.section.messages"===this.transition.target&&this.refresh()}}}),Lyte.Router.registerRoute("crm.settings.section.messages.services",{afterModel:function(){$L("#im_setup_tabs")[0].openTab("im_services_tab")}}),Lyte.Router.registerRoute("crm.settings.section.orchestration.edit-orchestration",{getResources:function(){var e=[{parent:networkUtils.returnDependencyFiles(["zohocrm_jsplumb.js"]),child:[networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-builder.js","setup/orchestration/crm-orchestration-details.js","setup/orchestration/crm-orchestration-abm-common.js","orchestration_config.js","orchestration_common.js","automation/common/crm-mergefield-multilevel.js","setup/crm-actions-readmode-model.js","crux-tag.js"],crmConstants.jsStaticPathForLyte)]}].concat(networkUtils.returnDependencyFiles(["zohocrm_orchestration.js"]));e=e.concat(networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-builder.css","automation/common/crm-mergefield-multilevel.css"],crmConstants.cssStaticPathForLyte));var t=fetchAutomationFunctionFiles();return e=e.concat(t),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-rtl.css"],crmConstants.cssStaticPathForLyte))),e},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Workflow||(renderingUtils.displayPermissionDenied(),this.transition.abort())},model:function(e){return Lyte.resolvePromises({modules:store.peekAll("orchestration_meta").length?store.peekAll("orchestration_meta")[0].supported_state_modules:store.findAll("orchestration_meta").then((function(){return store.peekAll("orchestration_meta")[0].supported_state_modules})),orchestrationMeta:store.peekAll("orchestration_meta").length?store.peekAll("orchestration_meta")[0]:store.findAll("orchestration_meta"),orchestration_list:this.getCachedOrchestrationList().length?this.getCachedOrchestrationList():store.findAll("orchestration_process"),process:store.findRecord("orchestration_process",e.dynamicParam),approval_process_list:store.peekAll("approval_process_list").length?store.peekAll("approval_process_list")[0]:store.findAll("approval_process_list"),webform_list:store.peekAll("webform").length?store.peekAll("webform")[0]:store.findAll("webform",{feature_name:"Orchestration"})})},afterModel:function(e){var t=this.getGroupedOrchestration(e.orchestration_list);e.orchestrationVersions=t[e.process[0].group_id];var r=e.process[0];r.$.set("cliqEnabled",e.orchestrationMeta.cliq_integration),r.$.set("slackEnabled",e.orchestrationMeta.slack_integration),r.$.set("unsupportedActions",e.orchestrationMeta.unsupported_actions);var i="draft"===r.status||"temp"===r.status;r.$.set("isEditable",i),r.$.set("autoSaveStatusText",""),r.states&&r.states.length?(r.$.set("isFirstStateAdded",!0),r.$.set("showRightPanel",!0)):(r.$.set("isFirstStateAdded",!1),r.$.set("showRightPanel",!1)),Lyte.registeredMixins.salesiq_chat.popoverCloseClicked||(Lyte.registeredMixins.salesiq_chat.popoverCloseClicked=store.peekRecord("orchestration_meta","1").enabled_redis_keys.cc_widget_chat_close_clicked||!1),store.findAll("layout",{module:moduleRecordMapping.Campaigns.api_name},!0),this.currentModel={data:e};for(var a=r.transitions,s=a.length,o=this,n=0;n<s;n++){var l=a[n];if(l&&l.triggers&&2===l.triggers.length&&("auto_segment"===l.triggers[0].type||"manual_segment"===l.triggers[0].type)){var c=l.triggers[0].details;return r.$.set("segment",c.segment),o.currentModel.segment=c.segment,Lyte.resolvePromises({account_module:store.findAll("abm_module",{account:"include_inner_details=name.display_label"},!0,!0,{module:"account"}),contact_module:store.findAll("abm_module",void 0,void 0,void 0,{module:"contact"}),deal_module:store.findAll("abm_module",void 0,void 0,void 0,{module:"deal"}),product_module:store.findAll("abm_module",void 0,void 0,void 0,{module:"product"}),label_fields:store.findAll("field",{module:"ABM_Account__s",type:"all"},!0,!0,{apiVersion:"2.2"}),segment:store.findAll("segment")}).then((function(t){var r,i=[],a=[];i[0]=t.account_module,i[1]=t.contact_module,i[2]=t.deal_module,i[3]=t.product_module;for(var s=0;s<4;s++)(r={}).plural_label=i[s].name,r.api_name=i[s].name,r.id=i[s].id,a.push(r);var n=e.modules;n&&n.forEach((function(e){"Tasks"!==e.api_name&&"Calls"!==e.api_name||a.push(e)})),e.modules=a,o.currentModel.modulesForAbm=a,t.label_fields.forEach((function(e){"RFM_Label__s"===e.api_name?o.currentModel.rfm_fields=e.pick_list_values:"Firmographic_Label__s"===e.api_name&&(o.currentModel.firmographic_fields=e.pick_list_values)})),o.currentModel.segmentArray=t.segment;var l=[];t.segment.forEach((function(e){"dynamic"===e.type&&l.push(e)})),o.currentModel.segmentList=l}))}}},renderTemplate:function(){return customFunctionsObj.isFrom="automation",$L(".setupleftmenutd , #setupInnerLinks, #mainMenuTabDiv").hide(),$(".new_setupview").addClass("newSetupRightShow"),{outlet:"#result",component:"crm-orchestration-builder"}},afterRender:function(e){var t=isChatEnabled?28:0,r=$L("#setup_new_ContentDiv"),i=renderingUtils.windowHeight-(r.offset().top+t),a=(e.data.process[0],Lyte.registeredMixins.orchestration_config);wfmergefield.initMergeFieldDetl("Orchestration"),e.data.orchestrationMeta.enabled_trial_features.COMMANDCENTER_INTEG_TRIGGERS||(a.limits.triggers.per_transition=1),e.data.orchestrationMeta.enabled_trial_features.SALES_SIGNALS_CUSTOM_MODULE_SUPPORT&&(a.triggers.defaultTriggers[16].regexForSupportedModules=Lyte.registeredMixins.orchestration.constants.supportedModulesRegex.LeadsContactsCustom),automationActions.isBusinessHourAvailable=store.peekAll("orchestration_meta")[0].business_hours_enabled,setTimeout((function(){r.css({height:i+"px"})}),800)},beforeExit:function(e){var t=Lyte.registeredMixins.orchestration_builder;store.unloadAll("orchestration_state"),store.unloadAll("orchestration_transition"),wfmergefield.clearMergeFieldDetl(),t.resetBuilderInstance(),store.clearCachedQuery("layout",{module:moduleRecordMapping.Campaigns.api_name}),store.unloadAll("orchestration_process")},actions:{onError:function(e){return this.routeErrorHandling(e),!1}}},{mixins:["orchestration"]}),Lyte.Router.registerRoute("crm.settings.section.orchestration.index-orchestration",{queryParams:["segment"],getResources:function(){var e=networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-details.js","setup/orchestration/crm-orchestration-abm-common.js","orchestration_common.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-details.css"],crmConstants.cssStaticPathForLyte))},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Workflow||(renderingUtils.displayPermissionDenied(),this.transition.abort()),store.unloadAll("orchestration_process")},model:function(e){return Lyte.resolvePromises({orchestrations:store.findAll("orchestration_process"),orchestrationMeta:store.peekAll("orchestration_meta").length?store.peekAll("orchestration_meta"):store.findAll("orchestration_meta"),approval_process_list:store.findAll("approval_process_list"),webform_list:store.findAll("webform",{feature_name:"Orchestration"}),module:store.findAll("module"),segment:e.queryParams.isAbm})},afterModel:function(e){var t=this.getGroupedOrchestration(e.orchestrations);e.orchestrationList=this.getDisplayableOrchestrationsList(t),e.isSandbox=Crm.userDetails.isSandbox,e.orchestrationList.forEach((function(e){var r=t[e.group_id].length;e.$.set("versionCount",r),e.statusDominatingProcess.$.set("versionList",t[e.group_id])})),Lyte.registeredMixins.salesiq_chat.popoverCloseClicked||(Lyte.registeredMixins.salesiq_chat.popoverCloseClicked=store.peekRecord("orchestration_meta","1").enabled_redis_keys.cc_widget_chat_close_clicked||!1),e.maxCountOfProcess=this.getOrchestrationsCountForLicense()},renderTemplate:function(){return{outlet:"#result",component:"crm-orchestration-details"}},afterRender:function(){this.transition.data.invalidProcess&&$L("#processNotExistAlert").e.ltProp("show",!0)},actions:{didTransition:function(){$L("#mainMenuTabDiv").show(),$("#mainMenuTabDiv crm-tab")[0].component.resizeMenu()},onError:function(e){return this.routeErrorHandling(e),!1}}},{mixins:["orchestration"]}),Lyte.Router.registerRoute("crm.settings.section.orchestration.orchestration-reports",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_analytics.js"],crmConstants.jsStaticPath),t=[{parent:networkUtils.returnDependencyFiles(["zohocrm_jsplumb.js"]),child:[networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-reports.js","setup/orchestration/crm-orchestration-abm-common.js","orchestration_common.js"],crmConstants.jsStaticPathForLyte)]}].concat(e);return t=t.concat(networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-reports.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["setup/orchestration/crm-orchestration-rtl.css"],crmConstants.cssStaticPathForLyte))),t=t.concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles()))},model:function(e){return Lyte.resolvePromises({processId:e.dynamicParam,orchestration_list:this.getCachedOrchestrationList().length?this.getCachedOrchestrationList():store.findAll("orchestration_process"),dashboard_details:store.findAll("Analytics",{feature_type:"Orchestration"})})},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Workflow?commonUtils.showHideLoadingDiv(!0):(renderingUtils.displayPermissionDenied(),this.transition.abort())},afterModel:function(e){var t=this.getGroupedOrchestration(e.orchestration_list),r=store.peekRecord("orchestration_process",e.processId);e.orchestrationVersions=r?t[r.group_id].filter((function(e){return"draft"!==e.status})):[],this.currentModel={data:e},commonUtils.showHideLoadingDiv(!1)},renderTemplate:function(){return networkUtils.initChart(),{outlet:"#result",component:"crm-orchestration-reports"}},afterRender:function(){var e=isChatEnabled?28:0,t=$L("#setup_new_ContentDiv"),r=renderingUtils.windowHeight-(t.offset().top+e);$L(".setupleftmenutd , #setupInnerLinks").hide(),$(".new_setupview").addClass("newSetupRightShow reviewprocessDiv"),t.addClass("oHImp"),setTimeout((function(){t.css({height:r+"px"})}),800)},beforeExit:function(){$L("#setup_new_ContentDiv").removeClass("oHImp"),$(".new_setupview").removeClass("reviewprocessDiv"),store.unloadAll("orchestration_process"),store.unloadAll("orchestration_state"),store.unloadAll("orchestration_transition")},actions:{onError:function(e){return commonUtils.showHideLoadingDiv(),this.routeErrorHandling(e),!1}}},{mixins:["orchestration"]}),Lyte.Router.registerRoute("crm.settings.section.profiles.index-profiles",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-profile-list.js","crm-profile-action.js"],crmConstants.jsStaticPathForLyte);e=(e=Crm.userDetails.RTL_ENABLED?e.concat(networkUtils.returnDependencyFiles(["crm-profile-list.css","crm-profile-list-rtl.css"],crmConstants.cssStaticPathForLyte)):e.concat(networkUtils.returnDependencyFiles(["crm-profile-list.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("profiles")],crmConstants.jsStaticPath));var t=networkUtils.getI18nJSUrl("InventoryModulePerm");return e.push(networkUtils.returnDependencyFiles([t],null)),e},model:function(e){return{profiles:store.findAll("profile",{include_lite_profile:"true"})}},renderTemplate:function(e,t){return this.currentModel.profileLimit=e.profiles.$.meta.license_limit,{outlet:"#result",component:"crm-profile-list"}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.profiles.list"),Crm.appName])),$("#setup_new_ContentDiv").addClass("helpOverflowHide")},actions:{willTransition:function(){$("#setup_new_ContentDiv").removeClass("helpOverflowHide")}}}),Lyte.Router.registerRoute("crm.settings.section.profiles.view-profile",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-profile-view.js","crm-profile-action.js","crm-permission-dropdown.js","crm-help-link.js","lyte-scrollspy.js","lyte-scrollTo.js","lyte-hovercard.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("profilepage")],crmConstants.jsStaticPath)),e=(e=Crm.userDetails.RTL_ENABLED?e.concat(networkUtils.returnDependencyFiles(["crm-profile-list.css","crm-profile-view.css","crm-permission-dropdown.css","crm-profile-view-rtl.css"],crmConstants.cssStaticPathForLyte)):e.concat(networkUtils.returnDependencyFiles(["crm-profile-list.css","crm-profile-view.css","crm-permission-dropdown.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("InventoryModulePerm")],crmConstants.jsStaticPath))},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-profile-mixin.js"],crmConstants.jsStaticPathForLyte)},beforeModel:function(){this.transition.data.reloadAll&&(this.refresh({refreshTemplate:!0}).data={})},model:function(e){var t=this.getDynamicParam(),r=store.peekRecord("profile",t);return r&&r.permissions_details&&delete r.permissions_details,{profileDetails:store.findRecord("profile",t)}},afterModel:function(e){Object.keys(e.profileDetails).length&&this.setPermission(e)},renderTemplate:function(e){if(e.isSystemDefProfile=!e.profileDetails.custom,"lite_profile"===e.profileDetails.type&&(e.isLightProfile=!0),!Object.keys(e.profileDetails).length)return{outlet:"#result",html:'<div class="pT30" style=" margin-top: 200px; "><div class="crm-error-page pR pL30" style="width: 50%;"><span class="crm-error-page-icon p0"></span> <h2 style="color:#DD4B39; font-size: 26px;" class="mL15">'+I18n.getMsg("crm.profile.error.unavailable")+'</h2><div class="mt5 f14 mL15 lineHgt20"></div></div></div>'};for(var t in e.sections)this.checkFieldEnable(e.sections[t],e.sections);return e.allSection=this.sortOrderPermission(e),{outlet:"#result",component:"crm-profile-view"}},afterRender:function(){this.component&&(this.component.component.checkSetupDevPermission({},void 0,"setupPermissionStatus"),this.component.component.checkSetupDevPermission({},void 0,"devPermissionStatus"),this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.security.profile.details"),Crm.partnerName])),this.viewProfileOnLoad(),$(window).on("beforeunload",(function(){var e=$L("crm-profile-view")[0];if(e&&e.getData("profileDetails")&&e.getData("profileDetails").$&&e.getData("profileDetails").$.isDirty())return"show alert"})))},beforeExit:function(){for(var e in moduleRecordMapping)delete moduleRecordMapping[e].actions},viewProfileOnLoad:function(){var e=$L("#setup_new_ContentDiv"),t=$L(".newTopbar"),r=$L(".profViewTopArea"),i=$L(".setupleftmenutd"),a=$L(".profViewContent"),s=$L(".profViewLeftPane"),o=$L(".leftPaneLyteScrollWrapper"),n=r.outerHeight()+t.outerHeight(),l=renderingUtils.windowHeight-(n+28),c="left",d=Crm.userDetails.RTL_ENABLED;d&&(c="right"),$("#setupInnerLinks").hide(),e.removeClass("oA"),s.css({height:l+"px",top:n+"px"}),d?s.css("right",0):s.css("left",0),r.css(c,"0"),setTimeout((function(){i.hide(),$(".new_setupview").addClass("newSetupRightShow reviewprocessDiv"),s.removeClass("profViewLeftPaneBeforeAnim").css({top:"",height:""}),d?s.css("right",""):s.css("left",""),r.removeClass("profViewTopPaneBeforeAnim").css(c,""),a.removeClass("profViewContentBeforeAnim"),o.scroll()}),300)},sortOrderPermission:function(e){var t=e.headerOrder,r=e.sections,i=e.sectionOrder,a={module_permissions:0,setup_permissions:1,extension_permission:2,developers_permission:3};for(var s in t){for(var o=[],n=0;t[s][n];n++){var l=t[s][n];r[l].sequence_number=n;for(var c=0;i[l][c];c++){var d=i[l][c];r[l].sub_categories[d].sequence_number=c}o.push(r[l])}e.header[a[s]].categories=o}var u=[];for(n=0;e.header[n];n++)u=u.concat(e.header[n].categories);return u}},{mixins:["crm-profile-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.review-process.create-review-process",{queryParams:["layout_id"],getResources:function(){var e,t=networkUtils.returnDependencyFiles(["crm-reviewprocess.js","business_hours-model.js"],crmConstants.jsStaticPathForLyte);return e=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-reviewprocess-rtl.css","crm-approval-myjobs.css","crm-reviewprocess-style-wrapper.css","crm-review-logs.css"],crmConstants.cssStaticPathForLyte):networkUtils.returnDependencyFiles(["crm-reviewprocess-customfunction.css","function-common.css","custom-function-editor.css","crm-reviewprocess-style-wrapper.css","crm-review-logs.css"],crmConstants.cssStaticPathForLyte),t.concat(e).concat(networkUtils.returnDependencyFiles(["zohocrm_reviewprocess.js"])).concat(networkUtils.returnDependencyFiles(["custom-function-model.js","crm-function-components-wrapper.js","crm-functions-helper.js"],crmConstants.jsStaticPathForLyte)).concat(networkUtils.returnDependencyFiles(["crm-reviewprocess-customfunction.css","function-common.css"],crmConstants.cssStaticPathForLyte)).concat(fetchAutomationFunctionFiles())},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-reviewprocess-models.js"],crmConstants.jsStaticPathForLyte)},model:function(){var e=this.transition.data;return e&&e.moduleDetails?{}:Lyte.resolvePromises({moduleList:this.getModules()})},afterModel:function(e,t){var r=this.transition.data,i=this,a=e.moduleList?e.moduleList:r.moduleDetails;return Lyte.resolvePromises({moduleList:a,moduleName:t.dynamicParam,layoutId:t.queryParams.layout_id,criteriaFields:i.getCriteriaFields(t.dynamicParam,t.queryParams.layout_id),layoutDetails:r.layoutDetails?r.layoutDetails:this.getLayoutDetails(t.dynamicParam,a),prevListModule:r.prevListModule,prevListLayout:r.prevListLayout}).then((function(e){return e.errorCode=i.currentModel.errorCode,i.currentModel=e,e.layoutDetails&&e.layoutDetails instanceof Record&&(i.currentModel.layoutId=void 0),i.currentModel}))},renderTemplate:function(e,t){var r=store.createRecord("reviewprocess",{});return r.layout={id:e.layoutId},this.currentModel.record=r,$L("#setupInnerLinks").hide(),{outlet:"#result",component:"crm-reviewprocess-create"}},beforeExit:function(e){e.record&&store.unloadRecord("reviewprocess",e.record.id)},getLayoutDetails:function(e,t){if(e){var r=this;return store.findAll("layout",{module:e,skip_permission:!0}).then((function(e){return e=r.returnValidLayouts(e)})).catch((function(e){var r=JSON.parse(e.responseText);if("NO_PERMISSION"===r.code||"PERMISSION_DENIED"===r.code||"INVALID_MODULE"===r.code)return renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),t[0];renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("error.database.problem"))}))}return this.getModules(!0)},actions:{onError:function(e,t,r,i){Lyte.Component.render("crm-reviewprocess-create",{moduleName:""},"#setup_new_ContentDiv"),$("#result").hide()}}},{mixins:["reviewprocess"]}),Lyte.Router.registerRoute("crm.settings.section.review-process.edit-review-process",{getResources:function(){var e,t=networkUtils.returnDependencyFiles(["crm-reviewprocess.js","business_hours-model.js"],crmConstants.jsStaticPathForLyte);return e=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-reviewprocess-rtl.css","crm-approval-myjobs.css","crm-reviewprocess-style-wrapper.css","crm-review-logs.css"],crmConstants.cssStaticPathForLyte):networkUtils.returnDependencyFiles(["crm-reviewprocess-customfunction.css","function-common.css","custom-function-editor.css","crm-reviewprocess-style-wrapper.css","crm-review-logs.css"],crmConstants.cssStaticPathForLyte),t.concat(e).concat(networkUtils.returnDependencyFiles(["zohocrm_reviewprocess.js"])).concat(networkUtils.returnDependencyFiles(["custom-function-model.js","crm-function-components-wrapper.js","crm-functions-helper.js"],crmConstants.jsStaticPathForLyte)).concat(networkUtils.returnDependencyFiles(["crm-reviewprocess-customfunction.css","function-common.css"],crmConstants.cssStaticPathForLyte)).concat(fetchAutomationFunctionFiles())},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-reviewprocess-models.js"],crmConstants.jsStaticPathForLyte)},model:function(e){return commonUtils.showHideLoadingDiv(!0),{processRecord:this.getProcess(e),rpId:e.dynamicParam}},afterModel:function(e,t){var r=this,i=this.transition.data;return Lyte.resolvePromises({rpId:t.dynamicParam,processRecord:e.processRecord,criteriaFields:this.getCriteriaFields(e.processRecord.module.api_name,e.processRecord.layout.id),fieldsData:this.getFieldsData(e.processRecord),prevListModule:i.prevListModule,prevListLayout:i.prevListLayout}).then((function(e){return r.currentModel=e,r.currentModel}))},renderTemplate:function(e,t){for(var r=e.processRecord,i=store.peekAll("module"),a=i.length,s=0;s<a;s++)if(i[s].api_name===r.module.api_name){this.currentModel.moduleLabel=i[s].plural_label,this.currentModel.tabName=i[s].module_name;break}this.currentModel.functionsEnabled=Crm.userDetails.isRpCustomFunctionEnabled;var o=r.actions,n=r.layout.fields;this.currentModel.layoutId=r.layout.id;var l=n.length,c=[],d=[],u={};for(s=0;s<l;s++){var m=n[s];c.push(m.field_label),d.push(m.api_name),u[m.field_label]=m.api_name}var p=[],g=r.reason_for_rejection,f=g.length;for(s=0;s<f;s++)p.push(g[s].value);if(this.currentModel.rejectionReasons=p,this.currentModel.selectedFieldObj=d,o.sla&&o.sla.period&&o.sla.unit){if(this.currentModel.rpSlaAction=!0,o.sla.escalate_to)var h=this.getSelectedReviewers(o.sla.escalate_to);"BusinessDays"!==o.sla.period&&"BusinessHours"!==o.sla.period||(this.currentModel.isBusinessRuleApplicable=!0),this.currentModel.selectedReviewersMain=h||[];var y=this.getRpViewComponents(h);this.currentModel.renderReviewerDtlsMain=y}else r.actions.sla={};this.currentModel.setCriteria=r.criteria,o.notify_on.submission||o.notify_on.approval||o.notify_on.rejection||o.sla.period?(o.notify_on.submission=1==o.notify_on.submission,o.notify_on.approval=1==o.notify_on.approval,o.notify_on.rejection=1==o.notify_on.rejection):this.currentModel.rpNoActions=!0,this.currentModel.selectedFieldsVsApiName=u,this.currentModel.editConfig=!0,this.currentModel.moduleName=r.module.api_name,this.currentModel.layoutName=r.layout.name,this.currentModel.selectedFieldLabels=c,this.currentModel.prevRecrdFlds=c,this.currentModel.rules=r.rules;var v=Crm.userDetails.LICENSE_TYPE;return v="Z"===v&&Crm.userDetails.ULTIMATE_ADDON_COUNT>0?"U":v,this.currentModel.maxFldCnt=this.getLimits().fields[v],{outlet:"#result",component:"crm-reviewprocess-createconfig"}},getProcess:function(e){var t=e.dynamicParam,r=store.peekRecord("reviewprocess",t);if(!r||!r.actions){var i={};r&&(i.module=r.module.api_name),r=store.findRecord("reviewprocess",t,i).then((function(e){return e[0]}))}return r},afterRender:function(){$(".setupleftmenutd , #setupInnerLinks").hide(),$(".new_setupview").addClass("newSetupRightShow reviewprocessDiv"),setup_new_ContentDiv.addClass("oHImp"),commonUtils.showHideLoadingDiv(!1),0===Search.criteriaDtls.length&&(Search.criteriaDtls=this.currentModel.criteriaFields)},didDestroy:function(){$("#setup_new_ContentDiv").removeClass("oHImp")},beforeExit:function(e){},actions:{onError:function(e,t,r,i){Lyte.Component.render("crm-reviewprocess-processdeleted",{showComp:!0},"#setup_new_ContentDiv"),$("#result").hide()}}},{mixins:["reviewprocess"]}),Lyte.Router.registerRoute("crm.settings.section.review-process.index-review-process",{getResources:function(){return networkUtils.returnDependencyFiles(["crm-reviewprocess-view.js"],crmConstants.jsStaticPathForLyte)},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-reviewprocess-models.js"],crmConstants.jsStaticPathForLyte).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reviewprocess")]))},model:function(){return commonUtils.showHideLoadingDiv(!0),Lyte.resolvePromises({countObj:this.getRpRecordCount()})},afterModel:function(e){var t,r,i,a;if(this.transition.data&&Object.keys(this.transition.data).length>0){var s=this.transition.data;t=s.prevListModule?s.prevListModule:s.module,r=s.prevListLayout?s.prevListLayout:s.layout_id,t&&("undefined"==t?t=void 0:"All"!==t&&(i=this.getLayoutDetails(t),a=this.getModules()),r&&"undefined"==r&&(r=void 0))}var o,n=this,l={totalCount:e.countObj.total_count};return o=null!==t&&"All"!==t&&r&&"All"!==r?this.getRpDetails(t,r,l):null!==t&&"All"!==t?this.getRpDetails(t,void 0,l):this.getRpDetails(void 0,void 0,l),Lyte.resolvePromises({modules:a,layoutDetails:i,countObj:e.countObj,rplistView:o,actionCount:e.countObj.active_count,moduleName:t||"All",layoutId:r||"All",maxCountReached:this.isMaxCountReached(e.countObj.active_count)}).then((function(e){return n.currentModel=e,n.currentModel.totalRPs=l.totalCount,n.currentModel}))},renderTemplate:function(){return $(".setupleftmenutd , #setupInnerLinks").show(),$(".new_setupview").removeClass("newSetupRightShow reviewprocessDiv"),{outlet:"#result",component:"crm-reviewprocess-listview"}},afterRender:function(e){this.transition.data.visible&&!this.transition.data.visible&&$L(".rpdisable").addClass("disable"),0==e.countObj.total_count?$L("#setupInnerLinks").hide():$("#setupInnerLinks").show(),$L(".setupleftmenutd").css("display","table-cell"),$(".new_setupview").removeClass("newSetupRightShow reviewprocessDiv"),commonUtils.showHideLoadingDiv(!1)},getRpRecordCount:function(){return store.triggerAction("reviewprocess","count",void 0,void 0,"GET",!1).then((function(e){return e.review_process})).catch((function(e){var t=JSON.parse(e.responseText);"NO_PERMISSION"===t.code||"PERMISSION_DENIED"===t.code?renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")):renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("error.database.problem"))}))},isMaxCountReached:function(e){var t=Crm.userDetails.LICENSE_TYPE;return t="Z"===t&&Crm.userDetails.ULTIMATE_ADDON_COUNT>0?"U":t,e>=this.getLimits().process[t]},getRpDetails:function(e,t,r){store.unloadAll("reviewprocess");var i={};e&&"undefined"!=e&&(i.module=e),t&&"undefined"!=t&&(i.layout_id=t),r.totalCount>50&&(i.page=1,i.per_page=10);var a=this;return store.findAll("reviewprocess",i,!1).then((function(e){return a.setTotalCount(e,r),store.peekAll("reviewprocess")})).catch((function(e){var t=JSON.parse(e.responseText);"NO_PERMISSION"===t.code||"PERMISSION_DENIED"===t.code?renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")):renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("error.database.problem"))}))},setTotalCount:function(e,t){if(e&&e.length>0){var r=e.$.meta.total_count;r>0&&(t.totalCount=r)}}},{mixins:["reviewprocess"]}),Lyte.Router.registerRoute("crm.settings.section.roles.create-role",{queryParams:["reportsToId"],model:function(e){var t=this.getQueryParams().reportsToId,r=this;commonUtils.showHideLoadingDiv(!0);var i=[store.findAll("role",{reload:!0},!1),store.findAll("dummy",void 0,!1,!1,{url:"crm/v2.1/__features/roles",method:"GET"})],a=store.peekAll("module");if(moduleRecordMapping.Forecasts){var s=a?a.filterBy({api_name:moduleRecordMapping.Forecasts.api_name}):[],o=!!s.length&&(s[0].visible&&s[0].profiles.some((function(e){return Crm.userDetails.PROFILE_NAME===e.name})));i[2]=newForecastsEnabled&&o?store.findAll("forecast_configuration"):store.findAll("dummy",void 0,!1,!1,{url:Crm.getCrmBasePath()+"/Role.do?action=getForecastType",method:"GET"})}else i[2]=store.findAll("dummy",void 0,!1,!1,{url:Crm.getCrmBasePath()+"/Role.do?action=getForecastType",method:"GET"});return Lyte.resolvePromises(i).then((function(e){var r=e[0]&&e[0].length?e[0].length:0,i=e[1],a=i.__features[0].details&&i.__features[0].details.limits?i.__features[0].details.limits.total:void 0;if(commonUtils.showHideLoadingDiv(!1),r<a){var s=t?store.peekRecord("role",t):void 0;return{mode:"create",reportsToid:t,roleSelected:s,reportingChanged:s,accessible:t&&!s?"false":"true",currentEdition:Crm.userDetails.LICENSE_TYPE_ACTUAL_NAME_I18N}}return{mode:"create",accessible:"true",maxReached:a,currentEdition:Crm.userDetails.LICENSE_TYPE_ACTUAL_NAME_I18N}}),(function(e){return e&&401===e.status&&(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),r.transition.abort()),commonUtils.showHideLoadingDiv(!1),{mode:"create",accessible:"false"}}))},renderTemplate:function(e,t){return{outlet:"#result",component:"crm-roles-create"}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.new.role"),Crm.appName]))}}),Lyte.Router.registerRoute("crm.settings.section.roles.delete-role",{model:function(e){var t=this.getDynamicParam();commonUtils.showHideLoadingDiv(!0);var r=Crm.getCrmBasePath()+"/Role.do?action=getForecastType",i=this,a=[store.findRecord("role",t)],s=store.peekAll("module");if(moduleRecordMapping.Forecasts){var o=s?s.filterBy({api_name:moduleRecordMapping.Forecasts.api_name}):[],n=!!o.length&&(o[0].visible&&o[0].profiles.some((function(e){return Crm.userDetails.PROFILE_NAME===e.name})));a[1]=newForecastsEnabled&&n?store.findAll("forecast_configuration"):store.findAll("dummy",void 0,!1,!1,{url:r,method:"GET"})}else a[1]=store.findAll("dummy",void 0,!1,!1,{url:r,method:"GET"});return Lyte.resolvePromises(a).then((function(e){if(commonUtils.showHideLoadingDiv(!1),e&&e[0]){var r,i=e[0].length&&e[0][0]?e[0][0]:[];return r=newForecastsEnabled?!(!e[1].hierarchy||"Roles"!==e[1].hierarchy.api_name):!(!e[1]||1===Crm.userDetails.TMENABLED),{mode:"delete",roleId:t,roleObj:i,forecastEnabled:r,sharePeer:!1,roleName:i.display_label,accessible:"true"}}return{mode:"delete",roleId:t,accessible:"false"}}),(function(e){return e&&401===e.status&&(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),i.transition.abort()),commonUtils.showHideLoadingDiv(!1),{mode:"delete",roleId:t,accessible:"false"}}))},renderTemplate:function(e,t){return{outlet:"#result",component:"crm-roles-create"}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.role.delete"),Crm.appName]))}}),Lyte.Router.registerRoute("crm.settings.section.roles.edit-role",{model:function(){var e=this.getDynamicParam();commonUtils.showHideLoadingDiv(!0);var t=Crm.getCrmBasePath()+"/Role.do?action=getForecastType",r=this,i=[store.findRecord("role",e)],a=store.peekAll("module");if(moduleRecordMapping.Forecasts){var s=a?a.filterBy({api_name:moduleRecordMapping.Forecasts.api_name}):[],o=!!s.length&&(s[0].visible&&s[0].profiles.some((function(e){return Crm.userDetails.PROFILE_NAME===e.name})));i[1]=newForecastsEnabled&&o?store.findAll("forecast_configuration"):store.findAll("dummy",void 0,!1,!1,{url:t,method:"GET"})}else i[1]=store.findAll("dummy",void 0,!1,!1,{url:t,method:"GET"});return Lyte.resolvePromises(i).then((function(t){if(commonUtils.showHideLoadingDiv(!1),t&&t[0]){var r,i=t[0].length&&t[0][0]?t[0][0]:[],a=i.reporting_to?i.reporting_to&&!i.reporting_to.id?i.id:void 0:i.id,s=i.forecast_manager?{id:i.forecast_manager.id,full_name:i.forecast_manager.name}:{};return r=newForecastsEnabled?!(!t[1].hierarchy||"Roles"!==t[1].hierarchy.api_name):!(!t[1]||1===Crm.userDetails.TMENABLED),i.reporting_to&&i.reporting_to.id?store.findRecord("role",i.reporting_to.id).then((function(){return{mode:"edit",roleId:e,roleObj:i,forecastEnabled:r,forecastManager:s,roleSelected:i.reporting_to,reportingChanged:i.reporting_to,ceoId:a,sharePeer:i.share_with_peers,roleName:i.display_label,desc:i.description,accessible:"true"}})):{mode:"edit",roleId:e,roleObj:i,forecastEnabled:r,forecastManager:s,roleSelected:i.reporting_to,reportingChanged:i.reporting_to,ceoId:a,sharePeer:i.share_with_peers,roleName:i.display_label,desc:i.description,accessible:"true"}}return{mode:"edit",roleId:e,accessible:"false"}}),(function(t){return t&&401===t.status&&(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),r.transition.abort()),commonUtils.showHideLoadingDiv(!1),{mode:"edit",roleId:e,accessible:"false"}}))},renderTemplate:function(e,t){return{outlet:"#result",component:"crm-roles-create"}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.role.edit"),Crm.appName]))}}),Lyte.Router.registerRoute("crm.settings.section.roles.index-roles",{getResources:function(){if(Crm.userDetails.permissions.Crm_Implied_Manage_Roles&&featuresAvailable.Roles)return networkUtils.returnDependencyFiles(["crm-userlookup-wrapper-component.js"],crmConstants.jsStaticPathForLyte).concat(networkUtils.returnDependencyFiles(["crm-userlookup-wrapper-component.css"],crmConstants.cssStaticPathForLyte))},model:function(){commonUtils.showHideLoadingDiv(!0);var e=Crm.getCrmBasePath()+"/Role.do?action=getForecastType",t=this;store.unloadAll("role");var r=[store.findAll("org"),store.findAll("role",{reload:!0},!1)],i=store.peekAll("module");if(moduleRecordMapping.Forecasts){var a=i?i.filterBy({api_name:moduleRecordMapping.Forecasts.api_name}):[],s=!!a.length&&(a[0].visible&&a[0].profiles.some((function(e){return Crm.userDetails.PROFILE_NAME===e.name})));r[2]=newForecastsEnabled&&s?store.findAll("forecast_configuration"):store.findAll("dummy",void 0,!1,!1,{url:e,method:"GET"})}else r[2]=store.findAll("dummy",void 0,!1,!1,{url:e,method:"GET"});return Lyte.resolvePromises(r).then((function(e){commonUtils.showHideLoadingDiv(!1);var t=e[0]&&e[0][0]?e[0][0].company_name:"",r=store.peekAll("role").filter((function(e){if(!e.reporting_to)return e}))[0];return{companyName:t,showPopup:!t,forecastEnabled:newForecastsEnabled?!(!e[2].hierarchy||"Roles"!==e[2].hierarchy.api_name):!(!e[2]||1===Crm.userDetails.TMENABLED),ceoId:r.id?r.id:"",rolesTree:[{name:t,children:[r]}]}}),(function(e){e&&401===e.status&&(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),t.transition.abort())}))},renderTemplate:function(){return{outlet:"#result",component:"crm-roles-list",reRender:!0}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.roles.list"),Crm.appName]))}}),Lyte.Router.registerRoute("crm.settings.section.roles.view-role",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-userlist.css"],crmConstants.cssStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["i18n/"+Crm.userDetails.jsLocation+"userlist/zohocrm_"+$ESAPI.encoder().encodeForJavaScript(Crm.userDetails.LOCALE)+".js"]))},beforeModel:function(e){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.security.view.role"),Crm.partnerName]))},model:function(){if(this.transition.data.data)return this.transition.data.data;var e=this.getDynamicParam();commonUtils.showHideLoadingDiv(!0);var t=Crm.getCrmBasePath()+"/Role.do?action=getForecastType",r=this,i=[store.findRecord("role",e)],a=store.peekAll("module");if(moduleRecordMapping.Forecasts){var s=a?a.filterBy({api_name:moduleRecordMapping.Forecasts.api_name}):[],o=!!s.length&&(s[0].visible&&s[0].profiles.some((function(e){return Crm.userDetails.PROFILE_NAME===e.name})));i[1]=newForecastsEnabled&&o?store.findAll("forecast_configuration"):store.findAll("dummy",void 0,!1,!1,{url:t,method:"GET"})}else i[1]=store.findAll("dummy",void 0,!1,!1,{url:t,method:"GET"});return Lyte.resolvePromises(i).then((function(t){commonUtils.showHideLoadingDiv(!1);var r=store.peekRecord("role",e);if(r&&r.id){var i,a={0:"crm.security.user.fullName",1:"crm.label.email.address",2:"crm.security.user.status",3:"crm.security.confirm.status"};return Crm.userDetails.isUserHierarchy&&(a[4]="crm.user.hierarchy.reportingto"),i=newForecastsEnabled?!(!t[1].hierarchy||"Roles"!==t[1].hierarchy.api_name):!(!t[1]||1===Crm.userDetails.TMENABLED),r.reporting_to&&r.reporting_to.id?store.findRecord("role",r.reporting_to.id).then((function(){return{roleId:e,forecastEnabled:i,roleObj:r,accessible:"true",isUserHierarchy:Crm.userDetails.isUserHierarchy,tableObj:JSON.stringify(a)}})):{roleId:e,forecastEnabled:i,roleObj:r,accessible:"true",isUserHierarchy:Crm.userDetails.isUserHierarchy,tableObj:JSON.stringify(a)}}return{roleId:e,accessible:"false"}}),(function(t){return t&&401===t.status&&(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),r.transition.abort()),commonUtils.showHideLoadingDiv(!1),{roleId:e,accessible:"false"}}))},renderTemplate:function(e,t){return{outlet:"#result",component:"crm-roles-view",reRender:!0}},afterRender:function(e,t){wfForm.chosen_show(),wfForm.initFormClick(),wfForm.inputfieldFocus(),this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.view.role"),Crm.appName]))}}),Lyte.Router.registerRoute("crm.settings.section.sandbox.sandbox-deployment-logs",{model:function(){var e=document.querySelector("crm-sandbox-deploymentlogs");return null!==e&&e.remove(),void 0!==this.transition.data&&!0===this.transition.data.isFromSandboxList?{filterComponent:store.triggerAction("sandbox","supported_components",{},{},"GET"),deployment_logs:store.findAll("sandbox_deployment_log"),sandboxList:store.findAll("sandbox",{include_inner_details:"created_by.image_link"})}:{filterComponent:store.triggerAction("sandbox","supported_components",{},{},"GET"),deployment_logs:store.findAll("sandbox_deployment_log"),sandboxList:void 0}},afterModel:function(e){void 0!==e.sandboxList&&0===e.sandboxList.length&&Lyte.Router.transitionTo("crm.settings.section.sandbox.sandbox-list"),this.currentModel={filterAPIVsDisplayName:e.filterComponent.supported_components,deployment_logs:e.deployment_logs,moreRecords:e.deployment_logs.length>0&&e.deployment_logs.$.meta.more_records,showfilter:e.deployment_logs.length>0}},renderTemplate:function(){return{outlet:"#result",component:"crm-sandbox-deploymentlogs"}},afterRender:function(){var e=$L("#sandboxFilterInSandbox")[0];void 0!==e&&(e.component.data.cxPropSelected="All")},actions:{onError:function(e){Lyte.Router.getRouteInstance().transition.abort();var t=JSON.parse(e.responseText);"company name not found"!==t.message?"permission denied"!==t.message&&"permission denied"!==t.data||renderingUtils.displayPermissionDenied():Lyte.Router.transitionTo("crm.settings.section.company-details")},willTransition:function(e){"crm.settings.section.sandbox.sandbox-list"===e.target&&(e.data={},e.data.isFromDeploymentLogs=!0)}}}),Lyte.Router.registerRoute("crm.settings.section.sandbox.sandbox-detail",{model:function(){var e={action:"viewSandboxChanges"},t=this.transition.data?this.transition.data.sandboxInfo:null;if(t&&"Creating"===t.status){t.sandboxId=this.getDynamicParam();var r=store.peekRecord("sandbox",t.sandboxId);return Crm.isMultiSandboxEnabled&&r&&("configuration"===r.type?t.type=I18n.getMsg("custmr.prtl.configuration"):"configuration_and_data"===r.type&&(t.type=I18n.getMsg("crm.sandbox.singular.type2")),t.isMultiSandbox=!0),t}return void 0!==this.getDynamicParam()&&(e.sandboxId=this.getDynamicParam()),store.findAll("dummy",e,!1,!1,{url:Crm.getCrmBasePath()+"/SandboxConfig.do"})},renderTemplate:function(e){if("company"===e.data&&Lyte.Router.transitionTo("crm.settings.section.company-details"),"Creating"!==e.status)"new sandbox"===e.data?(Crm.userDetails.isSandboxCreated=!1,Lyte.Router.transitionTo({route:"crm.settings.section.sandbox"})):(Crm.userDetails.isSandboxCreated=!0,sandbox.setResultForSandboxChanges(e)),setTimeout((function(){crmLayout.Resize.Setup()}),300);else{var t=Handlebars.templates.sandboxCreationAnimation(e);$("#result").html(t)}},actions:{willTransition:function(e){"crm.settings.section.sandbox.sandbox-list"!==e.target&&"crm.settings.section.sandbox"!==e.target||(e.data={},e.data.refresh=!0),sandbox.removeComponent()},onError:function(e){if(404===e.status){var t=JSON.parse(e.responseText);if(t&&"sandbox not found"===t.data){var r=this.getDynamicParam();null!==store.peekRecord("sandbox",r)&&store.deleteRecord("sandbox",r),Lyte.Router.transitionTo({route:"crm.settings.section.sandbox"}),crmui.showMsgBand("error",I18n.getMsg("crm.sandbox.not.found"),5e3)}}}}}),Lyte.Router.registerRoute("crm.settings.section.sandbox.sandbox-list",{model:function(){var e={};return"true"!==window.isSandboxAcc&&sandbox.isMultiSandbox?(e.action="viewSandboxList",void 0!==this.transition.data&&!0===this.transition.data.isFromDeploymentLogs?{countList:store.findAll("dummy",{},!1,!1,{url:"crm/v2.2/settings/sandbox/actions/summary"}),sandboxList:store.findAll("sandbox",{include_inner_details:"created_by.image_link"}),organizations:store.findAll("dummy",{env_type:"sandbox"},!1,!1,{url:"/crm/v2/organizations"})}:{countList:store.findAll("dummy",{},!1,!1,{url:"crm/v2.2/settings/sandbox/actions/summary"}),organizations:store.findAll("dummy",{env_type:"sandbox"},!1,!1,{url:"/crm/v2/organizations"})}):(e.action="viewSandbox",store.findAll("dummy",e,!1,!1,{url:Crm.getCrmBasePath()+"/SandboxConfig.do"}))},afterModel:function(e){if("false"===window.isSandboxAcc&&void 0!==e.countList&&e.countList.hasOwnProperty("sandbox")){var t={},r={},i={};e.countList.sandbox.forEach((function(e){t[e.id]=e})),e.organizations.organizations.forEach((function(e){"sandbox"===e.type&&(r[e.name]=e.web_url+"/")}));var a=store.peekAll("sandbox");a.forEach((function(e){i[e.id]=e.created_by})),this.currentModel={sandboxList:a,sandboxIdVsCountMap:t,nameVsUrl:r,sandboxIdVsCreatedby:i}}},renderTemplate:function(e){if("company"===e.data&&Lyte.Router.transitionTo("crm.settings.section.company-details"),"new sandbox"===e||"new sandbox"===e.data||(void 0===e.sandboxList||0===Object.keys(e.sandboxList).length)&&void 0===e.INFO)Crm.userDetails.isSandboxCreated=!1,sandbox.showStartPage();else{if("true"!==window.isSandboxAcc&&sandbox.isMultiSandbox)return Crm.userDetails.isSandboxCreated=!0,{outlet:"#result",component:"crm-sandbox-list"};Crm.userDetails.isSandboxCreated=!0,sandbox.setResultForSandboxChanges(e)}setTimeout((function(){crmLayout.Resize.Setup()}),300)},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.setup.data.sandbox"),Crm.partnerName]))},actions:{willTransition:function(e){"crm.settings.section.sandbox.sandbox-deployment-logs"===e.target&&(e.data={},e.data.isFromSandboxList=!0),sandbox.removeComponent()},onError:function(e){Lyte.Router.getRouteInstance().transition.abort();var t=JSON.parse(e.responseText);"company name not found"!==t.message?"permission denied"!==t.message&&"permission denied"!==t.data||renderingUtils.displayPermissionDenied():Lyte.Router.transitionTo("crm.settings.section.company-details")}}}),Lyte.Router.registerRoute("crm.settings.section.scoring-rules.clone-scoring-rule",{getResources:function(){var e=networkUtils.returnDependencyFiles(["scoring_config.js"],crmConstants.jsStaticPathForLyte);return Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["scoring_config_rtl.css"],crmConstants.cssStaticPathForLyte))),e=e.concat(networkUtils.returnDependencyFiles(["scoring_config.css"],crmConstants.cssStaticPathForLyte))},beforeModel:function(){store.unloadAll("layout"),store.unloadAll("field"),Crm.userDetails.permissions.Crm_Implied_Manage_Workflow||(renderingUtils.displayPermissionDenied(),this.transition.abort()),this.transition.preservePopup=!0},renderTemplate:function(){return{outlet:"#result",component:"crm-scoringrule-config"}},model:function(e){var t=e.dynamicParam;return this.initRulesAndLayoutReq(t)},afterModel:function(e){if(this.afterModelRuleChanges(e,!1),e.isViewOnly)return this.redirectToListView({type:"error",msg:I18n.getMsg("readonly.clone.error.msg")}),void this.transition.abort();e.signalIdVsSignalJo={};var t={},r=e.scoring_rules;t.module={api_name:r.module.api_name,id:r.module.id},r.layout&&(t.layout={api_name:r.layout.api_name,id:r.layout.id}),t.active=!0,t.description=r.description,t.name=(I18n.getMsg("crm.label.clone")+" "+I18n.getMsg("crm.wf.audtiLog.view.of")+" "+r.name).substring(0,25);var i=store.createRecord("scoring_rule",t);r.field_rules.forEach((function(e,t){var r=e.$.toJSON();delete r.id;var a=store.createRecord("scoring_field_rule",r);0===t?i.$.set("field_rules",a):i.field_rules.add(a)})),r.signal_rules.forEach((function(t,r){var a=t.$.toJSON();delete a.id;var s=store.createRecord("scoring_signal_rule",a);s.isChecked=!0,s.scoreClone=Math.abs(t.score),s.operator=s.score>0?"add":"subtract",0===r?i.$.set("signal_rules",s):i.signal_rules.add(s),s.isNew=!0,e.signalIdVsSignalJo[s.signal.id]=s})),this.markDisabledSignals(e),e.scoring_rules=i,e.disableSaveBtn=!1},beforeExit:function(){store.unloadAll("scoring_rule")},afterRender:function(){this.setScoreRuleTitle()},actions:{onError:function(e){return this.routeErrorHandling(e),!1},willTransition:function(e){this.setFilterDataInCurrRoute(e)}}},{mixins:["scoringrules_common"]}),Lyte.Router.registerRoute("crm.settings.section.scoring-rules.create-scoring-rule",{queryParams:["layout_id"],getResources:function(){var e=networkUtils.returnDependencyFiles(["scoring_config.js"],crmConstants.jsStaticPathForLyte);return Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["scoring_config_rtl.css"],crmConstants.cssStaticPathForLyte))),e=e.concat(networkUtils.returnDependencyFiles(["scoring_config.css"],crmConstants.cssStaticPathForLyte))},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Workflow||(renderingUtils.displayPermissionDenied(),this.transition.abort()),store.unloadAll("layout"),store.unloadAll("field"),this.transition.preservePopup=!0},renderTemplate:function(){return{outlet:"#result",component:"crm-scoringrule-config"}},model:function(e){var t=e.queryParams.layout_id,r=e.dynamicParam,i=moduleRecordMapping[r];if(i&&i.visible){var a={rules_meta:this.transition.data.rules_meta?this.transition.data.rules_meta:this.initDefAPI()};return t?a.layout=store.findAll("layout",{module:moduleApiMapping[r],skip_permission:!0},!1,!0,{apiVersion:"2.1",moduleSet:!0}):a.criteria_fields=store.findAll("field",{module:moduleApiMapping[r]},!1,!0,{apiVersion:"2.1"}),Lyte.resolvePromises(a)}this.redirectToListView()},afterModel:function(e,t){var r={},i=t.queryParams.layout_id;if(i){r.layout={id:i};var a=store.peekRecord("layout",i);this.isValidLayoutRecord(a)?(r.layout.api_name=a.name,e.criteria_fields=a.fields):(this.transition.abort(),this.redirectToListView())}r.module={api_name:moduleApiMapping[t.dynamicParam],id:Crm.moduleInfo[t.dynamicParam].Id},r.name=this.transition.data.ruleName,r.description=this.transition.data.description,r.name||(r.name="New Rule"),e.scoring_rules=store.createRecord("scoring_rule",r),this.parseRulesMeta(e.rules_meta,e),i&&!e.meta_extraDetails.isLayoutSupported&&(this.transition.abort(),this.redirectToListView({type:"error",msg:I18n.getMsg("score.rule.active.msg")}))},beforeExit:function(){store.unloadAll("scoring_rule")},afterRender:function(){this.setScoreRuleTitle()},actions:{onError:function(e){return this.routeErrorHandling(e),!1},willTransition:function(e){this.setFilterDataInCurrRoute(e)}}},{mixins:["scoringrules_common"]}),Lyte.Router.registerRoute("crm.settings.section.scoring-rules.edit-scoring-rule",{getResources:function(){var e=networkUtils.returnDependencyFiles(["scoring_config.js"],crmConstants.jsStaticPathForLyte);return Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["scoring_config_rtl.css"],crmConstants.cssStaticPathForLyte))),e=e.concat(networkUtils.returnDependencyFiles(["scoring_config.css"],crmConstants.cssStaticPathForLyte))},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Workflow||(renderingUtils.displayPermissionDenied(),this.transition.abort()),this.transition.preservePopup=!0,store.unloadAll("layout"),store.unloadAll("field")},renderTemplate:function(){return{outlet:"#result",component:"crm-scoringrule-config"}},model:function(e){var t=e.dynamicParam;return this.initRulesAndLayoutReq(t)},afterModel:function(e){this.afterModelRuleChanges(e,!0)},beforeExit:function(){store.unloadAll("scoring_rule")},afterRender:function(){if(this.setScoreRuleTitle(),this.transition.preservePopup=!0,this.transition.data){var e=this.transition.data;e.type&&this.displaySuccessOrErrorMsg(e.msg,e.type)}},actions:{onError:function(e){return this.routeErrorHandling(e),!1},willTransition:function(e){this.setFilterDataInCurrRoute(e)}}},{mixins:["scoringrules_common"]}),Lyte.Router.registerRoute("crm.settings.section.scoring-rules.index-scoring-rule",{getResources:function(){var e=networkUtils.returnDependencyFiles(["scoring_details.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["scoring_details.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["scoring_details_rtl.css"],crmConstants.cssStaticPathForLyte))),e},model:function(){this.setRouteDataInObj();var e=this.getCurrFilterData(),t=Object.keys(e).length>0;return Lyte.resolvePromises({scoring_rules:store.findAll("scoring_rule",e),rules_meta:this.initDefAPI(),isFromFilter:t,filteredModule:e.module,selectedStatus:e.active})},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Workflow||(renderingUtils.displayPermissionDenied(),this.transition.abort()),this.transition.preservePopup=!0},renderTemplate:function(){return{outlet:"#result",component:"crm-scoringrule-details"}},afterModel:function(e){var t=[],r=[{api_name:"_allModules",displayLabel:I18n.getMsg("crm.label.AllModules")}];e.rules_meta.definition.extraDetails.supportedModules.forEach((function(e){t.push({api_name:moduleApiMapping[e],displayLabel:Lyte.Component.registeredHelpers.getModuleLabel(e),module_name:e})})),r=r.concat(objectUtils.cloneObject_new(t)),e.scoringModules=t,e.modFilterArr=r,e.scoring_rules=objectUtils.cloneObject_new(e.scoring_rules),e.isRulesAvailInFilter=!e.isFromFilter||e.isFromFilter&&e.scoring_rules.length>0,this.parseRulesMeta(e.rules_meta,e,"listView")},afterRender:function(){if(this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.scoring.rules"),Crm.partnerName])),this.transition.preservePopup=!0,this.transition.data){var e=this.transition.data,t=this.transition.data.type;if("schedule_rule"===t){var r={rules:[e.id],module:e.module};this.makeRunRulesReq(r)}else t&&this.displaySuccessOrErrorMsg(this.transition.data.msg,t)}},beforeExit:function(){this.isSelfTarget||store.unloadAll("scoring_rule")},actions:{onError:function(e){return this.routeErrorHandling(e),!1},willTransition:function(e){this.setFilterDataInCurrRoute(e)}}},{mixins:["scoringrules_common"]}),Lyte.Router.registerRoute("crm.settings.section.segmentation.create",{model:function(){commonUtils.showHideLoadingDiv(!0);var e=[store.findAll("segments"),store.findAll("module",{feature_name:"rfm_segmentation"})];return Lyte.resolvePromises(e).then((function(e){return commonUtils.showHideLoadingDiv(!1),{isSuccess:!0,segments:store.peekAll("segments"),supportedSegmentModule:e?e[1]:[]}}),(function(e){commonUtils.showHideLoadingDiv(!1);var t,r=(t=JSON.parse(e.response)).segments;return r&&!r.segments.details.length?t={isSuccess:!0,segments:[]}:t.isSucess=!1,t}))},afterModel:function(e){if(e.isSuccess){var t=e.supportedSegmentModule.filter((function(e){return e.visible}));e={newSegment:store.createRecord("segments"),isSuccess:!0,segmentationModules:t,linkingModules:[],AllFieldsList:[],allModulesArray:[]}}else e.isSuccess=!1;this.currentModel=e},renderTemplate:function(e){if("NOT_SUPPORTED_FEATURE"!==e.code&&"NO_PERMISSION"!==e.code)return{outlet:"#result",component:"crm-segmental-create"};renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))},actions:{willTransition:function(e){var t=getElemById("createSegment");(store.peekAll("segments").filter((function(e){return e.$.isNew})).length||t&&t.getData("isSegmentCreated"))&&this.pauseTheTransaction(e)}}},{mixins:["segmentation-utils"]}),Lyte.Router.registerRoute("crm.settings.section.segmentation.edit",{model:function(){var e=this.getDynamicParam(),t="2"===this.transition.info.queryParams.step;return this.transition.data.isLabelsEdit=t,commonUtils.showHideLoadingDiv(!0),this.getSegmentationDetails(e,t)},afterModel:function(e){this.currentModel=this.populateSegmentationDetails(e,this.transition.data.isLabelsEdit)},renderTemplate:function(){if(this.currentModel){var e=!0;if(!this.currentModel.noPermission)if(this.transition.data.isLabelsEdit){var t=this.currentModel.segment,r=store.peekRecord("module",t.module.id),i=store.peekRecord("module",t.link_module.id);if(r&&i&&r.visible&&i.visible)return e=!1,{outlet:"#result",component:"crm-segment-labels"}}else{r=this.currentModel.segmentModuleDetails,i=this.currentModel.lookUpModuleDetails;if(r&&i&&r.visible&&i.visible)return e=!1,{outlet:"#result",component:"crm-segment-info"}}if(e||this.currentModel.noPermission)return commonUtils.showHideLoadingDiv(!1),{outlet:"#result",component:"segment-info-popup"}}},actions:{willTransition:function(e){var t=this.getDynamicParam(),r=$L("crm-segment-info")[0],i=r&&!r.getData("IsCancelFromEditPage")&&(r.component.getData("isGlobalRuleEdit")||r.component.getData("isConModuleCriEdit")),a=store.peekRecord("segments",t)&&store.peekRecord("segments",t).$.isDirty();(i||a)&&this.pauseTheTransaction(e)}}},{mixins:["segmentation-utils"]}),Lyte.Router.registerRoute("crm.settings.section.segmentation.index",{model:function(){return commonUtils.showHideLoadingDiv(!0),store.findAll("segments").then((function(){var e=store.peekAll("segments"),t=!0,r=!0,i=!1;e&&(e.length&&(t=!1),t?r=!0:(r=!1,i=!0));for(var a=[],s=e.length,o=0,n=0;n<s;n++){var l={};l.segmentalModule=store.peekRecord("module",e[n].module.id);var c=store.peekRecord("module",e[n].link_module.id);if(l.segmentalModule&&c&&l.segmentalModule.visible&&c.visible){l.segmentId=e[n].id,l.segmentName=e[n].name;var d=l.segmentalModule.plural_label,u=c.plural_label;l.segmentAndLookupModule=d,l.linkingModule=c,l.linkingField=e[n].link_field,l.recencyField=e[n].recency_field,l.frequencyField=e[n].frequency_field,"$Count_Of"===l.frequencyField.api_name&&(l.frequencyField={field_label:I18n.getMsg("crm.dashboard.funnel.count.of",[u])}),l.monetaryField=e[n].monetary_field,l.criteriaType="automatic"===e[n].score_type?I18n.getMsg("crm.dumprequest.automatic"):I18n.getMsg("crm.dumprequest.manual"),l.labelsCount=e[n].labels_count,l.status=e[n].status,a.push(l),o++}}var m=!1;return o>=25&&(m=!0),commonUtils.showHideLoadingDiv(!1),{showWelcomePage:r,showUserSegments:i,segmentsListArray:a,isSuccess:!0,disableNewRecord:m}}),(function(e){commonUtils.showHideLoadingDiv(!1);var t,r=(t=JSON.parse(e.response)).segments;return r&&!r.segments.details.length?t={showWelcomePage:!0,showUserSegments:!1,isSuccess:!0}:t.isSucess=!1,t}))},renderTemplate:function(e){if("NOT_SUPPORTED_FEATURE"!==e.code&&"NO_PERMISSION"!==e.code)return e.segmentsListArray.length||(this.currentModel={showWelcomePage:!0,showUserSegments:!1,isSuccess:!0}),{outlet:"#result",component:"segmental-welcome"};renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))},afterRender:function(){var e=this.currentModel.showUserSegments,t=$L("#setup_new_ContentDiv");e?t.css("overflow","hidden"):t.css("overflow","auto")},beforeExit:function(){$L("#setup_new_ContentDiv").css("overflow","auto");var e=$L("crm-user-segments");if(e.length){var t=e[0].component;window.removeEventListener("resize",t.applyResizeHeight)}}},{mixins:["segmentation-utils"]}),Lyte.Router.registerRoute("crm.settings.section.segmentation",{getResources:function(){var e=networkUtils.returnDependencyFiles(["segmentation.js"],crmConstants.jsStaticPathForLyte);return e=(e=Crm.userDetails.RTL_ENABLED?e.concat(networkUtils.returnDependencyFiles(["segmentation.css","segmentation-rtl.css"],crmConstants.cssStaticPathForLyte)):e.concat(networkUtils.returnDependencyFiles(["segmentation.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("segmentation")]))},redirect:function(){"crm.settings.section.segmentation"===this.transition.target&&this.replaceWith("crm.settings.section.segmentation.index")},beforeExit:function(){this.removeFromCache(["segmentation-rtl.css","segmentation.css"]),store.unloadAll("segments")}}),Lyte.Router.registerRoute("crm.settings.section.territories.create-territory",{queryParams:["parentId"],model:function(e){var t=this.getQueryParams().parentId,r={params:{action:"createConfig"}};return t&&(r.params.parentId=t),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/TerritoryConfig.do","GET",r)},renderTemplate:function(e,t){if(!(e.indexOf("REACHED_MAX_LIMIT")>=0))return{outlet:"#result",html:e};var r=e.split("###")[1],i=I18n.getMsg("crm.territory.alert.add",r);setTimeout((function(){renderingUtils.showCustomAlert(i,void 0,!1,(function(){Lyte.Router.transitionTo({route:"crm.settings.section.territories.index-territories"})}))}),1)}}),Lyte.Router.registerRoute("crm.settings.section.territories.edit-territory",{model:function(e){var t={params:{action:"editTerritory",territoryId:this.getDynamicParam()}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/TerritoryConfig.do","GET",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.territories.index-territories",{model:function(e){if(this.transition.cachedResponse)return this.transition.cachedResponse;return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/TerritoryConfig.do","GET",{params:{action:"territoryList"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.territory.title.territory.hierarchy"),Crm.partnerName]))}}),Lyte.Router.registerRoute("crm.settings.section.unsubscribe-link.create-unsubscribe-link",{model:function(){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/unsubscribelink.do","POST",{params:{step:"limitCheck",isAjax:!0}})},renderTemplate:function(e){return e.check?{outlet:"#unsubFormDetails",html:Handlebars.templates.UnsubscribeFormDetails()}:{outlet:"#limitWarning",html:I18n.getMsg("crm.unsubscription.limit.warning",[e.maxLimit,e.editionName])}},afterRender:function(e){"block"===$("#unSubscribe_callOut").css("display")?(freezeBackground(),$("#unSubscribe_callOutHide").attr("onclick","unsubscription.showUnsubscribeFormDetails("+JSON.stringify(e)+");")):unsubscription.showUnsubscribeFormDetails(e),Crm.client_tracking("Unsubscribe Link - New Unsubscribe Link Click")}}),Lyte.Router.registerRoute("crm.settings.section.users.view",{queryParams:["type"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-userdelete-confirm.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-userdelete-confirm.css"],crmConstants.cssStaticPathForLyte),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("transferanddeleteuser")]);return t.concat(e).concat(r)},model:function(e){var t=this.getDynamicParam(),r={params:{actionName:"viewUser",userId:t,frmAllUsersPage:!0}};if(void 0!==t)return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Security.do","GET",r)},renderTemplate:function(e,t){return $("#overlayHeader").hide(),$("#viewalluserstd").attr("width","40%"),$("#viewalluserstd").attr("vertical-align","top"),{outlet:"#viewUserFrmAllUsers",html:e}},afterRender:function(e){this.setTitle(I18n.getMsg("crm.title.general.dynamic",[I18n.getMsg("crm.security.userDetails"),Crm.appName]));var t=$("#viewUserFrmAllUsers");$("#viewUserFrmAllUserstd").show(),t.find("#userDetailView").removeClass("user-pers-details").addClass("user-all-details"),showOrHideUserDetail(t),setPerfectScrollBarUserDetails(),$("#tbl_user_data tr").removeClass("selectedRightActivity"),$("table#tbl_user_data tr#row_u_"+this.getDynamicParam()).addClass("selectedRightActivity")}}),Lyte.Router.registerRoute("crm.settings.section.web-apps.webapp-details",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-webapp-details.js"],crmConstants.jsStaticPathForLyte);return(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-zes-share.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-zes-share.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-webapp-details.css"],crmConstants.cssStaticPathForLyte))},beforeModel:function(e){if(validationUtils.isEmpty(this.transition.data.crm_all_users)){var t,r=this,i=e.dynamicParam;return commonUtils.showHideLoadingDiv(!0),store.findAll("zes-client",{is_apps:!0,per_page:50,page:1}).then((function(e){for(var a=e.length,s=0;s<a;s++)if(e[s].id===i){t=e[s];break}t?r.transition.data=t:(r.showMessageBox("error",I18n.getMsg("crm.zes.mobile.error.appnot.exits")),r.replaceWith("crm.settings.section.web-apps.webapps-index"))}))}},model:function(){var e=this.transition.data,t=e.crm_all_users,r=e.crm_users,i=e.crm_profiles;return e.selectedProfileIds=[],e.selectedUserIds=[],e.selectedObj=[],store.findAll("profile",{},!0).then((function(a){return e.profilesList=a.map((function(t){var r={name:t.name,id:"profile_"+t.id,displayLabel:t.display_label};return i.includes(t.id)&&(e.selectedObj.push(r),e.selectedProfileIds.push(r.id)),r})),store.findAll("user",{type:"ActiveConfirmedUsers"},!0).then((function(i){var a=i.length,s=[];e.sharedUsers=s,e.usersList=s;for(var o=0;o<a;o++){var n=i[o],l={name:n.full_name,id:"user_"+n.id,displayLabel:n.full_name};r.includes(n.id)&&(e.selectedObj.push(l),e.selectedUserIds.push(l.id)),e.usersList.push(l),t.includes(n.id)&&e.sharedUsers.push(n)}return e}))}))},renderTemplate:function(){return document.getElementById("setupInnerLinks").style.display="none",$(".setupleftmenutd").hide(),{outlet:"#result",component:"crm-web-app-details"}},didDestroy:function(){var e=document.getElementById("mainResult");e.style.display="none",document.getElementById("setupInnerLinks").style.display="block",$(".setupleftmenutd").show(),e.style.display="block"},actions:{didTransition:function(){return commonUtils.showHideLoadingDiv(!1),this.titleOnHover($(".zesUsrName"),300),this.titleOnHover($(".webAppsEmail"),280),this.titleOnHover($(".webApppsProfile"),300),!1}}},{mixins:["crm-zes-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.web-apps.webapp-upload",{queryParams:["page"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-zes-upload.js","lyte-fileupload.js"],crmConstants.jsStaticPathForLyte);return(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-zes-share.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-zes-share.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-zes-upload.css"],crmConstants.cssStaticPathForLyte))},model:function(e){var t={};return e.queryParams.page&&"2"===e.queryParams.page.toString()?(this.component||this.replaceWith({route:"crm.settings.section.web-apps.webapp-upload"}),store.findAll("user",{type:"ActiveConfirmedUsers"},!0).then((function(e){return t.users=e.map((function(e){return{name:e.full_name,id:"user_"+e.id,displayLabel:e.full_name}})),store.findAll("profile",{},!0).then((function(e){return t.profiles=e.map((function(e){return{name:e.name,id:"profile_"+e.id,displayLabel:e.display_label}})),t.stage="share",t.selectedObj=[],t}))}))):(t.stage="app",t)},renderTemplate:function(){return{outlet:"#result",component:"crm-zes-upload"}},actions:{didTransition:function(){commonUtils.showHideLoadingDiv(!1)}}}),Lyte.Router.registerRoute("crm.settings.section.web-apps.webapps-index",{queryParams:["is_apps","page","per_page"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-web-apps.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["crm-web-apps.css"],crmConstants.cssStaticPathForLyte))},model:function(){var e={},t=this.getQueryParams();return t.page?(e.page=t.page,e.per_page=20,e.is_apps=t.is_apps):e={page:1,per_page:20},store.findAll("zes-client",e,!0)},afterModel:function(e,t){if(this.currentModel={clients:e},e.$)if(this.currentModel.hasNext=e.$.meta.more_records,this.currentModel.isApps=e.$.meta.is_apps,this.currentModel.hasNext)this.currentModel.count=void 0;else{var r=t.queryParams.page?t.queryParams.page:1;this.currentModel.count=20*(r-1)+e.$.meta.count}t.queryParams.page&&(this.currentModel.page=t.queryParams.page,this.currentModel.startIndex=20*(t.queryParams.page-1)),Lyte.registeredMixins["crm-zes-mixin"].searchValue&&(this.currentModel.searchValue=Lyte.registeredMixins["crm-zes-mixin"].searchValue,delete Lyte.registeredMixins["crm-zes-mixin"].searchValue)},renderTemplate:function(){return{outlet:"#result",component:"crm-web-apps"}},actions:{didTransition:function(){commonUtils.showHideLoadingDiv(!1);for(var e=$(".webAppName"),t=e.length,r=[],i=[],a=0;a<=t-1;a++)r[a]=e[a].innerText,i[a]=e[a].offsetWidth;for(a=0;a<=t-1;a++)i[a]>=300&&e[a].setAttribute("lt-prop-title",r[a]);this.currentModel.searchValue&&$L("#zesWebSearch")[0].setValue(this.currentModel.searchValue)},willTransition:function(){this.component&&this.component.component.data&&(Lyte.registeredMixins["crm-zes-mixin"].searchValue=this.component.component.data.searchValue)}}}),Lyte.Router.registerRoute("crm.settings.section.web-tabs.create-webtabs",{renderTemplate:function(){return{outlet:"#result",component:"crm-webtabs-create"}}}),Lyte.Router.registerRoute("crm.settings.section.web-tabs.edit-webtabs",{model:function(){var e=Lyte.Router.getRouteInstance().getDynamicParam();if(idModuleMapping[e]){commonUtils.showHideLoadingDiv(!0);var t=store.peekRecord("module",e);return store.findAll("module").then((function(e){return e.contains(t)&&("webtab_link"===t.generated_type||"webtab_widget"===t.generated_type)?{mode:"edit"}:{mode:"invalid"}}),(function(){return{mode:"invalid"}}))}return{mode:"invalid"}},renderTemplate:function(){return{outlet:"#result",component:"crm-webtabs-create"}}}),Lyte.Router.registerRoute("crm.settings.section.web-tabs.index-webtabs",{model:function(){return commonUtils.showHideLoadingDiv(!0),store.findAll("module").then((function(e){for(var t=e.sort((function(e,t){return e.id-t.id})),r=[],i=t.length-1,a=0;i>=0;i--)"webtab_link"===t[i].generated_type?(r[a]=t[i],r[a].base_url=t[i].web_link.split("##wtab##")[0],a++):"webtab_widget"===t[i].generated_type&&(r[a]=t[i],r[a].base_url=t[i].widget.url,r[a].widget_name=t[i].widget.name,r[a].widget_id=t[i].widget.id,a++);return commonUtils.showHideLoadingDiv(!1),{mode:"list",webTabArray:r}}))},renderTemplate:function(){return{outlet:"#result",component:"crm-webtabs-list"}}}),Lyte.Router.registerRoute("crm.settings.section.widget-telephony.configuration",{beforeModel:function(e){var t=store.peekAll("provider_conf")[0];t.$.get("isEnabled")?e.dynamicParam!=t.$.get("providerName")&&this.replaceWith("crm.settings.section.widget-telephony.configuration",t.$.get("providerName")):validationUtils.isEmpty(e.dynamicParam)?this.replaceWith("crm.settings.section.widget-telephony.marketplace"):this.replaceWith("crm.settings.section.widget-telephony.summary",e.dynamicParam)},model:function(e){var t=store.peekAll("provider_conf")[0],r=Crm.getCrmBasePath()+"/CtiApiConfig.do",i={params:{mode:"widget",ctiname:t.$.get("providerName")}};return networkUtils.lyteInitiateRequest(r,"GET",i)},afterModel:function(e,t){"object"!=typeof e||"providerEnabled"==e.view||e.isZticonfigured||(store.peekAll("provider_conf")[0].$.set("isEnabled",!1),Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.widget-telephony.summary",t.dynamicParam))},renderTemplate:function(e,t){return{outlet:"#result",html:"object"==typeof e?Handlebars.templates.ctiapi_provider_detail_page(e):e}},afterRender:function(e){$("#setupInnerLinks").hide()},beforeExit:function(){$("#setupInnerLinks").show()}}),Lyte.Router.registerRoute("crm.settings.section.widget-telephony.marketplace",{beforeModel:function(e){var t=store.peekAll("provider_conf")[0];t.$.get("isEnabled")&&this.replaceWith("crm.settings.section.widget-telephony.configuration",t.$.get("providerName"))},model:function(e){var t=ctiApiConfig.providerListData;if(validationUtils.isEmpty(t)){var r=Crm.getCrmBasePath()+"/CtiApiConfig.do",i={params:{mode:"widget"}};return networkUtils.lyteInitiateRequest(r,"GET",i)}return t},afterModel:function(e,t){"object"==typeof e&&"providerList"===e.view?ctiApiConfig.setProviderData(e):"object"==typeof e&&"providerEnabled"===e.view&&this.replaceWith("crm.settings.section.widget-telephony.configuration",e.provider)},renderTemplate:function(e,t){return{outlet:"#result",html:"object"==typeof e?Handlebars.templates.ctiapi_providers_list(ctiApiConfig.providerListData):e}},afterRender:function(e,t){commonUtils.showHideLoadingDiv();var r=store.peekAll("provider_conf")[0];if(validationUtils.isNotEmpty(r.$.get("providerName"))){var i=r.$.get("providerName");i=(i=i.replace(".","\\.")).replace(/\s/g,"\\ "),$("html, body").scrollTop($("#"+i).offset().top)}}}),Lyte.Router.registerRoute("crm.settings.section.widget-telephony.summary",{beforeModel:function(e){var t=store.peekAll("provider_conf")[0];t.$.get("isEnabled")?this.replaceWith("crm.settings.section.widget-telephony.configuration",t.$.get("providerName")):validationUtils.isEmpty(e.dynamicParam)&&this.replaceWith("crm.settings.section.widget-telephony.marketplace")},model:function(e){var t=store.peekAll("provider_conf")[0];if(t.$.set("providerName",e.dynamicParam),validationUtils.isEmpty(ctiApiConfig.providerListData)){var r=Crm.getCrmBasePath()+"/CtiApiConfig.do",i={params:{mode:"widget",ctiname:e.dynamicParam}};return networkUtils.lyteInitiateRequest(r,"GET",i)}return ctiApiConfig.allProviderInfo[t.$.get("providerName")]},afterModel:function(e,t){"object"==typeof e&&(e.provider=e.providerName,e.detailObj&&(e.detailObj.provider=e.provider,e.detailObj.type=e.type))},renderTemplate:function(e,t){var r="";return"object"!=typeof e?r=e:e.detailObj?r=Handlebars.templates.ctiapi_provider_detail_page(e.detailObj):(Handlebars.registerPartial("twilioDetailView",Handlebars.templates.twilio_detailview),r=Handlebars.templates.ctiapi_provider_login_page(e)),{outlet:"#result",html:r}},afterRender:function(e,t){$("#setupInnerLinks").hide()}}),Lyte.Router.registerRoute("crm.settings.section.wizard.create-wizard",{getResources:function(){window.module=void 0;var e=networkUtils.returnDependencyFiles(["zohocrm_jsplumb.js","zohocrm_wizard.js"]),t=networkUtils.returnDependencyFiles(["crm-wizards-builder.js","lyte-hovercard.js"],crmConstants.jsStaticPathForLyte),r=fetchAutomationFunctionFiles(),i=e.concat(t).concat(r);return{parent:networkUtils.returnDependencyFiles(["crm-wizards-list.js","crm-wizard-configuration-helpers.js","crm-wizard-common-helpers.js"],crmConstants.jsStaticPathForLyte),child:i}},model:function(){return Lyte.resolvePromises({profiles:store.findAll("profile",{include_lite_profile:!0})})},afterModel:function(e){var t=this.transition.data,r=store.createRecord("wizard");if(e.limits=t.limits,r.$.isError||!t.selectedLayouts)Lyte.Router.transitionTo("crm.settings.section.wizard.index-wizard");else{e.wizardName=t.wizardName,e.primaryModule=store.peekRecord("module",t.primaryModuleId),e.id="wizBuilder";var i=t.selectedLayouts;e.layouts=[],e.builderScreenMap={},e.wizardId=r.id,r.$.set("name",t.wizardName),r.$.set("module",e.primaryModule),i&&(i.forEach((function(t){var i=store.peekRecord("layout",t),a=store.createRecord("wizard-container");a.$.set("layout",i),a.$.set("chart_data",{nodes:[],connections:[]}),e.builderScreenMap[t]=a,e.layouts.push(i),r.containers.add(a)})),e.selectedLayoutId=i[0])}},renderTemplate:function(){return $("#tabLayer").hide(),$(".setupleftmenutable .setupleftmenutd").hide(),$(".new_setupview").addClass("newSetupRightShow"),$("body").addClass("isWizard"),{outlet:"#result",component:"crm-wizard-builder"}},beforeExit:function(){var e=$("crm-wizard-builder");e.length&&(e[0].component.getData("layouts").forEach((function(e){delete e.active})),e[0].component.data.primaryModule.fields=void 0,store.unloadAll("field"),store.unloadAll("layout"),e[0].component.data.primaryModule.wizard=void 0,window.removeEventListener("beforeunload",wizardUtil.pageReloadChk),thirdPartyUtils.unbindChildEvents(e,!0,!0,!1),crmFlowUtils.magnetiserInstance=null,store.unloadAll("wizard-screen"),store.unloadAll("wizard-segment"),store.unloadAll("wizard-button"),store.unloadAll("wizard-conditional-rule"),store.unloadAll("wizard-conditional-action"),store.unloadAll("transition"))},actions:{willTransition:function(e){this.checkForUnsavedChanges(e)},onError:function(){this.transitionTo("crm.settings.section.wizard.index-wizard")}}},{mixins:["crm-wizard-util-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.wizard.index-wizard",{model:function(){return Lyte.resolvePromises({lastActiveWizard:"crm.settings.section.wizard.view-wizard"===app.prevTransition.route?app.prevTransition.dynamicParams[0]:this.transition.lastActiveWizard,module:store.findAll("module"),wizards:store.findAll("wizard"),profiles:store.findAll("profile",{include_lite_profile:!0})}).catch((function(e){crmHistory.handleAjaxErrorLyte=!0,Lyte.Router.getRouteInstance().transition.abort(),"FEATURE_NOT_SUPPORTED"==JSON.parse(e.response).code?renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.setup.attribution.FEATURE_NOT_SUPPORTED")):renderingUtils.displayPermissionDenied()}))},beforeModel:function(){store.unloadAll("wizard"),store.unloadAll("wizard-container"),store.unloadAll("custom_button"),store.unloadAll("field")},afterModel:function(e){e.modules=e.module.filter((function(e){return(crmConstants.wizardIncludedModules.contains(e.module_name)||"custom"===e.generated_type)&&!0===e.presence_sub_menu})),delete e.module,e.wizardLimit=e.wizards.length?e.wizards.$.meta.license_limit:5,e.wizardCount=e.wizards.length?e.wizards.$.meta.wizard_count:0,e.limits=e.wizards.$.meta.limits},renderTemplate:function(){return{outlet:"#result",component:"crm-wizard-list"}},afterRender:function(){var e=Handlebars.templates.deleteFieldWarningPopup();$("#result").append(e)},actions:{didTransition:function(){$("#tabLayer").show(),$("#mainMenuTabDiv").show(),$(".setupleftmenutable .setupleftmenutd").show(),$(".new_setupview").removeClass("newSetupRightShow")}}}),Lyte.Router.registerRoute("crm.settings.section.wizard.view-wizard",{queryParams:["layoutid"],getResources:function(){window.module=void 0;var e=networkUtils.returnDependencyFiles(["zohocrm_jsplumb.js","zohocrm_wizard.js"]),t=networkUtils.returnDependencyFiles(["crm-wizards-builder.js","lyte-hovercard.js"],crmConstants.jsStaticPathForLyte),r=fetchAutomationFunctionFiles(),i=e.concat(t).concat(r);return{parent:networkUtils.returnDependencyFiles(["crm-wizards-list.js","crm-wizard-configuration-helpers.js","crm-wizard-common-helpers.js"],crmConstants.jsStaticPathForLyte),child:i}},beforeModel:function(){},model:function(){commonUtils.showHideLoadingDiv(!0);var e=this;return Lyte.resolvePromises({profile:store.findAll("profile",{include_lite_profile:!0}),wizard:store.findRecord("wizard",this.transition.info.dynamicParams[0],{layout_id:this.transition.info.queryParams.layoutid},!1),wizardMeta:store.findAll("wizard")}).then((function(e){return e.wizard[0]&&store.findAll("field",{module:e.wizard[0].module.module_name},void 0,void 0,{apiVersion:"2.2"}),e})).catch((function(t){var r;commonUtils.showHideLoadingDiv(!1),e.transition.abort(),(r=t.response&&t.response.indexOf("Invalid Wizard ID")>0?Lyte.Component.render("lyte-alert",{id:"wizardNotFoundAlert","lt-prop-wrapper-class":"wizardAlertWrapCls","lt-prop-top":"0px","lt-prop-type":"error","lt-prop-secondary-message":I18n.getMsg("crm.settings.wizard.not.found.desc"),"lt-prop-primary-message":I18n.getMsg("crm.settings.wizard.not.found.heading"),"lt-prop-button-position":"left"},"#result"):t.response&&t.response.indexOf("Invalid layout id")>0?Lyte.Component.render("lyte-alert",{id:"wizardNotFoundAlert","lt-prop-wrapper-class":"wizardAlertWrapCls","lt-prop-top":"0px","lt-prop-type":"error","lt-prop-secondary-message":I18n.getMsg("crm.settings.wizard.layout.not.found.desc"),"lt-prop-primary-message":I18n.getMsg("crm.zmail.users.backup.error"),"lt-prop-button-position":"left"},"#result"):Lyte.Component.render("lyte-alert",{id:"wizardNotFoundAlert","lt-prop-wrapper-class":"wizardAlertWrapCls","lt-prop-top":"0px","lt-prop-type":"error","lt-prop-secondary-message":I18n.getMsg("crm.copy.error.mail.internal.error"),"lt-prop-primary-message":I18n.getMsg("crm.zmail.users.backup.error"),"lt-prop-button-position":"left"},"#result")).setMethods({onClose:function(){Lyte.Router.transitionTo("crm.settings.section.wizard.index-wizard")}}),r.ltProp("buttons",[{type:"reject",text:I18n.getMsg("crm.button.ok"),appearance:"failure"}]),r.ltProp("showCloseButton",!1),r.ltProp("show",!0)}))},afterModel:function(e){var t={},r=e.wizard[0];if(t.limits=e.wizardMeta.$.meta.limits,!r){commonUtils.showHideLoadingDiv(!1),this.transition.abort();var i=Lyte.Component.render("lyte-alert",{id:"wizardNotFoundAlert","lt-prop-wrapper-class":"wizardAlertWrapCls","lt-prop-top":"0px","lt-prop-type":"error","lt-prop-secondary-message":I18n.getMsg("crm.settings.wizard.not.found.desc"),"lt-prop-primary-message":I18n.getMsg("crm.settings.wizard.not.found.heading"),"lt-prop-button-position":"left"},"#result");return i.ltProp("buttons",[{type:"reject",text:I18n.getMsg("crm.button.ok"),appearance:"failure"}]),i.ltProp("showCloseButton",!1),void i.ltProp("show",!0)}this.sortElements(r),t.wizardId=this.transition.info.dynamicParams[0],t.wizardName=r.name,t.primaryModule=r.module,t.selectedLayoutId=this.transition.info.queryParams.layoutid,t.id="wizBuilder",t.layouts=[],t.builderScreenMap={};var a={},s=this;r.containers.forEach((function(e,r){var i=e.layout;t.layouts[r]=i,i.id==s.transition.info.queryParams.layoutid&&(t.layouts[r].active=!0,t.selectedLayoutId=i.id),a[i.id]=e})),t.builderScreenMap=a,this.currentModel=t},renderTemplate:function(){return $("#tabLayer").hide(),$(".setupleftmenutable .setupleftmenutd").hide(),$(".new_setupview").addClass("newSetupRightShow"),$("body").addClass("isWizard"),{outlet:"#result",component:"crm-wizard-builder"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)},beforeExit:function(){var e=$("crm-wizard-builder");if(e.length){e[0].component.getData("layouts").forEach((function(e){delete e.active})),e[0].component.data.primaryModule.fields=void 0,store.unloadAll("field"),store.unloadAll("layout"),e[0].component.data.primaryModule.wizard=void 0,window.removeEventListener("beforeunload",wizardUtil.pageReloadChk),thirdPartyUtils.unbindChildEvents(e,!0,!0,!1);var t=document.getElementById("wizardNotFoundAlert");t&&t.remove(),store.unloadAll("wizard-screen"),store.unloadAll("wizard-segment"),store.unloadAll("wizard-button"),store.unloadAll("wizard-conditional-rule"),store.unloadAll("wizard-conditional-action"),store.unloadAll("transition")}},actions:{willTransition:function(e){this.checkForUnsavedChanges(e)}}},{mixins:["crm-wizard-util-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.workflow-rules.create-workflow-rule",{queryParams:["module"],model:function(e){var t=this.transition.data,r={module:e.queryParams.module,step:"newRule"};null!=t&&null!=t.rulename&&(r.ruleName=t.rulename,r.ruleDesc=t.ruleDesc,r.step="newRuleStep2");var i={params:r};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowRule.do","POST",i)},afterModel:function(e,t){},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){$("#FreezeLayer").hide(),$("#headerModuleOpt").val("All"),$("#headerStatusOpt").val("All"),workflow.moduleSelected="All",workflow.statusSelected="All",workflow.execSelected="All",store.unloadAll("role"),store.unloadAll("user_group")},actions:{willTransition:function(e){if(wfNew.isRuleEdited&&(!e.data||!e.data.from||"cancel"!==e.data.from)&&(!e.extraDetails||!e.extraDetails.from||"save"!==e.extraDetails.from)){wfNew.showWfConfirmPop(I18n.getMsg("crm.workflow.rule.cancel.confirm.message"),I18n.getMsg("workflow.confirm.heading.cancel.workflow"),wfNew.cancelWorkFlow),commonUtils.showHideLoadingDiv(!1),this.transition.abort();var t=Object.assign({},this.transition.info);t.route="crm.settings.section.workflow-rules.create-workflow-rule",this.replaceWith(t).data={from:"cancel"}}},didTransition:function(){}},beforeExit:function(){}}),Lyte.Router.registerRoute("crm.settings.section.workflow-rules.index-workflow-rule",{queryParams:["module","status","executeOn","executeOnType","searchWord"],model:function(e){var t={params:{step:"showAllRules"}};return void 0!==e.queryParams.module?t.params.module=e.queryParams.module:(t.params.module=workflow.moduleSelected="All",workflow.searchString=""),void 0!==e.queryParams.status?t.params.status=e.queryParams.status:t.params.status=workflow.statusSelected="All",e.queryParams.executeOn?t.params.executeOn=e.queryParams.executeOn:t.params.executeOn=workflow.execSelected="All",e.queryParams.executeOnType?t.params.executeOnType=e.queryParams.executeOnType:t.params.executeOnType=workflow.executeOnTypeSelected,void 0!==e.queryParams.searchWord&&(t.params.searchWord=e.queryParams.searchWord),Crm.isWorkflowSuggestionEnabled?Lyte.resolvePromises({workflowHTML:networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowRule.do","POST",t),suggestions:store.findAll("workflow_suggestion").then((function(e){return e}),(function(e){if(403!==e.status)return[];Crm.isWorkflowSuggestionEnabled=!1}))}).then((function(e){return void 0===e.suggestions?e.workflowHTML:e})):networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowRule.do","POST",t)},afterModel:function(){Crm.isWorkflowSuggestionEnabled&&(this.currentModel.suggestions=store.peekAll("workflow_suggestion"))},renderTemplate:function(e){var t=e;return Crm.isWorkflowSuggestionEnabled&&(t=e.workflowHTML),{outlet:"#result",html:t}},afterRender:function(e,t){workflow.isListView=!0;var r=$("#wfSearchWithName");r.val(Lyte.Router.getRouteInstance().getQueryParams().searchWord);var i=$("#reOrderBtn");i.css({display:""});var a=$("#reOrderBtn_div");workflow.moduleSelected=Lyte.Router.getRouteInstance().getQueryParams().module,workflow.statusSelected=Lyte.Router.getRouteInstance().getQueryParams().status,workflow.searchString=null==Lyte.Router.getRouteInstance().getQueryParams().searchWord?"":Lyte.Router.getRouteInstance().getQueryParams().searchWord,$("#saveReOrderBtn,#cancelReOrderBtn,#executionSPAN").css({display:"none"}),"All"!==workflow.moduleSelected&&void 0!==workflow.moduleSelected&&"InActive"!==workflow.statusSelected&&""===workflow.searchString?r.closest("div").show():("All"!==workflow.moduleSelected&&void 0!==workflow.moduleSelected||(i[0].disabled=!0,a[0].onmouseover=function(){crmui.toolTip_show(this,"left",I18n.getMsg("workflow.rules.list.disablebtnTitlehelp.ReOrder"))}),a[0].onmouseout=function(){crmui.toolTip_hide()});var s=$("#summaryLINK");"All"===workflow.moduleSelected||void 0===workflow.moduleSelected?(s.addClass("disabled").parent().removeAttr("onmouseover"),s.attr("onmouseover","crmui.toolTip_show(this,'right','"+I18n.getMsg("crm.wf.summary.alert.SummaryNotforAllModules.chooseModule")+"')")):void 0!==i[0]&&(s.removeClass("disabled").parent().removeAttr("onmouseover"),s.attr("onmouseover","crmui.toolTip_show(this,'right','"+I18n.getMsg("crm.wf.summary.Title.SummaryView")+"')")),workflow.hideReOrderForNoRules(),""!==workflow.searchString?workflow.wfSearchOnKeyUp(r):workflow.disableReorderBtn();var o=$("#headerModuleOpt"),n=$("#executeOptList"),l=$("#headerStatusOpt"),c=o.parent();"All"!==o.val()?c.addClass("filterApplied"):c.removeClass("filterApplied");var d=l.parent();"All"!==l.val()?d.addClass("filterApplied"):d.removeClass("filterApplied");var u=n.parent();"All"!==n.val()?u.addClass("filterApplied"):u.removeClass("filterApplied"),"All"!==o.val()&&void 0!==o.val()&&workflow.showHideTriggersForModule(o.val(),n),Crm.isWorkflowSuggestionEnabled&&Lyte.Component.render("crm-workflow-suggestion",t,"#workflowSuggestContainer");var m=this.transition.extraDetails;if(m&&m.highlight){var p=m.highlight+"Row";workflow.highlightSavedRule(p),setTimeout((function(){$("#"+p).removeClass("lastActiveRow")}),1e4),setTimeout((function(){workflow.savedWFRuleNameparams&&workflow.savedWFRuleNameparams.length>0&&crmui.showMsgBand("success",I18n.getMsg("crm.workflow.save.success.message",workflow.savedWFRuleNameparams),"5000",$("#setupInnerLinks"))}),100)}$("#activePopup").after(Handlebars.templates.showRuleDeactivationAlertMsg()),$L("#setup_new_ContentDiv").removeClass("oHImp")},beforeExit:function(){workflow.isListView=!1,wfNew.resetWFObjs()}}),Lyte.Router.registerRoute("crm.settings.section.workflow-rules.summary-workflow-rules",{queryParams:["module","status","executeOn","executeOnType","searchWord"],model:function(e){var t={params:{step:"showSummary"}};return void 0!==e.queryParams.module&&(t.params.module=e.queryParams.module),void 0!==e.queryParams.status&&(t.params.status=e.queryParams.status),void 0!==e.queryParams.executeOn&&(t.params.executeOn=e.queryParams.executeOn),void 0!==e.queryParams.executeOnType&&(t.params.executeOnType=e.queryParams.executeOnType),void 0!==e.queryParams.searchWord&&(t.params.searchWord=e.queryParams.searchWord),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowRule.do","POST",t)},renderTemplate:function(e){return{outlet:"#result",html:e}},afterRender:function(){$("#reOrderBtn,#saveReOrderBtn,#cancelReOrderBtn").css({display:"none"});var e=$("#modOpt"),t=$("#statusOpt"),r=$("#wfSearchWithName");r.val(Lyte.Router.getRouteInstance().getQueryParams().searchWord),void 0!==workflow.moduleSelected?e.val(workflow.moduleSelected):workflow.moduleSelected=e.val(),void 0!==workflow.statusSelected?t.val(workflow.statusSelected):workflow.statusSelected=t.val(),void 0===workflow.execOptVal&&(workflow.execOptVal=Lyte.Router.getRouteInstance().getQueryParams().executeOn),workflow.searchString=Lyte.Router.getRouteInstance().getQueryParams().searchWord,workflow.setSummaryViewDiv(),""!=r.val()&&workflow.wfSearchOnKeyUp(r)},beforeExit:function(){$("#wfSearchWithName").val(workflow.searchString)}}),Lyte.Router.registerRoute("crm.settings.section.workflow-rules.view-workflow-rule",{queryParams:["module","actionId","migrateTo","ruleName"],model:function(e){var t=this.getDynamicParam(),r=this.transition.data,i={step:"editRule",ruleId:t,module:e.queryParams.module};null!=r&&null!=r.src&&(i.src=r.src),this.getQueryParams().actionId&&(i.actionId=e.queryParams.actionId),this.getQueryParams().ruleName&&(i.ruleName=e.queryParams.ruleName),this.getQueryParams().migrateTo&&(i.migrateTo=e.queryParams.migrateTo);var a={params:i};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowRule.do","POST",a)},renderTemplate:function(e,t){return"Deleted"==e&&(e=Handlebars.templates.WFRuleDeleted()),{outlet:"#result",html:e}},afterRender:function(){$("#bestTimeEnablePopup").after(Handlebars.templates.showRuleDeactivationAlertMsg());var e=this.transition.data;e.suggestion_id&&(store.unloadRecord("workflow_suggestion",e.suggestion_id),$("#unlockspan, #wf_showMore_div").hide(),wfNew.enableSubmit()),store.unloadAll("role"),store.unloadAll("user_group")},actions:{willTransition:function(e){if("crm.settings.section.workflow"==e.target&&(e.data={reload:!0}),LytePopup.components.length>0)for(var t=LytePopup.components,r=t.length,i=0;i<r;i++)t[i].$node.id&&"chat-popup"==t[i].$node.id&&t[i].setData("ltPropBindToBody",!1);if(wfNew.isRuleEdited&&(!e.data||!e.data.from||"cancel"!==e.data.from)&&(!e.extraDetails||!e.extraDetails.from||"save"!==e.extraDetails.from)){wfNew.showWfConfirmPop(I18n.getMsg("crm.workflow.rule.cancel.confirm.message"),I18n.getMsg("workflow.confirm.heading.cancel.workflow"),wfNew.cancelWorkFlow),commonUtils.showHideLoadingDiv(!1),this.transition.abort();var a=Object.assign({},this.transition.info);a.route="crm.settings.section.workflow-rules.view-workflow-rule",this.replaceWith(a).data={from:"cancel"}}}},beforeExit:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess()}}),Lyte.Router.registerRoute("crm.settings.section.zohocpq.configurator-create",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-cpq-general.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["crm-cpq-general.css"],crmConstants.cssStaticPathForLyte)),e="productConfigurator"===this.parent.getDynamicParam()?(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["cpq-productconfigurator.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["zohocrm_zprocess.js","zohocrm_workflow.js"]))).concat(networkUtils.returnDependencyFiles(["cpq-helpers.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-automation-userswrapper.js","crm-superadmin-dd-wrapper.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["cpq-productconfigurator.css","crm-automation-userswrapper.css"],crmConstants.cssStaticPathForLyte)):(e=(e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["zohocpq-tab.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["zohocpq.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["zohocpq.js","lytecombobox.js","lyte-hovercard.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-cpq-settings.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-cpq-setting.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("cpq")],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles(["zohocpq-tab.js"],crmConstants.jsStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-cpq-rtl.css"],crmConstants.cssStaticPathForLyte))),e},model:function(){if("productConfigurator"===this.parent.getDynamicParam())return Lyte.resolvePromises([store.findAll("field",{module:"Quoted_Items",type:"all"},!0,void 0,{apiVersion:"2.2"}),store.findAll("field",{module:"Quotes",type:"all"},!0,void 0,{apiVersion:"2.2"})])},afterModel:function(e){if("productConfigurator"===this.parent.currentModel.configuratorInfo.dynamicParam||"priceRules"===this.parent.currentModel.configuratorInfo.dynamicParam)if(this.currentModel={},Lyte.objectUtils(this.currentModel,"add","transitionData",this.transition.data),Lyte.objectUtils(this.currentModel,"add","mode","create"),"productConfigurator"===this.parent.currentModel.configuratorInfo.dynamicParam&&(Lyte.objectUtils(this.currentModel,"add","quotedItemsFields",e[0]),Lyte.objectUtils(this.currentModel,"add","quoteFields",e[1])),"priceRules"===this.parent.currentModel.configuratorInfo.dynamicParam){var t=this.transition.data,r=!0;t.pricerulename&&""!==t.pricerulename&&t.priceruleactiontype&&""!==t.priceruleactiontype&&t.productFields&&t.productRecords||(r=!1),r||(Lyte.Router.transitionTo("crm.settings.section.zohocpq.index-zohocpq","priceRules").data={redirect:!0,isCreatePRRedirect:!0})}else Crm.userDetails.permissions.Crm_Implied_Create_CPQ_Product_Configurator&&this.transition.data.layout&&this.transition.data.name||(Lyte.Router.transitionTo("crm.settings.section.zohocpq.index-zohocpq","productConfigurator").data={redirect:!0,isCreatePCHook:!0})},beforeExit:function(){var e=$L("crm-cpq-warningpopup");e&&e[0]&&e[0].remove()},renderTemplate:function(){this.hideSetupMenu();var e=null;return"productConfigurator"===this.parent.currentModel.configuratorInfo.dynamicParam?e="crm-productconfigurator-main":"priceRules"===this.parent.currentModel.configuratorInfo.dynamicParam&&(e="crm-cpqpricerulecontainer"),{outlet:"#result",component:e}},actions:{willTransition:function(e){"crm.settings.section.zohocpq.index-zohocpq"!==e.target&&"crm.settings.section.zohocpq.configurator-create"!==e.target&&("priceRules"===this.parent.getDynamicParam()?this.checkChangesInPR(e,"create",!1):"productConfigurator"===this.parent.getDynamicParam()&&this.checkChangesInPR(e,"create",!0))},onError:function(e){401===e.status&&renderingUtils.displayPermissionDenied(),this.transition.abort()}}},{mixins:["crm-cpq-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zohocpq.configurator-edit",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-cpq-general.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["crm-cpq-general.css"],crmConstants.cssStaticPathForLyte)),e="productConfigurator"===this.parent.getDynamicParam()?(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-automation-userswrapper.js","crm-superadmin-dd-wrapper.js","cpq-helpers.js","cpq-productconfigurator.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["zohocrm_zprocess.js","zohocrm_workflow.js"]))).concat(networkUtils.returnDependencyFiles(["cpq-productconfigurator.css","crm-automation-userswrapper.css"],crmConstants.cssStaticPathForLyte)):(e=(e=e.concat(networkUtils.returnDependencyFiles(["zohocpq.js","lytecombobox.js","lyte-hovercard.js","crm-cpq-settings.js","zohocpq-tab.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-cpq-setting.css","zohocpq.css","zohocpq-tab.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("cpq")],crmConstants.jsStaticPath)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-cpq-rtl.css"],crmConstants.cssStaticPathForLyte))),e},model:function(){if("productConfigurator"===this.parent.getDynamicParam()){var e={include_inner_details:"criteria.group.field.data_type,criteria.group.field.display_label,criteria.group.field.formula,criteria.group.field.decimal_place,criteria.group.field.separator,actions.field_update.value,actions.field_update.field_label,criteria_field_metadata"};return this.transition.data.criteria_entity_limit?Lyte.resolvePromises([store.findRecord("product_configurator",this.getDynamicParam(),e),store.findAll("field",{module:"Quotes",type:"all"},!0,void 0,{apiVersion:"2.2"}),store.findAll("field",{module:"Quoted_Items",type:"all"},!0,void 0,{apiVersion:"2.2"})]):Lyte.resolvePromises([store.findRecord("product_configurator",this.getDynamicParam(),e),store.findAll("field",{module:"Quotes",type:"all"},!0,void 0,{apiVersion:"2.2"}),store.findAll("dummy",{},!1,!1,{url:"/crm/v2.1/__features?api_names=product_configurator,criteria_entities_product_configurator,action_entities_product_configurator,action_field_update_product_configurator",method:"GET"}),store.findAll("field",{module:"Quoted_Items",type:"all"},!0,void 0,{apiVersion:"2.2"})])}if("priceRules"===this.parent.getDynamicParam()){e={include_inner_details:"criteria.group.field.data_type,criteria.group.field.display_label,criteria.group.field.formula,criteria.group.field.decimal_place,criteria_field_metadata,criteria.group.field.separator,record.Product_Code,record.Unit_Price"};return store.findAll("dummy",e,!1,!1,{url:"/crm/v2.2/settings/cpq/pricing_rules/"+this.getDynamicParam(),method:"GET"}).then(function(e){return this.transition.data.isRespSuccess=!!e,e}.bind(this),function(){return this.transition.data.isRespSuccess=!1,{}}.bind(this))}},afterModel:function(e){if("productConfigurator"===this.parent.getDynamicParam())if(e[0]&&e[0][0]&&e[0][0].id){if(this.currentModel={},this.transition.data.criteria_entity_limit)Lyte.objectUtils(this.currentModel,"add","transitionData",this.transition.data),Lyte.objectUtils(this.currentModel,"add","quotedItemsFields",e[2]);else{var t,r=e[2];t=this.checkPCLimits(r),Lyte.objectUtils(this.currentModel,"add","transitionData",t),Lyte.objectUtils(this.currentModel,"add","quotedItemsFields",e[3])}Lyte.objectUtils(this.currentModel,"add","pc_obj",e[0]),Lyte.objectUtils(this.currentModel,"add","pc_id",this.getDynamicParam()),Lyte.objectUtils(this.currentModel,"add","pc_mode","edit"),Lyte.objectUtils(this.currentModel,"add","quoteFields",e[1])}else this.transition.data.isRespSuccess=!1,this.currentModel={};else if("priceRules"===this.parent.getDynamicParam()&&this.transition.data.isRespSuccess){this.currentModel={},Lyte.objectUtils(this.currentModel,"add","transitionData",this.transition.data),Lyte.objectUtils(this.currentModel,"add","pr_id",this.getDynamicParam()),Lyte.objectUtils(this.currentModel,"add","mode","edit"),Lyte.objectUtils(this.currentModel,"add","pr_obj",e);var i=this.transition.data;i.productFields&&i.productRecords?Lyte.objectUtils(this.currentModel,"add","isProductInfoPresent",!0):Lyte.objectUtils(this.currentModel,"add","isProductInfoPresent",!1)}!1===this.transition.data.isRespSuccess&&(this.currentModel={},Lyte.objectUtils(this.currentModel,"add","isRuleUnAvailable",!0))},beforeExit:function(){var e=$L("crm-cpq-warningpopup")[0];e&&e.remove()},renderTemplate:function(){this.hideSetupMenu();var e=null;return!1!==this.transition.data.isRespSuccess?"productConfigurator"===this.parent.getDynamicParam()?e="crm-productconfigurator-main":"priceRules"===this.parent.getDynamicParam()&&(e="crm-cpqpricerulecontainer"):e="crm-cpqpermissiondenied",{outlet:"#result",component:e}},actions:{willTransition:function(e){"crm.settings.section.zohocpq.index-zohocpq"!==e.target&&"crm.settings.section.zohocpq.configurator-edit"!==e.target&&("priceRules"===this.parent.getDynamicParam()?this.checkChangesInPR(e,"edit",!1):"productConfigurator"===this.parent.getDynamicParam()&&this.checkChangesInPR(e,"edit",!0))},onError:function(e){401===e.status&&renderingUtils.displayPermissionDenied(),this.transition.abort()}}},{mixins:["crm-cpq-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zohocpq.index-zohocpq",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocpq.js","lytecombobox.js","lyte-hovercard.js"],crmConstants.jsStaticPathForLyte);return e=(e=e.concat(networkUtils.returnDependencyFiles(["cpq-helpers.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("cpq")],crmConstants.jsStaticPath)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-cpq-rtl.css"],crmConstants.cssStaticPathForLyte))),e},model:function(){var e;if(this.transition&&this.transition.data&&this.transition.data.type&&(e=this.transition.data.type),"error"!==e){if("productConfigurator"===this.parent.getDynamicParam())return networkUtils.lyteInitiateRequest("/crm/v2.1/__features?api_names=product_configurator,criteria_entities_product_configurator,action_entities_product_configurator,action_field_update_product_configurator","GET");if("priceRules"===this.parent.getDynamicParam())return networkUtils.lyteInitiateRequest("/crm/v2.1/__features?api_names=price_rule","GET")}},afterModel:function(e){var t;this.transition&&this.transition.data&&this.transition.data.type&&(t=this.transition.data.type),"error"!==t&&(this.currentModel={configuratorInfo:this.parent.currentModel.configuratorInfo,dp:this.parent.currentModel.dp,cpqTabs:this.parent.currentModel.cpqTabs},this.parent.currentModel.configuratorInfo&&"priceRules"===this.parent.currentModel.configuratorInfo.dynamicParam&&this.transition.data.actionTypeFromTransition&&Lyte.objectUtils(this.currentModel,"add","actionTypeFromTransition",this.transition.data.actionTypeFromTransition),"productConfigurator"===this.parent.getDynamicParam()?(Lyte.objectUtils(this.currentModel,"add","Limits",e),this.parent.transition&&this.parent.transition.data&&this.parent.transition.data.isCreatePCHook&&Lyte.objectUtils(this.currentModel,"add","isCreatePCHook",!0)):"priceRules"===this.parent.getDynamicParam()&&(Lyte.objectUtils(this.currentModel,"add","Limits",e),this.parent.transition&&this.parent.transition.data&&this.parent.transition.data.isCreatePRRedirect&&Lyte.objectUtils(this.currentModel,"add","isCreatePRRedirect",!0)))},renderTemplate:function(){var e=$L(".setupleftmenutd"),t=$L("#setupshow");void 0!==e&&void 0!==e[0]&&void 0!==t&&void 0!==t[0]&&(e[0].className.includes("hide")&&e.removeClass("hide"),t[0].className.includes("new_setupview")||t.addClass("new_setupview"));var r,i="crm-cpqconfiguratorlistview";if(this.transition&&this.transition.data&&this.transition.data.type&&(r=this.transition.data.type),"error"===r)i="crm-cpqpermissiondenied";else{var a=this.currentModel.dp[0];"CpqSettings"===a?i="crm-cpqsettings":"templateEditor"===a&&(i="crm-cpqtemplate")}return{outlet:"#result",component:i}}}),Lyte.Router.registerRoute("crm.settings.section.abtesting.create-abtesting",{queryParams:["module","name","base_form"],getResources:function(){var e=networkUtils.returnDependencyFiles(["webform-builder.js","crm-privacy-policy.js","definition-model.js","assignment-rules-model-wrapper.js","crm-alert-addresswrapper.js","crux-tag.js","lyte-colorpicker.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["webform-builder.css","crm-alert-addresswrapper.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["webform-builder-RTL.css"],crmConstants.cssStaticPathForLyte))),e},beforeModel:function(e){commonUtils.showHideLoadingDiv(!0),e.queryParams.module&&e.queryParams.base_form&&this.checkPermission(e.queryParams.module,"abtesting")||this.showPermissionDenied(this.transition)},model:function(e){e.queryParams.name&&(e.queryParams.name=e.queryParams.name.trim());var t=this;return new Promise((function(r){var i=t.getModuleObjByApiName(e.queryParams.module),a={builder_type:"abtesting",module:i,abtesting:store.createRecord("abtesting",t.getBasicABTesting(e.queryParams.name,i,e.queryParams.base_form)),base_form:store.findRecord("webform",e.queryParams.base_form,{module:i.api_name},void 0,!0,store.peekRecord("webform",e.queryParams.base_form))};Lyte.resolvePromises(a).then((function(e){e.base_form&&e.base_form.id?(e.layout=store.findRecord("layout",e.base_form.layout.id,{module:i.api_name,skip_permission:!0}),Lyte.resolvePromises(e).then((function(e){r(e)}))):t.showPermissionDenied(t.transition)}))}))},afterModel:function(e){var t=this.constructFieldsArrayFromResponse(e.layout[0]),r=this.constructWebFormFields(e.base_form.fields,t,e.module.module_name);e.activeTab=1,e.allFields=t,e.base_form=e.base_form.$.toJSON(),e.base_form.modifications={form_attributes:{font_attributes:{}},modified_fields:[],added_fields:[],removed_fields:[],button_attributes:[]},e.base_form.fields=r.selectedFieldsList,e.base_form.fieldsToSelect=r.fieldsToSelect,e.base_form.advancedFieldsToSelect=r.advancedFieldsToSelect,$L.extend(e.abtesting.base_form,e.base_form),$L.extend(e.abtesting.variant_form[0],JSON.parse(JSON.stringify(e.base_form))),e.abtesting.variant_form[0].id="",e.webform=e.abtesting.variant_form[0]},renderTemplate:function(){return{outlet:"#result",component:"crm-webform-builder"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)}},{mixins:["webform"]}),Lyte.Router.registerRoute("crm.settings.section.abtesting.edit-abtesting",{queryParams:["module"],getResources:function(){var e=networkUtils.returnDependencyFiles(["webform-builder.js","crm-privacy-policy.js","definition-model.js","assignment-rules-model-wrapper.js","crm-alert-addresswrapper.js","crux-tag.js","lyte-colorpicker.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["webform-builder.css","crm-alert-addresswrapper.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["webform-builder-RTL.css"],crmConstants.cssStaticPathForLyte))),e},beforeModel:function(e){commonUtils.showHideLoadingDiv(!0),e.queryParams.module&&this.checkPermission(e.queryParams.module,"abtesting")||this.showPermissionDenied(this.transition)},model:function(e){var t=this;return new Promise((function(r,i){var a=t.getModuleObjByApiName(e.queryParams.module),s={builder_type:"abtesting",module:a,abtesting:store.findRecord("abtesting",e.dynamicParam,{module:a.api_name})};Lyte.resolvePromises(s).then((function(e){if("drafted"!==e.abtesting.status&&"scheduled"!==e.abtesting.status)return t.showPermissionDenied(t.transition),i("user does not have sufficient privileges to perform this action");var s=e.abtesting.variant_form.length;e.base_form=store.findRecord("webform",e.abtesting.base_form.id,{module:a.api_name});for(var o=0;o<s;o++){var n=e.abtesting.variant_form[o],l={form1:e.abtesting.base_form.id,form2:n.id};e["variant_"+o+"_modifications"]=store.triggerAction("webform","diff",{},l,"GET")}Lyte.resolvePromises(e).then((function(e){e.layout=store.findRecord("layout",e.base_form.layout.id,{module:a.api_name,skip_permission:!0}),Lyte.resolvePromises(e).then((function(e){r(e)}))}))}),(function(e){e.constructor!==String&&e.response&&(e=e.response.constructor===String?JSON.parse(e.response).code:e.response.code),"NO_PERMISSION"!==e&&"INVALID_MODULE"!==e&&"INVALID_FORM_ID"!==e||setTimeout((function(){t.showPermissionDenied(t.transition)}),0)}))}))},afterModel:function(e){var t=this.constructFieldsArrayFromResponse(e.layout[0]),r=this.constructWebFormFields(e.base_form.fields,t,e.module.module_name);e.base_form.fields=r.selectedFieldsList,e.base_form.modifications={form_attributes:{font_attributes:{}},modified_fields:[],added_fields:[],removed_fields:[],button_attributes:[]},$L.extend(e.abtesting.base_form,e.base_form.$.toJSON()),e.allFields=t,e.abtesting.base_form.fields=r.selectedFieldsList,e.abtesting.base_form.fieldsToSelect=r.fieldsToSelect,e.abtesting.base_form.advancedFieldsToSelect=r.advancedFieldsToSelect,e.abtesting.base_form.modifications={form_attributes:{font_attributes:{}},modified_fields:[],added_fields:[],removed_fields:[],button_attributes:[]};for(var i=e.abtesting.variant_form.length,a=0;a<i;a++){var s=e.abtesting.variant_form[a],o=this.constructWebFormFields(s.fields,t,e.module.module_name),n=e["variant_"+a+"_modifications"].diff[0];e.abtesting.variant_form[a].module=e.module,e.abtesting.variant_form[a].fields=o.selectedFieldsList,e.abtesting.variant_form[a].fieldsToSelect=o.fieldsToSelect,e.abtesting.variant_form[a].advancedFieldsToSelect=o.advancedFieldsToSelect,0===Object.keys(n).length?n={form_attributes:{font_attributes:{}},modified_fields:[],added_fields:[],removed_fields:[],button_attributes:[]}:(n.modified_fields||(n.modified_fields=[]),n.added_fields||(n.added_fields=[]),n.removed_fields||(n.removed_fields=[])),this.updateAddedFieldModifications(n,t,e.module),e.abtesting.variant_form[a].modifications=n}e.activeTab=1,e.webform=e.abtesting.variant_form[0]},renderTemplate:function(){return{outlet:"#result",component:"crm-webform-builder"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)},actions:{onError:function(e){e.constructor!==String&&e.response&&(e=e.response.constructor===String?JSON.parse(e.response).code:e.response.code),"NO_PERMISSION"!==e&&"INVALID_MODULE"!==e&&"INVALID_FORM_ID"!==e||(setTimeout((function(){renderingUtils.displayPermissionDenied()}),0),this.transition&&this.transition.abort())}}},{mixins:["webform"]}),Lyte.Router.registerRoute("crm.settings.section.abtesting.index-abtesting",{queryParams:["module","base_form","status"],renderThis:!0,getResources:function(){var e=networkUtils.returnDependencyFiles(["abtesting-listview.js","crm-webform-abtesting-create.js","webform-abtesting-demovideo.js","crux-video.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["abtesting-listview.css","crm-webform-abtesting-create.css","webform-abtesting-demovideo.css"],crmConstants.cssStaticPathForLyte);return Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["abtesting-listview-rtl.css"],crmConstants.cssStaticPathForLyte))),e.concat(t)},beforeModel:function(e){if(commonUtils.showHideLoadingDiv(!0),e.queryParams.module)this.checkPermission(e.queryParams.module,"abtesting")||this.showPermissionDenied(this.transition);else{var t=this.getFeatureSupportedModules("abtesting");t.length?e.queryParams.module=t[0].api_name:this.showPermissionDenied(this.transition)}},model:function(e){var t={module:e.queryParams.module};e.queryParams.base_form&&(t.base_form=e.queryParams.base_form),e.queryParams.status&&(t.status=e.queryParams.status);var r={abtesting:store.findAll("abtesting",t,void 0,!0,{}),visit_details:store.triggerAction("abtesting","visitors",{},{module:t.module},"GET"),supported_modules:this.getFeatureSupportedModules("abtesting")};return Lyte.resolvePromises(r)},afterModel:function(e,t){if(e.module=this.getModuleObjByApiName(t.queryParams.module),e.abtesting){var r=e.abtesting.$.meta.info;e.available_abtesting=r.available_abtesting,r.supported_module&&(e.supported_modules=r.supported_module)}e.visit_details&&e.visit_details.AB_testing&&this.setVisitorDetails(e.visit_details.AB_testing,e.abtesting),e.base_forms=this.getBaseFormsForABTList(e.abtesting,e.module.api_name),t.queryParams.base_form&&(e.base_form=t.queryParams.base_form),e.base_form="all_forms",e.status="all_status";Crm.userDetails.DEPLOYMENT.includes("China")||["zh","ja","pt","de","es","fr"].contains(Crm.userDetails.LOCALE.substr(0,2))||isMobileBrowser()||(e.isNewHelp=!0)},renderTemplate:function(){return{outlet:"#result",component:"crm-webform-abtesting-listview"}},afterRender:function(e){commonUtils.showHideLoadingDiv(!1);var t=$L("#selectMod")[0];t&&(t.ltProp("selected",""),t.ltProp("selected",e.module.api_name)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["webform-builder-RTL.css"],crmConstants.cssStaticPathForLyte)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["webform-builder.css","crm-alert-addresswrapper.css"],crmConstants.cssStaticPathForLyte))},beforeExit:function(){Crm.userDetails.RTL_ENABLED&&(Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-webform-rtl.css"],crmConstants.cssStaticPathForLyte)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["webform-builder-RTL.css"],crmConstants.cssStaticPathForLyte)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["webform-builder.css","crm-alert-addresswrapper.css"],crmConstants.cssStaticPathForLyte)))},actions:{onError:function(e){"NO_PERMISSION"===(e.response.constructor===String?JSON.parse(e.response):e.response).code&&(setTimeout((function(){renderingUtils.displayPermissionDenied()}),0),this.transition&&this.transition.abort())}}},{mixins:["webform"]}),Lyte.Router.registerRoute("crm.settings.section.abtesting.view-abtesting",{queryParams:["module","view"],getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-webform-abtesting-analytics-dependencies_new.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["view-abtesting.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["view-abtesting.css","abtesting-preview.css"],crmConstants.cssStaticPathForLyte))},beforeModel:function(e){commonUtils.showHideLoadingDiv(!0),this.checkPermission(e.queryParams.module,"abtesting",this.transition)},model:function(e){var t=this.getModuleObjByApiName(e.queryParams.module),r={abtesting:store.findRecord("abtesting",e.dynamicParam,{module:e.queryParams.module}),module:t};return this.id!==this.getDynamicParam()&&(r.abtesting_analytics=this.getAllWebFormAbtestingDashboards(e.queryParams.module,this.getDynamicParam()),this.id=this.getDynamicParam()),Lyte.resolvePromises(r)},renderTemplate:function(){return $("#setupInnerLinks .tabClass").hide(),{outlet:"#result",component:"crm-abtesting-view"}},afterRender:function(){this.setPageHeaderWidth(".webF_formNameCtn",".webFormName",[".webF_modName",".webF_allFilterHolder"]),this.setTitleforEllipsis(".webFormName")},redirect:function(){if((this.transition.info.abtesting_analytics||this.transition.info.old_abtesting_analytics)&&(this.currentModel.selectedTab="analytics"),this.transition.info.abtesting_analytics)this.transitionTo("crm.settings.section.abtesting.view-abtesting.analytics-abtesting",this.getDynamicParam(),this.currentModel.abtesting_analytics[0].id,this.getQueryParams());else if("crm.settings.section.abtesting.view-abtesting"===this.transition.target){var e=this.getQueryParams();if(e&&e.view&&"analytics"===e.view)delete e.view,this.transitionTo("crm.settings.section.abtesting.view-abtesting.analytics-abtesting",this.getDynamicParam(),this.currentModel.abtesting_analytics[0].id,e);else{var t=Object.assign({},this.transition.info);t.route="crm.settings.section.abtesting.view-abtesting.preview-abtesting",this.replaceWith(t)}}},actions:{onError:function(){this.transition&&this.showPermissionDenied(this.transition)}}},{mixins:["webform","webform-analytics-util"]}),Lyte.Router.registerRoute("crm.settings.section.abtesting.view-abtesting.analytics-abtesting",{queryParams:["module","timeFilter"],renderThis:!0,getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-webform-abtesting-analytics_new.js","lyte-daterangepicker.js","crm-webform-analytics-config_new.js"],crmConstants.jsStaticPathForLyte),t=["crm-webform-abtesting-analytics_new.css","crm-webform-analytics-config_new.css"];Crm.userDetails.RTL_ENABLED&&t.push("crm-webform-rtl.css");var r=networkUtils.returnDependencyFiles(t,crmConstants.cssStaticPathForLyte);return e.concat(r)},beforeModel:function(e){commonUtils.showHideLoadingDiv(!0),this.validateModule(e),this.parent.component.setData("selectedTab","analytics")},model:function(e){var t=this.parent.currentModel.abtesting,r={record:t,visit_details:store.triggerAction("abtesting","visitors",{id:t.id},{module:e.queryParams.module},"GET"),module:e.queryParams.module};return this.id!==e.dynamicParam&&(r.webform_analytics_arr=this.getAllWebFormAbtestingDashboardsComponents(e.queryParams.module,this.parent.getDynamicParam(),e.dynamicParam),this.id=e.dynamicParam,r.abtesting_webforms=store.batch((function(){store.findRecord("webform",r.record.base_form.id,{module:r.module},!1,!0,{})}))),Lyte.resolvePromises(r)},afterModel:function(e){e.abtesting_webforms&&e.record.variant_form.forEach((function(t){e.abtesting_webforms.push(t)}));var t,r,i="YYYY-MM-DD";if(e.timefilter={},e.display_value={},this.getQueryParams().timeFilter){var a=JSON.parse(this.getQueryParams().timeFilter);t=crmCalendar.getDateObjectFromGivenDateString(a.start_date,i),r=crmCalendar.getDateObjectFromGivenDateString(a.end_date,i)}else t=Utils.convertFrom8601DateFormat(e.record.created_time),Utils.convertToUserTimezone(t),r=new Date,Utils.convertToUserTimezone(r);if(e.timefilter.start_date=this.convertDateToISODate(t),e.timefilter.end_date=this.convertDateToISODate(r),e.display_value.start_date=this.convertDateFormat(t),e.display_value.end_date=this.convertDateFormat(r),e.abtesting_status=this.createABTestingStats(e.record),e.id=this.parent.getDynamicParam(),e.webform_analytics_arr){var s,o=store.peekRecord("abtesting-analytics",this.getDynamicParam());e.webform_analytics=this.renderComponentsBasedOnType(this.getQueryParams().module,o,e.webform_analytics_arr),delete e.webform_analytics_arr,e.day_week_month=this.getDayWeekMonthChartObject("custom",void 0,void 0,t,r),e.day_week_month[0].disabled="",e.day_week_month.forEach((function(e){"true"===e.selected&&(s=e.value)})),e.default_period=s}var n="MM/DD/YYYY";e.datePickerStart=Utils.getDateInGivenPattern(Utils.convertFrom8601DateFormat(e.record.created_time),n.toLowerCase()),e.datePickerEnd=Utils.getDateInGivenPattern(new Date,n.toLowerCase()),e.dateStart=Utils.getDateInGivenPattern(t,n.toLowerCase()),e.dateEnd=Utils.getDateInGivenPattern(r,n.toLowerCase()),e.visit_details&&e.visit_details.AB_testing&&(this.setVisitorDetails(e.visit_details.AB_testing,[e.record]),e.remainingVisitors=e.record.condition.remaining);for(var l=e.abtesting_status.length,c=0,d=!1,u=0;u<l;u++){var m=e.abtesting_status[u];c+=m.visitors,d||0===m.conversion||(d=!0)}e.launchBtnAvailable=d&&0!==c,e.totalVisits=c;var p=Utils.ISO8601toDateObject(e.record.start_time),g=new Date;g.setMonth(g.getMonth()-this.getEditionBasedLimit().month),g.setDate(1),p<g&&(e.hide_analytics=!0)},renderTemplate:function(){return this.parent.currentModel.selectedTab="analytics",{outlet:"#abtesting_Preview",component:"crm-abtesting-analytics"}},actions:{onError:function(){this.transition&&this.showPermissionDenied(this.transition)}},afterRender:function(){this.lazyLoadSettings("abT_analytics","abtesting_Preview","crm-abtesting-analytics"),commonUtils.showHideLoadingDiv(!1)}},{mixins:["webform","webform-analytics-util"]}),Lyte.Router.registerRoute("crm.settings.section.abtesting.view-abtesting.preview-abtesting",{queryParams:["module"],getResources:function(){var e=networkUtils.returnDependencyFiles(["abtesting-preview.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["abtesting-preview.css"],crmConstants.cssStaticPathForLyte);return Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-abtesting-preview-RTL.css"],crmConstants.cssStaticPathForLyte))),e.concat(t)},beforeModel:function(e){commonUtils.showHideLoadingDiv(!0),this.parent.component.setData("selectedTab","preview"),this.checkPermission(e.queryParams.module,"abtesting",this.transition)},model:function(e){e.dynamicParam=this.parent.getDynamicParam();var t=this.getModuleObjByApiName(e.queryParams.module),r={abtesting:store.findRecord("abtesting",e.dynamicParam,{module:e.queryParams.module}),abtestingPreview:store.triggerAction("abtesting","preview",{id:e.dynamicParam},{module:e.queryParams.module},"GET"),module:t};return Lyte.resolvePromises(r)},afterModel:function(e){if(!e.abtesting)throw"INVALID_FORM_ID";e.abtesting=e.abtesting.$.toJSON(),$L.extend(e.abtesting.base_form,e.abtestingPreview.AB_testing[0].base_form);for(var t=e.abtesting.variant_form.length,r=[],i=0;i<t;i++)$L.extend(e.abtesting.variant_form[i],e.abtestingPreview.AB_testing[0].variant_form[i]),r.push({divShow:!1,tagShow:!0,modificationAvailable:!1});if(e.abtesting){e.analyticsdata=this.createABTestingStats(e.abtesting);var a=e.analyticsdata.length;for(i=0;i<a;i++){var s=e.analyticsdata[i];s.winner&&(e.winner=s.id),s.leading&&(e.leading=s.id)}}e.modifications=r},renderTemplate:function(){return{outlet:"#abtesting_Preview",component:"crm-abtesting-preview"}},afterRender:function(e){var t=renderingUtils.windowWidth-$(".setupleftmenutd").width(),r=renderingUtils.getHeightFromTabLayer()-$("#abTestingViewHead").outerHeight()+2;this.updateDatePickerScript(e.abtesting.base_form.source_code,"crm-abtesting-preview"),this.transition.data&&this.transition.data.action&&"preview"===this.transition.data.action&&Crm.client_tracking("WF AB Test - Preview Click",{module:e.module.module_name}),$L(".variantPrevListWrap").css("max-width",t),$L("#abtesting_Preview").css("height",r),commonUtils.showHideLoadingDiv(!1)},actions:{onError:function(e){e.constructor!==String&&e.response&&(e=e.response.constructor===String?JSON.parse(e.response).code:e.response.code),"NO_PERMISSION"!==e&&"INVALID_MODULE"!==e&&"INVALID_FORM_ID"!==e||(setTimeout((function(){renderingUtils.displayPermissionDenied(),commonUtils.showHideLoadingDiv(!1)}),0),this.transition&&this.transition.abort())}}},{mixins:["webform","webform-analytics-util"]}),Lyte.Router.registerRoute("crm.settings.section.workflow-alerts",{getResources:function(){var e=["zohocrm_workflow.js","zohocrm_automationactions_usage.js",networkUtils.getI18nJSUrl("businesshours"),networkUtils.getI18nJSUrl("workflowalert"),networkUtils.includeChartFiles()[0]];return networkUtils.returnDependencyFiles(e)},redirect:function(){if("crm.settings.section.workflow-alerts"==this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.workflow-alerts.index-workflow-alert",this.replaceWith(e)}},actions:{willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||!ZohoHCAsap.UnInstall||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall())}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-deluge",{queryParams:["delugeId"],getDependencies:function(){var e=["zohocrm_workflow.js","zohocrm_automationactions_usage.js",networkUtils.getI18nJSUrl("businesshours")],t=networkUtils.returnDependencyFiles(e),r=fetchAutomationFunctionFiles();return t.concat(r)},getResources:function(){return networkUtils.returnDependencyFiles(networkUtils.includeChartFiles())},model:function(e){customFunctionsObj.category=customFunctionsObj.isFrom="automation";var t={pageTitle:"crm.inactive.prewarning.custom.functions",step:"showAllWFDeluge",isFromBack:!0},r=this.transition.data;r&&r.delugeId&&(t.delugeId=r.delugeId),e.queryParams.delugeId&&(t.delugeId=e.queryParams.delugeId);var i={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowDeluge.do","POST",i)},renderTemplate:function(e,t){return networkUtils.initChart(),{outlet:"#result",html:e}},afterRender:function(){wfmergefield.initMergeFieldDetl(void 0),wfmergefield.setActionType("Deluge"),ZohoDRE.resetRequestData();var e=function(){automationActionsUsage.ZChartResize($(".wf_chartConatiner")),automationActionsUsage.ZChartResize($("#pastDaysDelugeLimitUsage"))};e(),$L(window).resize(e)},beforeExit:function(){wfmergefield.clearMergeFieldDetl(),"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess()},actions:{willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||!ZohoHCAsap.UnInstall||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall())}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-field-updates",{getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_workflow.js",networkUtils.getI18nJSUrl("businesshours")])},redirect:function(){if("crm.settings.section.workflow-field-updates"==this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.workflow-field-updates.index-workflow-field-update",this.replaceWith(e)}},actions:{willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||!ZohoHCAsap.UnInstall||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall())}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-tasks",{getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_workflow.js",networkUtils.getI18nJSUrl("businesshours")])},redirect:function(){if("crm.settings.section.workflow-tasks"==this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.workflow-tasks.index-workflow-task",this.replaceWith(e)}},afterRender:function(){WFTask.fromListPage=!0,wfmergefield.initMergeFieldDetl(void 0),wfmergefield.setActionType("Task")},beforeExit:function(){WFTask.fromListPage=void 0,wfmergefield.clearMergeFieldDetl();var e=$("#taskTable .newSelect").find("select");e.length>0&&(thirdPartyUtils.unbindSelect2(e),thirdPartyUtils.unbindChildPerfectScroll(e))},actions:{willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||!ZohoHCAsap.UnInstall||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall())}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-webhooks",{getResources:function(){var e=["zohocrm_workflow.js","zohocrm_automationactions_usage.js",networkUtils.getI18nJSUrl("businesshours")],t=networkUtils.returnDependencyFiles(e);return t=(t=t.concat(fetchWFParamterComponentFiles())).concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles()))},redirect:function(){if("crm.settings.section.workflow-webhooks"==this.transition.target){var e=Object.assign({},this.transition.info);e.route="crm.settings.section.workflow-webhooks.index-workflow-webhooks",this.replaceWith(e)}},afterRender:function(){wfmergefield.initMergeFieldDetl(void 0),wfmergefield.setActionType("Webhook")},beforeExit:function(){wfmergefield.clearMergeFieldDetl()},actions:{willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||!ZohoHCAsap.UnInstall||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall())}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-alerts.create-workflow-alert",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowAlert.do","POST",{params:{step:"newAlert",isFromBack:!0}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-alerts.edit-workflow-alert",{model:function(e){var t={params:{step:"editAlert",alertId:this.getDynamicParam(),isFromBack:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowAlert.do","POST",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-alerts.index-workflow-alert",{model:function(e){var t={params:{pageTitle:"crm.workflow.label.alerts",step:"showAllAlerts",isFromBack:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowAlert.do","POST",t)},afterModel:function(e,t){},renderTemplate:function(e,t){return networkUtils.initChart(),{outlet:"#result",html:e}},afterRender:function(e,t){var r=function(){automationActionsUsage.ZChartResize($(".wf_chartConatiner")),automationActionsUsage.ZChartResize($("#pastDaysAlertLimitUsage"))};r(),$L(window).resize(r)}}),Lyte.Router.registerRoute("crm.settings.section.workflow-alerts.view-workflow-alert",{model:function(e){var t={params:{step:"showAlert",alertId:this.getDynamicParam(),isFromBack:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowAlert.do","POST",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-field-updates.create-workflow-field-update",{model:function(e){var t={params:{step:"newFieldUpdate",isFromBack:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowFieldUpdate.do","POST",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-field-updates.edit-workflow-field-update",{model:function(e){var t={params:{step:"editFieldUpdate",fieldUpdateId:this.getDynamicParam(),isFromBack:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowFieldUpdate.do","POST",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-field-updates.index-workflow-field-update",{model:function(e){var t={params:{pageTitle:"crm.workflow.label.field.update",step:"showAllFieldUpdate",isFromBack:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowFieldUpdate.do","POST",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-field-updates.view-workflow-field-update",{model:function(e){var t={params:{step:"showFieldUpdate",fieldUpdateId:this.getDynamicParam(),isFromBack:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowFieldUpdate.do","POST",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-webhooks.create-workflow-webhook",{model:function(e){var t={params:{step:"newWebHook",isFromBack:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowWebHook.do","POST",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-webhooks.edit-workflow-webhook",{model:function(e){var t={params:{step:"editWebHook",webHookId:this.getDynamicParam(),isFromBack:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowWebHook.do","POST",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-webhooks.index-workflow-webhook",{model:function(e){var t={params:{pageTitle:"workflow.label.webhooks",step:"showAllWebHooks",isFromBack:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowWebHook.do","POST",t)},renderTemplate:function(e,t){return networkUtils.initChart(),{outlet:"#result",html:e}},afterRender:function(){var e=function(){automationActionsUsage.ZChartResize($(".wf_chartConatiner")),automationActionsUsage.ZChartResize($("#pastDaysWebhookLimitUsage"))};e(),$L(window).resize(e)}}),Lyte.Router.registerRoute("crm.settings.section.workflow-webhooks.view-workflow-webhook",{model:function(e){var t={params:{step:"showWebHook",webHookId:this.getDynamicParam(),isFromBack:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowWebHook.do","POST",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-tasks.create-workflow-task",{queryParams:["module"],model:function(e){var t={step:"newTask",isFromBack:!0};e.queryParams.module&&(t.module=e.queryParams.module);var r={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowTask.do","POST",r)},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-tasks.edit-workflow-task",{model:function(e){var t={params:{step:"editTask",taskId:this.getDynamicParam(),isFromBack:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowTask.do","POST",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-tasks.index-workflow-task",{model:function(e){var t={params:{pageTitle:"crm.workflow.label.tasks",step:"showAllTasks",isFromBack:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowTask.do","POST",t)},afterModel:function(e){"Permission denied"===e.Status&&(e.permissionDenied=!0,crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied())},renderTemplate:function(e,t){if(!e.permissionDenied)return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.workflow-tasks.view-workflow-task",{model:function(e){var t={params:{step:"showTask",taskId:this.getDynamicParam(),isFromBack:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/WorkFlowTask.do","POST",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.client-portal.begin-portal",{beforeModel:function(){Lyte.registeredMixins["crm-client-portal-util"].isClientPortalAccessibleForEdition()},afterModel:function(){var e={};e.companyName=Crm.userDetails.orgName,this.currentModel=e},renderTemplate:function(){return{outlet:"#result",component:"crm-client-portal-begin"}},actions:{didTransition:function(){commonUtils.showHideLoadingDiv()},onError:function(e){var t=JSON.parse(e.response);-1!==t.message.indexOf("unable to process")&&"INVALID_REQUEST"===t.code&&(this.transition.abort(),window.location=Crm.getCrmBasePath()+"/iam-security-error")}}}),Lyte.Router.registerRoute("crm.settings.section.client-portal.create-portal",{redirect:function(){this.transition.data.portal_name||this.transitionTo("crm.settings.section.client-portal.begin-portal")},beforeModel:function(){Lyte.registeredMixins["crm-client-portal-util"].isClientPortalAccessibleForEdition()},afterModel:function(){var e={};e.portal_name=this.transition.data.portal_name,this.currentModel=e},renderTemplate:function(){return{outlet:"#result",component:"crm-client-portal-basic-info"}},actions:{didTransition:function(){commonUtils.showHideLoadingDiv()},onError:function(e){var t=JSON.parse(e.response);-1!==t.message.indexOf("unable to process")&&"INVALID_REQUEST"===t.code&&(this.transition.abort(),window.location=Crm.getCrmBasePath()+"/iam-security-error")}}}),Lyte.Router.registerRoute("crm.settings.section.client-portal.user-types",{beforeModel:function(){CLIENT_PORTAL_NAME&&"dummyValue"!==CLIENT_PORTAL_NAME||Crm.userDetails.CLIENT_PORTAL_NAME||this.transitionTo("crm.settings.section.client-portal.begin-portal"),commonUtils.showHideLoadingDiv(!0)},model:function(){return[store.findAll("user_type"),store.findAll("portal")]},afterModel:function(e){var t={};t.records=e[0];var r={model:{}};r.model=t,r.portalName=CLIENT_PORTAL_NAME&&"dummyValue"!==CLIENT_PORTAL_NAME?CLIENT_PORTAL_NAME:e[1][0].name,r.REMAINING_PORTAL_USER_TYPE_LICENSE=5-t.records.length,this.currentModel=r},renderTemplate:function(){return{outlet:"#result",component:"crm-client-portal-user-types-list-view"}},actions:{willTransition:function(e){"crm.settings.section.client-portal"===e.target&&(e.data={},e.data.refresh=!0);var t=$L("#deleteUserTypePop").e;t&&t.remove()},didTransition:function(){this.transition.data.refresh&&this.refresh(),commonUtils.showHideLoadingDiv()},onError:function(e){var t=JSON.parse(e.response);-1!==t.message.indexOf("unable to process")&&"INVALID_REQUEST"===t.code?(this.transition.abort(),window.location=Crm.getCrmBasePath()+"/iam-security-error"):"NO_PERMISSION"===t.code&&(renderingUtils.displayPermissionDenied(),this.transition.abort())}}}),Lyte.Router.registerRoute("crm.settings.section.client-portal.user-types.create-user-type",{queryParams:["step","name","module"],redirect:function(){if(!this.transition.info||!this.transition.info.queryParams){var e=this.transitionTo("crm.settings.section.client-portal.user-types");e.data={},e.data.refresh=!0}},beforeModel:function(e){if(!Lyte.registeredMixins["crm-client-portal-util"].isAtleastOnePersonalityModuleAvailable()){var t=this.transitionTo("crm.settings.section.client-portal.user-types");t.data={},t.data.refresh=!0}"tabs"===e.queryParams.step&&store.findAll("module"),commonUtils.showHideLoadingDiv(!0),"tabs"!==e.queryParams.step||e.queryParams.name||(this.transition.abort(),crmui.showMsgBand("error",I18n.getMsg("portal.user.type.unavailability"),5e3))},model:function(e){switch(e.queryParams.step){case"tabs":return store.findAll("clientPortalMetaData",{module:e.queryParams.module});case"name":var t={type:"addNewType"};return e.queryParams.name&&(t.name=e.queryParams.name),t}},afterModel:function(e,t){var r=t.queryParams;switch(r.step){case"tabs":var i={};if(!e[0].related_lists)throw"Meta response received empty.";i.model=Lyte.registeredMixins["crm-client-portal-util"].getMetaDataObjForAddingNewUserType(objectUtils.cloneObject(e[0]),r.module,r.name),i.model.route=this.getRouteInstance().transition.target,this.currentModel=i;break;case"name":this.currentModel=e}},renderTemplate:function(e,t){switch(t.queryParams.step){case"tabs":return{outlet:"#result",component:"crm-client-portal-tabs-configuration"};case"name":return{outlet:"#result",component:"crm-client-portal-user-type"}}},actions:{onError:function(e){"string"==typeof e&&"Meta response received empty."===e&&(commonUtils.showHideLoadingDiv(),$L("#nextTab")[0].disabled=!0,crmui.showMsgBand("error",I18n.getMsg("portal.apiname.change.error",crmBasePath+"/settings/client-portal"),1e4))},willTransition:function(e){if("crm.settings.section.client-portal.user-types"!==e.target&&"crm.settings.section.client-portal"!==e.target||(e.data={},e.data.refresh=!0),clientPortal.changesAvailable){var t={};t.routeName=e.info.route,t.transitionData=e.data,t.queryParams=e.info.queryParams,t.dynamicParams=e.info.dynamicParams,e.abort(),Lyte.Component.render("crm-client-portal-changes-available-alert",t,"body"),$L("#changesAvailableAlert").e.ltProp("show",!0)}},didTransition:function(){this.transition.data.refresh&&this.refresh(),commonUtils.showHideLoadingDiv()}}}),Lyte.Router.registerRoute("crm.settings.section.client-portal.user-types.edit",{queryParams:["step","name","layoutId","module"],redirect:function(){this.transition.info&&this.transition.info.dynamicParams||this.transitionTo("crm.settings.section.client-portal.user-types")},beforeModel:function(e){clientPortal.changesAvailable=!1;var t=e&&e.queryParams&&e.queryParams.module&&"fields"===e.queryParams.step?e.queryParams.module.replace("_",""):void 0;t&&Crm.moduleInfo[t]&&!Crm.moduleInfo[t].showSubMenu&&(this.transition.abort(),window.location=Crm.getCrmBasePath()+"/iam-security-error"),commonUtils.showHideLoadingDiv(!0)},model:function(e){switch(e.queryParams.step){case"tabs":return{userTypeData:store.findRecord("user_type",e.dynamicParam),metaData:store.findAll("clientPortalMetaData",{module:e.queryParams.module})};case"fields":var t=store.peekRecord("user_type",e.dynamicParam);t=t&&t.modules&&t.modules[0]?t:void 0;var r=store.peekRecord("layout",e.queryParams.layoutId);return void 0!==r&&("sections"in r||(r=void 0)),{userTypeData:t?[t]:store.findRecord("user_type",e.dynamicParam),layoutRecord:r?[r]:store.findRecord("layout",e.queryParams.layoutId,{module:e.queryParams.module},void 0,void 0,{clientPortalSettings:!0,apiVersion:"2.1"})};case"name":var i={};return i.id=e.dynamicParam,i.type="rename",i.name=e.queryParams.name,i}},afterModel:function(e,t){var r=t.queryParams;switch(r.step){case"tabs":var i={};if(!e.userTypeData[0].modules)throw"Manage portal permission is not presesnt";if(!e.metaData[0].related_lists)throw"Meta response received empty.";i.model=Lyte.registeredMixins["crm-client-portal-util"].getUserTypeData(objectUtils.cloneObject(e.userTypeData[0]),objectUtils.cloneObject(e.metaData[0])),i.model.route=this.getRouteInstance().transition.target,this.currentModel=i;break;case"fields":this.currentModel=Lyte.registeredMixins["crm-client-portal-util"].createFieldPermissionsObj(e.userTypeData[0],objectUtils.cloneObject(e.layoutRecord[0]),r.module);break;case"name":this.currentModel=e}},renderTemplate:function(e,t){switch(t.queryParams.step){case"tabs":return{outlet:"#result",component:"crm-client-portal-tabs-configuration"};case"fields":return{outlet:"#result",component:"crm-client-portal-field-permissions"};case"name":return{outlet:"#result",component:"crm-client-portal-user-type"}}},actions:{willTransition:function(e){if("crm.settings.section.client-portal.user-types"===e.target||"crm.settings.section.client-portal"===e.target?(e.data={},e.data.refresh=!0):"crm.settings.section.client-portal.user-types.create-user-type"===e.target&&"tabs"===e.info.queryParams.step&&(e.abort(),Lyte.Router.transitionTo("crm.settings.section.client-portal.user-types.create-user-type",void 0,{step:"name"})),clientPortal.changesAvailable){var t={};t.routeName=e.info.route,t.transitionData=e.data,t.queryParams=e.info.queryParams,t.dynamicParams=e.info.dynamicParams,e.abort(),Lyte.Component.render("crm-client-portal-changes-available-alert",t,"body"),$L("#changesAvailableAlert").e.ltProp("show",!0)}},didTransition:function(e){if(commonUtils.showHideLoadingDiv(),"fields"===e.queryParams.step){for(var t=this.getQueryParams().module,r=store.peekAll("module"),i={},a=r?r.length:0,s=0;s<a;s++){var o=r[s];o.api_name===t&&(i.api_name=t,i.id=o.id,i.display_label=o.plural_label,i.name=o.module_name)}var n="lyte_tab_"+i.id;document.querySelector("crm-client-portal-field-permissions .portalTab_lyte").openTab(n)}this.transition.data.refresh&&this.refresh(),this.transition.data.changesDone&&(clientPortal.changesAvailable=!0)},onError:function(e){if("string"==typeof e&&"Meta response received empty."===e)commonUtils.showHideLoadingDiv(),crmui.showMsgBand("error",I18n.getMsg("portal.apiname.change.error",crmBasePath+"/settings/client-portal"),1e4);else if("string"==typeof e&&"Manage portal permission is not presesnt"===e)commonUtils.showHideLoadingDiv(),renderingUtils.displayPermissionDenied();else if("object"==typeof e&&e.response){"the module name given seems to be invalid"===JSON.parse(e.response).message&&(this.transition.abort(),commonUtils.showHideLoadingDiv(),crmui.showMsgBand("error",I18n.getMsg("portal.apiname.change.error",crmBasePath+"/settings/client-portal"),1e4))}else this.transition.abort(),window.location=Crm.getCrmBasePath()+"/iam-security-error"}}}),Lyte.Router.registerRoute("crm.settings.section.client-portal.user-types.summary",{redirect:function(){this.transition.info&&this.transition.info.dynamicParams||this.transitionTo("crm.settings.section.client-portal.user-types")},beforeModel:function(e){Crm.userDetails.permissions.Crm_Implied_Manage_ClientPortal||this.transitionTo("crm.settings.section.client-portal.user-types.users",e.dynamicParam),commonUtils.showHideLoadingDiv(!0)},model:function(e){var t=e.dynamicParam,r=store.peekRecord("user_type",t);return r&&r.modules&&0!==r.modules.length?r:store.findRecord("user_type",t)},afterModel:function(e){var t=e.constructor===Record?objectUtils.cloneObject(e):objectUtils.cloneObject(e[0]);(t=this.convertPermissionsJsonObjectToJsonArray(t)).arePublicModulesAvailable=this.arePublicModulesAvailableInUserTypeData(t),t.areWebTabsAvailable=this.areWebTabsAvailable(t),this.currentModel=t},renderTemplate:function(){return{outlet:"#result",component:"crm-client-portal-user-type-summary"}},afterRender:function(){var e=$L(".cpT_portalNameCtn").width()-($L(".cpT_modName").outerWidth()+$(".cpT_saveCancel").outerWidth()+80),t=$L("#cpT_navCtn"),r=renderingUtils.windowHeight-(t.offset().top+29+17);t.css("height",r+"px"),$L(".cpT_portalName").css("max-width",e)},actions:{willTransition:function(e){"crm.settings.section.client-portal.user-types"!==e.target&&"crm.settings.section.client-portal"!==e.target||(e.data={},e.data.refresh=!0);var t=$L("#portalPreview").e;t&&t.remove();var r=$L("#changeUserTypePop").e;r&&r.remove();var i=$L("#sendInvitePopUp").e;i&&i.remove()},didTransition:function(){this.transition.data.refresh&&this.refresh(),commonUtils.showHideLoadingDiv()},onError:function(e,t){if(-1!==e.message.indexOf("Cannot read property 'constructor' of undefined")&&t.info.dynamicParams[0]&&!store.peekRecord("user_type",t.info.dynamicParams[0])){crmui.showMsgBand("error",I18n.getMsg("portal.user.type.unavailability"),5e3);var r=this.transitionTo("crm.settings.section.client-portal.user-types");return void(data&&data.refresh&&(r.data=data))}this.transition.abort(),window.location=Crm.getCrmBasePath()+"/iam-security-error"}}},{mixins:["crm-client-portal-util"]}),Lyte.Router.registerRoute("crm.settings.section.client-portal.user-types.users",{model:function(e){var t=e.dynamicParam,r={};r.users=store.findAll("client_user",{type:"AllActiveUsers",per_page:200,page:1},!1,!0,{user_type_id:t}),r.canPerformChangeUserType=Lyte.registeredMixins["crm-client-portal-user-util"].canPerformChangeUserType(t),r.user_type_id=t,r.personality_module={};var i=store.peekRecord("user_type",t);r.personality_module.plural_label=i.personality_module.plural_label;var a=store.peekRecord("module",i.personality_module.id);return r.module=a.module_name,r.module_api_name=i.personality_module.api_name,r.user_type_name=i.name,r.moduleRecord=store.findRecord("module",i.personality_module.id),r.isUserTypeActive=!i.active,r},afterModel:function(e){var t=this;t.emailFieldPermission=!1,e.users||(e.users=[]);var r=e.users.length;if(e.noResultsFound=0===r,0!==r&&(e.totalUsersCount=e.currentUsersCount=e.users.$.meta.total_count),e.moduleRecord[0]&&e.moduleRecord[0].viewable&&e.moduleRecord[0].visible)return Lyte.resolvePromises([store.findAll("field",{module:e.module_api_name},void 0,void 0)]).then((function(r){var i=r[0];if(i)for(var a=i.length,s=0;s<a;s++)if("Email"===i[s].api_name&&i[s].visible){t.emailFieldPermission=!0;break}e.showInviteUsersButton=t.emailFieldPermission&&e.moduleRecord[0]&&e.moduleRecord[0].viewable&&e.moduleRecord[0].visible,e.titleForDisableInviteButton=t.emailFieldPermission?e.moduleRecord[0]&&e.moduleRecord[0].viewable&&e.moduleRecord[0].visible?"":I18n.getMsg("custmr.prtl.invite.module.permission.missing"):I18n.getMsg("custmr.prtl.email.field.permission.denied")}));e.showInviteUsersButton=!1,e.titleForDisableInviteButton=I18n.getMsg("custmr.prtl.invite.module.permission.missing")},renderTemplate:function(){return{outlet:"#result",component:"crm-client-portal-user-type-users"}},afterRender:function(){var e=$L(".cpT_portalNameCtn").width()-($L(".cpT_modName").outerWidth()+$(".cpT_saveCancel").outerWidth()+80),t=$L("#cpT_navCtn"),r=$L("#portalUsersTable"),i=$(".cpT_listRow"),a=i.length,s=$L("#portalUsersTable .lyteTableScroll");if(a>0){var o=renderingUtils.windowHeight-(t.offset().top+29+17),n=s[0].scrollHeight,l=renderingUtils.windowHeight-(s.offset().top+29+17);$L(".cpT_portalName").css("max-width",e),t.css("height",o+"px"),r.css("height","auto"),s.scrollTop(0),n>l&&i.length>0&&r.css("height",l+"px")}},actions:{willTransition:function(e){"crm.settings.section.client-portal.user-types"!==e.target&&"crm.settings.section.client-portal"!==e.target||(e.data={},e.data.refresh=!0);var t=$L("#portalPreview").e;t&&t.remove();var r=$L("#changeUserTypePop").e;r&&r.remove();var i=$L("#cpT_reInviteUsersError");i&&i.e&&i.e.remove();var a=$L("#listViewPopup");a&&a[0]&&a[0].ltProp("show",!1)}}}),Lyte.Router.registerRoute("crm.settings.section.competitor-alerts.competitor-alert-create",{getResources:function(){return this.parent.getResourcesForAlertForm()},beforeModel:function(){return store.peekAll("competitor_alert").length>=store.peekAll("competitor_alert_meta")[0].max_alert_limit&&(crmui.showMsgBand("error",I18n.getMsg("crm.competitoralert.error.alert.maximum.limit",store.peekAll("competitor_alert_meta")[0].max_alert_limit),3e3),this.replaceWith("crm.settings.section.competitor-alerts.competitor-alerts-index")),this.checkAndDownloadChatFiles()},model:function(){var e={alertDetails:store.createRecord("competitor_alert",{},!0),configurationOptions:JSON.parse(JSON.stringify(store.peekAll("competitor_alert_meta")[0])),formHeading:I18n.getMsg("crm.competitoralert.alert.create.title"),competitorsCount:store.peekAll("competitor").length};return this.setTeamsForSlack(e),e},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.competitoralert.alert.create.title"),Crm.partnerName]))},actions:{willTransition:function(e){this.validateAndPerformTransition(e)}}},{mixins:["crm-competitor-alert-form-utils"]}),Lyte.Router.registerRoute("crm.settings.section.competitor-alerts.competitor-alert-record",{model:function(e){var t=store.peekRecord("competitor_alert",e.dynamicParam);return t||store.findRecord("competitor_alert",e.dynamicParam)},afterModel:function(e){e||(crmui.showMsgBand("error",I18n.getMsg("crm.competitoralert.error.invalid.alertid"),3e3),this.transition.abort())}}),Lyte.Router.registerRoute("crm.settings.section.competitor-alerts.competitor-alerts-index",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-competitor-alerts-index.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-competitor-alerts-index.css"],crmConstants.cssStaticPathForLyte),r=e.concat(t);return Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-competitor-alerts-index-rtl.css"],crmConstants.cssStaticPathForLyte))),r},model:function(){if(this.parent.currentModel.integrationNotEnabled)return{competitorAlerts:[],configurationOptions:{},integrationNotEnabled:!0};var e=Array.from(store.peekAll("competitor_alert"));return store.model.competitor_alert.addEventListener("remove",(function(t){Lyte.arrayUtils(e,"removeObject",t)})),{competitorAlerts:e,configurationOptions:store.peekAll("competitor_alert_meta")[0],activeCompetitorsCount:store.peekAll("competitor").length}},afterModel:function(e){e.competitorAlerts.forEach((function(t){var r=[];t.notifications.forEach((function(e){-1===r.indexOf(e.medium)&&r.push(e.medium)})),t.configuredMediums=[],r.forEach((function(r){t.configuredMediums.push(e.configurationOptions.mediumVsLabel[r])}))}))},renderTemplate:function(){return{outlet:"#competitorResult",component:"crm-competitor-alerts-index",reRender:!0}},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("zoho.email.incoming.competitors"),Crm.partnerName])),this.transition&&this.transition.data&&this.transition.data.showErrorAlert&&this.component.setData({showErrorAlert:!0})},actions:{willTransition:function(){store.model.competitor_alert.removeEventListener()}}}),Lyte.Router.registerRoute("crm.settings.section.competitor-alerts.competitor-alert-record.competitor-alert-edit",{getResources:function(){return this.parent.parent.getResourcesForAlertForm()},beforeModel:function(){return this.checkAndDownloadChatFiles()},model:function(){var e={alertDetails:store.peekRecord("competitor_alert",this.parent.getDynamicParam()),configurationOptions:JSON.parse(JSON.stringify(store.peekAll("competitor_alert_meta")[0])),formHeading:I18n.getMsg("crm.competitoralert.alert.update.title"),competitorsCount:store.peekAll("competitor").length};return e.groupedNotifications=this.getGroupedNotifications(e.alertDetails.notifications),this.setTeamsForSlack(e),e.configurationOptions.notification_mediums.forEach((function(t){e.groupedNotifications[t.name]&&(t.showUserLookup=!0)})),e.competitorsCount>=e.configurationOptions.max_competitors_limit&&(e.competitorInputDisabled=!0,e.competitorPlaceHolder=""),e},afterModel:function(e){e.fromList=this.transition.data&&this.transition.data.fromList},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.competitoralert.edit.alert.page.title"),Crm.partnerName]))},actions:{willTransition:function(e){this.validateAndPerformTransition(e)}}},{mixins:["crm-competitor-utils","crm-competitor-alert-form-utils"]}),Lyte.Router.registerRoute("crm.settings.section.competitor-alerts.competitor-alert-record.competitor-alert-view",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-competitor-alerts-detail.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-competitor-alerts-detail.css"],crmConstants.cssStaticPathForLyte),r=e.concat(t);return Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-competitor-alerts-detail-rtl.css"],crmConstants.cssStaticPathForLyte))),r},model:function(){var e=store.peekRecord("competitor_alert",this.parent.getDynamicParam()),t=e.notifications.filter((function(e){return"users"===e.notificant_type&&"sales_signals"!==e.medium})).map((function(e){return e.notificant.id})),r={alertDetails:e,configurationOptions:store.peekAll("competitor_alert_meta")[0],groupedNotifications:this.getGroupedNotifications(e.notifications)};return t.length>0&&(t=t.filter((function(e,r){return t.indexOf(e)===r})),r.userDetails=store.findAll("user",{ids:t.join(",")},!0)),r},afterModel:function(e){e.userDetails&&(e.userIdVsZuid={},e.userDetails.forEach((function(t){e.userIdVsZuid[t.id]=t.zuid})),this.currentModel=e)},renderTemplate:function(){return{outlet:"#competitorResult",component:"crm-competitor-alerts-detail"}},afterRender:function(e){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.competitoralert.view.alert.page.title",e.alertDetails.name),Crm.partnerName]))}},{mixins:["crm-competitor-utils"]}),Lyte.Router.registerRoute("crm.settings.section.compliance.consent-dashboard",{getResources:function(){return networkUtils.returnDependencyFiles(["zcrm_privacy_settings.js"])},beforeModel:function(e){Crm.userDetails.permissions.Crm_Implied_Manage_Compliance_Settings||(renderingUtils.displayPermissionDenied(),this.transition.abort()),this.invokeRedirection()},model:function(e){commonUtils.showHideLoadingDiv(!0);return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PrivacyDashboard.do?action=loadDashboards","GET",{params:null})},renderTemplate:function(e,t){if(e.modules&&0!=e.modules.length)return CrmPrivacyDashboard.consentPicklist=e.consentPicklist,CrmPrivacyDashboard.requestPicklist=e.requestPicklist,(!e.consentPicklist||e.consentPicklist.length<1||!e.requestPicklist||e.requestPicklist.length<1)&&(murphy.info("Response json: "),murphy.info(e)),{outlet:"#result",html:Handlebars.templates.PrivacyDashboards(e)};var r=I18n.getMsg("crm.privacy.no.module.permission");setTimeout((function(){renderingUtils.showCustomAlert(r,void 0,!1,(function(){Lyte.Router.transitionTo({route:"crm.settings.section.compliance.privacy-preference"})}))}),1)},afterRender:function(e,t){e.modules&&0!=e.modules.length&&($L(".gdpr_contenttabMenu_wrapper").show(),commonUtils.showHideLoadingDiv(),thirdPartyUtils.bindSelect2(".moduleSelect"),CrmPrivacyDashboard.populateConsentDashboard(),CrmPrivacyDashboard.populateRequestDashboard())},actions:{willTransition:function(e){-1===e.info.route.indexOf("crm.settings.section.compliance")&&(setTimeout((function(){$("#result").removeClass("freezeprivacySettingsTabContent")}),200),privacySettings.preferenceJson={},privacySettings.configJson={}),"crm.settings.section.compliance"===e.info.route&&(Crm.userDetails.isPrivacySettingEnabled||Lyte.Router.transitionTo({route:"crm.settings.section.compliance.privacy-preference"})),Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||!ZohoHCAsap.UnInstall||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall()),$L("#setupInnerLinks").find(".gdpr_tabClass").removeClass("oH"),$("#privacy_subtabdiv").find("#sub_consentDashboard").parent().removeClass("sel")},didTransition:function(){this.transition.refresh&&this.refresh(),$L("#setupInnerLinks").find(".gdpr_tabClass").addClass("oH")}},invokeRedirection:function(){if(Crm.userDetails.isPrivacyPrefTablesCreated){if(!Crm.userDetails.isPrivacySettingEnabled){var e;(e=Object.assign({},this.transition.info)).route="crm.settings.section.compliance.privacy-preference",this.replaceWith(e)}}else(e=Object.assign({},this.transition.info)).route="crm.settings.section.compliance",this.replaceWith(e)}}),Lyte.Router.registerRoute("crm.settings.section.compliance.consent-form",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zcrm_privacy_settings.js"]);return e=e.concat(networkUtils.returnDependencyFiles(["privacy-preference.js","crm-permission-dropdown.js","lyte-scrollTo.js","lyte-hovercard.js"],crmConstants.jsStaticPathForLyte)),e=Crm.userDetails.RTL_ENABLED?(e=e.concat(networkUtils.returnDependencyFiles(["privacy-preference.css","crm-permission-dropdown.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["privacy-preference-rtl.css"],crmConstants.cssStaticPathForLyte)):(e=e.concat(networkUtils.returnDependencyFiles(["crm-compliance-landing.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["privacy-preference.css","crm-permission-dropdown.css"],crmConstants.cssStaticPathForLyte))},getDependencies:function(){return networkUtils.returnDependencyFiles(["compliance-store.js","lyte-hovercard.js"],crmConstants.jsStaticPathForLyte)},redirect:function(){if(Crm.userDetails.permissions.Crm_Implied_Manage_Compliance_Settings||(renderingUtils.displayPermissionDenied(),this.transition.abort()),Crm.userDetails.isPrivacyPrefTablesCreated){if(!Crm.userDetails.isPrivacySettingEnabled){var e;(e=Object.assign({},this.transition.info)).route="crm.settings.section.compliance.privacy-preference",this.replaceWith(e)}}else(e=Object.assign({},this.transition.info)).route="crm.settings.section.compliance",this.replaceWith(e)},model:function(){if(Events.isPageLayoutModified=!1,commonUtils.showHideLoadingDiv(!0),Crm.userDetails.isPrivacySettingEnabled)return store.findAll("consent_form",{locale:Crm.userDetails.LOCALE});commonUtils.showHideLoadingDiv(!1)},afterModel:function(e){if(void 0!==e){this.currentModel={},this.currentModel.consent_form=e[0],this.currentModel.selectedLanguage=Crm.userDetails.LOCALE,this.currentModel.original_consent_form=Lyte.deepCopyObject(e[0]),this.currentModel.isRevertAvailable=e[0].revertAvailable,this.currentModel.clientPortalKey=e[0].client_portal_key,this.currentModel.languages=this.setLanguagesInfo(e),this.currentModel.communicationPreferences=this.setSectionData("Communication_Preferences",e[0]),this.currentModel.consentStatement=this.setSectionData("Consent_Statment",e[0]),this.currentModel.privacyStatement=this.setSectionData("Privacy_Statment",e[0]),this.currentModel.submitButton=this.setSectionData("Submit_Button",e[0]);for(var t=e[0].sections.length,r=0;r<t;r++){var i=e[0].sections[r];switch(i.api_name){case"Communication_Preferences":this.currentModel.prefsectionShown=i.visible;break;case"Consent_Statment":this.currentModel.consentStatementShown=i.visible;break;case"Privacy_Statment":this.currentModel.privacyStatementShown=i.visible;for(var a=i.fields.length,s=0;s<a;s++){var o=i.fields[s];"Privacy_Policy"===o.api_name&&(this.currentModel.privacyPolicy=o.value.length>0?o.value:"")}}}void 0!==Crm.userDetails.orgName?this.currentModel.companyName=Crm.userDetails.orgName:this.currentModel.companyName=I18n.getMsg("crm.gallery.template.dummy.companyname"),void 0!==Crm.userDetails.org_logo&&(this.currentModel.companyLogo="/crm/viewInLineImage?fileContent="+Crm.userDetails.org_logo)}},renderTemplate:function(){return{outlet:"#result",component:"crm-consent-form"}},afterRender:function(e,t){$L(".gdpr_contenttabMenu_wrapper").show(),commonUtils.showHideLoadingDiv(),$L("#setupInnerLinks").find(".gdpr_tabClass").addClass("oH")},actions:{willTransition:function(e){if(-1===e.info.route.indexOf("crm.settings.section.compliance")&&(setTimeout((function(){$("#result").removeClass("freezeprivacySettingsTabContent")}),200),privacySettings.configJson={},privacySettings.preferenceJson={}),$("#privacy_subtabdiv").find("#sub_consentForm").parent().removeClass("sel"),void 0!==Events.isPageLayoutModified&&Events.isPageLayoutModified){var t=e.pause(),r="stayonPageConfirmBox",i=$("#"+r);freezeBackground(),mailsetCenter(r),i.find(".leavePage").off("click").click((function(){i.hide(),t.resume(),removeFreezeLayer(),Events.isPageLayoutModified=!1})),i.find(".stayPage").off("click").click((function(){i.hide(),e.abort(),$("#privacy_subtabdiv").find("#sub_consentForm").parent().addClass("sel"),removeFreezeLayer()})),i.focus()}else"crm.settings.section.compliance"===e.info.route&&(Crm.userDetails.isPrivacySettingEnabled?Lyte.Router.transitionTo({route:"crm.settings.section.compliance.consent-dashboard"}):Lyte.Router.transitionTo({route:"crm.settings.section.compliance.privacy-preference"}));return $L("#setupInnerLinks").find(".gdpr_tabClass").removeClass("oH"),Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||!ZohoHCAsap.UnInstall||(ZohoHCAsap.UnInstall(),removeViewPortFromAsapWidget()),!0}}},{mixins:["crm-compliance"]}),Lyte.Router.registerRoute("crm.settings.section.compliance.hipaa",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-hipaa-compliance.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("hipaaCompliance")]);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-hipaa-compliance.css"],crmConstants.cssStaticPathForLyte))).concat(t)},getDependencies:function(){return networkUtils.returnDependencyFiles(["hipaa-store.js"],crmConstants.jsStaticPathForLyte)},beforeModel:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Compliance_Settings||(renderingUtils.displayPermissionDenied(),this.transition.abort())},model:function(){return Lyte.resolvePromises({privacy_preference:Crm.userDetails.isHipaaFeatureEnabled?store.findAll("hipaa_compliance"):[]})},afterModel:function(e){this.currentModel={},void 0!==e&&(this.currentModel.privacy_preference=e.privacy_preference)},renderTemplate:function(){return $L(".gdprTopBand").hide(),$L(".gdpr_contenttabMenu_wrapper").hide(),{outlet:"#result",component:"crm-hipaa-compliance"}},afterRender:function(){$("#result").removeClass("freezeprivacySettingsTabContent"),$(".gdpr_tabClass").show(),setTimeout((function(){$(".hipaaSettingActionWrap").show()}),700)},redirect:function(){Crm.userDetails.permissions.Crm_Implied_Manage_Compliance_Settings&&Crm.userDetails.hipaaTabAvailable&&Crm.userDetails.IS_ADMIN||(renderingUtils.displayPermissionDenied(),this.transition.abort())},actions:{willTransition:function(e){"crm.settings.section.compliance"===e.target&&(e.refresh=!0);var t=$L("#saveSettings");if(null!=t[0]&&0!==t[0].length&&!t[0].ltProp("disabled")){var r=e.pause(),i="stayonPageConfirmBox",a=$("#"+i);freezeBackground(),mailsetCenter(i),a.find(".leavePage").off("click").click((function(){store.peekAll("privacy_preference")[0].preference=store.peekAll("privacy_preference").unChangedPreference,a.hide(),r.resume(),removeFreezeLayer()})),a.find(".stayPage").off("click").click((function(){a.hide(),e.abort(),removeFreezeLayer()})),a.focus()}},didTransition:function(){$(".complianceAlter").hide()}}}),Lyte.Router.registerRoute("crm.settings.section.compliance.privacy-preference",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zcrm_privacy_settings.js"]);return e=e.concat(networkUtils.returnDependencyFiles(["privacy-preference.js","crm-permission-dropdown.js","lyte-scrollTo.js","lyte-hovercard.js"],crmConstants.jsStaticPathForLyte)),e=Crm.userDetails.RTL_ENABLED?(e=e.concat(networkUtils.returnDependencyFiles(["privacy-preference.css","crm-permission-dropdown.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["privacy-preference-rtl.css"],crmConstants.cssStaticPathForLyte)):(e=e.concat(networkUtils.returnDependencyFiles(["crm-compliance-landing.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["privacy-preference.css","crm-permission-dropdown.css"],crmConstants.cssStaticPathForLyte))},getDependencies:function(){return networkUtils.returnDependencyFiles(["compliance-store.js","lyte-hovercard.js"],crmConstants.jsStaticPathForLyte)},beforeModel:function(e){if(Crm.userDetails.permissions.Crm_Implied_Manage_Compliance_Settings||(renderingUtils.displayPermissionDenied(),this.transition.abort()),!Crm.userDetails.isPrivacyPrefTablesCreated){var t=Object.assign({},this.transition.info);t.route="crm.settings.section.compliance",this.replaceWith(t)}Crm.trackSpotLightAction("Privacy Preference Settings - Clicked")},model:function(){return commonUtils.showHideLoadingDiv(!0),void 0!==store.peekAll("privacy_preference")[0].config&&store.peekAll("privacy_preference")[0].config.hasOwnProperty("section")?void 0===store.peekAll("privacy_preference")[0].preference||"false"!==store.peekAll("privacy_preference")[0].preference.privacy_setting_status||this.settingsObj.isSettingsEnableDisableCall||"filed_in_use"!==store.peekAll("privacy_preference")[0].error_type?store.peekAll("privacy_preference"):store.findAll("privacy_preference"):void 0!==store.peekAll("privacy_preference")[0]&&store.peekAll("privacy_preference")[0].config.hasOwnProperty("section")?store.peekAll("privacy_preference"):store.findAll("privacy_preference")},afterModel:function(e){this.currentModel={},void 0!==e&&(this.currentModel.privacy_preference=e,this.setPreferenceData(e),this.currentModel.consentModules=this.showConsentModules(),this.currentModel.brandName=Crm.brandName,this.currentModel.privacyModuleLimit=Crm.userDetails.privacyModuleLimit,this.currentModel.awaitingActions=this.showAwaitingActions(),this.currentModel.awaitingPeriod=this.showAwaitingPeriod(),this.currentModel.personalDataRestrictions=this.showDataRestrictions(),this.currentModel.tptRestrictions=this.showRestrictionsTpt(),this.currentModel.oldprivacyPreference=e[0].preference,e.unChangedPreference=Lyte.deepCopyObject(this.currentModel.privacy_preference[0].preference))},renderTemplate:function(){var e=$("crm-setup-innerlink")[0];return null!=e&&e.setData({currentRouteInfo:this.transition.info,currentRoute:this.transition.info.route}),$("#settingsEnableSwitch").show(),{outlet:"#result",component:"crm-privacy-preference"}},afterRender:function(e,t){var r=$L("crm-privacy-preference")[0].component;$L(".gdpr_contenttabMenu_wrapper").show();var i=$L("crm-setup-innerlink")[0];i&&i.setData("currentRoute",this.transition.target),Crm.userDetails.isPrivacySettingEnabled?$("#preferencesSaveCancel").show():$("#preferencesSaveCancel").hide(),$($(".gdprComplianceSetting")[0]).addClass("sel"),commonUtils.showHideLoadingDiv(!1),thirdPartyUtils.bindSelect2($("#result").find(".consentDataProcessOptions, .sensitiveSelection")),r.setHeightForPrefSection()},actions:{willTransition:function(e){void 0!==e.info.route&&-1===e.info.route.indexOf("crm.settings.section.compliance")&&(setTimeout((function(){$("#result").removeClass("freezeprivacySettingsTabContent")}),200),privacySettings.configJson={},privacySettings.preferenceJson={});var t=$L("#saveSettings");if($("#privacy_subtabdiv").find("#sub_preference").parent().removeClass("sel"),null!=t[0]&&0!==t[0].length&&!t[0].ltProp("disabled")){var r=e.pause(),i="stayonPageConfirmBox",a=$("#"+i);freezeBackground(),mailsetCenter(i),a.find(".leavePage").off("click").click((function(){store.peekAll("privacy_preference")[0].preference=store.peekAll("privacy_preference").unChangedPreference,a.hide(),$("#privacy_subtabdiv").find("#sub_preference").parent().addClass("sel"),r.resume(),removeFreezeLayer()})),a.find(".stayPage").off("click").click((function(){a.hide(),e.abort(),removeFreezeLayer()})),a.focus()}"crm.settings.section.compliance"===e.info.route&&(Crm.userDetails.isPrivacySettingEnabled?Lyte.Router.transitionTo({route:"crm.settings.section.compliance.consent-dashboard"}):(e.abort(),Crm.userDetails.isPrivacyPrefTablesCreated&&$("#result").addClass("freezeprivacySettingsTabContent"))),Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||!ZohoHCAsap.UnInstall||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall())}}},{mixins:["crm-compliance"]}),Lyte.Router.registerRoute("crm.settings.section.compliance.consent-dashboard.list-view",{queryParams:["type","status","module","filters","cross_filters","sort_by","sort_order","page","per_page"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-list-view-modal.js","crm-column-list.js","crm-list-view.js","crm-inner-list.js","crm-custom-view.js","crm-custom-filter.js","crux-smart-filter.js","crux-smart-filter-input.js","crm-customview-helpers.js","crm-vision-helper.js","crm-list-helpers.js"],crmConstants.jsStaticPathForLyte);return e=(e=e.concat(networkUtils.returnDependencyFiles(["zcrm_privacy_settings.js"]))).concat(networkUtils.returnDependencyFiles(["crm-list-view-new.css","crux-smart-filter.css","custom-view-layer-new.css","crm-page-navigator.css","custom-view-layer-common.css","crm-list-view-crux.css","crm-inner-list-new.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-list-view-new-rtl.css","custom-view-layer-new-rtl.css"],crmConstants.cssStaticPathForLyte))),e},beforeModel:function(e){if(Crm.userDetails.permissions.Crm_Implied_Manage_Compliance_Settings||(renderingUtils.displayPermissionDenied(),this.transition.abort()),Crm.userDetails.isPrivacyPrefTablesCreated){if(!Crm.userDetails.isPrivacySettingEnabled){var t;(t=Object.assign({},this.transition.info)).route="crm.settings.section.compliance.privacy-preference",this.replaceWith(t)}}else(t=Object.assign({},this.transition.info)).route="crm.settings.section.compliance",this.replaceWith(t)},model:function(e){var t=this.getQueryParams();if(t.status=t.status?t.status:"Pending",t.type=t.type?t.type:"consent",!t.module){t.module="consent"===t.type?$("#consentModules").val():$("#requestModules").val();var r=Object.assign({},this.transition.info);return r.queryParams=t,void this.replaceWith(r)}void 0===moduleRecordMapping[t.module]&&(renderingUtils.showCustomAlert(I18n.getMsg("module.not.available"),void 0,!1,(function(){Lyte.Router.transitionTo("crm.settings.section.compliance.consent-dashboard").refresh=!0})),Lyte.Router.getRouteInstance().transition.abort()),Crm.trackSpotLightAction("GDPR - View Click",{Module:t.module,Type:t.type,Status:t.status}),this.currentModel={}},renderTemplate:function(e,t){crmListView.getObject().isPrivacyListView=!0;var r={queryParams:{}};if(customViewObject.modalQueryObj)for(var i in customViewObject.modalQueryObj)r.queryParams[i]=customViewObject.modalQueryObj[i];this.loadModal(t.queryParams.module,"COMPLIANCE",r,!0)},afterRender:function(e,t){},actions:{onError:function(e,t,r,i){},willTransition:function(e){if("crm.tab.module.entity.detail"!==e.info.route||!e.data||!e.data.cvid){var t=$L("crm-list-view-modal")[0];t&&t.component.executeMethod("closePopUp")}if(-1===e.info.route.indexOf("crm.settings.section.compliance")&&(setTimeout((function(){$("#result").removeClass("freezeprivacySettingsTabContent")}),200),privacySettings.configJson={},privacySettings.preferenceJson={}),"crm.settings.section.compliance"===e.info.route&&(Crm.userDetails.isPrivacySettingEnabled?e.abort():Lyte.Router.transitionTo({route:"crm.settings.section.compliance.privacy-preference"})),"crm.settings.section.compliance.consent-dashboard"===e.info.route){customViewObject={};var r=void 0!==Events.isPageLayoutModified&&Events.isPageLayoutModified,i=this.transition.info.queryParams;if(i){var a=i.type;if(a){var s="consent"===a?$("#consentModules"):$("#requestModules");i.module&&s.val()!==i.module&&(s.val(i.module),r||s.trigger("change"))}}r&&(CrmPrivacyDashboard.populateConsentDashboard(),CrmPrivacyDashboard.populateRequestDashboard(),Events.isPageLayoutModified=!1)}},didTransition:function(){this.transition.refresh&&this.refresh()}}},{mixins:["crm-view-utils","crm-list-view-modal-util"]}),Lyte.Router.registerRoute("crm.settings.section.custom-view.create-custom-view",{queryParams:["module"],model:function(e){var t=e.queryParams.module;if(Crm.isActivitySplitDone&&t.Activities&&moduleRecordMapping.Activities.show_as_tab){var r=[t,moduleRecordMapping[t].cvid];return Lyte.Router.transitionTo({route:"crm.tab.module.custom-view.list",dynamicParams:r})}var i={action:"create"};i.module=t;var a={params:i};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CustomView.do","GET",a)},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.custom-view.cvid",{queryParams:["module"],model:function(e){var t=e.queryParams.module;if(Crm.isActivitySplitDone&&t.Activities&&moduleRecordMapping.Activities.show_as_tab){var r=[t,moduleRecordMapping[t].cvid];return Lyte.Router.transitionTo({route:"crm.tab.module.custom-view.list",dynamicParams:r})}var i={};i.cvid=e.dynamicParam,i.action="edit",i.module=e.queryParams.module;var a={params:i};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CustomView.do","GET",a)}}),Lyte.Router.registerRoute("crm.settings.section.custom-view.cvid.clone-custom-view",{renderTemplate:function(){return{outlet:"#show",html:this.parent.currentModel}},afterRender:function(){$(document.CreateCustomViewForm.cvid).remove(),$("#CloneCustomView,#cvcminfodiv,#cvdelbut,#romsgDv").hide(),$(".cv_noAction,.cv_innerAction,.cv_innerActionEl,.cv_noEditPermission").removeClass("cv_noAction cv_innerAction cv_innerActionEl cv_noEditPermission"),$("#customviewname").removeAttr("disabled"),$("#searchbtn").removeClass("dN");var e=$("#customviewname"),t=e.val();cvNames.push(t.toUpperCase());var r=t.match(/ \( [0-9]+ \)/gi);r&&r[0].length&&t.endsWith(r[0])?(r=parseInt(r[0].match(/[0-9]+/g))+1,t=t.replace(/ \( [0-9]+ \)/gi,"")):r="1",e.val(t+" ( "+r+" )").focus()}}),Lyte.Router.registerRoute("crm.settings.section.custom-view.cvid.edit-custom-view",{renderTemplate:function(){return{outlet:"#show",html:this.parent.currentModel}},afterRender:function(){var e=this.transition.info.dynamicParams[0],t=store.peekRecord("custom_view",e);Lyte.isRecord(t)||store.pushPayload("custom_view",{id:e})}}),Lyte.Router.registerRoute("crm.settings.section.email-deliverability.email-auth",{getDependencies:function(){return networkUtils.returnDependencyFiles(["email-auth.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("EmailAuthentication")],null).concat(networkUtils.returnDependencyFiles(["email-auth.css"],crmConstants.cssStaticPathForLyte))},model:function(){return Lyte.resolvePromises({emailauth:store.findAll("email_auth_record"),user:store.findAll("user",{ids:Crm.userDetails.USER_ID})})},afterModel(e){Crm.userDetails.IS_ADMIN&&(this.currentModel.limit=e.emailauth.pop().limit,this.currentModel.auth_records=e.emailauth,this.currentModel.isAdmin=e.user[0].profile.name===crmConstants.adminProfileName)},beforeExit:function(){store.unloadAll("email_auth_record")},renderTemplate:function(){return this.currentModel.isAdmin?{outlet:"#result",component:"crm-email-auth"}:void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))}}),Lyte.Router.registerRoute("crm.settings.section.email-configuration.email-compose-settings",{getDependencies:function(){return networkUtils.returnDependencyFiles(["email-compose-settings.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.getI18nJSUrl("emailcompose"),t=networkUtils.getI18nJSUrl("emaileditor");t=networkUtils.getI18nJSUrl("composesetting");var r=networkUtils.returnDependencyFiles(["inlineEmailCompose_min.js"],crmConstants.jsStaticPath).concat(networkUtils.returnDependencyFiles(["crm-email-subjectpop.js"],crmConstants.jsStaticPathForLyte)),i=networkUtils.returnDependencyFiles(["inline_ComposeEditor_min.css"],crmConstants.cssStaticPath).concat(networkUtils.returnDependencyFiles(["crm-email-subjectpop.css"],crmConstants.cssStaticPathForLyte)),a=[e,t];Lyte.injectResources(networkUtils.returnDependencyFiles(a,crmConstants.jsStaticPath),void 0,void 0);var s=r.concat(i);return Lyte.injectResources(s,void 0,void 0),Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["email-compose-settings.css","email-compose-settings-rtl.css"],crmConstants.cssStaticPathForLyte).concat(s):networkUtils.returnDependencyFiles(["email-compose-settings.css"],crmConstants.cssStaticPathForLyte).concat(s)},beforeModel:function(){store.unloadAll("compose"),store.unloadAll("email_signatures")},model:function(){return Lyte.resolvePromises({from_addresses:store.triggerAction("emails","from_addresses",{},null,"GET"),meta:store.findAll("configuration_options"),usersetting:store.findAll("compose")}).then((function(e){for(var t=!1,r=[],i=[],a=[],s=[],o=[],n=Lyte.deepCopyObject(e.from_addresses.from_addresses),l=n.length,c=[],d=0;d<l;d++){for(var u=!1,m=n[d],p=store.peekAll("email_signatures"),g=p.length,f=0;f<g;f++)for(var h=p[f].from,y=h.length,v=0;v<y;v++)h[v].email!==m.email||h[v].user_name===m.user_name||c.contains(m.email)||!h[v].user_name&&!m.user_name||(n.deleteElementAt(d),l--,d--,u=!0,m.user_name?p[f].fromAddArray.push(m.user_name+"<"+h[v].email+">"):p[f].fromAddArray.push(h[v].email));"org_email"===m.type?m.user_name?i.push(m.user_name+"<"+m.email+">"):i.push(m.email):m.user_name?s.push(m.user_name+"<"+m.email+">"):s.push(m.email),!(u=!!c.contains(m.email))&&m.user_name?(r.push(m.user_name+"<"+m.email+">"),c.push(m.email)):u||(r.push(m.email),c.push(m.email)),u||o.push(m.email),a.includes(m.email)||(a.push(m.email),"primary"===m.type&&(t=!0))}t||(r.push(e.meta.primary_from_address.user_name+"<"+e.meta.primary_from_address.email+">"),o.push(e.meta.primary_from_address.email)),e.from_addresses.from=[],e.from_addresses.from.push({"":s}),0!==i.length&&e.from_addresses.from.push({orgemail:i});var _=r.length;for(f=0;f<_;f++)for(d=f+1;d<_;d++)if(r&&r[f]&&r[d]){var b=r[d],w=r[f],C=b.indexOf("<"),D=b.indexOf(">");-1!==C&&-1!==D&&C<D&&(b=b.slice(C+1,D)),C=w.indexOf("<"),D=w.indexOf(">"),-1!==C&&-1!==D&&C<D&&(w=w.slice(C+1,D)),w===b&&(r.deleteElementAt(d),d--,_--)}return store.peekAll("configuration_options")[0].fromAddrArray=r,store.peekAll("configuration_options")[0].fromWithoutName=o,e}),(function(e){if("NO_PERMISSION"===JSON.parse(e.response).code)return renderingUtils.displayPermissionDenied(),null}))},renderTemplate:function(e){if(null!==e)return{outlet:"#result",component:"crm-email-compose-settings"}},redirect:function(){this.transition.data.refresh&&(delete this.transition.data.refresh,this.refresh({refreshTemplate:!0}).data=this.transition.data)}}),Lyte.Router.registerRoute("crm.settings.section.email-intelligence.email-insights",{getDependencies:function(){return networkUtils.returnDependencyFiles(["email-insights.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("EmailInsights")],null).concat(networkUtils.returnDependencyFiles(["email-insights.css"],crmConstants.cssStaticPathForLyte))},model:function(){return Lyte.resolvePromises({emailInsights:store.findAll("email_insights_record"),user:store.findAll("user",{ids:Crm.userDetails.USER_ID})})},afterModel:function(e){var t=e.emailInsights.email_insights;this.currentModel.emailWorkFlow=-1!=="P,E,A,U,C,Z".indexOf(Crm.userDetails.LICENSE_TYPE),this.currentModel.isAdmin=Crm.userDetails.IS_ADMIN_ROLE||Crm.userDetails.PROFILE_NAME===crmConstants.adminProfileName,this.currentModel.isStandard="S"===Crm.userDetails.LICENSE_TYPE,this.currentModel.trackable=t.active,this.currentModel.modification=t.active?I18n.getMsg("crm.label.enabled"):I18n.getMsg("Disabled"),this.currentModel.modifiedby=t.modified_by.name;var r=this.getFormattedDate(t.modified_time);this.currentModel.modifiedon=r,this.currentModel.isAdmin=e.user[0].profile.name===crmConstants.adminProfileName},beforeExit:function(){store.unloadAll("email_insights_record")},renderTemplate:function(){return this.currentModel.isAdmin?{outlet:"#result",component:"crm-email-insights"}:void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))}},{mixins:["email-insights-util"]}),Lyte.Router.registerRoute("crm.settings.section.email-configuration.email-preference",{getDependencies:function(){return networkUtils.returnDependencyFiles(["email-preference-model.js"],crmConstants.jsStaticPathForLyte)},beforeModel:function(){return Crm.userDetails.isSandbox?(renderingUtils.displayAlert(null,null,I18n.getMsg("crm.security.error")),Lyte.Router.getRouteInstance().transition.abort(),!1):Crm.userDetails.IS_ADMIN?void 0:(renderingUtils.displayAlert(null,null,I18n.getMsg("crm.security.error")),Lyte.Router.getRouteInstance().transition.abort(),!1)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailPreferences")],null);return e=e.concat(networkUtils.returnDependencyFiles(["email-preference.js"],crmConstants.jsStaticPathForLyte))},model:function(){return store.findAll("email_preference")},afterModel:function(e){this.currentModel.enabled=e.email_preference.unsubscribe_link.enable},renderTemplate:function(){return{outlet:"#result",component:"crm-email-preference"}},actions:{onError:function(e){var t=JSON.parse(e.response);"NO_PERMISSION"!==t.code&&"FEATURE_NOT_ENABLED"!==t.code||(renderingUtils.displayAlert(null,null,I18n.getMsg("crm.security.error")),Lyte.Router.getRouteInstance().transition.abort())}}}),Lyte.Router.registerRoute("crm.settings.section.email-deliverability.email-relay",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["email-relay.js"],crmConstants.jsStaticPathForLyte);return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailrelay")],null).concat(e)},getResources:function(){return Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["email-relay-rtl.css","email-relay.css"],crmConstants.cssStaticPathForLyte):networkUtils.returnDependencyFiles(["email-relay.css"],crmConstants.cssStaticPathForLyte)},model:function(){return Lyte.resolvePromises({config:store.findAll("relay-config"),records:store.findAll("relay-record")}).then((function(e){return e}),(function(e){if("NO_PERMISSION"===JSON.parse(e.response).code)return renderingUtils.displayPermissionDenied(),null}))},renderTemplate:function(e){if(null!==e)return{outlet:"#result",component:"crm-email-relay"}}}),Lyte.Router.registerRoute("crm.settings.section.email-configuration.email-settings",{queryParams:["action","service","frmmode","isFromSI"],getResources:function(){networkUtils.returnDependencyFiles(["mailconfig-min.js"],crmConstants.jsStaticPathForLyte)},getDependencies:function(){var e=(e=networkUtils.returnDependencyFiles(["emailconfiguration.js","crux-tag.js"],crmConstants.jsStaticPathForLyte)).concat(networkUtils.returnDependencyFiles(["zohocrm_mailClient.js"])),t=networkUtils.returnDependencyFiles(["emailconfiguration.css"],crmConstants.cssStaticPathForLyte),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailconfiguration")],null);if(Crm.userDetails.RTL_ENABLED){var i=networkUtils.returnDependencyFiles(["emailconfiguration-rtl.css"],crmConstants.cssStaticPathForLyte);return e.concat(r).concat(t).concat(i)}return e.concat(r).concat(t)},beforeModel:function(e){"crm.settings.section.email-configuration.email-settings.email-create"===this.transition.target&&this.replaceWith("crm.settings.section.email-configuration.email-settings.email-index"),"crm.settings.section.email-configuration.email-settings.email-index"===this.transition.target||["mailSelect","imap","zmail"].contains(this.getQueryParams().action)||this.transition.abort()},model:function(e){if(this.transition.target){var t="GET",r=this.getQueryParams().action,i=this.getQueryParams().frmmode,a=this.getQueryParams().isFromSI,s=Crm.getCrmBasePath()+"/specific/IMAPAction.do",o="showIndex";"imap"===r?o="showConfig":"zmail"===r&&(s=Crm.getCrmBasePath()+"/ZMailConfig.do",o="checkConfiguration");var n={params:{action:o}};i&&"oauth"!==i&&(n.params.frmmode=i),a&&(crmTab.redirectToSalesInbox=a),"LicenseUsersUpdate"===this.transition.data.actionType&&(s=Crm.getCrmBasePath()+"/License.do",n={params:{}},t="POST");var l=objectUtils.cloneObject(this.transition.data);return delete l.permission,delete l.checkPermission,Object.assign(n.params,l),networkUtils.lyteInitiateRequest(s,t,n)}return{}},afterModel:function(e){var t;try{t="object"!=typeof e?JSON.parse(e):e}catch(t){return"crm.settings.section.email-configuration.email-settings.email-index"===this.transition.target&&Lyte.Router.replaceWith("crm.settings.section.email-configuration.email-settings",{action:"mailSelect"}),e}if("object"==typeof t&&("crm.settings.section.email-configuration.email-settings.email-index"!==this.transition.target||t.gmailSetup))if(!0===t.gmailSetup){Lyte.Router.getRouteInstance().transition.info.isFrom="gmailAPI";var r=this.transition.pause();Lyte.injectResources(networkUtils.returnDependencyFiles(["zohocrm_gmailSetup.js","gmailAPI-min.js"]),void 0,(function(){r.resume()}))}else"true"===t.mailappsflow&&this.replaceWith("crm.settings.section.email-configuration.email-settings.email-index");return t},renderTemplate:function(e,t){var r;if("crm.settings.section.email-configuration.email-settings.email-index"!==this.transition.target||e.gmailSetup){if(!crmSetup.isChildShowByFeature("crm.settings.section.email-configuration"))return $("#inner_result,#setupInnerLinks").html(""),void renderingUtils.showCustomAlert(I18n.getMsg("crm.security.error"));"object"==typeof e&&!0===e.gmailSetup&&(e=Handlebars.templates.gmailSetup(e)),r={outlet:"#result",html:e}}return r},afterRender:function(e,t){("crm.settings.section.email-configuration.email-settings.email-index"!==this.transition.target||"object"==typeof e&&1==e.gmailSetup)&&"object"==typeof e&&1==e.gmailSetup&&GmailAPI.onLoad(e),t.queryParams.frmmode&&"oauth"===t.queryParams.frmmode&&(Lyte.Router.getRouteInstance().transition.isFrom="oauth"),$("#result").addClass("crmEmailConfigDiv")},beforeExit:function(){$("#result").removeClass("crmEmailConfigDiv")}}),Lyte.Router.registerRoute("crm.settings.section.email-configuration.email-sharing",{queryParams:["page","per_page"],getDependencies:function(){return networkUtils.returnDependencyFiles(["admin-email-sharing-mixin.js"],crmConstants.jsStaticPathForLyte).concat(networkUtils.returnDependencyFiles(["admin-email-sharing-model.js"],crmConstants.jsStaticPathForLyte))},getResources:function(){var e=networkUtils.returnDependencyFiles(["admin-email-sharing-components.js"],crmConstants.jsStaticPathForLyte);return e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["lyte-tree.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["admin-email-sharing.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailsharing")],null))).concat(networkUtils.returnDependencyFiles(["email-sharing.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["email-sharing-components.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["email-sharing-rtl.css"],crmConstants.cssStaticPathForLyte))),e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_adminemailsharing.js"]))},beforeModel:function(){return["F","N","L"].contains(Crm.userDetails.LICENSE_TYPE)?(renderingUtils.displayAlert(null,null,I18n.getMsg("crm.security.error")),Lyte.Router.getRouteInstance().transition.abort(),!1):Crm.userDetails.isSandbox?(this.transition.info.route="crm.settings.section",this.replaceWith(this.transition.info),!1):void 0},model:function(){if(crmSetup.setupObject["crm.settings.section.email-configuration"].sub_menus.find((e=>"crm.settings.section.email-configuration.email-sharing"===e.routeName)).sharingPreferenceAvailable)return Lyte.resolvePromises({roles:store.findAll("role")});return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/AdminEmailSharing.do","GET",{params:{action:"adminEmailSharing"}})},afterModel:function(e){if(crmSetup.setupObject["crm.settings.section.email-configuration"].sub_menus.find((e=>"crm.settings.section.email-configuration.email-sharing"===e.routeName)).sharingPreferenceAvailable){var t=this.createRolesList(e.roles);this.currentModel.ceoRoleId=this.getCeoRoleId(e.roles);var r=[{display_label:I18n.getMsg("crm.email.sharing.all.roles"),id:"no-filter"}].concat(t);this.currentModel.rolesList=r,this.currentModel.isSuperAdmin=Crm.userDetails.IS_ADMIN_ROLE,this.currentModel.currentAdminId=Crm.userDetails.USER_ID,this.currentModel.currentUserProfile=Crm.userDetails.PROFILE_NAME}},renderTemplate:function(e){return crmSetup.setupObject["crm.settings.section.email-configuration"].sub_menus.find((e=>"crm.settings.section.email-configuration.email-sharing"===e.routeName)).sharingPreferenceAvailable?this.currentModel.isSuperAdmin||this.currentModel.currentUserProfile===crmConstants.adminProfileName?{outlet:"#result",component:"crm-admin-email-sharing"}:void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")):AdminEmailSharing.constructAdminEmailSharingHeaders(e)},afterRender:function(e){$L("#noDataDiv").hide(),crmSetup.setupObject["crm.settings.section.email-configuration"].sub_menus.find((e=>"crm.settings.section.email-configuration.email-sharing"===e.routeName)).sharingPreferenceAvailable?this.emailSharingHeight():($("#result").addClass("crmEmailConfigDiv"),AdminEmailSharing.constructAdminEmailSharingTemplate(e))},beforeExit:function(){crmSetup.setupObject["crm.settings.section.email-configuration"].sub_menus.find((e=>"crm.settings.section.email-configuration.email-sharing"===e.routeName)).sharingPreferenceAvailable&&($("#result").removeClass("crmEmailConfigDiv"),store.unloadAll("email_sharing_action"))},actions:{didTransition:function(){this.transition.data.from_preference&&(objectUtils.removeKeyFromGivenObj(this.transition.data,"from_preference"),this.refresh({refreshTemplate:!0}).data=this.transition.data)}}},{mixins:["email-sharing-util"]}),Lyte.Router.registerRoute("crm.settings.section.email-configuration.organization-emails",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/OrgEmailAction.do","POST",{params:{pageTitle:"org.email.settings",action:"orgEmail"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(){$("#result").addClass("crmEmailConfigDiv")},beforeExit:function(){$("#result").removeClass("crmEmailConfigDiv")}}),Lyte.Router.registerRoute("crm.settings.section.email-intelligence.sentiment-model",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_ziaconfig.js"]),t=networkUtils.returnDependencyFiles(["zohocrm_ziaconfig.css"],crmConstants.cssStaticPath);return e.concat(t)},beforeModel:function(){Handlebars.registerPartial("ZiaConfigOverAllChkbox",Handlebars.templates.ZiaConfigOverAllChkbox),Handlebars.registerPartial("ZiaConfigChkbox",Handlebars.templates.ZiaConfigChkbox),Handlebars.registerPartial("ziaPredictionSetup",Handlebars.templates.ziaPredictionSetup)},redirect:function(){"crm.settings.section.zia.sentiment-model"==this.transition.target&&(this.transition.info.route="crm.settings.section.email-intelligence.sentiment-model",this.replaceWith(this.transition.info))},model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/EmailSentimentModelAction.do","GET",{params:{action:"sentimentModel"}})},getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_sentimentmodel.js",networkUtils.getI18nJSUrl("sentimentmodel")])},renderTemplate:function(e,t){var r=e;return"object"==typeof e&&(r=Handlebars.templates.SentimentModelDataHeaders(r)),{outlet:"#result",html:r}},afterRender:function(e,t){"ZIA"===e.CHOOSEN_MODEL?($("#ziaExist").attr("checked",!0),sentimentModel.showInitialModel(2,e)):"ORG"===e.CHOOSEN_MODEL&&($("#ziaownnew").attr("checked",!0),sentimentModel.showInitialModel(1,e)),e.IS_MODEL_DEFINED||($(".sentimentDisableNotification").show(),$(".sentimentModel_header").parent().addClass("disableNotify")),thirdPartyUtils.bindSelect2(".ziaExistingIndustrmodel");var r=$("#result");setTimeout((function(){r.removeClass("pR"),$(".sentimentkrploading").hide()}),200),r.css({height:"100%"}),crmLayout.Resize.Setup(),$(".publisSettingsContainer").css({width:renderingUtils.windowWidth-260,opacity:""}),$(".emailsentimentalcontenteditablediv").css({"max-height":renderingUtils.windowHeight-260})},actions:{onError:function(e,t,r){crmui.showMsgBand("failure",I18n.getMsg("crm.zia.config.not.saved"),1500)}}}),Lyte.Router.registerRoute("crm.settings.section.email-configuration.email-settings.email-create",{beforeModel:function(){void 0!==store.peekAll("email_configuration")&&store.unloadAll("email_configuration"),void 0!==store.peekAll("server_details")&&store.unloadAll("server_details"),void 0!==store.peekAll("folder_detail")&&store.unloadAll("folder_detail")},model:function(){var e=store.createRecord("email_configuration",{user_id:Crm.userDetails.USER_ID});return e.incoming_mail_server=store.createRecord("server_details",{type:"incoming"}),e.outgoing_mail_server=store.createRecord("server_details",{type:"outgoing"}),e},afterModel:function(e){this.currentModel.config=e},renderTemplate:function(){return{outlet:"#result",component:"crm-email-create"}}}),Lyte.Router.registerRoute("crm.settings.section.email-configuration.email-settings.email-edit",{model:function(){return store.findAll("email-configuration")},afterModel:function(e){if(e&&e.length){var t=e[0];this.currentModel=t}else this.currentModel=null},renderTemplate:function(){return{outlet:"#result",component:"email-create"}}}),Lyte.Router.registerRoute("crm.settings.section.email-configuration.email-settings.email-index",{getDependencies:function(){return networkUtils.returnDependencyFiles(["mailconfig-min.js"])},model:function(){var e=null,t=Lyte.Router.getRouteInstance().transition.info.isFrom;if(!t)return Lyte.resolvePromises({email_config:store.findAll("email_configuration"),folders:store.findAll("folder_detail")});if("cancelCreate"===t)e=null;else{if("cancelEdit"===t)return Lyte.resolvePromises({email_config:store.findAll("email_configuration"),folders:store.findAll("folder_detail")});"gmailAPI"===t&&Lyte.Router.replaceWith("crm.settings.section.email-configuration.email-settings",{action:"mailSelect"})}return e},afterModel:function(e){if(e&&e.email_config.length>0){var t=e.email_config[0];this.currentModel=t}else this.currentModel=null},renderTemplate:function(e){var t=Lyte.Router.getRouteInstance().transition.isFrom;return e?{outlet:"#result",component:"crm-email-info"}:"cancelCreate"===t?{outlet:"#result",component:"crm-email-setup"}:{outlet:"#result",component:"crm-email-index"}},afterRender:function(){"oauth"===Lyte.Router.getRouteInstance().transition.isFrom&&document.getElementsByTagName("crm-email-info")[0].setData("showImportFilter",!0)},actions:{onError:function(e){$L("#inner_result,#setupInnerLinks").html("");var t={val:I18n.getMsg("crm.button.label.back.to.home")},r={val:I18n.getMsg("crm.label.backToModule",["Settings"]),fn:function(){Lyte.Router.replaceWith("crm.settings")}};401===e.status?renderingUtils.showCustomConfirmMessageNewModel(I18n.getMsg("crm.security.error"),r,t):renderingUtils.showCustomAlert(I18n.getMsg("zb.common.error.PageTitle"))},willTransition:function(e){var t=store.peekRecord("email_configuration",Crm.userDetails.USER_ID),r=store.peekRecord("server_details","incoming"),i=store.peekRecord("server_details","outgoing"),a={val:I18n.getMsg("crm.button.cancel")},s={val:I18n.getMsg("crm.label.proceed"),fn:function(){store.peekRecord("email_configuration",Crm.userDetails.USER_ID).$.rollBack(),store.peekRecord("server_details","incoming").$.rollBack(),store.peekRecord("server_details","outgoing").$.rollBack(),Lyte.Router.getRouteInstance().transitionTo(e.target)}};t&&r&&i&&(t.$.getDirtyAttributes().length>0||r.$.getDirtyAttributes().length>0||i.$.getDirtyAttributes().length>0)&&(e.abort(),renderingUtils.showCustomConfirmMessageNewModel(I18n.getMsg("crm.zia.vision.unsave.title")+" "+I18n.getMsg("crm.zia.vision.unsave.msg"),s,a))}}}),Lyte.Router.registerRoute("crm.settings.section.email-configuration.email-sharing.email-sharing-preference",{getDependencies:function(){return networkUtils.returnDependencyFiles(["admin-email-sharing-mixin.js"],crmConstants.jsStaticPathForLyte).concat(networkUtils.returnDependencyFiles(["admin-email-sharing-preference-model.js"],crmConstants.jsStaticPathForLyte))},getResources:function(){var e=networkUtils.returnDependencyFiles(["admin-email-sharing-components.js"],crmConstants.jsStaticPathForLyte);return e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["lyte-tree.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["admin-email-sharing-preference.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailsharing")],null))).concat(networkUtils.returnDependencyFiles(["email-sharing-preference.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["email-sharing-components.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["email-sharing-preference-rtl.css"],crmConstants.cssStaticPathForLyte))),e},beforeModel:function(){if(Crm.userDetails.isSandbox)return renderingUtils.displayAlert(null,null,I18n.getMsg("crm.security.error")),Lyte.Router.getRouteInstance().transition.abort(),!1;return crmSetup.setupObject["crm.settings.section.email-configuration"].sub_menus.find((e=>"crm.settings.section.email-configuration.email-sharing"===e.routeName)).sharingPreferenceAvailable?["F","N","L"].contains(Crm.userDetails.LICENSE_TYPE)?(renderingUtils.displayAlert(null,null,I18n.getMsg("crm.security.error")),Lyte.Router.getRouteInstance().transition.abort(),!1):void 0:(this.transition.info.route="crm.settings.section.email-configuration.email-sharing",this.replaceWith(this.transition.info),!1)},model:function(){return Lyte.resolvePromises({roles:store.findAll("role")})},afterModel:function(e){var t=this.createRolesList(e.roles);this.currentModel.rolesList=t,this.currentModel.ceoRoleId=this.getCeoRoleId(e.roles),this.currentModel.isSuperAdmin=Crm.userDetails.IS_ADMIN_ROLE,this.currentModel.currentUserProfile=Crm.userDetails.PROFILE_NAME},renderTemplate:function(){return this.currentModel.isSuperAdmin||this.currentModel.currentUserProfile===crmConstants.adminProfileName?{outlet:"#result",component:"crm-admin-email-sharing-preference"}:void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))},beforeExit:function(){store.unloadAll("email_sharing_preference_action")},afterRender:function(){this.emailSharingHeight()},actions:{willTransition:function(e){if(crmSetup.setupObject["crm.settings.section.email-configuration"].sub_menus.find((e=>"crm.settings.section.email-configuration.email-sharing"===e.routeName)).sharingPreferenceAvailable){var t=e.pause();validationUtils.isEmpty(this.component.component.data.preferenceUpdateMap)?t.resume():("crm.settings.section.email-configuration.email-settings"===e.target?Lyte.Component.set(this.component.component.data,{isBack:!0,showAlertModal:!0,targetRoute:"crm.settings.section.email-configuration.email-settings.email-index"}):Lyte.Component.set(this.component.component.data,{isBack:!0,showAlertModal:!0,targetRoute:e.target}),t.abort())}}}},{mixins:["email-sharing-util"]}),Lyte.Router.registerRoute("crm.settings.section.mobile-apps.mobile-app",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-mobile-app-details.js"],crmConstants.jsStaticPathForLyte);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-zes-share.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-zes-share.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-mobile-app-details.css"],crmConstants.cssStaticPathForLyte))},model:function(e){return store.findRecord("mobile-app",e.dynamicParam,{},!0)},afterModel:function(e){var t=this.transition.data?this.transition.data:{},r=e.$.meta;t.app=e,["users","profiles","selected_user_ids","selected_profile_ids","mdm_users","user_info"].forEach((function(e){r[e]?t[e]=r[e]:t[e]=void 0})),this.currentModel=t},actions:{didTransition:function(){if(commonUtils.showHideLoadingDiv(),this.currentModel.mdm_users)return!1}}},{mixins:["crm-zes-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.mobile-apps.mobileapp-upload",{queryParams:["type","csr_page"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-zes-upload.js"],crmConstants.jsStaticPathForLyte);return(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-zes-share.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-zes-share.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-zes-upload.css"],crmConstants.cssStaticPathForLyte))},model:function(e){var t=validationUtils.isEmpty(this.transition.data)?{}:this.transition.data;return t.type="mobile",e.queryParams&&(t.csr_page=e.queryParams.csr_page),e.queryParams.type||t.apnCertUploaded?t:store.triggerAction("mobile-app","apn",{},void 0,"GET").then((function(e){return t.apnCertUploaded="true"!==e.show_apn,t}))},renderTemplate:function(e,t){var r="crm-zes-upload";return t.queryParams&&"csr"===t.queryParams.type&&(r="crm-zes-apn"),{outlet:"#result",component:r}},actions:{didTransition:function(){var e=document.getElementById("appInput");e&&e.removeUpload();var t=document.getElementById("enableiOS");t&&this.transition.data.showiOSDivVal&&t.click(),this.component.component.setData(this.transition.data),commonUtils.showHideLoadingDiv(!1)}}},{mixins:["crm-zes-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.mobile-apps.mobileapps-index",{queryParams:["page","traverse"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-mobile-apps.js"],crmConstants.jsStaticPathForLyte);return e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zesmobileapps")]))).concat(networkUtils.returnDependencyFiles(["crm-mobile-apps.css"],crmConstants.cssStaticPathForLyte))},model:function(e){var t={};return e.queryParams.traverse?t.traverse=e.queryParams.traverse:t.page=1,store.findAll("mobile-app",t,!0)},afterModel:function(e,t){this.currentModel={apps:e,records_count:e.$.meta.record_count,previous:e.$.meta.previous,next:e.$.meta.next,selectedApps:[],active:e.$.meta.active,searchValue:""},t.queryParams.page?(this.currentModel.recordStartIndex=20*(t.queryParams.page-1),this.currentModel.page=t.queryParams.page):this.currentModel.recordStartIndex=0,Lyte.registeredMixins["crm-zes-mixin"].prevSelApps&&(this.currentModel.selectedApps=Lyte.registeredMixins["crm-zes-mixin"].prevSelApps,delete Lyte.registeredMixins["crm-zes-mixin"].prevSelApps),this.currentModel.prevSelectedApp=this.transition.data.prevId,Lyte.registeredMixins["crm-zes-mixin"].searchVal&&(this.currentModel.searchValue=Lyte.registeredMixins["crm-zes-mixin"].searchVal,delete Lyte.registeredMixins["crm-zes-mixin"].searchVal)},redirect:function(e){e.active&&0===e.apps.length&&(this.replaceWith("crm.settings.section.mobile-apps.mobileapp-upload").data={showBackBtn:!1})},renderTemplate:function(){return{outlet:"#result",component:"crm-mobile-apps"}},afterRender:function(){this.transition.data.prevId&&setTimeout((function(){var e=document.getElementsByClassName("prevAppSel")[0];e&&e.classList.remove("prevAppSel")}),1e3)},actions:{didTransition:function(){commonUtils.showHideLoadingDiv(!1),this.titleOnHover($(".zesMobAppName"),200),document.getElementById("mainResult").style.display="block",(this.transition.data.searchVal||this.currentModel.searchValue)&&(Lyte.Router.getRouteInstance().component.setData("enableSearch",!0),document.querySelector("#zesMobileSearch").setValue(this.transition.data.searchVal?this.transition.data.searchVal:this.currentModel.searchValue))},willTransition:function(){this.component&&this.component.component.data&&(Lyte.registeredMixins["crm-zes-mixin"].prevSelApps=this.component.component.data.selectedApps),this.component&&this.component.component.data&&(Lyte.registeredMixins["crm-zes-mixin"].searchVal=this.component.component.data.searchValue)}}},{mixins:["crm-zes-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.mobile-apps.mobile-app.mobileapp-share",{model:function(){var e=Lyte.Router.getRouteInstance().parent.currentModel,t={},r={},i=e.selected_user_ids?e.selected_user_ids:[],a=e.selected_profile_ids?e.selected_profile_ids:[];i.length>0&&(t.ids=i.join(",")),a.length>0&&(r.ids=a.join(","));var s=[];e.selectedUserIds=s,e.selectedProfileIds=s;var o=[];return store.triggerAction("mobile-app","mdm_users",{},t,"GET").then((function(t){return t=t.user_list,e.allUsers=t.map((function(t){var r={name:t.name,id:"user_"+t.id,displayLabel:t.name};return"true"===t.selected&&(o.push(r),e.selectedUserIds.push(r.id)),r})),store.triggerAction("mobile-app","mdm_profiles",{},r,"GET").then((function(t){return t=t.profile_list,e.allProfiles=t.map((function(t){var r={name:t.name,id:"profile_"+t.id,displayLabel:t.display_label};return"true"===t.selected&&(o.push(r),e.selectedProfileIds.push(r.id)),r})),e.selectedObj=o,e}))}))},afterModel:function(){this.currentModel.showSharePage=!0},renderTemplate:function(){return this.currentModel.mdm_users&&(document.getElementById("setupInnerLinks").style.display="none",$(".setupleftmenutd").hide()),{outlet:"#result",component:"crm-mobile-app-details"}},didDestroy:function(){if(this.currentModel.mdm_users&&"mobileapp-view"!==this.getRouteInstance().routeName){var e=document.getElementById("mainResult");e.style.display="none",document.getElementById("setupInnerLinks").style.display="block",$(".setupleftmenutd").show(),e.style.display="block"}},actions:{didTransition:function(){commonUtils.showHideLoadingDiv(!1)}}},{mixins:["crm-zes-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.mobile-apps.mobile-app.mobileapp-view",{beforeModel:function(){this.transition.refresh&&this.parent.refresh()},model:function(){return Lyte.Router.getRouteInstance().parent.currentModel},afterModel:function(){return this.currentModel.showSharePage=!1},renderTemplate:function(){return this.currentModel.mdm_users&&(document.getElementById("setupInnerLinks").style.display="none",$(".setupleftmenutd").hide()),{outlet:"#result",component:"crm-mobile-app-details"}},didDestroy:function(){if(this.currentModel.mdm_users&&"mobileapp-share"!==this.getRouteInstance().routeName){var e=document.getElementById("mainResult");e.style.display="none",document.getElementById("setupInnerLinks").style.display="block",$(".setupleftmenutd").show(),e.style.display="block"}},actions:{didTransition:function(){commonUtils.showHideLoadingDiv(!1),this.titleOnHover($(".zesAppUser"),250),this.titleOnHover($(".zesUserMail"),300),this.titleOnHover($(".zesAppDesc"),320),this.titleOnHover($(".zesUpAppName"),520)}}},{mixins:["crm-zes-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.telephony.configuration",{queryParams:["headless","caller","frameorigin"],beforeModel:function(e){var t=store.peekAll("provider_conf")[0];if(t.$.get("isEnabled")){if(this.parent.getProviderNameFromURIName(e.dynamicParam)!=t.$.get("providerName")){var r=this.parent.getURINameFromProviderName(t.$.get("providerName"));this.replaceWith("crm.settings.section.telephony.configuration",r,e.queryParams)}}else this.replaceWith("crm.settings.section.telephony.marketplace")},model:function(e){var t=store.peekAll("provider_conf")[0],r=Crm.getCrmBasePath()+"/CtiApiConfig.do",i={params:{mode:"telephony",ctiname:t.$.get("providerName")}};return networkUtils.lyteInitiateRequest(r,"GET",i)},afterModel:function(e,t){if(e.isZticonfigured)this.currentModel=Handlebars.templates.ctiapi_provider_login_page(e);else if("object"==typeof e&&"providerEnabled"!=e.view&&!e.isZticonfigured){store.peekAll("provider_conf")[0].$.set("isEnabled",!1),Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.telephony.marketplace")}},renderTemplate:function(e,t){return{outlet:"#result",html:"object"==typeof e?Handlebars.templates.ctiapi_provider_detail_page(e):e}},afterRender:function(e){var t=store.peekAll("provider_conf")[0];if("PBX"==t.$.get("phoneViewType")){var r=this.transition.info.queryParams?this.transition.info.queryParams.from:null;ctiApiConfig.showPBXProviderDetails(t.$.get("providerName"),r)}$("#setupInnerLinks").hide(),commonUtils.showHideLoadingDiv()},actions:{changeToDisableView:function(){store.peekAll("provider_conf")[0].$.set("isEnabled",!1),ctiApiConfig.providerListData=null,Crm.isHeadless?CTIAPI.IFrame.backToProviderList():Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.telephony.marketplace")},willTransition:function(e){var t=store.peekAll("provider_conf")[0],r=e.pause();!t.$.get("isEnabled")||"crm.settings.section.telephony.marketplace"!==e.target&&"crm.settings.section.telephony.summary"!==e.target?r.resume():(r.abort(),this.transitionTo("crm.settings.index"))}},beforeExit:function(){$("#setupInnerLinks").show()}}),Lyte.Router.registerRoute("crm.settings.section.telephony.marketplace",{beforeModel:function(e){var t=store.peekAll("provider_conf")[0];if(t.$.get("isEnabled")){var r=this.parent.getURINameFromProviderName(t.$.get("providerName"));this.replaceWith("crm.settings.section.telephony.configuration",r)}Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||initAsap("Telephony")},model:function(){if(Crm.userDetails.ZPBENABLED&&window.PB)return"";var e=ctiApiConfig.providerListData;if(validationUtils.isEmpty(e)){var t=Crm.getCrmBasePath()+"/CtiApiConfig.do",r={params:{mode:"telephony"}};return networkUtils.lyteInitiateRequest(t,"GET",r)}return e},afterModel:function(e,t){if("object"==typeof e)if("providerList"===e.view)ctiApiConfig.setProviderData(e);else if("providerEnabled"===e.view){var r=this.parent.getURINameFromProviderName(e.provider);this.replaceWith("crm.settings.section.telephony.configuration",r)}else"singleProvider"===e.view&&this.replaceWith("crm.settings.section.telephony.summary",e.providerName)},renderTemplate:function(e,t){if(!Crm.userDetails.ZPBENABLED)return{outlet:"#result",html:"object"==typeof e?Handlebars.templates.ctiapi_providers_list(ctiApiConfig.providerListData):e};if(window.PB){var r=renderingUtils.windowHeight-$("#setup_new_ContentDiv").offset().top-26;$("#result").empty();var i=PB.loadSetup(r);document.getElementById("result").appendChild(i)}},afterRender:function(){$("#result,#setupSpace").addClass("helpOverflowHide"),commonUtils.showHideLoadingDiv();var e=store.peekAll("provider_conf")[0];if(validationUtils.isNotEmpty(e.$.get("providerName"))){var t=e.$.get("providerName");t=(t=t.replace(".","\\.")).replace(/\s/g,"\\ "),$("html, body").scrollTop($("#"+t).offset().top)}Crm.trackSpotLightAction("Telephony Clicked")},actions:{willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||!ZohoHCAsap.UnInstall||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall()),$("#result,#setupSpace").removeClass("helpOverflowHide")}}}),Lyte.Router.registerRoute("crm.settings.section.telephony.phonebridgegroup",{queryParams:["headless","caller","frameorigin"],beforeModel:function(e){var t=store.peekAll("provider_conf")[0];if(t.$.get("isEnabled")&&"PBX"!=t.$.get("phoneViewType")){var r=this.parent.getURINameFromProviderName(t.$.get("providerName"));this.replaceWith("crm.settings.section.telephony.configuration",r,e.queryParams)}else if(t.$.get("isEnabled")&&this.parent.getProviderNameFromURIName(e.dynamicParam)!=t.$.get("providerName")){r=this.parent.getURINameFromProviderName(t.$.get("providerName"));this.replaceWith("crm.settings.section.telephony.phonebridgegroup",r,e.queryParams)}else{var i=this.parent.getProviderNameFromURIName(e.dynamicParam);t.$.set("providerName",i)}},model:function(){return""},renderTemplate:function(e,t){return{outlet:"#result",html:"<div id='pbxGroup'></div>"}},actions:{changeToEnableView:function(e){var t=store.peekAll("provider_conf")[0];t.$.set("isEnabled",!0),t.$.set("providerName",e);var r=Lyte.Router.getRouteInstance().parent.getURINameFromProviderName(e);Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.telephony.configuration",r,Lyte.Router.getRouteInstance().getQueryParams())}}}),Lyte.Router.registerRoute("crm.settings.section.telephony.summary",{queryParams:["headless","caller","frameorigin"],beforeModel:function(e){var t=store.peekAll("provider_conf")[0];if(t.$.get("isEnabled")){var r=this.parent.getURINameFromProviderName(t.$.get("providerName"));this.replaceWith("crm.settings.section.telephony.configuration",r,e.queryParams)}else validationUtils.isEmpty(e.dynamicParam)&&this.replaceWith("crm.settings.section.telephony.marketplace")},model:function(e){var t=this.parent.getProviderNameFromURIName(e.dynamicParam);if(store.peekAll("provider_conf")[0].$.set("providerName",t),validationUtils.isEmpty(ctiApiConfig.providerListData)){var r=Crm.getCrmBasePath()+"/CtiApiConfig.do",i={params:{mode:"telephony",ctiname:t}};return networkUtils.lyteInitiateRequest(r,"GET",i)}return ctiApiConfig.allProviderInfo[t]},afterModel:function(e,t){"object"==typeof e&&(e.provider=e.providerName,e.detailObj&&(e.detailObj.provider=e.provider,e.detailObj.type=e.type))},renderTemplate:function(e,t){var r="";return"object"!=typeof e?r=e:e.detailObj?r=Handlebars.templates.ctiapi_provider_detail_page(e.detailObj):(Handlebars.registerPartial("twilioDetailView",Handlebars.templates.twilio_detailview),r=Handlebars.templates.ctiapi_provider_login_page(e)),{outlet:"#result",html:r}},afterRender:function(e,t){if("object"==typeof e&&!e.detailObj)switch(e.type){case"type2":ctiApiConfig.showType2ProviderDetails(e.provider,e.displayName);break;case"phonebridge":ctiApiConfig.showPBXProviderDetails(e.provider)}$("#setupInnerLinks").hide(),commonUtils.showHideLoadingDiv(),$("html, body").scrollTop(0,0)},actions:{changeToEnableView:function(e){var t=store.peekAll("provider_conf")[0];t.$.set("isEnabled",!0),t.$.set("providerName",e);var r=Lyte.Router.getRouteInstance().parent.getURINameFromProviderName(e);Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.telephony.configuration",r,Lyte.Router.getRouteInstance().getQueryParams())}}}),Lyte.Router.registerRoute("crm.settings.section.telephony.phonebridgegroup.createpbxgroup",{queryParams:["headless","caller","frameorigin"],model:function(e){var t=store.peekAll("provider_conf")[0],r=Crm.getCrmBasePath()+"/ZTIConfig.do",i={event:"showGroup",pbxtype:t.$.get("providerName")};Crm.isHeadless&&(i.headless=JSON.stringify(e.queryParams)),networkUtils.setCsrfParam(i);var a={params:i};return networkUtils.lyteInitiateRequest(r,"POST",a)},renderTemplate:function(e,t){return{outlet:"#pbxGroup",html:e}},afterRender:function(){$("#setupInnerLinks").hide(),commonUtils.showHideLoadingDiv()}}),Lyte.Router.registerRoute("crm.settings.section.telephony.phonebridgegroup.editpbxgroup",{queryParams:["headless","caller","frameorigin"],model:function(e){store.peekAll("provider_conf")[0];var t=Crm.getCrmBasePath()+"/ZTIConfig.do",r={event:"editGroup",groupid:e.dynamicParam};Crm.isHeadless&&(r.headless=JSON.stringify(e.queryParams)),networkUtils.setCsrfParam(r);var i={params:r};return networkUtils.lyteInitiateRequest(t,"POST",i)},renderTemplate:function(e,t){return{outlet:"#pbxGroup",html:e}},afterRender:function(){$("#setupInnerLinks").hide(),commonUtils.showHideLoadingDiv()}}),Lyte.Router.registerRoute("crm.settings.section.telephony.phonebridgegroup.viewpbxgroup",{queryParams:["headless","caller","frameorigin"],model:function(e){store.peekAll("provider_conf")[0];var t=Crm.getCrmBasePath()+"/ZTIConfig.do",r={event:"detailView",groupid:e.dynamicParam};Crm.isHeadless&&(r.headless=JSON.stringify(e.queryParams)),networkUtils.setCsrfParam(r);var i={params:r};return networkUtils.lyteInitiateRequest(t,"POST",i)},renderTemplate:function(e,t){return{outlet:"#pbxGroup",html:e}},afterRender:function(){$("#setupInnerLinks").hide(),commonUtils.showHideLoadingDiv()}}),Lyte.Router.registerRoute("crm.settings.section.webform.clone-webform",{queryParams:["module","name","layout_id"],getResources:function(){var e=networkUtils.returnDependencyFiles(["webform-builder.js","crm-privacy-policy.js","definition-model.js","assignment-rules-model-wrapper.js","crm-alert-addresswrapper.js","crux-tag.js","lyte-colorpicker.js","crux_"+Crm.userDetails.LOCALE+".js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["webform-builder.css","crm-alert-addresswrapper.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["webform-builder-RTL.css"],crmConstants.cssStaticPathForLyte))),e},beforeModel:function(e){commonUtils.showHideLoadingDiv(!0),this.checkPermission(e.queryParams.module,"webform")||this.showPermissionDenied(this.transition)},model:function(e){e.queryParams.name&&(e.queryParams.name=e.queryParams.name.trim());var t=this;return new Promise((function(r){var i,a=t.getModuleObjByApiName(e.queryParams.module),s=e.dynamicParam,o={builder_type:"webform",module:a,cloneForm:store.findRecord("webform",s,{module:a.api_name},void 0,!0,store.peekRecord("webform",s))};Lyte.resolvePromises(o).then((function(t){delete(i=t.cloneForm.$.toJSON()).id,i.analytics_data&&delete i.analytics_data.analytics_enabled_time,delete i.abtesting,i.name=e.queryParams.name,t.webform=store.createRecord("webform",i,!0),t.layouts=store.findAll("layout",{module:a.api_name,skip_permission:!0}),Lyte.resolvePromises(t).then((function(e){r(e)}))}))}))},afterModel:function(e,t){e.layouts=this.getLayoutsFromLayoutsAPI(e.layouts);for(var r=e.layouts.length,i=e.layouts[0],a=0;a<r;a++)if(t.queryParams.layout_id===e.layouts[a].id){i=e.layouts[a];break}var s=this.constructFieldsArrayFromResponse(i),o=this.constructWebFormFields(e.webform.fields,s,e.module.module_name);e.formName=e.webform.name,e.allFields=s,e.selectedLayout=i.id,e.webform.layout={id:i.id},e.webform.fields=o.selectedFieldsList,e.webform.fieldsToSelect=o.fieldsToSelect,e.webform.advancedFieldsToSelect=o.advancedFieldsToSelect},renderTemplate:function(){return{outlet:"#result",component:"crm-webform-builder"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1),window.onbeforeunload=function(){if(document.querySelector("crm-webform-builder"))return""}}},{mixins:["webform"]}),Lyte.Router.registerRoute("crm.settings.section.webform.create-webform",{queryParams:["module","name"],getResources:function(){var e=networkUtils.returnDependencyFiles(["webform-builder.js","crm-privacy-policy.js","definition-model.js","assignment-rules-model-wrapper.js","crm-alert-addresswrapper.js","crux-tag.js","lyte-colorpicker.js","crux_"+Crm.userDetails.LOCALE+".js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["webform-builder.css","crm-alert-addresswrapper.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["webform-builder-RTL.css"],crmConstants.cssStaticPathForLyte))),e},beforeModel:function(e){commonUtils.showHideLoadingDiv(!0),this.checkPermission(e.queryParams.module,"webform")||this.showPermissionDenied(this.transition)},model:function(e){e.queryParams.name&&(e.queryParams.name=e.queryParams.name.trim());var t=this.getModuleObjByApiName(e.queryParams.module),r=e.dynamicParam;r&&void 0!==r||(r=this.getBasicWebform(e.queryParams.name,t));var i={builder_type:"webform",module:t,webform:store.createRecord("webform",r),layouts:store.findAll("layout",{module:t.api_name,skip_permission:!0})};return Lyte.resolvePromises(i)},afterModel:function(e){for(var t=this.getLayoutsFromLayoutsAPI(e.layouts),r=this.getSystemLayout(t),i=null!=r?r:t[0],a=this.constructFieldsArrayFromResponse(i),s=a.length,o=[],n=0;n<s;n++){var l=a[n];(l.required||l.system_mandatory)&&o.push(l)}var c=this.constructWebFormFields(o,a,e.module.module_name);e.formName=e.webform.name,e.layouts=t,e.allFields=a,e.selectedLayout=i.id,e.webform.layout={id:i.id},e.webform.fields=c.selectedFieldsList,e.webform.fieldsToSelect=c.fieldsToSelect,e.webform.advancedFieldsToSelect=c.advancedFieldsToSelect},renderTemplate:function(){return{outlet:"#result",component:"crm-webform-builder"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1),window.onbeforeunload=function(){if(document.querySelector("crm-webform-builder"))return""}}},{mixins:["webform"]}),Lyte.Router.registerRoute("crm.settings.section.webform.edit-webform",{queryParams:["module"],getResources:function(){var e=networkUtils.returnDependencyFiles(["webform-builder.js","crm-privacy-policy.js","definition-model.js","assignment-rules-model-wrapper.js","crm-alert-addresswrapper.js","crux-tag.js","lyte-colorpicker.js","crux_"+Crm.userDetails.LOCALE+".js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["webform-builder.css","crm-alert-addresswrapper.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["webform-builder-RTL.css"],crmConstants.cssStaticPathForLyte))),e},beforeModel:function(e){commonUtils.showHideLoadingDiv(!0),this.checkPermission(e.queryParams.module,"webform",this.transition)},model:function(e){var t=e.dynamicParam,r=this.getModuleObjByApiName(e.queryParams.module),i={builder_type:"webform",action:"edit",webform:store.findRecord("webform",t,{module:r.api_name},void 0,void 0,store.peekRecord("webform",t)),layouts:store.findAll("layout",{module:r.api_name,skip_permission:!0},void 0,void 0,void 0),module:r};return Lyte.resolvePromises(i)},afterModel:function(e){var t=store.peekRecord("layout",e.webform.layout.id),r=this.constructFieldsArrayFromResponse(t),i=this.constructWebFormFields(e.webform.fields,r,e.module.module_name);e.formName=e.webform.name,e.layouts=this.getLayoutsFromLayoutsAPI(e.layouts),e.selectedLayout=e.webform.layout.id,e.allFields=r,e.webform.fields=i.selectedFieldsList,e.webform.fieldsToSelect=i.fieldsToSelect,e.webform.advancedFieldsToSelect=i.advancedFieldsToSelect},renderTemplate:function(){return{outlet:"#result ",component:"crm-webform-builder"}},afterRender:function(e){var t=null,r=e.webform.abtesting&&e.webform.abtesting.length>0?e.webform.abtesting[0]:null;!r||"drafted"===r.status||"launched"===r.status||this.transition.data&&this.transition.data.editConfirmation||(r.link="<link-to lt-prop-route='crm.settings.section.abtesting.view-abtesting.preview-abtesting' lt-prop-dp='[\""+r.id+'"]\' lt-prop-qp=\'{"module": "'+r.module.api_name+"\"}' lt-prop-target='_blank' lt-prop-rel='noopener noreferrer' class='wbbw'>"+$ESAPI.encoder().encodeForHTML(r.name)+"</link-to>",t={action:"editWarningShow",webform:e.webform,module:e.webform.module,editData:{abtesting:r,place:"webform_builder"}});var i=store.peekRecord("layout",e.webform.layout.id);!i||i.status<0?this.component.setData("commonActionData",{action:"layoutDeactivatedWarning",webform:e.webform,module:this.getModuleObjByApiName(e.webform.module.api_name),layoutsInfo:{layout:e.webform.layout,layouts:e.layouts,place:"webform_builder",callback:"edit",otherInfo:t,component:this.component}}):t&&this.component.setData("commonActionData",t),commonUtils.showHideLoadingDiv(!1),window.onbeforeunload=function(){if(document.querySelector("crm-webform-builder"))return""}},actions:{onError:function(e){e.constructor!==String&&e.response&&(e=e.response.constructor===String?JSON.parse(e.response).code:e.response.code),"NO_PERMISSION"!==e&&"INVALID_MODULE"!==e&&"INVALID_FORM_ID"!==e||(setTimeout((function(){renderingUtils.displayPermissionDenied()}),0),this.transition&&this.transition.abort())}}},{mixins:["webform"]}),Lyte.Router.registerRoute("crm.settings.section.webform.index-webform",{queryParams:["module","timeFilter"],renderThis:!0,getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-webforms-list.js","crm-webform-abtesting-create.js","abtesting-model.js","crux-video.js","webform-abtesting-demovideo.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-webforms-list.css","crm-webform-abtesting-create.css","webform-abtesting-demovideo.css"],crmConstants.cssStaticPathForLyte);return Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-webform-rtl.css"],crmConstants.cssStaticPathForLyte))),e.concat(t)},beforeModel:function(e){if(commonUtils.showHideLoadingDiv(!0),e.queryParams.module)this.checkPermission(e.queryParams.module,"webform")||this.showPermissionDenied(this.transition);else{var t=this.getFeatureSupportedModules("webform");t.length?e.queryParams.module=t[0].api_name:this.showPermissionDenied(this.transition)}},model:function(){var e=this.getQueryParams(),t={},r={module:e.module};if(Crm.webformAnalyticsEnabled){e.timeFilter||(e.timeFilter=JSON.stringify({filter:"all"})),e.timeFilter=$ESAPI.encoder().decodeFromURL(e.timeFilter),t.parsedJson=JSON.parse(e.timeFilter);var i=this.getWebFormAnalyticsDuration(t.parsedJson.filter,t.parsedJson.subFilter,t.parsedJson.filterValue,t.parsedJson.customStart,t.parsedJson.customEnd);t.filterObj={dateObject:i.timeFilter,displayName:i.selected_value},t.webform_dashboards=this.getAllWebFormAnalyticsDashBoard(),t.timeFilter=i.timeFilter,t.user_input=i.selected_value,t.analytics_data=this.getWebFormAnalyticData(e.module,i.timeFilter)}return t.webforms=store.findAll("webform",r,void 0,!0,{}),Lyte.resolvePromises(t)},afterModel:function(e,t){var r=e.webforms.$.meta.info;if(e.webform_available=r.webform_available,e.module=this.getModuleObjByApiName(t.queryParams.module),e.supportedModules=r.supported_module?r.supported_module:this.getFeatureSupportedModules("webform"),e.isChineseUser=Crm.userDetails.LOCALE.indexOf("zh")>-1,e.isHebrewUser=Crm.userDetails.LOCALE.indexOf("iw")>-1,e.analyticsEnabled=Crm.webformAnalyticsEnabled,Crm.webformAnalyticsEnabled){e.webforms||this.showPermissionDenied(this.transition),this.setWebformsAnalyticsData(e.webforms,void 0),e.analytics_data||this.showPermissionDenied(this.transition),e.webform_dashboards.forEach((function(t){null!==t.module||t.custom_module||(e.dashboardid=t.id)}));var i=!1;e.webforms.forEach((function(e){e.analytics_data&&e.analytics_data.analytics_enabled&&(i=!0)})),e.isTrackingEnabled=i,e.showOnBoarding=!1,0===e.webform_available?Crm.webformAnalyticsOnboardingEnabled=!0:e.webform_available>0&&!1===Crm.webformAnalyticsOnboardingEnabled&&(e.showOnBoarding=!0);var a=!!r.url_access_consent_status&&r.url_access_consent_status;e.webform_available>0&&!a&&(e.urlConsentPopupShow=!0)}},renderTemplate:function(){return networkUtils.initChart(),{outlet:"#result",component:"crm-webforms-list"}},afterRender:function(e){this.hideAndShowABTestTab(this.component),commonUtils.showHideLoadingDiv(!1);var t=$L("#selectModuleDrop")[0];t&&(t.ltProp("selected",""),t.ltProp("selected",e.module.api_name)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["webform-builder-RTL.css"],crmConstants.cssStaticPathForLyte)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["webform-builder.css","crm-alert-addresswrapper.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.isStorageLimitReached&&Crm.showStorageExceedPopup()},beforeExit:function(){Crm.userDetails.RTL_ENABLED&&(Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-webform-rtl.css"],crmConstants.cssStaticPathForLyte)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["webform-builder-RTL.css"],crmConstants.cssStaticPathForLyte)),Lyte.removeFromCache(networkUtils.returnDependencyFiles(["webform-builder.css","crm-alert-addresswrapper.css"],crmConstants.cssStaticPathForLyte)))},actions:{onError:function(){this.alertForInvaliedRequest(I18n.getMsg("crm.security.error"),"crm.settings.index"),this.transition&&this.transition.abort()}}},{mixins:["webform","webform-analytics-util"]}),Lyte.Router.registerRoute("crm.settings.section.webform.module-analytics",{queryParams:["module","timeFilter"],getResources:function(){var e;return e=networkUtils.returnDependencyFiles(["crm-webform-analytics-config_new.css"],crmConstants.cssStaticPathForLyte),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-webform-rtl.css"],crmConstants.cssStaticPathForLyte))),e},beforeModel:function(e){if(commonUtils.showHideLoadingDiv(!0),this.validateModule(e),!e.queryParams.timeFilter){e.queryParams.timeFilter=JSON.stringify({filter:"all"})}if(!store.peekRecord("webform-analytics",e.dynamicParam))return this.getAllWebFormAnalyticsDashBoard()},model:function(e){var t={dashboardid:e.dynamicParam,queryparam:e.queryParams,module:e.queryParams.module};return e.dynamicParam!==this.id&&(t.webform_analytics_arr=this.getAllWebFormAnalyticsComponents(e.queryParams.module,void 0,e.dynamicParam),this.id=e.dynamicParam),Lyte.resolvePromises(t)},afterModel:function(e){var t=this.getQueryParams();e.webform_analytics_arr&&(e.webform_analytics_arr=this.renderComponentsBasedOnType(e.module,store.peekRecord("webform-analytics",e.dashboardid),e.webform_analytics_arr));var r=JSON.parse(t.timeFilter),i=this.getWebFormAnalyticsDuration(r.filter,r.subFilter,r.filterValue,r.customStart,r.customEnd);e.timefilter=i.timeFilter,e.user_input=i.selected_value,e.isMoreStatsPage=!0},moreStatsPageSettings:function(){var e=$("#analyticsResult"),t=e.offset().top,r=renderingUtils.windowHeight-t;e.css("height",r-36+"px")},renderTemplate:function(){return{outlet:"#result",component:"crm-webform-analytics"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1),this.lazyLoadSettings("analyticsResult","webF_prvTabHead","crm-webform-analytics"),$L("body").addClass("oH");var e=$L("#webF_regionMapDetails"),t=$L("#webF_regionMapModal").height()-e.position().top;this.moreStatsPageSettings(),e.css("height",t)},actions:{onError:function(){this.showPermissionDenied(this.transition)}},beforeExit:function(){$L("body").removeClass("oH")}},{mixins:["webform","webform-analytics-util"]}),Lyte.Router.registerRoute("crm.settings.section.webform.view-webform",{queryParams:["module","timeFilter","location_url"],getResources:function(){var e=networkUtils.returnDependencyFiles(["webform-preview.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["webform-preview.css"],crmConstants.cssStaticPathForLyte))},beforeModel:function(e){if(commonUtils.showHideLoadingDiv(!0),this.validateModule(e),!e.queryParams.timeFilter){e.queryParams.timeFilter=JSON.stringify({filter:"all"})}},model:function(e){var t=this.getModuleObjByApiName(e.queryParams.module),r=store.findRecord("webform",this.getDynamicParam(),{module:e.queryParams.module},void 0,void 0,store.peekRecord("webform",this.getDynamicParam())),i=this.getQueryParams(),a={id:this.getDynamicParam(),queryparam:i,formdata:r,webform:r,module:t};return Crm.webformAnalyticsEnabled&&(a.webform_analytics_dashboard_arr=this.getAllWebFormAnalyticsDashBoard(i.module,this.getDynamicParam())),Lyte.resolvePromises(a)},afterModel:function(e){var t=this.transition.info.queryParams;if(t&&t.module||(this.transition.info.queryParams.module=e.module.api_name),e.webform_analytics_dashboard_arr){for(var r=this.getQueryParams(),i=Lyte.Component.registeredHelpers.getModuleNameByApiName(r.module),a=e.webform_analytics_dashboard_arr.length,s=this.CONSTANTS.DASHBOARDS,o=0;o<a;o++){var n=e.webform_analytics_dashboard_arr[o];switch(n.name){case s.WEBFORM_STATS_INDIVIDUAL_FORMS_SUBMISSION:n.item_name="Submission",n.display_item_name=I18n.getMsg("webform.analytics.view.submission"),n.zcqa="submissiontab",n.selected=!0;break;case s.WEBFORM_STATS_INDIVIDUAL_FORMS_REGION:n.item_name="Region",n.display_item_name=I18n.getMsg("webform.analytics.view.region"),n.zcqa="regiontab";break;case s.WEBFORM_STATS_INDIVIDUAL_FORMS_MODULES+i:n.item_name=i,n.display_item_name=Lyte.Component.registeredHelpers.getDisplayModuleName(i),n.zcqa="moduletab"}e.webform_analytics_dashboard_arr[o]=n}e.class_analytics="pL30 pR30"}},redirect:function(e){"crm.settings.section.webform.view-webform"===this.transition.info.route&&!0===this.transition.info.webform_analytics?this.transitionTo("crm.settings.section.webform.view-webform.webform-analytics",e.id,e.webform_analytics_dashboard_arr[0].id,e.queryparam):"crm.settings.section.webform.view-webform"===this.transition.target&&this.transitionTo("crm.settings.section.webform.view-webform.preview-webform",e.id,e.queryparam)},renderTemplate:function(){return{outlet:"#result",component:"crm-webform-view"}},afterRender:function(){this.lazyLoadSettings("analyticsResult","webF_prvTabHead","crm-webform-analytics"),this.setTitleforEllipsis(".webformName")},actions:{onError:function(e){e.constructor!==String&&e.response&&(e=e.response.constructor===String?JSON.parse(e.response).code:e.response.code),"NO_PERMISSION"!==e&&"INVALID_MODULE"!==e&&"INVALID_FORM_ID"!==e&&"INVALID_DATA"!==e||(setTimeout((function(){renderingUtils.displayPermissionDenied(),commonUtils.showHideLoadingDiv(!1)}),0),this.transition&&this.transition.abort())}}},{mixins:["webform","webform-analytics-util"]}),Lyte.Router.registerRoute("crm.settings.section.webform.view-webform.preview-webform",{queryParams:["module"],beforeModel:function(e){this.parent.component.setData({webform_analytics_page:!1}),this.checkPermission(e.queryParams.module,"webform",this.transition)},getResources:function(){if(Crm.userDetails.RTL_ENABLED)return networkUtils.returnDependencyFiles(["crm-webform-rtl.css"],crmConstants.cssStaticPathForLyte)},model:function(e){e.dynamicParam=this.parent.getDynamicParam();var t=this.getModuleObjByApiName(e.queryParams.module),r={webform:this.parent.component.getData("webform"),webformPreview:store.triggerAction("webform","preview",{id:e.dynamicParam},{module:e.queryParams.module},"GET"),module:t,analyticsEnabled:Crm.webformAnalyticsEnabled};return Lyte.resolvePromises(r)},afterModel:function(e){if(!e.webform)throw"INVALID_FORM_ID";var t=e.webformPreview.webforms[0],r=t.source_code;if(Crm.webformAnalyticsEnabled&&e.webform.analytics_data&&e.webform.analytics_data.analytics_enabled){var i=r.substring(r.indexOf("<script id='wf_anal'"),r.indexOf("</form>"));r=r.replace(i,"")}e.wf_source_code=r,$L.extend(e.webform,t)},renderTemplate:function(){return{outlet:"#webformPreview",component:"crm-webform-preview"}},afterRender:function(e){var t=renderingUtils.getHeightFromTabLayer(),r=t-$("#webformPrevHead").outerHeight(),i=$("#ABTestPreviewPart");this.updateDatePickerScript(e.wf_source_code,"crm-webform-preview"),this.setTitleforEllipsis(".webformName"),Lyte.registeredMixins["webform-analytics-util"].setPageHeaderWidth(".webF_formNameCtn",".webformName",[".wenF_modName"]),$("#webF_Preview").css("height",r),i.css("height",t-36),$("#WebFormPreviewPart").css("height",r-36),commonUtils.showHideLoadingDiv(!1)},beforeExit:function(){Crm.userDetails.RTL_ENABLED&&Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-webform-rtl.css"],crmConstants.cssStaticPathForLyte))},actions:{onError:function(e){e.constructor!==String&&e.response&&(e=e.response.constructor===String?JSON.parse(e.response).code:e.response.code),"NO_PERMISSION"!==e&&"INVALID_MODULE"!==e&&"INVALID_FORM_ID"!==e||(setTimeout((function(){renderingUtils.displayPermissionDenied(),commonUtils.showHideLoadingDiv(!1)}),0),this.transition&&this.transition.abort())}}},{mixins:["webform"]}),Lyte.Router.registerRoute("crm.settings.section.webform.view-webform.webform-analytics",{queryParams:["module","timeFilter","location_url"],getResources:function(){var e;return e=networkUtils.returnDependencyFiles(["crm-webform-analytics-config_new.css"],crmConstants.cssStaticPathForLyte),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-webform-rtl.css"],crmConstants.cssStaticPathForLyte))),e},beforeModel:function(e){if(commonUtils.showHideLoadingDiv(!0),this.validateModule(e),!e.queryParams.timeFilter){e.queryParams.timeFilter=JSON.stringify({filter:"all"})}this.parent.component.setData({webform_analytics_page:!0}),this.setPageHeaderWidth(".webF_formNameCtn",".webF_formName",[".webF_modName",".webF_allFilterHolder"])},model:function(){var e=this.parent.getDynamicParam(),t=this.getDynamicParam(),r=this.getQueryParams(),i=JSON.parse(r.timeFilter),a=this.getWebFormAnalyticsDuration(i.filter,i.subFilter,i.filterValue,i.customStart,i.customEnd);this.parent.component.setData({user_input:a.selected_value});var s,o=this.getDayWeekMonthChartObject(i.filter,i.subFilter,i.filterValue,i.customStart,i.customEnd);o.forEach((function(e){"true"===e.selected&&(s=e.value)}));var n=store.peekRecord("webform-analytics",e);n||(n=this.getWebFormAnalyticData(r.module,a.timeFilter));var l={queryparam:r,default_period:s,timefilter:a.timeFilter,location_url:r.location_url,webformid:e,day_week_month:o,form_analytics_data:n};this.dashboardid!==t&&(l.webform_analytics_arr=this.getAllWebFormAnalyticsComponents(r.module,e,t),l.selected_dashboard_id=t,this.dashboardid=t,l=Object.assign(l,this.parent.component.getData()));var c=this.parent.component.getData("webform");return void 0===store.peekRecord("layout",c.layout.id)&&(l.layoutObj=store.findRecord("layout",c.layout.id,{module:r.module,skip_permission:!0})),this.setPageHeaderWidth(".webF_formNameCtn",".webF_formName",[".webF_modName",".webF_allFilterHolder"]),Lyte.resolvePromises(l)},afterModel:function(e){var t=this.getQueryParams();e.module=t.module,e.webform_analytics_arr&&(e.webform_analytics_arr=this.renderComponentsBasedOnType(t.module,store.peekRecord("webform-analytics",this.getDynamicParam()),e.webform_analytics_arr))},renderTemplate:function(){return{outlet:"#webformPreview",component:"crm-webform-analytics"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1);var e=$L("#analyticsResult");$L("#setup_new_ContentDiv").scrollTop(0),e.scrollTop(0);var t=e.offset().top,r=renderingUtils.windowHeight-(t+15);e.css("height",r-28+"px");var i=renderingUtils.getHeightFromTabLayer()-$("#webformPrevHead").outerHeight();$("#webF_Preview").css("height",i),$("#WebFormPreviewPart").css("height",renderingUtils.getHeightFromTabLayer()-36)},actions:{onError:function(){this.transition&&this.showPermissionDenied(this.transition)}}},{mixins:["webform","webform-analytics-util"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.all-extensions",{beforeModel:function(e){var t=this,r=t.transition;if(r.info.queryParams.activate&&"crm.settings.section.extensions.all-extensions.sales-navigator"===this.transition.target){$("#linkedinActivateMsg").addClass("dN");var i={success_callback:function(){t.setQueryParams("activate",void 0)}};networkUtils.makeRequest("/crm/v2/settings/sales_navigator","POST",i),r.pause()}},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-integration-common-mixin.js"],crmConstants.jsStaticPathForLyte)},model:function(e){var t=this.transition.info.queryParams.toolname;e={};if("crm.settings.section.extensions.all-extensions.slack"===this.transition.target&&(e={nameSpace:"slack",portalName:"zoho",activate:!0}),"crm.settings.section.extensions.all-extensions.sales-navigator"===this.transition.target&&(e={nameSpace:"salesnavigator",portalName:"zoho",activate:!0}),"crm.settings.section.extensions.all-extensions.meeting-integration"===this.transition.target&&(t=t||"GoToMeeting",e={nameSpace:t+="",portalName:"zoho",activate:!0}),"crm.settings.section.extensions.all-extensions.cisco-teams"===this.transition.target&&(e={nameSpace:"ciscoteams",portalName:"zoho",activate:!0}),"crm.settings.section.extensions.all-extensions.dynamicExtn"!==this.transition.target){var r={params:e};return networkUtils.lyteInitiateRequest("/market/showPlugins.do","GET",r)}},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(){this.transition.data&&this.transition.data.showInstalled&&$("#pluginIPClick").click()},beforeExit:function(){$("#pluginHeaders .pluginMainDiv").remove()}}),Lyte.Router.registerRoute("crm.settings.section.extensions.google-extensions",{redirect:function(){"crm.settings.section.extensions.google-extensions"===this.transition.target&&this.transitionTo("crm.settings.section.extensions.google-extensions.google-apps",JSON.parse(globalSetpJson)[6].Marketplace[0].array[2].array[0].dynamicParams[0])}}),Lyte.Router.registerRoute("crm.settings.section.extensions.ms-extensions",{redirect:function(){"crm.settings.section.extensions.ms-extensions"===this.transition.target&&this.transitionTo(JSON.parse(globalSetpJson)[6].Marketplace[0].array[3].array[0].routeName)}}),Lyte.Router.registerRoute("crm.settings.section.extensions.skyeye",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_businessinfoservice.js"]),t=networkUtils.returnDependencyFiles(["businessinfoservice-min.css"]);return e.concat(t)},model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/BusinessInfoServiceAction.do","GET",{params:{action:"configure"}})},renderTemplate:function(e,t){return{outlet:"#result",html:Handlebars.templates.BusinessInfoService(e)}},afterRender:function(e,t){BusinessInfoService.initialLoad(e)}}),Lyte.Router.registerRoute("crm.settings.section.extensions.social-extensions",{redirect:function(){"crm.settings.section.extensions.social-extensions"===this.transition.target&&this.transitionTo("crm.settings.section.extensions.social-extensions.social-brands")}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions",{getResources:function(){return[networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("remotetoolkit")]),networkUtils.returnDependencyFiles(["crm-rso-marketplace.js"],crmConstants.jsStaticPathForLyte),networkUtils.returnDependencyFiles(["crm-rso-marketplace.css"],crmConstants.cssStaticPathForLyte),networkUtils.returnDependencyFiles([""],RebrandLinkUtil.getProperty("STORE_JS_STATIC_URL")),networkUtils.returnDependencyFiles([""],RebrandLinkUtil.getProperty("STORE_CSS_STATIC_URL"))]},redirect:function(){"crm.settings.section.extensions.zoho-extensions"===this.transition.target&&this.transitionTo("crm.settings.section.extensions.zoho-extensions.zoho-apps")}}),Lyte.Router.registerRoute("crm.settings.section.extensions.all-extensions.cisco-teams",{},{mixins:["chat-setup-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.all-extensions.dynamicExtn",{model:function(e){(e=this.transition.info.queryParams).nameSpace=this.getDynamicParam(),delete e.tab,delete e.subTab;var t={params:e};return networkUtils.lyteInitiateRequest("/market/showPlugins.do","GET",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.all-extensions.meeting-integration",{queryParams:["toolname"],model:function(e){var t={params:{type:"showMeetingPage",toolName:this.getQueryParams().toolname?this.getQueryParams().toolname:"GoToMeeting"}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/events/EventMeetingAuthorize.do","POST",t)},renderTemplate:function(e,t){return{outlet:"#internalExtensionDetail",html:e}},beforeModel:function(e){var t=e.toolname?e.toolname:"GoToMeeting";Crm.trackSpotLightAction(t+" Integration - Manage Click")},afterRender:function(e,t){"GoToMeeting"===t.toolname&&t.from&&"calendarBooking"===t.from&&$("#enableDisableMeetingButton").trigger("click")}}),Lyte.Router.registerRoute("crm.settings.section.extensions.all-extensions.sales-navigator",{getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_salesnavigator.js"])},model:function(e){return networkUtils.lyteInitiateRequest("/crm/v2/settings/sales_navigator","GET",{skip_load_tab:!0})},afterModel:function(e,t){"object"==typeof e&&(e.brand=RebrandLinkUtil.properties.Brand,e.details.profiles&&(SalesNavigatorSettings.config=e,Handlebars.registerPartial("SalesNavigatorPermissions",Handlebars.templates.SalesNavigatorPermissions),e.partner=Crm.partnerName),this.currentModel=e)},renderTemplate:function(e,t){if("object"==typeof e)return{outlet:"#internalExtensionDetail",html:Handlebars.templates.SalesNavigatorSetup(e)}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.all-extensions.slack",{getDependencies:function(){return networkUtils.returnDependencyFiles(["slack-setup-store.js","chat-setup-store.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-chat-setup.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-chat-setup.css"],crmConstants.cssStaticPathForLyte),r=networkUtils.returnDependencyFiles(["zohocrm_slackHome.js","zohocrm_chatIntegration.js",networkUtils.getI18nJSUrl("chatintegrations")],crmConstants.jsStaticPath),i=e.concat(t);return i=i.concat(r)},beforeModel:function(){Crm.userDetails.IS_ADMIN||(renderingUtils.displayPermissionDenied(),Lyte.Router.getRouteInstance().transition.abort())},model:function(){var e=this.transition;return store.findAll("team",{type:"slack",req_for:"settings"},!1).then((function(e){return{teams:e,type:"slack",active:!0}}),(function(t){var r=JSON.parse(t.response);if(r){if("FEATURE_NOT_ENABLED"===r.code)return{type:"slack",active:!1};"PERMISSION_DENIED"===r.code&&(renderingUtils.displayPermissionDenied(),e.abort())}}))},renderTemplate:function(){return{outlet:"#internalExtensionDetail",component:"crm-chat-setup"}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.google-extensions.google-apps",{getResources:function(){return networkUtils.returnDependencyFiles(["zcrm_googleapps.js"])},beforeModel:function(e){Object.keys(crmHistory.getGAppsRoutevsAction()).contains(this.getDynamicParam())||this.transition.abort()},model:function(e){var t={params:{mode:crmHistory.getGAppsRoutevsAction()[this.getDynamicParam()]}};return t.params[csrfParamName]=csrfToken,networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/GApps.do","POST",t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.google-extensions.google-calendars",{getDependencies:function(){return networkUtils.returnDependencyFiles(["gapps/crm-gcal-models.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["gapps/crm-gcal-main.js","crm-google-utils.js","gapps/crm-invalid-url.js","gapps/crm-gapps.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["gapps/crm-gcal-main.css","gapps/crm-invalid-url.css"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("google_cal")]),i=e;return i=(i=i.concat(t)).concat(r)},beforeModel:function(){commonUtils.showHideLoadingDiv(!0);var e=store.peekRecord("user",Crm.userDetails.USER_ID);return store.batch((function(){store.findRecord("profile",e.profile.id),store.findAll("gcal_sync")}))},model:function(){var e=this,t=store.peekAll("gcal_sync");if(0!==t.length&&!0===t[0].reauthenticate||0===t.length){var r=void 0!==e.transition.data.authenticated_email&&"null"!==e.transition.data.authenticated_email?e.transition.data.authenticated_email:"";return store.findAll("gcal_config",{email:r})}return store.unloadAll("gcal_config"),t},afterModel:function(e){var t=this;if(!t.error_key){void 0!==e&&Array.isArray(e)&&(e=e[0]);var r=void 0!==t.transition.data.authenticated_email&&"null"!==t.transition.data.authenticated_email?t.transition.data.authenticated_email:"";this.currentModel={gcal_config:store.peekAll("gcal_config")[0],gcal_sync:store.peekAll("gcal_sync")[0],authenticated_email:r}}},renderTemplate:function(){return{outlet:"#result",component:"crm-gcal-main"}},afterRender:function(){commonUtils.showHideLoadingDiv();var e=store.peekAll("gcal_sync");!Crm.userDetails.isStorageLimitReached||0===e.length||"google_to_crm"!==e[0].sync_option&&"two_way"!==e[0].sync_option||Crm.showStorageExceedPopup("sync_alert")},beforeExit:function(){store.unloadAll("gcal_config"),store.unloadAll("gcal_sync"),store.unloadAll("profile-permissions")},actions:{onError:function(e,t){if(e.response.includes("HIDDEN_MODULE"))Lyte.Component.render("crm-invalid-url",{},"#mainResult"),$("#setupshow").hide(),commonUtils.showHideLoadingDiv(),this.transition&&this.transition.abort();else if(e.response&&(e.response.includes("NO_PERMISSION")||e.response.includes("CANNOT_PERFORM_ACTION")))return this.error_key=!0,this.currentModel={error:!0},t.resume(),!1},willTransition:function(e){"crm.settings.section.extensions.google-extensions.google-calendars"===e.target&&(e.data&&e.data.refreshData||(store.unloadAll("gcal_config"),store.unloadAll("gcal_sync"),this.getRouteInstance().refresh({refreshTemplate:!0}).data={refreshData:!0}))}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.google-extensions.google-contacts",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["gapps/crm-gcont-models.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["hipaa-store.js"],crmConstants.jsStaticPathForLyte);return e.concat(t)},getResources:function(){var e=networkUtils.returnDependencyFiles(["gapps/crm-gcont-main.js","crm-google-utils.js","gapps/crm-invalid-url.js","gapps/crm-gapps.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["gapps/crm-gcont-main.css","gapps/crm-invalid-url.css"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("google_cont")]),i=e;return i=(i=i.concat(t)).concat(r)},beforeModel:function(){commonUtils.showHideLoadingDiv(!0);var e=store.peekRecord("user",Crm.userDetails.USER_ID);return store.batch((function(){store.findAll("custom_view",{module:"contacts"}),store.findAll("field",{module:"Contacts"},!1,!0,{apiVersion:"2.1"}),store.findAll("gcont_sync"),store.findRecord("profile",e.profile.id)}))},model:function(){var e=this,t=store.peekAll("gcont_sync");if(0!==t.length&&!0===t[0].reauthenticate||0===t.length){var r=void 0!==e.transition.data.authenticated_email&&"null"!==e.transition.data.authenticated_email?e.transition.data.authenticated_email:"";return store.findAll("gcont_config",{email:r})}return store.unloadAll("gcont_config"),t},afterModel:function(e){var t=this;if(!t.error_key){void 0!==e&&Array.isArray(e)&&(e=e[0]);var r=void 0!==t.transition.data.authenticated_email&&"null"!==t.transition.data.authenticated_email?t.transition.data.authenticated_email:"";this.currentModel={gcont_config:store.peekAll("gcont_config")[0],gcont_sync:store.peekAll("gcont_sync")[0],authenticated_email:r}}},renderTemplate:function(){return{outlet:"#result",component:"crm-gcont-main"}},afterRender:function(){commonUtils.showHideLoadingDiv();var e=store.peekAll("gcont_sync");!Crm.userDetails.isStorageLimitReached||0===e.length||"two_way"!==store.peekAll("gcont_sync")[0].sync_option&&"google_to_crm"!==store.peekAll("gcont_sync")[0].sync_option||Crm.showStorageExceedPopup("sync_alert")},beforeExit:function(){store.unloadAll("gcont_config"),store.unloadAll("gcont_sync"),store.unloadAll("custom_view"),store.unloadAll("field"),store.unloadAll("profile-permissions")},actions:{onError:function(e,t){if(e.response&&e.response.includes("HIDDEN_MODULE"))Lyte.Component.render("crm-invalid-url",{},"#mainResult"),$("#setupshow").hide(),commonUtils.showHideLoadingDiv(),this.transition&&this.transition.abort();else if(e.response&&(e.response.includes("NO_PERMISSION")||e.response.includes("CANNOT_PERFORM_ACTION")))return this.error_key=!0,this.currentModel={error:!0},t.resume(),!1},willTransition:function(e){"crm.settings.section.extensions.google-extensions.google-contacts"===e.target&&(e.data&&e.data.refreshData||(store.unloadAll("gcont_config"),store.unloadAll("gcont_sync"),this.getRouteInstance().refresh({refreshTemplate:!0}).data={refreshData:!0}))}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.ms-extensions.ms-office",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["integration/crm-ms-models.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["hipaa-store.js"],crmConstants.jsStaticPathForLyte);return e.concat(t)},getResources:function(){var e,t=networkUtils.returnDependencyFiles(["integration/crm-ms-components.js"],crmConstants.jsStaticPathForLyte);e=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["integration/crm-mstasks-fieldmapping-rtl.css","integration/crm-mstasks-fieldmapping.css"],crmConstants.cssStaticPathForLyte):networkUtils.returnDependencyFiles(["integration/crm-mstasks-fieldmapping.css"],crmConstants.cssStaticPathForLyte);var r=networkUtils.returnDependencyFiles(["zohocrm_msintegration.js",networkUtils.getI18nJSUrl("office365")]);return t.concat(r).concat(e)},beforeModel:function(){var e=this;if(commonUtils.showHideLoadingDiv(!0),void 0!==e.transition.product){var t=void 0!==e.transition.authenticated_email?e.transition.authenticated_email:"",r=e.transition.product;switch(r){case"mscalendar":commonUtils.showHideLoadingDiv(!0);var i=store.createRecord(r);return i.active=!0,""!==t&&(i.authenticated_email=t),i.$.save();case"mscontact":return store.findAll("field",{module:"Contacts"},!1);case"mstask":return store.findAll("field",{module:"Tasks"},!1)}}},model:function(){if(void 0!==this.transition.product)return store.findAll(this.transition.product)},afterModel:function(e){var t=this;if(t.error_key)this.currentModel={data:{product:"",error:!0,message:"crm.livedesk.error.exp.msg"}};else if(void 0!==e&&Array.isArray(e)&&(e=e[0]),t.currentModel){var r=t.currentModel.data;if(void 0===r&&void 0!==t.transition.product){var i=t.transition.product;store.peekAll(i)[1]&&store.deleteRecord(i,"123");var a=void 0!==t.transition.authenticated_email?t.transition.authenticated_email:"";r={product:t.transition.product,authenticated_email:a,error:!1}}this.currentModel={mscalendar:store.peekAll("mscalendar")[0],mscontact:store.peekAll("mscontact")[0],mstask:store.peekAll("mstask")[0],data:r}}},renderTemplate:function(e,t){return{outlet:"#result",component:"crm-ms-container"}},afterRender:function(e,t){var r=this;commonUtils.showHideLoadingDiv(!0),void 0!==r.transition.product&&"mstask"===r.transition.product?msApps.openTaskFieldMapper(msApps.task_sync_email):void 0!==r.transition.product&&"mscontact"===r.transition.product&&r.openContactsFieldMapper(msApps.contact_sync_email),commonUtils.showHideLoadingDiv()},actions:{onError:function(e,t){if(e.response){this.error_key=!0;return void 0!==this.transition.product?this.currentModel={data:{product:this.transition.product,error:!0,message:"crm.livedesk.error.exp.msg"}}:this.currentModel={data:{product:"",error:!0,message:"crm.livedesk.error.exp.msg"}},t.resume(),!1}}},openContactsFieldMapper:function(e){var t=document.getElementById("ms_contact_mapping");t&&t.parentNode.removeChild(t);var r=store.peekAll("mscontact")[0];r.$.get("deactivation_progress")?store.findAll("mscontact").then((function(){var e=store.peekAll("mscontact")?store.peekAll("mscontact")[0]:void 0;e&&!1===e.$.get("deactivation_progress")?t.ltProp("show",!0):crmui.showMsgBand("error",I18n.getMsg("crm.mstask.deactivate.progress"),1e3)})):(e&&!0!==e&&r.$.set("authenticated_email",e),Lyte.Component.render("crm-mscontacts-fieldmapping",{mscontact:r},"#mapper"))}}),Lyte.Router.registerRoute("crm.settings.section.extensions.ms-extensions.ms-outlook",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-outlook-admin.css"],crmConstants.cssStaticPathForLyte);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-outlook-admin.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("MicrosoftOutlookAddin")],crmConstants.jsStaticPath))},model:function(){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/OutlookEvaluationAction.do?action=checkoutlook","GET").then((function(e){if(1!=e&&"true"!=e)return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/OutlookEvaluationAction.do?action=oldoutlook","GET")}))},renderTemplate:function(e){return null==e?{outlet:"#result",component:"crm-outlook-admin"}:{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.ms-extensions.ms-word",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/MailMerge.do","GET",{params:{action:"OfficePlugin"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.social-extensions.social-admin-settings",{getResources:function(){var e,t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("social")]),r=networkUtils.returnDependencyFiles(["crm-social-setup-admin-settings.js","crm-social.js","crm-social-helper.js","crm-social-setup-lead-gen.js"],crmConstants.jsStaticPathForLyte),i=networkUtils.returnDependencyFiles(["crm-social-setup-admin-settings.css"],crmConstants.cssStaticPathForLyte);if(Crm.userDetails.RTL_ENABLED){var a=networkUtils.returnDependencyFiles(["crm-social-setup-admin-settings-rtl.css"],crmConstants.cssStaticPathForLyte);e=r.concat(i).concat(a)}else e=r.concat(i);return e=t.concat(e)},renderTemplate:function(e){return{outlet:"#result",component:"crm-social-admin-outer"}},afterRender:function(e,t){var r=$L("#setupInnerLinks"),i=renderingUtils.windowHeight-(r.offset().top+r.outerHeight()+28);$("#result").removeClass("crmEmailConfigDiv"),$L("#kso_adminSettings").css("height",i)},redirect:function(){"crm.settings.section.extensions.social-extensions.social-admin-settings"===this.transition.target&&this.replaceWith("crm.settings.section.extensions.social-extensions.social-admin-settings.index-permissions")}}),Lyte.Router.registerRoute("crm.settings.section.extensions.social-extensions.social-brands",{getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("social")]),t=networkUtils.returnDependencyFiles(["crm-social-setup-all-brands.js","crm-social-add-profile.js","crm-social.js","crm-social-setup-admin-settings.js","crm-social-add-profile.js","crm-social-helper.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles(["crm-social-setup.css"],crmConstants.cssStaticPathForLyte);if(Crm.userDetails.RTL_ENABLED)var i=networkUtils.returnDependencyFiles(["crm-social-setup-rtl.css"],crmConstants.cssStaticPathForLyte),a=t.concat(r).concat(i).concat(e);else a=t.concat(r).concat(e);return a},renderTemplate:function(e){return{outlet:"#result",component:"crm-social-setup"}},afterRender:function(e,t){var r=$("#setupInnerLinks"),i=r.outerHeight()<=10?70:r.outerHeight(),a=renderingUtils.windowHeight-(r.offset().top+i+28);$L("#result").removeClass("crmEmailConfigDiv"),$L("#zso_setup").css("height",a)},redirect:function(){"crm.settings.section.extensions.social-extensions.social-brands"===this.transition.target&&this.replaceWith("crm.settings.section.extensions.social-extensions.social-brands.index-brands")}}),Lyte.Router.registerRoute("crm.settings.section.extensions.social-extensions.social-lead-gen",{getResources:function(){var e,t=networkUtils.returnDependencyFiles(["crm-social-setup-lead-gen.js","crm-social.js","assignment-rule-models.js","crm-social-helper.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles(["crm-social-setup-lead-gen.css"],crmConstants.cssStaticPathForLyte),i=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("social")]);if(Crm.userDetails.RTL_ENABLED){var a=networkUtils.returnDependencyFiles(["crm-social-setup-lead-gen-rtl.css"],crmConstants.cssStaticPathForLyte);e=t.concat(r).concat(a)}else e=t.concat(r);return e=i.concat(e)},beforeModel:function(e){Crm.trackSpotLightAction("CRM Social- Leadgen Clicked")},model:function(e){return store.unloadAll("crm_social_workflow"),store.findAll("crm_social_workflow")},afterModel:function(e){var t=e;if(t.$){var r,i=t.$.meta;r=!1===i.networks.twitter&&!1===i.networks.facebook;var a,s={twitter_more:!0,facebook_more:!0,twitter_active:i.networks.twitter,facebook_active:i.networks.facebook,wf_disable:r},o={};if(t.length>0)for(a in t.forEach((function(e){o[e.network]||(o[e.network]=[],s[e.network]={}),o[e.network].push(e)})),o){s=this.processModel(o[a],s,a),this.getDefaultCriteriaForNetwork(a).length<=objectUtils.getLength(o[a])&&(s[a+"_more"]=!1)}if(s.showdisclaimer=Crm.userDetails.isPrivacySettingEnabled,t.workflow_enabled){crmui.showMsgBand("success",I18n.getMsg("crm.nsocial.leadgen.enable.success","Lead"),3e3)}this.currentModel=s}},renderTemplate:function(e,t){return this.error_key?{outlet:"#result",component:"crm-social-workflow-warning"}:{outlet:"#result",component:"crm-social-workflow"}},afterRender:function(e,t){!0!==Crm.userDetails.isStorageLimitReached?$("#result").removeClass("crmEmailConfigDiv"):Crm.showStorageExceedPopup()},actions:{onError:function(e,t,r){return 403!=e.code&&403!=e.status||(this.error_key=!0,t.resume()),!1}}},{mixins:["crm-soc-workflow"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.social-extensions.social",{getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_zsocialsetup.js"])},beforeModel:function(e){this.allowedDynamicParams=["twitter","facebook","google-plus"],this.allowedDynamicParams.contains(this.getDynamicParam())||this.transition.abort()},model:function(e){var t=this.getDynamicParam(),r={action:"get_settings",network:this.allowedDynamicParams.indexOf(t)+1};this.ajaxParams=jQuery.extend(!0,{},r);var i={params:r};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/SocialSettings.do","POST",i)},afterModel:function(e,t){this.currentModel=JSON.parse(e)},renderTemplate:function(e,t){return crmSocialSetup.renderSetupPage(e,this.ajaxParams.network)},afterRender:function(e,t){crmSocialSetup.postRender(e,this.ajaxParams.network)}}),Lyte.Router.registerRoute("crm.settings.section.extensions.social-extensions.social-admin-settings.index-permissions",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-social-setup-admin-settings.js","crm-social-setup-all-brands.js","crm-social-helper.js","crm-social-add-profile.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-social-setup-admin-settings.css","crm-social-setup.css"],crmConstants.cssStaticPathForLyte);if(Crm.userDetails.RTL_ENABLED)var r=networkUtils.returnDependencyFiles(["crm-social-setup-admin-settings-rtl.css"],crmConstants.cssStaticPathForLyte),i=e.concat(t).concat(r);else i=e.concat(t);return i},model:function(e){store.unloadAll("crm-social-account-user");var t=store.findAll("crm-social-admin-profile"),r=store.findAll("crm-social-account-user");return Lyte.resolvePromises({adminProfiles:t,personalAccounts:r})},afterModel:function(e,t){var r=e.adminProfiles,i={},a=!1,s=!1,o=!1,n={};void 0!==r&&r.length>0&&r.forEach((function(e){void 0!==e.id&&(i[e.id]=e,e.social_integ||e.lite_profile||(a=!0),e.social_tab||(s=!0),e.social_admin||"Standard"===e.name||e.lite_profile||(o=!0))})),$.each(e.adminProfiles.$.meta,(function(e,t){t.permissions&&(n=t.permissions)})),this.currentModel.profiles=i,this.currentModel.more_integ=a,this.currentModel.more_tab=s,this.currentModel.more_admin=o,this.currentModel.permissions=n,delete this.currentModel.adminProfiles,$L("#zso_setupLoading").hide()},renderTemplate:function(){return{outlet:"#kso_adminPermissions",component:"crm-social-admin-perm-inner"}},afterRender:function(e,t,r){thirdPartyUtils.titleForEllipsis(".profPer");var i={},a={};e.personalAccounts.forEach((function(e){void 0!==e.info.id&&(e.info.id&&e.info.current_user_id&&e.info.id===e.info.current_user_id&&(e.personal=!0),a[e.info.id]=e)})),objectUtils.getLength(a)>0&&(i.personal=a),Lyte.Component.render("crm-social-admin-personal-inner",i,"#persHandles")}}),Lyte.Router.registerRoute("crm.settings.section.extensions.social-extensions.social-brands.index-brands",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-social-setup-all-brands.js","crm-social-helper.js","crm-social-setup-lead-gen.js","crm-social.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-social-setup.css"],crmConstants.cssStaticPathForLyte),r=networkUtils.returnDependencyFiles([""],RebrandLinkUtil.getProperty("STORE_JS_STATIC_URL")),i=networkUtils.returnDependencyFiles([""],RebrandLinkUtil.getProperty("STORE_CSS_STATIC_URL")),a=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("social")]);if(Crm.userDetails.RTL_ENABLED)var s=networkUtils.returnDependencyFiles(["crm-social-setup-rtl.css"],crmConstants.cssStaticPathForLyte),o=e.concat(t).concat(s).concat(i).concat(r);else o=e.concat(t).concat(i).concat(r);return o=a.concat(o)},model:function(e){return store.findAll("crm_social_brand")},afterModel:function(e,t){var r={brands:[]};$.each(e,(function(e,t){r.brands.push(t)})),$.each(e.$.meta,(function(e,t){r[e]=t})),this.getAllBrandsRequestCallback(e,t)},actions:{onError:function(e){var t=e.responseJSON?e.responseJSON:e.response?JSON.parse(e.response):e;return"SOCIAL_PERMISSION_DENIED"===t.code&&crmui.showMsgBand("error",I18n.getMsg("crm.creator.error.access"),3e3),"INTERNAL_ERROR"===t.code&&crmui.showMsgBand("error",I18n.getMsg("error.database.problem"),3e3),!1}}},{mixins:["crm-social-setup"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.assist",{queryParams:["isZohoAssistEnabled"],getDependencies:function(){return networkUtils.returnDependencyFiles(["platformInstallFlow-lib.js"])},model:function(e){if("false"==e.queryParams.isZohoAssistEnabled)return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath().replace("/crm/","/market/")+"/installPlugin.do","GET",{params:{portalName:"ramya2",nameSpace:"zohoassist1"}});getPluginDetails("zohoassist1","","ramya2","configure")},renderTemplate:function(e,t){if("false"==t.queryParams.isZohoAssistEnabled)return $("#setup_new_ContentDiv").css("background-color","#fff"),{outlet:"#result",html:e=(e=(e=(e=(e=(e=(e=e.replace('<div id="marketplaceheader">','<div id="marketplaceheader" style="display:none;">')).replace('<div id="marketplacefooter">','<div id="marketplacefooter" style="display:none;">')).replace('<div id="closeiconMarket">','<div id="closeiconMarket" style="display:none;">')).replace('<div id="extensionInstallFllow">','<div id="extensionInstallFllow" style="margin:32px 32px;">')).replace('<div id="closeiconCRM" style="display:none;">','<div id="closeiconCRM">')).replace('<a class="plu-close-icon" href="#" onclick="$(\'#pluginIPClick\').click();">&nbsp;</a>','<a class="plu-close-icon" href="'+Crm.getCrmBasePath()+'/settings/extensions/zoho/apps"></a>')).replace('<link href="<s:property value="#application.staticurls.CSS"/>home-page.css" rel="stylesheet" type="text/css" />',"")}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.backstage",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-backstage-index.js","crm-campaign-integ-error-popup.js","crm-users-thumbnail-view.js","crm-campaign-integ-disable.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-backstage-index.css","crm-campaign-integ-disable.css","crm-users-thumbnail-view.css"],crmConstants.cssStaticPathForLyte),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zbackstagesetup")]),i=e.concat(t);return i=i.concat(r)},model:function(){return networkUtils.lyteInitiateRequest("/crm/extensions/v2/__internal/backstage/accounts","GET",{})},afterModel:function(e){var t={};if(t.integrationEnabled=this.currentModel.integrationEnabled,this.currentModel.integrationEnabled){this.currentModel.isAccountNotEnabled=!1;var r=e.config.crmConfiguration;r.crmModuleConfiguration.forEach((function(e){delete e.id,delete e.crmMetaId})),this.currentModel.crmConfiguration=e.config,this.currentModel.portalMembers=e.admins.portalMembers,this.currentModel.userProfiles=e.admins.userProfiles,this.currentModel.selectedPortal=r.portalId,this.currentModel.portalDisplayVal=r.portalName,this.currentModel.getStarted=!1,this.currentModel.isUserHasAccount=!0;var i=e.admins.userProfiles;if(i){for(var a=[],s=i.length,o=0;o<s;o++)a.push(i[o].crm_user_id);this.currentModel.userIds=a}}else this.currentModel.integrationPresent?(this.currentModel.isAccountNotEnabled=!0,t.retainMyData=!0,this.currentModel.enablePage=!0,this.currentModel.selectedPortal=e.portalId):(this.currentModel.isAccountNotEnabled=!0,t.retainMyData=!1,this.currentModel.selectedPortal=e.portalId,this.currentModel.getStarted=!0);Crm.trackSpotLightAction("Backstage Setup visited",t)},renderTemplate:function(){return delete this.component,{outlet:"#result",component:"crm-backstage-index"}},afterRender:function(){if(this.currentModel.enablePage){var e=renderingUtils.windowHeight-($("#setup_new_ContentDiv").offset().top+26);$("#zBSDisablePageOuter").css("height",e+"px")}var t=Handlebars.templates.deleteFieldWarningPopup();($("#result").append(t),this.transition.data&&1==this.transition.data.showDeactivatePopup)&&document.getElementById("zCampIntegDisable").ltProp("show",!0)},actions:{onError:function(e){return e.responseJSON&&"AUTHORIZATION_FAILED"===e.responseJSON.code?(crmui.showMsgBand("error",I18n.getMsg("crm.backstage.non.portal.user.dynamic",Crm.integrationsAppName.ZOHO_BACKSTAGE),"3000"),!1):(crmui.showMsgBand("error",JSON.parse(e.responseText).message,"3000"),!1)}}},{mixins:["crm-integration-common-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.campaigns",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-campaign-setup-mixin.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-campaign-index.js","crm-confirm-changes-popup.js","crm-campaign-integ-disable.js","lyte-scrollTo.js"],crmConstants.jsStaticPathForLyte),t=["crm-campaign-index.css","crm-setup-campaign-index.css","crm-campaign-integ-disable.css"];Crm.userDetails.RTL_ENABLED&&t.push("crm-campaign-syncs-rtl.css");var r=networkUtils.returnDependencyFiles(t,crmConstants.cssStaticPathForLyte),i=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zcampaignsetup")]),a=e.concat(r);return a=a.concat(i)},model:function(){return networkUtils.lyteInitiateRequest("/crm/extensions/v2/__internal/Campaigns/accounts","GET",{})},afterModel:function(e){if(this.currentModel=e.response,this.campaignsErrorHandling(e.code)){var t={};t.responseJSON=e,this.actions.onError(t,this),this.transition.abort()}},renderTemplate:function(e){if(e){var t={};return t.consentEnabled=this.currentModel.consentEnabled,t.hourSchedule=this.currentModel.hourSchedule,t.pickListAllowed=this.currentModel.pickListAllowed,t.potentialSync=this.currentModel.potentialSync,t.timeZones=this.deDuplicateTimeZones(this.currentModel.timeZones),t.instantSyncAllowed=this.currentModel.instantSyncAllowed,t.issTicketId=this.currentModel.issTicketId,this.metaData=t,{outlet:"#result",component:"crm-campaign-index"}}return{outlet:"#result",component:"crm-campaign-create-account"}},afterRender:function(e){e?(this.fixIndexBar(),"crm.settings.section.extensions.zoho-extensions.campaigns"===this.transition.target&&Lyte.Router.replaceWith("crm.settings.section.extensions.zoho-extensions.campaigns.syncs")):"crm.settings.section.extensions.zoho-extensions.campaigns.syncs"!==this.transition.target&&"crm.settings.section.extensions.zoho-extensions.campaigns.campaigns-field-mapping"!==this.transition.target&&"crm.settings.section.extensions.zoho-extensions.campaigns.crm-to-campaign-settings"!==this.transition.target||Lyte.Router.replaceWith("crm.settings.section.extensions.zoho-extensions.campaigns");var t=Handlebars.templates.deleteFieldWarningPopup();$("#result").append(t)},beforeExit:function(){$("#setup_new_ContentDiv").css("overflow","")},actions:{onError:function(e,t){return this.apiErrorHandling?this.apiErrorHandling(e):t.apiErrorHandling(e)},willTransition:function(e){-1!==e.info.route.indexOf("crm.settings.section.extensions.zoho-extensions.campaigns")||Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall())}}},{mixins:["crm-campaign-utils"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.cliq",{},{mixins:["chat-setup-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.contracts",{queryParams:["isZohoContractsEnabled"],getDependencies:function(){return networkUtils.returnDependencyFiles(["platformInstallFlow-lib.js"])},model:function(e){if("false"==e.queryParams.isZohoContractsEnabled)return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath().replace("/crm/","/market/")+"/installPlugin.do","GET",{params:{portalName:"zohoplugin",nameSpace:"zohocontracts"}});getPluginDetails("zohocontracts","","zohoplugin","configure")},renderTemplate:function(e,t){if("false"==t.queryParams.isZohoContractsEnabled)return $("#setup_new_ContentDiv").css("background-color","#fff"),{outlet:"#result",html:e=(e=(e=(e=(e=(e=(e=e.replace('<div id="marketplaceheader">','<div id="marketplaceheader" style="display:none;">')).replace('<div id="marketplacefooter">','<div id="marketplacefooter" style="display:none;">')).replace('<div id="closeiconMarket">','<div id="closeiconMarket" style="display:none;">')).replace('<div id="extensionInstallFllow">','<div id="extensionInstallFllow" style="margin:32px 32px;">')).replace('<div id="closeiconCRM" style="display:none;">','<div id="closeiconCRM">')).replace('<a class="plu-close-icon" href="#" onclick="$(\'#pluginIPClick\').click();">&nbsp;</a>','<a class="plu-close-icon" href="'+Crm.getCrmBasePath()+'/settings/extensions/zoho/apps"></a>')).replace('<link href="<s:property value="#application.staticurls.CSS"/>home-page.css" rel="stylesheet" type="text/css" />',"")}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.creator",{getResources:function(){return networkUtils.returnDependencyFiles(["zcreator_app-min.js"])},model:function(e){var t={params:{mode:"creator",creatorAction:"viewCreatorHome"}},r=objectUtils.cloneObject(this.transition.data);delete r.showDeactivatePopup,delete r.backOneLevel,delete r.showDeactivatePopup,delete r.integrationEnabled,delete r.isLoadedinCrmPlus,Object.assign(t.params,r);var i="createCreatorAccount"===t.params.creatorAction?"POST":"GET";return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ZCreatorAction.do",i,t)},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(e,t){this.transition.data&&"createCreatorAccount"===this.transition.data.creatorAction&&CrmCreatorCustomAppObj.removeFreezeLayer(),this.transition.data&&1==this.transition.data.showDeactivatePopup&&CustomRelatedListObj.openWarningMessage("deActivateCreator","")}},{mixins:["crm-integration-common-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.crossorg",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-integration-crossorg.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-integration-crossorg-datastore.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("crossorgs")],crmConstants.jsStaticPath),i=networkUtils.returnDependencyFiles(["crm-integration-crossorg.css"],crmConstants.cssStaticPathForLyte);return e.concat(t).concat(r).concat(i)},getDependencies:function(){var e=networkUtils.returnDependencyFiles(["crm-integration-crossorg.js"],crmConstants.jsStaticPathForLyte);return networkUtils.returnDependencyFiles(["crm-integration-crossorg-datastore.js"],crmConstants.jsStaticPathForLyte).concat(e)},beforeModel:function(e){if(!this.transition.data.service_name)switch(e.dynamicParam){case"projects":Lyte.Router.replaceWith({route:"crm.settings.section.extensions.zoho-extensions.projects"});break;case"survey":Lyte.Router.replaceWith({route:"crm.settings.section.extensions.zoho-extensions.survey"});break;case"desk":Lyte.Router.replaceWith({route:"crm.settings.section.extensions.zoho-extensions.desk"});break;case"finance-suite":Lyte.Router.replaceWith({route:"crm.settings.section.extensions.zoho-extensions.finance-suite"})}},model:function(){var e=this.transition.data,t={};switch(t.email=e.approver_email,e.updateEmailValue&&(t.textboxValue=e.updateEmailValue),t.show=!0,t.integ_name=e.service_name,t.crossorgtitle=e.crossorgtitle,t.integrationHelpLinkUrl=e.integrationHelpLinkUrl,t.portalName=e.approved_portal_name,t.enterEmailShow=!1,t.refreshtokenstatus=e.approval_status,t.integ_name){case"projects":t.crossorg_name="Zoho Projects";break;case"survey":t.crossorg_name="Zoho Survey";break;case"desk":t.crossorg_name="Zoho Desk";break;case"finance-suite":t.crossorg_name="Zoho FinanceSuite"}switch(e.approval_status){case"pending":case"resent":t.waitingForApprovalShow=!0;break;case"approved":t.approvedShow=!0;break;case"rejected":t.rejectedShow=!0;break;case"enterEmail":t.enterEmailShow=!0}return t},renderTemplate:function(){return{outlet:"#result",component:"crm-integration-crossorg"}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.desk",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-zdesk-intro.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["zdeskSetup_templates.js","zdeskSetup-min.js"]),r=networkUtils.returnDependencyFiles(["crm-zdesk-intro.css"],crmConstants.cssStaticPathForLyte),i=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("desksetuppage")],crmConstants.jsStaticPath);return t.concat(e).concat(r).concat(i)},model:function(e){var t=this.transition.data,r={params:{action:t&&t.action?t.action:"viewDeskIntegrationHome"}};if(!t||"promotab"!=t.from)return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/deskIntegration.do","GET",r);$(".setupleftmenutd").hide()},renderTemplate:function(e,t){if("object"==typeof e)return{outlet:"#result",html:Handlebars.templates.zdeskSetup(e)};var r=this.transition.data;return r&&"promotab"==r.from?{outlet:"#result",component:"crm-zdesk-intro"}:{outlet:"#result",html:e}},afterRender:function(e,t,r){var i=this.transition.data;"object"==typeof e?desk.onload(e):i&&"promotab"==i.from?r.component.bindDeskIntro():this.transition.data&&1==this.transition.data.showDeactivatePopup&&crmui.showPopup("deactivatedeskpop")},beforeExit:function(){$(window).off("keyup.deskpromo")}},{mixins:["crm-integration-common-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.finance-suite",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/invoiceIntegration.do","GET",{params:{mode:"viewInvoiceIntegration"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(){(this.transition.data&&1==this.transition.data.showDeactivatePopup&&ZInvoice.deactivateZBIntegration("#Warningdiv","books,expense,subscriptions,inventory"),"undefined"!=typeof CrmPlusLib&&void 0!==CrmPlusLib.serviceView&&void 0!==CrmPlusLib.serviceView.currentView&&"extensionView"==CrmPlusLib.serviceView.currentView)&&(document.querySelector("#zb-intg-heading span.backtoIcon").classList.add("hide"),document.getElementsByClassName("setupleftmenutd")[0].classList.add("hide"),CrmPlusLib.serviceView.afterLoad(this.transition.data.dKey,this.transition.data.dParams))},onError:function(){"undefined"!=typeof CrmPlusLib&&void 0!==CrmPlusLib.serviceView&&void 0!==CrmPlusLib.serviceView.currentView&&"extensionView"==CrmPlusLib.serviceView.currentView&&CrmPlusLib.serviceView.showError(this.transition.data.dKey,this.transition.data.dParams)}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.forms",{getDependencies:function(){return networkUtils.returnDependencyFiles(["integration/crm-zforms-setup.js"],crmConstants.jsStaticPathForLyte)},model:function(){return store.findAll("forms_config")},afterModel:function(e){void 0!==e&&Array.isArray(e)&&(e=e[0]),this.currentModel={forms_config:e}},renderTemplate:function(){return{outlet:"#result",component:"crm-zforms-setup"}}},{mixins:["crm-integration-common-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.meeting",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/events/EventMeetingAuthorize.do","POST",{params:{type:"showMeetingPage",toolName:"ZohoMeeting"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}},beforeModel:function(e){var t=this,r=this.transition.data.integrationEnabled;if("undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()&&!r){CrmPlusImpl.trigger("enableApplication",["ZohoMeeting",function(){Lyte.Router.transitionTo("crm.settings.section.extensions.zoho-extensions.meeting")}])}"C"!==Crm.userDetails.LICENSE_TYPE&&"Z"!==Crm.userDetails.LICENSE_TYPE&&"Y"!==Crm.userDetails.LICENSE_TYPE&&store.triggerAction("rso_configuration","get_rso_info",{},{},"GET").then((function(e){if(null!=e.remote_sales_office){var r,i=e.remote_sales_office.length;1===i?r="zoho_meeting"===e.remote_sales_office[0].service:2===i&&(r="zoho_meeting"===e.remote_sales_office[0].service||"zoho_meeting"===e.remote_sales_office[1].service),r&&t.transitionTo("crm.settings.section.extensions.zoho-extensions.remote-sales-office.information")}})),Crm.trackSpotLightAction("Zoho Meeting Integration - Manage Click")},afterRender:function(){this.transition.data&&1==this.transition.data.showDeactivatePopup&&crmui.showPopup("disablemeetingpopup")}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.motivator",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CRMMotivator.do","POST",{params:{mode:"motivator",action:"showInfo"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.pagesense",{queryParams:["isZohoPageSenseEnabled"],getDependencies:function(){return networkUtils.returnDependencyFiles(["platformInstallFlow-lib.js"])},model:function(e){"false"==e.queryParams.isZohoPageSenseEnabled?networkUtils.lyteInitiateRequest(Crm.getCrmBasePath().replace("/crm/","/market/")+"/installPlugin.do","GET",{params:{portalName:"surya141",nameSpace:"custommodule1"}}):getPluginDetails("custommodule1","","surya141","configure")},renderTemplate:function(e,t){if("false"==t.queryParams.isZohoPageSenseEnabled)return $("#setup_new_ContentDiv").css("background-color","#fff"),{outlet:"#result",html:e=(e=(e=(e=(e=(e=(e=e.replace('<div id="marketplaceheader">','<div id="marketplaceheader" style="display:none;">')).replace('<div id="marketplacefooter">','<div id="marketplacefooter" style="display:none;">')).replace('<div id="closeiconMarket">','<div id="closeiconMarket" style="display:none;">')).replace('<div id="extensionInstallFllow">','<div id="extensionInstallFllow" style="margin:32px 32px;">')).replace('<div id="closeiconCRM" style="display:none;">','<div id="closeiconCRM">')).replace('<a class="plu-close-icon" href="#" onclick="$(\'#pluginIPClick\').click();">&nbsp;</a>','<a class="plu-close-icon" href="'+Crm.getCrmBasePath()+'/settings/extensions/zoho/apps"></a>')).replace('<link href="<s:property value="#application.staticurls.CSS"/>home-page.css" rel="stylesheet" type="text/css" />',"")}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.projects",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-project-setup.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-project-setup.css"],crmConstants.cssStaticPathForLyte),r=networkUtils.returnDependencyFiles(["crm-project-setup-rtl.css"],crmConstants.cssStaticPathForLyte);return Crm.userDetails.RTL_ENABLED?e.concat(t).concat(r).concat(networkUtils.returnDependencyFiles(["zohocrm_projectSetup.js"])):e.concat(t).concat(networkUtils.returnDependencyFiles(["zohocrm_projectSetup.js"]))},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-integration-crossorg-datastore.js","crm-project-setup-datastore.js"],crmConstants.jsStaticPathForLyte)},model:function(e){var t,r,i,a=this.crossorgresponse;if(a){var s=a.filter((function(e){return"projects"==e.service_name}))[0],o=s.integration_status;"approvalaccepted"===s.approval_status&&(r=s.approved_portal_name,t=s.approved_portal_id,i=s.approver_email)}var n={headers:{Accept:"application/json","Content-type":"application/json; charset=utf-8"}};return this.transition&&this.transition.data&&this.transition.data.from_marketing_tab?networkUtils.lyteInitiateRequest("/crm/v2/settings/Zoho_Projects/portals","GET",n):store.findAll("projects_configuration").then((function(e){if(t&&r){"not_configured"===o&&(e.approval_status="approvalaccepted");var a=[{name:r,id:t}];e.info={email:i,is_related_information_hidden:!0,personal_account:Crm.userDetails.PERSONAL_ACCOUNT},e.portals=a}return e}),(function(){renderingUtils.displayPermissionDenied(),this.transition.abort()}))},renderTemplate:function(e,t){return{outlet:"#result",component:"crm-project-setup"}},afterRender:function(e){if(e.approval_status&&"approvalaccepted"===e.approval_status&&e.portals&&(ProjectSetup.populatePortals(e),ProjectSetup.changePortal(e)),e&&this.transition&&this.transition.data&&this.transition.data.from_marketing_tab){var t=e.code;t&&"NO_PORTALS_AVAILABLE"==t?(ProjectSetup.state="NEW_PORTAL",ProjectSetup.SelectDivToShown()):e.portals&&(ProjectSetup.populatePortals(e),e.info&&0==e.info.personal_account&&ProjectSetup.handleProfileCall()),Crm.trackSpotLightAction("Projects Marketing- Get Started clicked")}this.transition.data&&1==this.transition.data.showDeactivatePopup&&ProjectSetup.showDeactivatePopup()},actions:{onError:function(e,t,r){return ZProjects.onFailureCallBack(e)}},didDestroy:function(){window.drp=null}},{mixins:["crm-integration-common-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.remote-sales-office",{getResources:function(){return[networkUtils.returnDependencyFiles(["crm-rso-setup.js"],crmConstants.jsStaticPathForLyte),networkUtils.returnDependencyFiles(["crm-rso-setup.css"],crmConstants.cssStaticPathForLyte),networkUtils.returnDependencyFiles(["zohocrm_chatIntegration.js",networkUtils.getI18nJSUrl("chatintegrations")],crmConstants.jsStaticPath),networkUtils.returnDependencyFiles(["chat-setup-store.js"],crmConstants.jsStaticPathForLyte)]},model:function(){var e=this.transition.data;return void 0===e||void 0===e.enabled?store.triggerAction("rso_configuration","get_config",{},{},"GET").then(void 0,(function(){return{error:!0}})):e},afterModel:function(e){if(e.error)this.currentModel.error=!0;else{var t=this.transition.data;if(void 0!==t&&void 0!==t.enabled||(e=e.configuration[0]),this.currentModel.trial_days_left=e.trial_status.days_left,this.currentModel.cliqIntegrationEnabled=e.integrated_service_status[0].enabled,this.currentModel.meetingIntegrationEnabled=e.integrated_service_status[1].enabled,this.currentModel.rso_paid=e.addon_subscription_info.paid,this.currentModel.rso_addon_count=e.addon_subscription_info.addon_purchased_count,this.currentModel.payments_profile_type=e.addon_subscription_info.payments_profile_type,this.currentModel.trial_allowed=e.trial_status.allowed,this.currentModel.trial_enabled=e.trial_status.enabled,void 0!==e.trial_status.trialExpired?this.currentModel.trialExpired=e.trial_status.trialExpired:this.currentModel.trialExpired=!1,this.currentModel.meetingIntegrationEnabled&&(this.currentModel.meetingZgid=e.integrated_service_status[1].zgid),this.currentModel.enabled=e.enabled,this.currentModel.integration_allowed=e.integration_allowed,this.currentModel.reasons_for_denial=null!==e.reasons_for_denial?e.reasons_for_denial:[],this.currentModel.existing_user=e.existing_user,this.currentModel.tab=this.transition.info.route.includes("information")?"information":"users",this.currentModel.service=Lyte.Router.getRouteInstance().transition.info.queryParams.service||"zoho_cliq",this.currentModel.cliq_label=Crm.integrationsAppName.ZOHO_CLIQ,this.currentModel.rso_paid&&(this.currentModel.meetingIntegrationEnabled||store.triggerAction("rso_configuration","enable_trial",{remote_sales_office:[{service:"zoho_meeting"}]},{},"POST").then((function(e){"SUCCESS"===(e=e.remote_sales_office[0]).code&&document.getElementsByTagName("crm-rso-setup")[0].component.setData("meetingIntegrationEnabled",!0)})),this.currentModel.cliqIntegrationEnabled||store.triggerAction("rso_configuration","enable_trial",{remote_sales_office:[{service:"zoho_cliq"}]},{},"POST").then((function(e){"SUCCESS"===(e=e.remote_sales_office[0]).code&&document.getElementsByTagName("crm-rso-setup")[0].component.setData("cliqIntegrationEnabled",!0)}))),0!==this.currentModel.reasons_for_denial.length){var r=this.currentModel.reasons_for_denial.length,i=!1;if(!this.currentModel.enabled)for(var a=0;a<r;a++)switch(this.currentModel.reasons_for_denial[a]){case"cliq_org_conflict":case"meeting_org_conflict":case"cliq_paid_plan":case"meeting_paid_plan":i=!0}this.currentModel.conflicts=i}}},renderTemplate:function(){return{outlet:"#result",component:"crm-rso-setup"}},redirect:function(){this.currentModel.error||this.currentModel.existing_user&&!this.currentModel.enabled||"C"===Crm.userDetails.LICENSE_TYPE||"Z"===Crm.userDetails.LICENSE_TYPE||"Y"===Crm.userDetails.LICENSE_TYPE||this.currentModel.conflicts?this.transitionTo("crm.settings.section.extensions.zoho-extensions.zoho-apps"):"crm.settings.section.extensions.zoho-extensions.remote-sales-office"===this.transition.target&&this.transitionTo("crm.settings.section.extensions.zoho-extensions.remote-sales-office.information")}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.reports",{redirect:function(){this.replaceWith("crm.settings.section.extensions.zoho-extensions.zanalytics")}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.showtime",{getDependencies:function(){return networkUtils.returnDependencyFiles(["showtime-setup-store.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-showtime-setup.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-chat-setup.css"],crmConstants.cssStaticPathForLyte),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("remotetoolkit")]);return e.concat(t).concat(r)},model:function(){return store.findAll("showtime",!1).then((function(e){return e}),(function(){renderingUtils.displayPermissionDenied(),transition.abort()}))},renderTemplate:function(){return{outlet:"#result",component:"crm-showtime-setup"}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.survey",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-survey-setup.js","survey-configuration.js"],crmConstants.jsStaticPathForLyte);e=e.concat(networkUtils.returnDependencyFiles(["crm-survey-setup.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-survey-setup.css"],crmConstants.cssStaticPathForLyte)).concat(networkUtils.returnDependencyFiles(["crm-survey-setup-rtl.css"],crmConstants.cssStaticPathForLyte)));var t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zsurveysetup")]);return e=e.concat(t)},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-integration-crossorg-datastore.js"],crmConstants.jsStaticPathForLyte)},afterModel:function(e){var t=this;if(e.survey){if("inactive"===e.survey.status)this.currentModel.createAccount=!1,this.currentModel.getStarted=!1,this.currentModel.portalCreation=!1,this.currentModel.integrated=!1,this.currentModel.enablePage=!0;else if("active"===e.survey.status)return Lyte.resolvePromises({modules:store.triggerAction("survey","modules",void 0,{feature_name:"zoho_survey"})}).then((function(r){t.currentModel.adminEmail=e.survey.email,t.currentModel.portal=e.survey.portal,t.currentModel.selectedmodules=e.survey.modules,t.currentModel.modules=r.modules.modules,t.currentModel.departmentNames=t.currentModel.portal.departments.map((function(e){return e.name})).join(", "),t.currentModel.createAccount=!0,t.currentModel.getStarted=!1,t.currentModel.portalCreation=!1,t.currentModel.userModule=!0,t.currentModel.beforeSave=!1,t.currentModel.saveSurvey=!1,t.currentModel.integrated=!0,t.currentModel.portalName=e.survey.portal.name,t.currentModel.portalId=e.survey.portal.id,t.currentModel.users=e.survey.users,t.currentModel.createNextDiv=!1,t.currentModel.showIntegComponents=!0,t.currentModel.showConfigAnother=!1,t.currentModel.deactivationPage=!1,t.currentModel.reAuthPage=!1,t.currentModel.invalidToken=!1}))}else e.configuration?(this.currentModel.crossOrgFlow=!0,this.currentModel.adminEmail=e.configuration.email,this.currentModel.portals=e.configuration.portals,this.currentModel.modules=e.configuration.modules,this.currentModel.createAccount=!0,this.currentModel.portalCreation=!1,this.currentModel.beforeSave=!0,this.currentModel.showIntegComponents=!1,this.currentModel.getStarted=!1):(this.currentModel.createAccount=!0,this.currentModel.getStarted=!0,this.currentModel.portalCreation=!1,this.currentModel.integrated=!1)},model:function(e){var t=this.crossorgresponse;if(t){var r=t.filter((function(e){return"survey"==e.service_name}))[0];return"approvalaccepted"===r.approval_status&&"not_configured"===r.integration_status?store.triggerAction("survey","get_config",{}):Lyte.resolvePromises({survey:store.findAll("survey")})}return store.findAll("integration_crossorg",{},!1,!0).then((function(e){var t=e.filter((function(e){return"survey"==e.service_name}))[0];return"approvalaccepted"===t.approval_status&&"not_configured"===t.integration_status?store.triggerAction("survey","get_config",{}):Lyte.resolvePromises({survey:store.findAll("survey")})}))},renderTemplate:function(){return{outlet:"#result",component:"crm-survey-setup"}},afterRender:function(){if(this.currentModel.integrated){for(var e=this.currentModel.selectedmodules,t=e.length,r=0;r<t;r++)$L("#tab_"+e[r].id)[0].ltProp("checked",!0);var i=$L("crm-survey-setup")[0].component;i.setData("saveSurvey",!1),i.setData("showIntegComponents",!0)}var a=$L(".zSurveyFields");if(a.length){var s=[],o=a.find(".zSurveyFieldLabel"),n=a.find(".zSurveyFieldVal");o.each((function(){s.push($L(this).width())}));var l=Math.max.apply(null,s);l+=30,o.css("width",l+"px"),n.css("width","calc(100% - "+l+"px)")}},actions:{onError:function(e){if(e.responseText.indexOf("It appears that you don't have a Zoho Survey account")>-1)return ZSurvey.showAccountDeletedError(),!1;var t=JSON.parse(e.response),r=$(".dummy_body");if("PERMISSION_DENIED"===t.code)return renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),r.hide(),!1;if("SURVEY_ORG_OAUTHMIGRATION_FAILED"===t.code){commonUtils.showHideLoadingDiv();var i={deactivationPage:!0,reAuthPage:!1,getStarted:!1};return"api_access_denied"!==t.details.error&&"no_portal"!==t.details.error||(i.deactivationPage=!0),t.details.re_auth&&(i.reAuthPage=!0),"invalid_authtoken"===t.details.error&&(i.invalidToken=!0),i.portalCreation=!1,Lyte.Component.render("crm-survey-setup",i,"#setup_new_ContentDiv"),void $("#result").hide()}}}},{mixins:["crm-integration-common-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.visit",{getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_visitsetup.js"])},beforeModel:function(){Crm.userDetails.IS_ADMIN||Crm.userDetails.IS_ADMIN_ROLE||(this.transition.abort(),crmui.showMsgBand("error",I18n.getMsg("crm.livedesk.permission.denied",Crm.integrationsAppName.ZOHO_SALESIQ),2e3))},model:function(e){return VisitRoute.fetchIntegDetails("configured")},afterModel:function(){this.transition.data&&this.transition.data.fromTab&&(VisitsConfig.fromVisitsTab=!0)},renderTemplate:function(e,t){return VisitsConfig.renderSettings(e)},afterRender:function(e,t){VisitsConfig.postRenderSettings(),this.transition.data&&1==this.transition.data.showDeactivatePopup&&VisitsConfig.showPopup("deactivate"),VisitsConfig.isEnabledFromZCRM&&(CrmTracking.userPortalsInfo=e.userPortals,CrmTracking.portalsInfo=e.configured,CrmTracking.populateUserPortalsDD(),delete VisitsConfig.isEnabledFromZCRM)},beforeExit:function(){VisitsConfig.clearVariables()},actions:{willTransition:function(e){-1!==e.info.route.indexOf("crm.settings.section.extensions.zoho-extensions.visit")||Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall())}}}),VisitRoute={},VisitRoute.fetchIntegDetails=function(e){var t={params:{type:e}};return networkUtils.lyteInitiateRequest("/crm/v2/Visits/portals","GET",t)},Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.webinar",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-webinar-data-store.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zohowebinar")]),t=networkUtils.returnDependencyFiles(["crm-webinar-index.js","crm-campaign-integ-error-popup.js","crm-confirm-changes-popup.js","crm-users-thumbnail-view.js","crux-video.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles(["crm-webinar-common.js"],crmConstants.jsStaticPathForLyte),i=networkUtils.returnDependencyFiles(["crm-webinar-index.css","crm-users-thumbnail-view.css"],crmConstants.cssStaticPathForLyte),a=networkUtils.returnDependencyFiles(["crm-webinar-common.css"],crmConstants.cssStaticPathForLyte),s=e.concat(t.concat(r.concat(i.concat(a))));return Crm.userDetails.RTL_ENABLED&&(s=s.concat(networkUtils.returnDependencyFiles(["crm-webinar-index-rtl.css"],crmConstants.cssStaticPathForLyte))),s},model:function(e){return store.findAll("webinar")},afterModel:function(e,t){e&&e[0]&&(this.currentModel=e={webinar:e[0]},e.webinar.org&&"Free"===e.webinar.org.licence?(e.webinar.popUpfrom="settings",Lyte.Component.render("crm-webinar-trial-expiry-modal",e.webinar,"#show"),this.transition.abort()):e.webinar.access_denied?(crmui.showMsgBand("error",I18n.getMsg("zwebinar.setup.not.authorized",Crm.partnerName),"5000"),this.transition.abort()):e.webinar.non_member&&(crmui.showMsgBand("error",I18n.getMsg("zwebinar.setup.member.webinar.org.unavailable.error.dynamic",Crm.integrationsAppName.ZOHO_BACKSTAGE),"5000"),this.transition.abort()))},renderTemplate:function(e,t){return this.currentModel={webinarData:e.webinar},Crm.trackSpotLightAction("Zoho Webinar - Setup Page Access",{integrationStatus:!e.webinar.integration_disabled}),{outlet:"#result",component:"crm-webinar-setup-config"}},afterRender:function(e,t){this.transition.data&&this.transition.data.enableCallback&&this.component.setData({showVideo:!0}),this.transition.data&&1==this.transition.data.showDeactivatePopup&&(this.component.setData({showDeactivatePopup:!0}),Crm.trackSpotLightAction("Zoho Webinar - Deactivate Click",{fromExtension:!0}))},actions:{onError:function(e,t,r,i){var a=JSON.parse(e.responseText);return"AUTHORIZATION_FAILED"===a.code?renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")):crmui.showMsgBand("error",a.message,"3000"),!1},willTransition:function(e){var t=this.component;t&&t.getData("settingsModified")&&(t.setData({transitionObject:e,showConfirmChangesPop:!0}),e.pause())}}},{mixins:["crm-integration-common-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.writer",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/MailMerge.do","POST",{params:{mode:"writer",action:"writerIntro"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.zanalytics",{getDependencies:function(){return networkUtils.returnDependencyFiles(["zanalytics-model.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_zreports.js"]),t=networkUtils.returnDependencyFiles(["zanalytics.css"],crmConstants.cssStaticPathForLyte),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zanalyticsintegration")]),i=networkUtils.returnDependencyFiles(["zanalytics.js","lyte-tree.js"],crmConstants.jsStaticPathForLyte),a=networkUtils.returnDependencyFiles(["lyte-tree.js"],crmConstants.jsStaticPathForLyte);if(Crm.userDetails.RTL_ENABLED){var s=networkUtils.returnDependencyFiles(["zanalytics-rtl.css"],crmConstants.cssStaticPathForLyte);return e.concat(t).concat(s).concat(i).concat(a).concat(r)}return e.concat(t).concat(i).concat(a).concat(r)},model:function(){return commonUtils.showHideLoadingDiv(!0),store.findAll("zanalytics")},afterModel:function(e){commonUtils.showHideLoadingDiv(!1),void 0!==e&&(e=e[0]),this.currentModel={zanalytics:e}},redirect:function(e){"v1"===e.zanalytics.mode&&(commonUtils.showHideLoadingDiv(!1),this.replaceWith("crm.settings.section.extensions.zoho-extensions.reports"))},renderTemplate:function(){return{outlet:"#result",component:"crm-zanalytics-integ"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1),this.transition.data&&!0===this.transition.data.showDeactivatePopup&&ZReports.showDeleteReportConfigWarning()},actions:{onError:function(e){if(200!==e.status){try{const t=JSON.parse(e.response);if(Lyte.Router.transitionTo("crm.settings.section.extensions.zoho-extensions.zoho-apps").refresh=!0,t)switch(t.code){case"UNCONFIRMED_EMAIL":crmui.showMsgBand("error",I18n.getMsg("workflow.wfDeluge.failures.unConfirmedEmail"),3e3);break;case"FEATURE_NOT_AVAILABLE":crmui.showMsgBand("error",I18n.getMsg("crm.setup.attribution.FEATURE_NOT_SUPPORTED"),3e3);break;case"NO_PERMISSION":crmui.showMsgBand("error",I18n.getMsg("crm.setup.attribution.NO_PERMISSION"),3e3);break;case"CONNECTION_LIMIT_EXCEEDED":_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.zanalytics.basicplan.integ.restricted"),ltPropSecondaryMessage:I18n.getMsg("crm.zanalytics.basicplan.newinteg.connlimitexceeded",Crm.integrationsAppName.ZOHO_ANALYTICS),ltPropButtons:[{type:"reject",text:I18n.getMsg("Close")}],ltPropButtonPosition:"right",ltPropContentAlign:"left",ltPropShowCloseButton:"false",ltPropWrapperClass:"cxAlignLeft"}});break;default:crmui.showMsgBand("error",I18n.getMsg("crm.label.widgets.error.internal"),3e3)}else crmui.showMsgBand("error",I18n.getMsg("crm.label.widgets.error.internal"),3e3)}catch(t){return crmui.showMsgBand("error",I18n.getMsg("crm.label.widgets.error.internal"),3e3),murphy.error(e),!1}return!1}}}},{mixins:["crm-integration-common-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.zoho-apps",{model:function(e){var t=Crm.userDetails.IS_ADMIN&&"L"!==Crm.userDetails.LICENSE_TYPE;return Lyte.resolvePromises([networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowAppsAndAddons.do","GET",{params:{view:"1"}}),t?store.triggerAction("rso_configuration","get_config",{},{},"GET").then(void 0,(function(){return{error:!0}})):{rso_permission_denied:!0}])},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-integration-common-mixin.js"],crmConstants.jsStaticPathForLyte)},renderTemplate:function(e,t){return{outlet:"#result",html:e[0]}},afterRender:function(e,t){if(!e[1].error&&!e[1].rso_permission_denied){var r={},i=e[1].configuration[0];r.response=i,r.enabled=i.enabled,r.integration_allowed=i.integration_allowed,r.reasons_for_denial=null!==i.reasons_for_denial?i.reasons_for_denial:[],r.trial_enabled=i.trial_status.enabled,r.trial_allowed=i.trial_status.allowed,void 0!==i.trial_status.trialExpired?r.trialExpired=i.trial_status.trialExpired:r.trialExpired=!1,r.trial_days_left=i.trial_status.days_left,r.cliqIntegrationEnabled=i.integrated_service_status[0].enabled,r.meetingIntegrationEnabled=i.integrated_service_status[1].enabled,r.meetingIntegrationEnabled&&(r.meetingZgid=i.integrated_service_status[1].zgid),r.rso_paid=i.addon_subscription_info.paid,r.rso_addon_count=i.addon_subscription_info.addon_purchased_count,r.payments_profile_type=i.addon_subscription_info.payments_profile_type,r.existing_user=i.existing_user,r.unsupported_crm_edition=!1,r.cliq_label=Crm.integrationsAppName.ZOHO_CLIQ,r.setupIndividually=!(r.enabled||r.integration_allowed&&!r.existing_user),"C"!==Crm.userDetails.LICENSE_TYPE&&"Z"!==Crm.userDetails.LICENSE_TYPE&&"Y"!==Crm.userDetails.LICENSE_TYPE||(r.unsupported_crm_edition=!0,r.setupIndividually=!0),Lyte.Component.render("crm-rso-marketplace",r,"#rso_component"),this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.setup.zoho.apps",[Crm.partnerName]),Crm.partnerName]))}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.campaigns.campaigns-field-mapping",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-campaign-field-mappings.js"],crmConstants.jsStaticPathForLyte),t=["crm-campaign-field-mappings.css","crm-campaign-sync-delete.css"];Crm.userDetails.RTL_ENABLED&&t.push("crm-campaign-syncs-rtl.css");var r=networkUtils.returnDependencyFiles(t,crmConstants.cssStaticPathForLyte);return e.concat(r)},beforeModel:function(){this.campaignIndexUnderLine(this.transition.target),store.unloadAll("layout")},model:function(){for(var e,t=store.peekAll("module"),r=[],i=[],a=t.length,s=["Leads","Contacts"],o=0;o<a;o++)-1!==s.indexOf(t[o].api_name)&&!0===t[o].visible&&t[o].viewable?r.push(t[o]):"custom"===t[o].generated_type&&!0===t[o].visible&&t[o].viewable&&i.push(t[o]);if(r[0])e=r[0].module_name;else{if(!i[0])return{noModules:I18n.getMsg("None"),loading:!1,moduleDropDownDisabled:!0};e=i[0].module_name,this.transition.data.customModuleSelected=!0}this.transition.data.modulesList=r,this.transition.data.customModulesList=i,this.transition.data.selectedModule=e;return Lyte.resolvePromises([store.findAll("layout",{module:this.transition.data.customModuleSelected?this.getAPINameOfModuleName(i,e):e,for_service:"campaign"},!0,!0),networkUtils.lyteInitiateRequest("/crm/extensions/v2/__internal/Campaigns/mappedfields/"+e,"GET",{})])},afterModel:function(){if(this.transition.data.selectedModule){this.currentModel=this.currentModel[1],this.currentModel.selectedModule=this.transition.data.selectedModule,this.transition.data.modulesList[0]?this.currentModel.customModuleSelected=!1:this.currentModel.customModuleSelected=!0,this.currentModel.modulesList=this.transition.data.modulesList,this.currentModel.customModulesList=this.transition.data.customModulesList;var e=this.currentModel.response.mappedFields;if(this.currentModel.mappedFieldsResponse=e,this.currentModel.response.mappedFields.length){this.currentModel.emptyFieldsResponse=!1,this.currentModel.lastKey=e.length-1,this.currentModel.isEmailField=this.currentModel.response.isEmailField;var t=this.getMappedFieldIds(e);this.currentModel.allMappedCrmFieldsIds=t.allMappedCrmFieldsIds,this.currentModel.allMappedCampFieldsIds=t.allMappedCampFieldsIds,this.checkPersonalFldsAndAddKey(this.currentModel.response.mappedFields)}else this.currentModel.emptyFieldsResponse=!0;this.currentModel.loading=!1,this.currentModel.addNew=!1,this.currentModel.crmFields=null}},renderTemplate:function(){return this.indexHideAndShow("show"),{outlet:"#campaignsResult",component:"crm-campaign-field-mapping"}},actions:{willTransition:function(e){validationUtils.isEmpty(document.querySelector("crm-campaign-edit-field"))||(Lyte.Component.render("crm-confirm-changes-popup",{transitionObject:e},"#show"),e.pause())},onError:function(e){return this.apiErrorHandling(e)}}},{mixins:["crm-campaign-utils"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.campaigns.crm-to-campaign-settings",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-to-campaign-settings.js"],crmConstants.jsStaticPathForLyte),t=["crm-to-campaign-settings.css"];Crm.userDetails.RTL_ENABLED&&t.push("crm-campaign-syncs-rtl.css");var r=networkUtils.returnDependencyFiles(t,crmConstants.cssStaticPathForLyte);return e.concat(r)},beforeModel:function(){this.campaignIndexUnderLine(this.transition.target)},model:function(){return networkUtils.lyteInitiateRequest("/crm/extensions/v2/__internal/Campaigns/settings","GET",{})},afterModel:function(e){this.currentModel=e.response,this.currentModel.oldData=Object.assign({},e.response)},renderTemplate:function(){return this.indexHideAndShow("show"),{outlet:"#campaignsResult",component:"crm-campaign-to-crm-settings"}},actions:{willTransition:function(e){Lyte.triggerEvent("checkAnyUnsavedChanges"),Lyte.Router.getRouteInstance().transition.data.isUnsavedChanges&&(Lyte.Component.render("crm-confirm-changes-popup",{transitionObject:e},"#show"),e.pause())},onError:function(e){return this.apiErrorHandling(e)}}},{mixins:["crm-campaign-utils"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.campaigns.syncs",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-campaign-syncs.js","crm-campaign-list-creation-form.js"],crmConstants.jsStaticPathForLyte),t=["crm-campaign-syncs.css","crm-campaign-list-creation-form.css","crm-campaign-sync-delete.css"];Crm.userDetails.RTL_ENABLED&&t.push("crm-campaign-syncs-rtl.css");var r=networkUtils.returnDependencyFiles(t,crmConstants.cssStaticPathForLyte);return e.concat(r)},beforeModel:function(){store.unloadAll("custom_view"),this.campaignIndexUnderLine(this.transition.target)},model:function(){return networkUtils.lyteInitiateRequest("/crm/extensions/v2/__internal/Campaigns/syncdetails?page=1","GET",{})},afterModel:function(e){this.currentModel=void 0!==e.response?e.response:e},renderTemplate:function(){return this.currentModel.syncDetail=!1,this.currentModel.newSync=!1,this.currentModel.syncListId=0,this.currentModel.emptySyncList=!1,this.currentModel.totalSyncs=validationUtils.isEmpty(this.currentModel.totalSyncs)?"0":this.currentModel.totalSyncs,{outlet:"#campaignsResult",component:"crm-campaign-sync-lists",reRender:!0}},actions:{willTransition:function(e){Lyte.triggerEvent("checkAnyUnsavedChanges"),Lyte.Router.getRouteInstance().transition.data.isUnsavedChanges&&(Lyte.Component.render("crm-confirm-changes-popup",{transitionObject:e},"#show"),e.pause())},onError:function(e){return this.apiErrorHandling(e)},didTransition:function(){Lyte.triggerEvent("setBtnDisabledToFalse")}}},{mixins:["crm-campaign-utils"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.circuits",{getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("circuits")],crmConstants.jsStaticPath),t=networkUtils.returnDependencyFiles(["crm-circuits.css","crm-circuits-create-edit.css"],crmConstants.cssStaticPathForLyte),r=networkUtils.returnDependencyFiles(["crm-circuits-preview-display.js"],crmConstants.jsStaticPathForLyte),i=networkUtils.returnDependencyFiles(["crm-circuits-preview-display.css"],crmConstants.cssStaticPathForLyte),a=networkUtils.returnDependencyFiles(["crm-circuits.js","lyte-dateselect.js","lyte-daterangepicker.js","crm-circuit-create-edit.js","crm-createcircuit-pop.js"],crmConstants.jsStaticPathForLyte);return Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-circuits-rtl.css"],crmConstants.cssStaticPathForLyte))),a.concat(t).concat(e).concat(r).concat(i)},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-circuits-common.js"],crmConstants.jsStaticPathForLyte)},beforeModel:function(){Crm.trackSpotLightAction("Circuits Visited"),commonUtils.showHideLoadingDiv(!0)},model:function(){return this.transition.data.refresh=!1,Lyte.resolvePromises({integration:store.triggerAction("circuits","integration",{request_type:"GET"})})},afterModel:function(e){if(commonUtils.showHideLoadingDiv(!1),this.error_key){var t=e.response;return this.methods.errorHandling(t,void 0),Lyte.Router.transitionTo("crm.settings.section.extensions.zoho-extensions.zoho-apps"),this.stop_bubble=!0,this.transition.abort(),!1}this.data.firstTimeAccess=!0},actions:{onError:function(e,t){return this.error_key=!0,t.resume(),!1},didTransition:function(){if(this.stop_bubble)return!1},refreshRoute:function(){var e={refreshTemplate:!0};this.refresh(e)},willTransition:function(e){if(this.data.needToShowStopBanner.default){var t=e.pause(),r=this,i="stayonPageConfirmBox",a=$("#"+i);freezeBackground(),mailsetCenter(i),a.find(".leavePage").off("click").click((function(){$("#"+i).hide(),t.resume(),removeFreezeLayer(),r.data.needToShowStopBanner.default=!1,r.data.callBackFunc&&r.data.callBackFunc()})),a.find(".stayPage").off("click").click((function(){$("#"+i).hide(),e.abort(),removeFreezeLayer(),r.data.needToShowStopBanner.default=!1})),a.focus()}}},redirect:function(e){if(this.transition.data&&this.transition.data.refresh)this.transition.data.hasOwnProperty("data")?Lyte.Router.getRouteInstance().refresh().data=this.transition.data.data:Lyte.Router.getRouteInstance().refresh();else if(-1==["crm.settings.section.extensions.zoho-extensions.circuits.main.myCircuits","crm.settings.section.extensions.zoho-extensions.circuits.main.executionLog","crm.settings.section.extensions.zoho-extensions.circuits.main"].indexOf(this.transition.target)||e&&e.integration&&Object.keys(e.integration).length)if(-1!=["crm.settings.section.extensions.zoho-extensions.circuits.circuitswelcome"].indexOf(this.transition.target)&&e&&e.integration&&Object.keys(e.integration).length){Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.extensions.zoho-extensions.circuits.main").data={integration:e.integration}}else if(-1!=["crm.settings.section.extensions.zoho-extensions.circuits"].indexOf(this.transition.target)){if(e&&e.integration&&Object.keys(e.integration).length)Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.extensions.zoho-extensions.circuits.main").data={integration:e.integration,freshIntegration:!!this.transition.data.hasOwnProperty("freshIntegration")&&this.transition.data.freshIntegration,ongngIntegrationProcess:!!this.transition.data.hasOwnProperty("ongngIntegrationProcess")&&this.transition.data.ongngIntegrationProcess};else Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.extensions.zoho-extensions.circuits.circuitswelcome").data={integration:e.integration}}else e&&(this.transition.data.integration=e,this.transition.data.firstTimeAccess=this.data.firstTimeAccess);else{Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.extensions.zoho-extensions.circuits.circuitswelcome").data={integration:e.integration}}this.data.firstTimeAccess=!1},afterRender:function(){var e=$("html, body");this.transition.data&&this.transition.data.fromeditor&&($("#mainMenuTabDiv").show(),e.css("overflow","")),e[0].scrollTop=0}},{mixins:["crm-circuits-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.circuits.circuitswelcome",{beforeModel:function(){Crm.trackSpotLightAction("Circuits Visited")},renderTemplate:function(){return{outlet:"#result",component:"crm-circuits-welcome"}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.circuits.main.executionLog",{beforeModel:function(){Crm.trackSpotLightAction("Execution Logs Visited"),commonUtils.showHideLoadingDiv(!0)},model:function(){var e,t=!0,r="all";this.transition.data.isCircuitNameChanged&&(t=this.transition.data.isCircuitNameChanged),this.transition.info.queryParams&&(e=this.transition.info.queryParams.circuit_id?this.transition.info.queryParams.circuit_id:void 0,r=this.transition.info.queryParams.status?this.transition.info.queryParams.status:r);var i={request_type:"GET"};e&&(i.payLoad=[{circuit_id:e}]);var a={page:1,per_page:50};return a.status=r,a.type="api",t||!this.transition.data.circuitDtls?Lyte.resolvePromises({logs:store.triggerAction("circuits","execution_summary",i,a),circuitDtls:store.triggerAction("circuits","all_circuit_list",{request_type:"GET"})}):Lyte.resolvePromises({logs:store.triggerAction("circuits","execution_summary",i,a),circuitDtls:this.transition.data.circuitDtls})},afterModel:function(e){if(commonUtils.showHideLoadingDiv(!1),this.error_key){var t=e.response;return this.methods.errorHandling(t,void 0),Lyte.Router.transitionTo("crm.settings.section.extensions.zoho-extensions.circuits.main.myCircuits"),this.stop_bubble=!0,this.transition.abort(),!1}if(this.transition.info.queryParams.circuit_id&&e.hasOwnProperty("circuitDtls"))for(var r=e.circuitDtls.circuits,i=r.length,a=0;a<i;a++)if(this.transition.info.queryParams.circuit_id===r[a].id){e.selectedCircuitName=r[a].name;break}e.logs||(e.logs={},e.logs.executions=[],e.logs.meta={more_executions:!1,nextPageIndex:-1}),e.logs&&(e.logs_array=e.logs.executions,e.moreContentAvailable=e.logs.meta.more_records,e.nextPageIndex=e.moreContentAvailable?e.logs.meta.page+1:-1),e.circuitDtls&&(e.circuitDtls=e.circuitDtls.circuits),this.transition.info.queryParams.circuit_id&&(e.circuit_id=this.transition.info.queryParams.circuit_id,e.circuitSelectedValue=this.transition.info.queryParams.circuit_id),this.transition.info.queryParams.status&&(e.dropDownPrevSelectedValue=this.transition.info.queryParams.status,e.dropDownSelectedValue=this.transition.info.queryParams.status)},actions:{onError:function(e,t){return this.error_key=!0,t.resume(),!1},didTransition:function(){if(this.stop_bubble)return!1}},renderTemplate:function(){return Lyte.triggerEvent("cirMain_openDummyTab",{id:"circuit_execution_panel"}),$L("#setup_new_ContentDiv").scrollTop(0),$("#circuitExecutionLogsTable .lyteTableScroll").scrollTop(0),{outlet:"#circuitsResultDiv",component:"crm-circuits-execution"}}},{mixins:["crm-circuits-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.circuits.main",{beforeModel:function(){Lyte.triggerEvent("cirPrev_show_preview_pop",!1)},model:function(){return Lyte.resolvePromises({integration:this.transition.data.integration.integration,circuitDtls:store.triggerAction("circuits","all_circuit_list",{request_type:"GET"})})},afterModel:function(e){if(commonUtils.showHideLoadingDiv(!1),this.error_key){var t=e.response;return this.methods.errorHandling(t,void 0),Lyte.Router.transitionTo("crm.settings.section.extensions.zoho-extensions.zoho-apps"),this.stop_bubble=!0,this.transition.abort(),!1}!!this.transition.data.hasOwnProperty("ongngIntegrationProcess")&&this.transition.data.ongngIntegrationProcess&&crmui.showMsgBand("success",I18n.getMsg("crm.circuits.integration.success"),4e3),e.freshIntegration=!!this.transition.data.hasOwnProperty("freshIntegration")&&this.transition.data.freshIntegration},actions:{onError:function(e,t){return this.error_key=!0,t.resume(),!1},didTransition:function(){if(this.stop_bubble)return!1},refreshRoute:function(){var e={refreshTemplate:!0};this.refresh(e)}},redirect:function(e){if(this.transition.data&&this.transition.data.refresh)Lyte.Router.getRouteInstance().refresh();else if("crm.settings.section.extensions.zoho-extensions.circuits.main"===this.transition.target){Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.extensions.zoho-extensions.circuits.main.myCircuits").data={integration:e.integration,freshIntegration:!!this.transition.data.hasOwnProperty("freshIntegration")&&this.transition.data.freshIntegration}}else"crm.settings.section.extensions.zoho-extensions.circuits.main.executionLog"===this.transition.target&&(this.transition.data.integration=e.integration,this.transition.data.isCircuitNameChanged||(this.transition.data.circuitDtls=e.circuitDtls))},renderTemplate:function(){return{outlet:"#result",component:"crm-circuits-main"}}},{mixins:["crm-circuits-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.circuits.main.myCircuits",{beforeModel:function(){Crm.trackSpotLightAction("Circuits Visited"),commonUtils.showHideLoadingDiv(!0)},model:function(){if(this.transition.data)var e=this.transition.data.from_date?this.transition.data.from_date:void 0,t=this.transition.data.to_date?this.transition.data.to_date:void 0;var r={created_service:"ZohoCRM",page:1,per_page:50};this.transition.info.queryParams.searchKey&&(r.criteria="(name:contains:"+searchKeyWord+")");var i=new Date;return Lyte.resolvePromises({circuits:store.findAll("circuits",r),summary:store.triggerAction("circuits","summary",{request_type:"GET"},{from:e||CrmDateUtils.getFormattedDate(i),to:t||CrmDateUtils.getFormattedDate(i),type:"api"})})},afterModel:function(e){if(commonUtils.showHideLoadingDiv(!1),this.error_key){var t=e.response;return this.methods.errorHandling(t,void 0),Lyte.Router.transitionTo("crm.settings.section.extensions.zoho-extensions.zoho-apps"),this.stop_bubble=!0,this.transition.abort(),!1}e.summary.summary&&(e.summary=e.summary.summary),e.freshIntegration=!!this.transition.data.hasOwnProperty("freshIntegration")&&this.transition.data.freshIntegration,e.circuits||(e.circuits=[]),this.transition.info.queryParams.searchKey&&(e.searchQuery=this.transition.info.queryParams.searchKey)},actions:{onError:function(e,t){return this.error_key=!0,t.resume(),!1},didTransition:function(){if(this.stop_bubble)return!1}},renderTemplate:function(){return $("#circuitsTable .lyteTableScroll").scrollTop(0),Lyte.triggerEvent("cirMain_openDummyTab",{id:"circuit_list_panel"}),{outlet:"#circuitsResultDiv",component:"crm-circuits-list"}},afterRender:function(){$L("#setup_new_ContentDiv").scrollTop(0);var e=$("crm-circuits-list")[0].component;e._resize=e.resize.bind(this),window.addEventListener("resize",e._resize,!0),e.resize()},beforeExit:function(){store.unloadAll("circuits")}},{mixins:["crm-circuits-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.remote-sales-office.information",{afterModel:function(){var e=document.getElementsByTagName("crm-rso-setup")[0].component;"information"!==e.data.tab&&e.setData("tab","information"),this.currentModel={},this.currentModel.cliq_label=Crm.integrationsAppName.ZOHO_CLIQ},renderTemplate:function(){return{outlet:"#rsoInformationComp",component:"crm-rso-info"}}}),Lyte.Router.registerRoute("crm.settings.section.extensions.zoho-extensions.remote-sales-office.users",{queryParams:[{service:{refreshModel:!0}}],model:function(){var e=this.transition.info.queryParams.service||"zoho_cliq",t=document.getElementsByTagName("crm-rso-setup")[0].component.data,r={service_users:[],meta:{more_records:!0,total_count:0,page:0,empty:!0}};switch(e){case"zoho_cliq":return t.cliqIntegrationEnabled?store.triggerAction("rso_configuration","get_users",{},{service:e||e},"GET").then(void 0,(function(){return r})):r;case"zoho_meeting":return store.triggerAction("rso_configuration","get_users",{},{service:e||e},"GET").then(void 0,(function(){return r}))}},afterModel:function(e){var t=document.getElementsByTagName("crm-rso-setup")[0].component,r=t.data;"users"!==r.tab&&t.setData("tab","users"),this.currentModel.cliqIntegrationEnabled=r.cliqIntegrationEnabled,this.currentModel.service=this.transition.info.queryParams.service?this.transition.info.queryParams.service:"zoho_cliq";switch(this.currentModel.enabled=r.enabled,this.currentModel.service){case"zoho_cliq":this.currentModel.zcliq_users=e.service_users,this.currentModel.zcliq_users_data=e.service_users.slice(0,13),this.currentModel.zcliq_users_from=13,this.currentModel.zcliq_users_to=this.currentModel.zcliq_users_from+13,this.currentModel.zcliq_users_hasMore=e.meta.more_records,this.currentModel.zcliq_users_count=e.meta.total_count,this.currentModel.zcliq_users_pageno=e.meta.page+1,e.meta.empty&&(this.currentModel.zcliq_users_from=0,this.currentModel.zcliq_users_to=13);break;case"zoho_meeting":this.currentModel.zmeeting_users=e.service_users,this.currentModel.zmeeting_users_data=e.service_users.slice(0,13),this.currentModel.zmeeting_users_from=13,this.currentModel.zmeeting_users_to=this.currentModel.zmeeting_users_from+13,this.currentModel.zmeeting_users_hasMore=e.meta.more_records,this.currentModel.zmeeting_users_count=e.meta.total_count,this.currentModel.zmeeting_users_pageno=e.meta.page+1,e.meta.empty&&(this.currentModel.zmeeting_users_from=0,this.currentModel.zmeeting_users_to=13)}this.currentModel.cliq_label=Crm.integrationsAppName.ZOHO_CLIQ},renderTemplate:function(){return{outlet:"#userManageComp",component:"crm-rso-users"}},redirect:function(){this.currentModel.enabled||this.transitionTo("crm.settings.section.extensions.zoho-extensions.remote-sales-office.information")}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.canvas",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-canvasrule-model.js","crm-detailcanvas-utils.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["lyte-colorpicker.js","lyte-fileupload.js","crm-zdesk-rl-all.js","crm-zdesk-rl-label.js","crm-circuits-rl-all.js","crm-circuits-rl-label.js"],crmConstants.jsStaticPathForLyte);if(e=(e=(e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-canvasview.js","crm-canvas-designer.js","crm-canvas-rename-popup.js","lyte-screengrab.js","crm-tag.js","crm-skype-field.js","crm-email-field.js","crm-circuits-rl-label.js","crm-recommendation-details-newview.js","similarity-details-page.js","zia-insights.js","zia-helpers.js","prediction-result.js","nba-detail-page.js","crm-image-mixin.js","setup/orchestration/crm-orchestration-detailview-pop.js","crm-salesiq-detail-view.js","crm-rl-users-list.js","crm-emails-related-list.js","email-emotions.js","crm-rl-share-email.js","social_related_list_store.js","recommendation-detailed-main.js","emails_rl_user-model.js","crm-image-preview.js","crm-emailsrl-canvas-view-comp.js","crm-related-list-action-wrapper.js","crm-detail-view-data-privacy.js","crm-custom-button-wrapper.js","sales-navigator.js","crm-social-integ-outer-template.js","crm-macro.js","crm-column-list.js","crm-attachments.js","crm-activity-rel-wrapper.js","crm-activity-rel.js","crm-list-helpers.js","crux-video.js","crux-note.js","lyte-colorbox.js","crux-tag.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zdeskrelatedlist")],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("circuits")],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles(["zohocrm_detailview_canvas.js","zohocrm_lookupBusinessCard.js"],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("crossorgs")],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailsummary")],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailsRelatedList")],crmConstants.jsStaticPath)),e=(e=(e=Crm.userDetails.detailView_newUI?e.concat(networkUtils.returnDependencyFiles(["zcrm_customization.js","zcrm_dataprivacy_view_new.js",networkUtils.getI18nJSUrl("customization")])):e.concat(networkUtils.returnDependencyFiles(["zcrm_customization.js","zcrm_dataprivacy_view.js",networkUtils.getI18nJSUrl("customization")]))).concat(networkUtils.returnDependencyFiles(["crm-canvasview.css","crm-canvas-designer.css","crm-canvas-rename-popup.css","crm-msg-related-list.css","crm-activity-rel-customize.css","crux-boolean-component.css","crm-canvas-criteria.css","crm-column-list.css","crm-custom-rl.css","crm-image-preview.css","crm-macro.css","crm-related-list-view-header.css","crm-activity-rel-wrapper.css","crm-emails-related-list.css","crm-rl-share-email.css","crm-rl-users-list.css","crm-zdesk-rl-all-wrapper.css","crm-zsurvey-rl-label.css","scoring_entityscore.css","crm-recommendation-details-newview.css","prediction-result.css","crm-list-view-crux.css","crm-circuits-rl-all.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["canvas-detailview-less.css","recommendation-similarity.css"],crmConstants.lessStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-circuits-rtl.css"],crmConstants.cssStaticPathForLyte))),Crm.userDetails.isSegmentationEnabled&&(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["related-list-rfm.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["related-list-rfm.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("segmentation")]))),"Activities"!==this.transition.info.dynamicParams[0]&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-image-upload.js","crm-image-upload-create.js","lyte-scrollTo.js","exif-plugin.js","lyte-cropper.js","lyte-colorbox.js"],crmConstants.jsStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-image-upload-rtl.css","crm-image-upload-ziaError.css"],crmConstants.cssStaticPathForLyte))),e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-image-upload.css","crm-image-preview.css","crm-image-upload-create.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("imageupload"),networkUtils.getI18nJSUrl("scoringRulesChart")]))),"Campaigns"===this.transition.info.dynamicParams[0]){var t=networkUtils.returnDependencyFiles(["crm-campaigns-detail-view.js","crm-campaign-setup-mixin.js","crm-campaign-detail-utils.js"],crmConstants.jsStaticPathForLyte);t=t.concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles()));var r=networkUtils.returnDependencyFiles(["crm-campaigns-detail-view.css","crm-setup-campaign-index.css"],crmConstants.cssStaticPathForLyte);e=e.concat(t.concat(r));var i=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("campaignsdetail")]);e=e.concat(i);var a=networkUtils.returnDependencyFiles(["zWebinar.js",networkUtils.getI18nJSUrl("zohowebinar")]);e=e.concat(a);var s=networkUtils.returnDependencyFiles(["crm_finance_suite.js"]);e=e.concat(s)}return"crm.settings.section.modules.module.canvas.create"===this.transition.info.route&&(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-detailview-canvas-gallery.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-detailview-canvas-gallery.css"],crmConstants.cssStaticPathForLyte))),"Potentials"!==this.transition.info.dynamicParams[0]&&"Deals"!==this.transition.info.dynamicParams[0]||e.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("detailview_stage")])),e.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Recommendation-detail"),networkUtils.getI18nJSUrl("SimilarityRecommendation")])),e},beforeModel:function(){var e=this.transition.info.dynamicParams[0],t=this;return app.store.makeRequest("findRecord","module",moduleRecordMapping[e].id,void 0,void 0,!0,{getOnlyMeta:!1}).then((function(t){var r=[];return moduleRecordMapping[e].fields.forEach((function(e){if("subform"===e.data_type){var t=e.subform.id;r.push(store.findRecord("module",t))}})),r.push(app.store.makeRequest("findAll","canvas_rule",{module:moduleApiMapping[e]})),r.push(t),Lyte.resolvePromises(r)})).catch((function(e){if("NO_PERMISSION"===JSON.parse(e.responseText).code)return renderingUtils.displayPermissionDenied(),void t.transition.abort();t.getRouteInstance().transitionTo({route:"crm.crm-error",dynamicParams:[t.transition.info.dynamicParams[0]]}).data={showError:!0,module:t.transition.info.dynamicParams[0],errorMsg:I18n.getMsg("canvas.not.accessible","Canvas")}}))},model:function(){var e=this.transition.info.dynamicParams[0];e="Deals"===e?"Potentials":e;var t=moduleApiMapping[e],r=this.transition.info.dynamicParams[1],i={feature:"DetailView",module:e,layoutId:r},a=this;return networkUtils.lyteInitiateRequest("/crm/v2/customization/views/components","GET",{params:i}).then((function(e){return Lyte.resolvePromises({link:app.store.makeRequest("findAll","custom_link",{module:t}),layout:app.store.makeRequest("findRecord","layout",r,{module:t,include:"portal_user_types"},!1,!0,{apiVersion:"2.2"}),button:app.store.makeRequest("findAll","custom_button",{module:t}),relatedlist:app.store.makeRequest("findAll","related_list",{module:t,layout_id:r}),components:e})})).catch((function(e){var t=JSON.parse(e.responseText);"FEATURE_NOT_SUPPORTED"===t.code?(renderingUtils.displayPermissionDenied(),$("#popupnew").find(".mT10").text(I18n.getMsg("crm.label.cf.error.feature.unsupported"))):"FEATURE_NOT_ENABLED"!==t.code&&"NOT_ALLOWED"!==t.code||(renderingUtils.displayPermissionDenied(),$("#popupnew").find(".mT10").text(I18n.getMsg("crm.security.error"))),a.transition.abort()}))},afterModel:function(e){var t=this.transition.info.dynamicParams[0];e.moduledata=store.peekRecord("module",moduleRecordMapping[t].id);var r=e.moduledata?e.moduledata.api_name:void 0,i=["Visits","Activities","Tasks","Events","Calls","Campaigns","Services__s","Appointments__s","Job_Sheets__s","messages__s"].indexOf(r)>0;if(e.layout&&!i){var a=this.transition.info.dynamicParams[0];e.module=a,e.layoutId=this.transition.info.dynamicParams[1];var s,o=this.transition.info.route.split(".").pop(),n=this.transition.info.queryParams.id;this.transition.info.dynamicParams[2]&&"clone"!==o&&(e.viewId=this.transition.info.dynamicParams[2]),"Deals"!==a&&"Potentials"!==a||(e.stage=app.store.makeRequest("findAll","stage",{module:"Deals",layout_id:e.layoutId}));var l=Crm.latestEntId;if(l)s=app.store.makeRequest("findRecord",moduleRecordMapping[e.module].id,l,{approved:"both",formatted_currency:!0,home_converted_currency:!0});else if(n)s=app.store.makeRequest("findRecord",moduleRecordMapping[e.module].id,n,{approved:"both",formatted_currency:!0,home_converted_currency:!0});else if(e.moduledata.layouts&&1===e.moduledata.layouts.filterBy({status:"active"}).length)s=app.store.makeRequest("findAll",moduleRecordMapping[e.module].id,{per_page:1,approved:"both",formatted_currency:!0,home_converted_currency:!0});else{var c={comparator:"equal",field:{api_name:"Layout"},value:[e.layoutId]};s=app.store.makeRequest("findAll",moduleRecordMapping[e.module].id,{filters:JSON.stringify(c),per_page:1,approved:"both",formatted_currency:!0,home_converted_currency:!0})}return s.then((function(t){e.entityId=t[0]?t[0].id:null;var r,i,s=!1,o=!1;if(t[0]){var c=store.peekRecord(moduleRecordMapping[e.module].id,t[0].id);s=!!c&&c.$process_flow,o=!!c&&c.$stop_processing}if(s&&!o)r=networkUtils.lyteInitiateRequest("/crm/v2.2/"+moduleApiMapping[a]+"/"+e.entityId+"/actions/blueprint","GET");else{var d=Lyte.registeredMixins["crm-detailcanvas-utils"];d.blueprintFldId=void 0,d.isBluePrintTrans=!1}return n||l?e.record=e.entityId?store.peekRecord(moduleRecordMapping[e.module].id,t[0].id):{}:e.entityId?(e.anotherReq=!0,i=app.store.makeRequest("findRecord",moduleRecordMapping[e.module].id,t[0].id,{approved:"both",formatted_currency:!0,home_converted_currency:!0})):e.record={},Lyte.resolvePromises({record:i,isBluePrintTrans:r}).then((function(e){if(e.isBluePrintTrans){var t=Lyte.registeredMixins["crm-detailcanvas-utils"];t.blueprintFldId=e.isBluePrintTrans.blueprint.process_info.field_id,t.isBluePrintTrans=!!e.isBluePrintTrans.blueprint.transitions.length,t.showStage="Stage"!==e.isBluePrintTrans.blueprint.process_info.api_name}}))}))}this.getRouteInstance().transitionTo({route:"crm.crm-error",dynamicParams:[e.module]}).data={showError:!0,module:e.module,errorMsg:I18n.getMsg("canvas.not.accessible","Canvas")}},renderTemplate:function(e){return e.anotherReq&&(e.record=store.peekRecord(moduleRecordMapping[e.module].id,e.entityId)),{component:"crm-detailview-oldeditor",outlet:"#canvasEditorDiv"}},afterRender:function(e){var t={section:0,tab:0,text:0,icon:0,table:0,line:0,image:0},r=$(".canvas-builder-area").height();this.componentPreProcess(e),zutils.zcopyobjExternal=objectUtils.cloneObject_new,zutils.getUUID=function(){var e=(new Date).getTime()+(Crm.userDetails&&Crm.userDetails.USER_ID?parseInt(Crm.userDetails.USER_ID):0);return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?r:3&r|8).toString(16)}))},zutils.externalwindowWidth=function(){return renderingUtils.windowWidth},zutils.externalwindowHeight=function(){return renderingUtils.windowHeight},zutils.canvasI18n={fields:I18n.getMsg("crm.label.customize.fields"),relatedlist:I18n.getMsg("crm.label.customize.relatedList"),action:I18n.getMsg("crm.setup.system.actions"),link:I18n.getMsg("crm.customlink"),"Canvas Button":I18n.getMsg("zc.editor.button"),button:I18n.getMsg("crm.customize.custombutton.label"),Line:I18n.getMsg("crm.report.line"),image:I18n.getMsg("crm.image.header"),staticimage:I18n.getMsg("crm.image.header"),"image value":I18n.getMsg("crm.image.header"),MERGEFIELD:I18n.getMsg("crm.canvas.builder.mergefield"),"Static Icon":I18n.getMsg("crm.canvas.editor.icon"),"Static Text":I18n.getMsg("crm.label.text"),"Tab Bar":I18n.getMsg("crm.canvas.builder.tabbar"),"Tab Container":I18n.getMsg("crm.canvas.builder.tabcontainer"),label:I18n.getMsg("crm.label.label"),field:I18n.getMsg("crm.canvas.builder.field"),holder:I18n.getMsg("crm.canvas.builder.holder"),value:I18n.getMsg("crm.massmail.value"),"button holder":I18n.getMsg("crm.canvas.builder.holder"),"button label":I18n.getMsg("crm.label.label"),"button value":I18n.getMsg("crm.massmail.value"),link:I18n.getMsg("crm.label.link"),"link holder":I18n.getMsg("crm.canvas.builder.holder"),"link label":I18n.getMsg("crm.label.label"),"link value":I18n.getMsg("crm.massmail.value"),textarea:I18n.getMsg("crm.label.textarea"),tag:I18n.getMsg("crm.label.small.tags"),section:I18n.getMsg("crm.section.label"),button:I18n.getMsg("zc.editor.button"),"Tab Layout":I18n.getMsg("crm.canvas.builder.tabitem"),"Table Layout":I18n.getMsg("crm.dashboard.label.table"),page:I18n.getMsg("crm.social.integ.type.page"),row:I18n.getMsg("crm.module.subform.row"),icon:I18n.getMsg("crm.canvas.editor.icon"),"relatedlist section":I18n.getMsg("crm.section.label"),"relatedlist title":I18n.getMsg("crm.html.subject"),seperator:I18n.getMsg("crm.canvas.builder.seperator"),"field row":I18n.getMsg("crm.module.subform.row"),_reusable_components_:I18n.getMsg("crm.canvas.reusable.comp"),picklist:I18n.getMsg("crm.picklist.picklist.value"),Text:I18n.getMsg("crm.label.text")},zutils.getExternali18n=function(e){return zutils.canvasI18n&&zutils.canvasI18n[e]?zutils.canvasI18n[e]:e},window.undoredomanager=new CanvasUndoRedoManager({onUndo:function(e){if("resize"==e.action){var t=this.getElements(e.node);!t.hasClass("zcanvas-field")||t.hasClass("zcbdrbox")||t.hasClass("zctextarea")||t.css("height","")}},onRedo:function(e){if("resize"==e.action){var t=this.getElements(e.node);!t.hasClass("zcanvas-field")||t.hasClass("zcbdrbox")||t.hasClass("zctextarea")||t.css("height","")}},onChange:function(e){var t;(Lyte.registeredMixins["crm-detailcanvas-utils"].colorPersistance(),setTimeout((function(){var e=document.getElementsByTagName("crm-detailview-oldeditor");e&&e.length&&(e[0].setData("changed",!0),e[0].setData("hasUndo",undoredomanager.hasUndo()),e[0].setData("hasRedo",undoredomanager.hasRedo()))}),0),e&&e.json&&e.json.relatedList)&&((t=(s=$(e.node)).find("crm-stage-history")).length&&t[0].component.setWidthForStagesParent());e&&e.json&&e.json.action&&"newtab"==e.json.action&&e.json.previous&&e.json.previous.isList&&((t=$("#"+e.json.previous.tabid).find("crm-stage-history")).length&&t[0].component.setWidthForStagesParent());if("editordrag"==e.action)if((s=this.getElements(e.node)).hasClass("ui-droppable")){var r=s.data("uiDroppable");r._rearrangescopes(r.options.scope||"default")}else{var i=s.find(".ui-droppable");if(i.length){var a=i.eq(0).data("uiDroppable");a._rearrangescopes(a.options.scope||"default")}}if("new"==e.action||"editorswitch"==e.action||"editordrag"==e.action){var s=this.getElements(e.node);if(zutils.blinkelement(s),"editorswitch"===e.action&&"string"==typeof e.node&&e.current&&e.current.editor&&e.previous&&e.previous.editor){var o,n=$(e.previous.editor+" "+e.node),l=n.data("zccustomstate")||[];n.hasClass("zcanvas-field")&&(o={holder:n.find(".zcanvas-holder").data("zccustomstate"),label:n.find(".zcanvas-label").data("zccustomstate"),value:n.find(".zcanvas-value-container").data("zccustomstate")});var c=$(e.current.editor+" "+e.node);c.data("zccustomstate",l),o&&(c.find(".zcanvas-holder").data("zccustomstate",o.holder),c.find(".zcanvas-label").data("zccustomstate",o.label),c.find(".zcanvas-value-container").data("zccustomstate",o.value))}}if(e&&"switchaction"==e.action&&setTimeout((function(){disablePerfectScroll("canvas-available-tools"),enablePerfectScroll("canvas-available-tools")}),500),e&&e.node)for(var d=(s=this.getElements(e.node)).find("[zcflag]"),u=d.length,m=0;m<u;m++){var p=d.eq(m),g=p.removeAttr("lyte-rendered zcflag").outerHTML(),f=p.parent();p.remove(),f.append(g)}}}),setTimeout((function(){enablePerfectScroll("canvas_scroll_menu"),enablePerfectScroll("canvas-available-tools")}),200);$("body").append('<lyte-colorpicker id="zcanvascolorpicker" lt-prop-appearance = "box" lt-prop-used-colors-number = 20 lt-prop-wrapper-class="zccolorpickerwrap"></lyte-colorpicker>');var i=function(e){"transparent"!=e&&e&&"string"==typeof e||(e="rgba(255, 255, 255, 0)");var t={hex:"","hex-alpha":"",rgb:"",rgba:""},r=e.replace(/^(rgb|rgba)\(/,"").replace(/\)$/,"").replace(/\s/g,"").split(",");if(r.length){var i=ColorPicker_Util.getRgbCodeByRgbColors(r[0],r[1],r[2]);if(t.hex="#"+i,t.rgb="rgb("+r[0]+","+r[1]+","+r[2]+")",r[3]&&r[3]<1){var a=parseFloat(r[3]);i+=a=(255*a|256).toString(16).slice(1),t["hex-alpha"]=i,t.rgba="rgba("+r[0]+","+r[1]+","+r[2]+","+r[3]+")",t.opacity=parseFloat(parseFloat(100*parseFloat(r[3])).toFixed(2))}else t["hex-alpha"]=i+"FF",t.rgba="rgba("+r[0]+","+r[1]+","+r[2]+",1)",t.opacity=100}return t};var a=function(e,t,r,a,s){Lyte.registeredMixins["crm-detailcanvas-utils"].colorPersistance();var o=document.getElementById("zcanvascolorpicker"),n=$(e).css("background-color"),l=i(n);o.setData("ltPropCurrentRgbCode",l.hex.replace("#","")),o.setData("ltPropBoardColor",l.rgba),o.ltProp({originElement:e,show:!0,advancedColorButton:!0,closeOnBodyClick:!0,closeOnSelection:!0,noFillButton:!0,ltPropUsedColorsNumber:20}),o.setMethods({onSelect:function(r,i){"transparent"===i.rgb&&(jsonCreation.toolinst&&jsonCreation.toolinst.selectedfields.hasClass("zcanvas-editor-outer")&&"background-color"===t?i.rgba="rgba(255,255,255,1)":i.rgba="rgba(255,255,255,0)");var o={style:{}};if(o.style[t]=i.rgba,$(e).css("background-color",i.rgba),s&&s.main&&s.main.tools.preprocesshandler&&(o=s.main.tools.preprocesshandler.bind(s)(o)),a?a(o,!0):s.config.onChange?s.config.onChange.bind(s)(s.config,o):s.main.changehandler(s.config,o),s&&s.config.sync){var n=i.hex?i.hex.replace("#",""):"000000";$(s.config.sync).find("input").val(n)}}})},s={editorcontainer:"#zcanvas-editor-outer",toolbarContainer:".toolbar",actionsContainer:".canvas-actions",contextmenu:!0,contextmenucontainer:".canvas-builder-area",contextclass:"zccontextclose",alwaysdisabled:!0,zclayoutcontainer:"#zcanvas_menu_insert",tools:{zcdefault:["fontsize","fontweight"]},isPage:!0,multiresize:["text-area","profileimage","Owner_Photo","timeline","textarea","image","fileupload"],style:{zcdefault:["textstyles"]},listtypes:["relatedlist","static_rel","system","zia","subform","section"],undoredomanager:undoredomanager,postStyleApplyConditions:[".zcanvas-field:not(.zccbutton)",".zcanvas-holder",""],staticelement:$('<div class="svgIcons ico-plus-circle-blue zc-add-canvas" lt-prop-title="'+I18n.getMsg("crm.button.clone")+'"></div>').click((function(e){A(e.target.parentElement)})),lockhandler:function(e,t,r,i){e||(e=t),t.is(".zctablayout")&&(e=t.children(".zc-tab-container"));var a=$('<div class="zcanvas-lock-icon'+(i?" zcanvas-limited-lock":"")+'" lt-prop-title="'+I18n.getMsg("crm.data.subject.request.unlock")+'"></div>');if(e.append(a),t.addClass("zcanvas-locked-element").draggable("option","disabled",!0),!i&&a.on("click",(function(e){var t=$(e.target).closest(".ui-draggable"),r=$("#zcanvas-editor-outer").data("zcanvas");r&&r.config&&r.config.unlockhandler(null,t)})),$(".dimentiontool").addClass("zc-disabled-tool"),!r){var s=$("#zcanvas-editor-outer").data("zcanvas"),o={action:"callback",node:s.config.toolsRef.getSelectorByElement(t),lock:!0,callback:function(e,t,r){var i=$("#zcanvas-editor-outer").data("zcanvas");"undo"===t?i&&i.config&&i.config.unlockhandler(null,r,!0):i&&i.config&&i.config.lockhandler(null,r,!0)}};s.savecanvasaction(t,o.action,null,null,null,null,o)}},unlockhandler:function(e,t,r){if(e||(e=t),t.is(".zctablayout")&&(e=t.children(".zc-tab-container")),t.removeClass("zcanvas-locked-element"),e.children(".zcanvas-lock-icon").zremove(),t.draggable("option","disabled",!1),$(".dimentiontool").removeClass("zc-disabled-tool"),!r){var i=$("#zcanvas-editor-outer").data("zcanvas"),a={action:"callback",node:i.config.toolsRef.getSelectorByElement(t),lock:!1,callback:function(e,t,r){var i=$("#zcanvas-editor-outer").data("zcanvas");"undo"===t?i&&i.config&&i.config.lockhandler(null,r,!0):i&&i.config&&i.config.unlockhandler(null,r,!0)}};i.savecanvasaction(t,a.action,null,null,null,null,a)}},zccontainment:"#zcanvas-editor-outer",relatedlistcompile:function(e,t,r){if((t&&t._data&&(t=t._data),t&&t.id)&&!store.peekRecord("related_list",t.id))return;var i=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];return t.module=i,Lyte.registeredMixins["crm-detailcanvas-utils"].getRelListHtml(e,t&&t.rellistdata?t.rellistdata:[],t.module,t&&t.fieldid?t.fieldid:[],null,r,t)},relatedlistdata:function(e,t,r,i){return e.noMapAvail?e:Lyte.registeredMixins["crm-detailcanvas-utils"].processRelListObj(e,r,t.module,JSON.parse(JSON.stringify(t.fieldid)),i,t)},afterrelatedlistplace:function(e,t){if("stage_navigator"==e.api_name){var r=t.find("crm-stage-history");r.length&&r[0].component.setWidthForStagesParent()}},onTabSwitch:function(e){var t=e.find("crm-stage-history");t.length&&t[0].component.setWidthForStagesParent()},relatedlistmenu:function(e,t,r){r=r||{};var i=t.relListModId,a=store.peekRecord("module",i).module_name,s={relatedListModule:a};if(t.connectedModName){var o=Lyte.registeredMixins["crm-detailcanvas-utils"].getConnectedModuleApiName(t.connectedModName);s.connectedModName=o}if(e.includes("_profileimage"))return e=e.replace("_profileimage",""),new CrmDetailViewHandler(a,r,e,"profileimage",{},void 0,void 0,!0,s).getHTML();var n=Lyte.registeredMixins["crm-detailcanvas-utils"].constructCruxComponentForCanvas(e,t.module,r,!0,s,!0);return null==n?"N/A":n},relatedlistcreate:function(e){var t=$L("crm-detailview-oldeditor")[0],r=$("#zcanvas_menu").data("zcdatamap"),i=r[e.id];if(i&&1===i.zcscope&&"Custom Layout"===e.theme&&(e.theme="Table Layout"),"Table Layout"===e.theme&&i){var a=$(i.fieldContainer).data("zcanvasMenu");if(a&&a.config&&a.config.zmenustart&&a.config.zmenustart(i),t&&e.data&&"relatedlist"===e.data.datatype&&"crm.settings.section.modules.module.canvas.clone"===Lyte.Router.getRouteInstance().transition.target){var s=t.component.getData("layoutId"),o=t.component.getData("module"),n=t.component.getData("record")?JSON.stringify(t.component.getData("record")):void 0,l=t.component.getData("entityId");i.template="<crm-related-list-view-header layout-id='"+s+"' record='"+n+"' entity-id=\""+l+"\" module='"+o+'\' show-loading="{{lbind(isLoading)}}" related-list-id="'+i.id+"\" related-list='"+JSON.stringify(store.peekRecord("related_list",i.id).$.toJSON())+"'></crm-related-list-view-header>"}}if(i&&i.template&&$u.isEmpty(i.data)&&(!(2===i.zcscope&&i.mappedCount>1&&"Custom Layout"===e.theme)||"static_rel"===i.datatype&&1===i.zcscope&&1===i.mappedCount&&"Custom Layout"===e.theme))return r[e.id].data=new Promise((function(e){i.async&&Lyte.registeredMixins["crm-detailcanvas-utils"].loadResourceOnDemand(i);var t=i.actions;e({data:{},template:i.template,async:i.async,asyncloader:i.asyncloader,actions:t})})),i;e.children=e.components;var c=!0,d=!0;if(i&&!i.noAction){var u=i.action.url_params[2],m=store.peekRecord("related_list",u);if(m&&"multiselectlookup"===m.type){var p=m.connectedmodule;c=moduleRecordMapping[p].viewable,d=moduleRecordMapping[p].visible}}if("create"!==Lyte.Router.getRouteInstance().routeName&&"clone"!==Lyte.Router.getRouteInstance().routeName||!i)if(i&&c&&d&&!i.noAction)Lyte.registeredMixins["crm-detailcanvas-utils"].relatedListDataProcessing(i,e);else{i={};var g,f,h,y="";o=Lyte.Router.getRouteInstance().parent.currentModel.module;if(("create"===Lyte.Router.getRouteInstance().routeName||"clone"===Lyte.Router.getRouteInstance().routeName)&&"Table Layout"===e.theme)f=(g=["timeline","sales_summary","data_privacy","stage_navigator","followers","blueprint","subform","score_summary","campaign_integ_analytics","campaign_analytics","backstage_analytics","backstage_status","zfinance_stock_info","zfinance_business_info","upcoming_action","orchestrations","segmentation","best_time","prediction","recommendation","similarity"].indexOf(e.id)>-1?new CrmDetailViewHandler(o,{},e.id,e.id,null,"",e.personalityName):new CrmDetailViewHandler(o,{},e.id,"static_rel",null,"",e.personalityName)).getHTML(),h=g.getResources(),i.asyncresources=h,i.async=!0,y=f;i.data=new Promise((function(t){Lyte.registeredMixins["crm-detailcanvas-utils"].loadResourceOnDemand(i),t({data:e,template:y,actions:[],rellistdata:[],module:"",asyncloader:i.asyncloader,async:i.async})}))}else Lyte.registeredMixins["crm-detailcanvas-utils"].relatedListDataProcessing(i,e);return i},gallerymap:function(e){Crm.client_tracking("Canvas Reusable Component Drag and Drop in editor");var t=$L("crm-detailview-oldeditor")[0].getData("reusableObjDetails").filter((function(t){return t.id===e.id}))[0];return t=t?Lyte.deepCopyObject(t):e.data,Lyte.registeredMixins["crm-detailcanvas-utils"].processgallery(t,!0)},contextcallback:function(e,t,r,i){if("conditionalstyle"===e)$L(".zcstylesideebar").click(),$L(".zcaddstate").click();else if("addelementname"===e||"addscript"===e){var a=(o=document.querySelector("crm-detailview-oldeditor")).getData("selectedElementName");if("addscript"===e){if(!o.component.isCscriptAvailable())return;return void o.component.cscripteventContext.bind(o.component)(r,i,name)}var s=o.component.issaverequired.bind(o.component)();o.setData("showaddscript","addscript"===e),s||!a||"addelementname"===e?(o.setData("showelementnamemodal",!0),$L("#canvas_element_name").val(a)):o.component.openscriptpopup.call(o.component)}else if("managescripts"===e){var o;if(document.querySelector("crm-cscript"))(o=document.querySelector("crm-detailview-oldeditor"))&&o.component.opencscriptpanel.bind(o.component)(),setTimeout((function(){var e=document.querySelector("#cscript-search-element");if(e){var t=document.querySelector("crm-detailview-oldeditor"),r=t.getData("selectedElementName"),i=t.getData("selectedelementtype");if("Static Icon"!==i&&"Static Text"!==i&&"Canvas Button"!==i){var a=t.getData("selectedSpecialEventType");if(a)if("field"===a){var s=jsonCreation.toolinst.selectedfields.zdata();if(s&&s.length&&s[0]){var o=store.peekRecord("field",s[0].id);r=o?o.display_label:""}}else r="page"===a?I18n.getMsg("crm.social.integ.type.page"):"tag"===a?I18n.getMsg("Tag"):"blueprint"===a?I18n.getMsg("BluePrint"):r}e.setValue(r)}}),1e3)}else if("savepreset"===e){var n=jsonCreation.toolinst.selectedfields,l=n.hasClass("zc-tabs")||n.hasClass("zctablayout")||n.hasClass("tab")||n.hasClass("zc-tab-container"),c=n.hasClass("zcanvas-static-editor"),d=n.hasClass("zclayout-table");if(l)var u=n.closest(".zctablayout"),m={style:zclayout.prototype.layouts["Tab Layout"].getComponentStyle(u),type:"Tab Layout"};else if(c){var p=$("#zcanvas-editor-outer").data("zcanvas").config.toolsRef;p.copyrl();m={style:JSON.parse(JSON.stringify(p.copyrldata)),type:"relatedlist"}}else if(d){m=jsonCreation.toolinst.copystyle(n,!0);zutils.getinstancetool().copydata={},zutils.getinstancetool().gettablerowstyles(),zutils.getinstancetool().gettablecolumnstyles(),$.extend(m.style,zutils.getinstancetool().copydata)}else m=jsonCreation.toolinst.copystyle(n,!0);var g=m.type;"page"!==g||m.style.default&&Object.keys(m.style).length||(m.style.default={"background-color":jsonCreation.toolinst.config.theme.currenttheme.page.default["background-color"]}),"section"!==g||m.style.default&&Object.keys(m.style).length||(m.style.default=jsonCreation.toolinst.config.theme.currenttheme.section.default),"Canvas Button"!==g&&"button"!==g||(m.style.field.default=m.style.field.default||{},m.style.field.hover=m.style.field.hover||{});var f=document.querySelector("crm-canvas-builder-presets");if(f){var h=f.getData("availablepresets");l?(h["Tab Layout"]||(h["Tab Layout"]={default:[],defined:[]}),h["Tab Bar"]||(h["Tab Bar"]={default:[],defined:[]}),h["Tab Container"]||(h["Tab Container"]={default:[],defined:[]}),h.Tab||(h.Tab={default:[],defined:[]})):h[m.type]||(h[m.type]={default:[],defined:[]}),f.component.savePreset(m,t),f.setData("availablepresets",h),jsonCreation.toolinst.selectfield(n,null,!0)}}else if("savecomponent"===e){var y=document.querySelector("crm-detailview-oldeditor");y&&y.getData("isReusableLimitExceed")?_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.canvas.reusable.comp.limit.exceed"),ltPropType:"error"}}):y&&y.setData("showreusablepopup",!0)}},onBeforeChange:function(e,t){if("new"==e&&"object"==typeof t&&(t.hasClass("zctextarea")||t.hasClass("zcimagefield"))){var r=t.offset(),i=zutils.getParentData(t),a=zutils.findpositionAndWidth(i.container,r,i.container,t,!1);t.css({width:a.targetwidth>400?400:a.targetwidth})}},checkActivitySplit:function(e){var t=store.peekRecord("related_list",e);if(t&&("Activities"===t.api_name||"Activities_History"===t.api_name))return!0},onChange:function(e,r,i){if(i&&"link"==e)for(var a=i.actionarray.length,s=0;s<a;s++){var o=i.actionarray[s];i.changedetection&&i.changedetection(o.action,undoredomanager.getElements(o.node),o)}if("new"===e&&r.is(".zcanvas-nav")||"neweditor"===e&&r.has(".zcanvas-nav").length){var n=r.find(".navigateRecord");if(n.length){var l=n[0];return l.setMethods({onNext:function(){},onPrevious:function(){}}),void l.component.buttonDisable.call(l.component)}}if("resize"==e&&r.has("crm-stage-history").length){var c=r.find("crm-stage-history");c.length&&c[0].component.setWidthForStagesParent()}if((i&&"resize"==e&&r.hasClass("zcbdrbox")||i&&("action"==e||"switchaction"==e)&&r.is("img"))&&this.adjustimagetooriginal(r),i&&r.hasClass("zccbuttonicon")&&this.bindlabelresize&&this.bindlabelresize(r),i&&"resize"==e&&"#zcanvas-editor-outer"==i.node){var d=r.css("width");r.parent().width(d)}if(r.hasClass("zcanvas-afterdrop")){var u=r.attr("data-uniquekey"),m=$('#zcanvas_menu [data-uniquekey="'+u+'"]'),p=r.data("zcanvas")["zcanvas-afterdrop"];m.data("zcanvas",objectUtils.cloneObject_new(p)),delete r.data("zcanvas")["zcanvas-afterdrop"]}var g,f=r.attr("data-zcqa"),h=r.hasClass("zcanvas-rl-change");if("neweditor"===e||"new"===e&&r.hasClass("zc-fieldsection"))r.attr("data-zcqa","canvas-detail-section"+ ++t.section),g="section"+t.section;else if("new"==e&&r.hasClass("zctablayout"))r.attr("data-zcqa","canvas-detail-tab"+ ++t.tab),g="tab"+t.tab,r.find(".zcaddtab").attr("data-zcqa","canvas-detail-tab"+t.tab+"-add"),r.find(".tab").attr("data-zcqa","canvas-detail-tab-Unnamed Tab");else if("new"==e&&r.hasClass("zclayout-table"))r.attr("data-zcqa","canvas-detail-table"+ ++t.table),g="table"+t.table;else if(r.hasClass("zcstatictext")&&!f)r.attr("data-zcqa","canvas-detail-text"+ ++t.text),g="text"+t.text;else if(!f&&r.hasClass("zcstaticicon"))r.attr("data-zcqa","canvas-detail-icon"+ ++t.icon),g="icon"+t.icon;else if(!f&&r.hasClass("zcdivider"))r.attr("data-zcqa","canvas-detail-line"+ ++t.line),g="line"+t.line;else if(!f&&r.hasClass("zc-rating"))r.attr("data-zcqa","canvas-detail-rating"+ ++t.rating),g="rating"+t.rating;else if(!f&&r.hasClass("zc-button-code"))r.attr("data-zcqa","canvas-detail-button"+ ++t.button),g="button"+t.button;else if(!h&&f||!r.hasClass("zcanvas-static-editor"))!f&&r.is(".zclayout.zcbdrbox")&&(r.attr("data-zcqa","canvas-detail-image"+ ++t.image),g="image"+t.image);else{var y=r.data("zcanvas").zcqaval||r.data("zcanvas").label;g="RL-"+y,r.attr("data-zcqa","canvas-detail-RL-"+y),r.removeClass("zcanvas-rl-change")}if(g){var v=r.data("zcanvasdata");v||(v={}),v&&!v.name&&(v.name=g,r.data("zcanvasdata",v))}if(e&&null!=e&&this&&"#zcanvas-editor-outer"==this.editorcontainer&&(e.indexOf("new")>-1||e.indexOf("resize")>-1||e.indexOf("drag")>-1||e.indexOf("editorswitch")>-1)){var _=$(this.editorcontainer).data("zcanvas");_&&_.resetheight&&_.resetheight()}},statictypecallback:function(e,t){var r=e.data("zcanvas");e.has(".zc-noneditable-rl").length&&Lyte.registeredMixins["crm-detailcanvas-utils"].contextualstyles(r,e,t)},onmenuswitch:function(e,t){$(e).find(".zcanvas-menu-heading , .zcanvas-submenu-heading").click((function(e){var t=$(e.target);t.toggleClass("zcnotransform"),t.next().slideToggle();var r=t.closest(".ps-container");setTimeout((function(){if(r.length){var e=r.attr("id");disablePerfectScroll(e),enablePerfectScroll(e)}}),500)})),setTimeout((function(){thirdPartyUtils.bindPerfectScrollUpdate($("#canvas_scroll_menu"))}),500);var r=t.data("zcanvas");if(moduleRecordMapping[r.api_name]){var i=moduleRecordMapping[r.api_name].fields,a=$(e).data("zcanvasMenu");a&&(a.config.metafields=Lyte.registeredMixins["crm-detailcanvas-utils"].transformdatatocriteria(i||[]))}var s=$L("crm-detailview-oldeditor")[0].component,o=Lyte.registeredMixins["crm-detailcanvas-utils"].getModuleNameFromRelatedlistId(r.id),n=moduleApiMapping[o];Lyte.registeredMixins["crm-detailcanvas-utils"].RequestingcanvasruleinBuilder(n),s.data.selectedModuleapiname===n&&s.setData("selectedModuleapiname",null),s.setData("selectedModuleapiname",n)},preformattr:{key:"zcqaval",key2:"zclabel",attr:{"data-zcqa":"canvas-detail-"}},fieldrerender:function(e){var t=e.find("[zcflag]"),r=t.length;if(r)for(var i=0;i<r;i++){var a=t.eq(i),s=a.removeAttr("lyte-rendered zcflag").outerHTML(),o=a.parent();a.remove(),o.append(s)}},onaddelement:function(e,t,r){if(e&&t&&t.noMapAvail&&e.addClass("zcanvas-ignore"),t&&t.ui&&t.ui.value&&(t.ui.value.zcode||t.ui.value.system_id)&&(t.ui.value.zcode||(t.ui.value.zcode={}),e.attr("data-zcqa","canvas-detail-"+t.ui.value.zcode.name),(t.ui.value.system_id||r)&&(t.ui.value.zcode.systemid=r||t.ui.value.system_id,Customization.sysidmapping&&Customization.sysidmapping[t.ui.value.system_id]?t.ui.value.zcode.elementname=Customization.sysidmapping[t.ui.value.system_id].element_name:delete t.ui.value.zcode.systemid),e.data("zcanvasdata",t.ui.value.zcode),e.hasClass("zctablayout")&&e.find(".zcaddtab").attr("data-zcqa","canvas-detail-"+t.ui.value.zcode.name+"-add")),t&&t.ui&&t.ui.label&&(t.ui.label.zcode||t.ui.label.system_id)&&(t.ui.label.zcode||(t.ui.label.zcode={}),(t.ui.label.system_id||r)&&(t.ui.label.zcode.systemid=r||t.ui.label.system_id,Customization.sysidmapping&&Customization.sysidmapping[t.ui.label.system_id]&&(t.ui.label.zcode.elementname=Customization.sysidmapping[t.ui.label.system_id].element_name)),e.find(".zcanvas-label").data("zcanvasdata",t.ui.label.zcode)),t&&t.ui&&t.ui.field&&(t.ui.field.zcode||t.ui.field.system_id)&&(t.ui.field.zcode||(t.ui.field.zcode={}),(t.ui.field.system_id||r)&&(t.ui.field.zcode.systemid=r||t.ui.field.system_id,Customization.sysidmapping&&Customization.sysidmapping[t.ui.field.system_id]&&(t.ui.field.zcode.elementname=Customization.sysidmapping[t.ui.field.system_id].element_name)),e.find(".zcanvas-value-container").data("zcanvasdata",t.ui.field.zcode)),t&&t.ui&&t.ui.value&&t.ui.value.class&&t.ui.value.class.indexOf("zc_disabled")>-1&&e.attr("data-zcqa","canvas-detail-"+t.ui.value.value+"-title"),t&&t.sectionId&&e&&e.zhasClass("zc-fieldsection")){e.data("zccompmeta",{sectionId:t.sectionId}),e.attr("data-sectionid",t.sectionId);var i=e.attr("id");e.addClass("zc-non-insertable");var a=e.find(".ui-draggable");a.draggable("option","containment","parent"),a.draggable("option","scope",i),e.find(".ui-droppable").add(e).droppable("option","scope",i),e.find(".zctable-sortable").addClass("zctable-disabled")}if(t&&t.ui&&t.ui.value&&t.ui.value&&t.ui.value.class&&t.ui.value.class.indexOf("zcimagefield")>-1)for(var s=e.find("[zcflag]"),o=s.length,n=0;n<o;n++){var l=s.eq(n),c=l.removeAttr("lyte-rendered zcflag").outerHTML(),d=l.parent();l.remove(),d.append(c)}if(t&&t.ui&&t.ui.icon){var u=zutils.getParentData(e);u&&u.bindlabelresize&&u.bindlabelresize(e)}},listjson:function(e){var t=document.querySelector("crm-detailview-oldeditor").getData("criterias"),r=[];!function e(t){zutils.compressioncallback&&zutils.compressioncallback(t,r);var i=t.children&&t.children.length;if(i)for(var a=0;a<i;a++)e(t.children[a])}(e),r=$u.uniq(r);var i=Lyte.registeredMixins["crm-detailcanvas-utils"].getModuleNameFromRelatedlistId(e.id),a=moduleApiMapping[i],s=t.filter((function(e){return e.module.api_name===a&&r.indexOf(e.zcid)>-1}));return e.ui.canvas_rules=s.map((function(e){return{id:e.id}})),e},listinterceptor:function(e){if(e&&e.noMapAvail){var t=$L(this.editorcontainer);t.addClass("zcanvas-ignore");var r=$L.parseHTML('<div class="zcanvas_overlay_component"><div class="zcanvas_overlay_action_container"><div class="zcanvas_overlay_action zcchangerl">'+I18n.getMsg("crm.canvas.builder.changerelatedlist")+'</div> <div class="zcanvas_overlay_action zcdeleterl">'+I18n.getMsg("crm.button.delete")+"</div> </div> </div>");t.append(r[0]);var i=t.find(".zcchangerl"),a=t.find(".zcdeleterl"),s=$(t[0]).data("zcanvas");return s&&(s.data=$L.isEmptyObject(s.data)?s.data:e,s.group="relatedlist",s.fieldContainer="#zcanvas_menu"),a.click((function(e){var t=$L(e.target).closest(".zcanvas-static-editor");zutils.deleteElement(t,!0)})),i.click((function(e){var t=document.querySelector(".canvas-page-container");t&&t.classList.add("zccontextclose"),zutils.changelistutil(e,null,e.currentTarget.parentElement,null,(function(e,t,r){e.find(".zcanvas_overlay_component").remove(),r.changelist(e,t,!0),setTimeout((function(){r.selectfieldonEditor&&r.selectfieldonEditor(e,!0),e.removeClass("zcanvas-ignore")}),10)})),e.stopImmediatePropagation()})),!1}return!0},lazyloadeditor:function(e,t,r){if(e.addClass("zcanvas-loading-component"),r&&r.data&&r.data.id){var i=$("#zcanvas_menu"),a=i.data("zcdatamap");if(a&&!a[r.data.id]){var s=(document.querySelector("crm-detailview-oldeditor").getData("components").section||[]).filter((function(e){return e.id===r.data.id}));if(s.length){var o=i.data("zcanvasMenu").config,n=a[s[0].label];o&&o.zmenustart(n,null,null,!0)}}if(a&&a[r.data.id]){for(var l=objectUtils.cloneObject(a[r.data.id].template),c=a[r.data.id].label,d=zclayout.prototype.layouts["Table Layout"],u=l.children,m=u.length,p=r.data.ui.value.tablestyles||{},g=p.rows||[],f=p.fields||{},h=0;h<m;h++){var y=g&&g[h];y&&(u[h].ui.value.style=y.value.style,u[h].ui.value.system_id=y.value.system_id);for(var v=u[h].children,_=v.length,b=0;b<_;b++){var w=v[b].id;f&&f[w]?v[b].ui=f[w]:v[b].ui=f.commonfield?objectUtils.cloneObject_new(f.commonfield):v[b].ui}}l.ui.value.layoutstyle=p.layoutstyles||{},l.ui.tablestyles={commonfield:objectUtils.cloneObject_new(f.commonfield)},p.table&&(l.ui.value.system_id=p.table.system_id,l.ui.value.style=p.table.style?p.table.style:l.ui.value.style);var C=d.toDom(l,t,0,0);this.onaddelement&&this.onaddelement(C,l),t.addClass("zc-section-element"),e.find(".zc_disabled .zctextcontent").html(c),e.removeClass("zcanvas-loading-component"),e.addClass("zc-fieldsection zc-non-insertable zc-static-callback")}}},customstaticjson:function(e,t){var r=e.find(".zclayout-table"),i=zclayout.prototype.layouts["Table Layout"].toJson(r),a={fields:{},rows:[],layoutstyles:i.ui.value.layoutstyle,table:i.ui.value};a.layoutstyles&&!a.layoutstyles.row&&(a.layoutstyles.row={height:"50px"});for(var s=i.children,o=s.length,n=0;n<o;n++){var l={value:{style:{}}};l.value.style=s[n].ui.value.style,l.value.system_id=s[n].ui.value.system_id,a.rows.push(l);for(var c=s[n].children,d=c.length,u=0;u<d;u++){var m=c[u].id;m&&(a.fields[m]=c[u].ui)}}var p=e.find(".zc-hidden-table-field"),g=canvasOutput.createJson(p);a.fields.commonfield=g.ui||{},t.ui.value.tablestyles=a;var f=e.data("zcanvas");return f&&f.data&&f.data.id&&(t.id=f.data.id),t},customstaticview:function(t){return Lyte.registeredMixins["crm-detailcanvas-utils"].customStatiView(t,e)},tabJSONcallback:function(e){var t=e.children,r={},i=t.length;if(t[0]&&!t[0].relatedList)return e;for(var a=0;a<i;a++){var s=t[a],o=s.children,n={sectionstyle:s.ui,titlesection:o[0],datastyle:o[1].ui};r[o[1].id]=n}return e.children=[],e.ui.allfieldstabstyle=r,e},tabDOMcallback:function(e){var t=e.ui.allfieldstabstyle;if(e.children.length&&!t){var r=Lyte.registeredMixins["crm-detailcanvas-utils"];if(!r.isSectionMigrationNeed)return e;t=(e=r.extractInfoFromSection(e)).ui.allfieldstabstyle}t&&$u.isEmpty(t)&&(Lyte.registeredMixins["crm-detailcanvas-utils"].swapAllFields(e),t=e.ui.allfieldstabstyle);var i=$("#zcanvas_menu"),a=i.data("zcanvasMenu"),s=i.data("zcdatamap"),o=a&&a.config,n=Lyte.Router.getRouteInstance().transition.info.dynamicParams[1],l=store.peekRecord("layout",n),c={};l.sections.map((function(e){"Score Summary"===e.api_name||0===e.fields.length||e.fields&&1==e.fields.length&&(e.fields[0].data_type.indexOf("profileimage")>-1||e.fields[0].data_type.indexOf("subform")>-1)||(c[e.uid]=e.fields)}));var d=[];for(var u in c){if((D=l.sections.filterBy({uid:u})).length){var m=D[0].display_label,p=s&&s[m],g=o&&p&&o.zmenustart(p,null,null,!0);g&&d.push(g)}}for(var f=d.length,h={_t:10,_l:20},y=0;y<f;y++){var v=d[y];if(v&&v.data&&v.data.ui&&v.data.ui.value&&v.data.ui.value.position){var _=v.sectionid,b={};t&&t[_]&&(b=t[_]),v.data.ui.value.position.startX=h._l,v.data.ui.value.position.startY=h._t,v.data.ui.value.position.width=b.sectionstyle?b.sectionstyle.value.position.width:"calc(100% - 60px)",v.data.ui.value.position.height=b.sectionstyle?b.sectionstyle.value.position.height:v.data.ui.value.position.height,v.data.ui.value.class+=" zc-fieldsectionallfield",v.data.ui.value.style=b.sectionstyle?b.sectionstyle.value.style:v.data.ui.value.style,v.data.ui.value.system_id=b.sectionstyle&&b.sectionstyle.value?b.sectionstyle.value.system_id:null,h._t+=v.data.ui.value.position.height+30,v.data.sectionId=_;var w=v.data.children;if(b.titlesection){b.titlesection.zcanvasId=w[0].zcanvasId,w[0]=b.titlesection;var C=w[0].children.filter((function(e){return"Static Text"===e.theme&&e.ui.value.class&&e.ui.value.class.indexOf("zc_disabled")>-1})),D=l.sections.filterBy({uid:_});C.length&&(C[0].ui.value.value=D.length?D[0].display_label:C[0].ui.value.value)}b.datastyle&&(w[1].ui=b.datastyle),e.children.push(v.data)}}return e},tabViewcallback:function(e){return Lyte.registeredMixins["crm-detailcanvas-utils"].allFieldFormation(e)}},o={fieldContainer:"#zcanvas_menu",layoutContainer:"#zcanvas_menu_insert",editorcontainer:"#zcanvas_editor",mapping:{label:"label",value:"value",type:"datatype"},nonMergableTypes:["text-area","profileimage","Owner_photo","button","tag"],hiddenLableType:["profileimage","Owner_photo","relatedlist","link","button","system","static_rel","subform","zia"],hiddenLableExclude:["morebutton","canvas_button_group"],groups:{},defaultstyle:{"text-area":{height:"40px"},profileimage:{width:"120px",height:"120px"},Owner_photo:{"padding-right":"17px"},timeline:{height:"300px"},image:{width:"400px",height:"50px"},fileupload:{width:"400px",height:"50px"}},stylebyid:{followers:{padding:"0"}},defaultclass:{button:"zcanvas-no-img-default zc-ta-center zccbutton",timeline:"zcanvas-timeline",profileimage:"zcbdrbox","text-area":"zctextarea",link:"zcanvas-no-img-default zcclink",fileupload:"zcfilefield",image:"zcimagefield"},classbyid:{navigate:"zcanvas-nav zc-restricted-icon",morebutton:"zc-only-icon zccbuttonicon",canvas_button_group:"zc-only-icon zccbuttonicon",back:"zc-restricted-icon"},classforall:"",defaulticons:{morebutton:"icon-Icon_dot_three",canvas_button_group:"icon-Icon_dot_three"},nonremovalclass:{morebutton:"zccbuttonicon",canvas_button_group:"zccbuttonicon"},removeclassbyid:{notes:"zc-ta-center",followers:"zc-ta-center"},uniqueId:"id",defaultscope:5,scopepertype:{relatedlist:2,static_rel:1,system:1,zia:1,image:1},scopebyid:{blueprint:1,data_privacy:1},preform:!1,preformhtml:function(e){return e.value},zcGuide:"#zcanvas-editor-outer > .zcanvas:not('.ui-draggable-dragging,.zcanvas-multiselect')",preformattr:{key:"zcqaval",key2:"zclabel",attr:{"data-zcqa":"canvas-detail-"}},submenuattr:{key:"data-zcqa",prefix:"canvas-detail-"},nosearch:!0,manualconfig:!1,zmenurevert:function(t){var r=$(t.target);if(r.hasClass("zcanvas-submenu-heading")){var i=r.attr("data-uniquekey"),a=$('#zcanvas_menu [data-uniquekey="'+i+'"]'),s=r.data("zcanvas")["zcanvas-afterdrop"];a.data("zcanvas",objectUtils.cloneObject_new(s)),delete r.data("zcanvas")["zcanvas-afterdrop"]}"stage_navigator"!=r.attr("data-uniquekey")||"Potentials"!==e.module&&"Deals"!==e.module||($('#zcanvas_menu [data-uniquekey="'+r.attr("data-uniquekey")+'"]')[0].innerText=I18n.getMsg("Stage")+"/"+I18n.getMsg("crm.label.cf.blueprint"))},zmenustart:function(t,r,i,a){if(t&&"canvas_component"===t.datatype){var s=moduleApiMapping[t.module],o=t.layoutId;app.store.makeRequest("findAll","related_list",{module:s,layout_id:o}).then((function(){var e=Lyte.registeredMixins["crm-detailcanvas-utils"];e.editPreProcess(t,t.module).then((function(t){e.processgallery(t)}))}))}if(t&&"relatedlist"===t.datatype&&!t.data?Lyte.registeredMixins["crm-detailcanvas-utils"].relatedListDataProcessing(t):(t&&"static_rel"===t.datatype||t&&"system"===t.datatype&&Crm.isActivitySplitDone&&("Activities"===t.api_name||"Activities_History"===t.api_name))&&Lyte.registeredMixins["crm-detailcanvas-utils"].fetchActionsForStaticRel(t,e.module),t.async&&Lyte.registeredMixins["crm-detailcanvas-utils"].loadResourceOnDemand(t,!0),t&&"system"===t.datatype&&"stage_navigator"===t.id&&("Potentials"!=e.module&&"Deals"!=e.module||!e.renameStage?"Potentials"!=e.module&&"Deals"!=e.module||e.renameStage||(t.zclabel=I18n.getMsg("Stage"),t.zcvalue=I18n.getMsg("Stage")):(t.zclabel=I18n.getMsg("crm.label.cf.blueprint"),t.zcvalue=I18n.getMsg("crm.label.cf.blueprint"))),t&&"submenu"===t.zcsubtype){t.menudata&&(t.data=objectUtils.cloneObject_new(t.menudata));var n=t.data&&1==t.data.length&&(t.data[0].datatype.indexOf("image")>-1||t.data[0].datatype.indexOf("subform")>-1);if(n){if(n&&!a){var l=$("#zcanvas_menu").data("zcanvasMenu");r.helper.addClass("zcanvas-field zcanvas-afterdrop").removeClass("zcanvas-submenu-heading");var c=objectUtils.cloneObject_new(t.data[0]),d=r.helper.attr("data-uniquekey"),u=$('#zcanvas_menu [data-uniquekey="'+d+'"]');c["zcanvas-afterdrop"]=t,u.data("zcanvas",c),l.dragstarthandler(null,r,c)}}else{var m=Lyte.registeredMixins["crm-detailcanvas-utils"],p=m.sectionfieldmapping(t.data),g=t.data.map((function(e){return e.id}));g=g.filter((function(e){return-1===e.indexOf("_profileimage")}));var f=m.processRelListObj(p,e.record,e.module,g,void 0,void 0,!0),h=$("#zcanvas_menu").data("zcdatamap");h&&(h[t.sectionid]||(h[t.sectionid]={}),h[t.sectionid].template=f,h[t.sectionid].label=t.zclabel);var y=JSON.parse('{"ui":{"value":{"style":{},"position":{"startX":39,"startY":31,"endX":452,"width":413,"height":234,"depth":1,"minTop":30,"minLeft":30},"tagname":"DIV","class":"zc-list-component","relatedList":true,"editorclass":"zcanvas-loading-component"}},"children":[{"ui":{"value":{"style":{},"position":{"startX":30,"startY":30,"endX":381,"width":351,"height":50,"depth":1,"minTop":11,"minLeft":10},"tagname":"DIV","class":"zcanvas-title-editor"}},"children":[{"children":[],"ui":{"value":{"style":{"default":{"background-color":"transparent"}},"position":{"startX":10,"startY":11,"endX":174,"width":164,"height":22,"depth":1},"tagname":"DIV","class":"zc_disabled","value":"'+t.zclabel+'"},"autoheight":false},"_type":"component","theme":"Static Text","zcanvasId":"zcanvas_2c76a5emm38"}],"_type":"static_content","theme":"Custom Layout","zcanvasId":"zcanvas_37aqskzijxp"},{"theme":"LazyLoad Component","lazyload":true,"id":"'+t.sectionid+'","children":[],"ui":{"value":{"position":{"startX":30,"startY":80,"endX":381,"width":351,"height":122,"depth":1},"style":{}}},"_type":"section"}],"_type":"component","relatedList":true,"theme":"Custom Layout","zcanvasId":"zcanvas_a1kkfrwft29"}');if(y=zcanvasrelatedList.recompiletemplate(y),t.zctype,t.value="",t.menudata=objectUtils.cloneObject_new(t.data),y.zccompmeta={sectionId:t.sectionid},y.ui.value.position.height=p.ui.value.position.height+110,t.data=y,a)return t}}},reusableObjScopeConfig:function(e,t){"relatedlist"===t.datatype?1===t.zcscope?t.mappedCount=1:0===t.zcscope?t.mappedCount=2:t.mappedCount=0:"static_rel"!==t.datatype&&"system"!==t.datatype&&"zia"!==t.datatype||(1===t.zcscope?t.mappedCount=0:0===t.zcscope&&(t.mappedCount=1))}};delete e.components.components;var n=e.components;for(var l in n){var c=n[l];if(c&&c.length)if("section"===l){var d=c.length;o.groups.fields={};for(var u=0;u<d;u++)o.groups.fields[c[u].label]={data:c[u].data,sectionid:c[u].id}}else o.groups[l]={data:c,template:l}}o.groups.relatedlist||(o.groups.relatedlist={},o.groups.relatedlist.data=[]),o.groups.system&&(o.groups.relatedlist&&o.groups.relatedlist.data&&(o.groups.relatedlist.data=o.groups.relatedlist.data.concat(o.groups.system.data)),delete o.groups.system),o.groups.zia&&(o.groups.relatedlist&&o.groups.relatedlist.data&&(o.groups.relatedlist.data=o.groups.relatedlist.data.concat(o.groups.zia.data)),delete o.groups.zia);var m=Lyte.registeredMixins.orchestration.getSupportedModules(),p=!1;m.forEach((function(t){t.api_name===e.moduledata.api_name&&(p=!0)}));var g=this.getAvailableModulesByFeatureForPrediction("predictions"),f=!1;g.forEach((function(t){t.api_name===e.moduledata.api_name&&(f=!0)}));var h=null,y=[];o.groups.relatedlist&&o.groups.relatedlist.data.forEach((function(e){var t=store.peekRecord("related_list",e.id),r=!0,i=!0;if(t&&"multiselectlookup"===t.type){var a=t.connectedmodule;r=moduleRecordMapping[a].viewable,i=moduleRecordMapping[a].visible}r&&i||y.push(e.id)}));var v=y.length,_=o.groups.relatedlist?o.groups.relatedlist.data:void 0;for(u=0;u<v;u++)_=$u.without(_,$u.findWhere(_,{id:y[u]}));o.groups.relatedlist&&_&&(o.groups.relatedlist.data=_);var b=o.groups.relatedlist?o.groups.relatedlist.data.length:0;for(u=0;u<b;u++)if(("social"===o.groups.relatedlist.data[u].api_name&&"China"!==RebrandLinkUtil.getProperty("DeploymentLocation")||"orchestrations"===o.groups.relatedlist.data[u].api_name&&!p||"prediction"===o.groups.relatedlist.data[u].api_name&&!f||"Invited_Events"===o.groups.relatedlist.data[u].api_name&&!Crm.userDetails.permissions.Crm_Implied_View_Events||"Contact_Roles"===o.groups.relatedlist.data[u].api_name&&!Crm.userDetails.permissions.Crm_Implied_View_Contacts||"blueprint"===o.groups.relatedlist.data[u].api_name&&("Potentials"===e.module||"Deals"===e.module))&&(h=u),null!=h&&(o.groups.relatedlist.data.splice(h,1),h=null,b-=1,u-=1),"stage_navigator"===o.groups.relatedlist.data[u].api_name&&("Potentials"===e.module||"Deals"===e.module))if("clone"===Lyte.Router.getRouteInstance().routeName||Crm.isCanvasGallery){var w=(S=Lyte.registeredMixins["crm-detailcanvas-utils"]).showStage,C=S.isBluePrintTrans,D=!0;D=!(!w&&!C)&&!!C,e.record&&e.record.$process_flow&&D?(o.groups.relatedlist.data[u].label=I18n.getMsg("crm.label.cf.blueprint"),o.groups.relatedlist.data[u].value=I18n.getMsg("crm.label.cf.blueprint")):(o.groups.relatedlist.data[u].label=I18n.getMsg("Stage"),o.groups.relatedlist.data[u].value=I18n.getMsg("Stage"))}else o.groups.relatedlist.data[u].label=o.groups.relatedlist.data[u].label+"/"+I18n.getMsg("crm.label.cf.blueprint"),o.groups.relatedlist.data[u].value=o.groups.relatedlist.data[u].label;h=null,b=o.groups.action.data.length;for(u=0;u<b;u++)"meetnow"!=o.groups.action.data[u].api_name&&"scheduleonlinemeeting"!=o.groups.action.data[u].api_name||Crm.calPreferences&&Crm.calPreferences.MEETINGPREFDETAILS&&("Leads"===e.module||"Contacts"===e.module)&&"China"!==RebrandLinkUtil.getProperty("DeploymentLocation")&&"Free"!==Crm.userDetails.LICENSE_TYPE_ACTUAL_NAME||(h=u),null!=h&&(o.groups.action.data.splice(h,1),h=null,b-=1,u-=1);h=null,b=o.groups.field.data.length;for(u=0;u<b;u++){if("subform"==o.groups.field.data[u].datatype){var L=store.peekRecord("field",o.groups.field.data[u].id);if(L)for(var R=store.peekRecord("layout",Lyte.Router.getRouteInstance().parent.getDynamicParam()).sections.filterBy({isSubformSection:!0}),P=R.length,I=0;I<P;I++)R[I].fields.filterBy({api_name:L.api_name}).length>0&&R[I].fields.filterBy({visible:!0}).length<2&&(delete o.groups.fields[L.display_label],h=u)}null!=h&&(o.groups.field.data.splice(h,1),h=null,b-=1,u-=1)}if("Potentials"==e.module||"Deals"==e.module)if(e.renameStage=!1,e.record&&e.record.$process_flow){var S;w=(S=Lyte.registeredMixins["crm-detailcanvas-utils"]).showStage,C=S.isBluePrintTrans;e.renameStage=!(!w&&!C)&&!!C}else e.renameStage=!1;var M=$("#zcanvas-editor-outer");o.metafields=this.transformdatatocriteria(e.layout[0].fields||[]),delete o.groups.field,$("#zcanvas_menu").zcanvasMenu(o),zclayout.prototype.layouts["Tab Layout"].onnavigation=Lyte.registeredMixins["crm-detailcanvas-utils"].tabOnNavigation;var k={fieldContainer:"#zcanvas_menu_insert",editorcontainer:"#zcanvas_editor_outer",mapping:{label:"label",value:"value",type:"datatype"},nosearch:!0,groups:{layouts:{data:new zclayout("id",null,(function(e){var t={"Section Layout":1,"Tab Layout":2,"Table Layout":3,"Static Text":4,"Canvas Image":5,"Static Icon":6,Line:7,"Canvas Button":8};return $u.sortBy(e,(function(e){return t[e.layoutname]}))}))}},uniqueId:"id",mainmenucontainer:"#zcanvas_menu",preformattr:{key:"layoutname",attr:{"data-zcqa":"canvas-detail-"}},scopebyid:{}};k.groups.layouts.data.map((function(e){var t=0;switch(e.layoutname){case"Section Layout":t=200;break;case"Tab Layout":t=25;break;case"Table Layout":t=50;break;case"Static Text":case"Static Icon":case"Line":t=200;break;case"Canvas Button":t=25;break;case"Canvas Image":t=5;break;default:t=25}k.scopebyid[e.id]=t})),$("#zcanvas_menu_insert").zcanvasMenu(k),$(".zcrm-canvas-tools-heading").click((function(e){$(e.target).closest(".zcrm-canvas-tools-heading").next().toggle()}));var T=[],E=function(e){var t=[];return e.each((function(e){var r=function(e,t,r){e||(e=$("#zcanvas-editor-outer").children(".zcanvas"));for(var i=$(t).position().top,a=$(t).position().left,s=$(t).position().left+$(t).outerWidth(),o=[],n=e.length,l=0;l<n;l++){var c=e[l],d=$(c).position().top;if(d!==i&&i<d){var u=$(c).position().left,m=$(c).position().left+$(c).outerWidth();(a<=u&&s>u||a>=u&&a<m)&&o.push(e[l])}}if(0!==o.length)return!0===r?o:$u.min(o,(function(e){return $(e).position().top}))}(null,$(e),!0);r&&(t=t.concat(r))})),t&&t.length?(T=T.concat(t),E(t)):$u.uniq(T)},A=function(e){var t=$("#zcanvas_menu_insert").data("zcanvasMenu");if(t){var r=t.getElementByKey("layoutname","Section Layout").data("zcanvas");if(!t.getCurrentScope(r))return;t.reduceScope(r)}T=[];var i=$("#zcanvas-editor-outer"),a={action:"link",actionarray:[],node:i},o=$(e),n=E([o]),l=o.clone().html(""),c=$(l),d=o.parents(".zcanvas-editor");d.length||(d=i),d.append(c);var u=d.data("zcanvas"),m=u.config.toolsRef.copystyle(o),p=c.outerHeight(),g=zutils.getRandomId();c.attr("id",g);var f=zutils.zcopyobj(s);f.editorcontainer="#"+g,f.draggable=!0,f.handles="all",c.zcanvas(f),c.css({"max-width":"none","max-height":"none","min-width":"auto","min-height":"auto",top:o.position().top+o.outerHeight()+10}),u.config.toolsRef.pastestyle(m,c),n.each((function(e){var t=$(e),r=t.position().top,i=r+p+10;$(e).css("top",i);var s={action:"drag",current:{top:i},previous:{top:r},node:t};a.actionarray.push(s)})),i.data("zcanvas").resetheight();var h={action:"neweditor",current:canvasOutput.createJson(c),node:c,editor:"#zcanvas-editor-outer"};a.actionarray.push(h),undoredomanager.push(a),zutils.reinitarrange(c),c.click()};s.toolsRef=new zcanvastools({baseeditor:"#zcanvas-editor-outer",toolcommon:".zc-tool",contexttools:{timeline:[{field:I18n.getMsg("crm.events.date"),selector:".timeLineHistDate"},{field:I18n.getMsg("crm.events.time"),selector:".timeLineHistTime"},{field:I18n.getMsg("crm.email.search.content"),selector:[".timeLineHistCont",".timeline_added.Notes span pre"]},{field:I18n.getMsg("zc.editor.link"),selector:["link-to a",".TimeLineHighTxt"]},{field:I18n.getMsg("crm.functions.oldvalue"),selector:".tl_from"},{field:I18n.getMsg("crm.functions.newvalue"),selector:".tl_to"},{field:I18n.getMsg("crm.owner.field.label"),selector:'span[purpose="showUserBC"]'},{field:I18n.getMsg("crm.canvas.builder.footer"),selector:[".tl_dat",".tl_by"]}],Notes:[{field:I18n.getMsg("crm.label.title"),selector:".cruxNotesList .cxNoteTitleSpan"},{field:I18n.getMsg("crm.email.search.content"),selector:".cruxNotesList .notesAddedContent"},{field:I18n.getMsg("crm.canvas.builder.footer"),selector:".cruxNotesList .notesOtherActionDetails .notesgray"},{field:I18n.getMsg("zc.editor.link"),selector:".cruxNotesList .moduleRecordName"},{field:I18n.getMsg("crm.canvas.builder.seperator"),selector:".cruxNotesLi",titleclass:"canvas-tool-name bold uppercase",nobasictools:!0,requiredtools:{bgcolor:!1,fsize:!1,color:!1,fweight:!1,bordercolor:!0}}],Table:[{field:I18n.getMsg("crm.module.subform.row"),subtools:[{field:I18n.getMsg("zc.editor.link"),selector:"lyte-td a",titleclass:"canvas-tool-name bold uppercase"}],texttitle:!0,titleclass:"zcanvas-menu-heading",selector:"lyte-tr",selectorformuladefault:"lyte-tr lyte-td",selectorformula:function(e){return"bgcolor"!=e?"lyte-tr lyte-td":"lyte-tr"},requiredtools:{bgcolor:!0,fsize:!0,color:!0,fweight:!0,bordercolor:!0}},{field:I18n.getMsg("zc.editor.header"),titleclass:"zcanvas-menu-heading",selector:"lyte-th",requiredtools:{bgcolor:!0,fsize:!0,color:!0,fweight:!0,bordercolor:!0}}]},preformattr:{key:"toolname",attr:{"data-zcqa":"canvas-detail-tool-"}},nodeattr:{key:"zcqaval",key2:"label",attr:{"data-zcqa":"canvas-detail-"}},stylecreationcallback:function(e,t){Crm.canvasUsedColors&&t&&"string"==typeof t&&0===t.indexOf("rgba")&&"rgba(255, 255, 255, 0)"!==t&&Crm.canvasUsedColors.push(t)},processstylevalue:function(e,t){return Lyte.registeredMixins["crm-detailcanvas-utils"].getUrlfromStyleData(e,t)},stylecompressioncallback:function(e){e&&e.opacity&&("0.5"===e.opacity?e._hide_="true":e._show_="true",delete e.opacity)},mousestateprefix:"_mousestate_",styledecompressioncallback:function(e){e&&(e._hide_||e._show_)&&("true"===e._hide_?e.opacity="0.5":"true"===e._show_&&(e.opacity="1"),delete e._hide_,delete e._show_)},contextrendercallback:function(e,t){var r=document.querySelector("crm-detailview-oldeditor");if(r&&!CScriptLib)return null;var i=r.getData("isrldata"),a=!1,s=t.is(".zcanvas-editor-outer"),o=t.closest(".tab");if(o.length?t=o:s||(t=t.closest(".zcanvas")),t.hasClass("zc-tab-container")&&(t=t.parent()),i&&!t.hasClass("zcanvas-static-editor"))return null;var n=t.data("zcanvasdata");n&&n.systemid&&(a=!0);var l=t.zdata(),c=!(!l||!l[0]||"tag"!==l[0].datatype),d=t.is(".zcanvas-static-editor")&&t.find("crm-detail-view-blueprint-action").length,u=null;if(t.hasClass("zcanvas-inner-component")||t.hasClass("zcanvas-data-node")||t.hasClass("zcanvas-field")){var m=t.closest(".zcanvas-field").data("zcanvas");if(m&&"field"===m._type)Lyte.registeredMixins["crm-detailcanvas-utils"].isAjaxEditableField(m.id,1,["profileimage","image","fileupload","imageupload"])&&(u="field")}var p=c||d||u||s;if(p?u?r.setData("selectedSpecialEventType",u):s?r.setData("selectedSpecialEventType","page"):r.setData("selectedSpecialEventType",c?"tag":"blueprint"):r.setData("selectedSpecialEventType",null),"addelementname"===e.event&&a){var g=objectUtils.cloneObject(e);return g.label=I18n.getMsg("crm.canvas.cscript.changeelementname"),g}if("addscript"===e.event){if(s||t.is(".zclayout.zccbutton")||t.hasClass("zcstaticicon")||t.is(".zcstatictext:not(.zc_disabled)")||p){var f=document.querySelector("#cscript-lmenu");return f&&f.setData("ltPropShow",!1),e}return null}return"managescripts"===e.event&&(a||p)?p||t.is(".zclayout.zccbutton")||t.hasClass("zcstaticicon")||t.is(".zcstatictext:not(.zc_disabled)")?e:null:"managescripts"!==e.event||a?e:null},errorcallback:function(){crmui.showMsgBand("error",I18n.getMsg("zc.editor.unable.to.download.images"),1e3)},tooldropdownopen:function(e,t){t?disablePerfectScroll("canvas-available-tools"):enablePerfectScroll("canvas-available-tools")},toolonfocus:function(){$(".canvas-tools-container").enableSelection()},toolonblur:function(){$(".canvas-tools-container").disableSelection()},validationerror:function(e,t,r,i){var a="";switch(e){case"minerror":a=I18n.getMsg("crm.canvas.validation.minlimit",[I18n.getMsg(r),t,i||""]);break;case"maxerror":switch(r){case"_row_":a=I18n.getMsg("crm.canvas.validation.rowlimit",[t]);break;case"_column_":a=I18n.getMsg("crm.canvas.validation.columnlimit",[t]);break;case"_textlength_":a=I18n.getMsg("crm.canvas.validation.textlimit",[t]);break;default:a=I18n.getMsg("crm.canvas.validation.maxlimit",[I18n.getMsg(r),t,i||""])}break;case"empty":a=I18n.getMsg("crm.replace.picklist.value.none");break;case"badinput":a=I18n.getMsg("crm.canvas.validation.incorrect")}crmui.showMsgBand("error",a,1e3)},toolcreatecallback:function(e,t,r){r.i18n&&t.attr("lt-prop-title",I18n.getMsg(r.i18n)).attr("lt-prop-tooltip-config",'{"position" : "top"}')},onstatechange:function(e){if((e.indexOf("hover")>-1||e.indexOf("active")>-1)&&$("#zcvisibilitycontainer").hide(),"default"!==e&&"active"!==e&&"hover"!==e){$(".zc_rules_list").show();var t=document.querySelector("crm-detailview-oldeditor"),r=[],i=e.split("_mousestate_");if(i.length)for(var a=i[0].split("_and_"),s=a.length,o=0;o<s;o++)for(var n=a[o].split("_child_"),l=n.length,c=0;c<l;c++)r.push(t.component.getCriteriabyzid(n[c]));t.setData("selectedstaterules",r),thirdPartyUtils.titleForEllipsis(document.querySelectorAll(".canvas_rulelist_item_name"))}else $(".zc_rules_list").hide()},onBeforeSelection:function(e,t,r){"object"==typeof e&&(e=e[0]);var i=$(".dimentiontool");"image"===e||"staticimage"===e?(this.selectedfields.removeClass("zcanvas-selected-element"),this.selectedfields=this.selectedfields.closest(".zcanvas-field"),this.selectedfields.addClass("zcanvas-selected-element"),i.addClass("zctool-nohelper")):i.removeClass("zctool-nohelper");var a=$(".zc_mouse_states"),s=$("#zc_state_hover"),o=!1,n=$("#zc_state_active"),l=$(".zc-custom-states"),c=!1;$L(".zc_state_tool li").removeClass("zcanvas-tools-list-selected"),$L(".zc_mouse_states li").removeClass("zcanvas-tools-list-selected"),"Tab Layout"!==e&&"button"!==e&&"Canvas Button"!==e||(o=!0);var d=!1;r&&"default"!==r.state?(d=!0,this.changestate(r.state,!0)):document.getElementById("zc_state_default").classList.add("zcanvas-tools-list-selected"),"Tab Layout"==e?(c=!0,document.getElementById("zc_state_active").classList.add("zcanvas-tools-list-selected"),this.changestate("active",!0)):(document.getElementById("zc_substate_default").classList.add("zcanvas-tools-list-selected"),!d&&this.changestate("default",!0)),"Tab Layout"===e||this.selectedfields&&!this.selectedfields.closest(".zc-table-cell").length&&("label"===e||"value"===e||"picklist"===e)||"Text"===e?$L("#aligntool").addClass("zc-disabled-tool"):$L("#aligntool").removeClass("zc-disabled-tool");var u,m="#uppercasetool",p=$L("#linethroughtool , #weightselect, #uppercasetool");if(this.selectedfields&&"value"==e){var g=zutils.getdatafromelement(this.selectedfields.closest(".zcanvas-field"));g&&g.datatype&&"boolean"==g.datatype?(p.addClass("zc-disabled-tool"),u=!0):p.removeClass("zc-disabled-tool")}else p.removeClass("zc-disabled-tool");if("Text"==e?$L(m).addClass("zc-disabled-tool"):u||$L(m).removeClass("zc-disabled-tool"),"picklist"===e?$L("#fontcolor").addClass("zc-disabled-tool"):$L("#fontcolor").removeClass("zc-disabled-tool"),!t){var f=$(".zcanvas-editor-outer").find(".ui-draggable:not(.ui-draggable-disabled):not(.zcanvas-non-selectable):not(.zc-strict-hide):not(.zcanvas-menuhidden)");f.length&&f.draggable("option","disabled",!0);var h=this.selectedfields;if(h.hasClass("zcanvas-locked-element")?i.addClass("zc-disabled-tool"):i.removeClass("zc-disabled-tool"),(h=h.not(".zcanvas-locked-element")).hasClass("ui-draggable:not(.zc-tab-content)"))h.draggable("option","disabled",!1);else{var y=h.closest(".ui-draggable:not(.zcanvas-locked-element)");y.length&&y.draggable("option","disabled",!1)}}s.hide(),n.hide(),l.show(),a.css("display","none"),o&&(s.show(),a.css("display","")),c&&(n.show(),l.show()),$(".zc-fit-screen").hide();var v=document.querySelector("crm-detailview-oldeditor");v&&v.component&&v.component.forcestateapply(this.state,this)},onSelection:function(e,t,r){"object"==typeof e&&(e=e[0]);var i=document.querySelector("crm-detailview-oldeditor");i.setData("selectedelementtype",e),zcanvasrelatedList&&zcanvasrelatedList.currentmenu&&"#zcanvas_menu"!==zcanvasrelatedList.currentmenu.opened?i.setData("isrldata",!0):i.setData("isrldata",!1);var a=this.selectedfields;a.hasClass("zc-tab-container")&&(a=a.parent());var s=a.data("zcanvasdata"),o="";s&&s.elementname&&(o=s.elementname),i.setData("selectedElementName",o),$("#canvas-available-tools").scrollTo(0),$(".canvas-tool-typetext").html(o||(zutils.getExternali18n?zutils.getExternali18n(e):e));var n=$("#gallerycontainer");if(n.find(".canvas-gallery").hide(),zcanvasgallery.isAvailableByType(e))if(n.find(".canvas-gallery-"+e).length)$(".canvas-gallery-"+e).show();else{n.append('<div class="canvas-gallery-'+e+' canvas-gallery"></div>');var l=zcanvasgallery.getstaticgallerylist.bind(this)(e);n.find(".canvas-gallery-"+e).html(l),zcanvasgallery.postprocess[e].bind(this)(l)}else $(".canvas-no-gallery").show();if("Tab Layout"==e&&this.selectedfields.hasClass("tab")){var c=this.selectedfields.find(".tabname");if(!c.hasClass("zc-tab-noedit")){var d=c.text();$(".canvas-tabname-container").show();var u=this.selectedfields.closest(".zctablayout");$("#zctabname").val(d).data({"zc-old-text":d,parent:u.attr("id"),current:this.selectedfields.attr("data-tab")})}r&&(this.state.indexOf("hover")>-1||this.state.indexOf("active")>-1)&&r.splice(r.indexOf("#zcvisibilitycontainer"),1)}if("Canvas Button"===e){$(".canvas-buttonname-container").show();var m=this.selectedfields.find(".zcanvas-value-container").text();$("#zcbtnname").val(m)}if("image"===e&&this.selectedfields&&this.selectedfields.is(".zcbdrbox.zclayout")){var p=this.selectedfields.find(".zcanvas-value-container>img").attr("zc-src");jsonCreation.toolinst.tools.populate.filepicker(jsonCreation.toolinst.availabletools.image_upload,{imagesrc:p}),$(".canvas-imageselect-container").show()}"page"===e&&$(".zc-fit-screen").show();var g=$(".canvas-align-tool"),f=!0;if("multiple"===e&&(g.show(),f=!1),"subtype"===e){var h=this.selectedfields.closest(".zcanvas-static-editor"),y=zutils.getParentData(h),v=h.data("zcanvas");Lyte.registeredMixins["crm-detailcanvas-utils"].contextselection.bind({data:v,element:h,options:y.config})(),f=!1}if(i.setData("hideaddstate",f),"page"!==e){var _=i.component;_.actions.switchsidebar.bind(_)("canvas-tools-container",document.querySelector(".canvas-sidebar-item-style"))}if("multiple"==e){var b=$(".zcanvas-selectbox");if(!b.length||b.hasClass("zcanvas-locked-element")?g.addClass("zc-disabled-tool"):g.removeClass("zc-disabled-tool"),b.length)var w=zutils.getParentData(b);else{var C=$(".zcanvas-selected-element");w=zutils.getdatabyelement(zutils.getClosestEditor(C))}if(!w)return;for(var D,L=w.config.toolsRef,R=L.selectedfields,P=R.length,I=0;I<P;I++){var S=L.config.gettype(R.eq(I)),M=L.config.tools[S.zctype];D=D?$u.intersection(D,M):M}if(D){var k=D.length;for(r=[],I=0;I<k;I++){var T=this.availabletools[D[I]],E=L.showtools(T);E&&r.push(E)}$(r.join(",")).show()}}"label"!==e&&"value"!==e||this.selectedfields&&this.selectedfields.closest(".zcanvas-field").parent().is(".zc-table-cell")&&$(".zc-labelalign-tool").hide(),Lyte.registeredMixins["crm-detailcanvas-utils"].selectionchange(this.selectedfields);var A=document.querySelector("crm-detailview-oldeditor");if(this.selectedfields){var F=this.selectedfields.data("zccustomstate");if(!F&&this.selectedfields.is(".zcanvas-field:not(.zccbutton)"))F=this.selectedfields.find(".zcanvas-data-node").data("zccustomstate");else if(this.selectedfields.is(".tab")&&this.config&&this.config.stateelement){var U=this.config&&this.config.stateelement&&this.config.stateelement(this.selectedfields);U&&(F=U.data("zccustomstate"))}F=F?zutils.zcopyobj2(F):[],A.setData("toolcriterias",F)}if(t&&"default"!==t.state){var O=document.getElementById("zc_state_"+t.state);O&&(O.classList.add("zcanvas-tools-list-selected"),A.component.actions.switchstate.bind(A.component)(t.state,!0,!1,!0))}if(zcanvasrelatedList&&zcanvasrelatedList.currentmenu&&"#zcanvas_menu"===zcanvasrelatedList.currentmenu.opened)A.setData("selectedcriteriamodule",null),A.setData("selectedModuleapiname",A.getData("defaultModuleapiname"));else{var x=$("#zcanvas-editor-outer").data("zcanvas");if(x&&x.config&&x.config.toolsRef){var N=$(x.config.toolsRef.selectedfields).closest(".zcanvas-non-delete");if(N&&N.length){var j=N.closest(".zcanvas-static-editor").data("zcanvas").id;A.setData("selectedcriteriamodule",j);var z=Lyte.registeredMixins["crm-detailcanvas-utils"].getModuleNameFromRelatedlistId(j);A.getData("selectedModuleapiname")===moduleApiMapping[z]&&A.setData("selectedModuleapiname",null),A.setData("selectedModuleapiname",moduleApiMapping[z])}else A.setData("selectedcriteriamodule",null),A.setData("selectedModuleapiname",A.getData("defaultModuleapiname"))}}$L(".style-root-container").show(),$L(".presets-root-container").hide();var q=$(".zc-style-menu");q.find(".selected").removeClass("selected"),q.find("li").eq(0).addClass("selected"),setTimeout((function(){disablePerfectScroll("canvas-available-tools"),enablePerfectScroll("canvas-available-tools")}),500)},integritycheck:function(e,t){return!(e.is(".zcanvas-editor-outer")&&this.config.tools.page&&!this.config.tools.page.contains(t.toolname)&&!this.config.tools.page.contains(t.parent))},gettype:function(e){var t={};if(!e)return t;var r=e.parents(".zcanvas-static-editor"),i=e.closest(".zcbdrbox"),a=i.length,s=e.children("crux-text-area-component").length;if(e.hasClass("zcanvas-static-editor"))e=r.length?r:e,t={zctype:"relatedlist"};else if(e.hasClass("zc-rl-sub-selectable"))t={zctype:"subtype"};else if(e.hasClass("tab"))t={zctype:"Tab Layout"};else if(e.hasClass("zctablayout"))t={zctype:"Tab"};else if(a)t=i.hasClass("zclayout")?{zctype:"staticimage"}:{zctype:"image"};else if(s)t={zctype:"textarea"};else if(e.hasClass("zclayout")){t={zctype:e.attr("data-layoutname")}}else if(e.hasClass("zclayoutselectable"))t={zctype:e.attr("data-layout-selctabletype")};else if(e.hasClass("zcanvas-non-delete"))t={zctype:"relatedlist section"};else if(e.hasClass("zcanvas-title-editor"))t={zctype:"relatedlist title"};else if(e.hasClass("zcanvas-editor"))t={zctype:"section"};else if(e.hasClass("zcanvas-editor-outer"))t={zctype:"page"};else if(e.hasClass("zcanvas-holder")){var o="holder";e.closest(".zccbutton").length?o="button holder":e.closest(".zcclink").length&&(o="link holder"),t={zctype:o}}else if(e.attr("zc-icon"))t={zctype:"icon"};else if(e.hasClass("zcanvas-label")){o="label";e.closest(".zccbutton").length?o="button label":e.closest(".zcclink").length&&(o="link label"),t={zctype:o}}else if(e.hasClass("zcanvas-value-container")){o="value";if(e.closest(".zccbutton").length)o="button value";else if(e.closest(".zcclink").length)o="link value";else if(e.closest(".zcimagefield").length)o="image value";else{var n=e.zdata();if((n=n.length&&n[0]?n[0]:null)&&"picklist"===n.zctype){var l=store.peekRecord("field",n.id);if(l&&l.enable_colour_code)e.closest(".zcanvas-field").parent().is(".zc-table-cell")||(o="picklist")}}t={zctype:o},e.find("crm-tag").length&&(t={zctype:"tag"})}else e.hasClass("zccbutton")?t={zctype:"button"}:e.hasClass("zcclink")?t={zctype:"link"}:e.hasClass("zcbdrbox")?t=e.hasClass("zclayout")?{zctype:"staticimage"}:{zctype:"image"}:e.hasClass("zcanvas-field")?t={zctype:"field"}:e.hasClass("zcanvas-seperator")?t={zctype:"seperator"}:e.hasClass("zcanvas-row-seperator")?t={zctype:"field row"}:e.hasClass("zcanvas-selectable")&&(t={zctype:e.attr("data-zcanvastooltype")});return t},preprocess:function(e,t,r){var i=t.actionproperty;if(e.is(".zctoolpostprocess")&&e.find("")&&e.is(".zclayout")){var a=e.attr("data-layoutname"),s=zclayout.prototype.layouts[a];if(s)return s.postprocessapply(e,t,r)}if((e.hasClass("zc-tabs")||e.hasClass("tab")||e.hasClass("zc-tab-container"))&&i&&(i.indexOf("margin")>-1||i.indexOf("padding")>-1)){var o=e.closest(".zctablayout"),n=o.children(".zc-tab-container"),l=n.outerHeight(),c=o.outerHeight(),d=n.css(["margin-top","margin-bottom"]);n.hasClass("zc-tab-processing")||(n.css("min-height",l+parseInt(d["margin-top"]+parseInt(d["margin-bottom"]))),n.addClass("zc-tab-processing"),n.attr("data-height",c))}},stateelement:function(e){return e.is(".zcanvas-field:not(.zccbutton)")?e.find(".zcanvas-data-node"):e.is(".tab")?e.parent("ul").find(".zcaddtab"):e},postprocess:function(e,t,r,i,a,s,o){var n=r.actionproperty;if(e.is(".zcanvas-field")||e.is(".zcanvas-holder")){var l=e.find(".zcanvas-inner-component"),c=l.length;if(e.hasClass("zccbutton")||"font-size"!=n&&"font-family"!=n&&"color"!=n&&"background-color"!=n){if("uppercase"==r.toolname)for(d=0;d<c;d++){if(!l.eq(d).is("[zc-icon]"))(u=this.changehandler(r,t,!0,null,null,l.eq(d)))&&u.actionarray&&u.actionarray[0]&&i.push(u.actionarray[0])}else if("linethrough"==r.toolname)for(d=0;d<c;d++){if(!l.eq(d).is("[zc-icon]"))(u=this.changehandler(r,t,!0,null,null,l.eq(d)))&&u.actionarray&&u.actionarray[0]&&i.push(u.actionarray[0])}}else for(var d=0;d<c;d++){var u={},m=l.eq(d);if(!m.find(".colorAppliedPicklist").length){var p=this.getSelectorByElement(m,"default"),g=this.getSelectorByElement(m);if(!this.getstylebyselector(p,!0)[this.state]){this.zcstyles[p][this.state]={};var f=0;o&&o[this.state]&&(f=o[this.state]._order),this.zcstyles[p][this.state]._order=f,this.zcstyles[p][this.state]._inherited=!0}u.action="action",u.node=p;var h={};for(var y in t)h[y]=this.zcstyles[p][this.state][y];$L.extend(this.zcstyles[p][this.state],t),this.updatestyle(r,g,this.zcstyles[p][this.state]),u.state=this.state,u.previous=h,u.current=t,i.push(u)}}}e&&e.hasClass("zcbdrbox")&&zutils.getParentData(e).adjustimagetooriginal(e);if(n&&"font-size"==n){var v=e.closest(".zcanvas-field");if(v.length){var _=v.outerWidth(),b=_-v.width(),w=_;if(_<(R=v.find(".zcanvas-data-node").outerWidth())){w=R+b;var C=v.position();C.width=_,C.height="auto";var D=zutils.zcopyobj(C);D.width=w,v.width(w),i.push({action:"resize",node:zutils.getSelectorByElement(v),current:D,previous:C})}}}if(n&&n.indexOf("bwidth")>-1&&Lyte.registeredMixins["crm-detailcanvas-utils"].selectionchange(e),n&&(n.indexOf("padding")>-1||n.indexOf("width")>-1)&&e.is(".zcstaticicon")){var L=e.children(".zciconcontainer"),R=L.children("span")[0].scrollHeight,P=L.css(["padding-left","padding-right","border-left-width","border-right-width"]);w=R+parseInt(P["padding-left"])+parseInt(P["padding-right"])+parseInt(P["border-left-width"])+parseInt(P["border-right-width"]);if(e.css({width:w,height:w}),!a){var I=e.data("uiResizable"),S={height:w,width:w};i.push({action:"resize",node:zutils.getSelectorByElement(e),current:S,previous:I.size}),I.size=S}}if(n&&(n.indexOf("margin")>-1||n.indexOf("padding")>-1)&&(e.hasClass("zc-tabs")||e.hasClass("tab")||e.hasClass("zc-tab-container"))){if((T=e.closest(".zc-tabs")).length)M=(k=T.closest(".zctablayout")).children(".zc-tab-container");else var M,k,T=(k=(M=e).closest(".zctablayout")).children(".zc-tablist-container").children(".zc-tabs");var E=T.outerHeight(),A=T.css(["margin-top","margin-bottom"]);if(M.hasClass("zc-tab-processing")){var F=M.css(["min-height","margin-top","margin-bottom"]),U=E+parseInt(A["margin-top"])+parseInt(A["margin-bottom"])+parseInt(F["min-height"])+parseInt(F["margin-top"])+parseInt(F["margin-bottom"]);if(!a){u={action:"resize",previous:{height:M.attr("data-height")},current:{height:U},node:"#"+k.attr("id"),editor:"#"+zutils.getParentEditor(k).attr("id")};i.push(u),M.removeClass("zc-tab-processing").css("min-height","")}k.css("height",U)}}if(n&&n.indexOf("bwidth")>-1&&e.hasClass("tab")&&!a){var O=e.find(".icon , .deletetabicon");O.css("position","relative"),setTimeout((function(){O.css("position","absolute")}),0)}},tools:{image:["width","height","radiussliderp","radiusphideswt","radiusinputp","radiusleftinputp","radiustopinputp","radiusrightinputp","radiusbottominputp","radiusswitchp","boxshadow","shadowhideswt","border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","depthforward","depthbackward","visibility"],staticimage:["image_upload","width","height","radiussliderp","radiusphideswt","radiusinputp","radiusleftinputp","radiustopinputp","radiusrightinputp","radiusbottominputp","radiusswitchp","boxshadow","shadowhideswt","border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","depthforward","depthbackward","visibility"],field:["border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","bgadvanced","bgimagecontd","bggradcontd","bgimagecover","bgimagerepeat","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","fontsize","fontcolor","bgcolor","bgcolorinput","fontweight","align","uppercase","italic","linethrough","radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","depthforward","depthbackward","labelalign","visibility"],holder:["border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","marginslider","margininput","marginleftinput","margintopinput","marginrightinput","marginbottominput","marginswitch","marginhideswt","fontsize","fontcolor","bgcolor","fontweight","align","uppercase","italic","linethrough","radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","labelalign"],label:["border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","bgadvanced","bgimagecontd","bggradcontd","bgimagecover","bgimagerepeat","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","marginslider","margininput","marginleftinput","margintopinput","marginrightinput","marginbottominput","marginswitch","marginhideswt","fontsize","fontcolor","bgcolor","bgcolorinput","fontweight","align","uppercase","italic","linethrough","radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","labelalign","tableverticalalign"],value:["border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","bgadvanced","bgimagecontd","bggradcontd","bgimagecover","bgimagerepeat","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","marginslider","margininput","marginleftinput","margintopinput","marginrightinput","marginbottominput","marginswitch","marginhideswt","fontsize","fontcolor","bgcolor","bgcolorinput","fontweight","align","uppercase","italic","linethrough","radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","labelalign","tableverticalalign"],picklist:["marginslider","margininput","marginleftinput","margintopinput","marginrightinput","marginbottominput","marginswitch","marginhideswt","fontsize","fontcolor","fontweight","align","uppercase","italic","linethrough","labelalign"],"image value":["border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","marginslider","margininput","marginleftinput","margintopinput","marginrightinput","marginbottominput","marginswitch","marginhideswt","bgcolor","bgcolorinput","radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","labelalign","tableverticalalign"],"button holder":["border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","marginslider","margininput","marginleftinput","margintopinput","marginrightinput","marginbottominput","marginswitch","marginhideswt","fontsize","fontcolor","bgcolor","fontweight","align","uppercase","italic","linethrough","radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","labelalign"],"button label":["border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","marginslider","margininput","marginleftinput","margintopinput","marginrightinput","marginbottominput","marginswitch","marginhideswt","fontsize","fontcolor","bgcolor","bgcolorinput","fontweight","align","uppercase","italic","linethrough","radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","labelalign"],"button value":["border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","marginslider","margininput","marginleftinput","margintopinput","marginrightinput","marginbottominput","marginswitch","marginhideswt","fontsize","fontcolor","bgcolor","bgcolorinput","fontweight","align","uppercase","italic","linethrough","radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","labelalign"],link:["border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","fontsize","fontcolor","bgcolor","bgcolorinput","fontweight","align","uppercase","italic","linethrough","radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","depthforward","depthbackward","visibility"],"link holder":["border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","marginslider","margininput","marginleftinput","margintopinput","marginrightinput","marginbottominput","marginswitch","marginhideswt","fontsize","fontcolor","bgcolor","fontweight","align","uppercase","italic","linethrough","radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","labelalign"],"link label":["border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","marginslider","margininput","marginleftinput","margintopinput","marginrightinput","marginbottominput","marginswitch","marginhideswt","fontsize","fontcolor","bgcolor","bgcolorinput","fontweight","align","uppercase","italic","linethrough","radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","labelalign"],"link value":["border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","marginslider","margininput","marginleftinput","margintopinput","marginrightinput","marginbottominput","marginswitch","marginhideswt","fontsize","fontcolor","bgcolor","bgcolorinput","fontweight","align","uppercase","italic","linethrough","radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","labelalign"],textarea:["lhslider","lhinput","border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","marginslider","margininput","marginleftinput","margintopinput","marginrightinput","marginbottominput","marginswitch","marginhideswt","fontsize","fontcolor","bgcolor","bgcolorinput","fontweight","align","uppercase","italic","linethrough","radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","labelalign","tableverticalalign"],tag:["border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","marginslider","margininput","marginleftinput","margintopinput","marginrightinput","marginbottominput","marginswitch","marginhideswt","bgcolor","bgcolorinput","radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","labelalign","tableverticalalign"],section:["width","height","widthswitch","heightswitch","radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","boxshadow","shadowhideswt","border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","bgadvanced","bgimagecontd","bggradcontd","bgimagecover","bgimagerepeat","bgcolor","bgcolorinput","depthforward","depthbackward","visibility"],button:["radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","paddinghideswt","boxshadow","shadowhideswt","border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","fontsize","fontcolor","bgcolor","fontweight","align","uppercase","italic","linethrough","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","bgadvanced","bgimagecontd","bggradcontd","bgimagecover","bgimagerepeat","bgcolorinput","depthforward","depthbackward","visibility"],"Canvas Button":["radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","paddinghideswt","boxshadow","shadowhideswt","border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","fontsize","fontcolor","bgcolor","fontweight","align","uppercase","italic","linethrough","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","bgadvanced","bgimagecontd","bggradcontd","bgimagecover","bgimagerepeat","bgcolorinput","depthforward","depthbackward","visibility"],"Tab Layout":["radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","fontsize","fontcolor","align","bgcolor","fontweight","uppercasetab","italic","linethroughtab","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","marginslider","margininput","marginleftinput","margintopinput","marginrightinput","marginbottominput","marginswitch","marginhideswt","bgadvanced","bgimagecontd","bggradcontd","bgimagecover","bgimagerepeat","bgcolorinput"],"Table Layout":["radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","boxshadow","shadowhideswt","border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","bgadvanced","bgimagecontd","bggradcontd","bgimagecover","bgimagerepeat","bgcolor","bgcolorinput","depthforward","depthbackward","visibility"],"Static Text":["radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","boxshadow","shadowhideswt","border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","fontsize","fontcolor","bgcolor","fontweight","align","uppercase","italic","linethrough","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","bgadvanced","bgimagecontd","bggradcontd","bgimagecover","bgimagerepeat","bgcolorinput","depthforward","depthbackward","visibility"],"Static Icon":["radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","boxshadow","shadowhideswt","border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","bgcolor","iconcolorhex","iconcolor","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","bgadvanced","bgimagecontd","bggradcontd","bgimagecover","bgimagerepeat","bgcolorinput","depthforward","depthbackward","visibility"],relatedlist:["width","height","widthswitch","heightswitch","radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","boxshadow","shadowhideswt","border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","bgadvanced","bgimagecontd","bggradcontd","bgimagecover","bgimagerepeat","bgcolor","bgcolorinput","depthforward","depthbackward","visibility"],"Tab Bar":["radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","boxshadow","shadowhideswt","border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","marginslider","margininput","marginleftinput","margintopinput","marginrightinput","marginbottominput","marginswitch","marginhideswt","bgadvanced","bgimagecontd","bggradcontd","bgimagecover","bgimagerepeat","bgcolor","bgcolorinput","depthforward","depthbackward"],"Tab Container":["radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","boxshadow","shadowhideswt","border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","marginslider","margininput","marginleftinput","margintopinput","marginrightinput","marginbottominput","marginswitch","marginhideswt","bgadvanced","bgimagecontd","bggradcontd","bgimagecover","bgimagerepeat","bgcolor","bgcolorinput","depthforward","depthbackward","visibility"],page:["width","height","widthswitch","heightswitch","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","bgadvanced","bgimagecontd","bggradcontd","bgimagecover","bgimagerepeat","bgcolor","bgcolorinput"],Line:["thickslide","thickwidth","thickstyle","thickcolor","thickhex","depthforward","depthbackward","linemodeswitch","visibility"],row:["radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","boxshadow","shadowhideswt","border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","bgadvanced","bgimagecontd","bggradcontd","bgimagecover","bgimagerepeat","bgcolor","bgcolorinput"],icon:["border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","iconcolorhex","iconcolor","bgcolor","bgcolorinput","radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt"],"relatedlist section":["width","height","widthswitch","heightswitch","radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","boxshadow","shadowhideswt","border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","marginslider","margininput","marginleftinput","margintopinput","marginrightinput","marginbottominput","marginswitch","marginhideswt","bgadvanced","bgimagecontd","bggradcontd","bgimagecover","bgimagerepeat","bgcolor","bgcolorinput"],"relatedlist title":["width","height","widthswitch","heightswitch","radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","boxshadow","shadowhideswt","border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","marginslider","margininput","marginleftinput","margintopinput","marginrightinput","marginbottominput","marginswitch","marginhideswt","bgadvanced","bgimagecontd","bggradcontd","bgimagecover","bgimagerepeat","bgcolor","bgcolorinput"],seperator:["border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","fontsize","fontcolor","bgcolor","bgcolorinput","fontweight","align","uppercase","italic","linethrough","radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt"],"field row":["border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","bgcolor","bgcolorinput","radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt"],MERGEFIELD:["boxshadow","shadowhideswt","border","bordert","borderr","borderb","borderl","borderswitch","borderhideswt","paddingslider","paddinginput","paddingleftinput","paddingtopinput","paddingrightinput","paddingbottominput","paddingswitch","paddinghideswt","bgcolor","bgcolorinput","mergehorizontalalign","mergeverticalalign","radiusslider","radiusinput","radiusleftinput","radiustopinput","radiusrightinput","radiusbottominput","radiusswitch","radiushideswt","depthforward","depthbackward","visibility"],Text:["fontsize","fontcolor","bgcolor","bgcolorinput","fontweight","align","uppercase","italic","linethrough"],Tab:[]},staticstyles:{label:[{selector:".zcanvas-row .zcanvas-field .zcanvas-inner-component",style:{default:{"padding-top":"0px","padding-left":"18px","padding-right":"18px","padding-bottom":"0px"}}}]},theme:{currenttheme:{field:{default:{}},label:{default:{color:"rgba(62, 62, 60, 1)","font-size":"15px","font-family":"LatoRegular","margin-right":"10px"}},value:{default:{color:"rgba(8, 7, 7, 1)","font-size":"15px","font-family":"LatoBold"}},textarea:{default:{color:"rgba(8, 7, 7, 1)","font-size":"15px","font-family":"LatoRegular","line-height":"1"}},section:{default:{"background-color":"rgba(255, 255, 255, 1)","border-radius":"4px",border:"1px solid rgba(221, 219, 218, 1)","box-shadow":"0px 2px 2px 0px rgba(0,0,0, 0.12)"}},"relatedlist section":{default:{"background-color":"rgba(255, 255, 255, 0)"}},"relatedlist title":{default:{"background-color":"rgba(255, 255, 255, 0)"}},title:{default:{color:"rgba(0, 0, 0, 1)","font-size":"18px","font-family":"LatoBold"}},button:{default:{"font-size":"15px",color:"rgba(34, 40, 51, 1)","border-radius":"6px","padding-top":"6px","padding-right":"20px","padding-bottom":"6px","padding-left":"20px","background-color":"rgba(234, 238, 245, 1)",border:"1px solid rgba(208, 212, 223, 1)","font-family":"LatoRegular"}},"Tab Layout":{default:{color:"rgba(62, 62, 60, 1)","font-size":"15px","font-family":"LatoRegular","padding-left":"20px","padding-right":"20px","padding-top":"10px","padding-bottom":"10px","background-color":"transparent","border-bottom":"3px solid transparent"},hover:{color:"rgba(62, 62, 60, 1)","border-bottom":"3px solid rgba(0, 112, 210, 1)"},active:{color:"rgba(62, 62, 60, 1)","font-size":"15px","font-family":"LatoBold","border-bottom":"3px solid rgba(0, 112, 210, 1)","padding-left":"20px","padding-right":"20px","padding-top":"10px","padding-bottom":"10px","background-color":"transparent"}},page:{default:{"background-color":"rgba(233, 235, 238, 1)","padding-bottom":"100px","padding-top":"0px","padding-left":"0px","padding-right":"0px"}},relatedlist:{default:{"background-color":"rgba(255, 255, 255, 1)","border-radius":"4px",border:"1px solid rgba(221, 219, 218, 1)","box-shadow":"0px 2px 2px 0px rgba(0,0,0, 0.12)",padding:"30px"}},"Static Text":{default:{padding:"10px"}},Line:{default:{"border-width":"1px","border-style":"solid"}},"Table Layout":{default:{"background-color":"rgba(255, 255, 255, 1)"}}},selector:{field:{default:".zcanvas-field:not(.zccbutton):not(.zc-rl-field):not(.zcclink)"},label:{default:".zcanvas-field:not(.zccbutton):not(.zc-rl-field):not(.zcclink) .zcanvas-label"},value:{default:".zcanvas-field:not(.zccbutton):not(.zc-rl-field):not(.zcclink) .zcanvas-value-container"},tag:{default:".zcanvas-field:not(.zccbutton):not(.zc-rl-field) .zcanvas-value-container crm-tag ul li"},section:{default:".zcanvas-editor:not(.zcanvas-non-delete):not(.zcanvas-title-editor):not(.zc-no-theme):not(.zclayout-table):not(.zc-tab-content)"},"relatedlist section":{default:".zcanvas-editor.zcanvas-non-delete"},"relatedlist title":{default:".zcanvas-editor.zcanvas-title-editor"},title:{default:".zcstatictext.zc_disabled"},button:{default:".zccbutton.zcanvas-field"},"Tab Layout":{default:".zctablayout .zc-tabs .tab:not(.active)",hover:".zctablayout .zc-tabs .tab:not(.active):hover",active:".zctablayout .zc-tabs .tab.active"},page:{default:".zcanvas-editor-outer"},relatedlist:{default:".zcanvas-static-editor"},"Static Text":{default:".zcstatictext:not(.zc_disabled)"},Line:{default:".zclayout.zcdivider .zc-divider-line"},"Table Layout":{default:"body > .zcanvas-field .zcanvas-editor.zclayout-table , .zcanvas-editor-outer .zcanvas-editor.zclayout-table"},textarea:{default:".zcanvas-field.zctextarea:not(.zccbutton):not(.zc-rl-field) .zcanvas-value-container"}}},customstate:function(e,t,r){if(!e||0!==e.indexOf("zcanvas"))return t;var i="_mousestate_",a=e.indexOf(i);if(a>-1){var s=e.length,o=i.length,n=e.slice(0,a),l=e.slice(a+o,s);l&&n&&(e=n,"hover"===l?t+=":hover":"active"===l&&(t+=".active"))}return r&&r.hasClass("zcanvas-non-delete")?"."+e+t:"."+e+" "+t},compressionmap:zutils.stylecompressionmap,classstyles:zutils.classstyles,classselector:function(e){return e.indexOf("zcanvas-holder")>-1&&(e=e.replace(".zcanvas-holder","").trim()),e},stylepriority:function(e,t){return e&&e.endsWith(".zc-tabs li.tab")&&(t=!0),t},processvaluebyconfig:function(e,t){return"image"===e?Lyte.registeredMixins["crm-detailcanvas-utils"].getUrlfromStyleData(null,t,1):t},poststylecreate:function(e,t,r){if(e&&e.indexOf(".zcanvas-field")>=0&&e.indexOf(":hover")>-1){e+=" .zcanvas-inner-component";for(var i=["font-family","font-size","color","background-color"],a={},s=i.length,o=0;o<s;o++)t[i[o]]&&(a[i[o]]=t[i[o]]);this.addrule(e,a,r,!0)}if(e&&e.indexOf(".zcanvas-holder")>-1&&t&&t["flex-direction"]&&t["flex-direction"].indexOf("column")>-1){this.addrule(e+"> .zcanvas-label",{"white-space":"normal;"},r,!0)}if(e&&e.indexOf(".zc-tablist-container .zc-tabs")>-1){var n=zutils.getSpacingProperties("margin",t),l=zutils.getSpacingProperties("padding",t),c=e.replace(".zc-tabs",".zc-tabs-nav");a={"padding-top":l["padding-top"]+"px","padding-bottom":l["padding-bottom"]+"px","margin-top":n["margin-top"]+"px","margin-bottom":n["margin-bottom"]+"px"};this.addrule(c,a,r,!0)}if(e&&e.indexOf(".zcanvas-value-container img")>-1){c=e+".cd_people_image";var d=zutils.getImageMaxProps(t);this.addrule(c,d,r,!0)}if(e&&e.indexOf(".zcanvas-value-container .zcimageholder")>-1){c=e+".zcimagebuilder",d=zutils.getImageMaxProps(t);this.addrule(c,d,r,!0),t&&this.addrule(e+"::after",{"background-image":t["background-image"]},r,!0)}}}),s.toolsRef.addtool({toolname:"width",container:"#widthtool",type:"input",actiontype:"action",actionproperty:"width",measurement:"px",basecontainer:".dimentiontool",actualmin:1,actualmax:3e3,i18n:"zc.editor.width",min:1,max:3e3,populate:function(e){var t=this.selectedfields,r=parseInt(t.width()),i=$(e.container+" input"),a=$(e.container+" .zcanvas-tools-input");i.val(r),i.data("zcprev",r),a.removeClass("zc-non-valid-input")},onChange:function(e,t){var r=this.main.selectedfields,i=r.width(),a=$(e.container+" .zcanvastoolinput"),s=a.data("zcprev");(parseInt(t.style.width)>0?parseInt(t.style.width)!=i&&(r.width(t.style.width),undoredomanager.push({action:"resize",node:r,previous:{width:s},current:{width:t.style.width},changedetection:$("#zcanvas-editor-outer").data("zcanvas").config.onChange}),a.data("zcprev",t.style.width),r&&r.hasClass("zcanvas-editor-outer")&&r.parent().width(t.style.width)):a.val(s),r&&r.hasClass("zcbdrbox"))&&zutils.getParentData(r).adjustimagetooriginal(r)}}),s.toolsRef.addtool({toolname:"height",container:"#heighttool",type:"input",actiontype:"action",actionproperty:"height",measurement:"px",actualmin:1,actualmax:21e3,i18n:"ze.editor.height",min:1,max:21e3,populate:function(e){var t=this.selectedfields,r=parseInt(t.height()),i=$(e.container+" input"),a=$(e.container+" .zcanvas-tools-input");i.val(r),i.data("zcprev",r),a.removeClass("zc-non-valid-input")},onChange:function(e,t){var r=this.main.selectedfields,i=r.height(),a=$(e.container+" .zcanvastoolinput"),s=a.data("zcprev");parseInt(t.style.height)>0?i!=parseInt(t.style.height)&&(r.height(t.style.height),undoredomanager.push({action:"resize",node:r,previous:{height:s},current:{height:t.style.height}}),a.data("zcprev",t.style.height)):a.val(s)}}),s.toolsRef.addtool({toolname:"widthswitch",container:"#widthswitch",type:"toggle",displayvalue:'<span class="zc_checkbox"></span>',actiontype:"condition",actioncondition:function(e){return"true"!=e.attr("data-fixed")&&"true"!=e.attr("data-fixed-x")&&"true"!=e.attr("fixed")},onChange:function(e){var t=this.main.selectedfields;0==!e&&t.attr("fixed")&&(t.removeAttr("fixed"),t.attr("data-fixed-y",!0)),t.attr("data-fixed-x",!e)}}),s.toolsRef.addtool({toolname:"heightswitch",container:"#heightswitch",type:"toggle",displayvalue:'<span class="zc_checkbox"></span>',actiontype:"condition",actioncondition:function(e){return"true"!=e.attr("data-fixed")&&"true"!=e.attr("data-fixed-y")&&"true"!=e.attr("fixed")},onChange:function(e){var t=this.main.selectedfields;0==!e&&t.attr("fixed")&&(t.removeAttr("fixed"),t.attr("data-fixed-x",!0)),t.attr("data-fixed-y",!e)}}),s.toolsRef.addtool({toolname:"lhslider",container:"#lhslider",type:"slider",selected:"0",actiontype:"action",actionproperty:"line-height",basecontainer:".zc-lh-tool",measurement:"",min:"1",max:"2",step:".1",i18n:"zc.editor.lineheight",actualmin:1,actualmax:2,mousewheel:!0,nomeasurement:!0,format:"float",sync:"#lhinput"}),s.toolsRef.addtool({toolname:"lhinput",container:"#lhinput",type:"input",selected:"0",actiontype:"action",actionproperty:"line-height",measurement:"",i18n:"zc.editor.lineheight",min:"1",max:"2",step:".1",actualmin:0,actualmax:2,mousewheel:!0,nomeasurement:!0,fixedpos:1,format:"float",sync:"#lhslider"}),s.toolsRef.addtool({toolname:"visibility",container:"#visibilitytool",actiontype:"action",actionproperty:"opacity",type:"list",basecontainer:"#zcvisibilitycontainer",list:[{selectvalue:"Show",displayvalue:"Show",style:{opacity:"1"}},{selectvalue:"Hide",displayvalue:"Hide",style:{opacity:"0.5"}}]}),s.toolsRef.addtool({toolname:"lhinput",container:"#lhinput",type:"input",selected:"0",actiontype:"action",actionproperty:"line-height",measurement:"",i18n:"zc.editor.lineheight",min:"1",max:"2",step:".1",actualmin:0,actualmax:2,mousewheel:!0,nomeasurement:!0,fixedpos:1,format:"float",sync:"#lhslider"}),s.toolsRef.tools.handler.colorpicker=function(e){var t='<div class="canvascolorcontainer" id="'+e.el+'"><div class="zcanvascolor"></div></div>',r=$($.parseHTML(t)),i=$(e.container);i.append(r),i.click(function(){a("#"+this.config.el,this.config.actionproperty,this.config.container,null,this)}.bind({main:this,config:e})),this.tools.metaformation.bind({main:this,config:e})(r)},s.toolsRef.tools.populate.colorpicker=function(e,t){t.length&&(this.multiobject(e,t)?t=t[0]:(t={},e.availableclass?t.class="":t[e.actionproperty]=""));var r=$(e.container).find(".canvascolorcontainer"),i=t[e.actionproperty];(i||""==i)&&r.css("background-color",i)},s.toolsRef.tools.getvalue.colorpicker=function(e){return $(e.container).find(".canvascolorcontainer").css("background-color")},s.toolsRef.tools.handler.hexinput=function(e){var t=$($.parseHTML('<span class="zcanvas-tools-input">\t\t       \t\t\t\t\t\t\t<span class="zcanvas-tool-input-param">#</span>\t\t\t\t\t                    <input type="text" maxlength="6" class="zcanvastoolinput"/>\t\t\t\t                    </span>'));$(e.container).append(t);var r=t.find(".zcanvastoolinput"),i=function(e){return function(e,t){var r=parseInt(e.slice(1,3),16),i=parseInt(e.slice(3,5),16),a=parseInt(e.slice(5,7),16);return t?"rgba("+r+", "+i+", "+a+", "+t+")":"rgb("+r+", "+i+", "+a+")"}("#"+e,1)},a=function(e){var t={style:{}},r=i(e.target.value);return t.style[this.config.actionproperty]=r,this.config.sync&&$(this.config.sync).find(".canvascolorcontainer").css("background-color",r),t=this.main.tools.preprocesshandler.bind(this)(t),this.config.onChange?this.config.onChange.bind(this)(this.config,t):this.main.changehandler(this.config,t,this.nocatch),e.stopImmediatePropagation(),t};r.change(a.bind({main:this,config:e,el:r})),r.on("paste",function(e){var t=e.originalEvent.clipboardData.getData("text");e.target.value=t.replace("#","").trim(),a.bind(this)(e)}.bind({main:this,config:e,el:r})),this.tools.metaformation.bind({main:this,config:e})(t)},s.toolsRef.tools.populate.hexinput=function(e,t){t.length&&(this.multiobject(e,t)?t=t[0]:(t={},e.availableclass?t.class="":t[e.actionproperty]=""));var r,a=e.actionproperty,s=t,o=$(e.container).find(".zcanvas-tools-input").find(".zcanvastoolinput");(r=(r=i(s[a]||"")).hex.replace("#","")).indexOf("NAN")>-1&&(r=""),o.val(r)},s.toolsRef.tools.handler.filepicker=function(){return $L("crm-canvas-image-uploader")[0]},s.toolsRef.tools.populate.filepicker=function(e,t){t.length&&(this.multiobject(e,t)?t=t[0]:(t={},e.availableclass?t.class="":t[e.actionproperty]=""));var r,i=e.actionproperty,a=t||{},s=$(e.container),o=s.find(".canvas-file-picker-preview"),n=s.find(".canvas-file-picker-btn");if(r=a[i],s.data("zcprev",r),r){var l=r.match(/\$Image\{([\s]*[^;\s\{]+[\s]*)\}/g),c=o.find(".canvas-file-picker-preview-img");if(l){var d=l[0].replace("$Image",""),u=d.substring(1,d.length-1);c.attr("src",Lyte.registeredMixins["crm-detailcanvas-utils"].getBgImageURL(u,"small"))}else c.attr("src",r);o.removeClass("dNImp"),n.addClass("dNImp")}else o.addClass("dNImp"),n.removeClass("dNImp")},s.toolsRef.tools.getvalue.filepicker=function(e){return $(e.container).data("zcprev")||""},s.toolsRef.tools.handler.gradient=function(e){var t=$(e.container),r=function(r,i){if(i){var a=$("#zcgradientpicker"),s=a.css("background-color");a.attr("data-bgcolor",s),t.data("zgradient").setbg()}var o={style:{}};this.config.preprocess&&(o=this.config.preprocess.bind(this)(o));var n=$(e.datacontainer);return this.main.changehandler(this.config,o,this.nocatch,this.nocatch?void 0:zutils.zcopyobj(n.data("zcprev"))),this.nocatch||n.data("zcprev",o.style),o},i=new ZGradientBuilder({container:e.container,onChange:r.bind({main:this,config:e,nocatch:!0}),onClick:function(e){$("#zcgradientpicker").removeAttr("id"),$(e).attr("id","zcgradientpicker"),a("#zcgradientpicker","gradient",0,r.bind(this))}.bind({main:this,config:e}),sortmethod:function(e){return $u.sortBy($L(e).toArray(),(function(e){return e.offsetLeft}))},onStop:r.bind({main:this,config:e}),onRemove:function(e){document.getElementById("zcanvascolorpicker").setData("ltPropShow",!1),r.bind(this)(e)}.bind({main:this,config:e})});t.data("zgradient",i),this.tools.metaformation.bind({main:this,config:e})(t)},s.toolsRef.tools.populate.gradient=function(e,t){t.length&&(t=this.multiobject(e,t,!0)?t[0]:{bggradient:[]});$(e.container).data("zgradient").setvalue(t[e.actionproperty])},s.toolsRef.tools.getvalue.gradient=function(e){return $(e.container).data("zgradient").getvalue()},s.toolsRef.addtool({basecontainer:".canvas-imageselect-container",toolname:"image_upload",container:"#canvas_imagesrc_comp",type:"filepicker",actiontype:"action",actionproperty:"background-image",prepopulatehandler:function(e,t){var r=t["background-image"]||"";canvasObjUtils._.isEmpty(r)&&(r="");var i=r.match(/url\((.*?)\)/),a="";return i&&i.length&&(a=i[1]),{"background-image":a}},preprocess:function(e){var t=e.style["background-image"];return t="url("+t+")",e.style["background-image"]=t,e}}),this.createcontextuals(s.toolsRef),undoredomanager.toolsRef=s.toolsRef;var F=new zcanvastools({baseeditor:"#previewstyles",tools:{},nocompile:!0,compressionmap:zutils.stylecompressionmap,classstyles:zutils.classstyles,meta:{fallbackurl:networkUtils.getImageUrl("image_profile_canvas_1d7b1e9_.svg",ResourceConstants.CRM)},stylepriority:function(e,t){return e&&e.endsWith(".zc-tabs li.tab")&&(t=!0),t},processstylevalue:function(e,t){return Lyte.registeredMixins["crm-detailcanvas-utils"].getUrlfromStyleData(e,t)},processvaluebyconfig:function(e,t){return"image"===e?Lyte.registeredMixins["crm-detailcanvas-utils"].getUrlfromStyleData(null,t,1):t},poststylecreate:function(e,t,r){if(e&&e.indexOf(".zcanvas-field")>=0&&e.indexOf(":hover")>-1){e+=" .zcanvas-inner-component";for(var i=["font-family","font-size","color","background-color"],a={},s=i.length,o=0;o<s;o++)t[i[o]]&&(a[i[o]]=t[i[o]]);this.addrule(e,a,r,!0)}if(e&&e.indexOf(".zc-tablist-container .zc-tabs")>-1){var n=zutils.getSpacingProperties("margin",t),l=zutils.getSpacingProperties("padding",t),c=e.replace(".zc-tabs",".zc-tabs-nav");a={"padding-top":l["padding-top"]+"px","padding-bottom":l["padding-bottom"]+"px","margin-top":n["margin-top"]+"px","margin-bottom":n["margin-bottom"]+"px"};this.addrule(c,a,r,!0)}if(e&&e.indexOf(".zcanvas-value-container img")>-1){c=e+".cd_people_image";var d=zutils.getImageMaxProps(t);this.addrule(c,d,r,!0)}},nodeattr:{key:"zcqaval",key2:"label",attr:{"data-zcqa":"canvas-detail-"}},customstate:Lyte.registeredMixins["crm-detailcanvas-utils"].customstateview,theme:{selector:{field:{default:"#previewcanvas .zcanvas-field:not(.zccbutton):not(.zc-rl-field)"},label:{default:"#previewcanvas .zcanvas-field:not(.zccbutton):not(.zc-rl-field) .zcanvas-label"},value:{default:"#previewcanvas .zcanvas-field:not(.zccbutton):not(.zc-rl-field) .zcanvas-value-container"},textarea:{default:"#previewcanvas .zcanvas-field.zctextarea:not(.zccbutton):not(.zc-rl-field) .zcanvas-value-container"},section:{default:"#previewcanvas .zcanvassection:not(.zcanvas-non-delete):not(.zcanvas-title-editor):not(.zcanvas-static-content-container):not(.zc-no-theme):not(.zc-tab-section)"},"relatedlist section":{default:"#previewcanvas .zcanvassection.zcanvas-non-delete"},"relatedlist title":{default:"#previewcanvas .zcanvassection.zcanvas-title-editor"},title:{default:"#previewcanvas .zcstatictext.zc_disabled"},button:{default:"#previewcanvas .zccbutton.zcanvas-field"},"Tab Layout":{default:".zctabview .zc-tabs .tab:not(.active)",hover:".zctabview .zc-tabs .tab:not(.active):hover",active:".zctabview .zc-tabs .tab.active"},page:{default:"#previewcanvas > div"},relatedlist:{default:"#previewcanvas .zc-list-component"},"Static Text":{default:".zcstatictext:not(.zc_disabled)"},Line:{default:".zclayout.zcdivider .zc-divider-line"},"Table Layout":{default:".zclayout-table > .canvas-outer"}}}}),U=new zcanvastools({baseeditor:"#presets-root-container",processstylevalue:function(e,t){return Lyte.registeredMixins["crm-detailcanvas-utils"].getUrlfromStyleData(e,t)}});jsonCreation.presetstoolinst=U,jsonCreation.toolinst=s.toolsRef,createStruture.toolinst=F,createStruture.singleshotrender=!0,zcconfig(s.toolsRef),zutils.enableshortcuts(),M.zcanvas(s);var O=M.droppable("instance");O&&(O.actualindex=-1),zcanvasrelatedList.currentmenu._default="#zcanvas_menu",$(".canvas-tools-container").disableSelection(),M.height(r);var x=this.getRouteInstance();if(x&&"edit"!=x.routeName){var N=renderingUtils.windowWidth>1680?1680:renderingUtils.windowWidth;M.width(N),M.parent().width(N),M.click().disableSelection()}else Crm.canvasUsedColors=[];var j=$(".zcanvas-menu-heading , .zcanvas-submenu-heading "),z=j.add(".canvas-tool-typetext");thirdPartyUtils.titleForEllipsis(z),j.click((function(e){var t=$(e.target);t.toggleClass("zcnotransform"),t.next().slideToggle();var r=t.closest(".ps-container");setTimeout((function(){if(r.length){var e=r.attr("id");disablePerfectScroll(e),enablePerfectScroll(e)}}),500)})),$L(".canvas-container").attr("tabindex","-1").addClass("outLine_non"),zutils.compressioncallback=Lyte.registeredMixins["crm-detailcanvas-utils"].compressioncallback},beforeExit:function(){app.cachedModulePromises={},app.reqCache={}},actions:{willTransition:function(e){if("crm.crm-error"!==e.info.route){var t=document.querySelector("crm-detailview-oldeditor"),r=t?t.getData():{},i=e.data&&e.data.disablePopup;if(r.changed&&!i){var a=e.pause(),s="stayonPageConfirmBox",o=$("#"+s);freezeBackground(),mailsetCenter(s),o.find(".leavePage").off("click").click((function(){"undefined"!=typeof autoSaveTimer&&clearTimeout(autoSaveTimer),$("#stayonPageConfirmBox").hide(),Lyte.registeredMixins["crm-detailcanvas-utils"].flusheditor(),a.resume(),removeFreezeLayer()})),o.find(".stayPage").off("click").click((function(){$("#stayonPageConfirmBox").hide(),e.abort(),removeFreezeLayer()})),o.focus()}else"undefined"!=typeof autoSaveTimer?clearTimeout(autoSaveTimer):r.changed||!e.info.route||e.info.route.indexOf("crm.settings.section.modules.module.canvas.edit")>-1||this.flusheditor()}}}},{mixins:["crm-detailcanvas-utils"]}),Lyte.Router.registerRoute("crm.settings.section.modules.index-modules",{queryParams:["showsorganizemods"],refreshNeeded:!1,model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","GET",{params:{action:"moduleList"}})},renderTemplate:function(e,t){return{outlet:"#result",html:e}},afterRender:function(){"true"==this.getQueryParams().showsorganizemods&&CML.showManageModule("show"),$("#mainMenuTabDiv").show(),$("#mainMenuTabDiv crm-tab")[0].component.resizeMenu();var e=this.transition.data;if(null!=e&&"true"===e.showLeadStatus){var t=$("#leadLayoutId").val();null!=t&&CMB.showSpecialFieldPopup("LeadStatusMap","true",t,void 0,void 0,"Leads")}},actions:{didTransition:function(){this.transition.data.refreshNeeded&&this.refresh()},willTransition:function(e){}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module",{redirect:function(){"crm.settings.section.modules.module"===this.transition.target&&this.replaceWith("crm.settings.section.modules.module.layouts",this.getDynamicParam())},renderTemplate:function(e,t){$("#setupshow").hide(),$("#result").html(""),$("#moduleCustomizationDiv").show(),CrmPageLayout.resetChanges()},actions:{willTransition:function(e){e.target.indexOf("crm.settings.section.modules.module")<0&&($("#setupshow").show(),$("#moduleCustomizationDiv").hide())},didTransition:function(){var e=this.getDynamicParam(),t=this.transition.target,r=t.split("crm.settings.section.modules.module.")[1].split(".")[0],i=crmTab.isZBCustomModule(e);!i||"links-and-buttons"===r&&moduleRecordMapping[e].viewable||Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.modules.module.links-and-buttons",crmTab.getFirstZBModule(e)),"field-permissions"!==r&&"field-privacy"!==r||(r="field-listing"),"Services"!==e&&"jobsheet-layouts"===r&&(r="layouts",Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.modules.module.layouts",e)),"Appointments"!==e&&"preferences-module"===r&&(r="layouts",Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.modules.module.layouts",e));var a=(D=$("#cusLinkLI")).children();if("crm.settings.section.modules.module.layouts.view-layout"!==t&&"crm.settings.section.modules.module.layouts.clone-layout"!==t){var s=$("#innerTabDiv"),o=$("#moduleListDiv"),n=$("#moduleCustomizationDiv");if("Events"==e)s.find("#formRulesLI").show(),s.show();else if("Tasks"==e||e.indexOf("LinkingModule")>-1||"Calls"==e||"false"==s.find("#cusLinkLI").attr("bothAvailable"))"Tasks"!=e&&(a.html(I18n.getMsg("crm.customlink")),D.show()),"Calls"===e&&!isNewCallView||e.indexOf("LinkingModule")>-1?s.find("#formRulesLI").hide():s.find("#formRulesLI").show(),s.show();else if("Users"==e)s.find("#cusLinkLI,#infoLI,#formRulesLI").hide(),o.hide(),n.find("#modListSpan,#modListSpan1").mouseover((function(){CrmModule.newshowtt(I18n.getMsg("crm.back.users"))})).click((function(){parent.window.close()})),n.find("#manageUserDiv").show();else if(i){var l=s.find("#cusLinkLI");l.children().html(I18n.getMsg("crm.custom.buttons.links")),l.show(),s.find("#infoLI,#formRulesLI,#layoutsLI,#validationRulesLI,#fieldsLI").hide(),s.show()}else s.find("#cusLinkLI").children().html(I18n.getMsg("crm.custom.buttons.links")),s.find("#cusLinkLI").show(),s.find("#formRulesLI").show(),s.show();var c=$("#jobSheetLayoutsLI");"Services"===e?(CrmPageLayout.showOrHideJobsheetLayout(),D.hide()):c.hide();var d=$("#preferencesLI");"Appointments"===e?(d.show(),$("#cusLinkLI").hide()):d.hide(),s.find("link-to").attr("lt-prop-dp",'["'+e+'"]'),!$('#ModuleListUL option[value="'+e+'"]').length>0&&$("#ModuleListUL").append($("<option>",{value:e,text:Crm.moduleInfo[e].pluralLabel})),$("#moduleCustomizationDiv").find("#actionNavDiv").find("#modListSpan1").closest("link-to").attr("lt-prop-dp",'["'+e+'"]')}$("#customActionDiv").hide(),$("#moduleCustomizationDiv").find("#innerTabDiv").find("li").removeClass("active"),"layout-rules"!==r||("Calls"!==e||isNewCallView)&&"Users"!==e||Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.modules.module.layouts",e);var u="crm.settings.section.modules.module."+r;$("#moduleCustomizationDiv").find("#innerTabDiv").find("link-to[lt-prop-route='"+u+"']").find("li").addClass("active");var m=$("#layoutsLI");if("validation-rules"==r||"layout-rules"==r||"summary-module"==r||"field-listing"==r||"layouts"==r||"links-and-buttons"==r||"customViewSettings"==r)if($("#autoLinks").hide(),$("#templateLinks").hide(),"Calls"===e&&!isNewCallView||"Users"===e||"Visits"===e||"linking"===moduleRecordMapping[e].generated_type||i){var p=$("#formRulesLI");p.hide();var g=$("#validationRulesLI");g.hide(),(p.hasClass("active")||g.hasClass("active"))&&m[0].click()}else $("#innerTabDiv").find("#infoLI,#formRulesLI,#layoutsLI,#validationRulesLI,#fieldsLI").show();var f=$('#ModuleListUL option[value="'+e+'"]'),h=Crm.moduleInfo[e].pluralLabel,y=$("#customizationDiv"),v=$("#layout_landing_left"),_=$("#layout_landing_right"),b=$(".moduleNameSection"),w=_.find(".moduleLandingName"),C=w.find("span"),D=$("#cusLinkLI");i?C.text(crmTab.getDisplayName("Zoho Finance",!1)+" - "+h):C.text(Crm.moduleInfo[e].translatedPluralLabel),$(".landingModuleLists ul li").removeClass("selected"),$(".landingModuleLists ul li[data-zcqa='MPL_layoutListPage_"+e+"']").addClass("selected");var L=$(".landingModuleLists ul li.selected");if("layout-rules"==r||"preferences-module"==r||"jobsheet-layouts"==r||"summary-module"==r?(y.addClass("p30 pT20"),v.show(),b.show(),CML.layoutLandingResize()):"field-listing"==r?(y.addClass("p30 pT20"),"Users"!==e?($("body").removeClass("fromUserManageFields"),v.show(),_.removeClass("w100p pL20 fullInfoNoteDiv"),_.find("#innerTabDiv").addClass("pL15").removeClass("pL30"),w.removeClass("pR"),$("#modListSpan2").hide()):($("body").addClass("fromUserManageFields"),v.hide(),_.addClass("w100p pL20 fullInfoNoteDiv"),_.find("#innerTabDiv").removeClass("pL15").addClass("pL30"),w.addClass("pR"),$("#modListSpan2").show()),b.show(),$("#mainMenuTabDiv").show(),$("#mainMenuTabDiv crm-tab")[0].component.resizeMenu(),$("body").removeClass("builder_page_body"),CML.layoutLandingResize()):"validation-rules"==r?(y.addClass("p30 pT20"),v.show(),b.show(),CML.layoutLandingResize()):"links-and-buttons"==r&&("Services"===e||"Appointments"===e?(D.removeClass("active"),m[0].click()):(D.addClass("active"),D.show()),y.addClass("p30 pT20"),v.show(),b.show(),CML.layoutLandingResize()),f.prop("selected",!0),thirdPartyUtils.bindSelect2("#ModuleListUL"),"layouts"!=r&&"jobsheet-layouts"!==r||"crm.settings.section.modules.module.layouts.view-layout"===t||"crm.settings.section.modules.module.layouts.clone-layout"===t||($("#mainMenuTabDiv").show(),$("#mainMenuTabDiv crm-tab")[0].component.resizeMenu(),b.show(),"Users"!==e?($("body").removeClass("fromUserManageFields"),v.show(),_.removeClass("w100p pL20 fullInfoNoteDiv"),_.find("#innerTabDiv").addClass("pL15").removeClass("pL30"),w.removeClass("pR"),$("#modListSpan2").hide()):($("body").addClass("fromUserManageFields"),v.hide(),_.addClass("w100p pL20 fullInfoNoteDiv"),_.find("#innerTabDiv").removeClass("pL15").addClass("pL30"),w.addClass("pR"),$("#modListSpan2").show()),y.addClass("p30 pT20"),C.text(moduleRecordMapping[e]?moduleRecordMapping[e].plural_label:e),CML.layoutLandingResize()),"Tasks"===e?(a.html(I18n.getMsg("crm.custom.buttons.links")),D.show(),s&&s.show()):"Events"===e&&(a.html(I18n.getMsg("crm.label.cf.custom_buttons")),D.show(),s&&s.show()),"map-dependency"!=r||"crm.settings.section.modules.module.map-dependency.create-map-dependency"!=t&&"crm.settings.section.modules.module.map-dependency.edit-map-dependency"!=t||(y.addClass("p30 pT20"),v.show(),CML.layoutLandingResize()),L.length>0&&!renderingUtils.isElementInViewport(L)){var R=L.position().top;$(".landingModuleLists").scrollTo(R)}}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.canvas.clone",{queryParams:["layoutId"],model:function(){var e=this.transition.info.dynamicParams[2];return Lyte.resolvePromises({views:app.store.makeRequest("findRecord","canvasview",e,{unparsed:!0})})},afterModel:function(e){e.views=e.views[0],e.module=this.transition.info.dynamicParams[0];var t=e.views.module,r=moduleApiMapping[t],i=this.transition.info.queryParams.layoutId;return Lyte.resolvePromises({relatedlist:app.store.makeRequest("findAll","related_list",{module:r,layout_id:i})})},renderTemplate:function(e){var t=e.views.module,r=document.querySelector("crm-detailview-oldeditor");r&&r.setData("loading",!0),Crm.client_tracking("Canvas DetailView - Clone View Click",{Module:t}),this.editPreProcess(e.views,t).then(function(e){$("#canvasname").val(""),this.transition.info.dynamicParams[1]!==this.transition.info.queryParams.layoutId?this.processgallery(e):this.editPostProcess(e),r&&r.setData("loading",!1)}.bind(this))}},{mixins:["crm-detailcanvas-utils"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.canvas.create",{model:function(){var e,t=this.parent.getRouteInstance().transition.info.dynamicParams;return e=Customization.orgSpec.includes(Crm.userDetails.LICENSE_TYPE)?{feature:"DetailView",from_range:1}:{feature:"DetailView",module:t[0]},store.findAll("canvasview",e).then((function(e){var r=e.$.meta.maxViewLimit;if(e.length>=r)if(Customization.moduleSpec.includes(Crm.userDetails.LICENSE_TYPE)){var i=moduleRecordMapping[t[0]].plural_label;renderingUtils.showCustomAlert(I18n.getMsg("crm.canvas.module.limit.exceed",["Canvas",i]))}else renderingUtils.showCustomAlert(I18n.getMsg("crm.canvas.limit.exceed","Canvas"))}))},renderTemplate:function(){var e=Lyte.Router.getRouteInstance().transition.info,t=e.queryParams?e.queryParams.template:void 0;if(t){var r=e.dynamicParams[0],i=document.querySelector("crm-detailview-oldeditor");i&&i.setData("loading",!0),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CanvasGallery.do?action=getCustomisedDetailViewGallery&module="+r+"&type="+t+"&preview=false","GET",void 0).then(function(e){Crm.isCanvasGallery=!0,this.processgallery(e),Crm.isCanvasGallery=!1,i&&i.setData("loading",!1)}.bind(this)),Crm.client_tracking("CanvasGallery Edit landing",{template:t,Module:r}),$L(".canvas-page-container").attr("data-canvassrc",t)}else setTimeout((function(){var e=$L("crm-detailview-canvas-gallery")[0];document.getElementById("canvas-gallery").ltProp("show",e.component.getData("openGallery"))}),500)}},{mixins:["crm-detailcanvas-utils"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.canvas.edit",{model:function(){var e=this.transition.info.dynamicParams[2],t=this;return app.store.makeRequest("findRecord","canvasview",e,{unparsed:!0}).then((function(e){return Lyte.resolvePromises({views:e})})).catch((function(e){var r=JSON.parse(e.responseText);"FEATURE_NOT_SUPPORTED"===r.code?(renderingUtils.displayPermissionDenied(),$("#popupnew").find(".mT10").text(I18n.getMsg("crm.label.cf.error.feature.unsupported"))):"FEATURE_NOT_ENABLED"!==r.code&&"NOT_ALLOWED"!==r.code||(renderingUtils.displayPermissionDenied(),$("#popupnew").find(".mT10").text(I18n.getMsg("crm.security.error"))),t.transition.abort()}))},afterModel:function(e){return e.views=e.views[0],e.module=this.transition.info.dynamicParams[0],e.views.$.isError?(this.getRouteInstance().transitionTo({route:"crm.crm-error",dynamicParams:[e.module]}).data={showError:!0,module:e.module,errorMsg:I18n.getMsg("canvas.not.accessible","Canvas")},void this.transition.abort()):store.findAll("canvas_rule",{},null,null,{customizationId:this.transition.info.dynamicParams[2]})},renderTemplate:function(e){if(!this.transition.data||!this.transition.data.disablePopup){$(".dummy_Body").hide();var t=document.querySelector("crm-detailview-oldeditor");t&&t.setData("loading",!0),e.views.ui.script_info&&(t.setData("editsysidmapping",e.views.ui.script_info.mapping||{}),Customization.sysidmapping=objectUtils.cloneObject(e.views.ui.script_info.mapping||{}),t.setData("lastsavedmapping",objectUtils.cloneObject(e.views.ui.script_info.mapping)||{})),setTimeout(function(){this.editPreProcess(e.views,e.module).then(function(r){$("#canvasname").val(r.name),this.editPostProcess(r),t&&t.setData("loading",!1);var i=$("#zcanvas-editor-outer");i.click().disableSelection(),e.views.ui&&e.views.ui.value&&e.views.ui.value.system_id&&e.views.ui.script_info&&e.views.ui.script_info.mapping&&e.views.ui.script_info.mapping[e.views.ui.value.system_id]&&i.data("zcanvasdata",{systemid:e.views.ui.value.system_id,elementname:e.views.ui.script_info.mapping[e.views.ui.value.system_id].element_name})}.bind(this))}.bind(this),10)}}},{mixins:["crm-detailcanvas-utils"]}),Lyte.Router.registerRoute("crm.settings.section.modules.index-modules.create-module",{model:function(e){var t={params:{action:"showModuleBuilder",operation:"create"}};return networkUtils.setCsrfParam(t),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",t)},afterModel:function(e,t){if(0===e.indexOf("ALERT:::"))(r=e.split("ALERT:::")).length>2?CML.showModuleDeleteErrorWithTip(r[1],r[2]):CrmModule.notifyUser("alert",r[1],5e3),CrmModule.toggleBusy("primaryBtnLayer",!0),this.transition.abort();else if(0===e.indexOf("ERROR:::")){var r=e.split("ERROR:::");CrmModule.notifyUser("alert",r[1]),CrmModule.toggleBusy("primaryBtnLayer",!0),this.transition.abort()}else if(0===e.indexOf("COUNTEXCEED:::")){r=e.split("COUNTEXCEED:::");CrmModule.notifyUser("alert",r[1],5e3),CrmModule.toggleBusy("primaryBtnLayer",!0),this.transition.abort()}},renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:e}},afterRender:function(e,t){CrmModule.arrangeBuilder(!0),$("#setupshow").hide(),$("#result").html(""),$("#moduleCustomizationDiv").show(),$("#moduleCustomizationDiv").hasClass("createLayout")&&$("#moduleCustomizationDiv").removeClass("createLayout"),$("#moduleCustomizationDiv").addClass("createModule"),$("#moduleCustomizationDiv").find("#actionNavDiv").hide(),$("#moduleCustomizationDiv").find("#innerTabDiv").hide(),$("#customActionDiv").hide(),$(".moduleNameSection").hide(),$("#layout_landing_left").hide(),$("#customizationDiv").removeClass("p30 pT20").show(),$("#permissionComponentPopup").length>0&&(CML.isFPAccess=!0);var r="create",i={params:{action:"getNewFieldButtonDetails",operation:r}};networkUtils.setCsrfParam(i);var a=networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",i),s={params:{action:"getExistedSectionAndFieldDetails",operation:r}};networkUtils.setCsrfParam(s);var o=networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",s);return CrmPageLayout.resetChanges(),CML.builderOperation=r,Lyte.resolvePromises({newFields:a,existedFields:o}).then(function(e){CML.designNewFieldsAndButtons(e.newFields,"create"),CML.designExistingSectionAndFields(e.existedFields,"create")}.bind(this))},actions:{willTransition:function(e){if("crm.settings.section.modules"!==e.target&&"crm.settings.section.modules.index-modules"!==e.target||(e.data={refreshNeeded:!0}),Events.isPageLayoutModified){var t=e.pause(),r="stayonPageConfirmBox",i=$("#"+r);freezeBackground(),mailsetCenter(r),i.find(".leavePage").off("click").click((function(){$("#stayonPageConfirmBox").hide(),t.resume(),removeFreezeLayer(),Events.isPageLayoutModified=!1})),i.find(".stayPage").off("click").click((function(){$("#stayonPageConfirmBox").hide(),e.abort(),removeFreezeLayer()})),i.focus()}}},beforeExit:function(){var e=$("#moduleCustomizationDiv");$("#setupshow").show(),$("#mainMenuTabDiv").show(),e.find("#actionNavDiv").show(),e.find("#innerTabDiv").show(),e.hide().removeClass("createModule"),$L("body").removeClass("builder_page_body")}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.conversion-mapping",{queryParams:["leadLayoutId","accountLayoutId","contactLayoutId","potentialLayoutId","quoteLayoutId","salesOrderLayoutId","invoiceLayoutId","showLayout"],getResources:function(){this.module=this.parent.getDynamicParam();var e=networkUtils.returnDependencyFiles(["crm-mxn-lead-conversion.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-mxn-lead-conversion.css"],crmConstants.cssStaticPathForLyte),r=e.concat(t);if(r=(r=r.concat(networkUtils.returnDependencyFiles(["crm-inventory-mapping-helper.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("LinkingModuleConvertField")],crmConstants.jsStaticPath)),"Leads"!==this.module){var i=networkUtils.returnDependencyFiles(["i18n/"+Crm.userDetails.jsLocation+"conversion_mapping/zohocrm_"+$ESAPI.encoder().encodeForJavaScript(Crm.userDetails.LOCALE)+".js"]);return(i=Crm.userDetails.RTL_ENABLED?i.concat(networkUtils.returnDependencyFiles(["crm-inventory-mapping-rtl.css","crm-inventory-mapping.css"],crmConstants.cssStaticPathForLyte)):i.concat(networkUtils.returnDependencyFiles(["crm-inventory-mapping.css"],crmConstants.cssStaticPathForLyte))).concat(r)}return r},getDependencies:function(){if("Leads"!==this.parent.getDynamicParam())return networkUtils.returnDependencyFiles(["crm-inventory-mapping.js"],crmConstants.jsStaticPathForLyte)},beforeModel:function(e){this.transition.data.fromPage&&(this.fromPage=this.transition.data.fromPage,this.transition.data.fromLayout&&(this.fromLayout=this.transition.data.fromLayout))},model:function(e){var t=this.getQueryParams(),r={module:this.module};if("Leads"===this.module)return t.leadLayoutId?r.leadLayoutId=t.leadLayoutId:(r.action="showLayoutList",r.from="mlist"),t.accountLayoutId&&(r.accountLayoutId=t.accountLayoutId),t.contactLayoutId&&(r.contactLayoutId=t.contactLayoutId),t.potentialLayoutId&&(r.potentialLayoutId=t.potentialLayoutId),this.transition.data&&this.transition.data.from&&(r.from=this.transition.data.from),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CustomFieldMapping.do","GET",{params:r});if("Quotes"===this.module||"SalesOrders"===this.module){this.module;for(var i={apiVersion:"2.2",getFields:!0},a=Lyte.registeredMixins["crm-conversion-mapping"],s=null,o=[],n="SalesOrders"===this.module?["Sales_Orders","Invoices"]:["Quotes","Sales_Orders","Invoices"],l=n.length,c=0;c<l;c++)o.push(store.findAll("layout",{module:n[c]},!1,void 0,i));return Lyte.resolvePromises(o).then((function(e){if(s=3===e.length?{quotesRes:e[0],salesOrderRes:e[1],invoiceRes:e[2]}:{salesOrderRes:e[0],invoiceRes:e[1]},Crm.userDetails.isLineItemSubformMvmtDone){for(var r=[],i=e.length,o=2==i?[t.salesOrderLayoutId,t.invoiceLayoutId]:[t.quoteLayoutId,t.salesOrderLayoutId,t.invoiceLayoutId],c=2==i?t.salesOrderLayoutId:t.quoteLayoutId,d=2==i?"SalesOrders":"Quotes",u=2==i?["SalesOrders","Invoices"]:["Quotes","SalesOrders","Invoices"],m=0;m<i;m++){var p=o[m];if(!p)if(d===u[m])p=c||a.getStandartLayoutId(e[m]);else{var g=a.getMappedLayoutId(e[0],c,u[m]);p=g||a.getStandartLayoutId(e[m])}r.push(p)}var f=[];for(m=l-r.length;m<l;m++)f.push(store.findAll("layout",{module:n[m]},!1,void 0,{apiVersion:"2.2",applyLayoutId:!0,layout_id:r[m]}));return f.push(store.findAll("module")),Lyte.resolvePromises(f).then((function(e){var t=null,r=4===e.length;return t=r?{quotesRes:e[0],salesOrderRes:e[1],invoiceRes:e[2]}:{salesOrderRes:e[0],invoiceRes:e[1]},{layout:s,subform:t,moduleResponse:r?e[3]:e[2]}}))}return{layout:s}}),(function(e){e?renderingUtils.displayPermissionDenied():renderingUtils.showCustomAlert(I18n.getMsg("crm.internal.error.calsched"))}))}},afterModel:function(e){if(e&&"Leads"!==this.module){var t="Quotes"===this.module,r=e.layout.quotesRes?e.layout.quotesRes:null,i=e.layout.salesOrderRes,a=e.layout.invoiceRes,s=!!t&&r.length>1||i.length>1||a.length>1,o=[],n=[],l=[],c=this.getQueryParams(),d=c.quoteLayoutId,u=c.salesOrderLayoutId,m=c.invoiceLayoutId,p=t?d:u,g=t?r:i,f=!1;if(s){var h,y={},v={},_={};t?(v=this.getLayoutOptionData(r,d),o=this.getFieldsFromSection(v.sectionsDo,"Quotes"),m||u||(u=this.getMappedLayoutId(this.currentModel.layout.quotesRes,v.selected,"SalesOrders"),m=this.getMappedLayoutId(this.currentModel.layout.quotesRes,v.selected,"Invoices")),_=this.getLayoutOptionData(i,u)):(_=this.getLayoutOptionData(i,u),m||(m=this.getMappedLayoutId(this.currentModel.layout.salesOrderRes,_.selected,"Invoices"))),f=this.isNewLayoutMapping(p,t?r:i,t),n=this.getFieldsFromSection(_.sectionsDo,"SalesOrders",!1,void 0),h=this.getLayoutOptionData(a,m),l=this.getFieldsFromSection(h.sectionsDo,"Invoices",!1,void 0);var b=c.showLayout?c.showLayout:!p,w=this.removeParentLayoutsOtherOptions(t?v:_,p,b);y=t?{parentlayout:w,child1layout:_,child2layout:h}:{parentlayout:w,child2layout:h},e.layoutData=y}else t?(o=this.getFieldsFromSection(r[0].sections,"Quotes",!1,void 0),e.layoutData={parentlayout:r[0],child1layout:i[0],child2layout:a[0]}):e.layoutData={parentlayout:i[0],child2layout:a[0]},n=this.getFieldsFromSection(i[0].sections,"SalesOrders",!1,void 0),l=this.getFieldsFromSection(a[0].sections,"Invoices",!1,void 0);e.parentLayout=t?r:i;var C=s?t?v.selected:_.selected:t?r[0].id:i[0].id;if(Crm.userDetails.isLineItemSubformMvmtDone){var D=e.subform.quotesRes?e.subform.quotesRes[0]:null,L=e.subform.salesOrderRes[0],R=e.subform.invoiceRes[0],P=[],I=[];t&&(P=this.getFieldsForSubforms(D.sections,!0),I=this.getFieldsForSubforms(D.sections,!1));var S=this.getFieldsForSubforms(L.sections,!0),M=this.getFieldsForSubforms(R.sections,!0),k=this.getFieldsForSubforms(L.sections,!1),T=this.getFieldsForSubforms(R.sections,!1),E=[this.getSubformFieldMapping(P,S,M,t,"LineItem",C,f,g)[0]],A=this.getSubformFieldMapping(I,k,T,t,"Custom",C,f,g);E[0]&&A.length>0&&E.concat(A),e.subformMapping=E[0]&&A.length>0?E.concat(A):E[0]?E:A.length>0?A:null,e.quoteSubForm=I.length>0?P.concat(I):P,e.soSubForm=k.length>0?S.concat(k):S,e.invSubForm=M.length>0?T.concat(M):T,o=this.getSubFormAggregateFields(P,I,o),n=this.getSubFormAggregateFields(S,k,n),l=this.getSubFormAggregateFields(M,T,l)}e.isLineItemSubformMvmtDone=Crm.userDetails.isLineItemSubformMvmtDone,e.isPageLayoutNeeded=s,e.showLayout=b,e.moduledata=this.getAllModuleIdApiName(t),e.field_mapping=this.getMappedFields(t,o,n,l,f,g,C),e.isQuoteConversion=t,e.isNewLayoutMapping=f,e.moduleSingularLabel={Quotes:moduleRecordMapping.Quotes.singular_label,SalesOrder:moduleRecordMapping.SalesOrders.singular_label,Invoice:moduleRecordMapping.Invoices.singular_label},e.buttonDispProp=!f}},renderTemplate:function(e){return"Leads"===this.module?(0==e.indexOf("ALERT:::")&&CrmModule.notifyUser("alert",e.split("ALERT:::")[1],5e3),{outlet:"#customizationDiv",html:e}):e?{outlet:"#customizationDiv",component:"crm-inventory-conversion-mapping"}:void 0},afterRender:function(){var e=this.module;if("Leads"===e){var t=$("#Button1").closest("link-to");"layoutsList"!==this.fromPage&&"layout"!==this.fromPage||(t.attr("lt-prop-route","crm.settings.section.modules.module.layouts.index-layouts"),t.attr("lt-prop-dp",'["'+e+'"]'),this.fromLayout&&(t.attr("lt-prop-route","crm.settings.section.modules.module.layouts.view-layout"),t.attr("lt-prop-dp",'["'+e+'","'+this.fromLayout+'"]'))),this.transition.data&&this.transition.data.changeLayout&&enableSaveButton()}var r=moduleRecordMapping[e].plural_label;$("#customizationDiv").addClass("p30 pT20"),$("#layout_landing_left").show(),$(".moduleNameSection").show(),$("#mainMenuTabDiv").show(),$("#innerTabDiv").show();var i=$("#landingModuleLists").find("ul");i.find("li").removeClass("selected"),$("#layout_landing_right").find(".moduleLandingName").find("span").text(r),i.find("li[data-zcqa='MPL_layoutListPage_"+e+"']").addClass("selected");$("body").removeClass("builder_page_body"),CML.layoutLandingResize()},beforeExit:function(){this.fromPage=void 0,this.fromLayout=void 0,$(".seleDestory").is(":visible")&&"Leads"===this.module&&thirdPartyUtils.unbindSelect2(".seleDestory")}},{mixins:["crm-conversion-mapping"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.field-listing",{queryParams:["layoutId"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-field-list.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-field-list.css"],crmConstants.cssStaticPathForLyte);return e.concat(t)},beforeModel:function(){moduleRecordMapping[Lyte.Router.getRouteInstance().parent.getDynamicParam()].layouts=void 0,commonUtils.showHideLoadingDiv(!0)},model:function(e){var t=Lyte.Router.getRouteInstance().parent.getDynamicParam();return store.findAll("layout",{module:moduleRecordMapping[t].api_name},void 0,void 0,{moduleSet:!0}).then((function(r){if(e.queryParams.layoutId)for(var i=r.length,a=0;a<i;a++){var s=r[a];if(s.id===e.queryParams.layoutId)return{fields:{modFields:{fields:[],limitedFields:s.fields}},currentLayout:e.queryParams.layoutId,isSubformSection:!0,module:t,moduleLayout:r}}return{fields:{modFields:{fields:[],limitedFields:store.peekRecord("module",moduleRecordMapping[t].id).fields}},currentLayout:0,isSubformSection:!1,module:t,moduleLayout:r}}))},afterModel:function(e){e.fields.modFields.limitedFields=e.fields.modFields.limitedFields.slice(0);var t=e.fields.modFields.limitedFields;this.currentModel.NoRecordObj={modFields:!1},this.currentModel.scrollEvent=!0,this.setLayout(e.moduleLayout);var r=0,i={};this.setFields(e.module,t,!1,"modFields",this.currentModel),this.currentModel.isSubformAvailable=!1;var a=this;if(e.fields.modFields.limitedFields.forEach((function(e){"subform"===e.data_type&&(a.currentModel.isSubformAvailable=!0,a.currentModel.fields["subform"+r]={display_label:e.display_label},a.currentModel.NoRecordObj["subform"+r]=!1,i["subform"+r]=store.findAll("layout",{module:e.subform.module},!1,void 0,{moduleSet:!0}).then((function(t){for(var r=[],i=e.layouts.length,a=t.length,s=0;s<a;s++){for(var o=0;o<i;o++){var n=!1;if(t[s].name===e.layouts[o].name){n=!0;break}}n||(store.unloadRecord("layout",t[s].id),s--,a--)}return e.layouts.forEach((function(e){var i=t.filter((function(t){return t.name===e.name}))[0];i&&(i.parent_layout={id:e.id,status:e.status},i.created_time=e.created_time,e.child_layouts||(e.child_layouts=[]),e.child_layouts.push(i.id),r.push(i))})),t=r})),r+=1)})),Object.keys(i).length>0)return Lyte.resolvePromises(i).then((function(t){for(var r in t){var i=store.peekRecord("module",t[r][0].module.id),s=i.fields?i.fields:[];a.currentModel.fields[r].fields=[],a.currentModel.fields[r].limitedFields=s.slice(0),a.setFields(e.module,a.currentModel.fields[r].limitedFields,!0,r,a.currentModel),0===a.currentModel.fields[r].limitedFields.length&&delete a.currentModel.fields[r]}}));commonUtils.showHideLoadingDiv(!0)},renderTemplate:function(){return this.currentModel.id="getFields",{outlet:"#customizationDiv",component:"crm-field-list"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1),$L("crm-field-list")[0].component.hideSubform(),this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.customize.fields"),Crm.partnerName]))},actions:{onError:function(){Lyte.Router.getRouteInstance().transition.preservePopup=!0,renderingUtils.displayPermissionDenied(),Lyte.Router.transitionTo("crm.settings.section.modules.index-modules").preservePopup=!0}},setFields:function(e,t,r,i,a){var s,o,n=this,l=[0,9,14],c=[50,51,99],d=["SE_STATUS","FULLNAME","ISCTICALL","ISCALLBILLABLE","SALUTATION","TAGMODULEREFID"],u=t.length,m={110:I18n.getMsg("Multi Line (Small)"),3:I18n.getMsg("Multi Line (Large)"),21:I18n.getMsg("crm.field.label.url"),24:I18n.getMsg("crm.nsocial.int.date"),25:I18n.getMsg("crm.field.label.email"),30:I18n.getMsg("crm.field.label.date.time"),33:I18n.getMsg("crm.field.label.phone"),34:I18n.getMsg("crm.field.label.percentage"),35:I18n.getMsg("Fax"),36:I18n.getMsg("crm.label.currency"),38:I18n.getMsg("crm.field.label.decimal"),100:I18n.getMsg("Multiselect"),111:I18n.getMsg("AutoNumber"),143:I18n.getMsg("Currency(Round Off)"),144:I18n.getMsg("Currency(Round Down)"),145:I18n.getMsg("Currency(Roundz Up)"),52:I18n.getMsg("crm.field.label.long.integer"),555:I18n.getMsg("crm.label.widgets.fileupload"),221:I18n.getMsg("UserLookup")};"Tasks"!==e&&"Calls"!==e||d.push("CALLSTATUS"),"Events"===e&&Array.prototype.push.apply(d,["CHECKINCREATEDTIME","CHECKINOWNERID","CHECKINCOMMENT","CHECKINSTREET","CHECKINCITY","CHECKINSTATE","CHECKINCOUNTRY","CHECKINLATITUDE","CHECKINLONGITUDE","CHECKINZIPCODE","CHECKINADDRESS","CHECKINSTATUS"]),"Leads"!==e&&"Deals"!==e&&"Contacts"!==e||Array.prototype.push.apply(d,["ADID","ADCLICKDATE","GCLID","AD","GAD_COST_PER_CONVERSION","CLICKTYPE","KEYWORD","ADCAMPAIGNNAME","GAD_COST_PER_CLICK","ADGROUPID","SEARCHPARTNERNETWORK","GAD_OFFLINE_STATUS","SEARCHWORD","GADCONFIGID","ADGROUPNAME","GAD_OFFLINE_FAILURE_REASON","GAD_OFFLINE_PUSHDATE","ADNETWORK","ZCAMPAIGNID","DEVICETYPE","KEYWORDID","GCUST_ID"]),"Leads"!==e&&"Contacts"!==e||d.push("CAMPAIGNID");for(var p=0;p<u;p++){o=t[p].data_type,s=t[p].ui_type,t[p].DataType=o,1===s||37===s||11===s||22===s||27===s||127===s||62===s||20===s||207===s||208===s||123===s?t[p].DataType=I18n.getMsg("crm.field.label.single.line"):2===s||26===s||39===s||98===s||210===s?t[p].DataType=I18n.getMsg("crm.field.label.pick.list"):32===s||40===s?t[p].DataType=I18n.getMsg("Number"):300===s||301===s?t[p].DataType=I18n.getMsg("Boolean"):333===s||786===s||14===s||200===s?t[p].DataType=I18n.getMsg("DateTime"):4===s||5===s||6===s||7===s||8===s||9===s||10===s||12===s||13===s||15===s||16===s||55===s||133===s||46===s?t[p].DataType=I18n.getMsg("crm.field.label.lookup"):116===s||117===s?t[p].DataType=I18n.getMsg("crm.field.label.formula"):444===s||445===s?t[p].DataType=I18n.getMsg("Multiselectlookup"):66===s?t[p].DataType=t[p].field_label:m[s]&&(t[p].DataType=m[s]);var g=[],f=t[p].layouts?t[p].layouts.length:0,h=[],y=[];if(0!==f){t[p].sortedLayouts=[];for(var v=0;v<f;v++)if(-5!==t[p].layouts[v].status){if(!t[p].layouts[v].created_time){y.push(t[p].layouts[v]);continue}h.push(t[p].layouts[v])}h.sort((function(e,t){return new Date(e.created_time)-new Date(t.created_time)})),y&&(t[p].sortedLayouts=y.concat(h));for(var _=t[p].sortedLayouts.length,b=0;b<_;b++)if(r&&t[p].sortedLayouts[b].parent_layout&&g.push(t[p].sortedLayouts[b]),t[p].sortedLayouts[b].id===this.currentModel.currentLayout&&!r){y=t[p].sortedLayouts[b];t[p].sortedLayouts.splice(b,1),t[p].sortedLayouts.unshift(y);break}if(r&&0===n.currentModel.currentLayout)t[p].sortedLayouts=g;else if(r&&0!==n.currentModel.currentLayout){t[p].sortedLayouts=g;var w=t[p].sortedLayouts.length,C=!1;for(v=0;v<w;v++)if(t[p].sortedLayouts[v].parent_layout.id===n.currentModel.currentLayout){y=t[p].sortedLayouts[v];t[p].sortedLayouts.splice(v,1),t[p].sortedLayouts.unshift(y),C=!0;break}if(!C){t.splice(p,1),p-=1,u-=1;continue}}}else t[p].sortedLayouts=[];if(t[p]&&!t[p].subform&&"modFields"===i){if(0!==n.currentModel.currentLayout&&n.currentModel.isSubformSection)if("subform"===(t[p].module?t[p].module[0].generated_type:"")||t[p].subform_api){t.splice(p,1),p-=1,u-=1;continue}if(-1!==l.indexOf(t[p].show_type)||!1===t[p].visible||2===t[p].category||-1!==d.indexOf(t[p].column_name)||0===t[p].sortedLayouts.length||-1!==c.indexOf(t[p].ui_type)||1===t[p].layouts.length&&-5===t[p].layouts[0].status){a.fields[i].limitedFields.splice(p,1),p--,u--;continue}}else if(r&&!t[p].custom_field&&"modFields"!==i&&!t[p].view_type.view&&t[p].view_type.edit&&t[p].view_type.create||0===t[p].sortedLayouts.length){a.fields[i].limitedFields.splice(p,1),p--,u--;continue}}var D="field_label";return t.sort((function(e,t){var r=e[D].toUpperCase(),i=t[D].toUpperCase();return r<i?-1:r>i?1:0})),t},setLayout:function(e){var t=e.length,r=[],i={name:I18n.getMsg("crm.label.all.layouts"),id:"0",zcqa:"MPL_layout_AllLayouts"};this.currentModel.layoutsCount=t+1;for(var a=0;a<t;a++)if(e[a].zcqa="MPL_layout_"+e[a].name,-1!==e[a].status&&-5!==e[a].status){if(!e[a].created_time){var s=e[a];continue}r.push(e[a])}r=r.sort((function(e,t){return new Date(e.created_time)-new Date(t.created_time)}));s&&r.unshift(s),this.currentModel.modalLayout=r.slice(0),r.unshift(i),this.currentModel.layouts=r}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.field-permissions",{queryParams:["profileId"],model:function(e){var t=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),r=this.getQueryParams().profileId?this.getQueryParams().profileId:void 0;e={module:t,innerTab:"fields",isFieldPermission:!0};null!=r&&(e.profileId=r);var i={params:e};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/EntityFieldCustomize.do","GET",i)},afterModel:function(e,t){var r=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam();e[r].module=r,CrmPageLayout.module=r,Handlebars.registerPartial("layoutDetailsForField",Handlebars.templates.layoutDetailsForField)},renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:Handlebars.templates.fieldsList(e[Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()])}},afterRender:function(e,t){var r=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam();e[r].isFieldPermNeeded?(CMB.enableCRMToolTip("FieldPermission"),CrmPageLayout.bottomBtn()):(e[r].isFieldListing=!0,$("#fieldListing").addClass("active")),CrmPageLayout.layout_jsonarrayObj=e[r].layout_jsonarrayObj,$(".newSelect select").select2(),this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.customize.fields"),Crm.partnerName]))},actions:{willTransition:function(e){var t=this.parent.getDynamicParam();if(commonUtils.unloadModuleRecords(t),store.unloadAll("layout"),Events.isLinksModified){var r=e.pause(),i="stayonPageConfirmBox",a=$("#"+i),s=$("#profileDetails").find('option[selected="selected"]').val();freezeBackground(),mailsetCenter(i),a.find(".leavePage").off("click").click((function(){a.hide(),r.resume(),removeFreezeLayer(),Events.isLinksModified=!1})),a.find(".stayPage").off("click").click((function(){a.hide(),$("#profileDetails").find("option[value="+s+"]").prop("selected",!0).siblings().removeAttr("selected"),thirdPartyUtils.bindSelect2("#profileDetails"),e.abort(),removeFreezeLayer()})),a.focus()}else{t=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam();this.unloadProperty("field",store.peekRecord("module",moduleRecordMapping[t].id).fields),this.unloadProperty("layout",store.peekRecord("module",moduleRecordMapping[t].id).layouts),store.peekRecord("module",moduleRecordMapping[t].id).fields=void 0}}}},{mixins:["crm-module-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.field-privacy",{queryParams:["layoutId"],model:function(e){var t=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),r=-1;this.getQueryParams().layoutId&&(r=this.getQueryParams().layoutId);var i={params:{module:t,innerTab:"fields",isPrivateFieldListing:!0,layoutId:r}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/EntityFieldCustomize.do","GET",i)},afterModel:function(e,t){var r=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam();e.ERROR?this.replaceWith("crm.settings.section.modules.module.field-listing",r):(e[r].module=r,CrmPageLayout.module=r,delete CML.integrationSerivceVsFields,Handlebars.registerPartial("layoutDetailsForField",Handlebars.templates.layoutDetailsForField))},renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:Handlebars.templates.fieldsList(e[Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()])}},afterRender:function(e,t){var r=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),i=$("#markPrivateFieldsBtn");e[r].fieldsInfo[0].fields.length>0?(i.html(I18n.getMsg("crm.mb.field.private.edit")),i.attr("onclick",'javascript:CML.showPrivateFields("'+r+'");Crm.trackSpotLightAction("Personal Fields - Edit Personal Fields Click",{"Module":"'+r+'"})')):(i.html(I18n.getMsg("crm.mb.field.private.set")),i.attr("onclick",'javascript:CML.showPrivateFields("'+r+'");Crm.trackSpotLightAction("Personal Fields - Mark Personal Fields Click",{"Module":"'+r+'"})')),$("#privateFields").addClass("active"),CrmPageLayout.layout_jsonarrayObj=e[r].layout_jsonarrayObj,$(".newSelect select").select2()},beforeExit:function(){delete CML.integrationSerivceVsFields}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.jobsheet-layouts",{model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","GET",{params:{action:"showLayoutList",module:"JobSheets",innerTab:"jobSheetLayouts"}})},renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.layouts"),Crm.partnerName]))}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.layout-rules",{redirect:function(){"crm.settings.section.modules.module.layout-rules"===this.transition.target&&this.replaceWith("crm.settings.section.modules.module.layout-rules.index-layout-rules",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam())},afterRender:function(){},actions:{willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||!ZohoHCAsap.UnInstall||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall())}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.layouts",{redirect:function(){"crm.settings.section.modules.module.layouts"===this.transition.target&&this.replaceWith("crm.settings.section.modules.module.layouts.index-layouts",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam())},beforeModel:function(){},actions:{willTransition:function(){var e=this.parent.getDynamicParam();this.unloadProperty("field",store.peekRecord("module",moduleRecordMapping[e].id).fields),this.unloadProperty("layout",store.peekRecord("module",moduleRecordMapping[e].id).layouts),store.peekRecord("module",moduleRecordMapping[e].id).fields=void 0,Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||!ZohoHCAsap.UnInstall||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall())}}},{mixins:["crm-module-mixin"]}),Lyte.Router.registerRoute("crm.settings.section.modules.module.links-and-buttons",{redirect:function(){void 0!==Crm.refWidAssocComp&&Crm.refWidAssocComp.custom_button&&(Crm.refWidAssocComp.custom_button=!1,Lyte.Router.getRouteInstance().routeName.includes("wizard")||Utils.windowLocationReload(!0)),"crm.settings.section.modules.module.links-and-buttons"===this.transition.target&&this.replaceWith("crm.settings.section.modules.module.links-and-buttons.index-links-and-buttons",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam())},beforeExit:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess()}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.map-dependency",{beforeModel:function(e){this.transition.data.fromPage&&(this.fromPage=this.transition.data.fromPage,this.transition.data.fromLayout&&(this.fromLayout=this.transition.data.fromLayout))},redirect:function(){"crm.settings.section.modules.module.map-dependency"===this.transition.target&&this.replaceWith("crm.settings.section.modules.module.map-dependency.index-map-dependency",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam())},beforeExit:function(){this.fromPage=void 0,this.fromLayout=void 0}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.preferences-module",{queryParams:["openPopUp"],getResources:function(){var e=networkUtils.returnDependencyFiles(["selling-preferences.js","crm-createrecord-mixin.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["selling-preferences.css"],crmConstants.cssStaticPathForLyte);return(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_services.js"]))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")]))).concat(networkUtils.returnDependencyFiles(["zohocrm_workflow.js"]))).concat(t)},model:function(){var e=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),t=this.getQueryParams();if(e&&("Services"===e&&CSU.isJobSheetSupported||"Appointments"===e)){var r="Appointments"===e?{include:"deal_record_configuration"}:{};return store.findAll("servapp_preferences",r,!1,!0,{module:e,reloadAll:!0}).then((function(r){if(r&&r.length){var i=objectUtils.cloneObject(r[0]);if(i.params={},i.params.module=e,"Services"===e)i.params.component="crm-service-preference";else if(i.params.component="crm-appointment-preference",i.params.openPopUp=t.openPopUp,!i.services)return store.findAll("servapp_preferences",{},!1,!0,{module:"Services",reloadAll:!0}).then((function(e){if(e&&e.length)return i.services=objectUtils.cloneObject(e[0].services),i}));return i}}),(function(e){var t=JSON.parse(e.response);"NO_PERMISSION"!==t.code&&"INVALID_MODULE"!==t.code||renderingUtils.displayPermissionDenied()}))}},renderTemplate:function(e){var t=e&&e.params&&e.params.component?e.params.component:"";return""!=t&&("Appointments"===e.params.module&&(e.appointments=CrmPageLayout.configureAppointments(e.appointments)),e.disableButton=!0),{outlet:"#customizationDiv",component:t}},afterRender:function(e){if(this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.module.info"),Crm.partnerName])),e&&e.params&&e.params.module)if("Services"===e.params.module)$('[lt-prop-name="job_sheet_enabled"][lt-prop-value='+e.services.job_sheet_enabled+"]").attr("lt-prop-checked",!0);else if(e.params.openPopUp&&"create_deal"===e.appointments.when_appointment_completed){$L("crm-appointment-preference").e[0].component.initialize()}},beforeExit:function(){wfNew.resetWFObjs()},actions:{willTransition:function(e){if(this.currentModel&&this.currentModel.params&&this.currentModel.params.module&&("Appointments"===this.currentModel.params.module||"Services"===this.currentModel.params.module)){var t=$L("#saveButton")[0].ltProp("disabled");if(void 0!==t&&!1===t){var r=e.pause(),i="stayonPageConfirmBox",a=$("#"+i);freezeBackground(),mailsetCenter(i),a.find(".leavePage").off("click").click((function(){a.hide(),r.resume(),removeFreezeLayer()})),a.find(".stayPage").off("click").click((function(){a.hide(),e.abort(),removeFreezeLayer()})),a.focus()}}}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.summary-module",{model:function(e){var t={params:{action:"showModuleInfo",module:Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),innerTab:"moduleInfo"}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CrmCustomization.do","GET",t)},renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.module.info"),Crm.partnerName]))}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.validation-rules",{queryParams:["layoutId"],redirect:function(){if("crm.settings.section.modules.module.validation-rules"===this.transition.target){var e=this.transition.data;this.replaceWith({route:"crm.settings.section.modules.module.validation-rules.index-validation-rules",dynamicParams:[Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()],queryParams:this.transition.info.queryParams}).data=e}},beforeModel:function(){},model:function(){var e={};e.module=moduleRecordMapping[this.parent.getDynamicParam()].api_name;var t=this.getQueryParams().layoutId,r=this.parent.getDynamicParam();return"Calls"===r&&!isNewCallView||"Users"===r||"Visits"===r||"linking"===moduleRecordMapping[r].generated_type||crmTab.isZBCustomModule(r)?(this.replaceWith("crm.settings.section.modules.module",this.parent.getDynamicParam()),null):void 0===CVRCust.fieldObj||!t&&!CVRCust.masterLayoutId||"crm.settings.section.modules.module.validation-rules.view-validation-rule"===this.transition.target||t&&!CVRCust.masterLayoutId?("crm.settings.section.modules.module.validation-rules.view-validation-rule"!==this.transition.target&&void 0!==CVRCust.fieldObj||(e.getFieldObj=!0),t&&(e.layout_id=t),networkUtils.lyteInitiateRequest("/crm/v2.1/settings/validation_rules/actions/rule_dependencyData","GET",{params:e}).then((function(e){return e}),(function(e){if(!e||!e.responseJSON||"Invalid Layout Id"!=e.responseJSON.message)return e;e.responseText=I18n.getMsg("crm.error.invalid.layoutid"),renderingUtils.showCustomAlert(e.responseText,void 0,!0,(function(){crmHistory.backOneLevel()})),Lyte.Router.getRouteInstance().transition.abort()}))):null},afterModel:function(e){e&&(CVRCust.validationRuleId=void 0,CVRCust.associated_function=void 0,CVRCust.validation_type="criteria",CVRCust.storeRuleDependencyData(e.validation_rules.details))},afterRender:function(){$("#mainMenuTabDiv").show(),$("body").removeClass("builder_page_body"),$("#layout_landing_right").perfectScrollbar("destroy"),$("#customizationDiv").addClass("helpOverflowHide")},actions:{onError:function(e,t,r){var i="noRolesForHome"!==e.responseText?e.responseText:'<div class="f21"><span id="warningMsg">'+I18n.getMsg("crm.no.roles.for.homepage1")+'</span> <span class="crm-font-regular" id="delItemName"></span><br><span id="showWarning2" class="f13"><b>'+I18n.getMsg("crm.label.note2")+' </b><span id="noteMsg">'+I18n.getMsg("crm.no.roles.for.homepage2")+"</span></span></div>";return renderingUtils.showCustomAlert(i,void 0,!0,(function(){crmHistory.backOneLevel()})),!1},willTransition:function(e){var t=e.target;(this.parent.getDynamicParam()!=e.info.dynamicParams[0]||null!=t&&"crm.settings.section.modules.module.validation-rules.index-validation-rules"!=t&&"crm.settings.section.modules.module.validation-rules.view-validation-rule"!=t&&"crm.settings.section.modules.module.validation-rules"!=t)&&CVRCust.init(),Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||!ZohoHCAsap.UnInstall||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall()),$("#customizationDiv").removeClass("helpOverflowHide"),$("#validationRuleCustDiv").hide(),$("#moduleCustomizationDiv").show(),Search.isVRCriteria&&(Search.isVRCriteria=!1)}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.layout-rules.index-layout-rules",{model:function(e){var t={params:{action:"showFormRulesList",module:Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),innerTab:"formRules"}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/FormRule.do","GET",t)},renderTemplate:function(e,t){return validationUtils.isJson(e)?{outlet:"#customizationDiv",html:Handlebars.templates.formRuleListView(e)}:{outlet:"#customizeModuleDiv",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.layout.rule.plural"),Crm.partnerName])),CFRCust.storeDataForListView(e),CFRCust.enableOrDisableCreateButton($("#formRulesListDIV").find("[class^=layoutId]"),Object.keys(CFRCust.layoutIdvsNameObj).length),this.transition.data.fieldName&&this.transition.data.layoutId&&CFRCust.showCreatePopup(this.transition.data.fieldName,this.transition.data.layoutId),$("#conditionalFieldContainer").empty().hide(),Crm.trackSpotLightAction("Layout Rule - Page Visited",{Module:Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()}),$L("#layout_landing_right").removeScroll(),$("#customizationDiv").addClass("helpOverflowHide")},actions:{willTransition:function(){$("#customizationDiv").removeClass("helpOverflowHide")}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.layout-rules.view-layout-rule",{queryParams:["layoutId"],model:function(e){if(this.transition.lrdata)return this.transition.lrdata;var t={params:{action:"editFormRule",module:Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),innerTab:"formRules",operation:"edit",layoutId:this.getQueryParams().layoutId,formRuleId:this.getDynamicParam()}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/FormRule.do","GET",t)},renderTemplate:function(e,t){if(!validationUtils.isJson(e))return{outlet:"#customizeModuleDiv",html:e};CFRCust.showFormRule(e,"edit")},actions:{willTransition:function(e){e.target.indexOf("crm.settings.section.modules.module.layouts.layout-rules")<0&&($("#moduleCustomizationDiv").show(),$("#conditionalFieldContainer").hide())}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.layouts.clone-layout",{requestMerge:!0,model:function(e){var t=Lyte.Router.getRouteInstance().parent.parent.getDynamicParam(),r=this.getDynamicParam();if(1==this.requestMerge){var i={params:{action:"showModuleBuilder",module:t,innerTab:"layouts",layoutId:r,operation:"edit",layoutOperation:"clone"}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",i)}return i={params:{action:"cloneNewLayout",module:t,innerTab:"layouts",actionType:"createLayout",layoutId:r}},networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","GET",i)},afterModel:function(e){if(validationUtils.isJson(e))"Layout_Unavailable"==e.status&&this.replaceWith("crm.settings.section.modules.module.layouts",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam());else if(null!=e)if(1!=this.requestMerge)this.transition.cachedResponse=e;else{var t=screen.width+"X"+screen.height;if(commonUtils.showHideLoadingDiv(!0),CML.builderOperation="edit",CrmModule.toggleBusy("primaryBtnLayer",!1),$("#innerTabDiv").hide(),0===e.indexOf("ALERT:::"))(r=e.split("ALERT:::")).length>2?CML.showModuleDeleteErrorWithTip(r[1],r[2]):CrmModule.notifyUser("alert",r[1],5e3),CrmModule.toggleBusy("primaryBtnLayer",!0),CML.isSuccess=!1;else if(0===e.indexOf("ERROR:::")){var r=e.split("ERROR:::");CrmModule.notifyUser("alert",r[1]),CrmModule.toggleBusy("primaryBtnLayer",!0),CML.isSuccess=!1}else if(0===e.indexOf("COUNTEXCEED:::")){r=e.split("COUNTEXCEED:::");CrmModule.notifyUser("alert",r[1],5e3),CrmModule.toggleBusy("primaryBtnLayer",!0),CML.isSuccess=!1}else null!=e&&(Crm.trackSpotLightAction("Layout Page - Users Resolution",{Resolution:t,BrowserVersion:$L.userAgent.browser+"-"+$L.userAgent.detailedVersion[1]}),this.transition.cachedResponse=e,$("#fieldSettingsDiv").html(e),$("#moduleCustomizationDiv").removeClass("createModule"),$(".newVersMsg").hide())}},getResources:function(){if(1==this.requestMerge){var e=[];"undefined"==typeof CML&&(e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_mbuilder.js"])));var t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ModuleBuilder")]);return e=e.concat(t)}},renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:e}},afterRender:function(){var e=$("#customizationDiv");if($("#customActionDiv").hide(),e.show(),0!=e.find("#List_Layouts").length?($("#mainMenuTabDiv").show(),e.addClass("p30 pT20"),$("#layout_landing_left").show(),$("#moduleCustomizationDiv").removeClass("notNewSetupView"),$(".moduleNameSection").show()):($("#innerTabDiv").hide(),$("#moduleCustomizationDiv").addClass("notNewSetupView"),$("body").addClass("builder_page_body"),$L("#layout_landing_right").removeClass("pL20"),$L("#manageUserDiv").hide(),$("#mainMenuTabDiv").hide(),$("#customizationDiv").removeClass("p30 pT20"),$("#layout_landing_left").hide(),$(".moduleNameSection").hide()),1==this.requestMerge){var t=$("#layoutTabId").val(),r=this.getDynamicParam(),i=this.getQueryParams().showspmapping,a={params:{action:"getNewFieldButtonDetails",operation:"edit",tabId:t}};networkUtils.setCsrfParam(a),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",a).then((function(e){CML.designNewFieldsAndButtons(e,"edit")}));var s={params:{action:"getExistedSectionAndFieldDetails",operation:"edit",tabId:t,layoutId:r,layoutOperation:"clone"}};networkUtils.setCsrfParam(s),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",s).then((function(e){CML.designExistingSectionAndFields(e,"edit",t,r,void 0,void 0),$("#permissionComponentPopup").length>0&&(CML.isFPAccess=!0),"true"==i&&$("#stageProbMapping").click()}))}},actions:{willTransition:function(e){var t=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam();if(Events.isPageLayoutModified){var r=e.pause(),i="stayonPageConfirmBox",a=$("#"+i);freezeBackground(),mailsetCenter(i),a.find(".leavePage").off("click").click((function(){$("#stayonPageConfirmBox").hide(),r.resume(),removeFreezeLayer(),Events.isPageLayoutModified=!1,"JobSheets"===t&&Lyte.Router.transitionTo("crm.settings.section.modules.module.jobsheet-layouts","Services")})),a.find(".stayPage").off("click").click((function(){$("#stayonPageConfirmBox").hide(),e.abort(),removeFreezeLayer()})),a.focus()}else"JobSheets"===t&&Lyte.Router.transitionTo("crm.settings.section.modules.module.jobsheet-layouts","Services")}},beforeExit:function(){$L("body").removeClass("builder_page_body")}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.layouts.index-layouts",{getResources:function(){var e=[],t=networkUtils.returnDependencyFiles(["crm-image-upload.js","crm-image-mixin.js","crm-image-preview.js","crm-image-upload-create.js","lyte-scrollTo.js","exif-plugin.js","lyte-cropper.js","lyte-colorbox.js"],crmConstants.jsStaticPathForLyte),r=[];return Crm.userDetails.RTL_ENABLED&&(r=networkUtils.returnDependencyFiles(["crm-image-upload-rtl.css","crm-image-upload-ziaError.css"],crmConstants.cssStaticPathForLyte)),r=r.concat(networkUtils.returnDependencyFiles(["crm-image-upload.css","crm-image-preview.css","crm-image-upload-create.css"],crmConstants.cssStaticPathForLyte)),e=(e=e.concat(t.concat(r))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("imageupload")]))},model:function(e){var t={params:{action:"showLayoutList",module:Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),innerTab:"layouts"}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","GET",t)},renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.layouts"),Crm.partnerName]))},actions:{willTransition:function(){$("body").removeClass("helpOverflowHide")}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.layouts.view-layout",{queryParams:["showspmapping"],cmlInitiate:!1,requestMerge:!0,getResources:function(){var e=[],t=networkUtils.returnDependencyFiles(["crm-image-upload.js","crm-image-mixin.js","crm-image-preview.js","crm-image-upload-create.js","lyte-scrollTo.js","exif-plugin.js","lyte-cropper.js","lyte-colorbox.js","crm-event-picklist.js","lyte-colorpicker.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ModuleBuilder")]);t=t.concat(r);var i=[];return Crm.userDetails.RTL_ENABLED&&(i=networkUtils.returnDependencyFiles(["crm-image-upload-rtl.css","crm-image-upload-ziaError.css"],crmConstants.cssStaticPathForLyte)),i=i.concat(networkUtils.returnDependencyFiles(["crm-image-preview.css","crm-image-upload.css","crm-image-upload-create.css","crm-picklist-colorpicker.css"],crmConstants.cssStaticPathForLyte)),"Appointments"===this.parent.parent.getDynamicParam()?t=(t=(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["multilookup-list.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["zohocrm_services.js"]))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")]))).concat(networkUtils.returnDependencyFiles(["crm-list-view-crux.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["multilookup-list.css"],crmConstants.cssStaticPathForLyte)):"Services"==this.parent.parent.getDynamicParam()&&(t=(t=t.concat(networkUtils.returnDependencyFiles(["zohocrm_services.js"]))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")]))),e=(e=(e=e.concat(t.concat(i))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("sharingrules")]))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("imageupload")])),1==this.requestMerge&&"undefined"==typeof CML&&(this.cmlInitiate=!0,e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_mbuilder.js"]))),e},beforeModel:function(){Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||initAsap("View Layouts")},model:function(e){if(this.transition.cachedResponse)return this.transition.cachedResponse;if(this.transition.data.dummyTransition)return null;var t,r=this.parent.parent.getDynamicParam(),i=this.getDynamicParam(),a=this.getQueryParams().showspmapping;return t=1==this.requestMerge?{params:{action:"showModuleBuilder",module:r,innerTab:"layouts",layoutId:i,showspmapping:a,operation:"edit",layoutOperation:"edit"}}:{params:{action:"editLayout",module:r,innerTab:"layouts",layoutId:i,showspmapping:a}},networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",t)},afterModel:function(e){if(1==this.requestMerge){commonUtils.showHideLoadingDiv(!0),CML.builderOperation="edit",CrmModule.toggleBusy("primaryBtnLayer",!1);var t=screen.width+"X"+screen.height;if($("#innerTabDiv").hide(),null!=e)if(validationUtils.isJson(e))"Layout_Unavailable"==e.status&&this.replaceWith("crm.settings.section.modules.module.layouts",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam());else if(0===e.indexOf("ALERT:::")){(r=e.split("ALERT:::")).length>2?CML.showModuleDeleteErrorWithTip(r[1],r[2]):CrmModule.notifyUser("alert",r[1],5e3),CrmModule.toggleBusy("primaryBtnLayer",!0),CML.isSuccess=!1}else if(0===e.indexOf("ERROR:::")){var r=e.split("ERROR:::");CrmModule.notifyUser("alert",r[1]),CrmModule.toggleBusy("primaryBtnLayer",!0),CML.isSuccess=!1}else if(0===e.indexOf("COUNTEXCEED:::")){r=e.split("COUNTEXCEED:::");CrmModule.notifyUser("alert",r[1],5e3),CrmModule.toggleBusy("primaryBtnLayer",!0),CML.isSuccess=!1}else Crm.trackSpotLightAction("Layout Page - Users Resolution",{Resolution:t,BrowserVersion:$L.userAgent.browser+"-"+$L.userAgent.detailedVersion[1]}),this.transition.cachedResponse=e,$("#fieldSettingsDiv").html(e),$("#moduleCustomizationDiv").removeClass("createModule"),$(".newVersMsg").hide()}else{if(null!=e&&validationUtils.isJson(e))"Layout_Unavailable"==e.status&&this.replaceWith("crm.settings.section.modules.module.layouts",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam());else null!=e&&(this.transition.cachedResponse=e)}},renderTemplate:function(e,t){if(null!=e)return 1==this.requestMerge&&1==this.cmlInitiate&&(CrmModule.init(),CML.init(),CrmPageLayout.scrollPos()),{outlet:"#customizationDiv",html:e}},afterRender:function(){var e=$("#customizationDiv");if($("#customActionDiv").hide(),e.show(),0!=e.find("#List_Layouts").length?($("#mainMenuTabDiv").show(),e.addClass("p30 pT20"),$("#layout_landing_left").show(),$("#moduleCustomizationDiv").removeClass("notNewSetupView"),$(".moduleNameSection").show()):($("#innerTabDiv").hide(),$("#moduleCustomizationDiv").addClass("notNewSetupView"),$("body").addClass("builder_page_body"),$L("#layout_landing_right").removeClass("pL20"),$L("#manageUserDiv").hide(),$("#mainMenuTabDiv").hide(),$("#customizationDiv").removeClass("p30 pT20"),$("#layout_landing_left").hide(),$(".moduleNameSection").hide()),!(1!=this.requestMerge||this.transition.data&&this.transition.data.dummyTransition)){var t=$("#layoutTabId").val(),r=this.getDynamicParam(),i=this.getQueryParams().showspmapping,a={params:{action:"getNewFieldButtonDetails",operation:"edit",tabId:t}};networkUtils.setCsrfParam(a),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",a).then((function(e){CML.designNewFieldsAndButtons(e,"edit")}));var s={params:{action:"getExistedSectionAndFieldDetails",operation:"edit",tabId:t,layoutId:r,layoutOperation:"edit"}};networkUtils.setCsrfParam(s),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/PageLayout.do","POST",s).then((function(e){CML.designExistingSectionAndFields(e,"edit",t,r,void 0,void 0),$("#permissionComponentPopup").length>0&&(CML.isFPAccess=!0),"true"==i&&$("#stageProbMapping").click()}))}},beforeExit:function(){delete CML.integrationSerivceVsFields,$L("body").removeClass("builder_page_body")},actions:{willTransition:function(e){var t=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam();if(Events.isPageLayoutModified){var r=e.pause(),i="stayonPageConfirmBox",a=$("#"+i);freezeBackground(),mailsetCenter(i),a.find(".leavePage").off("click").click((function(){a.hide(),r.resume(),removeFreezeLayer(),Events.isPageLayoutModified=!1,"JobSheets"===t&&Lyte.Router.transitionTo("crm.settings.section.modules.module.jobsheet-layouts","Services")})),a.find(".stayPage").off("click").click((function(){a.hide(),e.abort(),removeFreezeLayer()})),a.focus()}else"JobSheets"===t&&"crm.settings.section.modules.module.jobsheet-layouts"!=e.target&&Lyte.Router.transitionTo("crm.settings.section.modules.module.jobsheet-layouts","Services");CustomRelatedListObj.fromModuleBuilder=!1,Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||!ZohoHCAsap||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall())}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.links-and-buttons.create-links-and-buttons",{queryParams:["component"],getResources:function(){if("undefined"==typeof CustomButtonJSObject)return networkUtils.returnDependencyFiles(["zohocrm_custombuttonsetup.js"])},model:function(e){var t={params:{innerTab:"cusLink",module:Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),step:"createCustomButton",action:"createNewLink",component:this.getQueryParams().component}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CustomButton.do","POST",t)},renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:e}},actions:{willTransition:function(e){if(Events.isLinksModified){var t=e.pause(),r="stayonPageConfirmBox",i=$("#"+r);freezeBackground(),mailsetCenter(r),i.find(".leavePage").off("click").click((function(){i.hide(),t.resume(),removeFreezeLayer(),Events.isLinksModified=!1})),i.find(".stayPage").off("click").click((function(){i.hide(),e.abort(),removeFreezeLayer()})),i.focus()}}},beforeExit:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess(),crmui.hidePopup("newRelatedListPopUpDiv")}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.links-and-buttons.edit-links-and-buttons",{queryParams:["component"],getResources:function(){if("undefined"==typeof CustomButtonJSObject)return networkUtils.returnDependencyFiles(["zohocrm_custombuttonsetup.js"])},model:function(e){var t={params:{innerTab:"cusLink",module:Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),step:"editCustomButton",action:"editLink",component:this.getQueryParams().component,buttonId:this.getDynamicParam()}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CustomButton.do","POST",t)},renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:e}},actions:{willTransition:function(e){if(Events.isLinksModified){var t=e.pause(),r="stayonPageConfirmBox",i=$("#"+r);freezeBackground(),mailsetCenter(r),i.find(".leavePage").off("click").click((function(){i.hide(),t.resume(),removeFreezeLayer(),Events.isLinksModified=!1})),i.find(".stayPage").off("click").click((function(){i.hide(),e.abort(),removeFreezeLayer()})),i.focus()}}},beforeExit:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess(),crmui.hidePopup("newRelatedListPopUpDiv")}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.links-and-buttons.index-links-and-buttons",{queryParams:["component"],getResources:function(){if("undefined"==typeof CustomButtonJSObject)return networkUtils.returnDependencyFiles(["zohocrm_custombuttonsetup.js"])},model:function(e){if(this.transition.cachedResponse)return this.transition.cachedResponse;var t=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),r=this.getQueryParams().component,i={params:null!=r?{step:"loadCustomButtonsForModule",module:t,component:r}:{innerTab:"cusLink",module:t,step:"customizeButtons"}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CustomButton.do","POST",i)},afterModel:function(e){if(0===e.indexOf("ALERT:::")){var t=e.split("ALERT:::");$("#with_link_left_pane").hide(),Lyte.Router.getRouteInstance().replaceWith("crm.settings.section.modules.module.layouts",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()),CrmPageLayout.showMsgBand($("#moduleCustomizationDiv"),"alert",t[1],4e3)}},renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:e}},beforeExit:function(){"undefined"!=typeof customFunctionsObj&&customFunctionsObj.postRouteProcess(),crmui.hidePopup("newRelatedListPopUpDiv")}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.map-dependency.create-map-dependency",{queryParams:["layoutId"],model:function(e){e={action:"new",module:Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()};this.getQueryParams().layoutId&&(e.layoutId=this.getQueryParams().layoutId);var t={params:e};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/FieldDependency.do","GET",t)},renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.map-dependency.edit-map-dependency",{queryParams:["layoutId"],model:function(e){e={action:"edit",module:Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),uid:this.getDynamicParam()};this.transition.data&&this.transition.data.conId&&(e.conId=this.transition.data.conId,e.depId=this.transition.data.depId,"true"===this.transition.data.subForm&&(e.subLayoutId=this.transition.data.subLayoutId,e.subModule=this.transition.data.subModule)),this.getQueryParams().layoutId&&(e.layoutId=this.getQueryParams().layoutId);var t={params:e};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/FieldDependency.do","GET",t)},afterModel:function(e){void 0!==e.fieldDependencyEditNotAllowed&&e.fieldDependencyEditNotAllowed&&(void 0!==e.parentFld&&"false"===e.parentFld&&void 0!==e.childFld&&"false"===e.childFld?crmui.showMsgBand("error",I18n.getMsg("crm.mb.edit.dependency.alert1",[e.parentFldLabel,e.childFldLabel,e.layoutName]),3e3):void 0!==e.parentFld&&"false"===e.parentFld?crmui.showMsgBand("error",I18n.getMsg("crm.mb.edit.dependency.alert2",[e.parentFldLabel,e.layoutName]),3e3):void 0!==e.childFld&&"false"===e.childFld?crmui.showMsgBand("error",I18n.getMsg("crm.mb.edit.dependency.alert3",[e.childFldLabel,e.layoutName]),3e3):crmui.showMsgBand("error",I18n.getMsg("crm.mb.edit.dependency.not.allowed.msg"),3e3),this.replaceWith("crm.settings.section.modules.module.map-dependency.index-map-dependency",Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()))},renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:e}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.map-dependency.index-map-dependency",{queryParams:["layoutId"],model:function(e){e={action:"show",operation:"edit",module:Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()};this.getQueryParams().layoutId&&(e.layoutId=this.getQueryParams().layoutId);var t={params:e};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/FieldDependency.do","GET",t)},renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:e}},afterRender:function(e,t){var r=$("#cancelBtn").closest("link-to"),i=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam();"layoutsList"===this.parent.fromPage&&(r.attr("lt-prop-route","crm.settings.section.modules.module.layouts.index-layouts"),r.attr("lt-prop-dp",'["'+i+'"]')),"layout"===this.parent.fromPage&&(r.attr("lt-prop-route","crm.settings.section.modules.module.layouts.index-layouts"),r.attr("lt-prop-dp",'["'+i+'"]'),this.parent.fromLayout&&(r.attr("lt-prop-route","crm.settings.section.modules.module.layouts.view-layout"),r.attr("lt-prop-dp",'["'+i+'","'+this.parent.fromLayout+'"]')));var a=moduleRecordMapping[i].plural_label;$("#customizationDiv").addClass("p30 pT20"),$("#layout_landing_left").show(),$(".moduleNameSection").show(),$("#mainMenuTabDiv").show(),$("#innerTabDiv").show(),$(".landingModuleLists ul li").removeClass("selected"),$("#layout_landing_right").find(".moduleLandingName").find("span").text(a),$(".landingModuleLists ul li[data-zcqa='MPL_layoutListPage_"+i+"']").addClass("selected");$("body").removeClass("builder_page_body"),CML.layoutLandingResize()}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.validation-rules.index-validation-rules",{model:function(e){var t=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),r=this.parent.getQueryParams().layoutId;CVRCust.module=t,CVRCust.layoutId=r;var i={params:{module:moduleRecordMapping[CVRCust.module].api_name,layout_id:this.parent.getQueryParams().layoutId}};return networkUtils.lyteInitiateRequest("/crm/v2.1/settings/validation_rules","GET",i)},afterModel:function(e){CVRCust.storeRuleDependencyData(e.info),CVRCust.processDataForUserImg(e.validation_rules)},renderTemplate:function(e,t){return{outlet:"#customizationDiv",html:Handlebars.templates.validationRuleListView(e.validation_rules)}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg("crm.label.validation.rules"),Crm.partnerName])),Search.init(),Search.isVRCriteria=!0,$("#validationRuleCustDiv").empty().hide();var r=this.transition.data.action;CVRCust.storeRuleDependencyData(e.info),CVRCust.processDataForUserImg(e.validation_rules);var i=this.parent.getQueryParams().layoutId;if(i?(CVRCust.layoutId=i,$("#layoutDetails").find("option[value="+i+"]").prop("selected",!0),CVRCust.enableOrDisableCreateButton(i)):null!=CVRCust.layoutCount&&1!=CVRCust.layoutCount||CVRCust.enableOrDisableCreateButton(CVRCust.masterLayoutId),CVRCust.fromFieldObj&&!$.isEmptyObject(CVRCust.fromFieldObj)&&CVRCust.showCreatePopup(CVRCust.fromFieldObj.layoutId,CVRCust.fromFieldObj.apiName),r){Events.isPageLayoutModified&&(Events.isPageLayoutModified=!1,CrmModule.hideMe("#changeslostCB"));var a=$("#finalSaveRule,#cancelRule");a.attr("disabled",!0);var s=this.transition.data.status,o=this.transition.data.ruleResp,n={delete:"crm.validation.rule.deleted.successfully",active:"crm.validation.rule.activated.successfully",inactive:"crm.validation.rule.deactivated.successfully",created:"crm.validation.rule.created.successfully"},l=$("#validationRuleCustDiv"),c=$("#moduleCustomizationDiv");c.show(),"createCancel"==r&&(l.empty().hide(),c.show(),Crm.trackSpotLightAction("Validation Rule - New Validation Rule Cancelled",{Module:CVRCust.module})),null!=s&&"success"==s?"created"==r&&o.validation_rules[0].code.indexOf("SUCCESS")>-1?(l.empty().hide(),c.show(),crmui.showMsgBand("success",I18n.getMsg(n[r]),"4000","")):"delete"==r&&o.validation_rules.code.indexOf("SUCCESS")>-1||o.validation_rules[0].code.indexOf("SUCCESS")>-1?r&&"inactive"==r?crmui.showMsgBand("warning",I18n.getMsg(n[r]),"4000",""):crmui.showMsgBand("success",I18n.getMsg(n[r]),"4000",""):("delete"==r&&o.validation_rules.code.indexOf("SUCCESS")>-1||o.validation_rules.code[0].indexOf("INVALID_VALIDATION_RULE")>-1)&&crmui.showMsgBand("error",I18n.getMsg("crm.validation.rule.invalid.validation.rule.id"),"4000",""):null!=s&&"error"==s&&(o.responseJSON.code.indexOf("NOT_SUPPORTED_FEATURE")>-1?crmui.showMsgBand("error",I18n.getMsg("crm.validation.rule.edition.not.support"),"4000",""):o.responseJSON.code.indexOf("NO_PERMISSION")>-1?crmui.showMsgBand("error",I18n.getMsg("crm.zti.error.notauthendication"),"4000",""):crmui.showMsgBand("error",{delete:"crm.validation.rule.delete.error",active:"crm.validation.rule.active.error",inactive:"crm.validation.rule.inactive.error"}[r],"4000","")),crmui.hidePopup("deletePopDiv"),removeFreezeLayer(),a.attr("disabled",!1)}Crm.trackSpotLightAction("Validation Rule - Page Visited",{Module:Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam()})},actions:{willTransition:function(){Search.isVRCriteria&&(Search.isVRCriteria=!1)}}}),Lyte.Router.registerRoute("crm.settings.section.modules.module.validation-rules.view-validation-rule",{queryParams:["layoutId"],getResources:function(){return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customfunctions"),"zcrm_custom_functions.min.js"])},model:function(e){var t=Lyte.Router.getRouteInstance("crm.settings.section.modules.module").getDynamicParam(),r=this.getQueryParams().layoutId;CVRCust.module=t,CVRCust.layoutId=r;var i={params:{module:moduleRecordMapping[t].api_name,layoutId:r}};return networkUtils.lyteInitiateRequest("/crm/v2.1/settings/validation_rules/"+this.getDynamicParam(),"GET",i)},renderTemplate:function(e,t){if(e&&e.validation_rules&&e.validation_rules.length){var r={},i=e.validation_rules[0];r.modulelabel=moduleRecordMapping[CVRCust.module].plural_label,$.isEmptyObject(CVRCust.layoutIdvsNameObj)||(r.layoutname=CVRCust.layoutIdvsNameObj[CVRCust.layoutId]),i.active||(r.status=!1),r.generated_type=i.generated_type,r.field=i.field,r.execution_type=i.execution_type,r.source=i.source;var a={};return a.api_name=CVRCust.module+"."+i.field.api_name,a.field_label=i.field.field_label,CVRCust.primaryField=a,r.validation_type="criteria",i.associated_function&&(CVRCust.associated_function=i.associated_function,r.associated_function={},r.associated_function.name=CVRCust.associated_function.name,r.associated_function.id=CVRCust.associated_function.id,r.associated_function.category="crmfundamentals",r.validation_type="function"),CVRCust.validation_type=r.validation_type,r.function_rule_count=e.info.function_rule_count,{outlet:"#validationRuleCustDiv",html:Handlebars.templates.validationRuleConfig(r)}}var s=I18n.getMsg("crm.label.validation.rule").toLowerCase();$("#validationRuleCustDiv").html(crmTemplate.createRecordNotFoundAlertDiv(I18n.getMsg("crm.validation.header.alert",s),I18n.getMsg("crm.validation.body.alert",s)))},afterRender:function(e){var t=$(".validation-rule-container-inner"),r={height:renderingUtils.windowHeight-t.offset().top-30};if(!e||!e.validation_rules||!e.validation_rules.length){var i=$("#validationRuleCustDiv");return $("#moduleCustomizationDiv").hide(),i.removeClass("p30").addClass("p0"),void i.show()}Search.isVRCriteria=!0,CVRCust.validationRuleId=this.getDynamicParam(),CVRCust.storeRuleDependencyData(e.info);i=$("#validationRuleCustDiv");$("#moduleCustomizationDiv").hide(),i.removeClass("p30").addClass("p0");var a=e.validation_rules[0];(i=$("#validationRuleCustDiv")).find("#backtoIcon").attr("onclick",'CVRCust.showconfirmMoveAwayPopup("editCancel")'),i.find("#cancelRule").attr("onclick",'CVRCust.showconfirmMoveAwayPopup("editCancel")'),i.find("#finalSaveRule").attr("onclick","CVRCust.updateValidationRule()");var s=a.conditions;if(null!=s){for(var o=s.length,n=$("#addParentDiv"),l=0;l<o;l++){var c=CVRCust.formatCriteriaValue(s[l].primary_condition);0==l?i.find("#validationRuleDiv").html(Handlebars.templates.validationRuleParent(c)):i.find("#P"+l).after(Handlebars.templates.validationRuleParent(c));var d=$(".validationRuleParent").last(),u="P"+(l+1);d.attr("id",u),d.data("id",s[l].id),(c=CVRCust.formatCriteriaValue_forPicklist(c,!1)).value=c.value.toString(),delete c.case_sensitive,delete c.column_name,delete c.compareStr,delete c.data_type,delete c.relational_criteria_id,d.data("crt",c),d.data("isModified",!1),d.find("#priRuleSumDiv").attr("id","priRuleSumDiv_"+u),d.find("#primaryComp").attr("id","primaryComp_"+u),d.find("#primaryCompVal").attr("id","primaryCompVal_"+u),d.find("#primaryMoreDiv").attr("data-zcqa","VR_"+u+"_more"),d.find("#btnNewBranchRule").attr("data-zcqa","VR_"+u+"_new_branch");var m=s[l].sub_conditions,p=m.length;if(0==p){var g={criteria:"allRecords"};g.alert=s[l].alert,i.find("#P"+(l+1)).find("#addNewBranchRule").before(Handlebars.templates.validationRuleBranch(g));var f=u+"_B1";(y=d.find(".validationRuleBranch").last()).attr("id",f),delete g.criteria.case_sensitive,delete g.criteria.column_name,delete g.criteria.compareStr,delete g.criteria.data_type,delete g.criteria.relational_criteria_id,y.data("crt",g.criteria),y.find("#branchRuleSumOrEditDiv").attr("id","branchRuleSumOrEditDiv_"+f),y.find("#branchRuleDiv").attr("id","branchRuleDiv_"+f),y.find("#alertMsg").attr("id","alertMsg_"+f),y.find("#alertMsg_"+f).data("alert",s[l].alert),y.find("#alertMsg_"+f).data("isModified",!1),y.find("#alertMsg").attr("data-zcqa","VR_alertMsg_"+f)}for(var h=0;h<p;h++){c=CVRCust.formatCriteriaValue(m[h].criteria),0==h?i.find("#P"+(l+1)).find("#addNewBranchRule").before(Handlebars.templates.validationRuleBranch(m[h])):i.find("#P"+(l+1)+"_B"+h).after(Handlebars.templates.validationRuleBranch(m[h]));var y;f=u+"_B"+(h+1);(y=d.find(".validationRuleBranch").last()).attr("id",f),y.data("id",m[h].id),c=CVRCust.formatCriteriaValue_forPicklist(m[h].criteria,!0),y.data("crt",m[h].criteria),y.data("isModified",!1),y.find("#branchRuleSumOrEditDiv").attr("id","branchRuleSumOrEditDiv_"+f),y.find("#branchRuleDiv").attr("id","branchRuleDiv_"+f),y.find("#alertMsg").attr("id","alertMsg_"+f),y.find("#alertMsg_"+f).data("alert",m[h].alert),y.find("#alertMsg_"+f).data("isModified",!1),h<p&&"allRecords"!=c&&($("#"+f).addClass("branch-rule-enable"),d.find("#addNewBranchRule").addClass("branch-rule-enable"))}p==CVRCust.branchRuleCnt&&($("#"+f).removeClass("branch-rule-enable"),d.find("#addNewBranchRule").removeClass("branch-rule-enable")),l<o&&p>0?(d.find(".primary-rule-details").addClass("branch-rule-enable"),n.addClass("branch-rule-enable")):(d.find(".primary-rule-details").removeClass("branch-rule-enable"),n.removeClass("branch-rule-enable"))}o==CVRCust.primaryRuleCnt&&(d.find(".primary-rule-details").removeClass("branch-rule-enable"),n.removeClass("branch-rule-enable")),CVRCust.alertMsgSetHeight(),t.css(r),thirdPartyUtils.bindSelect2("#execution_type_chooser",{disable_search_threshold:"-1"})}i.show(),"default"!=a.generated_type&&"private_plugin"!=a.source&&"market_place_plugin"!=a.source||($(".moreOptionIcon").remove(),$("textarea").prop("disabled",!0))}}),Lyte.Router.registerRoute("crm.settings.section.zia.besttime",{getResources:function(){return networkUtils.returnDependencyFiles(["besttime-analytics-mixin.js","besttime-analytics.js","zia-helpers.js"],crmConstants.jsStaticPathForLyte).concat(networkUtils.returnDependencyFiles(["crm-besttime-analytics.css"],crmConstants.lessStaticPathForLyte)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("besttimeanalytics")],crmConstants.jsStaticPath))},getDependencies:function(){return networkUtils.returnDependencyFiles(["zohocrm_chart.js"]).concat(networkUtils.returnDependencyFiles(["besttime-analytics-model.js"],crmConstants.jsStaticPathForLyte))},beforeExit:function(){this.unbindAnalyticsDataFromComponents()}},{mixins:["crm-besttime-analytics-helper"]}),Lyte.Router.registerRoute("crm.settings.section.zia.prediction-analytics",{getDependencies:function(){if(commonUtils.showHideLoadingDiv(!0),!store.modelFor("org"))return networkUtils.returnDependencyFiles(["org-model.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){return networkUtils.returnDependencyFiles(["zia/prediction/analytics/prediction-analytics.js","zia/prediction/analytics/prediction-analytics-mixins.js","zia-error.js"],crmConstants.jsStaticPathForLyte).concat(networkUtils.returnDependencyFiles(Crm.userDetails.RTL_ENABLED?["zia/prediction/analytics/prediction-analytics.css","zia/prediction/analytics/prediction-analytics-rtl.css"]:["zia/prediction/analytics/prediction-analytics.css"],crmConstants.cssStaticPathForLyte)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("predictionanalytics")],crmConstants.jsStaticPath))},beforeModel:function(){this.start=new Date},model:function(){var e=store.peekAll("prediction");return{predictions:e.length>0?e:store.findAll("prediction")}},afterModel:function(e){if(e.predictions.length>0){var t=e.predictions[0].id,r=store.peekAll("org"),i=this;return Lyte.resolvePromises({predictions:e.predictions,prediction:store.findRecord("prediction",t),org:r.length>0?r:store.findAll("org"),models:store.findRecord("dummy",t,{},void 0,!1,{url:"crm/v2.2/settings/zia/predictions/"+t+"/models"})}).then((function(t){e.prediction=Array.isArray(t.prediction)?t.prediction[0]:t.prediction;var r=i.preProcess(e.prediction,t.models);e.org=t.org,e.models=t.models,e.isModelAvailable=r.isModelAvailable,e.isPredictionAvailable=r.isPredictionAvailable,e.activeRecords=r.activeRecords,e.isClassification=r.isClassification,e.isSingle=r.isSingle}))}},renderTemplate:function(){return{component:"crm-prediction-analytics",outlet:"#result"}},actions:{onError:function(e,t){403===e.status&&(renderingUtils.displayPermissionDenied(e),t.abort())}},beforeExit:function(){$(".predictionanalyticsviewcontainer").off("scroll"),$L("#setup_new_ContentDiv").removeClass("predictionanalyticsviewcontainer"),Crm.client_tracking("Time spent in prediction analytics page",{Time:new Date-this.start})}},{mixins:["crm-prediction-analytics-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.prediction",{getResources:function(){return networkUtils.returnDependencyFiles(["prediction.js"],crmConstants.jsStaticPathForLyte).concat(networkUtils.returnDependencyFiles(["zia-error.js"],crmConstants.jsStaticPathForLyte)).concat(networkUtils.returnDependencyFiles(["prediction-mixins.js"],crmConstants.jsStaticPathForLyte)).concat(networkUtils.returnDependencyFiles(["zia-commons.js"],crmConstants.jsStaticPathForLyte)).concat(networkUtils.returnDependencyFiles(["prediction.css","crm-zia-error.css"],crmConstants.cssStaticPathForLyte)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("prediction")],crmConstants.jsStaticPath))},model:function(){return store.findAll("prediction")},redirect:function(e){"crm.settings.section.zia.prediction"===this.transition.target?Lyte.Router.transitionTo({route:"crm.settings.section.zia.prediction.index"}).data={limit:e.$.meta.limit}:this.transition.data.limit=e.$.meta.limit},actions:{onError:function(e,t){403===e.status&&(renderingUtils.displayPermissionDenied(e),t.abort())}}}),Lyte.Router.registerRoute("crm.settings.section.zia.recommendation-analytics",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["recommendations_analytics.js"],crmConstants.jsStaticPathForLyte);return commonUtils.showHideLoadingDiv(!0),store.modelFor("org")||(e=e.concat(networkUtils.returnDependencyFiles(["org-model.js"],crmConstants.jsStaticPathForLyte))),e},getResources:function(){var e=networkUtils.returnDependencyFiles(["recommendation-analytics.js"],crmConstants.jsStaticPathForLyte).concat(networkUtils.returnDependencyFiles(["recommendation-analytics.css"],crmConstants.lessStaticPathForLyte)).concat(networkUtils.returnDependencyFiles(["zia-error.js"],crmConstants.jsStaticPathForLyte)).concat(networkUtils.returnDependencyFiles(["crm-zia-error.css"],crmConstants.cssStaticPathForLyte));return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("recommendation")],crmConstants.jsStaticPath).concat(e)},model:function(){return Lyte.resolvePromises({recommendationAnalyticsLists:store.findAll("recommendation_analytics_meta",{include_inner_details:"recommendation.what_to,recommendation.whom_to,recommendation.based_on,recommendation.done_by,recommendation.active"})})},redirect:function(e){commonUtils.showHideLoadingDiv(!1),"crm.settings.section.zia.recommendation-analytics"===this.transition.target&&this.replaceWith("crm.settings.section.zia.recommendation-analytics.view",e.recommendationAnalyticsLists.$?e.recommendationAnalyticsLists.$.meta.last_visited_recommendation.id:"noData")},actions:{onError:function(){Lyte.Router.transitionTo("crm.settings.section.zia.recommendation-analytics.error",null)}}}),Lyte.Router.registerRoute("crm.settings.section.zia.recommendation",{getDependencies:function(){return networkUtils.returnDependencyFiles(["recommendation-gallery.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["recommendation.js","recommendation-welcome-comp.js","zia-helpers.js"],crmConstants.jsStaticPathForLyte).concat(networkUtils.returnDependencyFiles(["recommendation.css","recommendation-welcome-comp.css"],crmConstants.cssStaticPathForLyte));return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("recommendation")],crmConstants.jsStaticPath).concat(e)},redirect:function(e){"crm.settings.section.zia.recommendation"===this.transition.target&&(this.replaceWith("crm.settings.section.zia.recommendation.index",this.getDynamicParam()),!1===Crm.userDetails.isZiaSetupMigRan)||(void 0===e.displayPermissionDenied||!0!==e.displayPermissionDenied?ZiaConfig.newRecommendationIsPermission=!0:ZiaConfig.newRecommendationIsPermission=!1)},model:function(e){return commonUtils.showHideLoadingDiv(!0),Lyte.resolvePromises({recommendationModuleArray:0!==store.peekAll("recommendations").length?Promise.resolve(store.peekAll("recommendations")):store.findAll("recommendations"),recommendationGallery:void 0!==store.peekAll("recommendation_gallery")&&0===store.peekAll("recommendation_gallery").length?store.findAll("recommendation_gallery",{page:1,per_page:1500}):Promise.resolve(store.peekAll("recommendation_gallery"))}).then((function(t){return t.recommendationModuleArray.$&&(ZiaConfig.newRecommendationLimit=t.recommendationModuleArray.$.meta.limit),commonUtils.showHideLoadingDiv(!1),e.displayPermissionDenied=!1,e}),(function(t){if(403===t.status)return e.displayPermissionDenied=!0,e;commonUtils.showHideLoadingDiv(!1)}))},renderTemplate:function(){return{outlet:"#result",component:"crm-recommendation-welcome-comp"}},didDestroy:function(){"crm.settings.section.zia.recommendation.index"===this.transition.target&&(store.unloadAll("recommendations"),store.unloadAll("recommendation_gallery"))}}),Lyte.Router.registerRoute("crm.settings.section.zia.similarity",{getResources:function(){var e=networkUtils.returnDependencyFiles(["recommendation-welcome-comp.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["recommendation-similarity.css"],crmConstants.lessStaticPathForLyte),r=networkUtils.returnDependencyFiles(["recommendation-welcome-comp.css"],crmConstants.cssStaticPathForLyte),i=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("SimilarityRecommendation")],crmConstants.jsStaticPath);return e.concat(r).concat(t).concat(i)},redirect:function(){"crm.settings.section.zia.similarity"===this.transition.target&&this.replaceWith("crm.settings.section.zia.similarity.list")},model:function(){return{similarities:Lyte.registeredMixins["similarity-utils"].lazyFindAll("similarity")}},renderTemplate:function(){return{outlet:"#result",component:"crm-recommendation-welcome-comp"}},didDestroy:function(){"crm.settings.section.zia.similarity.list"===this.transition.target&&store.unloadAll("similarity")}},{mixins:["similarity-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.vision",{getResources:function(){var e,t=networkUtils.returnDependencyFiles(["crm-ziavision.js","crm-vision-helper.js","crm-adminTool-helper.js","lyte-fileupload.js","zia-error.js","zia-commons.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ziavision")]);return e=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-ziavision.css","crm-zia-error.css","crm-ziavision-rtl.css"],crmConstants.cssStaticPathForLyte):networkUtils.returnDependencyFiles(["crm-ziavision.css","crm-zia-error.css"],crmConstants.cssStaticPathForLyte),t.concat(e).concat(r)},model:function(){return Crm.userDetails.permissions.Crm_Implied_Manage_Vision?(store.unloadAll("visions"),{visions:store.findAll("visions")}):(renderingUtils.displayPermissionDenied(),Lyte.Router.getRouteInstance().transition.abort(),!1)},afterModel:function(){var e={A:"1",C:"20",Z:"1",U:"20"};this.currentModel.maxLimit=void 0!==e[Crm.userDetails.LICENSE_TYPE]?e[Crm.userDetails.LICENSE_TYPE]:0,"Z"===Crm.userDetails.LICENSE_TYPE&&void 0!==Crm.userDetails.ULTIMATE_ADDON_COUNT&&0!==Crm.userDetails.ULTIMATE_ADDON_COUNT&&(this.currentModel.maxLimit=e.U)},redirect:function(){"crm.settings.section.zia.vision"===this.transition.info.route&&this.replaceWith("crm.settings.section.zia.vision.index",{},null)},actions:{onError:function(e,t){if(403===e.status)return renderingUtils.displayPermissionDenied(e),t.abort(),!1}}}),Lyte.Router.registerRoute("crm.settings.section.zia.admin-panel",{model:function(e){return networkUtils.lyteInitiateRequest("/crm/v2/setup/zia/config","GET",{params:{isOrgConfig:!0,isZiaPanel:!0}})},renderTemplate:function(e,t){var r,i=ZiaConfig.updateIsAllEnabled(e.configs),a=(Handlebars.templates.ZiaConfigList({data:i,isOrgConfig:!0}),e.prediction_config);return r=!0===e.isAvailable?"true":"false",a.inputTypes=[{id:"junkSelect",value:"zia.lead.admin.lead.user.junk"},{id:"notQfySelect",value:"zia.lead.admin.lead.user.input"}],{outlet:"#result",html:null!=e.status_picklist?Handlebars.templates.ZiaConfigList({data:i,predictionTab:!0,leadPickAvl:r,isOrgConfig:!0,pickList:e.status_picklist.picklist,predictionConfig:a}):Handlebars.templates.ZiaConfigList({data:i,predictionTab:!1,isOrgConfig:!0})}},afterRender:function(e,t){for(var r=ZiaConfig.updateIsAllEnabled(e.configs),i=!0,a="",s="",o=r.length,n=0;n<o;n++)if(1==r[n].category)for(var l=r[n].configs,c=l.length,d=0;d<c;d++){var u=l[d].actualName;if(s+="<a data-module='"+u+"' datatoId='"+d+"' class='pL20 pR20 pT5 pB5 fL f12  uppercase crm-font-bold  pR crm-font-bold  cP gameWhiteBg col666  ' onclick='ZiaConfig.predictionTabChange(this)' data-zcqa='trophyswitch'>",s+=l[d].title_singular,s+="<span class='gConfigMenuSwitch'></span></a>",i&&(a=u,i=!1),1==l[d].status||"true"==l[d].status)$("#"+u+"_ChkId").prop("checked",!0);var m=l[d].active_status,p=$("#"+u+"_enabledInfoDiv"),g=$("#"+u+"_ZiaEnablePrimarybtn"),f=$("."+u+"_ziaConfig_btn");if("0"===m?(g.show(),f.hide()):("Leads"===u&&("2"!=m&&p.show(),0==l[d].status&&p.hide()),g.hide(),f.show()),void 0===m){var h=$("#"+u+"_container");h.find(".ziaPredictionPanelContainer").hide(),h.find(".note").hide(),p.hide()}}if(null!=e.prediction_config&&e.prediction_config.crtDetail.length>0){var y=e.prediction_config.crtDetail,v=y.length;for(n=0;n<v;n++)ZiaConfig.updateCrtImg(y[n],y[n].actualName+"_criteria")}$("#"+a+"_container").show(),$(".ziaEnableContainer").hide(),$("#ziaSwitch").append(s);var _=$(".predictionTabLinks"),b=_.find(".gameWhiteBg");_.find(".gMenuAnimate").css({width:b.first().outerWidth()}),b.first().removeClass("gameWhiteBg col666").addClass("gameBlueBg black cD"),thirdPartyUtils.bindSelect2($(".ziaSelect"));var w=[],C=[],D=e.status_picklist,L=void 0;if(null!=D){var R=$("#notQfySelect"),P=$("#junkSelect"),I=D.picklist,S=I.length;for(n=0;n<S;n++){var M=I[n];$.isEmptyObject(M)||("Junk"===M.category&&w.push(M.uniqueid),"NotQualified"===M.category&&C.push(M.uniqueid),"Not Qualified"===M.actualvalue&&(L=M.uniqueid))}var k=w.length,T=C.length;if(null!=L&&(R.find('option[value="'+L+'"]').attr("locked",!0),P.find("option[value='"+L+"']").remove()),k>0){for(d=0;d<T;d++)P.find("option[value='"+C[d]+"']").remove();P.val(w).trigger("update")}if(T>0){for(d=0;d<k;d++)R.find("option[value='"+w[d]+"']").remove();R.val(C).trigger("update"),$("#ziaEnableBtn").prop("disabled",!1)}}},actions:{onError:function(e,t){crmui.showMsgBand("failure",I18n.getMsg("crm.zia.config.not.saved"),1500)}}}),Lyte.Router.registerRoute("crm.settings.section.zia.notification",{getDependencies:function(){return networkUtils.returnDependencyFiles(["zia-notification-settings.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){return networkUtils.returnDependencyFiles(["zia-notification.js"],crmConstants.jsStaticPathForLyte).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("notification")],crmConstants.jsStaticPath)).concat(networkUtils.returnDependencyFiles(["zia-notification.css"],crmConstants.lessStaticPathForLyte)).concat(networkUtils.returnDependencyFiles(["zohocrm_chatIntegration.js"]))},model:function(){var e=store.findAll("zia_notification_setup",{type:"workflow"}),t=store.findAll("zia_notification_common_config",{type:"workflow"});return Lyte.resolvePromises({zia_notification_setup:e,zia_notification_common_config:t})},afterModel:function(e){var t=e.zia_notification_setup.configurations,r=e.zia_notification_common_config,i=!1;return void 0!==r&&(i=r.enabled),this.currentModel={type:"wf",wfconfigs:t,isCommonConfigEnabled:i}},renderTemplate:function(){return{component:"crm-zianotification-setup",outlet:"#result",reRender:!0}},actions:{onError:function(){crmui.showMsgBand("failure",I18n.getMsg("crm.zia.config.not.saved"),1500)}},beforeExit:function(){store.unloadAll("zia_notification_setup"),store.unloadAll("zia_notification_common_config")}}),Lyte.Router.registerRoute("crm.settings.section.zia.untitlerecommendation",{getResources:function(){return networkUtils.returnDependencyFiles(["ziainemail.js"],crmConstants.jsStaticPathForLyte)},model:function(){return networkUtils.lyteInitiateRequest("/crm/v2/setup/zia/config","GET",{params:{isOrgConfig:!0,isRecommendation:!0}})},renderTemplate:function(e){var t=ZiaConfig.updateIsAllEnabled(e.configs);return{outlet:"#result",html:Handlebars.templates.ZiaConfigList({data:t,isRecommendation:!0})}},actions:{onError:function(){crmui.showMsgBand("failure",I18n.getMsg("crm.zia.config.not.saved"),1500)}}}),Lyte.Router.registerRoute("crm.settings.section.zia.reminder",{getDependencies:function(){var e=networkUtils.returnDependencyFiles(["reminder-settings-model.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["reminder-setup-model.js"],crmConstants.jsStaticPathForLyte);return e.concat(t)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-communication-reminder-setup.css"],crmConstants.lessStaticPathForLyte),t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Reminder")],crmConstants.jsStaticPath),r=e.concat(t),i=networkUtils.returnDependencyFiles(["crm-communication-reminder-setup.js","zia-helpers.js"],crmConstants.jsStaticPathForLyte);return r=r.concat(i)},model:function(){return Lyte.resolvePromises({configs:store.findAll("reminder_setup",{isOrgConfig:!0,isRecommendation:!0}),reminders:store.findAll("reminder_settings")})},renderTemplate:function(e,t){return{outlet:"#result",component:"crm-communication-reminder-setup"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.sentiment-model",{getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_sentimentmodel.js",networkUtils.getI18nJSUrl("sentimentmodel")])},model:function(e){return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/EmailSentimentModelAction.do","GET",{params:{action:"sentimentModel"}})},renderTemplate:function(e,t){var r=e;return"object"==typeof e&&(r=Handlebars.templates.SentimentModelDataHeaders(r)),{outlet:"#result",html:r}},afterRender:function(e,t){"ZIA"===e.CHOOSEN_MODEL?($("#ziaExist").attr("checked",!0),sentimentModel.showInitialModel(2,e)):"ORG"===e.CHOOSEN_MODEL&&($("#ziaownnew").attr("checked",!0),sentimentModel.showInitialModel(1,e)),e.IS_MODEL_DEFINED||($(".sentimentDisableNotification").show(),$(".sentimentModel_header").parent().addClass("disableNotify")),thirdPartyUtils.bindSelect2(".ziaExistingIndustrmodel");var r=$("#result");setTimeout((function(){r.removeClass("pR"),$(".sentimentkrploading").hide()}),200),r.css({height:"100%"}),crmLayout.Resize.Setup();var i=$(".publisSettingsContainer");i.css({width:renderingUtils.windowWidth-260}),i.css("opacity",""),$(".emailsentimentalcontenteditablediv").css({"max-height":renderingUtils.windowHeight-260})},actions:{onError:function(e,t,r){crmui.showMsgBand("failure",I18n.getMsg("crm.zia.config.not.saved"),1500)}}}),Lyte.Router.registerRoute("crm.settings.section.zia.zia-voice",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-chatbot-config.js","zia-error.js","lytecombobox.js","crux-smart-filter-input.js","crux-smart-filter.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("chatbot")],null),r=networkUtils.returnDependencyFiles(["crm-chatbot-config.css","crux-smart-filter.css"],crmConstants.cssStaticPathForLyte);return e.concat(t).concat(r)},getDependencies:function(){return networkUtils.returnDependencyFiles(["chatbotConfig.js"],crmConstants.jsStaticPathForLyte)},beforeExit:function(){store.unloadAll("chatbot-config")},renderTemplate:function(){return{outlet:"#result",component:"crm-ziavoice-index"}},actions:{refreshRoute:function(){this.refresh()},onError:function(e){if("NOT_ALLOWED"===(t=JSON.parse(e.response)).code)return this.replaceWith("crm.settings.index"),setTimeout((function(){renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"))}),500),!1;var t=JSON.parse(e.response);commonUtils.showHideLoadingDiv(!1),$L("#result").html("");var r={heading:I18n.getMsg("crm.chatbot.disable.title"),message:I18n.getMsg("crm.chatbot.disable.content",Crm.appName)},i={heading:I18n.getMsg("crm.skyeye.setup.msg.error")},a=["NOT_ALLOWED","NO_PERMISSION","AUTHENTICATION_FAILURE"].contains(t.code)?r:i;return Lyte.Component.render("crm-ziavoice-error-component",a,"#result"),!1}}}),Lyte.Router.registerRoute("crm.settings.section.zia.besttime.analytics",{model:function(){var e={};e.analytics_summary=store.findAll("analytics_summary",{filter_by_period:"last_week"});return e.duration=store.findAll("dummy",{key:"BEST_TIME_ANALYTICS_ENABLED_DURATION"},!1,!1,{url:"/crm/v4/__internal/crm_nc_key_values"}),Lyte.resolvePromises(e)},afterModel:function(e){var t=this.getBestTimeAnalyticsEnabledDays(e.duration.crm_nc_key_values.value),r={};return r.analytics_summary=e.analytics_summary,t<7?this.currentModel={analyticsSummaryObj:r.analytics_summary,analytics_summary:r,days_since_analytics_enabled:t}:r.analytics_summary.length>0?this.currentModel={analyticsSummaryObj:this.constructAnalyticsObj(r.analytics_summary),analytics_summary:r.analytics_summary,days_since_analytics_enabled:t}:this.currentModel={analyticsSummaryObj:r.analytics_summary,analytics_summary:r,days_since_analytics_enabled:t}},renderTemplate:function(){var e=this.currentModel.days_since_analytics_enabled;return this.currentModel.analytics_summary.length>0&&e>=7?{component:"crm-besttime-analytics",outlet:"#result"}:{component:"crm-besttime-analytics-empty",outlet:"#result"}},beforeExit:function(){this.unbindAnalyticsDataFromComponents()},actions:{onError:function(e,t){if(403===e.status)return renderingUtils.displayPermissionDenied(e),t.abort(),!1}}},{mixins:["crm-besttime-analytics-helper"]}),Lyte.Router.registerRoute("crm.settings.section.zia.prediction.create",{model:function(){return store.peekAll("prediction").length<this.transition.data.limit?{prediction:store.createRecord("prediction",{follow_up:!0})}:void 0},renderTemplate:function(e){if(void 0!==e)return e.dLeadDisabled=this.transition.data.dLeadDisabled,e.dDealDisabled=this.transition.data.dDealDisabled,{component:"crm-prediction-create",outlet:"#result"};Lyte.Router.getRouteInstance().transition.preservePopup=!0,renderingUtils.displayPermissionDenied()},actions:{willTransition:function(e){this.checkIsDirty(e)}}},{mixins:["crm-prediction-route-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.prediction.defaultprediction",{queryParams:["module"],model:function(){return networkUtils.lyteInitiateRequest("/crm/v2/setup/zia/config","GET",{params:{isOrgConfig:!0,isZiaPanel:!0}})},renderTemplate:function(e){var t,r=ZiaConfig.updateIsAllEnabled(e.configs),i=Handlebars.templates.ZiaConfigList({data:r,isOrgConfig:!0}),a=e.prediction_config;return t=!0===e.isAvailable?"true":"false",a.inputTypes=[{id:"junkSelect",value:"zia.lead.admin.lead.user.junk"},{id:"notQfySelect",value:"zia.lead.admin.lead.user.input"}],i=void 0!==e.status_picklist?Handlebars.templates.ZiaConfigList({data:r,predictionTab:!0,leadPickAvl:t,isOrgConfig:!0,pickList:e.status_picklist.picklist,predictionConfig:a}):Handlebars.templates.ZiaConfigList({data:r,predictionTab:!1,isOrgConfig:!0}),$(".prediction-setupspace-listview,.predictionBuilderCreateView,.predictionBuilderDetailView").hide(),$(".predictionBuilderDefaultView").show(),{outlet:"#result",html:i}},afterRender:function(e){for(var t=ZiaConfig.updateIsAllEnabled(e.configs),r=!0,i="",a="",s=t.length,o=0;o<s;o++)if(1===t[o].category)for(var n=t[o].configs,l=n.length,c=0;c<l;c++){var d=n[c].actualName;if(a+="<a id='"+d+"Predictionelt'data-module='"+d+"' datatoId='"+c+"' class='pL20 pR20 pT5 pB5 fL f12  uppercase crm-font-bold  pR crm-font-bold  cP gameWhiteBg col666  ' onclick='ZiaConfig.predictionTabChange(this)' data-zcqa='trophyswitch'>",a+=n[c].title_singular,a+="<span class='gConfigMenuSwitch'></span></a>",r&&(i=d,r=!1),!0===n[c].status||"true"===n[c].status)$("#"+d+"_ChkId").prop("checked",!0);var u=n[c].active_status,m=$("#"+d+"_enabledInfoDiv"),p=$("#"+d+"_ZiaEnablePrimarybtn"),g=$("."+d+"_ziaConfig_btn");if("0"===u?(p.show(),g.hide()):("Leads"===d&&("2"!==u&&m.show(),!1===n[c].status&&m.hide()),p.hide(),g.show()),void 0===u){var f=$("#"+d+"_container");f.find(".ziaPredictionPanelContainer").hide(),f.find(".note").hide(),m.hide()}}if(void 0!==e.prediction_config&&e.prediction_config.crtDetail.length>0){var h=e.prediction_config.crtDetail,y=h.length;for(o=0;o<y;o++)ZiaConfig.updateCrtImg(h[o],h[o].actualName+"_criteria")}var v=$(".predictionTabLinks");v.hide(),$(".ZiaPanelHeaderDefault").parent().prev().hide();var _=$(".ziaPredictionPanelContainer h2");_.addClass("pR"),_.append('<link-to lt-prop-route="crm.settings.section.zia.prediction.index" lt-prop-custom><span class="svgIcons cP ico-lineArrow-left dIB pA newsetupBackIcon mT2" style="left: -25px;top: 6px;"></span></link-to>');var b=$("#ziaSwitch"),w=v.find(".gameWhiteBg").first(),C=w.outerWidth(),D=v.find(".gMenuAnimate");$("#"+i+"_container").show(),$(".ziaEnableContainer").hide(),b.append(a),b.css({display:"none"});var L=$(document.getElementById(this.getQueryParams().module+"Predictionelt"));ZiaConfig.predictionTabChange(L),D.css({width:C}),w.removeClass("gameWhiteBg col666").addClass("gameBlueBg black cD"),thirdPartyUtils.bindSelect2($(".ziaSelect"));var R=$(".Leads_ziaConfig_btn"),P=$(".Potentials_ziaConfig_btn");"0"!==e.configs[0].configs[0].active_status&&("Leads"===e.configs[0].configs[0].actualName&&R.show(),"Potentials"!==e.configs[0].configs[0].actualName&&"Deals"!==e.configs[0].configs[1].actualName||P.show()),"0"!==e.configs[0].configs[1].active_status&&("Leads"===e.configs[0].configs[1].actualName&&R.show(),"Potentials"!==e.configs[0].configs[1].actualName&&"Deals"!==e.configs[0].configs[1].actualName||P.show());var I,S=[],M=[],k=e.status_picklist;if(void 0!==k){var T=$("#notQfySelect"),E=$("#junkSelect"),A=k.picklist,F=A.length;for(o=0;o<F;o++){var U=A[o];$.isEmptyObject(U)||("Junk"===U.category&&S.push(U.uniqueid),"NotQualified"===U.category&&M.push(U.uniqueid),"Not Qualified"===U.actualvalue&&(I=U.uniqueid))}var O=S.length,x=M.length;if(void 0!==I)T.find('option[value="'+I+'"]').attr("locked",!0),E.find("option[value='"+I+"']").remove();if(O>0){for(c=0;c<x;c++)E.find("option[value='"+M[c]+"']").remove();E.val(S).trigger("update")}if(x>0){for(c=0;c<O;c++)T.find("option[value='"+S[c]+"']").remove();T.val(M).trigger("update"),$("#ziaEnableBtn").prop("disabled",!1)}}},actions:{willTransition:function(e){"prediction"===e.info.routeName&&($(".predictionBuilderDetailView,.predictionBuilderCreateView,.predictionBuilderDefaultView").hide(),$(".prediction-setupspace-listview").show(),$(".predictionbuilderContainer").removeClass("recListBgView"))},beforeExit:function(){$(".predictionbuilderContainer").removeClass("bgDetColor")}}}),Lyte.Router.registerRoute("crm.settings.section.zia.prediction.edit",{beforeModel:function(){return commonUtils.showHideLoadingDiv(!0),this.getSinglePrediction(this.getDynamicParam())},model:function(){return this.error?void 0:this.moduleandFieldsForPrediction(this.getDynamicParam())},afterModel:function(){if(!this.error){var e=store.peekRecord("prediction",this.getDynamicParam()),t=e.predict_field.ui_type===CrmField.UITYPES.PICK_LIST||e.predict_field.ui_type===CrmField.UITYPES.STAGE;this.currentModel={prediction:e,isEditView:!0,mandatory:t?"":"newmandatory"}}},renderTemplate:function(){return this.error?{component:"crm-zia-error",outlet:"#result"}:{component:"crm-prediction-create",outlet:"#result"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)},actions:{willTransition:function(e){this.checkIsDirty(e)}}},{mixins:["crm-prediction-route-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.prediction.index",{model:function(){commonUtils.showHideLoadingDiv(!0);return networkUtils.lyteInitiateRequest("/crm/v2/setup/zia/config","GET",{params:{isOrgConfig:!0,isZiaPanel:!0}})},afterModel:function(e){var t=null,r=!0,i=!0;if(e.configs.length>0){for(var a=(t=e.configs[0].configs).length,s=0,o=0;o<a;o++)if(!0===t[o].status||"1"===t[o].active_status||"2"===t[o].active_status){var n="";t[s].config="0"!==t[o].active_status,t[s].category=e.configs[0].category,"Leads"===t[o].actualName?(r=!1,n="Leads"):(i=!1,n="Potentials");var l=store.peekAll("module").filterBy({module_name:n})[0];t[s].name=l.plural_label+" "+I18n.getMsg("crm.predictions.feature.label"),t[s].module=l.plural_label,t[s].module_name=n,t[s].field="Leads"===n?I18n.getMsg("Lead Status"):I18n.getMsg("Stage"),s++}0===s?t=null:1===s&&(t[1]=null,t.length=1)}var c=store.peekAll("prediction");return this.currentModel={prediction:c,configuredModules:this.getConfiguredModulesByFeature("prediction"),alldefaultprediction:t,defaultprediction:t,isPredictionAvailable:c.length<this.transition.data.limit,dLeadDisabled:r,dDealDisabled:i}},renderTemplate:function(){return this.currentModel.prediction.length>0||null!=this.currentModel.alldefaultprediction?{component:"crm-prediction-list",outlet:"#result"}:{component:"crm-prediction-getting-started",outlet:"#result"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)},actions:{onError:function(e,t){if(403===e.status||401===e.status)return renderingUtils.displayPermissionDenied(e),t.abort(),!1}}},{mixins:["crm-prediction-route-utils","crm-zia-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.prediction.view",{beforeModel:function(){return commonUtils.showHideLoadingDiv(!0),this.getSinglePrediction(this.getDynamicParam())},model:function(){return this.error?void 0:this.moduleandFieldsForPrediction(this.getDynamicParam(),"view")},afterModel:function(){var e=this;return e.error?void 0:e.processPredictionMeta(store.peekRecord("prediction",e.getDynamicParam()),e.currentModel).then((function(t){return e.currentModel=t}))},renderTemplate:function(){return this.error?{component:"crm-zia-error",outlet:"#result"}:{component:"crm-prediction-view",outlet:"#result"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)},actions:{onError:function(e,t){if(403===e.status)return renderingUtils.displayPermissionDenied(e),t.abort(),!1}},beforeExit:function(){$("#setup_new_ContentDiv").off("scroll")}},{mixins:["crm-prediction-route-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.anomaly",{getDependencies:function(){return networkUtils.returnDependencyFiles(["zia-notification-settings.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){return networkUtils.returnDependencyFiles(["zia-notification.js"],crmConstants.jsStaticPathForLyte).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("notification")],crmConstants.jsStaticPath)).concat(networkUtils.returnDependencyFiles(["zia-notification.css"],crmConstants.lessStaticPathForLyte)).concat(networkUtils.returnDependencyFiles(["zohocrm_chatIntegration.js"]))},model:function(){var e={};return e.custom_configs=networkUtils.lyteInitiateRequest("/crm/v2/Analytics/components","GET",{params:{filters:'[{"comparator":"equal","field":"component_type","value":"trends"}]'}}).then((function(e){return e}),(function(){return[]})),e.anomalyNotificationInfo=networkUtils.lyteInitiateRequest("/crm/v2/__internal/Analytics/actions/new_anomaly_notification","GET").then((function(e){return e}),(function(){return[]})),e.all_configs=store.findAll("zia_notification_setup",{type:"anomaly"}),e.common_config=store.findAll("zia_notification_common_config",{type:"anomaly"}),Lyte.resolvePromises(e)},afterModel:function(e){var t=!1;e.anomalyNotificationInfo&&e.anomalyNotificationInfo.new_anomaly_notification&&(t=e.anomalyNotificationInfo.new_anomaly_notification.enabled);var r=[];e.all_configs.configurations.each((function(e){e.notify_for&&"system"===e.notify_for.type&&r.push(e)}));var i,a=e.common_config;if(i=void 0!==a?a.mediums:[],e.custom_configs){for(var s=ZiaConfig.convertComponentsToConfigObj(e.custom_configs.components,e.all_configs.configurations,t),o=s.configs.length,n=0;n<o;n++)s.configs[n].mediums=i;return this.currentModel={type:"anomaly",anomalyconfigs:r,custAnomalyconfigs:s.configs,isNewAnomalyNotificationEnabled:t,isCommonConfigEnabled:!0}}return this.currentModel={type:"anomaly",anomalyconfigs:r,custAnomalyconfigs:null,isCommonConfigEnabled:!0}},renderTemplate:function(){return{component:"crm-zianotification-setup",outlet:"#result"}},beforeExit:function(){store.unloadAll("zia_notification_setup"),store.unloadAll("zia_notification_common_config")}}),Lyte.Router.registerRoute("crm.settings.section.zia.notification.index",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zia-notification.css"],crmConstants.lessStaticPathForLytee);return networkUtils.returnDependencyFiles(["zia-notification.js"],crmConstants.jsStaticPathForLyte).concat(e)},afterModel:function(){var e=this.transition.data.defaultConfigs.configs,t=null,r=e.length;if(r>0)for(var i=0;i<r;i++)51===e[i].category&&(t=e[i].configs);return this.currentModel={type:"wf",wfconfigs:t}},renderTemplate:function(){return{component:"crm-zianotification-detail",outlet:"#result"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.ziaforemail",{getDependencies:function(){return networkUtils.returnDependencyFiles(["zia-notification-settings.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){return networkUtils.returnDependencyFiles(["zia-notification.js"],crmConstants.jsStaticPathForLyte).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("notification")],crmConstants.jsStaticPath)).concat(networkUtils.returnDependencyFiles(["zia-notification.css"],crmConstants.lessStaticPathForLyte)).concat(networkUtils.returnDependencyFiles(["zohocrm_chatIntegration.js"]))},model:function(){var e=store.findAll("zia_notification_setup",{type:"zia_for_emails"}),t=store.findAll("zia_notification_common_config",{type:"zia_for_emails"});return Lyte.resolvePromises({zia_notification_setup:e,zia_notification_common_config:t})},afterModel:function(e){var t=e.zia_notification_setup.configurations,r=e.zia_notification_common_config,i=!1;return void 0!==r&&(i=r.enabled),this.currentModel={type:"ZE",ziaforemailconfigs:t,isCommonConfigEnabled:i}},renderTemplate:function(){return{component:"crm-zianotification-setup",outlet:"#result",reRender:!0}},actions:{onError:function(){crmui.showMsgBand("failure",I18n.getMsg("crm.zia.config.not.saved"),1500)}},beforeExit:function(){store.unloadAll("zia_notification_setup"),store.unloadAll("zia_notification_common_config")}}),Lyte.Router.registerRoute("crm.settings.section.zia.similarity.create",{getResources:function(){var e=networkUtils.returnDependencyFiles(["recommendation-similarity-create.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["zia-error.js"],crmConstants.jsStaticPathForLyte);return e.concat(t)},model:function(){return commonUtils.showHideLoadingDiv(!0),{modules:Lyte.registeredMixins["similarity-utils"].getSupportedModules()}},afterModel:function(e){e.modules=e.modules.module.filter((function(e){return!0===e.presence_sub_menu&&!0===e.visible&&"linking"!==e.generated_type})),e.similarities=store.peekAll("similarity"),commonUtils.showHideLoadingDiv(!1)},redirect:function(){this.currentModel.similarities.length>=ZiaConfig.similarityFeatureLimit&&(this.replaceWith("crm.settings.section.zia.similarity.list"),ZiaConfig.isSimilarityPermissionDenied=!0)},renderTemplate:function(){return{outlet:"#recommendation",component:"crm-similarity-configure"}},actions:{onError:function(){Lyte.Router.transitionTo("crm.settings.section.zia.similarity.error",null).data={errorMsg:I18n.getMsg("zia.similarity.error.message")}},willTransition:function(e){window.drp=void 0,!this.component||"crm.settings.section.zia.similarity.create"===e.target||"save"===this.component.component.data.currentButtonClick&&"crm.settings.section.zia.similarity.view"===e.target||!0===this.component.component.data.isConfigModified&&Lyte.registeredMixins["similarity-utils"].routeChangeConfirm(e,this)}}},{mixins:["similarity-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.similarity.edit",{getResources:function(){var e=networkUtils.returnDependencyFiles(["recommendation-similarity-create.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["zia-error.js"],crmConstants.jsStaticPathForLyte);return e.concat(t)},model:function(e){commonUtils.showHideLoadingDiv(!0);var t=Lyte.registeredMixins["similarity-utils"],r=t.lazyFindRecordWithProperty("similarity",e.dynamicParam,"selected_views"),i=void 0!==r&&"function"==typeof r.then?r.then((function(e){return store.peekRecord("module",e[0].module.id).fields?store.peekRecord("module",e[0].module.id):store.findRecord("module",e[0].module.id)})):store.peekRecord("module",r.module.id).fields?store.peekRecord("module",r.module.id):store.findRecord("module",r.module.id);return{similarity:r,isEdit:!0,modules:t.getSupportedModules(),whomModule:i,similarities:store.peekAll("similarity")}},afterModel:function(e){Array.isArray(e.similarity)&&(e.similarity=e.similarity[0]),e.whomModule=e.whomModule[0]?e.whomModule[0]:e.whomModule,e.modules=e.modules.module.filter((function(e){return!0===e.presence_sub_menu&&!0===e.visible&&"linking"!==e.generated_type})),commonUtils.showHideLoadingDiv(!1)},renderTemplate:function(){return{outlet:"#recommendation",component:"crm-similarity-configure"}},actions:{onError:function(){Lyte.Router.transitionTo("crm.settings.section.zia.similarity.error",null).data={errorMsg:I18n.getMsg("zia.similarity.error.message")}},willTransition:function(e){window.drp=void 0,"crm.settings.section.zia.similarity.edit"===e.target||"update"===this.component.component.data.currentButtonClick&&"crm.settings.section.zia.similarity.view"===e.target||!0===this.component.component.data.isConfigModified&&Lyte.registeredMixins["similarity-utils"].routeChangeConfirm(e,this)}}},{mixins:["similarity-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.similarity.error",{model:function(){var e,t=Lyte.Router.getRouteInstance().transition.data.errorMsg;return void 0!==t&&(e=I18n.getMsg(t)),{errorMsg:e}},renderTemplate:function(){return{outlet:"#recommendation",component:"crm-zia-error"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.similarity.list",{queryParams:[{type:{refreshModel:!1,sticky:!1}}],getResources:function(){return networkUtils.returnDependencyFiles(["recommendation-similarity-list.js"],crmConstants.jsStaticPathForLyte)},model:function(){return{featureLimit:ZiaConfig.similarityFeatureLimit,isManageProfile:!0===Crm.userDetails.permissions.Crm_Implied_Manage_Similarity}},renderTemplate:function(){return{outlet:"#recommendation",component:"crm-similarity-list"}},actions:{onError:function(e,t){"NO_PERMISSION"===JSON.parse(e.response).code&&(t.resume(),renderingUtils.displayPermissionDenied())}}}),Lyte.Router.registerRoute("crm.settings.section.zia.similarity.view",{getResources:function(){var e=networkUtils.returnDependencyFiles(["recommendation-similarity-detailed.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["zia-error.js"],crmConstants.jsStaticPathForLyte);return e.concat(t)},model:function(e){commonUtils.showHideLoadingDiv(!0);var t=store.findRecord("similarity",e.dynamicParam);return{similarity:t,module:t.then((function(e){return store.findRecord("module",e[0].module.id)}))}},afterModel:function(e){e.similarity=e.similarity[0],e.module=e.module[0],commonUtils.showHideLoadingDiv(!1)},renderTemplate:function(){return{outlet:"#recommendation",component:"crm-similarity-detailedview"}},actions:{onError:function(){Lyte.Router.transitionTo("crm.settings.section.zia.similarity.error",null).data={errorMsg:I18n.getMsg("zia.similarity.error.message")}}}}),Lyte.Router.registerRoute("crm.settings.section.zia.inemailnew",{getResources:function(){var e=networkUtils.returnDependencyFiles(["ziainemail.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-email-intelligence.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles(["crm-email-intelligence.css"],crmConstants.lessStaticPathForLyte),i=t.concat(r),a=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ziaemail")],crmConstants.jsStaticPath);return e.concat(a).concat(i)},model:function(){return networkUtils.lyteInitiateRequest("/crm/v2/setup/zia/config","GET",{params:{isOrgConfig:!0,isCommunication:!0}})},renderTemplate:function(e){var t=ZiaConfig.updateIsAllEnabled(e.configs),r=Handlebars.templates.ZiaConfigList({data:t,isCommunication:!0});return 1===e.configs[0].no_of_configs?{outlet:"#result",html:r}:{outlet:"#result",component:"crm-email-intelligence",configs:e.configs[0].configs,reRender:!0}},actions:{onError:function(){crmui.showMsgBand("failure",I18n.getMsg("crm.zia.config.not.saved"),1500)}}}),Lyte.Router.registerRoute("crm.settings.section.zia.vision.create",{model:function(e){commonUtils.showHideLoadingDiv(!0),e.visionsArr=store.peekAll("visions"),e.availableNames=this.getAvailableNames(),e.maxLimit=this.parent.currentModel.maxLimit,e.editClass="";var t=[];e.visions=store.peekRecord("visions",this.transition.data[0]);var r=[];return e.saveDisable=!1,void 0===e.visions?(e.visions=store.createRecord("visions",{}),e.visions.desired_set=[],e.visions.undesired_set=[],r=this.getModules(!0,!1),e.criteriaShowClass="op08 eventNone"):void 0!==e.visions.vision_module?(e.cruxModuleId=e.visions.vision_module.id,r=this.getModules(!0,!1,e.cruxModuleId),e.selectedField=e.visions.vision_fields.id,(t=[]).push(e.visions.vision_fields),e.criteriaShowClass=""):(r=this.getModules(!0,!1),e.criteriaShowClass="op08 eventNone"),e.modules=r,e.visions.undesired_set||(e.visions.undesired_set=[]),e.visions.desired_set||(e.visions.desired_set=[]),e.galTagUsed=!1,e.is_gallery_selected=!1,e.is_desktop_selected=!1,e.fields=t,e.module="",e.existing_fields=t,e.isView=!0,e.isEdit=!1,e.desiredFilesObjGal=[],e.type="",e.do_not_create_selected_default=!0,e.deploymentLocation=RebrandLinkUtil.getProperty("DeploymentLocation"),e},beforeExit:function(e){var t=store.peekRecord("visions",e.visions.id);t&&(delete t.training_details,delete t.undesired_set,delete t.desired_set)},renderTemplate:function(){return{outlet:"#result",component:"crm-ziavision-creationpage"}},afterRender:function(e){commonUtils.showHideLoadingDiv(!1);var t=$L("#vision_creation_page")[0];void 0!==e.visions.action&&(t.setData(e.visions.action.key+"_class","visionFailActItm_slctd"),$L(".visionFailActItm_slctd").trigger("click"));var r=this;if(!validationUtils.isEmpty(e.visions.criteria)){t.setData("criteriaShowClass",""),$L("#criteriaCheckButton").trigger("click");var i=$("#visionCruxCriteriaEditor");i.hide();var a=store.peekRecord("module",e.visions.vision_module.id).fields;function s(a){i.children().remove(),Lyte.Component.render("crux-criteria-editor",{id:"visionCruxCriteriaEditorComp",cxPropModule:e.visions.vision_module.module_name,cxPropFields:a,cxPropApiFormat:"new","cx-prop-appearance":"box"},"#visionCruxCriteriaEditor");var s=document.querySelector("#visionCruxCriteriaEditorComp");s.component.setCriteria(e.visions.criteria),r.setCriteriaMethods(s,t),i.show(),void 0!==s.setWidth&&s.setWidth()}a?s(JSON.parse(JSON.stringify(a.map((e=>e.$.toJSON()))))):this.getAllFields(e.visions.vision_module.id,e.visions.vision_module.api_name,s)}t.setData("saveDisable",!1),void 0!==e.visions.vision_fields&&(document.querySelector("#fieldDropdown").ltProp("disabled",!1),this.component.component.data.isView=!0)},actions:{onError:function(e,t){this.commonErrorAlerts(e,t)},willTransition:function(e){this.nextTransitionCheck(e,this.currentModel.visions.id,!1)}}},{mixins:["crm-vision-create"]}),Lyte.Router.registerRoute("crm.settings.section.zia.vision.edit",{beforeModel:function(){return commonUtils.showHideLoadingDiv(!0),store.peekAll("visions"),this.getVision(this.getDynamicParam())},model:function(){var e={},t=this.getDynamicParam();if(e.maxLimit=this.parent.currentModel.maxLimit,e.visions=store.peekRecord("visions",t),!e.visions)return e;if(0==e.visions.model_score&&($L("crm-ziavision-viewpage")[0].component.setData("visionRuleName",e.visions.name),$L("#editVisionModal")[0].ltProp("show",!0),commonUtils.showHideLoadingDiv(!1),this.transition.abort()),e.deploymentLocation=RebrandLinkUtil.getProperty("DeploymentLocation"),e.visions.undesired_set){var r=e.visions.undesired_set;if(r&&r.labels)a(r.labels)}else e.visions.undesired_set={};if(e.visions.desired_set){var i=e.visions.desired_set;if(i&&i.labels)a(i.labels)}else e.visions.desired_set={};function a(t){for(var r=t.length,i=0;i<r;i++){var a=t[i].model_tags;if(a.length>0){"gallery"===a[i].type?(e.is_gallery_selected=!0,e.is_desktop_selected=!1,e.galTagUsed=!0):(e.is_gallery_selected=!1,e.is_desktop_selected=!0);break}}}e.saveDisable=!0,(this.transition.data.approval_count>0||e.visions.approval_count>0)&&(e.editClass="creationPage_withEdit"),this.transition.data.approval_count>=0?e.fromSummary=!1:e.fromSummary=!0;var s=[],o=e.visions.desired_set;if(o&&o.labels&&(w=(d=o.labels).length)>0)for(var n=0;n<w;n++)for(var l=(p=(C=d[n]).model_tags).length,c=0;c<l;c++)s.push(p[c]);Lyte.Component.set(e.visions,"existingDesired_set",s);var d,u=[],m=e.visions.undesired_set;if(m&&m.labels&&(w=(d=m.labels).length)>0)for(n=0;n<w;n++){var p;for(l=(p=(C=d[n]).model_tags).length,c=0;c<l;c++)u.push(p[c])}Lyte.Component.set(e.visions,"existingUnDesired_set",u);var g=store.peekRecord("module",e.visions.vision_module.id),f=(g.fields,[]);e.cruxModuleId=e.visions.vision_module.id,e.layouts=e.visions.layout;var h=[];if(e.visions.layout&&(e.selectedLayout=e.visions.layout.id,h.push(e.visions.layout),e.layouts=h),!e.visions.layout){var y={id:"1"};y.name=I18n.getMsg("crm.zia.vision.layout.AllLayouts"),e.visions.layout=y,e.selectedLayout=y.id,h.push(y),e.layouts=h}if(f.push(e.visions.vision_fields),e.s_id=t,e.availableNames=this.getAvailableNames(e.visions.id),e.isEdit=!0,e.disableValidationType=!0,e.visions.validation_type){var v=this;if("object_detection"===e.visions.validation_type)e.objDetection=!0,e.imgValidation=!1,e.visions.label_details=[],e.visions.label_details=v.get_training_label_details(e.visions.training_details.pattern_criteria,e.visions.training_details.labels),e.textPattern=this.patternCriToTextPattern(e.visions.training_details.pattern_criteria,e.visions.training_details.labels),e.visions.is_gallery_selected=v.has_gallery_selected(e.visions.training_details.labels);else if("image_validation"===e.visions.validation_type){e.objDetection=!1,e.imgValidation=!0;var _=[],b=!0;if(e.visions.desired_set.labels&&e.visions.desired_set.labels.length>0?_=e.visions.desired_set.labels:e.visions.undesired_set.labels&&e.visions.undesired_set.labels.length>0&&(_=e.visions.undesired_set.labels,b=!1),e.criteriaTextPatternForMatch=this.labelsToTextPatternMatch(_,b),_&&_.length>0){e.visions.label_details=[];var w=_.length;for(n=0;n<w;n++){var C,D={},L=(C=_[n]).model_tags;D.labelName=C.name,D.apiName=C.api_name,D.labelId=C.id,D.tags=L,D.show_tags=!!(L&&L.length>0),Lyte.arrayUtils(e.visions.label_details,"push",D)}e.visions.is_gallery_selected=v.has_gallery_selected(_)}}}validationUtils.isEmpty(e.visions.criteria)||(e.criteriaSelected=!0),e.criteriaShowClass="";var R=this.getModules(!0,!1,e.cruxModuleId);switch(e.modules=R,e.fields=f,e.module=g.module_name,e.selectedFailureAction=e.visions.action.key,e.visions.action.key){case"do_not_create":e.do_not_create_selected=!0;break;case"record_approval":e.record_approval_selected=!0;break;case"image_approval":e.image_approval_selected=!0;break;case"create_without_image":e.create_without_image_selected=!0}return e.selectedField=e.visions.vision_fields.id,e.isView="false",e},beforeExit:function(e){var t=store.peekRecord("visions",e.visions.id);delete t.training_details,delete t.undesired_set,delete t.desired_set},afterModel:function(e){if(e.allVisions=store.peekAll("visions"),e.visions&&void 0===e.visions.approval_count)return store.triggerAction("visions","approval_count",{id:e.visions.id}).then((function(t){var r=t.vision_count;return r&&(Lyte.Component.set(e.visions,"approval_count",r[0].count),e.editClass="creationPage_withEdit"),e.visionId="",e}))},renderTemplate:function(e){return e.visions?{outlet:"#result",component:"crm-ziavision-creationpage"}:{component:"crm-zia-error",outlet:"#result"}},afterRender:function(e){commonUtils.showHideLoadingDiv(!1);var t=$L("#vision_creation_page")[0],r=!1;if(e.visions){var i=e.visions.$.getDirtyAttributes().length;if(e.visions.$.isModified&&(1===i&&"vision_fields"!=e.visions.$.getDirtyAttributes()[0]||i>1)&&(r=!0,t.setData("saveDisable",!1)),e.visions){var a=$L("#fieldDropdown")[0],s=$L("#moduleDropdown")[0],o=$L("#layoutDropdown")[0];a&&a.ltProp("disabled",!0),s&&s.ltProp("disabled",!0),o&&o.ltProp("disabled",!0)}if(this.component.component.data.isView=!0,e.visions&&!validationUtils.isEmpty(e.visions.criteria)){var n=this;var l=e.visions.vision_module.id;this.getAllFields(l,e.visions.vision_module.api_name,(function(i){$L("#criteriaCheckButton").trigger("click"),t.getData("saveDisable")||r||t.setData("saveDisable",!0);var a=$("#visionCruxCriteriaEditor");a.hide(),a.children().remove(),Lyte.Component.render("crux-criteria-editor",{id:"visionCruxCriteriaEditorComp",cxPropModule:e.visions.vision_module.module_name,cxPropFields:i,cxPropApiFormat:"new"},"#visionCruxCriteriaEditor");var s=document.querySelector("#visionCruxCriteriaEditorComp");s.component.setCriteria(e.visions.criteria),t.setData("selectedRecordsCriteria",s.component.getCriteria()),n.setCriteriaMethods(s,t),a.show(),void 0!==s.setWidth&&s.setWidth()}))}if(e.visions.validation_type){var c=$L("crm-ziavision-trainingdetails-criteria")[0];if(c.setData("isEdit",e.isEdit),"image_validation"===e.visions.validation_type){c.setData("imgValidation",!0),c.setData("objDetection",!1),e.visions.desired_set.labels&&e.visions.desired_set.labels.length>0?(c.setData("desiredSelected",!0),c.setData("undesiredSelected",!1)):e.visions.undesired_set.labels&&e.visions.undesired_set.labels.length>0&&(c.setData("desiredSelected",!1),c.setData("undesiredSelected",!0));var d=this.deepCopyOfAnObject(e.visions.label_details);c.setData("image_validation_label_details",[]),d=w(d),Lyte.arrayUtils(c.getData("image_validation_label_details"),"push",d);for(var u=$L("crm-ziavision-trainingcriteria-header"),m=d.length,p=0;p<m;p++){for(var g=u[p].component,f=0,h=d[p].tags.length,y=0;y<h;y++)f+=d[p].tags[y].count;var v=[];(b={}).comparator=g.data.comparator,b.labelName=g.data.label_name,b.type=g.data.detected?"matched":"not matched",b.criteriaIndex=p+1,v.push(b),Lyte.arrayUtils(c.getData("criteriaArrayForMatch"),"push",v),g.setData("upload_total_count",f)}c.setData("criteriaTextPatternForMatch",e.criteriaTextPatternForMatch)}else{c.setData("imgValidation",!1),c.setData("objDetection",!0);var _=this.deepCopyOfAnObject(e.visions.label_details);c.setData("obj_detection_label_details",[]),_=w(_),Lyte.arrayUtils(c.getData("obj_detection_label_details"),"push",_);for(u=$L("crm-ziavision-trainingcriteria-header"),m=_.length,p=0;p<m;p++){for(g=u[p].component,f=0,h=_[p].tags.length,y=0;y<h;y++)f+=_[p].tags[y].count;var b;v=[];(b={}).comparator=g.data.comparator,b.labelName=g.data.label_name,b.type=g.data.detected?"detected":"not detected",b.criteriaIndex=p+1,v.push(b),Lyte.arrayUtils(c.getData("criteriaArray"),"push",v),g.setData("upload_total_count",f)}}function w(e){for(var t=e.length,r=0;r<t;r++)e[r].fileArrCount=e[r].tags.length;return e}c.setData("totalCriteria",e.visions.label_details.length),c.setData("is_gallery_selected",e.visions.is_gallery_selected),c.setData("criteriaTextPattern",e.textPattern)}}},actions:{onError:function(e,t){this.commonErrorAlerts(e,t)},willTransition:function(e){this.nextTransitionCheck(e,this.currentModel.visions.id,!0)}}},{mixins:["crm-vision-create","crm-vision-match-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.vision.image-validate",{queryParams:["from","visionId","detectionType","labelName"],beforeModel:function(){commonUtils.showHideLoadingDiv(!0);var e=this.getQueryParams().visionId;return store.peekRecord("visions",e)?void 0:store.findRecord("visions",e)},model:function(){var e={};if(Crm.client_tracking("Zia Vision Training DataSet View Page "),e.from=this.getQueryParams().from,"view"===e.from?e.isSummary=!0:e.isSummary=!1,e.selectedVisionId=this.getQueryParams().visionId,e.visions={},e.visions=store.peekRecord("visions",e.selectedVisionId),e.visions){"image_validation"===e.visions.validation_type?e.visionDisplayType="Match":"object_detection"===e.visions.validation_type&&(e.visionDisplayType="Detect",e.visions.labelName=this.getQueryParams().labelName),e.visions.undesired_set||(e.visions.undesired_set=[]),e.visions.desired_set||(e.visions.desired_set=[]),e.visions.undesired_set&&e.visions.undesired_set.labels&&e.visions.undesired_set.labels.length>0&&(e.visions.labelName=e.visions.undesired_set.labels[0].name),e.visions.desired_set&&e.visions.desired_set.labels&&e.visions.desired_set.labels.length>0&&(e.visions.labelName=e.visions.desired_set.labels[0].name),e.visions.detectionType=this.getQueryParams().detectionType;var t=this.getDynamicParam();["cars","food","bicycles","motorbikes"].indexOf(t)>-1&&(e.isSummary=!0),e.dynamicParam=t;var r=this.getDetails(t,"GET","1");return new Promise((function(t,i){$L.ajax({url:r.url,type:"GET",headers:r.headers,data:r.param,xhrFields:{withCredentials:!0},success:function(r){return e.validation={},e.validationImages=r.response,r.response.page_details.size<20?e.navigatorShow="displayNone":e.navigatorShow="",t(e)},error:function(){return renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.error.common.di")),i(e)}})}))}return e},renderTemplate:function(e){return e.visions?{outlet:"#result",component:"crm-ziavision-image-validationpage"}:{component:"crm-zia-error",outlet:"#result"}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)},actions:{onError:function(e,t){return 403===e.status?(renderingUtils.displayPermissionDenied(),t.abort(),!1):void renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.oops"))}}},{mixins:["crm-vision-validation"]}),Lyte.Router.registerRoute("crm.settings.section.zia.vision.index",{model:function(){return commonUtils.showHideLoadingDiv(!0),{visions:store.peekAll("visions")}},afterModel:function(e){var t=store.peekAll("visions");if(e.visions=t,e.visionLen=e.visions.length,e.visionLen<this.parent.currentModel.maxLimit?e.limitExceeded=!1:e.limitExceeded=!0,e.maxLimit=this.parent.currentModel.maxLimit,e.visionLen>0){e.showListview=!0;var r=[],i={id:"All"};i.plural_label=I18n.getMsg("crm.zia.vision.all"),r.push(i);for(var a=[],s=t.length,o=[],n=0;n<s;n++){var l=t[n].vision_module.module_name,c={};if(c.active=t[n].active,o[t[n].id]=c,-1===a.indexOf(l)){var d={};d.module_name=l,a.push(l),d.id=t[n].vision_module.id,d.api_name=t[n].vision_module.api_name,d.plural_label=t[n].vision_module.plural_label,r.push(d)}}e.modules=r,e.moduleFilterSel="All"}else e.showListview=!1;return e.status=[{plural_label:I18n.getMsg("crm.zia.vision.all.status"),id:"All"},{plural_label:I18n.getMsg("crm.zia.vision.active.status"),id:"active"},{plural_label:I18n.getMsg("crm.zia.vision.inactive.status"),id:"inactive"}],e.statusFilterSel="All",e.visionVsStatus=o,e},renderTemplate:function(){return{outlet:"#result",component:"crm-ziavision-viewpage"}},afterRender:function(e){if($L("crm-ziavision-viewpage")[0].component.setData("visionVsStatus",e.visionVsStatus),commonUtils.showHideLoadingDiv(!1),e.visionLen>0)return store.triggerAction("visions","approval_counts").then((function(t){for(var r=t.vision_count,i=e.visions,a=void 0!==r?r.length:0,s=void 0!==i?i.length:0,o=0;o<a;o++)for(var n=0;n<s;n++)r[o].id===i[n].id?Lyte.Component.set(i[n],"approval_count",r[o].count):i[n].approval_count||Lyte.Component.set(i[n],"approval_count",null);return e.visions=i,e.visionId="",e}))},actions:{onError:function(e,t){this.commonErrorAlerts(e,t)}}},{mixins:["crm-vision-create"]}),Lyte.Router.registerRoute("crm.settings.section.zia.vision.view",{beforeModel:function(){return commonUtils.showHideLoadingDiv(!0),this.getVision(this.getDynamicParam())},getResources:function(){var e=[];return e=e.concat(networkUtils.returnDependencyFiles(["crm-image-upload.js","crm-image-mixin.js","crm-image-preview.js","crm-image-upload-create.js","lyte-scrollTo.js","exif-plugin.js","lyte-cropper.js","lyte-colorbox.js"],crmConstants.jsStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-image-upload-rtl.css","crm-image-upload-ziaError.css"],crmConstants.cssStaticPathForLyte))),e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-image-upload.css","crm-image-preview.css","crm-image-upload-create.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("imageupload")]))},model:function(){var e={},t=this.getDynamicParam();if(e.viewVisions=store.peekRecord("visions",t),!e.viewVisions)return e;validationUtils.isEmpty(e.viewVisions.criteria)&&(e.viewVisions.criteria=null),e.summarydisplayMessage=I18n.getMsg("crm.zia.vision.model.fail.msg"),e.viewVisions.modified_on_date=Utils.getDateTimeInUserFormat(new Date(e.viewVisions.modified_time));var r={};if(r.id=Crm.userDetails.USER_ID,r.name=Crm.userDetails.DISPLAY_NAME,e.viewVisions.created_by||(e.viewVisions.created_by=r),e.viewVisions.modified_by||(e.viewVisions.modified_by=r),!e.viewVisions.layout){var i={id:"1"};i.name=I18n.getMsg("crm.zia.vision.layout.AllLayouts"),e.viewVisions.layout=i}var a=!1,s=[];if("object_detection"===e.viewVisions.validation_type){var o=e.viewVisions.training_details,n=o.labels;e.criteriaText=this.getTrainingLabelDetails(o.pattern_criteria,n),e.criteriaTextPattern=this.patternCriToTextPattern(o.pattern_criteria,n);var l=this.getDetectedAndNotDetectedLabels(e.criteriaText);e.detected_labels=l.detected_labels,e.notdetected_labels=l.notdetected_labels,e.viewVisions.visionDisplayType="Detect";for(var c=n.length,d=0;d<c;d++)if(null!==n[d]._delete)for(var u=(y=n[d].model_tags).length,m=0;m<u;m++)y[m].hasOwnProperty("_delete")||(a="gallery"===y[m].type,s.push(y[m].file_id))}var p=[];if("image_validation"===e.viewVisions.validation_type){n=[];var g=e.viewVisions.desired_set,f=e.viewVisions.undesired_set,h=!0;g&&g.labels&&g.labels.length>0&&(n=g.labels),f&&f.labels&&f.labels.length>0&&(n=f.labels,h=!1);for(c=n.length,d=0;d<c;d++)if(null!==n[d]._delete){var y;for(u=(y=n[d].model_tags).length,m=0;m<u;m++)y[m].hasOwnProperty("_delete")||(p.push(y[m]),a="gallery"===y[m].type,s.push(y[m].file_id))}e.viewVisions.visionDisplayType="Match"}e.criteriaTextPatternForMatch=this.labelsToTextPatternMatch(n,h),e.imgValModelTags=p,e.viewVisions.totalTagsIds=s,e.viewVisions.isGalleryUpload=a,e.viewVisions.failure_action.map((function(t){t.key===e.viewVisions.action.key&&(e.viewVisions.action.type=t.type)})),e.viewVisions.s_id=t;var v=store.peekRecord("module",e.viewVisions.vision_module.id).fields;if(!v){return store.findAll("field",{module:e.viewVisions.vision_module.api_name},void 0,void 0,{apiVersion:"2.2"}),this.getAllFields(e.viewVisions.vision_module.id,e.viewVisions.vision_module.api_name,(function(t){return e.viewVisions.fieldsArr=t,e}))}return e.viewVisions.fieldsArr=JSON.parse(JSON.stringify(v.map((e=>e.$.toJSON())))),e.viewVisions.$.set("vision_fields",e.viewVisions.vision_fields.id),e},afterModel:function(e){if(e.viewVisions&&void 0===e.viewVisions.approval_count)return store.triggerAction("visions","approval_count",{id:e.viewVisions.id}).then((function(t){var r=t.vision_count;return r&&Lyte.Component.set(e.viewVisions,"approval_count",r[0].count),e}))},renderTemplate:function(e){return e.viewVisions?{outlet:"#result",component:"crm-ziavision-summarypage"}:{component:"crm-zia-error",outlet:"#result"}},afterRender:function(e){commonUtils.showHideLoadingDiv(!1)},actions:{onError:function(e,t){return 403===e.status?renderingUtils.displayPermissionDenied(e):renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.oops")),t.abort(),!1}},getTrainingLabelDetails:function(e,t){var r=this.getTrainingDetails(e);return this.updateLabelName(r,t)},getTrainingDetails:function(e,t,r){if(void 0!==e){t||(t=[]);var i=e.group_operator;if(!i&&e.label)t.push(this.constructGroupObj(e,r));else{var a=e.group;a&&(this.getTrainingDetails(a[0],t,i),this.getTrainingDetails(a[1],t,i))}}return t},constructGroupObj:function(e,t){var r={};return r.comparator=t&&t.length>0?t.toLowerCase():"",r.labelId=e.label.id,r.type="${DETECTED}"===e.value?"detected":"not detected",r},updateLabelName:function(e,t){for(var r=e.length,i=t.length,a=0;a<r;a++)for(var s=0;s<i;s++)e[a].labelId!==t[s].id&&e[a].labelId!==t[s].reference_id||(r>=2&&a<r-1&&(e[a].comparator=e[a+1].comparator),e[a].model_tags=t[s].model_tags,e[a].labelName=t[s].name);return this.addParenthesisToCriteria(e)}},{mixins:["crm-vision-create","crm-vision-match-utils"]}),Lyte.Router.registerRoute("crm.settings.section.zia.zia-voice.create",{model:function(){return{configList:store.findAll("chatbot-config",{type:"all"})}},renderTemplate:function(){return{outlet:"#ziavoice_outlet",component:"crm-chatbot-config-create"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.zia-voice.edit",{model:function(){return{configList:0===store.peekAll("chatbot-config").length?store.findAll("chatbot-config",{type:"all"}):Promise.resolve(store.peekAll("chatbot-config"))}},afterModel:function(e){var t=this.getDynamicParam(),r=store.peekRecord("chatbot-config",t);if(void 0===r)throw new Exception("configId is invalid");e.configData=r,(void 0!==e.configData.filters&&e.configData.filters!==[]||void 0!==e.configData.cross_filters&&e.configData.cross_filters!==[])&&(e.smartFilterCheckbox=!0),void 0!==e.configData.criteria&&e.configData.criteria!==[]&&(e.isCriteriaEditorChecked=!0),void 0!==e.configData.push_info&&e.configData.push_info!==[]&&(e.pushComponentCheckbox=!0),e.isEdit=!0;var i=r.$.get("module"),a=this.getModuleNameFromApiName(i),s=moduleRecordMapping[a].$.get("id");return new Promise((function(e,t){Lyte.resolvePromises([store.findRecord("module",s,void 0,void 0,void 0,{getFields:!0})]).then((function(){e()}),(function(){t()}))}))},renderTemplate:function(){return{outlet:"#ziavoice_outlet",component:"crm-chatbot-config-create"}},actions:{onError:function(){commonUtils.showHideLoadingDiv(!1),$L("#result").html("");var e={errorMsg:I18n.getMsg("crm.chatbot.invlid.config.id")};return Lyte.Component.render("crm-zia-error",e,"#result"),$("body > div.dummy_Body").addClass("hide"),!1}}},{mixins:["crm-chatbot-config-util"]}),Lyte.Router.registerRoute("crm.settings.section.zia.zia-voice.index",{model:function(){return commonUtils.showHideLoadingDiv(!0),store.unloadAll("chatbot-config"),{configs:0===store.peekAll("chatbot-config").length?store.findAll("chatbot-config",{type:"all"}):Promise.resolve(store.peekAll("chatbot-config"))}},afterModel:function(e){return e.configs&&0!==Object.keys(e.configs).length||(e.no_data=!0),e.configs.sort((function(e,t){var r=e.$.get("createdtime"),i=$L.moment(r).toDate().getTime(),a=t.$.get("createdtime");return $L.moment(a).toDate().getTime()-i})),e.req_type="All",e},renderTemplate:function(e){return 0===e.configs.length?{component:"crm-chatbot-config-welcome-comp",outlet:"#ziavoice_outlet"}:{component:"crm-chatbot-config-list-view",outlet:"#ziavoice_outlet",reRender:!0}},afterRender:function(){commonUtils.showHideLoadingDiv(!1)}},{mixins:["crm-chatbot-config-util"]}),Lyte.Router.registerRoute("crm.settings.section.zia.zia-voice.view",{beforeModel:function(){return 0===store.peekAll("chatbot-config").length?store.findAll("chatbot-config"):null},model:function(){var e=this.getDynamicParam();return{skillDetails:store.peekRecord("chatbot-config",e)}},renderTemplate:function(){return{outlet:"#ziavoice_outlet",component:"crm-chatbot-skill-view"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.autosuggestion",{getDependencies:function(){return networkUtils.returnDependencyFiles(["autosuggestion-model.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaEmail")],crmConstants.jsStaticPath),t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ZiaNba")],crmConstants.jsStaticPath);return networkUtils.returnDependencyFiles(["crm-recommendation-autosuggestion.js"],crmConstants.jsStaticPathForLyte).concat(e).concat(t)},model:function(){return Lyte.resolvePromises({configs:store.findAll("autosuggestion",{isOrgConfig:!0,isRecommendation:!0})})},afterModel:function(e){return this.currentModel={isOrgConfig:!1,isRecommendation:!0,configs:e.configs}},renderTemplate:function(e){return{outlet:"#result",component:"crm-recommendation-autosuggestion"}},actions:{onError:function(){crmui.showMsgBand("error",I18n.getMsg("crm.zia.config.not.saved"),1500)}}}),Lyte.Router.registerRoute("crm.settings.section.zia.recommendation.create",{getResources:function(){var e=networkUtils.returnDependencyFiles(["recommendation-create.css"],crmConstants.cssStaticPathForLyte),t=networkUtils.returnDependencyFiles(["recommendation-create.js"],crmConstants.jsStaticPathForLyte);return e.concat(t)},model:function(){return commonUtils.showHideLoadingDiv(!0),{whatModuleList:Lyte.registeredMixins["recommendation-util"].getWhatModuleList()}},afterModel:function(e){return commonUtils.showHideLoadingDiv(!1),e},renderTemplate:function(){return{outlet:"#recommendation",component:"crm-recommendation-creation-section"}},actions:{onError:function(){Lyte.Router.transitionTo("crm.settings.section.zia.recommendation.index",{},null)},willTransition:function(e){if("crm.settings.section.zia.recommendation.view"!==e.target){var t=this.component.getData("name"),r=this.component.getData("whatId");if(t||r||this.component.getData("editView")){var i=e;i.pause();var a=$L("#deletePredictionModal")[0];void 0!==a&&(a.ltProp("trans",i),a.ltProp("show",!0))}}}}}),Lyte.Router.registerRoute("crm.settings.section.zia.recommendation.edit",{getResources:function(){var e=networkUtils.returnDependencyFiles(["recommendation-create.css"],crmConstants.cssStaticPathForLyte);return networkUtils.returnDependencyFiles(["recommendation-create.js"],crmConstants.jsStaticPathForLyte).concat(e)},beforeModel:function(e){commonUtils.showHideLoadingDiv(!0);var t=store.peekRecord("recommendations",e.dynamicParam);if(void 0!==t)return Lyte.registeredMixins["recommendation-util"].loadRecommendationModuleForEditAndView(this,t,!0)},model:function(e){return Lyte.registeredMixins["recommendation-util"].loadUnUseFieldForViewAndEdit(e.dynamicParam,!0)},afterModel:function(e){return Lyte.registeredMixins["recommendation-util"].modelLoaderForEdit(e)},renderTemplate:function(){return{outlet:"#recommendation",component:"crm-recommendation-creation-section"}},afterRender:function(e){$L(".link_btn").addClass("link_btn_edit").removeClass("link_btn"),commonUtils.showHideLoadingDiv(!1)},actions:{onError:function(){Lyte.Router.transitionTo("crm.settings.section.zia.recommendation.index",{},null)},willTransition:function(e){if("crm.settings.section.zia.recommendation.view"!==e.target){var t=$L("#deletePredictionModal")[0],r=$L("#saverecommendation")[0];if(void 0!==t&&void 0!==r&&!1===r.ltProp("disabled")){var i=e;i.pause(),t.ltProp("trans",i),t.ltProp("show",!0)}}}}}),Lyte.Router.registerRoute("crm.settings.section.zia.recommendation.error",{model:function(){var e,t=Lyte.Router.getRouteInstance().transition.data.errorMsg;return void 0!==t&&(e=I18n.getMsg(t)),{errorMsg:e}},renderTemplate:function(){return{outlet:"#recommendation",component:"crm-zia-error"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.recommendation.gallery",{model:function(){var e=store.peekAll("recommendations").map((function(e){return e.whom_module.id})),t=store.peekAll("recommendation_gallery"),r=[],i=[];if(void 0!==(t=t.filter((function(t){return!e.contains(t.whom_module.id)})))){var a={};t.map((function(e){a[e.what_module.api_name]=e.what_module.id})),Object.values(a).map((function(e){r.push(store.peekRecord("module",e))})),a={},t.map((function(e){a[e.whom_module.api_name]=e.whom_module.id})),Object.values(a).map((function(e){i.push(store.peekRecord("module",e))}))}return commonUtils.showHideLoadingDiv(!0),t=t.sort((function(e,t){return e.based_module.plural_label<=t.based_module.plural_label?-1:1})).sort((function(e,t){return e.whom_module.plural_label<=t.whom_module.plural_label?-1:1})).sort((function(e,t){return e.what_module.plural_label<=t.what_module.plural_label?-1:1})),r=r.sort((function(e,t){return e.plural_label<=t.plural_label?-1:1})),i=i.sort((function(e,t){return e.plural_label<=t.plural_label?-1:1})),{recommendationGallery:t,recommendationGalleryOrgArray:t,apiNameList:r,apiNameListWhom:i}},afterModel:function(e){return commonUtils.showHideLoadingDiv(!1),e},renderTemplate:function(){return{outlet:"#recommendation",component:"crm-recommendation-gallery-comp"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.recommendation.index",{queryParams:[{type:{refreshModel:!1,sticky:!1}}],getResources:function(){var e=networkUtils.returnDependencyFiles(["recommendation-list.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["recommendation-list.css"],crmConstants.cssStaticPathForLyte);return e.concat(t)},model:function(){var e=store.peekAll("recommendations"),t=e.sort((function(e,t){return new Date(e.created_time)-new Date(t.created_time)}));return{recommendationModuleArray:e,recommendationModuleArrayBySort:t,recommendationModuleArrayLen:e.length,profilename:Crm.userDetails.PROFILE_NAME,isManageProfile:void 0!==Crm.userDetails.permissions.Crm_Implied_Manage_Recommendation}},renderTemplate:function(){return{outlet:"#recommendation",component:"crm-recommendation-list"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.notification.recommendation",{getResources:function(){var e=networkUtils.returnDependencyFiles(["recommendation-notification-setup.css"],crmConstants.cssStaticPathForLyte),t=networkUtils.returnDependencyFiles(["recommendation-notification-setup.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("recommendation")],crmConstants.jsStaticPath);return t.concat(e).concat(r)},model:function(){commonUtils.showHideLoadingDiv(!0);var e={url:"/crm/v2.2/settings/zia/recommendations/actions/configure_notification"},t={include_inner_details:"recommendation_notifications.selected_records"},r=store.triggerAction("recommendations","configure_notification",e,t,"GET");return commonUtils.showHideLoadingDiv(!1),Lyte.resolvePromises(r)},afterModel:function(e){e.hasOwnProperty("recommendations")?this.currentModel={notificationSetup:e.recommendations}:this.currentModel={notificationSetup:null},Crm.client_tracking("Zia Recommendation NotificationSetup pageView")},renderTemplate:function(){return{component:"crm-recommendation-notification-setup",outlet:"#result"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.recommendation.view",{getResources:function(){var e=networkUtils.returnDependencyFiles(["recommendation-detailed.css"],crmConstants.cssStaticPathForLyte),t=networkUtils.returnDependencyFiles(["recommendation-detailed.js","orchestration_config.js","zia-helpers.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles(["zia-error.js"],crmConstants.jsStaticPathForLyte);return t.concat(e).concat(r)},beforeModel:function(e){commonUtils.showHideLoadingDiv(!0);var t=store.peekRecord("recommendations",e.dynamicParam);if(void 0!==t)return Lyte.registeredMixins["recommendation-util"].loadRecommendationModuleForEditAndView(this,t,!1)},model:function(e){return Lyte.registeredMixins["recommendation-util"].loadUnUseFieldForViewAndEdit(e.dynamicParam,!1)},afterModel:function(e){var t=e.recommendationJson;return e.what_fields=t.what_module.fields,e.whom_fields=t.whom_module.fields,e.based_fields=t.based_module.fields,e.profilename=Crm.userDetails.PROFILE_NAME,commonUtils.showHideLoadingDiv(!1),e},renderTemplate:function(){return{outlet:"#recommendation",component:"crm-recommendation-detailedview"}},actions:{onError:function(){Lyte.Router.transitionTo("crm.settings.section.zia.recommendation.error",null).data={errorMsg:"crm.recommendation.error.module.permissions"}}}}),Lyte.Router.registerRoute("crm.settings.section.zia.recommendation-analytics.error",{model:function(){var e,t=Lyte.Router.getRouteInstance().transition.data.errorMsg;return void 0!==t&&(e=I18n.getMsg(t)),{errorMsg:e}},renderTemplate:function(){return{outlet:"#result",component:"crm-zia-error"}}}),Lyte.Router.registerRoute("crm.settings.section.zia.recommendation-analytics.view",{renderTemplate:function(){return{outlet:"#result",component:"crm-recommendation-analytics-detailedview"}},model:function(e){return Lyte.resolvePromises({recommendationAnalyticRecord:"noData"===e.dynamicParam?void 0:store.peekRecord("recommendation_analytics_meta",e.dynamicParam)})},actions:{onError:function(){Lyte.Router.transitionTo("crm.settings.section.zia.recommendation-analytics.error",null).data={errorMsg:"crm.recommendation.error.module.permissions"}},willTransition:function(e){if("crm.settings.section.zia.recommendation-analytics.view"!==e.target){[".pieChartPlace",".recenttrendchart",".barchartanalyticsnew"].forEach((function(e){var t=$L(e);thirdPartyUtils.unbindHighcharts(t),thirdPartyUtils.unbindZohoCharts(t)})),window.drp=void 0}}}}),Lyte.Router.registerRoute("crm.global-search",{queryParams:["searchword","sModules","userOption"],didTransitionCalled:!1,model:function(e){var t=this.getQueryParams(),r={ajaxSearch:"true",searchword:t.searchword,searchCategory:"AllEntities",newModel:!0};return t.sModules?r.sModules=t.sModules:r.sModules="AllEntities",t.userOption&&(r.userOption=t.userOption),this.transition.data.selectedmodule?r.selectedmodule=this.transition.data.selectedmodule:r.selectedmodule="Home",networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/GSearch.do","POST",{params:r})},renderTemplate:function(e,t){return this.setTitle(I18n.getMsg("crm.title.general.revamped",I18n.getMsg(["crm.title.global.search.results",Crm.partnerName]))),{outlet:"#gsearchContainer",html:e}},afterRender:function(e,t){$("#gsearchparentdiv").addClass("searchOverlayAct fullSearchBg").css("display","block").show(),"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()&&"undefined"!=typeof CrmPlusLib&&($("#newgsearchouterdiv").hide(),$(".adSearchClose").hide(),$(".primarySearchList").hide(),this.didTransitionCalled&&!this.methods.isTransitionToSearch(app.prevTransition)||(CrmPlusImpl.trigger("searchView.onafterload"),this.didTransitionCalled=!0)),$initialVal=$("#searchStr").val(),$("#searchStr").val($initialVal+" "),$("#searchStr").val($initialVal),$("#searchStr").focus()},actions:{onBeforeLoad:function(){"undefined"!=typeof CrmPlusImpl&&this.methods.isTransitionToSearch(app.prevTransition)&&CrmPlusImpl.trigger("searchView.onbeforeload")},willTransition:function(e){"undefined"!=typeof CrmPlusImpl&&-1===e.target.indexOf("crm.global-search")&&CrmPlusImpl.trigger("searchView.onclose")}},methods:{isTransitionToSearch:function(e){return void 0===e||void 0===e.route||-1===e.route.indexOf("crm.global-search")}}}),Lyte.Router.registerRoute("crm.crm-calendar",{queryParams:["type","idStr","userFetchCnt","isTailLoadCall","pageNo","obtaineddate","tdWidthParam","module","searchword","searchCategory","calViewType","openCalPref"],getResources:function(){var e=[],t=networkUtils.returnDependencyFiles(["zohocrm_calendar_view.js","zohocrm_services.js"]).concat(networkUtils.returnDependencyFiles(["crm-user-eventtype.js","crm-event-picklist.js","lyte-colorpicker.js","businessHoursCommon.js","businessHoursmixin.js","services-businesshours.js","shift_hours_model.js","business_hours-model.js"],crmConstants.jsStaticPathForLyte)),r=networkUtils.returnDependencyFiles(["crm-user-eventtype.css","crm-picklist-colorpicker.css","crmbusinesshourswrapper.css"],crmConstants.cssStaticPathForLyte);e=(e=e.concat(t.concat(r))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")]));var i=networkUtils.getI18nJSUrl("serviceentitykeys");return e=e.concat(networkUtils.returnDependencyFiles([i]))},model:function(e){returnJson=void 0;var t=Crm.getCrmBasePath()+"/events/CalendarView.do",r=e.queryParams,i=this.transition.data;for(var a in i)r[a]=i[a];r.module=e.queryParams.sModule||"Events";var s={params:r},o=this;return store.unloadAll("servapp_preferences"),networkUtils.lyteInitiateRequest(t,"POST",s).then((function(e){return e}),(function(e){return i&&0!=Object.keys(i).length?(Lyte.Router.transitionTo(app.prevTransition).info.preservePopup=!0,void(crmHistory.handleAjaxErrorLyte=!0)):(o.error=!0,e.responseText)}))},renderTemplate:function(e,t){return{outlet:"#show",html:e}},beforeExit:function(){$("#calendarBd").fullCalendar("destroy")},afterRender:function(){if(this.error){var e=$L("crux-permission-denied-alert")[0];e&&e.getData("cxPropShow")&&comp.setData("cxPropShow",!1),hide("popupnew"),removeFreezeLayer(),document.getElementById("popupnew").style.zIndex=30,this.error=!1}}}),Lyte.Router.registerRoute("crm.tab",{queryParams:["newSignUp"],beforeModel:function(e){window.self!==window.top&&e&&e.queryParams&&e.queryParams.newSignUp&&(window.top.location=window.self.location)},model:function(){if(app.refetchModulesMeta)return app.refetchModulesMeta=!1,store.findAll("module",{include:"territory"})},actions:{didTransition:function(){var e,t=!1,r=document.querySelector("crm-tab");if(!Crm.isHeadless){var i="";if(r&&r.component.getData("selected")&&(i=r.component.getData("selected").module_name),-1!=this.transition.info.route.indexOf("crm.tab.module"))e=this.getRouteInstance("crm.tab.module").getDynamicParam();else{var a=this.transition.info.route.split(".")[2];e=a.charAt(0).toUpperCase()+a.slice(1)}("Zoho Books"==i||"Zoho Expense"==i||"Zoho Subscriptions"==i)&&e.indexOf("CustomModule")>-1&&(e=i,t=!0),"NewReports"===e&&(e=this.getRouteInstance("crm.tab.newReports.records")&&this.getRouteInstance("crm.tab.newReports.records").getQueryParams()&&"viewAppointments"===this.getRouteInstance("crm.tab.newReports.records").getQueryParams().action?"Appointments":"Reports"),"Reports"===e&&this.getRouteInstance("crm.tab.reports.records")&&this.getRouteInstance("crm.tab.reports.records").getQueryParams()&&"viewAppointments"===this.getRouteInstance("crm.tab.reports.records").getQueryParams().action&&(e="Appointments"),"Zohocpq"===e&&(e=moduleRecordMapping.ZohoCPQ.module_name),"Quotes"!==e&&"SalesOrders"!==e&&"PurchaseOrders"!==e&&"Invoices"!==e&&"Products"!==e&&"PriceBooks"!==e||(moduleRecordMapping.ZohoCPQ&&moduleRecordMapping[e].parent_module===moduleRecordMapping.ZohoCPQ&&i!==moduleRecordMapping.ZohoCPQ.module_name?e=moduleRecordMapping.ZohoCPQ.module_name:(e=moduleRecordMapping.ZohoCPQ&&moduleRecordMapping.ZohoCPQ.module_name===i&&e!==i?moduleRecordMapping.ZohoCPQ.module_name:e,r&&moduleRecordMapping[e]&&!t&&r.setData("selected",moduleRecordMapping[e]),t=!0)),"OneFeeds"==e&&(e="Feeds"),i==e||t||(r&&moduleRecordMapping[e]&&r.setData("selected",moduleRecordMapping[e]),crmplusImplTriggerActions("selectEntity",["module",e])),Crm.isHeadless||$("#mainMenuTabDiv").show()}}}}),Lyte.Router.registerRoute("crm.tab.approvals",{redirect:function(){if("crm.tab.approvals"===this.transition.target){var e=this.transition.data;this.replaceWith({route:"crm.tab.approvals.index"}).data=e}}}),Lyte.Router.registerRoute("crm.tab.dashboards",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-analytics.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["crm-analytics.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-analytics-rtl.css"],crmConstants.cssStaticPathForLyte))),e=e.concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles()))},actions:{onError:function(){crmHistory.handleAjaxErrorLyte=!0},didTransition:function(){var e=Crm.userDetails.MODULE_LIST.Dashboards,t=e&&e.modified_by?e.plural_label:I18n.getMsg("Dashboards");this.setTitle(I18n.getMsg("crm.title.general.revamped",[t,Crm.partnerName]))}},beforeExit:function(){var e=$("#show");thirdPartyUtils.unbindChildSelect2(e),thirdPartyUtils.unbindHighcharts(e),thirdPartyUtils.unbindZohoCharts(e)}}),Lyte.Router.registerRoute("crm.tab.forecasts",{getResources:function(){if(Crm.userDetails.isUserHierarchy)return networkUtils.returnDependencyFiles(["zohocrm_forecastTemplate.js"])},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},redirect:function(){if("crm.tab.forecasts"===this.transition.target){var e=this.transition.data;this.replaceWith({route:"crm.tab.forecasts.index"}).data=e}},actions:{willTransition:function(){Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser()||"function"!=typeof ZohoHCAsap||(removeViewPortFromAsapWidget(),ZohoHCAsap.UnInstall())}}}),Lyte.Router.registerRoute("crm.tab.google-adwords",{model:function(e){var t={module:"Google AdWords",isload:!0},r={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowDetails.do","GET",r)},renderTemplate:function(e,t){if(!validationUtils.isJson(e))return{outlet:"#show",html:e}},afterRender:function(e,t){this.setTitle(I18n.getMsg("crm.title.zohocrm",Crm.partnerName)),validationUtils.isJson(e)?e.adword_enabled&&"crm.tab.google-adwords"===this.transition.target&&this.transitionTo("crm.tab.google-adwords.adword-accounts"):"crm.tab.google-adwords"!==this.transition.target&&this.transition.abort()}}),Lyte.Router.registerRoute("crm.tab.marketplace",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-marketplace-promo.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-marketplace-promo.css"],crmConstants.cssStaticPathForLyte);return e.concat(t)},redirect:function(){if("undefined"!=typeof crmTab&&!crmTab.isMarketPlacePromoTab){if("undefined"!=typeof Crm&&Crm.userDetails&&"Administrator"!==Crm.userDetails.PROFILE_NAME)return void renderingUtils.displayPermissionDenied();Lyte.Router.transitionTo({route:"crm.tab.module.begin",dynamicParams:["Home"]})}},renderTemplate:function(){return{outlet:"#show",component:"crm-marketplace-promo"}},actions:{didTransition:function(){this.setTitle(I18n.getMsg("crm.title.zohocrm",Crm.partnerName))}}}),Lyte.Router.registerRoute("crm.tab.module",{queryParams:["sub_module"],forceFetch:function(){if(this.transition.info.queryParams.filters){var e=this.transition.info.queryParams,t=JSON.parse(e.filters);if(t[0]&&t[0].searchfield)return!1}return"crm.tab.module.custom-view.list"==this.transition.target||"crm.tab.module.custom-view.kanban"==this.transition.target||"crm.tab.module.custom-view.canvas"==this.transition.target||"crm.tab.module.custom-view.zia"==this.transition.target},getDependencies:function(){location.host.includes("zoho.in")&&"60010197171"===crmZgid&&(detailview_log.moduleDependency_start=performance.now());if(moduleRecordMapping.ZohoCPQ&&(this.getDynamicParam()===moduleRecordMapping.ZohoCPQ.module_name||crmTab.isZCpqTab(this.getDynamicParam())||crmTab.isZCpqSubTab(this.getDynamicParam())))return networkUtils.returnDependencyFiles(["cpq-helpers.js"],crmConstants.jsStaticPathForLyte).concat([])},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-macro.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-macro.css"],crmConstants.cssStaticPathForLyte),r=e.concat(t);if(r=r.concat(networkUtils.returnDependencyFiles(["zohocrm_module_settings_common.js","zohocrm_module_common.js","zohocrm_macro_common.js"])),moduleRecordMapping.ZohoCPQ&&(this.getDynamicParam()===moduleRecordMapping.ZohoCPQ.module_name||crmTab.isZCpqTab(this.getDynamicParam())||crmTab.isZCpqSubTab(this.getDynamicParam()))){var i=networkUtils.returnDependencyFiles(["zohocpq.js","lytecombobox.js","lyte-hovercard.js","zohocpq-tab.js"],crmConstants.jsStaticPathForLyte);i=(i=i.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("cpq")],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles(["zohocpq.css","zohocpq-tab.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(i=i.concat(networkUtils.returnDependencyFiles(["crm-cpq-rtl.css"],crmConstants.cssStaticPathForLyte))),r=r.concat(i)}if("Feeds"===this.getDynamicParam()){var a=networkUtils.returnDependencyFiles(["crm-activity-right-panel.js"],crmConstants.jsStaticPathForLyte),s=networkUtils.returnDependencyFiles(["crm-activity-right-panel.css"],crmConstants.cssStaticPathForLyte);r=r.concat(a.concat(s))}if(moduleRecordMapping.Services){var o=networkUtils.getI18nJSUrl("serviceentitykeys");r.push(networkUtils.returnDependencyFiles([o]))}if("Social"===this.getDynamicParam()){var n=networkUtils.returnDependencyFiles(["zohocrm_social.css"],crmConstants.cssStaticPath);r.push(n)}var l=networkUtils.getI18nJSUrl("LineItemSubformCRUD");return r.push(networkUtils.returnDependencyFiles([l],null)),location.host.includes("zoho.in")&&"60010197171"===crmZgid&&(detailview_log.resourceTime=Array.isArray(detailview_log.resourceTime)?detailview_log.resourceTime:[],detailview_log.getRes=Array.isArray(detailview_log.getRes)?detailview_log.getRes:[],detailview_log.getRes.push(r)),r},beforeModel:function(e){if(location.host.includes("zoho.in")&&"60010197171"===crmZgid&&(detailview_log.moduleDependency_end=performance.now(),detailview_log.moduleDependency_diff=detailview_log.moduleDependency_end-detailview_log.moduleDependency_start),!this.transition.data||!this.transition.data.reloadAll){if(Crm.isActivitySplitDone&&e.dynamicParam&&"Activities"===e.dynamicParam&&this.transition.target.indexOf("crm.tab.module.entity.detail")>-1){var t=moduleRecordMapping.Activities&&moduleRecordMapping.Activities.show_as_tab;if(!this.transition.data.fromActivityListView&&!this.transition.data.fromDetailView&&!t){var r=this.getQueryParams().sub_module;this.transitionTo("crm.tab.module.entity.detail",r,this.transition.info.dynamicParams[1])}}var i=this.getDynamicParam();if(null==moduleRecordMapping[e.dynamicParam]&&e.dynamicParam.indexOf("CustomModule")>-1){var a=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),s=window.location.pathname.split(a)[1];this.replaceWith("crm.crm-error",s).data={showError:!0,module:i,errorMsg:I18n.getMsg("module.not.available")}}else{if("JobSheets"===e.dynamicParam&&moduleRecordMapping.JobSheets&&"default"===moduleRecordMapping.JobSheets.generated_type){var o="/crm/"+crmPortal+"/tab/JobSheets";-1!==this.transition.url.search(o)&&(this.transition.abort(),crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied())}if("Zoho Books"==e.dynamicParam||crmTab.isZBCustomModule(e.dynamicParam)){if("Zoho Books"==e.dynamicParam)(u=Object.values(moduleRecordMapping).filter((function(e){return crmTab.isZBCustomModule(e.module_name)&&e.viewable})).sort((function(e,t){return e.sequence_number-t.sequence_number}))).length>0&&this.replaceWith("crm.tab.module",u[0].module_name);crmTab.isBooksIntegrated()&&($("#zbModuleTabLayer #tabActiveBarUl li").find("a").removeClass("activeLiList"),$("#"+e.dynamicParam).addClass("activeLiList"))}else if(!window.clientPortalName&&moduleRecordMapping.ZohoCPQ&&("ZohoCPQ"===e.dynamicParam||crmTab.isZCpqTab(e.dynamicParam)||crmTab.isZCpqSubTab(e.dynamicParam))){var n=Lyte.registeredMixins["crm-cpq-utils"].generateCPQTabs("1"),l=Lyte.registeredMixins["crm-cpq-utils"].generateCPQTabs("2"),c=e.dynamicParam;0===n.length&&(l.length>0?(n=l,l=[]):(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),this.transition.abort())),"ZohoCPQ"===e.dynamicParam&&this.replaceWith("crm.tab.module.index-module",n[0].module_name);var d={};d.cpqTabs=n,d.cpqTabSelected=c,d.cpqSubTabs=l,this.cpqObj=d}else if("Zoho Invoice"===e.dynamicParam||crmTab.isZInvoiceCustomModule(e.dynamicParam)){var u;if("Zoho Invoice"==e.dynamicParam)(u=Object.values(moduleRecordMapping).filter((function(e){return crmTab.isZBCustomModule(e.module_name)&&e.viewable})).sort((function(e,t){return e.sequence_number-t.sequence_number}))).length>0&&this.replaceWith("crm.tab.module",u[0].module_name);crmTab.isInvoiceIntegrated()&&($("#zInvoiceModuleTabLayer #tabActiveBarUl li").find("a").removeClass("activeLiList"),$("#"+e.dynamicParam).addClass("activeLiList"))}else if("Zoho Expense"===e.dynamicParam)this.replaceWith("crm.tab.module","CustomModule5006"),crmTab.isZExpenseSubModule(e.dynamicParam)&&($("#zohoExpenseTabLayer #tabActiveBarUl li").find("a").removeClass("activeLiList"),$("#"+e.dynamicParam.replace(" ","_")).addClass("activeLiList"));else if(e.dynamicParam.indexOf("Orchestration")>=0){var m=function(){var e=Lyte.registeredMixins.orchestration.fetchOrchestrationChildModules().sort((function(e,t){return e.sequence_number-t.sequence_number}));e.length>0&&Lyte.Router.getRouteInstance().transitionTo({route:"crm.tab.module",dynamicParams:[e[0].module_name]})};if(moduleRecordMapping[e.dynamicParam]){if("Orchestration"===e.dynamicParam)return void m();moduleRecordMapping[e.dynamicParam].orchestrationModule?this.replaceWith("crm.tab.module",moduleRecordMapping[e.dynamicParam].orchestrationModule):moduleRecordMapping.Orchestration.orchestrationModule=e.dynamicParam}else{var p=Lyte.Component.render("lyte-alert",{ltPropType:"info",ltPropButtonPosition:"center",ltPropSecondaryMessage:I18n.getMsg("orch.listview.deleted.info"),ltPropContentAlign:"center",ltPropShowCloseButton:!1,ltPropTop:"0px"},"body");p.setData("ltPropShow",!0),p.setMethods({onAccept:m}),this.transition.abort()}}else{if("Visits"==e.dynamicParam&&"undefined"==typeof CrmTracking)return delete moduleRecordMapping.Visits.cvid,delete moduleRecordMapping.Visits.custom_view,void this.replaceWith("crm.tab.module.index-module","Visits");if("Messages"===i&&(-1!=="crm.tab.module.custom-view.kanban".indexOf(this.transition.target)||-1!=="crm.tab.module.custom-view.canvas".indexOf(this.transition.target)))return void this.replaceWith("crm.tab.messages");if(this.transition.target.indexOf("crm.tab.module.custom-view")>-1&&("Home"==e.dynamicParam||"Reports"==e.dynamicParam||"Dashboards"==e.dynamicParam||"Forecasts"==e.dynamicParam||"Emails"==e.dynamicParam||"SalesInbox"==e.dynamicParam||"Projects"==e.dynamicParam||"ABM"==e.dynamicParam))return void("Home"==e.dynamicParam?this.replaceWith("crm.tab.module.begin",e.dynamicParam):this.replaceWith("crm.tab.module.index-module",e.dynamicParam))}crmTab.removeOrShowZBTabLayer(crmTab.isZBCustomModule(e.dynamicParam)&&crmTab.isBooksIntegrated()||"Zoho Books"==e.dynamicParam),crmTab.removeOrShowZInvoiceTabLayer(crmTab.isZBCustomModule(e.dynamicParam)&&crmTab.isInvoiceIntegrated()||"Zoho Invoice"==e.dynamicParam),crmTab.removeOrShowZExpenseTabLayer(crmTab.isZExpenseSubModule(e.dynamicParam)||"Zoho Expense"==e.dynamicParam)}}},model:function(e){return location.host.includes("zoho.in")&&"60010197171"===crmZgid&&(detailview_log.isGSearch=!1,detailview_log.xhrTiming=[]),"crm.global-search"===app.prevTransition.route&&"60010197171"===crmZgid&&location.host.includes("zoho.in")&&(detailview_log.logStartTime=(new Date).getTime(),detailview_log.module_start=performance.now(),detailview_log.isGSearch=!0),this.transition.data&&this.transition.data.reloadAll?{}:this.getModuleData(e.dynamicParam,this.transition.target)},redirect:function(e,t){if("crm.global-search"===app.prevTransition.route&&"60010197171"===crmZgid&&location.host.includes("zoho.in")&&(detailview_log.module_end=performance.now(),detailview_log.module_diff=detailview_log.module_end-detailview_log.module_start),!crmHistory.transitionError){(i=e.module_name)||(i=t.dynamicParam);var r,i=this.currentModel.module;if(crmTab.requiredPromoTabs.hasOwnProperty(t.dynamicParam)?"crm.tab.module.index-module"===this.transition.target&&this.replaceWith("crm.tab.module.promo",this.transition.info.dynamicParams[0],null):"crm.tab.module.promo"!==this.transition.target||moduleRecordMapping[t.dynamicParam]||(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied()),i){r=i.module_name;var a=this.transition.target;if(!Crm.userDetails.CLIENT_ACCOUNT||"crm.tab.module.custom-view.list"!=a&&"crm.tab.module.custom-view.canvas"!=a){if("crm.tab.approvals"!=this.transition.target&&"crm.tab.module.create"!=this.transition.target&&(!this.transition.response||!this.transition.response.isFromModuleInfo&&!this.transition.response.skipRedirect))if((("crm.tab.module"===this.transition.target||"crm.tab.module.begin"===this.transition.target)&&"Home"!==i.api_name||"crm.tab.module.index-module"===this.transition.target||(window.location.pathname.endsWith("custom-view")||window.location.pathname.endsWith("custom-view/"))&&"crm.tab.module.entity.detail"==this.transition.target)&&(i.cvid||i.custom_view)){i.cvid=i.cvid?i.cvid:i.custom_view.id;var s=crmTab.getFromCache(r),o={};s&&((s.filter_id||s.filterId)&&(o.filter_id=s.filter_id?s.filter_id:s.filterId),s.filters&&(o.filters=JSON.stringify(s.filters)),s.cross_filters&&(o.cross_filters=JSON.stringify(s.cross_filters))),i.kanban_view?this.replaceWith("crm.tab.module.custom-view.kanban",r,i.cvid,o):i.canvas_view?this.replaceWith("crm.tab.module.custom-view.canvas",r,i.cvid,i.viewid,o):i.zia_view?this.replaceWith("crm.tab.module.custom-view.zia",r,i.cvid,o):this.replaceWith("crm.tab.module.custom-view.list",r,i.cvid,o).data=this.transition.data}else"Home"==i.api_name&&"crm.tab.module.begin"!=this.transition.target||"crm.tab.module.promo"===this.transition.target?this.replaceWith("crm.tab.module.begin",r):i.cvid||i.custom_view||"Home"===i.api_name||"Reports"===i.api_name||"Dashboards"===i.api_name||"crm.tab.module.index-module"===this.transition.target||"crm.tab.module.entity.detail"==this.transition.target||(-1!=r.indexOf("/")&&(r=r.replace("/"," ")),this.replaceWith("crm.tab.module.index-module",r))}else"crm.tab.module.custom-view.list"==a&&i.canvas_view?this.replaceWith("crm.tab.module.custom-view.canvas",r,i.cvid,i.viewid):"crm.tab.module.custom-view.canvas"!=a||i.canvas_view||this.replaceWith("crm.tab.module.custom-view.list",r,i.cvid);"crm.tab.module.custom-view.canvas"!=this.transition.target||i.customized_view||(this.replaceWith("crm.tab.module.custom-view.list",r,i.cvid).data=this.transition.data)}var n=this.transition.data;if(n&&n.reloadAll){i=this.getDynamicParam();["crm.tab.module.index-module","crm.tab.module.custom-view.list","crm.tab.module.custom-view.zia","crm.tab.module.custom-view.kanban","crm.tab.module.custom-view.canvas"].contains(this.transition.target)&&(this.removeTotalCache(this.transition.info.dynamicParams[0],this.transition.info.dynamicParams[1]),delete n.reloadAll,n.refreshTemplate=!0,n.clearCache=!0,app.prevTransitionBeforeRefresh=app.prevTransition,this.refresh({refreshTemplate:!0}).data=n)}else-1==this.transition.target.indexOf("crm.tab.module.custom-view")||moduleRecordMapping[t.dynamicParam].crux_customViewAccessedModules||(n?n.refreshTemplate=!0:n={refreshTemplate:!0},this.refresh({refreshTemplate:!0}).data=n)}},afterRender:function(e){e.module&&this.setTitle(I18n.getMsg("crm.title.general.revamped",[e.module.plural_label,Crm.partnerName]));var t=this.getDynamicParam();this.postModuleDataFetch(t),this.cpqObj&&(this.currentModel.cpqObj=this.cpqObj)},actions:{onError:function(e,t){if(this.currentModel&&this.currentModel.status&&200!==this.currentModel.status&&201!==this.currentModel.status)return crmHistory.transitionError=!0,this.handleError(this.getDynamicParam()),!1},didTransition:function(){var e=document.querySelector("crm-tab");if(-1==["create","edit","detail","clone","canvas"].indexOf(this.getRouteInstance().routeName)){var t=this.getDynamicParam();"Home"==t?this.setTitle(I18n.getMsg("crm.title.show.home.revamped.dynamic",[Crm.appName])):crmTab.getDisplayName(t,!1)&&this.setTitle(I18n.getMsg("crm.title.general.revamped",[crmTab.getDisplayName(t,!1),Crm.partnerName]))}if(!Crm.isHeadless&&!e.querySelector(".lyteMenuItems .lyteItem.lyteMenuActive")&&e){var r=e.getData("selected"),i=e.getData("visibleTabs");r&&i.forEach((function(t){t.module_name===r.module_name&&e.querySelector(".lyteMenuItems div[data-value="+r.module_name+"]").classList.add("lyteMenuActive")}))}},willTransition:function(e){Notes.feedsContent="",Notes.feedCommentsContent="";var t=$L("#feed_status");t.length>0&&t.hasClass("lyteMentionsAdded")&&Notes.destroyMentionsComponent("feed_status");var r=Notes.mentionedCommentIds?Notes.mentionedCommentIds.length:0;if(r>0){for(var i=0;i<r-1;i++)Notes.destroyMentionsComponent(Notes.mentionedCommentIds[i]);Notes.mentionedCommentIds.length=0}}},beforeExit:function(e,t){Crm.ViewedCanvasState&&(Crm.ViewedCanvasState=void 0),crmTab.removeOrShowZBTabLayer(!1),crmTab.removeOrShowZInvoiceTabLayer(!1),crmTab.removeOrShowZExpenseTabLayer(!1)},handlePromo:function(e){return"Services"===e&&moduleRecordMapping.Appointments&&!moduleRecordMapping.Appointments.cvid&&this.initializeCvid("Appointments"),this.initializeCvid(e)},initializeCvid:function(e){return store.findAll("custom_view",{module:moduleRecordMapping[e].api_name}).then((function(t){return t&&(moduleRecordMapping[e].cvid=t.$.meta.default),{module:moduleRecordMapping[e]}}))},addLogger:function(e,t){var r={type:"custom event"};r.message=e,murphy.addCustomTracking(r),murphy.error(new Error(t))}},{mixins:["crm-view-utils"]}),Lyte.Router.registerRoute("crm.tab.newForecasts",{queryParams:["forecast_type","forecast_hierarchy","status"],getDependencies:function(){return networkUtils.returnDependencyFiles(["lyte-tree.js","crm-forecast-datastore.js","crm-forecast-config-store.js","org-model.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Forecasts")]);return e=e.concat(networkUtils.returnDependencyFiles(["crm-forecast-util.js","crm-canvasview.js"],crmConstants.jsStaticPathForLyte))},beforeModel:function(){return store.addField("user","Reporting_To",Lyte.belongsTo("user",{inverse:"Reporting_To"})),Lyte.resolvePromises({fc_rec:store.findAll("forecast_configuration"),deal:app.store.makeRequest("findRecord","module",moduleRecordMapping.Deals.id,{},!0,void 0,{getFields:!0}),custom_view:store.findAll("custom_view",{module:moduleApiMapping.Deals},!0,!0)})},model:function(){if(crmHistory.transitionError&&this.currentModel)return this.currentModel;var e,t,r=store.peekAll("forecast_configuration")[0];moduleRecordMapping.Deals&&(e=store.findAll("field",{module:"Deals",type:"all"},void 0,!0,{apiVersion:"2.2"}));var i=this.getQueryParams();r&&(t=i.status&&"archived"===i.status?i.forecast_hierarchy?this.fetchHierarchyInfo(this.FORECAST_HIERARCHY_PICKLIST_VALUE_MAP[i.forecast_hierarchy].apiname,!1):this.fetchHierarchyInfo(void 0,!0):this.fetchHierarchyInfo());var a,s,o=this.transition.info;if("crm.tab.newForecasts.create"===o.route){var n=o.queryParams.group_id;a=(a=n?store.peekRecord("forecast_group",n):void 0)||(n?app.store.makeRequest("findRecord","forecast_group",n,{},!0):void 0),s=app.store.makeRequest("findAll","Forecast",{},!0)}r=store.peekAll("forecast_configuration")[0];return Lyte.resolvePromises({forecasts:s,hierarchy:t,forecast_group:a,criteria_fields:e,deletedItems:r?this.fetchDeletedItems(crmConstants.forecastHierarchyObj[r.hierarchy.api_name]):[]}).then((function(e){return e.hierarchy&&(e.hierarchyIds=e.hierarchy.IdData.hierarchyIds,e.hierarchy=e.hierarchy.hierarchy),e.criteria_fields&&(e.criteria_fields=e.criteria_fields.field),e}))},redirect:function(){if(crmHistory.transitionError)this.handleError(this.currentModel);else{var e=this.transition.data;e&&e.fromCreate&&(this.refreshModel=!0),app.prevTransition.route&&"crm.tab.newForecasts.view"===this.transition.target&&!this.refreshModel&&(this.refreshModel=!0,this.refresh().data=e),e&&e.reloadAll&&(delete e.reloadAll,e.refreshTemplate=!0,this.refresh({refreshTemplate:!0}).data=e)}},actions:{onError:function(e,t){if(this.currentModel=e,crmHistory.transitionError=!0,e&&e.status&&400===e.status&&e.response){var r=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),i=window.location.pathname.split(r)[1];this.replaceWith("crm.crm-error",i).data={showError:!0,errorMsg:I18n.getMsg("crm.forecast.not.available")}}t.resume()},didTransition:function(){delete this.refreshModel,this.setTitle(I18n.getMsg("crm.title.general.revamped",[crmTab.getDisplayName("Forecasts",!1),Crm.partnerName]))}},beforeExit:function(){store.clearCachedQuery("role"),store.clearCachedQuery("org"),store.clearCachedQuery("user"),store.addField("user","Reporting_To","object"),setTimeout((function(){store.unloadAll("territory"),store.unloadAll("role");var e=store.peekRecord("user",Crm.userDetails.USER_ID).$.toJSON();store.unloadAll("user"),store.pushPayload("user",e)}),1e3)}},{mixins:["crm-forecast-util"]}),Lyte.Router.registerRoute("crm.tab.newReports",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-report.js","lyte-sticky.js","lyte-scrollTo.js","crux-tag.js","crm-report-edit-page.js","crm-report-view-page.js","crm-report-table.js","lyte-tree.js","lyte-carousel.js","lyte-hovercard.js"],crmConstants.jsStaticPathForLyte);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reports")]))).concat(networkUtils.returnDependencyFiles(["crm-report.css","crm-report-edit-page.css","crm-report-view-page.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-report-popup.css"],crmConstants.lessStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-reports-revamp-rtl.css"],crmConstants.cssStaticPathForLyte))),e=e.concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles()))},getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-report-dependencies.js","child_relationship_model.js"],crmConstants.jsStaticPathForLyte)},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},beforeExit:function(){for(var e in store.unloadAll("field"),store.unloadAll("report_folder"),store.unloadAll("report_chart"),store.unloadAll("dashboard"),store.unloadAll("child_relationship"),store.unloadAll("scheduled_report"),moduleRecordMapping)this.removeTotalCache(e,moduleRecordMapping[e].cvid);delete moduleRecordMapping.Reports.query_params},renderTemplate:function(){return networkUtils.initChart(),{outlet:"#show",html:'<div id="sample"><div>'}},didDestroy:function(){store.unloadAll("report"),-1===Lyte.Router.getRouteInstance().transition.info.route.indexOf("newReports")&&(Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-report.css"],crmConstants.jsStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-reports-revamp-rtl.css"],crmConstants.cssStaticPathForLyte)))},actions:{didTransition:function(){"viewAppointments"===Lyte.Router.getRouteInstance().getQueryParams().action?this.setTitle(I18n.getMsg("crm.title.general.revamped",[crmTab.getDisplayName("Appointments",!1),Crm.partnerName])):this.setTitle(I18n.getMsg("crm.title.general.revamped",[crmTab.getDisplayName("Reports",!1),Crm.partnerName]))}}},{mixins:["crm-view-utils"]}),Lyte.Router.registerRoute("crm.tab.projects",{queryParams:["projectId"],model:function(e){var t={module:"Projects",isload:!0};e.queryParams.projectId&&(t.projId=e.queryParams.projectId,t.tabToShow="dashboard");var r={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowDetails.do","GET",r)},renderTemplate:function(e,t){return{outlet:"#show",html:e}},actions:{didTransition:function(){this.setTitle(I18n.getMsg("crm.title.zohocrm",Crm.partnerName))}}}),Lyte.Router.registerRoute("crm.tab.reports",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-report-dependencies.js","crm-report.js","crm-folder-sharing.js","lyte-carousel.js","lyte-hovercard.js"],crmConstants.jsStaticPathForLyte);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-report.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-report-popup.css"],crmConstants.lessStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reports")])),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-reports-revamp-rtl.css"],crmConstants.cssStaticPathForLyte))),e},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},redirect:function(){"crm.tab.reports"==this.transition.info.route&&this.replaceWith("crm.tab.reports.index")},actions:{didTransition:function(){"viewAppointments"===Lyte.Router.getRouteInstance().getQueryParams().action?this.setTitle(I18n.getMsg("crm.title.general.revamped",[crmTab.getDisplayName("Appointments",!1),Crm.partnerName])):this.setTitle(I18n.getMsg("crm.title.general.revamped",[crmTab.getDisplayName("Reports",!1),Crm.partnerName]))},willTransition:function(){crmReports.selectedModules=[],crmReports.selectedCount=0}}}),Lyte.Router.registerRoute("crm.tab.voc",{getDependencies:function(){return networkUtils.returnDependencyFiles(["voc-store.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["voc.js","crux-tag.js"],crmConstants.jsStaticPathForLyte);e=e.concat(networkUtils.returnDependencyFiles(["highcharts.js","zohocrm_chart.js"]));var t=networkUtils.returnDependencyFiles(["voc.css"],crmConstants.lessStaticPathForLyte);return e.concat(t).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("voc")]))},model:function(){return{dashboardData:store.findAll("voc_analytic")}},renderTemplate:function(){return{outlet:"#show",component:"crm-voc-module-container"}},afterRender:function(){this.setTitle(I18n.getMsg("crm.inv.mail.time.two.days.subject",[I18n.getMsg("crm.setup.system.voc"),Crm.appName])),document.getElementsByTagName("crm-tab")[0].setData("selected",moduleRecordMapping["Voice Of Customer"])},beforeExit:function(){store.unloadAll("voc_analytic"),store.unloadAll("voc_source"),store.unloadAll("dummy"),window.drp=void 0},redirect:function(){"crm.tab.voc"===this.transition.target&&this.replaceWith("crm.tab.voc.analytics")},actions:{onError:function(){if(this.currentModel&&this.currentModel.status&&200!==this.currentModel.status&&201!==this.currentModel.status)return crmHistory.transitionError=!0,this.handleError(this.getDynamicParam()),!1}}},{mixins:["crm-view-utils"]}),Lyte.Router.registerRoute("crm.tab.approvals.index",{queryParams:["is_others_view","process_opt"],getResources:function(){return networkUtils.returnDependencyFiles(["crm-reviewprocess-jobs.js","lyte-dateselect.js","lyte-daterangepicker.js"],crmConstants.jsStaticPathForLyte)},getDependencies:function(){var e,t=networkUtils.returnDependencyFiles(["crm-reviewprocess-jobs-model.js","crm-ziavision-myjobs.js","crm-image-mixin.js","crm-image-preview.js","crm-vision-helper.js","exif-plugin.js","lyte-colorbox.js"],crmConstants.jsStaticPathForLyte);return t=t.concat(networkUtils.returnDependencyFiles(["crux-tag.js"],crmConstants.jsStaticPathForLyte)),e=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-reviewprocess-rtl.css","crm-reviewprocess-style-wrapper.css","crm-review-logs.css","crm-myjobs.css","crm-approval-myjobs-rtl.css","crm-approval-myjobs.css","crm-ziavision-myjobs.css","crm-zia-error.css","crm-ziavision-myjobs-rtl.css","crm-image-preview.css"],crmConstants.cssStaticPathForLyte):networkUtils.returnDependencyFiles(["crm-reviewprocess-customfunction.css","function-common.css","custom-function-editor.css","crm-reviewprocess-style-wrapper.css","crm-review-logs.css","crm-myjobs.css","crm-approval-myjobs.css","crm-ziavision-myjobs.css","crm-image-preview.css","crm-zia-error.css"],crmConstants.cssStaticPathForLyte),t.concat(e).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reviewprocess"),networkUtils.getI18nJSUrl("ziavision")]))},model:function(e){var t,r=10;if(this.transition.data&&Object.keys(this.transition.data).length>0){var i=this.transition.data;i&&(i.process_count&&i.approval_count&&i.review_count&&i.imageValidation_count&&((t={}).review_process=i.review_count,t.approval=i.approval_count,t.process=i.process_count,i.imageValidation_count&&"undefined"!==i.imageValidation_count&&(t.image_validation=i.imageValidation_count),i.others_awaiting&&"undefined"!==i.others_awaiting&&(t.others_awaiting=i.others_awaiting)),r=i.recordPerPage?i.recordPerPage:r)}var a=e.queryParams;return t||(t=store.triggerAction("Approval","features_count",void 0,void 0,"GET",!1).then((function(e){for(var t=e.features_count,r=t.length,i={},a=0;a<r;a++)i[t[a].name]=t[a].count;return e.jobs_count=i,e.jobs_count.id||(e.jobs_count.id="123"),i})).catch((function(e){var t=JSON.parse(e.responseText);"NO_PERMISSION"===t.code||"PERMISSION_DENIED"===t.code||"INVALID_MODULE"===t.code?renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")):renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("error.database.problem"))}))),a&&(a.process_opt||void 0!==a.is_others_view)&&"ReviewProcess"!==a.process_opt&&"ImageValidation"!==a.process_opt?Lyte.resolvePromises({jobs_count:t,is_others_view:a.is_others_view,process_opt:a.process_opt,recordPerPage:r}):Lyte.resolvePromises({status:a.status,recordPerPage:r,jobs_count:t})},renderTemplate:function(e,t){if(this.currentModel.jobs_count){var r=t.queryParams;return"ImageValidation"===r.process_opt&&(e.process_opt=r.process_opt),{outlet:"#show",component:"crm-myjobs"}}},actions:{didTransition:function(){this.setTitle(I18n.getMsg("crm.title.zohocrm",Crm.partnerName))}}}),Lyte.Router.registerRoute("crm.tab.approvals.logs",{queryParams:["type"],getResources:function(){return networkUtils.returnDependencyFiles(["crm-reviewprocess-jobs.js","lyte-dateselect.js","lyte-daterangepicker.js"],crmConstants.jsStaticPathForLyte)},getDependencies:function(){var e,t=networkUtils.returnDependencyFiles(["crm-reviewprocess-jobs-model.js"],crmConstants.jsStaticPathForLyte);return e=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-reviewprocess-rtl.css","crm-approval-myjobs.css","crm-reviewprocess-style-wrapper.css","crm-review-logs.css"],crmConstants.cssStaticPathForLyte):networkUtils.returnDependencyFiles(["crm-reviewprocess-customfunction.css","function-common.css","custom-function-editor.css","crm-reviewprocess-style-wrapper.css","crm-review-logs.css"],crmConstants.cssStaticPathForLyte),t.concat(e).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reviewprocess")]))},model:function(e){var t=e.queryParams;if(t&&"review"===t.type){var r=networkUtils.lyteInitiateRequest("/crm/v2/Approvals/history/meta","GET",{params:{type:"review"}}),i=store.findAll("review-log",{action:"All Actions",type:"review",per_page:20});return Lyte.resolvePromises({logData:i,metaData:r})}return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowDetails.do","GET",{params:{module:"Approvals",action:"approvallog"}})},afterModel:function(e,t){var r=t.queryParams;if(r&&"review"===r.type){var i=e.metaData.data.modules;i.unshift({display_label:I18n.getMsg("crm.label.AllModules"),name:"All Entity"}),e.modules=i;var a=e.metaData.data.users;a.unshift({name:I18n.getMsg("crm.api.allusers"),id:"All Users"}),e.users=a,e.actions=e.metaData.data.actions,e.logData=store.peekAll("review-log"),delete e.metaData,e.type="review"}},renderTemplate:function(e,t){var r=t.queryParams;return r&&"review"===r.type?{outlet:"#show",component:"crm-review-logs"}:{outlet:"#show",html:e}},actions:{willTransition:function(){auditLog.clearFliter()}}}),Lyte.Router.registerRoute("crm.tab.approvals.view",{queryParams:["recModule","entityId","triggerAction"],model:function(e){var t=this.transition.data;return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/approvalProcess.do","POST",{params:{module:"Approvals",triggerAction:e.queryParams.triggerAction?e.queryParams.triggerAction:"",action:t.action?t.action:"showDetailedView",entityId:e.queryParams.entityId,isOthersView:!!t.isOthersView&&t.isOthersView,recModule:e.queryParams.recModule}})},renderTemplate:function(e){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.forecasts.create",{queryParams:["fcYear","fcQuarter","territoryId","roleId"],model:function(){var e=Crm.getCrmBasePath()+"/",t=this.getQueryParams();return 1===Crm.userDetails.TMENABLED||t.territoryId?e+="TerritoryForecast":e+="RoleForecast",t.roleId||t.territoryId?(e+=".do?action=setTarget&module=Forecasts&isload=true&fcYear="+t.fcYear+"&fcQuarter="+t.fcQuarter,t.roleId?e+="&roleId="+t.roleId:e+="&territoryId="+t.territoryId,networkUtils.lyteInitiateRequest(e)):networkUtils.lyteInitiateRequest(e+".do?action=createForecast&module=Forecasts&isload=true")},renderTemplate:function(e){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.forecasts.index",{queryParams:["mode","fcYear","fcQuarter","roleId","territoryId","ownerId"],getResources:function(){var e=[networkUtils.returnDependencyFiles(["crm-forecast-onboarding.js","crux-video.js"],crmConstants.jsStaticPathForLyte),networkUtils.returnDependencyFiles(["crm-forecast-onboarding.css"],crmConstants.cssStaticPathForLyte)];return Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-forecast-onboarding-RTL.css"],crmConstants.cssStaticPathForLyte))),e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ForecastOnboarding")]))},model:function(){if(this.transition.data&&this.transition.data.cachedResponse)return this.transition.data.cachedResponse;var e=this.getQueryParams();if("viewAll"===e.mode||"viewChild"===e.mode||"viewUser"===e.mode){e.module="Forecasts",e.isload=!0;var t="RoleForecast";return(e.territoryId||1===Crm.userDetails.TMENABLED)&&(t="TerritoryForecast"),e.action="viewForecast",networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/"+t+".do","GET",{params:e})}return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowDetails.do","GET",{params:{module:"Forecasts",isload:!0}})},renderTemplate:function(e){if("object"!=typeof e)return{outlet:"#show",html:e};loadForecastViewOrCreate(e)},actions:{onError:function(e){555===e.status&&(crmui.showMsgBand("info",I18n.getMsg("crm.forecast.enable.mail.sub"),4e3),Utils.windowLocationReload(!0))},didTransition:function(){store.findAll("dummy",void 0,!1,!1,{url:"crm/v2.2/Forecasts/actions/get_migration_requirements",method:"GET"}).then((function(e){if(e.data.isOnboardingMessageShown)if(Lyte.Component.render("crm-forecast-onboarding-popup",e.data,"#fconboardingcontent"),e.data.failureNotification)$L("#failureMessage")[0].ltProp("show",!0),store.findAll("dummy",{failureNotificationShown:!0},!1,!1,{url:"crm/v2.2/Forecasts/actions/set_onboarding_status",method:"POST"});else if(e.data.migrationStatus&&("SCHEDULED"===e.data.migrationStatus||"STARTED"===e.data.migrationStatus)){var t=$("#tabLayer").outerHeight();$L("body").addClass("oHImp"),$L("#fcNewVertionMoveLoadingWrap").css("top",t).removeClass("dN").addClass("dF")}}))}}}),Lyte.Router.registerRoute("crm.tab.forecasts.editSettings",{model:function(){var e="RoleForecast";return 1==Crm.userDetails.TMENABLED&&(e="TerritoryForecast"),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/"+e+".do","GET",{params:{module:"Forecasts",action:"editForecastSettings"}})},renderTemplate:function(e){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.forecasts.pipeline",{queryParams:["ownerId","isParent","closed","others","roleId","territoryId","fcYear","fcQuarter","parModule","rangeValue"],model:function(){var e=this.getQueryParams();return e.actiontype="viewPipeline",networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ViewPipeline.do","GET",{params:e})},renderTemplate:function(e){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.google-adwords.adword-accounts",{queryParams:["startDate","endDate"],model:function(e){var t={action:"accDesc"};e.queryParams.startDate&&(t.startDate=e.queryParams.startDate),e.queryParams.endDate&&(t.endDate=e.queryParams.endDate);var r={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/gadword.do","POST",r)},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.google-adwords.adword-metrics",{queryParams:["startDate","endDate"],model:function(e){var t={action:"reports",newModel:!0};return e.queryParams.startDate&&(t.startDate=e.queryParams.startDate),e.queryParams.endDate&&(t.endDate=e.queryParams.endDate),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/gadword.do","POST",{params:t})},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.google-adwords.adword-offline",{queryParams:["startDate","endDate"],model:function(e){var t={action:"offline",dateFilter:0,newModel:!0};return e.queryParams.startDate&&(t.startDate=e.queryParams.startDate),e.queryParams.endDate&&(t.endDate=e.queryParams.endDate),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/gadword.do","POST",{params:t})},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.google-adwords.adword-view",{queryParams:["accountId","campaignId","groupId","zgid","startDate","endDate"],model:function(e){var t={action:"accSummary"};return t.accId=e.queryParams.accountId,e.queryParams.campaignId&&(t.action="campSummary",t.campId=e.queryParams.campaignId),e.queryParams.groupId&&(t.action="groupSummary",t.gid=e.queryParams.groupId,t.zgid=e.queryParams.zgid),e.queryParams.startDate&&(t.startDate=e.queryParams.startDate),e.queryParams.endDate&&(t.endDate=e.queryParams.endDate),t.newModel=!0,networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/gadword.do","POST",{params:t})},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.messages.begin",{beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},renderTemplate:function(){return commonUtils.showHideLoadingDiv(!1),{outlet:"#show",component:"crm-msg-begin"}}}),Lyte.Router.registerRoute("crm.tab.messages.custom-view",{getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-msg-list-view.js","crm-customview-dropdown.js","crm-custom-filter.js","crux-smart-filter-input.js","crux-smart-filter.js","crm-customview-helpers.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-msg-utils.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-msg-list-view.css","crux-smart-filter.css","custom-view-layer.css","crm-customview-dropdown.css","crm-custom-filter.css"],crmConstants.cssStaticPathForLyte);Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-msg-rtl.css"],crmConstants.cssStaticPathForLyte)));var r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("bmlistview")],null);return e.concat(t).concat(r)},model:function(){var e=moduleRecordMapping.Messages,t={saved_filters:app.store.makeRequest("findAll","filter",{module:e.api_name,cvid:this.getDynamicParam()},!0,void 0,{cvid:this.getDynamicParam(),module:e.api_name}),custom_view_Info:app.store.makeRequest("findRecord","custom_view",this.getDynamicParam()+"",{module:"messages__s"}),fields:app.store.makeRequest("findAll","field",{module:"messages__s"},!1,!0,{apiVersion:"2.2"})};return Lyte.resolvePromises(t).then((function(e){return e}))},afterModel:function(e){var t=crmTab.getFromCache("Messages");this.cachedObj=t||{};var r=moduleRecordMapping.Messages;if(e.custom_view_Info){var i=this.getDynamicParam(),a=store.peekRecord("custom_view",i);a.sort_by||e.fields.forEach((function(e){"message_time__s"===e.api_name&&(a.$.set("sort_by",{id:e.id}),a.$.set("sort_order","desc"),store.triggerAction("custom_view","change_sort",{sort_by:a.sort_by,sort_order:a.sort_order,module:r.api_name,id:i}))}))}var s="Messages";this.currentModel.module=s,this.currentModel.module_name=s,this.currentModel.module_info=r,this.currentModel.cvid=this.currentModel.selectedCustomViewId=this.getDynamicParam(),this.currentModel.saved_filters=this.currentModel.saved_filters?this.currentModel.saved_filters:[]},renderTemplate:function(e){this.setDataBeforeRender(e,e.cvid,this.getRouteInstance().queryParams),app.renderTemplate(this,{outlet:"#show",component:"crm-msg-index"})},afterRender:function(e){"crm.tab.messages.custom-view"===this.transition.target&&this.transitionTo("crm.tab.messages.custom-view.list",e.selectedCustomViewId)},actions:{onError:function(){crmHistory.transitionError=!1;var e=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),t=window.location.pathname.split(e)[1],r=this.replaceWith("crm.crm-error",t);return commonUtils.showHideLoadingDiv(!1),crmTab.reloadTabMenu(),r.data={showError:!0,module:"Messages",errorMsg:I18n.getMsg("module.not.available")},!1}}},{mixins:["crm-view-utils"]}),Lyte.Router.registerRoute("crm.tab.messages.custom-view.list",{queryParams:["filters","sort_by","sort_order","page","per_page","filter_id","cross_filters"],model:function(){var e=this.parent.currentModel.selectedCustomViewId,t=store.peekRecord("custom_view",e),r=moduleRecordMapping.Messages,i={},a={},s=this.getQueryParams(),o=s.page&&s.page>=1?s.page:1,n=s.sort_by?s.sort_by:t.sort_by.id,l=s.sort_order?s.sort_order:t.sort_order,c=s.per_page;-1===[10,20,30,40,50,100,"10","20","30","40","50","100"].indexOf(c)&&(c=r.per_page),-1===["100",100].indexOf(c)||Crm.userDetails.ISPAID_USER||(c=50),i.page=a.page=o,i.per_page=a.per_page=c,i.sort_by=a.sort_by=n,i.sort_order=a.sort_order=l,i.cvid=a.selectedCustomViewId=e,i.module=a.module="Messages",s.filters&&(i.filters=a.filters=s.filters),s.cross_filters&&(i.cross_filters=a.cross_filters=s.cross_filters),s.filter_id&&(i.filter_id=a.filter_id=s.filter_id),this.transition.data.hasOwnProperty("fromNotification")&&(i.filters={group_operator:"AND",group:[{field:{api_name:"message_time__s",id:""},comparator:"less_equal",value:"${AGEINDAYS}+1"},{field:{api_name:"conversation_status__s",id:""},comparator:"not_equal",value:"Replied"}]}),a.start_index=0;var d=this.loadConversations(i,null,this.parent.currentModel.saved_filters),u=this;return Lyte.resolvePromises(d).then((function(t){if(t){var r=crmTab.getFromCache("Messages");r=r||{},a.conversations=t.messages,a.customview_records=t.messages,a.more_records=t.info.more_records,a.total_count=r.total_count?r.total_count:t.info.count,a.per_page=t.info.per_page,a.total_new_count=a.total_count||0===a.total_count?"###":a.total_count,u.constructNavigObject(e,a.conversations,"Messages",moduleRecordMapping.Messages.per_page)}return commonUtils.showHideLoadingDiv(!1),a}))},redirect:function(){crmHistory.transitionError&&this.handleError("Messages")},renderTemplate:function(e){var t=$L("#customFilter")[0].component.getCriteria(),r=document.querySelector("crm-custom-filter");!t.queryParams&&(e.filters||e.filter_id||e.cross_filters)&&r.setData("filterQueryParams",{filter_id:e.filter_id,filters:e.filters,cross_filters:e.cross_filters}),r.component.getData("preventUserAction",!1),r.component.preventUserAction=!1,app.renderTemplate(this,{outlet:"#msgListViewContainer",component:"crm-msg-list-view"})},actions:{onError:function(e){return this.currentModel=e,this.handleError("Messages"),!1}}},{mixins:["crm-msg-common","crm-view-utils"]}),Lyte.Router.registerRoute("crm.tab.messages",{beforeModel:function(){if(moduleRecordMapping.Messages)commonUtils.showHideLoadingDiv(!0),this.setTitle(I18n.getMsg("crm.title.general.revamped",[moduleRecordMapping.Messages.plural_label,Crm.partnerName]));else{var e=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),t=window.location.pathname.split(e)[1];this.replaceWith("crm.crm-error",t).data={showError:!0,module:"Messages",errorMsg:I18n.getMsg("module.not.available")}}},model:function(){var e={message_module:store.findRecord("module",moduleRecordMapping.Messages.id)};return store.model[moduleRecordMapping.Messages.id]||store.registerModel(moduleRecordMapping.Messages.id,{},{extends:"entity"}),Lyte.resolvePromises(e).then((function(e){return e}))},actions:{didTransition:function(){var e=$L("crm-tab");e&&(e[0].component.resizeMenu(),e.find(".lyteMenuActive").removeClass("lyteMenuActive"),e.find("[data-value*=Messages]").addClass("lyteMenuActive")),this.setTitle(I18n.getMsg("crm.title.general.revamped",[moduleRecordMapping.Messages.plural_label,Crm.partnerName]))}},redirect:function(){var e=moduleRecordMapping.Messages;if(e.visible&&e.viewable){if(this.transition.url.endsWith("Messages/")&&this.replaceWith("crm.tab.messages"),"crm.tab.messages"===this.transition.info.route){var t=crmTab.getFromCache("Messages");t&&(delete t.total_count,crmTab.putInCache("Messages",t)),this.replaceWith("crm.tab.messages.custom-view.list",moduleRecordMapping.Messages.cvid?moduleRecordMapping.Messages.cvid:moduleRecordMapping.Messages.custom_view.id)}}else crmHistory.handleAjaxErrorLyte=!0,crmHistory.doNotReload=!0,renderingUtils.displayPermissionDenied(),this.transition.abort()}}),Lyte.Router.registerRoute("crm.tab.messages.view",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-msg-utils.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-msg-detail-view.js","lyte-scrollTo.js"],crmConstants.jsStaticPathForLyte);t=t.concat(networkUtils.returnDependencyFiles(["zohocrm_module_settings_common.js"]));var r=networkUtils.returnDependencyFiles(["crm-msg-detail-view.css"],crmConstants.cssStaticPathForLyte);Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-msg-rtl.css"],crmConstants.cssStaticPathForLyte)));var i=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("bmdetailview")],null);return t.concat(r).concat(i).concat(e)},model:function(){var e;window.Messages={moduleName:"Messages",currentStatus:"view",entityId:this.transition.info.dynamicParams[0]},e=this.transition.data.cvid?this.transition.data.cvid:moduleRecordMapping.Messages.cvid,this.transition.data.recordNum&&(crmTab.getFromCache("Messages").recordNum=this.transition.data.recordNum);var t=store.peekRecord("custom_view",e),r={record:store.findRecord("immessage",this.transition.info.dynamicParams[0])};return t&&t.sort_by||(r.custom_view=store.findRecord("custom_view",e,{module:"messages__s"})),Lyte.resolvePromises(r).then((function(e){return e}))},afterModel:function(e){commonUtils.showHideLoadingDiv(!0),validationUtils.isEmpty(e.record)&&(this.currentModel.error=!0)},renderTemplate:function(e){if(renderingUtils.resizeWindowHW(),this.currentModel={selectedConversationId:this.transition.info.dynamicParams[0]},this.transition.data.cvid){var t=this.transition.data.cvid;this.currentModel.selectedCustomViewId=t}else this.currentModel.selectedCustomViewId=moduleRecordMapping.Messages.cvid;return this.currentModel.error=e.error,this.currentModel.showDetailView=!0,this.currentModel.showManageText=!1,commonUtils.showHideLoadingDiv(!1),{outlet:"#show",component:"crm-msg-detail-skeleton"}},actions:{onError:function(e){return commonUtils.showHideLoadingDiv(!1),this.currentModel=e,this.handleError("Messages"),!1}}},{mixins:["crm-view-utils"]}),Lyte.Router.registerRoute("crm.tab.newForecasts.bread-crum",{queryParams:["id","type","user_id","role_id","hierarchy_id","territory_id","filters","period","period_type","start_period","end_period"],forceFetch:!0,getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-forecast-list.js","crm-forecast-search.js","crm-forecast-create-popup.js","crm-forecast-deals-modal.js","crm-macro.js","crm-forecast-progress.js"],crmConstants.jsStaticPathForLyte);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-forecast-list.css","crm-forecast-create.css","crm-forecast-list-container.css","crm-forecast-common.css","crm-forecast-search-component.css","crm-forecast-deals-modal.css","crm-forecast-progress.css"],crmConstants.lessStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-macro.css"],crmConstants.cssStaticPathForLyte))},beforeModel:function(e){var t={},r=this,i={};t.filters=e.queryParams.filters?JSON.parse(e.queryParams.filters):e.queryParams.filters,e.queryParams.id&&(i={comparator:"equal",field:{api_name:"Group_Id"},value:e.queryParams.id},t.filters=this.construct_group(t.filters,i,"AND"));var a=e.queryParams.start_period,s=e.queryParams.end_period;i={},(a||s)&&(i=this.getCriteriaBetweenYear(a,s,!1,"Period_Name")),i=this.construct_group(i,{field:{api_name:"Period_Name.Type"},comparator:"equal",value:e.queryParams.period_type},"AND"),i=this.construct_group(i,{field:{api_name:"Is_Archived"},comparator:"equal",value:!1},"AND"),t.filters=this.construct_group(t.filters,i,"AND"),t.filters=JSON.stringify(t.filters),store.unloadAll("Forecast"),store.unloadAll("forecast_data");var o={};return o.fcGroup=app.store.makeRequest("findRecord","forecast_group",e.queryParams.id),o.forecast=app.store.makeRequest("findAll","Forecast",t),o.fiscalPeriod=store.findAll("fiscal_period",{},!0),e.queryParams.user_id&&(o.user=app.store.makeRequest("findRecord","user",e.queryParams.user_id)),Lyte.resolvePromises(o).then((function(e){r.transition.data.forecasts=e.forecast}),(function(e){if("INVALID_DATA"===(e=JSON.parse(e.response)).data[0].code){var t=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),i=window.location.pathname.split(t)[1];r.replaceWith("crm.crm-error",i).data={showError:!0,errorMsg:I18n.getMsg("crm.forecast.not.available")},r.transition.abort()}}))},model:function(e){var t=this,r=!0,i=store.peekAll("forecast_configuration")[0];store.unloadAll("forecast_data"),e.queryParams.user_id&&(r=!1);var a=this.getCriteriaBasedOnHierarchy(i.hierarchy,e.queryParams),s={};if(this.transition.data.associatedTerritories&&!a.searchValue.associatedTerritories&&(a.searchValue.associatedTerritories=this.transition.data.associatedTerritories),t.transition.data.forecasts&&t.transition.data.forecasts.length){var o={field:{api_name:"Forecast_Name.id"},comparator:"equal",value:this.getDataFromArray(t.transition.data.forecasts,"id")};a.criteria=this.construct_group(a.criteria,o,"AND"),a.criteria=JSON.stringify(a.criteria),this.predictionCriteria.field.api_name="Forecast_Quota."+this.predictionCriteria.field.api_name;var n=this.predictionCriteria;delete this.predictionCriteria,this.getPredictionData(this.construct_group(o,n,"AND")),s.forecast_data=app.store.makeRequest("findAll","forecast_data",{filters:a.criteria},!0)}var l={comparator:"equal",field:{api_name:"Type"},value:e.queryParams.period_type};if(this.currentYear=this.getPeriodMonthQuarter(!0),"MONTH"===e.queryParams.period_type)var c=this.getStartYear()+"-01-01",d=this.getEndYear()+"-12-31",u=this.getCriteriaBetweenYear(c,d,!1,"");else u=this.getCriteriaBetweenYear(this.currentYear.startdate,this.currentYear.enddate,!1,"");return l=this.construct_group(u,l,"AND"),s.period=app.store.makeRequest("findAll","fiscal_period",{filters:JSON.stringify(l)},!0),Lyte.resolvePromises(s).then((function(s){var o={baseForecast:store.peekRecord("forecast_group",e.queryParams.id),forecasts:t.transition.data.forecasts,forecastConfiguration:i,isAccordian:r,periodCriteria:s.period,selectedSearchvalue:a.searchValue};return s.period.$.meta.more_records?t.getFiscalPeriodRecursively(o,l):o}),(function(e){"NO_PERMISSION"===(e=JSON.parse(e.response)).code&&(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied()),this.transition.abort()}))},renderTemplate:function(){return{outlet:"#show",component:"crm-forecast-crum-component",reRender:!0}},afterModel:function(e){this.constructForecastData(e.forecasts);var t,r,i=Lyte.Router.getRouteInstance().getQueryParams();i.start_period&&i.end_period?(e.selectedPeriod={start_period:i.start_period,end_period:i.end_period,type:i.period_type,period:i.period},e.periodCriteria1=e.periodCriteria.filter((function(e){return e.End_Date>=i.start_period}))):(e.baseForecast.Forecast.forEach((function(e,i){0===i?(t=e.Period_Name.Start_Date,r=e.Period_Name.End_Date):(t=t>e.Period_Name.Start_Date?e.Period_Name.Start_Date:t,r=r<e.Period_Name.End_Date?e.Period_Name.End_Date:r)})),e.periodCriteria1=e.periodCriteria.filter((function(e){return e.End_Date>=t})),e.selectedPeriod={start_period:t,end_period:r,type:i.period_type,period:i.period})},lyteConvertionSupported:!0},{mixins:["crm-forecast-util"]}),Lyte.Router.registerRoute("crm.tab.newForecasts.clone",{queryParams:["Fiscal_Period"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-forecast-target.js","lyte-sticky.js","crm-forecast-search.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["crm-forecast-target.css","crm-forecast-create.css","crm-forecast-common.css"],crmConstants.lessStaticPathForLyte))},renderTemplate:function(){return{outlet:"#show",component:"crm-forecast-target"}},actions:{onError:function(e,t){t.resume()}},beforeModel:function(e){var t=e.queryParams;if(!e.queryParams.Fiscal_Period)return _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.errorpage.note1"),ltPropType:"error"}}),void this.replaceWith("crm.tab.newForecasts.index");var r=store.peekRecord("user",Crm.userDetails.USER_ID);this.admin_user=this.checkisAdminUser(r);var i={field:{api_name:"id"},comparator:"equal",value:JSON.parse(t.Fiscal_Period).id},a=this;this.base_forecast_rec=this.getPreviousForecast([store.peekRecord("Forecast",this.getDynamicParam())]);var s={prediction_status:app.store.makeRequest("triggerAction","Forecast","prediction_status",{forecast_id:this.base_forecast_rec.id}),currentPeriodInfo:store.findAll("fiscal_period",{filters:JSON.stringify(i)}),response_obj:a.fetchHierarchyInfo()};return Lyte.resolvePromises(s).then((function(e){a.currentPeriodInfo=e.currentPeriodInfo[0],a.response_obj=e.response_obj,e.prediction_status.prediction_status.length&&(a.prediction_status=e.prediction_status.prediction_status[0].status)}))},model:function(e){this.redirectToForecast();var t,r=this;t=store.createRecord("Forecast",{Forecast_Group:this.base_forecast_rec.Forecast_Group,Period_Name:JSON.parse(e.queryParams.Fiscal_Period)});var i=this.getForecastBasedOnPreviousYear(t.Forecast_Group.Forecast,this.getPreviousYearSet(this.currentPeriodInfo.Start_Date,2));store.unloadAll("forecast_data"),store.unloadAll("predicted_data");for(var a,s={field:{api_name:"Closing_Date"},comparator:"between",value:[r.currentPeriodInfo.Start_Date,r.currentPeriodInfo.End_Date]},o=store.peekAll("forecast_configuration")[0].hierarchy.api_name,n=r.response_obj.IdData.hierarchyIds,l=store.peekAll("forecast_configuration")[0].forecast_types,c=l.length,d=t.Forecast_Group.Forecast_Type.id,u=0;u<c;u++)l[u].id===d&&(a=l[u].field);var m,p={aggregated_field:{api_name:a.api_name,id:a.id},deal_criteria:s};"Territory"===o&&(p.territory_ids=n);var g,f=i.length,h=(m=f>0?i:this.base_forecast_lists).length,y={filters:{field:{api_name:"Forecast_Name.id"},comparator:"equal",value:m[h-(f>=0?1:2)].id}};(f>1||h>2)&&(g={filters:{field:{api_name:"Forecast_Name.id"},comparator:"equal",value:m[h-(f>=1?2:3)].id}});var v=JSON.stringify({field:{api_name:"Forecast_Name.id"},comparator:"equal",value:this.base_forecast_rec.id});return Lyte.resolvePromises({record:t,previousForecastData1:app.store.makeRequest("findAll","forecast_data",y),previousForecastData2:g?app.store.makeRequest("findAll","forecast_data",g):void 0,base_forecast_data:app.store.makeRequest("findAll","forecast_data",{filters:v},!0),base_predicted_data:app.store.makeRequest("findAll","predicted_data",{filters:v},!0),response_obj:r.response_obj,dealStatusCriteria:p})},afterModel:function(e){var t=this,r=store.peekAll("forecast_configuration")[0];e.hierarchy=r.hierarchy.display_value,e.is_admin=this.admin_user,e.hierarchyObj=r.hierarchy,e.showCriteriaEdit=this.showCriteriaEdit,e.forecast_type=e.record.Forecast_Group.Forecast_Type.name,e.base_forecast_fiscal=this.base_forecast_lists,e.fc_target_key="Deal_Revenue"===e.forecast_type?"target_amount":"target_quantity",e.criteria_fields=moduleRecordMapping.Deals?moduleRecordMapping.Deals.fields:void 0,e.previousForecasts=[];var i=[];e.previousForecastData1&&(e.previousForecastData1.length>0&&(e.formattedCurrency=e.previousForecastData1[0].formatted_currency),i.push(t.getSumForecastDataMap(e.previousForecastData1,r.hierarchy.api_name)),e.previousForecasts.push(store.peekRecord("Forecast",e.previousForecastData1[0].Forecast_Name.id))),e.previousForecastData2&&(i.push(t.getSumForecastDataMap(e.previousForecastData2,r.hierarchy.api_name)),e.previousForecasts.push(store.peekRecord("Forecast",e.previousForecastData2[0].Forecast_Name.id))),e.base_predicted_data&&(e.predictedDataMap=t.getPredictedDataMap(e.base_predicted_data,r.hierarchy.api_name)),e.dealStatusData=new Map,e.previousForecastsMap=i,"Reporting_To"===e.hierarchyObj.api_name&&(e.non_reporting_users=[],e.response_obj.non_reporting_users.forEach((function(t){"deleted"!==t.status&&e.non_reporting_users.push(t)}))),e.hierarchy_data=e.response_obj.hierarchy;var a=e.hierarchy_data[0].children;return a.length>50?e.hierarchy_data[0]._children=a.slice(0,50):e.hierarchy_data[0]._children=a,"Territory"===e.hierarchyObj.api_name?e.hierarchy_data[0].$.triggerAction("associated_users",{version:"v2.1"}).then((t=>{t&&t.meta.more_records&&(e.hierarchy_data[0].more_users=!0,e.hierarchy_data[0].page=2);var r=[],i=store.peekRecord("user",Crm.userDetails.USER_ID);if(i&&i.territories&&i.territories.length>0)for(var a of i.territories)if(a.id!==e.hierarchy_data[0].id)return r.push(a.$.triggerAction("associated_users",{version:"v2.1"}).then((e=>{var t=a.children;t.length>50?(a._children=t.slice(0,50),a.moreChildren=!0):a._children=t,e&&e.meta.more_records&&(a.more_users=!0,a.page=2)}))),Lyte.resolvePromises(r)})):"Roles"===e.hierarchyObj.api_name?store.findAll("user",{filters:[{comparator:"equal",field:"role.name",value:e.hierarchy_data[0].name}]}).then((t=>{t.$&&t.$.meta.more_records&&(e.hierarchy_data[0].more_users=!0,e.hierarchy_data[0].page=2)})):(e.isContinue=!0,void(e.isCloned=!0))},lyteConvertionSupported:!0},{mixins:["crm-forecast-util"]}),Lyte.Router.registerRoute("crm.tab.newForecasts.create",{queryParams:["Forecast_Name","Fiscal_Period","group_id","criteria","Forecast_Type","status"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-forecast-target.js","lyte-sticky.js","crm-forecast-search.js","crm-forecast-popup.js","crm-forecast-create-popup.js","crm-forecast-hierarchy-pop.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["crm-forecast-target.css","crm-forecast-common.css"],crmConstants.lessStaticPathForLyte))},beforeModel:function(e){var t=e.queryParams;if(!(t.Fiscal_Period&&t.group_id||t.Fiscal_Period&&t.Forecast_Name&&t.Forecast_Type))return _cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.errorpage.note1"),ltPropType:"error"}}),void this.replaceWith("crm.tab.newForecasts.index");var r=t.group_id,i=store.peekRecord("user",Crm.userDetails.USER_ID);this.admin_user=this.checkisAdminUser(i);var a={field:{api_name:"id"},comparator:"equal",value:JSON.parse(t.Fiscal_Period).id},s=this;if(r){var o=store.peekRecord("forecast_group",r);this.base_forecast_rec=this.getPreviousForecast(o.Forecast,store.peekRecord("fiscal_period",JSON.parse(t.Fiscal_Period).id));var n={prediction_status:this.base_forecast_rec?app.store.makeRequest("triggerAction","Forecast","prediction_status",{forecast_id:this.base_forecast_rec.id}):void 0,currentPeriodInfo:store.findAll("fiscal_period",{filters:JSON.stringify(a)}),response_obj:s.fetchHierarchyInfo()};return Lyte.resolvePromises(n).then((function(e){s.currentPeriodInfo=e.currentPeriodInfo[0],s.response_obj=e.response_obj,e.prediction_status&&e.prediction_status.prediction_status.length&&(s.prediction_status=e.prediction_status.prediction_status[0].status)}))}n={currentPeriodInfo:store.findAll("fiscal_period",{filters:JSON.stringify(a)}),response_obj:s.fetchHierarchyInfo()};return Lyte.resolvePromises(n).then((function(e){s.currentPeriodInfo=e.currentPeriodInfo[0],s.response_obj=e.response_obj}))},model:function(e){this.redirectToForecast();var t,r,i,a=e.queryParams,s=this,o=e.queryParams.group_id;o&&(r=store.peekRecord("forecast_group",o),i=s.getForecastBasedOnPreviousYear(r.Forecast,s.getPreviousYearSet(s.currentPeriodInfo.Start_Date,2)),t=store.createRecord("Forecast",{Forecast_Group:r,Period_Name:JSON.parse(a.Fiscal_Period)})),t||(r=store.createRecord("forecast_group",{Forecast_Group_Name:a.Forecast_Name,Forecast_Type:JSON.parse(a.Forecast_Type)}),t=store.createRecord("Forecast",{Period_Name:JSON.parse(a.Fiscal_Period),Forecast_Group:r}),this.showCriteriaEdit=!0),a.criteria&&r.$.set("criteria",JSON.parse(a.criteria)),store.unloadAll("forecast_data"),store.unloadAll("predicted_data");for(var n,l={field:{api_name:"Closing_Date"},comparator:"between",value:[s.currentPeriodInfo.Start_Date,s.currentPeriodInfo.End_Date]},c=store.peekAll("forecast_configuration")[0].hierarchy.api_name,d=s.response_obj.IdData.hierarchyIds,u=store.peekAll("forecast_configuration")[0].forecast_types,m=u.length,p=t.Forecast_Group.Forecast_Type.id,g=0;g<m;g++)u[g].id===p&&(n=u[g].field);var f={aggregated_field:{api_name:n.api_name,id:n.id},deal_criteria:l};if("Territory"===c&&(f.territory_ids=d),o){var h,y,v=i.length,_=(h=v>0?i:this.base_forecast_lists).length,b={filters:{field:{api_name:"Forecast_Name.id"},comparator:"equal",value:h[_-(v>0?1:2)].id}};(v>1||_>2)&&(y={filters:{field:{api_name:"Forecast_Name.id"},comparator:"equal",value:h[_-(v>1?2:3)].id}});var w=this.base_forecast_rec?JSON.stringify({field:{api_name:"Forecast_Name.id"},comparator:"equal",value:this.base_forecast_rec.id}):void 0;return Lyte.resolvePromises({record:t,previousForecastData1:app.store.makeRequest("findAll","forecast_data",b),previousForecastData2:y?app.store.makeRequest("findAll","forecast_data",y):void 0,base_forecast_data:w?app.store.makeRequest("findAll","forecast_data",{filters:w},!0):void 0,base_predicted_data:w?app.store.makeRequest("findAll","predicted_data",{filters:w},!0):void 0,response_obj:s.response_obj,dealStatusCriteria:f,isContinue:!0,existingForecast:store.findAll("forecast_group",{filters:'{ "group_operator":"and","group":[ { "comparator": "not_equal", "field": { "api_name": "id" }, "value":"${EMPTY}"} ] }'})})}return Lyte.resolvePromises({record:t,response_obj:s.response_obj,dealStatusCriteria:f,isContinue:!1,existingForecast:store.findAll("forecast_group",{filters:'{ "group_operator":"and","group":[ { "comparator": "not_equal", "field": { "api_name": "id" }, "value":"${EMPTY}"} ] }'})})},afterModel:function(e,t){var r=this,i=store.peekAll("forecast_configuration")[0];if(e.hierarchy=i.hierarchy.display_value,e.is_admin=this.admin_user,e.hierarchyObj=i.hierarchy,e.showCriteriaEdit=this.showCriteriaEdit,e.forecast_type=e.record.Forecast_Group.Forecast_Type.name,e.base_forecast_fiscal=this.base_forecast_lists,e.fc_target_key="Deal_Revenue"===e.forecast_type?"target_amount":"target_quantity",e.criteria_fields=moduleRecordMapping.Deals?moduleRecordMapping.Deals.fields:void 0,e.existingForecast&&e.existingForecast.length){for(var a=e.existingForecast.length,s=0,o=0;o<a;o++)e.existingForecast[o].Is_Group_Archived||s++;e.noOfForecast=s}else e.noOfForecast=0;e.previousForecasts=[];var n=[];e.previousForecastData1&&e.previousForecastData1.length&&(e.formattedCurrency=e.previousForecastData1[0].formatted_currency,n.push(r.getSumForecastDataMap(e.previousForecastData1,i.hierarchy.api_name)),e.previousForecasts.push(store.peekRecord("Forecast",e.previousForecastData1[0].Forecast_Name.id))),e.previousForecastData2&&(n.push(r.getSumForecastDataMap(e.previousForecastData2,i.hierarchy.api_name)),e.previousForecasts.push(store.peekRecord("Forecast",e.previousForecastData2[0].Forecast_Name.id))),e.base_predicted_data&&(e.predictedDataMap=r.getPredictedDataMap(e.base_predicted_data,i.hierarchy.api_name,"create")),e.dealStatusData=new Map,e.previousForecastsMap=n,"Reporting_To"===e.hierarchyObj.api_name&&(e.non_reporting_users=[],e.response_obj.non_reporting_users.forEach((function(t){"deleted"!==t.status&&e.non_reporting_users.push(t)}))),e.hierarchy_data=e.response_obj.hierarchy;var l=e.hierarchy_data[0].children;if(l&&l.length>50?e.hierarchy_data[0]._children=l.slice(0,50):e.hierarchy_data[0]._children=l,t.queryParams.group_id&&(e.quickset_targets=this.getQuickTarget(t.queryParams.status,e.previousForecastData1&&e.previousForecastData1.length)),"Territory"===e.hierarchyObj.api_name)return e.hierarchy_data[0].$.triggerAction("associated_users",{version:"v2.1"}).then((t=>{t&&t.meta.more_records&&(e.hierarchy_data[0].more_users=!0,e.hierarchy_data[0].page=2);var r=[],i=store.peekRecord("user",Crm.userDetails.USER_ID);if(i&&i.territories&&i.territories.length>0)for(var a of i.territories)if(a.id!==e.hierarchy_data[0].id)return r.push(a.$.triggerAction("associated_users",{version:"v2.1"}).then((e=>{var t=a.children;t&&t.length>50?(a._children=t.slice(0,50),a.moreChildren=!0):a._children=t,e&&e.meta.more_records&&(a.more_users=!0,a.page=2)}))),Lyte.resolvePromises(r).then((()=>{this.recursiveSetChildrenData(e.hierarchy_data[0])}))}));if("Roles"===e.hierarchyObj.api_name){var c=store.peekRecord("user",Crm.userDetails.USER_ID).role,d={firstRole:store.findAll("user",{filters:[{comparator:"equal",field:"role.name",value:e.hierarchy_data[0].name}]}).then((t=>{t.$&&t.$.meta.more_records&&(e.hierarchy_data[0].more_users=!0,e.hierarchy_data[0].page=2)}))};if(e.hierarchy_data[0].name!=c.name){var u=c.children;u&&u.length>50?c._children=u.slice(0,50):c._children=u,d.currentRole=store.findAll("user",{filters:[{comparator:"equal",field:"role.name",value:c.name}]}).then((e=>{e.$&&e.$.meta.more_records&&(c.more_users=!0,c.page=2)}))}return Lyte.resolvePromises(d)}},renderTemplate:function(){return{outlet:"#show",component:"crm-forecast-target"}},actions:{onError:function(e){this.handleError(e)}},recursiveSetChildrenData:function(e){var t=e.children;if(e.users&&e.users.length&&t&&t.length&&Lyte.Component.set(e,"_children",t),t)for(var r=e._children?e._children.length:0,i=0;i<r;i++)this.recursiveSetChildrenData(e._children[i])},lyteConvertionSupported:!0},{mixins:["crm-forecast-util"]}),Lyte.Router.registerRoute("crm.tab.newForecasts.edit",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-forecast-target.js","lyte-sticky.js","crm-forecast-search.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["crm-forecast-target.css","crm-forecast-common.css"],crmConstants.lessStaticPathForLyte))},beforeModel:function(){return this.target_id=this.getDynamicParam(),this.redirectToForecast(),this.fetchParentItemInfo(this.target_id)},model:function(){var e=store.peekRecord("Forecast",this.getDynamicParam());"completed"===e.status&&this.errorPageRedirection(I18n.getMsg("crm.forecast.completed.configuration.cant.updated.new")),this.base_forecast_rec=this.getPreviousForecast(e.Forecast_Group.Forecast,e.Period_Name);var t,r=this.getParentItemIds(this.parent_data[0]),i=JSON.stringify({field:{api_name:"Forecast_Name.id"},comparator:"equal",value:e.id}),a=crmConstants.forecastHierarchyObj[this.forecast_config.hierarchy.api_name];if("Reporting_To"===a&&this.is_admin&&this.non_reporting_data.length){var s=this.getParentItemIds(this.non_reporting_data[0]);t=this.fetchForecastData(s,"users",a,this.target_id,void 0,void 0,!0,void 0,!0)}return"completed"!==e.status&&this.fetchUsersCount(a,e),Lyte.resolvePromises({forecast_data_children:this.fetchForecastData(r,"children",a,this.target_id),forecast_data_user:this.fetchForecastData(r,"users",a,this.target_id),fetch_non_reporting:t,record:e,predicted_data:app.store.makeRequest("findAll","predicted_data",{filters:i},!0),fiscal_period:store.findRecord("fiscal_period",e.Period_Name.id)}).then(function(e){var t,r,i=this.getForecastBasedOnPreviousYear(e.record.Forecast_Group.Forecast,this.getPreviousYearSet(e.fiscal_period[0].Start_Date,2)),a=i.length,s=(t=a>0?i:this.base_forecast_lists).length,o={filters:{field:{api_name:"Forecast_Name.id"},comparator:"equal",value:t[s-(a>=0?1:2)].id}};(a>1||s>2)&&(r={filters:{field:{api_name:"Forecast_Name.id"},comparator:"equal",value:t[s-(a>1?2:3)].id}});var n=Object.assign({previousForecastData1:app.store.makeRequest("findAll","forecast_data",o),previousForecastData2:r?app.store.makeRequest("findAll","forecast_data",r):void 0},e);return Lyte.resolvePromises(n)}.bind(this))},afterModel:function(e){e.hierarchy=this.forecast_config.hierarchy.display_value,e.base_forecast_fiscal=this.base_forecast_lists,e.hierarchyObj=this.forecast_config.hierarchy,e.forecast_type=e.record.Forecast_Group.Forecast_Type.name,e.fc_target_key="Deal_Revenue"===e.forecast_type?"target_amount":"target_quantity",e.criteria_fields=moduleRecordMapping.Deals?moduleRecordMapping.Deals.fields:void 0;var t=this.parent_data[0];this.setPredictedInfo(t,this.fc_type),e.hierarchy_data=this.company_fc_data?[this.company_fc_data[0]]:this.hierarchy_data_info,e.is_admin=this.is_admin,this.is_admin&&"Reporting_To"===e.hierarchyObj.api_name&&(e.non_reporting_users=e.fetch_non_reporting.non_reporting_users,e.non_reporting_user_config=e.fetch_non_reporting.non_reporting_user_config),e.from_page="edit";var r=store.peekAll("forecast_configuration")[0];e.previousForecasts=[];var i=[];e.previousForecastData1&&(e.previousForecastData1.length>0&&(e.formattedCurrency=e.previousForecastData1[0].formatted_currency),i.push(this.getSumForecastDataMap(e.previousForecastData1,r.hierarchy.api_name)),e.previousForecasts.push(store.peekRecord("Forecast",e.previousForecastData1[0].Forecast_Name.id))),e.previousForecastData2&&(i.push(this.getSumForecastDataMap(e.previousForecastData2,r.hierarchy.api_name)),e.previousForecasts.push(store.peekRecord("Forecast",e.previousForecastData2[0].Forecast_Name.id))),e.predicted_data&&(e.predictedDataMap=this.getPredictedDataMap(e.predicted_data,r.hierarchy.api_name)),e.previousForecastsMap=i;for(var a,s=r.forecast_types,o=s.length,n=e.record.Forecast_Group.Forecast_Type.id,l=this.parent.currentModel.hierarchyIds,c=0;c<o;c++)s[c].id===n&&(a=s[c].field);var d={aggregated_field:{api_name:a.api_name,id:a.id},deal_criteria:{field:{api_name:"Closing_Date"},comparator:"between",value:[e.fiscal_period[0].Start_Date,e.fiscal_period[0].End_Date]}};"Territory"===store.peekAll("forecast_configuration")[0].hierarchy.api_name&&(d.territory_ids=l),e.dealStatusCriteria=d,e.dealStatusData=new Map;var u=e.hierarchy_data[0].children;u&&u.length>50?(e.hierarchy_data[0]._children=u.slice(0,50),e.hierarchy_data[0].moreChildren=!0):e.hierarchy_data[0]._children=u},renderTemplate:function(){return{outlet:"#show",component:"crm-forecast-target"}},lyteConvertionSupported:!0,actions:{onError:function(e,t){e&&e.status&&400===e.status&&e.response&&("The given forecast_id seems to be invalid"===JSON.parse(e.response).message&&this.errorPageRedirection(I18n.getMsg("crm.forecast.not.available")));t.resume()}}},{mixins:["crm-forecast-util"]}),Lyte.Router.registerRoute("crm.tab.newForecasts.index",{getResources:function(){return[networkUtils.returnDependencyFiles(["crm-forecast-popup.js","crm-forecast-create-popup.js","crm-forecast-hierarchy-pop.js"],crmConstants.jsStaticPathForLyte),networkUtils.returnDependencyFiles(["crm-forecast-popup.css","crm-forecast-create.css","crm-forecast-common.css","crm-forecast-hierarchy-pop.css"],crmConstants.lessStaticPathForLyte)]},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){var e={getforecastconfig:store.findAll("forecast_configuration"),fiscalPeriod:store.findAll("fiscal_period",{},!0)};return Lyte.resolvePromises(e)},afterModel:function(e){this.currentModel={},this.currentModel.getforecastconfig=e.getforecastconfig,Crm.userDetails.IS_ADMIN?this.currentModel.isAdminUser=!0:this.currentModel.isAdminUser=!1,commonUtils.showHideLoadingDiv()},renderTemplate:function(e){if(e.getforecastconfig&&e.getforecastconfig.id)Lyte.Router.transitionTo("crm.tab.newForecasts.list",null,{});else if(e.getforecastconfig){return{outlet:"#show",component:"crm-forecast-initial-page"}}}}),Lyte.Router.registerRoute("crm.tab.newForecasts.list",{queryParams:["id","type","forecast_id","user_id","role_id","filters","status","territory_id"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-forecast-list.js","crm-forecast-search.js","crm-forecast-create-popup.js","crm-forecast-deals-modal.js","crm-macro.js","crm-forecast-progress.js"],crmConstants.jsStaticPathForLyte);return e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-forecast-popup.js","crm-forecast-create-popup.js","crm-forecast-hierarchy-pop.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-forecast-popup.css","crm-forecast-create.css","crm-forecast-common.css","crm-forecast-hierarchy-pop.css","crm-forecast-progress.css"],crmConstants.lessStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-forecast-list.css","crm-forecast-list-container.css","crm-forecast-common.css","crm-forecast-search-component.css","crm-forecast-deals-modal.css"],crmConstants.lessStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-macro.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["zohocrm_macro_common.js"]))},beforeModel:function(e){var t=this.transition.data;if(!t||!t.reloadAll){var r={},i={},a=this;if(e.queryParams.filters&&(r.filters=JSON.parse(e.queryParams.filters),this.parseFilterCriteria(i,r.filters)),!i.periodCriteria&&"archived"!==e.queryParams.status){var s=this.getPeriodMonthQuarter().currentfiscalyear;i.periodCriteria=this.getCriteriaByYear(s,!1,"Period_Name"),i.selectedPeriod=s,r.filters=this.construct_group(r.filters,i.periodCriteria,"AND")}var o={field:{api_name:"Is_Archived"},comparator:"equal",value:!1};if("archived"===e.queryParams.status)o.value=!0,i.isArchived=!0;else if(e.queryParams.status){var n=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),l=window.location.pathname.split(n)[1];this.replaceWith("crm.crm-error",l).data={showError:!0,isBodyText:!0,bodyText:I18n.getMsg("crm.error.page.msg2"),errorMsg:I18n.getMsg("crm.error.page.msg1")}}if(i.isArchived&&(1!==Crm.userDetails.TMENABLED||!this.isReportingToHasPermission())){r.filters=this.construct_group(r.filters,{field:{api_name:"Group_Id.Forecast_Hierarchy"},comparator:"not_equal",value:"Territory"},"AND")}if(i.isArchived&&(o.value=!0),r.filters=JSON.stringify(this.construct_group(r.filters,o,"AND")),this.filterObj=i,store.unloadAll("Forecast"),store.unloadAll("forecast_data"),store.unloadAll("forecast_group"),i.isArchived){var c={forecast:store.findAll("Forecast",r),dealFields:store.findAll("field",{module:"Deals",type:"all"},!1,!1,{apiVersion:"2.2"})};return Lyte.resolvePromises(c).then((function(e){a.transition.data.forecasts=e.forecast}))}return store.findAll("Forecast",r).then((function(e){a.transition.data.forecasts=e}))}},model:function(e){if(!(t=this.transition.data)||!t.reloadAll){var t,r=store.peekAll("forecast_configuration")[0],i=this,a=e.queryParams;if((t=this.transition.data).searchValue){(a={})[{user:"user_id",role:"role_id",terrtory:"territory_id"}[t.searchValue.type]]=t.searchValue.id}var s={};if(i.filterObj.isArchived||(s=this.getCriteriaBasedOnHierarchy(r.hierarchy,a)),i.filterObj.isArchived||!this.transition.data.associatedTerritories||s.searchValue.associatedTerritories||(s.searchValue.associatedTerritories=this.transition.data.associatedTerritories),t.searchValue&&(s.searchValue=t.searchValue,t.searchValue.subtype&&"all"!==t.searchValue.subtype&&!i.filterObj.isArchived&&(this.filterObj.selectedTerritory=t.searchValue.subtype,s.criteria=this.construct_group(s.criteria,{field:{api_name:"Territory"},comparator:"equal",value:t.searchValue.subtype},"AND"))),s.searchValue=void 0===s.searchValue?{}:s.searchValue,i.transition.data.forecasts&&i.transition.data.forecasts.length){var o={field:{api_name:"Forecast_Name.id"},comparator:"equal",value:this.getDataFromArray(i.transition.data.forecasts,"id")};i.filterObj.isArchived||(this.predictionCriteria.field.api_name="Forecast_Quota."+this.predictionCriteria.field.api_name,this.childCriteria=this.predictionCriteria,delete this.predictionCriteria);for(var n=o.value,l={},c=1,d=!0;d;){n.length<50?(o.value=n,d=!1):o.value=n.splice(0,50),i.filterObj.isArchived||(l["predicted_data"+c]=this.getPredictionData(this.construct_group(o,this.childCriteria,"AND")));var u=void 0===s.criteria?this.getAllHierarchyCriteria():s.criteria;if(i.filterObj.isArchived){u=this.construct_group(u,{field:{api_name:"Forecast_Name.Is_Archived"},comparator:"equal",value:!0},"AND")}l["fcData"+c]=app.store.makeRequest("findAll","forecast_data",{filters:JSON.stringify(this.construct_group(u,o,"AND"))}),c+=1}return s.searchValue=void 0===s.searchValue?{}:s.searchValue,l.fiscalPeriod=store.findAll("fiscal_period",{},!0),i.filterObj.isArchived&&i.filterObj.selectedForecastGroup&&(l.forecastGroup=store.findRecord("forecast_group",i.filterObj.selectedForecastGroup)),Lyte.resolvePromises(l).then((function(e){return{forecasts:i.transition.data.forecasts,forecastConfiguration:r,isAdminUser:s.isAdminUser,selectedSearchvalue:s.searchValue,filtersCriteria:i.filterObj,isArchived:i.filterObj.isArchived,forecastGroupName:i.transition.data.forecastGroupName,selectedForecastGroup:e.forecastGroup}}),(function(e){var t=JSON.parse(e.response);"NO_PERMISSION"===t.code?(renderingUtils.displayPermissionDenied(),i.transition.abort()):"MANDATORY_FILTER_NOT_FOUND"!=t.code&&"VALUE_LIMIT_EXCEEDED_IN_CRITERIA"!=t.code&&500!=e.status&&(i.transitionTo("crm.tab.newForecasts.list").data={reloadAll:!0})}))}return{forecasts:[],forecastConfiguration:r,isAdminUser:s.isAdminUser,selectedSearchvalue:s.searchValue,filtersCriteria:i.filterObj,isArchived:i.filterObj.isArchived,forecastGroupName:i.transition.data.forecastGroupName}}},afterModel:function(e){var t=this.transition.data;if(!(t&&t.reloadAll||(this.constructForecastData(e.forecasts,e.isArchived),e.navigateToGroupId=this.transition.data.gotoGroup,0===e.forecasts.length))){e.baseForecast=store.peekAll("forecast_group").slice(0);for(var r=e.baseForecast.length,i=0,a=0;a<r;a++)e.baseForecast[a-i].Forecast&&e.baseForecast[a-i].Forecast.length||(e.baseForecast.splice(a-i,1),i++);e.isAdmin="Administrator"===store.peekRecord("user",Crm.userDetails.USER_ID).profile.name,e.selectedSearchvalue.period=e.filtersCriteria.selectedPeriod,e.isArchived&&!e.filtersCriteria.selectedPeriod&&(e.selectedSearchvalue.period="allTime",e.filtersCriteria.selectedPeriod="allTime")}},renderTemplate:function(){return{outlet:"#show",component:"crm-forecast-list-container",reRender:!0}},afterRender:function(){this.transition.data.initial&&this.setCreatePopValues()},lyteConvertionSupported:!0,actions:{onError:function(e,t){if(e&&e.status&&400===e.status&&e.response){var r=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),i=window.location.pathname.split(r)[1];this.replaceWith("crm.crm-error",i).data={showError:!0,errorMsg:I18n.getMsg("crm.forecast.not.available")}}t.resume()}}},{mixins:["crm-forecast-util"]}),Lyte.Router.registerRoute("crm.tab.newForecasts.view",{queryParams:["forecast_type","forecast_hierarchy","status","forecast_field_label"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-forecast-view.js","crm-forecast-search.js","crm-forecast-deals-modal.js","crm-macro.js","crm-forecast-progress.js"],crmConstants.jsStaticPathForLyte);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-forecast-view.css","crm-forecast-list-container.css","crm-forecast-common.css","crm-forecast-search-component.css","crm-forecast-deals-modal.css","crm-forecast-progress.css"],crmConstants.lessStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-macro.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["zohocrm_macro_common.js"]))},beforeModel:function(){var e=this.transition.data;if(!e||!e.reloadAll){var t=this.getDynamicParam(),r=this.getQueryParams();return r.status&&"archived"===r.status?this.fetchParentItemInfo(t,void 0,r.forecast_hierarchy,!0):this.fetchParentItemInfo(t)}},model:function(){var e=this.transition.data;if(!e||!e.reloadAll){var t=this.getQueryParams(),r=!1;t.status&&"archived"===t.status&&(r=!0);var i,a=this.getDynamicParam(),s=store.peekRecord("Forecast",a);if(s.Is_Archived&&!r){var o=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),n=window.location.pathname.split(o)[1];this.replaceWith("crm.crm-error",n).data={showError:!0,errorMsg:I18n.getMsg("crm.forecast.archived.not.available"),isForecast:!0}}s.Forecast_Group&&(i={field:{api_name:"Group_Id"},comparator:"equal",value:s.Forecast_Group.id});var l,c,d,u,m,p=JSON.stringify(i),g=store.findAll("Forecast",{filters:p}),f=JSON.stringify({field:{api_name:"Forecast_Name.id"},comparator:"equal",value:s.id}),h=this.parent_data.length?this.getParentItemIds(this.parent_data[0]):[];if(l=r?this.FORECAST_UNIQUE_HIERARCHY_API_NAME[t.forecast_hierarchy].apiname:crmConstants.forecastHierarchyObj[this.forecast_config.hierarchy.api_name],h.length&&(d=this.fetchForecastData(h,"children",l,a),u=this.fetchForecastData(h,"users",l,a)),"Reporting_To"===l&&this.is_admin&&this.non_reporting_data.length){var y=this.getParentItemIds(this.non_reporting_data[0]);c=this.fetchForecastData(y,"users",l,a,void 0,void 0,!0,void 0,!0)}return"completed"!==s.status&&this.fetchUsersCount(l,s),m="completed"===this.prediction_status?app.store.makeRequest("findAll","predicted_data",{filters:f},!0):[],Lyte.resolvePromises({forecast_data_children:d,forecast_data_user:u,fetch_non_reporting:c,record:s,predicted_data:m,group_forecasts:g,forecastGroupFields:r?store.findAll("field",{module:"Forecast_Groups",type:"all"},!1,!0,{apiVersion:"2.2"}):void 0,isArchived:r,forecast_field_label:r?t.forecast_field_label:void 0})}},afterModel:function(e){var t=this.transition.data;if(!t||!t.reloadAll){e.isArchived&&(e.archivedFieldLabel=e.forecast_field_label),e.Fiscal_Periods=this.constructFiscalPeriod(e.group_forecasts);var r=e.record;if(e.is_admin=this.is_admin,e.forecast_manager=this.forecast_manager,e.daydiff=Utils.getDayDiff(new Date(r.Period_Name.End_Date),new Date(r.Period_Name.Start_Date)),e.criteria_fields=moduleRecordMapping.Deals?moduleRecordMapping.Deals.fields:void 0,e.forecast_conf=this.forecast_config,e.forecast_type=r.Forecast_Group.Forecast_Type.name,e.fc_target_key="Deal_Revenue"===e.forecast_type?"formatted_target_amount":"formatted_target_quantity",e.isArchived){var i=this.getQueryParams(),a=this.getForecastHierarchy(e.forecastGroupFields,i.forecast_hierarchy);e.hierarchy=a.display_value,e.hierarchyObj=a}else e.hierarchy=e.forecast_conf.hierarchy.display_value,e.hierarchyObj=e.forecast_conf.hierarchy;e.criteria_fields=moduleRecordMapping.Deals?moduleRecordMapping.Deals.fields:void 0,this.setPredictedInfo(this.parent_data[0],this.fc_type),e.hierarchy_data=this.company_fc_data?[this.company_fc_data[0]]:this.hierarchy_data_info;var s=r.Forecast_Group.criteria?this.getCriteriaLen(r.Forecast_Group.criteria):0;e.criteriaLen=s.length,this.is_admin&&"Reporting_To"===e.hierarchyObj.api_name&&(e.non_reporting_users=[],e.fetch_non_reporting.non_reporting_users.forEach((function(t){(t.User&&"deleted"!==t.User.status||t.Reporting_To&&"deleted"!==t.Reporting_To.status)&&e.non_reporting_users.push(t)})),e.non_reporting_user_config=e.fetch_non_reporting.non_reporting_user_config),e.record.Forecast_Quotas&&(e.record.Forecast_Quotas=[]),e.hierarchy_name=crmConstants.forecastHierarchyObj[e.hierarchyObj.api_name],this.without_territory&&(e.without_territory=e.forecast_data_children.without_territory),delete this.without_territory;var o=e.record.Created_Time,n=e.record.Modified_Time,l=$L.moment(o.split(" ")[0]).toDate();Utils.convertToUserTimezone(l);var c=$L.moment(n.split(" ")[0]).toDate();Utils.convertToUserTimezone(c),e.created_time=Utils.getDateTimeInUserFormat(l,!0),e.modified_time=Utils.getDateTimeInUserFormat(c,!0)}},renderTemplate:function(){return{outlet:"#show",component:"crm-forecast-view",reRender:!0}},afterRender:function(){var e=$L("crm-forecast-view");e&&e.length&&e[0].component.setLastChangedTime()},lyteConvertionSupported:!0,actions:{onError:function(e,t){if(e&&e.status&&400===e.status&&e.response){var r=JSON.parse(e.response);if("The given forecast_id seems to be invalid"===r.message||"UNABLE_TO_PARSE_DATA_TYPE"===r.code){var i=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),a=window.location.pathname.split(i)[1];this.replaceWith("crm.crm-error",a).data={showError:!0,errorMsg:I18n.getMsg("crm.forecast.not.available")}}}t.resume()},didTransition:function(){commonUtils.showHideLoadingDiv("refreshing"===this.currentModel.record.$computation_status)}}},{mixins:["crm-forecast-util"]}),Lyte.Router.registerRoute("crm.tab.reports.create",{beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(e){var t=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=newReport";return networkUtils.lyteInitiateRequest(t,"GET",{params:{isload:!0}})},afterModel:function(){commonUtils.showHideLoadingDiv()},renderTemplate:function(e){return{outlet:"#show",html:e}},afterRender:function(e,t){crmReports.setHeightWidth(!1),thirdPartyUtils.bindSelect2($(".newSelect").find("select"))}}),Lyte.Router.registerRoute("crm.tab.reports.edit",{queryParams:["folderId","repType","isCopyReport"],beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(e){var t=this.transition.data?objectUtils.cloneObject(this.transition.data):{};t.isload=!0,t.reportId=this.getDynamicParam();var r=this.getQueryParams();r&&(t.folderId=r.folderId,t.repType=r.repType,t.isCopyReport=r.isCopyReport);var i={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=customize","GET",i)},afterModel:function(){commonUtils.showHideLoadingDiv()},renderTemplate:function(e){return{outlet:"#show",html:e}},afterRender:function(e,t){crmReports.customizeReport(this.getQueryParams().repType)}}),Lyte.Router.registerRoute("crm.tab.reports.index",{queryParams:["folder"],beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(e){var t=!1;if(this.transition.data&&this.transition.data.show_incompatibility&&(t=!0,Lyte.objectUtils(this.transition.data,"delete","show_incompatibility")),Object.keys(this.transition.data).length){(i=objectUtils.cloneObject(this.transition.data)).isload=!0,this.getQueryParams()&&(validationUtils.isValidNumber(this.getQueryParams().folder)?i.folderId=this.getQueryParams().folder:i.view=this.getQueryParams().folder);var r=Crm.getCrmBasePath()+"/specific/CustomReport.do?actionItem=getReports";return{data:networkUtils.lyteInitiateRequest(r,"GET",{params:i}),revamp_enabled:networkUtils.lyteInitiateRequest("/crm/v2/Reports/__internal/revamp_enabled","GET"),show_incompatibility:t}}var i={module:"Reports",isload:!0};return this.getQueryParams()&&this.getQueryParams().folder&&(validationUtils.isValidNumber(this.getQueryParams().folder)?i.folderId=this.getQueryParams().folder:i.view=this.getQueryParams().folder),{data:networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowDetails.do","GET",{params:i}),revamp_enabled:networkUtils.lyteInitiateRequest("/crm/v2/Reports/__internal/revamp_enabled","GET"),show_incompatibility:t}},renderTemplate:function(e){if(e.revamp_enabled&&e.revamp_enabled.enabled&&(this.transition.abort(),Utils.windowLocationHref("")),null!==localStorage.getItem("reports_migration")&&"NEW"!==localStorage.getItem("reports_migration")){var t=document.querySelector("crm-report-wms-pop");t&&(t=t.component).setData("showPop",!1)}return{outlet:Object.keys(this.transition.data).length?"#reportMain":"#show",html:e.data}},afterRender:function(e,t){if(e.revamp_enabled){var r=!!e.revamp_enabled.migration_scheduled&&e.revamp_enabled.migration_scheduled;if(crmReports.disableMigrateBtn=r,r){var i=e.revamp_enabled.scheduled_time?e.revamp_enabled.scheduled_time:"";i&&i.length>0&&crmReports.convertDateToUserTime(i)}}e.show_incompatibility&&Lyte.registeredMixins["crm-report-util"].errorPopup({status:400,response:'{"status":"error","code":"REPORT_NOT_SUPPORTED"}'},!0),crmReports.renderReports()}}),Lyte.Router.registerRoute("crm.tab.reports.records",{queryParams:["action","stdDateFilter","criteria","module","userId","status","summaryValue","dbItemId","summaryCol","FROM_INDEX","sortCol","orderBy","drill_down","from_hierarchy","title"],beforeModel:function(e){if(commonUtils.showHideLoadingDiv(!0),!e.queryParams.action){this.transition.abort();var t=networkUtils.returnDependencyFiles(["crm-new-reports-popup.js"],crmConstants.jsStaticPathForLyte);Lyte.injectResources(t,void 0,(function(){var e=Lyte.Component.render("crm-new-reports-popup",{},"#reportlookupdiv");e&&e.component.showOrHideModel("drillDownNotSupportedAlert",!0)}))}},model:function(e){var t=this.transition.data?objectUtils.cloneObject(this.transition.data):{},r=this.getQueryParams();return(r=r||{}).reportId=this.getDynamicParam(),t&&t.isAjax&&(r.isAjax=this.isAjax=!0),networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ReportsRelatedCV.do","GET",{params:r})},afterModel:function(){commonUtils.showHideLoadingDiv()},renderTemplate:function(e){return this.isAjax?e.FAILURE?void renderingUtils.showCustomAlert(parsedData.FAILURE,void 0,!1):{outlet:"#CVTable",html:(0,Handlebars.templates.ReportsRelatedCV)(e)}:{outlet:"#show",html:e}},afterRender:function(e,t){if(this.isFromCall)return $("#reportsPagNation").html(""),void CrmDashboard.setCallsNavigationDiv(e);this.isAjax&&($("#reportsPagNation").html(""),CrmDashboard.setNavigationDiv(e.requestedObj))}}),Lyte.Router.registerRoute("crm.tab.reports.redirect-to-index",{redirect:function(){this.replaceWith("crm.tab.reports.index")}}),Lyte.Router.registerRoute("crm.tab.reports.view",{queryParams:["fromDashboard","folderId","repType","viewtype","type","isrepupdate","repdesc","category","mailtype","entitytype","usertype","periodtype","startdate","enddate","nextpagenum","prevpagenum","customoption","userid","groupid","sort","sortorder","pagenum","catsort","repname","reprunorsave","tempusrsort","datatype","groupbychange","repoption","option","selectedfolder","stdDateFilterField","stdDateFilter","stdageindayscondition","stdageindays","isfrompopup"],getResources:function(e){var t=networkUtils.returnDependencyFiles([networkUtils.includeChartFiles()[0],"zohocrm_analytics.js"]);return"email"==e.queryParams.type&&(t=t.concat(networkUtils.returnDependencyFiles(["zohocrm_emailStats.js"]))),t},cscript:function(){return{enabled:!0,selector:[{}]}},beforeModel:function(e){"email"==e.queryParams.type&&$('<div class="pA zeTransparent" style="top:0;bottom:0;left:0;right:0;margin:auto;background-color:transparent"></div>').appendTo("body")},model:function(e){if(this.transition.cachedResponse)return this.transition.cachedResponse;var t=objectUtils.cloneObject(this.getQueryParams());(t=t||{}).reportId=this.getDynamicParam();t.reportId&&["list","schedule"].includes(t.reportId)&&(this.transition.abort(),Lyte.Router.transitionTo({route:"crm.tab.reports.index"}));var r=Crm.getCrmBasePath()+"/specific/CustomReport.do?",i="GET";return"email"==t.type?(r=Crm.getCrmBasePath()+"/ShowEmailStats.do",delete t.type,i="POST"):(t.isload=!0,t.actionItem="run"),networkUtils.lyteInitiateRequest(r,i,{params:t})},afterModel:function(){},renderTemplate:function(e,t){return CScriptLib&&CScript.Engine.Init(),"email"==t.queryParams.type?(crmEmailStats.init(),crmEmailStats.renderReports(e)):(networkUtils.initChart(),{outlet:"#show",html:e})},afterRender:function(e,t){crmReports.setHeightWidth(!1,!0),"email"!=t.queryParams.type||this.error_key||crmEmailStats.afterRender(e,t.queryParams),CScriptLib&&CScript.dispatchEvent("onLoad")},actions:{onError:function(e,t,r){"email"==r.queryParams.type&&t.abort()}}}),app.cscript_registry({route_name:"crm.tab.reports.view",category:I18n.getMsg("crm.label.privacy.preferences.reports"),config:[{enabled:function(){return new Promise((function(e){e(Crm.isCscriptReportEnabled)}))},name:I18n.getMsg("crm.customize.custombutton.create.detail"),unique_name:"reports_create",handlers:[],display_tag:!0,selectors:[],page_info:function(){return{name:I18n.getMsg("crm.label.privacy.preferences.reports")}},events:{page:{name:I18n.getMsg("com.cscript.pageevents"),label:I18n.getMsg("crm.social.integ.type.page"),list:[{event:"onLoad",args:[]}]}}}]}),Lyte.Router.registerRoute("crm.tab.dashboards.dashboardId",{}),Lyte.Router.registerRoute("crm.tab.dashboards.index",{beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(e){if(this.transition.data||(this.transition.data={}),this.transition.data.ajaxLoad=!0,"crm.tab.dashboards.view"==this.transition.target)this.transition.data.ajaxLoad=!1;else if("crm.tab.dashboards.view.expand"!=this.transition.target)return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowDetails.do","GET",{params:{module:"Dashboards",isload:!0}})},afterModel:function(){commonUtils.showHideLoadingDiv()},renderTemplate:function(e,t){if(e)return networkUtils.initChart(),{outlet:"#show",html:e}},actions:{willTransition:function(e){"0"==e.info.dynamicParams[0]&&e.abort()}},afterRender:function(){$("#dash_0").parent().addClass("sel");var e=$("#dashboardList");Territory.doHighLight("#dashboardList",e.find(".sel").eq(0),250,$(window).height()-280)},actions:{onError:function(e,t){if(commonUtils.showHideLoadingDiv(),t.abort(),555===e.status&&"Dashboard Not Available"===e.responseText){var r=I18n.getMsg("crm.dashboard.not.available");renderingUtils.showCustomAlert(r,void 0,!1),$("#custom_alert_button").bind("click",(function(){Lyte.Router.transitionTo({route:"crm.tab.dashboards.index"})}))}else renderingUtils.displayPermissionDenied()}}}),Lyte.Router.registerRoute("crm.tab.dashboards.view",{queryParams:["from"],beforeModel:function(){commonUtils.showHideLoadingDiv(!0),CrmDashboard.favoriteTimeout&&"crm.tab.dashboards.view.expand"!=this.transition.target&&CrmDashboard.setFavorites(void 0,void 0)},model:function(e){var t=this.getQueryParams().from;if("msteams"==t&&(CrmDashboard.fromMicrosoftTeams=!0),t&&"auditLog"===t&&(CrmDashboard.fromAuditLog=!0),this.transition.data&&"string"==typeof this.transition.data){var r=this.transition.data,i=$("#dashboardList");r=r.split("###");var a=CrmDashboard.dashboardListTemplate({DBID:r[0],DBNAME:r[1]});return $("#dbId").val(r[0]),$("#dbTitle").html(r[1]),$("#dashWithFav").find(".sel").removeClass("sel"),i.find("div").eq(0).append(a),$("#dashboardItems").height(0).find("#dashboardItemsSort").children().remove(),$("#dashboardItemCount").val(0),$("#emptyDashboard").css("display","").find('input[data-cid="addComponent"]').css("display",""),$("#emptyDbMsg").text(I18n.getMsg("crm.dashboard.nocomponent")),$("#addCompdiv").hide(),CrmDashboard.showDashboardSettings(),$("#show").html()}if("crm.tab.dashboards.view.expand"!=this.transition.target){var s={params:{action:"showDashboard",dbId:e.dynamicParam,isload:!0}};return this.transition.data&&this.transition.data.ajaxLoad&&(s.params.ajaxLoad=!0),s.params[csrfParamName]=csrfToken,networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/Dashboard.do","POST",s)}},afterModel:function(){commonUtils.showHideLoadingDiv(),CrmDashboard.hidePopup()},renderTemplate:function(e){if(e)return this.transition.data&&this.transition.data.ajaxLoad?{outlet:"#showdbItems",html:e}:{outlet:"#show\t",html:e}},afterRender:function(e,t){if(e){var r=t.dynamicParam;$("#dash_"+r).parent().addClass("sel");var i=$("#dashboardList");Crm.isHeadless||Territory.doHighLight("#dashboardList",i.find(".sel").eq(0),250,$(window).height()-280)}},actions:{onError:function(e,t,r){if("crm.tab.dashboards.view.expand"!==t.target&&CrmPlusImpl.trigger("serviceView.showError",["analytic_dashboard",{key:r.dynamicParam+"",errorType:"NO_ACCESS"}]),commonUtils.showHideLoadingDiv(),t.abort(),555===e.status&&"Dashboard Not Available"===e.responseText){var i=I18n.getMsg("crm.dashboard.not.available");renderingUtils.showCustomAlert(i,void 0,!1),$("#custom_alert_button").bind("click",(function(){Lyte.Router.transitionTo({route:"crm.tab.dashboards.index"})}))}else renderingUtils.displayPermissionDenied()}}}),Lyte.Router.registerRoute("crm.tab.dashboards.dashboardId.records",{queryParams:["criteria","FROM_INDEX","summaryValue","summaryCol","sortCol","orderBy","drill_down","subComponentId"],beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(e){var t=this.getQueryParams();return(t=t||{}).dbItemId=this.getDynamicParam(),t.action="fetchRecords",t.reportId=1,t.criteria=e.queryParams.criteria,t.drill_down=e.queryParams.drill_down,t.FROM_INDEX=e.queryParams.FROM_INDEX,t.summaryValue=e.queryParams.summaryValue,t.summaryCol=e.queryParams.summaryCol,t.isAjax=this.isAjax,t.subComponentId=e.queryParams.subComponentId,networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ReportsRelatedCV.do","GET",{params:t})},afterModel:function(){commonUtils.showHideLoadingDiv()},renderTemplate:function(e){return this.isAjax?e.FAILURE?void renderingUtils.showCustomAlert(parsedData.FAILURE,void 0,!1):{outlet:"#CVTable",html:(0,Handlebars.templates.SummaryReport)(e)}:{outlet:"#show",html:e}},afterRender:function(e){if(this.isFromCall)return $("#reportsPagNation").html(""),void CrmDashboard.setCallsNavigationDiv(e);this.isAjax&&($("#reportsPagNation").html(""),CrmDashboard.setNavigationDiv(e.requestedObj))}}),Lyte.Router.registerRoute("crm.tab.dashboards.view.expand",{queryParams:["isAnalyticsTrends"],model:function(e){var t={params:{action:"showDashboard",dbId:this.parent.getDynamicParam(),ajaxLoad:!0,isload:!0,window:"new",isAnalyticsTrends:e.queryParams.isAnalyticsTrends}};return t.params[csrfParamName]=csrfToken,networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/specific/Dashboard.do","POST",t)},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.voc.analytics",{getResources:function(){var e=networkUtils.returnDependencyFiles(["voc-analytics.js","lyte-hovercard.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["voc-analytics.css"],crmConstants.lessStaticPathForLyte),r=networkUtils.returnDependencyFiles(["zohocrm_voc_utilities.js"],crmConstants.jsStaticPath);return e.concat(t).concat(r)},beforeModel:function(){var e=this;return store.findAll("voc_source").then((function(){Lyte.Component.registeredHelpers.isVOCSourceAvailable()||($L("#vocErrorDiv")[0].innerHTML="",$L("crm-voc-module-container")[0].component.setData("error",!0),Lyte.Component.render("crm-voc-error-page",{message:I18n.getMsg("voc.data.source.not.available")},"#vocErrorDiv"),e.transition.abort())}))},redirect:function(){"crm.tab.voc.analytics"===this.transition.target&&this.replaceWith("crm.tab.voc.analytics.view",store.peekAll("voc_analytic")[0].id)},actions:{onError:function(e,t){500===e.status?($L("#vocErrorDiv")[0].innerHTML="",$L("crm-voc-module-container")[0].component.setData("error",!0),Lyte.Component.render("crm-voc-error-page",{message:I18n.getMsg("voc.load.error"),isRefresh:!0},"#vocErrorDiv")):this.handleError(JSON.parse(e.response)),t.abort()}}}),Lyte.Router.registerRoute("crm.tab.voc.analytics.view",{getResources:function(){var e=networkUtils.returnDependencyFiles(["voc-analytics-components.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["voc-analytics-components.css"],crmConstants.lessStaticPathForLyte);return e.concat(t)},beforeModel:function(){this.transition.data&&this.transition.data.refresh&&this.parent.parent.refresh(),this.unbindHighcharts(),this.unbindZCharts()},model:function(e){var t={};return store.findAll("module",{feature_name:"voc"}).then((function(r){var i=store.peekAll("voc_analytic"),a=e.dynamicParam,s=store.peekRecord("voc_analytic",a);t.supportedModules=r.filter((function(e){return e.visible&&e.viewable}));var o=t.supportedModules.map((function(e){return e.api_name})),n=[];return["default","computing"].forEach((function(e){var t=s[e+"_configuration"];t&&-1===o.indexOf(t.module.api_name)&&n.push(t.module.id)})),t.allDashboards=i,t.selectedDashboard=s,t.selectedFilter="customer_count",t.isModuleUnavailable=!1,t.error=!1,t.isVocModuleUnavailable=!1,t.errorMsg="",n.length>0?(t.isModuleUnavailable=!0,n=new Set(n),{unavailableModules:Array.from(n).map((function(e){return store.peekRecord("module",e).plural_label})),selectedDashboard:t.selectedDashboard,supportedModules:t.supportedModules,isModuleUnavailable:t.isModuleUnavailable,isVocModuleUnavailable:0===o.length,error:!0,errorMsg:"voc.dashboard.access.permission.denied"}):s.active?store.findRecord("voc_analytics_component",a).then((function(e){t.allComponentsMeta=e;var r=[];return e.forEach((function(e){r.contains(e.based_on)||r.push(e.based_on),r.length})),t.showFilter=r.length>1,t})):(t.error=!0,t.isVocModuleUnavailable=!0,"competitor_analysis_dashboard"===s.api_name?t.errorMsg="voc.dashboard.competitor.permission.denied":"survey_comparison_dashboard"===s.api_name&&(t.errorMsg="voc.dashboard.survey.permission.denied"),t)}))},afterModel:function(e,t){var r=document.getElementsByTagName("crm-voc-module-container")[0];r&&r.component.setData("selectedDashboard",t.dynamicParam),e.error||(e.computationalStatus=Lyte.Component.registeredHelpers.getComputationStatus(t.dynamicParam),e.subHeader=vocHelper.getSubHeader(e.selectedDashboard))},actions:{onError:function(e,t){if(500===e.status){$L("#vocErrorDiv")[0].innerHTML="",$L("crm-voc-module-container")[0].component.setData("error",!0);var r=I18n.getMsg("voc.load.error");Lyte.Component.render("crm-voc-error-page",{message:r,isRefresh:!0},"#vocErrorDiv")}else 401===e.status||403===e.status?(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.getRouteInstance().replaceWith("crm.tab.module.begin","Home")}),void 0)):this.handleError(JSON.parse(e.response));t.abort()},didTransition:function(){document.getElementsByClassName("lyteModalOpened").forEach((function(e){e.component.setData("ltPropShow",!1)})),document.getElementsByClassName("lyteAlertOpened").forEach((function(e){e.component.setData("ltPropShow",!1)}))}},renderTemplate:function(e){return{outlet:"#vocRightPanel",component:"crm-voc-analytics"}},afterRender:function(e,t){var r=document.getElementsByTagName("crm-voc-dashboard-view")[0];r&&r.scrollTo({left:0,top:0}),Lyte.triggerEvent("reloadDashboard",t.dynamicParam,!1)},didDestroy:function(){this.unbindHighcharts()}},{mixins:["voc-analytics-mixin"]}),Lyte.Router.registerRoute("crm.tab.module.actions",{getResources:function(){return networkUtils.returnDependencyFiles(["crm-inner-actions-template.css"],crmConstants.lessStaticPathForLyte)}}),Lyte.Router.registerRoute("crm.tab.module.associate-search",{getResources:function(){var e=[];return Crm.userDetails.isPhoneNoNewView&&(e=e.concat(Crm.returnPhoneFieldDependencyFiles())),e},queryParams:["phonenumber"],model:function(e){var t=e.queryParams.phonenumber,r=this.parent.getDynamicParam(),i=$("#ctinotifier");if(isNewCallView){var a="Leads"==r?"associate_lead":"associate_contact",s=document.createElement("phone-entity"),o=t?t.replace(/[^0-9]/g,""):t;s.setData({defaultvalue:t,defaultid:o,autotrigger:a}),s.style="display:none",document.body.appendChild(s)}else switch(Lyte.injectResources([networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("phonenumberassociate")],null)[0]]),r){case"Leads":i.append('<form name="ctiapileadsearch" onsubmit="return false;"><input type="hidden" id="Ctiapi_associated_lead_id"><input type="hidden" id="Ctiapi_associated_lead_name"></form>'),i.append('<input type="hidden" id="call_ctinumber" value="'+t+'">'),CTIAPI.associateLead();break;case"Contacts":i.append('<form name="ctiapicontactsearch" onsubmit="return false;"><input type="hidden" id="Ctiapi_associated_contact_id"> <input type="hidden" id="Ctiapi_associated_contact_name"><input type="hidden" name="property(modname)" id="Ctiapi_associated_contact_modname" value=""><input type="hidden" name="property(modid)" id="Ctiapi_associated_contact_modid"><input type="hidden" name="property(modsel)" id="Ctiapi_associated_contact_modsel" value="Accounts"></form>'),i.append('<input type="hidden" id="call_ctinumber" value="'+t+'">'),CTIAPI.associateContact()}}}),Lyte.Router.registerRoute("crm.tab.module.begin",{queryParams:["customizationId","category"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-list-kanban-container.js","crm-customview-dropdown.js","lyte-counter.js","crm-blank-states.js","crm-browser-version-check.js","crm-home-blankpage.js","crm-customview-helpers.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-list-kanban-container.css","crm-customview-dropdown.css","crm-blank-states.css","crm-home-blankpage.css"],crmConstants.cssStaticPathForLyte);e=e.concat(networkUtils.returnDependencyFiles(["crm-analytics.js"],crmConstants.jsStaticPathForLyte)),t=t.concat(networkUtils.returnDependencyFiles(["crm-analytics.css"],crmConstants.cssStaticPathForLyte));var r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("activitysubonboarding")]);return(e=(e=e.concat(r)).concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles()))).concat(t)},model:function(e){var t=this.parent.getDynamicParam();if(!("Home"!=t||this.transition.data&&this.transition.data.changeView)){var r={module:"Home",isload:!0};e.queryParams.customizationId&&(r.customizationId=e.queryParams.customizationId,r.category=e.queryParams.category),store.unloadAll("servapp_preferences");var i={params:r};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowDetails.do","GET",i)}if(this.transition.response&&"Home"!=t&&(1==this.transition.response.isDataWaitingForApproval||1==this.transition.response.data_waiting_for_approval))return store.findRecord("module",moduleRecordMapping[t].id,void 0,void 0,!0,{getMeta:!0})},redirect:function(){if(this.transition.response&&"Visits"==this.parent.getDynamicParam()&&!this.transition.data.donotRefresh){var e=this.refresh();e.response=this.transition.response,e.data={donotRefresh:!0}}},renderTemplate:function(e){if(Crm.userDetails.settings_disabled&&$("#tab_Setup").remove(),!this.transition.data||!this.transition.data.changeView){var t=this.parent.getDynamicParam();if("Home"!=t){if(this.currentModel=this.transition.response,this.currentModel.module_info&&"Potentials"==this.currentModel.module_info.module_name)if(this.currentModel.module_info.layouts.length){var r=this.currentModel.module_info.layouts.filterBy({name:"Standard"})[0];this.currentModel.deallayoutId=r?r.id:this.currentModel.module_info.layouts[0].id}else this.currentModel.deallayoutId=this.currentModel.deallayoutId?this.currentModel.deallayoutId:"";this.currentModel.begin_page=!0,this.currentModel.module_name=t;if(this.currentModel.zbModuleName={CustomModule5001:"Invoices",CustomModule5002:"Quotes",CustomModule5003:"PurchaseOrders",CustomModule5004:"SalesOrders"}[t],this.currentModel.hideGreyArea=!0,"Visits"==t){var i={allportals:I18n.getMsg("crm.salesiq.all.accounts")},a=this.currentModel.portal_name?this.currentModel.portal_name:customViewObject.screenName?customViewObject.screenName:"allportals";this.currentModel.screenName=a,this.currentModel.cvid=moduleRecordMapping.Visits.cvid;var s=objectUtils.cloneObject(CrmTracking.portalsInfo);for(var o in s)i[o]=s[o];this.currentModel.portalName=customViewObject.portalName="allportals"==this.currentModel.portal_name?i.allportals:i[this.currentModel.portal_name],this.currentModel.screenVsPortalJson=s,this.currentModel.portals=i}return 1==this.currentModel.isDataWaitingForApproval||1==this.currentModel.data_waiting_for_approval||"Visits"==t?(this.currentModel.cvid=this.currentModel.module_info.custom_view.id,{outlet:"#show",component:"crm-custom-outer-box"}):(this.currentModel.isZBCustomModule=crmTab.isZBCustomModule(t),this.currentModel.isZSCustomModule=crmTab.isZSCustomModule(t),this.currentModel.isDescriptionAvailable=this.currentModel.module_info.description&&null!==this.currentModel.module_info.description,this.parent.currentModel.cpqObj&&moduleRecordMapping.ZohoCPQ&&(crmTab.isZCpqTab(t)||crmTab.isZCpqSubTab(t))&&(this.currentModel.cpqobj=this.parent.currentModel.cpqObj,this.currentModel.enableCpqTab=!0),{outlet:"#show",component:"crm-begin-page"})}networkUtils.initChart(),$("#show").empty().html(e)}},afterRender:function(e){var t=this.transition.data;Object.keys(t).length>0&&(t.changeView?(CrmDashboard.loadDashboards(void 0,void 0,t.dataObj),this.transition.data.changeView=!1):t.homePageObj&&CrmDashboard.showSelectedHomePage(t.homePageObj,t.selectedHomeId,t.currentDate)),("Visits"==this.parent.getDynamicParam()||this.currentModel&&(1==this.currentModel.isDataWaitingForApproval||1==this.currentModel.data_waiting_for_approval))&&(customViewObject=e,this.renderVisitBlankState(customViewObject,"Visits"==this.parent.getDynamicParam()),CustomView.initFavorite())},renderVisitBlankState:function(e,t){e.isKanbanView&&t?Lyte.Component.render("crm-begin-page",e,"#visits_parent_div"):($("#idForCV").empty(),Lyte.Component.render("crm-begin-page",e,"#idForCV")),t&&(networkUtils.loadFeatureScripts(["zohocrm_visitsetup.js"],(function(){"allportals"!=e.screenName?VisitsConfig.getEmbedCode(e.screenName):VisitsConfig.getEmbedCode()})),0==$("#printviewBtn").length&&$(".customPluswithImpotBtnCon").hide())},actions:{willTransition:function(e){if(e.data&&e.data.checkPermission){var t,r=$(".lyteMenuItems .lyteMenuActive").data("value"),i=e.pause(),a=e.info.route;if(!t)switch(r){case"Home":t=!0;break;case"Leads":"crm.tab.module.create"===a?t=Crm.userDetails.permissions.Crm_Implied_Create_Leads:"crm.settings.import"===a?t=Crm.userDetails.permissions.Crm_Implied_Import_Leads:"crm.settings.section.extensions.social-extensions"===a?t=!0:"crm.settings.section.webform.index-webform"===a?t=Crm.userDetails.permissions.Crm_Implied_Web_To_Leads:"crm.settings.section.email-parser.index-email-parser"===a||"crm.settings.section.extensions.zoho-extensions.visit"===a?t="Administrator"===Crm.userDetails.PROFILE_NAME:"crm.settings.section.extensions.google-extensions.google-contacts"===a&&(t=Crm.userDetails.permissions.Crm_Implied_Gcontact_Sync);break;case"Contacts":"crm.tab.module.create"===a?t=Crm.userDetails.permissions.Crm_Implied_Create_Contacts:"crm.settings.import"===a?t=Crm.userDetails.permissions.Crm_Implied_Import_Contacts:"crm.settings.section.telephony"===a?t=Crm.userDetails.permissions.Crm_Implied_Zoho_PhoneBridge_Integ:"crm.settings.section.email-settings"===a?t=Crm.userDetails.permissions.Crm_Implied_Zoho_Mail_Integ:("crm.settings.section.extensions.social-extensions"===a||"crm.settings.section.sales-signals"===a)&&(t=!0);break;case"Accounts":"crm.tab.module.create"===a?t=Crm.userDetails.permissions.Crm_Implied_Create_Accounts:"crm.settings.import"===a?t=Crm.userDetails.permissions.Crm_Implied_Import_Accounts:"crm.settings.section.modules.index-modules"===a&&(t=Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM);break;case"Potentials":"crm.settings.section.modules.module.layouts.view-layout"===a?t=Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM:"crm.tab.module.create"===a?t=Crm.userDetails.permissions.Crm_Implied_Create_Potentials:"crm.settings.import"===a?t=Crm.userDetails.permissions.Crm_Implied_Import_Potentials:"crm.tab.dashboards.index"===a&&(t=Crm.userDetails.permissions.Crm_Implied_View_Dashboards);break;case"Activities":"crm.tab.module.create"===a?t=Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM:"crm.settings.section.telephony"===a&&(t=Crm.userDetails.permissions.Crm_Implied_Zoho_PhoneBridge_Integ);break;default:t=!0}t?i.resume():(i.abort(),renderingUtils.displayPermissionDenied())}},didTransition:function(){commonUtils.showHideLoadingDiv()}}}),Lyte.Router.registerRoute("crm.tab.module.create",{queryParams:["layoutId","wizardId"],getResources:function(e){return this.loadResources(e,this.parent.getDynamicParam())},cscript:function(){return{}},model:function(e){var t=objectUtils.cloneObject(this.transition.data);delete t.refreshPage,delete t.backOneLevel,delete t.checkPermission,delete t.isRefresh,delete t.isCreateChildCampaign;var r={},i=this.parent.getDynamicParam();if("Activities"==i&&(i=this.parent.getQueryParams().sub_module),r.module=i,t.wizardSwitch){var a=t.wizardSwitch;delete t.wizardSwitch}var s={params:r},o=moduleRecordMapping[i];if(t.isWizard||this.lyteConvertionSupported){(r=Object.assign(r,t)).relmodule&&"Deals"==r.relmodule&&(r.relmodule="Potentials");var n=moduleRecordMapping[i].id,l=store.peekRecord("module",n),c=l.layouts?l.layouts:void 0;if((this.lyteConvertionSupported||this.transition.data.isWizard)&&(!l||!l.creatable))return crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),void this.transition.abort();var d=this;if(this.currentModel||this.lyteConvertionSupported){var u=[];return u=c&&c.length?c:u,this.lyteConvertionSupported&&o&&o.api_supported&&Crm.userDetails.tabsUsedInWizards&&!window.clientPortalName&&-1!==Crm.userDetails.tabsUsedInWizards.indexOf(o.id)?store.findAll("wizard",{module:o.api_name},!1).then(function(i){return o.wizard=i||o.wizard,this.getCurrentLayoutInfo(u,t,l,e,r,a)}.bind(this)):this.getCurrentLayoutInfo(u,t,l,e,r,a)}s={data_type:"json",params:r};return(m={}).model=store.findRecord("module",o.id),o&&o.api_supported&&Crm.userDetails.tabsUsedInWizards&&!window.clientPortalName&&-1!==Crm.userDetails.tabsUsedInWizards.indexOf(o.id)&&(m.wizard=store.findAll("wizard",{module:moduleRecordMapping[i].api_name},!1)),Lyte.resolvePromises(m).then((function(s){return u=s.model[0].layouts,s&&s.wizard&&(moduleRecordMapping[i].wizard=s.wizard),t={isWizard:!0,selectedLayoutid:e.queryParams.layoutId+";"+e.queryParams.wizardId},d.getCurrentLayoutInfo(u,t,l,e,r,a)}))}if(delete t.isWizard,crmTab.isZBCustomModule(i)||crmTab.isZSCustomModule(i)?r.newModel=!0:(r.format="json",s.data_type="json"),(r=Object.assign(r,t)).relmodule&&"Deals"==r.relmodule&&(r.relmodule="Potentials"),r.primmodule&&"Products"===r.primmodule&&(r["property(productId)"]=r.entityid),Crm.requestParam=r,t.layoutId||e.queryParams.layoutId){"Tasks"!==i&&(r.layoutId=t.layoutId?t.layoutId:e.queryParams.layoutId),(new crmRequestPool).followOrder=!0;var m={};return(!this.currentModel||this.currentModel&&this.currentModel.model&&this.currentModel.model.module!==i)&&(["U","A","C","Z"].contains(Crm.userDetails.LICENSE_TYPE)||Crm.userDetails.ULTIMATE_ADDON_COUNT>0)&&o&&o.api_supported&&Crm.userDetails.tabsUsedInWizards&&!window.clientPortalName&&-1!==Crm.userDetails.tabsUsedInWizards.indexOf(o.id)&&(m.wizard=store.findAll("wizard",{module:moduleRecordMapping[i].api_name},!1)),m.model=networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Create.do","GET",s),Lyte.resolvePromises(m)}if(!t.layoutId)return(m={}).model=networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Create.do","POST",s),o&&o.api_supported&&Crm.userDetails.tabsUsedInWizards&&!window.clientPortalName&&-1!==Crm.userDetails.tabsUsedInWizards.indexOf(o.id)&&(m.wizard=store.findAll("wizard",{module:moduleRecordMapping[i].api_name},!1)),Lyte.resolvePromises(m).then((function(e){return e&&e.wizard&&(moduleRecordMapping[i].wizard=e.wizard),e}))},renderTemplate:function(e){CScriptLib&&CScript.Engine.Init(),Lyte._ignoreOnReady=!0;var t=objectUtils.cloneObject(this.transition.data),r=this.parent.getDynamicParam();if(e){if(null!=e.model&&"Layout_PermissionError"==e.model.error)return renderingUtils.showCustomAlert(I18n.getMsg("crm.label.layoutpermis"),void 0,!1,(function(){Lyte.Router.transitionTo({route:"crm.tab.module",dynamicParams:[r]})})),null;if(null!=e.model&&"Layout_DEACTIVATED"==e.model.error)return renderingUtils.showCustomAlert(I18n.getMsg("crm.label.layoutdelete"),void 0,!1,(function(){Lyte.Router.transitionTo({route:"crm.tab.module",dynamicParams:[r]})})),null}if(e.model&&(e=e.model),t.isWizard||this.lyteConvertionSupported){if(this.isInvalidLayoutError||this.isLayoutPermissionError){var i=this.isInvalidLayoutError?I18n.getMsg("crm.label.layoutdelete"):I18n.getMsg("crm.label.layoutpermis");return delete this.isInvalidLayoutError,delete this.isLayoutPermissionError,renderingUtils.showCustomAlert(i,void 0,!1,(function(){Lyte.Router.transitionTo({route:"crm.tab.module",dynamicParams:[r]})})),null}t.selectedLayoutId||window[r]||(window[r]=Object.create(crmCommonModule),window[r].moduleName=r),window[r]&&(window[r].currentStatus="create"),app.renderTemplate(this,{outlet:"#show",component:"crm-create-entity",reRender:!0}),commonUtils.showHideLoadingDiv(!1)}else{if("string"==typeof e)return{outlet:"#show",html:e};if("Activities"==r&&(r=this.parent.getQueryParams().sub_module),!t.selectedLayoutId){var a=Crm.getModuleObj(r);if(a.currentStatus="create",a.createTemplate(e),e.productLineItems){if(Crm.userDetails.isLookupAdvancedSearchEnabled){var s=e.productLineItems;s.fieldMeta=e.entityMapJson.PRODUCTDETAILS,productDetails.setValuesForAddedRowForEdit(s,void 0,void 0,void 0,!0)}else productDetails.setValuesForAddedRowForEdit(e.productLineItems,void 0,void 0,void 0,!0);productDetails.grandTaxChanged=!0;var o=$("#productList").find(".pB20");o.show(),o.find(".wrap").show(),$("#addLinesBtnLwr").hide(),loadClassFns1(),loadClassFns2(),productDetails.fillCurrencySymbolsInLineHeaders(),productDetails.fillCurrSymForGrandVals()}}if(this.currentModel.model.entityMapJson.SMOWNERID){var n="#"+r+"_fldRow_SMOWNERID";"Products"===r&&(n="#"+r+"_fldRow_HANDLER"),this.getRestrictionInfo(r,this.currentModel.model.entityMapJson.SMOWNERID.defaultid).then((function(e){if($("crm-threshold-grant").remove(),!1===e.allow){var t=document.createElement("crm-threshold-grant"),i=$(n+" .labelValCreate"),a=i.position().left,s=i.width();Crm.userDetails.RTL_ENABLED&&(a=-$(n+" .labelTabCreate").outerWidth());var o="position:relative;left:"+a+"px;width:"+s+"px;top:10px";return t.setData("rsGrantStyle",o),t.setData("moduleName",r),i.after(t),void commonUtils.showHideLoadingDiv()}}))}var l=Crm.requestParam;Crm.executeLayoutRule(Crm.getCrmBasePath()+"/Create.do",l,"edit")}removeFreezeLayer()},beforeModel:function(e){if(Crm.userDetails.isStorageLimitReached)return removeFreezeLayer(),Crm.showStorageExceedPopup(),void this.transition.abort();this.newTransition=!0;var t,r=this.parent.getDynamicParam(),i=this;return e.queryParams.wizardId?this.transition.data.isWizard=!0:this.transition.data.isWizard=!1,"Activities"==r&&(r=this.parent.getQueryParams().sub_module),void 0!==r&&"Quotes"===r&&Crm.client_tracking("CPQ-Quotes-Create Quote button in begin page"),t=store.peekRecord("module",moduleRecordMapping[r].id),this.transition.data.isRefresh?(this.transition.data.isRefresh=!1,void(Lyte.Router.getRouteInstance().refresh({refreshTemplate:!0}).data=this.transition.data)):t&&t.api_supported&&(this.lyteConvertionSupported||!e.queryParams.layoutId)&&-1===["CustomModule5001","CustomModule5002","CustomModule5003","CustomModule5004"].indexOf(r)?this.transition.data.skipModuleReqTrigger?(delete this.transition.data.skipModuleReqTrigger,e.queryParams.layoutId?"":i.setCreateQueryParam(r)):app.store.makeRequest("findRecord","module",moduleRecordMapping[r].id,{include:["layouts","lookup_field_properties","custom_view","related_lists","business_card_fields"]}).then((function(){return e.queryParams.layoutId?"":i.setCreateQueryParam(r)})):void delete this.transition.data.skipModuleReqTrigger},afterRender:function(e){Lyte._ignoreOnReady=!1;var t=this.parent.getDynamicParam();if(this.lyteConvertionSupported||this.transition.data.isWizard){if("Campaigns"===t&&e.moduleData&&e.moduleData.layouts.length)for(s=e.selectedLayoutid,o=(i=e.moduleData.layouts).length,n=(a=this.transition.data)&&"Campaigns"===a.primmodule&&a.entityid,l=0;l<o;l++){if(s===(c=i[l]).id){if(n||!c.created_by){d=n?"Child_Campaign_relatedList":"Campaign_listView";crmListView.trackCampaignCreatePage(d,c.name)}2!==c.status&&"campaign_integration"!==c.source||crmTemplate.handleSenderAddressErrorForZohoCampaigns(c);break}}removeFreezeLayer(),commonUtils.showHideLoadingDiv(!1)}else{var r=window.location.hash;if(r.length>0)(r=r.substring(1,r.length)).split("#").each((function(e){var t=e.split("=");if(2==t.length){var r,i=t[0],a=t[1];if(a.indexOf("||-||-||")>0){var s=a.split("||-||-||");2==s.length&&(a=s[0],r=s[1])}a=decodeURIComponent(a),(i=$("#"+i)).val(a),r&&i.data("id",r)}}));if("Campaigns"===t&&e.model&&e.model.layout_jsonarrayObj)for(var i,a,s=e.model.layout_jsonarrayObj.currLayoutId,o=(i=e.model.layout_jsonarrayObj.layout_jsonarrayObj).length,n=(a=this.transition.data)&&"Campaigns"===a.primmodule&&a.entityid,l=0;l<o;l++){var c;if(s===(c=i[l]).LAYOUTID){if(n||"12"===c.SOURCE){var d=n?"Child_Campaign_relatedList":"Campaign_listView";crmListView.trackCampaignCreatePage(d,c.LAYOUTNAME)}"12"===c.SOURCE&&crmTemplate.handleSenderAddressErrorForZohoCampaigns(e.model);break}}}Crm.userDetails.isStorageLimitReached&&Crm.showStorageExceedPopup("new_page");try{if(renderingUtils.windowWidth<=1200&&("Leads"==t||"Contacts"==t||"Accounts"==t||"Potentials"==t)){var u=navigator.userAgent.toLowerCase(),m={place:"Create page - "+t};u.includes("iphone")?m.tab_device="iPhone":u.includes("ipad")?m.tab_device="iPad":u.includes("android")&&(m.tab_device="Android"),renderingUtils.windowWidth<=1200&&renderingUtils.windowWidth>1e3?m.widthRange="below 1200":renderingUtils.windowWidth<=1e3&&renderingUtils.windowWidth>900?m.widthRange="below 1000":renderingUtils.windowWidth<=900&&(m.widthRange="below 900"),renderingUtils.windowWidth>renderingUtils.windowHeight&&(m.isLandscape=!0),Crm.trackSpotLightAction("Tab Device tracking",m)}}catch(e){murphy.error(e)}CScriptLib&&CScript.dispatchEvent("onLoad")},getRestrictionInfo:function(e,t){return Lyte.registeredMixins["crm-assignment-threshold-common"].restrictionGrantCheck(e,t)},actions:{willTransition:function(e){if(Lyte.Router.checkIfSameRoute(this.transition.info,e.info)&&e.data&&e.data.refreshPage){e.data&&e.data.refreshPage&&delete e.data.refreshPage,this.refresh({refreshTemplate:!0}).data=this.transition.data,window.scrollTo(0,0)}for(var t=$("crm-image-upload-create"),r=t.length,i=0;i<r;i++)for(var a=t[i].component.data.imageData.length,s=0;s<a;s++){var o=t[i].component.data.imageData[s];URL.revokeObjectURL(o.src)}},onError:function(e,t){this.lytecrudRouteErrorHandling(e,t)}},getDependencies:function(){return this.loadRouteDependencies()},didDestroy:function(){this.rollBackCreateEntityRecord()},afterModel:function(e){var t=this.parent.getDynamicParam(),r=objectUtils.cloneObject(this.transition.data);if(this.lyteConvertionSupported||r.isWizard)return this.handleLyteCreateAfterModelchanges(e,t,"create");if(e.model&&e.model.title&&this.setTitle(e.model.title),e.model&&e.model.webinar_trial_expired){var i=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zohowebinar")]),a=networkUtils.returnDependencyFiles(["crm-webinar-common.js","crm-webinar-data-store.js"],crmConstants.jsStaticPathForLyte),s=networkUtils.returnDependencyFiles(["crm-webinar-common.css"],crmConstants.cssStaticPathForLyte);Lyte.injectResources(i.concat(a.concat(s)),void 0,(function(){Lyte.Component.render("crm-webinar-trial-expiry-modal",e,"#show")})),this.transition.abort()}null!=e.model&&"crm.error.services.limit"==e.model.error&&(renderingUtils.showCustomAlert(I18n.getMsg("crm.error.services.limit",moduleRecordMapping.Appointments.singular_label),"",!1),this.transition.abort()),("crm.campaign.integ.sandbox.not.supported"===e.error||e.model&&"crm.campaign.integ.sandbox.not.supported"===e.model.error)&&(crmui.showMsgBand("error",I18n.getMsg("crm.campaign.integ.sandbox.not.supported",crmTab.getDisplayName("Campaigns",!1).toLowerCase()),3e3),this.transition.abort(),this.transitionTo({route:"crm.tab.module.custom-view.list",dynamicParams:app.prevTransition.dynamicParams})),e.model&&(e=e.model);var o=Crm.requestParam;e.isCreateChildCampaign=this.transition.data&&this.transition.data.isCreateChildCampaign,(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(o.module))&&Crm.downloadValidationRules(Crm.getCrmBasePath()+"/Create.do?format=json&module="+o.module+(o.layoutId?"&layoutId="+o.layoutId:""),o.module)},beforeExit:function(){this.unloadWizardComponents();var e=this.parent.getDynamicParam();"Activities"==e&&(e=this.parent.getQueryParams().sub_module),"Tasks"==e&&delete window[e].whoIdModulesArr},setCreateQueryParam:function(e){var t={},r=this.transition.info;if("Activities"===this.parent.getDynamicParam()&&(t.sub_module=this.parent.getQueryParams().sub_module),this.transition.data.layoutId)t.layoutId=this.transition.data.layoutId;else for(var i=Crm.userDetails.PROFILE_NAME,a=moduleRecordMapping[e].layouts,s=a.length,o=0;o<s;o++)for(var n=a[o].profiles.length,l=0;l<n;l++)if(a[o].profiles[l].default&&a[o].profiles[l].name===i){t.layoutId=a[o].id,!window.clientPortalName&&(["U","A","C","Z"].contains(Crm.userDetails.LICENSE_TYPE)||Crm.userDetails.ULTIMATE_ADDON_COUNT>0)&&a[o].profiles[l]._default_view&&"wizard"===a[o].profiles[l]._default_view.type&&(t.wizardId=a[o].profiles[l]._default_view.id);break}t.layoutId&&(this.transition.data.skipModuleReqTrigger=!0,this.replaceWith(r.route,r.dynamicParams[0],t).data=this.transition.data)},getCurrentLayoutInfo:function(e,t,r,i,a,s){e&&e.length&&(e=(e=Lyte.deepCopyObject(e)).sort((function(e,t){var r=e.name.toUpperCase(),i=t.name.toUpperCase();return r<i?-1:r>i?1:0})));var o,n,l,c=r.module_name,d=r.id,u=e?e.length:0,m=[],p=!1,g=0,f=Crm.userDetails.PROFILE_NAME,h=!1;Lyte.Router.getRouteInstance().transition.data.wizardSwitch=s;for(var y=0;y<u;y++)if(e[y].status>=0||!0===e[y].status||"active"===e[y].status){p="Campaigns"===c&&"active"===e[y].status&&"campaign_integration"===e[y].source||p;var v=!1;if(e[y].profiles)for(var _=e[y].profiles.length,b=(h=!1,0);b<_;b++)if(e[y].profiles[b].name===f&&(v=!0),e[y].profiles[b].default&&f===e[y].profiles[b].name){o=e[y].name,n=e[y].id,h=!0;break}v&&(m[g]={uservalue:e[y].name,systemvalue:e[y].id,id:e[y].id,isDefault:h,status:e[y].status,source:e[y].source},g++)}if(i.queryParams.layoutId&&i.queryParams.wizardId?(n=i.queryParams.layoutId,l=i.queryParams.wizardId,t.selectedLayoutid=t.selectedLayoutid?t.selectedLayoutid:i.queryParams.layoutId+";"+i.queryParams.wizardId):t.isWizard?(n=t.selectedLayoutid.split(";")[0],l=t.selectedLayoutid.split(";")[1]):i.queryParams.layoutId&&(n=i.queryParams.layoutId),l&&(0!==store.peekRecord("layout",n).profiles.filter((function(e){return e.name===Crm.userDetails.PROFILE_NAME})).length&&0!==store.peekRecord("wizard",l).profiles.filter((function(e){return e.name===Crm.userDetails.PROFILE_NAME})).length||(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.wizard.no.view.permission")),this.transition.abort())),"Campaigns"===c&&(a.layoutId||i.queryParams.layoutId)){var w=a.layoutId||i.queryParams.layoutId,C=m.filter((function(e){return e.id===w}))[0];C&&(o=C.uservalue,n=C.id)}if(!n&&m&&m.length)if("Campaigns"===c){var D=m.filter((function(e){return"crm"===e.source}))[0];D=D||m[0],o=D.name,n=D.id,D.isDefault=!0}else o=m[0].name,n=m[0].id,m[0].isDefault=!0;return commonUtils.showHideLoadingDiv(!0),this.getModulePromise(n,r.api_name,c,void 0,l,void 0,!this.lyteConvertionSupported).then((function(e){if(e.custom_button&&e.custom_button.length&&(e.custom_button=e.custom_button.filter((function(e){return"create_clone"==e.position}))),e.wizard){var s,u=store.peekRecord("wizard-container",n),g=u.chart_data.nodes.length,h=[];u.custom_buttons_array.forEach((function(e){var t=store.peekRecord("wizard-button",e);t.resource&&t.resource.id&&!store.peekRecord("custom_button",t.resource.id)&&(t.hide=!0)}));for(var y=0;y<g;y++){var v=u.chart_data.nodes[y];if(v.start_node){var _=store.peekRecord("wizard-screen",v.screen.id);s=_.segments,h.push({id:_.id,name:_.name,index:0});break}}}var b,w=r.wizard,C=w?w.length:0,D=[];for(y=0;y<C;y++){var L=w[y];if(L.active){for(var R=L.profiles.length,P=!1,I=0;I<R;I++)if(f===L.profiles[I].name){P=!0;break}if(t.isWizard){var S=t.selectedLayoutid?t.selectedLayoutid.split(";")[0]:i.queryParams.layoutId,M=w[y].layouts.length;for(I=0;I<M;I++)S===L.layouts[I].id&&(b=L.layouts[I].name)}if(P){if(m&&m.length&&L.layouts&&L.layouts.length){var k=m.mapByKey("id"),T=[];L.layouts.forEach((function(e){k.contains(e.id)&&T.push(e)})),L.layouts=T&&T.length?T:L.layouts}D.push({uservalue:L.name,layouts:L.layouts,id:L.id})}}}return n=n||(e.layout&&e.layout[0]?e.layout[0].id:n),{initRoute:"create",entityrecordData:e.editEntitydata?e.editEntitydata[0]:{},transitionData:a,showInteglayoutoption:p,layoutRules:e.layout_rule,validationRules:e.validation_rule,customButtons:e.custom_button,moduleData:r,moduleId:d,moduleName:c,currsubformApinames:r.currsubformApinames?r.currsubformApinames:[],layoutddData:m,layoutddSelected:o,selectedLayoutid:l?n+";"+l:n,moduleSections:l?s:e.layout&&e.layout[0]?e.layout[0].sections:[],layoutDet:e.layout,wizardData:D,isWizard:t.isWizard,wizardId:t.selectedLayoutid,wizardName:b,screenHistory:h,surveyDepartments:e.survey_departments?e.survey_departments:[],webinarIntegration:e.webinarIntegration?e.webinarIntegration:void 0,fcCategory:e.fc_category?e.fc_category.stages:[],skyEyeIntegration:!!(e.skyEyeIntegration&&validationUtils.isNotEmpty(e.skyEyeIntegration)&&e.skyEyeIntegration.configured),currentModuleAutoEnrichment:e.auto_enrichment}}))}},{mixins:["crm-create-mixin"]}),app.cscript_registry({route_name:"crm.tab.module.create",category:I18n.getMsg("crm.label.module"),config:[{enabled:function(){return!Lyte.Router.getRouteInstance().transition.info.queryParams.wizardId&&store.peekAll("module").filter((e=>e.api_supported&&e.visible&&e.show_as_tab&&e.presence_sub_menu&&!_cscript._unsupported_modules.includes(e.api_name)&&!crmTab.isZBCustomModule(e.api_name)&&!crmTab.isZECustomModule(e.api_name)&&!crmTab.isZSCustomModule(e.api_name))).filter((e=>e.module_name===Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]||"crm-cscript"===Lyte.Router.getRouteInstance().routeName)).length>0},name:I18n.getMsg("com.page.createpage"),unique_name:"module_create",handlers:["CreatePageHandler"],display_tag:!0,selectors:[{name:"Module",label:I18n.getMsg("crm.label.module"),key:"$dynamicParam:crm.tab.module.create:0",definition:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_module_definitions()}},{name:"Layout",label:I18n.getMsg("crm.lable.layout"),key:"$queryParam:layoutId",definition:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_layout_definitions(e)}}],preview_route:function(e){return{route:"crm.tab.module.create",dynamicParams:[e.Module],queryParams:{layoutId:e.Layout}}},page_info:function(e){return{name:I18n.getMsg("com.page.createpage"),module:store.peekAll("module").find((t=>t.module_name===e.Module)).api_name,layout_id:e.Layout}},events:{page:{name:I18n.getMsg("com.cscript.pageevents"),label:I18n.getMsg("crm.social.integ.type.page"),list:[{event:"onLoad",args:[]},{event:"onChange",args:["field_name"]},{event:"onSave",args:[]}]},field:{name:I18n.getMsg("com.cscript.fieldevents"),label:I18n.getMsg("crm.field.label"),child:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_fields(e)},child_label:I18n.getMsg("crm.field.label"),list:[{event:"onChange",args:["value"]}]}}}]}),Lyte.Router.registerRoute("crm.tab.module.custom-view",{forceFetch:function(){if(this.transition.info.queryParams.filters){var e=this.transition.info.queryParams,t=JSON.parse(e.filters),r=0,i=t.length;for(r=0;r<i;r++)if(t[r]&&"tag"==t[r].searchfieldtype)return this.isOldTagCriteria=t[r],!1}return!0},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-custom-view.js","crm-custom-filter.js","crm-custom-button-wrapper.js","crm-vision-helper.js","crm-list-helpers.js","crux-smart-filter.js","crux-smart-filter-input.js","crm-list-kanban-container.js","crm-customview-dropdown.js","lyte-counter.js","scoringrules_store.js","crm-customview-helpers.js","crm-tag-modal.js","crux-tag.js","crm-page-navigator.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-list-kanban-container.css","crm-customview-dropdown.css","custom-view-layer-common.css","crm-page-navigator.css"],crmConstants.cssStaticPathForLyte);if(t=t.concat(networkUtils.returnDependencyFiles(["custom-view-layer-new.css","crux-smart-filter.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["custom-view-layer-new-rtl.css"],crmConstants.cssStaticPathForLyte))),"Services"!=this.parent.getDynamicParam()&&"Appointments"!==this.parent.getDynamicParam()||(e=(e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_services.js"]))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")]))),Crm.isCpqActivated()&&moduleRecordMapping.Quotes&&this.parent&&this.parent.parent&&this.parent.getDynamicParam()===moduleRecordMapping.Quotes.module_name){var r=networkUtils.returnDependencyFiles(["crm-cpqdashboard.js"],crmConstants.jsStaticPathForLyte);r=(r=(r=r.concat(networkUtils.returnDependencyFiles(["crm-cpqdashboard.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles()))).concat(networkUtils.returnDependencyFiles(["zohocrm_analytics.js"])),e=e.concat(r)}var i=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("recommendation_custom")],crmConstants.jsStaticPath);return e.concat(t).concat(i)},model:function(){if(this.transition.data&&this.transition.data.reloadAll)return{};var e=this.parent.getDynamicParam();return this.getCustomViewData(e,this.getDynamicParam(),this.transition)},afterModel:function(e){if(crmHistory.transitionError)return{};if(this.transition.data&&this.transition.data.reloadAll)return{};var t=this.parent.getDynamicParam();e.actions=moduleRecordMapping[t].actions,e.module_name=t,e.module_info=moduleRecordMapping[t],e.cvid=this.getDynamicParam(),e.saved_filters=this.currentModel.saved_filters?this.currentModel.saved_filters:[]},redirect:function(){},afterRender:function(){Crm.getRouteObject(this.transition);var e=$(".cvBtnHeader").hasClass("topFixed");if("Potentials"!=this.parent.getDynamicParam()&&"Visits"!=this.parent.getDynamicParam()||Crm.trackSpotLightAction(this.parent.getDynamicParam()+" - Page Visited"),e){var t=$("#cvpadding").outerHeight();window.scrollTo(0,t)}else null==Crm.latestEntId&&window.scrollTo(0,0);var r=networkUtils.returnDependencyFiles(["crm-mass-actions.js","lyte-hovercard.js","crm-mass-action-mixin.js"],crmConstants.jsStaticPathForLyte);r=r.concat(networkUtils.returnDependencyFiles(["crm-mass-action.css"],crmConstants.lessStaticPathForLyte)),Lyte.injectResources(r)},actions:{onError:function(e,t){t.resume()},didTransition:function(){this.transition.data&&(delete this.transition.data.clearCache,delete this.transition.data.clearselectedIds)},willTransition:function(e){0==e.target.indexOf("crm.tab.module.actions")&&crmTab.deleteFromCache(this.parent.getDynamicParam())}},beforeExit:function(){commonUtils.getTextWidthUsingCanvas.canvasElem&&commonUtils.destroyCanvasElem();-1!=["CustomModule5001","CustomModule5002","CustomModule5003","CustomModule5004"].indexOf(this.parent.getDynamicParam())&&crmTab.deleteFromCache(this.parent.getDynamicParam())}},{mixins:["crm-view-utils"]}),Lyte.Router.registerRoute("crm.tab.module.entity",{queryParams:["redirect","newSignUp"],redirect:function(){if(location.host.includes("zoho.in")&&"60010197171"===crmZgid&&(detailview_log.entityRedirect_start=performance.now(),void 0===detailview_log.logStartTime&&(detailview_log.logStartTime=(new Date).getTime())),"crm.tab.module.entity.canvas"!==this.transition.target&&"crm.tab.module.entity.convert"!==this.transition.target&&"crm.tab.module.entity.edit"!==this.transition.target&&"crm.tab.module.entity.clone"!==this.transition.target&&"crm.tab.module.entity.find-and-merge"!==this.transition.target&&"false"!==this.transition.info.queryParams.redirect&&"crm.tab.module.entity.add-contact-role"!==this.transition.target&&"crm.tab.module.entity.edit-contact-role"!==this.transition.target||"crm.tab.module.entity.edit"!==this.transition.target&&"canvas"===Crm.layoutReqFrom){var e=this.parent.getDynamicParam(),t=this.getDynamicParam(),r=this.transition.data,i=this,a=this.getQueryParams().newSignUp,s=["SalesOrders","Quotes"],o=function(o){var n;o[0]&&("Leads"!=e||null==window[e].currentStatus||"create"!=window[e].currentStatus&&"edit"!=window[e].currentStatus&&"clone"!=window[e].currentStatus||!o[0].$converted?detailView.isBlueprintPageRefresh&&(detailView.isBlueprintPageRefresh=!1):detailView.isRecordConverted=!0,o[0].$state&&"draft"===o[0].$state?i.replaceWith({route:"crm.tab.module.entity.edit",dynamicParams:[e,t]}):(o[0].$converted&&!s.contains(e)||!o[0].$canvas_id||(i.replaceWith({route:"crm.tab.module.entity.canvas",dynamicParams:[e,t,o[0].$canvas_id]}).data={replaced:!0,recordNum:r.recordNum,cvId:r.cvId,skipRecordFetch:!0,newSignUp:a}),Crm.layoutReqFrom&&(Crm.layoutReqFrom=void 0,crmNavig&&crmNavig[crmNavig.customViewKey]&&crmListView.getObject().fromIndex&&crmListView.getObject().toIndex&&(n=crmNavig[crmNavig.customViewKey].recordId.map((function(e){return e.id})).indexOf(t)),n&&n>0?i.replaceWith({route:"crm.tab.module.entity.detail",dynamicParams:[e,t]}).data={FROM_INDEX:crmListView.getObject().fromIndex,TO_INDEX:crmListView.getObject().toIndex,recordNum:n,cvid:customViewObject.cvId,fromDel:!1,navig:!0}:i.replaceWith({route:"crm.tab.module.entity.detail",dynamicParams:[e,t]}))))},n=moduleRecordMapping[this.parent.getDynamicParam()].id;return store.modelFor(n)&&moduleRecordMapping[this.parent.getDynamicParam()].fields?store.findRecord(moduleRecordMapping[this.parent.getDynamicParam()].id,this.getDynamicParam(),{approved:"both",converted:"both",formatted_currency:!0,home_converted_currency:!0}).then(o,(function(){})):store.findRecord("module",n).then(function(){return store.findRecord(n,this.getDynamicParam(),{approved:"both",converted:"both",formatted_currency:!0,home_converted_currency:!0}).then(o,(function(){}))}.bind(this))}},afterRender:function(){location.host.includes("zoho.in")&&"60010197171"===crmZgid&&(detailview_log.entityRedirect_end=performance.now(),detailview_log.entityRedirect_diff=detailview_log.entityRedirect_end-detailview_log.entityRedirect_start)},getResources:function(){this.transition.info.dynamicParams[0];var e=networkUtils.returnDependencyFiles(["crm-existing-email-quickinfo.js","crm-image-upload-ziaError.js","crm-vision-helper.js","exif-plugin.js","lyte-colorbox.js","crm-ziavision-myjobs.js","crm-entity-lookup.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-existing-email-quickinfo.css","crm-custom-rl.css","crm-image-upload-ziaError.css"],crmConstants.cssStaticPathForLyte);t=Crm.userDetails.RTL_ENABLED?t.concat(networkUtils.returnDependencyFiles(["crm-ziavision-myjobs.css","crm-ziavision-myjobs-rtl.css","crm-entity-lookup-rtl.css"],crmConstants.cssStaticPathForLyte)):t.concat(networkUtils.returnDependencyFiles(["crm-ziavision-myjobs.css"],crmConstants.cssStaticPathForLyte));var r=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Lookup")],crmConstants.jsStaticPath))).concat(t);return"Quotes"===this.transition.info.dynamicParams[0]&&Crm.isCpqActivated()&&(r=(r=r.concat(networkUtils.returnDependencyFiles(["crm-cpq-appliedrules.js","lyte-hovercard.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-cpq-appliedrules.css"],crmConstants.cssStaticPathForLyte))),Crm.userDetails.isPhoneNoNewView&&(r=r.concat(Crm.returnPhoneFieldDependencyFiles())),location.host.includes("zoho.in")&&"60010197171"===crmZgid&&detailview_log.getRes.push(r),r},beforeExit:function(){commonUtils.getTextWidthUsingCanvas.canvasElem&&commonUtils.destroyCanvasElem()},addLogger:function(e,t){var r={type:"custom event"};r.message=e,murphy.addCustomTracking(r),murphy.error(new Error(t))}}),Lyte.Router.registerRoute("crm.tab.module.fields-value-collector",{queryParams:["sub_module","hiddenFieldsSysRefName","requiredSectionsSysRefName"],beforeModel:function(e){var t=e.queryParams.sub_module;"Activities"===this.parent.currentModel.module_name&&"Calls"===t&&isNewCallView||renderingUtils.showCustomAlert(I18n.getMsg("crm.calls.error.noadditional.field"),null,null,(function(){WindowsCommunicator.notifyParent("cancel-operation")}))},model:function(e){var t=e.queryParams,r=null;t.requiredSectionsSysRefName&&(r=t.requiredSectionsSysRefName.split(","));var i=Crm.getCrmBasePath()+"/GetFieldsForCallSections.do",a={};a.sectionsName=r&&JSON.stringify(r);var s={params:a};return networkUtils.lyteInitiateRequest(i,"GET",s)},afterRender:function(e,t){if(e.Calls&&e.Calls.section&&e.Calls.section[0]&&Object.keys(e.Calls.section[0]).length>0){var r=e.Calls.section.length>1,i=r?Calls.getCallHeaderLabel():e.Calls.section[0].displaylabel,a=!1,s=e.Calls.section.length,o=t.queryParams,n=null;o.hiddenFieldsSysRefName&&(n=o.hiddenFieldsSysRefName.split(","));for(var l=s-1;l>=0;l--){var c=e.Calls.section[l];if(c.FL instanceof Array)for(var d=c.FL.length-1;d>=0;d--){var u=c.FL[d];-1==n.indexOf(u.sysRefName)&&"true"!==u.readonly?a=!0:c.FL.splice(d,1)}else-1==n.indexOf(c.FL.sysRefName)&&"true"!==c.FL.readonly?a=!0:e.Calls.section.splice(l,1)}if(!a||e.Calls.section.length<=0)return void renderingUtils.showCustomAlert(I18n.getMsg("crm.calls.error.noadditional.field"),null,null,(function(){WindowsCommunicator.notifyParent("cancel-operation")}));var m=new CrmCallForm("FieldsCollectorForm",$("#createEditCallHeader"),i,$("#createEditCallPopup"),e);m.postRenderProcess=function(){m.postRenderProcessForCommonDiv(!0),!r&&m.showDiv.find(".editParentSection").find("table:first").remove(),$("#createEditCallButtons,#c2cPromiseButtons").hide(),$("#fieldsValueCollectorButtons").show(),crmTemplate.setDependentFields("Calls",window.Calls.currentStatus,m.showDiv)},m.show()}else renderingUtils.showCustomAlert(I18n.getMsg("crm.calls.error.noadditional.field"),null,null,(function(){WindowsCommunicator.notifyParent("cancel-operation")}))},actions:{onError:function(){renderingUtils.showCustomAlert(I18n.getMsg("crm.calls.error.noadditional.field"),null,null,(function(){WindowsCommunicator.notifyParent("cancel-operation")}))}}}),Lyte.Router.registerRoute("crm.tab.module.index-module",{queryParams:["id","action","key"],beforeModel:function(){var e=this.parent.getDynamicParam();if(null!=moduleRecordMapping[e]||"OneFeeds"==e);else{var t=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/"),r=window.location.pathname.split(t)[1];this.replaceWith("crm.crm-error",r).data={showError:!0,module:e,errorMsg:I18n.getMsg("module.not.available")}}},model:function(){var e=this.parent.currentModel.module_name;if("SalesInbox"==e){if(!crmTab.isSalesInboxAvailable)return void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"));if(crmTab.isMailClientEnabled&&!crmTab.isMailClientActive)return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/SalesInboxIntro.do","GET",{params:{action:"showIntro"}});crmTab.isMailClientActive&&(this.transition.abort(),"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()?window.open(RebrandLinkUtil.getProperty("URLPROTOCOL")+"://"+RebrandLinkUtil.getProperty("CRMURL")+Crm.getOrgSpecificURL(Urls.Salesinbox)):window.location=crmHistory.locationOrigin+Crm.getOrgSpecificURL(Urls.Salesinbox))}else{if("ABM"==e){if(this.transition.abort(),!crmTab.isABMAvailable)return void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"));this.transition.abort();var t="/crm/"+crmPortal+"/abm/connect";return crmTab.isABMConfigured&&(t="/crm/"+crmPortal+"/abm/home"),void("undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()?networkUtils.openUrl(RebrandLinkUtil.getProperty("URLPROTOCOL")+"://"+RebrandLinkUtil.getProperty("CRMURL")+t):window.location=window.location.origin+t)}if(!this.transition.response||!this.transition.response.skipRedirect||this.transition.response.refetchInfo){var r={isload:!0};r.module=e;var i=Crm.getCrmBasePath()+"/ShowDetails.do";moduleRecordMapping[e].web_link&&(r.webTab=!0);var a=objectUtils.cloneObject(this.transition.data);if(delete a.backOneLevel,Object.assign(r,a),"Feeds"==e&&"showAutoFollowRules"==this.getQueryParams().action){this.getQueryParams().id;r.action="showAutoFollowRules",r.id=this.getQueryParams().id}else"Feeds"!=e&&"OneFeeds"!=e||!this.getQueryParams().key||(r.action=this.getQueryParams().action,r.key=this.getQueryParams().key,0===$(".Feeds_notifications").length&&(r.fetchNotifications=!0),r.module=this.parent.getDynamicParam());var s={params:r};return networkUtils.lyteInitiateRequest(i,"GET",s)}}},renderTemplate:function(e,t){return this.transition.response&&this.transition.response.skipRedirect&&!this.transition.response.refetchInfo&&(e=this.transition.response.model),"SalesInbox"==this.parent.currentModel.module_name&&Crm.trackSpotLightAction("SalesInbox - Tab Click"),{outlet:"#show",html:e}},afterRender:function(e,t){var r=this.parent.currentModel.module_name;"Feeds"!=r&&"OneFeeds"!=r||$("#feedParentDiv").show()},beforeExit:function(){"undefined"!=typeof CrmWidget&&CrmWidget&&CrmWidget.FreezeWidget&&(WidgetHandler.EventNotifier.pageUnload(CrmWidget.FreezeWidget),$("#crmPopContent").addClass("hide"))}}),Lyte.Router.registerRoute("crm.tab.module.modal-create",{queryParams:["sub_module","listenData","callType","callStatus","formName"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-call-form-resources.js"],crmConstants.jsStaticPathForLyte);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-call-menu.js","crm-manual-call-list.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-create-resources.js","crm-wizard-common-helpers.js","crm-entity-lookup.js","crux-tag.js","lyte-scrollTo.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-create-resources.css","crm-list-view-crux.css"],crmConstants.cssStaticPathForLyte)),e=Crm.userDetails.RTL_ENABLED?e.concat(networkUtils.returnDependencyFiles(["crm-call-form-resources-rtl.css"],crmConstants.cssStaticPathForLyte)):e.concat(networkUtils.returnDependencyFiles(["crm-call-form-resources.css"],crmConstants.cssStaticPathForLyte))},beforeModel:function(e){var t=this.parent.currentModel.module_name,r=e.queryParams;"Activities"===t&&"Calls"===r.sub_module||this.transition.abort(),"Outgoing"!==e.queryParams.callType&&"outgoing"!==e.queryParams.callType||(e.queryParams.callType="Outbound"),"Incoming"!==e.queryParams.callType&&"incoming"!==e.queryParams.callType&&"missed"!==e.queryParams.callType||(e.queryParams.callType="Inbound")},model:function(e){var t=this.parent.getDynamicParam(),r=objectUtils.cloneObject(this.transition.data);delete r.refreshPage,delete r.backOneLevel,delete r.checkPermission;var i={};"Activities"===(t=this.parent.currentModel.module_name)&&(t=this.parent.getQueryParams().sub_module),i.module=t,crmTab.isZBCustomModule(t)||crmTab.isZSCustomModule(t)?i.newModel=!0:i.format="json",(i=Object.assign(i,r)).relmodule&&"Deals"===i.relmodule&&(i.relmodule="Potentials"),i.primmodule&&"Products"===i.primmodule&&(i["property(productId)"]=i.entityid);var a,s=this.parent.currentModel,o=s.module_name;return"Activities"===s.module_name?(o=this.parent.getQueryParams().sub_module,a=moduleRecordMapping[o].id):a=moduleRecordMapping[s.module_name].id,this.getModuleData().then(function(t){for(var r,s,n=t[0],l=n?n.layouts:[],c=l?l.length:0,d=[],u=0,m=Crm.userDetails.PROFILE_NAME,p=0;p<c;p++){for(var g=l[p].profiles.length,f=0;f<g;f++)if(l[p].profiles[f].default&&m===l[p].profiles[f].name){r=l[p].name,s=l[p].id;break}d[u]={uservalue:l[p].name,systemvalue:l[p].id,id:l[p].id},u++}var h,y=e.queryParams.formName,v={};"true"===e.queryParams.listenData&&(h=this.getCallBackparamPromise());var _=this.getModulePromise(s,n.api_name,o),b=this.getWhatIdArrPromise();return Promise.all([_,b,h]).then(function(t){for(var l=t[0],c=l.layout[0].sections,u=c.length,m={},p=0;p<u;p++){for(var g=!1,f=c[p].api_name,h=c[p].fields.length,_=0;_<h;_++){"Description"===c[p].fields[_].api_name&&(c[p].fields[_].visible=!1,g=!0)}(h<=0||h<=1&&g)&&(m[f]=!0)}var b=this.checkNoFieldsErrorHandling(e.queryParams.callType,e.queryParams.callStatus,m);return b||this.transition.abort(),v=this.getAdditionalEntityData(b.callType,b.callStatus),this.removeMandatoryFromLayoutRules(l.layout_rule,"Who_Id"),{formName:y,formTitle:"Add Call Details",initRoute:"create",entityrecordData:l.editEntitydata?l.editEntitydata[0]:{},transitionData:i,layoutRules:l.layout_rule,validationRules:l.validation_rule,customButtons:l.custom_button,moduleData:n,moduleId:a,moduleName:o,layoutddData:d,layoutddSelected:r,selectedLayoutid:s,moduleSections:l.layout[0].sections,layoutDet:l.layout,additionalEntityData:v,callBackParam:t[2],whatIdModuleArray:this.whatIdArr,whoIdLabel:I18n.getMsg("crm.activities.call.label.callee"),isServerData:this.getIsServerData()}}.bind(this))}.bind(this))},renderTemplate:function(){return{outlet:"#show",component:"crm-call-form"}}},{mixins:["crm-create-mixin","crm-call-form-mixin"]}),Lyte.Router.registerRoute("crm.tab.module.promo",{getResources:function(){var e=networkUtils.returnDependencyFiles(["get-started.js","lyte-carousel.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["get-started.css"],crmConstants.cssStaticPathForLyte),r=networkUtils.returnDependencyFiles(["zohocrm_mbuilder.js","zohocrm_tabsAndFieldsApiNames.js"],null),i=e.concat(t);i=i.concat(r);var a=networkUtils.getI18nJSUrl("promopagekeys");return i.push(networkUtils.returnDependencyFiles([a])),i},beforeModel:function(){window.isSandboxAcc&&"true"==window.isSandboxAcc&&(renderingUtils.displayPermissionDenied(),this.transition.abort())},renderTemplate:function(){return{outlet:"#show",component:"crm-get-started"}},afterRender:function(){this.setTitle(I18n.getMsg("crm.title.general.revamped",[I18n.getMsg(this.transition.info.dynamicParams[0]),Crm.partnerName]))}}),Lyte.Router.registerRoute("crm.tab.module.quick-create",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-existing-email-quickinfo.js","crm-image-upload-ziaError.js","crm-vision-helper.js","exif-plugin.js","lyte-colorbox.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-existing-email-quickinfo.css","crm-custom-rl.css","crm-image-upload-ziaError.css"],crmConstants.cssStaticPathForLyte);t.push(networkUtils.returnDependencyFiles(["zohocrm_headless_quickcreate.css"],crmConstants.cssStaticPath));var r=e.concat(t);return Crm.userDetails.isPhoneNoNewView&&(r=r.concat(Crm.returnPhoneFieldDependencyFiles())),r},queryParams:["sub_module","phonenumber","entityid","entitymodule","entityname"],model:function(e){window.returnJson=window.returnJson?window.returnJson:{};var t=e.queryParams,r=this.parent.getDynamicParam(),i=t.phonenumber?t.phonenumber:null,a=t.entityid?t.entityid:null,s=t.entitymodule?t.entitymodule:null,o=t.entityname?t.entityname:null,n=$("#ctinotifier_center");if(isNewCallView||"Leads"!==r&&"Contacts"!==r||!i||Lyte.injectResources([networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("phonenumberassociate")],null)[0]]),isNewCallView&&("Leads"===r||"Contacts"===r)&&i){var l="Leads"==r?"add_lead":"add_contact",c=document.createElement("phone-entity"),d=i?i.replace(/[^0-9]/g,""):i;c.setData({defaultvalue:i,defaultid:d,autotrigger:l}),c.style="display:none",document.body.appendChild(c)}else if("Leads"===r)n.append('<div class="ctiapi_activitys" id="ctiapi_entitys_create_lead" style="display:none;"></div>'),CTIAPI.createLead(i,"true");else if("Contacts"===r)n.append('<div class="ctiapi_activitys" id="ctiapi_entitys_create_contact" style="display:none;"></div>'),CTIAPI.createContact(i,"true");else if("Activities"===r){n.css("z-index",50);var u=t.sub_module,m=["zohocrm_phonebridge_notifier.js"];isNewCallView&&(m=m.concat("zcrm_callsnew.js")),networkUtils.loadFeatureScripts(m,function(){switch(u){case"Calls":isNewCallView?((validationUtils.isEmpty(a)||validationUtils.isEmpty(s))&&(a=s=o=null),this.getEntityInfo(s,a,o).then((function(e){var t=CrmDateUtils.getCrmDateAfterMins(30),r=new AutoFillFormData(e.primaryEntity,e.whoEntity,e.whatEntity,null,t,"Outbound","Scheduled");Calls.showCreateForm(r,["ScheduledCall"],["Crm_Calls_CALLTYPE","Crm_Calls_OUTBOUNDCALLSTATUS"])}))):(n.append('<div class="ctiapi_activitys" id="ctiapi_activitys_create_call" style="display:none;"></div>'),ctiApiNotifier.createCall(a,s,!0));break;case"Events":ctiApiNotifier.createEventfromZPB(a,s);break;case"Tasks":n.width(545),n.css("marginLeft","-272px"),n.append('<div class="ctiapi_activitys" id="ctiapi_activitys_create_task" style="display:none;"></div>'),ctiApiNotifier.createTask(a,s,!0)}}.bind(this))}},afterRender:function(e,t){setTimeout((function(){var e=t.queryParams,r=Lyte.Router.getRouteInstance("crm.tab.module.quick-create").transition.info.queryParams,i={},a=["4","5","6","7","9","10","12","13","15","16","42","43","44",CrmField.UITYPES.MULTI_MODULE_LOOK_UP_ENTITY.toString(),"133",CrmField.UITYPES.SYSTEM_SINGLE_LOOK_UP_ENTITY.toString(),"210"],s=$(".qcpopuparrow");for(var o in s&&s.hide(),r.data&&(i=JSON.parse(r.data)),i){if(r.sub_module&&"Events"==r.sub_module)var n=document.querySelector('[data-fieldid="'+o+'"]');else n=document.querySelector('[data-fieldid="field_'+o+'"]');if(n){var l=n.getAttribute("data-uitype"),c=i[o];if(a.contains(l))c=JSON.parse(c),n.value=c.id.toString(),document.querySelector('[data-fieldid="fields_'+o+'"]').value=c.name.toString();else if("2"==l||"26"==l){var d=n.getAttribute("id");$("#"+d).val(c).trigger("change")}else"786"==l?"Calls"==e.sub_module&&$('[value="'+c+'"]').click():n.value=c.toString()}}}),700)},actions:{willTransition:function(){if("Activities"===this.parent.currentModel.module_name)switch(this.getQueryParams().sub_module){case"Calls":case"Events":break;case"Tasks":var e=$("#ctinotifier_center");e.html(""),e.hide()}}},getEntityInfo:function(e,t,r){return new Promise((function(i){var a={};validationUtils.isEmpty(t)?i(a):validationUtils.isNotEmpty(r)?(a.primaryEntity=new BasicEntityInfo(e,t,r),i(a)):(a.primaryEntity=new BasicEntityInfo(e,t,r),new Promise((function(e,t){Calls.resolveWindowsCommunication=e,Calls.rejectWindowsCommunication=t,WindowsCommunicator.notifyParent("get-pbcall-info",null,{action:"getCallBackParam"})})).then((function(r){r.Who_Id&&(r.Who_Id.id===t&&(a.primaryEntity=new BasicEntityInfo(e,t,r.Who_Id.name)),a.whoEntity=new BasicEntityInfo("Contacts",r.Who_Id.id,r.Who_Id.name)),r.What_Id&&(r.What_Id.id===t&&(a.primaryEntity=new BasicEntityInfo(e,t,r.What_Id.name)),a.whatEntity=new BasicEntityInfo(r.$se_module,r.What_Id.id,r.What_Id.name)),i(a)})))}))}}),Lyte.Router.registerRoute("crm.tab.module.custom-view.canvas",{forceFetch:!0,queryParams:["filters","sort_by","sort_order","page","per_page","search_letter","territory_id","filter_id","cross_filters","include_child"],beforeModel:function(e){if(!this.transition.data||!this.transition.data.reloadAll){this.isRecordFetched=!1;e.queryParams;var t=crmTab.getFromCache(this.parent.parent.getDynamicParam());return this.cachedObj=t||{},this.fetchOnlyBody=!1,this.makeCustomViewRequest(this.parent.getDynamicParam(),this.parent.parent.getDynamicParam())}},model:function(e){if(this.transition.data&&this.transition.data.reloadAll)return{};var t=objectUtils.cloneObject(this.transition.data),r=this.parent.parent.getDynamicParam(),i=this.transition.info.dynamicParams[2],a={module:r,cvid:this.parent.getDynamicParam(),viewid:i},s=moduleRecordMapping["Potentials"==r?"Deals":r],o=!!e.queryParams.filters&&this.parse_Nested_Json(e.queryParams.filters);if(o&&this.isOldCriteria(o))try{var n=this.oldCriteria_to_newCriteria(o,this.getRouteInstance().transition.info.dynamicParams[0],res);return n||(this.filterErrorMsg(I18n.getMsg("crm.filter.error.label",I18n.getMsg("crm.report.filters")),"message"),delete e.queryParams.filters),e.queryParams.filters=!!n.filters&&JSON.stringify(n.filters),n.cross_filters&&(e.queryParams.cross_filters=JSON.stringify(n.cross_filters)),this.transition.abort(),void(this.setQueryParams(e.queryParams).data={clearCache:!0})}catch(t){this.filterErrorMsg(I18n.getMsg("crm.filter.error.label",I18n.getMsg("crm.report.filters")),"message"),delete e.queryParams.filters}null!=s.viewid&&s.viewid==i||s.$.set("viewid",i),Crm.userDetails.CLIENT_ACCOUNT||s.$.set("canvas_view",!0),s.$.set("kanban_view",!1),s.$.set("zia_view",!1);var l=crmTab.getFromCache(a.module),c=t.clickId,d=!0;if("navigate_previous_listview"!==c&&"navigate_next_listview"!=c||!l?t.clearselectedIds?(this.clearselectedIds=!0,l&&(delete l.selectAllHistory,delete l.showHideSelectAllDiv,delete l.showSelectAll),crmListView.startIndex={}):0==t.clearselectedIds&&(this.clearselectedIds=!1):(d=!1,t.cachedData=l,null==l.body[t.fromIndex]&&l.body.length!=parseInt(t.toIndex)+1&&(d=!0,delete t.cachedData)),(this.transition.fetchOnlyBody||t.fetchOnlyBody)&&!t.clearCache&&app.prevTransition&&"crm.tab.module.custom-view.canvas"==app.prevTransition.route&&l?this.fetchOnlyBody=!0:delete a.fetchOnlyBody,l)if(null!=t&&null!=t.cvid||"Leads"==a.module||"Accounts"==a.module||"Contacts"==a.module||"Potentials"==a.module)if(t.clearCache)l=void 0;else{var u=e.queryParams.per_page*e.queryParams.page,m=e.queryParams.page*e.queryParams.per_page-e.queryParams.per_page+1;l.body&&null==e.queryParams.per_page?t.cachedData=l:l.body&&void 0!==l.body[u]&&void 0!==l.body[m]&&(l.fromIndex=m,l.toIndex=u,t.cachedData=l)}else l=void 0,crmTab.deleteFromCache(a.module);var p=e.queryParams;if(!p.search_letter&&l&&"All"!=l.searchletter&&(l.searchletter="All",delete t.cachedData),delete t.clearselectedIds,delete t.clearCache,t&&!t.cachedData&&d){for(var g in a.isload=!0,t)"refreshTemplate"!=g&&(a[g]=t[g]);if(p)for(var f=0;f<this.queryParams.length;f++){if(p[g=this.queryParams[f]])if("page"!=g||a.fromIndex)"per_page"!=g||a.toIndex?"sort_order"==g?"sort_unsort"!=p[g]?a.sortOrderString=p[g]:a.sortOrderString="sort_desc":"search_letter"==g?a.searchletter=p[g]:"sort_by"==g?"sort_unsort"!=p.sort_order?a.sortColumnString=p[g]:a.sortColumnString="":"territory_id"==g?a.territoryId=p[g]:"filter_id"==g?a.filterId=p[g]:"include_child"==g?a.includechild=1:("filters"!=g&&"cross_filters"!=g||(a.isNewFilter=!0),a[g]=p[g]):a.toIndex=Number(p[g])*Number(p.page);else{var h=p[g]?Number(p[g]):1;p.per_page?a.fromIndex=h*Number(p.per_page)-Number(p.per_page)+1:a.fromIndex=h}}p.sort_order||(a.sortOrderString="sort_asc"),delete a.page,delete a.per_page,this.clickId=a.clickId,delete a.clickId,p.search_letter&&(a.searchletter=p.search_letter),a.normListView=!1,a.view="customisedview";var y={params:a},v=this;return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowDetails.do","POST",y).then((function(e){if(v.isRecordFetched=!0,e&&e.body){var t=[];if(e.body.length){l&&l.body&&(t=l.body);for(var r=0,i=e.fromIndex-1;i<=e.toIndex;r++,i++)e.body[r]?t[i]=e.body[r]:t[i]=null}e.body=t,crmplusImplTriggerActions("selectEntity",["module",e.module])}return e}))}return t.cachedData},afterModel:function(e){var t=this.transition.info.dynamicParams[2];if(this.transition.data&&this.transition.data.reloadAll)return{};var r=moduleRecordMapping[this.parent.parent.getDynamicParam()];this.currentModel.module_info=r,"string"==typeof e&&(this.replaceWith("crm.tab.module.index-module",Lyte.Router.getRouteInstance("crm.tab.module").getDynamicParam()).response={model:e,skipRedirect:!0}),e.canvasid==r.viewid||e.customizationJSON||(r.$.set("viewid",e.canvasid),this.replaceWith("crm.tab.module.custom-view.list",r.module_name,r.cvid).data=this.transition.data),null!=r.viewid&&r.viewid==t||!e.customizationJSON||r.$.set("viewid",t),(e&&1==e.showBlankState||e&&0==e.showBlankState&&1==e.isDataWaitingForApproval)&&(e.isFromModuleInfo=!0,e.module_name=this.parent.parent.getDynamicParam(),this.replaceWith("crm.tab.module.begin",e.module).response=e);var i=this.getQueryParams();this.cachedObj.filters=e.filters=i.filters?JSON.parse(i.filters):void 0,this.cachedObj.cross_filters=e.cross_filters=i.cross_filters?JSON.parse(i.cross_filters):void 0},renderTemplate:function(e){var t=moduleRecordMapping[this.parent.parent.getDynamicParam()];t.default_view&&t.default_view.id!=t.viewid&&t.$.set("default_view",{id:t.viewid}),this.setDataFromRoute(e,this.parent.getDynamicParam(),this.getQueryParams()),this.currentModel.layerBtn=this.parent.currentModel.layerBtn,this.currentModel.search_letter=e.searchletter,this.currentModel.customViewHeader=e.heading,this.currentModel.selectedIds=this.cachedObj.selectedIds?this.cachedObj.selectedIds:[];var r=$L("crm-customview-buttons")[0];this.currentModel.cvbtnRendered=!(r&&r.getData("frominitial")||!r);var i=this.getQueryParams();this.currentModel.filterQueryParams={filters:i.filters,cross_filters:i.cross_filters,filter_id:i.filter_id},this.clearselectedIds&&(this.currentModel.selectedIds=[]),app.renderTemplate(this,{outlet:"#show",component:"crm-custom-outer-box"})},afterRender:function(e,t){this.parent.getDynamicParam();crmListView.getObject()&&(this.fromIndex=crmListView.getObject().fromIndex);var r=crmTab.getFromCache(e.module);if(this.fetchOnlyBody){r.body=e.body,r.filters=e.filters,r.cross_filters=e.cross_filters;var i=!1;if("true"===r.error&&"false"===e.error&&(i=!0,r.error="false"),"true"===e.error)r.body=void 0,r.error="true",e.filters&&(r.filters=e.filters),$("#lv_table_holder").html(Handlebars.templates.cvError(r));else{var a=!0;if(e.module=r.module,e.heading&&0!==e.heading.length&&(r.heading=e.heading),r.filterId!==e.filterId&&(e.filterId||0===$("#lv_filter_save_opt:visible").length)&&($(".filter_listcontent").removeClass("f_listclick-view"),r.filterId=e.filterId,r.filterId)){crmListView.setFiltersToDefaultState();var s={filters:e.filters,filterId:e.filter_id,cross_filters:e.cross_filters};crmTab.putFiltersInCache(e.module,s),crmListView.renderSelectedFilters(r,s),$("#lv_filter_scroll").scrollTop(0)}if(r.fromIndex=e.fromIndex,r.toIndex=e.toIndex,r.currentOption=e.currentOption,r.selectedIds=r.selectedIds&&r.selectedIds.length?r.selectedIds:[],$('input[id="fromIndex"]').val(r.fromIndex),$('input[id="toIndex"]').val(r.toIndex),!i)if(e.body&&0==e.body.length)0===$("#lvNoRecordsFound").length&&($("#listViewTable").trigger("destroy"),$("#lvTred").html(""),$(".fixedrowTd").html(Handlebars.templates.fixedColumnlistview(r)),$("#listviewHeaderRow").parent().html(Handlebars.templates.heading(r)),$(Handlebars.templates.noRecordsFound(r)).insertAfter("#lvTred"),renderingUtils.tableSorter("listViewTable","0",""),$("#selectAllRecords").length>0&&(customViewObject.showSelectAll=!1,$("#selectAllRecords").hide())),$("#tcDiv").hide(),$("#checkAll").hide();else{crmTab.listviewTableScrollLeft=$("#listViewTable").parent(".tablesorter-scroller-table").scrollLeft(),$(".fixedrowTd").html(Handlebars.templates.fixedColumnlistview(r)),$("#listviewHeaderRow").parent().html(Handlebars.templates.heading(r)),$("#lvTred").html(Handlebars.templates.body(r)),new listViewHandler(r).renderListView();var o=$("#currentOption")[0];o&&(o.value=r.currentOption),$("#lvNoRecordsFound").length&&($("#lvNoRecordsFound").remove(),$("#listviewtablescroll").removeClass("oH")),$("#tcDiv").show(),$("#checkAll").show()}if(r.criteriaSearch=e.criteriaSearch,e.search_Fld=r.search_Fld,"alphaSearch"==this.clickId){var n=$(".alpha-link");"All"!=e.searchletter?($(n).addClass("alpha-linkNotAll"),$(n).html("<span id='alphaSearch' onclick='sE(event); crmListView.showAlphaTableList(event, this);'>"+I18n.getMsg(e.searchletter)+"</span><a onclick='crmListView.alphaSearchHandling();sE(event);' class='smalledit' id='alphaSearch_remove' data-td='{\"clickId\":\"alphaSearch\",\"clearCache\":true,\"fetchOnlyBody\" : true}'>x</a>")):($(n).removeClass("alpha-linkNotAll"),$(n).html("<span id='alphaSearch' onclick='sE(event); crmListView.showAlphaTableList(event, this);'></span>"));var l="<ul class='m0'><li></li>";"All"==e.searchletter?l+="<input type='hidden' name='searchletter'><li class='alphaBgSel' style'width:26' nowrap><div align='center' class='bodyText'>"+I18n.getMsg("crm.label.all")+"</div></li>":l+="<input type='hidden' name='searchleter' value='"+e.searchletter+"'><li class='alphaBg' style='width:26'><div align='center'><a id='alphaSearch_all' data-zcqa='alphaSearch_all' data-td='{\"fetchOnlyBody\":true,\"clickId\":\"alphaSearch\",\"clearCache\":true}' class='link'>"+I18n.getMsg("crm.label.all")+"</a></div></li>";for(var c=0;c<r.alphaDetails.length;c++){var d=r.alphaDetails[c];d==e.searchletter?l+="<li class='alphaBgSel'><div align='center' class='bodyText'>"+d+"</div></li>":"Potentials"==e.module||"Accounts"==e.module||"Contacts"==e.module||"Leads"==e.module?l+='<li class="alphaBg"><div align="center"><a data-td=\'{"fetchOnlyBody":true,"clickId":"alphaSearch","clearCache":true}\' class="link" data-zcqa="alphaSearch_"'+d+">"+d+"</a></div></li>":l+='<li class="alphaBg"><div align="center"><a class="link" data-td=\'{"clickId":"alphaSearch","clearCache":true}\' data-zcqa="alphaSearch_"'+d+">"+d+"</a></div></li>"}l+="</ul>",$("#alphaTable").html(l),r.searchletter=e.searchletter}if("sortingRecords"==this.clickId&&(a=!1,r.sortColumnString=e.sortColumnString,r.sortOrderString=e.sortOrderString,null!=e.nearmeSortOrder&&null!=crmListView&&(crmListView.getObject().nearmeSortOrder=e.nearmeSortOrder),$("#listviewHeaderRow").parent().html(Handlebars.templates.heading(r)),renderingUtils.tableSorter("listViewTable","0","")),"true"==e.navigation&&(a=!1),crmTab.putInCache(e.module,r),i&&crmListView.createTemplate(r),customViewObject=r,crmListView.getNavigationDiv(r),a){var u='&nbsp;&nbsp;<nobr><a id="totalRecordsCount" href="javascript:;" onclick="showTotalCount(this,\''+I18n.getMsg("crm.label.totalcount")+'\')" class="link date">'+I18n.getMsg("crm.label.totalcount")+': <span id="totalCountNo">###</span></a></nobr>&nbsp;&nbsp;';$("#tcDiv").html(u),delete customViewObject.totalCount,e.fetchCountValues&&showTotalCount($("#tcDiv #totalRecordsCount"),void 0,"false")}(e.filters||e.cross_filters)&&(r.filters=e.filters,r.cross_filters=e.cross_filters),crmListView.checkAll(),crmNavig.parseCurrentListView()}}else t.queryParams.filter_id&&e.isFilterError&&(crmListView.showCompatibilityError(),t.queryParams.filter_id=void 0),crmListView.createTemplate(e),crmTab.putInCache(e.module,e),placeExtra(),$("#h2").html(""),getObj("recentItem")&&($("#h2").empty(),getObj("h2").innerHTML=getObj("recentItem").innerHTML),removeFreezeLayer(),$("#eventCreatePopup").hide(),$("body").removeClass("oH"),crmListView.checkAll();Crm.latestEntId&&crmListView.latestEntity(Crm.latestEntId),Crm.latestEntId=void 0;var m=document.querySelector("crm-page-navigator");if(m){var p=crmTab.getFromCache(e.module),g=getEndIndex(p.fromIndex,p.toIndex,p.currentOption,p.body);p.body[g]&&g++;var f=p.currentOption,h=this.getQueryParams(),y=h.page?h.page:1;m.setData({total_count:g,startIndex:Math.ceil((y-1)*f),page:y})}this.getUpdatedActions(e.module,this.parent.getDynamicParam())},actions:{didTransition:function(){this.currentModel.module&&(moduleRecordMapping[this.currentModel.module].custom_view.id=this.parent.getDynamicParam()),this.handleKanbanSettingPopup(),delete this.cachedObj,delete this.clearselectedIds},getRecord:function(e,t,r,i,a){var s=(t-1)*e+1;return crmListView.recordChange({module:this.currentModel.module,fromIndex:s,nav:"true",fromListView:"true",fromApproval:"false",massActions:"false",cvid:moduleRecordMapping[this.currentModel.module].custom_view.id}),!1},onError:function(e,t){if(e.status===crmConstants.limitExceedsCode){t.abort(),crmHistory.doNotReload=!0,history.go(-1),Search.displayLookupExceedsMsg(e);var r=$L("crm-custom-filter")[0];r&&(r.setData({isApplyFilter:!0,isSaveFilter:!1}),document.querySelector("#applyBtn").ltProp("disabled",!0)),customViewObject.filters=customViewObject.cross_filters=void 0}return this.currentModel=e,this.handleError(this.parent.parent.getDynamicParam()),!1}}},{mixins:["crm-view-utils","crux-filter-utils"]}),Lyte.Router.registerRoute("crm.tab.module.custom-view.kanban",{forceFetch:!0,queryParams:["filters","territory_id","sort_by","sort_order","layout_id","filter_id","cross_filters","include_child","pipeline"],getResources:function(){var e=[];return"Activities"!==this.parent.parent.getDynamicParam()&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-image-upload.js","crm-image-mixin.js","crm-image-preview.js","crm-image-upload-create.js","lyte-scrollTo.js","exif-plugin.js","lyte-cropper.js","lyte-colorbox.js"],crmConstants.jsStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-image-upload-rtl.css","crm-image-upload-ziaError.css"],crmConstants.cssStaticPathForLyte))),e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-image-upload.css","crm-image-preview.css","crm-image-upload-create.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("imageupload")]))),e},beforeModel:function(e){if(Crm&&Crm.userDetails&&Crm.userDetails.CLIENT_ACCOUNT&&(this.transition.abort(),this.transitionTo("crm.tab.module.custom-view.list",this.parent.parent.getDynamicParam(),this.parent.getDynamicParam())),!this.transition.data||!this.transition.data.reloadAll){var t=e.queryParams,r=this.parent.parent.getDynamicParam(),i=crmTab.getFromCache(r);this.cachedObj=i||{};var a=this.transition.data;return"Visits"==this.parent.parent.getDynamicParam()&&(this.portalName=a.portalName=a.portalName?a.portalName:this.cachedObj.screenName?this.cachedObj.screenName:"allportals"),-1!=["Activities","Visits","Tasks","Events","Calls"].indexOf(r)&&(t.filters||t.cross_filters||t.filter_id)&&(this.setQueryParams({filters:void 0,filter_id:void 0,cross_filters:void 0}).data=this.transition.data),"Visits"==this.parent.parent.getDynamicParam()&&Crm.trackSpotLightAction("Visits - Kanban View Click"),this.fetchOnlyBody=!1,this.makeCustomViewRequest(this.parent.getDynamicParam(),r)}},model:function(e){if(this.transition.data&&this.transition.data.reloadAll)return{};this.isRecordFetched=!1;var t=this.transition.data?objectUtils.cloneObject(this.transition.data):{},r=this.parent.parent.getDynamicParam(),i={};i.module=r,i.cvid=this.parent.getDynamicParam();var a=moduleRecordMapping["Potentials"==r?"Deals":r],s=e.queryParams,o=!!s.filters&&this.parse_Nested_Json(s.filters);if(o&&this.isOldCriteria(o))try{var n=this.oldCriteria_to_newCriteria(o,this.getRouteInstance().transition.info.dynamicParams[0]);return n||(this.filterErrorMsg(I18n.getMsg("crm.filter.error.label",I18n.getMsg("crm.report.filters")),"message"),delete s.filters),s.filters=!!n.filters&&JSON.stringify(n.filters),n.cross_filters&&(s.cross_filters=JSON.stringify(n.cross_filters)),this.transition.abort(),void(this.setQueryParams(s).data={clearCache:!0})}catch(e){this.filterErrorMsg(I18n.getMsg("crm.filter.error.label",I18n.getMsg("crm.report.filters")),"message"),delete s.filters}if("Potentials"!=i.module&&"Leads"!=i.module&&"Contacts"!=i.module&&"Accounts"!=i.module||!crmTab.getFromCache(i.module)||t.clearCache||crmTab.getFromCache(i.module).cvId!=this.parent.getDynamicParam()?delete t.cachedData:t.cachedData=crmTab.getFromCache(i.module),t.fetchOnlyBody&&(this.fetchOnlyBody=!0),this.td=t,t.cachedData&&t.clearselectedIds&&(t.cachedData.selectedIds=[]),delete t.clearselectedIds,delete t.clearCache,t&&!t.cachedData){for(var l in i.isload=!0,t)"portalName"!=l&&"refreshTemplate"!=l&&(i[l]=t[l]);if(i.normListView=!1,"Activities"!==a.module_name&&"Tasks"!==a.module_name&&"Calls"!==a.module_name&&"Events"!==a.module_name||(i.view="kanbanview",i.columntype="Closed",i.kvstatus="enable",this.params=i),"Visits"===a.module_name&&(i.normListView=!1),"Visits"===i.module&&(i.allPortals=!0,!t.portalName&&this.portalName&&(t.portalName=this.portalName),t.portalName&&"allportals"!=t.portalName&&(i.portalName=CrmTracking.portalsInfo[t.portalName],i.screenName=t.portalName,i.allPortals=!1)),s)for(var c=0;c<this.queryParams.length;c++){s[l=this.queryParams[c]]&&("filter_id"==l?i.filterId=s[l]:"filters"==l||"cross_filters"==l?(i[l]=s[l],i.isNewFilter=!0):"include_child"==l&&s[l]&&(i.includechild=1),"territory_id"==l&&(i.territoryId=s[l]),"layout_id"==l&&(i.layoutId=s[l]),"pipeline"==l&&(i.pipeline=s[l]))}moduleRecordMapping.ZohoCPQ&&moduleRecordMapping[i.module]&&moduleRecordMapping[i.module].parent_module&&moduleRecordMapping[i.module].parent_module.module_name===moduleRecordMapping.ZohoCPQ.module_name?crmplusImplTriggerActions("selectEntity",["module",moduleRecordMapping.ZohoCPQ.module_name]):crmplusImplTriggerActions("selectEntity",["module",i.module]);var d={params:i};if(this.isRecordFetched=!0,"Potentials"===i.module){var u={detailsModel:networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowDetails.do","POST",d)};return Lyte.resolvePromises(u).then((function(e){return"STAGE"===e.detailsModel.stageColumn&&Crm.userDetails.isMultiPipelineActivated&&(u.layouts=i.layoutId?store.findRecord("layout",i.layoutId,{module:Crm.moduleInfo.Potentials.apiname}):store.findAll("layout",{module:Crm.moduleInfo.Potentials.apiname})),Lyte.resolvePromises(u)}))}return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowDetails.do","POST",d)}if("Potentials"===i.module&&Crm.userDetails.isMultiPipelineActivated&&"STAGE"===t.cachedData.stageColumn){var m=t.cachedData.layoutId?store.findRecord("layout",t.cachedData.layoutId,{module:Crm.moduleInfo.Potentials.apiname}):store.findAll("layout",{module:Crm.moduleInfo.Potentials.apiname});return Lyte.resolvePromises({detailsModel:t.cachedData,layouts:m})}return t.cachedData},afterModel:function(e,t){if(this.transition.data&&this.transition.data.reloadAll)return{};var r=moduleRecordMapping[this.parent.parent.getDynamicParam()];if(e.hasOwnProperty("detailsModel")){var i=e.layouts;e=e.detailsModel,this.currentModel=e}if(r.custom_view.system_name&&0===r.custom_view.system_name.indexOf("IMAGEVALIDATION")&&Lyte.injectResources(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ziavision")])),i){e.showPipeline=!0,e.singleLayout=!1;for(var a=[],s=t.queryParams.layout_id?1:i.length,o=function(e){return Crm.userDetails.PROFILE_NAME===e.name},n=function(e){return{display_value:e.display_value,id:e.id}},l=0;l<s;l++){var c=i[l].id;if(i[l].profiles.some(o))for(var d=i[l].sections,u=d.length,m=0;m<u;m++){var p=d[m].fields.filterBy({column_name:"PIPELINE"});if(p.length){if(t.queryParams.layout_id||e.layoutId)e.Pipelines=p[0][c].pick_list_values.map(n),e.singleLayout=!0;else{var g=p[0][c].pick_list_values.map(n);a.push({LAYOUTNAME:i[l].name,LAYOUTID:c,PIPELINE:g}),e.Pipelines=a}break}}}t.queryParams.layout_id||e.layoutId||1!=a.length||(e.Pipelines=a[0].PIPELINE,e.singleLayout=!0)}if("string"==typeof e)this.replaceWith("crm.tab.module.index-module",Lyte.Router.getRouteInstance("crm.tab.module").getDynamicParam()).response={model:e,skipRedirect:!0};else if(e.showKanbanPopup)crmListView.kanbanSettingData=e,crmHistory.length?(moduleRecordMapping[this.parent.parent.getDynamicParam()].$.set("kanban_view",!1),this.transition.abort(),history.back()):this.replaceWith("crm.tab.module.custom-view.list",this.parent.parent.getDynamicParam(),this.parent.getDynamicParam());else if(e.isStageView||e.isKanbanView){if(this.td&&!this.td.cachedData&&1==e.showBlankState){if("null"!=e.canvasid&&"Potentials"==e.module&&e.isCustomizedView){var f=moduleRecordMapping[e.module];f.$.set("kanban_view",!1),f.$.set("viewid",e.canvasid)}e.isFromModuleInfo=!0,e.module_info=r,e.portal_name=this.portalName,crmTab.putInCache(e.module,this.cachedObj),this.replaceWith("crm.tab.module.begin",e.module).response=e}}else this.transition.abort(),this.transitionTo("crm.tab.module.custom-view.list",this.parent.parent.getDynamicParam(),this.parent.getDynamicParam());e.showKanbanPopup||r.kanban_view||(r.$.set("default_view",{name:"kanban_view",id:r.custom_view.id}),r.$.set("kanban_view",!0),r.$.set("zia_view",!1),r.$.set("canvas_view",!1));var h=this.getQueryParams();this.cachedObj.filters=e.filters=h.filters?JSON.parse(h.filters):void 0,this.cachedObj.cross_filters=e.cross_filters=h.cross_filters?JSON.parse(h.cross_filters):void 0},renderTemplate:function(e){this.cachedObj&&this.cachedObj.selectedIds&&this.cachedObj.selectedIds.length>0&&(this.currentModel.selectedIds=this.cachedObj.selectedIds),commonUtils.showHideLoadingDiv();var t=this.getQueryParams();this.setDataFromRoute(e,this.parent.getDynamicParam(),t),this.currentModel.layerBtn=this.parent.currentModel.layerBtn,this.currentModel.search_letter=e.searchletter,this.currentModel.customViewHeader=e.heading,this.currentModel.filterQueryParams={filters:t.filters,cross_filters:t.cross_filters,filter_id:t.filter_id},app.renderTemplate(this,{outlet:"#show",component:"crm-custom-outer-box"})},afterRender:function(e,t){if("Activities"!=e.module&&"Visits"!=e.module&&"Tasks"!=e.module&&"Calls"!=e.module&&"Events"!=e.module||1!=e.isKanbanView||($("#lv_left_filter").css({display:"none"}),$("#viewcontainer").css({width:"100%"})),"Activities"==e.module||"Visits"==e.module||"Tasks"==e.module||"Calls"==e.module||"Events"==e.module){var r=$("#lv_filter_hide");r.removeClass("dIB"),r.addClass("dN")}var i=$L("#stageView_create_act");i&&i.length&&i[0].remove();var a=e;if(customViewObject=e,crmTab.putInCache(e.module,e),"false"!=customViewObject.error||!customViewObject.cvName||customViewObject.cvName!=="REVIEWPROCESS "+customViewObject.module.toUpperCase()&&"REVIEWPROCESS CUSTOMMODULE"!==customViewObject.cvName||(customViewObject.isReviewProcessView=!0),"false"!=customViewObject.error||!customViewObject.cvName||customViewObject.cvName!=="IMAGEVALIDATION"+customViewObject.module.toUpperCase()&&"IMAGEVALIDATIONCUSTOMMODULE"!==customViewObject.cvName||(customViewObject.isImageValidationView=!0),"Activities"===e.module||"Tasks"===e.module||"Events"===e.module||"Calls"===e.module||"Visits"===e.module||e.showBlankState||"false"!==e.error||crmListView.checkForNoneStage(e,!0),customViewObject.screenName=this.portalName,!0===e.isStageView&&this.fetchOnlyBody&&a){a.selectedIds=e.selectedIds,a.heading=e.heading,a.filter_id=e.filterId,a.filters=e.filters,a.cross_filters=e.cross_filters,a.stageBoardDetails=e.stageBoardDetails,a.stageBoards=e.stageBoards,a.stageSize=e.stageSize,a.layoutId=e.layoutId,a.cvId=moduleRecordMapping[e.module].custom_view.id,a.pipeline=e.pipeline,a.Pipelines=e.Pipelines,a.singleLayout=e.singleLayout,a.sortColumnString=e.sortColumnString,a.sortOrderString=e.sortOrderString,crmTab.putInCache(e.module,a);var s=!1,o=this.transition.data;if((o.isload&&"true"==o.isload||o.refresh&&"true"==o.refresh)&&(s=!0),$("#lv_stageview").html(Handlebars.templates.stageView(a)),crmListView.afterRenderStageView(a),a.filterId!==e.filterId&&(e.filterId||0===$("#lv_filter_save_opt:visible").length)&&($(".filter_listcontent").removeClass("f_listclick-view"),a.filterId=e.filterId,a.filterId)){crmListView.setFiltersToDefaultState();var n={filters:e.filters,filterId:e.filterId,cross_filters:e.cross_filters};crmTab.putFiltersInCache(e.module,n),o.filters=JSON.stringify(crmTab.getFiltersFromCache(o.module).filters),crmListView.renderSelectedFilters(a,n),$("#lv_filter_scroll").scrollTop(0)}e.fetchCountValues&&showTotalCount($("#tcDiv #totalRecordsCount"),void 0,"false")}else if("Activities"===this.parent.parent.currentModel.module_name&&"Tasks"===this.parent.parent.currentModel.module_name&&"Calls"===this.parent.parent.currentModel.module_name&&"Events"===this.parent.parent.currentModel.module_name&&this.td&&this.td.cachedData){$("#printviewBtn").attr("class","hide");$("#kvType").val();$(".kvtlistbgheader").removeClass("kv_detailview"),$("#cvEditSave").hide(),$("#cvEditSave").html(""),$("#cvparentspan1").removeClass("hide"),$(".kvtlistbgheader .kvtlistbg").removeClass("lightbdr"),$(".leftheaderBack").hide(),$(".tkvPriority").removeClass("active"),$(".kvtlistbg").width(TaskKanbanView.tkvListWidth-2),$(".leftContainerctn li").removeClass("ligraybackground"),TaskKanbanView.kvrecordid=0,$(".kvtlistbgheader").animate({width:TaskKanbanView.tkvListWidth-1+"px"},150,(function(){TaskKanbanView.KvListItemClickCount=0})),$("#kventitydetailspage").animate({left:4*TaskKanbanView.tkvListWidth+7+"px"},150,(function(){})),document.getElementById("cvEditSave")&&($("#cvEditSave").empty(),hide("cvEditSave"))}else crmListView.createTemplate(a),t.queryParams.filter_id&&e.isFilterError&&(crmListView.showCompatibilityError(),t.queryParams.filter_id=void 0);if("Activities"!=e.module&&"Visits"!=e.module&&"Tasks"!=e.module&&"Calls"!=e.module&&"Events"!=e.module&&crmTab.putInCache(e.module,a),void 0===(s=this.transition.data.refresh)&&(s=!0),void 0===e||e.isPredictView||e.showBlankState||"Activities"===e.module||"Visits"===e.module||"Tasks"===e.module||"Calls"===e.module||"Events"===e.module?e.showBlankState||"Activities"===e.module||"Visits"===e.module||"Tasks"===e.module||"Calls"===e.module||"Events"===e.module||(crmListView.loadPredictSummary(),$("#tab_Activities img").attr("src",networkUtils.getImageUrl("listview-task-deactive_ebe803e_.png",ResourceConstants.CRM)),$("#changer img").attr("src",networkUtils.getImageUrl("listview-task-kanban-active_e14274d_.png",ResourceConstants.CRM))):crmListView.loadStageSummary(void 0,e.layoutId,s),this.td&&!this.td.cachedData&&("Activities"===this.parent.parent.currentModel.module_name||"Tasks"===this.parent.parent.currentModel.module_name||"Events"===this.parent.parent.currentModel.module_name||"Calls"===this.parent.parent.currentModel.module_name)){var l=this.params;l.columntype="Open";var c=networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowDetails.do","POST",{params:l});l.columntype="RelatedTo";var d=networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowDetails.do","POST",{params:l});l.columntype="other";var u=networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowDetails.do","POST",{params:l});return crmplusImplTriggerActions("selectEntity",["module",l.module]),Lyte.resolvePromises({Open:c,RelatedTo:d,other:u}).then(function(e){for(var t in e)crmListView.kanbanView(e[t]);this.savekanbanData=e}.bind(this))}customViewObject.isStageView&&Crm.latestEntId&&(crmListView.latestEntity(Crm.latestEntId),Crm.latestEntId=void 0),crmNavig.parseCurrentListView(),customViewObject.isStageView&&crmListView.loadMoreStageBoardsAfterRender(),this.getUpdatedActions(e.module,this.parent.getDynamicParam())},actions:{willTransition:function(e){if("crm.tab.module.entity.detail"==e.target&&("Activities"==this.parent.parent.getDynamicParam()||"Tasks"===this.parent.parent.getDynamicParam()||"Events"===this.parent.parent.getDynamicParam()||"Calls"===this.parent.parent.getDynamicParam())){var t=e.info.dynamicParams[1],r=$("#recordid_"+t).attr("name");this.savekanbanData.Closed=this.currentModel,e.kanbanData=this.savekanbanData[r],e.column_name=r}},didTransition:function(){delete this.cachedObj},onError:function(e,t){if(e.status===crmConstants.limitExceedsCode){t.abort(),crmHistory.doNotReload=!0,history.go(-1),Search.displayLookupExceedsMsg(e);var r=$L("crm-custom-filter")[0];r&&(r.setData({isApplyFilter:!0,isSaveFilter:!1}),document.querySelector("#applyBtn").ltProp("disabled",!0)),customViewObject.filters=customViewObject.cross_filters=void 0}return this.currentModel=e,this.handleError(this.parent.parent.getDynamicParam()),!1}}},{mixins:["crm-view-utils","crux-filter-utils"]}),Lyte.Router.registerRoute("crm.tab.module.custom-view.list",{forceFetch:!0,queryParams:["filters","sort_by","sort_order","page","per_page","search_letter","search_field","territory_id","filter_id","cross_filters","include_child"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-list-view.js","crm-column-list.js","crm-list-view-modal.js","crm-inner-list.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["crm-list-view-new.css","crm-list-view-crux.css","crm-image-upload-ziaError.css","crm-listview-relatedfields-popover.css","crm-inner-list-new.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-list-view-new-rtl.css"],crmConstants.cssStaticPathForLyte))),e=e.concat(networkUtils.returnDependencyFiles(["crm_finance_suite.js"]))},beforeModel:function(e){var t=this.transition.data;if(!t||!t.reloadAll)return this.preFetch(e.queryParams,this.parent.parent.getDynamicParam(),this.parent.getDynamicParam(),t)},model:function(e){if(crmHistory.transitionError)return this.currentModel;if(this.transition.data&&this.transition.data.reloadAll)return{};var t=moduleRecordMapping[this.parent.parent.getDynamicParam()];return app.prevTransition&&"crm.tab.module.entity.detail"==app.prevTransition.route&&t.custom_view&&"UNREADVIEWS"==t.custom_view.system_name&&(store.unloadAll(t.id),this.transition.data.clearselectedIds=!0),this.fetch(e,this.parent.parent.getDynamicParam(),Lyte.Router.getRouteInstance("crm.tab.module.custom-view").getDynamicParam(),objectUtils.cloneObject(this.transition.data),!1,Lyte.Router.getRouteInstance())},afterModel:function(e){return crmHistory.transitionError?this.currentModel:this.transition.data&&this.transition.data.reloadAll?{}:this.postFetch(e,this.getQueryParams(),this.parent.parent.getDynamicParam())},redirect:function(e,t){if(crmHistory.transitionError)this.handleError(this.parent.parent.getDynamicParam());else{var r=moduleRecordMapping[this.parent.parent.getDynamicParam()],i=t.queryParams;if(this.currentModel&&!window.clientPortalName&&(e&&e.show_begin_page||e&&e.data_waiting_for_approval)&&("Visits"==e.module&&!i.filter_id&&!i.filters&&!i.cross_filters||"Visits"!=e.module)){if(this.currentModel.module_info=r,"null"!=e.canvasid&&e.isCustomizedView&&"Leads"==e.module||"Contacts"==e.module||"Accounts"==e.module||"Products"==e.module)moduleRecordMapping[e.module].$.set("viewid",e.canvasid);e.isFromModuleInfo=!0,e.skipRedirect=!0,e.data_waiting_for_approval?e.data_waiting_for_approval=!0:e.showBlankState=!0,e.module_name=this.parent.parent.getDynamicParam(),delete e.show_begin_page,e.portal_name=this.cachedObj.screenName=this.portalName,crmTab.putInCache(e.module_name,this.cachedObj),this.replaceWith("crm.tab.module.begin",r.module_name).response=e}}},renderTemplate:function(e,t){if(this.currentModel=this.currentModel?this.currentModel:{},!crmHistory.transitionError||this.currentModel.cvDeletePage||this.currentModel.errorOnModel){e.list_cv_btn=this.parent.currentModel.list_cv_btn,e.layerBtn=this.parent.currentModel.layerBtn,this.renderHTMLTemplate(e,t,this.parent.parent.getDynamicParam(),Lyte.Router.getRouteInstance("crm.tab.module.custom-view").getDynamicParam(),this.transition.data);this.isRecordFetched}},afterRender:function(e,t){this.postRender(e,t,this.parent.getDynamicParam())},actions:{onError:function(e,t){this.currentModel=e;var r=$L("crm-customview-layer")[0];r&&r.setData("show_loading",!1),crmHistory.transitionError=!0,t.resume()},sortOrder:function(e,t,r){return this.fetchCount=!1,this.setQueryParams({sort_by:e,sort_order:t,page:1,per_page:r}).data={clearCache:!0},!1},getRecord:function(e,t,r){var i=Lyte.Router.getRouteInstance(),a={page:t,per_page:e};return i.getQueryParams().filter_id&&(a.filters=customViewObject.filters?JSON.stringify(customViewObject.filters):customViewObject.filters,a.cross_filters=customViewObject.cross_filters?JSON.stringify(customViewObject.cross_filters):customViewObject.cross_filters),this.fetchCount=!1,this.fromNavigator=!0,this.fromPerpage=r,i.setQueryParams(a),!1},didTransition:function(){this.currentModel.module&&!this.currentModel.cvDeletePage&&(moduleRecordMapping[this.currentModel.module].cvid=this.parent.getDynamicParam()),delete this.currentModel.cvDeletePage,delete this.portalName,delete this.fromNavigator,this.handleKanbanSettingPopup()},willTransition:function(e){if(LytePopup.components.length>0)for(var t=LytePopup.components,r=t.length,i=0;i<r;i++)t[i].$node.id&&"rsoExpiredPopUp"===t[i].$node.id&&t[i].setData("ltPropShow",!1);"crm.tab.module.entity.detail"==e.info.route&&e.data&&(e.data.FROM_INDEX=crmListView.getObject().fromIndex,e.data.TO_INDEX=crmListView.getObject().toIndex)}}},{mixins:["crm-view-utils","crux-filter-utils","crm-list-view-modal-util"]}),Lyte.Router.registerRoute("crm.tab.module.custom-view.zia",{forceFetch:!0,queryParams:["filters","territory_id","sort_by","sort_order","layout_id","filter_id","cross_filters","include_child"],model:function(e){if(this.transition.data&&this.transition.data.reloadAll)return{};this.isRecordFetched=!1;var t=objectUtils.cloneObject(this.transition.data),r=moduleRecordMapping[this.parent.parent.getDynamicParam()],i={};i.module=r.module_name;var a=moduleRecordMapping[r.module_name];0==r.zia_view&&a.$.set("zia_view",!0),1==r.kanban_view&&a.$.set("kanban_view",!1),r.canvas_view&&a.$.set("canvas_view",!1),(l=e.queryParams).filter_id&&delete l.filter_id;var s=!!l.filters&&this.parse_Nested_Json(l.filters);if(s&&this.isOldCriteria(s))try{var o=this.oldCriteria_to_newCriteria(s,this.getRouteInstance().transition.info.dynamicParams[0]);return o||(this.filterErrorMsg(I18n.getMsg("crm.filter.error.label",I18n.getMsg("crm.report.filters")),"message"),delete l.filters),l.filters=!!o.filters&&JSON.stringify(o.filters),o.cross_filters&&(l.cross_filters=JSON.stringify(o.cross_filters)),this.transition.abort(),void(this.setQueryParams(l).data={clearCache:!0})}catch(e){this.filterErrorMsg(I18n.getMsg("crm.filter.error.label",I18n.getMsg("crm.report.filters")),"message"),delete l.filters}if((l.filters||l.cross_filters||l.filter_id)&&a&&a.id&&store.model[a.id]&&store.unloadAll(a.id),"Potentials"!=i.module&&"Leads"!=i.module||!crmTab.getFromCache(i.module)||t.clearCache||crmTab.getFromCache(i.module).cvId!=this.parent.getDynamicParam()?(delete t.cachedData,delete t.fetchOnlyBody):t.cachedData=crmTab.getFromCache(i.module),t.fetchOnlyBody&&(this.fetchOnlyBody=!0),this.td=t,t.cachedData&&t.clearselectedIds&&(t.cachedData.selectedIds=[]),delete t.clearselectedIds,delete t.clearCache,t&&!t.cachedData){for(var n in i.isload=!0,t)"refreshTemplate"!=n&&(i[n]=t[n]);var l;if(i.normListView=!1,i.predictview=!0,i.cvid=this.transition.info.dynamicParams[1],l=e.queryParams)for(var c=0;c<this.queryParams.length;c++){l[n=this.queryParams[c]]&&("filter_id"==n?i.filterId=l[n]:"filters"==n||"cross_filters"==n?(i[n]=l[n],i.isNewFilter=!0):"include_child"==n&&(i.includechild=1),"territory_id"==n&&(i.territoryId=l[n]),"layout_id"==n&&(i.layoutId=l[n]))}var d={params:i};return this.isRecordFetched=!0,networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/ShowDetails.do","POST",d)}return t.cachedData},afterModel:function(e,t){if(this.transition.data&&this.transition.data.reloadAll)return{};if("string"==typeof e)this.replaceWith("crm.tab.module.index-module",Lyte.Router.getRouteInstance("crm.tab.module").getDynamicParam()).response={model:e,skipRedirect:!0};else if(this.td&&!this.td.cachedData){if(1==e.showBlankState)e.isFromModuleInfo=!0,this.replaceWith("crm.tab.module.begin",e.module).response=e}var r=this.getQueryParams();this.cachedObj.filters=e.filters=r.filters?JSON.parse(r.filters):void 0,this.cachedObj.cross_filters=e.cross_filters=r.cross_filters?JSON.parse(r.cross_filters):void 0},renderTemplate:function(e){this.currentModel.actions=moduleRecordMapping[e.module].actions,this.currentModel.module_name=e.module,this.currentModel.search_letter=e.searchletter,this.currentModel.module_info=moduleRecordMapping[e.module],this.currentModel.cvid=moduleRecordMapping[e.module].cvid,this.setDataFromRoute(e);var t=this.getQueryParams();this.currentModel.filterQueryParams={filters:t.filters,cross_filters:t.cross_filters,filter_id:t.filter_id},app.renderTemplate(this,{outlet:"#show",component:"crm-custom-outer-box"})},afterRender:function(e){var t=crmTab.getFromCache(e.module);if(!0===e.isPredictView&&this.fetchOnlyBody&&t){t.selectedIds=e.selectedIds,t.heading=e.heading,t.filters=e.filters,t.cross_filters=e.cross_filters,t.predictData=e.predictData,t.stageBoards=e.stageBoards,t.stageSize=e.stageSize,t.layoutId=e.layoutId,t.sortColumnString=e.sortColumnString,t.sortOrderString=e.sortOrderString,crmTab.putInCache(e.module,t);var r=this.transition.data;if((r.isload&&"true"==r.isload||r.refresh&&"true"==r.refresh)&&!0,$("#lv_stageview").html(Handlebars.templates.stageView(t)),crmListView.afterRenderStageView(t),t.filterId!==e.filterId&&(e.filterId||0===$("#lv_filter_save_opt:visible").length)&&($(".filter_listcontent").removeClass("f_listclick-view"),t.filterId=e.filterId,t.filterId)){crmListView.setFiltersToDefaultState();var i={filters:e.filters,filterId:e.filterId};crmTab.putFiltersInCache(e.module,i),r.filters=JSON.stringify(crmTab.getFiltersFromCache(r.module).filters),crmListView.renderSelectedFilters(t,i),$("#lv_filter_scroll").scrollTop(0)}e.fetchCountValues&&showTotalCount($("#tcDiv #totalRecordsCount"),void 0,"false")}else crmListView.createTemplate(e);crmTab.putInCache(e.module,e);e.isload&&"true"==e.isload||e.refresh&&e.refresh,null!=e&&e.isPredictView&&!e.showBlankState?crmListView.loadPredictSummary():e.showBlankState||($("#tab_Activities img").attr("src",networkUtils.getImageUrl("listview-task-deactive_ebe803e_.png",ResourceConstants.CRM)),$("#changer img").attr("src",networkUtils.getImageUrl("listview-task-kanban-active_e14274d_.png",ResourceConstants.CRM))),crmNavig.parseCurrentListView()},beforeModel:function(){if(!this.transition.data||!this.transition.data.reloadAll){this.fetchOnlyBody=!1;this.transition.data;var e=crmTab.getFromCache(this.parent.parent.getDynamicParam());return this.cachedObj=e||{},this.makeCustomViewRequest(this.parent.getDynamicParam(),this.parent.parent.getDynamicParam())}},actions:{didTransition:function(){this.handleKanbanSettingPopup(),delete this.cachedObj},onError:function(e,t){if(e.status===crmConstants.limitExceedsCode){t.abort(),crmHistory.doNotReload=!0,history.go(-1),Search.displayLookupExceedsMsg(e);var r=$L("crm-custom-filter")[0];r&&(r.setData({isApplyFilter:!0,isSaveFilter:!1}),document.querySelector("#applyBtn").ltProp("disabled",!0)),customViewObject.filters=customViewObject.cross_filters=void 0}return this.currentModel=e,this.handleError(this.parent.parent.getDynamicParam()),!1}}},{mixins:["crm-view-utils","crux-filter-utils"]}),Lyte.Router.registerRoute("crm.tab.module.entity.add-contact-role",{queryParams:["returnAnchor","accId"],model:function(e){var t={};t.returnAnchor=e.queryParams.returnAnchor,t.step="addContactRole",t.id=this.parent.getDynamicParam(),t.accId=e.queryParams.accId;var r={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/potentials/ShowContactsRolesMapping.do","POST",r)},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.module.entity.canvas",{queryParams:["showShared"],getDependencies:function(){return networkUtils.returnDependencyFiles(["crm-canvasrule-model.js","crm-detailcanvas-utils.js"],crmConstants.jsStaticPathForLyte)},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-zdesk-rl-all.js","crm-zdesk-rl-label.js","crm-circuits-rl-all.js","crm-circuits-rl-label.js"],crmConstants.jsStaticPathForLyte);e=(e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-canvasview.js","crm-skype-field.js","crm-email-field.js","crm-circuits-rl-label.js","crm-phone-field.js","crm-dataenrichment.js","crm-recommendation-details-newview.js","similarity-details-page.js","zia-insights.js","zia-helpers.js","prediction-result.js","nba-detail-page.js","crm-image-mixin.js","setup/orchestration/crm-orchestration-detailview-pop.js","crm-salesiq-detail-view.js","crm-rl-users-list.js","crm-emails-related-list.js","email-emotions.js","crm-rl-share-email.js","email-summary.js","social_related_list_store.js","recommendation-detailed-main.js","emails_rl_user-model.js","crm-image-preview.js","crm-emailsrl-canvas-view-comp.js","crm-related-list-action-wrapper.js","crm-detail-view-data-privacy.js","crm-custom-button-wrapper.js","sales-navigator.js","crm-social-integ-outer-template.js","crm-macro.js","crm-column-list.js","crm-tag.js","crm-attachments.js","crm-activity-rel-wrapper.js","crm-activity-rel.js","crm-list-helpers.js","crux-video.js","crux-note.js","lyte-colorbox.js","crux-tag.js","crm-tag-modal.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zdeskrelatedlist")],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("scoringRulesChart"),"zohocrm_lookupBusinessCard.js"]))).concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles()))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("circuits")],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles(["zohocrm_detailview_canvas.js","zohocrm_emailTrackingStatus.js","zohocrm_detail_canvas_common.js"],crmConstants.jsStaticPath)),e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=Crm.userDetails.detailView_newUI?e.concat(networkUtils.returnDependencyFiles(["zcrm_customization.js","zcrm_dataprivacy_view_new.js",networkUtils.getI18nJSUrl("customization")])):e.concat(networkUtils.returnDependencyFiles(["zcrm_customization.js","zcrm_dataprivacy_view.js",networkUtils.getI18nJSUrl("customization")]))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("portals")],""))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("detailview"),networkUtils.getI18nJSUrl("AutoEnrichment")]))).concat(networkUtils.returnDependencyFiles(["crm-canvasview.css","crm-msg-related-list.css","crm-activity-rel-customize.css","crux-boolean-component.css","crm-canvas-criteria.css","crm-column-list.css","crm-custom-rl.css","crm-image-preview.css","crm-macro.css","crm-related-list-view-header.css","crm-activity-rel-wrapper.css","crm-emails-related-list.css","crm-rl-share-email.css","crm-rl-users-list.css","crm-zdesk-rl-all-wrapper.css","crm-zsurvey-rl-label.css","scoring_entityscore.css","crm-recommendation-details-newview.css","prediction-result.css","crm-list-view-crux.css","crm-phone-field.css","crm-circuits-rl-all.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["canvas-detailview-less.css"],crmConstants.lessStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["recommendation-similarity.css"],crmConstants.lessStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("SimilarityRecommendation")],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("NextBestAction")],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reviewprocess")]))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("crossorgs")]))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailsummary")]))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailsRelatedList")]));var t=networkUtils.returnDependencyFiles(["crm-approval-process-menu.js"],crmConstants.jsStaticPathForLyte),r=[];r=(r=(r=r.concat(t)).concat(networkUtils.returnDependencyFiles(["crm-approval-process-rejectorlistshow.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-approval-process-rejectorlistshow.css"],crmConstants.cssStaticPathForLyte)),e=e.concat(r),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-circuits-rtl.css"],crmConstants.cssStaticPathForLyte)));if(["Forecasts","Emails","Visits","Activities","Tasks","Events","Calls","Services","Appointments","JobSheets"].contains(this.parent.parent.getDynamicParam())||(e=e.concat(Crm.getVisionMyJobsDependency())),Crm.userDetails.isSegmentationEnabled&&(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["related-list-rfm.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["related-list-rfm.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("segmentation")]))),CScriptLib&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-canvas-cscript-handler.js"],crmConstants.jsStaticPathForLyte))),"Activities"!==this.parent.parent.getDynamicParam()&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-image-upload.js","crm-image-upload-create.js","lyte-scrollTo.js","exif-plugin.js","lyte-cropper.js","lyte-colorbox.js"],crmConstants.jsStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-image-upload-rtl.css","crm-image-upload-ziaError.css"],crmConstants.cssStaticPathForLyte))),e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-image-upload.css","crm-image-preview.css","crm-image-upload-create.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("imageupload")]))),"Campaigns"===this.parent.parent.getDynamicParam()){var i=networkUtils.returnDependencyFiles(["crm-campaigns-detail-view.js","crm-campaign-setup-mixin.js","crm-campaign-detail-utils.js"],crmConstants.jsStaticPathForLyte);i=i.concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles()));var a=networkUtils.returnDependencyFiles(["crm-campaigns-detail-view.css","crm-setup-campaign-index.css"],crmConstants.cssStaticPathForLyte);e=e.concat(i.concat(a));var s=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("campaignsdetail")]);e=e.concat(s);var o=networkUtils.returnDependencyFiles(["zWebinar.js",networkUtils.getI18nJSUrl("zohowebinar")]);e=e.concat(o);var n=networkUtils.returnDependencyFiles(["crm_finance_suite.js"]);e=e.concat(n)}return"Potentials"===this.parent.parent.getDynamicParam()&&e.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("detailview_stage")])),e.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Recommendation-detail")])),e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_customnew.js","zohocrm_fol.js","zohocrm_Sales_Navigator.js","crm_finance_suite.js"]))},beforeModel:function(){this.prefetchrecordfornavigation(this.transition.data);var e=this.parent.parent.getDynamicParam();detailView.currentModule=e,Crm.latestEntId=this.parent.getDynamicParam();var t=moduleRecordMapping[e],r=[];return t.fields.forEach((function(e){if("subform"===e.data_type){var t=e.subform.id;r.push(store.findRecord("module",t))}})),Lyte.resolvePromises(r)},model:function(){var e=this.parent.parent.getDynamicParam(),t=this.parent.getDynamicParam(),r=!1,i=this;return this.transition.data.skipRecordFetch||(r=!0),app.store.makeRequest("findAll","canvasview",{module:e,feature:"DetailView"}).then((function(i){var a={views:i,button:app.store.makeRequest("findAll","custom_button",{module:moduleRecordMapping[e].api_name},!0),link:app.store.makeRequest("findAll","custom_link",{module:moduleRecordMapping[e].api_name},!0),moduleField:store.findRecord("module",moduleRecordMapping[e].id,void 0,void 0,void 0,{getFields:!0}),entityDetails:networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/EntityData.do","GET",{params:{module:e,id:t},skip_load_tab:!0})};if("Quotes"===e&&Crm.isCpqActivated()&&!window.location.hostname.split(".").includes("sandbox")&&(a.cpqInfo=networkUtils.lyteInitiateRequest("/crm/v2.2/Quotes/"+t+"/__cpq_execution_info/actions/unique_line_item_product_entries","GET",{params:{},skip_load_tab:!0}),a.isCpqSupported=!0,!window.clientPortalName&&Crm.userDetails.permissions.Crm_Implied_View_Products&&moduleRecordMapping.Products.visible)){var s={per_page:200,page:1};a.cpq_suggestions=networkUtils.lyteInitiateRequest("/crm/v2.2/Quotes/"+t+"/actions/cpq_suggestions","GET",{params:s,skip_load_tab:!0})}return!r&&store.peekRecord(moduleRecordMapping[e].id,t)||(a.records=app.store.makeRequest("findRecord",moduleRecordMapping[e].id,t,{approved:"both",converted:"both",formatted_currency:!0,home_converted_currency:!0})),Lyte.resolvePromises(a)})).catch((function(e){var t=JSON.parse(e.responseText);if("FEATURE_NOT_SUPPORTED"===t.code){var r=i.parent.parent.getDynamicParam(),a=i.parent.getDynamicParam();Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[r,a]})}else"FEATURE_NOT_ENABLED"!==t.code&&"NOT_ALLOWED"!==t.code||(renderingUtils.displayPermissionDenied(),$("#popupnew").find(".mT10").text(I18n.getMsg("crm.security.error")));i.transition.abort(),$L("#show")[0].children.length<=0&&$(".dummy_Body").show()}))},afterModel:function(e){var t=this.parent.parent.getDynamicParam(),r=this.parent.getDynamicParam();e.view=store.peekRecord("canvasview",this.getDynamicParam());for(var i=e.views.length,a=!1,s=0;s<i;s++)if(e.view&&e.views[s].name===e.view.name){a=!0;break}if(!e.view||!e.view.canvas_status||!a)return this.getRouteInstance().transitionTo({route:"crm.crm-error",dynamicParams:[t]}).data={showError:!0,module:e.module,errorMsg:I18n.getMsg("canvas.not.accessible","Canvas")},void this.transition.abort();if(e.viewId=e.view.id,e.module=t,e.record=store.peekRecord(moduleRecordMapping[t].id,r),!e.record||e.records&&!e.records[0])return $("#show").empty(),Lyte.Component.render("crm-permission-error",{brandName:Crm.appName,isEntityPresence:e.entityDetails.isEntityPresence},"#show"),void this.transition.abort();detailView.entityId=e.record.id,e.viewsCount=e.views.length,e.maxViewLimit=e.views.$.meta.maxViewLimit;var o=this.transition.data;e.cvId=o.cvId,e.recordNum=o.recordNum?o.recordNum:"";var n=store.peekRecord("module",moduleRecordMapping[e.module].id),l=n.api_name;e.record.Layout?e.layoutId=e.record.Layout.id:e.layoutId=n.layouts[0].id,o.layoutId=e.layoutId,"Deals"!==e.module&&"Potentials"!==e.module||(e.stage=app.store.makeRequest("findAll","stage",{module:"Deals",layout_id:e.layoutId},!0));var c={feature:"DetailView",module:"Deals"===e.module?"Potentials":e.module,layoutId:e.layoutId};clientPortalName&&(c.entityId=detailView.entityId);var d=!1,u=store.peekRecord("module",moduleRecordMapping[t].id);if(u&&u.fields&&e.record){var m=u.fields.length;for(s=0;s<m;s++)if("email"===u.fields[s].data_type&&e.record[u.fields[s].api_name]){d=!0;break}}d&&networkUtils.lyteInitiateRequest("/crm/v2.2/"+u.api_name+"/"+e.record.id+"/actions/get_feature_specific_info","GET",{params:{features:"unsubscribed_emails"}}).then((function(t){e.emailFieldTooltipData=t}));var p={components:networkUtils.lyteInitiateRequest("/crm/v2/customization/views/components","GET",{params:c,skip_load_tab:!0}),field:app.store.makeRequest("findRecord","layout",e.layoutId,{module:l},!1,!0,{apiVersion:"2.2"}),relatedlist:app.store.makeRequest("findAll","related_list",{module:l,layout_id:e.layoutId}),rules:store.findAll("canvas_rule",{},null,null,{customizationId:e.viewId})};(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(e.module))&&(p.layoutRule=store.findAll("layout_rule",{module:l},!1,!1,e.layoutId)),(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(t))&&(p.validationRule=store.findAll("validation_rule",{layout_id:e.layoutId,module:l,download_rules:!0},!1));var g=!!e.record&&e.record.$process_flow,f=!!e.record&&e.record.$stop_processing;if(g&&!f)p.isBluePrintTrans=networkUtils.lyteInitiateRequest("/crm/v2.2/"+moduleApiMapping[t]+"/"+r+"/actions/blueprint","GET");else{var h=Lyte.registeredMixins["crm-detailcanvas-utils"];h.blueprintFldId=void 0,h.isBluePrintTrans=!1}return Lyte.resolvePromises(p).then((function(t){if(e.components=t.components.components,e.relatedlist=t.relatedlist,e.field=t.field,e.rules=t.rules,t&&t.layoutRule&&t.layoutRule.layout_rule){for(var r=t.layoutRule.layout_rule.length,i=0;i<r;i++)t.layoutRule.layout_rule[i].id=e.layoutId+"_"+i,t.layoutRule.layout_rule[i].layout=e.layoutId;store.pushPayload("layout_rule",t.layoutRule.layout_rule),e.layoutRule=t.layoutRule}if(e.validationRule=t.validationRule,e.components.forEach((function(t){["cliq","slack","cisco"].indexOf(t.name)>=0&&t.comp_available?e[t.name+"_integration"]=!0:("segmentation"===t.name&&t.comp_available||"recommendation"===t.name&&t.comp_available)&&(e[t.name+"_canvas"]=!0)})),t.isBluePrintTrans){var a=Lyte.registeredMixins["crm-detailcanvas-utils"];t.isBluePrintTrans.blueprint&&(a.blueprintFldId=t.isBluePrintTrans.blueprint.process_info.field_id,a.isBluePrintTrans=!!t.isBluePrintTrans.blueprint.transitions.length,a.showStage="Stage"!==t.isBluePrintTrans.blueprint.process_info.api_name)}return e}))},redirect:function(e){e&&e.record&&e.record.$converted&&"Leads"===moduleRecordMapping[e.module].api_name&&this.replaceWith({route:"crm.tab.module.entity.detail",dynamicParams:[this.parent.parent.getDynamicParam(),this.parent.getDynamicParam()]})},renderTemplate:function(){var e=document.body.querySelector(".zc-iframe");if(e||((e=document.createElement("iframe")).classList.add("zc-iframe"),document.body.appendChild(e)),window.CScriptLib&&CScript.Engine.Init(),$L("#show").empty(),!detailView.refreshInWms)return{component:"crm-detailview-canvas",outlet:"#show"};var t=Lyte.Router.getRouteInstance().currentModel.module;detailView.refreshCanvasView=!0,detailView.refreshTimer=setTimeout((function(){detailView.refreshInWms&&(detailView.refreshCanvasView=!1,detailView.kafkaWFStatus="timer_refresh",detailView.callLyteRefresh(t))}),15e3,t)},afterRender:function(e){if(this.transition.data.newSignUp&&CPMF.getClientPortalUserLocaleInfo(),this.canvasDependencyfieldHandling(e.layoutId,e.record,moduleApiMapping[e.module]),this.executelayoutRuleforCurrentRec(),null==detailView.refreshCanvasView||1!=detailView.refreshCanvasView){var t=this.parent.parent.getDynamicParam();null==Customization.canvasRefresh[t]&&(Customization.canvasRefresh[t]=!1);for(var r=$L("#detailcanvascontainer"),i=$L(".zctabview:not(.zcrefreshedlayout)"),a=zclayout.prototype.layouts["Tab Layout"],s=i.length,o=0;o<s;o++)a.refreshlayout(i.eq(o),this.tabHandler);$(".zcanvas_tab_hidden").each((function(){var e="#"+$(this).closest(".zc-tab-content").attr("id"),t=$(".tab[data-tab="+e+"]");t.addClass("zcanvas_contd_hidden");for(var r=t.closest('.zclayout[data-layoutname="Tab Layout"]')[0].getElementsByTagName("LI"),i=r.length,a=0;a<i;a++){var s=r[a];if(!$(s).hasClass("zcanvas_contd_hidden")){$(s).click();break}}}));var n=$L(".zctabview");if(Object.keys(Crm.canvasTab).length>0){if(Crm.canvasTab.hasOwnProperty(this.component.getData("viewId"))&&n.length>0){var l=$("#entityId").val();if(Crm.canvasTab[this.component.getData("viewId")].hasOwnProperty(l))for(var c=n.length,d=Lyte.Router.getRouteInstance().currentModel,u=0;u<c;u++){var m=n[u].getElementsByTagName("LI"),p=m.length;"Potentials"!=d.module||Crm.canvasTab[""+this.component.getData("viewId")][l][u]!=I18n.getMsg("crm.label.cf.blueprint")||d.record.$process_flow||(Crm.canvasTab[""+this.component.getData("viewId")][l][u]=I18n.getMsg("Stage"));for(var g=0;g<p;g++){var f=$(m[g]);if("Potentials"===d.module&&(m[g].textContent===I18n.getMsg("Stage")||m[g].textContent===I18n.getMsg("crm.label.cf.blueprint")))if(d.record.$process_flow){var h=Lyte.registeredMixins["crm-detailcanvas-utils"],y=h.showStage,v=h.isBluePrintTrans;(y||v)&&v&&!clientPortalName?m[g].textContent=I18n.getMsg("crm.label.cf.blueprint"):m[g].textContent=I18n.getMsg("Stage")}else m[g].textContent=I18n.getMsg("Stage");Crm.canvasTab[""+this.component.getData("viewId")][l][u]!=m[g].textContent||f.hasClass("zcanvas_contd_hidden")||(f.parent().scrollTo(f),f.click())}}}}else Crm.canvasTab={};"Potentials"===(Lyte.Router.getRouteInstance().currentModel?Lyte.Router.getRouteInstance().currentModel.module:void 0)&&this.handleStageInTabLayout();var _=function(e){var t=$L(e.target);t.closest("button").length||t.not("button").closest(".zcanvas-field").find("button , .zcref_button").click(),e.stopPropagation()};r.find("button").each((function(){$L(this).parents(".zcanvas-field:not(.zc-propagated)").click(_).addClass("zc-propagated").css("cursor","pointer")}));var b=function(){var e=$("#detailcanvascontainer"),t=e.offset(),r=$L(window).height()-t.top-28;e.height(r),$L(".zc-page-component-outer").css("min-height",r-104)};if(b(),$L(window).resize(b),this.loadRecordImage(),this.debouncemethod=this.debouncescroll.bind(this)(),this.initPageConfigMethods("debounce_load"),document.addEventListener("scroll",this.debouncemethod,!0),this.scrollhandler(),Crm.canvasScroll&&Lyte.Router.getRouteInstance().routeName!==Lyte.Router.getRouteInstance().parent.routeName){var w=$("#"+Crm.canvasScroll)[0],C=findPosY(w),D=$("#detailcanvascontainer");D.animate({scrollTop:C-D.offset().top-20},{duration:1e3,complete:"complete"})}if("true"==this.transition.info.queryParams.showShared&&0==$("#shareContactPopup").length){$("#show").append('<div id="shareContactPopup"></div>');var L=moduleRecordMapping[t].profiles,R=[],P=[],I=[],S="(profile:in:",M=L.length;for(u=0;u<M;u++)"Administrator"!==L[u].name&&(P.push(L[u].id),R.push(L[u].name));var k={};1===P.length?(S="(profile:equals:"+R[0].toString().replace("(","\\(").replace(")","\\)")+")",k.comparator="equal",k.field="profile.id",k.value=P[0]):(k.value=P,k.comparator="in",k.field="profile.id",S=S+R.join(",").replace("(","\\(").replace(")","\\)")+")"),I.push(k),I.push("and");l=detailView.entityId;var T=networkUtils.returnDependencyFiles(["crm-detailview-share-modal.js","lyte-hovercard.js"],crmConstants.jsStaticPathForLyte);T=(T=T.concat(networkUtils.returnDependencyFiles(["crm-detailview-share-modal.css"],crmConstants.lessStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("recordlevelsharing")],crmConstants.jsStaticPath)),commonUtils.showHideLoadingDiv(!0),Lyte.resolvePromises({roles:store.findAll("role",null,!1,!0),filesResolved:Lyte.injectResources(T),shareData:store.triggerAction("entity","share",{type:"GET",module:moduleRecordMapping[t].api_name,entityId:l}),moduleInfo:store.peekRecord("module",moduleRecordMapping[t].id),recordInfo:new Promise((function(e){var r=store.peekRecord(moduleRecordMapping[t].id,l);r?e(r):store.findRecord(moduleRecordMapping[t].id,l).then((function(t){e(t[0])}))}))}).then((function(e){commonUtils.showHideLoadingDiv(!1);var t={comparator:"not_equal",field:"role.name"},r=e.roles.filter((function(e){if(!e.reporting_to)return e}))[0];t.value=r.name,I.push(t);var i={type:"SubordinateRoleUsers",role_id:r.id,include_lite_users:!0},a=[{users:Array.from(new Set([Crm.userDetails.USER_ID,e.recordInfo.Owner.id])),roles:[r.id],groups:[]}];Lyte.Component.render("crm-detailview-share-modal",{userCriteria:I,searchCriteria:S,queryParam:i,module:module,entityId:l,shareData:e.shareData,moduleInfo:e.moduleInfo,excludeModel:a,excludeMembers:a,forceFetch:!0},"#shareContactPopup").show(!1)}),(function(e){commonUtils.showHideLoadingDiv(!1);var r=JSON.parse(e.responseText);"403"==e.status||"400"==e.status?"Scheduler is running"===r.message?(Lyte.Component.render("crm-detailview-share-modal",{onProcess:!0,moduleInfo:{singular_label:moduleRecordMapping[t].singular_label}},"#shareContactPopup"),$L("#crm-detailview-share-modal")[0].ltProp("show",!0)):renderingUtils.displayPermissionDenied():crmui.showMsgBand("error",I18n.getMsg("crm.mb.alert.complete.operation.later"),36e4)}))}zutils.destroyevents();var E=$("#entityName").val();if(E){var A=moduleRecordMapping[this.transition.info.dynamicParams[0]].singular_label;A=E+" ("+A+")",this.setTitle(I18n.getMsg("crm.title.entity.show",[A,Crm.appName]))}var F=document.querySelector("crm-detailview-canvas");if(!F||!F.querySelector(".zc-page-component")||zutils.renderingqueue&&zutils.renderingqueue.length||(F.setData("isPageLoaded",!0),F.component.onPageLoaded.bind(F.component)()),Customization&&Customization.approvalMsg&&(renderingUtils.showCustomAlert(Customization.approvalMsg),Customization.approvalMsg=void 0),this.transition&&this.transition.openassignment){var U=document.querySelector("crm-detailview-footer");U&&U.component&&U.component.openCanvasAssignment.bind(U.component)(!0)}detailView.pageRefreshHandlingForApprovalTransition()}},beforeExit:function(){app.cachedModulePromises={},app.reqCache={},$("body .zc-iframe").remove()},actions:{refreshRoute:function(){var e={refreshTemplate:!0};store.findAll("module").then(function(){this.refresh(e)}.bind(this))},getRecord:function(e){var t=store.peekAll(moduleRecordMapping[this.currentModel.module].id),r=this.currentModel.record.recnum,i="next"===e||"delete"===e?r+1:r-1,a=t.filter((function(e){return e.recnum===i}))[0];if("delete"===e&&!a){var s=r-1;a=t.filter((function(e){return e.recnum===s}))[0]}var o=this;store.findRecord(moduleRecordMapping[this.currentModel.module].id,a.id,{approved:"both",converted:"both"}).then((function(t){if(t){var r=(a=t[0]).$canvas_id;r?Lyte.Router.transitionTo({route:"crm.tab.module.entity.canvas",dynamicParams:[o.currentModel.module,a.id,r]}).data={recordNum:i,skipRecordFetch:!0}:crmNavig&&crmNavig[crmNavig.customViewKey]&&crmListView.getObject().fromIndex&&crmListView.getObject().toIndex?Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[o.currentModel.module,a.id],queryParams:{redirect:"false"},target:"_blank"}).data={recordNum:i,FROM_INDEX:crmListView.getObject().fromIndex,TO_INDEX:crmListView.getObject().toIndex,cvid:crmNavig.customViewKey,fromDel:!1,navig:!0}:Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[o.currentModel.module,a.id],queryParams:{redirect:"false"},target:"_blank"}).data={recordNum:i}}else if("delete"===e){var s=o.currentModel.module,n=store.peekRecord("module",moduleRecordMapping[s].id).custom_view.id;Lyte.Router.transitionTo({route:"crm.tab.module.custom-view.list",dynamicParams:[o.currentModel.module,n]})}return!1}))},didTransition:function(){Crm.canvasScroll=null,Crm.scrollToElem=null,window.UIHandler&&UIHandler.clearAlert&&UIHandler.clearAlert()},willTransition:function(){store.unloadAll("canvas_rule"),document.removeEventListener("scroll",this.debouncemethod,!0);var e=$(".zc-tablist-container");if(e.length>0){for(var t=e.length,r=[],i=0;i<t;i++){var a=e[i].getElementsByClassName("active")[0].textContent;r.push(a)}var s={};s[$("#entityId").val()]=r,Crm.canvasTab[this.component.getData("viewId")]=s}store.unloadAll("zia-insights")}},didDestroy:function(){}},{mixins:["crm-detail-view-utils","crm-detailcanvas-utils"]}),app.cscript_registry({route_name:"crm.tab.module.entity.canvas",category:I18n.getMsg("crm.label.module"),config:[{enabled:function(){var e=Lyte.Router.getRouteInstance();return!(!e||"canvas"!==e.routeName)||Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM&&!Crm.userDetails.RTL_ENABLED},name:I18n.getMsg("com.page.detailpagecanvas","Canvas"),unique_name:"module_view_canvas",handlers:["CanvasDetailPageHandler"],display_tag:!1,selectors:[{name:"Module",label:I18n.getMsg("crm.label.module"),key:"$dynamicParam:crm.tab.module.entity.canvas:0",definition:function(){return new Promise((function(e){store.findAll("module").then((function(t){var r=["Visits","Activities","Tasks","Events","Calls","Campaigns","Services__s","Appointments__s","Job_Sheets__s","Consents","Data_Subject_Requests","zohoshowtime__ShowTime_Sessions","zohoshowtime__Zoho_ShowTime","Desk","Forecasts"],i=["ZohoCPQ__s"],a=t.filter((function(e){return e.visible&&e.api_supported&&e.show_as_tab&&-1===r.indexOf(e.api_name)&&("default"===e.generated_type||"custom"===e.generated_type||"linking"===e.generated_type)&&!(e.parent_module&&-1===i.indexOf(e.parent_module.api_name))})).map((function(e){return{name:e.plural_label,value:e.module_name}}));e(a)}))}))}},{name:"Layout",label:I18n.getMsg("crm.lable.layout"),key:"$transitionData:layoutId",definition:function(e){return new Promise((function(t){var r=store.peekAll("module").filter((function(t){return t.module_name===e.Module}))[0].api_name;store.findAll("layout",{module:r}).then((function(e){var r=e.map((function(e){return{name:"Standard"===e.name?I18n.getMsg("Standard"):e.name,value:e.id}}));t(r)}))}))}},{name:"Canvas",label:"Canvas",key:"$dynamicParam:crm.tab.module.entity.canvas:2",definition:function(e){return new Promise((function(t){var r=document.querySelector("crm-detailview-oldeditor");if(r||(r=document.querySelector("crm-detailview-canvas")),r){var i=r.getData("viewId"),a=store.peekRecord("canvasview",i);a&&t([{name:a.name,value:i}])}else app.store.makeRequest("findAll","canvasview",{module:e.Module,feature:"DetailView",layoutId:e.Layout}).then((function(e){var r=e.map((function(e){return{name:e.name,value:e.id}}));t(r)}))}))}}],page_info:function(e){return{name:I18n.getMsg("crm.detailview.title"),module:store.peekAll("module").filter((function(t){return t.module_name===e.Module}))[0].api_name}},preview_route:async function(e){let t=store.peekRecord("canvasview",e.Canvas);if(t||await app.store.makeRequest("findAll","canvasview",{module:e.Module,feature:"DetailView"}),t=store.peekRecord("canvasview",e.Canvas),t&&t.canvas_status){store.registerModel(moduleRecordMapping[e.Module].id,{},{extends:"entity"});const t=await app.store.makeRequest("findAll",moduleRecordMapping[e.Module].id,{...(await store.findAll("layout",{module:store.peekAll("module").filter((t=>t.module_name===e.Module))[0].api_name})).length>1&&{filters:JSON.stringify({comparator:"equal",field:{api_name:"Layout"},value:[e.Layout]})},per_page:1,approved:"both",formatted_currency:!0});return t&&t[0]&&t[0].id?{route:"crm.tab.module.entity.canvas",dynamicParams:[moduleRecordMapping[e.Module].module_name,t[0].id,e.Canvas]}:{route:"crm.tab.module.custom-view.list",dynamicParams:[moduleRecordMapping[e.Module].module_name,moduleRecordMapping[e.Module].cvid],is_fallback:!0}}},events:{page:{name:I18n.getMsg("com.cscript.pageevents"),label:I18n.getMsg("crm.social.integ.type.page"),list:[{event:"onLoad",args:[]}]},field:{name:I18n.getMsg("com.cscript.fieldevents"),label:I18n.getMsg("crm.field.label"),child:function(e){return new Promise((function(t){var r=store.peekAll("module").filter((function(t){return t.module_name===e.Module}))[0].api_name;store.findAll("layout",{module:r}).then((function(r){var i=r.filter((function(t){return t.id===e.Layout}))[0].sections,a=[],s=["DAYSVISITED","AVERAGETIMESPENT","NUMBEROFCHATS","LASTVISITEDTIME","FIRSTVISITEDTIME","FIRSTVISITEDURL","REFERRER","VISITORSCORE"];i.forEach((function(e){a.push.apply(a,e.fields.filter((function(e){var t=store.peekRecord("field",e.id),r=t.api_name;return"profileimage"!==t.data_type&&"multiselectlookup"!==t.data_type&&"Reporting_To"!==r&&"Currency"!==r&&"Probability"!==r&&"Pricing_Model"!==r&&"Wizard"!==r&&"territory_updated_time"!==r&&("imageupload"!==t.data_type||556!==t.ui_type)&&"fileupload"!==t.data_type&&(-1!==s.indexOf(t.column_name)||t.view_type.edit)})).map((function(e){return{name:e.field_label,value:e.id}})))})),t(a)}))}))},child_label:I18n.getMsg("crm.label.field"),list:[{event:"onBeforeUpdate",args:["value"]}]},mandatory_form_events:{name:I18n.getMsg("com.cscript.bulkfieldevents"),label:I18n.getMsg("crm.field.label"),list:[{event:"onBeforeMandatoryFormSave",args:["value"]},{event:"onMandatoryFormLoad",args:["field"]}]},blueprint:{name:I18n.getMsg("com.cscript.blueprintevents"),label:I18n.getMsg("BluePrint"),list:[{event:"beforeTransition",args:["transition"]}]},tag:{name:I18n.getMsg("com.cscript.tagevents"),label:I18n.getMsg("Tag"),list:[{event:"onTagChanged",args:["tags_added","tags_removed"]}]},button:{name:I18n.getMsg("com.cscript.canvasbuttonevents","Canvas"),label:I18n.getMsg("zc.editor.button"),child:function(e){return new Promise((function(t){var r=[],i=document.querySelector("crm-detailview-oldeditor");if(i){var a=i.getData("lastsavedmapping")||{},s=Object.keys(a),o=$(".zccbutton.zclayout").filter(":data(zcanvasdata)");r=o.map((function(){var e=$(this).data("zcanvasdata");if(e.elementname&&e.systemid&&s.indexOf(e.systemid)>-1)return{name:e.elementname,value:e.systemid}})),t(Array.from(r))}else{var n=e.Canvas;Customization.getCanvasViewFromStore(n).then((function(e){if(e){var i=e.ui.script_info&&e.ui.script_info.mapping||{};r=Object.keys(i).map((function(e){if("Canvas Button"===i[e].action)return{name:i[e].element_name,value:e}})).filter((function(e){return e})),t(Array.from(r))}}))}}))},child_label:I18n.getMsg("zc.editor.button"),list:[{event:"onClick",args:[]}]},icon:{name:I18n.getMsg("com.cscript.iconevents"),label:I18n.getMsg("crm.canvas.editor.icon"),child:function(e){return new Promise((function(t){var r=[];if(document.querySelector("crm-detailview-oldeditor")){var i=$(".zcstaticicon ").filter(":data(zcanvasdata)");r=i.map((function(){var e=$(this).data("zcanvasdata");if(e.elementname&&e.systemid)return{name:e.elementname,value:e.systemid}})),t(Array.from(r))}else{var a=e.Canvas;Customization.getCanvasViewFromStore(a).then((function(e){if(e){var i=e.ui.script_info&&e.ui.script_info.mapping||{};r=Object.keys(i).map((function(e){if("Static Icon"===i[e].action)return{name:i[e].element_name,value:e}})).filter((function(e){return e})),t(Array.from(r))}}))}}))},child_label:I18n.getMsg("crm.canvas.editor.icon"),list:[{event:"onClick",args:[]}]},text:{name:I18n.getMsg("com.cscript.textevents"),label:I18n.getMsg("crm.label.text"),child:function(e){return new Promise((function(t){var r=[];if(document.querySelector("crm-detailview-oldeditor")){var i=$(".zcstatictext ").filter(":data(zcanvasdata)");r=i.map((function(){var e=$(this).data("zcanvasdata");if(e.elementname&&e.systemid)return{name:e.elementname,value:e.systemid}})),t(Array.from(r))}else{var a=e.Canvas;Customization.getCanvasViewFromStore(a).then((function(e){if(e){var i=e.ui.script_info&&e.ui.script_info.mapping||{};r=Object.keys(i).map((function(e){if("Static Text"===i[e].action)return{name:i[e].element_name,value:e}})).filter((function(e){return e})),t(Array.from(r))}}))}}))},child_label:I18n.getMsg("crm.label.text"),list:[{event:"onClick",args:[]}]}}}]}),Lyte.Router.registerRoute("crm.tab.module.entity.clone",{queryParams:["layoutId"],getResources:function(e){return this.loadResources(e,this.parent.parent.getDynamicParam())},cscript:function(){return{}},model:function(){var e=this.parent.parent.getDynamicParam();if(this.lyteConvertionSupported){var t=objectUtils.cloneObject(this.transition.data);delete t.refreshPage,delete t.backOneLevel,delete t.checkPermission;var r={};"Activities"===e&&(e=this.parent.parent.getQueryParams().sub_module),r.module=e,r.format="json",(r=Object.assign(r,t)).relmodule&&"Deals"===r.relmodule&&(r.relmodule="Potentials");var i=moduleRecordMapping[e].id,a=store.peekRecord("module",i);if(!a||!a.creatable)return crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),void this.transition.abort();for(var s=a?a.layouts.filter((function(e){return e.status>=0})):[],o=s?s.length:0,n=[],l=0;l<o;l++)n.push({id:s[l].id,name:s[l].name});var c,d,u=[],m=this.parent.parent.transition.data;m.layoutName&&m.layoutId?(u.push({uservalue:m.layoutName,systemvalue:m.layoutId,id:m.layoutId}),c=m.layoutName,d=m.layoutId):1===n.length&&(u.push({uservalue:n[0].name,systemvalue:n[0].id,id:n[0].id}),c=n[0].name,d=n[0].id);var p=this.parent.getDynamicParam();return commonUtils.showHideLoadingDiv(!0),this.getModulePromise(d,a.api_name,e,p).then(function(t){var s=store.peekRecord(i,p);if(!s)return this.handleRecNotAvailablityError();if(s&&s.$converted)return this.handleConvertedRecordError(e,s.id);if(t.clonedEntitydata=[],t.clonedEntitydata.push(s),t.layout=[],!d)if(s.Layout)d=s.Layout.id;else{var o=store.peekRecord("module",moduleRecordMapping[e].id).layouts.filter((function(e){return e.status>=0||"active"===e.status}))[0];d=o?o.id:d}return t.layout.push(store.peekRecord("layout",d)),t.custom_button&&t.custom_button.length&&(t.custom_button=t.custom_button.filter((function(e){return"create_clone"===e.position}))),{initRoute:"clone",entityrecordData:t.clonedEntitydata?t.clonedEntitydata[0]:{},transitionData:r,layoutRules:t.layout_rule,validationRules:t.validation_rule,customButtons:t.custom_button,moduleData:a,moduleId:i,moduleName:e,currsubformApinames:a.currsubformApinames?a.currsubformApinames:[],layoutddData:u,layoutddSelected:c,selectedLayoutid:d,moduleSections:t.layout[0].sections,layoutDet:t.layout,originalData:t.originalData||{},surveyDepartments:t.survey_departments?t.survey_departments:[],webinarIntegration:t.webinarIntegration?t.webinarIntegration:void 0,skyEyeIntegration:!!(t.skyEyeIntegration&&validationUtils.isNotEmpty(t.skyEyeIntegration)&&t.skyEyeIntegration.configured),fcCategory:t.fc_category?t.fc_category.stages:[]}}.bind(this))}Crm.requestParam={},(r={}).id=this.parent.getDynamicParam(),r.module="Activities"===e?this.parent.parent.getQueryParams().sub_module:e,r.format="json";var g={params:r,data_type:"json"};return this.params=r,networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Clone.do","GET",g)},didDestroy:function(){this.lyteConvertionSupported&&this.rollBackCreateEntityRecord()},beforeModel:function(e){var t=this.parent.parent.getDynamicParam();if(!e.queryParams.layoutId&&this.setInitialQueryParam(t,!1),Crm.userDetails.isStorageLimitReached&&(Crm.showStorageExceedPopup(),this.transition.abort()),this.lyteConvertionSupported&&!this.transition.data.skipModuleReqTrigger){"Activities"===t&&(t=this.parent.parent.getQueryParams().sub_module);var r=moduleRecordMapping[t].id,i=store.peekRecord("module",r);if(i&&i.api_supported)return app.store.makeRequest("findRecord","module",r,{include:["layouts","lookup_field_properties","custom_view","related_lists","business_card_fields"]})}delete this.transition.data.skipModuleReqTrigger},getDependencies:function(){return this.loadRouteDependencies()},afterModel:function(e){var t=this.parent.parent.getDynamicParam();if(this.lyteConvertionSupported)return this.handleLyteCreateAfterModelchanges(e,t,"clone");"crm.error.services.limit"==e.error&&(renderingUtils.showCustomAlert(I18n.getMsg("crm.error.services.limit",moduleRecordMapping.Appointments.singular_label),"",!1),this.transition.abort()),e&&e.title&&this.setTitle(e.title),(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(this.params.module))&&Crm.downloadValidationRules(Crm.getCrmBasePath()+"/Clone.do?format=json&module="+this.params.module+"&id="+this.params.id+(this.params.layoutId?"&layoutId="+this.params.layoutId:""),this.params.module)},renderTemplate:function(e,t){CScriptLib&&CScript.Engine.Init();var r=this.parent.parent.getDynamicParam();if(this.lyteConvertionSupported){if(this.isInvalidLayoutError||this.isLayoutPermissionError){var i=this.isInvalidLayoutError?I18n.getMsg("crm.label.layoutdelete"):I18n.getMsg("crm.label.layoutpermis");return delete this.isInvalidLayoutError,delete this.isLayoutPermissionError,renderingUtils.showCustomAlert(i,void 0,!1,(function(){Lyte.Router.transitionTo({route:"crm.tab.module",dynamicParams:[r]})})),null}window[r]||(window[r]=Object.create(crmCommonModule),window[r].moduleName=r),window[r].currentStatus="clone",app.renderTemplate(this,{outlet:"#show",component:"crm-create-entity",reRender:!0}),commonUtils.showHideLoadingDiv(!1)}else{r="Activities"==this.parent.parent.getDynamicParam()?this.parent.parent.getQueryParams().sub_module:this.parent.parent.getDynamicParam();if(window[r].currentStatus="clone",Crm.getModuleObj(r).createTemplate(e),Crm.executeLayoutRule(Crm.getCrmBasePath()+"/Clone.do",this.params,"edit"),this.currentModel.entityMapJson.SMOWNERID){var a="#"+r+"_fldRow_SMOWNERID";"Products"===r&&(a="#"+r+"_fldRow_HANDLER"),this.getRestrictionInfo(r,this.currentModel.entityMapJson.SMOWNERID.defaultid).then((function(e){if($("crm-threshold-grant").remove(),!1===e.allow){var t=document.createElement("crm-threshold-grant"),i=$(a+" .labelValCreate"),s=i.position().left,o=i.width();Crm.userDetails.RTL_ENABLED&&(s=-$(a+" .labelTabCreate").outerWidth());var n="position:relative;left:"+s+"px;width:"+o+"px;top:10px";return t.setData("rsGrantStyle",n),t.setData("moduleName",r),i.after(t),void commonUtils.showHideLoadingDiv()}}))}if("Services"==r){$("#markPopups").empty();var s=$("#Crm_Services_AVAILABLE_DATES"),o=JSON.parse(s.attr("arr_date")),n=o.length;if(s.length>0&&n>0){if(null!=o){s.val(Utils.getDateInUserDatePattern(new Date(o[0])));var l=document.createElement("a");l.setAttribute("id","removeDate_0"),l.setAttribute("class","svgIcons dIB ico_minus-lg mL10 vam mT5 fL"),l.setAttribute("onclick","CSU.removeDateField(this);"),1!=n&&$(s).after(l)}for(var c=document.getElementById("addDate_1"),d=1;d<n;d++)CSU.editDate(c,Utils.getDateInUserDatePattern(new Date(o[d])),d),c=document.getElementById("addDate_"+d)}var u=$("#Crm_Services_JOBSHEETLAYOUT");if(u.length>0){var m=$("#Crm_Services_JOBSHEETLAYOUT_img");m&&m.length>0&&(m.data().lookupModule="JobSheets"),u.data().lookupModule="JobSheets"}var p=$("#Crm_Services_AVAILABLE_CUSTOM_TIMING");p.length>0&&CSU.chooseServiceTimeOption(p)}}},afterRender:function(){commonUtils.showHideLoadingDiv(),CScriptLib&&CScript.dispatchEvent("onLoad")},getRestrictionInfo:function(e,t){return Lyte.registeredMixins["crm-assignment-threshold-common"].restrictionGrantCheck(e,t)},beforeExit:function(){var e=this.parent.parent.getDynamicParam();"Activities"==e&&(e=this.parent.parent.getQueryParams().sub_module),"Tasks"==e&&delete window[e].whoIdModulesArr}},{mixins:["crm-create-mixin"]}),app.cscript_registry({route_name:"crm.tab.module.entity.clone",category:I18n.getMsg("crm.label.module"),config:[{enabled:function(){return!Lyte.Router.getRouteInstance().transition.info.queryParams.wizardId&&store.peekAll("module").filter((e=>e.api_supported&&e.visible&&e.show_as_tab&&e.presence_sub_menu&&!_cscript._unsupported_modules.includes(e.api_name)&&!crmTab.isZBCustomModule(e.api_name)&&!crmTab.isZECustomModule(e.api_name)&&!crmTab.isZSCustomModule(e.api_name))).filter((e=>e.module_name===Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]||"crm-cscript"===Lyte.Router.getRouteInstance().routeName)).length>0},name:I18n.getMsg("com.page.clonepage"),unique_name:"module_clone",handlers:["CreatePageHandler"],display_tag:!0,selectors:[{name:"Module",key:"$dynamicParam:crm.tab.module.entity.clone:0",label:I18n.getMsg("crm.label.module"),definition:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_module_definitions()}},{name:"Layout",key:"$queryParam:layoutId",label:I18n.getMsg("crm.lable.layout"),definition:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_layout_definitions(e)}}],preview_route:async function(e){store.registerModel(moduleRecordMapping[e.Module].id,{},{extends:"entity"});const t=await app.store.makeRequest("findAll",moduleRecordMapping[e.Module].id,{...(await store.findAll("layout",{module:store.peekAll("module").filter((t=>t.module_name===e.Module))[0].api_name})).length>1&&{filters:JSON.stringify({comparator:"equal",field:{api_name:"Layout"},value:[e.Layout]})},per_page:1,approved:"both",formatted_currency:!0});return t&&t[0]&&t[0].id?{route:"crm.tab.module.entity.clone",dynamicParams:[moduleRecordMapping[e.Module].module_name,t[0].id],queryParams:{layoutId:e.Layout}}:{route:"crm.tab.module.custom-view.list",dynamicParams:[moduleRecordMapping[e.Module].module_name,moduleRecordMapping[e.Module].cvid],is_fallback:!0}},page_info:function(e){return{name:I18n.getMsg("com.page.clonepage"),module:store.peekAll("module").find((t=>t.module_name===e.Module)).api_name,layout_id:e.Layout}},events:{page:{name:I18n.getMsg("com.cscript.pageevents"),label:I18n.getMsg("crm.social.integ.type.page"),list:[{event:"onLoad",args:[]},{event:"onChange",args:["field_name"]},{event:"onSave",args:[]}]},field:{name:I18n.getMsg("com.cscript.fieldevents"),label:I18n.getMsg("crm.field.label"),child:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_fields(e)},child_label:I18n.getMsg("crm.field.label"),list:[{event:"onChange",args:["value"]}]}}}]}),Lyte.Router.registerRoute("crm.tab.module.entity.convert",{queryParams:["showPortalChange"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-convertlead.js","user_type.js","crux-tag.js"],crmConstants.jsStaticPathForLyte);return e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("convertlead")]))).concat(networkUtils.returnDependencyFiles(["crm-convert-lead.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(e=e.concat(networkUtils.returnDependencyFiles(["crm-convert-lead-rtl.css"],crmConstants.cssStaticPathForLyte))),e},beforeModel:function(){Crm.userDetails.isStorageLimitReached&&(Crm.showStorageExceedPopup(),this.transition.abort());var e=moduleRecordMapping.Leads.id;return Lyte.resolvePromises({ldmoduleData:store.findRecord("module",e)})},model:function(){var e=moduleRecordMapping.Leads.id,t=this.parent.getDynamicParam(),r=store.peekRecord("module",e),i=null,a=r.related_lists?r.related_lists:null;if(null!==a)for(var s=a.length,o=0;o<s;o++)a[o].module&&"Attachments"===a[o].module.api_name&&(i=a[o].id);return commonUtils.showHideLoadingDiv(!0),Lyte.resolvePromises([store.findRecord(e,t),store.findAll(e,{relatedId:t,relationId:i},null,!0,!1),store.triggerAction("entity","convert",{id:t,action:"convert",method:"GET"})]).then((function(e){if(!e[2].__conversion_options&&!moduleRecordMapping.Contacts.visible){var t=[];return t.push(moduleRecordMapping.Leads.plural_label),t.push(moduleRecordMapping.Contacts.plural_label),crmui.showMsgBand("error",I18n.getMsg("crm.lead.no.conversion",t),3e3),void commonUtils.showHideLoadingDiv(!1)}var r=e[0][0]&&void 0!==e[0][0].Layout?e[0][0].Layout.id:null;return Lyte.resolvePromises([store.findAll("layout",{module:moduleRecordMapping.Leads.api_name})]).then((function(t){for(var i=t[0].length,a=0;a<i;a++)if(null!==r&&r===t[0][a].id||(null===r||1===i)&&"system"===t[0][a].generated_type)return{convert_mapping:t[0][a].convert_mapping,data:e,leadFieldData:t[0][a].fields,lead_layout_id:t[0][a].id}}))}),(function(r){var i=JSON.parse(r.response);if("INVALID_DATA"===i.code)return Lyte.resolvePromises([store.findRecord(e,t,{converted:!0})]).then((function(e){return e[0][0]?{converted_detail:e[0]}:{LeadDeleted:"DeletedRecord"}}),(function(){renderingUtils.displayPermissionDenied()}));"NO_PERMISSION"===i.code||"NOT_APPROVED"===i.code||"CANNOT_PROCESS"===i.code||"RECORD_LOCKED"===i.code||"NOT_REVIEWED"===i.code||"REVIEW_REJECTED"===i.code?(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied()):crmui.showMsgBand("error",I18n.getMsg("crm.lead.error.conversion",moduleRecordMapping.Leads.singular_label),1e3),commonUtils.showHideLoadingDiv(!1)}))},afterModel:function(e,t){var r=t.queryParams;if(void 0!==e.data){if(e.Leads=e.data[0][0],void 0!==e.Leads.Tag){for(var i=e.Leads.Tag.length,a={},s={},o=0;o<i;o++)a[e.Leads.Tag[o].name]=e.Leads.Tag[o].id,s[e.Leads.Tag[o].name]=e.Leads.Tag[o].color_code;e.acntSelTags=e.Leads.Tag,e.cntSelTags=e.Leads.Tag,e.dealSelTags=e.Leads.Tag,e.tagnamevstagid=a,e.tagnamevscolor=s}if(e.attach=void 0!==e.data[1]&&(void 0!==e.data[1].length&&e.data[1].length>0),void 0!==e.data[2].__conversion_options?e.__conversion_options=e.data[2].__conversion_options:e.__conversion_options=void 0,e.singularModName=moduleRecordMapping.Leads.singular_label,e.acntsingularModName=moduleRecordMapping.Accounts.singular_label,e.cntsingularModName=moduleRecordMapping.Contacts.singular_label,e.dealsingularModName=moduleRecordMapping.Deals.singular_label,e.companyAvailable=!1,moduleRecordMapping.Accounts.visible)for(var n=e.leadFieldData.length,l=0;l<n;l++){if("COMPANY"===e.leadFieldData[l].column_name){e.companyAvailable=!0;break}}if(e.id=e.Leads.id,void 0!==e.__conversion_options&&null!==e.__conversion_options.modules_with_multiple_layouts){var c=[moduleRecordMapping.Accounts.id,moduleRecordMapping.Contacts.id,moduleRecordMapping.Deals.id],d=e.__conversion_options.modules_with_multiple_layouts;for(i=d.length,o=0;o<i;o++){var u=d[o].id;c[0]===u?e.showAcntLayout=!0:c[1]===u?e.showCntLayout=!0:c[2]===u&&(e.showDealLayout=!0)}}if(void 0!==e.__conversion_options&&e.__conversion_options.preference_field_matched_value&&null!==e.__conversion_options.preference_field_matched_value){e.disableAcnt=!1;var m=e.__conversion_options.preference_field_matched_value.Accounts&&null!==e.__conversion_options.preference_field_matched_value.Accounts?e.__conversion_options.preference_field_matched_value.Accounts:null,p=null!==e.__conversion_options.preference_field_matched_value.Contacts?e.__conversion_options.preference_field_matched_value.Contacts:null,g=null!==m?m.length:0;for(o=0;o<g;o++)if(null!==m[o].field.unique)e.disableAcnt=!0;else if("Account_Name"===m[o].field.api_name&&null===m[o].field.unique){e.disableAcnt=!1;break}var f=null!==p?p.length:null;for(o=0;o<f;o++)if(null!==p[o].field.unique){e.disablecnt=!0;break}}if(r&&!0===r.showPortalChange||"true"===r.showPortalChange)return Lyte.resolvePromises([store.findAll("user_type")]).then((function(t){for(var r=t[0],i=r.length,a=[],s=0;s<i;s++){var o=r[s];if(!0===o.active&&"Contacts"===o.personality_module.api_name&&!1===o.default){var n={};n.displayName=o.name,n.profileId=o.id,a.push(n)}}a.length>0?(e.portal_profiles=a,e.portalUserType=a[0].profileId):e.portalWarningMessage=I18n.getMsg("client.portal.convert.delete.user.warning.message",[e.cntsingularModName,e.singularModName])}));e.fromConvertAction=!0}else e.converted_detail&&e.converted_detail[0]?(void 0!==e.converted_detail[0].Converted_Account&&(e.accountObj=e.converted_detail[0].Converted_Account),void 0!==e.converted_detail[0].Converted_Contact&&(e.contactObj=e.converted_detail[0].Converted_Contact),void 0!==e.converted_detail[0].Converted_Deal&&(e.dealObj=e.converted_detail[0].Converted_Deal),e.Leads=e.converted_detail[0],e.singularModName=moduleRecordMapping.Leads.singular_label,e.acntsingularModName=moduleRecordMapping.Accounts.singular_label,e.cntsingularModName=moduleRecordMapping.Contacts.singular_label,e.dealsingularModName=moduleRecordMapping.Deals.singular_label,e.fromConvertAction=!1,e.converted=!0):"DeletedRecord"===e.LeadDeleted&&(e.RcdDeleted=!0)},renderTemplate:function(){return commonUtils.showHideLoadingDiv(!1),{outlet:"#show",component:"crm-convert-lead"}},actions:{willTransition:function(){Crm.VR&&delete Crm.VR,Crm.validationRuleJSONData.Potentials&&delete Crm.validationRuleJSONData.Potentials}},didDestroy:function(){Lyte.removeFromCache(networkUtils.returnDependencyFiles(["crm-convert-lead.css"],crmConstants.cssStaticPathForLyte))}}),Lyte.Router.registerRoute("crm.tab.module.entity.detail",{queryParams:["sub_module","showShared","iframe_src","newSignUp"],getDependencies:function(){location.host.includes("zoho.in")&&"60010197171"===crmZgid&&(detailview_log.detailDependency_start=performance.now());var e=networkUtils.returnDependencyFiles(["zohocrm_deduplicate.js"]),t=networkUtils.returnDependencyFiles(["recommendation-detailed-main.js"],crmConstants.jsStaticPathForLyte),r=e.concat(t);return r=r.concat(networkUtils.returnDependencyFiles(["zohocrm_invoice_template.js"]))},getResources:function(){var e,t=[];if(t=t.concat(networkUtils.returnDependencyFiles(["crm-detailview-tag.js","crux-tag.js"],crmConstants.jsStaticPathForLyte)),t=Crm.userDetails.RTL_ENABLED?t.concat(networkUtils.returnDependencyFiles(["crm-detailview-tag-rtl.css","crm-detailview-tag.css"],crmConstants.cssStaticPathForLyte)):t.concat(networkUtils.returnDependencyFiles(["crm-detailview-tag.css"],crmConstants.cssStaticPathForLyte)),"Campaigns"===this.parent.parent.getDynamicParam()){var r=networkUtils.returnDependencyFiles(["crm-campaigns-detail-view.js","crm-campaign-setup-mixin.js","crm-campaign-detail-utils.js"],crmConstants.jsStaticPathForLyte);r=r.concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles()));var i=networkUtils.returnDependencyFiles(["crm-campaigns-detail-view.css","crm-setup-campaign-index.css"],crmConstants.cssStaticPathForLyte);t=t.concat(r.concat(i)),Crm.userDetails.RTL_ENABLED&&t.push(networkUtils.returnDependencyFiles(["crm-campaigns-detail-view-rtl.css"],crmConstants.cssStaticPathForLyte));var a=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("campaignsdetail")]);if(t=t.concat(a),"undefined"==typeof webinar){var s=networkUtils.returnDependencyFiles(["zWebinar.js",networkUtils.getI18nJSUrl("zohowebinar")]);t=t.concat(s)}"undefined"==typeof ZCampaigns&&(t=t.concat(networkUtils.returnDependencyFiles(["ZCrmCampaigns.js"])))}else if("Services"===this.parent.parent.getDynamicParam())t.push(networkUtils.returnDependencyFiles(["crm-user-list.js"],crmConstants.jsStaticPathForLyte)),t.push(networkUtils.returnDependencyFiles(["services-availability.js"],crmConstants.jsStaticPathForLyte)),t.push(networkUtils.returnDependencyFiles(["zohocrm_services.js"])),t.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")]));else if("Appointments"===this.parent.parent.getDynamicParam())t.push(networkUtils.returnDependencyFiles(["zohocrm_services.js"])),t.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")]));else if("Potentials"===this.parent.parent.getDynamicParam())t.push(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("detailview_stage")])),t.push(networkUtils.returnDependencyFiles(["crm-stage-detailview.js"],crmConstants.jsStaticPathForLyte)),t.push(networkUtils.returnDependencyFiles(["crm-stage-detailview.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&t.push(networkUtils.returnDependencyFiles(["crm-stage-detailview-rtl.css"],crmConstants.cssStaticPathForLyte));else if(isNewCallView&&("Calls"===this.parent.parent.getDynamicParam()||"Activities"===this.parent.parent.getDynamicParam()&&"Calls"===this.parent.parent.getQueryParams().sub_module))t.push(networkUtils.returnDependencyFiles(["zcrm_callsnew2.js"],crmConstants.jsStaticPath));else if("Leads"===this.parent.parent.getDynamicParam()||"Contacts"===this.parent.parent.getDynamicParam()||"Accounts"===this.parent.parent.getDynamicParam()){var o=networkUtils.returnDependencyFiles(["zohocrm_social.css"],crmConstants.cssStaticPath);t.push(o)}t=(t=t.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("portals")],""))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reviewprocess")])),e=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-activity-rel-wrapper.css","crm-activity-rel-customize.css","crm-activity-rel-rtl.css"],crmConstants.cssStaticPathForLyte):networkUtils.returnDependencyFiles(["crm-activity-rel-wrapper.css","crm-activity-rel-customize.css"],crmConstants.cssStaticPathForLyte);var n=networkUtils.returnDependencyFiles(["crm-activity-rel-wrapper.js","crm-detailcanvas-utils.js"],crmConstants.jsStaticPathForLyte);t=t.concat(e.concat(n));var l=networkUtils.returnDependencyFiles(["crm-workflow-fields-update-popup.js"],crmConstants.jsStaticPathForLyte),c=networkUtils.returnDependencyFiles(["crm-workflow-fields-update-popup.css"],crmConstants.cssStaticPathForLyte);t=(t=t.concat(c)).concat(l);var d=networkUtils.returnDependencyFiles(["zia-insights.js"],crmConstants.jsStaticPathForLyte);t=t.concat(d);var u=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("SimilarityRecommendation")],crmConstants.jsStaticPath),m=networkUtils.returnDependencyFiles(["similarity-details-page.js","zia-helpers.js"],crmConstants.jsStaticPathForLyte),p=networkUtils.returnDependencyFiles(["recommendation-similarity.css"],crmConstants.lessStaticPathForLyte);t=t.concat(m).concat(p).concat(u);var g=networkUtils.returnDependencyFiles(["crux-tag.js"],crmConstants.jsStaticPathForLyte);t=t.concat(g);a=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("campaignsdetail")]);if(t=(t=(t=(t=t.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("detailview")]))).concat(c)).concat(a)).concat(l),Crm.userDetails.isSegmentationEnabled){var f,h=networkUtils.returnDependencyFiles(["related-list-rfm.js"],crmConstants.jsStaticPathForLyte);f=Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["related-list-rfm.css","related-list-rfm-rtl.css"],crmConstants.cssStaticPathForLyte):networkUtils.returnDependencyFiles(["related-list-rfm.css"],crmConstants.cssStaticPathForLyte);var y=h.concat(f);t=t.concat(y)}Crm.userDetails.isBestTimeEnabled&&(t=(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-besttime-new.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-besttime-new.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-besttime-zia.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-besttime-zia.css"],crmConstants.cssStaticPathForLyte))),"Activities"!==this.parent.parent.getDynamicParam()&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-image-upload.js","crm-image-preview.js","crm-image-upload-create.js","lyte-scrollTo.js","exif-plugin.js","lyte-cropper.js","lyte-colorbox.js"],crmConstants.jsStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-image-upload-rtl.css","crm-image-upload-ziaError.css"],crmConstants.cssStaticPathForLyte))),t=t.concat(networkUtils.returnDependencyFiles(["crm-image-upload.css","crm-image-preview.css","crm-image-upload-create.css"],crmConstants.cssStaticPathForLyte))),t=t.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("imageupload")]));var v=networkUtils.returnDependencyFiles(["integration/crm-zprojectsrl-store.js","crm-existing-email-quickinfo.js","crm-image-upload-ziaError.js","crm-vision-helper.js","exif-plugin.js","lyte-colorbox.js","crm-zdesk-rl-all.js","crm-zdesk-rl-label.js","crm-list-helpers.js","crm-zsurvey-rl-all.js","crm-circuits-rl-all.js","crm-circuits-common.js","crm-circuits-rl-label.js","crm-project-detail-view.js"],crmConstants.jsStaticPathForLyte),_=networkUtils.returnDependencyFiles(["crm-existing-email-quickinfo.css","crm-custom-rl.css","crm-image-upload-ziaError.css","crm-zsurvey-rl-label.css","crm-list-view-crux.css","crm-zdesk-rl-all-wrapper.css","crm-circuits-rl-all.css","integration/crm-zprojects-rl-all.css"],crmConstants.cssStaticPathForLyte),b=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zdeskrelatedlist")],crmConstants.jsStaticPath);t=t.concat(b),Crm.userDetails.RTL_ENABLED&&(_=_.concat(networkUtils.returnDependencyFiles(["crm-circuits-rtl.css"],crmConstants.cssStaticPathForLyte))),t=t.concat(v.concat(_));var w=networkUtils.returnDependencyFiles(["zohocrm_fol.js"]);t=(t=(t=0!=(t=(t=t.concat(w)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("FieldOfLookup")]))).length?t.concat(networkUtils.returnDependencyFiles(["crm-emails-related-list.js","emails_rl_user-model.js","crm-rl-users-list.js","crm-rl-share-email.js","email-summary.js","email-emotions.js"],crmConstants.jsStaticPathForLyte).concat(networkUtils.returnDependencyFiles(["crm-emails-related-list.css","crm-rl-users-list.css","crm-rl-share-email.css","email-summary.css"],crmConstants.cssStaticPathForLyte))):networkUtils.returnDependencyFiles(["crm-emails-related-list.js","emails_rl_user-model.js","crm-rl-users-list.js","crm-rl-share-email.js","email-summary.js","email-emotions.js"],crmConstants.jsStaticPathForLyte).concat(networkUtils.returnDependencyFiles(["crm-emails-related-list.css","crm-rl-users-list.css","crm-rl-share-email.css","email-summary.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["zohocrm_customnew.js","zohocrm_lookupBusinessCard.js"]))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("ziavision")]));var C=networkUtils.returnDependencyFiles(["zohocrm_blueprintattachment.js"],crmConstants.jsStaticPath);t=t.concat(C),"Leads"!==this.parent.parent.getDynamicParam()&&"Contacts"!==this.parent.parent.getDynamicParam()||(t=t.concat(networkUtils.returnDependencyFiles(["crm-salesiq-detail-view.js"],crmConstants.jsStaticPathForLyte))),t=(t=(t=(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["crm-image-mixin.js","crm-image-preview.js","crm-related-list-action-wrapper.js","crm-attachments.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-related-list-attachments.css","crm-image-preview.css","crm-related-list-view-header.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AutoEnrichment")]))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("crossorgs")]))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailsummary")]))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailsRelatedList")]));var D=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("circuits")],crmConstants.jsStaticPath);return t=(t=(t=t.concat(D)).concat(networkUtils.returnDependencyFiles(["zohocrm_emailTrackingStatus.js","zohocrm_detail_canvas_common.js","zohocrm_Sales_Navigator.js","crm_finance_suite.js"]))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Recommendation-detail")])),isMultiScoreAvail&&!Crm.userDetails.MSR_ONBOARD_POPULATED&&(t=t.concat(networkUtils.returnDependencyFiles(["scoringrules_store.js"],crmConstants.jsStaticPathForLyte))),location.host.includes("zoho.in")&&"60010197171"===crmZgid&&detailview_log.getRes.push(t),t},afterModel:function(){location.host.includes("zoho.in")&&"60010197171"===crmZgid&&(detailview_log.detailModel_end=performance.now(),detailview_log.detailModel_diff=detailview_log.detailModel_end-detailview_log.detailModel_start);var e=this.parent.parent.getDynamicParam();return void 0!==this.getQueryParams().sub_module&&"Activities"===e&&(e=this.getQueryParams().sub_module),store.model[moduleRecordMapping[e].id]||store.registerModel(moduleRecordMapping[e].id,{},{extends:"entity"}),store.peekRecord(moduleRecordMapping[e].id,this.parent.getDynamicParam())?void 0:store.findRecord(moduleRecordMapping[e].id,this.parent.getDynamicParam(),{approved:"both"})},beforeModel:function(){location.host.includes("zoho.in")&&"60010197171"===crmZgid&&(detailview_log.detailDependency_end=performance.now(),detailview_log.detailDependency_diff=detailview_log.detailDependency_end-detailview_log.detailDependency_start),this.url=void 0,this.doSendRequest=!0,this.obj=void 0;var e=objectUtils.cloneObject(this.transition.data);if(e.id=e.id?e.id:this.parent.getDynamicParam(),e.module=e.module?e.module:this.parent.parent.getDynamicParam(),"Deals"==e.module&&(e.module="Potentials"),"Meetings"==e.module&&(e.module="Events"),"Activities"==e.module&&(e.module=this.parent.parent.getQueryParams().sub_module),this.getQueryParams().iframe_src&&(e.iframe_src=this.getQueryParams().iframe_src),"CustomModule5004"==e.module&&Handlebars.registerPartial("ZOMPackagesPartial",Handlebars.templates.ZOMPackagesPartial),delete e.backOneLevel,delete e.clearCache,delete e.save,Crm.latestEntId=this.parent.getDynamicParam(),this.transition.data&&this.transition.data.fromid&&(Crm.latestEntId=this.transition.data.fromid,delete e.fromid),("true"==e.navig||e.cvid)&&"rel"!=e.pfrom&&e.recordNum){crmNavig.customViewKey=e.cvid&&"null"!=e.cvid?e.cvid:e.module,crmNavig.customViewKey=validationUtils.isNotEmpty(e.stageId)?crmNavig.customViewKey+"#"+e.stageId:crmNavig.customViewKey;var t,r=e.FROM_INDEX?parseInt(e.FROM_INDEX):$("input[name=cvFromIndex]")[0]?parseInt($("input[name=cvFromIndex]").val()):$("input[name=fromIndex]")?parseInt($("input[name=fromIndex]").val()):1,i=$("input[name=rangeValue]")[0]?parseInt($("input[name=rangeValue]").val()):$("input[name=cvRangeValue]")?parseInt($("input[name=cvRangeValue]").val()):10,a=e.TO_INDEX?parseInt(e.TO_INDEX):parseInt(r)+i-1;r&&(e.FROM_INDEX=r),a&&(e.TO_INDEX=a),t="true"!=e.fromDel?parseInt(e.recordNum)<=r?parseInt(e.recordNum)-1:parseInt(e.recordNum)+1:parseInt(e.recordNum),crmNavig.customViewKey&&-1!==crmNavig.customViewKey.indexOf("#")&&crmNavig[crmNavig.customViewKey]&&crmNavig[crmNavig.customViewKey].recordId&&(r=1,a=crmNavig[crmNavig.customViewKey].recordId.length-1),(parseInt(e.recordNum)===r||parseInt(e.recordNum)===a||"true"===e.fromDel&&"Activities"!==Crm.activityGrp[e.module])&&crmNavig[crmNavig.customViewKey]&&crmNavig.triggerFetch(r,a,t,e)}if(delete e.navig,delete e.fromRL,e.fromDetailView&&$("#detailCView").length)loadActivityDetails(void 0,void 0,e,e.id);else if("kanbanview"!=e.view){var s=!0;(e.fromActivityListView||e.fromActSubModuleListView||e.fromDetailView&&0===$("#detailCView").length&&"Activities"===Crm.activityGrp[e.module])&&(s=!1),delete e.activitytype,delete e.view,Crm.origin&&(e.origin=Crm.origin),e.format="json";if("Forecasts"==e.module&&delete e.isload,e.pfrom||(e.pfrom="cv"),"Activities"==Crm.activityGrp[e.module]&&Crm.isPageLoad&&(e.fromDetailView&&delete e.fromDetailView,e.fromActivityListView&&delete e.fromActivityListView),!e.fromActSubModuleListView&&!e.fromActivityListView&&!1!==s||(e.fromActSubModuleListView||e.fromActivityListView)&&"Activities"!==Crm.activityGrp[e.module]){var o=Crm.getCrmBasePath()+"/ShowEntityInfo.do",n=0;for(var l in e)/\b(calleeObj|clickId)\b/.test(l)||void 0!==e[l]&&(o+=0==n?"?":"&",o+=l+"="+encodeURIComponent(e[l]),n++);(e.module||e.parModule)&&(e.module?crmTab.updateTabContent(e.module):crmTab.updateTabContent(e.parModule)),this.url=o,isRelatedListLoaded=!0}0==s&&(this.doSendRequest=!1,this.obj=e)}var c=moduleRecordMapping[e.module].id;if(!store.modelFor(c)||!store.peekAll(c)||0===store.peekAll(c).length)return store.findRecord("module",c)},actions:{willTransition:function(e){if(LytePopup.components.length>0)for(var t=LytePopup.components,r=t.length,i=0;i<r;i++)t[i].$node.id&&"chat-popup"==t[i].$node.id&&t[i].setData("ltPropBindToBody",!1);null!==crmBstTime.updateTimeout&&(clearTimeout(crmBstTime.updateTimeout),crmBstTime.updateTimeout=null),null!==crmBstTime.updateInterval&&(clearInterval(crmBstTime.updateInterval),crmBstTime.updateInterval=null);var a=$("#zWebSendInvite");a&&a.is(":visible")&&CrmCampaignInteg.hideListView(),Notes.noteContent="";var s=$L("#noteContentTxt");s.length>0&&s.hasClass("lyteMentionsAdded")&&Notes.destroyMentionsComponent("noteContentTxt"),store.unloadAll("zia_insights")},didTransition:function(){if(this.actfromKanban){var e=$("#recordid_"+this.parent.getDynamicParam()),t=this.transition.column_name,r=$("#"+t+"_leftContainerctn");Territory.doHighLight("#"+t+"_leftContainerctn",e,r.offset().top,r.height()-20),e.addClass("ligraybackground"),delete this.transition.column_name,delete this.actfromKanban,delete this.kanbanResolve}}},model:function(){location.host.includes("zoho.in")&&"60010197171"===crmZgid&&(detailview_log.detailModel_start=performance.now());var e=this,t=objectUtils.cloneObject(this.transition.data);return"kanbanview"==t.view?(this.kanbanResolve={},new Promise((function(r){TaskKanbanView.kvrecordid=t.id,loadActivityDetails(void 0,void 0,t,t.id,void 0,void 0,r,e.kanbanResolve)}))):(store.unloadAll("servapp_preferences"),this.url?new Promise((function(t,r){detailView.load(e.url,void 0,void 0,void 0,t)})):0==this.doSendRequest?new Promise((function(t,r){loadDVWithRp(e.obj,t)})):void 0)},renderTemplate:function(e){if(location.host.includes("zoho.in")&&"60010197171"===crmZgid&&(detailview_log.nodeCountRenderTemp=$("*").length,detailview_log.renderTemplateStartTime=performance.now()),this.transition.kanbanData){var t=this.transition.column_name;customViewObject.columns=[t];return customViewObject.position=["Closed","Open","RelatedTo","other"].indexOf(t),customViewObject.fromDetailRoute=!0,{outlet:"#show",html:Handlebars.templates.TaskKanbanView(customViewObject)}}return e},afterRender:function(e,t){location.host.includes("zoho.in")&&"60010197171"===crmZgid&&(detailview_log.detailAfterRender_start=performance.now()),this.getQueryParams().newSignUp&&CPMF.getClientPortalUserLocaleInfo();var r=t.queryParams;if(this.transition.kanbanData){crmListView.kanbanView(this.transition.kanbanData),$("#taskKanbanViewContainer").addClass("kanbanDetailview_rewamp"),$("#"+this.transition.column_name+"_header").find(".leftheaderBack").show(),delete this.transition.kanbanData;var i=$L("#entitypopup")[0];i.innerHTML=e,this.actfromKanban=!0,Crm.evalAfterLRDownload(Crm.getCrmBasePath()+"/ShowEntityInfo.do",r.sub_module,this.parent.getDynamicParam()),EvalInnerScript(i),init()}if(this.kanbanResolve&&this.kanbanResolve.dummyPromise&&($$rightPanel.prerequisitesSettings(),this.kanbanResolve.resolve(this.kanbanResolve.responseData)),crmRelatedList.filters={},delete CustomButtonJSObjectInit.checkBox,this.url){if(adSearchClose(),isKanbanView="true"===$("#iskanbanview").val(),getObj("basic"))0!=(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)&&$.scrollTo("#basic",{axis:"y",duration:1,offset:-50});commonUtils.showHideLoadingDiv(),init(),enableSkype(),isWorking=!1;var a=void 0;if($("#recordNum").length>0&&(a=parseInt($("#recordNum")[0].value)),crmNavig.setNavigButtonState(a),returnJson){for(var s=returnJson.relListLabelsJson.relListLabelJson.length,o=[],n=0;n<s;n++)o[n]=returnJson.relListLabelsJson.relListLabelJson[n].name.toLowerCase()+"_"+returnJson.relListLabelsJson.relListLabelJson[n].id;if(crmRelatedList.personalityArr=o.join("||"),returnJson.relListLabelsJson){returnJson.layout_jsonarrayObj&&(returnJson.relListLabelsJson.layoutId=returnJson.layout_jsonarrayObj.currLayoutId);var l=Handlebars.templates.RelatedList(returnJson.relListLabelsJson);$("#relatedPageContent").html(l),$("#projects_sort")&&thirdPartyUtils.bindSelect2("#projects_sort"),$("#portalRList")&&thirdPartyUtils.bindSelect2("#portalRList select")}}var c=this.parent.parent.getDynamicParam(),d=this.parent.getDynamicParam();if(c.startsWith("Orchestration"))return;if(detailView.refreshInWms&&detailView.prevModule==detailView.currentModule)return"Activities"==c&&(c=t.queryParams.sub_module),void detailView.hideElementsForKafkaWorkFlow(c);if("CustomModule5004"==c&&$("#zbCMDetailsIframe").on("load",(function(){try{$("#zbCMDetailsIframe").contents().find("div#inventoryPackages").remove()}catch(e){}})),getObj("messageValue"))var u=Crm.getCrmBasePath()+"/NewRelatedList.do?action=getAllData&messageValue="+getObj("messageValue").value;else u=Crm.getCrmBasePath()+"/NewRelatedList.do?action=getAllData";var m=document.getElementById("relNEID"),p="";if(m&&/^[0-9]+$/.test(m.value)&&(p="&neid="+m.value),u+=p,getObj("parentCurrencyISOCode")&&getObj("parentExchangeRate")&&(u+="&parentCurrencyISOCode="+getObj("parentCurrencyISOCode").value+"&parentExchangeRate="+getObj("parentExchangeRate").value),getObj("zproject_errorcode")&&""!=getObj("zproject_errorcode").value&&"null"!=getObj("zproject_errorcode").value&&(u+="&errorcode="+getObj("zproject_errorcode").value),getObj("zproject_not_added_clients")&&""!=getObj("zproject_not_added_clients").value&&"null"!=getObj("zproject_not_added_clients").value&&(u+="&zproject_not_added_clients="+getObj("zproject_not_added_clients").value),"Potentials"==c){var g=$("#cntId");g.length>0&&"null"!==g.val()&&(u+="&relCntId="+g.val())}else"Activities"==c&&(c=this.parent.parent.getQueryParams().sub_module);var f={module:decodeURIComponent(c),id:d,fromIndex:1},h=new crmRequestPool,y={action:u,type:"GET",data:f,success:function(e){if(crmRelatedList.load(c,d,e,!0),"Accounts"===f.module||"Contacts"===f.module||"Potentials"===f.module)var t=e.ZFinance_Rel_Count.estimates+e.ZFinance_Rel_Count.salesOrders+e.ZFinance_Rel_Count.invoice,r=e.ZFinance_Rel_Count.subscriptions;if("Vendors"===f.module)t=e.ZFinance_Rel_Count.purchaseOrders;var i=$('[data-zcqa= "newleft__Zoho Finance"]');i.length||(i=$('[data-zcqa= "newleft__Zoho Books"]'));var a=$('[data-zcqa= "newleft__Zoho Subscriptions"]'),s=a.find("span.numCountn"),o=i.find("span.numCountn");if(r&&0!=a.length&&s.addClass("numCountVal").text(r),r||0==a.length||s.text("").removeClass("numCountVal"),t&&0!=i.length&&o.addClass("numCountVal").text(t),t||0==i.length||o.text("").removeClass("numCountVal"),"Accounts"===f.module){var l=$('div[ddname="CONTACTSPERSONALITY"]');$("#contactTreePopup").closest("#RelatedListCommonDiv").find("[id^=norec_]").length>0&&(l.find("[id=contactTreePopup]").addClass("disabledArow"),crmDeduplicate.initReq("/crm/v2/settings/fields","GET","module=Contacts",{"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken,"X-ZOHO-SERVICE":"crm/deduplication"},(function(e){var t=e.fields,r=!1;for(n=0;n<t.length;n++)if("REPORTINGTOCONTACTID"===t[n].column_name){r=!0;break}r||l.find("[id=contactTreePopup]").remove()})))}else if("Contacts"===f.module){(l=$('div[ddname="REPORTINGCONTACTSPERSONALITY"]')).find("[id^=norec_]").length>0&&l.find("[id=contactTreePopup]").addClass("disabledArow")}}},v={newModel:!0};v.module=c,Crm.executeLayoutRule(this.url,v,"view"),h.initiate(y)}else if(0==this.doSendRequest){var _=$("#detailCView").children().length;if(_<10){$("#taskMenuBlkdiv").css("min-height","0").css("height","auto");var b=parseInt(getObj("cvFromIndex").value);parseInt(getObj("cvToIndex").value);$("#from_To").text(b+" - "+(b+_-1))}}if("true"==this.transition.info.queryParams.showShared){var w=moduleRecordMapping[c].profiles,C=[],D=[],L=[],R="(profile:in:",P=w.length;for(n=0;n<P;n++)"Administrator"!==w[n].name&&(D.push(w[n].id),C.push(w[n].name));var I={};1===D.length?(R="(profile:equals:"+C[0].toString().replace("(","\\(").replace(")","\\)")+")",I.comparator="equal",I.field="profile.id",I.value=D[0]):(I.value=D,I.comparator="in",I.field="profile.id",R=R+C.join(",").replace("(","\\(").replace(")","\\)")+")"),L.push(I),L.push("and");var S=detailView.entityId,M=networkUtils.returnDependencyFiles(["crm-detailview-share-modal.js","lyte-hovercard.js"],crmConstants.jsStaticPathForLyte);M=(M=M.concat(networkUtils.returnDependencyFiles(["crm-detailview-share-modal.css"],crmConstants.lessStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("recordlevelsharing")],crmConstants.jsStaticPath)),commonUtils.showHideLoadingDiv(!0),Lyte.resolvePromises({roles:store.findAll("role",null,!1,!0),filesResolved:Lyte.injectResources(M),shareData:store.triggerAction("entity","share",{type:"GET",module:moduleRecordMapping[c].api_name,entityId:S}),moduleInfo:store.peekRecord("module",moduleRecordMapping[c].id),recordInfo:new Promise((function(e){var t=store.peekRecord(moduleRecordMapping[c].id,S);t?e(t):store.findRecord(moduleRecordMapping[c].id,S).then((function(t){e(t[0])}))}))}).then((function(e){commonUtils.showHideLoadingDiv(!1);var t={comparator:"not_equal",field:"role.name"},r=e.roles.filter((function(e){if(!e.reporting_to)return e}))[0];t.value=r.name,L.push(t);var i={type:"SubordinateRoleUsers",role_id:r.id,include_lite_users:!0},a=[{users:Array.from(new Set([Crm.userDetails.USER_ID,e.recordInfo.Owner.id])),roles:[r.id],groups:[]}];$(".DetailViewInnerPage").append('<div id="shareContactPopup"></div>'),Lyte.Component.render("crm-detailview-share-modal",{userCriteria:L,searchCriteria:R,queryParam:i,module:c,entityId:S,shareData:e.shareData,moduleInfo:e.moduleInfo,excludeModel:a,excludeMembers:a,forceFetch:!0},"#shareContactPopup").show(!1)}),(function(e){commonUtils.showHideLoadingDiv(!1);var t=JSON.parse(e.responseText);"403"==e.status||"400"==e.status?"Scheduler is running"===t.message?($(".DetailViewInnerPage").append('<div id="shareContactPopup"></div>'),Lyte.Component.render("crm-detailview-share-modal",{onProcess:!0,moduleInfo:{singular_label:moduleRecordMapping[c].singular_label}},"#shareContactPopup"),$L("#crm-detailview-share-modal")[0].ltProp("show",!0)):renderingUtils.displayPermissionDenied():crmui.showMsgBand("error",I18n.getMsg("crm.mb.alert.complete.operation.later"),36e4)}))}Crm.userDetails.detailView_newUI&&detailView.setCurrentStageSetReload();var k=$("#entityName").val();if(k){var T=moduleRecordMapping[this.transition.info.dynamicParams[0]].singular_label;T=k+" ("+T+")",this.setTitle(I18n.getMsg("crm.title.entity.show",[T,Crm.appName]))}var E=$L("#recentItemsModal");E[0]&&E[0].ltProp("show")&&E[0].ltProp("show",!1),location.host.includes("zoho.in")&&"60010197171"===crmZgid&&(detailview_log.detailAfterRender_end=performance.now(),detailview_log.detailAfterRender_diff=detailview_log.detailAfterRender_end-detailview_log.detailAfterRender_start)},beforeExit:function(){detailView.readOnlyField=!1,itsonview=!1;var e=$("#fieldHighlightId").eq(0);e&&e.remove();var t=$("#projectsPopup");t&&t.length>0&&t.remove(),"undefined"!=typeof customFunctionsObj&&(customFunctionsObj.listRelationId=null,customFunctionsObj.postRouteProcess()),$("#markPopups").empty()},addLogger:function(e,t){var r={type:"custom event"};r.message=e,murphy.addCustomTracking(r),murphy.error(new Error(t))}}),Lyte.Router.registerRoute("crm.tab.module.entity.edit-contact-role",{queryParams:["returnAnchor","accId"],model:function(e){var t={};t.returnAnchor=e.queryParams.returnAnchor,t.step="editContactRole",t.id=this.parent.getDynamicParam(),t.accId=e.queryParams.accId,t.pageIndex="0";var r={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/potentials/ShowContactsRolesMapping.do","POST",r)},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.module.entity.edit",{queryParams:["layoutId","wizardId"],getResources:function(e){return this.loadResources(e,this.parent.parent.getDynamicParam())},cscript:function(){return{}},beforeModel:function(e){this.permissionDenied=!1,this.isDirtyForm=!1;var t=this.parent.parent.getDynamicParam();if(void 0!==t&&"Quotes"===t&&Crm.client_tracking("CPQ-Quotes-Edit button in detailed view page"),!e.queryParams.layoutId&&this.setInitialQueryParam(t,!0),this.lyteConvertionSupported&&!this.transition.data.skipModuleReqTrigger){t="Activities"===t?this.parent.parent.getQueryParams().sub_module:t;var r=moduleRecordMapping[t];if(r&&r.api_supported)return app.store.makeRequest("findRecord","module",r.id,{include:["layouts","lookup_field_properties","custom_view","related_lists","business_card_fields"]})}delete this.transition.data.skipModuleReqTrigger},didDestroy:function(){this.rollBackCreateEntityRecord()},model:function(e){var t=this.parent.parent.getDynamicParam();if(this.isWizard=!1,this.lyteConvertionSupported)return this.newEditRequestData(t);Crm.requestParam={};var r=this.transition.data?objectUtils.cloneObject(this.transition.data):{},i=r;i.id=this.parent.getDynamicParam(),"gsearch"===r.pfrom&&(crmNavig.removeFeaturCacheObj("gsearch"),i.pfrom="gsearch"),i.tstamp=(new Date).getTime(),Crm.editReqFrom=r.reqFrom?r.reqFrom:r.returnAnchor||r.goTo?"":"listView",r.EditSeries&&(i.EditSeries="true",i.recAct=e.recAct,i.cvid=$("#cvid").val()),i.module="Activities"==t?this.parent.parent.getQueryParams().sub_module:t,delete i.backOneLevel,delete i.reqFrom;var a={params:i};crmTab.isZBCustomModule(t)||crmTab.isZSCustomModule(t)?i.newModel=!0:(i.format="json",a.data_type="json"),delete a.params.goTo,this.params=i;var s={};return s.editDo=networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/Edit.do","POST",a),Lyte.resolvePromises(s).then(function(e){return this.handleEditPromise(e.editDo,i)}.bind(this))},renderTemplate:function(e,t){CScriptLib&&CScript.Engine.Init();var r=this.parent.parent.getDynamicParam();if(this.isWizard||this.lyteConvertionSupported)window[r]||(window[r]=Object.create(crmCommonModule),window[r].moduleName=r),window[r].currentStatus="edit",window[r].entityId=this.parent.getDynamicParam(),app.renderTemplate(this,{outlet:"#show",component:"crm-create-entity",reRender:!0}),commonUtils.showHideLoadingDiv(!1);else{if(t=this.transition.data,e.responseText)return{outlet:"#show",html:e.responseText};if("string"==typeof e)return{outlet:"#show",html:e};if("Activities"==r&&(r=this.parent.parent.getQueryParams().sub_module),window[r].currentStatus="edit",window[r].entityId=this.parent.getDynamicParam(),Crm.getModuleObj(r).edit(this.parent.getDynamicParam(),e,t),"Events"!==r&&"true"!=$("#iskanbanview").val()&&(crmTab.updateTabContent(t.module),t.validationRequest&&"true"==t.validationRequest&&($("#saveAndNew"+t.module+"Btn").hide(),$("#save"+t.module+"Btn").val(I18n.getMsg("crm.validation.rule.approve.and.save.entity")).data("fromValidation",!0),$("#saveAndNew"+t.module+"Btn_Bottom").hide(),$("#save"+t.module+"Btn_Bottom").val(I18n.getMsg("crm.validation.rule.approve.and.save.entity")).data("fromValidation",!0)),!Crm.isDataEnrichAvailable||!Crm.enrichPermission||CAEExec.isEnrichDataInEditMode||"1"!==CAEExec.enrichStatusForRecord&&"6"!==CAEExec.enrichStatusForRecord||CAEExec.initEnrichDataFetchProcess(),"undefined"!=typeof CAEExec&&CAEExec.isEnrichDataInEditMode&&CAEExec.populateEnrichValues()),this.currentModel.entityMapJson.SMOWNERID){var i="#"+r+"_fldRow_SMOWNERID";"Products"===r&&(i="#"+r+"_fldRow_HANDLER"),this.getRestrictionInfo(r,this.currentModel.entityMapJson.SMOWNERID.defaultid,this.parent.getDynamicParam()).then((function(e){if($("crm-threshold-grant").remove(),!1===e.allow){var t=document.createElement("crm-threshold-grant"),a=$(i+" .labelValCreate"),s=a.position().left,o=a.width();Crm.userDetails.RTL_ENABLED&&(s=-$(i+" .labelTabCreate").outerWidth());var n="position:relative;left:"+s+"px;width:"+o+"px;top:10px";return t.setData("rsGrantStyle",n),t.setData("moduleName",r),a.after(t),void commonUtils.showHideLoadingDiv()}}))}Crm.executeLayoutRule(Crm.getCrmBasePath()+"/Edit.do",this.params,"edit"),isGlobalSearch(event)&&"Events"!==r&&adSearchClose()}},getDependencies:function(){return this.loadRouteDependencies()},afterModel:function(e){var t=this.parent.parent.getDynamicParam();if(this.isWizard||this.lyteConvertionSupported)return this.handleLyteCreateAfterModelchanges(e,t,"edit");if(e&&e.title&&this.setTitle(e.title),e.webinar_trial_expired){var r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("zohowebinar")]),i=networkUtils.returnDependencyFiles(["crm-webinar-common.js","crm-webinar-data-store.js"],crmConstants.jsStaticPathForLyte),a=networkUtils.returnDependencyFiles(["crm-webinar-common.css"],crmConstants.cssStaticPathForLyte);Lyte.injectResources(r.concat(i.concat(a)),void 0,(function(){Lyte.Component.render("crm-webinar-trial-expiry-modal",e,"#show")})),this.transition.abort()}var s=this.params;(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(s.module))&&Crm.downloadValidationRules(Crm.getCrmBasePath()+"/Edit.do?format=json&module="+s.module+"&id="+s.id+(s.layoutId?"&layoutId="+s.layoutId:""),s.module)},afterRender:function(e){if(e.vision_approvals&&e.vision_approvals.Record_Image){var t=$L(".photoUploadSec");t.addClass("cP");var r=Crm.getVisionMyJobsDependency();Lyte.injectResources(r,void 0,(function(){!function(e){var r=$L(".lnPhoto");r.find("img").hide(),"image_processing"===e.vision_approvals.Record_Image[0].failure_action?(r.addClass("lnPhoto_ziaVision lnPhoto_ziaVision_processing"),t.attr({onclick:"detailView.renderVisionErrorPopUp('"+e.vision_approvals.Record_Image[0].failure_action+"')",onmouseover:"crmui.showTooltip('"+I18n.getMsg("crm.zia.vision.processing.image")+"')",onmouseleave:"crmui.hideTooltip();"}),Lyte.Component.render("crm-zia-vision-error-popup",{action:e.vision_approvals.Record_Image[0].failure_action},"#zia-vision-popup")):(r.addClass("lnPhoto_ziaVision"),t.attr({onclick:"detailView.renderVisionErrorPopUp('"+e.vision_approvals.Record_Image[0].failure_action+"','"+e.module+"','"+e.entityId+"','"+e.vision_approvals.Record_Image[0].vision_id+"','"+e.vision_approvals.Record_Image[0].visionApproval_id+"',true,"+!1+")",onmouseover:"crmui.showTooltip('"+I18n.getMsg("crm.zia.vision.validation.failure.msg")+"')",onmouseleave:"crmui.hideTooltip();"}))}(e)}))}var i=!1;if(store.peekAll("module").forEach((function(e){"Projects"===e.api_name&&e.visible&&(i=!0)})),i){var a=Lyte.Router.getRouteInstance(),s=a.parent.getDynamicParam(),o=a.parent&&a.parent.parent?a.parent.parent.getDynamicParam():null;$L(".projectsTaskSyncBtn").hide();var n=$L("#Crm_Tasks_SEID");if($L("#Crm_Tasks_CONTACTID").keyup((function(){var e=$L("#Crm_Tasks_CONTACTID");""===$L("#Crm_Tasks_SEID").val()&&""===e.val()&&$L(".projectsTaskSyncBtn").hide()})),n.keyup((function(){var e=$("#Crm_Tasks_SEID"),t=e.attr("id"),r=$("#Crm_Tasks_CONTACTID").val(),i=$("#Crm_Tasks_CONTACTID_WhoId_select option:selected").val();store.peekRecord("crm-project-sync-task",s).module!==crmModuleConstants.Potentials&&(i===crmModuleConstants.Contacts&&""===r&&(""===e.val()||crmLookupAutoComplete.searchModule===crmModuleConstants.Accounts&&null!==t&&t.indexOf("CF")<0)&&$L(".projectsTaskSyncBtn").hide())})),null!==o&&"Activities"===o){var l=$(".projectsTaskSyncBtn"),c=store.peekRecord("crm-project-sync-task",s);void 0!==s&&c?(null!==c.firstSelectedProject&&"TASK_NOT_SYNCED"===c.code?l.show():l.hide(),l.attr("disabled",!!crmTasks.isRecurringSet()).attr("title",crmTasks.isRecurringSet()?"Recurring task cannot be pushed to Projects":"")):l.hide()}}else $(".projectsTaskSyncBtn").hide();var d=(c=objectUtils.cloneObject(this.transition.data)).reqFrom?c.reqFrom:c.returnAnchor||c.goTo?"":"listView",u=this.parent.parent.getDynamicParam();if(c.fromKv&&crmTab.isZBCustomModule(u)||crmTab.isZSCustomModule(u)){if("true"===$("#iskanbanview").val()?(PAGE_CACHE[u]&&PAGE_CACHE[u].New&&delete PAGE_CACHE[u].New,objectUtils.cloneObject(document.getElementById("kventitydetailspage")),document.getElementById("mapValues")&&document.getElementById("mapValues").parentNode.removeChild(document.getElementById("mapValues")),$("#entitypopup").html(),"cvEditSave"):$("#taskDetailsPart").length&&("taskDetailsPart",{},$("#taskDetailsPart").html()),"kvlistview"===d&&0===TaskKanbanView.kvrecordid){"false";var m=$(targetElem).closest(".kvtlistbgheader").attr("id");$("#kvType").val(m),taskDetailsview.listAnimation("open")}$("#cvEditSave").show()}if("Services"==u){$("#markPopups").empty();var p=$("#Crm_Services_AVAILABLE_DATES"),g=JSON.parse(p.attr("arr_date")),f=g.length;if(p.length>0&&f>0){if(null!=g){p.val(Utils.getDateInUserDatePattern(new Date(g[0])));var h=document.createElement("a");h.setAttribute("id","removeDate_0"),h.setAttribute("class","svgIcons dIB ico_minus-lg mL10 vam mT5 fL"),h.setAttribute("onclick","CSU.removeDateField(this);"),1!=f&&$(p).after(h),Crm.holidays.selectedDate.push(g[0])}for(var y=document.getElementById("addDate_1"),v=1;v<f;v++)CSU.editDate(y,Utils.getDateInUserDatePattern(new Date(g[v])),v),y=document.getElementById("addDate_"+v)}var _=$("#Crm_Services_JOBSHEETLAYOUT");if(_.length>0){var b=$("#Crm_Services_JOBSHEETLAYOUT_img");b&&b.length>0&&(b.data().lookupModule="JobSheets"),_.data().lookupModule="JobSheets"}var w=$("#Crm_Services_AVAILABLE_CUSTOM_TIMING");w.length>0&&CSU.chooseServiceTimeOption(w)}if($("#forEditViewScroll").change(function(){this.isDirtyForm=!0}.bind(this)),commonUtils.showHideLoadingDiv(),this.lyteConvertionSupported){if(!Crm.userDetails.CLIENT_ACCOUNT){if(this.setEntichDataOnInit(this.currentModel),Crm.isDataEnrichAvailable&&Crm.enrichPermission&&!CAEExec.isEnrichDataInEditMode&&("1"===CAEExec.enrichStatusForRecord||"6"===CAEExec.enrichStatusForRecord)){var C=[];"Leads"===this.currentModel.moduleName?C=["COMPANY","EMAIL","WEBSITE"]:"Contacts"===this.currentModel.moduleName?C=["ACCOUNTID","EMAIL"]:"Accounts"===this.currentModel.moduleName&&(C=["ACCOUNTNAME","WEBSITE"]);var D="",L=this.currentModel.moduleName,R=C.length;C.forEach((function(e,t){D+="crm-create-fields#"+L+"_fldRow_"+e,t+1!==R&&(D+=",")}));var P=$L(D)[0];P&&P.component&&P.component.triggerDataEnrichment()}"undefined"!=typeof CAEExec&&CAEExec.isEnrichDataInEditMode&&crmTemplate.assignEnrichmentDataDetails(CAEExec.columnVsEnrichVal,"edit")}if(this.currentModel&&this.currentModel.entityrecordData&&this.currentModel.entityrecordData.$zia_visions){var I={};function S(e){switch(e){case"zia_vision_validation":e="image_processing";break;case"zia_vision_pending":e="create_without_image";break;case"zia_vision_rejected":e="do_not_create";break;default:e="image_approval"}return e}(this.currentModel.entityrecordData.$zia_visions.length?this.currentModel.entityrecordData.$zia_visions:[]).forEach(function(e){if(e&&e.field){var t=store.peekRecord("field",e.field.id);if(t){var r=[];if("profileimage"===t.data_type)r.push({failure_action:S(),visionApproval_id:e.vision_approvals.id,vision_id:e.id});else if("imageupload"===t.data_type){var i=this.currentModel.entityrecordData[e.field.api_name];i&&i.length&&i.forEach(function(t){r.push({attachment_id:t.id,failure_action:S(this.currentModel.entityrecordData.$approval_state),visionApproval_id:e.vision_approvals.id,vision_id:e.id})}.bind(this))}r&&r.length&&(I[e.field.api_name]=r)}}}.bind(this)),Object.keys(I).length&&(this.currentModel.vision_approvals=I)}}CScriptLib&&CScript.dispatchEvent("onLoad")},getRestrictionInfo:function(e,t,r){return Lyte.registeredMixins["crm-assignment-threshold-common"].restrictionGrantCheck(e,t,r)},actions:{onError:function(e){if(e.status===crmConstants.errorStatusCode)return renderingUtils.displayPermissionDenied(e),$("#cvEditSave").hide(),this.permissionDenied=!0,!1;if(e.status===crmConstants.limitExceedsCode)Search.displayLookupExceedsMsg(e);else{var t='<div onclick=/"sE()" class="w500 p20"><div class="floatL pL20 w430"><div class="f20"><h2 style="color:#E20000";>'+I18n.getMsg("crm.delete.error")+'</h2></div><div class="mT10">'+I18n.getMsg("crm.record.delete.message",[Crm.getCrmBasePath()])+'</div></div><br class="clearB"><div  class="alignright mT20"><input type="button" id="popupok" class="primarybtn" value="'+I18n.getMsg("crm.button.ok")+"\" onclick=\"hide('popupnew');removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30\"></div></div>";renderingUtils.popUpWithFreeze(t)}},willTransition:function(e){if(this.permissionDenied&&e.data&&e.data.fromDetailView)delete e.data.fromDetailView,e.data.fromActivityListView=!0;else{var t=e.pause(),r="true"===$("#iskanbanview").val();!this.isDirtyForm||(!r||!getElemById("cvEditSave")||"none"===getElemById("cvEditSave").style.display||iskvFollowupTask||"crm.tab.module.entity.detail"!=e.target||e.data&&e.data.backOneLevel)&&(r||!$("#forEditViewScroll").length||e.data&&(e.data.backOneLevel||e.data.fromSave))?((this.isWizard||this.lyteConvertionSupported)&&this.rollbackRecord(),t.resume()):showConfirmBox(void 0,t)}for(var i=$("crm-image-upload-create"),a=i.length,s=0;s<a;s++)for(var o=i[s].component.data.imageData.length,n=0;n<o;n++){var l=i[s].component.data.imageData[n];URL.revokeObjectURL(l.src)}}},beforeExit:function(){this.unloadWizardComponents();var e=this.parent.parent.getDynamicParam();"Activities"==e&&(e=this.parent.parent.getQueryParams().sub_module),"Tasks"==e&&delete window[e].whoIdModulesArr},rollbackRecord:function(){var e=this.currentModel?this.currentModel.entityrecordData:void 0;if(e&&e.$&&e.$.isModified)for(var t in this.currentModel.originalData){var r=e.$.model.fieldList[t];if("relation"==r.type&&"hasMany"==r.relType)for(var i=this.currentModel.originalData[t],a=i.length,s=0;s<a;s++){var o=e[t].filter((function(e){return e.id==i[s].id}));if(o=o&&o[0]?o[0]:{},validationUtils.isNotEmpty(o))for(var n in i[s]){var l=o.$.model.fieldList[n];!l||"date"!=l.type&&"datetime"!=l.type&&"phone"!=l.type&&"multi-picklist"!=l.type||i[s][n]&&(o[n]=Lyte.Transform[l.type].deserialize(i[s][n]))}}else e[t]=Lyte.Transform[r.type].deserialize(this.currentModel.originalData[t])}}},{mixins:["crm-create-mixin"]}),app.cscript_registry({route_name:"crm.tab.module.entity.edit",category:I18n.getMsg("crm.label.module"),config:[{enabled:function(){return!Lyte.Router.getRouteInstance().transition.info.queryParams.wizardId&&store.peekAll("module").filter((e=>e.api_supported&&e.visible&&e.show_as_tab&&e.presence_sub_menu&&!_cscript._unsupported_modules.includes(e.api_name)&&!crmTab.isZBCustomModule(e.api_name)&&!crmTab.isZECustomModule(e.api_name)&&!crmTab.isZSCustomModule(e.api_name))).filter((e=>e.module_name===Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]||"crm-cscript"===Lyte.Router.getRouteInstance().routeName)).length>0},name:I18n.getMsg("com.page.editpage"),unique_name:"module_edit",handlers:["CreatePageHandler"],display_tag:!0,selectors:[{name:"Module",key:"$dynamicParam:crm.tab.module.entity.edit:0",label:I18n.getMsg("crm.label.module"),definition:function(){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_module_definitions()}},{name:"Layout",key:"$queryParam:layoutId",label:I18n.getMsg("crm.lable.layout"),definition:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_layout_definitions(e)}}],preview_route:async function(e){store.registerModel(moduleRecordMapping[e.Module].id,{},{extends:"entity"});const t=await app.store.makeRequest("findAll",moduleRecordMapping[e.Module].id,{...(await store.findAll("layout",{module:store.peekAll("module").filter((t=>t.module_name===e.Module))[0].api_name})).length>1&&{filters:JSON.stringify({comparator:"equal",field:{api_name:"Layout"},value:[e.Layout]})},per_page:1,approved:"both",formatted_currency:!0});return t&&t[0]&&t[0].id?{route:"crm.tab.module.entity.edit",dynamicParams:[moduleRecordMapping[e.Module].module_name,t[0].id],queryParams:{layoutId:e.Layout}}:{route:"crm.tab.module.custom-view.list",dynamicParams:[moduleRecordMapping[e.Module].module_name,moduleRecordMapping[e.Module].cvid],is_fallback:!0}},page_info:function(e){return{name:I18n.getMsg("com.page.editpage"),module:store.peekAll("module").find((t=>t.module_name===e.Module)).api_name,layout_id:e.Layout}},events:{page:{name:I18n.getMsg("com.cscript.pageevents"),label:I18n.getMsg("crm.social.integ.type.page"),list:[{event:"onLoad",args:[]},{event:"onChange",args:["field_name"]},{event:"onSave",args:[]}]},field:{name:I18n.getMsg("com.cscript.fieldevents"),label:I18n.getMsg("crm.field.label"),child:function(e){return Lyte.registeredMixins["crm-cscript-global-mixin"].get_fields(e)},child_label:I18n.getMsg("crm.field.label"),list:[{event:"onChange",args:["value"]}]}}}]}),Lyte.Router.registerRoute("crm.tab.module.entity.find-and-merge",{queryParams:["filter","findDupFldName"],getResources:function(){return networkUtils.returnDependencyFiles(["zohocrm_deduplicate.js",networkUtils.getI18nJSUrl("deduplication")])},model:function(e){var t={},r=e.queryParams,i=this.parent.getDynamicParam(),a=r.filter,s=moduleRecordMapping[this.parent.parent.getDynamicParam()].module_name,o=Crm.getCrmBasePath()+"/EntityDuplicate.do";if(a){o=Crm.getCrmBasePath()+"/FindDuplicate.do";var n=objectUtils.cloneObject(this.transition.data);if(n.findDupFldName="",n.searchDetails){for(var l=JSON.parse(n.searchDetails),c=n.match,d=Object.keys(l).length,u=1;u<=d;u++){for(j=0;j<l["pattern"+u].length;j++)n[l["pattern"+u][j][0]]=l["pattern"+u][j][1];1!=u&&(n["match"+u]="101"==c?"or":"and")}n["property(Match)"]=c,delete n.match,delete n.searchDetails,t=n}}r.findDupFldName&&(t.findDupFldName=r.findDupFldName),t.id=i,t.module=s;var m={params:t};return networkUtils.lyteInitiateRequest(o,"GET",m)},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.module.actions.add-to-campaigns",{queryParams:["entity-id"],model:function(e){var t={actiontype:"mass_addRecords",lookback:"showdetails"};t.entityId=e.queryParams["entity-id"],t.module=this.parent.parent.getDynamicParam(),delete t.backOneLevel;var r={params:t};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/MassRecords.do","POST",r)},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.module.actions.approvals",{queryParams:["actionName","showDuplicates","fromIndex","toIndex"],model:function(e){var t=e.queryParams;t.newModel=!0;var r=this.parent.parent.getDynamicParam(),i="Contacts"==r?Crm.getCrmBasePath()+"/WebContactApproval.do":"Cases"==r?Crm.getCrmBasePath()+"/WebCaseApproval.do":Crm.getCrmBasePath()+"/WebLeadApproval.do";return r.indexOf("CustomModule")>-1&&(i=Crm.getCrmBasePath()+"/WebRecordApproval.do"),i+="?module="+r,networkUtils.lyteInitiateRequest(i,"POST",{params:t})},renderTemplate:function(e){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.module.actions.deduplicate",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-list-mass-action.css"],crmConstants.lessStaticPathForLyte);return networkUtils.returnDependencyFiles(["zohocrm_deduplicate.js",networkUtils.getI18nJSUrl("deduplication")]).concat(e)}}),Lyte.Router.registerRoute("crm.tab.module.actions.draft",{queryParams:["filters","sort_by","sort_order","page","per_page","search_letter","territory_id","filter_id","draftView"],getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-record-draft-view.js","crm-wizard-configuration-helpers.js","crm-wizard-common-helpers.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["wizard-draft.css","crm-list-mass-action.css"],crmConstants.lessStaticPathForLyte);return e.concat(t)},getDependencies:function(){return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("wizardsdrafts")],crmConstants.jsStaticPath)},beforeModel:function(){var e=Lyte.Router.getRouteInstance("crm.tab.module").transition.info.dynamicParams[0];Crm.userDetails.permissions["Crm_Implied_Create_"+moduleRecordMapping[e].module_name]&&moduleRecordMapping[e].visible||(crmHistory.handleAjaxErrorLyte=!0,this.transition.abort(),renderingUtils.displayPermissionDenied())},model:function(){var e=Lyte.Router.getRouteInstance("crm.tab.module").transition.info.dynamicParams[0],t={};return store.findRecord("module",moduleRecordMapping[e].id).then((function(r){return t.modules=r,store.findAll(moduleRecordMapping[e].id,{per_page:10,state:"draft"}).then((function(e){return t.records=e,t}))}))},afterModel:function(e){var t=e.modules[0].custom_view.fields.length<6?e.modules[0].custom_view.fields.length:6;e.custom_view_fields=e.modules[0].custom_view.fields.slice(0,t),e.fields_list=e.custom_view_fields.map((function(e){return e.api_name})).join(),e.module=e.modules[0],e.criteriaFields=e.module.fields.filter((function(e){return e.filterable})),e.records.length&&(e.moreRecords=e.records.$.meta.more_records,e.records.$.meta.per_page>e.records.$.meta.count?e.perPage=e.records.$.meta.count:(e.perPage=e.records.$.meta.per_page,e.absolutePerPage=e.records.$.meta.per_page))},renderTemplate:function(){return{outlet:"#show",component:"crm-record-draft-view"}},actions:{willTransition:function(e){if(e.info.dynamicParams&&2==e.info.dynamicParams.length&&store.model[moduleRecordMapping[e.info.dynamicParams[0]].id]){var t=store.peekRecord(moduleRecordMapping[e.info.dynamicParams[0]].id,e.info.dynamicParams[1]);if(t){for(var r=t.Layout&&t.Layout.id?t.Layout.id:this.currentModel.module.layouts[0].id,i=store.peekRecord("layout",r),a=!1,s=i.profiles.length,o=0;o<s;o++)if(i.profiles[o].id===userInfo.users[0].profile.id){a=!0;break}if(!a)return renderingUtils.displayPermissionDenied(),void e.abort()}}}}}),Lyte.Router.registerRoute("crm.tab.module.actions.generate-po",{beforeModel:function(){Crm.userDetails.isStorageLimitReached&&(Crm.showStorageExceedPopup(),this.transition.abort())},model:function(e){var t={params:{newModel:!0}};return networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/GeneratePO.do","GET",t)},renderTemplate:function(e,t){return{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.tab.module.actions.mass-tools",{queryParams:["type","filter","page","per_page"],isReload:!1,getResources:function(){if("mass_email"!==Lyte.Router.getRouteInstance().getQueryParams().type){var e=networkUtils.returnDependencyFiles(["crm-mass-tools.css","crm-mass-tool-header.css"],crmConstants.lessStaticPathForLyte);return(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-inner-list-new.css","crm-page-navigator.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("masstools")]))).concat(networkUtils.returnDependencyFiles(["crm-mass-tools.js","crm-mass-tool-header.js","crm-inner-list.js","crm-page-navigator.js","crm-list-helpers.js","crm-mass-action-mixin.js"],crmConstants.jsStaticPathForLyte))}},beforeModel:function(e){var t=this.parent.parent.getDynamicParam();moduleRecordMapping[t]||(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(void 0,void 0,void 0,void 0,void 0,(function(){Lyte.Router.getRouteInstance().replaceWith("crm.tab.module.begin","Home")})));var r=(this.transition.data&&this.transition.data.query_params?this.transition.data.query_params:e.queryParams).type;if((r&&"convert"===r||"mass_convert"===r)&&(Crm.userDetails.isStorageLimitReached&&(Crm.showStorageExceedPopup(),this.transition.abort()),!moduleRecordMapping.Contacts.visible)){var i=[];i.push(moduleRecordMapping.Leads.plural_label),i.push(moduleRecordMapping.Contacts.plural_label),_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.lead.no.conversion",i),ltPropType:"error"}}),commonUtils.showHideLoadingDiv(!1),this.transition.abort()}this.unloadProperty("field",moduleRecordMapping[t].fields)},model:function(e){var t=this.transition.data&&this.transition.data.query_params?this.transition.data.query_params:e.queryParams,r={},i=t.type,a=t.filter,s=t.page,o=t.per_page,n=Crm.getCrmBasePath()+"/MassRecords.do";r.module=this.parent.parent.getDynamicParam(),r.actiontype=i;var l=moduleRecordMapping[r.module];if(a){var c=JSON.parse($ESAPI.encoder().decodeFromURL(a));delete c.calleeObj,delete c.backOneLevel;var d=o?parseInt(o):void 0,u=s?parseInt(s):void 0;if(d&&o){var m=u*d-d+1>0?u*d-d+1:1;c.from_index=m,c.to_index=m+d-1}if($("#fromIndex").length>0&&c.NorP){var p=c.NorP,g=$("#fromIndex").val()?parseInt($("#fromIndex").val()):void 0;d=$("#currentOption").val()?parseInt($("#currentOption").val()):void 0;if("next"==p){if(g&&d){var f=g+d;c.from_index=f,c.to_index=f+d-1}}else if("previous"==p&&g&&d){f=g-d;c.from_index=f>0?f:1,c.to_index=f+d-1}}delete c.NorP}if(this.transition.data&&this.transition.data.onlyFilter){var h={params:c};return networkUtils.lyteInitiateRequest(n,"POST",h)}if(a){h={params:r};var y=networkUtils.lyteInitiateRequest(n,"POST",h),v={params:r=c},_=networkUtils.lyteInitiateRequest(n,"POST",v);return Lyte.resolvePromises({withoutFilter:y,withFilter:_})}if("mass_delete"===i||"mass_update"===i||"mass_transfer"===i||"mass_convert"===i){store.unloadAll(l.id);var b={},w=this,C=store.peekRecord("user",Crm.userDetails.USER_ID).profile.id;return b.privacy_preference=store.findAll("dummy",void 0,!1,!1,{url:"crm/v2/settings/privacy_preferences",method:"GET"}),b.fields=store.findAll("field",{module:l.api_name,type:"all"},void 0,void 0,{apiVersion:"2.2"}),b.profile=store.findRecord("profile",C),"Contacts"===l.module_name&&(b.relativeFields=store.findAll("field",{module:moduleRecordMapping.Accounts.api_name,type:"all"},void 0,void 0,{apiVersion:"2.2"})),Lyte.resolvePromises(b).then((function(e){e.preference=e.privacy_preference.privacyPreference[0].preference,e.consent_modules=JSON.parse(e.preference.consent_modules);var t="mass_transfer"===i?"Transfer":"mass_update"===i?"Update":"mass_delete"===i?"Delete":"mass_convert"===i?"Convert":"Others";if(w.checkPermission(C,"Potentials"===l.module_name?"Deals":l.module_name,t))return e;w.transition.abort(),crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied()}),(function(e){var t=JSON.parse(e.response);403!==e.code&&"NO_PERMISSION"!==t.code||(crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied())}))}h={params:r};return networkUtils.lyteInitiateRequest(n,"GET",h)},afterModel:function(e,t){var r=this.transition.data&&this.transition.data.query_params?this.transition.data.query_params:t.queryParams,i=this.currentModel.type=r.type.split("mass_")[1],a=r.type;if(this.currentModel.module=this.parent.parent.getDynamicParam(),this.currentModel.module_info=moduleRecordMapping[this.parent.parent.getDynamicParam()],this.currentModel.instruction1="crm.mass."+i+".instruction1",this.currentModel.instruction2="crm.mass."+i+".instruction2","update"===i?(this.currentModel.actionName="crm.module.mass.update",this.currentModel.helpKey="help.update.response"):"convert"===i?(this.currentModel.actionName="crm.mass.convert.button",this.currentModel.helpKey="help.lead.massconvert"):(this.currentModel.actionName="crm.button."+i,this.currentModel.helpKey="transfer"===i?"help.mass.records."+i:"help.mass."+i),"mass_delete"===a||"mass_update"===a||"mass_transfer"===a||"mass_convert"===a){this.currentModel.columnFields=this.getHardCodedColumns();var s=Lyte.deepCopyObject(moduleRecordMapping[this.currentModel.module].fields);if(this.currentModel.fields=this.getCriteriaFields(s),"Contacts"===this.currentModel.module){s=Lyte.deepCopyObject(moduleRecordMapping.Accounts.fields);var o=this.getCriteriaFields(s,crmConstants.moduleDisplayField.Accounts[0]);this.currentModel.fields=this.currentModel.fields.concat(o)}}},renderTemplate:function(e,t){var r=this.transition.data&&this.transition.data.query_params?this.transition.data.query_params:t.queryParams;return"mass_delete"===r.type||"mass_update"===r.type||"mass_transfer"===r.type||"mass_convert"===r.type?{outlet:"#show",component:"crm-mass-tools"}:r.filter?this.transition.data&&this.transition.data.onlyFilter?(thirdPartyUtils.unbindChildEvents("#massResult"),{outlet:"#massResult",html:e}):(thirdPartyUtils.unbindChildEvents("#show"),{outlet:"#show",html:e.withoutFilter}):(thirdPartyUtils.unbindChildEvents("#show"),{outlet:"#show",html:e})},afterRender:function(e,t){var r=0,i=this.transition.data&&this.transition.data.query_params?this.transition.data.query_params:t.queryParams,a=i.type,s=i.filter,o=i.page,n=JSON.parse($ESAPI.encoder().decodeFromURL(s)),l=!!this.transition.data&&this.transition.data.onlyFilter;(l?(delete this.transition.data.onlyFilter,r=n.rowCount):s&&($("#massResult").html(e.withFilter),r=isNaN(parseInt(n.rowCount))?0:parseInt(n.rowCount)),o)&&$('<input id="page_no" type="hidden" value="'+o+'" />').insertAfter("#fromIndex");if("mass_update"===a||l||"mass_delete"===a||"mass_transfer"===a||"mass_convert"===a||(r>0?(Search.setValues("create",n),Search.rowcnt=r):(Search.setDefaultValues("create",void 0,void 0,void 0,void 0,!0),Search.rowcnt=1,thirdPartyUtils.bindSelect2("select"))),"mass_email"!==a){var c=this.transition.data;if(c.mass_data){var d=c.mass_data,u=$L("crm-mass-tools")[0].component;u.setData({criteria:d.criteria,per_page:d.pageDet.per_page}),"mass_transfer"===a&&u.setData({fromValue:d.userDetails.fromValue,toValue:d.userDetails.toValue,massqp:d.userDetails.massqp}),u.fetchRecords(void 0,d.pageDet.page,d.pageDet.per_page,!0,{searchClick:!0}),u.setData("showToggleBtn",!0)}var m=networkUtils.returnDependencyFiles(["crm-mass-actions.js","crm-lookuplimit-exceed-popup.js","lyte-hovercard.js"],crmConstants.jsStaticPathForLyte);m=m.concat(networkUtils.returnDependencyFiles(["crm-mass-action.css","crm-lookuplimit-exceed-popup.css"],crmConstants.lessStaticPathForLyte)),Lyte.injectResources(m)}},actions:{onError:function(e){return commonUtils.showHideLoadingDiv(),e.responseText.indexOf("ENCRYPTED_FIELDS_IN_CRITERIA")>-1&&renderingUtils.showCustomAlert(I18n.getMsg("ear.error.message.criteria.comparator.not.allowed",e.responseText.split("###")[1])),e.status===crmConstants.limitExceedsCode&&Search.displayLookupExceedsMsg(e),crmHistory.handleAjaxErrorLyte=!0,!1},willTransition:function(e){"crm.tab.module.entity.detail"!==e.target&&(this.transition.data.mass_data=void 0)}},beforeExit:function(){var e=this.parent.parent.getDynamicParam();store.unloadAll(moduleRecordMapping[e].id);var t=$L("crm-mass-tools");t[0]&&t.find(".massActionBodyWrapDiv")[0].removeEventListener("scroll",t[0].component._scroll,!0)}},{mixins:["crm-module-mixin","crm-mass-action-mixin"]}),Lyte.Router.registerRoute("crm.tab.module.actions.deduplicate.index-deduplicate",{model:function(e){var t={};t.module=this.parent.parent.parent.getDynamicParam();var r={params:t};return networkUtils.lyteInitiateRequest("/crm/v2/deduplicate","GET",r)},renderTemplate:function(e,t){var r=this.parent.parent.parent.getDynamicParam();if(e.exceptionObject){var i=e.exceptionObject;"NO_PERMISSION"==i.code?renderingUtils.displayPermissionDenied():"FEATURE_NOT_AVAILABLE"==i.code?(crmDeduplicate.loadPopup(),crmDeduplicate.showPopup("crm.module.not.supported",r,"Deduplication")):"INTERNAL_ERROR"==i.code&&renderingUtils.showCustomAlert(I18n.getMsg("crm.security.error"))}else if(e.deduplicate.columnsForDeduplication)e.modname=moduleRecordMapping[r].plural_label,e.singularmodulename=moduleRecordMapping[r].singular_label,$("#show").empty().html(Handlebars.templates.MassFindDuplicates(e));else{crmDeduplicate.loadPopup(),(t=[]).push(e.deduplicate.userName),t.push(moduleRecordMapping[r].plural_label);var a=renderingUtils.createHTML({name:"div",attr:{id:"msgpopup",class:"aligncenter"}}),s=renderingUtils.createHTML({name:"div"});s.appendChild(renderingUtils.createHTML({name:"span",attr:{class:"waring-info-icon mB20 svgIcons"}})),s.appendChild(renderingUtils.createHTML({name:"span",attr:{class:"crm-font-regular f16 dB oH mB20"},child:[{name:"text",content:I18n.getMsg("crm.label.deduplication.differentuser.message1",t)}]})),s.appendChild(renderingUtils.createHTML({name:"span",attr:{class:"crm-font-regular f14 dB mB10"},child:[{name:"text",content:I18n.getMsg("crm.label.deduplication.differentuser.message2")}]})),s.appendChild(renderingUtils.createHTML({name:"span",attr:{class:"crm-font-regular f14 dB"},child:[{name:"text",content:I18n.getMsg("crm.label.deduplication.differentuser.message3")}]})),a.appendChild(s).appendChild(renderingUtils.createHTML({name:"input",attr:{class:"primarybtn mT20 mR0",type:"button",value:I18n.getMsg("crm.mb.newversion.msg4"),onclick:'crmDeduplicate.hideMessagePopup("'+r+'")'}})),freezeBackground(),$("#deduplication_start_popup").html(a),crmui.showPop("deduplication_start_popup")}}}),Lyte.Router.registerRoute("crm.tab.module.actions.deduplicate.list-conflicts",{queryParams:["jobId","fromIndex","toIndex","isFromLink"],model:function(e){var t=e.queryParams,r=t.fromIndex,i=(t.toIndex,t.isFromLink),a={};a.module=this.parent.parent.parent.getDynamicParam(),r&&(a.page=r),void 0===i&&(i=!1),a.isFromLink=i;var s={params:a};return networkUtils.lyteInitiateRequest("/crm/v2/deduplicate/"+t.jobId,"GET",s)},renderTemplate:function(e,t){var r=this.parent.parent.parent.getDynamicParam(),i=t.queryParams,a=i.fromIndex,s=i.toIndex,o=i.jobId,n=moduleRecordMapping[r].singular_label,l=moduleRecordMapping[r].plural_label;if(e.exceptionObject){var c=e.exceptionObject;if("NO_PERMISSION"==c.code)renderingUtils.displayPermissionDenied();else if("FEATURE_NOT_AVAILABLE"==c.code)crmDeduplicate.loadPopup(),crmui.showPop("deduplication_start_popup");else if("INTERNAL_ERROR"==c.code)renderingUtils.showCustomAlert(I18n.getMsg("crm.security.error"));else if("LINK_EXPIRED"==c.code||"NO_DATA"==c.code){crmDeduplicate.loadPopup();t=[l];(b=renderingUtils.createHTML({name:"div",attr:{id:"mergePopup"}})).appendChild(renderingUtils.createHTML({name:"span",attr:{class:"f18 crm-font-regular dB mB10 color_010101"},child:[{name:"text",content:I18n.getMsg("crm.label.deduplication",l)}]})),"LINK_EXPIRED"==c.code?(b.appendChild(renderingUtils.createHTML({name:"span",attr:{class:"crm-font-regular color_3 f14 lh20"},child:[{name:"text",content:I18n.getMsg("crm.label.conflictlink.expired.message1",t)}]})),b.appendChild(renderingUtils.createHTML({name:"div",attr:{class:"aligncenter mT30"},child:[{name:"input",attr:{id:"msgbutton",class:"newgraybtn outlineprimary",type:"button",value:I18n.getMsg("crm.deduplicate.button",l),onclick:'crmDeduplicate.showDeduplication("'+r+'")'}},{name:"input",attr:{id:"msgbutton",class:"newgraybtn outlineprimary",type:"button",value:I18n.getMsg("crm.button.ok"),onclick:'crmDeduplicate.hideMessagePopup("'+r+'")'}}]}))):(b.appendChild(renderingUtils.createHTML({name:"span",attr:{class:"f14 crm-font-regular dB"},child:[{name:"text",content:I18n.getMsg("crm.label.alert.allresolved",l)}]})),b.appendChild(renderingUtils.createHTML({name:"div",attr:{class:"aligncenter mT30"},child:[{name:"input",attr:{id:"msgbutton",class:"newgraybtn",type:"button",value:I18n.getMsg("crm.button.ok"),onclick:'crmDeduplicate.hideMessagePopup("'+r+'")'}}]}))),$("#deduplication_start_popup").html(b),freezeBackground(),crmui.showPop("deduplication_start_popup")}}else if($.isEmptyObject(e.deduplicate))crmDeduplicate.loadPopup(),crmDeduplicate.showPopup("crm.label.alert.allresolved",r);else if(null==e.deduplicate.fields){var d=s-a+1,u=!0,m=e.deduplicate.defaultColumn,p=e.deduplicate.conflictObject,g=p.conflictRecordDetails,f=null;null!=g&&(f=g.length),f>d&&(u=!1,g.splice(10,1),f-=1),f=parseInt(a)+parseInt(f)-1,1==e.deduplicate.duplicateColumns.length?e.showTab=!1:e.showTab=!0,p.module=r,p.jobId=o,p.disableEndIndex=u,p.startIndex=a,p.endIndex=s,p.displayCount=f,p.defaultColumn=m,p.singularmodname=n;var h=$("#conflictDetails").children("#undefined");if(null!=h.html()||""==h.html()?$(h).html(Handlebars.templates.ConflictDetails(p)):(e.modname=moduleRecordMapping[r].plural_label,e.singularmodname=n,Handlebars.registerPartial("ConflictDetails",Handlebars.templates.ConflictDetails),$("#show").empty().html(Handlebars.templates.ViewConflictList(e))),crmDeduplicate.FixedHeaderFunctDF("duplicateDataTableCon_"+p.currentColumn),crmDeduplicate.FixedHeaderDedup("duplicateDataTableCon_"+p.defaultColumn),e.deduplicate.MatchCount>0){var y=[];y.push(e.deduplicate.MatchCount),y.push(r)}}else{var v=null,_=e.deduplicate.fields;crmDeduplicate.loadPopup();var b=renderingUtils.createHTML({name:"div",attr:{id:"mergePopup"}});t=[];if(1==_.length)v="crm.label.conflictlink.nofield.message1",t.push(_[0]);else if(2==_.length)v="crm.label.conflictlink.nofield.message2",t.push(_[0]),t.push(_[1]);else{v="crm.label.conflictlink.nofield.message3";f=_.length;for(var w=0;w<f;w++)t.push(_[w])}t.push(l),b.appendChild(renderingUtils.createHTML({name:"span",attr:{class:"f18 crm-font-regular dB mB10 color_010101"},child:[{name:"text",content:I18n.getMsg("crm.label.deduplication",l)}]})),b.appendChild(renderingUtils.createHTML({name:"span",attr:{class:"crm-font-regular color_3 f14 lh20"},child:[{name:"text",content:I18n.getMsg(v,t)}]})),b.appendChild(renderingUtils.createHTML({name:"div",attr:{class:"aligncenter mT30"},child:[{name:"input",attr:{id:"msgbutton",class:"newgraybtn outlineprimary",type:"button",value:I18n.getMsg("crm.deduplicate.button",l),onclick:'crmDeduplicate.showDeduplication("'+r+'")'}},{name:"input",attr:{id:"msgbutton",class:"newgraybtn outlineprimary",type:"button",value:I18n.getMsg("crm.button.ok"),onclick:'crmDeduplicate.hideMessagePopup("'+r+'")'}}]})),freezeBackground(),$("#deduplication_start_popup").html(b),crmui.showPop("deduplication_start_popup")}}}),Lyte.Router.registerRoute("crm.tab.module.actions.deduplicate.merge",{queryParams:["jobId","currentColumn","currentColVal","currentFieldLabel","fromFindAndMerge","startIndex","ids","recordCount","fromConflicts","conflictfromIndex","conflictendIndex"],model:function(e){var t=e.queryParams,r="/crm/v2.2/"+this.parent.parent.parent.getDynamicParam(),i=[],a=t.ids;if("string"==typeof a)for(var s=a.split(","),o=s.length,n=0;n<o;n++)i.push(s[n]);else i=a;this.ids=i;var l=i.length;l>0&&(r+="?ids=");for(var c=0;c<l;c++)r+=i[c],c!==l-1&&(r+=",");r+="&social=true";var d={},u={};return d["X-ZOHO-SERVICE"]="crm/deduplication",u.headers=d,networkUtils.lyteInitiateRequest(r,"GET",u)},renderTemplate:function(e,t){var r=this.parent.parent.parent.getDynamicParam();if(!e||0!==crmDeduplicate.selectedIds.length&&crmDeduplicate.selectedIds.length!==e.data.length){renderingUtils.showCustomAlert(I18n.getMsg("crm.alert.deduplicate.deleted.conflicted.record.message"));var i="crmDeduplicate.showDuplicates('"+r+"','"+t.queryParams.jobId+"','"+t.queryParams.currentColumn+"','"+t.queryParams.currentColVal+"','"+t.queryParams.currentFieldLabel+"','"+!0+"',1)";$("#custom_alert_button").attr("onclick","hideAnimatePopup('custom_alert_popup');"+i)}else{var a={},s=!1,o=!1;if(0===crmDeduplicate.fields.length)crmDeduplicate.initReq("/crm/v2.2/settings/fields","GET","module="+r,{"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken,"X-ZOHO-SERVICE":"crm/deduplication"},(function(i){var n=i.fields;crmDeduplicate.fields=[];for(var l=[],c={},d=n.length,u=0;u<d;u++){var m=n[u];207!==m.ui_type&&null==m.external&&(void 0===m.subformtabid?66===m.ui_type?crmDeduplicate.fields.unshift(m):crmDeduplicate.fields.push(m):500===m.ui_type?l.push(m):(void 0===c[m.subformtabid]&&(c[m.subformtabid]=[]),c[m.subformtabid].push(m)))}var p=l.length;for(u=0;u<p;u++){crmDeduplicate.fields.push(l[u]);for(var g=void 0===c[l[u].subformtabid]?0:c[l[u].subformtabid].length,f=0;f<g;f++)crmDeduplicate.fields.push(c[l[u].subformtabid][f])}crmDeduplicate.addSocialFields(crmDeduplicate.fields);var h=t.queryParams,y=h.recordCount,v="Crm_Implied_Merge_"+r;if(Crm.userDetails.permissions[v]){var _=e.data,b=[],w=_.length;for(u=0;u<w;u++)_[u].$approved&&(b.push(_[u]),networkUtils.lyteInitiateRequest("/crm/v2.1/"+moduleRecordMapping[r].api_name+"/"+_[u].id+"/actions/blueprint","GET").then((function(e){a.res=e})));b.length>1&&(b[0].$process_flow&&(o=!0),s=!0,a.jobId=h.jobId,a.module=r,a.modname=Crm.moduleInfo[r].translatedPluralLabel,a.singularmodname=Crm.moduleInfo[r].translatedSingularLabel,a.currentCol=h.currentColumn,a.currentColVal=h.currentColVal,a.currentFieldLabel=h.currentFieldLabel,a.data=b,a.conflictfromIndex=h.conflictfromIndex,a.conflicttoIndex=h.conflictendIndex,a.startIndex=h.startIndex,a.fromFindAndMerge=h.fromFindAndMerge,a.activitymodname=Crm.moduleInfo.Activities.translatedPluralLabel,a.prodmodname=Crm.moduleInfo.Products.translatedPluralLabel,a.fromConflicts=h.fromConflicts,a.transRcd=o,(h.fromFindAndMerge||y>0)&&(a.recordCount=y),a.fields=crmDeduplicate.fields,$("#show").html(Handlebars.templates.MergeEntities(a)),crmDeduplicate.FixedHeaderFunctDF("mergerFieldTable"),crmDeduplicate.imageObject.module=r,crmDeduplicate.imageObject.respObj=a)}else!1===s&&(crmDeduplicate.loadPopup(),crmDeduplicate.showPopup("crm.creator.error.accessd",r))}));else{var n=t.queryParams,l=n.recordCount,c="Crm_Implied_Merge_"+r;if(Crm.userDetails.permissions[c]){for(var d=e.data,u=[],m=d.length,p=0;p<m;p++)d[p].$approved&&u.push(d[p]);u.length>1&&(u[0].$process_flow&&(o=!0),s=!0,a.jobId=n.jobId,a.module=r,a.modname=Crm.moduleInfo[r].translatedPluralLabel,a.singularmodname=Crm.moduleInfo[r].translatedSingularLabel,a.currentCol=n.currentColumn,a.currentColVal=n.currentColVal,a.currentFieldLabel=n.currentFieldLabel,a.data=u,a.conflictfromIndex=n.conflictfromIndex,a.conflicttoIndex=n.conflictendIndex,a.startIndex=n.startIndex,a.fromFindAndMerge=n.fromFindAndMerge,a.activitymodname=Crm.moduleInfo.Activities.translatedPluralLabel,a.prodmodname=Crm.moduleInfo.Products.translatedPluralLabel,a.fromConflicts=n.fromConflicts,a.transRcd=o,(n.fromFindAndMerge||l>0)&&(a.recordCount=l),a.fields=crmDeduplicate.fields,u[0].$process_flow?networkUtils.lyteInitiateRequest("/crm/v2.1/"+moduleRecordMapping[r].api_name+"/"+u[0].id+"/actions/blueprint","GET").then((function(e){e.blueprint.process_info.field_id&&(crmDeduplicate.rcdIdVsTransFld.id=e.blueprint.process_info.column_name,a.lockFld=e.blueprint.process_info.column_name),crmDeduplicate.renderMerge(a,r)})):crmDeduplicate.renderMerge(a,r))}else!1===s&&(crmDeduplicate.loadPopup(),crmDeduplicate.showPopup("crm.creator.error.accessd",r))}}},afterRender:function(){setTimeout((function(){void 0===crmDeduplicate.imageObject.count&&crmDeduplicate.processImages()}),300)},actions:{willTransition:function(){delete crmDeduplicate.imageObject.count}}}),Lyte.Router.registerRoute("crm.tab.module.actions.deduplicate.show-duplicates",{queryParams:["jobId","currentColumn","currentColVal","disableEndIndex","currentFieldLabel","fromViewConflicts","startIndex","ids","selectedIds"],model:function(e){var t=e.queryParams,r="/crm/v2.2/"+this.parent.parent.parent.getDynamicParam(),i=[],a=t.ids;if("string"==typeof a)for(var s=a.split(","),o=s.length,n=0;n<o;n++)i.push(s[n]);else i=a;this.ids=i;var l=i.length;l>0&&(r+="?ids=");for(var c=0;c<l;c++)r+=i[c],c!==l-1&&(r+=",");return networkUtils.lyteInitiateRequest(r,"GET")},renderTemplate:function(e,t){var r=this.parent.parent.parent.getDynamicParam(),i=this.ids,a=e.data;if(0===crmDeduplicate.fields.length)crmDeduplicate.initReq("/crm/v2.2/settings/fields","GET","module="+r,{"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken,"X-ZOHO-SERVICE":"crm/deduplication"},(function(e){var s=e.fields;crmDeduplicate.fields=[];for(var o=[],n={},l=s.length,c=0;c<l;c++){var d=s[c];void 0===d.subformtabid?66===d.ui_type?crmDeduplicate.fields.unshift(d):crmDeduplicate.fields.push(d):500===d.ui_type?o.push(d):(void 0===n[d.subformtabid]&&(n[d.subformtabid]=[]),n[d.subformtabid].push(d))}var u=o.length;for(c=0;c<u;c++){crmDeduplicate.fields.push(o[c]);for(var m=void 0===n[o[c].subformtabid]?0:n[o[c].subformtabid].length,p=0;p<m;p++)crmDeduplicate.fields.push(n[o[c].subformtabid][p])}crmDeduplicate.addSocialFields(crmDeduplicate.fields);var g=t.queryParams;g.selectedIds&&0!==g.selectedIds.length?crmDeduplicate.selectedIds=g.selectedIds:crmDeduplicate.selectedIds=[];var f=g.jobId,h=g.currentColumn,y=g.currentColVal,v=g.currentFieldLabel,_=g.fromViewConflicts,b=g.startIndex,w=g.disableEndIndex,C=i.length,D="Crm_Implied_Merge_"+r,L={},R={};Crm.userDetails.permissions[D]?(R.data=a,R.module=r,L.recordDetails=R,L.startIndex=b,L.disableEndIndex=w,L.displayCount=1==b?C:parseInt(b)+(C-1),L.conflictfromIndex=$("#conflictstartIndex").val(),L.conflicttoIndex=$("#conflictendIndex").val(),L.jobId=f,L.module=r,L.modname=moduleRecordMapping[r].plural_label,L.singularmodname=moduleRecordMapping[r].singular_label,L.currentCol=h,L.currentColVal=y,L.currentFieldLabel=v,L.recordCount=C,R.selectedIds=crmDeduplicate.selectedIds,R.fields=crmDeduplicate.fields,"false"===_?($("#dupTable").html(Handlebars.templates.DuplicateRecords(L.recordDetails)),$("#navigate").html(Handlebars.templates.DuplicateRecordNavigation(L)),$("#defixedrowTd").html(Handlebars.templates.DuplicateCheckBox(L.recordDetails))):(Handlebars.registerPartial("DuplicateRecords",Handlebars.templates.DuplicateRecords),Handlebars.registerPartial("DuplicateCheckBox",Handlebars.templates.DuplicateCheckBox),Handlebars.registerPartial("DuplicateRecordNavigation",Handlebars.templates.DuplicateRecordNavigation),$("#show").html(Handlebars.templates.ViewDuplicates(L))),crmDeduplicate.fixedHeaderDedpulicate(),crmDeduplicate.checkOfRecordMerge()):renderingUtils.displayPermissionDenied()}));else{var s=t.queryParams;s.selectedIds&&0!==s.selectedIds.length?crmDeduplicate.selectedIds=s.selectedIds:crmDeduplicate.selectedIds=[];var o=s.jobId,n=s.currentColumn,l=s.currentColVal,c=s.currentFieldLabel,d=s.fromViewConflicts,u=s.startIndex,m=s.disableEndIndex,p=i.length,g="Crm_Implied_Merge_"+r,f={},h={};if(Crm.userDetails.permissions[g]){a=e.data;h.data=a,h.module=r,f.recordDetails=h,f.startIndex=u,f.disableEndIndex=m,f.displayCount=1==u?p:parseInt(u)+(p-1),f.conflictfromIndex=$("#conflictstartIndex").val(),f.conflicttoIndex=$("#conflictendIndex").val(),f.jobId=o,f.module=r,f.modname=moduleRecordMapping[r].plural_label,f.singularmodname=moduleRecordMapping[r].singular_label,f.currentCol=n,f.currentColVal=l,f.currentFieldLabel=c,f.recordCount=p,h.selectedIds=crmDeduplicate.selectedIds,h.fields=crmDeduplicate.fields,"false"===d?($("#dupTable").html(Handlebars.templates.DuplicateRecords(f.recordDetails)),$("#navigate").html(Handlebars.templates.DuplicateRecordNavigation(f)),$("#defixedrowTd").html(Handlebars.templates.DuplicateCheckBox(f.recordDetails))):(Handlebars.registerPartial("DuplicateRecords",Handlebars.templates.DuplicateRecords),Handlebars.registerPartial("DuplicateCheckBox",Handlebars.templates.DuplicateCheckBox),Handlebars.registerPartial("DuplicateRecordNavigation",Handlebars.templates.DuplicateRecordNavigation),$("#show").html(Handlebars.templates.ViewDuplicates(f))),crmDeduplicate.fixedHeaderDedpulicate(),crmDeduplicate.checkOfRecordMerge()}else renderingUtils.displayPermissionDenied()}}}),Lyte.Router.registerRoute("crm.tab.newReports.clone",{beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){return this.transition&&this.transition.data.report?Lyte.resolvePromises({serialized_report:this.transition.data.report,fromView:!!this.transition.data.fromView&&this.transition.data.fromView,popups:Crm.userDetails.isSandbox?{module_selection:!1,join_report:!1,report_type:!1}:store.triggerAction("report","popups",{action:"popups"},void 0,"GET")}):Lyte.resolvePromises({request_serialized_report:store.findRecord("report",this.getDynamicParam()),popups:Crm.userDetails.isSandbox?{module_selection:!1,join_report:!1,report_type:!1}:store.triggerAction("report","popups",{action:"popups"},void 0,"GET")})},afterModel:function(e){if(e.serialized_report){if(e.serialized_report.is_converted_report)(t=e.serialized_report.filters)&&(t.field.api_name="Converted__s");this.currentModel={report:e.serialized_report}}else if(e.request_serialized_report){var t,r=e.request_serialized_report[0];if(r&&r.is_converted_report)(t=r.filters)&&(t.field.api_name="Converted__s");this.currentModel={report:r}}var i=this.currentModel.report.name+"_"+I18n.getMsg("crm.label.cloned");i.length<=100&&(this.currentModel.report.name=i),this.currentModel.clone_mode=!0,this.currentModel.fromView=e.fromView,this.currentModel.parentRepIdForClone=this.currentModel.report.id,this.currentModel.popups=e.popups.Reports_Onboard,delete this.currentModel.report.id,commonUtils.showHideLoadingDiv()},renderTemplate:function(e){return{outlet:"#show",component:"crm-report-builder",data:e}},actions:{onError:function(e,t){if(this.transition.data.option&&"fromListView"===this.transition.data.option){var r=this.getDynamicParam(),i=document.querySelector("crm-reports-container");i&&i.component.setData("selectedReport",{id:r});var a=Lyte.registeredMixins["crm-report-util"],s=JSON.parse(e.response);s.Reports&&s.Reports[0]&&"INVALID_DATA"===s.Reports[0].code?(i.component.executeMethod("invalidReport"),t.abort(),a.replaceRouteWithCurrentInstance(),a.errorPopup({readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status})):s.code&&"NO_PERMISSION"===s.code&&s.details&&s.details.permissions&&"Crm_Implied_View_Reports"===s.details.permissions?this.transitionTo({route:"crm.tab.newReports.index"}).errorObj={readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status}:(t.abort(),a.replaceRouteWithCurrentInstance(),a.errorPopup({readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status}))}else this.transitionTo({route:"crm.tab.newReports.index"}).errorObj={readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status};return!1},willTransition:function(e){e.pause();var t=document.querySelector("crm-report-builder");(t=t||document.querySelector("crm-report-view"))&&(t=t.component).getData("isReportChanged")&&t.getData("showTransitionAlert")?(e.abort(),t.showOrHideModel("cancelChanges",!0)):e.resume()}}}),Lyte.Router.registerRoute("crm.tab.newReports.create",{queryParams:["module"],getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_jsplumb.js"],crmConstants.jsStaticPath);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-report-select-module.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-report-select-module.css"],crmConstants.cssStaticPathForLyte))},beforeExit:function(){this.removeFromCache(networkUtils.returnDependencyFiles(["zohocrm_jsplumb.js"],crmConstants.jsStaticPath))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(e){return store.unloadAll("child_relationship"),Lyte.resolvePromises({module_api_name:e.queryParams.module,checkPermission:store.triggerAction("report","checkPermission",{action:"checkPermission"}),related_modules:store.findAll("module"),popups:Crm.userDetails.isSandbox?{module_selection:!1,join_report:!1,report_type:!1}:store.triggerAction("report","popups",{action:"popups"},void 0,"GET")})},afterModel:function(e){commonUtils.showHideLoadingDiv();for(var t=e.related_modules.length,r=!1,i=0;i<t;i++){var a=e.related_modules[i];if(a.display_label=a.plural_label,e.module_api_name===a.api_name){e.module=a,r=!0;break}}var s=Crm.userDetails.MODULE_LIST.Reports.profiles,o=s.length,n=new Set;for(i=0;i<o;i++)n.add(s[i].name);if(!Crm.userDetails.MODULE_LIST.Reports.visible||!n.has(Crm.userDetails.PROFILE_NAME))return crmHistory.handleAjaxErrorLyte=!0,renderingUtils.displayPermissionDenied(),void this.transition.abort();if(!r)return this.transition.abort(),this.transitionTo("crm.tab.newReports.index").errorObj={response:'{"code" : "MODULE_NOT_AVAILABLE"}',status:"422"},"crm.tab.newReports.index"===Lyte.Router.getRouteInstance().transition.info.route||"crm.tab.newReports.index.list"===Lyte.Router.getRouteInstance().transition.info.route?void(Lyte.Router.getRouteInstance().refresh().errorObj={response:'{"code" : "MODULE_NOT_AVAILABLE"}',status:"422"}):void 0;if(!Crm.userDetails.permissions.Crm_Implied_Manage_Reports||!featuresAvailable.Custom_Reports){this.transition.abort();var l={status:403},c={status:"error",response:'{"code" : "NO_PERMISSION"}'};return l.response=JSON.stringify(c),void(this.transitionTo("crm.tab.newReports.index").errorObj=c)}var d={module:e.module,relatedModules:e.related_modules};this.currentModel={root:d,popups:e.popups.Reports_Onboard}},renderTemplate:function(e){return{outlet:"#show",component:"crm-report-module-selector",data:e}},actions:{onError:function(e){return Lyte.registeredMixins["crm-report-util"].errorPopup(e),this.transitionTo("crm.tab.newReports.index"),!1},willTransition:function(e){e.pause();var t=document.querySelector("crm-report-builder");(t=t||document.querySelector("crm-report-view"))&&(t=t.component).getData("isReportChanged")&&t.getData("showTransitionAlert")?(e.abort(),t.showOrHideModel("cancelChanges",!0)):e.resume()}}}),Lyte.Router.registerRoute("crm.tab.newReports.edit",{beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){if(this.transition&&this.transition.data.report){var e=this.transition.data.report;e.preview=!0,Lyte.objectUtils(e,"delete","more_records");var t={serialized_report:e,run_response:store.triggerAction("report","run",{Reports:[e]}),isReportChanged:this.transition.data.isReportChanged,isColumnResized:this.transition.data.isColumnResized,fromView:!!this.transition.data.fromView&&this.transition.data.fromView,checkPermission:store.triggerAction("report","checkPermission",{action:"checkPermission"}),popups:Crm.userDetails.isSandbox?{module_selection:!1,join_report:!1,report_type:!1}:store.triggerAction("report","popups",{action:"popups"},void 0,"GET")};return e.id&&(t.report=store.findRecord("report",e.id)),Lyte.resolvePromises(t)}return Lyte.resolvePromises({request_serialized_report:store.findRecord("report",this.getDynamicParam()),checkPermission:store.triggerAction("report","checkPermission",{action:"checkPermission"}),popups:Crm.userDetails.isSandbox?{module_selection:!1,join_report:!1,report_type:!1}:store.triggerAction("report","popups",{action:"popups"},void 0,"GET")})},afterModel:function(e){if(e.serialized_report)this.currentModel={report:e.serialized_report,run_response:e.run_response},this.currentModel.isColumnResized=!!e.isColumnResized;else if(e.request_serialized_report){this.currentModel={report:e.request_serialized_report[0]};var t=Lyte.registeredMixins["crm-report-util"];this.currentModel.isColumnResized=t.isWidthAvailable(this.currentModel.report,t)}this.currentModel.edit_mode=!0,this.currentModel.isReportChanged=!!e.isReportChanged,this.currentModel.fromView=e.fromView,this.currentModel.popups=e.popups.Reports_Onboard,commonUtils.showHideLoadingDiv()},renderTemplate:function(e){if(Crm.userDetails.permissions.Crm_Implied_Manage_Reports)return store.unloadAll("role"),{outlet:"#show",component:"crm-report-builder",data:e};var t={status:403};t.response=JSON.stringify({status:"error",code:"NO_PERMISSION",message:"permission denied",details:{"permissions needed":["Crm_Implied_Manage_Reports"]}}),Lyte.registeredMixins["crm-report-util"].errorPopup(t)},actions:{onError:function(e,t){if(this.transition.data.option&&"fromListView"===this.transition.data.option){var r=this.getDynamicParam(),i=document.querySelector("crm-reports-container");i&&i.component.setData("selectedReport",{id:r});var a=Lyte.registeredMixins["crm-report-util"],s=JSON.parse(e.response);s.Reports&&s.Reports[0]&&"INVALID_DATA"===s.Reports[0].code?(i.component.executeMethod("invalidReport"),t.abort(),a.replaceRouteWithCurrentInstance(),a.errorPopup({readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status})):s.code&&"NO_PERMISSION"===s.code&&s.details&&s.details.permissions&&"Crm_Implied_View_Reports"===s.details.permissions?this.transitionTo({route:"crm.tab.newReports.index"}).errorObj={readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status}:(t.abort(),a.replaceRouteWithCurrentInstance(),a.errorPopup({readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status}))}else this.transitionTo({route:"crm.tab.newReports.index"}).errorObj={readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status};return!1},willTransition:function(e){e.pause();var t=document.querySelector("crm-report-builder");(t=t||document.querySelector("crm-report-view"))&&(t=t.component).getData("isReportChanged")&&t.getData("showTransitionAlert")?(e.abort(),t.showOrHideModel("cancelChanges",!0)):e.resume()}}}),Lyte.Router.registerRoute("crm.tab.newReports.index",{getResources:function(){return networkUtils.returnDependencyFiles(["crm-report-list-page.js"],crmConstants.jsStaticPathForLyte)},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){return store.unloadAll("report_folder"),Lyte.resolvePromises({reportfolders:store.findAll("report_folder"),metadata:store.triggerAction("report","configuration",{action:"configuration",type:"GET"}),revamp_enabled:networkUtils.lyteInitiateRequest("/crm/v2/Reports/__internal/revamp_enabled","GET")})},afterModel:function(e){if(e.revamp_enabled&&(e.revamp_enabled.enabled?(this.currentModel.showRevampEnabledBanner=e.revamp_enabled.show_popup,this.currentModel.isVersionSwitchEnabled=!!e.revamp_enabled.version_switch_enabled&&e.revamp_enabled.version_switch_enabled,this.currentModel.isMigrationScheduled=!!e.revamp_enabled.migration_scheduled&&e.revamp_enabled.migration_scheduled,this.currentModel.migrationScheduledTime=e.revamp_enabled.scheduled_time?e.revamp_enabled.scheduled_time:""):(this.transition.abort(),Utils.windowLocationHref(""))),null!==localStorage.getItem("reports_migration")&&"NEW"===localStorage.getItem("reports_migration")){var t=document.querySelector("crm-report-wms-pop");t&&(t=t.component).setData("showPop",!1)}e.reportfolders||(e.reportfolders=[]),e&&e.reportfolders.$&&(this.currentModel.more_records=e.reportfolders.$.meta.more_records,this.currentModel.page=Number(e.reportfolders.$.meta.page));var r=e.metadata&&e.metadata.Reports_Configuration?e.metadata.Reports_Configuration:e.metadata;if(r&&r.last_viewed_report_folder){var i=r.last_viewed_report_folder.id?r.last_viewed_report_folder.id:r.last_viewed_report_folder.name;validationUtils.isValidNumber(i)?r.folder_id=i:(i="scheduled"!==i||featuresAvailable.Schedule_Reports?i:"everything",r.category=i),delete r.last_viewed_report_folder,moduleRecordMapping.Reports.query_params=r,this.currentModel.query_params=r,this.currentModel.paramObj=r}if(this.transition.errorObj&&(this.currentModel.errorObj=this.transition.errorObj,Lyte.registeredMixins["crm-report-util"].errorPopup(this.currentModel.errorObj,!0)),this.transition.data&&this.transition.data.show_incompatibility){this.currentModel.errorObj={status:400,response:'{"status":"error","code":"REPORT_NOT_SUPPORTED"}'}}commonUtils.showHideLoadingDiv()},renderTemplate:function(e){return{outlet:"#show",component:"crm-report-folders",data:e}},redirect:function(e){if("crm.tab.newReports.index"===Lyte.Router.getRouteInstance().transition.info.route){var t=!0;if(this.transition.data&&void 0!==this.transition.data.redirect&&!1===this.transition.data.redirect&&(t=!1),e.paramObj&&e.paramObj.category&&"scheduled"===e.paramObj.category&&featuresAvailable.Schedule_Reports&&t)this.replaceWith({route:"crm.tab.newReports.index.schedule.list",queryParams:{status:"active"}}).data={redirect:!1};else if(t){this.replaceWith({route:"crm.tab.newReports.index.list",queryParams:e.paramObj}).data={redirect:!1}}}},actions:{onError:function(e,t){crmHistory.handleAjaxErrorLyte=!0,app.historyLength=1,t.abort(),renderingUtils.displayPermissionDenied()}}}),Lyte.Router.registerRoute("crm.tab.newReports.records",{queryParams:["page","criteria","sort_by","sort_order","column","value","sub_report","date_filter","apply_date_filter","hierarchy_id","hierarchy_name","action","title","action"],model:function(e){return"viewAppointments"===e.queryParams.action?Lyte.registeredMixins["crm-report-util"].getModelForReportsView(e):Lyte.resolvePromises({report:store.findRecord("report",e.dynamicParam),criteria:e.queryParams.criteria,apply_date_filter:e.queryParams.apply_date_filter,sub_report:e.queryParams.sub_report,date_filter:e.queryParams.date_filter,hierarchy_id:e.queryParams.hierarchy_id,sort_order:e.queryParams.sort_order,sort_by:e.queryParams.sort_by,column:e.queryParams.column,value:e.queryParams.value})},renderTemplate:function(e){return{outlet:"#show",component:"crm-report-view",data:e}},beforeModel:function(e){if(commonUtils.showHideLoadingDiv(),e.queryParams.action&&"viewAppointments"!==e.queryParams.action){this.transition.abort();var t=networkUtils.returnDependencyFiles(["crm-new-reports-popup.js"],crmConstants.jsStaticPathForLyte);Lyte.injectResources(t,void 0,(function(){var e=Lyte.Component.render("crm-new-reports-popup",{},"#reportlookupdiv");e&&e.component.showOrHideModel("drillDownNotSupportedAlert",!0)}))}},afterModel:function(e){var t=Lyte.registeredMixins["crm-report-util"];if(e.report&&(e.report=e.report[0]),void 0!==e.sub_report&&(e.report=e.report.sub_reports[e.sub_report]),e.report){var r=[];if(e.report.fields)for(var i=e.report.fields.length,a=0;a<i;a++){var s={full_api_name:(o=e.report.fields[a]).api_name,display_label:o.label,ui_type:o.ui_type,encrypted:o.encrypted};o.data_type&&(s.data_type=o.data_type),t.addUniqueFields(r,s)}if(e.report.group_by){i=e.report.group_by.length;for(a=0;a<i;a++){s={full_api_name:(o=e.report.group_by[a]).field.api_name,display_label:o.field.label,ui_type:o.field.ui_type,encrypted:o.encrypted};o.field.data_type&&(s.data_type=o.field.data_type),t.addUniqueFields(r,s)}}if(e.report.aggregate_functions){i=e.report.aggregate_functions.length;for(a=0;a<i;a++){var o;s={full_api_name:(o=e.report.aggregate_functions[a]).field.api_name,display_label:o.field.label,ui_type:o.field.ui_type,encrypted:o.encrypted};o.field.data_type&&(s.data_type=o.field.data_type),t.addUniqueFields(r,s)}}e.apply_date_filter&&(e.report.date_filter=e.date_filter?JSON.parse(e.date_filter):null),e.hierarchy_id&&(e.report.hierarchy_drilldown={drill_by:"user",hierarchy_filter_id:e.hierarchy_id}),e.report.fields=r,e.report.group_by=[],delete e.report.row_group_by,delete e.report.column_group_by,e.report.aggregate_functions=[]}t.addFilterToReport(e),e.sort_by&&(e.report.sort_by={api_name:e.sort_by},e.report.sort_order=e.sort_order?e.sort_order:"asc"),delete e.sort_by,delete e.sort_order,e.report=t.deserializeReport(t.convertToTabular(e.report)),e.drill_down=!0,e.per_page=100,commonUtils.showHideLoadingDiv()},actions:{onError:function(e,t){Lyte.registeredMixins["crm-report-util"].errorPopup(e),t.abort()}}}),Lyte.Router.registerRoute("crm.tab.newReports.schedule-create",{getDependencies:function(){return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("chatintegrations")])},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-scheduled-report.js","crm-chat-options.js","chat-integ-store.js","slack-setup-store.js","chat-setup-store.js"],crmConstants.jsStaticPathForLyte);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-scheduled-report.css","crm-chat-options.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["zohocrm_chatIntegration.js"]))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){return Lyte.resolvePromises({checkPermission:store.triggerAction("scheduled_report","checkPermission",{action:"checkPermission"})})},afterModel:function(){commonUtils.showHideLoadingDiv()},renderTemplate:function(){return{outlet:"#show",component:"crm-scheduled-report"}},actions:{onError:function(e){this.transition.abort();var t=app.prevTransition&&"crm.tab.newReports.index.schedule.list"===app.prevTransition.route?app.prevTransition.queryParams:{status:"active"};return app.prevTransition&&"crm.tab.newReports.index.schedule.list"===app.prevTransition.route?(Lyte.Router.transitionTo({route:"crm.tab.newReports.index.schedule.list",queryParams:t}),Lyte.Router.getRouteInstance().refresh().errorObj=e):Lyte.Router.transitionTo({route:"crm.tab.newReports.index.schedule.list",queryParams:t}).errorObj=e,!1}}}),Lyte.Router.registerRoute("crm.tab.newReports.schedule-edit",{getDependencies:function(){return networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("chatintegrations")])},getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-scheduled-report.js","crm-chat-options.js","chat-integ-store.js","slack-setup-store.js","chat-setup-store.js"],crmConstants.jsStaticPathForLyte);return e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-scheduled-report.css","crm-chat-options.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["zohocrm_chatIntegration.js"]))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){if(this.getDynamicParam())return Lyte.resolvePromises({scheduledReport:store.findRecord("scheduled_report",this.getDynamicParam())})},afterModel:function(e){e.scheduledReport||(e.scheduledReport=[]),e&&(this.currentModel.scheduledReport=JSON.parse(JSON.stringify(e.scheduledReport[0])),this.currentModel.edit_mode=!0),commonUtils.showHideLoadingDiv()},renderTemplate:function(e){return{outlet:"#show",component:"crm-scheduled-report",data:e}},actions:{onBeforeLoad:function(){if(!Crm.userDetails.permissions.Crm_Implied_Schedule_Reports){var e=Lyte.registeredMixins["crm-report-util"],t={status:403};t.response=JSON.stringify({status:"error",code:"NO_PERMISSION",message:"permission denied",details:{"permissions needed":["Crm_Implied_Schedule_Reports"]}}),this.transition.abort(),e.replaceRouteWithCurrentInstance(),e.errorPopup({readyState:t.readyState,response:t.response,responseText:t.responseText,responseURL:t.responseURL,status:t.status})}},onError:function(e,t){if(this.transition.data.option&&"fromListView"===this.transition.data.option){var r=this.getDynamicParam(),i=document.querySelector("crm-schedule-container");i&&i.component.setData("selectedId",r);var a=Lyte.registeredMixins["crm-report-util"],s=JSON.parse(e.response);s.Reports_Scheduled&&s.Reports_Scheduled&&s.Reports_Scheduled[0]&&"INVALID_DATA"===s.Reports_Scheduled[0].code?(i.component.executeMethod("invalidReport"),t.abort(),a.replaceRouteWithCurrentInstance(),a.errorPopup({readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status})):s.code&&"NO_PERMISSION"===s.code&&s.details&&s.details.permissions&&"Crm_Implied_View_Reports"===s.details.permissions?this.transitionTo({route:"crm.tab.newReports.index"}).errorObj={readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status}:(t.abort(),a.replaceRouteWithCurrentInstance(),a.errorPopup({readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status}))}else this.transitionTo({route:"crm.tab.newReports.index"}).errorObj={readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status}}}}),Lyte.Router.registerRoute("crm.tab.newReports.view",{beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){return newReportsEnabled||(this.transition.abort(),Utils.windowLocationHref("")),Lyte.registeredMixins["crm-report-util"].unloadSpecificProperties(this.getDynamicParam()),Lyte.resolvePromises({reportAndFields:store.findRecord("report",this.getDynamicParam()).then((function(e){var t=Lyte.registeredMixins["crm-report-util"].getRequests(e[0]);return{report:e,fields:Lyte.resolvePromises(t)}})),run_response:store.triggerAction("report","run",{action:"run",reportId:this.getDynamicParam()}),chats_settings:networkUtils.lyteInitiateRequest("/crm/v2/settings/chats","GET",{skip_load_tab:!0}),saved_report:!0})},afterModel:function(e){if(e.reportAndFields.report){e.report=e.reportAndFields.report[0];var t=Lyte.registeredMixins["crm-report-util"];e.cached_grand_total=t.getGrandTotals(e.report,e.run_response),e.isColumnResized=t.isWidthAvailable(e.report,t)}else e.report={};if(e.chats_settings&&e.chats_settings.chats){for(var r=e.chats_settings.chats,i=r.length,a=0;a<i;a++)if(r[a].active)switch(r[a].type){case"cliq":e.cliq_enabled=!0;break;case"cisco":e.cisco_enabled=!0;break;case"slack":e.slack_enabled=!0}delete e.chats_settings}return commonUtils.showHideLoadingDiv(),this.transition.errorObject&&"emptyReport"===this.transition.errorObject.code&&(e.emptyExport=this.transition.errorObject),e.reportAndFields.fields},renderTemplate:function(e){return{outlet:"#show",component:"crm-report-view",data:e}},actions:{onError:function(e,t){if(this.transition.data.option&&"fromListView"===this.transition.data.option){var r=this.getDynamicParam(),i=document.querySelector("crm-reports-container");i&&i.component.setData("selectedReport",{id:r});var a=Lyte.registeredMixins["crm-report-util"],s=JSON.parse(e.response);if(s.Reports&&s.Reports[0]&&"INVALID_DATA"===s.Reports[0].code)i.component.executeMethod("invalidReport"),t.abort(),a.replaceRouteWithCurrentInstance(),a.errorPopup({readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status});else if(s.code&&"NO_PERMISSION"===s.code&&s.details&&s.details.permissions&&"Crm_Implied_View_Reports"===s.details.permissions)this.transitionTo({route:"crm.tab.newReports.index"}).errorObj={readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status};else{t.abort(),a.replaceRouteWithCurrentInstance(),"REPORT_NOT_SUPPORTED"===(s.code?s.code:s.Reports&&s.Reports[0]?s.Reports[0].code:null)&&i?i.component.showOrHideModel("reportNotSupportedAlert",!0):a.errorPopup({readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status})}}else this.transitionTo({route:"crm.tab.newReports.index"}).errorObj={readyState:e.readyState,response:e.response,responseText:e.responseText,responseURL:e.responseURL,status:e.status}}},didDestroy:function(){var e=$("#show");thirdPartyUtils.unbindHighcharts(e)}}),Lyte.Router.registerRoute("crm.tab.newReports.index.list",{queryParams:["folder_id","category","sort_by","sort_order","searchword"],model:function(){var e={},t=this.getQueryParams(),r="everything";for(var i in t)if(t[i]&&void 0!==t[i])if("folder_id"===i){var a=store.peekRecord("report_folder",t[i]),s=store.peekAll("report_folder");a||0===s.length?(r=t[i],e[i]=t[i]):(delete t[i],delete e[i],t.category="everything",e.category="everything")}else"category"===i?(r=t[i],e[i]=t[i]):e[i]=t[i];var o=document.querySelector("crm-reports-container"),n=document.querySelector("crm-report-folders"),l="";n&&(l=(n=n.component).getData("query_params")?n.getData("query_params").selected_folder:""),"everything"===r&&"everything"===l&&o&&o.component.getData("isSearch")&&!e.searchword&&this.transition.abort();var c={params:e,scope:r,need_checkbox:"favorites"!==r,folder:validationUtils.isValidNumber(r)?store.findRecord("report_folder",r):r};return"deleted"!==c.scope&&e.searchword?c.defaultReportsTriggered=!0:("deleted"===c.scope&&e.sort_by&&!["name","deleted_time"].contains(e.sort_by)&&(e.sort_by="deleted_time"),c.reports=store.findAll("report",Object.assign({},e))),Lyte.resolvePromises(c)},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},afterModel:function(e){if(e&&e.defaultReportsTriggered)var t=Object.assign({},e.params),r=this.currentModel,i=this.transition,a=store.findAll("report",t).then((function(t){e.reports=t,e&&!e.reports&&(e.reports=[]),e.params.searchword&&/^[~`#^*()+={}[\]|;"<>\\]+$/.test(e.params.searchword)&&(e.reports=[]),e&&e.folder&&"string"!=typeof e.folder&&(r.folder=e.folder[0],r.folder.visible||(i.abort(),Lyte.Router.transitionTo({route:"crm.tab.newReports.index.list",queryParams:{category:"everything"}}))),e&&e.reports.$&&(r.more_records=e.reports.$.meta.more_records,r=e.reports.$.meta.page),commonUtils.showHideLoadingDiv(),"string"==typeof e.folder&&(e.folder={id:e.folder})}));else e&&!e.reports&&(e.reports=[]),e&&e.folder&&"string"!=typeof e.folder&&(this.currentModel.folder=e.folder[0],this.currentModel.folder.visible||(this.transition.abort(),Lyte.Router.transitionTo({route:"crm.tab.newReports.index.list",queryParams:{category:"everything"}}))),e&&e.reports.$&&(this.currentModel.more_records=e.reports.$.meta.more_records,this.currentModel.page=e.reports.$.meta.page),commonUtils.showHideLoadingDiv(),"string"==typeof e.folder&&(e.folder={id:e.folder});return this.transition.errorObj&&(this.currentModel.errorObj=this.transition.errorObj,Lyte.registeredMixins["crm-report-util"].errorPopup(this.currentModel.errorObj,!0)),a},renderTemplate:function(e){return{outlet:"#report_container",component:"crm-reports-container",data:e}},actions:{onError:function(e){var t=e.response.constructor===String?JSON.parse(e.response):e.response;"NO_PERMISSION"===t.code?(setTimeout((function(){crmHistory.handleAjaxErrorLyte=!0,app.historyLength=1,renderingUtils.displayPermissionDenied()}),0),this.transition&&this.transition.abort()):t.Report_Folders&&"INVALID_DATA"===t.Report_Folders[0].code&&(renderingUtils.displayPermissionDenied(),this.transition.abort())},willTransition:function(){var e=document.querySelector("crm-reports-container");if(e){var t=$L(".recentDelete-container");t.hide(),e.component.setData("selected_ids",[]),e.component.actions.deselectRecords(e.component),setTimeout((function(){t.show()}),500)}}},afterRender:function(e,t,r){(r=r.component).executeMethod("setReporHeading",r),r.setData("refresh",!0);var i=document.querySelector("#crm-reports-listtable");i&&i.component.data.ltPropContent.length&&i.scrollTable(0,0);var a=window.innerHeight-i.getBoundingClientRect().top;a-=$L("#wms-chatwindowcontainer")[0]?26:0,$L("#ReportsNoRecordsFound").css("line-height",a-77);var s=e.params,o=Object.assign({},s);o.selected_folder=e.scope;var n=document.querySelector("crm-report-folders").component;n.setData("query_params",o);var l=n.executeMethod("getSelectedFolderIndex",void 0===o.folder_id?o.category:o.folder_id,n.getData("wholeFolders"));-1!==l&&n.executeMethod("scrollToGivenIndex",l);var c=!!(e.params&&e.params.searchword&&e.params.searchword.length>0);if(r.setData("isSearch",c),r.setData("personalAccount",Crm.userDetails.PERSONAL_ACCOUNT),r.setData("isVersionSwitchEnabled",n.getData("isVersionSwitchEnabled")),r.setData("isMigrationScheduled",n.getData("isMigrationScheduled")),r.setData("migrationScheduledTime",n.getData("migrationScheduledTime")),r.executeMethod("setTooltipMessage",r),this.transition.data.option&&"updateMetaData"===this.transition.data.option){var d={lastViewed:e.scope};for(var u in s)"deleted"!==e.scope&&s[u]&&void 0!==s[u]&&("sort_by"!==u&&"sort_order"!==u||(d[u]=s[u]));t=Object.assign({},d);d.action="configuration",d.type=crmConstants.requestMethods.POST,store.triggerAction("report","configuration",d).then((function(e){e&&(validationUtils.isValidNumber(t.lastViewed)?t.folder_id=t.lastViewed:t.category=t.lastViewed,delete t.lastViewed,moduleRecordMapping.Reports.query_params=t)}))}var m=$L("#reportSearchGobal2");if(m.length>0){m.lytefind({scope:"#crm-reports-listtable",search:".report-list a lyte-text span:not(.highlightdiv)"});var p=r.getData("params"),g=p&&p.searchword?p.searchword:"";document.querySelector("#reportSearchGobal2").setValue(g),(m=document.querySelector("#reportSearchGobal"))&&m.ltProp("value")!==g&&(r.setData("initialSearchSet",!0),m.ltProp("value",g))}}}),Lyte.Router.registerRoute("crm.tab.newReports.index.schedule",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-scheduled-report.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["crm-scheduled-report.css"],crmConstants.cssStaticPathForLyte))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},redirect:function(){"crm.tab.newReports.index.schedule"===this.transition.info.route&&this.replaceWith("crm.tab.newReports.index.schedule.list")}}),Lyte.Router.registerRoute("crm.tab.newReports.index.schedule.list",{queryParams:["status","sort_by","sort_order"],getResources:function(){return networkUtils.returnDependencyFiles(["crm-report-list-page.js"],crmConstants.jsStaticPathForLyte)},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},model:function(){var e={},t=this.getQueryParams(),r=this.transition.data.scheduleMsg?this.transition.data.scheduleMsg:"",i="active";for(var a in t)t[a]&&(e[a]=t[a],"status"===a&&(i=t[a]));return e.hasOwnProperty("sort_by")||"active"!==i&&"stopped"!==i||(e.sort_by="active"===i?"repeat_type":"modified_time",e.sort_order="desc"),Lyte.resolvePromises({reports:store.findAll("scheduled_report",e),params:e,scope:i,need_checkbox:!1,scheduleMsg:r})},afterModel:function(e){e.reports||(e.reports=[]);for(var t=[],r=e.reports.length,i=0;i<r;i++){var a=Object.assign({},e.reports[i]);a.schedule&&(a.repeat_type=Lyte.registeredMixins["crm-report-util"].getRepeatTypeConstant(a.schedule.repeat_type),a.schedule.details&&(a.next=a.schedule.details.next,a.previous=a.schedule.details.previous),delete a.schedule),t.push(a)}e.reports=t,e&&e.reports.$&&(this.currentModel.more_records=e.reports.$.meta.more_records,this.currentModel.page=e.reports.$.meta.page),this.transition.errorObj&&(this.currentModel.errorObj=this.transition.errorObj,Lyte.registeredMixins["crm-report-util"].errorPopup(this.currentModel.errorObj,!0)),commonUtils.showHideLoadingDiv()},renderTemplate:function(e){var t=document.querySelector("#crm-reports-listtable");return t&&t.scrollTable(0,0),{outlet:"#report_container",component:"crm-schedule-container",data:e}},afterRender:function(e,t,r){var i=$L("#scheduled");r.setData("reportHeading",i.text().trim()),r.setData("refresh",!0);var a=e.params,s=Object.assign({},a);s.selected_folder="scheduled";var o=document.querySelector("crm-report-folders").component,n=o.getData("query_params");s.sort_by=n.sort_by,s.sort_order=n.sort_order,o.setData("query_params",s);var l=document.querySelector("#crm-reports-listtable");if(l){var c=window.innerHeight-l.getBoundingClientRect().top;c-=$L("#wms-chatwindowcontainer")[0]?26:0,$L("#ReportsNoRecordsFound").css("line-height",c-77)}if(this.transition.data.option&&"updateMetaData"===this.transition.data.option){var d={lastViewed:"scheduled",action:"configuration"};d.type=crmConstants.requestMethods.POST,store.triggerAction("report","configuration",d).then((function(e){e&&(moduleRecordMapping.Reports.query_params={category:"scheduled"})}))}},actions:{onError:function(e,t){t.abort();var r=JSON.parse(e.response);r&&r.code&&"NOT_SUPPORTED_FEATURE"===r.code?Lyte.Router.transitionTo({route:"crm.tab.newReports.index.list",queryParams:{category:"everything"}}).data={option:"updateMetaData"}:Lyte.registeredMixins["crm-report-util"].errorPopup(e,!0)}}}),Lyte.Router.registerRoute("crm.crm-mobile-intermediatepage",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-mobilepage.css"],crmConstants.cssStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-mobilepage.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("mobilewebintermediatepage")]);return t.concat(e).concat(r)},renderTemplate:function(){return{outlet:"body",component:"crm-mobile-intermediatepage"}}}),Lyte.Router.registerRoute("crm.crm-error",{getResources:function(){var e=networkUtils.returnDependencyFiles(["crm-module-error.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["crm-module-error.css"],crmConstants.cssStaticPathForLyte);return e.concat(t)},afterModel:function(e,t){this.currentModel=this.transition.data},renderTemplate:function(e,t){return!0===e.showError?{outlet:"#show",component:"crm-deleted-module-error-page"}:{outlet:"#show",html:e}}}),Lyte.Router.registerRoute("crm.gamification",{getResources:function(){var e=[];return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles()))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("gamification")],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("gamescope")],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles(["gamescope-rule-detailed-comp.js","gamescope-delete-modal.js","gamescope-alert.js","gamescope.js","gamescope-threedotmenu.js","lytecombobox.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-rule-card.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-tvchannel-comp.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-create-dashboard-comp.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-team-comp.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-team-comp.css","gamescope-create-game.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-icons.css","gamescope-delete-modal.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-target-comp.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-threedot-menu.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-target-create-comp.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-game-comp.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-game-badge.js"],crmConstants.jsStaticPathForLyte)),e=(e=(e=(e=(e=(e=(e=Crm.userDetails.CUSTOMIZE_INFO.motivator_dark_theme?Crm.userDetails.RTL_ENABLED?e.concat(networkUtils.returnDependencyFiles(["gamescope-ui-components-rtl-dark.css","gamescope-crux-components-rtl-dark.css","gamescope.css","gamescope-rtl.css"],crmConstants.cssStaticPathForLyte)):e.concat(networkUtils.returnDependencyFiles(["gamescope-ui-components-dark.css","gamescope-crux-components-dark.css","gamescope.css"],crmConstants.cssStaticPathForLyte)):Crm.userDetails.RTL_ENABLED?e.concat(networkUtils.returnDependencyFiles(["gamescope-ui-components-rtl.css","gamescope-crux-components-rtl.css","gamescope.css","gamescope-rtl.css"],crmConstants.cssStaticPathForLyte)):e.concat(networkUtils.returnDependencyFiles(["gamescope-ui-components.css","gamescope-crux-components.css","gamescope.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-dashboard-component.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-rule-detailed.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-dashboard.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-tvchannel.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-game.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-record-deleted.js","lyte-scrollTo.js","lyte-clock.js"],crmConstants.jsStaticPathForLyte))},getDependencies:function(){var e=[];return e=(e=(e=(e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["gamescope-dashboard.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-tvchannel.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-game-rule-model.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-target.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-point-computation.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-game-team.js"],crmConstants.jsStaticPathForLyte))},model:function(){return Lyte.resolvePromises({user:store.findAll("user",{include_lite_users:!0}),features:store.findAll("features",{api_names:["sales_motivator_rules","sales_motivator_targets","sales_motivator_tvchannels","sales_motivator_tvchannels_comp","sales_motivator_dashboards","sales_motivator_dashboards_comp","sales_motivator_games","sales_motivator_games_rules","sales_motivator_games_users","sales_motivator_teams","sales_motivator_teams_users"].join(",")}),game_rule:store.findAll("game_rule",{include:"point_computation"}),targets:store.findAll("target"),gamescope_analytics:store.findAll("gamescope_analytics"),tv_channels:store.findAll("tv_channels"),game_team:store.findAll("game_team")})},renderTemplate:function(){return networkUtils.initChart(),{outlet:"#basic",component:"gamescope-index"}},actions:{didTransition:function(){if(this.setTitle(I18n.getMsg("gs.salesmotivator")),$L("#gs_threedotmenu")[0].ltProp("show",!1),$L("body").hasClass("bodyWrapper")){$L("#gs_create_rule_modal")[0].ltProp("show",!1),$L("#gs_create_target_modal")[0].ltProp("show",!1),$L("#gs_create_team_modal")[0].ltProp("show",!1),$L("#gs_create_game_modal")[0].ltProp("show",!1),$L("#gs_create_dashboard_modal")[0].ltProp("show",!1);var e=$L("#gs_create_component_modal");e.length>0&&e[0].ltProp("show",!1);var t=$L("#gs_create_tvchannel_modal");t.length>0&&t[0].ltProp("show",!1),$L("#gs_delete_modal")[0].ltProp("show",!1)}},onError:function(e){var t=JSON.parse(e.response);"NO_PERMISSION"===t.code&&"Gamification is not enabled"===t.message&&$("#basic").html('<div class="aIC dF flexDC h100vh jCC"> <p class="gs_redText f24">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="col5 mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")}}}),Lyte.Router.registerRoute("crm.gamification.achievements",{queryParams:["type","selectedPeople","selectedPeopleType"],getResources:function(){var e=networkUtils.returnDependencyFiles(["gamescope-achievement.css"],crmConstants.cssStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["gamescope-achievement-comp.js"],crmConstants.jsStaticPathForLyte))},getDependencies:function(){var e=networkUtils.returnDependencyFiles(["gamescope-achievements.js"],crmConstants.jsStaticPathForLyte);return e=(e=e.concat(networkUtils.returnDependencyFiles(["gamescope-game-badge.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-target.js"],crmConstants.jsStaticPathForLyte))},model:function(e){var t,r=e.queryParams,i=r.type&&0!==r.type.length?r.type:"games",a=r.selectedPeopleType&&0!==r.selectedPeopleType.length?r.selectedPeopleType:"user",s=r.selectedPeople&&0!==r.selectedPeople.length?r.selectedPeople:Crm.userDetails.USER_ID,o={type:a,id:s};if("user"===a)t=void 0===store.peekRecord("user",s)?store.findRecord("user",s):Promise.resolve([store.peekRecord("user",s)]);else if("team"===a){if(!store.peekRecord("game_team",s))return{selectedPeopleType:"team",selectedPeople:s,nodatafound:!0,recordName:I18n.getMsg("gs.team")}}else{if("company"!==a)return{selectedPeopleType:"invalid",nodatafound:!0,message:I18n.getMsg("gs.incorrect.url"),type:"invalidurl"};if(s!=crmZgid)return{selectedPeopleType:"company",selectedPeople:s,nodatafound:!0,message:I18n.getMsg("gs.incorrect.url"),type:"invalidurl"}}return"games"===i?(o.include_inner_details="result.configs.start_date, result.configs.end_date",Lyte.resolvePromises({gameAchievement:store.findRecord("game_achievements",s,o,!0,!0),gameModel:store.findAll("game",{status:"completed"}),achievementType:i,selectedPeopleType:a,user:t,selectedPeople:s,badges:store.findAll("game_badge")})):"targets"===i?Lyte.resolvePromises({targetAchievement:store.findRecord("target_achievements",s,o,!0,!0),badges:0===store.peekAll("game_badge").length?store.findAll("game_badge"):Promise.resolve(store.peekAll("game_badge")),targets:0===store.peekAll("target").length?store.findAll("target"):Promise.resolve(store.peekAll("target")),achievementType:i,selectedPeopleType:a,user:t,selectedPeople:s}):{selectedPeopleType:"invalid",nodatafound:!0,message:I18n.getMsg("gs.incorrect.url"),type:"invalidurl"}},afterModel:function(e,t){var r=void 0!==t.queryParams.type?t.queryParams.type:"games";if("user"===e.selectedPeopleType){if(0===Object.keys(e.user).length||"deleted"===e.user[0].status)return e.nodatafound=!0,e.recordName=I18n.getMsg("gs.user"),this.currentModel=e;e.nodatafound=!1,e.user=e.user[0],e.selectedPeopleName=e.user.$.get("full_name")}else if("team"===e.selectedPeopleType){if(!store.peekRecord("game_team",e.selectedPeople))return this.currentModel=e;e.nodatafound=!1,e.selectedPeopleName=store.peekRecord("game_team",e.selectedPeople).$.get("name")}else{if("company"!==e.selectedPeopleType)return this.currentModel=e;if(e.selectedPeople!=crmZgid)return this.currentModel=e;e.selectedPeopleName=I18n.getMsg("gs.allusers")}if("targets"===r){e.badges=e.badges.map((function(e){return e.$.toJSON()}));var i=e.targetAchievement,a={},s={},o=[];e.badges.forEach((function(e){a[e.name]=0,s[e.id]=[]}));var n=["daily","weekly","monthly","yearly"],l={daily:[],weekly:[],monthly:[],yearly:[]};i.result.forEach((function(t,r){var i=store.peekRecord("target",t.target.id);t.repeatType=i.$.get("time_period").type,t.icon_id=i.$.get("icon_id");var c=store.peekRecord("game_badge",t.icon_id);t.icon_name=c.$.get("name"),a[t.icon_name]++,e.badges.forEach((function(e){t.icon_id===e.id&&s[e.id].push(objectUtils.cloneObject(t))})),n.forEach((function(e){t.repeatType===e&&l[e].push(objectUtils.cloneObject(t))})),o[r]=objectUtils.cloneObject(e.targetAchievement.result[r])})),e.targetResult=o,e.badgeWiseResultData=s,e.badgeWiseResultData[0]=o,l.all=o,e.repeatTypeWiseResultData=l,e.badgeData=a,e.targetAchievement.badgeTotalCount=i.result.length,e.badgeId="0",e.badges.unshift({name:"allbadge",display_name:I18n.getMsg("gs.allbadge"),id:"0"}),e.selectedTargetPeriod="all"}else{var c=[];for(u=0;u<6;u++)c[u]=[];o=[];for(var d=e.gameAchievement.result.length,u=0;u<d;u++){var m=e.gameAchievement.result[u];o[u]=m,o[u]&&c[m.rank].push(o[u])}c[0]=o,e.trophyId="0",e.selectedGameDuration="thisyear",e.trophyWiseResultData=c,e.gameResult=o}if("user"===e.selectedPeopleType&&e.user){var p=e.user;if(p){var g=p.$.get("profile");g&&(e.userProfileName=g.$.get("name"))}}},afterRender:function(){$L("#gs_nav_achievements").attr("selected",!0)},didDestroy:function(e,t){var r=t.queryParams,i=void 0!==r.type?r.type:"games",a=void 0===r.selectedPeopleType?"user":r.selectedPeopleType,s=void 0===r.selectedPeople?Crm.userDetails.USER_ID:r.selectedPeople,o={type:a,id:s};"games"===i?(o.include_inner_details="result.configs.start_date, result.configs.end_date",store.clearCachedQuery("game_achievements",s,o)):store.clearCachedQuery("target_achievements",s,o)},renderTemplate:function(e){return e.nodatafound?{outlet:"#gs_outlet",component:"gamescope-record-deleted"}:{outlet:"#gs_outlet",component:"gamescope-achievement",reRender:!0}},actions:{willTransition:function(){var e=this.getQueryParams(),t=void 0!==e.type?e.type:"games",r=void 0===e.selectedPeopleType?"user":e.selectedPeopleType,i=void 0===e.selectedPeople?Crm.userDetails.USER_ID:e.selectedPeople,a={type:r,id:i};"games"===t?(a.include_inner_details="result.configs.start_date, result.configs.end_date",store.clearCachedQuery("game_achievements",i,a)):store.clearCachedQuery("target_achievements",i,a)},onError:function(e){return"NO_PERMISSION"===JSON.parse(e.response).code&&(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aIC dF fDC h100vh jCC"> <p class="crm-font-regular redText f24">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="col5 mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")),!1}}},{mixins:["gamescope_config"]}),Lyte.Router.registerRoute("crm.gamification.dashboards",{getResources:function(){var e=networkUtils.returnDependencyFiles(["gamescope-dashboard.css","gamescope-dashboard-inner-card.css","gamescope-target-card.css","gamescope-rule-card.css","gamescope-ongoinggame-card.css"],crmConstants.cssStaticPathForLyte);return e=(e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_analytics.js"],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles(["gamescope-target-card.js","gamescope-dashboard-inner-card.js","gamescope-target-mixins.js","gamescope-target.js","gamescope-game-rule-model.js","gamescope-game-badge.js","gamescope-game-team.js","gamescope-about-kpi.js","gamescope-about-target.js","gamescope-about-game.js"],crmConstants.jsStaticPathForLyte))},afterRender:function(){$L("#gs_nav_dashboard").attr("selected",!0)}}),Lyte.Router.registerRoute("crm.gamification.game",{getResources:function(){return networkUtils.returnDependencyFiles(["gamescope-about-game.js","gamescope-allkpi-table.js","gamescope-about-kpi.js","gamescope-about-team.js"],crmConstants.jsStaticPathForLyte)},getDependencies:function(){return networkUtils.returnDependencyFiles(["gamescope-game.js","gamescope-game-rule-model.js","gamescope-point-computation.js","gamescope-dashboard-component.js","gamescope-game-team.js"],crmConstants.jsStaticPathForLyte)},afterRender:function(){$L("#gs_nav_games").attr("selected",!0)}}),Lyte.Router.registerRoute("crm.gamification.home",{renderTemplate:function(){return{outlet:"#gs_outlet",component:"gamescope-home"}},model:function(){return store.findAll("game_rule")},afterModel:function(e){this.currentModel={rule:e}},afterRender:function(){$L("#gs_nav_home").attr("selected",!0)},actions:{onError:function(e){return"NO_PERMISSION"===JSON.parse(e.response).code&&(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aIC dF fDC h100vh jCC"> <p class="crm-font-regular redText f24">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="col5 mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")),!1}}}),Lyte.Router.registerRoute("crm.gamification.rules",{getResources:function(){var e=networkUtils.returnDependencyFiles(["gamescope-rule.css","gamescope-rule-dashboard-detail.css","gamescope-rule-card.css"],crmConstants.cssStaticPathForLyte);return e=(e=e.concat(networkUtils.returnDependencyFiles(["gamescope-rule-card.js","gamescope-about-kpi.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["zohocrm_analytics.js"],crmConstants.jsStaticPath))},afterRender:function(){$L("#gs_nav_rules").attr("selected",!0)}}),Lyte.Router.registerRoute("crm.gamification.targets",{getResources:function(){var e=networkUtils.returnDependencyFiles(["zohocrm_analytics.js"],crmConstants.jsStaticPath);return e=(e=e.concat(networkUtils.returnDependencyFiles(["gamescope-target-comp.css","gamescope-rule-dashboard-detail.css","gamescope-target-card.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-target-card.js","gamescope-target-mixins.js","gamescope-about-target.js","gamescope-about-kpi.js"],crmConstants.jsStaticPathForLyte))},getDependencies:function(){var e=networkUtils.returnDependencyFiles(["gamescope-target.js"],crmConstants.jsStaticPathForLyte);return e=(e=e.concat(networkUtils.returnDependencyFiles(["gamescope-game-rule-model.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["gamescope-game-team.js"],crmConstants.jsStaticPathForLyte))},model:function(){var e=store.findAll("target"),t=0!==store.peekAll("game_rule").length?Promise.resolve(store.peekAll("game_rule")):store.findAll("game_rule"),r=0!==store.peekAll("game_team").length?Promise.resolve(store.peekAll("game_team")):store.findAll("game_team"),i=store.findAll("points_acquired");return Lyte.resolvePromises([e,t,r,i])},afterRender:function(){$L("#gs_nav_target").attr("selected",!0)}}),Lyte.Router.registerRoute("crm.gamification.team",{getResources:function(){var e=networkUtils.returnDependencyFiles(["gamescope-team-comp.css"],crmConstants.cssStaticPathForLyte),t=networkUtils.returnDependencyFiles(["gamescope-team-comp.js","gamescope-about-team.js"],crmConstants.jsStaticPathForLyte);return e.concat(t)},getDependencies:function(){return networkUtils.returnDependencyFiles(["gamescope-game-team.js"],crmConstants.jsStaticPathForLyte)},model:function(){return Lyte.resolvePromises({teams:store.findAll("game_team")})},afterModel:function(e){e.teams_table=Lyte.registeredMixins.gamescope_list_filter_options.getAllTeams(),e.leadOptions=Lyte.registeredMixins.gamescope_list_filter_options.getLeadOptionsForTeam(),e.userOptions=Lyte.registeredMixins.gamescope_list_filter_options.getUserOptionsForTeam(),this.currentModel=e},afterRender:function(){$L("#gs_nav_team").attr("selected",!0)},renderTemplate:function(){return{outlet:"#gs_outlet",component:"gamescope-teams"}},actions:{onError:function(e){return"NO_PERMISSION"===JSON.parse(e.response).code&&(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aIC dF fDC h100vh jCC"> <p class="crm-font-regular redText f24">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="col5 mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")),!1}}}),Lyte.Router.registerRoute("crm.gamification.tvchannel",{queryParams:["id"],getResources:function(){var e=networkUtils.returnDependencyFiles(["gamescope-target-card.css","gamescope-dashboard-inner-card.css","gamescope-rule-card.css","gamescope-ongoinggame-card.css","gamescope-tvchannel.css"],crmConstants.cssStaticPathForLyte);return e=(e=e.concat(networkUtils.returnDependencyFiles(["zohocrm_analytics.js"],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles(["gamescope-target-card.js","gamescope-target-mixins.js","gamescope-dashboard-inner-card.js","gamescope-target.js","gamescope-game-rule-model.js","gamescope-game-team.js"],crmConstants.jsStaticPathForLyte))},afterRender:function(){$L("#gs_nav_tv").attr("selected",!0)}}),Lyte.Router.registerRoute("crm.gamification.dashboards.index",{queryParams:["id"],beforeModel:function(){store.unloadAll("gamescope_analytics"),store.unloadAll("gamescope_components")},model:function(e){var t=store.findAll("gamescope_analytics"),r=store.findAll("gamescope_analytics",{category:"recent"}),i=store.findAll("game_rule",void 0,!1,!1).then((function(){return Lyte.registeredMixins.gamescope_rule.requestAnalyticsAPIXHR()})),a=store.findAll("target").then((function(){return store.findAll("points_acquired").then((function(){return Lyte.registeredMixins.gamescope_target.getTargetDashboatdData()}))})),s=store.findAll("game",{status:"ongoing"}),o=store.findAll("game_team");return Lyte.resolvePromises({gamescope_analytics:t,gamescope_analytics_recent:r,rulesData:i,targetsData:a,gameConfig:s,teams:o,badges:store.findAll("game_badge")}).then((function(t){t.dashboardFilterDisabledList=[],t.invalidParam=!1,t.totalDashboards=void 0!==t.gamescope_analytics?t.gamescope_analytics.length:0,t.rulesData=store.peekAll("game_rule"),t.rulesData=t.rulesData&&0!==t.rulesData.length?t.rulesData:[],t.targetsData=t.targetsData&&0!==t.targetsData.length?t.targetsData:[],t.gameConfig=void 0===t.gameConfig?[]:t.gameConfig;var r=!0;if(t.gamescope_analytics){if(t.isFavoriteAvailable=!1,t.isSharedWithmeAvailable=!1,t.isCreatedBymeAvailable=!1,t.gamescope_analytics_recent){var i=-1;if(t.gamescope_analytics_recent.forEach((function(e,t){void 0!==e&&-1!==e||!r||(i=t)})),-1!=i){var a={name:"default",id:"default"};t.gamescope_analytics_recent.splice(i,1,a),r=!1}}else{t.gamescope_analytics_recent=[];a={name:"default",id:"default"};t.gamescope_analytics_recent.push(a)}t.gamescope_analytics.forEach((function(e){if((void 0===e||-1===e)&&r){var i={};i.name=Lyte.Component.registeredHelpers.getI18n("gs.default"),i.id="default",t.gamescope_analytics.push(i),t.gamescope_analytics=Lyte.registeredMixins.gamescope_config.removeUndefinedFromArray(e),r=!1}!t.isFavoriteAvailable&&e.favorite&&(t.isFavoriteAvailable=!0),e.shared_to&&!t.isSharedWithmeAvailable&&e.shared_to.forEach((function(e){e.id===Crm.userDetails.USER_ID&&(t.isSharedWithmeAvailable=!0)})),t.isCreatedBymeAvailable||e.created_by.id===Crm.userDetails.USER_ID&&(t.isCreatedBymeAvailable=!0)})),t.isFavoriteAvailable||t.dashboardFilterDisabledList.push("faviourtes"),t.isSharedWithmeAvailable||t.dashboardFilterDisabledList.push("sharedWithme"),t.isCreatedBymeAvailable||t.dashboardFilterDisabledList.push("createdByMe")}if(t.dashboardFilterDisabledList=void 0===t.gamescope_analytics?JSON.parse('["faviourtes","sharedWithme","createdByMe"]'):t.dashboardFilterDisabledList,Lyte.Router.getRouteInstance().transition.data.filterType)switch(Lyte.Router.getRouteInstance().transition.data.filterType){case"faviourtes":t.gamescope_analytics=t.gamescope_analytics.filter((function(e){return!0===e.favorite}));break;case"createdByMe":t.gamescope_analytics=t.gamescope_analytics.filter((function(e){return e.created_by.id===Crm.userDetails.USER_ID}));break;case"sharedWithme":t.gamescope_analytics=t.gamescope_analytics.filter((function(e){if(e.shared_to){var t=[];return e.shared_to.forEach((function(r){r.id===Crm.userDetails.USER_ID&&t.push(e)})),t}}))}if(Lyte.Router.getRouteInstance().transition.data.isDefault)t.dashboardId="default",t.dashboardName=I18n.getMsg("gs.default"),t.rulesData&&t.rulesData.forEach((function(e){e.user={},e.user.id=Crm.userDetails.USER_ID,e.user.full_name=Crm.userDetails.DISPLAY_NAME,e.user.name=Crm.userDetails.DISPLAY_NAME,e.user.type="user"}));else if(void 0!==e.queryParams.id){t.dashboardId=e.queryParams.id;var s=[];t.gamescope_analytics&&(s=t.gamescope_analytics.filter((function(t){return t.id===e.queryParams.id}))),s.length>0?t.dashboardName=s[0].name:t.invalidParam=!0}else void 0!==t.gamescope_analytics_recent&&0!==t.gamescope_analytics_recent.length&&void 0!==t.gamescope_analytics_recent[0]&&void 0!==t.gamescope_analytics_recent[0].id?(t.dashboardId=t.gamescope_analytics_recent[0].id,t.gamescope_analytics_recent[0]&&(t.dashboardName=t.gamescope_analytics_recent[0].name,t.rulesData&&"default"===t.dashboardName&&(t.dashboardName=I18n.getMsg("gs.default"),t.rulesData.forEach((function(e){e.user={},e.user.id=Crm.userDetails.USER_ID,e.user.full_name=Crm.userDetails.DISPLAY_NAME,e.user.name=Crm.userDetails.DISPLAY_NAME,e.user.type="user"}))))):(t.dashboardId="default",t.dashboardName=I18n.getMsg("gs.default"),t.rulesData&&t.rulesData.forEach((function(e){e.user={},e.user.id=Crm.userDetails.USER_ID,e.user.full_name=Crm.userDetails.DISPLAY_NAME,e.user.name=Crm.userDetails.DISPLAY_NAME,e.user.type="user"})));return t.dashboardFilter=void 0!==Lyte.Router.getRouteInstance().transition.data.filterType?Lyte.Router.getRouteInstance().transition.data.filterType:"all",t}))},afterModel:function(e){if(e.showCreateComponent=!1,"default"!==e.dashboardId&&""!==e.dashboardId)return Lyte.registeredMixins.gamescope_tvchannel.getComponentsWithGameConfig(e.dashboardId,"dashboard").then((function(t){return e.gamescope_components=t,e.rulesData=[],e.targetsData=[],e.gameConfig=[],e.invalidParam||void 0!==e.gamescope_components&&0!==e.gamescope_components.length?e.invalidParam||(e.isDashboardComponentLimitAvailable=Lyte.registeredMixins.gamescope_config.isDashboardComponentLimitAvailable(store.peekAll("gamescope_components")),e.showCreateComponent=0===e.gamescope_components.length,e.gamescope_components=Lyte.registeredMixins.motivator_components.updateDashboardComp(e.gamescope_components)):e.showCreateComponent=!0,e}));Lyte.registeredMixins.gamescope_tvchannel.getComponentsWithGameConfig(Crm.userDetails.USER_ID,"dashboard").then((function(){return e}))},renderTemplate:function(e){return e.invalidParam?(e.recordName=I18n.getMsg("gs.dashboard"),{outlet:"#gs_outlet",component:"gamescope-record-deleted"}):{outlet:"#gs_outlet",component:"gamescope-dashboard",reRender:!0}},actions:{onError:function(e){return"NO_PERMISSION"===JSON.parse(e.response).code?(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aIC dF fDC h100vh jCC"> <p class="crm-font-regular redText f24">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="col5 mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")):($L("#gs_outlet")[0].innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"commonerror"},"#gs_outlet")),!1}}}),Lyte.Router.registerRoute("crm.gamification.game.index",{queryParams:["status","page","viewType"],getResources:function(){var e=networkUtils.returnDependencyFiles(["gamescope-games.css","gamescope-create-game.css","gamescope-ongoinggame-card.css","gamescope-game-scoreboard-comp.css","gamescope-game-participants-modal.css"],crmConstants.cssStaticPathForLyte);return networkUtils.returnDependencyFiles(["gamescope-game-comp.js","gamescope-game-scoreboard-comp.js"],crmConstants.jsStaticPathForLyte).concat(e)},model:function(e){var t=void 0===e.queryParams.status||0===e.queryParams.status.length?"upcoming":e.queryParams.status,r=void 0===e.queryParams.page?1:e.queryParams.page,i="ongoing"===t?void 0:void 0===e.queryParams.viewType?"card":e.queryParams.viewType;return Lyte.resolvePromises({summary:store.findAll("game_summary",{status:t,page:r,per_page:50}),gameConfig:store.findAll("game",{status:t,page:r,per_page:50}),status:t,routeChanged:!1,viewType:i,page:r}).then((function(e){if("upcoming"===e.status?(e.summary=e.gameConfig,e.page=r,e.gameConfig&&(e.moreRecords=e.gameConfig.$.meta.more_records)):"completed"===e.status&&(e.page=r,e.summary&&(e.moreRecords=e.summary.$.meta.more_records)),e.summary||(e.summary=[]),e.summary=e.summary.map((function(e){return e.$.toJSON()})),e.gameConfig&&(e.gameConfig=e.gameConfig.map((function(e){return e.$.toJSON()}))),"list"===e.viewType)for(var t=e.summary,i=t.length,a=e.gameConfig,s=0;s<i;s++)t[s].created_by=a[s].created_by,t[s].repeat=a[s].repeat;return e}))},afterModel:function(e){var t=this.transition.data;e&&(e.prevSelectedGameID=t.prevSelectedGameID),this.currentModel=e},renderTemplate:function(){return{outlet:"#gs_outlet",component:"gamescope-games",reRender:!0}},actions:{onError:function(e){return"NO_PERMISSION"===JSON.parse(e.response).code&&(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aIC dF fDC h100vh jCC"> <p class="crm-font-regular redText f24">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="col5 mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")),!1}}}),Lyte.Router.registerRoute("crm.gamification.game.point-summary",{queryParams:["selectedUser","selectedTeam"],getResources:function(){var e=networkUtils.returnDependencyFiles(["gamescope-game-point-summary-comp.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["gamescope-game-point-summary-comp.css"],crmConstants.cssStaticPathForLyte);return e.concat(t)},getDependencies:function(){return networkUtils.returnDependencyFiles(["gamescope-game-scoreboard.js","gamescope-game-point-summary.js"],crmConstants.jsStaticPathForLyte)},beforeModel:function(e){var t=this,r=e.dynamicParam,i=e.queryParams.selectedUser,a=e.queryParams.selectedTeam;return r&&(i||a)?Lyte.resolvePromises({game:store.findRecord("game",r)}).then((function(e){if("group"===e.game.type){var s=[],o=[],n=[];if(e.game.participants.forEach((function(e){o.push(e.id),e.members.forEach((function(t){s.push(t.id),n.push(e.id),n.push(t.id)}))})),i&&s.contains(i)){var l=n[n.findIndex((e=>e===i))-1];if(a&&!o.contains(a))return Promise.reject({response:JSON.stringify({code:"NO_PARTICIPANTS_FOUND"})});if(!a){var c={selectedUser:i,selectedTeam:l};t.transitionTo({route:"crm.gamification.game.point-summary",dynamicParams:[r],queryParams:c}).data=t.transition.data}}else{if(!a||!o.contains(a))return Promise.reject({response:JSON.stringify({code:"NO_PARTICIPANTS_FOUND"})});var d=e.game.participants[o.findIndex((e=>e===a))].members[0].id;if(i&&!s.contains(i))return Promise.reject({response:JSON.stringify({code:"NO_PARTICIPANTS_FOUND"})});if(!i){c={selectedUser:d,selectedTeam:a};t.transitionTo({route:"crm.gamification.game.point-summary",dynamicParams:[r],queryParams:c}).data=t.transition.data}}}else{if("user"!==e.game.type)return Promise.reject({response:JSON.stringify({code:"NO_GAME_FOUND"})});if(i&&!e.game.participants.some((e=>e.id===i)))return Promise.reject({response:JSON.stringify({code:"NO_PARTICIPANTS_FOUND"})});if(!i)return Promise.reject({response:JSON.stringify({code:"NO_PARTICIPANTS_FOUND"})})}}),(function(){return Promise.reject({response:JSON.stringify({code:"NO_GAME_FOUND"})})})):Promise.reject({response:JSON.stringify({code:"NO_PARAMS_FOUND"})})},model:function(e){var t=e.queryParams.selectedUser,r=e.queryParams.selectedTeam,i=e.dynamicParam,a=this,s=store.peekRecord("game",i);if("user"===s.type)var o=store.findRecord("game_summary",i);else o=store.findRecord("game_scoreboard",i,{group_by:"group",based_on:"user"});return Lyte.resolvePromises({pointSummary:store.findAll("point_summary",{user:t},!1,!0,{id:i}),participantPoints:o}).then((function(e){var i={},o=e.participantPoints,n=e.pointSummary;i.game=s,i.isCompletedGame="completed"===s.$.get("status"),i.records=n.records,i.selectedUser=t;var l={};s.rules.forEach((function(e){l[e.id]=0}));var c=0;if(n.records.forEach((function(e){l[e.rule.id]=l[e.rule.id]+e.point,c+=e.point})),i.records=n.records.filter((function(e){return void 0!==e.name})),i.totalUserPoint=c,i.ruleCountObj=l,"group"===s.type){var d=s.participants.filter((function(e){if(void 0!==(e=e.members.filter((function(e){return e.id===t}))[0]))return!0}))[0];i.members=d.members,i.selectedTeam=d.id,i.selectedTeamName=d.name}else i.members=s.participants;var u=Crm.getUserDetailsMap(),m=[];i.members.forEach((function(e){var t=u[e.id],i={image:t&&t.avatar?t.avatar:"//img.zohocdn.com/crm/images/nophoto_80ea3af_.png",id:e.id,name:t.name};"user"===s.type?o.participants.every((function(t){return t.id!==e.id||(i.points=t.points,!1)})):o.details.every((function(t){return t.id!==r||(t.based_on.every((function(t){return t.id!==e.id||(i.points=t.point,!1)})),!1)})),m.push(i)})),i.partipantAvatars=m;var p=a.getObjFromGivenArray(i.members,t,"id"),g=p.index;return i.selectedUserName=-1!==g?p.data.name:e.pointSummary.user.name,i.fromDashboard=a.transition.data.fromDashboard,i.dashboardId=a.transition.data.dashboardId,i.viewType=a.transition.data.viewType,i.page=a.transition.data.page,i}))},afterModel:function(e,t){return store.findRecord("game_summary",t.dynamicParam).then((function(t){t.participants.forEach((function(t){e.selectedTeam===t.id&&(e.summaryPointTeam=t.points)}))}))},didDestroy:function(e,t){store.clearCachedQuery("point_summary",{user:t.queryParams.selectedUser})},renderTemplate:function(){return{outlet:"#gs_outlet",component:"gamescope-game-point-summary"}},actions:{onError:function(e){var t=$L("#gs_outlet")[0],r=JSON.parse(e.response);"NO_PERMISSION"===r.code?$("#basic").html('<div class="aIC dF fDC h100vh jCC"> <p class="crm-font-regular redText f24">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="col5 mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>"):"NO_PARTICIPANTS_FOUND"===r.code||"NO_GAME_FOUND"===r.code||"NO_PARAMS_FOUND"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{message:I18n.getMsg("gs.incorrect.url"),type:"invalidurl"},"#gs_outlet")):(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"commonerror"},"#gs_outlet")),commonUtils.showHideLoadingDiv(!1)}}},{mixins:["gamescope_config"]}),Lyte.Router.registerRoute("crm.gamification.game.scoreboard",{queryParams:["isMultipleRuleIndividualGame","selectedTab","selectedTeam","selectedRule"],getResources:function(){var e=networkUtils.returnDependencyFiles(["gamescope-game-scoreboard-comp.js","gamescope-about-kpi.js","gamescope-about-team.js","gamescope-allkpi-table.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles(["gamescope-game-scoreboard-comp.css","gamescope-game-participants-modal.css","gamescope-ongoinggame-card.css"],crmConstants.cssStaticPathForLyte);return e.concat(t)},getDependencies:function(){return networkUtils.returnDependencyFiles(["gamescope-game-scoreboard.js","lyte-counter.js"],crmConstants.jsStaticPathForLyte)},beforeModel:function(e){var t=e.dynamicParam;return store.findRecord("game",t).then((function(e){if(!(e instanceof Record))throw new Exception("GameNotFound","Game is not available in server side")}))},model:function(e){var t,r=e.dynamicParam,i=store.peekRecord("game",r),a=this;switch(e.queryParams.selectedTab){case"Users":t={group_by:"user",based_on:"rule"};break;case"Teams":t={group_by:"group",based_on:"rule"},void 0!==e.queryParams.selectedTeam&&(t.filter_type="group",t.filter_value=e.queryParams.selectedTeam,t.group_by="rule",t.based_on="user");break;case"Rules":t="user"===i.$.get("type")?{group_by:"rule",based_on:"user"}:{group_by:"rule",based_on:"group"},void 0!==e.queryParams.selectedRule&&(t.filter_type="rule",t.filter_value=e.queryParams.selectedRule,t.group_by="group",t.based_on="user");break;default:t={group_by:"group",based_on:"user"}}return Lyte.resolvePromises({summary:store.findRecord("game_summary",this.getDynamicParam()),scoreboard:store.findRecord("game_scoreboard",e.dynamicParam,t,!1,!0),game:void 0===store.peekRecord("game",r)?store.findRecord("game",this.getDynamicParam()):Promise.resolve(store.peekRecord("game",r))}).then((function(r){var i={};if(i.scoreboard=r.scoreboard.$.toJSON(),i.game=r.game.$.toJSON(),i.summary=r.summary.$.toJSON(),i.summary&&i.game){i.game.participants=i.summary.participants;var s=i.game.id,o=store.peekRecord("game",s);"group"===o.type&&i.game.participants&&i.game.participants.forEach((function(e){o.participants.forEach((function(t){t.id===e.id&&(e.members=t.members)}))}));var n=$u.indexBy(i.summary.participants,"id");i.game.participants.forEach((function(e,t){n[e.id]&&(i.game.participants[t].points=n[e.id].points,i.game.participants[t].rank=n[e.id].rank)}))}if(i.query=t,i.selectedTab=e.queryParams.selectedTab,i.selectedTeam=e.queryParams.selectedTeam,i.selectedRule=e.queryParams.selectedRule,"Users"===i.selectedTab||"Rules"===i.selectedTab||"group"===t.filter_type){for(var l=i.scoreboard.details,c=l.length,d=[],u=0;u<c;u++)if(u%2==0){var m=[l[u]];d.push(m)}else{d[parseInt(u/2)].push(l[u])}i.scoreboardData=d}return i.isCompletedGame="completed"===i.game.status,void 0!==t.filter_type&&(i.filterBy=t.filter_type,i.filterValue=t.filter_value),i.fromDashboard=a.transition.data.fromDashboard,i.dashboardId=a.transition.data.dashboardId,i.viewType=a.transition.data.viewType,i.page=a.transition.data.page,i}))},renderTemplate:function(){return{outlet:"#gs_outlet",component:"gamescope-game-scorecard",reRender:!0}},actions:{onError:function(e){if(!(e instanceof Exception))return"NO_PERMISSION"===JSON.parse(e.response).code&&(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aIC dF fDC h100vh jCC"> <p class="crm-font-regular redText f24">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="col5 mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")),!1;commonUtils.showHideLoadingDiv(!1),$L("div.dummy_Body")[0].style.display="none",$L("#gs_outlet")[0].innerHTML="",Lyte.Component.render("gamescope-record-deleted",{recordName:I18n.getMsg("gs.game")},"#gs_outlet")}}},{mixins:["gamescope_charts"]}),Lyte.Router.registerRoute("crm.gamification.rules.dashboards",{renderTemplate:function(e){return e.isRuleAvailable?{outlet:"#gs_outlet",component:"gamescope-rule-dashboard-details"}:(e.type&&"permissiondeniedformodule"===e.type||(e.recordName=I18n.getMsg("gs.rule")),{outlet:"#gs_outlet",component:"gamescope-record-deleted"})},beforeModel:function(e){var t=e.dynamicParam;return store.unloadAll("dashboard_comp"),0!==store.peekAll("game_rule").length&&store.peekRecord("game_rule",t)?Promise.resolve([store.peekRecord("game_rule",t)]):store.findRecord("game_rule",t)},model:function(e){var t,r,i,a,s,o=e.dynamicParam,n=this.transition.data,l=n.people,c=n.comptype,d=n.source,u=n.selectedfield;l&&l.id&&"org"!=l.type&&"All"!=l.type&&(r=l.id),n.moduleId&&(i=n.moduleId);var m=!(0===store.peekAll("game_rule").length||!store.peekRecord("game_rule",o));if(!m)return{isRuleAvailable:m,recordName:"KPI"};var p=store.peekRecord("game_rule",o),g=store.peekRecord("module",p.module.id);if(g.profiles&&!g.profiles.some((function(e){return e.name===Crm.userDetails.PROFILE_NAME})))return{type:"permissiondeniedformodule"};var f=store.findAll("module"),h=new Promise((function(e){e(a=Promise.resolve([store.peekRecord("game_rule",o)]))})).then((function(e){a=e[0];var r=store.findRecord("module",a.module.id),i=store.findAll("field",{module:a.module.api_name}).then((function(e){t=Lyte.registeredMixins.gamescope_rule.getFieldObject(e)}));return Promise.all([r,i])})).then((function(){n.duration||(n.duration="thismonth");var e=Lyte.registeredMixins.game_rules_record.getDateFilterValue(n.duration,n.customstartdate,n.customenddate);e&&!e.includes("undefined")&&((s={}).api_name=a.point_computation[0].date_field.api_name,s.comparator="between",s.value=e);var t="trend";return"component"==d&&c&&(t=c),Lyte.registeredMixins.gamescope_rule.xhrObject(a,"chart","day",t,u,r,s)}));return Lyte.resolvePromises({newtoResolve:h,modules:f,customView:undefined}).then((function(){return{dashBoardId:o,moduleFields:t,ruleId:a.id,transitionData:n,dateRangeVal:s,byFiledFormField:u,duration:n.duration,isRuleAvailable:m,parentCriteriaModule:i,compType:c,source:d}}))},afterModel(e){var t=this.transition.data;e.customstartdate=t.customstartdate,e.customenddate=t.customenddate,e.parentcustomstartdate=t.customstartdate,e.parentcustomenddate=t.customenddate,e.comparableRules=0!==store.peekAll("game_rule")?JSON.parse(JSON.stringify(store.peekAll("game_rule"))):[],e.comparableTeam=0!==store.peekAll("game_team")?JSON.parse(JSON.stringify(store.peekAll("game_team"))):[],e.comparableUsers=[],this.currentModel=e},actions:{onError:function(e){var t=$L("#gs_outlet")[0];if(e.response){var r=JSON.parse(e.response);"NO_PERMISSION"===r.code&&"Gamification is not enabled"===r.message?$("#basic").html('<div class="aIC dF fDC h100vh jCC"> <p class="crm-font-regular redText f24">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="col5 mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>"):"NO_PERMISSION"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"permissiondeniedformodule"},"#gs_outlet")):(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"commonerror"},"#gs_outlet"))}else t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{recordName:I18n.getMsg("gs.rule")},"#gs_outlet");commonUtils.showHideLoadingDiv(!1)}}}),Lyte.Router.registerRoute("crm.gamification.rules.index",{renderTemplate:function(){return{outlet:"#gs_outlet",component:this.getRenderComponent()}},beforeModel:function(){store.unloadAll("game_rule")},model:function(){var e,t=store.findAll("game_rule",{include:"point_computation"}).then((function(t){return e=!1,t&&(e=t.$.meta.more_records),Lyte.registeredMixins.gamescope_rule.requestAnalyticsAPIXHR()})),r=store.findAll("module");return Lyte.resolvePromises({modules:r,rules:t,page:1,perPage:50,isMoreRecords:e})},afterModel:function(e){var t=this.transition.data;if(e.selectedRuleId=t.selectedRuleId,t.parentCriteriaTime&&(e.duration=t.parentCriteriaTime,e.customStartDate=t.parentcustomstartdate,e.customEndDate=t.parentcustomenddate),t.parentCriteriaModule&&"undefined"!==t.parentCriteriaModule&&(e.module=store.peekRecord("module",t.parentCriteriaModule),e.selectedModuleName=e.module.plural_label),t.parentCriteriaPeople?e.people=t.parentCriteriaPeople:e.people={id:Crm.userDetails.USER_ID,type:"user",full_name:Crm.userDetails.DISPLAY_NAME},store.peekAll("game_rule").length>0){e.modules=Lyte.registeredMixins.gamescope.getDashboardSupportedModules();var r=store.peekAll("game_rule"),i=e.module;i&&i.id&&"All"!==i.id&&(r=r.filter((function(e){return i.api_name===e.module.api_name}))),e.ruleDashboards=JSON.parse(JSON.stringify(r))}this.currentModel=e},getRenderComponent:function(){return store.peekAll("game_rule").length>0?"gamescope-rule-dashboard":"gamescope-rule-basic"},actions:{onError:function(e){var t=JSON.parse(e.response);return"NO_PERMISSION"===t.code&&"Gamification is not enabled"===t.message&&(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aIC dF fDC h100vh jCC"> <p class="crm-font-regular redText f24">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="col5 mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")),!1}}}),Lyte.Router.registerRoute("crm.gamification.rules.list",{getResources:function(){return networkUtils.returnDependencyFiles(["gamescope-about-kpi.js"],crmConstants.jsStaticPathForLyte)},renderTemplate:function(e){return Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM?{outlet:"#gs_outlet",component:this.action.getRenderComponent()}:(e.type="permissiondenied",{outlet:"#gs_outlet",component:"gamescope-record-deleted"})},beforeModel:function(){store.unloadAll("game_rule")},model:function(){var e=store.findAll("game_rule",{include:"point_computation"});return Lyte.resolvePromises({ruleData:e})},afterModel:function(e){e.ruleData=Lyte.registeredMixins.gamescope_list_filter_options.getAllKPI(),e.moduleoptions=Lyte.registeredMixins.gamescope_list_filter_options.getModuleOptionsForKPI(),e.useroptions=Lyte.registeredMixins.gamescope_list_filter_options.getUserOptionsForKPI(),this.currentModel=e},action:{getRenderComponent:function(){return store.peekAll("game_rule").length>0?"gamescope-rule-list":"gamescope-rule-basic"},onError:function(e){return"NO_PERMISSION"===JSON.parse(e.response).code&&(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aIC dF fDC h100vh jCC"> <p class="crm-font-regular redText f24">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="col5 mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")),!1}}}),Lyte.Router.registerRoute("crm.gamification.targets.dashboard",{queryParams:["userId"],beforeModel:function(){var e=this.getDynamicParam(),t=this.getQueryParams().userId;return!e||e&&0===e.length||!t||t&&0===t.length?Promise.reject({response:JSON.stringify({code:"INVALID_PARAM"})}):store.findRecord("target",e).then((function(e){return e instanceof Object&&0===Object.keys(e).length?Promise.reject({response:JSON.stringify({code:"NO_TARGET_FOUND"})}):e instanceof Array&&!e[0].set_for.some((e=>e.id===t))?Promise.reject({response:JSON.stringify({code:"INVALID_USER_ID"})}):store.findRecord("module",e[0].rule.module.id)})).then((function(e){if(!e[0].profiles.some((e=>e.name===Crm.userDetails.PROFILE_NAME)))return Promise.reject({response:JSON.stringify({code:"NO_MODULE_PERMISSION"})})}),(function(e){var t=JSON.parse(e.response);return"NO_TARGET_FOUND"===t.code?Promise.reject({response:JSON.stringify({code:"NO_TARGET_FOUND"})}):"INVALID_USER_ID"===t.code?Promise.reject({response:JSON.stringify({code:"INVALID_USER_ID"})}):"NO_MODULE_PERMISSION"===t.code||"NO_PERMISSION"===t.code?Promise.reject({response:JSON.stringify({code:"NO_MODULE_PERMISSION"})}):Promise.reject({response:JSON.stringify({code:"QUERY_FAIL"})})}))},model:function(e){var t,r=e.dynamicParam,i=this.transition.data,a=i.target_time_period,s=i.people;if(s&&"user"===s.type&&(t=s.id),s&&"team"===s.type){var o=store.peekRecord("game_team",s.id);s.teamId=s.id;var n=[];o.$.get("members").forEach((function(e){n.push(e.id)})),s.id=n.toString(),t=s.id}var l=r+"_"+e.queryParams.userId,c=store.peekRecord("target",r),d=[],u="";c.set_for.forEach((function(e){if("user"===e.type)u+=e.id+",";else if("team"===e.type){var t=JSON.parse(JSON.stringify(store.peekRecord("game_team",e.id)));d.push(t)}})),u.length>0&&(u=u.slice(0,u.length-1)),a||(a=c.time_period);var m=i.source,p=a?this.getTimeGranularityValue[a.type]:"day";"week"===p&&(p="day");var g=a?"weekly"===a.type?"thisweek":"monthly"===a.type?"thismonth":"yearly"===a.type?"thisyear":"daily"===a.type?"today":"customRange":"customRange";if(!c||void 0===e.queryParams.userId||0===e.queryParams.userId.length||!c.set_for.some((function(t){return t.id===e.queryParams.userId})))return{isTargetAvailable:!1,recordName:I18n.getMsg("gs.target")};var f=store.peekRecord("points_acquired",r),h=c.$.get("rule").id,y=store.peekRecord("game_rule",h).$.toJSON(),v=JSON.parse(JSON.stringify(f)),_=Lyte.registeredMixins.gamescope_target.constructCriteriaForList(v,y),b=Lyte.registeredMixins.gamescope_target.constructCriteria(v,y),w=Lyte.registeredMixins.gamescope_target.getCustomDateRange(v),C=y.module.api_name,D={fields:store.findAll("field",{module:C,type:"all"},!1,!0,{apiVersion:"2.1"}),chart:Lyte.registeredMixins.gamescope_rule.xhrObject(y,"chart",p,"trend",void 0,t,b,l)};return u.length>1&&$L.extend(D,{users:store.findAll("user",{ids:u,type:"ActiveConfirmedUsers"})}),Lyte.resolvePromises(D).then((function(e){var t=Lyte.registeredMixins.gamescope_rule.getFieldObject(e.fields),r=[];return e.users&&(r=e.users),{dashBoardId:l,moduleFields:t,ruleId:h,transitionData:i,pointAuiredData:v,dateRangeVal:b,duration:g,timeGranularity:p,appliedCriteria:_,customDateRange:w,source:"dashboard_target"===m?m:"target",comparableUsers:r,comparableTeam:d,badges:store.findAll("game_badge")}}),(function(){return Promise.reject({response:JSON.stringify({code:"QUERY_FAIL"})})}))},afterModel(e){e.comparableTargets=0!==store.peekAll("target")?JSON.parse(JSON.stringify(store.peekAll("target"))):[];var t=e.transitionData.people;t&&"org"!==t.type?(e.isUserDiisabled=!1,e.isTargetDisabled=!0):(e.isUserDiisabled=!0,e.isTargetDisabled=!1),this.currentModel=e},renderTemplate:function(){return{outlet:"#gs_outlet",component:"gamescope-rule-dashboard-details"}},actions:{onError:function(e){var t=$L("#gs_outlet")[0],r=JSON.parse(e.response);return"NO_PERMISSION"===r.code&&"Gamification is not enabled"===r.message?$("#basic").html('<div class="aIC dF fDC h100vh jCC"> <p class="crm-font-regular redText f24">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="col5 mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>"):"NO_MODULE_PERMISSION"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"permissiondeniedformodule"},"#gs_outlet")):"NO_TARGET_FOUND"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{recordName:I18n.getMsg("gs.target")},"#gs_outlet")):"INVALID_PARAM"===r.code||"INVALID_USER_ID"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{message:I18n.getMsg("gs.incorrect.url"),type:"invalidurl"},"#gs_outlet")):(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"commonerror"},"#gs_outlet")),commonUtils.showHideLoadingDiv(!1),!1}}},{mixins:["gamescope_target"]}),Lyte.Router.registerRoute("crm.gamification.targets.index",{getResources:function(){return networkUtils.returnDependencyFiles(["gamescope-target-comp.js"],crmConstants.jsStaticPathForLyte)},model:function(){var e=(0!==store.peekAll("game_rule").length?Promise.resolve(store.peekAll("game_rule")):store.findAll("game_rule",{include:"point_computation"})).then((function(){return Lyte.registeredMixins.gamescope_rule.requestAnalyticsAPIXHR()}));return{targets:store.findAll("target"),teams:0!==store.peekAll("game_team").length?Promise.resolve(store.peekAll("game_team")):store.findAll("game_team"),rules:e,pointAqurired:store.findAll("points_acquired"),badges:store.findAll("game_badge")}},beforeModel:function(){store.unloadAll("points_acquired"),store.unloadAll("target")},afterModel:function(e){var t=this.transition.data;t.prevSelectedTargetId?e.prevSelectedTargetId=t.prevSelectedTargetId:e.prevSelectedTargetId=t.selectedRuleId,void 0===this.currentModel.targets&&(this.currentModel.targets=[])},renderTemplate:function(){return{outlet:"#gs_outlet",component:this.action.getRenderComponent(),reRender:!0}},action:{getRenderComponent:function(){return store.peekAll("target").length>0?"gamescope-target-dashboard":"gamescope-target"},onError:function(e){return"NO_PERMISSION"===JSON.parse(e.response).code&&(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aIC dF fDC h100vh jCC"> <p class="crm-font-regular redText f24">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="col5 mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")),!1}}}),Lyte.Router.registerRoute("crm.gamification.targets.list",{getResources:function(){var e=networkUtils.returnDependencyFiles(["gamescope-target-list.js","gamescope-about-target.js","gamescope-about-kpi.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["gamescope-target-list.css"],crmConstants.cssStaticPathForLyte))},beforeModel:function(){store.unloadAll("target"),store.findAll("points_acquired")},model:function(){return Lyte.resolvePromises({targets:store.findAll("target"),badges:store.findAll("game_badge")})},afterModel:function(e){e.ruleOptions=Lyte.registeredMixins.gamescope_list_filter_options.getRuleOptionsForTarget(),e.userOptions=Lyte.registeredMixins.gamescope_list_filter_options.getUserOptionsForTarget(),e.durationOptions=Lyte.registeredMixins.gamescope_list_filter_options.getDurationOptionsForTarget(),this.currentModel=e},renderTemplate:function(e){return Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM?{outlet:"#gs_outlet",component:this.action.getRenderComponent()}:(e.type="permissiondenied",{outlet:"#gs_outlet",component:"gamescope-record-deleted"})},action:{getRenderComponent:function(){return store.peekAll("target").length>0?"gamescope-target-list":"gamescope-target"},onError:function(e){return"NO_PERMISSION"===JSON.parse(e.response).code&&(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aIC dF fDC h100vh jCC"> <p class="crm-font-regular redText f24">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="col5 mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")),!1}}}),Lyte.Router.registerRoute("crm.gamification.tvchannel.index",{beforeModel:function(){store.unloadAll("tv_channels"),store.unloadAll("tv_channels_count");var e=Lyte.registeredMixins.gamescope_config.getGamescopeFeatureLimits("TvChannel");if(!e||0===e)return Promise.reject({response:JSON.stringify({code:"NO_ACCESS"})})},model:function(){var e=store.findAll("tv_channels"),t=store.findAll("tv_channels_count");return Lyte.resolvePromises({tv_channels:e,tv_channels_count:t}).then((function(e){for(var t=void 0!==e.tv_channels?e.tv_channels.length:0,r=0;r<t;r++)store.peekRecord("tv_channels_count",e.tv_channels[r].id)&&(e.tv_channels[r].components_count=store.peekRecord("tv_channels_count",e.tv_channels[r].id).components_count);return e}))},afterModel:function(e){e.tvchannels=Lyte.registeredMixins.gamescope_list_filter_options.getAllTvchannel(),e.usersOptions=Lyte.registeredMixins.gamescope_list_filter_options.getUserOptionsForTvchannel();var t=this.transition.data;t&&(e.selectedUser=t.selectedUser?t.selectedUser:"000"),this.currentModel=e},renderTemplate:function(){return{outlet:"#gs_outlet",component:"gamescope-tvchannel-list"}},afterRender:function(){$L("#gs_nav_tv").attr("selected",!0)},actions:{onError:function(e){var t=$L("#gs_outlet")[0],r=JSON.parse(e.response);return"NO_PERMISSION"===r.code?(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aIC dF fDC h100vh jCC"> <p class="crm-font-regular redText f24">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="col5 mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")):"NO_ACCESS"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"lowFeaturePermissionOnly"},"#gs_outlet")):(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"commonerror"},"#gs_outlet")),!1}}}),Lyte.Router.registerRoute("crm.gamification.tvchannel.live",{queryParams:["id"],beforeModel:function(e){var t=e.queryParams.id,r=Lyte.registeredMixins.gamescope_config.getGamescopeFeatureLimits("TvChannel");return r&&0!==r?!t||t&&0===t?Promise.reject({response:JSON.stringify({code:"INCORRECT_URL"})}):t?store.findRecord("tv_channels",t).then((e=>e&&0===Object.keys(e).length?Promise.reject({response:JSON.stringify({code:"RESOURCE_NOT_FOUND"})}):e?void 0:Promise.reject({response:JSON.stringify({code:"RESOURCE_NOT_FOUND"})}))):void 0:Promise.reject({response:JSON.stringify({code:"NO_ACCESS"})})},model:function(e){var t=e.queryParams.id;return Lyte.registeredMixins.gamescope_tvchannel.getTvComponentsLiveData(t).then((function(e){var r=store.peekRecord("tv_channels",t);return r&&r.transition_time_in_sec&&(e.slideDuration=1e3*r.transition_time_in_sec),e.showPreviewComp=!0,e.activeIndex=0,e.noOfSlides=e.tvSlides.length,e.isFromListView=!0,e.showPreview=!0,e.autoPlay=!0,e}),(function(){return Lyte.Component.registeredHelpers.gameLog("Sever error on live route"),Promise.reject({response:JSON.stringify({code:"SOMETHING_WENT_WRONG"})})}))},renderTemplate:function(){return{outlet:"#gs_outlet",component:"gamescope-tvchannel-preview"}},actions:{onError:function(e){var t=$L("#gs_outlet")[0],r=JSON.parse(e.response);return"NO_PERMISSION"===r.code?(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aIC dF fDC h100vh jCC"> <p class="crm-font-regular redText f24">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="col5 mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")):"INCORRECT_URL"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{message:I18n.getMsg("gs.incorrect.url"),type:"invalidurl"},"#gs_outlet")):"NO_ACCESS"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"lowFeaturePermissionOnly"},"#gs_outlet")):"RESOURCE_NOT_FOUND"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{recordName:I18n.getMsg("gs.tv")},"#gs_outlet")):(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"commonerror"},"#gs_outlet")),!1}}}),Lyte.Router.registerRoute("crm.gamification.tvchannel.slides",{queryParams:["id"],getResources:function(){return networkUtils.returnDependencyFiles(["gamescope-about-kpi.js","gamescope-about-target.js","gamescope-about-game.js","gamescope-allkpi-table.js"],crmConstants.jsStaticPathForLyte)},beforeModel:function(e){var t=e.queryParams.id;store.unloadAll("tv_channel_components");var r=Lyte.registeredMixins.gamescope_config.isgsFeatureLimitExceed("TvChannel"),i=Lyte.registeredMixins.gamescope_config.getGamescopeFeatureLimits("TvChannel");return i&&0!==i?t?store.findRecord("tv_channels",t).then((e=>e&&0===Object.keys(e).length?Promise.reject({response:JSON.stringify({code:"RESOURCE_NOT_FOUND"})}):e?e&&0===Object.keys(e).length&&r?Promise.reject({response:JSON.stringify({code:"LIMIT_EXCEED"})}):void 0:Promise.reject({response:JSON.stringify({code:"RESOURCE_NOT_FOUND"})}))):r?Promise.reject({response:JSON.stringify({code:"LIMIT_EXCEED"})}):void 0:Promise.reject({response:JSON.stringify({code:"NO_ACCESS"})})},model:function(e){var t=e.queryParams.id;if(void 0!==t){var r=Promise.resolve(store.peekRecord("tv_channels",t)),i=Lyte.registeredMixins.gamescope_tvchannel.getComponentsWithGameConfig(t,"tvchannel"),a=store.findAll("target"),s=store.findAll("points_acquired"),o=store.findAll("game_rule"),n=store.findAll("game_team");return Lyte.resolvePromises({tv_channel:r,target_data:a,points_data:s,rules:o,analyticsId:t,tv_channel_components:i,teams:n,badges:store.findAll("game_badge")}).then((function(e){return e.tv_channel_components=Lyte.registeredMixins.gamescope_tvchannel.combineComponents(JSON.parse(JSON.stringify(e.tv_channel_components))),e.tv_channel_components&&0!==e.tv_channel_components.length&&(e.showNextButton=!1),e.isEdit=!!store.peekRecord("tv_channels",t),e}))}},renderTemplate:function(){return{outlet:"#gs_outlet",component:"gamescope-create-tvslides"}},actions:{onError:function(e){var t=$L("#gs_outlet")[0],r=JSON.parse(e.response);"NO_PERMISSION"===r.code?(commonUtils.showHideLoadingDiv(!1),$("#basic").html('<div class="aIC dF fDC h100vh jCC"> <p class="crm-font-regular redText f24">'+I18n.getMsg("gs.salesmotivator.disabletitle")+' </p> <p class="col5 mT40">'+I18n.getMsg("gs.salesmotivator.disablecontent")+"</p> </div>")):"LIMIT_EXCEED"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"limitExceed"},"#gs_outlet")):"NO_ACCESS"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"lowFeaturePermissionOnly"},"#gs_outlet")):"RESOURCE_NOT_FOUND"===r.code?(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{recordName:I18n.getMsg("gs.tv")},"#gs_outlet")):(t.innerHTML="",Lyte.Component.render("gamescope-record-deleted",{type:"commonerror"},"#gs_outlet"))}}}),Lyte.Router.registerRoute("crm-print",{}),Lyte.Router.registerRoute("crm-print.export-pdf",{}),Lyte.Router.registerRoute("crm-print.send-mail",{}),store.registerModel("organization",{id:Lyte.attr("string",{primaryKey:"true"}),domain_name:Lyte.attr("string"),default:Lyte.attr("string"),web_url:Lyte.attr("string"),api_url:Lyte.attr("string"),name:Lyte.attr("string"),type:Lyte.attr("string"),created_time:Lyte.attr("string"),created_by:Lyte.attr("object"),company_logo_id:Lyte.attr("string"),parent_org:Lyte.attr("string")}),store.registerAdapter("organization",{buildURL:function(e,t,r,i,a){return a=a.replace(e,e+"s"),"updateRecord"===t&&(a=a.replace("organizations","__internal/organizations")),a},methodForRequest:function(e){return"PATCH"==e?"PUT":e}}).extends("application"),store.registerSerializer("organization",{payloadKey:function(e){return e+"s"},normalize:function(e,t,r){return"organization"===e&&r&&(r.web_url&&r.web_url.length>0&&(r.web_url+="/tab/Home/begin?ref=manage_organizations"),r.parent_org&&r.parent_org.web_url&&r.parent_org.web_url.length>0&&(r.parent_org.web_url+="/tab/Home/begin?ref=manage_organizations")),r}}),store.registerModel("campaign_status",{id:Lyte.attr("string"),name:Lyte.attr("string"),sequence_number:Lyte.attr("number")}),store.registerAdapter("campaign_status",{buildURL:function(e,t,r,i,a){return a=a.replace("campaign_status","Campaigns/status")}}),store.registerSerializer("campaign_status",{payloadKey:function(e){return e}}),store.registerModel("module",{api_name:Lyte.attr("string"),api_supported:Lyte.attr("boolean"),business_card_field_limit:Lyte.attr("number"),business_card_fields:Lyte.attr("array"),custom_view:Lyte.attr("object"),convertable:Lyte.attr("boolean"),default_view:Lyte.attr("object"),deletable:Lyte.attr("boolean"),display_field:Lyte.attr("object"),editable:Lyte.attr("boolean"),fields:Lyte.hasMany("field",{deserialize:"record"}),filter_supported:Lyte.attr("boolean"),filter_status:Lyte.attr("boolean"),generated_type:Lyte.attr("string"),global_search_supported:Lyte.attr("boolean"),id:Lyte.attr("string"),layouts:Lyte.hasMany("layout"),kanban_view:Lyte.attr("boolean"),kanban_feature_status:Lyte.attr("boolean"),kanban_view_supported:Lyte.attr("boolean"),lookup_field_properties:Lyte.attr("object"),modified_by:Lyte.attr("object"),lookup_field_properties:Lyte.attr("object"),modified_time:Lyte.attr("string"),module_name:Lyte.attr("string"),plural_label:Lyte.attr("string"),profiles:Lyte.attr("array"),prediction:Lyte.attr("boolean"),related_list_properties:Lyte.attr("array"),related_lists:Lyte.hasMany("related_list",{inverse:"relatedListModule"}),scoring_supported:Lyte.attr("boolean"),search_layout_fields:Lyte.attr("array"),cpq_search_layout_fields:Lyte.attr("array"),sequence_number:Lyte.attr("number"),singular_label:Lyte.attr("string"),stage_view:Lyte.attr("boolean"),viewable:Lyte.attr("boolean"),visible:Lyte.attr("boolean"),viewid:Lyte.attr("string"),per_page:Lyte.attr("number"),web_link:Lyte.attr("string"),territory:Lyte.attr("object"),parent_module:Lyte.belongsTo("module"),child_module:Lyte.hasMany("module",{inverse:"parent_module"}),vision_module:Lyte.hasMany("visions",{serialize:null}),auto_enrichment:Lyte.belongsTo("auto_enrichment"),module:Lyte.hasMany("prediction",{serialize:null}),wizard:Lyte.hasMany("wizard"),filterable:Lyte.attr("boolean"),didLoad:function(e){var t=(e=this instanceof Record?this:e).id,r=e.module_name;"Deals"==r&&(e.module_name="Potentials"),"Meetings"==r&&(e.module_name="Events");var i={},a=e.fields;if(i.id=Lyte.attr("string"),a&&a.length)if(store.model[t]){n=a.length;var s=store.model[t];if(s){for(l=0;l<n;l++)if(s.fieldList[a[l].api_name]&&s.fieldList[a[l].api_name].fieldType)s.fieldList[a[l].api_name].length=a[l].length;else if("subform"!==a[l].data_type){var o={};o.type=Lyte.registeredMixins["crm-module-mixin"].getfieldattributeType(a[l]),o.fieldID=a[l].id,o.uiType=a[l].ui_type,o.columnName=a[l].column_name,o.fieldType=a[l].data_type,o.length=a[l].length,store.addField(t,a[l].api_name,o.type,o)}else{if(store.addField(t,a[l].api_name,Lyte.hasMany(a[l].subform.id,{serialize:"record"})),!store.model[a[l].subform.id])(c={}).__parent_module__=Lyte.belongsTo(e.id),store.registerModel(a[l].subform.id,c,{extends:"entity"});e.currsubformApinames||(e.currsubformApinames=[]),e.currsubformApinames.contains(a[l].api_name)||e.currsubformApinames.push(a[l].api_name)}s.fieldList.$state||store.addField(t,"$state","string"),s.fieldList.$wizard_connection_path||store.addField(t,"$wizard_connection_path","array"),s.fieldList.$transitionid||store.addField(t,"$transitionid","string")}}else{for(var n=a.length,l=0;l<n;l++)if("subform"!==a[l].data_type)i[a[l].api_name]=Lyte.attr(Lyte.registeredMixins["crm-module-mixin"].getfieldattributeType(a[l])),i[a[l].api_name].fieldID=a[l].id,i[a[l].api_name].uiType=a[l].ui_type,i[a[l].api_name].columnName=a[l].column_name,i[a[l].api_name].fieldType=a[l].data_type,i[a[l].api_name].length=a[l].length;else{var c;if(i[a[l].api_name]=Lyte.hasMany(a[l].subform.id,{serialize:"record"}),!store.model[a[l].subform.id])(c={}).__parent_module__=Lyte.belongsTo(t),store.registerModel(a[l].subform.id,c,{extends:"entity"});e.currsubformApinames||(e.currsubformApinames=[]),e.currsubformApinames.contains(a[l].api_name)||e.currsubformApinames.push(a[l].api_name)}i.$state=Lyte.attr("string"),i.$wizard_connection_path=Lyte.attr("array"),i.$transitionid=Lyte.attr("string"),store.registerModel(t,i,{extends:"entity"})}validationUtils.isNotEmpty(e.layouts)&&e.layouts.length&&e.layouts.forEach((function(e){(e.status>=0||"active"===e.status)&&e.sections&&e.sections.length&&Lyte.registeredMixins["crm-module-mixin"].addSubformFieldsintoLyteModel(e.sections)})),e.custom_view&&!e.custom_view.module&&(Lyte.isRecord(e)?e.custom_view.module=e.$.toJSON():e.custom_view.module=e),r&&(moduleRecordMapping[r]=e,idModuleMapping[t]=r,moduleApiMapping[r]=e.api_name)}.on("add")},{actions:{mass_delete:{},mass_update:{},mass_change_owner:{},change_owner:{},single_record_delete:{},get_automated_configured_features:{},associations:{},owner_config_state:{},run_scoring_rules:{},searchRecordsByName:{},contact_role:{},survey_departments:{},survey_templates:{}}}),store.registerAdapter("module",{namespace:"crm/v2.2/settings",buildURL:function(e,t,r,i,a,s,o){if("searchRecordsByName"===s)return a=a.slice(0,a.indexOf("/",8))+o.url;if(a=this.$super.buildURL(e,t,r,i,a,s,o),"action"===t)switch(s){case"survey_departments":case"survey_templates":return a=a.replace("/v2.2/settings/modules/","/v2.2/Campaigns/");case"contact_role":return a=a.replace("settings/modules/actions/contact_role",o.module+"/roles");case"run_scoring_rules":return a=a.replace("settings/modules/"+i.id,i.api_name);case"single_record_delete":var n=a.split("/")[a.split("/").length-3];return a=a.replace("settings/modules/"+n+"/actions/single_record_delete",o.module+"/"+o.id);default:n=(a=a.replace("settings/modules/","")).split("/")[a.split("/").length-3];var l=moduleApiMapping[idModuleMapping[n]];return a=a.replace(n,l)}if("findAll"!==t){n=a.substring(a.lastIndexOf("/")+1),l=idModuleMapping[n];a=a.replace(n,moduleRecordMapping[l].api_name)}return r||(r={}),"findRecord"!=t||r.include||(r.include=["$properties","$on_demand_properties","layouts","custom_view","mass_action_cv","show_social","show_webform","show_visitor","show_googlesync","show_emailparser","show_phonebridge","show_salessignals","show_emailsettings","show_dashboard","default_view","per_page","filter_status","kanban_view","kanban_view_supported","stage_view","customized_view","show_zf_panel","task_completed_rule_configured","new_call_view","zb_custommodule_enabled","group_by_field_available","kanban_feature_status","kanban_view_fields","module_mlabel","module_nlabel","zia_view","territory","related_lists","related_list_properties","business_card_fields","search_layout_fields","cpq_search_layout_fields","lookup_field_properties"]),r.include&&(r.include=r.include.toString()),o&&"2"===o.apiVersion&&(a=a.replace("crm/v2.1/settings","crm/v2/settings")),a},methodForRequest:function(e,t,r,i,a){return"PATCH"===e||"run_scoring_rules"===a?"PUT":"contact_role"===a&&"POST"===e?"GET":"single_record_delete"===a?"DELETE":("action"===t&&(e=i&&i.type?i.type:e),e)},processRequest:function(e,t,r,i,a,s,o){if("findRecord"==e){if(a&&1==a.getMeta)return;var n=this,l=store.peekRecord("module",o).module_name;return a&&(1==a.getFields||a.layoutId)?this.fetchFields(l,a).then((function(e){n.deleteXHR(l);var t=[];return t[0]=e,JSON.stringify({modules:t})})):Lyte.resolvePromises({module:store.findRecord("module",o,s,void 0,!0,{getMeta:!0}),fields:n.fetchFields(store.peekRecord("module",o).module_name,a)}).then((function(e){return n.deleteXHR(l),e.module[0]=e.module[0].$.toJSON(),JSON.stringify({modules:e.module})}))}},fetchFields:function(e,t){var r="";t&&t.layoutId?(r="&layoutId="+t.layoutId,t.mode&&(r+="&mode="+t.mode)):r="&getField=true",t&&t.getExternalFields&&(r+="&include_external_fields=true");var i=this;return new Promise((function(a,s){var o=i.getXHR(e,t),n=Crm.getCrmBasePath()+"/ModuleCache.do",l=window.clientPortalName?Crm.getPortalURL(n):n;o.open("GET",l+"?module="+e+r);var c=store.adapter.application.headersForRequest();for(var d in c)o.setRequestHeader(d,c[d]);o.onload=function(){if(this.status>=200&&this.status<300){var e=o.response?Object.assign({},JSON.parse(o.response)):{},r=store.serializer.module.normalize("module","findRecord",e,t);if(t&&t.layoutId){var i=store.peekRecord("module",r.id);if(i.layouts){var n=i.layouts.mapBy("id");n.removeLastOccurenceOfElement(t.layoutId),r.layouts=r.layouts.concat(n)}}store.pushPayload("module",[r]),a(e)}else s({status:this.status,statusText:o.statusText})},o.onerror=function(){s({status:this.status,statusText:o.statusText})},o.send()}))},getXHR:function(e,t){if(this.xhr[e]){if(t&&t.allowMultiple)return new XMLHttpRequest}else this.xhr[e]=new XMLHttpRequest;return this.xhr[e]},xhr:{},deleteXHR:function(e){delete this.xhr[e]}}).extends("application"),store.registerSerializer("module",{serialize:function(e,t,r,i,a,s,o){if("run_scoring_rules"===o)return{scoring_rules:i.rules};if("searchRecordsByName"===o||"change_owner"===o&&i.bulkChange)return t;if("mass_update"===o||"mass_delete"===o||"mass_change_owner"===o)return t=new FormData,i&&i.ids&&t.append("ids",i.ids),i;if("change_owner"===o||"get_automated_configured_features"===o||"associations"===o||"owner_config_state"===o)return null;if("action"===e||"action"===e&&i&&"contact_role"===i.action)return t;var n=t.modules.id,l=store.peekRecord("module",n);return t.modules.api_name=l.api_name,"updateRecord"==e&&t.modules.custom_view&&(t.modules.custom_view={id:t.modules.custom_view.id}),t.modules=[t.modules],t},serializeKey:function(e){return e+"s"},normalizeResponse:function(e,t,r,i,a){if("updateRecord"==t&&200==a&&(r.modules={id:i}),!window.clientPortalName){var s={},o={ZohoCPQ:-1,Quotes:-1,SalesOrders:-1,PurchaseOrders:-1,Invoices:-1,Products:-1,Bundles:-1,PriceBooks:-1};switch(t){case"findRecord":moduleRecordMapping&&moduleRecordMapping.ZohoCPQ&&o.hasOwnProperty(r.modules[0].module_name)&&(s.api_name=moduleRecordMapping.ZohoCPQ.api_name,s.id=moduleRecordMapping.ZohoCPQ.id,r.modules[0].parent_module=s);break;case"pushPayload":case"findAll":for(var n=(r="findAll"===t?r.modules:r)instanceof Array?r.length:0,l=0;l<n;l++)o.hasOwnProperty(r[l].module_name)&&(o[r[l].module_name]=l);-1!==o.ZohoCPQ&&(s.api_name=r[o.ZohoCPQ].api_name,s.id=r[o.ZohoCPQ].id,-1!==o.Quotes&&(r[o.Quotes].parent_module=s),-1!==o.SalesOrders&&(r[o.SalesOrders].parent_module=s),-1!==o.PurchaseOrders&&(r[o.PurchaseOrders].parent_module=s),-1!==o.Invoices&&(r[o.Invoices].parent_module=s),-1!==o.Products&&(r[o.Products].parent_module=s),-1!==o.Bundles&&(r[o.Bundles].parent_module=s),-1!==o.PriceBooks&&(r[o.PriceBooks].parent_module=s)),r="findAll"===t?{modules:r}:r}}return"pushPayload"===t?{modules:r}:r},normalize:function(e,t,r,i){var a=r.module_name;if("findAll"!=t&&"findRecord"!=t||"Calls"!=a&&"Events"!=a&&"Tasks"!=a||Crm.isActivitySplitDone||delete r.custom_view,("findAll"==t||"findRecord"==t)&&r.layouts)for(var s=r.layouts.length,o=[-3,-4],n=0;n<s;n++)-1===o.indexOf(r.layouts[n].status)?(r.id&&(r.layouts[n].module={id:r.id}),this.setProperty(r.layouts[n],i)):(store.unloadRecord("layout",r.layouts[n].id),r.layouts.splice(n,1),n--,s--);return r}},{mixins:["crm-module-mixin"]}),store.registerModel("profile",{id:Lyte.attr("string"),display_label:Lyte.attr("string",{mandatory:!0,validation:"checkSpecialChar"}),name:Lyte.attr("string"),created_by:Lyte.belongsTo("user",{inverse:"createdByProfile"}),modified_by:Lyte.belongsTo("user",{inverse:"modifiedByProfile"}),modified_time:Lyte.attr("user-view-date-time"),created_time:Lyte.attr("user-view-date-time"),description:Lyte.attr("string"),category:Lyte.attr("boolean"),users:Lyte.hasMany("user",{inverse:"profile"}),wizard:Lyte.hasMany("wizard"),permissions_details:Lyte.hasMany("profile-permission",{serialize:"partial",deepNest:!0}),sections:Lyte.attr("array")},{actions:{validate_inventory_dependency:{}}}),Lyte.registerValidator("checkSpecialChar",(function(e,t){var r=t.replace(/[^~`#%^&*()+|,={};<>[\]\"\\]/g,"").split("");if(r=eliminateDuplicates(r),""==t.trim())return{message:I18n.getMsg("crm.field.none.check",I18n.getMsg("crm.security.profile.name"))};if(0===r.length)return!0;var i=I18n.getMsg("crm.security.profile.name");return{message:1===r.length?I18n.getMsg("crm.clearTextPattern.validationFail.alert",[i,r.join(" ")]):I18n.getMsg("crm.clearTextPattern.validationFail.alert.moreThanOneChar",[i,r.join(" ")])}})),store.registerAdapter("profile",{namespace:"crm/v2.2/settings",buildURL:function(e,t,r,i,a,s,o){return a=a.replace("profile","profiles"),Crm.isActivitySplitDone&&"findRecord"===t&&(a=a.replace("/v2.2","/v3")),"create"!==t&&"createRecord"!==t||(a=a.replace("profiles","profiles/"+o.cloned_id+"/actions/clone")),"deleteRecord"===t&&o&&o.transfer_to&&(r.transfer_to=o.transfer_to),a},reloadAll:function(e,t){return!t||!t.cache},methodForRequest:function(e,t,r,i,a){return"validate_inventory_dependency"==a?"GET":e}}),store.registerSerializer("profile",{normalizeResponse:function(e,t,r){return"create"===t||"createRecord"===t?{profiles:r.profiles[0].details}:"updateRecord"===t||"deleteRecord"===t?{}:("findRecord"===t&&(r.profiles=r.profiles?r.profiles[0]:r.profiles),r)},serialize:function(e,t){if(t){if(t.profiles=t.profile,delete t.profile,"updateRecord"===e||"createRecord"===e){var r=store.peekRecord("profile",t.profiles.id);"updateRecord"!==e||r.custom||"lite_profile"===r.type?"updateRecord"===e&&"lite_profile"===r.type&&this.checkLitePermissions(t.profiles):this.checkAdminPermissions(t.profiles),t.profiles=[t.profiles]}return t}},checkLitePermissions:function(e){var t=e.permissions_details.length,r=0;for(r=0;r<t;r++)store.peekRecord("profile-permission",e.permissions_details[r].id).customizable||(e.permissions_details.splice(r,1),r-=1,t-=1)},checkAdminPermissions:function(e){var t,r,i=e.permissions_details.length,a=0,s=!1;for(a=0;a<i;a++)s=!1,r=(t=store.peekRecord("profile-permission",e.permissions_details[a].id)).name.replace("Crm_Implied_",""),(t.module&&"Google_AdWords"==t.module.api_name||-1!=["View_ZInventory_Packages","View_ZSM_Subscriptions","Schedule_Reports","Manage_Reports","Manage_Docs_Folder","Manage_Dashboards","Reply_Messages"].indexOf(r))&&(s=!0),(r=r.split("_")).pop(),r=r.join("_"),-1!==["View","Create","Edit","Delete","Autolog","View_Invoice","Create_Invoice","Email_Invoice"].indexOf(r)&&(s=!0),s||(e.permissions_details.splice(a,1),a-=1,i-=1)}}),store.registerModel("profile-permission",{id:Lyte.attr("string"),display_label:Lyte.attr("string"),enabled:Lyte.attr("boolean"),module:Lyte.attr("object"),name:Lyte.attr("string"),profile:Lyte.hasMany("profile")}),store.registerModel("layout",{created_by:Lyte.attr("string"),id:Lyte.attr("string"),modified_by:Lyte.attr("string"),modified_time:Lyte.attr("string"),name:Lyte.attr("string"),status:Lyte.attr("number"),created_time:Lyte.attr("string"),sections:Lyte.hasMany("section"),module:Lyte.belongsTo("module"),fields:Lyte.hasMany("field"),parent_layout:Lyte.attr("string"),container:Lyte.belongsTo("wizard-container"),layout_rule:Lyte.hasMany("layout_rule"),validation_rule:Lyte.hasMany("validation_rule"),didLoad:function(e){(e=this instanceof Record?this:e).display_label&&(e.name=e.display_label),Lyte.registeredMixins["crm-module-mixin"].addSubformFieldsintoLyteModel(e.sections)}.on("add")},{actions:{associated:{},convert_mapping:{}}}),store.registerAdapter("layout",{namespace:"crm/v2.1/settings",headersForRequest:function(e,t,r){var i={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};return window.clientPortalName&&(i["X-CRMPORTAL"]=window.clientPortalName),"undefined"!=typeof crmZgid&&crmZgid&&(i["X-CRM-ORG"]=crmZgid),r&&r.clientPortalSettings&&(i["X-ZOHO-SERVICE"]="crm/client_portal"),i},buildURL:function(e,t,r,i,a,s,o){if(a=a.replace(e,e+"s"),"associated"===s||o&&o.applyLayoutId){var n=a.split("layouts");a=n.join("layouts/"+o.layout_id)}else"convert_mapping"==s&&(a=a.replace("/actions",""));return o&&"2.2"===o.apiVersion&&(a=(a=a.replace("crm/v2/settings","crm/v2.2/settings")).replace("crm/v2.1/settings","crm/v2.2/settings")),a},methodForRequest:function(e,t,r,i,a){return"associated"==a?"GET":"convert_mapping"==a?"PUT":e}}),store.registerSerializer("layout",{serialize:function(e,t,r,i,a,s,o){return"convert_mapping"==o?{convert_mapping:i.convert_mapping}:t},normalize:function(e,t,r,i){return"findAll"!=t&&"findRecord"!=t||!r||this.setProperty(r,i),r},normalizeResponse:function(e,t,r,i,a,s,o,n){var l;try{l=moduleRecordMapping[function(e,t){for(var r=e.length,i=0;i<r;i++)if(t(e[i]))return e[i]}(Object.keys(moduleApiMapping),(function(e){return"Potentials"===e?"Potentials"===o.module:moduleApiMapping[e]===o.module}))].id}catch(e){if(n&&n.clientPortalSettings&&"Cannot read property 'id' of undefined"===e.message)throw crmui.showMsgBand("error",I18n.getMsg("portal.apiname.change.error",crmBasePath+"/settings/client-portal"),1e4),e;l=o.module}if("findAll"===t||"findRecord"===t)for(var c=r.layouts.length,d=["hidden","downgraded"],u=0;u<c;u++)-1===d.indexOf(r.layouts[u].status)?r.layouts[u].module={id:l}:(store.unloadRecord("layout",r.layouts[u].id),r.layouts.splice(u,1),u--,c--);return r}},{mixins:["crm-module-mixin"]}),store.registerModel("section",{id:Lyte.attr("string"),column_count:Lyte.attr("number"),display_label:Lyte.attr("string"),name:Lyte.attr("string"),sequence_number:Lyte.attr("number"),fields:Lyte.hasMany("field"),layout:Lyte.belongsTo("layout")}),store.registerModel("field",{id:Lyte.attr("string"),api_name:Lyte.attr("string"),column_name:Lyte.attr("string"),custom_field:Lyte.attr("boolean"),data_type:Lyte.attr("string"),decimal_place:Lyte.attr("string"),field_label:Lyte.attr("string"),length:Lyte.attr("number"),read_only:Lyte.attr("boolean"),show_type:Lyte.attr("number"),ui_type:Lyte.attr("number"),show_type:Lyte.attr("number"),visible:Lyte.attr("boolean"),field_read_only:Lyte.attr("boolean"),default_value:Lyte.attr("string"),required:Lyte.attr("boolean"),system_mandatory:Lyte.attr("boolean"),sequence_number:Lyte.attr("number"),private:Lyte.attr("object"),currency:Lyte.attr("object"),lookup:Lyte.attr("object"),module:Lyte.hasMany("module",{inverse:"fields"}),conversion_mapping:Lyte.attr("object"),layouts:Lyte.hasMany("layout"),custom_view:Lyte.belongsTo("custom_view"),dynamic_field_label:Lyte.attr("string"),vision_fields:Lyte.hasMany("visions",{serialize:null}),section:Lyte.hasMany("section",{inverse:"fields"}),formula:Lyte.attr("object"),pick_list_values:Lyte.attr("array"),conditional_actions:Lyte.hasMany("wizard-conditional-action"),mass_update:Lyte.attr("boolean"),field_read_only:Lyte.attr("boolean"),pick_list_values:Lyte.attr("array"),allowed_modules:Lyte.hasMany("module"),subform_api:Lyte.attr("boolean"),separator:Lyte.attr("boolean"),field_contributors:Lyte.hasMany("prediction",{serialize:null}),prediction_field:Lyte.hasMany("prediction",{serialize:null}),predict_field:Lyte.hasMany("prediction",{serialize:null}),segment:Lyte.hasMany("wizard-segment",{inverse:"fields"}),wizsegment:Lyte.hasMany("wizard-segment",{inverse:"fieldsClone"}),score_to:Lyte.hasMany("prediction",{serialize:null}),auto_enrichment:Lyte.belongsTo("auto_enrichment"),colour_code_enabled:Lyte.attr("boolean"),picklist_colour_codes:Lyte.hasMany("user_picklist_colour_code")},{actions:{associated:{}}}),store.registerAdapter("field",{namespace:"crm/v2/settings",buildURL:function(e,t,r,i,a,s,o){return a=this.$super.buildURL(e,t,r,i,a,s,o),!o||"2.1"!==o.apiVersion&&"2.2"!==o.apiVersion||(a=a.replace("crm/v2/settings","crm/v"+o.apiVersion+"/settings")),o&&"2.2"===o.apiVersion&&(a=a.replace("crm/v2/settings","crm/v2.2/settings")),"lookup.query_details.criteria"===r.include_inner_details&&(a=a.replace("crm/v2/settings","crm/v2.2/settings")),a},methodForRequest:function(e,t,r,i,a){return"associated"==a?"GET":e}}).extends("application"),store.registerSerializer("field",{serializeKey:function(e){return e+"s"},serialize:function(e,t,r,i,a,s,o){return"associated"!==o&&"create"!==e&&(t.fields=[t.fields]),t},normalizeResponse:function(e,t,r,i,a,s,o){var n=store.peekAll("module").filterBy({api_name:o.module});return r&&r.fields&&o.module&&n.length>0&&r.fields.forEach((function(e){e.module=[],e.module[0]=n[0]&&n[0].id?n[0].id:"","create"!=t&&e.api_name.indexOf(".")>-1&&e.api_name.replace(".","__")})),r}}),store.registerModel("user_picklist_colour_code",{colour_code:Lyte.attr("string"),field:Lyte.belongsTo("field")},{actions:{reset:{}}}),store.registerAdapter("user_picklist_colour_code",{namespace:"crm/v2.2/settings",buildURL:function(e,t,r,i,a){return a=a.replace(e,"picklist_colour_codes")},methodForRequest:function(e,t,r,i,a){return"PATCH"===e?"PUT":"reset"===a?"POST":e}}),store.registerSerializer("user_picklist_colour_code",{payloadKey:function(){return"picklist_colour_codes"},serialize:function(e,t){if(t){var r={};return r.picklist_colour_codes=t.user_picklist_colour_code,r}return t},normalizeResponse:function(e,t,r){return"update"===t&&r&&r.picklist_colour_codes&&r.picklist_colour_codes.forEach((function(e,t){r.picklist_colour_codes[t].id=e.details.id})),r}}),store.registerModel("assignment_threshold",{id:Lyte.attr("string",{primaryKey:!0}),record_period:Lyte.attr("string"),module:{id:Lyte.attr("string"),api_name:Lyte.attr("string")},default_assignee:{id:Lyte.attr("string"),name:Lyte.attr("string")},exclude_criteria:Lyte.attr("object"),backlog_criteria:Lyte.attr("object"),backlog_period_count:Lyte.attr("number"),restrict_to:Lyte.hasMany("assignment_threshold_userdetails",{serialize:"record"}),latest_restrict:Lyte.attr("array"),active:Lyte.attr("boolean"),created_time:Lyte.attr("string"),created_by:{id:Lyte.attr("string"),name:Lyte.attr("string")},modified_time:Lyte.attr("string"),modified_by:{id:Lyte.attr("string"),name:Lyte.attr("string")},filters:Lyte.attr("object")}),store.registerAdapter("assignment_threshold",{namespace:"crm/v2.1/settings/automation",buildURL:function(e,t,r,i,a,s,o){return a=a.replace("assignment_threshold","assignment_thresholds"),("updateRecord"===t||"createRecord"===t||"deleteRecord"===t)&&o&&o.module&&(a+="?module="+o.module),a},methodForRequest:function(e){return"PATCH"===e?"PUT":e}},{mixins:["crm-assignment-threshold-common"]}),store.registerSerializer("assignment_threshold",{serialize:function(e,t){if("createRecord"===e){t.assignment_threshold.backlog_period_count&&(t.assignment_threshold.backlog={criteria:t.assignment_threshold.backlog_criteria,records_creation_before:{unit:t.assignment_threshold.backlog_period_count,period:"days"}}),delete t.assignment_threshold.backlog_criteria,delete t.assignment_threshold.backlog_period_count;for(var r=t.assignment_threshold.restrict_to.length?t.assignment_threshold.restrict_to.length:0,i=0;i<r;i++)delete t.assignment_threshold.restrict_to[i].pk;var a=this.getRecordPeriodName(t.assignment_threshold.record_period);t.assignment_threshold.record_period=a,delete t.assignment_threshold.id;for(i=0;i<r;i++){(s=t.assignment_threshold.restrict_to[i]).id&&(s.user={id:s.id}),delete s.id,delete s.name,delete s.email,delete s.zuid,delete s.default_assignee,"string"==typeof s.record_allow_count&&(s.record_allow_count=parseInt(s.record_allow_count)),null===s.backlog_allow_count?delete s.backlog_allow_count:"string"==typeof s.backlog_allow_count&&(""===s.backlog_allow_count.trim()?delete s.backlog_allow_count:s.backlog_allow_count=parseInt(s.backlog_allow_count)),s.type="user",delete s.record_assigned_count,delete s.backlog_count,delete s.pk}delete t.assignment_threshold.id}if("updateRecord"===e&&t.assignment_threshold){if(t.assignment_threshold.backlog_criteria&&(t.assignment_threshold.backlog_criteria._delete?(t.assignment_threshold.backlog={},t.assignment_threshold.backlog._delete=!0):t.assignment_threshold.backlog={criteria:t.assignment_threshold.backlog_criteria,records_creation_before:{unit:t.assignment_threshold.backlog_period_count,period:"days"}},delete t.assignment_threshold.backlog_criteria,delete t.assignment_threshold.backlog_period_count),t.assignment_threshold.latest_restrict&&(t.assignment_threshold.restrict_to=t.assignment_threshold.latest_restrict,delete t.assignment_threshold.latest_restrict),t.assignment_threshold.restrict_to){t.assignment_threshold||(t.assignment_threshold={});for(r=t.assignment_threshold.restrict_to?t.assignment_threshold.restrict_to.length:0,i=0;i<r;i++){var s;(s=t.assignment_threshold.restrict_to[i]).id&&(s.user={id:s.id}),delete s.id,delete s.name,delete s.email,delete s.zuid,"string"==typeof s.record_allow_count&&(s.record_allow_count=parseInt(s.record_allow_count)),"string"==typeof s.backlog_allow_count&&(s.backlog_allow_count=parseInt(s.backlog_allow_count)),s._delete&&(s._delete=null),s.type="user",delete s.record_assigned_count,delete s.backlog_count,delete s.pk,delete s.default_assignee,delete s.restriction_id}}if(t.assignment_threshold){if(t.assignment_threshold.record_period){a=t.assignment_threshold.record_period;t.assignment_threshold.record_period=this.getRecordPeriodName(a)}if(t.assignment_threshold.backlog_period){var o=t.assignment_threshold.backlog_period;o&&(t.assignment_threshold.backlog_period=o.toLowerCase())}}}return t.assignment_thresholds=[t.assignment_threshold],delete t.assignment_threshold,t},normalizeResponse:function(e,t,r,i,a,s,o,n){if(("updateRecord"===t||"createRecord"===t)&&a>=200&&a<300){r.assignment_thresholds||(r.assignment_thresholds={});var l=r.assignment_thresholds[0].details.id,c=store.peekRecord("assignment_threshold",i).restrict_to,d=[],u=c?c.length:0;(v=r.assignment_thresholds[0].backlog)&&v.criteria&&(r.assignment_thresholds[0].backlog_criteria=v.criteria,r.assignment_thresholds[0].backlog_period_count=v.records_creation_before.unit);for(var m=0;m<u;m++){var p=c[m].pk;d.push({pk:p})}r.assignment_thresholds={id:l},d.length>0&&(r.assignment_thresholds.restrict_to=d),"createRecord"===t&&this.appendThresholdModuleConfigCount(o.module,1)}if("deleteRecord"===t&&a>=200&&a<300&&this.appendThresholdModuleConfigCount(n.module,-1),("findAll"===t||"findRecord"===t)&&200===a){var g="crm.settings.section.assignment-thresholds.edit-assignment-thresholds"===Lyte.Router.getRouteInstance().transition.info.route,f=!0;"findAll"===t&&g&&(f=!1),"findAll"!==t||o.filters||o.status||(o.module?this.setThresholdModuleConfigCount(o.module,0):this.resetThresholdModuleConfigCount());var h=r&&r.assignment_thresholds?r.assignment_thresholds.length:0;for(m=0;m<h;m++){var y=r.assignment_thresholds[m].module;this.saveModuleObj(y,y.api_name),"findAll"!==t||o.filters||o.status||this.appendThresholdModuleConfigCount(y.api_name,1);var v,_=r.assignment_thresholds[m].record_period;if(_&&(r.assignment_thresholds[m].record_period=this.getRecordPeriodKey(_)),r.assignment_thresholds[m].created_time=Utils.getDateInUsrViewFormat(new Date(r.assignment_thresholds[m].created_time)),r.assignment_thresholds[m].modified_time){var b=new CrmDate(r.assignment_thresholds[m].modified_time);r.assignment_thresholds[m].modified_date=b.getDateInPattern("MMM DD, YYYY")}(v=r.assignment_thresholds[m].backlog)&&v.records_creation_before&&(r.assignment_thresholds[m].backlog_criteria=v.criteria,r.assignment_thresholds[m].backlog_period_count=v.records_creation_before.unit)}var w=[];for(m=0;m<h;m++){var C=r.assignment_thresholds[m].restrict_to;r.assignment_thresholds[m].restrict_to=C;var D=r.assignment_thresholds[m].id,L=r.assignment_thresholds[m].module.api_name,R=r.assignment_thresholds[m].restrict_to?r.assignment_thresholds[m].restrict_to.length:0;if(f)for(var P=0;P<R;P++){var I=r.assignment_thresholds[m].restrict_to[P];I.name=I.user.name,I.id=I.user.id,w.push(I.id),I.email=I.user.email,I.zuid=I.user.zuid,I.restriction_id=D,I.pk=L+""+I.id}}"findRecord"===t&&(this.makeUserAPIRequest(w),r.assignment_thresholds=r.assignment_thresholds[0],r.assignment_thresholds.total_count=r.info.total_count)}if(a&&204===a){"findAll"!==t||o.filters||o.status||(o.module?this.setThresholdModuleConfigCount(o.module,0):this.resetThresholdModuleConfigCount());var S={};return S[e]={},S}return r},payloadKey:function(){return"assignment_thresholds"}},{mixins:["crm-assignment-threshold-common"]}),store.registerModel("user_group",{name:Lyte.attr("string"),id:Lyte.attr("string"),description:Lyte.attr("string")}),store.registerAdapter("user_group",{namespace:"crm/v2/settings/",reloadAll:function(e,t){return!(!t||!Object.keys(t).length)||!(e.length>0)}}),store.registerSerializer("user_group",{extractMeta:function(e){var t=e.info;return delete e.info,t},serialize:function(e){return[e]}}),store.registerModel("assignment_threshold_userdetails",{pk:Lyte.attr("string",{primaryKey:!0}),id:Lyte.attr("string"),name:Lyte.attr("string"),role:Lyte.attr("string"),email:Lyte.attr("string"),type:Lyte.attr("string"),backlog_allow_count:Lyte.attr("string"),record_allow_count:Lyte.attr("number"),record_assigned_count:Lyte.attr("number"),backlog_count:Lyte.attr("number"),default_assignee:Lyte.attr("boolean"),_delete:Lyte.attr("boolean"),module:Lyte.attr("string"),restriction_id:Lyte.belongsTo("assignment_threshold")}),store.registerAdapter("assignment_threshold_userdetails",{namespace:"crm/v2.1/settings/automation/assignment_thresholds/",buildURL:function(e,t,r,i,a,s,o){return"findAll"===t&&o&&o.getAllUsers&&o.restrictionId&&(a=a.replace("assignment_threshold_userdetails",o.restrictionId+"/restrict_to")),a}}),store.registerSerializer("assignment_threshold_userdetails",{normalizeResponse:function(e,t,r,i,a,s,o){if("findAll"===t&&200===a){if(r.restrict_to&&o&&o.module)for(var n=o.module,l=[],c=r.restrict_to.length,d=0;d<c;d++){var u=r.restrict_to[d];u.name=u.user.name,u.id=u.user.id,l.push(u.user.id),u.email=u.user.email,u.zuid=u.user.zuid,u.role=u.user.role?u.user.role.name:null,u.pk=n+""+u.id}return r.restrict_to}if(a&&"204"===a){var m={};return m[e]={},m}return r}},{mixins:["crm-assignment-threshold-common"]}),store.registerModel("workflow_suggestion",{module:Lyte.attr("string"),name:Lyte.attr("string"),id:Lyte.attr("string"),description:Lyte.attr("string"),active:Lyte.attr("boolean"),conditions:Lyte.attr("array"),data_duration:Lyte.attr("object"),execute_when:Lyte.attr("object")},{actions:{convert:{endPoint:"convert"}}}),store.registerAdapter("workflow_suggestion",{namespace:"crm/v2/settings/automation/workflow",buildURL:function(e,t,r,i,a){return a=a.replace(e,"suggestions")}}),store.registerSerializer("workflow_suggestion",{}),store.registerModel("workflow_suggestion_details",{module:Lyte.attr("string"),execute_on:Lyte.attr("string"),name:Lyte.attr("string"),status:Lyte.attr("string"),conditions:Lyte.attr("array")}),store.registerAdapter("workflow_suggestion_details",{namespace:"crm/v2/settings/automation/workflow",buildURL:function(e,t,r,i,a){return a.replace(e,"suggestions")}}),store.registerSerializer("workflow_suggestion_details",{payloadKey:function(){return"workflow_suggestions"}}),store.registerModel("custom_button",{name:Lyte.attr("string"),id:Lyte.attr("string"),position:Lyte.attr("string"),profiles:Lyte.attr("array"),description:Lyte.attr("string"),sequence_number:Lyte.attr("number")}),store.registerSerializer("custom_button",{serialize:function(e,t){return t.custom_buttons=[t.custom_button],delete t.custom_button,t},normalizeResponse:function(e,t,r,i,a){return"updateRecord"==t&&200==a&&(r.custom_buttons={id:i}),this.$super.normalizeResponse(e,t,r)}}),store.registerAdapter("custom_button",{namespace:"crm/v2/settings",buildURL:function(e,t,r,i,a,s,o){return o&&o.new&&(a=a.replace("v2","v2.2")),a=a.replace("custom_button","custom_buttons"),"updateRecord"===t&&(a+="?module="+o.module),a}}),store.registerModel("related_list",{list_label:Lyte.attr("string"),sequence_number:Lyte.attr("string"),display_label:Lyte.attr("string"),api_name:Lyte.attr("string"),module:Lyte.attr("object"),name:Lyte.attr("string"),action:Lyte.attr("string"),id:Lyte.attr("string",{primaryKey:!0}),href:Lyte.attr("string"),type:Lyte.attr("string"),visibility:Lyte.attr("number"),visible:Lyte.attr("boolean"),sort_order:Lyte.attr("string"),connectedmodule:Lyte.attr("string"),mxnfield:Lyte.attr("string"),linkingmodule:Lyte.attr("string"),record_operations:Lyte.attr("object"),fields:Lyte.attr("array")},{actions:{customize_sort:{},unsort:{}}}),store.registerAdapter("related_list",{namespace:"crm/v2.2/settings",buildURL:function(e,t,r,i,a,s,o){return a=a.replace(e,e+"s"),o&&"2.1"===o.apiVersion&&(a=a.replace("crm/v2/settings",Crm.isActivitySplitDone?"crm/v3/settings":"crm/v2.1/settings")),Crm.isActivitySplitDone&&(a=a.replace("/v2.2","/v3")),"updateRecord"===t&&(a=a.substr(0,a.lastIndexOf("/"))),a},methodForRequest:function(e,t,r,i){return"PATCH"==e?"PUT":"action"==t&&i&&i.type?i.type:e}}),store.registerSerializer("related_list",{payloadKey:function(){return"related_lists"},serialize:function(e,t){return t.related_lists=[],t.related_lists[0]=t.related_list,delete t.related_list,t},normalizeResponse:function(e,t,r,i,a,s,o){return"updateRecord"==t&&(r.related_lists=r.related_lists[0].details),r.related_lists&&Array.isArray(r.related_lists)&&r.related_lists.forEach((function(e){var t,r;if(o&&o.layout_id&&(e[o.layout_id]=Lyte.deepCopyObject(e)),"multiselectlookup"==e.type){var i=store.peekAll("field").filterBy({data_type:"multiselectlookup"}).filter((function(t){return t.multiselectlookup.api_name===e.api_name}))[0];i&&(e.mxnfield=i.id,r=i.api_name)}if(e.fields&&e.fields.length>0)if("multiselectlookup"==e.type){t=moduleRecordMapping[e.connectedmodule]?moduleRecordMapping[e.connectedmodule].id:void 0;var a=e.module.id;store.model[t]||store.registerModel(t,{},{extends:"entity"}),store.model[a]||store.registerModel(a,{},{extends:"entity"});var s=store.model[t],n=store.model[a];store.addField(a,r,Lyte.belongsTo(t)),(u={}).id=Lyte.attr("string");for(var l=(m=e.fields).length,c=0;c<l;c++)if(116==m[c].ui_type&&m[c].formula_return_type&&(m[c].formula={return_type:m[c].formula_return_type}),m[c].api_name.split(".").length>1){var d=m[c].api_name.split(".")[1];if(!s.fieldList[d])(g={}).type=Lyte.registeredMixins["crm-module-mixin"].getfieldattributeType(m[c]),g.fieldID=m[c].id,g.columnName=m[c].column_name,g.fieldType=m[c].data_type,store.addField(t,d,g.type,g)}else if(!n.fieldList[m[c].api_name]){if("subform"!==m[c].data_type)(g={}).type=Lyte.registeredMixins["crm-module-mixin"].getfieldattributeType(m[c]),g.fieldID=m[c].id,g.columnName=m[c].column_name,g.fieldType=m[c].data_type,store.addField(a,m[c].api_name,g.type,g)}}else{var u;t=e.module.id,(u={}).id=Lyte.attr("string");var m=e.fields;if(store.model[t]){l=m.length;var p=store.model[t];if(p)for(c=0;c<l;c++){var g;if(!p.fieldList[m[c].api_name])if(116==m[c].ui_type&&m[c].formula_return_type&&(m[c].formula={return_type:m[c].formula_return_type}),"subform"!==m[c].data_type)(g={}).type=Lyte.registeredMixins["crm-module-mixin"].getfieldattributeType(m[c]),g.fieldID=m[c].id,g.columnName=m[c].column_name,g.fieldType=m[c].data_type,store.addField(t,m[c].api_name,g.type,g)}}else{for(var l=m.length,c=0;c<l;c++)116==m[c].ui_type&&m[c].formula_return_type&&(m[c].formula={return_type:m[c].formula_return_type}),"subform"!==m[c].data_type&&(u[m[c].api_name]=Lyte.attr(Lyte.registeredMixins["crm-module-mixin"].getfieldattributeType(m[c])),u[m[c].api_name].fieldID=m[c].id,u[m[c].api_name].columnName=m[c].column_name,u[m[c].api_name].fieldType=m[c].data_type);u.$state=Lyte.attr("string"),u.$transitionid=Lyte.attr("string"),store.registerModel(t,u,{extends:"entity"})}}!Lyte.Router.getRouteInstance()||("entity"!==Lyte.Router.getRouteInstance().parent.routeName||"canvas"!==Lyte.Router.getRouteInstance().routeName&&"detail"!==Lyte.Router.getRouteInstance().routeName)&&"detailview"!==Lyte.Router.getRouteInstance().routeName&&("canvas"!==Lyte.Router.getRouteInstance().parent.routeName||"clone"!==Lyte.Router.getRouteInstance().routeName&&"create"!==Lyte.Router.getRouteInstance().routeName&&"edit"!==Lyte.Router.getRouteInstance().routeName)||Lyte.registeredMixins["crm-detail-view-utils"].getRelatedListActions(e,objectUtils.getMatchedKey(moduleApiMapping,o.module))})),r}}),store.registerModel("entity",{type:Lyte.attr("string"),$approved:Lyte.attr("boolean"),$notes_view:Lyte.attr("array")},{actions:{count:{},custom_buttons:{},mass_actions:{},add_tags:{},relatedListmap:{},mass_delete:{},fetchrelatedList:{},remove_tags:{},permit_threshold:{},change_owner:{},reasonForLoss:{},execute:{},blueprint:{},orchestrations:{},share:{},follow:{},data_privacy:{},review_process:{},review_process_history:{},upcoming_actions:{},assign_territories:{},remove_territories:{},convert:{},mass_convert:{},portal_invite:{},deleted_record:{}}}),store.registerAdapter("entity",{namespace:"crm/v2.2",reloadAll:function(e,t){return!0},methodForRequest:function(e,t,r,i,a){return"convert"===a?"GET"===i.method?"GET":"POST":("findAll"==t&&(e="POST"),i&&"Search"===i.type&&"Lookup"===i.from?"GET":i&&i.type?i.type:"mass_convert"===a?"GET"===i.method?"GET":"POST":"action"==t?"count"==a?"POST":i&&i.type?i.type:"GET":e)},buildURL:function(e,t,r,i,a,s,o){if("action"==t&&("add_tags"==s||"remove_tags"==s))return a=a.replace(e,o.module),o.hasOwnProperty("from")&&"list"===o.from&&(a=a.replace("v2.2","v2.1")),a;if("share"==s){var n=o.module+"/"+o.entityId;return a=(a=a.replace(e,n)).replace("v2.2","v3"),"GET"==o.type&&null!=o.param&&(a+="?"+o.param),a}if("convert"===s)return"GET"===o.method?(a=a.replace("entity/actions/convert",moduleRecordMapping.Leads.api_name+"/"+o.id+"/__conversion_options"),r.include_inner_details="preference_field_matched_value.Accounts.unique,preference_field_matched_value.Contacts.unique"):a=a.replace("entity/actions/convert",moduleRecordMapping.Leads.api_name+"/"+o.id+"/actions/convert"),a;if("mass_convert"===s)return a=a.replace("entity",moduleRecordMapping.Leads.api_name);if("deleted_record"===s){var l=o.module;return a=(a=a.replace("entity/actions/deleted_record",l+"/deleted")).replace("v2.2","v2")}var c=store.peekRecord("module",e),d=c.api_name;if(a=a.replace(e,d),null!=o&&null!=o.type&&"Search"==o.type&&(a+="/search","Lookup"!==o.from&&(a=a.replace("v2.2","v2")),r.criteria=o.criteria),"relatedListmap"==s&&o&&o.entityid&&o.relmodule){var u=moduleRecordMapping[o.relmodule].related_lists.filter((function(e){return e.id==o.listRelationId}))[0];if(u){var m=o.relmodule+"/"+o.entityid+"/"+u.api_name+"/"+o.newentityID;a=a.replace(d+"/actions/relatedListmap",m)}}if("fetchrelatedList"==s&&o&&o.entityid&&o.relapiname){var p="/"+o.entityid+"/"+o.relapiname;a=a.replace("/actions/fetchrelatedList",p)}if("change_owner"==s&&o&&o.entityid&&(a=a.replace("/actions/change_owner","/"+o.entityid+"/actions/change_owner")),"reasonForLoss"==s&&o&&o.loss&&(a=a.replace("actions/reasonForLoss",o.entity+"/Notes")),"mass_delete"==s&&(a="/crm/v2/"+d,r.ids=o.ids),"permit_threshold"===s&&(a=a.replace("/v2.2","/v2.1"),o.record_id&&(a=a.replace(d,d+"/"+o.record_id)),r.owner_id=o.owner_id),"custom_buttons"==s)a+="/"+o.button_id;else if("mass_actions"==s)a=a.replace("/"+s,""),r.cvid=o.cvid;else if("count"==s){for(var g in o)r[g]=o[g];o.actionName="count"}else"review_process"==s?a=a.replace("/"+s,"/review"):"review_process_history"==s?a=a.replace("/"+s,"/history_review"):"upcoming_actions"==s&&(a=a.replace("/actions/"+s,"/upcoming_actions"),(c.module_name.indexOf("CustomModule")>-1||c.module_name.indexOf("LinkingModule")>-1)&&(a=a.replace(d,c.module_name)));if("execute"===s&&(a=a.replace(a.slice(a.indexOf("/crm/"),a.indexOf("/actions")+1),"/crm/v2/functions/")),"findAll"==t&&(a+="/bulk"),"findAll"===t&&o&&"Search"===o.type&&"Lookup"===o.from&&(a=a.replace("/bulk","")),r&&r.relationId&&r.relatedId&&"Competitors"==store.peekRecord("related_list",r.relationId).api_name?(a=(a=a.replace("bulk",""))+r.relatedId+"/Competitors",delete r.relationId,delete r.relatedId):r&&r.relationId&&r.relatedId&&"picklist_tracker"===store.peekRecord("related_list",r.relationId).action&&(a=(a=a.replace("bulk",""))+r.relatedId+"/"+store.peekRecord("related_list",r.relationId).api_name,delete r.relationId,delete r.relatedId),r&&r.relationId&&r.relatedId&&Crm.isActivitySplitDone){var f=store.peekRecord("related_list",r.relationId).module,h=null;f&&f.api_name&&(h=f.api_name),"Tasks"!==h&&"Events"!==h&&"Calls"!==h&&"Appointments"!==h||(a=a.indexOf("v2.2")>-1?a.replace("v2.2","v3"):a.indexOf("v2.1")>-1?a.replace("v2.1","v3"):a.replace("v2","v3"))}if(r.fields&&(r.fields=r.fields.toString()),r&&(r.filters||r.cross_filters)){var y={};y.value=r.filters&&"string"!=typeof r.filters?JSON.stringify(r.filters):r.filters,Object.defineProperty(r,"_filters",y),y.value=r.cross_filters&&"string"!=typeof r.cross_filters?JSON.stringify(r.cross_filters):r.cross_filters,Object.defineProperty(r,"_cross_filters",y),delete r.filters,delete r.cross_filters}return o&&o.type&&o.module&&o.id&&(a=a+"/"+o.module+"/"+o.id),o&&o.cloneData&&(a+="/"+o.cloneData.parent_id+"/actions/clone"),a},parseResponse:function(e,t,r,i){return 204==r.status&&((i=this.super(arguments)).info={},"function"==typeof r.getResponseHeader&&r.getResponseHeader("empty_resource")?i.info.show_begin_page="true"==r.getResponseHeader("empty_resource"):r.headers&&r.headers.empty_resource&&(i.info.show_begin_page="true"==r.headers.empty_resource),"function"==typeof r.getResponseHeader&&r.getResponseHeader("webform_approval_records")?i.info.data_waiting_for_approval="true"==r.getResponseHeader("webform_approval_records"):r.headers&&r.headers.webform_approval_records&&(i.info.data_waiting_for_approval="true"==r.headers.webform_approval_records)),i}}),store.registerSerializer("entity",{serializeKey:function(e,t,r){if(void 0===r||r&&"convert"!==r.action&&"mass_convert"!==r.action)return"data"},normalize:function(e,t,r){if("findAll"===t){var i=store.peekRecord(e,r.id);if(i&&i.$.isDirty()){var a=i.$.getDirtyAttributes()[0],s=i[a],o=store.modelFor(e);o&&o.fieldList&&o.fieldList[a]&&"relation"===o.fieldList[a].type&&i[a]&&i[a].mapBy&&(s=i[a].mapBy("id")),r[a]=s}}for(var n=Object.keys(r),l=n.length,c=0;c<l;c++)n[c].indexOf(".")>-1&&delete r[n[c]];return r},serialize:function(e,t,r,i,a,s,o){if("findAll"==e||"action"==e&&"count"==o){t=t||new FormData;var n=s&&s._filters?s._filters:i&&i.filters?i.filters:void 0;n&&(n=n&&"string"!=typeof n?JSON.stringify(n):n,t.append("filters",n));var l=s&&s._cross_filters?s._cross_filters:i&&i.cross_filters?i.cross_filters:void 0;return l&&(l=l&&"string"!=typeof l?JSON.stringify(l):l,t.append("cross_filters",l)),t}if(i&&"canvas_ajax_edit"===i.feature){var c=r.$.getDirtyAttributes()[0];if("multi-user"===r.$.model.fieldList[c].type){var d=[],u=[],m=r.$.undoStack[c][0].val?r.$.undoStack[c][0].val.users:[],p=r[c]?r[c].users:[],g={},f=store.peekRecord("field",r.$.model.fieldList[c].fieldID).multiuserlookup.connectedlookup_apiname;m.filter((function(e){u.push(e[f].id),g[e[f].id]=e.id}));for(var h={},y=[],v=p.length,_=0;_<v;_++)d.push(p[_][f].id),u.includes(p[_][f].id)||(h[f]={id:p[_][f].id},y.push(h),h={});u.diff(d).filter((function(e){y.push({id:g[e],_delete:"null"})}));var b={};b[c]=y,t.data=b}else if("tax"===r.$.model.fieldList[c].type)if(delete t.data.id,t.data[c]){var w,C=store.peekAll("field").filter((function(e){return"Tax"===e.api_name}))[0].pick_list_values,D=C.length,L=t.data[c].split(";"),R=L.length;t.data.Tax=[];for(var P=0;P<R;P++){for(var I=0;I<D;I++)C[I].display_value===L[P]&&(w=C[I]);var S={};S.id=w.id,S.value=w.display_value,t.data.Tax.push(S)}}else t.data.Tax="";else t.data&&t.data.hasOwnProperty(c)&&void 0===t.data[c]&&(t.data[c]="")}if("share"==o&&i)return i.share;if(i&&i.$se_module&&(t.data.$se_module=i.$se_module),"add_tags"===o||"remove_tags"===o||"custom_buttons"===o)if(t&&t.related_list_ids){var M=t.related_list_ids.split(",");(t={}).custom_buttons=[],t.custom_buttons.push({related_list_ids:M})}else{if(("add_tags"===o||"remove_tags"===o)&&"list"!==i.from)return i.tag_names;if(i&&i.fromForm){var k={};return k.custom_buttons=i.custom_buttons,i.cascadedResponse&&(k.cascadedResponse=i.cascadedResponse),k}t=new FormData,i&&i.ids&&t.append("ids",i.ids),t.append("tag_names",i.tag_names),null!=i.over_write&&t.append("over_write",i.over_write)}else{if("portal_invite"===o)return t;if("destroyRecord"!==e&&"create"!==e&&t&&"convert"!==o&&"mass_convert"!==o){if(r.$se_module&&t.data&&(t.data.$se_module=r.$se_module),i&&i.$lookupFilterEditData)for(let e in i.$lookupFilterEditData)t.data[e]=i.$lookupFilterEditData[e];if(i&&i.cloneData){var T={};for(var E in i.cloneData.dataToSend){var A=store.modelFor(a).fieldList[E];A&&"multiuserlookup"===A.fieldType&&!t.data[E]?T[E]=[]:T[E]=t.data[E]}t.data=[T]}else t.data=[t.data];var F=store.peekRecord("module",r.$.model._name),U=F?"crm-create-layout#"+F.module_name+"LC_layoutNode":"",O=$L(U)[0];if(O&&(t.skip_mandatory=O.component.data.skipMandatory,i&&i.skipblocklistValidation&&(t.escape_blocklist=!0),t.data[0].hasOwnProperty("__DUMMY_Request_Trigger__FIELD")&&delete t.data[0].__DUMMY_Request_Trigger__FIELD,"createRecord"==e||"create"==e||"updateRecord"==e)){if(t.data[0].$state&&"draft"===t.data[0].$state)for(var x in r.$.error)r.$.error.hasOwnProperty(x)&&"ERR02"===r.$.error[x].code&&(t.data[0][x]=null);var N=O.component.data.currsubformApinames;for(var j in N&&N.length&&N.forEach((function(e){var r=t.data[0][e];r&&r.forEach((function(e){delete e.__CUSTOM_sequence_NUMBER__}))})),t.data[0])null==t.data[0][j]&&(t.data[0][j]=null);if(a==(moduleRecordMapping.Products?moduleRecordMapping.Products.id:void 0)){var z=store.modelFor(a).fieldList.Tax;if(z&&"TAX"===z.columnName&&t.data[0].hasOwnProperty("Tax")){var $=[],q=t.data[0].Tax;(q=q&&"string"==typeof q?JSON.parse(q):q)&&q.length?(q.forEach((function(e){var t={id:null};t.value=e,$.push(t)})),t.data[0].Tax=$):t.data[0].Tax=[]}}Crm.curr_sub_Form_DetailS&&(Crm.curr_sub_Form_DetailS.subRecDetails={},Crm.curr_sub_Form_DetailS.apiNames.forEach((function(e){var i=[];if(t.data[0][e]){var a=r[e],s=[],o=[];if(a.forEach((function(r,a){var n=!1,l=r.$.model.fieldList;for(var c in l)l[c].fieldID&&"SERIAL_NUMBER"!==l[c].columnName&&"formula"!=l[c].fieldType&&(r[c]="string"==typeof r[c]?r[c]&&"[]"==r[c]?"":r[c].trim():r[c],((r[c]||0===r[c])&&"picklist"!==l[c].fieldType||r[c]&&"picklist"==l[c].fieldType&&"-None-"!=r[c])&&(n="true"!==r.removedRow));n&&(s.push(t.data[0][e][a]),i.push(r.id)),o.push({isValid:n,id:r.id})})),Crm.curr_sub_Form_DetailS.orgSubformData&&Crm.curr_sub_Form_DetailS.orgSubformData[e])for(var n=Crm.curr_sub_Form_DetailS.orgSubformData[e].filter((function(e){return!i.contains(e.id)})),l=n&&n.length?n.length:0,c=0;c<l;c++){var d={id:n[c].id,_delete:null};s.push(d)}s.length?(s.forEach((function(e){for(var t in e)e[t]=null==e[t]?null:e[t]})),t.data[0][e]=s):t.data[0][e]=null,Crm.curr_sub_Form_DetailS.subRecDetails[e]=o}})))}}}if("relatedListmap"==o)return{data:[{linkRelatedlist:!0}]};if("reasonForLoss"==o&&i)return{data:[{Note_Content:i.loss,Note_Title:i.stage}]};if("execute"==o&&i&&i.jsonData)return{functions:i.jsonData};if("blueprint"==o&&i)return{blueprint:i.blueprint};if("change_owner"===o&&i&&i.qParams){var B={},V=i.qParams;return B.owner={id:V.owner_id},B.notify=V.notify,V.related_modules&&V.related_modules.length?B.related_modules=V.related_modules:B.related_modules=[],B}return t},payloadKey:function(e,t,r,i,a){return void 0!==a&&"convert"===a.action?"__conversion_options":e},normalizeResponse:function(e,t,r,i){if(r.data&&r.data.forEach((function(e){e.hasOwnProperty("transition")&&(e.id=e.transition.id),e.hasOwnProperty("$approval_state")&&!e.hasOwnProperty("$approved")&&("approved"===e.$approval_state||"review_process_pending"===e.$approval_state||"review_process_rejected"===e.$approval_state||"merge_pending"===e.$approval_state?e.$approved=!0:e.$approved=!1)})),"createRecord"==t||"create"==t||"updateRecord"==t){var a={};if(a[e]={},a[e]=r.data[0].details,Crm.curr_sub_Form_DetailS){var s=store.peekRecord(e,i),o=Crm.curr_sub_Form_DetailS.apiNames;o.forEach((function(t){var r=s[t],i=Crm.curr_sub_Form_DetailS.subRecDetails?Crm.curr_sub_Form_DetailS.subRecDetails[t]:void 0;if(i&&i.length){var o=[],n=0;r&&r.length>0&&(a[e][t]&&a[e][t].length?o=JSON.parse(JSON.stringify(a[e][t])):a[e][t]=[],r.forEach((function(r,s){i[s].isValid?(a[e][t][s]={id:o[n].id},n++):a[e][t][s]={id:r.id}})))}}))}return a}if("findAll"==t||"findRecord"==t){if(r[e]=r.data?r.data:[],delete r.data,"findRecord"==t){var n=r[e]?r[e][0]:void 0;l(n)}else void 0!==r[e]&&r[e].forEach((function(e){l(e)}));arguments[7]&&arguments[7].module&&"Attachments"==arguments[7].module&&(r[e][0].id=r[e][0].details.id)}function l(t){if(t){var i=Object.keys(t),a=i.length,s=store.modelFor(e),o=s.fieldList;r.meta||(r.meta={}),r.meta.original||(r.meta.original={});for(var n=["date","datetime","multi-picklist","phone","time-in-hrs","time-in-minutes","tax"],l=0;l<a;l++)null===t[i[l]]&&(t[i[l]]=void 0),o[i[l]]&&(t[i[l]]||0===t[i[l]])&&n.indexOf(o[i[l]].type)>-1?r.meta.original[i[l]]=t[i[l]]:t[i[l]]&&t[i[l]].length&&o[i[l]]&&"relation"===o[i[l]].type&&"hasMany"===o[i[l]].relType&&(r.meta.original[i[l]]=Lyte.deepCopyObject(t[i[l]].slice(0)));var c=s.relations;for(var d in c){var u=c[d];u&&u.length&&"hasMany"==u[0].relType&&(null!=t[u[0].relKey]&&null!=t[u[0].relKey]||t.hasOwnProperty(u[0].relKey)&&(t[u[0].relKey]=[]))}}}return r},extractMeta:function(e,t,r,i,a){return a&&a.businessCard&&e.fields&&(e.info=e.info?e.info:{},e.info.fields=e.fields),e.info}}),store.registerModel("besttime_zia",{dateInMS:Lyte.attr("number"),inputDate:Lyte.attr("string"),id:Lyte.attr("string"),module:Lyte.attr("string"),bestTime_call:Lyte.attr("array"),bestTime_text:Lyte.attr("array"),bestTime_all:Lyte.attr("array")}),store.registerAdapter("besttime_zia",{namespace:"crm/di/",headersForRequest:function(){var e={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};return"undefined"!=typeof crmZgid&&crmZgid&&(e["X-CRM-ORG"]=crmZgid),e},buildURL:function(e,t,r,i,a){return a=a.replace("besttime_zia","besttime")}}),store.registerSerializer("besttime_zia",{days:["crm.best.time.day.short.sunday","crm.best.time.day.short.monday","crm.best.time.day.short.tuesday","crm.best.time.day.short.wednesday","crm.best.time.day.short.thursday","crm.best.time.day.short.friday","crm.best.time.day.short.saturday"],months:["crm.best.time.month.short.january","crm.best.time.month.short.february","crm.best.time.month.short.march","crm.best.time.month.short.april","crm.best.time.month.short.may","crm.best.time.month.short.june","crm.best.time.month.short.july","crm.best.time.month.short.august","crm.best.time.month.short.september","crm.best.time.month.short.october","crm.best.time.month.short.november","crm.best.time.month.short.december"],payloadKey:function(e){return e},normalizeResponse:function(e,t,r){var i=r.besttime,a="ALL"===r.type,s="CALL"===r.type;if(r[e]={},r[e].id=r.id,r[e].dateInMS=r.day,r[e].inputDate=this.getInputDate(r.day),i){var o=this.getBestTimeArrayNew(i);return(a?r[e].bestTime_all=o:s)?r[e].bestTime_call=o:r[e].bestTime_text=o,r}return r},getInputDate:function(e){var t=new Date,r=new Date(e);return Utils.dateEquals(r,t)?I18n.getMsg("Today"):r-t<864e5&&t<r?I18n.getMsg("Tommorow"):I18n.getMsg(this.days[r.getDay()])+", "+I18n.getMsg(this.months[r.getMonth()])+" "+r.getDate()},getBestTimeArrayNew:function(e){for(var t=e.length,r=[],i=0;i<t&&i<4;i++){var a=e[i],s={};s.weight=a.score,s.bestTimeDate=new Date(a.timestamp.substring(0,a.timestamp.length-5)),s.reminder=a.reminder,r.push(s)}r.sort(this.sortDateBestTime);var o=[],n=r.length,l="hh:mm a"===Crm.userDetails.TIME_FORMAT;for(i=0;i<n;i++){var c={};c.bestTime=this.getFormattedTime(l,r[i].bestTimeDate,!1),c.level=this.getLevel(r[i].weight),c.dateTime=r[i].bestTimeDate,c.reminder=r[i].reminder,o.push(c)}return o},sortDateBestTime:function(e,t){return new Date(e.bestTimeDate)-new Date(t.bestTimeDate)},getLevel:function(e){return e>=0&&e<21?1:e>20&&e<41?2:e>40&&e<61?3:e>60&&e<81?4:5},getFormattedTime:function(e,t,r){var i=t.getHours(),a=t.getMinutes(),s="";if(e){s="AM";0===i?i=12:12===i?s="PM":i>12&&(i-=12,s="PM")}return i<10&&(i="0"+i),a<10&&(a="0"+a),s=r?s:I18n.getMsg(s),e?i+":"+a+" "+s:i+":"+a}}),store.registerModel("besttime_zia_new",{dateInMS:Lyte.attr("number"),inputDate:Lyte.attr("string"),id:Lyte.attr("string"),module:Lyte.attr("string"),bestTime_call:Lyte.attr("array"),bestTime_text:Lyte.attr("array"),bestTime_all:Lyte.attr("array")}),store.registerSerializer("besttime_zia_new",{days:["crm.best.time.day.short.sunday","crm.best.time.day.short.monday","crm.best.time.day.short.tuesday","crm.best.time.day.short.wednesday","crm.best.time.day.short.thursday","crm.best.time.day.short.friday","crm.best.time.day.short.saturday"],months:["crm.best.time.month.short.january","crm.best.time.month.short.february","crm.best.time.month.short.march","crm.best.time.month.short.april","crm.best.time.month.short.may","crm.best.time.month.short.june","crm.best.time.month.short.july","crm.best.time.month.short.august","crm.best.time.month.short.september","crm.best.time.month.short.october","crm.best.time.month.short.november","crm.best.time.month.short.december"],payloadKey:function(e){return e},normalizeResponse:function(e,t,r){var i=r.besttime,a="ALL-NOWEB"===r.type,s="CALL"===r.type;return r[e]={},r[e].id=r.id,r[e].dateInMS=r.day,r[e].inputDate=this.getInputDate(r.day),i?a?(r[e].bestTime_call=this.getBestTimeArrayNew(i,"call"),r[e].bestTime_text=this.getBestTimeArrayNew(i,"text")):s?r[e].bestTime_call=this.getBestTimeArrayNew(i,"call"):r[e].bestTime_text=this.getBestTimeArrayNew(i,"text"):(r.besttime=[],r[e].besttime=[]),r},getInputDate:function(e){var t=new Date,r=new Date(e);return Utils.dateEquals(r,t)?I18n.getMsg("Today"):r-t<864e5&&t<r?I18n.getMsg("Tommorow"):I18n.getMsg(this.days[r.getDay()])+", "+I18n.getMsg(this.months[r.getMonth()])+" "+r.getDate()},getBestTimeArrayNew:function(e,t){for(var r=e.length,i=[],a=0;a<r;a++)if(e[a].type===t){var s=e[a],o={};o.weight=s.score,o.bestTimeDate=new Date(s.timestamp.substring(0,s.timestamp.length-5)),o.reminder=s.reminder,i.push(o)}i.sort(this.sortDateBestTime);var n=[],l=i.length,c="hh:mm a"===Crm.userDetails.TIME_FORMAT;for(a=0;a<l;a++){var d={};d.bestTime=this.getFormattedTime(c,i[a].bestTimeDate,!1),d.level=this.getLevel(i[a].weight),d.dateTime=i[a].bestTimeDate,d.reminder=i[a].reminder,n.push(d)}return n},sortDateBestTime:function(e,t){return new Date(e.bestTimeDate)-new Date(t.bestTimeDate)},getLevel:function(e){return e>=0&&e<21?1:e>20&&e<41?2:e>40&&e<61?3:e>60&&e<81?4:5},getFormattedTime:function(e,t,r){var i=t.getHours(),a=t.getMinutes(),s="";if(e){s="AM";0===i?i=12:12===i?s="PM":i>12&&(i-=12,s="PM")}return i<10&&(i="0"+i),a<10&&(a="0"+a),s=r?s:I18n.getMsg(s),e?i+":"+a+" "+s:i+":"+a}}),store.registerAdapter("besttime_zia_new",{namespace:"crm/di/",headersForRequest:function(){var e={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};return"undefined"!=typeof crmZgid&&crmZgid&&(e["X-CRM-ORG"]=crmZgid),e},buildURL:function(e,t,r,i,a){return a=a.replace("besttime_zia_new","besttime")}}),store.registerModel("zia_reminder",{id:Lyte.attr("string"),reminderTime:Lyte.attr("string")}),store.registerAdapter("zia_reminder",{namespace:"crm/di/",headersForRequest:function(){var e={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};return"undefined"!=typeof crmZgid&&crmZgid&&(e["X-CRM-ORG"]=crmZgid),e},buildURL:function(e,t,r,i,a){return a=a.replace("zia_reminder","ziaReminder")},methodForRequest:function(){return"POST"}}),store.registerSerializer("zia_reminder",{normalizeResponse:function(e,t,r){return r.result&&r.ReminderTime&&(r[e]={},r[e].id=r.id,r[e].reminderTime=r.ReminderTime),r}}),store.registerModel("custom_view",{display_value:Lyte.attr("string"),default:Lyte.attr("boolean"),criteria:Lyte.attr("object"),system_name:Lyte.attr("string"),id:Lyte.attr("string"),category:Lyte.attr("string"),fields:Lyte.attr("array"),filter:Lyte.hasMany("filter"),favorite:Lyte.attr("string")},{actions:{favourite:{endPoint:"favourite"},convert:{},change_sort:{},customize_wrap_text:{endPoint:"customize_wrap_text"},customize_width:{endPoint:"customize_width"},reset_width:{endPoint:"reset_width"}}}),store.registerAdapter("custom_view",{namespace:"crm/v2.2/settings",buildURL:function(e,t,r,i,a,s,o){if(!r||"Tasks"!==r.module&&"Events"!==r.module&&"Calls"!==r.module||(a=a.replace("/v2.1","/v3")),a=a.replace(e,e+"s"),"updateRecord"==t){var n=store.peekRecord("custom_view",i.id);n.sort_order?i.sort_order=n.sort_order:delete i.sort_order}else"deleteRecord"===t&&(a=a.substr(0,a.lastIndexOf("/")));if("action"!==t||"customize_width"!==s&&"reset_width"!==s)for(var l in o)"isDelete"!==l&&(r[l]=o[l]);else a=a.replace("settings/custom_views","__internal/settings/custom_views/"+o.id);return a},methodForRequest:function(e,t,r,i,a){return"PATCH"===e||"change_sort"===a||"customize_wrap_text"===a||"customize_width"===a||"reset_width"===a?"PUT":i&&!0===i.isDelete?"DELETE":e}}),store.registerSerializer("custom_view",{normalizeResponse:function(e,t,r,i,a,s,o){if(!r)return r=[];if(("findAll"===t||"findRecord"===t)&&r.info&&r.info.translation){var n=r.info.translation;for(var l in n)app.cvCategory?app.cvCategory[l]||(app.cvCategory[l]=n[l]):(app.cvCategory={},app.cvCategory.Favorites=I18n.getMsg("Favorites"),app.cvCategory[l]=n[l])}if("findAll"===t)for(var c=store.peekAll("custom_view"),d=c.length,u=0;u<d;u++)c[u].module.api_name==o.module&&(store.unloadRecord("custom_view",c[u].id),d--,u--);return delete r.categories,"findRecord"==t?r.custom_views?r.custom_views=r.custom_views[0]:r={}:"updateRecord"==t&&200==a&&(r.custom_views={id:i}),r.custom_views&&r.custom_views.module&&(r.custom_views.module_default=r.custom_views.module),r},normalize:function(e,t,r){return"findAll"==t&&(null==r.sort_by&&delete r.sort_by,null==r.sort_order&&delete r.sort_order),r},serialize:function(e,t,r,i,a,s,o){return"action"!=e&&t.custom_views&&"unsort"==t.custom_views.sort_order&&(delete t.custom_views.sort_order,t.custom_views.sort_by=null),"change_sort"===o||"customize_wrap_text"===o||"customize_width"===o?{custom_views:[i]}:("updateRecord"==e?t.custom_views=[t.custom_views]:"findRecord"==e&&t.custom_views&&(t.custom_views=t.custom_views[0]),t)},serializeKey:function(e){return e+"s"}}),store.registerModel("tag",{created_by:Lyte.attr("object"),created_time:Lyte.attr("string"),id:Lyte.attr("string"),modRefId:Lyte.attr("string"),modified_by:Lyte.attr("object"),modified_time:Lyte.attr("string"),module_name:Lyte.attr("string"),name:Lyte.attr("string"),color_code:Lyte.attr("string")},{actions:{records_count:{},merge:{},add_tags:{},remove_tags:{}}}),store.registerAdapter("tag",{namespace:"crm/v2.2/settings",methodForRequest:function(e,t,r,i){return"create"===t?"POST":"update"===t?"PATCH":"action"!==t||"add_tags"!==i.action&&"remove_tags"!==i.action?"action"===t&&void 0!==i&&i.module?(r.module=i.module,"GET"):e:"POST"},buildURL:function(e,t,r,i,a,s,o){return a=a.replace(e,e+"s"),"delete"===t&&o?a=a+"/"+o.id:"action"!==t||"add_tags"!==s&&"remove_tags"!==s?"action"===t&&o.id&&(a=(a=a.slice(0,a.indexOf("tag")+5))+o.id+"/actions/merge"):(a=(a=(a=a.slice(0,a.indexOf("tag")+5))+o.id+"/actions/"+s).replace("settings/"+e+"s",o.module),"remove_tags"===s&&(a=a+"?tag_names"+encodeURIComponent(o.tag_names)+"&fromClient="+!0)),a}}),store.registerSerializer("tag",{normalizeResponse:function(e,t,r,i,a,s,o){var n=Lyte.Router.getRouteInstance();if("create"===t){for(var l=r.tags.length,c=[],d=0;d<l;d++)r.tags[d].details.module_name=o.modulename,r.tags[d].details.message||(r.tags[d].details.message=r.tags[d].message),r.tags[d].details.module_name=o&&o.module?o.module:n.getQueryParams().module,Lyte.arrayUtils(c,"push",r.tags[d].details),r.tags[d].module_name=o.module;return{tags:c}}if("findAll"===t)for(l=r.tags.length,d=0;d<l;d++)r.tags[d].module_name=o&&o.module?o.module:n.getQueryParams().module;else if("update"===t)return{tags:r.tags[0].details};return r},serializeKey:function(e){return e+"s"},serialize:function(e,t,r,i,a,s,o){if("merge"===o)return{tags:[{conflict_id:r.id,modified_time:r.modified_time}]};if("update"===e)return{tags:[{name:void 0===t.tags[0].name?r[0].name:t.tags[0].name,color_code:t.tags[0].color_code,id:t.tags[0].id,modified_time:r.modified_time}]};if("create"===e){for(var n=[],l=t.tags.length,c=0;c<l;c++){var d={name:t.tags[c].name,color_code:t.tags[c].color_code};n.push(d)}return{tags:n}}return"add_tags"===o?i:"remove_tags"===o?((t=new FormData).append("tag_names",i.tag_names),t.append("fromPage","view"),t):void 0}}),store.registerModel("role",{api_name:Lyte.attr("string"),display_label:Lyte.attr("string"),name:Lyte.attr("string"),id:Lyte.attr("string",{primaryKey:!0}),users:Lyte.hasMany("user",{inverse:"role"}),admin_user:Lyte.attr("string"),reporting_to:Lyte.belongsTo("role",{serialize:"partial"}),forecast_manager:Lyte.belongsTo("user",{serialize:"partial",inverse:"null"}),children:Lyte.hasMany("role",{inverse:"reporting_to"}),share_with_peers:Lyte.attr("boolean"),description:Lyte.attr("string"),_children:Lyte.hasMany("role",{inverse:"_children"}),forecast_data:Lyte.hasMany("forecast_data")},{actions:{deleted_associated_roles:{}}}),store.registerAdapter("role",{namespace:"crm/v2.2/settings/",reloadAll:function(){return!0},buildURL:function(e,t,r,i,a,s,o){return o&&o.version&&(a=a.replace("v2.2",o.version)),a=a.replace(e,e+"s"),o&&"delete"===o.type?a=a+"/"+o.id:"updateRecord"===t&&i&&i.id&&(a=a.substring(0,a.indexOf("/"+i.id))),r&&"parent_roles"===r.type&&r.id&&(a=a+"/"+r.id+"/__parent_roles"),a},methodForRequest:function(e,t,r,i,a){return"action"===t&&"deleted_associated_roles"===a?"GET":"PATCH"===e||i&&"update"===i.type?"PUT":e}}),store.registerSerializer("role",{extractMeta:function(e){var t=e.info;return delete e.info,t},serialize:function(e,t,r){var i={};if("create"===e||"updateRecord"===e||"update"===e){var a=t.role&&t.role.length?t.role.length:1;i="create"===e?Lyte.deepCopyObject(t.role[a-1]):t.role;var s=r[a-1]?r[a-1].reporting_to:r.reporting_to,o=r[a-1]?r[a-1].forecast_manager:r.forecast_manager;if(s&&s.id){var n="create"===e?{name:s.name,id:s.id}:{id:s.id};void 0!==s._transfer_conflicting_users_to&&(n._transfer_conflicting_users_to=s._transfer_conflicting_users_to),i.reporting_to=n}if(o&&o.id){var l="create"===e?{name:o.name,id:o.id}:{id:o.id};i.forecast_manager=l}return t.roles=[i],delete t.role,t}return[t]},normalizeResponse:function(e,t,r){return"create"===t||"createRecord"===t||"updateRecord"===t?((r=r&&r.roles?r.roles[0]:r)&&r.details&&r.details.id&&(r.id=r.details.id),{roles:r}):r}}),store.registerAdapter("application",{namespace:"crm/v2",batchNamespace:"batch_requests",actionNamespace:"actions",headersForRequest:function(e,t,r){var i={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken,"X-CRM-ORG":crmZgid};return window.clientPortalName&&(i["X-CRMPORTAL"]=window.clientPortalName),"undefined"!=typeof crmZgid&&crmZgid&&(i["X-CRM-ORG"]=crmZgid),"false"===window.isSandboxAcc&&(t&&void 0!==t.SandboxAccount||r&&void 0!==r.SandboxAccount)&&(i["X-CRM-ORG"]=sandbox.orgInfo.crmSandboxOrParentZgid.toString()),r&&(r.isSandboxDiff||r.isProductionDiff)&&(i["X-CRM-ORG"]=sandbox.orgInfo.crmSandboxOrParentZgid.toString()),r&&r.businessCard&&(i["X-ZOHO-SERVICE"]="crm/lookupTooltip"),i},buildURL:function(e,t,r,i,a,s,o){o&&(o.isSandboxDiff?a=a.replace(this.namespace,this.namespace+"/sandbox/diff"+this.namespace.slice(3)):o.isProductionDiff&&(a=a.replace(this.namespace,this.namespace+"/production/diff"+this.namespace.slice(3))));var n=a.lastIndexOf(e);return-1!==n&&(a=a.substring(0,n)+e+"s"+a.substring(n+e.length)),a},parseResponse:function(e,t,r,i){return!i&&r&&204===r.status?{}:i}}),store.addEventListener("afterRequest",(function(e){if(Crm.env.isDevelopment&&"undefined"!=typeof instrumentData){var t=e.getResponseHeader("instrument");void 0!==t&&(Instrumentdata.instrumentresp.length>10&&Instrumentdata.instrumentresp.shift(),null!==t&&Instrumentdata.instrumentresp.push(JSON.parse(t)))}})),crmStore=function(e){this.maxLength=5,e&&e.maxLength&&e.maxLength<5&&(this.maxLength=e.maxLength),Object.defineProperties(this,{requestLength:{enumerable:!1,writable:!0,value:0},makeRequest:{value:function(){var e=arguments;return new Promise(function(t,r){this.request({args:e,res:t,rej:r})}.bind(this))}},request:{value:function(e){if(this.requestLength<this.maxLength){this.requestLength++;for(var t=[],r=e.args.length,i=1;i<r;i++)t.push(e.args[i]);var a=this,s=e.args[0];"sendXHR"==s?networkUtils.sendxhr.apply(null,t).then((function(t){a.success(e.res,t)}),(function(t){a.error(e.rej,t)})):store[s].apply(store,t).then((function(t){a.success(e.res,t)}),(function(t){a.error(e.rej,t)}))}else this.toSend.push(e)}},success:{value:function(e,t){this.requestLength--,this.toSend.length&&this.request(this.toSend.splice(0,1)[0]),e(t)}},toSend:{writable:!0,value:[]},error:{value:function(e,t){this.requestLength--,this.toSend.length&&this.request(this.toSend.splice(0,1)[0]),e(t)}}})},store.registerSerializer("application",{extractMeta:function(e){if(e&&e.info)return e.meta=e.info,delete e.info,e.meta},serialize:function(e,t,r,i){return"batch"==e&&(t.batch_requests=t.batch,delete t.batch),t},payloadKey:function(e){if("blueprint"!=e)return e+"s"},normalizeResponse:function(e,t,r,i,a,s){if("batch"===t)r.batch_requests.forEach((function(e,t){if("SUCCESS"===e.code){var r=e.details.response;for(var i in r)e[i]=r[i];delete e.details,500===r.status?e.content={info:{error:!0}}:e.content=JSON.parse(e.content)}}));else if(null==r||0==Object.keys(r).length){var o={};return"findAll"==t?o[e]=[]:"findRecord"==t&&(o[e]={}),o}return r}}),Lyte.registerValidator("datetimeValidation",(function(e,t){var r,i,a,s,o,n,l,c=t;t=t&&"string"==typeof t?t.trim():t;var d=this.$.model.fieldList[e];t=t&&"datetime"==d.fieldType&&-1==t.indexOf("TV")&&-1!=t.indexOf("T")?t.split("T")[0]:t;var u=Utils.isValidDate("yyyy-mm-dd",t);if(t&&!u){var m=-1!=(t=-1==(t=t.trim()).indexOf("TV")&&"date"==d.fieldType?t+"TV":t).indexOf("TV")?t.split("TV"):t.split(" ");if(t=m.length>=1?m[0]:"",d.mandatory&&!t)return{code:"ERR02",message:Lyte.errorCodes.ERR02,errorValue:c};if(!t)return!0;var p=-1!=["dd.mm.yyyy.","yyyy. mm. dd","yyyy.mm.dd","yyyy'年'mm'月'dd'日'"].indexOf(Crm.userDetails.DATE_PATTERN.toLowerCase()),g=Utils.convertUsrtoDefaultDatePattern(t,p);if(t==Lyte.registeredMixins["crm-date-datetime-mixin"].getDateTimeWithTimezone(g))return!0;if(!Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),t))return{code:"ERR03",message:Lyte.errorCodes.ERR03,errorValue:c};if(L(this),r||i){if("start"==l){var f;if((f=this.$.error[s]?Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),this.$.error[s].value)?this.$.error[s].value:void 0:this[s])||"Native__Backstage__Extn__Event_End_Date"!==s||(f=this.$.error[s]?this.$.error[s].value:f),"Native__Backstage__Extn__Event_End_Date"===s&&f&&-1!==f.indexOf("TV")){var h=f.split("TV");h.length>=1&&(f=Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),h[0])?h[0]:void 0)}if(f){if("STARTDATETIME"==r?t.split(" ").length>1?Utils.compareDateandTime(Utils.getDateObject(t,D(c)),Utils.getDateObject(f,D(f))):Utils.compareDate(Utils.getDateObject(t,D(c)),Utils.getDateObject(f,D(f))):Utils.compareDate(Utils.getDateObject(t,{}),Utils.getDateObject(f,{}))){if(this.$.error[s]){if((w=Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),this.$.error[s].value)?this.$.error[s].value:void 0)||"Native__Backstage__Extn__Event_End_Date"!==s||(w=this.$.error[s].value?this.$.error[s].value:w),"Native__Backstage__Extn__Event_End_Date"===s&&w&&-1!==w.indexOf("TV")){var y=w.split("TV");y.length>=1&&(w=Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),y[0])?y[0]:void 0)}w&&("Native__Backstage__Extn__Event_End_Date"===s?this.$.set(s,this.$.error[s].value):this.$.set(s,w))}return!0}return!!(d&&d.fieldID&&(b=store.peekRecord("field",d.fieldID))&&b.read_only)||{code:"ERRDATE01",message:I18n.getMsg("crm.custom.field.less.than.equalto",['"'+o+'"','"'+n+'"'])}}return!0}var v;if((v=this.$.error[a]?Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),this.$.error[a].value)?this.$.error[a].value:void 0:this[a])||"Native__Backstage__Extn__Event_Start_Date"!==a||(v=this.$.error[a]?this.$.error[a].value:v),"Native__Backstage__Extn__Event_Start_Date"===a&&v&&-1!==v.indexOf("TV")){var _=v.split("TV");_.length>=1&&(v=Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),_[0])?_[0]:void 0)}if(v){var b;if("ENDDATETIME"==i?t.split(" ").length>1?Utils.compareDateandTime(Utils.getDateObject(v,D(v)),Utils.getDateObject(t,D(c))):Utils.compareDate(Utils.getDateObject(v,D(v)),Utils.getDateObject(t,D(c))):Utils.compareDate(Utils.getDateObject(v,{}),Utils.getDateObject(t,{}))){if(this.$.error[a]){var w;if((w=Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),this.$.error[a].value)?this.$.error[a].value:void 0)||"Native__Backstage__Extn__Event_Start_Date"!==a||(w=this.$.error[a]?this.$.error[a].value:w),"Native__Backstage__Extn__Event_Start_Date"===a&&w&&-1!==w.indexOf("TV")){var C=w.split("TV");C.length>=1&&(w=Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),C[0])?C[0]:void 0)}w&&("Native__Backstage__Extn__Event_Start_Date"===a?this.$.set(a,this.$.error[a].value):this.$.set(a,w))}return!0}return!!(d&&d.fieldID&&(b=store.peekRecord("field",d.fieldID))&&b.read_only)||{code:"ERRDATE02",message:I18n.getMsg("crm.field.comparision.check",['"'+n+'"','"'+o+'"'])}}return!0}}return L(this),r||i?"start"==l?!(f=this.$.error[s]&&Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),this.$.error[s].value)?this.$.error[s].value:void 0)||(this.$.set(s,f),!0):!(v=this.$.error[a]&&Utils.isValidDate(Crm.userDetails.DATE_PATTERN.toUpperCase(),this.$.error[a].value)?this.$.error[a].value:void 0)||(this.$.set(a,v),!0):!(d.mandatory&&!t)||{code:"ERR02",message:Lyte.errorCodes.ERR02,errorValue:c};function D(e){var t=new Date(e),r={};return r.hrs=t.getHours(),r.mins=t.getMinutes(),r}function L(t){var c=t.$.model.fieldList[e];if("Native__Backstage__Extn__Event_Start_Date"===e||"Native__Backstage__Extn__Event_End_Date"===e)return r=a="Native__Backstage__Extn__Event_Start_Date",i=s="Native__Backstage__Extn__Event_End_Date",o=t.$.model.fieldList[a].fieldLabel,n=t.$.model.fieldList[s].fieldLabel,void(l=a===e?"start":"end");var d=crmConstants.dateTimeComparisonFieldsMapping.filter((function(e){if(e.start==c.columnName||e.end==c.columnName)return e}));if(d.length&&d[0]){r=d[0].start,i=d[0].end;var u=0;for(var m in t.$.model.fieldList){var p=t.$.model.fieldList[m];if(p.columnName&&p.columnName==r?(a=m,++u,o=p.fieldLabel):p.columnName&&p.columnName==i&&(s=m,++u,n=p.fieldLabel),2==u)break}l=a==e?"start":"end"}}})),Lyte.registerValidator("twitteridValidation",(function(e,t){if(t&&t.trim()){var r=getcurrentFieldAtributes(e,this);return r&&!havevalidLength(r,t)?{code:"ERR06",message:Lyte.errorCodes.ERR06}:validationUtils.isValidTwitter(t.trim())||{code:"ERR03",message:Lyte.errorCodes.ERR03}}return!0})),Lyte.registerValidator("emailValidation",(function(e,t){if(t&&t.trim()){var r=getcurrentFieldAtributes(e,this);return r&&!havevalidLength(r,t)?{code:"ERR06",message:Lyte.errorCodes.ERR06}:validationUtils.isValidEmail(t.trim())||{code:"ERR03",message:Lyte.errorCodes.ERR03}}return!0})),Lyte.registerValidator("websiteValidation",(function(e,t){if(t&&t.trim()){var r=getcurrentFieldAtributes(e,this);return r&&!havevalidLength(r,t)?{code:"ERR06",message:Lyte.errorCodes.ERR06}:validationUtils.isValidWebUrl(t.trim())||{code:"ERR03",message:Lyte.errorCodes.ERR03}}return!0})),Lyte.registerValidator("phonenumValidation",(function(e,t){if(t){var r=getcurrentFieldAtributes(e,this);if(r)return havevalidLength(r,t)?Lyte.Component.registeredHelpers.isValidPhonenumber(r,t)||{code:"ERR03",message:Lyte.errorCodes.ERR03}:{code:"ERR06",message:Lyte.errorCodes.ERR06}}return!0})),Lyte.registerValidator("decimalValidation",(function(e,t){if(t){var r=getcurrentFieldAtributes(e,this);if(!havevalidLength(r,t,!0))return{code:"ERR06",message:Lyte.errorCodes.ERR06};if(r)return validationUtils.decimalLengthCheck(t,r.decimal_place)||{code:"ERR04",message:Lyte.errorCodes.ERR04,allowedDecimal:r.decimal_place,fieldValue:t}}return!0})),Lyte.registerValidator("picklistValidation",(function(e,t){return!((this.$&&this.$.model&&this.$.model.fieldList?this.$.model.fieldList:{})&&this.$.model.fieldList[e]&&this.$.model.fieldList[e].mandatory&&"-None-"==t)||{code:"ERR02",message:Lyte.errorCodes.ERR02}})),Lyte.registerValidator("emptyValueValidation",(function(e,t){var r=this.$.model.fieldList;if(r[e].mandatory){if(["Native__Survey__Extn__Survey","Native__Survey__Extn__Survey_Department","Native__Survey__Extn__Survey_Type"].contains(e)&&(!t||"zsurvey___crm__SYSTEM__NONE"===t))return{code:"ERR02",message:Lyte.errorCodes.ERR02,value:t};if(t&&"object"==typeof t&&validationUtils.isEmpty(t))return{code:"ERR02",message:Lyte.errorCodes.ERR02,value:t};if(t&&"string"==typeof t&&!t.trim())return{code:"ERR02",message:Lyte.errorCodes.ERR02,value:t};if(t&&"string"==typeof t&&"multiselectpicklist"===r[e].fieldType&&-1!=t.indexOf("[")&&-1==t.indexOf("; ")&&!JSON.parse(t).length)return{code:"ERR02",message:Lyte.errorCodes.ERR02,value:t};var i=getcurrentFieldAtributes(e,this);return!(t&&!havevalidLength(i,t))||{code:"ERR06",message:Lyte.errorCodes.ERR06}}return!0})),Lyte.registerValidator("integerValidation",(function(e,t){if(t){var r=getcurrentFieldAtributes(e,this);return havevalidLength(r,t)?("PROBABILITY"!==r.columnName||t>=0&&t<=100)&&validationUtils.isValidInteger(String(t))||{code:"ERR03",message:Lyte.errorCodes.ERR03}:{code:"ERR06",message:Lyte.errorCodes.ERR06}}return!0})),Lyte.registerValidator("nonEmptyNoEmoji",(function(e,t){var r=Lyte.customValidator.emptyValueValidation.call(this,e,t);return!0===r&&/([\uD800-\uDBFF][\uDC00-\uDFFF])/.test(t)?{code:"EMOJI_PRESENT",message:"Emojies aren't allowed"}:r})),Lyte.registerValidator("basicFieldLengthValidator",(function(e,t){if(t){var r=getcurrentFieldAtributes(e,this);if(r&&["string","double","integer"].contains(r.type)&&!havevalidLength(r,t))return{code:"ERR06",message:Lyte.errorCodes.ERR06}}return!0})),Lyte.registerPattern("customEmail",/(^$)|(^([A-Za-z0-9._%\-'+/]+@[A-Za-z0-9.-]+\.[a-zA-Z]{2,22})$)/),Lyte.registerPattern("customWebsite",/(^$)|(^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$)/),store.registerModel("territory",{name:Lyte.attr("string"),reporting_to:Lyte.belongsTo("territory",{inverse:"children",serialize:"id"}),id:Lyte.attr("string"),children:Lyte.hasMany("territory",{inverse:"reporting_to"}),_children:Lyte.hasMany("territory",{inverse:"_children"}),users:Lyte.hasMany("user"),forecast_data:Lyte.hasMany("forecast_data")},{actions:{associated_users_count:{},deleted_associated_territories:{},associated_users:{}}}),store.registerAdapter("territory",{namespace:"crm/v2/settings",buildURL:function(e,t,r,i,a,s,o){return a=a.replace("territory","territories"),o&&o.version&&(a=a.replace("v2",o.version)),"action"===t&&"associated_users_count"===s&&o&&o.type&&(r.type=o.type),"action"===t&&"associated_users"===s&&(a=a.replace("/actions/associated_users","/users")),a},methodForRequest:function(e,t,r,i,a){return"action"!==t||"associated_users_count"!==a&&"deleted_associated_territories"!==a&&"associated_users"!==a?e:"GET"},reloadAll:function(e,t,r){return!(!r||!r.makeRequest)||(!(!t||!Object.keys(t).length)||!(e.length>0))},parseResponse:function(e,t,r,i){return"action"===e&&i&&i.users&&i.users.length>0&&store.pushPayload("user",i.users),i}}),store.registerSerializer("territory",{varPayloadKey:"territories",payloadKey:function(){return this.varPayloadKey},extractMeta:function(e){var t=e.info;return delete e.info,t},serialize:function(e){return[e]},normalizeResponse:function(e,t,r){return r}}),store.registerModel("forecast_data",{id:Lyte.attr("string"),Forecast_Name:Lyte.belongsTo("Forecast"),Parent_Item:Lyte.belongsTo("forecast_data"),children:Lyte.hasMany("forecast_data",{inverse:"children"}),users:Lyte.hasMany("forecast_data",{inverse:"users"}),User:Lyte.belongsTo("user"),Role:Lyte.belongsTo("role"),Territory:Lyte.belongsTo("territory"),Reporting_To:Lyte.belongsTo("user"),Forecast_Category:Lyte.attr("object"),Forecast_Quota:Lyte.attr("object")}),store.registerAdapter("forecast_data",{namespace:"crm/v2.2",buildURL:function(e,t,r,i,a){return a=a.replace("forecast_data","Forecasts/forecast_data")},headersForRequest:function(e,t,r){var i=this.$super.headersForRequest(e,t,r);return i.Accept="application/json",i["Content-type"]="application/json; charset=utf-8",i}}).extends("application"),store.registerSerializer("forecast_data",{payloadKey:function(e){return e}}),store.registerModel("filter",{id:Lyte.attr("string"),custom_view:Lyte.belongsTo("custom_view",{serialize:"record"}),criteria:Lyte.attr("object"),cross_filters:Lyte.attr("array"),name:Lyte.attr("string")}),store.registerAdapter("filter",{namespace:"crm/v2.2/settings",buildURL:function(e,t,r,i,a,s,o){return a=a.replace("/filter","/custom_views/"+o.cvid+"/filters"),"delete"!=t&&"deleteRecord"!=t||(r.ids=o.filter_id),"deleteRecord"==t&&(a=a.replace("/"+o.filter_id,"")),"findRecord"!=t&&(r.module=o.module),a},methodForRequest:function(e,t){return"delete"==t?"DELETE":"updateRecord"==t?"PUT":e}}),store.registerSerializer("filter",{normalizeResponse:function(e,t,r,i,a,s,o){if("create"==t){var n={};(n=r.filters[0].details).module_name=o&&o.module?o.module:"",n.count=void 0,r.filters=n}else if("updateRecord"==t){(n={}).id=r.filters[0].details.id,r.filters=n}else if("findAll"===t)for(var l=r.filters?r.filters.length:0,c=0;c<l;c++)r.filters[c].module_name=o&&o.module?o.module:"",r.filters[c].count=void 0;else"findRecord"==t&&r.filters&&r.filters[0]&&(r.filters[0].criteria=r.filters[0].criteria?r.filters[0].criteria:void 0,r.filters[0].cross_filters=r.filters[0].cross_filters?r.filters[0].cross_filters:void 0);return null==r&&(r={filter:[]}),this.$super.normalizeResponse(e,t,r)},serialize:function(e,t){if(t.filters=t.filter,delete t.filter,"updateRecord"==e){var r=t.filters;delete t.filters,t.filters=[],t.filters[0]=r}return t}}),store.registerModel("related_sort_info",{sort_by:Lyte.attr("string"),sort_order:Lyte.attr("string")}),store.registerModel("tab_group",{name:Lyte.attr("string"),modules:Lyte.hasMany("module"),profiles:Lyte.hasMany("profile"),default:Lyte.attr("boolean"),visible:Lyte.attr("string")}),store.registerAdapter("tab_group",{namespace:"crm/v2.2/settings",buildURL:function(e,t,r,i,a){return"updateRecord"==t&&(a=a.slice(0,a.lastIndexOf("/"))),a+"s"}}),store.registerSerializer("tab_group",{serializeKey:function(e){return e+"s"},serialize:function(e,t){return"updateRecord"==e&&(t.tab_groups=[t.tab_groups]),t},normalizeResponse:function(e,t,r,i,a){return"updateRecord"==t&&200==a&&(r.tab_groups={id:i}),r}}),store.registerModel("businesscard",{data:Lyte.attr("array"),fields:Lyte.attr("array")}),store.registerAdapter("businesscard",{headersForRequest:function(){var e={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken,"X-ZOHO-SERVICE":"crm/lookupTooltip"};return window.clientPortalName&&(e["X-CRMPORTAL"]=window.clientPortalName),"undefined"!=typeof crmZgid&&crmZgid&&(e["X-CRM-ORG"]=crmZgid),e},buildURL:function(e,t,r,i,a){return a=a.replace("businesscard",r.module),delete r.module,r.apply_fields||(r.apply_fields="business_card"),r.include||(r.include="fields"),a},reloadRecord:function(e){return!e}}),store.registerSerializer("businesscard",{normalizeResponse:function(e,t,r){if(void 0!==r.data){var i=r.data,a=r.fields,s=r.data[0].id;delete r.data,delete r.fields,r[e]={},r[e].id=s,r[e].data=i,r[e].fields=a}else r[e]={},r[e].id=void 0,r[e].data=i,r[e].fields=void 0;return r},payloadKey:function(e){return e}}),store.registerModel("zianotificationpanel",{id:Lyte.attr("string",{pattern:Lyte.patterns.numeric}),name:Lyte.attr("string"),created_by:Lyte.attr("object"),modified_by:Lyte.attr("object"),created_time:Lyte.attr("string"),modified_time:Lyte.attr("string"),favorite:Lyte.attr("boolean",{default:!1}),isDesktopNotyEnabled:Lyte.attr("boolean",{default:!1}),noNotification:Lyte.attr("boolean",{default:!0})},{actions:{mark_all_as_read:{},categorize:{}}}),store.registerAdapter("zianotificationpanel",{namespace:"crm/v2.2",buildURL:function(e,t,r,i,a,s){return a=a.replace("zianotificationpanel","__zia_notifications")},methodForRequest:function(e){return"PATCH"===e?"PUT":e}}),store.registerSerializer("zianotificationpanel",{payloadKey:function(e,t){if("findAll"===t||"findRecord"===t)return"__zia_notifications"},serialize:function(e,t){return"updateRecord"===e&&(t.__zia_notifications=[],t.__zia_notifications.push(t.zianotificationpanel),delete t.zianotificationpanel),t}}),store.registerModel("zia-notification-configuration",{desktop_notification_enabled:Lyte.attr("boolean",{default:!1}),unread_only:Lyte.attr("boolean",{default:!1})},{actions:{notification_configuration:{}}}),store.registerAdapter("zia-notification-configuration",{namespace:"crm/v2.2/settings/zia",buildURL:function(e,t,r,i,a){return a=a.replace("zia-notification-configuration/actions/notification_configuration","notification_configuration")},methodForRequest:function(e){return"PATCH"===e?"PUT":e}}),store.registerSerializer("zia-notification-configuration",{payloadKey:function(e,t){if("findAll"===t||"findRecord"===t)return"notification_configuration"},serialize:function(e,t){if("action"===e){var r={};void 0!==t.unread_only&&(r.unread_only=t.unread_only,delete t.unread_only),void 0!==t.desktop_notification_enabled&&(r.desktop_notification_enabled=t.desktop_notification_enabled,delete t.desktop_notification_enabled),t.zia_notification_configuration=r}return t}}),store.registerModel("prediction",{id:Lyte.attr("string",{pattern:Lyte.patterns.numeric}),name:Lyte.attr("string"),module:Lyte.belongsTo("module",{serialize:"record",inverse:"module"}),prediction_field:Lyte.belongsTo("field",{serialize:"record",inverse:"prediction_field"}),predict_field:Lyte.belongsTo("field",{serialize:"record",inverse:"predict_field"}),score_to:Lyte.belongsTo("field",{serialize:"record",inverse:"score_to"}),values:Lyte.attr("array"),value:Lyte.attr("boolean"),start_values:Lyte.attr("array"),contrary_values:Lyte.attr("array"),follow_up:Lyte.attr("boolean"),field_contributors:Lyte.hasMany("field",{serialize:"record",inverse:"field_contributors"}),sampling_criteria:Lyte.attr("object"),end_criteria:Lyte.attr("object"),active:Lyte.attr("boolean"),created_by:Lyte.attr("object"),modified_by:Lyte.attr("object"),created_time:Lyte.attr("string"),modified_time:Lyte.attr("string")},{actions:{migratenow:{},migratelater:{}}}),store.registerAdapter("prediction",{namespace:"crm/v2.2/settings/zia",buildURL:function(e,t,r,i,a,s){switch(s){case"migratenow":a=a.replace("settings/zia/prediction/actions/migratenow","__internal/settings/zia/predictions/actions/migration?migrate=now");break;case"migratelater":a=a.replace("settings/zia/prediction/actions/migratelater","__internal/settings/zia/predictions/actions/migration?migrate=later");break;default:a=a.replace("prediction","predictions")}return a},methodForRequest:function(e,t,r,i,a){return"PATCH"===e?"PUT":"migrate"===a?"POST":e}}),store.registerSerializer("prediction",{normalizeResponse:function(e,t,r,i,a){if("findRecord"===t||"findAll"===t)if(204===a)r.predictions=[];else for(var s=r.predictions.length,o=0;o<s;o++){if(void 0!==r.predictions[o].contribute){var n=r.predictions[o].contribute;delete r.predictions[o].contribute;for(var l=n.length,c=0;c<l;c++)r.predictions[o].field_contributors="fields"===n[c].type?n[c].contributors:[]}r.predictions[o].contrary_values=null===r.predictions[o].contrary_values?[]:r.predictions[o].contrary_values}else"createRecord"!==t&&"updateRecord"!==t||(r.predictions[0].details&&(r.predictions=r.predictions[0].details),"createRecord"===t?r.predictions.created_by={id:Crm.userDetails.USER_ID,name:Crm.userDetails.DISPLAY_NAME}:r.predictions.modified_by={id:Crm.userDetails.USER_ID,name:Crm.userDetails.DISPLAY_NAME},"createRecord"===t?r.predictions.created_time=Date.now():r.predictions.modified_time=Date.now());return r},serialize:function(e,t){if("createRecord"===e||"updateRecord"===e){if(t.prediction.module){var r={};r.id=t.prediction.module.id,r.api_name=t.prediction.module.api_name,t.prediction.module=r}var i=void 0!==t.prediction.predict_field?t.prediction.predict_field.ui_type:"updateRecord"===e?store.peekRecord("prediction",t.prediction.id).predict_field.ui_type:null;if(t.prediction.predict_field){var a={};a.id=t.prediction.predict_field.id,a.api_name=t.prediction.predict_field.api_name,t.prediction.predict_field=a}if(i!==CrmField.UITYPES.BOOLEAN_DEF&&i!==CrmField.UITYPES.BOOLEAN_DEF_NOT&&delete t.prediction.value,i!==CrmField.UITYPES.PICK_LIST&&i!==CrmField.UITYPES.STAGE&&delete t.prediction.values,t.prediction.field_contributors){for(var s=t.prediction.field_contributors.length,o=[],n={type:"fields"},l=[],c=0;c<s;c++){var d={};d.id=t.prediction.field_contributors[c].id,d.api_name=t.prediction.field_contributors[c].api_name,l.push(d)}n.contributors=l,o.push(n),t.prediction.contribute=o,delete t.prediction.field_contributors}"updateRecord"===e&&(void 0!==t.prediction.contrary_values&&0===t.prediction.contrary_values.length&&delete t.prediction.contrary_values,void 0!==t.prediction.sampling_criteria&&0===Object.keys(t.prediction.sampling_criteria).length&&(t.prediction.sampling_criteria={_delete:null}),void 0!==t.prediction.end_criteria&&0===Object.keys(t.prediction.end_criteria).length&&(t.prediction.end_criteria={_delete:null})),t.predictions=[],t.predictions.push(t.prediction),delete t.prediction}return t}}),store.registerModel("visions",{id:Lyte.attr("string"),name:Lyte.attr("string"),active:Lyte.attr("boolean"),vision_module:Lyte.belongsTo("module",{serialize:"record",inverse:"vision_module"}),criteria:Lyte.attr("object"),vision_fields:Lyte.belongsTo("field",{serialize:"record",inverse:"vision_fields"}),failure_action:Lyte.attr("array",{default:[{type:I18n.getMsg("crm.zia.vision.update.record"),key:"do_not_create"},{type:I18n.getMsg("crm.zia.vision.image.approve"),key:"image_approval"},{type:I18n.getMsg("crm.zia.vision.record.approve"),key:"record_approval"},{type:I18n.getMsg("crm.zia.vision.image.without"),key:"create_without_image"}]}),desired_set:Lyte.attr("object",{}),undesired_set:Lyte.attr("object",{}),training_details:Lyte.attr("object",{}),pattern_criteria:Lyte.attr("object",{}),action:Lyte.attr("object",{}),model_score:Lyte.attr("string"),validation_type:Lyte.attr("string"),layout:Lyte.attr("object")},{actions:{total_records:{},resubmit_record:{},approval_recordCount:{},record_approvals:{},approval_count:{},approval_counts:{},status:{},approvals:{},approval:{},approvals_images:{},reviews:{},delete_record:{},bulk_reviews:{}}}),store.registerAdapter("visions",{namespace:"crm/v2.2/",buildURL:function(e,t,r,i,a,s,o){switch(s){case"record_approvals":a=a.replace("visions/actions/record_approvals","settings/zia/visions/approvals");break;case"resubmit_record":a=a.replace("visions/actions/resubmit_record",o.moduleName+"/"+o.recordId+"/actions/vision_resubmit");break;case"approval_recordCount":a=a.replace("visions/actions/approval_recordCount","settings/zia/visions/approvals/actions/group_count");break;case"total_records":a=a.replace("visions/actions/total_records","settings/zia/visions/approvals/actions/total_records");break;case"approval_counts":a=a.replace("visions/actions/approval_counts","settings/zia/visions/approvals/actions/count");break;case"approval_count":a=a.replace("visions/actions/approval_count","settings/zia/visions/"+o.id+"/approvals/actions/count");break;case"status":a=a.replace("visions/actions/status","settings/zia/visions/"+o.id);break;case"approvals":a=a.replace("visions/actions/approvals","settings/zia/visions/"+o.id+"/approvals");break;case"approval":a=a.replace("visions/actions/approval","settings/zia/visions/"+o.id+"/approvals/"+o.approval_id);break;case"approvals_images":a=a.replace("visions/actions/approvals_images","settings/zia/visions/"+o.id+"/approvals");break;case"bulk_reviews":var n="record_approval"===o.failure_action?"vision_record_approvals":"vision_image_approvals";a=a.replace("visions/actions/bulk_reviews",o.moduleObj.api_name+"/"+o.recordObj.id+"/actions/"+n);break;case"delete_record":a=a.replace("visions/actions/delete_record",o.moduleObj.api_name+"/"+o.recordObj.id+"/actions/vision_record_approvals");break;case"reviews":a=a.replace("visions/actions/reviews","settings/zia/visions/approvals/"+o.id+"/actions/review");break;default:a=a.replace("visions","settings/zia/visions")}return a},methodForRequest:function(e,t,r,i,a){return"PATCH"===e?"PUT":"record_approvals"===a||"approval_recordCount"===a||"total_records"===a||"approval_counts"===a||"approval_count"===a||"approvals"===a||"approval"===a||"approvals_images"===a?"GET":"status"===a||"reviews"===a?"PUT":"resubmit_record"===a||"bulk_reviews"===a?"POST":"delete_record"===a?"DELETE":e}}),store.registerSerializer("visions",{normalizeResponse:function(e,t,r,i,a){if("createRecord"!==t&&"updateRecord"!==t||!r.visions[0]){if(("findRecord"===t||"findAll"===t)&&204===a)return r;if(("findAll"===t||"findRecord"===t)&&r.visions[0]){o=[];var s=[{type:"crm.zia.vision.update.record",key:"do_not_create"},{type:"crm.zia.vision.image.approve",key:"image_approval"},{type:"crm.zia.vision.record.approve",key:"record_approval"},{type:"crm.zia.vision.image.without",key:"create_without_image"}];r.visions.map((function(e,t){o[t]=e,o[t].vision_module=e.module,o[t].vision_fields=e.field,s.map((function(e){o[t].failure_action!==e.key||(o[t].action={type:e.type,key:e.key})})),o[t].failure_action=s,delete o[t].module,delete o[t].field})),(r={}).visions=o}}else{var o={};o=r.visions[0].details,(r={}).visions=o}return r},serialize:function(e,t,r,i,a,s,o){if("createRecord"===e||"updateRecord"===e){var n=[],l=objectUtils.cloneObject(t.visions);void 0!==l.vision_fields&&(l.field={id:l.vision_fields.id,api_name:l.vision_fields.api_name}),void 0!==l.vision_module&&(l.module={id:l.vision_module.id,api_name:l.vision_module.api_name}),void 0!==l.action&&(l.failure_action=l.action.key),"object_detection"!==r.validation_type?delete l.training_details:(delete l.desired_set,delete l.undesired_set),delete l.action,delete l.vision_fields,delete l.vision_module,n.push(l);var c={};return c.visions=n,c}return"status"===o?(t={}).visions=i.statusJson:"reviews"!==o&&"bulk_reviews"!==o||(t={},"record_approval"===i.failure_action?t.vision_record_approvals=i.reviewJson:t.vision_image_approvals=i.reviewJson),t},payloadKey:function(e){return e}}),store.registerModel("features",{api_name:Lyte.attr("string"),components:Lyte.attr("object"),details:Lyte.attr("object"),feature_label:Lyte.attr("string",{primaryKey:!0}),module_supported:Lyte.attr("boolean"),parent_feature:Lyte.attr("string")}),store.registerAdapter("features",{namespace:"crm/v2.1/",buildURL:function(e,t,r,i,a){return a=a.replace("features","__features")}}),store.registerSerializer("features",{payloadKey:function(){return"__features"},normalizeResponse:function(e,t,r){return r[this.payloadKey()]&&r.__features.forEach((e=>{(e.api_name=null)&&(e.apiname=e.parent_feature.apiname)})),r}}),store.registerModel("wizard",{id:Lyte.attr("string"),name:Lyte.attr("string"),module:Lyte.belongsTo("module",{serialize:"record"}),created_time:Lyte.attr("string"),modified_time:Lyte.attr("string"),modified_by:Lyte.attr("string"),created_by:Lyte.attr("string"),active:Lyte.attr("boolean"),profiles:Lyte.hasMany("profile",{serialize:"partial"}),containers:Lyte.hasMany("wizard-container",{serialize:"partial",deepNest:!0}),didLoad:function(e){e=this instanceof Record?this:e;var t,r=!1,i=!1,a=e.containers;a&&(e.layouts=[],a.forEach((function(a){e.layouts.push({id:a.layout.id,name:a.layout.name}),a.chart_data&&(a.chart_data.connections&&a.chart_data.connections.length&&!a.chart_data.screen_connections&&(a.chart_data.screen_connections={},a.chart_data.connections.forEach((function(e){a.chart_data.screen_connections[e.id]=e}))),a.chart_data.connections=[]),a.screens&&(a.fields=[],a.field_array=[],a.custom_buttons_array=[],a.screens.forEach((function(s){s.segments=s.segments||[],s.segments.forEach((function(s){switch(s.type){case"subforms":var o={};if(o.id=Lyte.attr("string"),r=!1,i=!1,s.fields.forEach((function(e){"subform"==e.data_type?(r=!0,t=e.subform.id,a.fields.push(e.api_name),a.field_array.push(e)):e.subform||(o[e.api_name]=Lyte.attr(Lyte.registeredMixins["crm-module-mixin"].getfieldattributeType(e)),o[e.api_name].fieldID=e.id,o[e.api_name].uiType=e.ui_type,o[e.api_name].columnName=e.column_name,o[e.api_name].fieldType=e.data_type,o[e.api_name].length=e.length,"SERIAL_NUMBER"==e.column_name&&(i=!0))})),!store.model[t]&&r&&e.module){var n={};n.__parent_module__=Lyte.belongsTo(e.module.id),store.registerModel(t,n,{extends:"entity"})}if(store.model[t]&&r&&Lyte.Component.registeredHelpers.isNotEmpty(o))for(var l in i||(o.__CUSTOM_sequence_NUMBER__={type:"string"}),o.removedRow={type:"string"},o)store.addField(t,l,o[l].type,o[l]);break;case"fields":s.fields&&s.fields.forEach((function(e){a.fields.push(e.api_name),a.field_array.push(e)}));break;case"buttons":s.buttons.forEach((function(e){if(e.hide=!1,e.category||(e.category="wizard_button"),"custom_button"===e.category&&a.custom_buttons_array.push(e.id),e.target_screen&&!validationUtils.isEmpty(e.target_screen)){var t={};t.target_screen=e.target_screen,t.source_button={id:e.id,display_label:e.display_label},a.chart_data.connections.push(t)}}))}}))})))})))}.on("add")}),store.registerAdapter("wizard",{namespace:"crm/v2.2/settings",headersForRequest:function(e,t,r){var i={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken,"X-CRM-ORG":crmZgid};return r&&r.headers&&r.headers["X-CRM-ORG"]&&(i["X-CRM-ORG"]=r.headers["X-CRM-ORG"]),i},buildURL:function(e,t,r,i,a,s,o){if(o&&o.hostUrl&&o.hostUrl.url)if((a=o.hostUrl.url).match("sandbox/diff")||a.match("production/diff")){n=a.split("diff/").pop().split("v2.2/")[0];a=a.replace(n,"")}else{var n=a.split("crm/").pop().split("v2.2/")[0];a=a.replace(n,"")}else a=a.replace("wizard","wizards");return a}}),store.registerSerializer("wizard",{normalizeResponse:function(e,t,r){if(!r)return null;if(!r.wizards)return r.wizard=[],r;if(r.wizard=r.wizards,r.wizard[0]&&r.wizard[0].code&&"error"!==r.wizard[0].status)r.wizard=r.wizard[0].details;else if("findAll"===t||"findRecord"===t){var i=this;r.wizards.forEach((function(e){e=i.payLoadHandler(e);var t=store.peekRecord("wizard",e.id),r=[];t&&t.containers&&(r=t.containers.map((function(e){return e.id}))),t&&(e.containers.forEach((function(t){if(!r.contains(t.layout.id))var i={id:t.layout.id,name:t.layout.name,wizard:[e.id],layout:t.layout};store.pushPayload("wizard-container",i||t)})),delete e.containers)})),r.wizard=r.wizards}return delete r.wizards,r},serialize:function(e,t){if("deleteRecord"!=e){if("createRecord"==e&&(t.wizard.active=!0,t.wizard.module={id:t.wizard.module.id,api_name:t.wizard.module.api_name}),t.wizard.hasOwnProperty("profiles")){var r=[];t.wizard.profiles.forEach((function(e){var t=store.peekRecord("profile",e.id);"removed"==e.$.partialType?r.push({id:t.id,_delete:!0}):r.push({id:t.id,name:t.name})})),delete t.wizard.profiles,t.wizard.profiles=r}t.wizard.hasOwnProperty("containers")&&t.wizard.containers.forEach((function(t){var r=store.peekRecord("wizard-container",t.$.pK);"removed"!=t.$.partialType?(r.layout&&(t.layout={id:r.layout.id,name:r.layout.name}),t.screens&&t.screens.forEach((function(t){"removed"===t.$.partialType?t._delete=!0:(t.hasOwnProperty("active")&&delete t.active,"added"===t.$.partialType?t.reference_id=Lyte.Component.registeredHelpers.returnReferenceFormat(t.$.pK):"removed"===t.$.partialType?t.id=t.$.pK:"modified"===t.$.partialType&&1==Object.keys(t).length&&(t.sequence_number=store.peekRecord("wizard-screen",t.$.pK).sequence_number,t.id=t.$.pK),t.segments&&t.segments.forEach((function(t){if("removed"===t.$.partialType?t.id=t.$.pK:"modified"===t.$.partialType&&1==Object.keys(t).length&&(t.sequence_number=store.peekRecord("wizard-segment",t.$.pK).sequence_number,t.id=t.$.pK),"removed"===t.$.partialType)t._delete=!0;else if("added"===t.$.partialType||"modified"===t.$.partialType){var r=store.peekRecord("wizard-segment",t.$.pK);if("fields"===r.type){var i=[];(t.fields||null!=t.fieldReorder)&&(t.fields=t.fields||[],t.fields.forEach((function(e){if(!r.$.isNew&&"removed"===e.$.partialType&&(i.push({id:e.id,_delete:!0}),"First_Name"===store.peekRecord("field",e.id).api_name)){var t=store.peekAll("field").filter((function(e){return"Salutation"===e.api_name})),a=t&&t.length?t[0]:void 0;a&&i.push({id:a.id,_delete:!0})}})),r.fields.forEach((function(e){if(e[t.$.pK].sequence_number!=e[t.$.pK].orig_sequence_number){if("First_Name"===e.api_name){var r=store.peekAll("field").filter((function(e){return"Salutation"===e.api_name})),a=r&&r.length?r[0]:void 0;a&&i.push({id:a.id,api_name:a.api_name,sequence_number:e[t.$.pK].sequence_number})}var s={id:e.id,api_name:e.api_name,sequence_number:e[t.$.pK].sequence_number};if("Salutation"===e.api_name)return;i.push(s)}}))),delete t.fieldReorder,delete t.buttons,delete t.fields,delete t.fieldsClone,delete t.content,i.length>0?t.fields=i:"createRecord"==e&&(t.fields=null)}else if("subforms"===r.type){i=[];(t.fields||r.$.isNew)&&r.fields.forEach((function(e){if(500===e.ui_type){var t=store.peekRecord("field",e.id);i.push({id:t.id,api_name:t.api_name,sequence_number:1})}})),r.$.isNew&&(t.reference_id=Lyte.Component.registeredHelpers.returnReferenceFormat(r.$.pK)),delete t.buttons,delete t.fields,delete t.content,i.length?t.fields=i:"createRecord"==e&&(t.fields=null)}else"buttons"===r.type?(t.buttons&&t.buttons.forEach((function(t){if(t.hasOwnProperty("selected")&&delete t.selected,"removed"===t.$.partialType)t._delete=!0;else{t.$.isNew?t.reference_id=Lyte.Component.registeredHelpers.returnReferenceFormat(t.$.pK):t.id=t.$.pK,t.hasOwnProperty("criteria")&&validationUtils.isEmpty(t.criteria)&&(t.$.isNew||"added"==t.$.partialType?delete t.criteria:t.criteria=null);var r=store.peekRecord("wizard-button",t.$.pK);if(t.visibility&&"show"==t.visibility&&r.criteria&&("createRecord"==e?delete t.criteria:t.criteria=null),t.criteria&&!t.visibility&&(t.visibility=r.visibility),r.transition&&r.transition.Id){t.transition={id:r.transition.Id,name:r.transition.Name};var i=store.peekRecord("transition",r.transition.Id);if(i&&i.Actions){var a=wizardTransitionHandler.getAssociatedActions(r.transition.Id);0==a.Alert.length&&0==a.Deluge.length&&0==a.Webhook.length&&(t.transition={id:r.transition.Id,_delete:!0})}}if(r.target_screen&&!validationUtils.isEmpty(r.target_screen)){var s=store.peekRecord("wizard-screen",r.target_screen.$.pK);r.target_screen.$.isNew?t.target_screentemp={reference_id:Lyte.Component.registeredHelpers.returnReferenceFormat(s.$.pK),display_label:s.display_label}:t.target_screentemp={id:s.$.pK,display_label:s.display_label},t.target_screen=t.target_screentemp,delete t.target_screentemp}}})),delete t.fields,delete t.content):r.$.isNew&&"widget"===r.type&&(t.widget={},t.widget.id=r.widget.widgets_id,t.widget.name=r.widget.name,delete t.widget.widgets_id)}})),t.conditional_rules&&t.conditional_rules.forEach((function(e){"removed"!==e.$.partialType?e.actions&&e.actions.forEach((function(e){var t=store.peekRecord("wizard-conditional-action",e.$.pK);if("removed"===e.$.partialType)e._delete=!0;else if("added"===e.$.partialType&&"show_subforms"===e.type){store.peekRecord("wizard-segment",t.segment.$.pK).$.isNew&&(e.segment.reference_id=Lyte.Component.registeredHelpers.returnReferenceFormat(e.segment.$.pK))}})):e._delete=!0})))})),t.chart_data={},t.chart_data.nodes=[],t.chart_data.connections=[],r.chart_data.nodes.forEach((function(e){var r;r=e.screen.id?store.peekRecord("wizard-screen",e.screen.id):store.peekRecord("wizard-screen",Lyte.Component.registeredHelpers.returnActualId(e.screen.reference_id));var i={};i.pos_x=e.pos_x,i.pos_y=e.pos_y,i.start_node=e.start_node,r.$.isNew?i.screen={reference_id:Lyte.Component.registeredHelpers.returnReferenceFormat(r.id),display_label:e.screen.display_label}:i.screen={id:r.id,display_label:e.screen.display_label},t.chart_data.nodes.push(i)})),r.chart_data.connections.forEach((function(e){var r={},i={},a={};e.transition&&e.transition.transition_id&&(a.transition=e.transition),r=(i=e.source_button.id?store.peekRecord("wizard-button",e.source_button.id):store.peekRecord("wizard-button",Lyte.Component.registeredHelpers.returnActualId(e.source_button.reference_id))).$.isNew?{reference_id:Lyte.Component.registeredHelpers.returnReferenceFormat(i.$.pK),display_label:e.source_button.display_label}:{id:i.id,display_label:e.source_button.display_label},a.source_button=r;var s,o={};(s=e.target_screen.id?store.peekRecord("wizard-screen",e.target_screen.id):store.peekRecord("wizard-screen",Lyte.Component.registeredHelpers.returnActualId(e.target_screen.reference_id))).$.isNew?o.reference_id=Lyte.Component.registeredHelpers.returnReferenceFormat(s.$.pK):o.id=s.id,o.display_label=s.display_label,a.target_screen=o,t.chart_data.connections.push(a)}))):(t.layout={id:t.id,_delete:!0},delete t.id)}))}return{wizards:[t.wizard]}},payloadKey:function(e,t){if("findAll"==t||"findRecord"==t)return e},payLoadHandler:function(e){return e.hasOwnProperty("containers")&&e.containers.forEach((function(e){e.screens&&e.screens.forEach((function(e){e.segments.forEach((function(e){"fields"==e.type||"subforms"==e.type?(store.addField("field",e.id,"object"),e.fieldsClone=[],e.fields.forEach((function(t){t[e.id]={sequence_number:t.sequence_number,orig_sequence_number:t.sequence_number},e.fieldsClone.push(t)}))):"buttons"==e.type?e.buttons.forEach((function(e){e.transition&&e.transition.id&&(store.pushPayload("transition",{Id:e.transition.id,Name:e.transition.name,button:e.id}),delete e.transition)})):"widget"===e.type&&(e.widget.widgets_id=e.widget.id,store.pushPayload("widget",e.widget))}))})),e.chart_data&&!e.chart_data.connections&&(e.chart_data.connections=[])})),e}}),Lyte.Component.registerHelper("returnReferenceFormat",(function(e){return"{{"+e+"}}"})),Lyte.Component.registerHelper("returnActualId",(function(e){return e.replace("{{","").replace("}}","")})),store.registerModel("wizard-container",{id:Lyte.attr("string"),layout:Lyte.belongsTo("layout",{serialize:"partial"}),screens:Lyte.hasMany("wizard-screen",{serialize:"partial",deepNest:!0}),wizard:Lyte.hasMany("wizard"),chart_data:Lyte.attr("object")}),store.registerModel("wizard-screen",{id:Lyte.attr("string"),reference_id:Lyte.attr("string"),display_label:Lyte.attr("string"),segments:Lyte.hasMany("wizard-segment",{serialize:"partial",deepNest:!0}),container:Lyte.belongsTo("wizard-container"),button:Lyte.hasMany("wizard-button"),conditional_rules:Lyte.hasMany("wizard-conditional-rule",{serialize:"partial",deepNest:!0}),conditional_actions:Lyte.hasMany("wizard-conditional-action"),_displaylabelObserver:function(){this.name=this.display_label}.observes("display_label").on("init")}),store.registerModel("wizard-segment",{id:Lyte.attr("string"),sequence_number:Lyte.attr("number"),type:Lyte.attr("string"),display_label:Lyte.attr("string"),name:Lyte.attr("string"),fieldReorder:Lyte.attr("boolean"),column_count:Lyte.attr("number"),widget:Lyte.belongsTo("widget"),fields:Lyte.hasMany("field",{serialize:"partial",deepNest:!0}),fieldsClone:Lyte.hasMany("field"),content:Lyte.attr("string",{default:""}),buttons:Lyte.hasMany("wizard-button",{serialize:"partial",deepNest:!0}),screen:Lyte.belongsTo("wizard-screen"),conditional_actions:Lyte.hasMany("wizard-conditional-action"),didLoad:function(){var e=this instanceof Record?this:e;"fields"===e.type&&(e.fieldsClone||store.pushPayload("wizard-segment",{id:e.id,fieldsClone:[]}),e.fields.forEach((function(t){e.fieldsClone.add(t)})))}.on("init"),_displaylabelObserver:function(){this.name=this.display_label}.observes("display_label").on("init")}),store.registerModel("wizard-button",{id:Lyte.attr("string"),reference_id:Lyte.attr("string"),sequence_number:Lyte.attr("number"),display_label:Lyte.attr("string"),criteria:Lyte.attr("object"),target_screen:Lyte.belongsTo("wizard-screen"),type:Lyte.attr("string"),category:Lyte.attr("string"),resource:Lyte.attr("object"),message:Lyte.attr("object"),color:Lyte.attr("string"),background_color:Lyte.attr("string"),shape:Lyte.attr("string"),transition:Lyte.belongsTo("transition"),visibility:Lyte.attr("string"),segment:Lyte.belongsTo("wizard-segment")}),store.registerModel("transition",{Id:Lyte.attr("string",{primaryKey:!0}),Name:Lyte.attr("string"),LayoutId:Lyte.attr("string"),Module:Lyte.attr("string"),Actions:Lyte.attr("object"),button:Lyte.belongsTo("wizard-button")}),store.registerModel("wizard-conditional-rule",{query_id:Lyte.attr("string",{primaryKey:!0}),criteria:Lyte.attr("object"),screen:Lyte.belongsTo("wizard-screen"),actions:Lyte.hasMany("wizard-conditional-action",{serialize:"partial",deepNest:!0})}),store.registerModel("wizard-conditional-action",{id:Lyte.attr("string"),rule:Lyte.belongsTo("wizard-conditional-rule"),type:Lyte.attr("string"),field:Lyte.belongsTo("field",{serialize:"partial",deepNest:!0}),segment:Lyte.belongsTo("wizard-segment",{serialize:"partial",deepNest:!0}),screen:Lyte.belongsTo("wizard-screen")}),store.registerModel("global-search",{}),store.registerAdapter("global-search",{namespace:"crm/v2",buildURL:function(e,t,r,i,a){return r.meta_resources&&(a=a.replace("crm/v2","crm/v2/settings")),a.replace(e,"search")}}),store.registerSerializer("global-search",{payloadKey:function(){return"data"}}),store.registerModel("dummy",{}),store.registerAdapter("dummy",{buildURL:function(e,t,r,i,a,s,o){return a="/"===o.url[0]?a.slice(0,a.indexOf("/",8))+o.url:a.slice(0,a.indexOf("/",8)+1)+o.url},methodForRequest:function(e,t,r,i){return i.method?i.method:"PATCH"===e?"PUT":e},headersForRequest:function(e,t,r){var i=r.customHeadersOnly?{}:this.$super.headersForRequest(),a=r?r.headers:void 0;if(r.hasOwnProperty("contentType")&&(i["Content-Type"]=r.contentType),a)for(var s in a)i[s]=a[s];return i}}),store.registerSerializer("dummy",{payloadKey:function(e){return e},serialize:function(e,t,r,i){var a=i.formData;if(i.payLoad)return i.payLoad;if(a){var s=[];for(var o in a)s.push(encodeURIComponent(o)+"="+encodeURIComponent(a[o]));return s=s.join("&")}},normalizeResponse:function(e,t,r,i,a,s,o,n){if(r&&null!=n&&("POST"===n.method||"PUT"===n.method||"DELETE"===n.method)&&!r.dummy){var l={};return r.id="dummy",l.dummy=r,l}if(r&&void 0!==n&&n.hasOwnProperty("workflow_rules")&&!r.dummy){l={};return r.id="dummy",l.dummy=r,l}return r}}),store.registerModel("servapp_preferences",{services:Lyte.attr("object"),appointments:Lyte.attr("object")}),store.registerAdapter("servapp_preferences",{namespace:"crm/v3/settings",buildURL:function(e,t,r,i,a,s,o){if(("findAll"===t||"update"===t)&&o&&o.module&&("Services"===o.module||"Appointments"===o.module)){var n=("Services"===o.module?"service":"appointment")+"_preferences";a=a.replace(e,n)}return a},reloadAll:function(e,t,r){if(r&&r.module&&("Services"===r.module||"Appointments"===r.module)&&!r.reloadAll){var i=store.peekAll("servapp_preferences");if(i.length>0&&i[0][r.module.toLowerCase()])return!1}return!0},methodForRequest:function(e){return"PATCH"===e?"PUT":e}}),store.registerSerializer("servapp_preferences",{normalizeResponse:function(e,t,r){if("findAll"===t&&r&&(r.service_preferences||r.appointment_preferences)){r.servapp_preferences=[{}];var i=store.peekRecord("servapp_preferences","1");i&&(r.servapp_preferences[0]=i.$.toJSON()),r.service_preferences?(r.servapp_preferences[0].services=r.service_preferences,delete r.service_preferences):r.appointment_preferences&&(r.servapp_preferences[0].appointments=r.appointment_preferences,delete r.appointment_preferences),r.servapp_preferences[0].id=1}return r},serialize:function(e,t,r,i){return"update"===e&&i&&i.module&&("Services"===i.module?(t.service_preferences=[],t.service_preferences=t.servapp_preferences[0].services):"Appointments"===i.module&&(t.appointment_preferences=[],t.appointment_preferences=t.servapp_preferences[0].appointments),delete t.servapp_preferences),t},payloadKey:function(){return"servapp_preferences"}}),store.registerModel("note",{id:Lyte.attr("string",{primaryKey:!0}),Parent_Id:Lyte.attr("object"),$se_module:Lyte.attr("string"),Note_Title:Lyte.attr("string"),Note_Content:Lyte.attr("string"),$attachments:Lyte.attr("array"),$is_shared_to_client:Lyte.attr("boolean")}),store.registerAdapter("note",{namespace:"crm/v2",buildURL:function(e,t,r,i,a,s,o){var n=e[0].toUpperCase()+e.substr(1)+"s";return a=a.replace(e,n),"findAll"===t?o&&(a=a.replace(n,""),a+=o.module+"/"+o.entityId+"/"+n):"deleteRecord"===t?a=(a=a.slice(0,a.lastIndexOf("/")))+"?ids="+o.noteId:"updateRecord"===t&&o.removeAttachment&&(a+="/Attachments?ids="+o.ids),a},methodForRequest:function(e,t,r,i){return"PATCH"===e&&(e="PUT"),"updateRecord"===t&&i.removeAttachment&&(e="DELETE"),e}}),store.registerSerializer("note",{normalizeResponse:function(e,t,r){return r[e]=r.data,"createRecord"!==t&&"updateRecord"!==t||(r.data=r.data[0].details),r},serialize:function(e,t,r){return r.entity&&delete r.entity,t.data=[r],t},serializeKey:function(){return"data"},payloadKey:function(){return"data"}}),store.registerModel("reviewprocess",{process:Lyte.attr("array"),active:Lyte.attr("boolean"),sequence_number:Lyte.attr("number"),name:Lyte.attr("string"),description:Lyte.attr("string"),criteria:Lyte.attr("object"),layout:Lyte.attr("object"),rules:Lyte.attr("array"),actions:Lyte.attr("object"),reason_for_rejection:Lyte.attr("array"),module:Lyte.attr("string"),id:Lyte.attr("string"),isJobRunning:Lyte.attr("boolean")},{actions:{count:{},records_count:{},active:{}}}),store.registerAdapter("reviewprocess",{namespace:"crm/v2.1/settings/review_process",buildURL:function(e,t,r,i,a,s,o){return a="updateRecord"===t?a.substring(0,a.indexOf("/reviewprocess/")):a.replace("/reviewprocess",""),"deleteRecord"===t&&o?o.action_on_record?a+="/actions/active?module="+o.module+"&action_on_record="+o.action_on_record:a+="?module="+o.module:o&&(a+="?module="+o.module),a},methodForRequest:function(e){return"PATCH"===e?"PUT":e}}),store.registerSerializer("reviewprocess",{serialize:function(e,t){var r={};return r.review_process="update"!==e?[t.reviewprocess]:t.reviewprocess,r},normalizeResponse:function(e,t,r,i,a,s,o){if("findAll"===t||"findRecord"===t){var n=r.review_process;if(n){for(var l=n.length,c=0;c<l;c++){n[c].layout.fieldCount=n[c].layout.fields.length;var d=Utils.ISO8601toDateObject(n[c].created_time);n[c].created_by.created_display_date=Utils.getDateInUserDatePattern(d),n[c].created_by.created_display_time=Utils.getTimeInUserFormat(d,!0),n[c].created_by.image_src="//"+RebrandLinkUtil.getProperty("CONTACTS_URL")+"/file?ID="+n[c].created_by.zuid+"&fs=thumb"}r.reviewprocess=r.review_process,("findRecord"!==t&&!o.isFromNameValid||o.per_page)&&store.unloadAll("reviewprocess")}else"findAll"!==t?(r.reviewprocess=r,r.id="123456"):(o.isFromNameValid||store.unloadAll("reviewprocess"),r.reviewprocess=r)}else"updateRecord"!==t&&"createRecord"!==t&&"update"!==t||(r.reviewprocess=r.review_process[0],r.reviewprocess.id=r.reviewprocess.details.id,r.reviewprocess.rules={},r.reviewprocess.rules.id="12345");return r},payloadKey:function(){return"reviewprocess"}}),Lyte.Component.register("crm-user-autocomplete-wrapper",{_template:'<template tag-name="crm-user-autocomplete-wrapper"> <crux-user-dropdown id="{{idVal}}" class="{{classVal}}" cx-prop-type="single"> </crux-user-dropdown> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}],_observedAttributes:["idVal","classVal","uiType"],data:function(){return{idVal:Lyte.attr("string"),classVal:Lyte.attr("string"),uiType:Lyte.attr("string")}}}),store.registerModel("pipeline",{id:Lyte.attr("string"),layout_id:Lyte.attr("string"),pick_list_values:Lyte.hasMany("pick_list_values",{serialize:"partial",deepNest:!0})},{actions:{transfer:{},associated:{}}}),store.registerAdapter("pipeline",{namespace:"crm/v2/settings",buildURL:function(e,t,r,i,a,s,o){"updateRecord"!==t&&"createRecord"!==t||"updateRecord"===t&&((n=a.split("/")).deleteElementAt(n.length-1),a=n.join("/"));if("associated"==s){var n=a.split("pipeline");a=n.join("pipeline/"+o.pipeline_id)}return a},methodForRequest:function(e,t,r,i,a){return"associated"==a?"GET":e},parseResponse:function(e,t,r,i,a){return i=this.super(arguments),("findAll"==e||"findRecord"==e)&&i&&i.pipeline&&0!=i.pipeline.length&&(i.pipeline[0].layout_id=a.layout_id),i}}),store.registerSerializer("pipeline",{serialize:function(e,t,r,i,a,s,o){if(this.delete=!1,("updateRecord"===e||"createRecord"===e)&&t.pipeline){var n=t.pipeline;if(t.pipeline=[],t.pipeline.push(n),"updateRecord"===e){var l=n.pick_list_values,c=l.length;if(1===c&&"modified"===l[0].$.partialType&&i.isStageDeleted){for(var d=r.pick_list_values.filterBy({id:l[0].id})[0].maps,u=d.length,m=0;m<u;m++)if(d[m].hasOwnProperty("_delete")){Lyte.arrayUtils(r.pick_list_values.filterBy({id:l[0].id})[0].maps,"removeAt",m,u-m);break}}else 2===c&&(i.isDefaultChanged?Lyte.arrayUtils(l,"removeObjects",l.filter((function(e){return!e.default}))):i.isDefaultDeleted&&Lyte.arrayUtils(l,"removeObjects",l.filter((function(e){return e.default}))));"removed"===l[0].$.partialType&&(this.delete=!0,Lyte.objectUtils(l[0],"add",{maps:[],display_value:store.peekRecord("pick_list_values",l[0].id).display_value,_delete:{permanent:null}})),l[0].display_value=l[0].display_value?l[0].display_value:r.pick_list_values.filterBy({id:l[0].id})[0].display_value}}return"transfer"==o&&(t=i),t},normalizeResponse:function(e,t,r,i,a){return"updateRecord"!==t&&"createRecord"!==t||(r.pipeline=r.pipeline[0],r.pipeline.id=r.pipeline.details.id,r.pipeline.pick_list_values=r.pipeline.details.pick_list_values,this.delete&&(delete r.pipeline.pick_list_values,this.delete=!1)),"findAll"!==t&&"findRecord"!==t||204!==a||(r.pipeline=[]),r},payloadKey:function(e){return e}}),store.registerModel("pick_list_values",{display_value:Lyte.attr("string",{mandatory:!0,validation:"validateName"}),actual_value:Lyte.attr("string"),id:Lyte.attr("string"),maps:Lyte.attr("array",{minLength:1}),default:Lyte.attr("boolean"),pipeline:Lyte.belongsTo("pipeline")}),Lyte.registerValidator("validateName",(function(e,t){return store.setErrorMessages({SPL_CHAR:I18n.getMsg("crm.pipeline.alert.special.character"),MAX_LENGTH:I18n.getMsg("crm.massmail.limit.title")}),splCharCheckNew(t)?!(t.length>120)||"MAX_LENGTH":"SPL_CHAR"})),store.registerModel("shift_hour",{break_hours:Lyte.attr("array"),details:Lyte.attr("array"),holiday:Lyte.attr("array"),id:Lyte.attr("string"),name:Lyte.attr("string"),same_as_everyday:Lyte.attr("boolean"),shift_days:Lyte.attr("array"),timezone:Lyte.attr("string"),users:Lyte.hasMany("user",{serialize:"partial"})}),store.registerAdapter("shift_hour",{namespace:"crm/v2/settings/business_hours",methodForRequest:function(e){return"PATCH"===e?"PUT":e}}),store.registerSerializer("shift_hour",{serialize:function(e,t){return t.shift_hours=[t.shift_hour],delete t.shift_hour,t},weekDays:[I18n.getMsg("Sunday"),I18n.getMsg("Monday"),I18n.getMsg("Tuesday"),I18n.getMsg("Wednesday"),I18n.getMsg("Thursday"),I18n.getMsg("Friday"),I18n.getMsg("Saturday")],normalizeResponse:function(e,t,r,i,a){if("updateRecord"===t&&200===a){var s=r.shift_hours[0].details?r.shift_hours[0].details.id:"";delete r.shift_hours,r.shift_hours={id:s}}else 204===a&&(r[e]=void 0);var o=store.peekRecord("user",Crm.userDetails.USER_ID);if(("findAll"===t||"findRecord"===t)&&r.shift_hours&&o){function n(e,t,r){return"0"===t||"00"===t?"12"+r+" "+I18n.getMsg("AM"):t>12?(t-12<10?"0"+(t-12):t-12)+r+" "+I18n.getMsg("PM"):e+" "+I18n.getMsg("AM")}function l(e){for(var t=e.length,r=1;r<t;r++)if(e[r]&&this.weekDays.indexOf(I18n.getMsg(e[r]))!==this.weekDays.indexOf(I18n.getMsg(e[r-1]))+1)return!1;return!0}function c(e,t){for(var r,i,a=[],s=0,c=e.length+2,d=1,u=0;d<c&&(d!==c-1&&l.call(this,e.slice(s,d))||(d=d===c-1?d:d-1,a[u]={days:e.slice(s,d)},o.time_format.indexOf("a")>-1?(r=n(t[0],t[0].slice(0,t[0].indexOf(":")),t[0].slice(t[0].indexOf(":"))),i=n(t[1],t[1].slice(0,t[1].indexOf(":")),t[1].slice(t[1].indexOf(":"))),a[u].workHour=" ("+r+" - "+i+")"):a[u].workHour=" ("+t[0]+" - "+t[1]+")",u++,s=d,!(d>c-2)));d++);var m=a.length;for(d=0;d<m;d++)a[d].shiftInterval=a[d].days.length>1?I18n.getMsg(a[d].days[0])+" - "+I18n.getMsg(a[d].days[a[d].days.length-1]):I18n.getMsg(a[d].days[0]);return a}var d,u,m,p,g,f,h,y=r.shift_hours,v=y.length;if(y&&y[0]&&"error"!==y[0].status)for(var _=0;_<v;_++){if(y[_].continuousWorkDays=l.call(this,y[_].shift_days),y[_].continuousWorkDays?y[_].shiftInterval=y[_].shift_days.length>1?I18n.getMsg(y[_].shift_days[0])+" - "+I18n.getMsg(y[_].shift_days[y[_].shift_days.length-1]):I18n.getMsg(y[_].shift_days[0]):!y[_].continuousWorkDays&&y[_].same_as_everyday&&(y[_].nonContinuousWorkDays=c.call(this,y[_].shift_days,y[_].details)),p=y[_].details,o.time_format.indexOf("a")>-1&&y[_].same_as_everyday)d=n(p[0],p[0].slice(0,p[0].indexOf(":")),p[0].slice(p[0].indexOf(":"))),u=n(p[1],p[1].slice(0,p[1].indexOf(":")),p[1].slice(p[1].indexOf(":"))),y[_].workHour=" ("+d+" - "+u+")";else if(-1===o.time_format.indexOf("a")&&y[_].same_as_everyday)y[_].workHour=" ("+p[0]+" - "+p[1]+")";else if(o.time_format.indexOf("a")>-1&&!y[_].same_as_everyday){g=p.length;for(var b=0;b<g;b++)f=p[b].shift_timing[0],h=p[b].shift_timing[1],d=n(f,f.slice(0,f.indexOf(":")),f.slice(f.indexOf(":"))),u=n(h,h.slice(0,h.indexOf(":")),h.slice(h.indexOf(":"))),p[b].workHour=" ("+d+" - "+u+")"}else{g=p.length;for(b=0;b<g;b++)p[b].workHour=" ("+p[b].shift_timing[0]+" - "+p[b].shift_timing[1]+")"}m=y[_].users?y[_].users.length:0;for(b=0;b<m;b++)y[_].users[b].effective_from?y[_].users[b].effective_shift_hour=y[_].id:y[_].users[b].current_shift_hour=y[_].id}}return r}}),Lyte.Component.register("crm-trigger-error",{_template:'<template tag-name="crm-trigger-error" id="triggerErrorModal"> <lyte-modal lt-prop-show="false" lt-prop-offset="{&quot;top&quot;:&quot;0px&quot;,&quot;left&quot;:&quot;center&quot;}" lt-prop-width="950px" lt-prop-scrollable="false" on-close="{{method(\'removeElement\')}}"> <template is="registerYield" yield-name="modal"> <lyte-modal-header class="grayBg f20 color_1"> {{getI18n(\'crm.import.skipped.records\')}} <span class="f12" id="trigHeaderRecCount">{{getI18n(\'crm.workflow.convert.skipped.msg\',totalRecordCount,skippedRecordCount)}}</span> </lyte-modal-header> <lyte-modal-content> <lyte-search lt-prop-query-selector="{&quot;scope&quot; : &quot;lyte-tbody&quot;, &quot;search&quot; : &quot;lyte-td:first-of-type&quot;, &quot;target&quot; : &quot;lyte-tr&quot;}" lt-prop-autofocus="true" lt-prop-placeholder="Search" lt-prop-style="box" on-search="{{method(\'error\')}}"> </lyte-search> <lyte-table lt-prop-yield="true" class="w100per trigErrorTable pT15" lt-prop-scroll="{&quot;horizontal&quot; : false, &quot;vertical&quot; : true}" style="{{if(height,height,\'\')}}"> <template is="registerYield" yield-name="yield"> <lyte-table-structure class="bdrTop"> <lyte-thead> <lyte-tr> <lyte-th class="whiteBg w40per"> {{getI18n(\'crm.label.record.name\')}} </lyte-th> <lyte-th class="whiteBg"> {{getI18n(\'crm.wf.reason.label\')}} </lyte-th> </lyte-tr> </lyte-thead> <lyte-tbody> <template is="for" items="{{skippedRecords}}" item="item" index="index"> <lyte-tr> <lyte-td> <a href="{{getCrmBasePath()}}/tab/{{module}}/{{item.id}}" target="_blank"> {{item.name}} </a> </lyte-td> <lyte-td> {{item.reason}} </lyte-td> </lyte-tr> </template> </lyte-tbody> </lyte-table-structure> </template> </lyte-table> </lyte-modal-content> <lyte-modal-footer class="right nobdr"> </lyte-modal-footer> </template> </lyte-modal> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,1]},{type:"text",position:[1,3,0]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"componentDynamic",position:[3,1]},{type:"attr",position:[3,3],attr:{style:{name:"style",helperInfo:{name:"if",args:["height","height","''"]}}}},{type:"registerYield",position:[3,3,1],dynamicNodes:[{type:"text",position:[1,1,1,1,1]},{type:"componentDynamic",position:[1,1,1,1]},{type:"text",position:[1,1,1,3,1]},{type:"componentDynamic",position:[1,1,1,3]},{type:"componentDynamic",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3,1]},{type:"for",position:[1,3,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"text",position:[1,1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"text",position:[1,3,1]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3,3]},{type:"componentDynamic",position:[3]},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["totalRecordCount","skippedRecordCount","skippedRecords","module","orgid","height"],data:function(){return{totalRecordCount:Lyte.attr("number"),skippedRecordCount:Lyte.attr("number"),skippedRecords:Lyte.attr("array"),module:Lyte.attr("string"),orgid:Lyte.attr("string"),height:Lyte.attr("string")}},init:function(){this.data.skippedRecordCount>5&&this.setData("height","height : 200px")},methods:{removeElement:function(){setTimeout((function(){getElemById("crmTriggerError").remove()}),2e3)}}}),store.registerModel("stage",{id:Lyte.attr("string"),display_label:Lyte.attr("string"),forecast_category:Lyte.attr("object"),forecast_type:Lyte.attr("string"),name:Lyte.attr("string"),probability:Lyte.attr("number"),sequence_number:Lyte.attr("number")}),store.registerAdapter("stage",{namespace:"crm/v2/settings"}),store.registerSerializer("stage",{}),Lyte.Router.registerRoute("crm.deletionAdminTool",{getResources:function(){var e=networkUtils.returnDependencyFiles(["deletionAdminTool.js"],crmConstants.jsStaticPathForLyte);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles(["crm-admincenter.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["crm-admintools.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("AdminCenter")],crmConstants.jsStaticPath))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},renderTemplate:function(){return this.currentModel={},this.currentModel.featuresNames=[{apiName:"templates",display:I18n.getMsg("crm.label.templates"),system:"templates",singular:I18n.getMsg("crm.email.label.template"),qp:{feature:"templates"}},{apiName:"custom_views",display:I18n.getMsg("setupsearch.customviews"),system:"customView",singular:I18n.getMsg("crm.label.customview"),qp:{feature:"customView"}},{apiName:"workflows",display:I18n.getMsg("crm.label.workflows"),system:"workflow",singular:I18n.getMsg("Workflow"),qp:{feature:"workflow"}},{apiName:"reports",display:I18n.getMsg("Reports"),system:"reports",singular:I18n.getMsg("Report"),qp:{feature:"reports"}}],void 0!==newReportsEnabled&&!1!==newReportsEnabled||(this.currentModel.featureDisabledList=["reports"]),{outlet:"#show",component:"crm-admindeletiontool"}},afterModel:function(){commonUtils.showHideLoadingDiv()}}),Lyte.Router.registerRoute("crm.offlineBackupAdminTool",{getResources:function(){var e=networkUtils.returnDependencyFiles(["offlineBackupAdminTool.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["offlineBackupAdminTool.css"],crmConstants.cssStaticPathForLyte))},renderTemplate:function(){return{outlet:"#show",component:"crm-offlinebackupadmintool"}}}),Lyte.Router.registerRoute("crm.dcMigrationAdminTool",{getResources:function(){var e=networkUtils.returnDependencyFiles(["dcMigrationAdminTool.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["dcMigrationAdminTool.css"],crmConstants.cssStaticPathForLyte))},renderTemplate:function(){return{outlet:"#show",component:"crm-dcmigrationadmintool"}}}),Lyte.Router.registerRoute("crm.exportAuditLogAdminTool",{getResources:function(){var e=networkUtils.returnDependencyFiles(["exportAuditLogAdminTool.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["exportAuditLogAdminTool.css"],crmConstants.cssStaticPathForLyte))},renderTemplate:function(){return{outlet:"#show",component:"crm-exportauditlogadmintool"}}}),Lyte.Router.registerRoute("crm.emailAdminTool",{getResources:function(){var e=networkUtils.returnDependencyFiles(["emailAdminTool.js","lyte-daterangepicker.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["emailAdminTool.css"],crmConstants.cssStaticPathForLyte))},beforeModel:function(){commonUtils.showHideLoadingDiv(!0)},afterModel:function(){commonUtils.showHideLoadingDiv()},renderTemplate:function(){return{outlet:"#show",component:"crm-emailadmintool"}}}),Lyte.Component.register("crm-logout-survey",{_template:'<template tag-name="crm-logout-survey"> <div class="form-page"> <div class="header-bg"></div> <div class="header-branding"> <div class="header-title">{{unescape(getI18n("crm.logout.survey.thanks1"))}}</div> </div> </div> </template>',_dynamicNodes:[{type:"text",position:[1,3,1,0]}],data:function(){return{}}}),store.registerModel("auto_enrichment",{id:Lyte.attr("string"),module:Lyte.belongsTo("module"),active:Lyte.attr("boolean"),modified_by:Lyte.attr("object"),fields_map:Lyte.attr("array"),modified_time:Lyte.attr("user-view-date-time"),profiles:Lyte.hasMany("profile"),fields_to_enrich:Lyte.hasMany("field")},{actions:{enrich_dependencyData:{},deactivate_all:{},activate_all:{},fields_save:{},enrich_data_feedback:{}}}),store.registerAdapter("auto_enrichment",{namespace:"crm/v2/settings",buildURL:function(e,t,r,i,a,s){if("fields_save"===s){var o=a.split("actions/fields_save");a=o[0],a+=Lyte.Router.getRouteInstance().getDynamicParam()}else if("deactivate_all"===s||"activate_all"===s){o=a.replace(s,"activate");a=o}else if("enrich_data_feedback"===s){o=a.replace("v2","v2.2");a=o}return a},methodForRequest:function(e,t,r,i,a){return"enrich_dependencyData"===a?"GET":"deactivate_all"===a?"DELETE":"activate_all"===a||"enrich_data_feedback"===a?"POST":"fields_save"===a?"PATCH":e}}),store.registerSerializer("auto_enrichment",{normalizeResponse:function(e,t,r){return"updateRecord"===t&&(r={auto_enrichment:r.auto_enrichment[0].details}),r},payloadKey:function(){return"auto_enrichment"},serialize:function(e,t,r,i,a,s,o){if(i&&"profileSave"===i){for(var n=[],l=r.profiles.length,c=0;c<l;c++)n.push(r.profiles[c].id);t.auto_enrichment=[{profiles:n}]}if(i&&"statusChange"===i){var d={},u=[];d.active=t.auto_enrichment.active,u[0]=d,(t={}).auto_enrichment=u}if(i&&"fields_save"===i){var m=[];if((i=r.fields_map)&&i.length>0){var p=i.length;for(c=0;c<p;c++){var g={},f={};f.name=i[c].enrich_field.name,f.label=i[c].enrich_field.label?i[c].enrich_field.label:"",i[c].crm_field&&i[c].crm_field.api_name?(g.api_name=i[c].crm_field.api_name,g.id=i[c].crm_field.id?i[c].crm_field.id:""):g=null,Lyte.arrayUtils(m,"push",{enrich_field:f,crm_field:g})}var h={};h.auto_enrichment=[{fields_map:m,active:!0}],t=JSON.stringify(h)}}return"enrich_data_feedback"===o&&((t={})[this.payloadKey()]=[i]),t}}),store.registerModel("layout_rule",{layout:Lyte.belongsTo("layout")}),store.registerAdapter("layout_rule",{buildURL:function(e,t,r,i,a,s,o){return a=a.replace(e,"layouts/"+o+"/rules")},namespace:"crm/v2.1/settings"}),store.registerSerializer("layout_rule",{normalizeResponse:function(e,t,r){return Lyte.Component.registeredHelpers.isEmpty(r)?{layout_rule:[]}:r},payloadKey:function(){return"rules"}}),store.registerModel("validation_rule",{layout:Lyte.belongsTo("layout")},{actions:{records_count:{endpoint:"records_count"}}}),store.registerAdapter("validation_rule",{namespace:"crm/v2.1/settings",buildURL:function(e,t,r,i,a,s){return a=a.replace("validation_rule","validation_rules"),"action"===t&&"records_count"===s&&(a=a.replace("v2.1","v2.2")),a},parseResponse:function(e,t,r,i,a){if(i=this.super(arguments))for(var s=a.layout_id,o=i.validation_rules?i.validation_rules.length:0,n=0;n<o;n++)i.validation_rules[n].layout=s;return i}}),store.registerSerializer("validation_rule",{normalizeResponse:function(e,t,r){return Lyte.Component.registeredHelpers.isNotEmpty(r)?(r[e]=r.validation_rules,delete r.validation_rules,delete r.info,r):r[e]={}},payloadKey:function(e){if(e)return e}}),store.registerModel("widget",{widgets_id:Lyte.attr("string",{primaryKey:!0}),file_name:Lyte.attr("string"),hosting:Lyte.attr("string"),permissions:Lyte.attr("object"),name:Lyte.attr("string"),base_url:Lyte.attr("string"),description:Lyte.attr("string"),active:Lyte.attr("boolean"),source:Lyte.attr("string"),type:Lyte.attr("string"),associated_places:Lyte.attr("array",{default:[]}),segment:Lyte.hasMany("wizard-segment",{serialize:"partial",deepNest:!0})}),store.registerAdapter("widget",{namespace:"crm/v2/settings",buildURL:function(e,t,r,i,a,s,o){for(var n in o)r[n]=o[n];return a.replace("widget","widgets")}}),store.registerSerializer("widget",{normalizeResponse:function(e,t,r){return"findAll"!=t&&"findRecord"!=t||r?r:{widget:[]}},payloadKey:function(){return"crm_widgets"}}),Lyte.Router.registerRoute("crm.adminTool",{}),Lyte.Component.register("crm-multiuserdd-wrapper",{_template:'<template tag-name="crm-multiuserdd-wrapper"> <crux-user-dropdown id="userDropdown" cx-prop-query-param="{{queryparam}}" cx-prop-no-user-label="{{placeholder}}" cx-prop-login-user-required="{{liteUserReq}}" cx-prop-zcqa="{{zcqa}}" cx-prop-selected-users="{{lbind(usersRecord)}}" cx-prop-selected="{{lbind(selectedUsers)}}" cx-prop-filter-options="{{filterOptions}}" cx-prop-filter-user-value="{{filterUservalue}}" cx-prop-filter-system-value="{{filterSystemvalue}}" cx-prop-filter-selected="ActiveUsers" cx-prop-type="multiple" on-user-remove="{{method(&quot;onUserAddOrRemove&quot;)}}" on-user-add="{{method(&quot;onUserAddOrRemove&quot;)}}"></crux-user-dropdown> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}],_observedAttributes:["selectedIds","selectedUsers","selectedNames","usersRecord","placeholder","fieldId","zcqa","filterable","filterOptions","filterUservalue","filterSystemvalue","queryparam","liteUserDetails","normalUserDetails","liteUserReq"],data:function(){return{selectedIds:Lyte.attr("string"),selectedUsers:Lyte.attr("string"),selectedNames:Lyte.attr("string"),usersRecord:Lyte.attr("array"),placeholder:Lyte.attr("string"),fieldId:Lyte.attr("string"),zcqa:Lyte.attr("string"),filterable:Lyte.attr("boolean",{default:!0}),filterOptions:Lyte.attr("array",{default:[{id:"AllUsers",category:_cruxUtils.getI18n("crm.globalsearch.option.all")},{id:"ActiveUsers",category:_cruxUtils.getI18n("webform.status.Active")},{id:"DeactiveUsers",category:_cruxUtils.getI18n("Inactive")},{id:"NotConfirmedUsers",category:I18n.getMsg("crm.user.component.unconfirmed")}]}),filterUservalue:Lyte.attr("string",{default:"category"}),filterSystemvalue:Lyte.attr("string",{default:"id"}),queryparam:Lyte.attr("object"),liteUserDetails:Lyte.attr("array"),normalUserDetails:Lyte.attr("array"),liteUserReq:Lyte.attr("boolean",{default:!0})}},updateDom:function(e){var t="",r="",i=e.newValue;if(i&&i.length){for(var a=i.length,s=0;s<a;s++){var o=i[s];s>0?(t=t+","+o.full_name,r=r+","+o.id):(t=o.full_name,r=o.id)}this.setData("selectedNames",t),this.setData("selectedIds",r)}}.observes("usersRecord"),methods:{onUserAddOrRemove:function(e,t,r){for(var i="",a="",s=r.length,o=0;o<s;o++){var n=r[o];o>0?(i=i+","+n.full_name,a=a+","+n.id):(i=n.full_name,a=n.id)}this.setData("selectedNames",i),this.setData("selectedIds",a),this.executeMethod("updateSelectedUsers")},updateSelectedUsers:function(){var e=this.getData("selectedIds"),t=this.getData("fieldId"),r=$(this.$node).parent(),i=r.find("#"+t);0==i.length&&(i=r.parent().find("#"+t)),i.val(e)}}}),Lyte.Component.register("crm-user-wrapper",{_template:'<template tag-name="crm-user-wrapper"> <div class="w85per dIB"> <template is="if" value="{{expHandlers(cxPropCustomRequest,\'!\')}}"><template case="true"> <crux-user-dropdown class="outLine_non" onfocus="{{action(\'setFocus\',this)}}" on-user-before-show="{{method(&quot;folUserDropdown&quot;)}}" tabindex="{{tabIndex}}" user-id-list="{{userIdList}}" cx-prop-disabled="{{readOnly}}" cx-prop-zcqa="{{zcqaDropdown}}" cx-prop-criteria="{{userCriteria}}" cx-prop-search-criteria="{{userSearchCriteria}}" cx-prop-filterable="{{filterable}}" cx-prop-no-user-label="{{placeholder}}" cx-prop-selected-user="{{lbind(userRecord)}}" cx-prop-selected="{{dataId}}" cx-prop-selected-name="{{userName}}" cx-prop-filter-options="{{filterOptions}}" cx-prop-filter-user-value="{{filterUservalue}}" cx-prop-filter-system-value="{{filterSystemvalue}}" on-user-selected="{{method(&quot;onSelect&quot;)}}" cx-prop-query-param="{{defaultQueryParams}}"></crux-user-dropdown> <template is="if" value="{{expHandlers(expHandlers(readOnly,\'===\',&quot;false&quot;),\'&amp;&amp;\',expHandlers(expHandlers(expHandlers(dataUitype,\'==\',availableUiTypes.USERLOOKUP),\'||\',expHandlers(dataUitype,\'==\',availableUiTypes.PRODUCT_HANDLER)),\'&amp;\',expHandlers(userRecord.id,\'!==\',&quot;&quot;)))}}"><template case="true"> <img data-zcqa="lookup_{{fieldId}}_close" src="{{getCrmImageUrl(\'spacer_e17b417_.gif\')}}" id="Crm_lookup_img_{{fieldId}}" class="clear_lookupfield lookup_hIconO dIB svgIcons ico-close-small2 op5 cP fR hIconO mR30 {{showClearIconClass}}" onclick="{{action(\'clearSelection\')}}"> </template></template> <crux-user-lookup class="dIB" cx-prop-criteria="{{userCriteria}}" on-body-before-show="{{method(&quot;folUserDropdown&quot;)}}" cx-prop-search-criteria="{{userSearchCriteria}}" cx-prop-filterable="{{filterable}}" cx-prop-filter-options="{{filterOptions}}" cx-prop-filter-user-value="{{filterUservalue}}" cx-prop-filter-system-value="{{filterSystemvalue}}" cx-prop-selected-id="{{dataId}}" on-assign="{{method(&quot;onLookupSelected&quot;)}}" cx-prop-query-params="{{defaultQueryParams}}" on-before-search="{{method(&quot;setFilterQueryId&quot;)}}"></crux-user-lookup> </template><template case="false"> <crux-user-dropdown class="outLine_non" onfocus="{{action(\'setFocus\',this)}}" tabindex="{{tabIndex}}" cx-prop-forced-fetch="true" cx-prop-disabled="{{readOnly}}" cx-prop-zcqa="{{zcqaDropdown}}" cx-prop-criteria="{{userCriteria}}" cx-prop-search-criteria="{{userSearchCriteria}}" cx-prop-filterable="{{filterable}}" cx-prop-no-user-label="{{placeholder}}" cx-prop-selected-user="{{lbind(userRecord)}}" cx-prop-selected="{{dataId}}" cx-prop-selected-name="{{userName}}" cx-prop-filter-options="{{filterOptions}}" cx-prop-filter-user-value="{{filterUservalue}}" cx-prop-filter-system-value="{{filterSystemvalue}}" on-user-selected="{{method(&quot;onSelect&quot;)}}" on-custom-user-request="{{method(&quot;filterDropdownUsers&quot;)}}" cx-prop-query-param="{{defaultQueryParams}}" on-user-before-show="{{method(&quot;setFilterQueryId&quot;)}}"></crux-user-dropdown> <template is="if" value="{{expHandlers(expHandlers(readOnly,\'===\',&quot;false&quot;),\'&amp;&amp;\',expHandlers(expHandlers(expHandlers(dataUitype,\'==\',availableUiTypes.USERLOOKUP),\'||\',expHandlers(dataUitype,\'==\',availableUiTypes.PRODUCT_HANDLER)),\'&amp;\',expHandlers(userRecord.id,\'!==\',&quot;&quot;)))}}"><template case="true"> <img data-zcqa="lookup_{{fieldId}}_close" src="{{getCrmImageUrl(\'spacer_e17b417_.gif\')}}" id="Crm_lookup_img_{{fieldId}}" class="clear_lookupfield lookup_hIconO dIB svgIcons ico-close-small2 op5 cP fR hIconO mR30 {{showClearIconClass}}" onclick="{{action(\'clearSelection\')}}"> </template></template> <crux-user-lookup cx-prop-custom-request="true" on-custom-request="{{method(&quot;filterLookupUsers&quot;)}}" class="dIB" cx-prop-criteria="{{userCriteria}}" cx-prop-search-criteria="{{userSearchCriteria}}" cx-prop-filterable="{{filterable}}" cx-prop-filter-options="{{filterOptions}}" cx-prop-filter-user-value="{{filterUservalue}}" cx-prop-filter-system-value="{{filterSystemvalue}}" cx-prop-selected-id="{{dataId}}" on-assign="{{method(&quot;onLookupSelected&quot;)}}" cx-prop-query-params="{{defaultQueryParams}}" on-body-before-show="{{method(&quot;setFilterQueryId&quot;)}}"></crux-user-lookup> </template></template> </div> </template>',_dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"attr",position:[5]},{type:"componentDynamic",position:[5]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"attr",position:[5]},{type:"componentDynamic",position:[5]}]}},default:{}}],_observedAttributes:["userRecord","dataId","actionSource","fieldId","userName","operationSource","showClearIconClass","filterOptions","filterUservalue","filterSystemvalue","placeholder","filterable","userCriteria","userSearchCriteria","zcqaDropdown","dataUitype","readOnly","tabIndex","availableUiTypes","module","cxPropCustomRequest","userIdList","isFieldLookup","fieldIdFol","layoutId","isOwnerRecordLock","filterQueryId","defaultQueryParams","recordId","source","isEditPermissionDenied"],data:function(){return{userRecord:Lyte.attr("object",{default:{},hideAttr:!0}),dataId:Lyte.attr("string",{default:""}),actionSource:Lyte.attr("string"),fieldId:Lyte.attr("string"),userName:Lyte.attr("string"),operationSource:Lyte.attr("string"),showClearIconClass:Lyte.attr("string",{default:"vVIm"}),filterOptions:Lyte.attr("array",{default:[{id:"ActiveUsers",category:"Active"}]}),filterUservalue:Lyte.attr("string",{default:"category"}),filterSystemvalue:Lyte.attr("string",{default:"id"}),placeholder:Lyte.attr("string"),filterable:Lyte.attr("boolean",{default:!1}),userCriteria:Lyte.attr("string",{default:""}),userSearchCriteria:Lyte.attr("string",{default:""}),zcqaDropdown:Lyte.attr("string",{default:""}),dataUitype:Lyte.attr("string"),readOnly:Lyte.attr("string",{default:"false"}),tabIndex:Lyte.attr("string",{default:"0"}),availableUiTypes:Lyte.attr("object",{default:Crm.Field.UITYPES}),module:Lyte.attr("string"),cxPropCustomRequest:Lyte.attr("boolean",{default:!1}),userIdList:Lyte.attr("string",{default:""}),isFieldLookup:Lyte.attr("boolean"),fieldIdFol:Lyte.attr("string"),layoutId:Lyte.attr("string"),isOwnerRecordLock:Lyte.attr("string"),filterQueryId:Lyte.attr("string"),defaultQueryParams:Lyte.attr("object"),recordId:Lyte.attr("string"),source:Lyte.attr("string"),isEditPermissionDenied:Lyte.attr("string")}},lookupAutoComplete:[],ajaxEditOwnerValue:{},editOwnerValue:{},setFilterOptions:function(){this.getData("userCriteria")&&this.setData("userCriteria",decodeURIComponent(this.getData("userCriteria"))),this.getData("userSearchCriteria")&&this.setData("userSearchCriteria",decodeURIComponent(this.getData("userSearchCriteria"))),this.getData("filterable")&&this.setData("filterOptions",[{id:"AllUsers",category:_cruxUtils.getI18n("crm.globalsearch.option.all")},{id:"ActiveUsers",category:_cruxUtils.getI18n("webform.status.Active")},{id:"DeactiveUsers",category:_cruxUtils.getI18n("Inactive")},{id:"NotConfirmedUsers",category:I18n.getMsg("crm.user.component.unconfirmed")},{id:"DeletedUsers",category:_cruxUtils.getI18n("DeletedUser")}])}.on("init"),toggleClearLookup:function(){var e=$(this.$node).closest(".lookupFieldCreate");this.getData("dataUitype")!=this.getData("availableUiTypes").PRODUCT_HANDLER&&this.getData("dataUitype")!=this.getData("availableUiTypes").USERLOOKUP||!this.getData("userRecord").id?(this.setData("showClearIconClass",""),e.hasClass("userLookupCIH")&&e.removeClass("userLookupCIH")):(this.setData("showClearIconClass","vVIm"),e.addClass("userLookupCIH"))}.observes("userRecord").on("init"),changeOwnerValueImpose:function(e){var t=this.getData("fieldId"),r=$("#OwnerField");(t.includes("SMOWNER")||r.length>0)&&this.executeMethod("validateRestrictionCheck",e);var i=$("#"+t),a=$("#ownerId");$("#ownerName").text(" "+e.full_name),a.val(e.id),$("#ownerNameIntext").text(" "+e.full_name),$(".form_err_msg").hide(),$(".wf_no_focus").removeClass("wf_no_focus form_err_fld"),r.removeClass("dN"),i.data("id",e.id).data("profileId",e.profile.id),r.show(),changeOwner.enableButton()},folUserRefFields:function(e){if(Crm.userDetails.FIELD_OF_LOOKUP_ENABLED&&!0===Crm.userDetails.FIELD_OF_LOOKUP_AVAIALBLE){var t={},r="undefined"==typeof lookupAutoComplete?this.lookupAutoComplete:lookupAutoComplete;if(void 0!==r){for(var i=r.length,a=0;a<i;a++)if(r[a].seId===e.id){t.item=r[a];break}_.isEmpty(t)?this.folUserDropdownSelectedId(e,this,t):this.folUserValuePopulate(this,t,e)}}},folUserValuePopulate:function(e,t,r){var i=t.item.refFieldsInfo,a=$L("#createEntityForm"),s=$L("#qCreate");if(void 0===(o=e.getData("module"))&&!a.is(":visible"))var o=Lyte.Router.getRouteInstance("crm.tab.module").getDynamicParam();if(window[o]=void 0===window[o]?o:window[o],a.is(":visible")||"edit"!==window[o].currentStatus&&!$("#convertOwner").data("isownerdealfol")||"changeOwnerPopUp"!==e.data.fieldId)if(s.is(":visible")||"crm.tab.approvals.index"!==Lyte.Router.getRouteInstance().transition.target){if(i&&t.item.parentFieldsColumnName){var n=$("#multipleFieldsEditPop"),l=$("#socAddToCrmPop"),c=$L("#ctinotifier_center");if(a.is(":visible")||s.is(":visible")||c.is(":visible")||"view"!==window[o].currentStatus||n.is(":visible"))(a.is(":visible")||l.is(":visible")||"create"===window[o].currentStatus||"clone"===window[o].currentStatus||"edit"===window[o].currentStatus||s.is(":visible")||c.is(":visible")||n.is(":visible")&&"view"===window[o].currentStatus)&&(i=i||{},Crm.setRefFieldValues(e,r.id,i));else{var d="changeOwnerPopUp"===e.data.fieldId?"SMOWNERID":e.$node.dataset.colname;fieldOfLookup.participatingfieldsvalidationrule(t,d)}}}else Crm.setRefFieldValues(e,r.id,i||{});else e.editOwnerValue=i},folUserDropdownSelectedId:function(e,t,r){if(Crm.userDetails.FIELD_OF_LOOKUP_ENABLED&&!0===Crm.userDetails.FIELD_OF_LOOKUP_AVAIALBLE&&this.getData("isFieldLookup")&&"true"!==this.getData("isOwnerRecordLock")&&"true"!==this.getData("isEditPermissionDenied")){var i=$L(".zcanvas_zcdefaultcontd"),a=$L("#createEntityForm");if(!i.is(":visible")||i.is(":visible")&&a.is(":visible")){var s,o=this.getData("fieldId"),n=this.getData("fieldIdFol"),l=this.getData("module"),c={searchmodule:"Users",fldValue:"",isAutoComplete:!0,offset:"1",currencyISOCode:"undefined"!=typeof returnJson&&returnJson&&returnJson.entityMapJson&&returnJson.entityMapJson.CURRENCYISOCODE?returnJson.entityMapJson.CURRENCYISOCODE.defaultvalue:"",productId:"",fldName:o,entityId:"",fieldId:n,isSubFormField:"false",parentModule:l,layoutId:s=window[l]&&"edit"===window[l].currentStatus&&"changeOwnerPopUp"===o?crmCommonModule.createEditJson.layout_jsonarrayObj.sysLayoutId:"null"!==(s=this.getData("layoutId"))?s:"",isFolUser:!0,folUserSelectedId:e.id};store.findAll("dummy",c,!1,!1,{url:Crm.getCrmBasePath()+"/Search.do",method:"POST"}).then((function(i){this.lookupAutoComplete=i.dummy.Value,r.item=i.dummy.Value[0],t.folUserValuePopulate(t,r,e)}))}}},actions:{clearSelection:function(){if(this.getData("dataId")){this.setData("userRecord",{}),this.setData("dataId","");var e=this.getData("fieldId");if(e)$("#"+e).data("id","");$(this.$node).find("lyte-dropdown")[0].ltProp("placeholder",I18n.getMsg("None"))}},setFocus:function(e){e.currentTarget=this.$node,setFocusClass(e)}},methods:{onSelect:function(e,t){this.setData("userName",t.full_name),this.setData("dataId",t.id),this.setData("userRecord",t);var r=this.getData("actionSource"),i=this.getData("cxPropCustomRequest"),a=$(this.$node);switch(r){case"ChangeOwner":this.changeOwnerValueImpose(t);break;case"entitycreate":var s=null!=this.getData("module")?this.getData("module"):$("#quick_module").val();s=s||module;var o=this.getData("fieldId");o.includes("SMOWNER")&&this.executeMethod("showRestrictionWarningMessage",s,t.id,this.getData("recordId"));var n=$("#"+o);if(n.prevAll("input").length>0?n.prevAll("input:eq(0)").val(t.id):n.data("id",t.id),"true"==this.$node.getAttribute("createTask")){var l=$("#notifyOwnerDiv"),c=0==l.length?$(".Tasks_Notify_Owner"):l;Crm.userDetails.USER_ID!=t.id?c.show():c.hide()}}if(this.getData("isFieldLookup")&&"true"!==this.getData("isOwnerRecordLock")&&"true"!==this.getData("isEditPermissionDenied")){var d=$L(".zcanvas_zcdefaultcontd"),u=$L("#createEntityForm");if(d.is(":visible")&&!u.is(":visible")){var m=$L("crm-detailview-canvas")[0].component,p=this;store.findAll("dummy",null,!1,!1,{url:"crm/v2/users/"+t.id}).then((function(e){m.executeMethod("setFolValueUserLookup",e.users[0],p.data,t)}))}else this.folUserRefFields(t)}if(!$(".commonRightPanel").length){var g=Lyte.Router.getRouteInstance().transition.info.route;"crm.tab.module.create"!==g&&"crm.tab.module.entity.edit"!==g&&"crm.tab.module.entity.clone"!==g&&"crm.tab.module.entity.detail"!==g&&"crm.tab.module.custom-view.list"!==g&&"crm.crm-calendar"!==g||a.trigger("change",this.$node)}if(1==i){var f=$("#Crm_Appointments_APPOINTMENTDATEANDTIME");CSU.checkServiceAvailabilityTime(f,void 0,"edit"===Events.currentStatus)}},filterDropdownUsers:function(){var e=this.getData("userIdList"),t=arguments,r=this;return new Promise((function(i,a){if("search"===t[1]){var s=t[2].criteria;e&&(s="("+s+"and(id:in:"+e+"))"),(o={}).criteria=s,o.type="ActiveUsers",Crm.userDetails.isLookupFilterEnabled&&r.getData("filterQueryId")&&(o.query_id=r.getData("filterQueryId")),store.triggerAction("user","search",o).then((function(e){i(e)}),(function(){a()}))}else{var o;t[1].ids=e,(o=t[1]).page=1,Crm.userDetails.isLookupFilterEnabled&&r.getData("filterQueryId")&&(o.query_id=r.getData("filterQueryId")),store.findAll("user",o).then((function(e){i(e)}),(function(){a()}))}}))},folUserDropdown:function(){if(Crm.userDetails.isLookupFilterEnabled&&this.getData("filterQueryId")&&this.setData("defaultQueryParams",{query_id:this.getData("filterQueryId")}),Crm.userDetails.FIELD_OF_LOOKUP_ENABLED&&!0===Crm.userDetails.FIELD_OF_LOOKUP_AVAIALBLE&&this.getData("isFieldLookup")&&"true"!==this.getData("isOwnerRecordLock")&&"true"!==this.getData("isEditPermissionDenied")){var e=$L(".zcanvas_zcdefaultcontd"),t=$L("#createEntityForm");if(!e.is(":visible")||e.is(":visible")&&t.is(":visible")){var r,i=this.getData("fieldId"),a=this.getData("fieldIdFol"),s=this.getData("module"),o={searchmodule:"Users",fldValue:"",isAutoComplete:!0,offset:"1",currencyISOCode:"undefined"!=typeof returnJson&&returnJson&&returnJson.entityMapJson&&returnJson.entityMapJson.CURRENCYISOCODE?returnJson.entityMapJson.CURRENCYISOCODE.defaultvalue:"",productId:"",fldName:i,entityId:"",fieldId:a,isSubFormField:"false",parentModule:s,layoutId:r=window[s]&&"edit"===window[s].currentStatus&&"changeOwnerPopUp"===i?crmCommonModule.createEditJson.layout_jsonarrayObj.sysLayoutId:"null"!==(r=this.getData("layoutId"))?r:"",isFolUser:!0};store.findAll("dummy",o,!1,!1,{url:Crm.getCrmBasePath()+"/Search.do",method:"POST"}).then((function(e){this.lookupAutoComplete=e.dummy.Value}))}}},filterLookupUsers:function(e,t,r){var i=this.getData("userIdList"),a=this;return new Promise((function(e,s){if(r){var o=t.criteria;i&&(o="("+o+"and(id:in:"+i+"))"),(n={}).criteria=o,n.type="ActiveUsers",Crm.userDetails.isLookupFilterEnabled&&a.getData("filterQueryId")&&(n.query_id=a.getData("filterQueryId")),store.triggerAction("user","search",n).then((function(t){e(t)}),(function(){s()}))}else{var n;(n=t).ids=i,Crm.userDetails.isLookupFilterEnabled&&a.getData("filterQueryId")&&(n.query_id=a.getData("filterQueryId")),store.findAll("user",n).then((function(t){e(t)}),(function(){s()}))}}))},onLookupSelected:function(e){if(this.setData("dataId",e.id),this.setData("userRecord",e),this.setData("userName",e.full_name),"entitycreate"===this.getData("actionSource")){var t=this.getData("fieldId"),r=$("#"+t),i=$("#ownerId"),a=r.find("span");if(a.attr("userid",e.id),a.attr("userzuid",e.zuid),i.val(e.id),r.prevAll("input").length>0?r.prevAll("input:eq(0)").val(e.id):r.data("id",e.id),"true"==this.$node.getAttribute("createTask")){var s=$("#notifyOwnerDiv"),o=0==s.length?$(".Tasks_Notify_Owner"):s;Crm.userDetails.USER_ID!=e.id?o.show():o.hide()}}if("ChangeOwner"!==this.getData("actionSource")&&"entitycreate"!==this.getData("actionSource")||this.changeOwnerValueImpose(e),this.getData("isFieldLookup")&&"true"!==this.getData("isOwnerRecordLock")){var n=$L(".zcanvas_zcdefaultcontd"),l=$L("#createEntityForm");if(n.is(":visible")&&!l.is(":visible")){var c=$L("crm-detailview-canvas")[0].component,d=this;store.findAll("dummy",null,!1,!1,{url:"crm/v2/users/"+e.id}).then((function(t){c.executeMethod("setFolValueUserLookup",t.users[0],d.data,e)}))}else this.folUserRefFields(e)}if(1==this.getData("cxPropCustomRequest")){var u=$("#Crm_Appointments_APPOINTMENTDATEANDTIME");CSU.checkServiceAvailabilityTime(u)}if(!$(".commonRightPanel").length){var m=Lyte.Router.getRouteInstance().transition.info.route;"crm.tab.module.create"!==m&&"crm.tab.module.entity.edit"!==m&&"crm.tab.module.entity.clone"!==m&&"crm.tab.module.entity.detail"!==m&&"crm.tab.module.begin"!==m&&"crm.tab.module.custom-view.list"!==m&&"crm.tab.module.entity.detail"!==m&&"crm.crm-calendar"!==m||$(this.$node).trigger("change",this.$node)}},setFilterQueryId:function(){Crm.userDetails.isLookupFilterEnabled&&this.getData("filterQueryId")&&this.setData("defaultQueryParams",{query_id:this.getData("filterQueryId")})},showRestrictionWarningMessage:function(e,t,r){var i="#"+e+"_fldRow_SMOWNERID";"Products"===e&&(i="#"+e+"_fldRow_HANDLER");let a=$("#isQuickCreate"),s=a.length>0;(this.getRestrictionInfo?this.getRestrictionInfo(e,t,r):this.executeMethod("getRestrictionInfo",e,t,r)).then((function(t){if(s?a.find("crm-threshold-grant").remove():$("crm-threshold-grant").remove(),!1===t.allow){var r=document.createElement("crm-threshold-grant"),o=s?a.find(i+" .labelValCreate"):$(i+" .labelValCreate"),n=o.length>0?o[0].offsetWidth:n,l="position:relative; width:"+n+"px; top:10px; ";if(0===$("#isQuickCreate").length){var c=o.position().left;Crm.userDetails.RTL_ENABLED&&(c=-$(i+" .labelTabCreate").outerWidth()),l+="left:"+c+"px;"}return r.setData("rsGrantStyle",l),r.setData("moduleName",e),o.after(r),void commonUtils.showHideLoadingDiv()}}))},validateRestrictionCheck:function(e){var t=null!=this.getData("module")?this.getData("module"):$("#quick_module").val();if(t=t||module,!Crm.isRestrictionEnabled||!this.isValidRestrictionModule(t))return;var r=$("#assignmentRestriction"),i=document.getElementById("assRestGrant");let a=$("#isQuickCreate"),s=a.length>0;var o=this.getData("source");if(i&&i.setData("moduleName",t),"massconvert"===o){if(!r||!i)return;if("Leads"!=t)return;var n=["Contacts","Accounts"],l=$("#potentialsCheckBox");l.length>0&&l[0].checked&&n.push("Deals"),r.hasClass("dN")||r.addClass("dN"),i.setData("source","massconvert"),i.setData("moduleName",""),n.forEach((function(t){changeOwner.getRestrictionInfo(t,e.id).then((function(e){!1===e.allow&&r.hasClass("dN")&&r.removeClass("dN")}))}))}else if("listview"===o||"entityview"===o||"massTransferTo"===o||"detailview"===o){this.executeMethod("getRestrictionInfo",this.getData("module"),e.id,this.getData("recordId")).then((function(e){!0===e.allow&&(r.hasClass("dN")||r.addClass("dN")),!1===e.allow&&r.removeClass("dN")}))}else if("entitycreate"===this.getData("actionSource")){var c="#"+t+"_fldRow_SMOWNERID";"Products"===t&&(c="#"+t+"_fldRow_HANDLER"),this.executeMethod("getRestrictionInfo",t,e.id,this.getData("recordId")).then((function(e){if(s?a.find("crm-threshold-grant").remove():$("crm-threshold-grant").remove(),!1===e.allow){var r=document.createElement("crm-threshold-grant"),i=s?a.find(c+" .labelValCreate"):$(c+" .labelValCreate"),o=i.length>0?i[0].offsetWidth:o,n="position:relative; width:"+o+"px; top:10px; ";if(0===$("#isQuickCreate").length){var l=i.position().left;Crm.userDetails.RTL_ENABLED&&(l=-$(c+" .labelTabCreate").outerWidth()),n+="left:"+l+"px;"}return r.setData("rsGrantStyle",n),r.setData("moduleName",t),i.after(r),void commonUtils.showHideLoadingDiv()}}))}var d=$L("#applyRestrictionOption");d&&d.length>0&&d[0].setData({source:o,user:e})},getRestrictionInfo:function(e,t,r){return Lyte.registeredMixins["crm-assignment-threshold-common"].restrictionGrantCheck(e,t,r)}}},{mixins:["crm-assignment-threshold-common"]}),Lyte.Component.register("crm-ziasetup-onboard",{_template:'<template tag-name="crm-ziasetup-onboard"> <lyte-modal lt-prop-height="460px" lt-prop-width="860px" lt-prop-wrapper-class="ziaWrapperSetupOnboard" id="ziaSetupOnBoard" lt-prop-offset="{&quot;top&quot;:&quot;0px&quot;,&quot;left&quot;:&quot;center&quot;}" on-close="{{method(\'closeZiaSetupOnBoarding\')}}" lt-prop-show="true" lt-prop-scrollable="false" lt-prop-show-close-button="true" on-before-show="{{method(\'onOnboardShow\')}}" on-show="{{method(\'onOnboardVideoPlay\')}}"> <template is="registerYield" yield-name="modal"> <lyte-modal-content style="padding:0;overflow:hidden"> <div class="dIB pR"> <video width="860px" height="460px" muted="true" id="ziaSetupOnboardVideo"> <source src="{{onboard_src}}" type="video/mp4"> </video> <div class="ziaSetupOnboardReloadCont pR dN"> <span class="ico-play-ziasetup ziaSetupOnboardReload" onclick="{{action(\'onReload\')}}"></span> <div class="pA ziaSetupreload" onclick="{{action(\'closeThisPop\')}}"> <div class="ico-close-small2 svgIcons ziaSetupOnboardReload"></div> </div> </div> </div> </lyte-modal-content> </template> </lyte-modal> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1,1,1]},{type:"attr",position:[1,1,3,1]},{type:"attr",position:[1,1,3,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["onboard_src"],didConnect:function(){document.getElementById("ziaSetupOnboardVideo").onended=function(){var e=$L(".ziaSetupOnboardReloadCont");e.addClass("showReload"),e.parents(".lyteModal").addClass("ziaSetupWhenStop")}},data:function(){return{onboard_src:Lyte.attr("string",{default:""})}},methods:{closeZiaSetupOnBoarding:function(){var e=Crm.getCrmBasePath()+"/ZiaSetup.do?action=closeOnBoarding",t={};t[csrfParamName]=csrfToken,(new crmRequestPool).doAjax(e,(function(e){"object"!=typeof e&&(e=JSON.parse(e)),"success"===e.status&&(Crm.userDetails.CUSTOMIZE_INFO.ZIADIRECTORY_MOVEMENT_VIEWED=!0)}),t,(function(){Crm.userDetails.CUSTOMIZE_INFO.ZIADIRECTORY_MOVEMENT_VIEWED=!0}))},onOnboardShow:function(){switch(Crm.userDetails.LOCALE){case"zh_CN":case"zh_TW":this.setData("onboard_src",networkUtils.getImageUrl("ziadirectoryOnBoard_CN_237e1a9_.mp4",ResourceConstants.CRMClient));break;case"ja_JP":this.setData("onboard_src",networkUtils.getImageUrl("ziadirectoryOnBoard_JP_33dd144_.mp4",ResourceConstants.CRMClient));break;default:this.setData("onboard_src",networkUtils.getImageUrl("ziadirectoryOnBoard_US_250593a_.mp4",ResourceConstants.CRMClient))}document.getElementById("ziaSetupOnboardVideo").load()},onOnboardVideoPlay:function(){document.getElementById("ziaSetupOnboardVideo").play()}},actions:{onReload:function(){var e=$L(".ziaSetupOnboardReloadCont");document.getElementById("ziaSetupOnboardVideo").play(),e.removeClass("showReload"),e.parents(".lyteModal").removeClass("ziaSetupWhenStop")},closeThisPop:function(){document.getElementById("ziaSetupOnBoard").ltProp("show",!1)}}}),Lyte.Component.register("crm-threshold-grant",{_template:'<template tag-name="crm-threshold-grant" id="assRestGrant{{selectorId}}"> <div class="rsFieldInfo" style="{{rsGrantStyle}}"> <span class="svgIconsImg rsInfoIcon"></span> <span> <template is="if" value="{{isSingleModule}}"><template case="true"> {{getI18n(\'crm.restriction.grant.warning\',plural_label)}} </template><template case="false"> {{getI18n(\'crm.restriction.grant.warning.moremodules\')}} </template></template> </span><span class="colBlue cP">{{getI18n(\'crm.mxnlookup.tooltip.knowmore\')}}</span> </div> </template>',_dynamicNodes:[{type:"attr",position:[1],attr:{style:{name:"style",dynamicValue:"rsGrantStyle"}}},{type:"attr",position:[1,3,1]},{type:"if",position:[1,3,1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}},{type:"text",position:[1,4,0]}],_templateAttributes:{type:"attr",position:[]},_observedAttributes:["rsGrantStyle","selectorId","source","isSingleModule","moduleName","moduleApiName","plural_label","recordid","ownerid","moduleArray"],data:function(){return{rsGrantStyle:Lyte.attr("string",{default:""}),selectorId:Lyte.attr("string",{default:""}),source:Lyte.attr("string",{default:""}),isSingleModule:Lyte.attr("boolean",{default:!0}),moduleName:Lyte.attr("string",{default:I18n.getMsg("records")}),moduleApiName:Lyte.attr("string",{default:I18n.getMsg("records")}),plural_label:Lyte.attr("string",{default:I18n.getMsg("records")}),recordid:Lyte.attr("string",{default:null}),ownerid:Lyte.attr("string",{default:null}),moduleArray:Lyte.attr("array",{default:[]})}},init:function(){this.executeMethod("setModuleApiName")},methods:{setModuleApiName:function(){var e=this.getData("moduleName");if(e){var t=this.getModuleRecord(null,e);if(!t)return;this.setData("moduleApiName",t.api_name),this.setData("plural_label",t.plural_label)}var r=this.getData("source");"massconvert"!=r&&"convert"!=r&&"transfer_and_delete"!=r||(this.setData("moduleApiName",I18n.getMsg("records")),this.setData("plural_label",I18n.getMsg("records")),this.setData("isSingleModule",!1))},addRestrictionMessage:function(e){var t=(e=null==e?this:e).getData("recordid"),r=e.getData("ownerid"),i=e.getData("moduleName");(Lyte.registeredMixins["crm-assignment-threshold-common"].isValidRestrictionModuleByModuleName(i)||$("#assignmentRestriction").addClass("dN"),i&&r)&&Lyte.registeredMixins["crm-assignment-threshold-common"].restrictionGrantCheck(i,r,t).then((function(t){var r;r=$("#multipleFieldsEditPop").is(":visible")?$(e).parent():$("#assignmentRestriction"),!1===t.allow?r.removeClass("dN"):r.addClass("dN")}))}},dataModuleArray:function(){var e=this.getData("moduleArray"),t="";e.forEach((function(r,i){t=0==i?r:i==e.length-1?t+" "+I18n.getMsg("crm.label.lowercase.and")+" "+r:t+" , "+r})),this.setData("moduleName",t)}.observes("moduleArray"),dataObserverModule:function(){this.executeMethod("setModuleApiName")}.observes("moduleName")},{mixins:["crm-assignment-threshold-common"]}),Lyte.Component.register("crm-threshold-checkbox-option",{_template:'<template tag-name="crm-threshold-checkbox-option"> <template is="if" value="{{showOption}}"><template case="true"> <lyte-checkbox lt-prop-checked="{{lbind(checked)}}" lt-prop-id="arCheckbox" lt-prop-label="{{message}}" class="pT20 atMw500"> </lyte-checkbox> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}],_observedAttributes:["checked","message","module","source","user","ownerName","showOption"],data:function(){return{checked:Lyte.attr("boolean",{default:!0}),message:Lyte.attr("string",{default:I18n.getMsg("crm.restriction.apply.option.label")}),module:Lyte.attr("string"),source:Lyte.attr("string"),user:Lyte.attr("object"),ownerName:Lyte.attr("string",{default:"the user"}),showOption:Lyte.attr("boolean",{default:!1})}},init:function(){this.executeMethod("moduleCheck"),this.executeMethod("setMessageBySource")},methods:{setMessageBySource:function(){if(this.executeMethod("showBasedOnSource")){var e=this.data.user?this.data.user.full_name:this.data.ownerName,t=this.getData("source");"approvalprocess"===t&&(e=I18n.getMsg("crm.label.selected.owners"));var r=I18n.getMsg("crm.restriction.apply.option.label",e);"workflow_convert"===t&&(r=I18n.getMsg("crm.restriction.wfcreaterecord")),this.setData("message",r)}},moduleCheck:function(){var e=this;if(this.executeMethod("showBasedOnSource")){var t=this.getData("module").split(","),r=t.length;for(let i=0;i<r;i++){let r=t[i];e.isConfiguredRestrictionModule(r).then((function(t){t&&!e.getData("showOption")&&e.setData("showOption",!0)}))}}},showBasedOnSource:function(){var e=this.getData("source");return"workflow"===e||"blueprint"===e||"approvalprocess"===e||"macro"===e||"workflow_convert"===e||(this.setData("showOption",!1),!1)}},dataObserver:function(){this.executeMethod("moduleCheck"),this.executeMethod("setMessageBySource")}.observes("user","ownerName","source")},{mixins:["crm-assignment-threshold-common"]}),Lyte.Component.register("crm-userlist",{_template:'<template tag-name="crm-userlist"> <lyte-table border="0" width="100%" class="rolesUserTableList " id="rolesUserTable"> <lyte-table-structure> <lyte-thead> <lyte-tr> <template is="for" items="{{displayTable}}" item="item" index="index"> <lyte-th nowrap="">{{getI18n(item)}}</lyte-th> </template> </lyte-tr> </lyte-thead> <lyte-tbody> <template is="if" value="{{expHandlers(expHandlers(listHeadSize,\'!=\',0),\'||\',expHandlers(noMoreRecords,\'==\',true))}}"><template case="true"><template is="for" items="{{dList}}" item="item" index="index"> <lyte-tr> <lyte-td><link-to lt-prop-route="crm.settings.section.users.view" lt-prop-dp="[&quot;{{item.userId}}&quot;]" lt-prop-target="_blank">{{item.name}}</link-to></lyte-td> <template is="if" value="{{expHandlers(expHandlers(statusCheck[index],\'==\',3),\'||\',expHandlers(statusCheck[index],\'==\',4))}}"><template case="true"> <lyte-td>{{getI18n("crm.iam.user.does.not.exist")}}</lyte-td> </template><template case="false"> <lyte-td><a href="mailto:{{item.Email}}">{{item.email}}</a></lyte-td> </template></template> <lyte-td>{{item.status}}</lyte-td> <lyte-td>{{item.conStatus}}</lyte-td> <template is="if" value="{{isreportingheirarchy}}"><template case="true"> <lyte-td>{{item.reportingManager}}</lyte-td> </template></template> </lyte-tr> </template></template></template> </lyte-tbody> </lyte-table-structure> </lyte-table> <template is="if" value="{{expHandlers(expHandlers(listHeadSize,\'==\',0),\'&amp;&amp;\',expHandlers(noMoreRecords,\'==\',false))}}"><template case="true"> <lyte-table> <lyte-table-structure> <lyte-tr> <lyte-td class="aligncenter">{{getI18n("crm.security.role.associated.users.none")}}</lyte-td> </lyte-tr> </lyte-table-structure> </lyte-table> </template></template> <template is="if" value="{{expHandlers(index,\'>\',0)}}"><template case="true"> <div class="navContent"> <lyte-navigator on-next="{{method(\'nextRecord\')}}" on-previous="{{method(\'previousRecord\')}}" lt-prop-value="{{fromIndex}}" lt-prop-records="{{listHeadSize}}" lt-prop-perpage="{{endIndex}}" lt-prop-middle-text="{{getI18n(to)}}"> </lyte-navigator> </div> </template></template> <div class="frameloading {{if(load,\'dB\',\'dN\')}}"></div> </template>',_dynamicNodes:[{type:"attr",position:[1,1,1,1,1]},{type:"for",position:[1,1,1,1,1],dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"attr",position:[1,1,3,1]},{type:"if",position:[1,1,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"for",position:[0],dynamicNodes:[{type:"attr",position:[1,1,0]},{type:"text",position:[1,1,0,0]},{type:"componentDynamic",position:[1,1,0]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1,0]},{type:"text",position:[1,0,0]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"text",position:[1,5,0]},{type:"componentDynamic",position:[1,5]},{type:"text",position:[1,7,0]},{type:"componentDynamic",position:[1,7]},{type:"attr",position:[1,9]},{type:"if",position:[1,9],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1]}]}]}},default:{}},{type:"componentDynamic",position:[1,1,3]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,1,1,0]},{type:"componentDynamic",position:[1,1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[5]},{type:"if",position:[5],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]}]}},default:{}},{type:"attr",position:[7]}],_observedAttributes:["load","fromIndex","endIndex","listHeadSize","dataAdded","displayData","index","statusCheck","isreportingheirarchy","roleid","tablecontent","dList","displayTable","cxPropExclude","cxPropPerPage","cxPropPrimaryKey","cxPropRecords","cxPropNetworkData","currentPos","localData","pageNo","noMoreRecords","systemData","isSearch","to"],data:function(){return{load:Lyte.attr("boolean",{default:!0}),fromIndex:Lyte.attr("number",{default:0}),endIndex:Lyte.attr("number",{default:50}),listHeadSize:Lyte.attr("number",{default:0}),dataAdded:Lyte.attr("number",{default:0}),displayData:Lyte.attr("array",{default:[]}),index:Lyte.attr("number",{default:0}),statusCheck:Lyte.attr("array"),isreportingheirarchy:Lyte.attr("boolean"),roleid:Lyte.attr("string"),tablecontent:Lyte.attr("object"),dList:Lyte.attr("array",{default:[]}),displayTable:Lyte.attr("array",{default:[]}),cxPropExclude:Lyte.attr("array",{default:[]}),cxPropPerPage:Lyte.attr("number",{default:200}),cxPropPrimaryKey:Lyte.attr("string",{default:"id"}),cxPropRecords:Lyte.attr("number",{default:100}),cxPropNetworkData:Lyte.attr("object",{default:{cxPropModuleName:"user",cxPropCacheQuery:!1,cxPropDataCache:!1}}),currentPos:Lyte.attr("number",{default:0}),localData:Lyte.attr("array",{default:[]}),pageNo:Lyte.attr("number",{default:1}),noMoreRecords:Lyte.attr("boolean",{default:!0}),systemData:Lyte.attr("array",{default:[]}),isSearch:Lyte.attr("boolean",{default:!0}),to:Lyte.attr("string",{default:"crm.label.lowercase.to"})}},init:function(){var e=[];for(var t in this.getData("tablecontent"))e.push(this.getData("tablecontent")[t]);this.setData("displayTable",e),this.constructArray("RolesUserList",!1).then(function(){this.executeMethod("addDataToJSON",this.getData("systemData")),this.setData("cxPropRecords",50)}.bind(this))},setCriteria:function(){return{criteria:"(role:equals:"+this.getData("roleid")+")",fields:"full_name,email,status,confirm,Reporting_To.full_name,Reporting_To.role",tempApiVersion:"V2.2",include_lite_users:!0}},loadMoreData:function(){this.setData("listHeadSize",this.getData("systemData").length)},methods:{addDataToJSON:function(e){for(var t=[],r=[],i=this.getData("index"),a=0,s=this.getData("endIndex"),o=e.length;i>=0&&i<i+s&&i<o;i++){var n={};switch(n.name=e[i].full_name,n.email=e[i].email,e[i].status){case"active":n.status=I18n.getMsg("Active"),r[a]=1;break;case"disabled":n.status=I18n.getMsg("Disabled"),r[a]=2;break;case"deleted":n.status=I18n.getMsg("DeletedUser"),r[a]=3;break;case"closed":n.status=I18n.getMsg("Closed"),r[a]=4}if(n.userId=e[i].id,4!=r[a]?1==e[i].confirm?n.conStatus=I18n.getMsg("Confirmed"):n.conStatus=I18n.getMsg("crm.label.notconfirmed"):n.conStatus=I18n.getMsg("Closed"),null!=e[i].Reporting_To&&null!=e[i].Reporting_To.full_name&&null!=e[i].Reporting_To.role.name){var l=e[i].Reporting_To.full_name+" ("+e[i].Reporting_To.role.name+")";n.reportingManager=l}else n.reportingManager="---";t[a]=n,a++,s--}this.setData("index",i>0?i:0),this.setData("statusCheck",r),this.setData("displayData",e),this.setData("dList",t),(t.length>0||0==this.getData("noMoreRecords"))&&this.setData("load",!1),this.setData("dataAdded",a),this.setData("listHeadSize",this.getData("systemData").length)},nextRecord:function(){this.setData("fromIndex",this.getData("fromIndex")+this.getData("endIndex")),this.getData("fromIndex")+this.getData("endIndex")>=this.getData("systemData").length&&this.constructArray("RolesUserList",!1),this.executeMethod("addDataToJSON",this.getData("systemData"))},previousRecord:function(){this.setData("fromIndex",this.getData("fromIndex")-this.getData("endIndex")),this.setData("index",this.getData("index")-(this.getData("endIndex")+this.getData("dataAdded"))),this.executeMethod("addDataToJSON",this.getData("systemData"))}}},{mixins:["crux-user-utils"]}),Lyte.Component.register("crm-userdelete-notification",{_template:'<template tag-name="crm-userdelete-notification"> <template is="if" value="{{expHandlers(&quot;progress&quot;,\'==\',status)}}"><template case="true"> <div class="picklist_progress progressBarAnime"> <p class="pB20 pR pL8">{{message}}</p> <div class="pR progBarWarp"> <div class="progBarWheel"></div> </div> </div> </template></template> <template is="if" value="{{expHandlers(&quot;completed&quot;,\'==\',status)}}"><template case="true"> <div class="schedularMsg"> <p class="pB5 pL10 succesIcoSchedular pR">{{message}}</p> <a href="#" class="f13 mL2 pL10 uline1 viewInfoTbl" onclick="{{action(\'viewUpdatedInfo\',this)}}">{{getI18n(\'crm.delete.user.transfer_delete.notification.info\')}}</a> <div class=" f13 viewInfoData tdu_viewInfoData dN"> <span class="col555 pB5 dIB">{{getI18n(\'crm.delete.user.transfer_delete.notification.info.title\')}}</span> <div class=""> <ul class="p0 m0"> <template is="if" value="{{expHandlers(&quot;true&quot;,\'==\',record)}}"><template case="true"> <li>{{getI18n(\'crm.delete.user.transfer_delete.notification.info.record\')}}</li> </template></template> <template is="if" value="{{expHandlers(&quot;true&quot;,\'==\',assignment)}}"><template case="true"> <li>{{getI18n(\'crm.delete.user.transfer_assignment\')}}</li> </template></template> <template is="if" value="{{expHandlers(&quot;true&quot;,\'==\',criteria)}}"><template case="true"> <li>{{getI18n(\'crm.delete.user.transfer_criteria\')}}</li> </template></template> </ul> </div> </div> </div> </template></template> <template is="if" value="{{expHandlers(&quot;failure&quot;,\'==\',status)}}"><template case="true"> <div class="schedularMsg"> <p class="pB5 pL10 succesIcoSchedular pR">{{message}}</p> </div> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,0]}]}},default:{}},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,0]},{type:"attr",position:[1,3]},{type:"text",position:[1,3,0]},{type:"text",position:[1,5,1,0]},{type:"attr",position:[1,5,3,1,1]},{type:"if",position:[1,5,3,1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[1,5,3,1,3]},{type:"if",position:[1,5,3,1,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[1,5,3,1,5]},{type:"if",position:[1,5,3,1,5],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]}},default:{}},{type:"attr",position:[5]},{type:"if",position:[5],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,0]}]}},default:{}}],_observedAttributes:["title","jobId","status","message","record","assignment","criteria"],data:function(){return{title:Lyte.attr("string"),jobId:Lyte.attr("string"),status:Lyte.attr("string"),message:Lyte.attr("string"),record:Lyte.attr("string",{default:"false"}),assignment:Lyte.attr("string",{default:"false"}),criteria:Lyte.attr("string",{default:"false"})}},actions:{viewUpdatedInfo:function(e){$(".viewInfoTbl").removeClass("dN"),$(".viewInfoData").slideUp(300),$(e).addClass("dN"),$(e).siblings(".viewInfoData").slideDown(300)}}}),Lyte.Component.register("crm-detailview-footer",{_template:'<template tag-name="crm-detailview-footer"> <template is="if" value="{{expHandlers(expHandlers(expHandlers(expHandlers(expHandlers(module,\'===\',\'Tasks\'),\'||\',expHandlers(module,\'===\',\'Events\')),\'||\',expHandlers(module,\'===\',\'Calls\')),\'||\',expHandlers(module,\'===\',\'Activities\')),\'!\')}}"><template case="true"> <template is="if" value="{{expHandlers(isCanvas,\'!\')}}"><template case="true"> <br><br><br><br><br><br> </template></template> <div class="detailsfooter"> <lyte-popover id="morecustoptions_footer" lt-prop-placement="topRight" lt-prop-origin-elem="#detailfooterrighticon" lt-prop-content-padding="8px" lt-prop-freeze="false" lt-prop-height="auto" lt-prop-duration="100" lt-prop-show-close-button="false"> <template is="registerYield" yield-name="popover"> <lyte-popover-content> <div> <div><a href="javascript:void(0);" onclick="{{action(\'showCustomizePopup\',\'SummaryView\')}}">{{getI18n("crm.business.card.customize")}}</a></div> <div><a href="javascript:void(0);" onclick="{{action(\'showCustomizePopup\',\'RelatedList\')}}">{{getI18n("crm.label.customize.module",module)}}</a></div> </div> </lyte-popover-content> </template> </lyte-popover> <div class="detailsfootercontainer pR20"> <div> <template is="if" value="{{showaddrelatedlist}}"><template case="true"> <div id="newRelatedListDiv" class="p10"> <input type="button" class="primarybtn newbutton mL20" data-zcqa="detail_lead_addrelatedlist" value="{{getI18n(&quot;crm.label.newCustomRelatedList&quot;)}}" onclick="{{action(\'addNewRelatedList\')}}"> <input type="hidden" name="rlContentChngd" value="false"> </div> </template></template> </div> <template is="if" value="{{expHandlers(expHandlers(canvasAccessible,\'&amp;&amp;\',expHandlers(module,\'!==\',\'Campaigns\')),\'&amp;&amp;\',expHandlers(hideCanvasOptions,\'!\'))}}"><template case="true"> <div class="detailfooterswitch"> <div class="vline"></div> <span class=" mR20 pR">{{getI18n(\'crm.canvas.recordviews\')}}</span> <template is="if" value="{{expHandlers(isrendered,\'||\',isCanvas)}}"><template case="true"> <crux-dropdown id="detailviewswitch" class="mR20" data-zcqa="canvas_select_dd" on-option-select="{{method(\'viewchange\')}}" cx-prop-maxsearch="5" cx-prop-selected="{{currentview}}" cx-prop-options="{{canvasviewDropdown}}" cx-prop-user-value="name" cx-prop-system-value="id"></crux-dropdown> <div class="vline"></div> </template><template case="false"> <div class="w150"></div> </template></template> <template is="if" value="{{expHandlers(canvasCreate,\'&amp;&amp;\',expHandlers(hideCanvasOptions,\'!\'))}}"><template case="true"><template is="if" value="{{expHandlers(currentview,\'!==\',\'default\')}}"><template case="true"> <lyte-button class="link1 mR10 pR" data-zcqa="edit_canvas" onclick="{{action(\'editcanvas\',\'crm.settings.section.modules.module.canvas.edit\',module,layout,currentview,entity)}}"> <template is="registerYield" yield-name="text">{{getI18n(\'Edit\')}}</template> </lyte-button> </template></template> <template is="if" value="{{expHandlers(canvasAccessible,\'&amp;&amp;\',isCanvas)}}"><template case="true"> <crm-canvas-assignment is-selection-disabled="true" id="canvasbuilderassign" feature="DetailView" show="{{lbind(showAssignPopup)}}"></crm-canvas-assignment> <lyte-button class="link1 mR10 pR" data-zcqa="footer_assign_canvas" onclick="{{action(\'openCanvasAssignment\')}}"> <template is="registerYield" yield-name="text">{{getI18n(\'crm.canvas.assignment\',\'Canvas\')}}</template> </lyte-button> </template></template> <template is="if" value="{{expHandlers(expHandlers(viewsCount,\'<\',maxViewLimit),\'&amp;&amp;\',canvasBannerEnabled)}}"><template case="true"> <template is="if" value="{{expHandlers(expHandlers(expHandlers(expHandlers(isCanvas,\'!\'),\'&amp;&amp;\',showCanvasBanner),\'&amp;&amp;\',canvasCreate),\'&amp;&amp;\',canvasAccessible)}}"><template case="true"> <lyte-button data-zcqa="create_canvas" onclick="{{action(\'showGalleryPopup\')}}" class="try-canvas-btn cP" id="try-canvas-btn"> <template is="registerYield" yield-name="text">{{getI18n(\'crm.canvas.try\',\'Canvas\')}}</template> </lyte-button> </template><template case="false"> <lyte-button class="link1 mR20 pR" data-zcqa="create_canvas" onclick="{{action(\'showGalleryPopup\')}}"> <template is="registerYield" yield-name="text">{{getI18n(\'crm.canvas.createcanvaspage\')}}</template> </lyte-button> </template></template> </template></template> <div class="vline"></div> </template></template> <template is="if" value="{{expHandlers(currentview,\'!==\',\'default\')}}"><template case="true"> <span><lyte-checkbox data-zcqa="fit_to_screen" lt-prop-name="fixed" lt-prop-checked="true" lt-prop-value="val" lt-prop-id="fixed" lt-prop-label="{{getI18n(\'crm.layout.fit.to.screen\')}}" on-checked="{{method(\'changeTofluid\')}}" on-unchecked="{{method(\'changeTofixed\')}}" id="zcFitscreen"> </lyte-checkbox> </span> </template></template> </div> </template></template> <template is="if" value="{{expHandlers(expHandlers(expHandlers(expHandlers(expHandlers(isCanvas,\'!\'),\'&amp;&amp;\',showCanvasBanner),\'&amp;&amp;\',canvasBannerEnabled),\'&amp;&amp;\',canvasCreate),\'&amp;&amp;\',canvasAccessible)}}"><template case="true"> <div class="new-canvas-banner-container" data-zcqa="canvas_banner"> <span class="zc-close-banner" data-zcqa="close_canvas_banner" onclick="{{action(\'closeBanner\',event)}}"></span> <div class="zc-banner-video-container"> <video muted="" loop="" id="zc-canvas-banner-video"> <source src="{{getCrmClientImageUrl(\'Canvas_animation_0ca951a_.mp4\')}}" type="video/mp4"> </video> </div> <div class="zc-banner-about-container"> <div class="pR"> <span class="zc-banner-label">{{getI18n(\'crm.button.new\')}}</span> <div class="zc-banner-text-container"> <span class="zc-banner-small-text">{{getI18n(\'crm.canvas.banner.introcanvas\',\'Canvas\')}}</span> </div> </div> <div class="mT10 zc-banner-large-text"> <div class="crm-font-bold f16">{{getI18n(\'crm.canvas.banner.industryfirst\')}}</div> <div class="crm-font-xbold f24 mT5">{{unescape(getI18n(\'crm.canvas.banner.crmdesginstudio\',\'CRM\'))}}</div> </div> <div class="mT20 zc-banner-actionarea"> <div class="f13 w240"> <div>{{unescape(getI18n(\'crm.canvas.banner.nocodetext\',CrmbrandName,\'CRM\',\'Canvas\'))}}</div> <div class="mT5"><span class="link1" onclick="{{action(\'openHelpLink\')}}">{{getI18n(\'crm.ntc.manage.helptext.trigger.learnmore\')}}</span></div> </div> <div class="zc-actionbbtn-area"> <div class="zc-checkout-waves-container pR" id="zc-canvas-banner-checkoutanim"> <div class="zc-checkout-btn cP" onclick="{{action(\'showTryCanvasButton\')}}"> </div> <div class="zc-checkout-waves-anim"> <div class="zc-checkout-wave zc-checkout-wave1"></div> <div class="zc-checkout-wave zc-checkout-wave2"></div> <div class="zc-checkout-wave zc-checkout-wave3"></div> </div> </div> </div> </div> </div> </div> </template></template> </div> </div> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[]}},default:{}},{type:"registerYield",position:[3,1,1],dynamicNodes:[{type:"attr",position:[1,1,1,0]},{type:"text",position:[1,1,1,0,0]},{type:"attr",position:[1,1,3,0]},{type:"text",position:[1,1,3,0,0]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3,1]},{type:"attr",position:[3,3,1,1]},{type:"if",position:[3,3,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]}]}},default:{}},{type:"attr",position:[3,3,3]},{type:"if",position:[3,3,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,3,0]},{type:"attr",position:[1,5]},{type:"if",position:[1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[]}},default:{}},{type:"attr",position:[1,7]},{type:"if",position:[1,7],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[2]},{type:"if",position:[2],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[3]}]}},default:{}},{type:"attr",position:[4]},{type:"if",position:[4],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,9]},{type:"if",position:[1,9],cases:{true:{dynamicNodes:[{type:"attr",position:[1,0]},{type:"componentDynamic",position:[1,0]}]}},default:{}}]}},default:{}},{type:"attr",position:[3,3,5]},{type:"if",position:[3,3,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"attr",position:[1,3,1,1]},{type:"text",position:[1,5,1,1,0]},{type:"text",position:[1,5,1,3,1,0]},{type:"text",position:[1,5,3,1,0]},{type:"text",position:[1,5,3,3,0]},{type:"text",position:[1,5,5,1,1,0]},{type:"attr",position:[1,5,5,1,3,0]},{type:"text",position:[1,5,5,1,3,0,0]},{type:"attr",position:[1,5,5,3,1,1]}]}},default:{}}]}},default:{}}],_observedAttributes:["showaddrelatedlist","module","layout","entity","canvasview","canvasviewDropdown","cscriptconfig","currentview","viewsCount","maxViewLimit","canvasAccessible","canvasCreate","showAssignPopup","isrendered","isCanvas","showNoView","showCanvasBanner","canvasBannerEnabled","CrmbrandName","hideCanvasOptions"],data:function(){return{showaddrelatedlist:Lyte.attr("boolean"),module:Lyte.attr("string"),layout:Lyte.attr("string"),entity:Lyte.attr("string"),canvasview:Lyte.attr("array"),canvasviewDropdown:Lyte.attr("array",{default:[]}),cscriptconfig:Lyte.attr("object",{default:{}}),currentview:Lyte.attr("string",{default:"default"}),viewsCount:Lyte.attr("number"),maxViewLimit:Lyte.attr("number"),canvasAccessible:Lyte.attr("boolean"),canvasCreate:Lyte.attr("boolean"),showAssignPopup:Lyte.attr("boolean"),isrendered:Lyte.attr("boolean",{default:!1}),isCanvas:Lyte.attr("boolean",{default:!1}),showNoView:Lyte.attr("boolean",{default:!1}),showCanvasBanner:Lyte.attr("boolean"),canvasBannerEnabled:Lyte.attr("boolean"),CrmbrandName:Lyte.attr("string",{default:Crm.brandName}),hideCanvasOptions:Lyte.attr("boolean",{default:!1})}},init:function(){this.setData("showCanvasBanner",!1),this.setData("canvasBannerEnabled",!0)},didConnect:function(){var e=this.getData("layout"),t=this.getData("module"),r=["Visits","Activities","Tasks","Events","Calls","Campaigns","Services__s","Appointments__s","Job_Sheets__s","Consents","Data_Subject_Requests","zohoshowtime__ShowTime_Sessions","zohoshowtime__Zoho_ShowTime","Desk","Forecasts"];if(!store.peekAll("module").filter((function(e){return-1!==r.indexOf(e.api_name)&&e.api_name===t})).length){var i=this.getData("canvasview"),a=this.getData("currentview"),s=this.getData("isCanvas"),o=i?i.length:0;this.setData("viewsCount",o);var n=i?i.filter((function(e){return e.id===a})):[];if(n&&n.length>0)var l=n[0].ui.value.fixed;if(""==e&&"detail"==Lyte.Router.getRouteInstance().routeName&&returnJson&&returnJson.layout_jsonarrayObj&&returnJson.layout_jsonarrayObj.currLayoutId&&(e=returnJson.layout_jsonarrayObj.currLayoutId,this.setData("layout",e)),!s&&e)store.findAll("canvasview",{module:t,feature:"DetailView"}).then(function(t){if(this.data){var r=t.$.meta.maxViewLimit;this.setData("maxViewLimit",r),this.setlimitBasedOnEdition(t);var i=t||[];i=i.filter((function(t){return t.layout_id===e})),this.setData("canvasview",i),this.constructDropdownArray(),this.setData("isrendered",!0),this.setDropdownvalue()}}.bind(this));else{var c=this.getData("canvasview");this.setlimitBasedOnEdition(c),c&&e&&(c=c.filter((function(t){return t.layout_id===e})),this.setData("canvasview",c),this.constructDropdownArray())}l?$L("#zcFitscreen").attr("lt-prop-checked",!1):$(".zc-page-component").addClass("fluidlayout");var d=this.getData();!d.isCanvas&&d.showCanvasBanner&&d.canvasCreate&&d.canvasAccessible&&setTimeout((function(){var e=$L("#zc-canvas-banner-video");e[0]&&e[0].play(),setTimeout((function(){$L("#zc-canvas-banner-checkoutanim").addClass("zc-checkout-start-waves"),Crm.client_tracking("Canvas release banner showing")}),200)}),4e3)}},setlimitBasedOnEdition:function(e){if(e&&!Customization.orgSpec.includes(Crm.userDetails.LICENSE_TYPE)){var t=e?e.length:0;this.setData("viewsCount",t)}else{var r;r=Customization.orgSpec.includes(Crm.userDetails.LICENSE_TYPE)?{feature:"DetailView",from_range:1}:{module:this.getData("module"),feature:"DetailView"},store.findAll("canvasview",r).then(function(e){var t=e.$.meta.maxViewLimit;this.setData("maxViewLimit",t);var r=e?e.length:0;this.setData("viewsCount",r)}.bind(this))}},openCanvasAssignment:function(e){var t=networkUtils.returnDependencyFiles(["crm-canvas-builder.js","user_type.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles(["crm-canvas-builder.css"],crmConstants.cssStaticPathForLyte);this._track("Assign"),Lyte.injectResources([t,r]).then(function(){var t=document.querySelector("#canvasbuilderassign");if(t){var r=this.getData("layout"),i=this.getData("module"),a=store.peekRecord("module",moduleRecordMapping[i].id),s=a.module_name,o=[{name:a.plural_label,id:a.module_name}],n=a.layouts.filterBy({id:r});t.setData({modules:o,layouts:n,selectedLayout:r}),t.setData("selectedModule",s),t.setData("isfromfooter",e),t.component.updatepopup(t.component,r,!0)}}.bind(this))},hideViews:function(e){var t=$u.clone(this.getData("cscriptconfig").views);if(t){var r=-1;t.map((function(t,i){t.id===e&&(r=i)})),r>-1&&t.splice(r,1),this.setData("canvasviewDropdown",t)}},actions:{showTryCanvasButton:function(){var e=$L("crm-detailview-footer");$L("#dvinner").scrollTo(e,{duration:1e3}),$(".new-canvas-banner-container").fadeOut(1e3),Crm.client_tracking("Canvas release Checkout click")},openHelpLink:function(){openHelp(this.canvasHelpDoc()),Crm.client_tracking("Canvas release Helplink open")},closeBanner:function(e){e.stopPropagation(),this.removeBanner()},openCanvasAssignment:function(){this.openCanvasAssignment()},showmorecustomization:function(){var e=document.getElementById("morecustoptions_footer");e.setData("ltPropPlacement","topRight"),e.setData("ltPropShow",!0)},editcanvas:function(e,t,r,i,a){this._track("Edit"),openNewTab(Lyte.Router.getURL(e,t,r,i),"canvas","get",{id:a})},createcanvas:function(){var e=this.getData("module"),t=this.getData("layout"),r=this.getData("entity");this.createnewcanvas("crm.settings.section.modules.module.canvas.create",e,t,r)},showGalleryPopup:function(){var e=this.getGalleryResources();Lyte.injectResources(e,void 0,(function(){Lyte.Component.render("crm-detailview-canvas-gallery",{},"#show")}))},showCustomizePopup:function(e){showCustomizePopup(e,this.getData("module"))},addNewRelatedList:function(){CustomRelatedListObj.addNewRelatedList()}},removeBanner:function(){if(this.getData("showCanvasBanner")){var e=this;networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CanvasGallery.do?action=closeCanvasBanner","GET",{skip_load_tab:!0}).then((function(){e.setData("showCanvasBanner",!1)}))}},getGalleryResources:function(){var e=networkUtils.returnDependencyFiles(["crm-detailview-canvas-gallery.js","crm-detailview-canvas-utils.js"],crmConstants.jsStaticPathForLyte);return e=(e=(e=e.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customization")],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles(["zohocrm_detailview_canvas.js"],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles(["crm-detailview-canvas-gallery.css"],crmConstants.cssStaticPathForLyte))},createnewcanvas:function(e,t,r,i){openNewTab(Lyte.Router.getURL(e,t,r),"canvas","get",{id:i})},_track:function(e,t){var r=this.getData("isCanvas")?"Customized":"Standard";t||(t={}),t.Module=this.getData("module"),Crm.client_tracking("CanvasDetailPage - "+r+" - "+e,t)},methods:{viewchange:function(e,t){var r=this.getData("module"),i=this.getData("layout"),a=this.getData("entity");if("create"==t){this.createnewcanvas("crm.settings.section.modules.module.canvas.create",r,i,a),document.getElementById("detailviewswitch").setData("ltPropSelected",this.getData("currentview"))}else"default"==t?this.gotodefault(r,a):this.updateDefaultCanvas(r,a,t)},changeTofixed:function(){$(".zc-page-component").removeClass("fluidlayout"),this._track("Fixed")},changeTofluid:function(){$(".zc-page-component").addClass("fluidlayout"),this._track("Fluid")},showTickIcon:function(){var e=this.getData("currentview"),t=document.getElementById("viewmenu_"+e);t&&t.setAttribute("selected","true")},checkResult:function(e){0===e.length?this.setData("showNoView",!0):this.setData("showNoView",!1)},onOpeningDropdown:function(){$L("#canvasViewSearch").focus()},onClosingDropdown:function(e,t){var r=$L("#canvasViewSearch");r&&r[0]&&r[0].setValue(""),$(t.$node)}},updatedropdown:function(e){var t=this.getData("layout"),r=this.getData("module"),i=this.getData("canvasview"),a=i?i.length:0;this.setData("viewsCount",a),""==t&&"detail"==Lyte.Router.getRouteInstance().routeName&&returnJson&&returnJson.layout_jsonarrayObj&&returnJson.layout_jsonarrayObj.currLayoutId&&(t=returnJson.layout_jsonarrayObj.currLayoutId),t&&store.findAll("canvasview",{module:r,feature:"DetailView"}).then(function(r){this.setlimitBasedOnEdition(r);var i;i=r.filter((function(e){return e.layout_id===t})),this.setData("canvasview",i),this.constructDropdownArray(),this.setData("isrendered",!0);var a=this.getData("currentview"),s=document.getElementById("detailviewswitch");s&&e&&s.component&&(s.component.setData("ltPropSelected",""),s.component.setData("ltPropSelected",a))}.bind(this))},createnewcanvas:function(e,t,r,i){var a=this.getData("canvasCreate"),s=this.getData("canvasAccessible");this._track("Create"),a&&s&&openNewTab(Lyte.Router.getURL(e,t,r),"canvas","get",{id:i})},editcanvas:function(e,t,r,i,a){var s=this.getData("canvasCreate"),o=this.getData("canvasAccessible");this._track("Edit"),s&&o&&openNewTab(Lyte.Router.getURL(e,t,r,i),"canvas","get",{id:a})},gotodefault:function(e,t){if(crmNavig&&crmNavig[crmNavig.customViewKey]&&crmListView.getObject().fromIndex&&crmListView.getObject().toIndex)var r=crmNavig[crmNavig.customViewKey].recordId.map((function(e){return e.id})).indexOf(t);this._track("Switch to Default"),r&&r>0?Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[e,t],queryParams:{redirect:"false"},target:"_blank"}).data={FROM_INDEX:crmListView.getObject().fromIndex,TO_INDEX:crmListView.getObject().toIndex,recordNum:r,cvid:customViewObject.cvId,fromDel:!1,navig:!0}:Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[e,t],queryParams:{redirect:"false"},target:"_blank"})},updateDefaultCanvas:function(e,t,r){if(this.getData("currentview")!==r){this._track("Switch to Canvas");var i=$("#recordNum").val();Lyte.Router.transitionTo({route:"crm.tab.module.entity.canvas",dynamicParams:[e,t,r]}).data={recordNum:i}}},setDropdownvalue:function(){this.getData("currentview")},constructDropdownArray:function(){var e=[{"data-value":"default",name:I18n.getMsg("crm.standard.view"),id:"default"}],t=this.getData("canvasview");t=t&&t.length>0?t.filter((function(e){return 1===e.canvas_status})):[],e=e.concat(t),this.setData("canvasviewDropdown",e);var r=this.getData("cscriptconfig");r&&(r.views=e)}},{mixins:["crm-detailcanvas-utils"]}),Lyte.Component.register("crm-detail-view-common",{_template:'<template tag-name="crm-detail-view-common"> <lyte-modal id="closeTaskPopup" lt-prop-wrapper-class="crmBoxModal" lt-prop-offset="{&quot;top&quot;:&quot;0&quot;}" lt-prop-yield="true" lt-prop-show-close-button="false"> <template is="registerYield" yield-name="modal"> <lyte-modal-header>{{getI18n(\'crm.confirm.close.task\')}}</lyte-modal-header> <lyte-modal-footer class="center"> <lyte-button onclick="{{action(\'cancelTaskPopUp\')}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.cancel\')}} </template> </lyte-button> <lyte-button lt-prop-appearance="primary" onclick="{{action(\'closeTask\')}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.label.mark.completed\')}} </template> </lyte-button> <div class="mT5"> ( <lyte-checkbox id="taskPopupCheckBoxId" lt-prop-checked="false" lt-prop-id="checkbox" lt-prop-label="{{getI18n(\'crm.zohosocial.never.show\')}}" on-changed="{{method(\'closeTaskDontShow\')}}"></lyte-checkbox> ) </div> </lyte-modal-footer> </template> </lyte-modal> <lyte-modal id="removeParticipantPopup" lt-prop-wrapper-class="crmBoxModal" lt-prop-offset="{&quot;top&quot;:&quot;0&quot;}" lt-prop-yield="true" lt-prop-show-close-button="false" lt-prop-max-width="600px"> <template is="registerYield" yield-name="modal"> <lyte-modal-header class="crm-font-regular">{{removeParticipantTitle}}</lyte-modal-header> <lyte-modal-footer class="center"> <lyte-button lt-prop-appearance="failure" onclick="{{action(\'removeParticipantButton\')}}"> <template is="registerYield" yield-name="text"> {{removeParticipantButtonTitle}} </template> </lyte-button> <template is="if" value="{{showDontNotifyButton}}"><template case="true"> <lyte-button lt-prop-appearance="default" onclick="{{action(\'removeParticipantButton\',expHandlers(1,\'-\'))}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.event.btn.dnt.notify.part.singular\')}} </template> </lyte-button> </template></template> <span class="blueTxt mL5 cursorPointer" onclick="{{action(\'cancelParticpant\')}}">{{getI18n(\'crm.button.cancel\')}}</span> </lyte-modal-footer> </template> </lyte-modal> <lyte-menu lt-prop-yield="true" lt-prop-event="click" lt-prop-query="lyte-th.sortRelated > lyte-text" on-menu-click="{{method(\'sortRecord\')}}" on-before-open="{{method(\'sortButtonDisplay\')}}" data-zcqa="sort_div" lt-prop-freeze="false"> <template is="registerYield" yield-name="yield"> <lyte-menu-body id="sort_div"> <template is="for" items="{{sortDetails}}" item="order" index="index"> <lyte-menu-item data-value="{{order}}" data-zcqa="sorting_{{order}}"> <template is="if" value="{{expHandlers(order,\'==\',&quot;unsort&quot;)}}"><template case="true"> {{getI18n("crm.column.unsort")}} </template><template case="false"> {{getI18n(concat("crm.column.sort.",order))}} </template></template><template is="if" value="{{ifAnyMatch(order,\'=\',\'asc\',order,\'=\',\'desc\')}}"><template case="true"> <span class="svgIcons sort_{{if(ifEquals(order,\'asc\'),\'asc\',\'desc\')}}"></span> </template></template> </lyte-menu-item> </template> </lyte-menu-body> </template> </lyte-menu> <div id="columnList" style="display:none;position:fixed;z-index:2" onclick="{{action(\'stopEvent\')}}"></div> <div id="viewcontainer"></div> </template>',_dynamicNodes:[{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"registerYield",position:[3,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[3,1]},{type:"attr",position:[3,3]},{type:"registerYield",position:[3,3,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[3,3]},{type:"attr",position:[3,5,1]},{type:"componentDynamic",position:[3,5,1]},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[1]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"registerYield",position:[3,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[3,1]},{type:"attr",position:[3,3]},{type:"if",position:[3,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3,5]},{type:"text",position:[3,5,0]},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5]},{type:"registerYield",position:[5,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}},{type:"attr",position:[1,2]},{type:"if",position:[1,2],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[5]},{type:"attr",position:[7]}],_observedAttributes:["sortDetails","sortRelatedId","taskId","recordName","removeParticipantButtonTitle","showDontNotifyButton","dontShowPopup"],data:function(){return{sortDetails:Lyte.attr("array"),sortRelatedId:Lyte.attr("string"),taskId:Lyte.attr("string"),recordName:Lyte.attr("string"),removeParticipantButtonTitle:Lyte.attr("string"),showDontNotifyButton:Lyte.attr("boolean"),dontShowPopup:Lyte.attr("boolean",!1)}},methods:{closeTaskDontShow:function(e){this.setData("dontShowPopup",e.checked)},sortButtonDisplay:function(e,t,r){var i=r&&r.parentElement?r.parentElement:void 0;if(i){var a;try{if(this.sortComp=t.path.filter((e=>"CRM-RELATED-LIST-VIEW-HEADER"==e.tagName))[0].component,!this.sortComp.data.relatedList.customize_sort)return!1;this.setData("sortDetails",this.sortComp.data.sortDetails),a=this.sortComp.data.relatedListFields.filter((e=>e.id==i.id))}catch(e){murphy.error(e)}return!(a&&(3==a.ui_type||999==a.ui_type||208==a.ui_type||110==a.ui_type||1e3==a.ui_type||209==a.ui_type)||"Visits"==this.getData("module")&&"SEID"==a.column_name||"Dealhistory"==this.getData("relatedModule"))}},sortRecord:function(e){this.sortComp.sortRecord(e)}},actions:{closeTask:function(){this.getData("dontShowPopup")&&(localStorage.setItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID,!0),Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup=!0),this.updateCloseTask(),this.$node.querySelector("#closeTaskPopup").ltProp("show",!1)},cancelTaskPopUp:function(){this.$node.querySelector("#closeTaskPopup").ltProp("show",!1),this.getData("dontShowPopup")&&$L("#taskPopupCheckBoxId").attr("lt-prop-checked",!1)},removeParticipantButton:function(e){for(var t=Lyte.deepCopyObject(this.data.event.Participants),r=t.length,i=0;i<r;i++)if(t[i].participant==this._record.id){Lyte.arrayUtils(t,"removeAt",i);break}this.data.event.$.set("Participants",t),this.data.event.$.set("$delete_send_notification",-1!=e),this.data.event.$.save().then((function(){Lyte.triggerEvent("relatedList",{module:"Events"})})),this.$node.querySelector("#removeParticipantPopup").ltProp("show",!1)},cancelParticpant:function(){this.$node.querySelector("#removeParticipantPopup").ltProp("show",!1)}},closeTask:function(e){this.setData("taskId",e);var t=localStorage.getItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID);Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup||t?this.updateCloseTask():this.$node.querySelector("#closeTaskPopup").ltProp("show",!0)},updateCloseTask:function(){var e,t=store.peekRecord(moduleRecordMapping.Tasks.id,this.getData("taskId")),r=store.peekAll("field").filter((function(e){return"Status"===e.api_name&&e.module&&e.module[0]&&("Activities"===e.module[0].api_name||"Tasks"===e.module[0].api_name)}))[0];if(r){if(e=r.pick_list_values.filter((function(e){return"Completed"===e.actual_value}))[0].display_value,t.$.set("Status",e),t.$.isError)for(var i in t.$.error)t.$.set(i,t[i]);t.$.save().then((function(){Lyte.triggerEvent("relatedList",{module:Crm.isActivitySplitDone?"Tasks":"Activities"})}),(function(){renderingUtils.displayPermissionDenied()}))}else store.findRecord("module",moduleRecordMapping.Tasks.id,void 0,void 0,void 0,{getFields:!0}).then((function(){r=store.peekAll("field").filter((function(e){return"Status"===e.api_name&&e.module&&e.module[0]&&("Activities"===e.module[0].api_name||"Tasks"===e.module[0].api_name)}))[0],e=r.pick_list_values.filter((function(e){return"Completed"===e.actual_value}))[0].display_value,t.$.set("Status",e),t.$.save().then((function(){Lyte.triggerEvent("relatedList",{module:Crm.isActivitySplitDone?"Tasks":"Activities"})}),(function(){renderingUtils.displayPermissionDenied()}))}))},showSortDropdown:function(e){this.sortComp=e,this.setData("sortDetails",e.data.sortDetails)},removeParticipant:function(e,t,r){this.setData("recordName",e),this.setData("event",t),this._record=r,null==store.modelFor(moduleRecordMapping.Events.id).fieldList.Participants&&store.addField(moduleRecordMapping.Events.id,"Participants","array");var i=t.Start_DateTime,a=Crm.userDetails.DATE_PATTERN.toUpperCase(),s=Crm.userDetails.TIME_FORMAT;(i.indexOf("AM")>1||i.indexOf("PM")>1)&&(s=s.replace("a","A")),a+=" "+s,new Date>$L.moment(t.Start_DateTime,a).getDObj()?(this.setData("removeParticipantTitle",I18n.getMsg("crm.label.event.remove.participant.message",[e,t.Event_Title,I18n.getMsg("crm.module.singularLabel.event")])),this.setData("removeParticipantButtonTitle",I18n.getMsg("crm.label.event.remove.participant",e)),this.setData("showDontNotifyButton",!1)):(this.setData("removeParticipantTitle",I18n.getMsg("crm.label.event.remove.alert",[e,t.Event_Title])),this.setData("removeParticipantButtonTitle",I18n.getMsg("crm.event.btn.notify.part.singular")),this.setData("showDontNotifyButton",!0)),this.$node.querySelector("#removeParticipantPopup").ltProp("show",!0)},openColumnList:function(e,t){this.columnComp=e;var r=this,i=t||!1,a=this.columnComp.data.btn_name&&["TASKSPERSONALITY","EVENTSPERSONALITY","CALLSPERSONALITY","APPOINTMENTSPERSONALITY"].contains(this.columnComp.data.relatedList.personality_name)?"openActivities_btn":this.columnComp.data.btn_name&&["TASKSHISTORYPERSONALITY","EVENTSHISTORYPERSONALITY","CALLSHISTORYPERSONALITY","APPOINTMENTSHISTORYPERSONALITY"].contains(this.columnComp.data.relatedList.personality_name)?"closedActivities_btn":null,s=$L("crm-column-list"),o="#"+this.columnComp.data.btn_name+"_ul";if(0==s.length){if(null!==a){var n=Crm.userDetails.RTL_ENABLED?"right":"left";s.push(Lyte.Component.render("crm-column-list",{module:e.getData("relatedModule"),placement:n,from:"detailView",relatedList:e.getData("relatedList")},o))}else s.push(Lyte.Component.render("crm-column-list",{module:e.getData("relatedModule"),from:"detailView",relatedList:e.getData("relatedList")},"#columnList"));i=!0}else s[0].setData({module:e.getData("relatedModule"),from:"detailView",relatedList:e.getData("relatedList")});s[0].setMethods({onSaveCustomView:function(e,t){r.columnComp.saveColumnList(e,t)},columnResize:function(e){e&&e.length?this.setData("showPopoverfooter",!0):this.setData("showPopoverfooter",!1);var t,i=$L("#columnListId"),s=null===a?$L("#customizeList"+r.columnComp.data.relatedList.id):$L("#"+a);if(window.innerHeight/2>s[0].getBoundingClientRect().bottom){t=window.innerHeight-(s[0].getBoundingClientRect().bottom+60);var o=$L("#wmstoolbar");o.outerHeight()&&(t-=o.outerHeight())}else t=s[0].getBoundingClientRect().top-103;var n=30*e.length+103;t>n&&(t=n),t=t>350?350:t,i.css({height:t})},beforePopoverShow:function(){var e=[];r.columnComp.data.relatedList.fields.forEach((function(t,r){e[r]={},e[r].api_name=t.api_name,e[r].id=t.id})),this.setData({ordered_fields1:this.data.ordered_fields,selected_fields1:e}),this.callcleasrselectedFields&&($L("crux-column-list")[0].component.clearSelectedFields(),this.callcleasrselectedFields=!1);var t=$L("crm-column-list lyte-popover")[0];if(null!==(r.columnComp.data.btn_name&&["TASKSPERSONALITY","EVENTSPERSONALITY","CALLSPERSONALITY","APPOINTMENTSPERSONALITY"].contains(r.columnComp.data.relatedList.personality_name)?"openActivities_btn":r.columnComp.data.btn_name&&["TASKSHISTORYPERSONALITY","EVENTSHISTORYPERSONALITY","CALLSHISTORYPERSONALITY","APPOINTMENTSHISTORYPERSONALITY"].contains(r.columnComp.data.relatedList.personality_name)?"closedActivities_btn":null)){var i="#"+r.columnComp.data.btn_name+"_ul",a=Crm.userDetails.RTL_ENABLED?"right":"left";t.setData("ltPropOriginElem",i),t.setData("ltPropPlacement",a)}else t.setData("ltPropOriginElem","#customizeList"+r.columnComp.data.relatedList.id);this._resize()},onColumnListResize:function(){var e=$L("#columnListId"),t=r.columnComp.data.btn_name&&["TASKSPERSONALITY","EVENTSPERSONALITY","CALLSPERSONALITY","APPOINTMENTSPERSONALITY"].contains(r.columnComp.data.relatedList.personality_name)?"openActivities_btn":r.columnComp.data.btn_name&&["TASKSHISTORYPERSONALITY","EVENTSHISTORYPERSONALITY","CALLSHISTORYPERSONALITY","APPOINTMENTSHISTORYPERSONALITY"].contains(r.columnComp.data.relatedList.personality_name)?"closedActivities_btn":null,i=null===t?$L("#customizeList"+r.columnComp.data.relatedList.id):$L("#"+t),a=$L("#columnListId lyte-menu-item:not(.lyteSearchHidden)");if(a&&a.length?this.setData("showPopoverfooter",!0):this.setData("showPopoverfooter",!1),e.length){var s;if(window.innerHeight/2>i[0].getBoundingClientRect().bottom){s=window.innerHeight-(i[0].getBoundingClientRect().bottom+60);var o=$L("#wmstoolbar");o.outerHeight()&&(s-=o.outerHeight())}else s=i[0].getBoundingClientRect().top-80;var n=30*a.length+80;s>n&&(s=n),s=s>350?350:s,t&&!$("#customize_error")[0].classList.contains("dN")?e.css({height:s-30}):e.css({height:s})}var l=$L("crm-column-list lyte-popover")[0];if(l){var c=l.component.childComp.querySelector("lyte-popover-content");$L.fastdom.measure((function(){var e=c.getBoundingClientRect().width+"px";$L.fastdom.mutate((function(){c.style.width=e}))}))}},getColumnListFields:function(e){return r.columnComp.getColumnListData(e)}}),i&&s[0].component.callForArrangement(),$L("#newPopup")[0].ltProp("show",!0)}},{mixins:["crm-stop-event"]}),Lyte.Component.register("crm-permission-error",{_template:'<template tag-name="crm-permission-error"> <template is="if" value="{{expHandlers(isEntityPresence,\'===\',0)}}"><template case="true"> <div data-zcqa="crm_error_page" data-errormessage="The action that you intend to perform is not possible" class="leadbox p30" style=" margin-top:200px;min-height:100px; height:170px;"> <div class="crm-error-page pR pL30"><span class="crm-error-page-icon p0"></span> <h2 style="color:#DD4B39;" class="mL15">{{getI18n("crm.delete.error")}}</h2> <div class="mt5 f14 mL15 lineHgt20">{{unescape(getI18n("crm.record.delete.message",crmBasePath))}}</div> </div> </div> </template><template case="false"> <div data-zcqa="crm_error_page" class="leadbox p30" data-errormessage="The record you are trying to access is not available" id="notAccessibleMsgContainer" style="margin-top:10px;min-height:100px; height:200px; "> <div class="w100p"> <div style="margin:35px auto; display:table; vertical-align:top;"> <div class="kso_CautionLeft" style="width:20%; float:left; margin-top:5px;"> <img src="{{getCrmImageUrl(\'cautionImg_76d861e_.jpg\')}}" alt="Caution Image" class="dB" style="margin:0 auto"> </div> <div class="kso_CautionRight" style="width:80%; float:left;"> <h2 style="color:#DD4B39;" class="kso_CautionTitle">{{getI18n(\'crm.record.not.accessible.message.heading\',"crm.record.not.accessible")}}</h2> <div class="mT10 f13 gray2">{{getI18n("crm.record.not.accessible.message1")}}</div> <ul class="m0 p0 pL15 cB mt5"> <li class="mT5 f12 gray2 opensansL p0 mB3" style="list-style-type:disc">{{getI18n("crm.record.not.accessible.message2","crm.record.not.accessible")}}</li> <li class="f12 gray2 opensansL p0" style="list-style-type:disc">{{getI18n("crm.record.not.accessible.message3","crm.record.not.accessible",brandName)}}</li> </ul> </div> </div> </div> </div> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,2,0]},{type:"text",position:[1,1,4,0]}]},false:{dynamicNodes:[{type:"attr",position:[1,1,1,1,1]},{type:"text",position:[1,1,1,3,1,0]},{type:"text",position:[1,1,1,3,3,0]},{type:"text",position:[1,1,1,3,5,1,0]},{type:"text",position:[1,1,1,3,5,3,0]}]}},default:{}}],_observedAttributes:["brandName","isEntityPresence","crmBasePath"],data:function(){return{brandName:Lyte.attr("string"),isEntityPresence:Lyte.attr("number"),crmBasePath:Lyte.attr("string")}},init:function(){this.setData("crmBasePath",crmBasePath)}}),Lyte.Component.register("renaming-banner-comp",{_template:'<template tag-name="renaming-banner-comp"> <lyte-modal lt-prop-height="auto" id="renamingBannerPopup" lt-prop-class="zoho_show_pop" lt-prop-bind-to-body="true" lt-prop-show="false" lt-prop="{&quot;transition&quot; : {&quot;animation&quot; : &quot;slideFromTop&quot;, &quot;duration&quot; : &quot;0.3&quot;}, &quot;offset&quot; : {&quot;top&quot;:&quot;0px&quot;,&quot;left&quot;:&quot;center&quot;} }" lt-prop-show-close-button="false"> <template is="registerYield" yield-name="modal"> <lyte-modal-content class="pT20"> <div class="topAlert red1 pT10 aligncenter f15"> <span class="svgIcons ico-warning-trianlge-red dIB vtop"></span> <span class="mL5 dIB mT4">{{getI18n(\'crm.recommendation.update.title\')}} {{getUserDisplayName()}}</span> </div> <div class="midContent w600 pT10 pb0 aligncenter lh25"> <span class="crm-font-bold f15">{{getI18n(\'crm.meeting.onboarding.info\',convertDateToUserPattern(meetingRenamingReleaseDate()))}}</span> <a href="{{getKnowMoreUrl()}}" rel="noopener noreferrer" target="_blank" class="f12">{{getI18n(\'crm.label.setup.banner.label\')}}</a> </div> </lyte-modal-content> <lyte-modal-footer class="center pT0"> <lyte-button lt-prop-appearance="primary" onclick="{{action(\'hideBanner\')}}"> <template is="registerYield" yield-name="text">{{getI18n(\'crm.meeting.onboarding.confirm.button.label\')}}</template> </lyte-button> </lyte-modal-footer> </template> </lyte-modal> </template>',_dynamicNodes:[{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,1,3,0]},{type:"text",position:[1,1,3,2]},{type:"text",position:[1,3,1,0]},{type:"attr",position:[1,3,3]},{type:"text",position:[1,3,3,0]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"registerYield",position:[3,1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[3,1]},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["features"],data:function(){return{features:Lyte.attr("array")}},actions:{showBanner:function(){document.getElementById("renamingBannerPopup").ltProp("show",!0)},hideBanner:function(){var e=new crmRequestPool,t={type:"updateNextBannerTimeForUser"};networkUtils.setCsrfParam(t),e.initiate({action:Crm.getCrmBasePath()+"/events/EventAction.do",data:t,type:"POST",success:function(){document.getElementById("renamingBannerPopup").ltProp("show",!1)}})}},methods:{showBanner:function(){$L("#renamingBannerPopup").e.ltProp("show",!0)}}}),$L.prototype.extend({cruxTextareaBindResize:function(){var e=this[0];function t(){if(e.cxResized)return!1;var t=71;e.querySelector("textarea").style.height=t+"px","vertical"==e.getData("ltPropDirection")&&e.querySelector(".lyteLabel")&&(t+=e.querySelector(".lyteLabel").offsetHeight),e.style.height=t+2+"px"}e.getData("ltPropDisabled")||e.getData("ltPropReadonly")||(e.setMethods({onResizeEnd:function(){e.cxResized=!0}}),Lyte.Component.addLyteEventListener(e,"click",(function(){t()})),Lyte.Component.addLyteEventListener(e,"keyup",(function(e){(e&&"Tab"!=e.key||!e)&&t()}))),e.getData("ltPropValue")&&t(),e.ltProp("textAreaResize",{vertical:!0,horizontal:!1})}}),Lyte.Component.register("crmutil-icon",{_template:'<template tag-name="crmutil-icon"> <svg class="zcicn_embedSvg {{iconClass}}"> <use href="{{expHandlers(\'#zcicn-\',\'+\',iconName)}}"></use> </svg> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]}],_observedAttributes:["iconName","iconClass"],data:function(){return{iconName:Lyte.attr("string",{default:""}),iconClass:Lyte.attr("string",{default:""})}}});
