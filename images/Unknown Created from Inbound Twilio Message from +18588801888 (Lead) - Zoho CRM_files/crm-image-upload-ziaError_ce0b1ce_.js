Lyte.Component.register("crm-zia-vision-error-popup",{_template:'<template tag-name="crm-zia-vision-error-popup" id="vision-error-popup"> <template is="if" value="{{expHandlers(isSaveAndNew,\'!\')}}"><template case="true"> <div id="detailPopUpModal"></div> <lyte-modal data-zcqa="visionErrorModal" id="visionModal" lt-prop-show-close-button="{{closeButton}}" lt-prop-close-on-escape="true" lt-prop-show="false" lt-prop-freeze="true" lt-prop-wrapper-class="crmBoxModal" lt-prop="{&quot;width&quot; : &quot;auto&quot; , &quot;transition&quot; : {&quot;animation&quot; : &quot;slideFromTop&quot;, &quot;duration&quot; : &quot;0.3&quot;}, &quot;offset&quot; : {&quot;top&quot;:&quot;0px&quot;,&quot;left&quot;:&quot;center&quot;} }" lt-prop-max-height="720px" lt-prop-allow-multiple="true"> <template is="registerYield" yield-name="modal"> <lyte-modal-header> <template is="if" value="{{expHandlers(action,\'===\',&quot;image_processing&quot;)}}"><template case="true"> <span class="f18 fs crm-font-semibold">{{getI18n("crm.zia.vision.under.validation")}}</span> </template><template case="false"> <span class="f18 fs crm-font-semibold">{{getI18n("crm.zia.vision.failure.message")}}</span> </template></template> </lyte-modal-header> <lyte-modal-content class="visionErrorModalContent"> <template is="if" value="{{expHandlers(action,\'!==\',&quot;image_processing&quot;)}}"><template case="true"> <div class="visionApprovalItm p20 pR mT20"> <template is="if" value="{{expHandlers(expHandlers(expHandlers(isAdmin,\'!\'),\'||\',expHandlers(action,\'!==\',&quot;do_not_create&quot;)),\'||\',expHandlers(action,\'!==\',&quot;create_without_image&quot;))}}"><template case="true"> <div class="visionApprovalImgSec dIB vam {{if(createImgSrc,\'visionApprovalImgSec_withImg pointerEventsNone\',\'\')}} "> <div class="visionApprovalImg dIB vam {{if(createImgSrc,\'\',\'visionApprovalImg_detailPage\')}} "></div> </div> </template></template> <template is="if" value="{{expHandlers(expHandlers(expHandlers(approval.image,\'&amp;&amp;\',isAdmin),\'&amp;&amp;\',expHandlers(action,\'!==\',&quot;do_not_create&quot;)),\'&amp;&amp;\',expHandlers(action,\'!==\',&quot;create_without_image&quot;))}}"><template case="true"> <div class="visionApprovalImgSec dIB vam"> <div class="visionApprovalImg dIB vam"></div> </div> </template></template> <div class="visionApprovalDetSec dIB vam mL15 col666 f13"> <div class="lH21">{{displayMessage}}</div> <template is="if" value="{{expHandlers(validation_type,\'===\',&quot;image_validation&quot;)}}"><template case="true"> <div class="mT15 cP dIB f13 zv_samplesLink" onclick="{{action(\'showSamplesPop\')}}"> <template is="if" value="{{expHandlers(image_category,\'!=\',&quot;undesired&quot;)}}"><template case="true"> <span class="dIB vam link1 ">{{getI18n(\'crm.zia.vision.allowable.images\')}}</span> </template><template case="false"> <span class="dIB vam link1 ">{{getI18n(\'crm.zia.vision.prohibited.images\')}}</span> </template></template> </div> </template></template> </div> </div> </template><template case="false"> <div class="col666 lH21 mW430 mB10">{{displayMessage}}</div> </template></template> </lyte-modal-content> <lyte-modal-footer class="right"> <template is="if" value="{{expHandlers(expHandlers(expHandlers(isAjaxEdit,\'||\',isDetailPage),\'||\',expHandlers(action,\'===\',&quot;image_processing&quot;)),\'&amp;&amp;\',expHandlers(isEdit,\'!\'))}}"><template case="true"> <lyte-button data-zcqa="visionDetailClose" onclick="{{action(\'closeInfo\')}}" lt-prop-appearance="primary"> <template is="registerYield" yield-name="text"> {{getI18n("crm.zia.vision.failure.okay")}} </template> </lyte-button> <template is="if" value="{{expHandlers(expHandlers(editAllowed,\'&amp;&amp;\',expHandlers(readOnly,\'!\')),\'&amp;&amp;\',expHandlers(action,\'===\',&quot;do_not_create&quot;))}}"><template case="true"> <lyte-button lt-prop-disabled="{{disableAllButtons}}" data-zcqa="visionDetailRemove" onclick="{{action(\'removeImage\')}}" lt-prop-appearance="failure-default" class="mL7"> <template is="registerYield" yield-name="text"> {{getI18n("crm.zia.vision.remove.failed.image")}} </template> </lyte-button> </template></template> </template></template> </lyte-modal-footer> </template> </lyte-modal> <lyte-modal id="visionSamplesModal" lt-prop-freeze="true" lt-prop-wrapper-class="crmBoxModal" lt-prop="{&quot;width&quot; : &quot;auto&quot;, &quot;transition&quot; : {&quot;animation&quot; : &quot;slideFromTop&quot;, &quot;duration&quot; : &quot;0.3&quot;}, &quot;offset&quot; : {&quot;top&quot;:&quot;0px&quot;,&quot;left&quot;:&quot;center&quot;} }" lt-prop-max-height="720px" lt-prop-allow-multiple="true"> <template is="registerYield" yield-name="modal"> <lyte-modal-header> <span class="dIB vam ">{{getI18n(\'crm.zia.vision.image.samples\')}}</span></lyte-modal-header> <lyte-modal-content> <div class="w993"> <template is="for" items="{{validationImages}}" item="key" index="index"> <div class="visionApprovalSampleImg fL" style="background-image: url({{key.image_url}});"></div> </template> <div class="cB"></div> </div> </lyte-modal-content> <lyte-modal-footer class="right"> <lyte-button lt-prop-appearance="primary" data-zcqa="visionImageSampleOkay" onclick="{{action(\'closeSamplePopUp\')}}"> <template is="registerYield" yield-name="text"> {{getI18n("crm.zia.vision.failure.okay")}} </template> </lyte-button> </lyte-modal-footer> </template> </lyte-modal> </template><template case="false"> <lyte-messagebox data-zcqa="visionApproval_messageBox" lt-prop-duration="8000" id="visionApproval_messageBox" lt-prop-type="info" lt-prop-message="{{displayMessage}}"> </lyte-messagebox> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"if",position:[3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]}]}},default:{}},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[]}},default:{}},{type:"text",position:[1,5,1,0]},{type:"attr",position:[1,5,3]},{type:"if",position:[1,5,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]}},default:{}}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"componentDynamic",position:[3]},{type:"attr",position:[5,1]},{type:"if",position:[5,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[3]},{type:"registerYield",position:[5,1],dynamicNodes:[{type:"text",position:[1,1,0]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1,1]},{type:"for",position:[3,1,1],dynamicNodes:[{type:"attr",position:[1],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'background-image: url('","key.image_url","');'"]}}}}]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5,1]},{type:"registerYield",position:[5,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[5,1]},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[5]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}],_observedAttributes:["action","moduleName","entityId","createImgSrc","attachmentId","isDetailPage","isOnClick","fieldName","visionId","isSaveAndNew","image_category","approvalId","records","nonAdminClass","recImageSysRefName","displayMessage","isAjaxEdit","adminClass","readOnly","closeButton","showActions","editAllowed","isEdit","isAdmin","disableAllButtons","approval","validation_type"],data:function(){return{action:Lyte.attr("string"),moduleName:Lyte.attr("string"),entityId:Lyte.attr("string"),createImgSrc:Lyte.attr("string",{default:""}),attachmentId:Lyte.attr("string",{default:""}),isDetailPage:Lyte.attr("boolean",{default:!1}),isOnClick:Lyte.attr("boolean",{default:!1}),fieldName:Lyte.attr("string"),visionId:Lyte.attr("string"),isSaveAndNew:Lyte.attr("boolean",{default:!1}),image_category:Lyte.attr("string",{default:"desired"}),approvalId:Lyte.attr("string"),records:Lyte.attr("array"),nonAdminClass:Lyte.attr("string",{default:""}),recImageSysRefName:Lyte.attr("string",{default:"Record_Image"}),displayMessage:Lyte.attr("string"),isAjaxEdit:Lyte.attr("boolean",{default:!1}),adminClass:Lyte.attr("string",{default:""}),readOnly:Lyte.attr("boolean",{default:!1}),closeButton:Lyte.attr("boolean",{default:!0}),showActions:Lyte.attr("boolean",{default:!0}),editAllowed:Lyte.attr("boolean",{default:!0}),isEdit:Lyte.attr("boolean",{default:!1}),isAdmin:Lyte.attr("boolean",{default:!1}),disableAllButtons:Lyte.attr("boolean",{default:!1}),approval:Lyte.attr("object"),validation_type:Lyte.attr("string")}},init:function(){Crm.userDetails.permissions.Crm_Implied_Approve_Actions?this.setData("showActions",Crm.userDetails.permissions.Crm_Implied_Approve_Actions):this.setData("showActions",!1),this.getData("attachmentId")&&this.getData("fieldName")&&(this.getData("isDetailPage")&&("crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route?this.setData("visionApprovals",Lyte.Router.getRouteInstance().currentModel.entityDetails.image_vision_approvals):this.setData("visionApprovals",detailView.changedBCJson.hidden.vision_approvals)),this.getData("isEdit")&&this.setData("visionApprovals",Lyte.Router.getRouteInstance().currentModel.vision_approvals));var t=this;"image_processing"===t.getData("action")&&t.getData("isSaveAndNew")?t.setData("displayMessage",I18n.getMsg("crm.zia.vision.message.processing",this.getData("moduleName"))):t.getDisplayMessage(t),this.getVision(t.getData("visionId"));var e=store.peekRecord("visions",t.getData("visionId"));e&&(t.setData("image_category",null!==e.desired_set&&e.desired_set&&e.desired_set.labels.length>0?"desired":"undesired"),t.setData("validation_type",e.validation_type)),"image_processing"!==t.getData("action")&&store.findAll("visions",{module:this.getData("moduleName")}).then((function(){!function(){if(t.getData("attachmentId")&&t.getData("fieldName")){for(var e=t.getData("visionApprovals")[t.getData("fieldName")],a=e.length,i=0;i<a;i++)e[i].attachment_id===t.getData("attachmentId")&&(t.setData("visionId",e[i].vision_id),t.setData("approvalId",e[i].visionApproval_id),t.setData("action",e[i].failure_action));var o=store.peekRecord("visions",t.getData("visionId"));t.setData("image_category",null!==o.desired_set&&o.desired_set&&o.desired_set.labels.length>0?"desired":"undesired"),t.setData("validation_type",o.validation_type)}if(!t.getData("isSaveAndNew")&&"do_not_create"!==t.getData("action")&&(Crm.userDetails.permissions.Crm_Implied_Approve_Actions?(t.setData("isAdmin",!0),t.setData("closeButton",!0),t.setData("adminClass","fL")):t.setData("nonAdminClass","ziaVisionWarningImgSec_nonAdmin"),returnJson.entityMapJson&&returnJson.entityMapJson.PHOTO_FILEID&&t.setData("readOnly",returnJson.entityMapJson.PHOTO_FILEID.readonly),detailView.changedBCJson&&detailView.changedBCJson.hidden&&t.setData("editAllowed",detailView.changedBCJson.hidden.RECORD_FIELDS_EDIT_ALLOWED),t.getData("isAdmin")&&!t.getData("approval")&&"do_not_create"!==t.getData("action")&&"create_without_image"!==t.getData("action")&&t.getData("isOnClick"))){var s={};s.record_id=t.getData("entityId"),s.page="1",s.per_page="10",s.fields="object_details",store.triggerAction("visions","record_approvals",{},s).then((function(e){commonUtils.showHideLoadingDiv(!1),e.vision_approvals&&e.vision_approvals[0]?t.approvalsCallbackAndImageFetch(s,e,!1):renderingUtils.showCustomAlert(I18n.getMsg("crm.zia.vision.message.fail.validated"),I18n.getMsg("crm.zia.vision.action.performed"),!0)}),(function(e){t.approvalsErrorHandler(e)}))}}()}))},actions:{closeSamplePopUp:function(){$L("#visionSamplesModal")[0].ltProp("show",!1)},showSamplesPop:function(){this.showSampleImages(this)},changeImage:function(){$L("#visionModal")[0].ltProp("show",!1),"do_not_create"===this.getData("action")?this.getData("isEdit")?showUploadPhoto(this.getData("moduleName"),this.getData("entityId"),"edit"):showUploadPhoto(this.getData("moduleName"),"","create"):this.getData("isEdit")?showUploadPhoto(this.getData("moduleName"),this.getData("entityId"),"edit"):showUploadPhoto(this.getData("moduleName"),this.getData("entityId"))},removeImage:function(){this.getMethods("onDelete")&&(this.executeMethod("onDelete",this.getData("attachmentId")),$("#visionModal")[0].ltProp("show",!1));var t=[],e={image_status:"reject"};e.id=this.getData("approvalId"),t.push(e),this.setData("selectedAppObj",t),commonUtils.showHideLoadingDiv(!0);var a={};a.id=this.getData("entityId"),a.module=moduleRecordMapping[this.getData("moduleName")],this.setData("selectedRecord",a),this.triggerBulkReviews(this,(function(t){t.vision_image_approvals&&"success"===t.vision_image_approvals[0].status&&Lyte.Router.getRouteInstance().refresh(),commonUtils.showHideLoadingDiv(!1),scopeThis.setData("disaleAllButns",!1)}))},allowImages:function(){this.allowImagesMixin(this,"errorPopup")},ignoreImages:function(){this.ignoreImagesMixin(this,"errorPopup")},closeInfo:function(){$("#visionModal")[0].ltProp("show",!1)}}},{mixins:["crm-vision-create","crm-vision-validation","crm-vision-match-utils"]});
