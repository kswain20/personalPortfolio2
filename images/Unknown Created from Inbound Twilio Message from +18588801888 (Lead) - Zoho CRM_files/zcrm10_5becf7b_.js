var searchStats={searchText:"",scrollEnd:!1,fetchedAll:!1,scrollPageIndex:1,lineInFocus:"",textBoxId:"",previousSearchResults:[],previousSearchTerm:"",previousVendorStatus:!1},productDetails={debugVar:"",linesInPop:0,linesInPopInBp:{},prdIdVsDetailsMap:"",currencySymbol:"",roundOff:2,roundOffPrecision:Math.pow(10,2),module:"",discStatus:"percent",allTaxes:"",newAllTaxes:"",sortedOrgTax:[],taxIdVsName:{},autoPopulateTax:!0,canEditTaxValue:!0,grandTaxChanged:!1,bcCols:"",layoutVsBCfieldDetails:"",layoutIdVsLayoutName:"",fieldsInBC:"",bcUiTypes:"",taxNameVsId:{},isInited:!1,hideListPrice:!0,invModuleVsLineItemSfTabId:[],sfFldIdSuffix:"",init:function(e,t,i,a,s){var r=!1;if("blueprint"===i)$("#multipleFieldsEditPop #"+a.relListId+"_rlContainer");var o=$("#searchCreateDiv");productDetails.module=t,Crm.userDetails.hideProductLineItemsSummary&&$("#summary").remove(),Crm.userDetails.TAX_MIGRATION_COMPLETED||1!=e.TAX_MIGRATION_COMPLETED||(Crm.userDetails.TAX_MIGRATION_COMPLETED=!0),$("#popup1").append(o);var n=$("#popup1"),l=document.getElementsByName("createEntityNewForm");if($(l).parent().append(n),productDetails.fillTaxDetails(e),productDetails.autoPopulateTax=e.autoPopulateTax,productDetails.canEditTaxValue=e.canEditTaxValue,e.fieldsInBC&&(productDetails.fieldsInBC=e.fieldsInBC,productDetails.fieldsInBC=productDetails.fieldsInBC.replace("[",""),productDetails.fieldsInBC=productDetails.fieldsInBC.replace("]",""),productDetails.fieldsInBC=productDetails.fieldsInBC.split(", ")),e.colNamesInBC&&(productDetails.bcCols=e.colNamesInBC,productDetails.bcCols=productDetails.bcCols.replace("[",""),productDetails.bcCols=productDetails.bcCols.replace("]",""),productDetails.bcCols=productDetails.bcCols.split(", ")),e.uiTypesInBC&&(productDetails.bcUiTypes=e.uiTypesInBC,productDetails.bcUiTypes=productDetails.bcUiTypes.replace("[",""),productDetails.bcUiTypes=productDetails.bcUiTypes.replace("]",""),productDetails.bcUiTypes=productDetails.bcUiTypes.split(", ")),e.layoutVsBCfieldDetails&&(productDetails.layoutVsBCfieldDetails=e.layoutVsBCfieldDetails),productDetails.fillCurrencyAndRoundOffDetail(r,a),"edit"==window[t].currentStatus||"clone"==window[t].currentStatus){var d=$("#productList");if($(".lnk_inv_whatsnew").parent().show(),Crm.userDetails.isLookupAdvancedSearchEnabledInLineItem){var c=e.productLineItems;c.fieldMeta=e.entityMapJson.PRODUCTDETAILS,productDetails.setValuesForAddedRowForEdit(c,void 0,void 0,void 0,s)}else productDetails.setValuesForAddedRowForEdit(e.productLineItems,void 0,void 0,void 0,s);productDetails.grandTaxChanged=!0,d.find(".pB20").show(),d.find(".pB20").find(".wrap").show(),$("#addLinesBtnLwr").hide(),loadClassFns1(),loadClassFns2(),loadClassFns3()}else{productDetails.grandTaxChanged=!1;var u=JSON.parse(e.newAllTaxes),m="",p="<div>";if(null!=u)for(var f=objectUtils.getKeys(u),v=f.length-1,g=0;g<=v;g++){var h=u[f[g]];productDetails.canEditTaxValue?p+='<div class="taxRow"> <p class="f12 bold color1 taxName"> '+h[0]+' </p> <div class="pT10 pB10 bdrBot mB10"><input type="text" size="5" class="newinputText1 decimalFld editTax alignright" value="'+h[1]+'"> <b class="pL5">%</b> <input type="text" class="newinputText1 mL10 taxVal alignright decimalFld" readonly="true" size="5" value="0"> <label class="pL5"> </label></div> </div>':p+='<div class="taxRow"> <p class="f12 bold color1 taxName"> '+h[0]+' </p> <div class="pT10 pB10 bdrBot mB10"><input type="text" size="5" class="newinputText1 decimalFld editTax alignright" style="cursor: not-allowed;" readonly="true" value="'+h[1]+'"> <b class="pL5">%</b> <input type="text" class="newinputText1 mL10 taxVal alignright decimalFld" readonly="true" size="5" value="0"> <label class="pL5"> </label></div> </div>',Crm.userDetails.TAX_MIGRATION_COMPLETED||(m+=h[0]+"===0:::0;;;")}p+="</div>",$("#grandTaxPop").append(p),$("#recordTaxDet").val(m)}(productDetails.fillCurrencySymbolsInLineHeaders(),productDetails.fillCurrSymForGrandVals(),"PurchaseOrders"!=t?$("#vendPrdsSpan").remove():($("#vendPrds").prop("checked",!1),"create"==window[t].currentStatus&&productDetails.fillBillingAddressForPO()),Crm.userDetails.isLookupAdvancedSearchEnabledInLineItem)&&(loadClassFns1(r,null!=a?a.relListId:void 0),loadClassFns2(r),loadClassFns3(void 0,r));moduleRecordMapping.PriceBooks&&moduleRecordMapping.PriceBooks.visible&&moduleRecordMapping.PriceBooks.viewable&&store.findRecord("module",moduleRecordMapping.Products.id,void 0,void 0,void 0,{getMeta:!0}).then((function(e){for(var t=e[0].related_lists,i=t.length,a=0;a<i;a++)if("Price_Books"===t[a].api_name&&!0===t[a].visible&&"default"===t[a].type){productDetails.hideListPrice=!1;break}}))},fillTaxDetails:function(e){e.allTaxes?productDetails.allTaxes=e.allTaxes:(productDetails.allTaxes=null,e.allTaxes=null),e.newAllTaxes?productDetails.newAllTaxes=e.newAllTaxes:(productDetails.newAllTaxes=null,e.newAllTaxes=null),e.sortedOrgTax&&(productDetails.sortedOrgTax=e.sortedOrgTax),e.taxIdVsName?productDetails.taxIdVsName=JSON.parse(e.taxIdVsName):productDetails.taxIdVsName={}},fillCurrencyAndRoundOffDetail:function(e,t){if(objectUtils.getKeys(Crm.userDetails.CURRENCY_DETAILS).length>0){var i=e?$("#Crm_"+productDetails.module+"_"+t.relListId+"_CURRENCYISOCODE").val():$("#Crm_"+productDetails.module+"_CURRENCYISOCODE").val();i||(i=Crm.userDetails.BASE_CURRENCY);var a=Crm.userDetails.CURRENCY_DETAILS[i];a&&(productDetails.currencySymbol=a.symbol,productDetails.roundOff=a.decimals)}else productDetails.currencySymbol=Crm.userDetails.defaultOrgCurrency,isNaN(Crm.userDetails.productRoundOff)||(productDetails.roundOff=Crm.userDetails.productRoundOff,productDetails.roundOff>5&&(productDetails.roundOff=5));productDetails.roundOffPrecision=Math.pow(10,productDetails.roundOff)},initSFLineItem:function(e,t,i,a){productDetails.isInited=!0,productDetails.module=t,productDetails.autoPopulateTax=e.autoPopulateTax,productDetails.canEditTaxValue=e.canEditTaxValue,productDetails.sestatus=e.sestatus;var s=productDetails.invModuleVsLineItemSfTabId[t],r=$("#totalProductCount"),o=$("#subform_"+s),n=o.closest(".secContent").get(0);for(key in o.length>0&&Crm.userDetails.TAX_MIGRATION_COMPLETED?productDetails.createDiscPopupSFLineItem(n):productDetails.createDiscountPop(n),productDetails.createTaxPopsSFLineItem(n),$(window).off("click").on("click",(function(){$("#discountPop").css({display:"none"}),$("#grandTaxPop").css({display:"none"}),$("#taxPop").css({display:"none"})})),productDetails.fillTaxDetails(e),productDetails.taxIdVsName){var l=productDetails.taxIdVsName[key];productDetails.taxNameVsId[l[1]]=key}productDetails.fillCurrencyAndRoundOffDetail(i,a);var d=e.RECORDTAXDET;if(d||"edit"===window[t].currentStatus||"clone"===window[t].currentStatus){if(productDetails.grandTaxChanged=!0,d=e.RECORDTAXDET,Crm.requestParam["property(recordTaxDet)"]=d,void 0!==d&&d.length>0){var c={},u=d.split(";;;");d="";for(var m=u.length-1,p=0;p<m;p++){var f=u[p],v=f.split("===")[0],g=productDetails.taxIdVsName[v];void 0!==g&&g.length>0&&(v=g[1]),v=v.trim();var h=f.split("===")[1],C=parseFloat(void 0===h?0:h.split(":::")[0]),w=parseFloat(void 0===h?0:h.split(":::")[1]);c[v]=v+"==="+C+":::"+w+";;;",d+=c[v]}$("#grandTaxValueMap").val(JSON.stringify(c))}}else{productDetails.grandTaxChanged=!1;c={},h=JSON.parse(productDetails.newAllTaxes);var b=productDetails.sortedOrgTax?productDetails.sortedOrgTax.length:0,T='<div class="selectTaxdiv mB2"><div class="f12 proximas mB10">'+I18n.getMsg("crm.tax.select")+"</div>";for(p=0;p<b;p++){var I=h[v=productDetails.sortedOrgTax[p]];T+=productDetails.constructTaxPopSFLineItem(I[1],v,0,!0,!1,p+1)}$("#grandTaxValueMap").val(JSON.stringify(c)),T+="</div>",$("#grandTaxPop").append(T)}$("#recordTaxDet").val(d);var y="#Crm_"+t+"_"+(s=o.data("data-subformid"))+"_";productDetails.sfFldIdSuffix=y;for(var P=r.val(),_=1;_<=P;_++){var D=$(y+"PRODUCTID_"+_),O=D.length,S=D.closest("tr");productDetails.bindPBIconShowOrHideSFLineItem(S);var L=$(y+"BOOKID_"+_),E=L.closest("td"),x=E.find(".PriceBooks-small"),F=E.find(".clear_lookupfield");null!==O?x.css({display:"block"}):x.css({display:"none"}),F.css({display:"none"});var V=$(y+"LINETAX_"+_),A=$(y+"TOTAL_"+_),k=$(y+"TOTALAFTERDISCOUNT_"+_),N=$(y+"DISCOUNT_"+_);L.length>0&&L.val().length>0?N.attr("discType","fromPb"):N.attr("discType","percent"),A.attr("temp-value",""===A.val()?0:A.val()),k.attr("temp-value",""===k.val()?0:k.val());var M=A.val();M=parseFloat(M&&M.length>0?M:0),M=isNaN(M)?0:M;var R=N.val();R=R&&R.length>0?R:0,R=isNaN(R)?0:R;var B=M/100;N.attr("percentage",0===B?0:R/B);var U=V.val();V.attr("old",void 0!==U&&U.length>0),V.val(productDetails.convertTaxIdToTaxDispName(U,_))}var j=i?$("#Crm_"+productDetails.module+"_"+a.relListId+"_DISCOUNT"):$("#Crm_"+productDetails.module+"_DISCOUNT"),H=i?$("#Crm_"+productDetails.module+"_"+a.relListId+"_TAX"):$("#Crm_"+productDetails.module+"_TAX"),z=i?$("#Crm_"+productDetails.module+"_"+a.relListId+"_SUBTOTAL"):$("#Crm_"+productDetails.module+"_SUBTOTAL"),q=z.val()-(j.length>0?j.val():0);q=parseFloat(""===q?0:q);var Y=""===H.val()?0:H.val();H.attr("percentage",productDetails.getRoundOffValue(Y/(q/100),!0));var J=z.val();J=parseFloat(""===J?0:J);var W=""===j.val()?0:j.val();B=J/100;j.attr("percentage",productDetails.getRoundOffValue(0===B?0:W/B,!0)),"PurchaseOrders"===t&&"create"===window[t].currentStatus&&productDetails.fillBillingAddressForPO(),z.off("change").on("change",(function(){var e=$("#multipleFieldsEditPop").is(":visible");if(e)var t=$("#duringTabs").find(".sel").attr("data-tab").split("_")[0];var i=e?$("#Crm_"+productDetails.module+"_"+t+"_DISCOUNT"):$("#Crm_"+productDetails.module+"_DISCOUNT"),a=e?$("#Crm_"+productDetails.module+"_"+t+"_TAX"):$("#Crm_"+productDetails.module+"_TAX"),s=$(this),r=parseFloat(""===a.val()?0:a.val()),o=parseFloat(""===s.val()?0:s.val()),n=parseFloat(i.length<1||""===i.val()?0:i.val()),l=i.attr("percentage");l=parseFloat(void 0===l||0===l.length||isNaN(l)?0:l),l=productDetails.getRoundOffValue(l,!0);var d=a.attr("percentage");d=parseFloat(void 0===d||0===d.length||isNaN(d)?0:d),d=productDetails.getRoundOffValue(d,!0);var c=s.attr("temp-value");parseFloat(void 0===c||0===c.length||isNaN(c)?0:c)!==o&&(n="dirPrice"!==i.attr("discType")?l*o/100:n,0!==r&&(r=d*(o-n)/100)),i.val(parseFloat(productDetails.getRoundOff(i,n)).toString()).trigger("change"),s.attr("temp-value",o),a.val(parseFloat(productDetails.getRoundOff(a,r)).toString()).trigger("change")}))},getRoundOff:function(e,t){var i=e.data("colname"),a=e.data("subformdisplaylabel");if(Crm.userDetails.lineItemFormulaCalcFlow&&objectUtils.getKeys(Crm.userDetails.lineItemFormulaCalcFlow).length>0&&(!a&&Crm.userDetails.lineItemFormulaCalcFlow[productDetails.module].aggrFields[i]||a&&Crm.userDetails.lineItemFormulaCalcFlow[productDetails.module][i]))return productDetails.getRoundOffValue(t,!0);var s=e.data("uitype"),r=e.data("decimalLength");r=void 0===r?0:r;var o=Math.pow(10,r);if(t&&t.toString().indexOf("e")>-1||t.toString().indexOf("E")>-1)t=Number(Math.round(t,o));else switch(s){case 36:case 143:case 144:case 145:t=Number(productDetails.getRoundOffValue(t,!0,r))}return void 0===t?0:parseFloat(currencyUtils.getWholeOrDecimalValue(t,r))},bindPBIconShowOrHideSFLineItem:function(e){e.off("mouseover").on("mouseover",(function(){productDetails.priceBookIconHideOrShowSFLineItem($(this),!1)})),e.off("mouseout").on("mouseout",(function(){productDetails.priceBookIconHideOrShowSFLineItem($(this),!0)}))},priceBookIconHideOrShowSFLineItem:function(e,t){var i=e.data("data-rowid"),a=$(productDetails.sfFldIdSuffix+"PRODUCTID_"+i),s=a.length>0?a.val().length:0,r=$(productDetails.sfFldIdSuffix+"LISTPRICE_"+i);if(!r.attr("readonly")){var o=r.closest("td"),n=o.find(".PriceBooks-small.lookup_hIconO");s>0&&!t?n.removeClass("hide"):n.addClass("hide"),o.find(".clear_lookupfield.lookup_hIconO").css({display:"none"})}},convertTaxIdToTaxDispName:function(e,t){var i=$(productDetails.sfFldIdSuffix+"TAX_"+t),a=$(productDetails.sfFldIdSuffix+"TOTAL_"+t),s=$(productDetails.sfFldIdSuffix+"TOTALAFTERDISCOUNT_"+t),r=s.val();r=isNaN(r)||0==r.length?0:parseFloat(r);var o=i.val();if(o=isNaN(o)?0:parseFloat(o),"clone"===window[productDetails.module].currentStatus){o=0;var n=$(productDetails.sfFldIdSuffix+"PRODUCTID_"+t),l=n.length>0?n.attr("prdDetails"):"";l=void 0!==l&&l.length>0?JSON.parse(l):"";var d=productDetails.getTaxVsIdSFLineItem(l.Tax),c=d.length,u=(e=e||"").split(";;;");e="";for(var m=u.length,p=0;p<m;p++){var f=u[p];if(""!==f){var v=f.split("===")[0].trim(),g=productDetails.taxIdVsName[v];if(void 0!==g&&g.length>0&&(v=g[1]),0==c||c>0&&d.indexOf(v)<0)continue;var h=f.split("===")[1],C=parseFloat(void 0===h?0:h.split(":::")[0]),w=r*C/100;o+=w,e=e+v+"==="+C+":::"+w+";;;"}}}var b=s.length>0?s.val():a.val();return b=parseFloat(""===b?0:b),i.val(parseFloat(productDetails.getRoundOff(i,o).toString())),i.attr("percentage",o/(b/100)),e},getTaxVsIdSFLineItem:function(e){if(void 0!==e&&e.length>0)for(var t=(e=e.split(";")).length,i=0;i<t;i++){var a=productDetails.taxIdVsName[e[i]];void 0!==a&&a.length>0&&(e[i]=a[1])}else e="";return e},showGrandTaxNewSFLineItemPop:function(e){var t=$("#grandTaxPop"),i=$("#taxPop"),a=$("#multipleFieldsEditPop"),s=a.is(":visible");if(s)var r=$("#duringTabs").find(".sel").attr("data-tab").split("_")[0];if(t.hide(),i.hide(),productDetails.isInited){var o,n,l,d=$(e),c=d.closest("tr"),u=c.data("data-rowid"),m=d.closest("table").hasClass("aggFldTabl"),p=m?t:i;m?(o=s?$("#Crm_"+productDetails.module+"_"+r+"_SUBTOTAL"):$("#Crm_"+productDetails.module+"_SUBTOTAL"),l=s?$("#Crm_"+productDetails.module+"_"+r+"_DISCOUNT"):$("#Crm_"+productDetails.module+"_DISCOUNT"),n=s?$("#Crm_"+productDetails.module+"_"+r+"_TAX"):$("#Crm_"+productDetails.module+"_TAX")):(o=$(productDetails.sfFldIdSuffix+"TOTALAFTERDISCOUNT_"+u),l=$(productDetails.sfFldIdSuffix+"DISCOUNT_"+u),n=$(productDetails.sfFldIdSuffix+"TAX_"+u));var f,v,g=d.position(),h=d.offset(),C=d.innerHeight(),w=p.innerWidth(),b=s?g.left:h.left,T=s?g.top:h.top,I=parseFloat(o.val());if(I=isNaN(I)?0:I,s){var y=$(".subFrmTablWrapper"),P=y.scrollLeft(),_=$("#multipleFieldsEditPop .pp-content").scrollTop(),D=a.offset().left,O=d.closest(".labelValCreate");if(m)f=O.offset().left,v=O.offset().top+_;else{f=O.offset().left-P;var S=p[0].id;"taxPop"===S?(f=O.position().left+y.position().left,v=O.position().top+y.position().top+_):v=O.position().top}var L,E,x=O.closest(".labelValCreate"),F=x.outerHeight(),V=x.outerWidth(),A=a.offset().left,k=a.outerWidth()}if(""===l.val()&&l.val(0),m){var N=n.val();productDetails.grandTaxChanged=""!==N&&null!==N}var M=l.length>0?l.val():0;M=isNaN(M)||0===M.length?0:parseFloat(M);var R=m?I-M:I,B=Crm.userDetails.TAX_MIGRATION_COMPLETED?'<div class="selectTaxdiv mB2"><div class="f12 proximas mB10">'+I18n.getMsg("crm.tax.select")+"</div>":"<div>",U=$(productDetails.sfFldIdSuffix+"LINETAX_"+u),j=$(productDetails.sfFldIdSuffix+"PRODUCTID_"+u),H=j.length>0?j.attr("prdDetails"):"";H=void 0!==H&&H.length>0?JSON.parse(H):"";var z=m?[]:productDetails.getTaxVsIdSFLineItem(H.Tax),q=!0,Y=m?$("#recordTaxDet").val():U.val();if(productDetails.addLoggerForTaxIssue(Y.toString(),"Action triggered when tax icon is clicked"),(0===parseInt(Y)||""===Y||"create"===window[productDetails.module].currentStatus&&!productDetails.grandTaxChanged)&&m){var J=productDetails.sortedOrgTax?productDetails.sortedOrgTax.length:0;Y=JSON.parse(productDetails.newAllTaxes);for(var W=0;W<J;W++){var G=productDetails.sortedOrgTax[W];void 0!==(le=productDetails.taxIdVsName[G])&&le.length>0&&(G=le[1]);var Q=R*(de=Y[G])[1]/100;B+=productDetails.constructTaxPopSFLineItem(de[1],G,Q,m,!1,W+1)}}else{var K=0,X=n,Z=(q=!!m||0!==j.val().length&&H.Taxable,Y.split(";;;")),ee=Z.length-1,te=[];for(W=0;W<ee;W++){var ie=Z[W];G=ie.split("===")[0].trim();void 0!==(le=productDetails.taxIdVsName[G])&&le.length>0&&(G=le[1]),te[W]=G;Y=ie.split("===")[1];var ae=R*(de=parseFloat(void 0===Y?0:Y.split(":::")[0]))/100;ae=productDetails.getRoundOff(X,ae),B+=productDetails.constructTaxPopSFLineItem(de,G,ae,m,!0,++K),z.indexOf(G)>-1&&z.splice(z.indexOf(G),1)}if(q){var se=1===z.length&&""===z[0]?0:q?z.length:0,re=JSON.parse(productDetails.newAllTaxes);if(Crm.userDetails.TAX_MIGRATION_COMPLETED)if(m){var oe=objectUtils.getKeys(re),ne=oe.length-1;for(W=0;W<=ne;W++){G=oe[W].trim();void 0!==(le=productDetails.taxIdVsName[G])&&le.length>0&&(G=le[1]);Q=R*(de=void 0!==re[G]?re[G]:[G,JSON.parse(productDetails.allTaxes)[G]])[1]/100;m&&te.toString().indexOf(G)<=-1&&(B+=productDetails.constructTaxPopSFLineItem(de[1],G,productDetails.getRoundOff(X,Q),m,!1,++K))}}else{for(W=0;W<se;W++){G=z[W].trim();void 0!==(le=productDetails.taxIdVsName[G])&&le.length>0&&(G=le[1]);Q=R*(de=void 0!==re[G]?re[G]:[G,JSON.parse(productDetails.allTaxes)[G]])[1]/100;z.indexOf(G)>-1&&te.toString().indexOf(G)<=-1&&(B+=productDetails.constructTaxPopSFLineItem(de[1],G,productDetails.getRoundOff(X,Q),m,!1,++K))}0===se&&ee<=0&&(q=!1,B=Crm.userDetails.TAX_MIGRATION_COMPLETED?"<div><span>"+I18n.getMsg("crm.tax.association.check")+"</span>":"<span>"+I18n.getMsg("crm.tax.association.check")+"</span>")}else{for(W=0;W<se;W++){var le;G=z[W].trim();void 0!==(le=productDetails.taxIdVsName[G])&&le.length>0&&(G=le[1]);var de;Q=R*(de=re[G])[1]/100;B+=productDetails.constructTaxPopSFLineItem(de[1],G,productDetails.getRoundOff(X,Q),m,!1,W+1)}0===se&&ee<=0&&(q=!1,B=Crm.userDetails.TAX_MIGRATION_COMPLETED?"<div><span>"+I18n.getMsg("crm.tax.association.check")+"</span>":"<span>"+I18n.getMsg("crm.tax.association.check")+"</span>")}}else ee<1?(q=!1,B=Crm.userDetails.TAX_MIGRATION_COMPLETED?"<div><span>"+I18n.getMsg("crm.tax.association.check")+"</span>":"<span>"+I18n.getMsg("crm.tax.association.check")+"</span>"):q=!0}var ce=m?"saveGrandTaxBtn":"saveRowTaxBtn";Crm.userDetails.TAX_MIGRATION_COMPLETED?B+=q?'<div class="grandTaxButtons"><input type="button" data-zcqa="tax_save" id="'+ce+'" class="primarybtn btn_sml" value="'+I18n.getMsg("crm.button.done")+'"><input data-zcqa="tax_cancel" class="newgraybtn btn_sml" type="button" onclick="productDetails.cancelGrandTaxSFLineItem('+m+')" value="'+I18n.getMsg("crm.button.cancel")+'"/></div></div>':"</div>":B+=m?'<input type="button"  id="'+ce+'" class="primarybtn btn_sml" value="'+I18n.getMsg("crm.button.done")+'"></div>':"</div>",p.children().remove(),p.append(B),$(m?"#grandTaxRnd.grandTaxRnd":"#lineTaxRnd.lineTaxRnd").off("click").on("click",(function(){var e=c;productDetails.addOrRemoveTaxSFLineItem($(this),m?"grand":"inline",e)}));var ue=Crm.userDetails.TAX_MIGRATION_COMPLETED?p.find(".grandTaxButtons"):p.find(".primarybtn");if(m||Crm.userDetails.TAX_MIGRATION_COMPLETED?(ue.css({display:"block"}),$("#"+ce).off("click").on("click",(function(){for(var e=c,t=m?$("#grandTaxPop .editTax"):$("#taxPop .editTax"),i=m?".grandTaxRnd":".lineTaxRnd",a=t.length,s=!1,r=0;r<a;r++){var o=t.eq(r),n=o.closest(".taxRow").find(i).get(0),l=o.val(),d=m?$("#grandTaxValError"+(r+1)):$("#inlineTaxValError"+(r+1));d.addClass("dN"),n.checked&&(isNaN(l)||!l||l>100)&&(d.removeClass("dN"),s=!0)}if(s)return!1;if(m){productDetails.grandTaxChanged=!0;var u=$("#grandTaxValueMap").val(),p=JSON.parse(u.length>0?u:"{}"),f="";for(var r in p)f+=p[r];$("#recordTaxDet").val(f),Crm.requestParam["property(recordTaxDet)"]=f,productDetails.calculateGrandTotalSFLineItem(this,e),$("#grandTaxPop").css({display:"none"}),productDetails.addLoggerForTaxIssue(f,"Action triggered when save button is clicked")}else{var v=e.data("data-rowid"),g=$(productDetails.sfFldIdSuffix+"LINETAX_"+v),h=$(productDetails.sfFldIdSuffix+"TAX_"+v),C=$(this).closest(".grandTaxButtons").attr("tax-expr");void 0!==C&&g.val(0===C.length?"":C),g.attr("old",!1),void 0!==C&&0===C.length&&h.val("0").trigger("change");var w=$("#taxPop");w.find(".editTax").each((function(t,i){var a=e;Crm.userDetails.TAX_MIGRATION_COMPLETED&&$(i).closest(".taxRow").find(".lineTaxRnd")[0].checked?ve($(i),a):Crm.userDetails.TAX_MIGRATION_COMPLETED||ve($(i),a)})),w.css({display:"none"})}}))):Crm.userDetails.TAX_MIGRATION_COMPLETED||ue.css({display:"none"}),$("#discountPop").hide(),p.removeClass("hide"),productDetails.canEditTaxValue||(p.find(".newinputText1.editTax").each((function(e,t){$(t).css({cursor:"not-allowed"}).attr("readonly","true")})),productDetails.bindMouseOverActionForRestrictTaxEdit()),s)L=p.outerWidth(),E=p.height(),k-(O.offset().left-A)>L+20?p.css({left:f,top:v+E+F-15}).show():p.css({left:f+V/2-L,top:v+E+F-15}).show(),m?Crm.userDetails.RTL_ENABLED?p.css({left:f-D,top:v-(F+30)}).show():p.css({left:f-(D+L/2),top:v-(F+25)}).show():"taxPop"===S&&(Crm.userDetails.RTL_ENABLED?p.css({left:f,top:v+E+F-15}).show():p.css({left:f-(L/2+V/2),top:v+E+F-15}).show());else{var me,pe=b+w/2;me=renderingUtils.windowWidth<pe?b-w:b-w/2,p.css({left:me,top:T+C+10}).show();var fe=document.querySelector("html, body");crmui.animateScrollTop(fe,T-115,200)}function ve(e,t){var i=e.val(),a=t.data("data-rowid"),s=$(productDetails.sfFldIdSuffix+"TAX_"+a);s.attr("percentage",i),(isNaN(i)||""===i)&&(i=0);var r=o.val();r=isNaN(r)?0:r;var n=M;n=isNaN(n)?0:n;var l=parseFloat(r)-parseFloat(n),d=l*i/100,c=e.closest(".taxRow").find(".taxName").text().trim();if(c=Crm.userDetails.TAX_MIGRATION_COMPLETED?productDetails.getTaxDisplayName(c,i):c,d=isNaN(d)?0:d,d=productDetails.getRoundOff(s,d),m){var u=$("#grandTaxValueMap"),p=objectUtils.getKeys(JSON.parse(productDetails.newAllTaxes)),f=""===u.val()?{}:JSON.parse(u.val());if(Crm.userDetails.TAX_MIGRATION_COMPLETED){var v=[];e.closest("table").find(".taxName").each((function(e,t){if($(t.parentNode).find("#grandTaxRnd")[0].checked){var i=t.parentNode.getElementsByClassName("editTax")[0].value;v.push(productDetails.getTaxDisplayName(t.innerText,i))}})),Object.keys(v).forEach((function(e){f[e]=e===c?e+"==="+i+":::"+d+";;;":f[e]}))}else f[c]=c+"==="+i+":::"+d+";;;";p.forEach((function(e){Object.keys(f).indexOf(e)<=-1&&(f[e]=e+"===0:::0;;;")})),u.val(JSON.stringify(f))}else{var g=$(productDetails.sfFldIdSuffix+"LINETAX_"+a),h=$(productDetails.sfFldIdSuffix+"PRODUCTID_"+a),C=JSON.parse(h.attr("prdDetails")),w=h.length>0?productDetails.getTaxVsIdSFLineItem(C.Tax):"",b=w.length-1,T=g.val();if(productDetails.grandTaxChanged=!0,""===T)g.val(c+"==="+i+":::"+d+";;;"),s.val(parseFloat(d).toString()).trigger("change");else{var I=T.split(";;;"),y=I.length-1,P=0,_="",D=!1;if(Crm.userDetails.TAX_MIGRATION_COMPLETED)for(O=0;O<y;O++){E=(S=I[O]).split("===")[0].trim(),x=S.split("===")[1];void 0!==(L=productDetails.taxIdVsName[E])&&L.length>0&&(E=L[1]);V=l*(F=parseFloat(x.split(":::")[0]))/100;P=parseFloat(P)+parseFloat(V),_=_+E+"==="+F+":::"+V+";;;"}else{for(var O=0;O<y;O++){var S,L,E=(S=I[O]).split("===")[0].trim(),x=S.split("===")[1];void 0!==(L=productDetails.taxIdVsName[E])&&L.length>0&&(E=L[1]);var F=parseFloat(x.split(":::")[0]),V=parseFloat(x.split(":::")[1]);c===E&&(D=!0,F=i,V=d),P=parseFloat(P)+parseFloat(V),_=_+E+"==="+F+":::"+V+";;;"}D||(_=_+c+"==="+i+":::"+d+";;;",P=parseFloat(P)+parseFloat(d));for(var O=0;O<b;O++)_.indexOf(w[O])<=-1&&(_=_+w[O]+"===0:::0;;;")}s.val(parseFloat(productDetails.getRoundOff(s,P)).toString()).trigger("change"),g.val(_)}o.trigger("change"),productDetails.calculateGrandTotalSFLineItem(this,t)}}$(".editTax").off("keyup").on("keyup",(function(){var e=$(this),t=c,i=t.data("data-rowid"),a=e.parent(),s=e.val(),r=$(productDetails.sfFldIdSuffix+"TAX_"+i),n=t.closest("table").hasClass("aggFldTabl");r.attr("percentage",s),(isNaN(s)||""===s)&&(s=0);var l=o.val();l=isNaN(l)?0:l;var d=M;d=isNaN(d)?0:d;var u=(parseFloat(l)-parseFloat(d))*s/100,p=a.closest(".taxRow"),f=Crm.userDetails.TAX_MIGRATION_COMPLETED?p.find(".taxVal"):a.find(".taxVal");u=productDetails.getRoundOff(r,u);var v=n?".grandTaxRnd":".lineTaxRnd",g=p.find(v).get(0);Crm.userDetails.TAX_MIGRATION_COMPLETED&&g.checked?$(f).text(u):$(f).val(u),Crm.userDetails.TAX_MIGRATION_COMPLETED?Crm.userDetails.TAX_MIGRATION_COMPLETED&&productDetails.canEditTaxValue&&productDetails.addOrRemoveTaxSFLineItem($(g),m?"grand":"inline",t):ve(e,t)}))}},getTaxDisplayNameSFLineItem:function(e){return e.indexOf("-")>-1&&e.indexOf("%")>-1?e.substr(0,e.indexOf("-")).trim():e},checkMaxLengthSFLineItem:function(e,t,i,a){if(8!==e.which&&(e.which<37||e.which>40)){var s,r,o=$("#multipleFieldsEditPop").is(":visible");if(o)var n=$("#duringTabs").find(".sel").attr("data-tab").split("_")[0];if($(t).hasClass("editTax"))s=5,r=5;else{var l=a?o?$("#Crm_"+productDetails.module+"_"+n+"_DISCOUNT"):$("#Crm_"+productDetails.module+"_DISCOUNT"):$(productDetails.sfFldIdSuffix+"DISCOUNT_1")[0];s=i?a?l.data("maxLength"):l.dataset.maxlength:5,r=i?a?l.data("decimalLength"):l.dataset.decimalLength:5}var d=$(t).val().trim(),c=d.indexOf(".")>-1;if(d&&d.length>=s)e.preventDefault();else if(c){r<=d.split(".")[1].length&&e.preventDefault()}d.indexOf("-")>1&&e.preventDefault()}},checkAlphabatePresence:function(e,t){var i=$(t).val().trim().indexOf(".")>-1;return!(/^[0-9\.\-]+$/.test(e.key)&&("."!==e.key||!i))&&(e.preventDefault(),!0)},validateQtyFld:function(e){var t=$(e),i=t.val();t.closest("div").find(".errorMsgDesc").remove(),i&&isNaN(i)&&Crm.showErrorMsg(I18n.getMsg("crm.field.valid.check",[$ESAPI.encoder().encodeForHTML(t.data("displaylabel"))]),t,productDetails.module)},addOrRemoveTaxSFLineItem:function(e,t,i){var a,s=i.data("data-rowid"),r=e.attr("btn-num"),o=e.closest(".taxRow"),n=e.closest(".newpopup"),l=o.find(".editTax"),d=o.find(".taxVal"),c=o.find(".taxPercentage_box"),u=n.find(".grandTaxButtons").eq(0),m=parseFloat(l.val().trim()),p="",f=$("#multipleFieldsEditPop").is(":visible"),v=$(e).is(":checked");v?e.checked=!0:(("inline"===t?$("#inlineTaxValError"+r):$("#grandTaxValError"+r)).addClass("dN"),l.addClass("taxPercentage_box_bg"),c.addClass("taxPercentage_box_bg"));if(productDetails.canEditTaxValue&&(v?(l.removeAttr("readonly"),l.removeClass("taxPercentage_box_bg"),c.removeClass("taxPercentage_box_bg")):l.attr("readonly",!0)),(isNaN(m)||""===m)&&(m=0),"inline"===t){var g=$(productDetails.sfFldIdSuffix+"TOTALAFTERDISCOUNT_"+s),h=g&&g.val()?g.val():0,C=$(productDetails.sfFldIdSuffix+"TAX_"+s);v?(a=h*m/100,a=productDetails.getRoundOff(C,a)):a="-";p="";n.find(".taxRow").each((function(e,i){var a=h;a=isNaN(a)?0:a;var s=parseFloat(i.getElementsByClassName("editTax")[0].value);s=isNaN(s)?0:s;var r=productDetails.getRoundOff(C,parseFloat(a*s/100)),o=$(i).find("inline"===t?".lineTaxRnd":".grandTaxRnd")[0],n=o.value;o.checked&&(p=p+n+"==="+s+":::"+r+";;;")})),u.attr("tax-expr",p)}else{if(f)var w=$("#duringTabs").find(".sel").attr("data-tab").split("_")[0];var b=f?$("#Crm_"+productDetails.module+"_"+w+"_SUBTOTAL").val():$("#Crm_"+productDetails.module+"_SUBTOTAL").val();C=f?$("#Crm_"+productDetails.module+"_"+w+"_TAX"):$("#Crm_"+productDetails.module+"_TAX");b=void 0===b||b.length<1?0:b;var T=f?$("#Crm_"+productDetails.module+"_"+w+"_DISCOUNT").val():$("#Crm_"+productDetails.module+"_DISCOUNT").val();T=void 0===T?0:T;var I=parseFloat(b)-parseFloat(T);v?(a=I*m/100,a=productDetails.getRoundOff(C,a)):a="-";var y=$("#grandTaxValueMap"),P={};n.find(".taxRow").each((function(e,i){I=isNaN(I)?0:I;var a=parseFloat(i.getElementsByClassName("editTax")[0].value);a=isNaN(a)?0:a;var s=productDetails.getRoundOff(C,parseFloat(I*a/100)),r=$(i).find("inline"===t?".lineTaxRnd":".grandTaxRnd")[0],o=r.value;r.checked&&(P[o]=o+"==="+a+":::"+s+";;;")})),y.val(JSON.stringify(P)),productDetails.addLoggerForTaxIssue(y.val(),"Action triggered when checkbox is clicked")}d.text(a)},taxCalcTriggerSFLineItem:function(e){var t=e.data("data-rowid"),i=$(productDetails.sfFldIdSuffix+"LINETAX_"+t),a=$(productDetails.sfFldIdSuffix+"PRODUCTID_"+t),s=a.length>0?a.attr("prdDetails"):"";s=void 0!==s&&s.length>0?JSON.parse(s):"";var r=productDetails.getTaxVsIdSFLineItem(s.Tax).length,o=$(productDetails.sfFldIdSuffix+"TOTALAFTERDISCOUNT_"+t),n=o.length>0?parseFloat(o.val()):0;n=isNaN(n)?0:n;var l=$(productDetails.sfFldIdSuffix+"TAX_"+t);if(r>0&&(s.Taxable&&(productDetails.autoPopulateTax&&l.length>0||l.length>0))){for(var d="",c=i.val().split(";;;"),u=c.length-1,m=0,p=0;p<=u&&0!==u;p++)if(c[p].length>0){var f=c[p].split("===")[0].trim(),v=c[p].split("===")[1],g=productDetails.taxIdVsName[f];void 0!==g&&g.length>0&&(f=g[1]);var h=v.split(":::")[0],C=n*h/100;d=d+f+"==="+h+":::"+C+";;;",m+=C}i.val(d),l.val(parseFloat(productDetails.getRoundOff(l,m)).toString()).trigger("change")}},showGrandDiscNewSFLineItemPop:function(e){var t=$("#discountPop"),i=$("#multipleFieldsEditPop"),a=$(e),s=i.is(":visible"),r=a.offset().left,o=a.offset().top,n=a.innerHeight(),l=a.closest("tr").data("data-rowid");if(event.stopPropagation(),s)var d=$("#duringTabs").find(".sel").attr("data-tab").split("_")[0];var c=$(e).closest("table").hasClass("aggFldTabl"),u=c?s?$("#Crm_"+productDetails.module+"_"+d+"_SUBTOTAL"):$("#Crm_"+productDetails.module+"_SUBTOTAL"):$(productDetails.sfFldIdSuffix+"TOTAL_"+l),m=c?s?$("#Crm_"+productDetails.module+"_"+d+"_DISCOUNT"):$("#Crm_"+productDetails.module+"_DISCOUNT"):$(productDetails.sfFldIdSuffix+"DISCOUNT_"+l),p=$(e).parent().find("input").val();if(s){var f=$(".subFrmTablWrapper"),v=$("#multipleFieldsEditPop .pp-content").scrollTop(),g=i.offset().left,h=a.closest(".labelValCreate"),C=h.closest(".aggFldTabl").length>0;C?(r=h.offset().left,o=h.offset().top+v):(o=h.position().top,r=h.position().left+f.position().left);var w,b,T=h.closest(".labelValCreate"),I=T.outerHeight(),y=T.outerWidth(),P=i.offset().left,_=i.outerWidth()}p=parseFloat(""===p||isNaN(p)?0:p);var D=0;D=u.val();var O=0;0!==(D=parseFloat(""===D||isNaN(D)?0:D))?O=productDetails.getRoundOffValue(p/D*100,!0):(O=parseFloat(m.attr("percentage")),O=isNaN(O)?0:O);var S=t.find(".discPc"),L=t.innerWidth();if(S.val(O.toString()),void 0!==u&&0===u.length&&void 0!==S&&S.length>0){var E=t.find(".bdrBot.p15");E.length>0&&E[0].remove()}var x=t.find(".directPrice");function F(e){$("#dirPcErr").addClass("dN"),$("#discPercErr").addClass("dN");var t=e.closest(".noEventDiv"),i=$("#multipleFieldsEditPop").is(":visible"),a=t.find(".decimalFld"),s=a.parent();if(0==s.find(".resultValue").length){var r=$('<span class="resultValue hide"></span>');r.attr("data-valueRes",""),s.append(r)}"percent"===e.attr("id")?a.attr({"data-decimal-length":"5",maxlength:"5"}):"dirPrice"===e.attr("id")&&a.attr({"data-decimal-length":m.attr("data-decimal-length"),maxlength:m.attr("data-maxlength")}),a.off("keypress keyup blur").on("keypress keyup blur",(function(e){crmTemplate.calculatorOperation(this,e,!0)})),t.parent().parent().find(".decimalFld").parent().css("visibility","hidden"),s.css("visibility","visible"),i||a.select()}x.val(p.toString()),$("#dirPcErr").addClass("dN"),$("#discPercErr").addClass("dN"),$("#taxesPop").find("div").hide(),Crm.userDetails.TAX_MIGRATION_COMPLETED?($("#saveDiscountType").off("click").on("click",(function(){var e=null,t=$("#multipleFieldsEditPop").is(":visible"),i=a;if(t){e=$("#multipleFieldsEditPop #duringTabDivs div.current");var r=$("#duringTabs").find(".sel").attr("data-tab").split("_")[0]}var o=t?e.find("#discountPop"):$("#discountPop"),n=$("#inventrydiscountPop:checked").val(),l=document.getElementById("discountPop"),d=l.getElementsByClassName("discPc")[0].value,c=l.getElementsByClassName("directPrice")[0].value,u=i.closest("tr").data("data-rowid");if("fromPb"!==n&&u){var m=$(productDetails.sfFldIdSuffix+"BOOKID_"+u);m.val(""),m.removeAttr("pricingDetails")}if((u?$(productDetails.sfFldIdSuffix+"DISCOUNT_"+u):s?$("#Crm_"+productDetails.module+"_"+r+"_DISCOUNT"):$("#Crm_"+productDetails.module+"_DISCOUNT")).attr({percentage:d,discType:n}),"percent"===n){if(isNaN(d)||!d)return $("#discPercErr").removeClass("dN"),!1;productDetails.calcGrandDiscSFLineItem($(o.find(".discPc")),i)}else if("dirPrice"===n){if(isNaN(c)||!c)return $("#dirPcErr").removeClass("dN"),!1;productDetails.calcGrandDiscSFLineItem($(o.find(".directPrice")),i)}o.hide()})),$("#cancelDiscountType").off("click").on("click",(function(){$("#discountPop").hide()}))):(S.off("keyup"),S.keyup((function(){var e=a,t=e.closest("tr").data("data-rowid");$(productDetails.sfFldIdSuffix+"BOOKID_"+t).val(""),$(productDetails.sfFldIdSuffix+"DISCOUNT_"+t).attr({percentage:$(this).val(),discType:"percent"}),productDetails.calcGrandDiscSFLineItem(this,e)})),x.off("keyup"),x.keyup((function(){var e=a,t=e.closest("tr").data("data-rowid");$(productDetails.sfFldIdSuffix+"BOOKID_"+t).val(""),productDetails.calcGrandDiscSFLineItem(this,e),$(productDetails.sfFldIdSuffix+"DISCOUNT+"+t).attr({percentage:$("#discountPop").find(".discPc").val(),discType:"dirPrice"})}))),$(".discType").off("click").on("click",(function(){F($(this))})),$(".noEventDiv").off("click").on("click",(function(){var e=$(this);e.hasClass("roundCheck")?e.prop("checked",!0):e.find(".roundCheck").prop("checked",!0),F(e)}));var V=$("#frmBook"),A=$(productDetails.sfFldIdSuffix+"BOOKID_"+l),k=A.length>0?A.val().length:0,N=u.length>0,M=$("#percent");if(N?M.closest("div").removeClass("hide"):M.closest("div").addClass("hide"),k>0&&"fromPb"===m.attr("discType")?(V.parent().show(),V.find(".roundCheck").trigger("click")):"dirPrice"!==m.attr("discType")&&N?(V.parent().hide(),M.find(".roundCheck").trigger("click")):(V.parent().hide(),$("#dirPrice").find(".roundCheck").trigger("click")),s)w=t.outerWidth(),b=t.height(),_-(h.offset().left-P)>w+20?t.css({left:r,top:o+b+I-15}).show():t.css({left:r+y/2-w,top:o+b+I-15}).show(),C&&(Crm.userDetails.RTL_ENABLED?t.css({left:r-g,top:o-(I+30)}).show():t.css({left:r-(g+w/2),top:o-(I+25)}).show());else{var R,B=r+L/2;R=renderingUtils.windowWidth<B?r-L:r-L/2,t.css({left:R,top:o+n+10}).show();var U=document.querySelector("html, body");crmui.animateScrollTop(U,o-115,200),t.find(".decimalFld").focus()}},calculateGrandTotalSFLineItem:function(e,t){var i=$("#multipleFieldsEditPop").is(":visible");if(i)var a=$("#duringTabs").find(".sel").attr("data-tab").split("_")[0];var s=i?$("#Crm_"+productDetails.module+"_"+a+"_DISCOUNT"):$("#Crm_"+productDetails.module+"_DISCOUNT"),r=i?$("#Crm_"+productDetails.module+"_"+a+"_SUBTOTAL"):$("#Crm_"+productDetails.module+"_SUBTOTAL"),o=i?$("#Crm_"+productDetails.module+"_"+a+"_ADJUSTMENT"):$("#Crm_"+productDetails.module+"_ADJUSTMENT"),n=i?$("#Crm_"+productDetails.module+"_"+a+"_TAX"):$("#Crm_"+productDetails.module+"_TAX"),l=(t.closest("table").hasClass("aggFldTabl"),r.val());l=l&&l.length>0?l:0;var d=parseFloat(s.length>0?s.val():0),c=s.attr("percentage"),u=parseFloat(void 0===c||0===c.length||isNaN(c)?0:c);"dirPrice"!==s.attr("discType")&&(d=0!==u?l*u/100:parseFloat(void 0===d||0===d.length||isNaN(d)?0:d));for(var m=0,p=$("#recordTaxDet").val(),f=p?p.split(";;;"):"",v=f.length-1,g=0,h=0;h<v;h++){var C=f[h].split("===")[1],w=parseFloat(C.split(":::")[0]),b=(l-d)*w/100;m+=parseFloat(productDetails.getRoundOff(n,b)),g+=w}var T=parseFloat(o.val());(isNaN(T)||""===T)&&(T=0),m=productDetails.getRoundOff(n,m),l=productDetails.getRoundOff(r,l),d=productDetails.getRoundOff(s,d),T=productDetails.getRoundOff(o,T),r.val(parseFloat(l).toString()).trigger("change"),r.attr("temp-value",l),n.attr("percentage",g),s.val(parseFloat(d).toString()).trigger("change"),n.val(parseFloat(m).toString()).trigger("change"),o.val(parseFloat(T).toString()).trigger("change"),productDetails.grandTaxChanged=!1},showTaxToolTipForSFLineItem:function(e){var t=$(e).closest("tr").data("data-rowid"),i=$(productDetails.sfFldIdSuffix+"PRODUCTID_"+t),a=0===i.length?0:i.val().length;if(!$(e).closest("table").hasClass("aggFldTabl")&&a>0){var s=JSON.parse(i.attr("prdDetails")).Taxable+""=="true",r=$(productDetails.sfFldIdSuffix+"LINETAX_"+t),o=r.attr("old"),n=r.val(),l="<table>";if(""!==(n=s&&0===n.length?"":n)&&(s||o))for(var d=n.split(";;;"),c=d.length-1,u=0;u<c;u++){var m=d[u],p=(n=m.split("===")[1],m.split("===")[0].trim()),f=productDetails.taxIdVsName[p];void 0!==f&&f.length>0&&(p=f[1]);var v=n.split(":::")[0];l=l+"<tr> <td> "+productDetails.getTaxDisplayNameSFLineItem(p)+" </td> <td> : </td> <td> &nbsp; "+v+"% </td></tr>"}else l=l+"<tr> <td>"+I18n.getMsg("crm.tax.association.check")+"</td> </tr>";l+="</table>",""!==$(l).html()&&zctt.showtt(l)}},showDiscToolTipForSFLineItem:function(e){if(!$(e).closest("table").hasClass("aggFldTabl")){var t=$(e).closest("tr").data("data-rowid"),i=$(productDetails.sfFldIdSuffix+"PRODUCTID_"+t),a=i.length>0?i.val().length:0,s=$(productDetails.sfFldIdSuffix+"TOTALAFTERDISCOUNT_"+t).val();s=s||0,a>0&&zctt.showtt(I18n.getMsg("TotalAfterDiscount")+" : "+productDetails.currencySymbol+" "+s)}},showPrdToolTipSFLineItem:function(e){var t=$(e).closest("tr").data("data-rowid"),i=$(productDetails.sfFldIdSuffix+"PRODUCTID_"+t);if(i.val().length>0&&void 0!==i.attr("prdDetails")){var a=JSON.parse(i.attr("prdDetails")),s=a.Unit_Price;if(!isNaN(s)&&null!=s&&String(a.Unit_Price).length>0){var r=1,o=$("#Crm_"+productDetails.module+"_CURRENCYISOCODE").val(),n=Crm.userDetails.BASE_CURRENCY;null!=o&&null!=n&&o!=n&&(r=Crm.userDetails.CURRENCY_DETAILS[o]?Crm.userDetails.CURRENCY_DETAILS[o].er:Crm.userDetails.CURRENCY_DETAILS[n].er),s*=r,s=productDetails.getRoundOffValue(s,!0)}else s=0;s=productDetails.currencySymbol+" "+s;var l=isNaN(a.Qty_in_Stock)||0===a.Qty_in_Stock.length?"-":a.Qty_in_Stock;a.isNumberSeparatorEnabledForQInS&&(l=Search.formatNumber(l.toString()));var d=null==a.Product_Code?"-":a.Product_Code,c='<table class="f13 nowrap pli_tooltipzc crm-font-bold"><tr> <td class="pli_tooltipTd pli_tooltipLbl">'+I18n.getMsg("crm.label.Product Code")+'</td> <td class="pli_tooltipTd"> : </td> <td class="pli_tooltipTd" id="prdCode"> &nbsp; '+d+" </td></tr>";c=(c=c+'<tr> <td class="pli_tooltipTd pli_tooltipLbl">'+I18n.getMsg("Qty in Stock")+'</td> <td class="pli_tooltipTd"> : </td> <td class="pli_tooltipTd" id="qtyInStk"> &nbsp; '+l+" </td></tr>")+'<tr><td class="pli_tooltipTd pli_tooltipLbl">'+I18n.getMsg("Unit Price")+'</td> <td class="pli_tooltipTd"> : </td> <td class="pli_tooltipTd" id="unitPrice"> &nbsp; '+s+" </td> </tr></table>",zctt.showtt(c)}},calcGrandDiscSFLineItem:function(e,t){var i,a,s,r=$(e),o=0,n=0,l=t.closest("tr"),d=l.data("data-rowid"),c=l.closest("table").hasClass("aggFldTabl"),u=$("#multipleFieldsEditPop").is(":visible");if(u)var m=$("#duringTabs").find(".sel").attr("data-tab").split("_")[0];c?(i=u?$("#Crm_"+productDetails.module+"_"+m+"_SUBTOTAL"):$("#Crm_"+productDetails.module+"_SUBTOTAL"),a=u?$("#Crm_"+productDetails.module+"_"+m+"_DISCOUNT"):$("#Crm_"+productDetails.module+"_DISCOUNT"),s=u?$("#Crm_"+productDetails.module+"_"+m+"_TAX"):$("#Crm_"+productDetails.module+"_TAX")):(i=$(productDetails.sfFldIdSuffix+"TOTAL_"+d),a=$(productDetails.sfFldIdSuffix+"DISCOUNT_"+d),s=$(productDetails.sfFldIdSuffix+"TAX_"+d));var p=parseFloat(i.val());p=isNaN(p)?0:p,r.attr("class").indexOf("discPc")<0?((""===(o=r.val())||isNaN(o))&&(o=0),o=productDetails.getRoundOff(a,parseFloat(o)),n=0===p?0:100*o/p,n=productDetails.getRoundOff(a,n),r.parent().parent().parent().parent().find(".discPc").val(n)):((""===(n=r.val())||isNaN(n))&&(n=0),o=p*n/100,o=productDetails.getRoundOff(a,o),r.parent().parent().parent().parent().find(".directPrice").val(o));var f=$(productDetails.sfFldIdSuffix+"TOTALAFTERDISCOUNT_"+d);if(a.attr("percentage",n),a.val(parseFloat(o).toString()).trigger("change"),f.val(parseFloat(productDetails.getRoundOff(f,parseFloat(p-o))).toString()).trigger("change"),s.length>0){var v=c?i.val()-o:f.length>0?f.val():i.val(),g=$(productDetails.sfFldIdSuffix+"LINETAX_"+d),h=c?$("#recordTaxDet").val():g.val(),C=0;if(c||""!==h){var w=h.split(";;;"),b=w.length-1;for(O=0;O<b;O++){h=w[O].split("===")[1];C+=v*(L=parseFloat(h.split(":::")[0]))/100}}else{h=JSON.parse(productDetails.newAllTaxes);var T=$(productDetails.sfFldIdSuffix+"PRODUCTID_"+d),I=T.length>0&&void 0!==T.attr("prdDetails")?JSON.parse(T.attr("prdDetails")):{},y=productDetails.getTaxVsIdSFLineItem(I.Tax),P=void 0!==g&&g.length>0?y:"";if(null!==h&&I.Taxable)for(var _=objectUtils.getKeys(h),D=_.length-1,O=0;O<=D;O++){var S=_[O],L=h[S];P.length>0&&P.indexOf(S)>-1&&!c&&productDetails.autoPopulateTax&&(C+=v*L[1]/100)}}s.val(parseFloat(productDetails.getRoundOff(s,C)).toString()).trigger("change")}Crm.userDetails.hideProductLineItemsSummary||productDetails.calculateGrandTotalSFLineItem(r,l)},constructTaxPopSFLineItem:function(e,t,i,a,s,r){e=parseFloat(e);var o="",n=productDetails.getTaxDisplayNameSFLineItem(t);if(Crm.userDetails.TAX_MIGRATION_COMPLETED){var l=n+"_"+e+"_percentage",d=a?"grandTaxRnd":"lineTaxRnd",c=a?"grandTaxValError":"inlineTaxValError";o=(o=(o=(o=(o='<div class="taxRow clearFix">')+'<label class="newCustomchkbox-md fL w130 mT3 dIB vam"><input type="checkbox" id='+d+' class="'+d+'" style="width: 25px;height: 15px;" value="'+t+'" data-zcqa="'+(n+"_"+e+"_tax_checkbox")+'" btn-num="'+r+'"'+(s?" checked":"")+'><span class="chkbxIcon vam mR10"></span><span class="ellipsistext w100 dIB vam taxName">'+n+"</span></label>")+'<div class="fL clearFix"><div class="taxPercentage_box fL wAuto '+(s&&productDetails.canEditTaxValue?"":"taxPercentage_box_bg")+'"><input type="number" max="5" class="'+(s&&productDetails.canEditTaxValue?"":"taxPercentage_box_bg")+" decimalFld editTax alignright nobdr w40 "+(productDetails.canEditTaxValue?"":"cantEditTax")+'" data-zcqa="'+l+'" value="'+e+'" onkeydown="productDetails.checkMaxLengthSFLineItem(event,this,false,'+a+')" '+(productDetails.canEditTaxValue&&s?"":'readonly="true" ')+(productDetails.canEditTaxValue?"":'style="-moz-appearance: textfield"')+'><b class="pL5">%</b></div>')+'<div class="mL10 taxVal alignright decimalFld fR w100 mT4" size="5" style="font-size: smaller;">'+(s?parseFloat(i):"-")+"</div></div>")+'</div><div class="mB10"><span id="'+c+r+'" style="font-size: 11px;color: red;margin-left: 130px;" class="vat dN taxValError">'+I18n.getMsg("crm.field.valid.check",I18n.getMsg("crm.label.tax.value"))+"</span></div>"}else o=o+'<div class="taxRow"> <p class="f12 bold color1 taxName"> '+n+' </p> <div class="pT10 pB10 bdrBot mB10"><input type="text" size="5" class="newinputText1 decimalFld editTax alignright" value="'+e+'"> <b class="pL5">%</b> <input type="text" class="newinputText1 mL10 taxVal alignright decimalFld" readonly="true" size="5" value="'+parseFloat(i)+'"> <label class="pL5"> </label></div> </div>';return o},createDiscPopupSFLineItem:function(e){var t=document.createElement("div");t.id="discountPop",t.setAttribute("class","newpopup w320"),t.setAttribute("style","display: none;z-index: 2"),t.setAttribute("onclick","sE(event)"),e.appendChild(t);var i="discount_"+I18n.getMsg("percentage")+"_radio",a="discount_"+I18n.getMsg("crm.label.direct.dicount")+"_radio",s="discount_"+I18n.getMsg("crm.inventory.discount.frompb")+"_radio",r="discount_"+I18n.getMsg("percentage")+"_input",o="discount_"+I18n.getMsg("crm.label.direct.dicount")+"_input",n="<div class='p30'><div class=\"proximas pB15\">"+I18n.getMsg("crm.discount.pop.title")+"</div>";n=(n=(n=(n=(n=(n+='<div class="pB10">')+'<div class="noEventDiv" id="percent"><label class="rbCheckHtml"> <input type="radio" data-zcqa="'+i+'" id="inventrydiscountPop" name="discType" value="percent" class="roundCheck discType cP"><span class="rbHtml"></span> <span class="rbHtmlLb mL5">'+I18n.getMsg("percentage")+'</span></label> <span class="pL15 vh">')+'<input type="text" data-zcqa="'+r+'" class="w40 discPc decimalFld newinputText1 alignRight"> <b class="pL5">%</b> </span></div><div><span id="discPercErr" style="font-size: 11px;color: red;margin-left: 20px;" class="vat dN taxValError">'+I18n.getMsg("crm.subform.lineitem.discount.percentage.validation.error")+"</span></div> </div>")+'<div class="pB10">  <div class="noEventDiv" id="dirPrice"> <label class="rbCheckHtml"><input type="radio" data-zcqa="'+a+'" id="inventrydiscountPop" name="discType" value="dirPrice" class="roundCheck discType cP"><span class="rbHtml"></span> <span class="rbHtmlLb mL5">'+I18n.getMsg("crm.label.direct.dicount")+"</span></label>")+'<span class="vh"> <input type="text" data-zcqa="'+o+'" class="w40 directPrice decimalFld newinputText1"> </span> </div><div><span id="dirPcErr" style="font-size: 11px;color: red;margin-left: 20px;" class="vat dN taxValError">'+I18n.getMsg("crm.subform.lineitem.discount.directprice.validation.error")+"</span></div> </div>")+'<div class="pB10"> <div class="noEventDiv" id="frmBook">  <label class="rbCheckHtml"><input type="radio" data-zcqa="'+s+'" id="inventrydiscountPop" name="discType" value="fromPb" class="discType roundCheck cP"><span class="rbHtml"></span><span class="rbHtmlLb mL5">'+I18n.getMsg("crm.inventory.discount.frompb")+"</span></label>",n=(n+="</div> </div>")+'<div class="pT10"><input type="button" data-zcqa="discount_save" id="saveDiscountType" class="primarybtn btn_sml" value="'+I18n.getMsg("crm.button.done")+'"><input type="button" data-zcqa="discount_cancel" id="cancelDiscountType" class="newgraybtn btn_sml" value="'+I18n.getMsg("crm.button.cancel")+'"></div></div>',t.innerHTML=n},createTaxPopsSFLineItem:function(e){var t=document.createElement("div");t.id="taxesPop",e.appendChild(t);var i='<div class="newpopup '+(Crm.userDetails.TAX_MIGRATION_COMPLETED?"p30 w350":"p15 w190")+' whiteBg hide" style="top: 128px; display: block; left: 963px;" id="taxPop" onclick="sE(event)"> </div>';i=i+'<div class="newpopup '+(Crm.userDetails.TAX_MIGRATION_COMPLETED?"p30 w350":"p15 w190")+' whiteBg hide" style="top: 128px; display: block; left: 963px;" id="grandTaxPop" onclick="sE(event)"> </div>',i+='<input id="grandTaxValueMap" type="text" style="display:none"/>',t.innerHTML=i},cancelGrandTaxSFLineItem:function(e){event.stopPropagation(),(e?$("#grandTaxPop"):$("#taxPop")).empty().hide()},fillBillingAddressForPO:function(){var e=Crm.userDetails.orgAddress;null!=e&&""!=e&&(e=e.split("|"),$("#Crm_PurchaseOrders_BILLINGSTREET").val(e[0]),$("#Crm_PurchaseOrders_BILLINGCITY").val(e[1]),$("#Crm_PurchaseOrders_BILLINGSTATE").val(e[2]),$("#Crm_PurchaseOrders_BILLINGCODE").val(e[3]),$("#Crm_PurchaseOrders_BILLINGCOUNTRY").val(e[4]))},createLinesTable:function(e){var t=document.createElement("div");t.id="productList",e.appendChild(t);var i='<div class="pT0 pB20" style="display:none"> <div class="wrap"> <table width="100%" border="0" cellspacing="0" cellpadding="0" class="invoiceTable" id="linesTable"> ';i+='<thead><tr id="lineHeaderRow"><th width="30%" class="bold">'+I18n.getMsg("Product Details")+'</th> <th width="12%" class="aligncenter bold">'+I18n.getMsg("List Price")+'</th><th width="12%" class="aligncenter bold">'+I18n.getMsg("Quantity")+'</th><th width="12%" class="aligncenter bold">'+I18n.getMsg("Amount")+"</th>",i+='<th width="12%" class="aligncenter bold">'+I18n.getMsg("Discount")+'</th><th width="12%" class="aligncenter bold">'+I18n.getMsg("Tax")+'</th><th width="12%" class="aligncenter bold">'+I18n.getMsg("Total")+'</th><th width="2%"></th><th width="5%"></th></tr></thead>',i+='<tbody id="linesTbody"> </tbody> <tfoot> <tr> <td colspan="5" style="border-bottom:none"><input type="button" value="'+I18n.getMsg("crm.button.inventory.add.lineitems")+'" onclick="productDetails.showpop()" class="newgraybtn mT40 cP"></td> ',Crm.userDetails.hideProductLineItemsSummary||(i+='<td colspan="2"  style="border-bottom:none"> <table class="fR"> <tr> <td class="noborder"> <label class="fL w100 alignright">'+I18n.getMsg("Sub Total")+'</label> </td> <td class="noborder alignright"> <span class="fL w100 grandVals"> </span> <input type="hidden" id="subTotal" name="property(Sub Total)" value="0"> </td> <td class="noborder"> </td> </tr>',i+='<tr> <td class="noborder"> <label class="fL w100 alignright">'+I18n.getMsg("Discount")+'</label> </td> <td onmouseover=\'productDetails.showCellIcon(this, true,false)\' onmouseout=\'productDetails.hideCellIcon(this, true)\' class="noborder alignright"> <span class="w100 pL40"> <label class="grandVals"> </label> <input type="hidden" id="txtDiscount" name="property(Discount)" value="0"> <input type="hidden" class="discPc" id="discPc" name="property(hdnDiscPc)" value="0"> </span> </td> <td onmouseover=\'productDetails.showCellIcon(this,undefined,false)\' onmouseout=\'productDetails.hideCellIcon(this)\' class="noborder"> <i class="neweditIcon dIB vam mL5 lineicon pointer" style="visibility: hidden;" onclick="productDetails.showGrandDiscPop(this);sE(event)"></i> </td> </tr>',i+='<tr> <td class="noborder"> <label class="fL w100 alignright">'+I18n.getMsg("Tax")+'</label> </td> <td id=\'recordTaxDetTD\' onmouseover=\'productDetails.showCellIcon(this, true,false)\' onmouseout=\'productDetails.hideCellIcon(this, true)\' class="noborder alignright"> <span class="w100 pL40"><label class="grandVals"> </label> <input type="hidden" id="txtTax" name="property(Tax)" value="0"> </span> <input type="hidden" id="recordTaxDet" name="property(recordTaxDet)" class="recordTaxDet"> </td> <td onmouseover=\'productDetails.showCellIcon(this,undefined,false)\' onmouseout=\'productDetails.hideCellIcon(this)\' class="noborder"> <i class="icon_roundNxtarw mL5 pointer lineicon" style="visibility: hidden;" onclick="productDetails.showGrandTaxPop(this);sE(event)"></i> </td> </tr>',i+='<tr> <td> <label class="fL w100 alignright">'+I18n.getMsg("Adjustment")+'</label> </td> <td class="alignright"> <input type="text" size="8" class="textFieldEdit decimalFld cP textInLineItem alignright mL15 invValidate" onkeyup="productDetails.calculateGrandTotal()" onmouseover="$(this).addClass(\'grayBg\')" onmouseout="$(this).removeClass(\'grayBg\')" onclick="$(this).select()" id="txtAdjustment" name="property(Adjustment)" value="0" style="box-shadow: none;"> </td> <td  class="noborder"> </td> </tr>',i+='<tr style="border-top:1px solid #eee; border-bottom:1px solid #eee;" class="oH p5"> <td> <label class="fL w100 alignright bold">'+I18n.getMsg("Grand Total")+'</label> </td> <td class="alignright"> <span class="fL w100 alignright grandVals bold"> </span> <input type="hidden" id="grandTotal" name="property(Grand Total)" value="0"> </td> <td  class="noborder"> </td> </tr> </table> </td><td  style="border-bottom:none"></td><td  style="border-bottom:none"></td> </tr>',i+='</tfoot> </table> </div> </div> <div id="addLinesBtnLwr" class="pB10 fL cP invAddLinesBtn" onclick="productDetails.showpop()" > <div class=""> +  '+I18n.getMsg("crm.button.inventory.add.lineitems")+'<span class="errMsg red pR20 f11 fR" id="errorMsg_Crm_'+this.module+'_PRODUCTDETAILS" style="color: rgb(221, 0, 0); display: none; top:0px !important"> * '+I18n.getMsg("crm.inventory.alert.lineitems.empty")+" </span> </div> </div>",i+=" </table> </div> <input type='hidden' name='property(totalProductCount)' id='totalProductCount' value='0'> </div>"),t.innerHTML=i},createProductsPop:function(e){var t=document.createElement("div");t.id="popup1",t.setAttribute("class","newpopup p30 w680"),t.setAttribute("style","left: 25%; top: 40%; height: 400px; z-index: 30; display: none;"),e.appendChild(t);var i='<div class="pR"> <div class="ui-front" id="invLinesAutoComplete"> </div> <div id="productPopup" style="max-height:750px"><div class="pL0"><div class="f18 openSans txtClrBlack"> <div style="float: right;"> <a href="javascript:;" class="icon_close mT6 fR" onclick="productDetails.closepop()">&nbsp;</a> <span class="fR" id="vendPrdsSpan"> <input type="checkbox" id="vendPrds"> <span> '+I18n.getMsg("crm.vendor.products.show")+' </span> </span></div> <h2 class="f20 mB10" style="border-bottom:none;"> '+I18n.getMsg("crm.inventory.select.products")+" </h2>";i+='<table width="100%" border="0" cellpadding="0" cellspacing="0" style="border-collapse:collapse;"><thead><tr class="bdrdouble">',i+='<th class="f13 pT20 pB5 openSansNormal bold alignleft" width="65%" style="float: left;">'+I18n.getMsg("Product Details")+'</th> <th class="f13 pT20 pB5 openSansNormal bold" width="25%" style="float: left;">'+I18n.getMsg("Quantity")+'</th> <th class="" width="5%" style="float: left;">&nbsp;</th> </tr>  </thead>',i+='<tbody id="linesInPop" class="minh250auto" style="display: block;"> <tr> <td colspan="3" style="float: left;"> <div class="f15 pT20"><a href="javascript:;" id="addAnotherLine" class="link1 addAnotherLine vh" tabindex="1002" onclick="productDetails.addLineInPop()">'+I18n.getMsg("zb.invoice.AddAnotherLine")+"</a></div> </td> </tr> </tbody>",i+='<tfoot style="display: block;"> <tr> <td>',i+='<div class="mT20"> <a href="javascript:;" class="primarybtn addFinal hauto dIB" id="addPrdbtn" onclick="productDetails.addSave()"> '+I18n.getMsg("crm.button.inventory.add.products")+" </a>",i+='<input type="button" id="cancelAddPrdbtn" class="newgraybtn hauto" value="'+I18n.getMsg("crm.button.cancel")+'" onclick="productDetails.closepop()"> <input type="hidden" id="linesInPop" name="linesInPop"> </div> </td> </tr> </tfoot> </table> </div> <br class="clearB"> </div> </div> </div>',t.innerHTML=i},createDiscountPop:function(e){var t=document.createElement("div");t.id="discountPop",t.setAttribute("class","newpopup w300 hide"),t.setAttribute("style","left: 865.5px; top: 128px; display: block;"),t.setAttribute("onclick","sE(event)"),e.appendChild(t);var i='<div><div class="bdrBot p15" onmouseover="$(this).addClass(\'grayBg\')" onmouseout="$(this).removeClass(\'grayBg\')">';i+='<div class="noEventDiv"> <input type="radio" id="inventrydiscountPop" name="discType" value="percent" class="roundCheck discType cP"> <span class="f12 openSansNormal color1 cP">'+I18n.getMsg("percentage")+'</span> <span class="pL15 vh">',i+='<input type="text" size="5" class="discPc decimalFld newinputText1 alignRight"> <b class="pL5">%</b> </span></div></div>',i+='<div class="bdrBot p15" onmouseover="$(this).addClass(\'grayBg\')" onmouseout="$(this).removeClass(\'grayBg\')">  <div class="noEventDiv"> <input type="radio" id="inventrydiscountPop" name="discType" value="dirPrice" class="roundCheck discType cP"> <span class="f12 openSansNormal color1 cP">'+I18n.getMsg("crm.label.direct.dicount")+"</span>",i+='<span class="vh"> <input type="text" size="5" class="directPrice decimalFld newinputText1"> <label class="pL5"> </label> </span> </div> </div>',i+='<div class="p15" onmouseover="$(this).addClass(\'grayBg\')" onmouseout="$(this).removeClass(\'grayBg\')"> <div class="noEventDiv" id="frmBook"> <input type="radio" id="inventrydiscountPop" name="discType" value="fromPb" class="discType roundCheck cP">',i+='<span class="f12 openSansNormal color1 pL5 cP">'+I18n.getMsg("crm.inventory.discount.frompb")+"</span> </div> </div> </div> ",t.innerHTML=i},createTaxPops:function(e){var t=document.createElement("div");t.id="taxesPop",e.appendChild(t);t.innerHTML='<div class="newpopup p15 w300 whiteBg hide" style="top: 128px; display: block; left: 963px;" id="taxPop" onclick="sE(event)"> </div><div class="newpopup p15 w190 whiteBg hide" style="top: 128px; display: block; left: 963px;" id="grandTaxPop" onclick="sE(event)"> </div>'},createNewProductForm:function(e){var t=document.createElement("div");t.id="searchCreateDiv",t.setAttribute("style","position: absolute; width:660px; display:none; z-index:31"),e.appendChild(t),t.innerHTML='<input type="hidden" id="invNewProductForm" value="true"> '},showpop:function(){var e,t,i="",a=!1,s=$("#multipleFieldsEditPop");if(Crm.userDetails.isLookupAdvancedSearchEnabledInLineItem){s.is(":visible")&&(a=!0,i=(e=$("#multipleFieldsEditPop #duringTabs").find("li.sel").attr("id").split("_")[0])+"_",t=$("#multipleFieldsEditPop #"+e+"_rlContainer"));var r=a?t.find("#linesTbody"):$("#linesTbody"),o=r.find("tr");if(200==o.length)return void Crm.showAlertMsg(I18n.getMsg("crm.lineitem.exceeds.alert","Line Items"));var n=r.find("#hrow1").find("input.ui-autocomplete-input").data();n.rowNumber=o.length+1,n.TAX_MIGRATION_COMPLETED=Crm.userDetails.TAX_MIGRATION_COMPLETED,n.autoPopulateTax=productDetails.autoPopulateTax;var l=Handlebars.templates.productDetailsRow(n);r.append(l);var d=r.find("#hrow"+n.rowNumber);d.addClass("hide"),a?t.find("#totalProductCount").val(o.length+1):$("#totalProductCount").val(o.length+1),$(".icon_close").removeClass("hide");var c=$(r.find("input.ui-autocomplete-input")[n.rowNumber-1]);c.length>0&&!c.data().readonly&&(crmLookupAutoComplete.initAutoCompletePlugin(c,"createPageLookup"),c.click((function(){$(this).autocomplete("search")}))),loadClassFns1(a,e),loadClassFns2(a),loadClassFns3(void 0,a),d.find(".productLookup").click()}else{s.is(":visible")&&(s.css("z-index","31"),s.find(".bPPopupFreezLayer").show());var u=$("#Crm_PurchaseOrders"+i+"_VENDORID");linesInPop=0,linesInPopInBp={},a&&(linesInPopInBp.relId=0);var m=a?parseInt($("#"+e+"_rlContainer #totalProductCount")[0].value)+1:parseInt(document.getElementById("totalProductCount").value)+1;if(m>200)return void alert(I18n.getMsg("crm.lineitem.exceeds.alert","Line Items"));if(1==m&&loadClassFns1(a,e),a?t.find("#addAnotherLine").addClass("vh"):$("#addAnotherLine").addClass("vh"),productDetails.addLineInPop(a,e),6!=$("#popup1").find("tr").length&&$(".addedRow").is(":hidden")||6==$("#popup1").find("tr").length&&0==$(".addedRow").is(":hidden")?(document.getElementById("addpbtn").style.opacity=1,showAnimatePopup("popup1"),$("#codein"+linesInPop).focus()):(a?t.find("#popup1").eq(0).css("display","block"):showAnimatePopup("popup1"),a?t.find("#codein"+linesInPopInBp.relId).focus():$("#codein"+linesInPop).focus()),"PurchaseOrders"==this.module){var p=$("#vendPrdsSpan");if(null!=p)if(u.length>0){var f=u.data().id;null==f||""==f?($(p).hide(),$("#vendPrds").prop("checked",!1)):($(p).show(),$("#vendPrds").prop("checked",!0))}else $(p).hide(),$("#vendPrds").prop("checked",!1)}else $("#vendPrdsSpan").remove();a&&t.scrollTo("#popup1")}},addLineInPop:function(e,t){var i;e?i=$("#multipleFieldsEditPop #"+t+"_rlContainer"):(e=$("#multipleFieldsEditPop").is(":visible"),(e=!1)&&(i=$("#multipleFieldsEditPop #duringTabDivs div.current")));var a=e?i.find("#addAnotherLine"):$("#addAnotherLine"),s=e?i.find("#prdDet"+linesInPopInBp.relId):document.getElementById("prdDet"+linesInPop);if(e&&s.length>0&&""==s.val())return i.find("#codein"+linesInPopInBp.relId).focus(),void i.find("#codein"+linesInPopInBp.relId).select();if(!e&&s&&(null==s.value||""==s.value))return $("#codein"+linesInPop).focus(),void $("#codein"+linesInPop).select();if((e?linesInPopInBp.relId:linesInPop)>200)alert(I18n.getMsg("crm.lineitem.exceeds.alert","Line Items"));else{var r,o;e?(r=2*linesInPopInBp.relId+1e4,linesInPopInBp.relId++,o=linesInPopInBp.relId):(r=2*linesInPop+1e4,linesInPop++,o=linesInPop);var n='<tr id="lineInPop'+o+'" class="" onmouseover="productDetails.popLineHover(this)" onmouseout="productDetails.popLineOut(this)"><td class="f15 pT15 pR" style="width: 345px;"> <input type="text" id="codein'+o+'" tabindex="'+(r+1)+'" class="cP popTxtBox newTextBx h20 dB" size="50" onclick="$(this).select()" placeholder="'+I18n.getMsg("crm.inventory.search.placeholder")+'">';n+='<span class="errMsg helper vh pA mT2" style="color: rgb(221, 0, 0); font-size:1.1rem; top: 100%;"> '+I18n.getMsg("crm.inventory.newline.codename.placeholder")+" </span> </td>",n+='<td class="aligncenter pT15 pR" valign="top" style="padding-right: 0px;"> <div class="aligncenter">  <input type="text" size="5" id="qtyin'+o+'" value="" tabindex="'+(r+2)+'" class="cP newTextBx popTxtBox h20 popQty decimalFld" onclick="$(this).select()");"> </div> <div style="width: 30%;" class="fL alignleft prodInfoIc">  <i class="icon_roundinfo mL10 mT6 hide cP" onmouseover="productDetails.showQtyInfo(this);" onmouseout="zctt.hidett();" style="visibility: hidden;"></i> </div> </td>',n+='<td valign="top" class="pT15 pR0" style="width: 56px;"> <div>',n+='<table><tr><td class="p0"><div id="removeProd_'+o+'" onclick="productDetails.deleteRowInPop('+o+', true)" class="fL"><span class=""></span></div></td>',n+='<td class="p0"><div class="iconAddItem fL" data-zcqa="addProductInc" id="addProd_'+o+'" onclick="productDetails.addLineInPop()"><span data-zcqa="addProductIncIcon"></span></div></td></tr></table>',n+='<input type="hidden" class="hdnPrdDet" id="prdDet'+o+'" name="prdDet'+o+'"> <input type="hidden" class="stkQty" id="stkQty'+o+'" name="stkQty'+o+'"> </td></tr>',e?i.find("#linesInPop").find("tr").last().before(n):$("#linesInPop").find("tr").last().before(n),a.attr("tabindex",r+3),e?i.find("#addPrdbtn").attr("tabindex",r+4):$("#addPrdbtn").attr("tabindex",r+4),e?i.find("#cancelAddPrdbtn").attr("tabindex",r+5):$("#cancelAddPrdbtn").attr("tabindex",r+5),searchStats.scrollEnd=!1,searchStats.fetchedAll=!1,searchStats.scrollPageIndex=1,searchStats.textBoxId="codein"+o,o>1&&($("#removeProd_1").addClass("iconRemoveItem"),$("#removeProd_"+o).addClass("iconRemoveItem"),$("#linesInPop").find(".iconAddItem").each((function(){var e=$(this).prop("id").split("_")[1];linesInPop!=e&&$(this).removeClass("iconAddItem")})));var l=e?i.find("#"+searchStats.textBoxId):$("#"+searchStats.textBoxId);$(l).autocomplete({source:function(e,t){var i=$(l).data("ui-autocomplete").menu.element;if($(i).scrollTop(0),commonUtils.showHideLoadingDiv(!0),searchStats.searchText=e.term.trim(),searchStats.searchText.length<3)0==searchStats.searchText.length?$(l).parent().parent().find(".hdnPrdDet").val(""):setTimeout((function(){$(l).parent().find(".helper").addClass("vh");var e=productDetails.searchForProducts(searchStats.searchText,!1,0);t(e)}),500);else{$(l).parent().find(".helper").addClass("vh");var a=productDetails.searchForProducts(searchStats.searchText,!1,0);t(a)}commonUtils.showHideLoadingDiv()},minLength:0,appendTo:e?"#multipleFieldsEditPop #"+t+"_rlContainer #invLinesAutoComplete":"body",delay:500,search:function(e,t){$(l).val().length<3&&$(l).autocomplete("close")},open:function(){$(this).autocomplete("widget").css({width:316,height:"auto","max-height":250,overflow:"auto","z-index":1e3}).addClass("addlineitemNew")},select:function(e,t){productDetails.debugVar+=" lineInFocus obj in autocomplete select ----\x3e "+searchStats.lineInFocus+" ;;; ",productDetails.debugVar+=" lineInFocus id in autocomplete select ----\x3e "+$(searchStats.lineInFocus).attr("id")+" ;;; ","001"!=t.item.id?($(this).val($("<div/>").html($ESAPI.encoder().encodeForHTML(t.item.value)).text()),e.preventDefault(),$(this).parent().parent().find(".popQty").focus(),productDetails.getProductDetails(t.item.id,this),$(this).parent().parent().find(".icon_roundinfo").removeClass("hide"),$(this).next().addClass("ui-helper-hidden-accessible"),$(l).parent().find(".helper").remove(),a.removeClass("vh")):(t.item.value=null,productDetails.requestNewProductForm(),(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains("Products"))&&Crm.downloadValidationRules(Crm.getCrmBasePath()+"/QuickCreateAction.do?module=Products","Products"))}}).on("focus",(function(){searchStats.scrollPageIndex=1,$(this).autocomplete("search")})).data("ui-autocomplete");var d=$(l).data("ui-autocomplete");d._renderMenu=function(e,t){searchStats.scrollPageIndex=1,searchStats.scrollEnd=!1,$(e).off("scroll"),productScroll._scrollMenu(e,t,d)},d._renderItem=function(e,t){return"001"!=t.id?$("<li>").data("ui-autocomplete-item",t).attr("data-value",t.value).attr("data-zcqa","product_"+t.value).attr("class","ui-menu-item").mouseenter((function(){$(this).find(".icon_roundinfo").removeClass("vh")})).mouseleave((function(){$(this).find(".icon_roundinfo").addClass("vh")})).append('<a class="ui-corner-all"><span class="productNameLengthExtend wB dIB oH">'+$ESAPI.encoder().encodeForHTML(t.value)+"</span><i class=\"icon_roundinfo cP fR vh\"onmouseover=\" $(this).removeClass('vh'); productDetails.showBCDetails(this, '"+t.id+"');\" onmouseout=\"$('#prdBCTip').remove(); zctt.hidett();\"></i> </a>").appendTo(e):$("<li>").data("ui-autocomplete-item",t).attr("data-value",t.value).attr("data-zcqa","product_newItem").attr("class","ui-menu-item").append('<a class="ui-corner-all">'+$ESAPI.encoder().encodeForHTML(t.value)+"</a>").appendTo(e)},$(l).focus((function(){productDetails.debugVar+=" lineInFocus obj before changing in codein.focus ----\x3e "+searchStats.lineInFocus+" ;;; ",productDetails.debugVar+=" lineInFocus id before changing in codein.focus ----\x3e "+$(searchStats.lineInFocus).attr("id")+" ;;; ",searchStats.lineInFocus=l,productDetails.debugVar+=" lineInFocus obj after changing in codein.focus ----\x3e "+searchStats.lineInFocus+" ;;; ",productDetails.debugVar+=" lineInFocus id after saving in codein.focus ----\x3e "+$(searchStats.lineInFocus).attr("id")+" ;;; ",searchStats.scrollEnd=!1,searchStats.textBoxId!=$(l).attr("id")&&(searchStats.fetchedAll=!1),searchStats.textBoxId=$(l).attr("id");var e=$(this).data("ui-autocomplete");e&&e.menu.element.scrollTop(0)})),loadClassFns3(),$(l).focus()}},showBCDetails:function(e,t){var i,a=productDetails.prdIdVsDetailsMap[t],s=a.LAYOUTID,r='<i class="invSetDDPopupAbG leftA r8"><i class="invSetDDPopupA"></i></i> </div> <table>',o=productDetails.bcCols.length;productDetails.layoutVsBCfieldDetails&&(o=(i=productDetails.layoutVsBCfieldDetails[s]).length);for(var n=0;n<o;n++){var l=productDetails.bcCols[n],d=productDetails.fieldsInBC[n],c=productDetails.bcUiTypes[n];if(i){var u=i[n];l=u.columnname,d=u.fieldlabel,c=u.uitype}var m=a[l];if("LAYOUTID"===l&&(m=productDetails.layoutIdVsLayoutName[m]),null==m||null==m?m="-":m.length>50&&(m=m.substring(0,45)+"..."),96===c||"96"===c){var p=m;for(var f in m="",p)m=m+f+";";-1!=m.indexOf(";")&&(m=m.substring(0,m.lastIndexOf(";")))}if("object"==typeof m&&!Array.isArray(m)){var v=[];for(var f in m)v.push(f+":"+m[f]);m=v.join(" ,")}r+="<tr> <td> "+$ESAPI.encoder().encodeForHTML(d)+" </td> <td> </td> <td> </td> <td> "+m+" </td> </tr> "}r+="</table>";var g=document.createElement("div"),h=$(e),C=h.offset().top,w=h.offset().left;g.setAttribute("class","tooltipzcdefault"),g.setAttribute("id","prdBCTip"),g.style.display="block",g.style.position="absolute",g.style.zIndex="100",document.body.appendChild(g),$(g).append(r),$(g).show().css({left:w+45,top:C-80}),$("#prdBCArrow").css({top:C-50})},requestNewProductForm:function(){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{$("#FreezeLayer");var e=$("#layoutdetails");productDetails.debugVar+=" lineInFocus obj in requestNewProductForm ----\x3e "+searchStats.lineInFocus+" ;;; ",productDetails.debugVar+=" lineInFocus id in requestNewProductForm ----\x3e "+$(searchStats.lineInFocus).attr("id")+" ;;; ";var t=Crm.getCrmBasePath()+"/QuickCreateAction.do?module=Products&frmInvLineItem=true";t=Crm.getPortalURL(t),null!=e.val()&&(t=t+"&layoutId="+e.val());var i=getHTTPObject();i.open("POST",t,!1);i.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),i.onreadystatechange=function(){if(4==i.readyState){if(i.status==crmConstants.errorStatusCode){return renderingUtils.displayPermissionDenied(i,(function(){$L("crux-permission-denied-alert")[0].component.setMethods({onAccept:function(){var e=$("#FreezeLayer");productDetails.showProductPopFromFreeze(),e.css({"z-index":1550,opacity:.9})}})})),void productDetails.cancelNewProduct(!0)}var e=i.responseText;$("#searchCreatePopup").html(e),showAnimatePopup("searchCreatePopup",(function(){setTimeout((function(){var e=$(document.getElementsByName("property(Product Name)"));e.val(searchStats.searchText),e.select()}),600)}));!1}},i.send("")}},searchForProducts:function(e,t,i){var a=[],s="",r=$("#Crm_PurchaseOrders_VENDORID"),o=$("#vendPrds").prop("checked");if(e=e.trim(),searchStats.previousSearchTerm==e&&!t&&searchStats.previousVendorStatus==o)return searchStats.previousSearchResults;searchStats.previousSearchTerm!=e?(searchStats.isFull=!1,searchStats.previousSearchResults=[]):t||(searchStats.previousSearchResults=[]),searchStats.previousSearchTerm=e,searchStats.previousVendorStatus=o;var n=Crm.getCrmBasePath()+"/autocomplete.do?searchtext="+encodeURIComponent(e)+"&entity=items&newlineitem=true";if(n=Crm.getPortalURL(n),null!=i&&null!=i&&(n+="&offset="+i),o&&r.length>0){var l=r.data().id;null!=l&&(n+="&vendorId="+l)}if(e.length>=1){var d=0,c=getHTTPObject();c.open("POST",n,!1),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),c.onreadystatechange=function(){if(4==c.readyState){var e=c.responseText;if(""!=e){var t=(s=JSON.parse(e))[1];if(""==productDetails.prdIdVsDetailsMap&&(productDetails.prdIdVsDetailsMap=t),productDetails.layoutIdVsLayoutName=s[2],s[3])for(var i,r=(i=s[3]).length,o=0;o<r;o++){var n=t[v=i[o]],l=(m=n.PRODUCTNAME)+"  ("+n.PRODUCTCODE+")";n.PRODUCTCODE||(l=m),a[d]={id:v,value:l},searchStats.previousSearchResults.push(a[d]),productDetails.prdIdVsDetailsMap[v]=t[v],d++}else if(null!=(i=s[0]))for(var u in i){var m=i[u],p=u.lastIndexOf(";;;;"),f=[u.substring(0,p),u.substring(p+4)],v=f[1];l=m+"  ("+f[0]+")";null!=f[0]&&""!=f[0]||(l=m),a[d]={id:v,value:l},searchStats.previousSearchResults.push(a[d]),productDetails.prdIdVsDetailsMap[v]=t[v],d++}}}a.length<50&&(searchStats.isFull=!0,!Crm.userDetails.permissions.Crm_Implied_Create_Products||0!=searchStats.previousSearchResults.length&&"001"==searchStats.previousSearchResults[searchStats.previousSearchResults.length-1].id||(a[d]={id:"001",value:"+ "+I18n.getMsg("crm.inventory.add.new.product")},searchStats.previousSearchResults.push(a[d])))},c.send("")}return a},getProductDetails:function(e,t){var i=$(t).parent().parent().find(".hdnPrdDet"),a=productDetails.prdIdVsDetailsMap[e];a=JSON.stringify(a),$(i).val(a),a=JSON.parse(a),$(t).parent().parent().find(".stkQty").val(a.QUANTITY_IN_STOCK)},showQtyInfo:function(e){var t=$(e).parent().parent().parent().find(".hdnPrdDet").val(),i=null!=(t=JSON.parse(t)).QUANTITY_IN_DEMAND?t.QUANTITY_IN_DEMAND:t["Qty in Demand"],a=null!=t.QUANTITY_IN_STOCK?t.QUANTITY_IN_STOCK:t["Qty in Stock"],s=null!=t.QUANTITY?t.QUANTITY:t["Qty Ordered"];null==i&&(i=""),null==a&&(a=""),null==s&&(s=""),zctt.showtt("<table> <tr> <td> "+I18n.getMsg("Qty in Stock")+" </td> <td> "+a+" </td> </tr> <tr> <td> "+I18n.getMsg("Qty in Demand")+" </td> <td> "+i+" </td> </tr> <tr> <td> "+I18n.getMsg("Qty Ordered")+" </td> <td> "+s+" </td> </tr>")},deleteRowInPop:function(e,t,i,a){var s=null;i&&(s=$("#multipleFieldsEditPop #duringTabDivs div.current")),i?s.find("#lineInPop"+e).remove():$("#lineInPop"+e).remove();var r=i?linesInPopInBp.relId:linesInPop;if(1==r&&1==e&&productDetails.closepop(),t&&e!=r)for(var o=e+1;o<=r;o++){var n=$("#removeProd_"+o);i?s.find("#codein"+o).attr("id","codein"+(o-1)):$("#codein"+o).attr("id","codein"+(o-1)),i?s.find("#descin"+o).attr("id","descin"+(o-1)):$("#descin"+o).attr("id","descin"+(o-1)),i?s.find("#qtyin"+o).attr("id","qtyin"+(o-1)):$("#qtyin"+o).attr("id","qtyin"+(o-1)),i?s.find("#prdDet"+o).attr("name","prdDet"+(o-1)):$("#prdDet"+o).attr("name","prdDet"+(o-1)),i?s.find("#prdDet"+o).attr("id","prdDet"+(o-1)):$("#prdDet"+o).attr("id","prdDet"+(o-1)),n.attr({onclick:"productDetails.deleteRowInPop("+(o-1)+", true)",id:"removeProd_"+(o-1)}),$("#addProd_"+o).attr("id","addProd_"+(o-1)),i?s.find("#lineInPop"+o).attr("id","lineInPop"+(o-1)):$("#lineInPop"+o).attr("id","lineInPop"+(o-1))}e==linesInPop&&e>1&&$("#addProd_"+(e-1)).addClass("iconAddItem");i?linesInPopInBp.relId--:linesInPop--,1===linesInPop&&$("#removeProd_1").removeClass("iconRemoveItem")},validatePopLines:function(e,t){for(var i=!0,a=e?linesInPopInBp.relId:linesInPop,s=1;s<=a;s++){var r=getObj("codein"+s);if(null!=r.value&&""!=r.value){var o=getObj("qtyin"+s);null!=o.value&&""!=o.value||$(o).val(1);var n=$("#prdDet"+s).val();null!=n&&""!=n||(i&&(alert(I18n.getMsg("crm.inventory.alert.invalid.product")),$(r).focus()),i=!1)}else{if(1==s)return $("#codein"+s).focus(),!1;$(r).parent().parent().remove(),a--}}return e?linesInPopInBp.relId=a:linesInPop=a,i},closepop:function(){var e=null,t=!1,i=$("#multipleFieldsEditPop");if(i.is(":visible")){t=!1,e=$("#multipleFieldsEditPop #duringTabDivs div.current"),relId=e.attr("id").split("_")[0];var a=$("#addLinesBtnLwr").offset().top}for(var s=t?linesInPopInBp.relId:linesInPop,r=1;r<=s;r++){var o=t?e.find("#lineInPop"+r)[0]:getObj("lineInPop"+r);$(o).remove()}linesInPop=0,t&&(linesInPopInBp.relId=0),hideAnimatePopup("popup1"),t&&window.scrollTo(0,a),i.is(":visible")?(i.css("z-index",""),i.find(".bPPopupFreezLayer").hide()):removeFreezeLayer(),searchStats.lineInFocus=null},addSave:function(e){e&&(linesInPop=1);var t,i=$("#multipleFieldsEditPop"),a=!1;i.is(":visible")&&$("#multipleFieldsEditPop #duringTabDivs div.current");var s=$("#totalProductCount"),r=parseInt(s.val()),o=$("#productList"),n=$("#linesTable");n.offset().top;if(e||productDetails.validatePopLines(a,t)){for(var l=r+linesInPop,d=r+1,c=1;d<=l;d++,c++)productDetails.addARow(d,a,t),productDetails.setValuesForAddedRow(d,c,e,a),productDetails.deleteRowInPop(c,!1,a,t);n.parent().parent().show(),o.find(".pB20").show(),o.find(".pB20").find(".wrap").show(),s.val(l),$("#popup1").hide(),$("#addLinesBtnLwr").hide(),$(".lnk_inv_whatsnew").parent().show(),n.show();var u=$("#hdnSinglePbId").val(),m=$("#singlePbTable");null==u||""==u?m.hide():(m.children(0).children(0).find(".PriceBooks-Small").hide(),m.children(0).children(0).find(".clear_lookupfield").hide()),loadClassFns2(a),loadClassFns3(a),i.is(":visible")?(i.css("z-index",""),i.find(".bPPopupFreezLayer").hide(),hideFreezeLayer()):hideAnimatePopup("popup1"),searchStats.lineInFocus=null}},addARow:function(e,t,i){var a="<tr id='hrow"+e+"' class='pl_"+e+" cTax sort helperBG' onmouseover='productDetails.invLineHover(this)' onmouseout='productDetails.invLineOut(this)'>";a+='<td> <input type="hidden" id="hdnProductId'+e+'" name="property(hdnProductId'+e+")\"> <div class='cP' onmouseover='productDetails.showPrdDetInEdit("+e+")' onmouseout='zctt.hidett()'> <h3 id='txtProductSpan"+e+"' class=\"dI f15 bold\"> </h3> <span id='txtProductCodeSpan"+e+"' class='color7 isBpCheck'>  </span> <input type='hidden' id='hdnProductCode"+e+"' name='property(hdnProductCode"+e+')\'> </div> <input type="hidden" id="hdnInvRelId'+e+'" name="property(hdnInvRelId'+e+")\"> <input type='hidden' id='txtProduct"+e+"' name='property(hdnProductName"+e+")'> <textarea id='itemDescription"+e+"' name='property(itemDescription"+e+')\' cols="45" rows="3" maxlength="32000" class="itemDescription resizeNone" style="margin-top:5px;margin-left:-5px; padding:3px 5px; border:1px solid #efefef !important;border-radius: 3px !important" onmouseover="$(this).attr(\'placeholder\',\''+I18n.getMsg("PrdDescription")+"')\" onmouseout=\"$(this).attr('placeholder','')\"> </textarea></td>",a+='<td class="f13 alignleft" onmouseover=\'productDetails.showCellIcon(this,undefined,true)\' onmouseout=\'productDetails.hideCellIcon(this)\'> <div style="width:90%" class="fL alignright">  <input type="text" class="cP alignright textFieldEdit textInLineItem decimalFld pT3 pB3 f13 invValidate" size="20" onmouseover="$(this).addClass(\'grayBg\')" style="width:100%; margin-top:-4px; box-shadow: none;" onmouseout="$(this).removeClass(\'grayBg\')" onclick="$(this).select()" id=\'txtListPrice'+e+"' data-label=\"List Price\" name='property(txtListPrice"+e+")' onblur='productDetails.calculateForLine("+e+", true)'> <input type='hidden' id='hdnPriceBookId"+e+"' name='property(hdnPriceBookId"+e+")'> <input type='hidden' id='hdnPriceBookIdClone"+e+"' name='property(hdnPriceBookIdClone"+e+")'> <input type='hidden' id='hdnPriceBookName"+e+"' name='property(hdnPriceBookName"+e+')\'> </div> <div style="width:10%" class="fL alignleft">  <i class="icon_list pointer lineicon vh pR" id="pbIcon'+e+'" title="'+I18n.getMsg("PriceBookNameLookUp")+'" onclick="Crm.showLookUp(\''+productDetails.module+"','property(txtListPrice"+e+")','hdnPriceBookId"+e+"','Product Details','PriceBooks','','','property(hdnProductId"+e+")')\" style=\"visibility: hidden;\"></i> <input type='hidden' id='hdnUnitPrice"+e+"' name='property(hdnUnitPrice"+e+")'> </div> </td>",a+='<td class="f13 alignright"> <input type="text" id=\'txtQty'+e+"' name='property(txtQty"+e+")' onblur='productDetails.calculateForLine("+e+', true)\' class="cP alignright textFieldEdit textInLineItem decimalFld mL10 pT3 pB3 f13 invValidate" size="10" onmouseover="$(this).addClass(\'grayBg\');" onmouseout="$(this).removeClass(\'grayBg\')" onclick="$(this).select()" style="margin-top:-4px; box-shadow: none;"> <input type=\'hidden\' id=\'hdnOldQty'+e+"' name='property(hdnOldQty"+e+")'> <input type='hidden' id='hdnQtyStock"+e+"' name='property(hdnQtyStock"+e+")'> </td>",a+='<td class="f13 alignright"> <span class="amntFP"> </span> <input type="hidden" id="total'+e+'" name="property(hdnTotal'+e+')"> </td>',a+='<td class="f13 alignright" onmouseover=\'productDetails.showCellIcon(this,undefined,false)\' onmouseout=\'productDetails.hideCellIcon(this)\'> <span style="width:75%" class="alignright"> <span class="discVal" onmouseover="productDetails.showDiscForLine(this)" style=\'cursor:pointer\' onmouseout="zctt.hidett()">  </span> <input type="hidden" id="totalAfterDiscount'+e+'" name="property(hdnTotalAfterDiscount'+e+')" class="getAftrDisc"> <input type="hidden" class="discAmt" id="discount'+e+'" name="property(hdnDiscount'+e+')"> <input type="hidden" class="discPc" id="discPc'+e+'" name="property(hdnDiscPc'+e+')" value="0"> </span> <i class="neweditIcon dIB vam mL5 vh lineicon pointer" onclick="productDetails.showDiscountPop(this);sE(event)" style="visibility: hidden;"></i> </td>',a+="<td class=\"f13 alignright\" onmouseover='productDetails.showCellIcon(this,undefined,false)' onmouseout='productDetails.hideCellIcon(this)'> <span class=\"taxClickelement\" id='inlineValueContainer"+e+'\'> <span class="taxval" onmouseover="productDetails.showTaxForLine(this)" style=\'cursor:pointer\' onmouseout="zctt.hidett()">  </span> <input type="hidden" id="tax'+e+'" name="property(hdnTax'+e+')"> <input type="hidden" id="prdTaxDet'+e+'" name="property(hdnPrdTaxDet'+e+')" class="prdTaxDet"> <input type="hidden" id="prdAllTax'+e+'" class="prdAllTax"> </span> <div style="width:22px" class="alignright dIB">',!0===Crm.userDetails.TAX_MIGRATION_COMPLETED?a+='<i class="neweditIcon lineicon mL5 dIB vam vh pointer" onclick="productDetails.editLineItemTax(this,'+e+');sE(event)" style="visibility: hidden;" id=\'taxInlineEditIcon'+e+"'></i> </div> </td>":a+='<i class="neweditIcon lineicon mL5 dIB vam vh pointer" onclick="productDetails.showtaxPop(this);sE(event)" style="visibility: hidden;"></i> </div> </td>',a+='<td class="f13 alignright"> <span class="netTot">  </span> <input type="hidden" id="netTotal'+e+'" name="property(hdnNetTotal'+e+')" class="eachTotVal"> </td>',a+='<td class="alignright"> <i class="icon_close pointer" onclick="productDetails.deleteARow(this)" style="visibility: hidden;"></i></td> <td class="alignright"style="cursor:move;"><i class="icon_reorder dragdrop"></i> <input type="hidden" class="isTaxable" id="isTaxable'+e+'"> </td>',a+="</tr>",$("#multipleFieldsEditPop").is(":visible")&&(actContainer=$("#multipleFieldsEditPop #"+i+"_rlContainer")),t?actContainer.find("#linesTbody").append(a):$("#linesTbody").append(a),t?actContainer.find("#hdnPriceBookId"+e).data("colname","BOOKID"):$("#hdnPriceBookId"+e).data("colname","BOOKID")},setValuesForAddedRow:function(e,t,i,a){var s=null;a&&(s=$("#multipleFieldsEditPop #duringTabDivs div.current")),null==i&&(i=a?s.find("#prdDet"+t).val():$("#prdDet"+t).val());var r=i;try{i=JSON.parse(i)}catch(e){i=r}var o="<div/>";(a?s.find("#hdnProductId"+e):$("#hdnProductId"+e)).val(validationUtils.isUndefined(i,"PRODUCTID")?validationUtils.isUndefined(i,"seId")?i.SEID:i.seId:i.PRODUCTID);var n=null!=i.PRODUCTNAME?i.PRODUCTNAME:i["Product Name"],l=a?s.find("#txtProductSpan"+e):$("#txtProductSpan"+e),d=$(o).html($ESAPI.encoder().encodeForHTML(n)).text();l.text(d),(a?s.find("#txtProduct"+e):$("#txtProduct"+e)).val(d);var c=null!=i.PRODUCTCODE?i.PRODUCTCODE:null!=i["Product Code"]?i["Product Code"]:"";(a?s.find("#txtProductCodeSpan"+e):$("#txtProductCodeSpan"+e)).text(""==c?"":"("+$(o).html(c).text()+")"),(a?s.find("#hdnProductCode"+e):$("#hdnProductCode"+e)).val(null!=i.PRODUCTCODE?i.PRODUCTCODE:i["Product Code"]);var u=a?s.find("#itemDescription"+e):$("#itemDescription"+e),m=null==i.DESCRIPTION?i.Description:i.DESCRIPTION;u.val($(o).html(m).text());var p=parseFloat(null!=i.UNITPRICE?i.UNITPRICE:i["Unit Price"]);isNaN(p)&&(p=0);var f=$("#Crm_"+productDetails.module+"_CURRENCYISOCODE").val(),v=Crm.userDetails.BASE_CURRENCY,g=1;null!=f&&null!=v&&f!=v&&null!=Crm.userDetails.CURRENCY_DETAILS[f]&&null!=Crm.userDetails.CURRENCY_DETAILS[v]&&(g=Crm.userDetails.CURRENCY_DETAILS[f]?Crm.userDetails.CURRENCY_DETAILS[f].er:Crm.userDetails.CURRENCY_DETAILS[v].er),p*=g,p=productDetails.getRoundOffValue(p,!0),a?s.find("#txtListPrice"+e).val(p):$("#txtListPrice"+e).val(p),a?s.find("#hdnUnitPrice"+e).val(p):$("#hdnUnitPrice"+e).val(p);var h=void 0,C=a?s.find("#qtyin"+t):$("#qtyin"+t);h=0===C.length?parseFloat(i.QUANTITY):parseFloat(C.val()),a?s.find("#txtQty"+e).val(h):$("#txtQty"+e).val(h),a?s.find("#hdnOldQty"+e).val(h):$("#hdnOldQty"+e).val(h);var w=void 0,b=a?s.find("#stkQty"+t):$("#stkQty"+t);w=0===b.length?i.QUANTITY_IN_STOCK:b.val(),a?s.find("#hdnQtyStock"+e).val(w):$("#hdnQtyStock"+e).val(w);var T=p*h;T=productDetails.getRoundOffValue(T,!0);var I=a?s.find("#total"+e):$("#total"+e);I.val(T),I.parent().find(".amntFP").text(T);var y=a?s.find("#discount"+e):$("#discount"+e);y.val(0),y.parent().find(".discVal").text(0);var P=T-0;P=productDetails.getRoundOffValue(P,!0);a?s.find("#totalAfterDiscount"+e).val(P):$("#totalAfterDiscount"+e).val(P);var _=i.TAX;_||(_={});var D=[];!productDetails.autoPopulateTax&&Crm.userDetails.TAX_MIGRATION_COMPLETED||!_||(D=Object.keys(_));var O=0,S=i.ISTAXABLE;a?s.find("#isTaxable"+e).val(S):$("#isTaxable"+e).val(S);var L="",E={};for(var x in 0==S||"false"==S?(S=!1,_={}):S=!0,_){var F;if(Crm.userDetails.TAX_MIGRATION_COMPLETED?(F=_[x][1],E[x]=_[x][0]):F=_[x],D.contains(x)){var V=P*parseFloat(F)/100;O+=V,L+=x+"==="+F+":::"+V+";;;"}}var A=a?s.find("#prdTaxDet"+e):$("#prdTaxDet"+e);A.val(L),A.data("serviceIdVsName",E);var k=a?s.find("#prdAllTax"+e):$("#prdAllTax"+e);k.val(JSON.stringify(_)),k.data("sortedTaxNames",i.hdnPrdSortedTaxs),O=productDetails.getRoundOffValue(O,!0);var N=a?s.find("#tax"+e):$("#tax"+e);N.val(O),N.parent().find(".taxval").text(O);var M=parseFloat(P)+parseFloat(O);M=productDetails.getRoundOffValue(M,!0);var R=a?s.find("#netTotal"+e):$("#netTotal"+e);R.val(M),R.parent().find(".netTot").text(M),Crm.userDetails.hideProductLineItemsSummary||productDetails.calculateGrandTotal(e,a)},getTaxDisplayName:function(e,t){return t=isNaN(t)?"0.0":-1==(t+"").indexOf(".")?t?(t+"").trim()+".0":"0.0":(t+"").trim(),parseFloat(t)<0?e.trim()+" - ("+t+" %)":e.trim()+" - "+t+" %"},isTaxDisplayName:function(e){return e&&e.indexOf("%")>-1&&e.indexOf("-")>-1},getTaxTypeAndValue:function(e){var t=[],i=e.lastIndexOf("-"),a=e.substring(i);return-1!=a.indexOf("%)")?(e=e.substring(0,e.lastIndexOf("-")),t[0]=e.substring(0,e.lastIndexOf("-")-1),t[1]=a.substring(0,a.indexOf("%")).trim()):(t[0]=e.substring(0,i).trim(),t[1]=e.substring(i+1,e.lastIndexOf("%")).trim()),t},setValuesForAddedRowNew:function(e,t,i){var a=null;$("#hrow"+e).removeClass("hide"),i&&(a=$("#multipleFieldsEditPop #duringTabDivs div.current"));var s=t;try{t=JSON.parse(t)}catch(e){t=s}(i?a.find("#hdnProductId"+e):$("#hdnProductId"+e)).val(t.id),(i?a.find("#txtProductSpan"+e):$("#txtProductSpan"+e)).text(t.Product_Name),(i?a.find("#txtProduct"+e):$("#txtProduct"+e)).val(t.Product_Name);var r=null!=t.Product_Code?t.Product_Code:"";(i?a.find("#txtProductCodeSpan"+e):$("#txtProductCodeSpan"+e)).text(""==r?"":"("+r+")"),(i?a.find("#hdnProductCode"+e):$("#hdnProductCode"+e)).val(r),(i?a.find("#itemDescription"+e):$("#itemDescription"+e)).val(t.Description);var o=parseFloat(t.Unit_Price);isNaN(o)&&(o=0),(i?a.find("#pbIcon"+e):$("#pbIcon"+e)).attr("style","visibility:hidden");var n=$("#Crm_"+productDetails.module+"_CURRENCYISOCODE").val(),l=Crm.userDetails.BASE_CURRENCY,d=1;null!=n&&null!=l&&n!=l&&null!=Crm.userDetails.CURRENCY_DETAILS[n]&&null!=Crm.userDetails.CURRENCY_DETAILS[l]&&(d=Crm.userDetails.CURRENCY_DETAILS[n]?Crm.userDetails.CURRENCY_DETAILS[n].er:Crm.userDetails.CURRENCY_DETAILS[l].er),o*=d,o=productDetails.getRoundOffValue(o,!0),i?a.find("#txtListPrice"+e).val(o):$("#txtListPrice"+e).val(o),i?a.find("#hdnUnitPrice"+e).val(o):$("#hdnUnitPrice"+e).val(o);var c=parseFloat(1);i?a.find("#txtQty"+e).val(c):$("#txtQty"+e).val(c),i?a.find("#hdnOldQty"+e).val(c):$("#hdnOldQty"+e).val(c);var u=t.Qty_in_Stock;i?a.find("#hdnQtyStock"+e).val(u):$("#hdnQtyStock"+e).val(u);var m=o*c;m=productDetails.getRoundOffValue(m,!0);var p=i?a.find("#total"+e):$("#total"+e);p.val(m),p.parent().find(".amntFP").text(m);var f=i?a.find("#discount"+e):$("#discount"+e);f.val(0),f.parent().find(".discVal").text(0);var v=m-0;v=productDetails.getRoundOffValue(v,!0);var g=t.TaxDetails;g||(g={});var h=0,C=t.Taxable;i?a.find("#isTaxable"+e).val(C):$("#isTaxable"+e).val(C);var w="",b=g?Object.keys(g):[],T=productDetails.autoPopulateTax||!Crm.userDetails.TAX_MIGRATION_COMPLETED?b:[];0==C||"false"==C?(C=!1,g={}):C=!0;var I={};for(var y in g){var P;if(Crm.userDetails.TAX_MIGRATION_COMPLETED?(P=g[y][1],I[y]=g[y][0]):P=g[y],T.contains(y)){var _=v*parseFloat(P)/100;h+=_,w+=y+"==="+P+":::"+_+";;;"}}var D=i?a.find("#prdTaxDet"+e):$("#prdTaxDet"+e);D.val(w),D.data("serviceIdVsName",I);var O=i?a.find("#prdAllTax"+e):$("#prdAllTax"+e);O.val(JSON.stringify(g)),O.data("sortedTaxNames",t.Tax?t.Tax:[]),h=productDetails.getRoundOffValue(h,!0);var S=i?a.find("#tax"+e):$("#tax"+e);S.val(h),S.parent().find(".taxval").text(h);var L=parseFloat(v)+parseFloat(h);L=productDetails.getRoundOffValue(L,!0);var E=i?a.find("#netTotal"+e):$("#netTotal"+e);E.val(L),E.parent().find(".netTot").text(L),Crm.userDetails.hideProductLineItemsSummary||productDetails.calculateGrandTotal(e,i)},isListPriceEmpty:function(){for(var e=1;e<500;e++){var t=$("#txtListPrice"+e);if(!(t.length>0))return!1;if(""==t.val().trim())return!0}return!1},calculateForLine:function(e,t,i){$("#multipleFieldsEditPop").is(":visible")&&$("#multipleFieldsEditPop #duringTabDivs div.current");var a=$("#txtListPrice"+e).val(),s=$("#txtQty"+e).val();(isNaN(s)||""==s)&&(s=1,$("#txtQty"+e).val(s)),$("#hdnOldQty"+e).val(s),(isNaN(a)||""==a)&&(a=0);var r=parseFloat(s)*parseFloat(a);r=productDetails.getRoundOffValue(r,!0),$("#total"+e).val(r),$("#total"+e).parent().find(".amntFP").text(r);var o=$("#hdnPriceBookId"+e).val(),n=0,l=r;if(1==t)if("fromPb"==productDetails.discStatus&&null!=o&&""!=o&&null!=a&&""!=a&&null!=s&&""!=s){var d=Crm.getCrmBasePath()+"/CreateInventory.do?action=getReductionPrice&quantity="+s+"&listPrice="+a+"&bookId="+o+"&isload=true";new crmRequestPool;mR(d,(function(t){if(null!=t){if(-1!=t.toString().indexOf("PRICEBOOK_NOT_ACCESSIBLE"))return void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"));a=productDetails.getRoundOffValue(t,!1),n=r-a,n=productDetails.getRoundOffValue(n,!0),$("#discount"+e).val(n),$("#discount"+e).parent().find(".discVal").text(n);var a=r-n;a=productDetails.getRoundOffValue(a,!0),$("#totalAfterDiscount"+e).val(a);var s=0,o="";if(null!=(m=$("#prdTaxDet"+e).val())&&""!=m)for(var l=m.split(";;;"),d=l.length-1,c=0;c<d;c++){var u=l[c],m=u.split("===")[1],p=parseFloat(m.split(":::")[0]),f=a*p/100;s+=f,o+=u.split("===")[0]+"==="+p+":::"+f+";;;"}s=productDetails.getRoundOffValue(s,!0),$("#prdTaxDet"+e).val(o),$("#tax"+e).val(s),$("#tax"+e).parent().find(".taxval").text(s);var v=parseFloat(a)+parseFloat(s);i&&(v=a),v=productDetails.getRoundOffValue(v,!0),$("#netTotal"+e).val(v),$("#netTotal"+e).parent().find(".netTot").text(v),Crm.userDetails.hideProductLineItemsSummary||productDetails.calculateGrandTotal()}}))}else if("percent"==productDetails.discStatus||"fromPb"==productDetails.discStatus&&(null==o||""==o)){var c=productDetails.getRoundOffValue($("#discPc"+e).val(),!0);n=r*c/100}else"dirPrice"==productDetails.discStatus&&(n=$("#discount"+e).val());else n=$("#discount"+e).val();if("fromPb"!=productDetails.discStatus||null==t||"fromPb"==productDetails.discStatus&&(null==o||""==o)){n=productDetails.getRoundOffValue(n,!0),$("#discount"+e).val(n),$("#discount"+e).parent().find(".discVal").text(n);l=r-n;l=productDetails.getRoundOffValue(l,!0),$("#totalAfterDiscount"+e).val(l);var u=0,m="";if(null!=(h=$("#prdTaxDet"+e).val())&&""!=h)for(var p=h.split(";;;"),f=p.length-1,v=0;v<f;v++){var g=p[v],h=g.split("===")[1],C=parseFloat(h.split(":::")[0]),w=l*C/100;u+=w,m+=g.split("===")[0]+"==="+C+":::"+w+";;;"}u=productDetails.getRoundOffValue(u,!0),$("#prdTaxDet"+e).val(m),$("#tax"+e).val(u),$("#tax"+e).parent().find(".taxval").text(u);var b=parseFloat(l)+parseFloat(u);i&&(b=l),b=productDetails.getRoundOffValue(b,!0),$("#netTotal"+e).val(b),$("#netTotal"+e).parent().find(".netTot").text(b),Crm.userDetails.hideProductLineItemsSummary||productDetails.calculateGrandTotal()}},fillCurrSymForGrandVals:function(){var e=productDetails.currencySymbol,t=$("#subTotal"),i=$("#grandTotal"),a=$("#txtDiscount"),s=$("#txtTax"),r=$("#txtAdjustment");t.parent().find(".grandVals").text(e+" "+t.val()),i.parent().find(".grandVals").text(e+" "+i.val()),a.parent().parent().find(".grandVals").text(e+" "+a.val()),s.parent().parent().find(".grandVals").text(e+" "+s.val()),r.parent().parent().find(".grandVals").text(e+" "+r.val())},calculateGrandTotal:function(e,t){var i=null;(t=!t&&$("#multipleFieldsEditPop").is(":visible"))&&(i=$("#multipleFieldsEditPop #duringTabDivs div.current"));var a=t?i.find("#txtDiscount"):$("#txtDiscount");null==e&&(e=t?i.find("#totalProductCount").val():$("#totalProductCount").val());for(var s=0,r=1;r<=e;r++)s+=parseFloat(t?i.find("#netTotal"+r).val():$("#netTotal"+r).val());var o,n=parseFloat(t?i.find("#discPc").val():$("#discPc").val());o=0!=(n=productDetails.getRoundOffValue(n,!0))?s*n/100:parseFloat(a.val());var l=0,d=(t?i.find("#recordTaxDet").val():$("#recordTaxDet").val()).split(";;;"),c=d.length-1;for(r=0;r<c;r++){var u=d[r].split("===")[1],m=(s-o)*parseFloat(u.split(":::")[0])/100;l+=parseFloat(productDetails.getRoundOffValue(m,!0))}var p=parseFloat(t?i.find("#txtAdjustment").val():$("#txtAdjustment").val());(isNaN(p)||""==p)&&(p=0),l=productDetails.getRoundOffValue(l,!0);var f=s-o+parseFloat(l)+p;s=productDetails.getRoundOffValue(s,!0),o=productDetails.getRoundOffValue(o,!0),f=productDetails.getRoundOffValue(f,!0);var v=t?i.find("#subTotal"):$("#subTotal");v.val(s).trigger("change"),v.parent().find(".grandVals").text(productDetails.currencySymbol+" "+s),a.val(o).trigger("change"),a.parent().find(".grandVals").text(productDetails.currencySymbol+" "+o);var g=t?i.find("#txtTax"):$("#txtTax");g.val(l).trigger("change"),g.parent().find(".grandVals").text(productDetails.currencySymbol+" "+l);var h=t?i.find("#grandTotal"):$("#grandTotal");h.val(f).trigger("change"),h.parent().find(".grandVals").text(productDetails.currencySymbol+" "+f)},showDiscForLine:function(e,t){if(t){var i=Crm.userDetails.isLineItemSubformMvmtDone?$(e).closest("tr").find("#subvalue_TOTALAFTERDISCOUNT").text().trim():$(e).parent().find(".getAftrDisc").text();i=void 0!==i&&i.length>0?i:parseFloat("0.00"),$("#pbDiscInfo").is(":visible")||zctt.showtt(I18n.getMsg("TotalAfterDiscount")+" : "+productDetails.currencySymbol+" "+i)}else zctt.showtt(I18n.getMsg("TotalAfterDiscount")+" : "+productDetails.currencySymbol+" "+$(e).parent().find(".getAftrDisc").val())},showTaxForLine:function(e){var t=$(e).parent().find(".prdTaxDet"),i=t.val(),a=t.data().serviceIdVsName,s="<table>",r=0;if(null!=i&&""!=i){var o=i.split(";;;");r=o.length-1;for(var n=0;n<r;n++){var l=o[n],d=(i=l.split("===")[1],l.split("===")[0]),c=i.split(":::")[0];!0===Crm.userDetails.TAX_MIGRATION_COMPLETED?s+="<tr><td> "+productDetails.getTaxDisplayName(a[d],c)+" </td></tr>":s+="<tr> <td> "+d+" </td> <td> : </td> <td> &nbsp; "+c+"% </td></tr>"}}0===r&&(s+="<tr> <td>"+I18n.getMsg("crm.tax.association.check")+"</td> </tr>"),s+="</table>",zctt.showtt(s)},getRoundOffValue:function(e,t,i){if(void 0!==i){var a=Math.pow(10,i),s=Math.sign(parseFloat(e)*a)*Math.round(Math.abs((parseFloat(e)*a).toFixed(i)));return t?(s/a).toFixed(i):s/a}s=Math.sign(parseFloat(e)*productDetails.roundOffPrecision)*Math.round(Math.abs((parseFloat(e)*productDetails.roundOffPrecision).toFixed(productDetails.roundOff)));return t?(s/productDetails.roundOffPrecision).toFixed(productDetails.roundOff):s/productDetails.roundOffPrecision},calcDisc:function(e,t){var i=0,a=parseFloat($("#total"+t).val());if($(e).attr("class").indexOf("discPc")<0){i=$(e).val(),(isNaN(i)||""==i)&&(i=0);var s=0;s=productDetails.getRoundOffValue(s,!0),$(e).parent().parent().parent().parent().find(".discPc").val(s)}else{(s=$(e).val())||(s=0),i=a*s/100,i=productDetails.getRoundOffValue(i,!0),$(e).parent().parent().parent().parent().find(".directPrice").val(i),$("#discPc"+t).val(s)}$("#discount"+t).val(i),productDetails.calculateForLine(t)},calcTax:function(e){for(var t=$("#taxPop").find(".taxRow"),i=0,a="",s=t.length,r=0;r<s;r++){var o=t[r],n=$(o).children()[0],l=$(n).text(),d=$(o).find(".editTax").val();(isNaN(d)||""==d)&&(d=0),d=parseFloat(d);var c=parseFloat($(o).find(".taxVal").val());i+=c,a+=l+"==="+d+":::"+c+";;;"}i=productDetails.getRoundOffValue(i,!0),$("#tax"+e).val(i),$("#prdTaxDet"+e).val(a),productDetails.calculateForLine(e),$("#editRowTaxPop").hide()},showGrandDiscPop:function(e){var t=$("#discountPop"),i=$(e),a=$("#multipleFieldsEditPop").is(":visible"),s=a?i.position().left:i.offset().left,r=a?i.position().top:i.offset().top,o=i.innerHeight();event.stopPropagation();var n=parseFloat($("#txtDiscount").val()),l=parseFloat($("#subTotal").val()),d=0;0!=l&&(d=productDetails.getRoundOffValue(n/l*100,!0));var c=t.find(".discPc"),u=t.innerWidth(),m=$(c);m.val(d);var p=t.find(".directPrice");$(p).val(n),$("#taxesPop").find("div").hide(),t.removeClass("hide");var f=$("#frmBook");f.parent().hide(),t.show().css({left:s-u/2,top:r+o+10});var v=t.find(".roundCheck");v.filter(":visible").last().parent().parent().removeClass("bdrBot"),Crm.userDetails.TAX_MIGRATION_COMPLETED?($("#saveDiscountType").off("click").on("click",(function(){var e=$("#discountPop");"percent"===$("#inventrydiscountPop:checked").val()?productDetails.calcGrandDisc($(e.find(".discPc"))):productDetails.calcGrandDisc($(e.find(".directPrice"))),e.hide()})),$("#cancelDiscountType").off("click").on("click",(function(){$("#discountPop").hide()}))):(m.off("keyup"),m.keyup((function(){productDetails.calcGrandDisc(this)})),$(p).off("keyup"),$(p).keyup((function(){productDetails.calcGrandDisc(this)})),f.find(".roundCheck").click((function(){$("#txtQty"+id).focus()}))),$(".discType").click((function(){var e=$(this).parent(),t=e.find(".decimalFld");e.parent().parent().find(".decimalFld").parent().css("visibility","hidden"),t.parent().css("visibility","visible"),t.focus()})),$(".noEventDiv").click((function(){var e=$(this),t=e.parent(),i=t.find(".decimalFld");e.find(".discType").prop("checked",!0),t.parent().parent().find(".decimalFld").parent().css("visibility","hidden"),i.parent().css("visibility","visible"),i.focus()})),v.first().trigger("click")},calcGrandDisc:function(e){var t=$(e),i=0,a=0,s=parseFloat($("#subTotal").val());t.attr("class").indexOf("discPc")<0?((i=t.val())||(i=0),a=100*(i=productDetails.getRoundOffValue(i,!0))/s,a=productDetails.getRoundOffValue(a,!0),$("#discPc").val(0),t.parent().parent().parent().parent().find(".discPc").val(a)):((a=t.val())||(a=0),$("#discPc").val(a),i=s*a/100,i=productDetails.getRoundOffValue(i,!0),t.parent().parent().parent().parent().find(".directPrice").val(i)),$("#txtDiscount").val(i),Crm.userDetails.hideProductLineItemsSummary||productDetails.calculateGrandTotal()},showGrandTaxPop:function(e){var t=$("#grandTaxPop"),i=$("#subTotal"),a=$("#txtDiscount");event.stopPropagation();var s=$(e),r=$("#multipleFieldsEditPop").is(":visible"),o=r?s.position().left:s.offset().left,n=r?s.position().top:s.offset().top,l=s.innerHeight(),d=t.outerWidth(),c=parseFloat(i.val())-parseFloat(a.val()),u="<div>";if(null==(T=$("#recordTaxDet").val())||""==T||"create"==window[productDetails.module].currentStatus&&!productDetails.grandTaxChanged){if(null!=(T=JSON.parse(productDetails.newAllTaxes)))for(var m=objectUtils.getKeys(T),p=m.length-1,f=0;f<=p;f++){b=(C=T[b=m[f]])[0];var v=c*(C=C[1])/100;u+='<div class="taxRow"> <p class="f12 bold color1 taxName"> '+$ESAPI.encoder().encodeForHTML(b)+' </p> <div class="pT10 pB10 bdrBot mB10"><input type="text" size="5" class="newinputText1 decimalFld editTax alignright" value="'+$ESAPI.encoder().encodeForHTMLAttribute(C)+'"> <b class="pL5">%</b> <input type="text" class="newinputText1 mL10 taxVal alignright decimalFld" readonly="true" size="5" value="'+v+'"> <label class="pL5"> </label></div> </div>'}}else{var g=T.split(";;;"),h=g.length-1;for(f=0;f<h;f++){var C,w=g[f],b=w.split("===")[0],T=w.split("===")[1],I=c*(C=parseFloat(T.split(":::")[0]))/100;u+='<div class="taxRow"> <p class="f12 bold color1 taxName"> '+$ESAPI.encoder().encodeForHTML(b)+' </p> <div class="pT10 pB10 bdrBot mB10"><input type="text" size="5" class="newinputText1 decimalFld editTax alignright" value="'+C+'"> <b class="pL5">%</b> <input type="text" class="newinputText1 mL10 taxVal alignright decimalFld" readonly="true" size="5" value="'+I+'"> <label class="pL5"> </label></div> </div>'}}u+='<input type="button" onclick="productDetails.calcGrandTax()" class="primarybtn" value="'+I18n.getMsg("crm.button.apply")+'"> </div>',t.children().remove(),t.append(u),$("#discountPop").hide(),t.removeClass("hide"),t.show().css({left:o-70-d/2,top:n+l+10}),$(".editTax").keyup((function(){var e=$(this).val();(isNaN(e)||""==e)&&(e=0);var t=e/100*(parseFloat(i.val())-parseFloat(a.val())),s=$(this).parent().find(".taxVal");t=productDetails.getRoundOffValue(t,!0),$(s).val(t)}))},editGrandTax:function(e){productDetails.serviceIdVsPercent&&delete productDetails.serviceIdVsPercent;var t=$("#grandTaxPop"),i=t.outerWidth(),a=$(e),s=a.innerHeight(),r=$("#multipleFieldsEditPop").is(":visible")?a.position():a.offset(),o=r.left-70,n=r.top;$("#discountPop").hide(),$("#taxPop").empty().hide(),event.stopPropagation();var l=[],d=[],c={},u=0,m=parseFloat($("#subTotal").val())-parseFloat($("#txtDiscount").val()),p=$("#recordTaxDet").val(),f='<div class="selectTaxdiv"><div class="f20 crm-font-bold mB10">'+I18n.getMsg("crm.tax.select")+"</div>";if(p)for(var v=p.split(";;;"),g=v.length-1,h=0;h<g;h++){u++;var C=(D=v[h]).split("==="),w=C[0],b=C[0];productDetails.isTaxDisplayName(b)?b=productDetails.getTaxTypeAndValue(b)[0]:(b=productDetails.taxIdVsName[b][0],l.push(w));var T=C[1].split(":::")[0],I=productDetails.isTaxDisplayName(C[0])?C[0]:productDetails.getTaxDisplayName(b,T);d.push(I.toLowerCase());var y=m*(T=parseFloat(T))/100;y=productDetails.getRoundOffValue(y,!0),f+=productDetails.constructTaxRow(!0,b.trim(),T+"",y,-1,u,"grand",w),null==c[w]&&(c[w]=T)}var P=productDetails.sortedOrgTax?productDetails.sortedOrgTax.length:0,_=JSON.parse(productDetails.newAllTaxes);for(h=0;h<P;h++){var D,O=_[D=productDetails.sortedOrgTax[h]];l.contains(O[2])||(d.contains(D.toLowerCase())||(u++,d.push(D.toLowerCase()),f+=productDetails.constructTaxRow(!1,O[0],O[1],void 0,-1,u,"grand",D),null==c[D]&&(c[D]=parseFloat(O[1]))))}f+='<div class="selectTaxbtnSec mT10"><input type="button" onclick="productDetails.saveGrandTax()" class="primarybtn btn_sml" value="'+I18n.getMsg("crm.button.done")+'"> <input class="newgraybtn btn_sml" type="button" onclick="productDetails.cancelGrandTax()" value="'+I18n.getMsg("crm.button.cancel")+'"/></div></div>',t.html(f).removeClass("hide").show().css({left:o-i/2,top:n+s+10}),$(".taxActiveElement").removeClass("taxActiveElement"),$("#grandTaxDispSpan").addClass("taxActiveElement"),loadClassFns3(),productDetails.canEditTaxValue||productDetails.bindMouseOverActionForRestrictTaxEdit(),productDetails.serviceIdVsPercent=c},saveGrandTax:function(){event.stopPropagation();var e=!1,t=$("input.grandTax:checked"),i="",a=t.length;$(".taxValError").addClass("dN");for(var s=0;s<a;s++){var r=$(t[s]),o=r.val().trim(),n=$("#grandTaxVal"+r.attr("id")).text().trim();if(n=productDetails.getTaxPercentString(n),isNaN(n)||n>100||n<-100)$("#grandTaxValError"+r.attr("id")).removeClass("dN"),e=!0;else if(!e){if(null==productDetails.serviceIdVsPercent[o]||!productDetails.canEditTaxValue&&productDetails.serviceIdVsPercent[o]!=parseFloat(n))continue;i+=o+"==="+n+";;;"}}if(e)return!1;$("#recordTaxDet").val(i),productDetails.grandTaxChanged=!0,Crm.userDetails.hideProductLineItemsSummary||productDetails.calculateGrandTotal(),productDetails.cancelGrandTax()},cancelGrandTax:function(){event.stopPropagation(),$("#grandTaxPop").empty().hide(),productDetails.serviceIdVsPercent&&delete productDetails.serviceIdVsPercent,$("#grandTaxDispSpan").removeClass("taxActiveElement")},getTaxPercentString:function(e){return isNaN(e)||(-1==(e+"").indexOf(".")?e+=".0":0==(e+"").indexOf(".")&&(e="0"+e)),e},calcGrandTax:function(){for(var e=$("#grandTaxPop"),t=e.find(".editTax"),i="",a=t.length,s=0;s<a;s++){var r=t[s],o=$(r).val();(isNaN(o)||""==o)&&(o=0),i+=$(r).parent().parent().find(".taxName").text()+"==="+o+":::"+$(r).parent().find(".taxVal").val()+";;;"}$("#recordTaxDet").val(i),e.hide(),productDetails.grandTaxChanged=!0,Crm.userDetails.hideProductLineItemsSummary||productDetails.calculateGrandTotal()},findMissingIndex:function(){var e=$("#multipleFieldsEditPop").is(":visible"),t=null;e&&(t=$("#multipleFieldsEditPop #duringTabDivs div.current"));var i=e?t.find("#linesTbody"):$("#linesTbody"),a=e?t.find("#totalProductCount"):$("#totalProductCount");if(a&&$(a).val()>0)for(var s=$(a).val(),r=1;r<=s;r++){if(0==i.find("#hrow"+r).length)return r}},rowIndexIssueWorkAround:function(){var e=$("#multipleFieldsEditPop").is(":visible"),t=null;e&&(t=$("#multipleFieldsEditPop #duringTabDivs div.current"));var i=e?t.find("#linesTbody"):$("#linesTbody"),a=productDetails.findMissingIndex();if(a){for(var s=e?t.find("#totalProductCount"):$("#totalProductCount"),r=parseInt(s.val()),o=a+1;o<=r;o++){var n=i.find("#hrow"+o);productDetails.reorderRow(n,o-1)}var l=r-1;s.val(l)}},deleteARow:function(e){var t=$("#totalProductCount"),i=$("#linesTbody");if(confirm(I18n.getMsg("crm.inventory.alert.delete.lineitem"))){var a=$(e).parent().parent(),s=$(a).attr("id");s=parseInt(s.split("hrow")[1]);var r=parseInt(t.val());if(s!=r)for(var o=s+1;o<=r;o++){var n=i.find("#hrow"+o);productDetails.reorderRow(n,o-1)}delete Crm.requestParam["property(hdnProductId"+s+")"],delete Crm.requestParam["property(hdnInvRelId"+s+")"],delete Crm.requestParam["property(hdnProductCode"+s+")"],delete Crm.requestParam["property(hdnProductName"+s+")"],delete Crm.requestParam["property(itemDescription"+s+")"],delete Crm.requestParam["property(txtListPrice"+s+")"],delete Crm.requestParam["property(hdnPriceBookId"+s+")"],delete Crm.requestParam["property(hdnUnitPrice"+s+")"],delete Crm.requestParam["property(txtQty"+s+")"],delete Crm.requestParam["property(hdnOldQty"+s+")"],delete Crm.requestParam["property(hdnQtyStock"+s+")"],delete Crm.requestParam["property(hdnTotal"+s+")"],delete Crm.requestParam["property(hdnTotalAfterDiscount"+s+")"],delete Crm.requestParam["property(hdnDiscount"+s+")"],delete Crm.requestParam["property(hdnTax"+s+")"],delete Crm.requestParam["property(hdnPrdTaxDet"+s+")"],delete Crm.requestParam["property(hdnNetTotal"+s+")"],$(e).parent().parent().remove();var l=r-1;t.val(l);var d=$("#singlePbTable");0==l&&($("#linesTable").parent().hide(),$("#productList").find(".pB20").hide(),d.show(),d.children(0).children(0).find(".PriceBooks-Small").show(),d.children(0).children(0).find(".clear_lookupfield").show(),$("#addLinesBtnLwr").show()),Crm.userDetails.isLookupAdvancedSearchEnabledInLineItem&&1===l&&$(".icon_close").addClass("hide"),Crm.userDetails.hideProductLineItemsSummary||productDetails.calculateGrandTotal()}},reorderRow:function(e,t){var i=$(e).children(),a=$(e).children()[0];if(Crm.userDetails.isLookupAdvancedSearchEnabledInLineItem&&e.length>0){var s=$(e),r=s.find("input.ui-autocomplete-input"),o=r.data(),n=o.rownumber;r.attr("id","Crm_"+o.module+"_"+o.colname+"_"+t),r.attr("data-zcqa","lookup_"+o.colname+"_"+t),r.data("zcqa","lookup_"+o.colname+"_"+t),r.attr("data-rownumber",t),r.data("rownumber",t);var l=s.find("#hdnProductId"+n);l.attr("id","hdnProductId"+t),l.attr("name","property(hdnProductId"+t+")");var d=s.find("#hdnProductCode"+n);d.attr("id","hdnProductCode"+t),d.attr("name","property(hdnProductCode"+t+")");var c=s.find("#hdnInvRelId"+n);c.attr("id","hdnInvRelId"+t),c.attr("name","property(hdnInvRelId"+t+")");var u=s.find("#txtProduct"+n);u.attr("id","txtProduct"+t),u.attr("name","property(hdnProductName"+t+")");var m=s.find(".Products-small");m.attr("id","Crm_"+o.module+"_"+o.colname+"_"+t+"_img"),m.attr("data-label","Crm_"+o.module+"_"+o.colname+"_"+t),m.data("label","Crm_"+o.module+"_"+o.colname+"_"+t),m.attr("data-zcqa","lookup_"+o.colname+"_"+t),m.data("zcqa","lookup_"+o.colname+"_"+t);var p=s.find(".clear_lookupfield");p.attr("id","Crm_"+o.module+"_"+o.colname+"_"+t+"_img"),p.attr("data-zcqa","lookup_"+o.colname+"_"+t+"_close"),p.data("zcqa","lookup_"+o.colname+"_"+t+"_close"),s.find(".lookuploader").attr("id","Crm_"+o.module+"_"+o.colname+"_"+t+"_loadimg");var f=s.find("#itemDescription"+n);f.attr("id","itemDescription"+t),f.attr("name","property(itemDescription"+t+")")}else{var v=$(a).children()[0];$(v).attr("name","property(hdnProductId"+t+")"),$(v).attr("id","hdnProductId"+t),v=$(a).find(".bold"),$(v).parent().attr("onmouseover","productDetails.showPrdDetInEdit("+t+")"),$(v).attr("id","txtProductSpan"+t),v=$(v).next(),$(v).attr("id","txtProductCodeSpan"+t),v=$(v).next(),$(v).attr("name","property(hdnProductCode"+t+")"),$(v).attr("id","hdnProductCode"+t),v=$(a).children()[2],$(v).attr("name","property(hdnInvRelId"+t+")"),$(v).attr("id","hdnInvRelId"+t),v=$(a).children()[3],$(v).attr("name","property(hdnProductName"+t+")"),$(v).attr("id","txtProduct"+t),v=$(a).children()[4],$(v).attr("name","property(itemDescription"+t+")"),$(v).attr("id","itemDescription"+t)}var g=$(e).children()[1];a=$(g).children()[0],v=$(a).children()[0],$(v).attr("name","property(txtListPrice"+t+")"),$(v).attr("onblur","productDetails.calculateForLine("+t+", true)"),$(v).attr("id","txtListPrice"+t),v=$(a).children()[1],$(v).attr("name","property(hdnPriceBookId"+t+")"),$(v).attr("id","hdnPriceBookId"+t),v=$(a).children()[2],$(v).attr("name","property(hdnPriceBookIdClone"+t+")"),$(v).attr("id","hdnPriceBookIdClone"+t),v=$(a).children()[3],$(v).attr("name","property(hdnPriceBookName"+t+")"),$(v).attr("id","hdnPriceBookName"+t),a=$(g).children()[1],v=$(a).children()[0],$(v).attr("onclick","Crm.showLookUp('"+productDetails.module+"','property(txtListPrice"+t+")','hdnPriceBookId"+t+"','Product Details','PriceBooks','','','property(hdnProductId"+t+")')"),$(v).attr("id","pbIcon"+t),v=$(a).children()[1],$(v).attr("name","property(hdnUnitPrice"+t+")"),$(v).attr("id","hdnUnitPrice"+t),a=$(e).children()[2],v=$(a).children()[0],$(v).attr("name","property(txtQty"+t+")"),$(v).attr("onblur","productDetails.calculateForLine("+t+", true)"),$(v).attr("id","txtQty"+t),v=$(a).children()[1],$(v).attr("name","property(hdnOldQty"+t+")"),$(v).attr("id","hdnOldQty"+t),v=$(a).children()[2],$(v).attr("name","property(hdnQtyStock"+t+")"),$(v).attr("id","hdnQtyStock"+t),a=$(e).children()[3],v=$(a).children()[1],$(v).attr("name","property(hdnTotal"+t+")"),$(v).attr("id","total"+t),a=$(e).children()[4];g=$(a).children()[0];v=$(g).children()[1],$(v).attr("name","property(hdnTotalAfterDiscount"+t+")"),$(v).attr("id","totalAfterDiscount"+t),v=$(g).children()[2],$(v).attr("name","property(hdnDiscount"+t+")"),$(v).attr("id","discount"+t),v=$(g).children()[3],$(v).attr("name","property(hdnDiscPc"+t+")"),$(v).attr("id","discPc"+t);var h=$(i[5]).children(),C=$(h[0]),w=C.children();v=w[1],$(C).attr("id","inlineValueContainer"+t),$(v).attr("name","property(hdnTax"+t+")"),$(v).attr("id","tax"+t),$(w[2]).attr({name:"property(hdnPrdTaxDet"+t+")",id:"prdTaxDet"+t}),$(w[3]).attr("id","prdAllTax"+t),Crm.userDetails.TAX_MIGRATION_COMPLETED&&$($(h[1]).children()[0]).attr({id:"taxInlineEditIcon"+t,onclick:"productDetails.editLineItemTax(this,"+t+");sE(event)"}),a=$(e).children()[6],v=$(a).children()[1],$(v).attr("name","property(hdnNetTotal"+t+")"),$(v).attr("id","netTotal"+t),a=$(e).children()[8],v=$(a).children()[1],$(v).attr("id","isTaxable"+t),$(e).attr("class","pl_"+t+" cTax sort helperBG"),$(e).attr("id","hrow"+t)},fillCurrencySymbolsInLineHeaders:function(e,t){var i,a=e?$("#multipleFieldsEditPop #"+t+"_rlContainer #lineHeaderRow"):$("#lineHeaderRow"),s=productDetails.currencySymbol,r=a.children()[1];(i=$(r).text()).indexOf("(")>-1&&(i=i.substring(0,i.indexOf("("))),$(r).html(i+' <span class="openSansNormal"> ('+s+") </span>"),r=a.children()[3],(i=$(r).text()).indexOf("(")>-1&&(i=i.substring(0,i.indexOf("("))),$(r).html(i+' <span class="openSansNormal"> ('+s+") </span>"),r=a.children()[4],(i=$(r).text()).indexOf("(")>-1&&(i=i.substring(0,i.indexOf("("))),$(r).html(i+' <span class="openSansNormal"> ('+s+") </span>"),r=a.children()[5],(i=$(r).text()).indexOf("(")>-1&&(i=i.substring(0,i.indexOf("("))),$(r).html(i+' <span class="openSansNormal"> ('+s+") </span>"),r=a.children()[6],(i=$(r).text()).indexOf("(")>-1&&(i=i.substring(0,i.indexOf("("))),$(r).html(i+' <span class="openSansNormal"> ('+s+") </span>")},fillCurrencySymbolInView:function(e){var t=$("#subvalue_CURRENCYISOCODE").text(),i="";if(null!=(i=null==t||""==t?e:Crm.userDetails.CURRENCY_DETAILS[t].symbol)&&"null"!=i){var a=$("#tablehead").children(),s=a[2];(r=$(s).text()).indexOf("(")>-1&&(r=r.substring(0,r.indexOf("("))),$(s).html(r+' <span class="openSansNormal"> ('+i+") </span> ");s=a[4];(r=$(s).text()).indexOf("(")>-1&&(r=r.substring(0,r.indexOf("("))),$(s).html(r+' <span class="openSansNormal"> ('+i+") </span> ");s=a[5];(r=$(s).text()).indexOf("(")>-1&&(r=r.substring(0,r.indexOf("("))),$(s).html(r+' <span class="openSansNormal"> ('+i+") </span> ");s=a[6];(r=$(s).text()).indexOf("(")>-1&&(r=r.substring(0,r.indexOf("("))),$(s).html(r+' <span class="openSansNormal"> ('+i+") </span> ");var r;s=a[7];(r=$(s).text()).indexOf("(")>-1&&(r=r.substring(0,r.indexOf("("))),$(s).html(r+' <span class="openSansNormal"> ('+i+") </span> ")}},saveNewProduct:function(e,t,i){productDetails.debugVar+=" lineInFocus obj in saveNewProduct ----\x3e "+searchStats.lineInFocus+" ;;; ",productDetails.debugVar+=" lineInFocus id in saveNewProduct ----\x3e "+$(searchStats.lineInFocus).attr("id")+" ;;; ",productDetails.debugVar+="Searched value ---\x3e "+searchStats.searchText+" ;;; ",productDetails.debugVar+="Value in text box before save product -----\x3e "+$(searchStats.lineInFocus).val()+" ;;; ";var a=$(".comboSelect");if(a.length>0)for(var s=a.length,r=0;r<s;r++){var o=a[r],n=$(o).val();if(null!=n){for(var l="",d=n.length,c=0;c<d;c++)l+=n[c],c!=n.length-1&&(l+=";");var u=$(o).next();"input"===u[0].tagName?u.val(l):u.next().val(l)}}var m=!0;try{m=formValidate("newQCProductForm",e,t,i,"inline")}catch(e){}m&&new Promise((function(e){e(CVRExec.evalRules("edit","Products"))})).then((function(e){if(e){var t=getObj("newQCProductForm"),i=t.action,a="";-1!=i.indexOf("?")&&(a=i.substring(i.indexOf("?")+1),i=i.substring(0,i.indexOf("?"))),a=(a=a+"&targetForm="+t.target+"&"+csrfParamName+"="+encodeURIComponent(csrfToken))+"&"+formData2QueryString(t);var s=getHTTPObject();s.open("POST",i,!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),s.onreadystatechange=function(){if(4==s.readyState){if(s.status==crmConstants.errorStatusCode)return void renderingUtils.displayPermissionDenied(s);var e=s.responseText,t=JSON.parse(e);if("DUPLICATE"===t.STATUS){Crm.hideDuplicateErrorMsg("newQCProductForm");for(var i=t.INFO.length,a=0;a<i;a++){var r=t.INFO[a],o=r.FIELDLABEL,n=r.MODULE,l=Crm.getDuplicateErrorMsg(r,!1),d=r.ISCF&&"1"==r.ISCF?r.COLUMNNAME:o,c=$("#property\\("+d+"\\)");c&&0!==c.length||(c=$("[name='property\\("+d+"\\)']"))&&0!==c.length||(c=$("#Crm_"+n+"_"+d)),Crm.showErrorMsg(l,c,n),c.focus()}return void commonUtils.showHideLoadingDiv()}if((t=t.newPrdDet).ISAPPROVED&&7==t.ISAPPROVED){Lyte.Component.render("crm-reviewprocess-reviewpop",{moduleName:t.module},"#tabLayer");var u=$L("#rpRecordInReview")[0];return u.ltProp("message",I18n.getMsg("crm.reviewprocess.record.entered.lookup.customview.msg",t.module)),u.ltProp("show",!0),hideAnimatePopup("searchCreatePopup"),void($L("#codein1")[0].value="")}var m=t["Product Name"],p=t["Product Code"],f=m+" ("+p+")";null!=p&&""!=p||(f=m);var v=$(searchStats.lineInFocus);productDetails.debugVar+="Value in text box just before changing it -----\x3e "+v.val()+" ;;; ",v.val(f),productDetails.debugVar+="Value in text box after changing -----\x3e "+v.val()+" ;;; ",v.attr("style","border : 1px solid #fff");var g=v.parent().parent();t=JSON.stringify(t),g.find(".hdnPrdDet").val(t),g.find(".icon_roundinfo").removeClass("hide"),$(searchStats.lineInFocus).next().addClass("ui-helper-hidden-accessible"),$(searchStats.lineInFocus).parent().find(".helper").remove(),$("#addAnotherLine").removeClass("vh"),productDetails.cancelNewProduct(!1)}},s.send(a)}}))},cancelNewProduct:function(e){$("#multipleFieldsEditPop").is(":visible");$("#productPopup").animate({left:"700px"}).show(),$("#addpbtn").show(),$("#cancelbtn").show(),$("#searchCreateDiv").hide().animate({left:"500px"}).html(""),hideAnimatePopup("searchCreatePopup"),showFreezeLayer(),$("#searchCreatePopup").html(""),$(searchStats.lineInFocus).parent().parent().find(".popQty").focus(),1==e&&($(searchStats.lineInFocus).val(""),$(searchStats.lineInFocus).focus())},showProductPopFromFreeze:function(){var e=$("#FreezeLayer");freezeBackground(),e.css("z-index",20),e.css("opacity","0.2"),$(searchStats.lineInFocus).val(""),$(searchStats.lineInFocus).parent().parent().find(".hdnPrdDet").val(""),$(searchStats.lineInFocus).focus()},showPrdDetInEdit:function(e){zctt.showtt('<table cellpadding="5" cellspacing="0" border="0" width="100%"> <tbody><tr><td class="f13">'+I18n.getMsg("Unit Price")+'</td> <td class="f13 bold">'+productDetails.currencySymbol+" "+$("#hdnUnitPrice"+e).val()+'</td></tr>  <tr><td class="f13">'+I18n.getMsg("Qty in Stock")+'</td><td class="f13 bold">'+$("#hdnQtyStock"+e).val()+"</td></tr></tbody></table>")},showPrdDetInView:function(e){zctt.showtt('<table cellpadding="5" cellspacing="0" border="0" width="100%"> <tbody><tr><td class="f13">'+I18n.getMsg("Unit Price")+'</td> <td  class="f13 bold">'+productDetails.currencySymbol+" "+$("#value_hdnUnitPrice"+e).text()+'</td></tr>  <tr><td class="f13">'+I18n.getMsg("Qty in Stock")+'</td><td class="f13 bold">'+$("#value_hdnQtyStock"+e).text()+"</td></tr></tbody></table>")},getParsedNumber:function(e){return isNaN(e.split(" ")[0])||(e=e.split(" ")[0]),-1!==(e=(e=e.replace(/,/g,"")).replace(" ","")).indexOf("(")&&-1!==e.indexOf(")")&&(e="-"+(e=e.replace(/[()]/g,"").trim())),Number(e)},showDiscountScheme:function(e,t){event.stopPropagation();var i=$("#pbDiscInfo"),a=$(e),s=a.position().left,r=a.position().top,o=a.closest("td");o.hasClass("rPsubFormTd")&&(s+=o.position().left,r+=o.position().top);var n,l=a.innerHeight(),d=i.hasClass("newDeialViewDiscPop"),c=i.innerWidth();if(d&&(r=a.closest(".subFrmTablWrapper").position().top+r-15),Crm.userDetails.isLineItemSubformMvmtDone){var u=a.closest("tr"),m=u.find(".mouseArea___BOOKID"),p=m.length>0?m.data("params").id:"";if(null==p)p=void 0!==(p=u.find("#subvalue_BOOKID").attr("data-params"))&&p.length>0?JSON.parse(p).id:"";else p=void 0!==p&&p.length>0?p:"";if(n=void 0!==(n=m.length>0?m.data("params").pricingDetails:"")?n.pricingRange:"",""===p||""===n){var f=u.find(".mouseArea___TOTALAFTERDISCOUNT").data("params").rawFormulaCurrency;f=parseFloat(void 0!==f&&f.length>0?f:"0");var v=u.find(".mouseArea___DISCOUNT").data("params").defaultvalue;if(v=parseFloat(void 0!==v&&v.length>0?v:"0"),0===(T=parseFloat(f)+parseFloat(v))||0===v){var g=!1;void 0!==t&&!0===Crm.isCpqActivated()&&("string"==typeof t&&t===moduleRecordMapping.Quotes.api_name||"string"!=typeof t&&void 0!==t.value&&t.value===moduleRecordMapping.Quotes.api_name)&&(g=!0),n=!0===g?I18n.getMsg("cpq.pr.nodiscount"):I18n.getMsg("crm.inventory.lineitem.no.pricebook.new",[moduleRecordMapping.PriceBooks.plural_label])}else{var h=parseFloat(T),C=0===h?0:100*parseFloat(v)/h;C=productDetails.getRoundOffValue(C,!0),n="<span class='dIB'>"+I18n.getMsg("Discount Percentage")+"</span> <span>"+C+"%</span>"}}}else{var w=$(e).parent().parent().parent().attr("id");w=w.split("hrow")[1],n=$("#value_pricingRange"+w).html();var b=$("#value_priceBookId"+w).html();if(null==b||""==b||" "==b||""==n||null==n){var T=$("#value_hdnTotal"+w).text();T=parseFloat(T.replace(/,| /g,""));var I=$("#value_hdnDiscount"+w).text();if(I=parseFloat(I.replace(/,| /g,"")),0==T||0==I){g=!1;void 0!==t&&!0===Crm.isCpqActivated()&&("string"==typeof t&&t===moduleRecordMapping.Quotes.api_name||"string"!=typeof t&&void 0!==t.value&&t.value===moduleRecordMapping.Quotes.api_name)&&(g=!0),n=!0===g?I18n.getMsg("cpq.pr.nodiscount"):I18n.getMsg("crm.inventory.lineitem.no.pricebook.new",[moduleRecordMapping.PriceBooks.plural_label])}else{C=100*parseFloat(I)/parseFloat(T);C=productDetails.getRoundOffValue(C,!0),n=I18n.getMsg("Discount Percentage")+" "+C+"%"}}}i.html(n),i.removeClass("hide"),i.css({left:s-c/2,top:r+l+10}).show(),zctt.hidett(!0)},showDiscountPop:function(e){event.stopPropagation();var t,i=$(e).position().left,a=$(e).position().top,s=$(e).offset().left,r=$(e).offset().top,o=$(e).innerHeight(),n=null,l=$("#multipleFieldsEditPop");(t=l.is(":visible"))&&(n=$("#multipleFieldsEditPop #duringTabDivs div.current"));var d=t?n.find("#discountPop"):$("#discountPop"),c=d.innerWidth(),u=t?n.find("#frmBook"):$("#frmBook"),m="#hdnPriceBookId",p=$(e).parent(),f=p.parent(),v=parseFloat(f.find(".discAmt").val()),g=parseFloat(f.find(".amntFP").text()),h=0;0!=g&&(h=productDetails.getRoundOffValue(v/g*100,!0));var C=d.find(".discPc"),w=$(C);w.val(h);var b=d.find(".directPrice"),T=$(b);T.val(v);var I=f.attr("id");I=I.split("hrow")[1];var y=t?n.find(m+I):$(m+I),P=!1,_=u.find(".roundCheck");if(null!=y.val()&&""!=y.val()){u.parent().show();var D=t?n.find("#hdnPriceBookId"+I):$("#hdnPriceBookId"+I);null!=D.val()&&""!=D.val()&&_.prop("checked",!0),u.parent().prev().addClass("bdrBot")}else u.parent().hide(),"dirPrice"==productDetails.discStatus?(d.find(".roundCheck").filter(":visible").last().prop("checked",!0),d.find(".roundCheck").filter(":visible").last().css("visibility","visible")):(d.find(".roundCheck").first().prop("checked",!0),d.find(".decimalFld").first().parent().css("visibility","visible")),P=!0;if(t)var O=i,S=a;else O=s,S=r;t?n.find("#taxPop").hide():$("#taxPop").hide(),d.removeClass("hide"),d.show().css({left:O-c/2,top:S+o+10}),$(e).closest("tr").find(".icon_list,.icon_roundNxtarw,.icon_close,.neweditIcon").css("visibility","hidden"),$(e).css("visibility","visible"),P&&u.parent().parent().find(".decimalFld").first().select(),d.find(".roundCheck").filter(":visible").last().parent().parent().removeClass("bdrBot"),Crm.userDetails.TAX_MIGRATION_COMPLETED?($("#saveDiscountType").off("click").on("click",(function(){var e=null,t=$("#multipleFieldsEditPop").is(":visible");t&&(e=$("#multipleFieldsEditPop #duringTabDivs div.current"));var i=t?e.find("#discountPop"):$("#discountPop"),a=$("#inventrydiscountPop:checked").val();"percent"===a?productDetails.calcDisc($(i.find(".discPc")),I):"dirPrice"===a?productDetails.calcDisc($(i.find(".directPrice")),I):(t?e.find("#hdnPriceBookId"+I).val(y.val()):$("#hdnPriceBookId"+I).val(y.val()),t?e.find("#txtQty"+I).focus():$("#txtQty"+I).focus()),i.hide()})),$("#cancelDiscountType").off("click").on("click",(function(){d.hide()}))):(w.off("keyup"),w.keyup((function(){productDetails.calcDisc(this,I)})),T.off("keyup"),T.keyup((function(){productDetails.calcDisc(this,I)})),_.click((function(){t?n.find("#hdnPriceBookId"+I).val(y.val()):$("#hdnPriceBookId"+I).val(y.val()),t?n.find("#txtQty"+I).focus():$("#txtQty"+I).focus()}))),(t?n.find(".discType"):$(".discType")).click((function(){productDetails.discStatus=$(this).val(),$(this).parent().parent().parent().find(".decimalFld").parent().css("visibility","hidden"),$(this).parent().find(".decimalFld").parent().css("visibility","visible"),$(this).parent().find(".decimalFld").select(),"fromPb"!=productDetails.discStatus?t?n.find("#hdnPriceBookId"+I).val(null):$("#hdnPriceBookId"+I).val(null):(t?n.find("#hdnPriceBookId"+I).val(y.val()):$("#hdnPriceBookId"+I).val(y.val()),t?n.find("#txtQty"+I).focus():$("#txtQty"+I).focus())})),(t?n.find(".noEventDiv"):$(".noEventDiv")).click((function(){$(this).find(".discType").prop("checked",!0),productDetails.discStatus=$(this).find(".discType").val(),$(this).parent().parent().parent().find(".decimalFld").parent().css("visibility","hidden"),$(this).parent().find(".decimalFld").parent().css("visibility","visible"),$(this).parent().find(".decimalFld").select(),"fromPb"!=productDetails.discStatus?(t?n.find("#hdnPriceBookId"+I).val(null):$("#hdnPriceBookId"+I).val(null),"percent"==productDetails.discStatus&&(t?n.find("#discPc"+I).val($(this).parent().find(".decimalFld").val()):$("#discPc"+I).val($(this).parent().find(".decimalFld").val()))):(t?n.find("#hdnPriceBookId"+I).val(y.val()):$("#hdnPriceBookId"+I).val(y.val()),t?n.find("#txtQty"+I).focus():$("#txtQty"+I).focus())})),$(".taxActiveElement").removeClass("taxActiveElement"),p.children("span.alignright").addClass("taxActiveElement")},showtaxPop:function(e){event.stopPropagation();var t=$(e),i=t.parent().parent(),a=t.offset(),s=t.position(),r=(a.left,a.top,s.left),o=s.top,n=i.find(".prdTaxDet").val(),l="<div>",d=t.innerHeight(),c=i.parent().attr("id");if(c=c.split("hrow")[1],n)for(var u=n.split(";;;"),m=u.length-1,p=0;p<m;p++){var f=u[p],v=(n=f.split("===")[1],f.split("===")[0]),g=n.split(":::")[0];h=n.split(":::")[1];var h=Number(h);h=productDetails.getRoundOffValue(h,!0),l+='<div class="taxRow"> <p class="f12 openSansNormal color1"> '+$ESAPI.encoder().encodeForHTML(v)+' </p> <div class="pT10 pB10 bdrBot mB10"><input type="text" size="5" class="newinputText1 editTax decimalFld alignright" value="'+$ESAPI.encoder().encodeForHTMLAttribute(g)+'"> <b class="arial pL5">%</b> <input type="text" class="newinputText1 decimalFld taxVal mL10 alignright" readonly="true" size="5" value="'+h+'"> <label class="pL5"> </label></div> </div>'}else l+=I18n.getMsg("crm.tax.association.check");l+="</div>";var C=$("#taxPop"),w=C.outerWidth();C.children().remove(),C.append(l),C.find(".taxRow").last().find(".bdrBot").removeClass("bdrBot");var b=r,T=o;$("#discountPop").hide(),C.removeClass("hide"),C.show().css({left:b-w/2,top:T+d+10}),t.closest("tr").find(".icon_list,.icon_roundNxtarw,.icon_close,.neweditIcon").css("visibility","hidden"),t.css("visibility","visible"),loadClassFns3(),$(".editTax").keyup((function(){var e=$(this),t=e.val();(isNaN(t)||""==t)&&(t=0);var i=t/100*parseFloat($("#totalAfterDiscount"+c).val());i=productDetails.getRoundOffValue(i,!0),e.parent().find(".taxVal").val(i),productDetails.calcTax(c)}))},bindMouseOverActionForRestrictTaxEdit:function(){$(".cantEditTax").on("mouseover",(function(){crmui.showTooltip(I18n.getMsg("crm.restrict.edit.tax.value.info"),!1,"center",$(this))})).on("mouseout",(function(){crmui.hideTooltip()}))},saveAddTaxInline:function(e){event.stopPropagation();var t="",i=0,a=parseFloat($("#totalAfterDiscount"+e).val()),s=(Math.pow(10,productDetails.roundOff),!1),r=$("input.inlineTax:checked"),o=r.length;$(".taxValError").addClass("dN");for(var n=0;n<o;n++){var l=$(r[n]),d=l.val().trim(),c=$("#inlineTaxVal"+l.attr("id")).text().trim();if(c=productDetails.getTaxPercentString(c),isNaN(c)||c>100||c<-100)$("#inlineTaxValError"+l.attr("id")).removeClass("dN"),s=!0;else if(!s){if(null==productDetails.serviceIdVsPercent[d]||!productDetails.canEditTaxValue&&productDetails.serviceIdVsPercent[d]!=parseFloat(c))continue;var u=parseFloat(c)/100*a;i+=u=productDetails.getRoundOffValue(u,!0),t+=d+"==="+c+";;;"}}if(s)return!1;$("#tax"+e).val(productDetails.getRoundOffValue(i,!0)),$("#prdTaxDet"+e).val(t),productDetails.calculateForLine(e),productDetails.cancelInlineTax()},cancelInlineTax:function(){$("#taxPop").empty().hide(),productDetails.serviceIdVsPercent&&delete productDetails.serviceIdVsPercent,$(".taxActiveElement").removeClass("taxActiveElement")},editLineItemTax:function(e,t){productDetails.serviceIdVsPercent&&delete productDetails.serviceIdVsPercent;var i=$(e),a=i.position(),s=a.left-70,r=a.top,o=i.innerHeight(),n=$("#taxPop"),l=n.outerWidth();$("#discountPop").hide(),$("#grandTaxPop").empty().hide(),event.stopPropagation();var d=$("#isTaxable"+t).val();"false"===d&&(d=!1);var c=$("#prdTaxDet"+t),u=c.data().serviceIdVsName,m=c.val(),p={},f=[],v=[],g=[],h="",C=$("#prdAllTax"+t),w=0;if(d&&(g=C.data().sortedTaxNames),m)for(var b=parseFloat($("#totalAfterDiscount"+t).val()),T=(Math.pow(10,productDetails.roundOff),m.split(";;;")),I=T.length-1,y=0;y<I;y++){w++;var P=T[y].split("==="),_=P[0],D=u[_],O=P[1].split(":::")[0],S=Number(b*O/100);S=productDetails.getRoundOffValue(S,!0),productDetails.isTaxDisplayName(_)?E=_:(E=productDetails.getTaxDisplayName(D,O),f.push(_)),v.push(E.toLowerCase()),h+=productDetails.constructTaxRow(!0,D.trim(),O+"",S,t,w,"inline",_),null==p[_]&&(p[_]=parseFloat(O))}if(g&&C.val()){var L=JSON.parse(C.val());for(I=g.length,y=0;y<I;y++){var E,x=g[y],F=L[x];D=F[0],O=F[1];if(productDetails.isTaxDisplayName(x))E=x;else{if(f.contains(x))continue;E=productDetails.getTaxDisplayName(D,O)}v.contains(E.toLowerCase())||(w++,h+=productDetails.constructTaxRow(!1,D.trim(),O+"",void 0,t,w,"inline",x),v.push(E.toLowerCase()),null==p[x]&&(p[x]=parseFloat(O)))}}var V='<div class="selectTaxdiv">';w>0?(V+='<div class="f20 crm-font-bold mB10">'+I18n.getMsg("crm.tax.select")+"</div>",V+=h,V+='<div class="selectTaxbtnSec mT10"><input class="primarybtn btn_sml" type="Button" onclick="productDetails.saveAddTaxInline('+t+')" value="'+I18n.getMsg("crm.button.done")+'"/><input class="newgraybtn btn_sml" type="Button" onclick="productDetails.cancelInlineTax()" value="'+I18n.getMsg("crm.button.cancel")+'"/></div>'):V+=I18n.getMsg("crm.tax.association.check"),V+="</div>",n.html(V),n.find(".taxRow").last().find(".bdrBot").removeClass("bdrBot"),n.removeClass("hide"),n.show().css({left:s-l/2,top:r+o+10}),i.closest("tr").find(".icon_list,.icon_roundNxtarw,.icon_close,.neweditIcon").css("visibility","hidden"),i.css("visibility","visible"),$(".taxActiveElement").removeClass("taxActiveElement"),$("#inlineValueContainer"+t).addClass("taxActiveElement"),loadClassFns3(),productDetails.canEditTaxValue||productDetails.bindMouseOverActionForRestrictTaxEdit(),productDetails.serviceIdVsPercent=p},addOrRemoveTax:function(e,t,i,a){if($(e).is(":checked")){var s=$("#"+t+"TaxVal"+a);productDetails.canEditTaxValue&&(s.attr({contenteditable:!0,onkeydown:"productDetails.checkMaxLength(event,this)",onkeyup:"productDetails.changeTaxValue(this,'"+t+"',"+i+","+a+")"}),$("#taxValContainer"+a).removeClass("taxPercentage_box_bg"));var r,o=s.text().trim();if((isNaN(o)||""==o)&&(o=0),"inline"===t)r=parseFloat($("#totalAfterDiscount"+i).val())*o/100;else r=(parseFloat($("#subTotal").val())-parseFloat($("#txtDiscount").val()))*o/100;r=productDetails.getRoundOffValue(r,!0),$("#"+t+"taxAmount"+a).val(r)}else productDetails.canEditTaxValue&&($("#"+t+"TaxVal"+a).removeAttr("onkeyup").removeAttr("onkeydown").removeAttr("contenteditable"),$("#taxValContainer"+a).addClass("taxPercentage_box_bg")),$("#"+t+"taxAmount"+a).val("-")},checkMaxLength:function(e,t){if(8!=e.which&&(e.which<37||e.which>40)){var i=$(t).text().trim();i&&(i.length>=5||"."===e.key&&i.indexOf(".")>-1)&&e.preventDefault()}},changeTaxValue:function(e,t,i,a){var s=$(e).text().trim();(isNaN(s)||""==s)&&(s=0);var r="0.0";"inline"===t?r=s/100*parseFloat($("#totalAfterDiscount"+i).val()):r=s/100*(parseFloat($("#subTotal").val())-parseFloat($("#txtDiscount").val()));r=productDetails.getRoundOffValue(r,!0),$("#"+t+"taxAmount"+a).val(r)},constructTaxRow:function(e,t,i,a,s,r,o,n){null==a&&(a="-"),n=$ESAPI.encoder().encodeForHTMLAttribute(n);var l='<div class="taxRow clearFix"> <label class="newCustomchkbox-md fL w130 mT3">',d=!1,c=productDetails.canEditTaxValue&&e?"":"taxPercentage_box_bg";return e?(d=!0,l+='<input type="checkbox" onclick="productDetails.addOrRemoveTax(this,\''+o+"',"+s+","+r+')" id="'+r+'" class="'+o+'Tax" checked value="'+n+'">'):l+='<input type="checkbox" onclick="productDetails.addOrRemoveTax(this,\''+o+"',"+s+","+r+')" id="'+r+'" class="'+o+'Tax" value="'+n+'">',l+='<span class="chkbxIcon vam mR10"></span><span class="ellipsistext w100 dIB vam">'+$ESAPI.encoder().encodeForHTML(t)+'</span> </label> <div class="fL clearFix"><div id="taxValContainer'+r+'" class="taxPercentage_box fL '+c+'">',productDetails.canEditTaxValue?l+='<div type="text" onkeydown="productDetails.checkMaxLength(event,this)" onkeyup="productDetails.changeTaxValue(this,\''+o+"',"+s+","+r+')" contenteditable="'+d+'" size="5" class="noBdr editTax decimalFld" value="'+i+'" id="'+o+"TaxVal"+r+'">'+i+"</div>":l+='<div type="text" size="5" class="noBdr cantEditTax editTax" value="'+i+'" id="'+o+"TaxVal"+r+'" readonly="true" style="cursor: not-allowed;">'+i+"</div>",l+='<b class="arial pL5">%</b></div> <input type="text" id="'+o+"taxAmount"+r+'" class="noBdr taxVal mL10 mT4 alignright fR w100" readonly="true" value="'+a+'">',l+='<label class="pL5"> </label></div> </div><div class="mB10"><span id="'+o+"TaxValError"+r+'" style="font-size:1.1rem;color: red;margin-left: 130px;" class="vat dN taxValError">'+I18n.getMsg("crm.field.valid.check",I18n.getMsg("crm.label.tax.value"))+"</span></div>"},invLineHover:function(e){$(e).find(".icon_close").css("visibility","visible"),$(e).find(".itemDescription").css({border:"1px solid #e2e9ef",resize:"vertical"}).attr("placeholder",I18n.getMsg("PrdDescription"))},invLineOut:function(e){$(e).find(".icon_close").css("visibility","hidden"),$(e).find(".itemDescription").css("border","1px solid #fff"),$(e).find(".itemDescription").attr("placeholder",""),$(e).find(".itemDescription").css("resize","none")},popLineHover:function(e){$(e).find(".icon_close, .icon_roundinfo").css("visibility","visible")},popLineOut:function(e){$(e).find(".icon_close, .icon_roundinfo").css("visibility","hidden")},showCellIcon:function(e,t,i){i&&productDetails.hideListPrice||(t?$(e).next().find(".lineicon").css("visibility","visible"):$(e).find(".lineicon").css("visibility","visible"))},hideCellIcon:function(e,t){t?$(e).next().find(".lineicon").css("visibility","hidden"):$(e).find(".lineicon").css("visibility","hidden")},setValuesForAddedRowForEdit:function(e,t,i,a,s){var r=null;i&&(r=$("#multipleFieldsEditPop #"+a.relListId+"_rlContainer"));Math.pow(10,productDetails.roundOff);if(e){var o=Crm.userDetails.isLookupAdvancedSearchEnabledInLineItem,n=e.totalProductCount;if(i?r.find("#totalProductCount").val(n):$("#totalProductCount").val(n),o){var l=e.fieldMeta;l.module=this.module;for(var d=i?r.find("#linesTbody"):$("#linesTbody"),c=2;c<=n;c++){l.rowNumber=c,l.TAX_MIGRATION_COMPLETED=Crm.userDetails.TAX_MIGRATION_COMPLETED,l.autoPopulateTax=productDetails.autoPopulateTax;var u=Handlebars.templates.productDetailsRow(l);d.append(u);var m=d.find("#Crm_"+this.module+"_PRODUCTDETAILS_"+c);m.length>0&&!m.data().readonly&&crmLookupAutoComplete.initAutoCompletePlugin(m,"createPageLookup")}d.find("input.ui-autocomplete-input").click((function(){$(this).autocomplete("search")})),n>1&&$(".icon_close").removeClass("hide"),d.find(".pbIcon").attr("style","visibility:hidden")}else for(c=1;c<=n;c++)productDetails.addARow(c,i,i?a.relListId:void 0);for(c=1;c<=n;c++){o&&(i?r.find("#Crm_"+this.module+"_PRODUCTDETAILS_"+c).val(e["hdnProductName"+c]):$("#Crm_"+this.module+"_PRODUCTDETAILS_"+c).val(e["hdnProductName"+c])),i?r.find("#hdnProductId"+c).val(e["hdnProductId"+c]):$("#hdnProductId"+c).val(e["hdnProductId"+c]),i?r.find("#hdnInvRelId"+c).val(e["hdnInvRelId"+c]):$("#hdnInvRelId"+c).val(e["hdnInvRelId"+c]),i?r.find("#txtProductSpan"+c).text(e["hdnProductName"+c]):$("#txtProductSpan"+c).text(e["hdnProductName"+c]),i?r.find("#txtProduct"+c).val(e["hdnProductName"+c]):$("#txtProduct"+c).val(e["hdnProductName"+c]),(i?r.find("#txtProductCodeSpan"+c):$("#txtProductCodeSpan"+c)).text(null==e["hdnProductCode"+c]?"":"("+e["hdnProductCode"+c]+")"),i?r.find("#hdnProductCode"+c).val(e["hdnProductCode"+c]):$("#hdnProductCode"+c).val(e["hdnProductCode"+c]),i?r.find("#itemDescription"+c).val(e["itemDescription"+c]):$("#itemDescription"+c).val(e["itemDescription"+c]);var p=parseFloat(e["txtListPrice"+c]);if(null!=p&&"NaN"!=p.toString()||(p=parseFloat(e["hdnUnitPrice"+c])),p.toString().indexOf(".")<0&&(p=productDetails.getRoundOffValue(p,!0)),i?r.find("#txtListPrice"+c).val(p):$("#txtListPrice"+c).val(p),null!=e["hdnUnitPrice"+c]&&!isNaN(e["hdnUnitPrice"+c])){var f=1,v=i?$("#Crm_"+productDetails.module+"_"+a.relListId+"_CURRENCYISOCODE").val():$("#Crm_"+productDetails.module+"_CURRENCYISOCODE").val(),g=Crm.userDetails.BASE_CURRENCY;null!=v&&null!=g&&v!=g&&(f=Crm.userDetails.CURRENCY_DETAILS[v]?Crm.userDetails.CURRENCY_DETAILS[v].er:Crm.userDetails.CURRENCY_DETAILS[g].er);var h=e["hdnUnitPrice"+c];h*=f,h=productDetails.getRoundOffValue(h,!0),i?r.find("#hdnUnitPrice"+c).val(h):$("#hdnUnitPrice"+c).val(h)}i?r.find("#hdnPriceBookId"+c).val(e["hdnPriceBookId"+c]):$("#hdnPriceBookId"+c).val(e["hdnPriceBookId"+c]),i?r.find("#hdnPriceBookIdClone"+c).val(e["hdnPriceBookId"+c]):$("#hdnPriceBookIdClone"+c).val(e["hdnPriceBookId"+c]),i?r.find("#hdnQtyStock"+c).val(e["hdnQtyStock"+c]):$("#hdnQtyStock"+c).val(e["hdnQtyStock"+c]);var C=parseFloat(e["txtQty"+c]);i?r.find("#txtQty"+c).val(C):$("#txtQty"+c).val(C),i?r.find("#hdnOldQty"+c).val(e["txtQty"+c]):$("#hdnOldQty"+c).val(e["txtQty"+c]);var w=p*C;w=productDetails.getRoundOffValue(w,!0),i?r.find("#total"+c).val(w):$("#total"+c).val(w),i?r.find("#total"+c).parent().find(".amntFP").text(w):$("#total"+c).parent().find(".amntFP").text(w),null!=(M=parseFloat(e["hdnDiscount"+c]))&&"NaN"!=M.toString()||(M=0),M=productDetails.getRoundOffValue(M,!0);var b=0;0!=w&&(b=productDetails.getRoundOffValue(M/w*100,!0)),i?r.find("#discount"+c).val(M):$("#discount"+c).val(M),i?r.find("#discPc"+c).val(b):$("#discPc"+c).val(b),i?r.find("#discount"+c).parent().find(".discVal").text(M):$("#discount"+c).parent().find(".discVal").text(M);var T=w-M;if(T=productDetails.getRoundOffValue(T,!0),i?r.find("#totalAfterDiscount"+c).val(T):$("#totalAfterDiscount"+c).val(T),!s&&("create"===Lyte.Router.getRouteInstance().routeName||"clone"===Lyte.Router.getRouteInstance().routeName)){for(var I=e["hdnPrdAllTax"+c],y=e["hdnPrdTaxDet"+c],P="",_=0,D=(T=parseFloat(T),Math.pow(10,productDetails.roundOff),y.split(";;;")),O=D.length-1,S=0;S<O;S++){if(I[z=(H=(Y=D[S]).split("==="))[0]]){var L=H[1].split(":::")[0];if(!productDetails.canEditTaxValue&&parseFloat(I[z][1])!=parseFloat(L))continue;var E=Number(L/100*T);_+=E=productDetails.getRoundOffValue(E,!1),P+=z+"==="+L+";;;"}}e["hdnTax"+c]=_,e["hdnPrdTaxDet"+c]=P}var x=i?r.find("#prdTaxDet"+c):$("#prdTaxDet"+c);x.val(e["hdnPrdTaxDet"+c]),x.data("serviceIdVsName",e["lineTaxNames"+c]);var F=i?r.find("#prdAllTax"+c):$("#prdAllTax"+c);F.val(JSON.stringify(e["hdnPrdAllTax"+c])),F.data("sortedTaxNames",e["hdnPrdSortedTaxs"+c]),i?r.find("#isTaxable"+c).val(e["isTaxable"+c]):$("#isTaxable"+c).val(e["isTaxable"+c]),null!=(E=parseFloat(e["hdnTax"+c]))&&"NaN"!=E.toString()||(E=0),E=productDetails.getRoundOffValue(E,!0),i?r.find("#tax"+c).val(E):$("#tax"+c).val(E),i?r.find("#tax"+c).parent().find(".taxval").text(E):$("#tax"+c).parent().find(".taxval").text(E);var V=parseFloat(T)+parseFloat(E);V=productDetails.getRoundOffValue(V,!0),i?r.find("#netTotal"+c).val(V):$("#netTotal"+c).val(V),i?r.find("#netTotal"+c).parent().find(".netTot").text(V):$("#netTotal"+c).parent().find(".netTot").text(V),t&&(Crm.userDetails.hideProductLineItemsSummary||productDetails.calculateGrandTotal(c),productDetails.grandTaxChanged=!1)}if(!t){var A=i?r.find("#subTotal"):$("#subTotal"),k=i?r.find("#txtDiscount"):$("#txtDiscount"),N=productDetails.getRoundOffValue(e.INVENTORYTOTALVALUES.SUBTOTAL,!0);A.val(N),A.parent().find(".grandVals").text(N);var M=productDetails.getRoundOffValue(e.INVENTORYTOTALVALUES.DISCOUNT,!0);k.val(M);b=0;if(0!=N&&(b=productDetails.getRoundOffValue(M/N*100,!0)),i?r.find("#discPc").val(b):$("#discPc").val(b),k.parent().find(".grandVals").text(M),!s&&("create"===Lyte.Router.getRouteInstance().routeName||"clone"===Lyte.Router.getRouteInstance().routeName))if(P=e.INVENTORYTOTALVALUES.RECORDTAXDET){var R=JSON.parse(productDetails.newAllTaxes),B="",U=(_=0,T=parseFloat(N)-parseFloat(M),P.split(";;;")),j=U.length-1;for(S=0;S<j;S++){var H,z;if(R[z=(H=(Y=U[S]).split("==="))[0]]){L=H[1].split(":::")[0];if(!productDetails.canEditTaxValue&&parseFloat(R[z][1])!=parseFloat(L))continue;var q=(L=parseFloat(L))/100*T;_+=q=productDetails.getRoundOffValue(q,!1),B+=z+"==="+L+";;;"}}e.INVENTORYTOTALVALUES.TAX=_,e.INVENTORYTOTALVALUES.RECORDTAXDET=B}var Y=productDetails.getRoundOffValue(e.INVENTORYTOTALVALUES.TAX,!0),J=i?r.find("#txtTax"):$("#txtTax");J.val(Y),J.parent().find(".grandVals").text(Y),i?r.find("#recordTaxDet").val(e.INVENTORYTOTALVALUES.RECORDTAXDET):$("#recordTaxDet").val(e.INVENTORYTOTALVALUES.RECORDTAXDET);var W=productDetails.getRoundOffValue(e.INVENTORYTOTALVALUES.ADJUSTMENT,!0),G=i?r.find("#txtAdjustment"):$("#txtAdjustment");G.val(W),G.parent().find(".grandVals").text(W);var Q=productDetails.getRoundOffValue(e.INVENTORYTOTALVALUES.GRANDTOTAL,!0),K=i?r.find("#grandTotal"):$("#grandTotal");K.val(Q),K.parent().find(".grandVals").text(Q)}if(!s&&("create"===Lyte.Router.getRouteInstance().routeName||"clone"===Lyte.Router.getRouteInstance().routeName)){for(c=1;c<=n;c++)productDetails.calculateForLine(c);productDetails.calculateGrandTotal()}}},setParamsForInventory:function(e,t){var i=$("#multipleFieldsEditPop #"+t+"_rlContainer"),a=e?i.find("#totalProductCount").val():$("#totalProductCount").val();Crm.requestParam["property(totalProductCount)"]=a;for(var s=0;s<=a;s++){var r=e?i.find("#hdnProductId"+s).val():$("#hdnProductId"+s).val();Crm.requestParam["property(hdnProductId"+s+")"]=r,r=e?i.find("#hdnInvRelId"+s).val():$("#hdnInvRelId"+s).val(),Crm.requestParam["property(hdnInvRelId"+s+")"]=r,r=e?i.find("#hdnProductCode"+s).val():$("#hdnProductCode"+s).val(),Crm.requestParam["property(hdnProductCode"+s+")"]=r,r=e?i.find("#txtProduct"+s).val():$("#txtProduct"+s).val(),Crm.requestParam["property(hdnProductName"+s+")"]=r,r=e?i.find("#itemDescription"+s).val():$("#itemDescription"+s).val(),Crm.requestParam["property(itemDescription"+s+")"]=r,r=e?i.find("#txtListPrice"+s).val():$("#txtListPrice"+s).val(),Crm.requestParam["property(txtListPrice"+s+")"]=r,r=e?i.find("#hdnPriceBookId"+s).val():$("#hdnPriceBookId"+s).val(),Crm.requestParam["property(hdnPriceBookId"+s+")"]=r,r=e?i.find("#hdnUnitPrice"+s).val():$("#hdnUnitPrice"+s).val(),Crm.requestParam["property(hdnUnitPrice"+s+")"]=r,r=e?i.find("#txtQty"+s).val():$("#txtQty"+s).val(),Crm.requestParam["property(txtQty"+s+")"]=r,r=e?i.find("#hdnOldQty"+s).val():$("#hdnOldQty"+s).val(),Crm.requestParam["property(hdnOldQty"+s+")"]=r,r=e?i.find("#hdnQtyStock"+s).val():$("#hdnQtyStock"+s).val(),Crm.requestParam["property(hdnQtyStock"+s+")"]=r,r=e?i.find("#total"+s).val():$("#total"+s).val(),Crm.requestParam["property(hdnTotal"+s+")"]=r,r=e?i.find("#totalAfterDiscount"+s).val():$("#totalAfterDiscount"+s).val(),Crm.requestParam["property(hdnTotalAfterDiscount"+s+")"]=r,r=e?i.find("#discount"+s).val():$("#discount"+s).val(),Crm.requestParam["property(hdnDiscount"+s+")"]=r,r=e?i.find("#tax"+s).val():$("#tax"+s).val(),Crm.requestParam["property(hdnTax"+s+")"]=r,r=e?i.find("#prdTaxDet"+s).val():$("#prdTaxDet"+s).val(),Crm.requestParam["property(hdnPrdTaxDet"+s+")"]=r,r=e?i.find("#netTotal"+s).val():$("#netTotal"+s).val(),Crm.requestParam["property(hdnNetTotal"+s+")"]=r}var o=e?i.find("#subTotal").val():$("#subTotal").val();Crm.requestParam["property(Sub Total)"]=o,o=e?i.find("#txtDiscount").val():$("#txtDiscount").val(),Crm.requestParam["property(Discount)"]=o,o=e?i.find("#txtTax").val():$("#txtTax").val(),Crm.requestParam["property(Tax)"]=o,o=e?i.find("#recordTaxDet").val():$("#recordTaxDet").val(),Crm.requestParam["property(recordTaxDet)"]=o,o=e?i.find("#txtAdjustment").val():$("#txtAdjustment").val(),Crm.requestParam["property(Adjustment)"]=o,o=e?i.find("#grandTotal").val():$("#grandTotal").val(),Crm.requestParam["property(Grand Total)"]=o},initInventoryView:function(e){if(e.entMetaData.isConverted&&$('[id="btnConvert"]').parent().remove(),Crm.userDetails.isLineItemSubformMvmtDone||(this.createLinesTableInView(e.productLineItems),this.addViewRows(e.productLineItems)),objectUtils.getKeys(Crm.userDetails.CURRENCY_DETAILS).length>0){var t=$("#subvalue_CURRENCYISOCODE").text();null!=t&&""!=t||(t=Crm.userDetails.BASE_CURRENCY),productDetails.currencySymbol=Crm.userDetails.CURRENCY_DETAILS[t].symbol,productDetails.roundOff=Crm.userDetails.CURRENCY_DETAILS[t].decimals}else productDetails.currencySymbol=Crm.userDetails.defaultOrgCurrency,isNaN(Crm.userDetails.productRoundOff)||(productDetails.roundOff=Crm.userDetails.productRoundOff,productDetails.roundOff>5&&(productDetails.roundOff=5));productDetails.roundOffPrecision=Math.pow(10,productDetails.roundOff),Crm.userDetails.isLineItemSubformMvmtDone||(this.setValuesForViewLines(e),this.fillCurrencySymbolInView(productDetails.currencySymbol),this.handleForMulCurrency(e),$("#productList").closest(".tabDiv").css("border-left","none"),loadClassFns3(!0))},createLinesTableInView:function(e){for(var t=e.productLineItemFields,i={},a=0;a<=t.length-1;a++)i[t[a].label]=t[a].displaylabel;var s=document.getElementById("secDiv_Product_Details"),r=$(s),o=" <tr> <td colspan='"+2*r.data("layout")+'\'> <div id="productList">';o+='<table width="100%" border="0" cellspacing="0" cellpadding="0" class="invoiceTable" > <thead> <tr id="tablehead">',o+='<th width="5%" align="left bold"> # </th> <th width="28%" class="alignleft bold lightgray3">'+i["Product Details"]+'</th> <th width="12%" class="aligncenter bold lightgray3">'+I18n.getMsg("List Price")+"</th>",o+='<th width="12%" class="aligncenter bold lightgray3">'+I18n.getMsg("Quantity")+'</th> <th width="12%" class="aligncenter bold lightgray3">'+I18n.getMsg("Amount")+'</th> <th width="15%" class="aligncenter bold lightgray3">'+i.Discount+"</th>",o+='<th width="10%" class="aligncenter bold lightgray3">'+i.Tax+'</th> <th width="15%" class="alignright pR5 bold lightgray3">'+I18n.getMsg("Total")+"</th> </tr> </thead>",o+='<tbody id="linesTable">',Crm.userDetails.hideProductLineItemsSummary||(o+='<tfoot> <tr> <td colspan="8" class="noBdr alignright"> <table class="fR"> <tr> <td class="noborder oH p5"> <label class="fL w100 alignright">'+i["Sub Total"]+'</label> </td> <td class="noborder"> <div id=\'subTotal\' class="mL15"> <span id=\'value_SUBTOTAL\' class="alignright"> </span> </div> </td> </tr>',o+='<tr> <td class="noborder oH p5"> <label class="fL w100 alignright">'+i.Discount+'</label> </td> <td class="noborder"> <div id=\'groupDiscount\' class="mL15"> <span id=\'value_DISCOUNT\' class="alignright"> </span> </td> </tr>',o+='<tr> <td class="noborder oH p5"> <label class="fL w100 alignright">'+i.Tax+'</label> </td> <td class="noborder"> <div id=\'groupTax\' class="mL15"> <span id=\'value_TAX\' class="alignright"> </span> </td> </tr>',o+='<tr> <td class="oH p5"> <label class="fL w100 alignright">'+i.Adjustment+"</label> </td> <td> <div id='groupAdjustment' class=\"mL15\"> <span id='value_ADJUSTMENT' class=\"alignright\"> </span> </td> </tr>",o+='<tr> <td class="noborder oH p5"> <label class="fL w100 alignright bold">'+i["Grand Total"]+'</label> </td> <td class="noborder"> <div id=\'grandTotal\' class="mL15"> <span id=\'value_GRANDTOTAL\' class="alignright bold"> </span></td> </tr>',o+="</table> </td> </tr> </tfoot> </table> </div> </td> </tr> "),r.find(".tabDiv").append(o);r.find(".tabDiv").append('<tfoot> <tr> <td> <div class="newpopup p15 w180 hide" style="left:450px; top:400px;" id="pbDiscInfo" data-close="true"> <table cellpadding="5" cellspacing="0" border="0" width="100%"></div> </td> </tr> </tfoot>')},addViewRows:function(e){for(var t=e.totalProductCount,i=1;i<=t;i++){var a='<tr id="hrow'+i+"\" onmouseover=\"$(this).find('.icon_roundinfo').css('visibility', 'visible')\" onmouseout=\"$(this).find('.icon_roundinfo').css('visibility', 'hidden')\"> <td align=\"left\"> <span id='value_sno"+i+"' style='padding:3px;'> "+i+" </span> </td> ";a+="<td> <span id='value_hdnProductName"+i+"' onmouseover='productDetails.showPrdDetInView("+i+')\' onmouseout=\'zctt.hidett()\'> <a href="javascript:;" class="f13 link1"> <h3 class="fL bold"> </h3> </a> </span> <div class="pR20 dvmB0">',a+="<pre id='value_itemDescription"+i+'\' class="eliptext fL pR5 itemDescriptionView" wrap="soft" onmouseover="productDetails.showMore(this)" onmouseout="productDetails.hideMore(this)"> </pre> <input type="hidden" id="value_itemDescriptionClone'+i+'">  </div> </td>',a+='<td class="f13 aligncenter"> <span id=\'value_txtListPrice'+i+"' class='lineCurrVal'> </span> <span id='value_hdnUnitPrice"+i+"' style='display:none'> </span> </td>",a+='<td class="f13 aligncenter"> <span id=\'value_txtQty'+i+"'> </span> <span id='value_hdnQtyStock"+i+"' style='display:none'> </span> </td> <td class=\"f13 aligncenter\"> <span id='value_hdnTotal"+i+"' class='lineCurrVal'> </span> </td>",a+='<td class="f13 aligncenter"> <div class="fL alignright w60per" onmouseover="productDetails.showDiscForLine(this, true)" onmouseout="zctt.hidett()"> <span id=\'value_hdnDiscount'+i+"' class='lineCurrVal'> </span> <span id='value_hdnTotalAfterDiscount"+i+'\' style=\'display:none\' class=\'getAftrDisc\'> </span> </div> <div class="fL alignleft" style="width:40%"> <i class="icon_roundinfo pointer mL5" onclick="productDetails.showDiscountScheme(this,module.value);sE(event)" style="visibility:hidden"></i></td>',a+='<td class="f13 aligncenter"> <span id=\'value_hdnTax'+i+"' class='lineCurrVal'> </span> </td> <td class=\"f13 aligncenter alignright\"> <span id='value_hdnNetTotal"+i+"' class='lineCurrVal'> </span> <span id=\"value_pricingRange"+i+'" style="display:none"> </span> <span id="value_priceBookId'+i+'" style="display:none"> </span> </td> </tr>',$("#linesTable").append(a)}},setValuesForViewLines:function(e){var t=e.productLineItems,i=t.totalProductCount,a=$("#subvalue_CURRENCYISOCODE").text(),s=[",","."];null!=productDetails.currencySymbol&&null!=a&&""!=a&&(s=Crm.userDetails.CURRENCY_DETAILS[a].format.split("|"));for(var r=0,o=1;o<=i;o++){var n=t["hdnProductId"+o],l=t["hdnProductCode"+o],d="<a id='viewEntity_"+n+'\' data-zcqa=\'detailView\' data-cid=\'detailView\' data-params=\'{"lookback":true,"module":"Products","id":"'+n+"\"}'  class='link' href='"+Crm.getCrmBasePath()+"/EntityInfo.do?module=Products&id="+n+'\'> <h3 class="dI bold mR5">'+$ESAPI.encoder().encodeForHTML(t["hdnProductName"+o])+"</h3>";null!=l&&""!=l&&(d+='<span class="mL5" id="value_hdnProductCode'+o+'"> ('+$ESAPI.encoder().encodeForHTML(l)+") </span>"),d+="</a>",$("#value_hdnProductName"+o).html(d);var c=t["itemDescription"+o];if(null!=c)if($("#value_itemDescriptionClone"+o).val(c),c.length>=100){var u=c.substring(85),m=c.substring(0,85);if((m=renderingUtils.highlightUrlInText($ESAPI.encoder().encodeForHTML(m))).endsWith("</a>")&&!u.startsWith(" ")){var p=-1===u.indexOf(" ")?86+u.length:85+u.indexOf(" ");m=c.substring(0,p),m=renderingUtils.highlightUrlInText($ESAPI.encoder().encodeForHTML(m))}c=m+'...  <a href="javascript:;" class="fR f12 link1 vh moreLess" onclick="productDetails.clickMore('+o+')"> '+I18n.getMsg("crm.login.more")+" </a> "}else c=renderingUtils.highlightUrlInText($ESAPI.encoder().encodeForHTML(c));else $("#value_itemDescriptionClone"+o).val($ESAPI.encoder().encodeForHTML(c));if($("#value_itemDescription"+o).html(c),t["txtListPrice"+o].toString().indexOf(".")<0||t["txtListPrice"+o].toString().substring(t["txtListPrice"+o].toString().indexOf(".")).length-1<productDetails.roundOff?$("#value_txtListPrice"+o).html(currencyUtils.getNumberWithCommas(productDetails.getRoundOffValue(t["txtListPrice"+o],!0),s[0],s[1])):$("#value_txtListPrice"+o).html(currencyUtils.getNumberWithCommas(t["txtListPrice"+o],s[0],s[1])),null==t["hdnUnitPrice"+o]||isNaN(t["hdnUnitPrice"+o]))$("#value_hdnUnitPrice"+o).html(0);else{var f=t["hdnUnitPrice"+o],v=1,g=Crm.userDetails.BASE_CURRENCY;null!=a&&null!=g&&a!=g&&(v=Crm.userDetails.CURRENCY_DETAILS[a]?Crm.userDetails.CURRENCY_DETAILS[a].er:Crm.userDetails.CURRENCY_DETAILS[g].er),f*=v,f=productDetails.getRoundOffValue(f,!0),$("#value_hdnUnitPrice"+o).html(currencyUtils.getNumberWithCommas(f,s[0],s[1]))}$("#value_txtQty"+o).html(t["txtQty"+o]),$("#value_hdnQtyStock"+o).html(t["hdnQtyStock"+o]),$("#value_hdnTotal"+o).html(currencyUtils.getNumberWithCommas(productDetails.getRoundOffValue(t["total"+o],!0),s[0],s[1])),$("#value_hdnDiscount"+o).html(currencyUtils.getNumberWithCommas(productDetails.getRoundOffValue(t["hdnDiscount"+o],!0),s[0],s[1])),$("#value_hdnTotalAfterDiscount"+o).html(currencyUtils.getNumberWithCommas(productDetails.getRoundOffValue(t["totalAfterDiscount"+o],!0),s[0],s[1])),$("#value_hdnTax"+o).html(currencyUtils.getNumberWithCommas(productDetails.getRoundOffValue(t["hdnTax"+o],!0),s[0],s[1]));var h=t["hdnNetTotal"+o];r+=parseFloat(h),$("#value_hdnNetTotal"+o).html(currencyUtils.getNumberWithCommas(productDetails.getRoundOffValue(h,!0),s[0],s[1])),$("#value_pricingRange"+o).html(t["pricingRange"+o]),$("#value_priceBookId"+o).html($ESAPI.encoder().encodeForHTML(t["hdnPriceBookId"+o]))}var C=productDetails.currencySymbol;if(t.INVENTORYTOTALVALUES){var w=productDetails.getRoundOffValue(t.INVENTORYTOTALVALUES.SUBTOTAL,!0);w!=(r=productDetails.getRoundOffValue(r,!0))&&(w=r.toString());var b=productDetails.getRoundOffValue(t.INVENTORYTOTALVALUES.GRANDTOTAL,!0),T=parseFloat(w)-(t.INVENTORYTOTALVALUES.DISCOUNT?t.INVENTORYTOTALVALUES.DISCOUNT:0)+(t.INVENTORYTOTALVALUES.TAX?t.INVENTORYTOTALVALUES.TAX:0)+(t.INVENTORYTOTALVALUES.ADJUSTMENT?t.INVENTORYTOTALVALUES.ADJUSTMENT:0);(T=productDetails.getRoundOffValue(T,!0))!=b&&(b=T),$(document.getElementById("value_SUBTOTAL")).html(C+" "+currencyUtils.getNumberWithCommas(w,s[0],s[1])),$(document.getElementById("value_DISCOUNT")).html(C+" "+currencyUtils.getNumberWithCommas(t.INVENTORYTOTALVALUES.DISCOUNT?productDetails.getRoundOffValue(t.INVENTORYTOTALVALUES.DISCOUNT,!0):(0).toFixed(productDetails.roundOff),s[0],s[1])),$(document.getElementById("value_TAX")).html(C+" "+currencyUtils.getNumberWithCommas(t.INVENTORYTOTALVALUES.TAX?productDetails.getRoundOffValue(t.INVENTORYTOTALVALUES.TAX,!0):(0).toFixed(productDetails.roundOff),s[0],s[1])),$(document.getElementById("value_ADJUSTMENT")).html(C+" "+currencyUtils.getNumberWithCommas(t.INVENTORYTOTALVALUES.ADJUSTMENT?productDetails.getRoundOffValue(t.INVENTORYTOTALVALUES.ADJUSTMENT,!0):(0).toFixed(productDetails.roundOff),s[0],s[1])),$(document.getElementById("value_GRANDTOTAL")).html(C+" "+currencyUtils.getNumberWithCommas(b,s[0],s[1]))}},handleForMulCurrency:function(e){var t=Crm.userDetails.CURRENCY_DETAILS;if(objectUtils.getKeys(Crm.userDetails.CURRENCY_DETAILS).length>0){var i=$("#subvalue_CURRENCYISOCODE").text(),a=Crm.userDetails.BASE_CURRENCY,s=t[a].symbol,r=t[a].format,o=r.split("|")[0],n=r.split("|")[1],l=t[a].decimals;if(null!=i&&""!=i&&i!=a){for(var d=e.entMetaData.EXCHANGERATE,c=returnJson.productLineItems.totalProductCount,u=1;u<=c;u++){var m=returnJson.productLineItems["txtListPrice"+u]/d;m=productDetails.getRoundOffValue(m,!0,l),m=currencyUtils.getNumberWithCommas(m,o,n),$("#value_txtListPrice"+u).append(" ("+s+" "+m+")"),m=returnJson.productLineItems["total"+u]/d,m=productDetails.getRoundOffValue(m,!0,l),m=currencyUtils.getNumberWithCommas(m,o,n),$("#value_hdnTotal"+u).append(" ("+s+" "+m+")"),m=returnJson.productLineItems["hdnDiscount"+u]/d,m=productDetails.getRoundOffValue(m,!0,l),m=currencyUtils.getNumberWithCommas(m,o,n),$("#value_hdnDiscount"+u).append(" ("+s+" "+m+")"),m=returnJson.productLineItems["hdnTax"+u]/d,m=productDetails.getRoundOffValue(m,!0,l),m=currencyUtils.getNumberWithCommas(m,o,n),$("#value_hdnTax"+u).append(" ("+s+" "+m+")"),m=returnJson.productLineItems["hdnNetTotal"+u]/d,m=productDetails.getRoundOffValue(m,!0,l),m=currencyUtils.getNumberWithCommas(m,o,n),$("#value_hdnNetTotal"+u).append(" ("+s+" "+m+")")}if(null!=returnJson.productLineItems.INVENTORYTOTALVALUES){var p=returnJson.productLineItems.INVENTORYTOTALVALUES.SUBTOTAL/d;p=productDetails.getRoundOffValue(p,!0,l),p=currencyUtils.getNumberWithCommas(p,o,n),$(document.getElementById("value_SUBTOTAL")).append(" ("+s+" "+p+")"),p=returnJson.productLineItems.INVENTORYTOTALVALUES.DISCOUNT/d,p=productDetails.getRoundOffValue(p,!0,l),p=currencyUtils.getNumberWithCommas(p,o,n),$(document.getElementById("value_DISCOUNT")).append(" ("+s+" "+p+")"),p=returnJson.productLineItems.INVENTORYTOTALVALUES.TAX/d,p=productDetails.getRoundOffValue(p,!0,l),p=currencyUtils.getNumberWithCommas(p,o,n),$(document.getElementById("value_TAX")).append(" ("+s+" "+p+")"),p=returnJson.productLineItems.INVENTORYTOTALVALUES.ADJUSTMENT/d,p=productDetails.getRoundOffValue(p,!0,l),p=currencyUtils.getNumberWithCommas(p,o,n),$(document.getElementById("value_ADJUSTMENT")).append(" ("+s+" "+p+")"),p=returnJson.productLineItems.INVENTORYTOTALVALUES.GRANDTOTAL/d,p=productDetails.getRoundOffValue(p,!0,l),p=currencyUtils.getNumberWithCommas(p,o,n),$(document.getElementById("value_GRANDTOTAL")).append(" ("+s+" "+p+")")}}}},clickMore:function(e){var t=$("#value_itemDescription"+e),i=$("#value_itemDescriptionClone"+e),a=renderingUtils.highlightUrlInText($ESAPI.encoder().encodeForHTML(i.val()));a+=' <a href="javascript:;" class="fR f12 link1 vh moreLess" onclick="productDetails.clickLess('+e+')"> '+I18n.getMsg("crm.label.less")+" </a> ",t.html(a)},clickLess:function(e){var t=$("#value_itemDescription"+e),i=$("#value_itemDescriptionClone"+e).val(),a=i.substring(85),s=i.substring(0,85);if((s=renderingUtils.highlightUrlInText($ESAPI.encoder().encodeForHTML(s))).endsWith("</a>")&&!a.startsWith(" ")){var r=-1===a.indexOf(" ")?86+a.length:85+a.indexOf(" ");s=i.substring(0,r),s=renderingUtils.highlightUrlInText($ESAPI.encoder().encodeForHTML(s))}i=s+'...  <a href="javascript:;" class="fR f12 link1 vh moreLess" onclick="productDetails.clickMore('+e+')"> '+I18n.getMsg("crm.login.more")+" </a> ",t.html(i)},showMore:function(e){$(e).find(".moreLess").removeClass("vh")},hideMore:function(e){$(e).find(".moreLess").addClass("vh")},create:function(e){this.productDetails=!0,this.module=e;var t=document.createDocumentFragment();return this.createLinesTable(t),this.createProductsPop(t),this.createDiscountPop(t),this.createTaxPops(t),this.createNewProductForm(t),this.productDetails=!1,t},convertQuote:function(e,t,i,a,s){var r,o=I18n.getMsg("convertAlert");if(store.peekRecord(moduleRecordMapping[e].id,i)&&(r=store.peekRecord(moduleRecordMapping[e].id,i)),"Invoices"==t){var n=!1;if(Crm.userDetails.isLineItemSubformMvmtDone){var l=$(".lineItemSubformRow").length,d=$(".mouseArea___PRODUCTID"),c=$(".mouseArea___QUANTITY");if(c.length>0)for(var u=0;u<l;u++){var m=d.eq(u).data().params.prdDetails;if(!m.LAYOUTID||Crm.userDetails.QuantityInStockAvailableLayoutIds.contains(m.LAYOUTID)){var p=m?m.Qty_in_Stock:0,f=c.eq(u).data().params.defaultvalue;if(f.length>0&&(p<=0||p<=f)){n=!0;break}}}}else for(l=returnJson.productLineItems.totalProductCount,u=1;u<=l;u++)if(!$u.isEmpty(returnJson)&&(returnJson.productLineItems["hdnQtyStock"+u]<=0||returnJson.productLineItems["hdnQtyStock"+u]<=returnJson.productLineItems["txtQty"+u])||r.Product_Details[u-1].quantity_in_stock<=0||r.Product_Details[u-1].quantity_in_stock<=r.Product_Details[u-1].quantity){n=!0;break}if("canvas"===Lyte.Router.getRouteInstance().routeName&&s&&(n=!0),n&&!window.confirm(o))return!1}if($u.isEmpty(returnJson)?r.$converted:Crm.userDetails.isLineItemSubformMvmtDone?returnJson.entMetaData.isConverted:returnJson.productLineItems.isConverted)return"canvas"==Lyte.Router.getRouteInstance().routeName?renderingUtils.showCustomAlert(I18n.getMsg("crm.noquote.convert",I18n.getMsg("Quotes"))):alert(I18n.getMsg("crm.noquote.convert",I18n.getMsg("Quotes"))),!1;a&&(a.click=null),detailView.isWFExecInKafka=!1,detailView.refreshInWms=!1;var v=Crm.getCrmBasePath()+"/FillEntityObject.do?operation=convert&destModule="+t+"&sourceModule="+e+"&sourceId="+i;mR(v,(function(e){var t=JSON.parse(e);if("INTERNAL_ERROR"===t.STATUS)return renderingUtils.showCustomAlert(I18n.getMsg("crm.copy.error.mail.internal.error"),"",!0,void 0),!1;if("DUPLICATE"===t.STATUS)return renderingUtils.showCustomAlert(Crm.getDuplicateErrorMsg(t.INFO[0],!0),"",!0,void 0),!1;if("INACTIVEOWNER"===t.STATUS)return renderingUtils.showCustomAlert(I18n.getMsg("crm.alert.assign.active.user"),"",!1,void 0),!1;if("PERMISSION_DENIED"==t.STATUS)return renderingUtils.displayPermissionDenied(),!1;detailView.isWFExecInKafka=t.isWFExecInKafka,detailView.refreshInWms=t.callWMS,detailView.prevModule=t.module;var i=t.URL,a=networkUtils.parseUrl(i).params;Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:[a.module,a.id]})}),crmReports.csrf())},convertQuoteFromCanvas:function(e,t,i){var a,s=store.peekRecord(moduleRecordMapping[e].id,$L("#entityId")[0].value);if((a=s.Ordered_Items?s.Ordered_Items:s.Quoted_Items)&&a.length>0&&"Invoices"===t){var r=[];a.filter((function(e){r.push(e.Product_Name.id)})),(store.modelFor(moduleRecordMapping.Products.id)?Promise.resolve(store.peekRecord("module",moduleRecordMapping.Products.id)):store.findRecord("module",moduleRecordMapping.Products.id)).then((function(){var a={};a.ids=r.join(),a.approved="both",store.findAll(moduleRecordMapping.Products.id,a).then((function(a){a.filter((function(e){return e.Qty_in_Stock<=0})).length>0?productDetails.convertQuote(e,t,i,void 0,!0):productDetails.convertQuote(e,t,i,void 0,!1)}))}))}else productDetails.convertQuote(e,t,i,void 0)},getTaxIdFromDisplayName:function(e){for(var t in productDetails.taxIdVsName)if(productDetails.taxIdVsName[t][1]==e)return t;return null},addLoggerForTaxIssue:function(e,t){if("20070216817"===Crm.userDetails.ZGID.toString()){var i={type:"custom event"};i.message=e,murphy.addCustomTracking(i),murphy.error(new Error(t))}},setPrdDetailsForWidget:function(e,t){if(t.Product_Name&&t.Product_Name.id&&t.Product_Name.name){var i={};i.id=t.Product_Name.id,i.Taxable=t.Taxable,i.Tax=t.Tax,i.Product_Name=t.Product_Name.name,i.Qty_Ordered=t.Quantity,i.Qty_in_Stock=t.Qty_in_Stock,i.Unit_Price=t.List_Price,i.Product_Code=t.Product_Code,$(e).attr("prdDetails",JSON.stringify(i))}}};function loadClassFns1(e,t){$(e?"#multipleFieldsEditPop #"+t+"_rlContainer #cancelNewProduct":"#cancelNewProduct").click((function(){$("#searchCreateDiv").animate({right:"700px"}).hide(),$("#productPopup").show().animate({right:"0px"}),$("#addpbtn").show(),$("#cancelbtn").show()})),e?$("#multipleFieldsEditPop #"+t+"_rlContainer ").find("#taxPop,#discountPop,#moreop,#editGrandDiscPop,#grandTaxPop").attr("data-close","true"):$("#taxPop,#discountPop,#moreop,#editGrandDiscPop,#grandTaxPop").attr("data-close","true"),$(".subDiscTot").click((function(){$(this).siblings(".editCentDesc").hide(),$(this).siblings(".s").show(),$(this).siblings(".s").children(".textField").focus(),$(this).closest("tr").siblings("tr").find(".editCentDesc").show(),$(this).closest("tr").siblings("tr").find(".s").hide(),document.getElementsByClassName("wrap").style.display="block"})),$(".subDisc").keyup((function(){var e=0,t=parseFloat($("#subTotal").val());if("grandDiscPc"==$(this).attr("id")){e=t*(i=$(this).val())/100,$("#grandDiscDir").val(e),e=productDetails.getRoundOffValue(e,!0)}else{var i=0;0!=(e=$(this).val())&&(i=e/t*100),$("#grandDiscPc").val(i)}$("#txtDiscount").val(e),"0"!=$("#txtTax").val()?calcGrandTax():Crm.userDetails.hideProductLineItemsSummary||calculateGrandTotal()}))}function loadClassFns3(e,t){var i=null;t&&(i=$("#multipleFieldsEditPop #duringTabDivs div.current"));t?i.find(".decimalFld"):$(".decimalFld");$(".decimalFld").keypress((function(e){return(8==e.which||0==e.which||46==e.which||45==e.which||!(e.which<48||e.which>57))&&((null==$(this).attr("id")||!($(this).attr("id").indexOf("Qty")>-1&&$(this).val().length>=9||$(this).attr("id").indexOf("ListPrice")>-1&&$(this).val().length>=20))&&void 0)}))}function loadClassFns2(e){var t=null;e&&(t=$("#multipleFieldsEditPop #duringTabDivs div.current"));var i=e?t.find("#linesTbody"):$("#linesTbody");i.sortable({placeholder:"ui-sortable-placeholder",cursor:"move",helper:function(e,t){return t.children().each((function(){$(this).width($(this).width())})),t},stop:function(e,t){var i=0;$("#linesTbody .sort").each((function(){i++,productDetails.reorderRow(this,i)}))}}),i.mousedown((function(){document.activeElement.blur()})),(e?t.find(".showCode"):$(".showCode")).change((function(){this.checked?e?t.find(".codeList").show():$(".codeList").show():e?t.find(".codeList").hide():$(".codeList").hide()})),(e?t.find(".showDisc"):$(".showDisc")).change((function(){this.checked?e?t.find(".discList").show():$(".discList").show():e?t.find(".discList").hide():$(".discList").hide()}))}var productScroll={_scrollMenu:function(e,t,i){var a=[],s=Math.ceil(t.length/10);a=t.slice(0,10);var r=i.options.position;s>1&&$(e).scroll((function(){if(isScrollbarBottom($(e))){if(searchStats.scrollEnd)return null;if(searchStats.scrollPageIndex>=s){if(searchStats.isFull)return null;var t=searchStats.previousSearchResults.length+1;(a=productDetails.searchForProducts(searchStats.searchText,!0,t)).length<10&&(searchStats.scrollEnd=!0,searchStats.isFull=!0)}else a=(a=productDetails.searchForProducts(searchStats.searchText,!1,0)).slice(10*searchStats.scrollPageIndex,10*searchStats.scrollPageIndex+10);++searchStats.scrollPageIndex,a.each((function(t){null!=t&&i._renderItem(e,t)})),i.menu.refresh(),e.show(),i._resizeMenu(),e.position($.extend({of:i.element},r)),i.options.autoFocus&&i.menu.next(new $.Event("mouseover"))}})),a.each((function(t){null!=t&&i._renderItem(e,t)}))}};function isScrollbarBottom(e){var t=e.outerHeight(),i=e[0].scrollHeight;return e.scrollTop()>=i-t}var closeAll,SalesSummaryInfo=SalesSummaryInfo||{},zCampaignaDetails=zCampaignaDetails||{};macroDivStatus=!0;var singularModule=getObj("singularModule")?getObj("singularModule").value:"",noneValue="-None-";pulseSelId={id:!0};var typedtext,feedBacktimeout,countDownInterval,scrX=0,scrY=0,pgeX=0,pgeY=0,splCharArray=new Array("`","~","!","#","^","*","[","]","{","}","|","\\",'"',";"),splCharUsersArray=new Array("`","~","!","#","^","*","[","]","{","}","|","\\",'"',";","<",">"),splCharArrayNew=new Array("'","`","~","!","#","^","*","[","]","{","}","|","\\",'"',";","/","<",">","?","&","%"),splCharArrayForTabs=new Array("`","~","!","#","^","*","[","]","{","}","|","\\",'"',";","'","&","+","%","(",")","@","_","?",":","<",">","="),currSrchResCnt=0,currSechExtMatCnt=0,noMoreTBActions=!1,zInvEntId="",zInvMod="",zInvRelId="",ZB_ESTIMATE_POST=1,ZB_ESTIMATE_EDITPAGE=5,div_on_hover=!1,div_on_click=!1,li_hover_class="li_hover",cur=-1,CaretPos=0,focusRange="",appAct=null,appMod=null,appRecId=null,appObj=null,appObj1=null,JElem=null,currAppLevel=-1,isWFExecuted=!1,isDeletedUserDetailsAvail=!1;function getObj(e,t){var i,a,s;for(t||(t=document),(i=e.indexOf("?"))>0&&parent.frames.length&&""!=e.substring(i+1)&&null!=e.substring(i+1)&&parent.frames[e.substring(i+1)]&&(t=parent.frames[e.substring(i+1)].document,e=e.substring(0,i)),!(s=t[e])&&t.all&&(s=t.all[e]),a=0;!s&&a<t.forms.length;a++)s=t.forms[a][e];for(a=0;!s&&t.layers&&a<t.layers.length;a++)s=getObj(e,t.layers[a].document);return!s&&t.getElementById&&(s=t.getElementById(e)),s||(s=t.getElementsByName(e)[0]),s}function getOpenerObj(e,t){var i="";if(void 0!==getObj("service")&&(i=getObj("service").value),"zcal"!==i&&"zcreator"!==i&&"zmail"!==i&&"mail"!==i&&opener)return t&&"undefined"!==t&&"null"!==t?opener.document[t].elements[e]:getObj(e,opener.document)}function findPosX(e){var t=0;if(document.getElementById||document.all){if(e)for(;e.offsetParent;)t+=e.offsetLeft,e=e.offsetParent}else document.layers&&(t+=e.x);return t}function showUserBusinessCard(e,t,i){if(i||(i=this),!t){var a=$(i).attr("data-params");t=(a?JSON.parse(a):{}).userId}Crm.getUserBusinessCard(t,i)}function hideUserBusinessCard(e){var t=document.getElementById("popoverTooltip");t&&t.component.hide()}function escapeSingleQuote(e){return e.replace(/'/g,"\\'")}function refreshFollowDiv(e,t){var i=document.getElementById("flw_spn_lnk");i&&(e&&t&&("Accounts"!=e||"Contacts"!=t&&"Potentials"!=t&&"Tasks"!=t&&"Events"!=t&&"Calls"!=t&&"Notes"!=t)&&("Leads"!=e&&"Contacts"!=e||"Tasks"!=t&&"Events"!=t&&"Calls"!=t&&"Emails"!=t&&"Notes"!=t)&&("Potentials"!=e||"Calls"!=t&&"Tasks"!=t&&"Events"!=t&&"Emails"!=t&&"Notes"!=t)||(i&&getObj("isthroughP")?($(i).empty(),i.innerHTML='<a id="pulseHistorylnk" class="smalledit" href="javascript:;" onclick="javascript:showPulseHistory(\'dlink\');sE(event);">'+getObj("awago").value+"</a>"):($(i).empty(),i.innerHTML=getObj("awago").value))),$("#timeLineContainerDV").html("").hide(),$("#timeLineContainerDataDV").html("").hide();var a=$("#newleft_UpdatedTime");0==a.length?1==Crm.userDetails.detailView_newUI?($(".last-updated-status").append('<span class="last-updated" id="newleft_UpdatedTime">'+I18n.getMsg("crm.calendar.lastsyncat")+" : "+I18n.getMsg("crm.general.a.while.ago")+"</span>"),detailView.lastupdateChecking()):$("#newleft_History").append('<span class="fR f10 pR15 lght27 gray crm-font-regular dB" id="newleft_UpdatedTime">'+I18n.getMsg("crm.calendar.lastsyncat")+" : "+I18n.getMsg("crm.general.a.while.ago")+"</span>"):($(a).text(I18n.getMsg("crm.calendar.lastsyncat")+" : "+I18n.getMsg("crm.general.a.while.ago")),1==Crm.userDetails.detailView_newUI&&detailView.lastupdateChecking()),$("#krp_Rightpanel_TimelineContainer").remove(),$("#krp_Conversation_Container").remove(),$$rightPanel.rpCachedList=["info"],$("#fromTaskPage").length||"true"===$("#iskanbanview").val()?($("#fromTaskPage").find("#rp_parent").show(),$('[id="timeLine_dv"]:visible').click()):(null==Crm.userDetails.CUSTOMIZE_INFO.SHOW_RIGHT_PANEL||Crm.userDetails.CUSTOMIZE_INFO.SHOW_RIGHT_PANEL)&&($("#rp_parent").show(),$("#kso_rightpanel_title").find('a[tabname="info"]').click(),$$rightPanel.rpCachedList=["info"]),$("#newleft_History").hasClass("sel")&&Crm.userDetails.detailView_newUI&&detailView.switchTab(this,"Info")}function toggleDivDispById(e){var t=getObj(e);t&&("none"==t.style.display?t.style.display="":t.style.display="none")}function disablePerfectScroll(e){thirdPartyUtils.unbindPerfectScroll("#"+e)}function enablePerfectScroll(e){thirdPartyUtils.bindPerfectScroll("#"+e,{wheelSpeed:1,wheelPropagation:!0,suppressScrollX:!1})}function getObjFromPopup(e,t){var i=t.find('[id="'+e+'"]').length?t.find('[id="'+e+'"]')[0]:t.find('[name="'+e+'"]')[0];return void 0===i&&window.isFromOutlookPlugin&&(i=window.opener.$.find('[id="'+e+'"]').length?window.opener.$.find('[id="'+e+'"]')[0]:window.opener.$.find('[name="'+e+'"]')[0]),i}function findPosY(e){var t=0;if(document.getElementById||document.all)for(;e&&e.offsetParent;)t+=e.offsetTop,e=e.offsetParent;else document.layers&&(t+=e.y);return t}function openHelp(e,t){if(!(Crm.userDetails.DEPLOYMENT.includes("China")||Crm.userDetails.DEPLOYMENT.includes("skyDesk")||Crm.userDetails.LOCALE.includes("zh")||isMobileBrowser())){if(e.includes("crm/help/templates/email-template-new.html"))return void openKB("Email Templates");if(e.includes("crm/help/customization/conditional-layouts.html"))return void openKB("Conditional Layout");if(e.includes("crm/help/automation/scoring-rules.html"))return void openKB("Scoring Rules");if(e.includes("data-administration/import-data.html"))return void openKB("Data Import");if(e.includes("data-administration/data-backup.html"))return void openKB("Data Backup");if(e.includes("migrate-data.html"))return void openKB("Data Migration");if(e.includes("gamescope/configure-gamescope.html")||e.includes("gamescope/reward-management.html"))return void openKB("Gamescope");if(e.includes("customization/validation-rules.html"))return void openKB("Validation Rules");if(e.includes("automation/approval-process.html"))return void openKB("Approval Process");if(e.includes("help/blueprint/index.html")||e.includes("help/automation/processautomation-rules.html"))return void openKB("Blueprint");if(e.includes("automation/assignment-rules.html"))return void openKB("Assignment Rules");if(e.includes("Compliance"))return void openKB("Compliance");if(e.includes("help/web-forms/set-up-web-forms.html"))return void openKB("Webforms");if("Webform_ABTesting"===e)return void openKB("Webform ABTesting");if(e.includes("help/customization/page-layouts.html"))return void openKB("Page Layouts");if(e.includes("help/zoho-phonebridge/index.html"))return void openKB("Telephony");if(e.includes("Sales-Signals-help"))return void openKB("Sales Signals");if(e.includes("Subforms-Help"))return void openKB("Subforms");if(e.includes("Interlinking Modules-Help"))return void openKB("Interlinking Modules");if(e.includes("SalesIQ Integration"))return void openKB("SalesIQ Integration");if(e.includes("ZCampaign Integration"))return void openKB("ZCampaign Integration");if(e.includes("Voc"))return void openKB("Voc");if(e.includes("Competitor Alert"))return void openKB("Competitor Alert");if(e.includes("Create Forecasts"))return void openKB("Forecast");if("Users-Help"==e)return void openKB("Users");if("BusinessHours"===e)return void openKB("Business Hours");if("Roles"===e||"Profiles"===e)return void openKB(e);if("Copy_Customization"==e)return void openKB("Copy Customization");if("external_Field"==e)return void openKB("CUSTOMIZE_CRM_ACCOUNT");if("undefined"!=typeof automationActions&&!automationActions.isHelpDocAvailable()){if(e.includes("automation/workflow-alerts.html"))return void openKB("Workflow Alert");if(e.includes("automation/workflow-tasks.html"))return void openKB("Task");if(e.includes("automation/workflow-field-updates.html"))return void openKB("Field Update");if(e.includes("automation/webhooks.html"))return void openKB("Webhook");if(e.includes("automation/custom-functions-programming.html"))return void openKB("Deluge");if(e.includes("automation/workflow-rules.html"))return void openKB("Workflow Rule")}}var i=e+"?crmprod=1";e.indexOf("?src=")>0&&(i=e+"&crmprod=1"),t&&(i=i+"#"+t),window.open(i,"help","toolbar=no,statusbar=no,menubar=no,directories=no,scrollbars=yes,resizeable=yes,menubar=no,width=700,height=600")}function emptyCheck(e,t,i,a,s){var r=e;if(null!=e&&"string"==typeof e&&(r=getElm(a,e)),null!=r&&r.length>1&&"radio"==r[0].type)for(var o=0;o<r.length;o++)r[o].checked&&(r=r[o]);if(null!=r&&i&&(""==r.value||"combo"==i&&"none"==r.value)&&!r.disabled){alert(I18n.getValueForFields("crm.field.none.check",t)),r.setAttribute("autocomplete","off");try{r.focus()}catch(e){}return!1}if(null==r||null==r.value||0!=r.value.replace(/^\s+/g,"").replace(/\s+$/g,"").length||r.disabled)return!0;alertMsg=I18n.getValueForFields("crm.field.empty.check",t),"inline"===s?$(r).closest(".labelValCreate").length||$(r).closest(".validErrMsg").length?Crm.showErrorMsg($ESAPI.encoder().encodeForHTML(alertMsg),$(r)):renderingUtils.displayErrorDiv("string"==typeof e?e:t,void 0,alertMsg,r):crmui.showMsgBand("error",$ESAPI.encoder().encodeForHTML(alertMsg),3e3,""),r.setAttribute("autocomplete","off");try{r.focus()}catch(e){}return!1}function patternValidate(e,t,i,a,s,r,o,n){a||r||null==(r=getElm(s,e))&&(r=getElm(s,"property('+fldLabel+')"));var l=t.replace(/_____/g,")").replace(/____/g,"(").replace(/___/g,".");$("#module").val();if(a)d=e;else var d=r.value;if("EMAIL"==i.toUpperCase()){var c=validationUtils.emailRegex;null!=n&&"User"==n&&(c=validationUtils.emailRegexOfUser)}if("DATE"==i.toUpperCase()){var u=Crm.userDetails.DATE_PATTERN?Crm.userDetails.DATE_PATTERN.toUpperCase():userDateFrmtinCE;try{return new CrmDate(CrmDateUtils.getDateObjectFromString(d,u)).validate()}catch(e){return!1}}if("TIME"==i.toUpperCase())c=/^\d{1,2}(\:\d{1,2})*$/;if(alertMsg=I18n.getValueForFields("crm.field.valid.check",l),"PHONE"==i.toUpperCase()){if(!validationUtils.isValidPhoneNo($(r),d))return Search.isVRCriteria?$(".validationRuleCongureWarningMsg").text(alertMsg).show():renderingUtils.displayAlert(e,void 0,alertMsg,r,o),a||(r.setAttribute("autocomplete","off"),r.focus()),!1}else if(!validationUtils.validatePattern(c,trimBoth(d)))return Search.isVRCriteria?$(".validationRuleCongureWarningMsg").text(alertMsg).show():renderingUtils.displayAlert(e,void 0,alertMsg,r,o),a||(r.setAttribute("autocomplete","off"),r.focus()),!1}function emailValidate(e,t,i,a,s){return 0!=patternValidate(e,t,"EMAIL",void 0,i,void 0,a,s)}function splitDateVal(e){var t=new Array(3),i=Crm.userDetails.DATE_PATTERN?Crm.userDetails.DATE_PATTERN.toUpperCase():userDateFrmtinCE,a=CrmDateUtils.getDateObjectFromString(e,i);return t[0]=a.getDate(),t[1]=a.getMonth()+1,t[2]=a.getFullYear(),t}function comparingDates(e,t,i,a,s,r,o){var n;switch(s){case"L":e>=i&&(n=I18n.getValueForFields("crm.custom.field.less.than",[t,a]));break;case"LE":e>i&&(n=I18n.getValueForFields("crm.custom.field.less.than.equalto",[t,a]));break;case"E":e!=i&&(n=I18n.getValueForFields("crm.custom.field.equalto",[t,a]));break;case"G":e<=i&&(n=I18n.getValueForFields("crm.custom.field.greater.than",[t,a]));break;case"GE":e<i&&(n=I18n.getValueForFields("crm.field.comparision.check",[t,a]))}if(n){var l=getObj(t)?getObj(t):o?getObj(o):void 0;return renderingUtils.displayAlert(t,t,n,l,r),!1}return!0}function getElm(e,t){if(t=escapeSingleQuote(t),e)var i=$("[name='"+e+"'] [name='"+t+"'], [name='"+e+"'] [id='"+t+"']");else i=$("[name='"+t+"'],[id='"+t+"']");return i.length>1?i:i[0]}function dateTimeValidate(e,t,i,a,s,r,o){var n=getElm(s,e),l=i.replace(/_____/g,")").replace(/____/g,"(").replace(/___/g,".");n||(e="property("+i+")",t=i);getObj("module")&&getObj("module").value;var d=getElm(s,e).value.replace(/^\s+/g,"").replace(/\s+$/g,""),c=I18n.getValueForFields("crm.field.valid.check",l);if(!Utils.isValidDate(Crm.userDetails.DATE_PATTERN,d))return renderingUtils.displayAlert(e,i,c,n,r),!1;if(document.getElementById("iskanbanview")&&"true"===document.getElementById("iskanbanview").value){if($("[fldlabel='"+i+"']").length>0)var u=$("[fldlabel='"+i+"']").val().split(":");else u=$("#"+t).val().split(":");m=u[0],p=u[1]}else{if(getElm(s,t+"hour"))var m=getElm(s,t+"hour").value.replace(/^\s+/g,"").replace(/\s+$/g,"");else m=getElm(s,"property("+t+"hour)").value.replace(/^\s+/g,"").replace(/\s+$/g,"");if(getElm(s,t+"minute"))var p=getElm(s,t+"minute").value.replace(/^\s+/g,"").replace(/\s+$/g,"");else p=getElm(s,"property("+t+"minute)").value.replace(/^\s+/g,"").replace(/\s+$/g,"")}if("HH:mm"!==Crm.userDetails.TIME_FORMAT){if(document.getElementById("iskanbanview")&&"true"===document.getElementById("iskanbanview").value){if("Call Start Time"!==i)if($('[fldlabel="'+i+'"]').attr("time"))var f=$('[fldlabel="'+i+'"]').attr("time").split(":")[2];else{var v=i+"_ampmSpan";if($("#"+v).length>0)f=$("#"+v).attr("ampm");else if(v=t+"ampmSpan",$("#"+v).length>0)f=$("#"+v).attr("ampm")}else if($("span[id='Call Start Time_ampmSpan']").length>0)f=$("span[id='Call Start Time_ampmSpan']").attr("ampm");else if(v=t+"ampmSpan",$("#"+v).length>0)f=$("#"+v).attr("ampm");g=f}else if(getElm(s,t+"ampm"))var g=getElm(s,t+"ampm").value.replace(/^\s+/g,"").replace(/\s+$/g,"");else var g=getElm(s,"property("+t+"ampm)").value.replace(/^\s+/g,"").replace(/\s+$/g,"");if("PM"==g&&m>12||"AM"==g&&m>12||"AM"!=g&&"PM"!=g)return renderingUtils.displayAlert(timefldName,i,c,n,r),!1;"PM"==g&&m<12&&m>=0?m=parseInt(m)+12:"AM"===g&&"12"===m&&(m=0)}if(m>23||m<0||p>59||p<0)return renderingUtils.displayAlert(t,i,c,n,r),!1;if(0==patternValidate(m+":"+p,i,"TIME",!0,s,void 0,r))return!1;var h=new Date,C=Utils.convertUsrtoDefaultDatePattern(d);C.setHours(m),C.setMinutes(p);var w=I18n.getMsg("currentDateTime");return!("OTH"!=a&&!o)||(!!comparingDates(C,i,h,w,a,r)||(getElm(s,e).setAttribute("autocomplete","off"),getElm(s,e).focus(),!1))}function dateTimeComparison(e,t,i,a,s,r,o,n,l){var d=getElm(n,e).value.replace(/^\s+/g,"").replace(/\s+$/g,"");getElm(n,e);if(getElm(n,a))var c=getElm(n,a).value.replace(/^\s+/g,"").replace(/\s+$/g,"");else if(getElm(n,r))c=getElm(n,r).value.replace(/^\s+/g,"").replace(/\s+$/g,"");if(getElm(n,t+"hour")&&getElm(n,t+"minute")){var u=getElm(n,t+"hour").value.replace(/^\s+/g,"").replace(/\s+$/g,""),m=getElm(n,t+"minute").value.replace(/^\s+/g,"").replace(/\s+$/g,"");"HH:mm"!=timeFrmat&&("PM"==(g=getElm(n,t+"ampm").value.replace(/^\s+/g,"").replace(/\s+$/g,""))?(0==u.indexOf("0")&&(u=u.substr(1)),u<12&&(u=parseInt(u)+12)):"AM"==g&&12==u&&(u=0))}else if(getElm(n,"property("+i+"hour)")&&getElm(n,"property("+i+"minute)")){u=getElm(n,"property("+i+"hour)").value.replace(/^\s+/g,"").replace(/\s+$/g,""),m=getElm(n,"property("+i+"minute)").value.replace(/^\s+/g,"").replace(/\s+$/g,"");if("HH:mm"!==Crm.userDetails.TIME_FORMAT)"PM"==(g=getElm(n,"property("+i+"ampm)").value.replace(/^\s+/g,"").replace(/\s+$/g,""))?(0==u.indexOf("0")&&(u=u.substr(1)),u<12&&(u=parseInt(u)+12)):"AM"==g&&12==u&&(u=0)}else{var p=(d=getElm(n,"value_"+i).innerHTML).indexOf(":"),f=d.substring(0,p-3),v=d.substring(p-2,d.length);d=f;var g;u=(b=(w=v.split(" "))[0].split(":"))[0],m=b[1];if("HH:mm"!==Crm.userDetails.TIME_FORMAT)"PM"==(g=w[1])?(0==u.indexOf("0")&&(u=u.substr(1)),u<12&&(u=parseInt(u)+12)):"AM"==g&&12==u&&(u=0)}if(getElm(n,s+"hour")&&getElm(n,s+"minute")){var h=getElm(n,s+"hour").value.replace(/^\s+/g,"").replace(/\s+$/g,""),C=getElm(n,s+"minute").value.replace(/^\s+/g,"").replace(/\s+$/g,"");if("HH:mm"!==Crm.userDetails.TIME_FORMAT)"PM"==(T=getElm(n,s+"ampm").value.replace(/^\s+/g,"").replace(/\s+$/g,""))?(0==h.indexOf("0")&&(h=h.substr(1)),h<12&&(h=parseInt(h)+12)):"AM"==T&&12==h&&(h=0)}else if(getElm(n,"property("+r+"hour)")&&getElm(n,"property("+r+"minute)")){h=getElm(n,"property("+r+"hour)").value.replace(/^\s+/g,"").replace(/\s+$/g,""),C=getElm(n,"property("+r+"minute)").value.replace(/^\s+/g,"").replace(/\s+$/g,"");if("HH:mm"!==Crm.userDetails.TIME_FORMAT)"PM"==(T=getElm(n,"property("+r+"ampm)").value.replace(/^\s+/g,"").replace(/\s+$/g,""))?(0==h.indexOf("0")&&(h=h.substr(1)),h<12&&(h=parseInt(h)+12)):"AM"==T&&12==h&&(h=0)}else{var w;p=(c=getElm(n,"value_"+r).innerHTML).indexOf(":"),f=c.substring(0,p-3),v=c.substring(p-2,c.length);c=f;var b,T;h=(b=(w=v.split(" "))[0].split(":"))[0],C=b[1];if("HH:mm"!==Crm.userDetails.TIME_FORMAT)"PM"==(T=w[1])?(0==h.indexOf("0")&&(h=h.substr(1)),h<12&&(h=parseInt(h)+12)):"AM"==T&&12==h&&(h=0)}var I=splitDateVal(d),y=splitDateVal(c);dd1=I[0],mm1=I[1],yyyy1=I[2],dd2=y[0],mm2=y[1],yyyy2=y[2];var P=new Date,_=new Date;if(P.setYear(yyyy1),P.setMonth(mm1-1),P.setDate(dd1),P.setHours(u),P.setMinutes(m),_.setYear(yyyy2),_.setMonth(mm2-1),_.setDate(dd2),_.setHours(h),_.setMinutes(C),"OTH"!=o){$("#module").val();return!!comparingDates(P,i,_,r,o,alerType)||(getElm(n,e).setAttribute("autocomplete","off"),getElm(n,e).focus(),!1)}return!0}function isLeapYear(e){return e%400==0||e%100!=0&&e%4==0}function dateValidate(e,t,i,a,s,r){(s=s||getElm(a,e))||(s=getElm(a,e="property("+t+")"));var o=t.replace(/_____/g,")").replace(/____/g,"(").replace(/___/g,".");getObj("module")&&getObj("module").value;var n=s.value.replace(/^\s+/g,"").replace(/\s+$/g,""),l=I18n.getValueForFields("crm.field.valid.check",o);return!!Utils.isValidDate(Crm.userDetails.DATE_PATTERN,n)||(renderingUtils.displayAlert(e,t,l,s,r),!1)}function dateComparison(e,t,i,a,s,r){var o=getObj(e).value.replace(/^\s+/g,"").replace(/\s+$/g,"");if(getObj(i))var n=getObj(i).value.replace(/^\s+/g,"").replace(/\s+$/g,"");else n=getObj("value_"+a).innerHTML.replace(/^\s+/g,"").replace(/\s+$/g,"");var l=splitDateVal(o),d=splitDateVal(n);dd1=l[0],mm1=l[1],yyyy1=l[2],dd2=d[0],mm2=d[1],yyyy2=d[2];var c=new Date(yyyy1,mm1-1,dd1),u=new Date(yyyy2,mm2-1,dd2);return"OTH"==s||(!!comparingDates(c,t,u,a,s,r,e)||(getObj(e).setAttribute("autocomplete","off"),getObj(e).focus(),!1))}function timeValidate(e,t,i,a,s){if(0==patternValidate(e,t,"TIME",void 0,a,void 0,s))return!1;var r=t.replace(/_____/g,")").replace(/____/g,"(").replace(/___/g,"."),o=($("#module").val(),getElm(a,e).value.replace(/^\s+/g,"").replace(/\s+$/g,"")),n=parseInt(o.substring(0,o.indexOf(":"))),l=parseInt(o.substring(o.indexOf(":")+1,o.length)),d=getElm(a,e);if(alertMsg=I18n.getValueForFields("crm.field.valid.check",r),n>23||l>59)return renderingUtils.displayAlert(e,t,alertMsg,d,s),d.setAttribute("autocomplete","off"),d.focus(),n>23&&selInvalidText(getElm(a,e),n),l>59&&selInvalidText(getElm(a,e),l),!1;var c=new Date,u=new Date;return u.setHours(n),u.setMinutes(l),"OTH"==i||(!!comparingDates(u,t,c,"current time",i,s)||(getElm(a,e).setAttribute("autocomplete","off"),getElm(a,e).focus(),!1))}function timeComparison(e,t,i,a,s,r,o){var n=getElm(r,e).value.replace(/^\s+/g,"").replace(/\s+$/g,""),l=getElm(r,i).value.replace(/^\s+/g,"").replace(/\s+$/g,""),d=n.substring(0,n.indexOf(":")),c=n.substring(n.indexOf(":")+1,n.length),u=l.substring(0,l.indexOf(":")),m=l.substring(l.indexOf(":")+1,l.length),p=new Date,f=new Date;return p.setHours(d),p.setMinutes(c),f.setHours(u),f.setMinutes(m),"OTH"==s||(!!comparingDates(p,t,f,a,s,o)||(getElm(r,e).setAttribute("autocomplete","off"),getElm(r,e).focus(),!1))}function decimalValidate(e,t,i,a,s){var r=e;null!=e&&"string"==typeof e&&((r=getElm(a,e))||(r=getElm(a,e="property("+t+")")));var o=t.replace(/_____/g,")").replace(/____/g,"(").replace(/___/g,".");$("#module").val();if(null!=r&&0!=r.value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){var n=r.value.replace(/^\s+/g,"").replace(/\s+$/g,"");if("any"!=i&&0!=parseInt(i))var l=new RegExp("^-?\\d+((\\d)+)*(\\.\\d{1,"+i+"})?$");if(0==n.split(".")[0].length&&(n=0+n),/^-?\d+(\.\d\d*)*$/.test(n)){if(void 0===l||l.test(n))return!0;var d=I18n.getValueForFields("crm.field.valid.decimal.cal.check",[o,i]);return renderingUtils.displayAlert(e,t,d,r,s),r.setAttribute("autocomplete","off"),r.focus(),!1}return d=I18n.getValueForFields("crm.field.valid.check",o),renderingUtils.displayAlert(e,t,d,r,s),r.setAttribute("autocomplete","off"),r.focus(),!1}return!0}function numValidate(e,t,i,a,s){var r=getElm(a,e),o=r.value.replace(/^\s+/g,"").replace(/\s+$/g,"");if(null!=r&&0!=r.value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if("any"!=i&&0!=parseInt(i))var n="^-?\\d+((\\d)+)*(\\.\\d{1,"+(i=i.split(","))[0]+"})?$",l=new RegExp(n);else l=/^-?\d+((\d)+)*(\.\d{1,2})?$/;return l.test(o)?(r.value=o,!0):("inline"==$("#fieldUpdateValidationType").val()||"inline"==s?renderingUtils.displayErrorDiv(e,t,I18n.getValueForFields("crm.field.valid.check",t)):alert(I18n.getValueForFields("crm.field.valid.check",t)),r.setAttribute("autocomplete","off"),r.focus(),!1)}return!0}function phoneValidate(e,t,i,a){return 0!=patternValidate(e,t,"PHONE",void 0,i,void 0,a)}function intValidate(e,t,i,a){var s=getElm(i,e);if(null!=s&&0!=s.value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){var r=getElm(i,e).value.replace(/^\s+/g,"").replace(/\s+$/g,""),o=I18n.getValueForFields("crm.field.valid.check",t);if(validationUtils.isValidInteger(r))return s.value=s.value.replace(/^\s+/g,"").replace(/\s+$/g,""),!0;null!=a&&(o=I18n.getValueForFields("crm.field.valid.check",$ESAPI.encoder().encodeForHTML(t))),renderingUtils.displayAlert(e,t,o,s,a),s.setAttribute("autocomplete","off");try{s.focus()}catch(e){}return!1}return!0}function numConstComp(e,t,i,a,s,r){var o=getElm(s,e);if(!o&&!(o=getElm(s,e="property("+t+")")))return!0;var n=parseFloat(getElm(s,e).value.replace(/^\s+/g,"").replace(/\s+$/g,""));a=parseFloat(a);var l=t.replace(/_____/g,")").replace(/____/g,"(").replace(/___/g,"."),d=($("#module").val(),!0);switch(i){case"L":n>=a&&(alertMsg=I18n.getValueForFields("crm.custom.field.less.than",[l,a]),renderingUtils.displayAlert(e,t,alertMsg,o,r),d=!1);break;case"LE":n>a&&(alertMsg=I18n.getValueForFields("crm.custom.field.less.than.equalto",[l,a]),renderingUtils.displayAlert(e,t,alertMsg,o,r),d=!1);break;case"E":n!=a&&(alert(I18n.getValueForFields("crm.custom.field.equalto",[l,a])),d=!1);break;case"NE":n==a&&(alertMsg=I18n.getValueForFields("crm.custom.field.not.equalto",[l,a]),renderingUtils.displayAlert(e,t,alertMsg,o,r),d=!1);break;case"G":n<=a&&(alertMsg=I18n.getValueForFields("crm.custom.field.greater.than",[l,a]),renderingUtils.displayAlert(e,t,alertMsg,o,r),d=!1);break;case"GE":n<a&&(alertMsg=I18n.getValueForFields("crm.field.comparision.check",[l,a]),renderingUtils.displayAlert(e,t,alertMsg,o,r),o.setAttribute("autocomplete","off"),d=!1)}return 0!=d||(o.focus(),!1)}function selInvalidText(e,t){e.setSelectionRange(e.value.indexOf(t),parseInt(e.value.indexOf(t)+t.length))}function formValidate(e,t,i,a,s,r,o){for(var n=!0,l=t||window.fieldname,d=i||window.fieldlabel,c=a||window.fielddatatype,u=$("#quick_module").val(),m=$("#leContModSel").val(),p=$("#leContModId").val(),f=0;f<l.length;f++){var v=c[f].split("~");if(e&&"null"!==e&&"undefined"!==e){var g=l[f].replace(/'/g,"\\'");h=$("[name='"+e+"'] [name='"+g+"']")[0]}else var h=getObj(l[f]);var C=l[f];if(!h&&g&&-1!==g.indexOf("Owner")){h=$("[name='"+e+"'] [name='property(ownerId)']")[0];var w=$(h).data();w&&8===w.uitype?C="property(ownerId)":h=void 0,$(h).closest("#call_qowner").hasClass("changeOwnerDisabled")&&(s="inline",$("#call_qowner").focus())}h&&r&&Crm.checkIfLookUpAndLookUpValue($(h));var b="M"===v[1],T=$(h).data();if(Crm.userDetails.LITE.IS_LITE_USER&&T&&8===T.uitype&&(b=!0),CFRExec&&validationUtils.isNotEmpty(CFRExec.QCObj)&&T){if(T.colname&&CFRExec.isLayoutRuleHiddenElem(T.colname))continue;b||!0!==T.mandate&&"true"!==T.mandate?b&&T.colname&&CFRExec.isLayoutRuleHiddenElem(T.colname)&&(b=!1):b=!0}if(b)if("property(DurationInMinute)"===l[f]||"property(DurationInSecond)"===l[f]||"property(Call Duration)"===l[f]){var I=0!=jQuery("input[name=whichCall]:checked").length?jQuery("input[name=whichCall]:checked").val():"",y=$("#Crm_Calls_CALLTYPE").children("option:selected").attr("actualvalue");"ScheduleCall"!==I&&"CurrentCall"!==I&&"Missed"!==y&&(emptyCheck(l[f],d[f],void 0,e,s)||(n=!1))}else emptyCheck(C,d[f],void 0,e,s)||(n=!1);switch(v[0]){case"O":case"V":case"C":break;case"E":h&&null!=h&&0!=h.value.replace(/^\s+/g,"").replace(/\s+$/g,"").length&&(emailValidate(l[f],d[f],e,s,o)||(n=!1));break;case"DT":if(null!=h&&0!=h.value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(void 0===v[3])var P="OTH";else P=v[3];dateTimeValidate(l[f],v[2],d[f],P,e,s)||(n=!1),v[4]&&(dateTimeComparison(l[f],v[2],d[f],v[5],v[6],v[7],v[4],e,s)||(n=!1))}break;case"D":if(null!=h&&0!=h.value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(void 0===v[2])P="OTH";else P=v[2];dateValidate(l[f],d[f],P,e,void 0,s)||(n=!1),v[3]&&(dateComparison(l[f],d[f],v[4],v[5],v[3],s)||(n=!1))}break;case"T":if(null!=h&&0!=h.value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(void 0===v[2])var _="OTH";else _=v[2];timeValidate(l[f],d[f],_,e,s)||(n=!1),v[3]&&(timeComparison(l[f],d[f],v[4],v[5],v[3],e,s)||(n=!1))}break;case"I":null!=h&&0!=h.value.replace(/^\s+/g,"").replace(/\s+$/g,"").length&&(intValidate(l[f],d[f],e,s)||(n=!1),v[2]&&(numConstComp(l[f],d[f],v[2],v[3],e,s)||(n=!1)),"property(Probability)"==l[f]&&(h.value>100?(renderingUtils.displayAlert(l[f],d[f],I18n.getMsg("crm.criteria.editor.probability.value.exceed"),h,s),n=!1):h.value<0&&(renderingUtils.displayAlert(l[f],d[f],I18n.getValueForFields("crm.field.valid.check",$ESAPI.encoder().encodeForHTML(d[f])),h,s),n=!1)));break;case"B":null!=h&&0!=h.value.replace(/^\s+/g,"").replace(/\s+$/g,"").length&&(intValidate(l[f],d[f],e,s)||(n=!1),v[2]&&(numConstComp(l[f],d[f],v[2],v[3],e,s)||(n=!1)));break;case"DE":if(null!=h&&0!=h.value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(void 0===v[2])var D="any";else D=v[2];decimalValidate(l[f],d[f],D,e,s)||(n=!1),v[3]&&(numConstComp(l[f],d[f],v[2],v[3],e,s)||(n=!1))}break;case"N":if(null!=h&&0!=h.value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(void 0===v[2])D="any";else D=v[2];numValidate(l[f],d[f],D,e,s)||(n=!1),v[3]&&(numConstComp(l[f],d[f],v[3],v[4],e,s)||(n=!1))}break;case"P":null!=h&&0!=h.value.replace(/^\s+/g,"").replace(/\s+$/g,"").length&&(phoneValidate(l[f],d[f],e,s)||(n=!1));break;case"W":if(null!=h&&0!=h.value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(e)var O=document[e][l[f]];else O=document.getElementsByName(l[f])[0];validationUtils.isValidWebUrl(O.value)||(alertMsg1=I18n.getValueForFields("crm.field.valid.check","Website"),renderingUtils.displayAlert("url","Website",alertMsg1,O,s),n=!1)}break;case"CL":null!=h&&0!=h.value.replace(/^\s+/g,"").replace(/\s+$/g,"").length&&(checkSplChars(l[f],d[f])||(n=!1));break;case"R":null!=h&&0!=h.value.replace(/^\s+/g,"").replace(/\s+$/g,"").length&&(checkMatchForRegex(l[f],d[f])||(n=!1));break;case"L":if(h){var S=(h=$(h)).data(),L=h.val();if(!(S&&S.id&&S.hasOwnProperty("selectedlookupvalue")&&""!=h.attr("data-selectedlookupvalue"))||""===L&&void 0===h[0].value||h.attr("data-old-value")==L||L==h[0].value&&h.attr("data-old-value")!=L&&L==h.attr("data-selectedlookupvalue")||(S.id=null,$("#"+h[0].id).data("id",null),h.data("id",null)),S&&!S.id&&L&&L.trim()&&S.lookupModule){var E=moduleRecordMapping[S.lookupModule].singular_label;renderingUtils.displayAlert(l[f],d[f],I18n.getMsg("crm.label.lookup.norecord",E),h,s),n=!1}else if(S&&L&&!S.id&&"property(Account Name)"===l[f]&&"Potentials"!==u){var x=I18n.getMsg("crm.label.lookup.norecord",moduleRecordMapping.Accounts.singular_label);crmui.showMsgBand("error",$ESAPI.encoder().encodeForHTML(x,h,s),3e3,""),n=!1}if("Tasks"===u&&"property(modname)"===l[f]&&"Leads"===m&&""!==S.id&&""!==p){x=I18n.getMsg("crm.import.error.invalid.data");crmui.showMsgBand("error",$ESAPI.encoder().encodeForHTML(x,h,s),3e3,""),n=!1}}}}var F=$("[name='"+e+"'] #quick_module").val();"Calls"===F&&(!1===validateCallTime2(e)&&(n=!1));if(F||(F=$("[name='"+e+"'] input[name=searchModule]").val()),"Campaigns"===F){var V=$("input[name=zohoSurveyCampaign]");if(V&&"true"===V.val())!1===ZSurvey.validateQCreateCampSurveyExtraFields(e)&&(n=!1)}return n}function clearId(e,t){var i=void 0;t&&(i=$(t).closest("form")[0].name);var a=getElm(i,e);a&&(a.value=""),$("#cvEditSave")[0]&&"block"===$("#cvEditSave")[0].style.display&&($('[id="cvEditSave"] [id="'+e+'"]')[0].value="")}function removeInsertedScripts(){if(null!=document.getElementById("insertedscript1")&&null!=document.getElementById("insertedscript2")){var e=document.getElementById("insertedscript1"),t=document.getElementById("insertedscript2");e.parentNode.removeChild(e),t.parentNode.removeChild(t)}}function openPopUp(e,t,i,a,s,r,o){var n=!1;if(i&&i.split("?")[1]){var l=i.split("?")[1];n="send_mail"===(c=(d=objectUtils.parseURLParamString(l)).action)||"sendReminder"===c}if(Crm.userDetails.isNewEditor&&n){l=i.split("?")[1];var d,c,u,m=(d=objectUtils.parseURLParamString(l)).module,p=d.entId,f=d.userIds;if(n="send_mail"===(c=d.action)||"sendReminder"===c)return"sendReminder"===c&&(u="sendReminder",EmailComposeUtil.ReminderMail={},EmailComposeUtil.ReminderMail.userId=f),void EmailLaunchUtil.SendMailEvent(m,p,u)}if(i=Crm.getOrgSpecificURL(i),"undefined"!=typeof crmNewPortal&&crmNewPortal)Crm.showURLChangeAlert(!1);else{var v=parseInt(findPosX(t)),g=parseInt(findPosY(t));if(g+=parseInt(t.offsetHeight),v+=scrX-pgeX,(g+=scrY-pgeY)+r+30>window.screen.height&&(g=findPosY(t)+(scrY-pgeY)-r-30),v+s>window.screen.width&&(v=findPosX(t)+(scrX-pgeX)-s),$("html").hasClass("win")&&(v=0),a=window.name==a?a+"_"+Math.floor(100*Math.random()):a,o="width="+s+",height="+r+",top=50,left="+v+","+o,"casereplyWin"==e&&"casereply"==a){var h=getObj("secondMail");null!=h&&(i+="&caseEmail="+h.value)}else"authGoogle"==e&&(window.name="zcrmmainwindow");if(-1!=i.indexOf("MailingLabel")){var C=customViewObject.selectedIds.join(";");if(null==document.getElementById("mailinglabel")){var w=document.createElement("form");w.setAttribute("id","mailinglabel"),$("#basic").append(w),document.getElementById("mailinglabel").target="_blank",document.getElementById("mailinglabel").method="post";var b=document.createElement("input");b.setAttribute("type","hidden"),b.setAttribute("name","idvals"),b.setAttribute("value",C),$("#mailinglabel").append(b)}else $("[name=idvals]").val(C);var T=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/ShowSelectedCustomView.do?&mailinglabel=true&module="+customViewObject.module);document.getElementById("mailinglabel").action=T,document.getElementById("mailinglabel").submit()}else if(window[e]&&window[e].close(),window[e]=window.open(i,a,o),window[e]&&"undefined"!=typeof EmailSendingUtil&&EmailSendingUtil&&EmailSendingUtil.switchedToOldEditor){window[e].switchedToOldEditor=!0,window[e].tempContent=EmailSendingUtil.tempContent,window[e].fromAddr=EmailSendingUtil.fromAddr,window[e].tempEditor=EmailSendingUtil.tempEditor,window[e].mailSubject=EmailSendingUtil.subject,window[e].toAddr=EmailSendingUtil.toAddr,window[e].fromAddr=EmailSendingUtil.fromAddr,window[e].toAddress=EmailSendingUtil.toAddress,window[e].ccAddr=EmailSendingUtil.ccAddr,window[e].bccAddr=EmailSendingUtil.bccAddr,window[e].replyTo=EmailSendingUtil.replyTo,window[e].attachArray=EmailSendingUtil.attachArray,window[e].inventObj=EmailSendingUtil.inventObj,window[e].ScheduledTime=EmailSendingUtil.ScheduledTime,window[e].ScheduleText=EmailSendingUtil.ScheduleText,EmailSendingUtil.tempContent="",EmailSendingUtil.tempEditor="richtext",EmailSendingUtil.subject="",EmailSendingUtil.toAddr="",EmailSendingUtil.ccAddr="",EmailSendingUtil.bccAddr="",EmailSendingUtil.attachArray=[],EmailSendingUtil.switchedToOldEditor=!1}}}function popUpListener(e){scrX=e.screenX,scrY=e.screenY,pgeX=e.pageX,pgeY=e.pageY}function toggle(){bottom_ig=getObj("hide"),ScrollEffect.lengthcount>=ScrollEffect.togglelimit?topple():(bottom_ig.style.display="block",ig.style.height=ScrollEffect.lengthcount+"px",ScrollEffect.lengthcount=ScrollEffect.lengthcount+3,ScrollEffect.lengthcount<ScrollEffect.togglelimit?setTimeout((function(){toggle()}),20):getObj("hide").style.display="block")}function topple(){button_ig=getObj("hide"),button_ig.style.display="none",ScrollEffect.lengthcount=ScrollEffect.lengthcount-3,ig.style.height=ScrollEffect.lengthcount+"px",ScrollEffect.lengthcount<ScrollEffect.topplelimit||setTimeout((function(){topple()}),30)}function trim(e){return e?e.replace(/\s+$/,""):""}function trimRight(e){return e.replace(/\s+$/,"")}function trimBoth(e){return"string"==typeof e?trimRight(trimLeft(e)):e}function trimLeft(e){return e.replace(/[\s| ]*/,"")}function splCharCheck(e){var t=splCharArray.length;for(i=0;i<t;i++)if(e.indexOf(splCharArray[i])>=0)return!1;return!0}ScrollEffect=function(){},ScrollEffect.lengthcount=0,ScrollEffect.closelimit=0,ScrollEffect.limit=0,ScrollEffect.togglelimit=0,ScrollEffect.topplelimit=0;var viewUserObject={splCharCheckUsers:function(e){var t=0,i=splCharUsersArray.length;for(t=0;t<i;t++)if(e.indexOf(splCharUsersArray[t])>=0)return!1;return!0}};function splCharCheckNew(e){for(i=0;i<splCharArrayNew.length;i++)if(e.indexOf(splCharArrayNew[i])>=0)return!1;return!0}function splCharCheckForTabs(e){for(i=0;i<splCharArrayForTabs.length;i++)if(e.indexOf(splCharArrayForTabs[i])>=0)return!1;return!0}function removeFreezeLayer(){var e=$(".temp_freezelayer");e.length>0?e.remove():$(".etTrendsWrapper").length||$(".etTrendsWrapperCNS").length||$(".freezeLayer").remove()}function incrId(e,t){for(var i=e.length-1;i>=0;i--){var a=e[i].id;if(a.indexOf("_")>-1){var s=a.substr(0,a.indexOf("_")+1);e[i].id=e[i].name=s+t}else{s=a.substr(0,a.indexOf("l")+1);e[i].id=e[i].name=s+t}}}function upgradeNow(e,t){document.location.href=Crm.getCrmBasePath()+"/PlanCrmAccount.do?plans="+e+"&srcplans="+t+"&actionName=PlanAccount"}function loadToolTip(e,t){var i=window.event||event;e||(e=i.target||i.srcElement);var a="";if(e.hasAttribute("data-toolTip"))a=e.getAttribute("data-toolTip");else{var s=history.state;s.backOneLevel&&(a=Crm.newHistoryArr[s.backOneLevel.historyIndex]?Crm.newHistoryArr[s.backOneLevel.historyIndex].toolTip:""),a?(a=I18n.getMsg("BackButton.back.to.name",decodeURIComponent(a)),e.hasAttribute("data-toolTip")||e.setAttribute("data-toolTip",a)):a=I18n.getMsg("BackButton.back")}zctt.showtt(revertSplChrs(a),void 0,void 0,void 0,"false")}var zctt=function(){var e,t=document,i=0,a=!!t.all,s=void 0;return{showtt:function(r,o,n,l,d,c,u,m,p){void 0===p&&(p=!0),null==e&&((e=t.createElement("div")).setAttribute("id","tooltip-zc"),e.setAttribute("data-zcqa","tooltip-zc"),u?u.appendChild(e):t.body.appendChild(e));var f=c||"tooltipzcdefault";e.setAttribute("class",f),e.style.display="block",e.style.position="absolute",e.style.zIndex="16",e.innerHTML=r,e.style.width=o?o+"px":"auto",!o&&a&&(e.style.width=e.offsetWidth),e.offsetWidth>400&&(e.style.width="400px"),h=parseInt(e.offsetHeight)+0,w=parseInt(e.offsetWidth)+0+20,0!=i&&clearTimeout(i),addEventInCrm(document.getElementById("tooltip-zc"),"mouseenter",(function(){e.style.display="block",clearTimeout(i)})),addEventInCrm(document.getElementById("tooltip-zc"),"mouseleave",(function(){m?i=setTimeout((function(){e.style.display="none"}),m):e.style.display="none",p&&(l?zctt.setpos(l,n):(s=d||void 0,t.onmousemove=zctt.setpos))})),l?zctt.setpos(l,n):(s=d||void 0,t.onmousemove=zctt.setpos)},hidett:function(a){e&&(i=setTimeout((function(){e.style.display="none"}),1==a?0:500),t.onmousemove=null)},setpos:function(i,r,o){if("block"==e.style.display){a&&(i=i||event);var n=a?i.clientY+$(document).scrollTop():i.pageY,l=a?i.clientX+$(document).scrollLeft():i.pageX;if(r){var d=renderingUtils.getTargetElem(i);l=$(d).offset().left}var c=t.body.clientWidth,u=t.body.clientHeight;l<0?(e.style.left="0px",e.style.right=""):l+w+0>c?(e.style.left="",e.style.right=c-l+0+"px"):(e.style.right="",e.style.left=l+0+"px"),n<0?(e.style.top="0px",e.style.bottom=""):s&&"true"==s?(e.style.top="",e.style.bottom=u-n+0+"px"):s&&"false"==s?(e.style.bottom="",e.style.top=n+0+"px"):n+h+0>u?(n+=50,e.style.top="",e.style.bottom=u-n+0+"px"):(e.style.bottom="",e.style.top=n+0+"px")}}}}();function roundNumber(e,t){return(Math.round((e*Math.pow(10,t)).toFixed(t-1))/Math.pow(10,t)).toFixed(t)}function addEventInCrm(e,t,i,a){a=a||!1,e.addEventListener?e.addEventListener(t,i,a):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i}function showHideSubMenu(e){hideMenu(e),showSubMenuLayer(),Activities.RemainderHideOnly(),$("#conditionalFieldRightSection").length&&(Crm.userDetails.RTL_ENABLED?$("#conditionalFieldRightSection").css("left","-650px"):$("#conditionalFieldRightSection").css("right","-650px")),$("#validationRuleRightSection").length&&$("#validationRuleRightSection").hide(),sE(e)}function sE(e){var t,i=renderingUtils.getTargetElem(e);try{t=i.getAttribute("data-cid")}catch(e){t=void 0}t||(e||(e=window.event),e&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()),i=null,"undefined"!=typeof ZDLibrary&&ZDLibrary.Launcher.isOpen()&&ZDLibrary.Launcher.close())}function qasE(e){if(getObj("Calendar")&&"block"==getObj("Calendar").style.display){var t=e||window.event;"INPUT"!=(t.target||t.srcElement).nodeName&&(getObj("Calendar").style.display="none",crmCalendar.calendarNode=void 0)}if(!e)e=window.event;e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),$(".dItimesdiv").length&&"INPUT"!=e.target.nodeName&&($(".dItimesdiv").hide(),$(".bestTimeListFilter").hide(),$(".tA").removeClass("tA"),crmBstTime.hideBestTimeSuggestion("QuickCreateTask"))}function doActionInAjax(e,t,i,a,s,r,o,n){var l=new getHTTPObject,d=null;s&&(d=csrfParamName+"="+encodeURIComponent(csrfToken)),a?l.open("GET",e,!0):l.open("POST",e,!0),l.onreadystatechange=function(){if(4==l.readyState)if(void 0===i||i==l.responseText)if(void 0!==t){var a=getObj(t);0!==$L(a).find("div[title|='Recommendation date']").length&&Crm.client_tracking("Zia Recommendation workflow delete");var s=$("#moduleSel");if(void 0!==a.dataset.module)var d=a.dataset.module;if(s.find("option").each((function(){if(this.value.indexOf(d+":")>-1){var e=this.value.split(":");return this.value=e[0]+":"+(parseInt(e[1])-1),!1}})),-1!=t.indexOf("home_")){var c=$("#"+t);void 0!==c.data("status")&&"undefined"!=typeof workflow&&(workflow.totalRulesCount--,"active"===c.data("status")&&workflow.activeRulesCount--,workflow.checkWFRuleCount()),0===c.parent().children("div").length?(a&&a.parentNode.removeChild(a),showWFtab("result",Crm.getCrmBasePath()+"/WorkFlowRule.do?step=showAllRules","wfrule")):a&&a.parentNode.removeChild(a)}else a&&a.parentNode.removeChild(a)}else void 0!==o&&(void 0!==n&&""!=n&&"result"===n?-1!=e.indexOf("delAlert")?Lyte.Router.transitionTo({route:"crm.settings.section.workflow-alerts.index-workflow-alert"}):-1!=e.indexOf("delTask")?Lyte.Router.transitionTo({route:"crm.settings.section.workflow-tasks.index-workflow-task"}):-1!=e.indexOf("delFieldUpdate")?Lyte.Router.transitionTo({route:"crm.settings.section.workflow-field-updates.index-workflow-field-update"}):-1!=e.indexOf("delWebHook")&&Lyte.Router.transitionTo({route:"crm.settings.section.workflow-webhooks.index-workflow-webhook"}):void 0!==n&&""!=n?loadUrl("result",o):document.location.href=o);else{if(-1!=l.responseText.indexOf("tError"))return void alert(I18n.getMsg("crm.alert.thresholdError"));void 0!==r&&alert(r)}},l.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),l.send(d),$("#deletepopup").is(":visible")&&hideAnimatePopup("deletepopup")}function EvalInnerScript(e,t){if(e&&e.getElementsByTagName)for(var i=e.getElementsByTagName("SCRIPT"),a=0;a<i.length;a++){var s=e.ownerDocument.createElement("SCRIPT");s.type="text/javascript",s.language="javascript",""!=i[a].src?s.src=i[a].src:("text/x-jquery-tmpl"!=i[a].type||"text/x-handlebars-template"!==i[a].type)&&(s.text=i[a].text),"text/x-jquery-tmpl"!==i[a].type&&"text/x-handlebars-template"!==i[a].type&&(t?$(t).append(s):i[a].parentNode.replaceChild(s,i[a]))}}function getAccessibleObj(e){var t=document.getElementById(e);if(t)return t;try{if(opener)return opener.document.getElementById(e)}catch(e){}}function reinitGlobalVars(){Search.rowcnt=1,Search.calform=""}function getAttr(e,t){return $(e).attr(t)}function showUpdateMsg(e){jQuery("#bulkUpdateSuccess").show(),mailsetCenter("bulkUpdateSuccess"),e?jQuery("#bulkUpdateSuccess").html(I18n.getMsg("crm.name.format.updated.successfully")):jQuery("#bulkUpdateSuccess").html(I18n.getMsg("crm.updated")),$("#bulkUpdateSuccess").fadeIn().delay(1500).fadeOut("slow")}function popup(e){getObj("parentCurrencyISOCode")&&getObj("parentExchangeRate")&&(e+="&parentCurrencyISOCode="+getObj("parentCurrencyISOCode").value+"&parentER="+getObj("parentExchangeRate").value),openPopUp("newWin","",Crm.getOrgSpecificURL(e),"newPopup",800,400,"menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes")}var getFileSize=function(e){var t=-1;return e&&"undefined"!=typeof FileReader&&(t=e.files[0].size),t};function getElemById(e){return document.getElementById(e)}function setVisibility(e,t){var i=getElemById(e);i&&(i.style.visibility=t)}function getEventXandY(e){var t=0,i=0;if(!e)e=window.event;return e.pageX||e.pageY?(t=e.pageX,i=e.pageY):(e.clientX||e.clientY)&&(t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),{left:t,top:i}}function formatNumber(e){return(e<10?"0":"")+e}function getLength(e){var t=0;for(var i in e)t++;return t}function unCheckChkBoxes(e){if(null!=(e=document.getElementsByName(e))){var t=e.length;if(null!=t)for(var i=0;i<t;i++)e[i].checked&&(e[i].checked=!1);else e.checked=!1}}function checkBoxCheckedCount(e){if(chkBoxElement=document.getElementsByName(e),null!=chkBoxElement){var t=0,i=chkBoxElement.length;if(null!=i)for(var a=0;a<i;a++)chkBoxElement[a].checked&&t++}return t}function getDocumentFragment(e){var t=document.createDocumentFragment();if(e){var i=document.createElement("div");i.innerHTML=e,t.appendChild(i.firstChild)}return t}function hideAnnouncement(){var e=$("#annoncement"),t=$(".downgrateMssBand");e.hide();var i=Crm.getCrmBasePath()+"/BannerTool.do?action=closeBanner",a="&"+csrfParamName+"="+csrfToken,s=e.find("#bannerName");s.length>0&&(a=a+"&bannerName="+encodeURIComponent(s.val())),$.ajax({type:"POST",url:i,dataType:"html",data:a,success:function(e){}}),t.length&&t.show(),crmLayout.Resize.All()}function trackBannerLink(e){var t=$(e).attr("trackerKey");if(void 0!==t){var i=Crm.getCrmBasePath()+"/BannerTool.do?action=trackBanner";$.ajax({type:"POST",url:i,dataType:"html",data:"&trackerKey="+encodeURIComponent(t)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),success:function(e){}})}return!0}function showAlertMessage(e,t,i,a){var s=getObj(e);s&&(1==t?(s.style.position="absolute",s.style.lineHeight="",s.style.fontSize="14px"):(s.className="redbox p10",s.style.textAlign="left",s.style.position="",s.style.lineHeight="1.5",s.style.fontSize="12px"),$(s).empty(),s.innerHTML=i,s.style.display="block",null!=a&&$("#"+e).delay(a).fadeOut())}function getDataType(e){return-1==(e=parseInt(e))||32==e?"int":36==e?"float":24===e||200===e||786===e||333===e||14===e?"date":301==e?"bool":"string"}function populateTimeVal(e){li_hover_class="li_hover",cur=-1,sTimeOut=void 0,availStat=void 0;var t=e?$(e):$(".ddTime");sdTime=void 0,constructList(),$("#sdiv,.AmpmnewValues").off("mouseleave").mouseleave((function(e){div_on_hover=!1})).off("mouseenter").mouseenter((function(e){div_on_hover=!0})),t.off("keyup keydown focus blur click"),t.on("keyup",(function(e){switch(e.keyCode){case 38:setPos(-1);e.preventDefault();break;case 40:setPos(1);e.preventDefault();break;case 37:case 39:break;case 13:"none"==$("#sdiv").css("display")?(this.setAttribute("time",this.value),-1!==cur&&parseTime($(this),$($(".AmpmnewValues li").get(cur)))):cur>0&&parseTime($(this),$($("#times li").get(cur))),$(".AmpmnewValues li").hasClass(li_hover_class)&&e.preventDefault(),$("#sdiv").hide(),$(".bestTimeListFilter").length&&($(".bestTimeListFilter").hide(),$(".tA").removeClass("tA"),crmBstTime.hideBestTimeSuggestion("QuickCreateTask")),$(".AmpmnewValues").addClass("hide");break;case 9:if($(this).hasClass("Crm_Calls_CALLSTARTDATETIME"))break;default:if(!$(this).hasClass("Crm_Calls_CALLSTARTDATETIME")){var t=$(this).val();$(this).val().length,t.substr(0,5);"HH:mm"!==Crm.userDetails.TIME_FORMAT&&appendAmpm(this,e),switchFocus(this),$("#bestTimeListFilterId").hide(),$("#sdiv").hide()}}})),t.on("focus",(function(e){var t,i;if((t=$(".bestTimeListFilter")).length&&(i=$(".bestTimeListFilter").outerHeight()),getObj("Calendar")&&"block"===getObj("Calendar").style.display){var a=e||window.event;a.target||a.srcElement;crmCalendar.calendarNode=void 0,getObj("Calendar").style.display="none"}if(sdTime=$(this),null!=sdTime.attr("readonly")&&"readonly"===sdTime.attr("readonly"))return!1;$(this).attr("autocomplete","off");$(this).offset();var s=$("#sdiv"),r=sdTime.closest("#ctinotifier").length>0,o=sdTime.closest(".topBandTime").length>0,n=$("#updateCallStatus").is(":visible");if(r){var l=sdTime.offset().left,d=sdTime.offset().top+sdTime.outerHeight()-$(window).scrollTop();s.css({top:d,left:l-1,position:"fixed"})}else if(o)l=sdTime.offset().left,d=sdTime.offset().top+sdTime.outerHeight();else{l=sdTime.offset().left,d=sdTime.offset().top+this.offsetHeight;$(".AmpmnewValues").hasClass("hide")&&(l=parseInt(l)-parseInt(28),d+=6,t.css({top:parseInt(d)+parseInt(287)-i,left:l}).show())}$(this).get(0);if($(".AmpmnewValues").hasClass("hide")&&(s.show(),s.css({top:d,left:l-1,position:""}),$("#searchCreatePopup .popup-model-content").on("scroll",(function(){$("#sdiv").hide()}))),n){d=sdTime.offset().top+sdTime.outerHeight()-$(window).scrollTop();if(Crm.userDetails.RTL_ENABLED)l=sdTime.offset().left-($(".ampmSpan#calltimefrmampmSpan").outerWidth()-1);else{l=sdTime.offset().left;t.css("left",l)}$(".AmpmnewValues").hasClass("hide")&&$(".dItimesdiv").length?(l=parseInt(l)-parseInt(28),d+=6,t.css({top:parseInt(d)+parseInt(287)-i,left:l}).show(),s.css({position:"absolute"})):s.css({position:"fixed"}),s.css({top:d,left:l-1})}setCTPos($(this).attr("time")),$(this).parent().hasClass("h24")?($("#sdiv").width("45"),$(this).css("margin-right","6px")):($("#sdiv").width("65"),$(this).css("margin-right","0px")),crmBstTime.showBestTimeInList()})),t.on("blur",(function(e){div_on_click||div_on_hover?div_on_click||setTimeout((function(){sdTime.focus()}),0):(parseTime($(this),void 0,!0),$("#sdiv").hide(),$(".bestTimeListFilter").hide(),$(".tA").removeClass("tA"),crmBstTime.hideBestTimeSuggestion("QuickCreateTask"),$(".AmpmnewValues").addClass("hide"),setDefault(),sdTime=void 0);div_on_click=!1})),t.on("keydown",(function(e){if(doGetCaretPosition(this),restrictType(e,this),13==e.keyCode)return e.preventDefault(),renderingUtils.stopEvent(e),!1})),t.on("click",(function(e){consoleCaretPos(this),crmBstTime.showBestTimeInList()})),t.each((function(){var e=$(this);e.parent().find("span").off("click").click((function(){setTimeout((function(){e.trigger("focus")}),0)}))})),t=null}function parseTime(e,t,i){var a,s,r,o,n=void 0===t;a=n?e.val().match(/(\d{1,2})(\d*):(\d{1,2})/):t.attr("time").split(":");var l=getFCT();if(a){var d=e.attr("fldlabel");if(n){if(s=parseInt(a[1],10),r=parseInt(a[3],10),"HH:mm"!==Crm.userDetails.TIME_FORMAT){var c=d+"_ampmSpan";-1!=d.indexOf("@{pattern}")&&(c=d.replace("@{pattern}","ampmSpan")),o=$("span[id='"+c+"']").attr("ampm")}}else s=parseInt(a[0],10),r=parseInt(a[1],10),o=a[2];s=s<12?formatNumber(s):s,r=formatNumber(r),o&&""!==o?(e.attr("time",[s,r,o].join(":")),$(".bestTimeListFilter").hasClass("bottomAlignClicked")||setTime([s,r,o].join(":"),i)):(e.attr("time",[s,r].join(":")),$(".bestTimeListFilter").hasClass("bottomAlignClicked")||setTime([s,r].join(":"),i))}else e.attr("time",l.F),$(".bestTimeListFilter").hasClass("bottomAlignClicked")||setTime(l.F)}function setDefault(){cur=-1}function setCTPos(e){var t=$("#times li[time='"+e+"']");if(t.length){cur=t.index();var i=t[0];$("#sdiv")[0].scrollTop=i.offsetTop-i.offsetHeight,setPos()}else $("#times li").removeAttr("class")}function getFCT(){var e="00",t="",i="00",a=new Date;a.getMinutes()>30?a.setHours(a.getHours()+1):e="30","HH:mm"!==Crm.userDetails.TIME_FORMAT?(t=a.getHours()>11?"PM":"AM",i=formatNumber((a.getHours()+11)%12+1)):i=formatNumber(a.getHours());var s=""!==t?[i,e,t].join(":"):[i,e].join(":");return{Hour:i,Min:e,AMPM:t,F:s}}function setTime(e,t){var i="object"==typeof e?$(e).attr("time"):e,a=i.split(":");if("HH:mm"===Crm.userDetails.TIME_FORMAT?a[0]>=24&&(a[0]="23","00"!==a[1]&&(a[1]="59")):a[0]>=12&&(a[0]="12"),sdTime){var s=sdTime.attr("fldlabel");if(sdTime.attr("isProperty"))$('input[name="property('+s+'hour)"]').val(a[0]),$('input[name="property('+s+'minute)"]').val(a[1]),"HH:mm"!==Crm.userDetails.TIME_FORMAT&&(""===a[2]&&(a[2]="AM"),$('input[name="property('+s+'ampm)"]').val(a[2]),$('span[id="'+s+'_ampmSpan"]').attr("ampm",a[2]),$('span[id="'+s+'_ampmSpan"]').text(I18n.getMsg(a[2])));else{var r=s.replace("@{pattern}","hour"),o=s.replace("@{pattern}","minute"),n=s.replace("@{pattern}","ampm"),l=s+"_ampmSpan";-1!=s.indexOf("@{pattern}")&&(l=s.replace("@{pattern}","ampmSpan"));var d=sdTime.hasClass("newSrchView");if(d){var c=sdTime.closest(".searchcrt");c.find("#"+r).val(a[0]),c.find("#"+o).val(a[1])}$("input[name='"+r+"']").val(a[0]),$("input[name='"+o+"']").val(a[1]),"HH:mm"!==Crm.userDetails.TIME_FORMAT&&(""===a[2]&&(a[2]="AM"),d?(c.find("#"+n).val(a[2]),c.find("#"+l).attr("ampm",a[2]).text(I18n.getMsg(a[2]))):($("input[name='"+n+"']").val(a[2]),$("span[id='"+l+"']").attr("ampm",a[2]),$("span[id='"+l+"']").text(I18n.getMsg(a[2]))))}sdTime.attr("time",i),sdTime.val(a[0]+":"+a[1]),"Call Start Time"!==s&&"calltimefrm@{pattern}"!==s||Events.callDuplicateCheckHandler(s,a),renderingUtils.triggerEvent("change",sdTime),sdTime=void 0}}function setPos(e){e&&"block"!=$("#sdiv").css("display")&&$(".AmpmnewValues").hasClass("hide")&&(setDefault(),setTimeout((function(){sdTime.focus()}),0),e=void 0);var t=$("#times li");$(".AmpmnewValues").length&&!$(".AmpmnewValues").hasClass("hide")&&(t=$(".AmpmnewValues li")),e&&(cur=(cur+=e)<0?t.length-1:cur>=t.length?0:cur),t.removeClass(li_hover_class);var i=t.get(cur);$(i).addClass(li_hover_class);var a=$("#sdiv")[0];return e&&scrollPos(e,a,i),$(i)}function scrollPos(e,t,i){var a=i,s=t;1==e?a.offsetHeight+a.offsetTop>s.scrollTop+s.offsetHeight?s.scrollTop=s.scrollTop+a.offsetHeight:s.scrollTop=0==cur?0:s.scrollTop:a.offsetTop<=s.scrollTop?s.scrollTop=s.scrollTop-a.offsetHeight:a.offsetHeight+a.offsetTop>s.scrollTop+s.offsetHeight&&(s.scrollTop=a.offsetTop-a.offsetHeight)}function appendAmpm(e,t){var i=$(e).val(),a=$(e).val().length;i=i.substr(0,5);if(5==a){var s=$(e).offset();"HH:mm"!==Crm.userDetails.TIME_FORMAT&&($(".AmpmnewValues").removeClass("hide").show(),$(".AmpmnewValues").css({top:s.top+23,left:s.left}),$(".bestTimeListFilter").hide(),$(".tA").removeClass("tA"),crmBstTime.hideBestTimeSuggestion("QuickCreateTask"),$(".AmpmnewValues li").removeClass("li_hover").each((function(e,t){0==e?$(this).attr("time",i+":AM").text(i+" "+I18n.getMsg("AM")):$(this).attr("time",i+":PM").text(i+" "+I18n.getMsg("PM"))})),setDefault()),sdTime&&sdTime.val(i)}}function restrictType(e,t){sdTime.attr("maxlength",5);for(var i=0,a=(typedtext=sdTime.val()).length;i<a;i++)typedtext[i];var s=isNaN(e.key);9!=e.keyCode&&(CaretPos>=3&&37==e.keyCode&&(fixValues(t),selectRange($(t),0,2),doGetCaretPosition(t)),CaretPos<=2&&39==e.keyCode&&(fixValues(t),selectRange($(t),3,5),doGetCaretPosition(t)),2==CaretPos&&186!==e.keyCode&&8!==e.keyCode&&59!==e.keyCode&&e.preventDefault(),46!=e.keyCode&&8!=e.keyCode&&("HH:mm"!==Crm.userDetails.TIME_FORMAT?0==CaretPos?(-1==["0","1"].indexOf(e.key)||s)&&e.preventDefault():1==CaretPos?0==typedtext[0]?s||"0"==e.key?e.preventDefault():focusRange="mm":1==typedtext[0]&&(-1==["0","1","2"].indexOf(e.key)||s?e.preventDefault():focusRange="mm"):3==CaretPos?(-1==["0","1","2","3","4","5"].indexOf(e.key)||s)&&e.preventDefault():4==CaretPos&&s&&e.preventDefault():0==CaretPos?(-1==["0","1","2"].indexOf(e.key)||s)&&e.preventDefault():1==CaretPos?0==typedtext[0]?s||"0"==e.key?e.preventDefault():focusRange="mm":1==typedtext[0]?s?e.preventDefault():focusRange="mm":2==typedtext[0]&&(-1==["0","1","2","3"].indexOf(e.key)||s?e.preventDefault():focusRange="mm"):3==CaretPos?(-1==["0","1","2","3","4","5"].indexOf(e.key)||s)&&e.preventDefault():4==CaretPos&&s&&e.preventDefault()))}function consoleCaretPos(e){doGetCaretPosition(e),fixValues(e),0!=CaretPos&&1!==CaretPos&&2!=CaretPos||selectRange($(e),0,2),(4==CaretPos||CaretPos>=5||3==CaretPos)&&selectRange($(e),3,5)}function fixValues(e){var t=$(e).val().split(":");"undefined"!==t[0]&&1===t[0].length?t[0]=0+t[0]:"undefined"!==t[0]&&0===t[0].length&&(t[0]="01"+t[0]),"undefined"!==t[1]&&1===t[1].length?t[1]=0+t[1]:"undefined"!==t[1]&&0===t[1].length&&(t[1]="00"+t[1]),$(e).val(t[0]+":"+t[1])}function switchFocus(e){"hh"===focusRange?(selectRange($(e),0,2),focusRange=""):"mm"===focusRange&&(selectRange($(e),3,5),focusRange=""),0===$(e).val().length&&0==sdTime.val().length&&($(e).val("01:00"),focusRange="hh",switchFocus(e))}function formData2QueryString(e,t,a,s){var r,o="",n="Home";null!=t&&(n=t.toUpperCase().substring(0,t.length-1)+"CF");var l=new RegExp("^"+n),d=new RegExp("^comboValue");for(i=0;i<e.elements.length;i++){if(r=e.elements[i],s){var c=$(r).data();if(CFRExec&&validationUtils.isNotEmpty(CFRExec.QCObj)&&c&&c.colname&&CFRExec.isLayoutRuleHiddenElem(c.colname))continue}var u=!0;if(a?u=""!=r.name:(u="gsitesList"!=r.name&&"gsitesName"!=r.name&&"isShareGsite"!=r.name&&"fieldname"!=r.name&&"dateFields"!=r.name&&"fieldlabel"!=r.name&&"fielddatatype"!=r.name&&"picklistFields"!=r.name&&"fieldvalues"!=r.name&&"mapValues"!=r.name&&"fieldName"!=r.name&&"fieldLabel"!=r.name&&"fieldDatatype"!=r.name&&"fieldUitype"!=r.name&&"fieldId"!=r.name&&"fieldTableName"!=r.name&&"fieldLen"!=r.name&&"dtPtn"!=r.name&&"hdnRowStatus1"!=r.name&&"focusid"!=r.name&&r.name.indexOf("uiType_")<0&&""!=r.name&&"radiobtn"!=r.name&&"hostSearch"!=r.name&&"territoryOwnerName"!=r.name&&"banner_countrySelect"!=r.name&&"banner_editionSelect"!=r.name&&!r.name.endsWith("_visible")&&"servstatcat"!==r.name&&"skipSubmission"!=r.name,null!=t&&(u="gsitesList"!=r.name&&"gsitesName"!=r.name&&"isShareGsite"!=r.name&&"fieldname"!=r.name&&"dateFields"!=r.name&&"fieldlabel"!=r.name&&"fielddatatype"!=r.name&&"picklistFields"!=r.name&&"fieldvalues"!=r.name&&"mapValues"!=r.name&&"fieldName"!=r.name&&"fieldLabel"!=r.name&&"fieldDatatype"!=r.name&&"fieldUitype"!=r.name&&"fieldId"!=r.name&&"fieldTableName"!=r.name&&"fieldLen"!=r.name&&"dtPtn"!=r.name&&"hdnRowStatus1"!=r.name&&"focusid"!=r.name&&r.name.indexOf("uiType_")<0&&!l.test(r.name)&&!d.test(r.name)&&""!=r.name&&!r.name.endsWith("_visible"))),u)switch(r.type){case"text":case"select-one":case"password":case"textarea":var m=r.value,p=$(r);if(33==p.data("uitype")&&(m=commonUtils.getValue(p)),void 0!==r.name.match(/[0123456789]/)&&null!==r.name.match(/[0123456789]/)){var f=r.name.indexOf(r.name.match(/[0123456789]/)[0]);if(r.name.startsWith("searchfield")||r.name.startsWith("property")||void 0===$("#searchfield"+r.name.substring(f)).find(":selected").attr("data-enc")||"true"!==$("#searchfield"+r.name.substring(f)).find(":selected").attr("data-enc"))o+=encodeURIComponent(r.name)+"="+encodeURIComponent(trimBoth(m))+"&";else if(r.name.startsWith("enc_")){var v=r.name.substring(r.name.indexOf("enc_")+4);o+=encodeURIComponent(v)+"="+encodeURIComponent(trimBoth(m))+"&"}else r.name.indexOf("condition")>-1||r.name.indexOf("search")>-1||(o+=encodeURIComponent(r.name)+"="+encodeURIComponent(trimBoth(m))+"&")}else o+=encodeURIComponent(r.name)+"="+encodeURIComponent(trimBoth(m))+"&";break;case"hidden":o+=encodeURIComponent(r.name)+"="+encodeURIComponent(r.value)+"&";break;case"checkbox":case"radio":r.checked&&("zloginForm"==e.name?o+=r.name+"="+encodeURIComponent(r.value)+"&":o+=encodeURIComponent(r.name)+"="+encodeURIComponent(r.value)+"&")}}return o}function logout(e){cookieUtils.deleteCookie("classicId"),"undefined"!=typeof CTIAPI&&CTIAPI.removeClientStorage(""),Utils.windowLocationHref(e),"object"==typeof CrmTracking&&CrmTracking.remTrackingRelStuff()}function showRecentIteminChatBar(){"undefined"!=typeof Storage&&JSON.parse(localStorage.getItem("recentItemSts")),WebMessanger.disableWMSStatus();var e="";if(Lyte.Router.getRouteInstance().transition.info.route.includes("crm.gamification")||(e="<td><div class='rItemIcon cP pR crm-wms-icon' id='rItmes_l' data-zcqa='rItem' onclick='refreshRecentItem1();slidelt();' lt-prop-title=\""+I18n.getMsg("crm.recentitems.title")+"\" onmouseenter='emptyLocalStoreRI(this);' data-title='"+I18n.getMsg("crm.recentitems.title")+"'><crmutil-icon icon-name='timer-recent' icon-class='zcicn-timer-recent crmBaseIcon' class='dIB vam'></crmutil-icon></div></td>"),!Crm.userDetails.CLIENT_ACCOUNT){if(isConfiguredUser("AWSlily")){e="<td><div class='crm-wms-icon topsetting twilioStat cP pR telpEnabled' data-zcqa='telephonyStatusIcon' href='javascript:;' onmouseenter='crmui.toolTip_show(this,\"right\",this.getAttribute(\"data-title\"))' onmouseleave='crmui.hideTooltip(this)' data-title='"+I18n.getMsg("crm.tpi.ctiapi.title.logout","Amazon Connect")+"' id='lily_status_img' onclick='lilyUINotify.lily_config_show_login();' style=''><span class='twistatusimg phoneIcon-Rc' id='lily_status_icon'></span></div></td>"+e}if(isConfiguredUser("twilio")&&(e="<td><div class='crm-wms-icon topsetting twilioStat twilioStatoffline cP pR' data-zcqa='telephonyStatusIcon' href='javascript:;' onmouseenter='crmui.toolTip_show(this,\"center\",this.getAttribute(\"data-title\"))' onmouseleave='crmui.hideTooltip(this)' data-title='  off-line  ' id='twistatusimg' statusvalue='0' style='display:none' onclick='ctiApiNotifier.showTwiStatusPopup();'><span class='twistatusimg toffline' id='twistatusimgicon'></span></div></td>"+e),$(".remainder-notifi").length>0){var t="";0==Activities.reminderCount&&(t='style="display: none"');var i=$("#notificationCount").text();e='<td><div class="crm-wms-icon timericon cP pR" data-zcqa="remainder" onmouseenter="crmui.showTooltip(\''+I18n.getMsg("crm.activity.reminder")+'\');" onmouseleave="crmui.hideTooltip(this)" onclick="Activities.showHideRemainder();" data-title="'+I18n.getMsg("crm.activity.reminder")+'"><crmutil-icon icon-name="alarm" icon-class="zcicn-alarm crmBaseIcon" class="dIB vam pT5"></crmutil-icon><span id="reminder_notification" '+t+" >"+i+"</span></div></td>"+e,isLoadedInCRMPlusIFrame()&&CrmPlusImpl.trigger("setNotificationCount",["reminder",i])}if($("#wVisTitBar").length>0&&(e="<td>"+$("#wmsstatusbar").html()+"</td>"+e),e="<td class='pR'><div style='display:none !important;' class='cP pR crm-wms-icon' id='di-notification-icon'  onclick='CrmIntelligence.getZiaNotificationSummary(event,this)' onmouseenter='emptyLocalStoreRI(this);crmui.toolTip_show(this,\"center\",\""+I18n.getMsg("crm.intelligence.name")+"\")' onmouseleave='crmui.hideTooltip(this)'><span><crmutil-icon icon-name='zia-logo' icon-class='zcicn-zia-logo crmBaseIcon mT7 mL7' class='vam'></crmutil-icon></span><div class='ziaCount'></div></div></td>"+e,e="<td class='vam'><div class='fL lh25 pR10 pointer crm-font-regular color_3 cP sticky-notes-label pR pL7'  onclick='crmStickies.viewStickyNewNote(this);' data-active='view'  data-zcqa='stickies_view' onmouseenter='crmui.showTooltip(\""+I18n.getMsg("crm.sticky.title")+"\")' onmouseleave='crmui.hideTooltip(this)' ><crmutil-icon icon-name='stickynotes' icon-class='zcicn-stickynotes crmBaseIcon mT7 mL7' class='dIB vam'></crmutil-icon><span id='sticky-notification-count'></span></div></td>"+e,"true"===Crm.userDetails.isMotivatorEnabled)e="<td class='vam dIB' id= 'salesmotivatornotification'><div class='fL lh25 pR10 cP crm-wms-icon pR data-active='view'  data-zcqa='game_view' lt-prop-title='"+I18n.getMsg("gs.salesmotivator")+"' id='my_rank' onclick=\"networkUtils.openUrl('"+Crm.getCrmBasePath()+"/gamification/home');Crm.client_tracking('SM Icon Click from CRM');return false;\" > <span id='gameentrancecolour' ><crmutil-icon icon-name='motivator' icon-class='zcicn14 vam' class='zcicn14 crmBaseIcon mT7 mL7'></crmutil-icon></span></div></td>"+e,e="<td class='vam dN' id= 'gamenotification'><div class='fL lh25 pR10 pointer crm-font-regular color_3 cP crm-wms-icon pR'  onclick='GameLoad.loadMainPage();' data-active='view'  data-zcqa='game_view' onmouseenter='crmui.showTooltip(\""+I18n.getMsg("game.feature.label")+"\")' onmouseleave='crmui.hideTooltip(this)' id='my_rank' > <span class='dIB' id='gameentrancecolour'><crmutil-icon icon-name='gamification' icon-class='zcicn-gamification' class='dIB vam pT5'></crmutil-icon></span><span id='current_rank' ></span></div></td>"+e;else if("undefined"!=typeof Gamification&&Gamification.commonObj&&"true"===Gamification.commonObj.isEarlyAccessAllowed)e="<td class='vam "+("true"===Gamification.commonObj.isGamificationEnabled?"dIB":"dN")+"' id= 'gamenotification'><div class='fL lh25 pR10 pointer crm-font-regular color_3 cP crm-wms-icon pR'  onclick='GameLoad.loadMainPage();' data-active='view'  data-zcqa='game_view' onmouseenter='crmui.showTooltip(\""+I18n.getMsg("game.feature.label")+"\")' onmouseleave='crmui.hideTooltip(this)' id='my_rank' > <span class='dIB' id='gameentrancecolour'><crmutil-icon icon-name='gamification' icon-class='zcicn-gamification crmBaseIcon' class='dIB vam pT5'></crmutil-icon></span><span id='current_rank' ></span></div></td>"+e,e="<td class='vam dN' id= 'salesmotivatornotification'><div class='fL lh25 pR10 cP crm-wms-icon pR data-active='view'  data-zcqa='game_view' lt-prop-title='"+I18n.getMsg("gs.salesmotivator")+"' onclick=\"networkUtils.openUrl('"+Crm.getCrmBasePath()+"/gamification/home');Crm.client_tracking('SM Icon Click from CRM');return false;\" id='my_rank' > <span id='gameentrancecolour'><crmutil-icon icon-name='motivator' icon-class='zcicn14 vam' class='zcicn14 crmBaseIcon mT7 mL7'></crmutil-icon></span></div></td>"+e;"true"===Crm.userDetails.isChatbotEnabled&&(e="<td class='vam' ><div class='fL lh25  pointer color_313949 cP askZiaIcon  crm-wms-icon pR'  onclick='constructChatbotDiv();' ><div class='dIB crm-font-bold' style='margin-top:2px'>Ask Zia</div></div></td>"+e)}e="<td id='MultiOperationSchedular' class='pR dN'><div class='cP pR crm-wms-icon pT5 w40' onclick='crmSchedulerNotification.hideInSchedularBar(this);'><span class='svgIcons rls-progress-icon dIB'></span></div></td>"+e,e="<td><div class='fL lh25  pointer crm-font-bold color_3 cP   crm-wms-icon pR hide' id='maxComposeBtn' onclick='EmailLaunchUtil.restoreComposePopup();' ><div class='dIB' style='margin-top:2px'>"+I18n.getMsg("crm.label.mail")+"</div></div></td>"+e,Crm.userDetails.isSandbox||Crm.userDetails.CLIENT_ACCOUNT||(e="<td class='vam pR'><div id='mbRippleDiv'></div><div id='stackedNumber' onclick='displayFeature();' class='cP' data-zcqa='msgboardcount_view' style='display:none;position: absolute;font-size: 1.1rem;background-color: #f56d6d;border-radius: 8px;top:-14px;right: 3px; text-align:center; min-width: 18px;color: #fff;padding: 3px 5px; z-index: 1;line-height:1.1rem'></div><div id='msgBoardDisplay' onclick='displayFeature();' style='display:block' class='fL lh25 pR10 pointer crm-font-regular color_3 cP sticky-notes-label pR'  data-active='view'  data-zcqa='msgboard_view' lt-prop-title='"+I18n.getMsg("crm.msgboard.icon.hover.lable")+"'> <span class='msg-board-icon' style='display:inline-block; top:0px; bottom:0px; left:0px; right:0px;position:absolute; margin:0 auto !important; margin-top: 4px !important;text-align: center;z-index: -1;'><crmutil-icon icon-name='messageboard' icon-class='zcicn-messageboard crmBaseIcon' class='dIB vat'></crmutil-icon></span><span id='stackedNumber'></span></div></td>"+e),e='<table class="fR crm-chatBarIcons" cellpadding="0" cellspacing="0" id="chatBarIcons"><tr>'+e,WebMessanger.setServiceStatus(e),Crm.userDetails.isSandbox||Crm.userDetails.CLIENT_ACCOUNT||(crmTab.isLiveDeskEnabled?setTimeout((function(){initializeMsgBoard()}),1e3):initializeMsgBoard())}function displayFeature(){var e=$L("#viewFeatures"),t=document.getElementById("viewFeatures"),i=document.querySelector("#msgBoardDisplay .msg-board-icon"),a=document.getElementById("mics_stacked_carpet"),s=document.getElementById("mics_stacked_backdrop");if(0===e.length){var r=document.createElement("a");r.style="display: block;cursor:pointer;z-index: 306;width: 410px;text-align: center; padding-bottom: 11px;background-color:#fff;font-size: 1.4rem;font-weight:700;color: #338cf0;right:0;bottom:28px;position:fixed;box-shadow: 0px -2px 4px rgb(135, 151, 161, 0.2);",r.textContent=I18n.getMsg("crm.msgboard.whatsnew",Crm.appName),r.href=RebrandLinkUtil.getProperty("whatsnew_canvas")+"/?src=inproduct-notification",r.target="_blank";var o=document.createElement("img");o.classList.add("mR5","pR","t3","h25");var n=document.createAttribute("src");n.value=networkUtils.getImageUrl("Blinking_Star_abfca23_.gif",ResourceConstants.CRM),o.setAttributeNode(n),r.prepend(o);var l=document.createElement("img");l.classList.add("mL5","pR","t3","h25"),l.style.transform="rotateY(180deg)";var d=document.createAttribute("src");d.value=networkUtils.getImageUrl("Blinking_Star_abfca23_.gif",ResourceConstants.CRM),l.setAttributeNode(d),r.appendChild(l);var c=document.createAttribute("data-zcqa");c.value="msgboard_whatsnew",r.setAttributeNode(c);var u=document.createElement("div");u.id="viewFeatures",u.appendChild(r),document.body.appendChild(u),i.classList.add("msg-board-icon-active"),$L("html").addClass("oH"),document.getElementById("wVisTitBar")&&(i.classList.add("msg-board-icon-active"),a.style.display="block",s.style.display="block",document.getElementById("stackedNumber").style.display="none")}else if("block"==t.style.display||0==t.style.display.length){t.style.display="none",i.classList.remove("msg-board-icon-active"),a.style.display="none",s.style.display="none";var m=$L("html"),p=document.getElementById("stNotes");p&&"block"===p.style.display?m.addClass("oH"):m.removeClass("oH")}else t.style.display="block",i.classList.add("msg-board-icon-active"),a.style.display="block",s.style.display="block",document.getElementById("stackedNumber").style.display="none",$L("html").addClass("oH");var f=document.getElementById("remainder-notifi"),v=document.getElementById("wms_notebook_icon");f&&"block"===f.style.display&&Activities.RemainderHideOnly(),v&&"true"===v.getAttribute("data-shown")&&v.setAttribute("data-shown","false")}function initializeMsgBoard(){try{this.msgBoardObj=new sdk({serviceID:RebrandLinkUtil.getProperty("MICS_SERVICE_CODE"),orgID:Crm.userDetails.ZGID,tipengineURL:RebrandLinkUtil.getProperty("MICS_DOMAIN"),src:RebrandLinkUtil.getProperty("MICS_DOMAIN")+"/analytics/stacked.jsp?frameorigin="+RebrandLinkUtil.getProperty("CRMURL_HTTPS"),element:document.getElementById("msgBoardDisplay"),elementOpacity:"0.4",iframeStyle:"width:410px; z-index:306; height:calc(100vh - 66px); overflow:none; display:none; position:fixed; top:0px; right:0px; border:0px",backdropStyle:"display:none; z-index:306; width:100vw; height:100vh;background:#000; opacity:0.3; position:fixed; top:0; left:0;",panelTemplateName:"panel-template-primary",styleJson:{home:{topband:{backgroundColor:"#338CF0",text:I18n.getMsg("crm.msgboard.announcements.lable",Crm.appName),color:"#FFF",fontSize:"20px",fontFamily:"'Lato', sans-serif !important",fontWeight:"700",zIndex:"100",boxShadow:"1px 0px 1px #bbc3ca",borderBottom:"",borderTop:"",borderLeft:"",borderRight:""},closeButton:{icon:"close",iconColor:"#FFF"},historyButton:{showDynamicHistory:!0,withNotification:{text:I18n.getMsg("crm.msgboard.see.history"),color:"#338CF0",buttonColor:"#fff",fontSize:"12px",fontFamily:"Lato,  sans-serif",fontWeight:"600",icon:"arrow_forward",iconColor:"#338CF0","text-decoration":"underline"},withNoNotification:{text:I18n.getMsg("crm.msgboard.view.history"),color:"#fff",fontSize:"14px",fontFamily:"'Lato', sans-serif !important",fontWeight:"500",backgroundColor:"#338cf0","text-decoration":"underline"}},background:{color:"#F6F9FC"},genreSelect:{selection:{backgroundColor:"#ECF3FA",color:"#22252A",fontSize:"14px",fontFamily:"Lato, sans-serif",fontWeight:""},item:{color:"#313949",fontSize:"14px",fontFamily:"Lato, sans-serif",fontWeight:""}},descriptionText:{noDataDescription:{icon:"question_answer",iconColor:"#616E88",heading:{text:"",color:"#313949",fontSize:"18px",fontWeight:"800",fontFamily:"'Lato', sans-serif !important"},description:{text:I18n.getMsg("crm.msgboard.no.notification.lable"),color:"#313949",fontSize:"20px",fontFamily:"'Lato', sans-serif !important",fontWeight:"700 !important"}}}},history:{topband:{backgroundColor:"#338CF0",text:I18n.getMsg("crm.label.general.history"),color:"#FFF",fontSize:"20px",fontFamily:"'Lato', sans-serif !important",fontWeight:"700",boxShadow:"1px 0px 1px #bbc3ca"},backButton:{icon:"arrow_back",iconColor:"#FFF"},closeButton:{icon:"close",iconColor:"#FFF"},background:{color:"#F5F9FC"},descriptionText:{noDataDescription:{text:"You have viewed all updates",color:"#313949",fontSize:"20px",fontFamily:"'Lato', sans-serif !important",fontWeight:"700"}}},showMessagesWithUndefinedGenreText:!1,genreTexts:{"All Messages":I18n.getMsg("crm.msgboard.drop.down.lable"),"User Education":I18n.getMsg("crm.msgboard.genre.usereducation"),Webinars:I18n.getMsg("crm.msgboard.genre.webinars"),Events:I18n.getMsg("crm.msgboard.genre.events"),"Feature Releases":I18n.getMsg("crm.msgboard.genre.featurereleases"),Announcements:I18n.getMsg("crm.msgboard.icon.hover.lable"),Community:I18n.getMsg("crm.msgboard.genre.community"),Retention:I18n.getMsg("crm.msgboard.genre.retention")},genreStyles:{renderGenreStyles:!0,default:{color:"#6C6C6C",fontSize:"12px",fontFamily:"'Lato', sans-serif !important",fontWeight:"",backgroundColor:"#EBEBEB",padding:"4px 12px",borderRadius:"6px",border:"none"},"Tips & Tricks":{color:"#8A390D",backgroundColor:"#FFF7F0"},Survey:{color:"#D60000",backgroundColor:"#FFF0F0"},"User Education":{color:"#9E1B4A",backgroundColor:"#FFEAF3"},Community:{color:"#1E807A",backgroundColor:"#E1FFFD"},Events:{backgroundColor:"#EFF9FF",color:"#256DDA"},Webinars:{backgroundColor:"#FFF7D9",color:"#786214"},"Feature Releases":{backgroundColor:"#F3FBE9",color:"#029200"},Announcements:{backgroundColor:"#F7F0FF",color:"#6422B9"}},messageStyles:{renderUndefinedMessageTemplates:"true","message-template-default-styles":{heading:{color:"#313949",fontSize:"15px",fontFamily:"Lato, sans-serif",fontWeight:"700"},sideHeading:{color:"#616e88",fontSize:"13px",fontFamily:"Lato, sans-serif",fontWeight:"400"},description:{color:"#616e88",fontSize:"14px",fontFamily:"Lato, sans-serif",fontWeight:"400"},category:{color:"#f48a4f",fontSize:"14px",fontFamily:"Lato, sans-serif",backgroundColor:"#fff7f0",margin:"0 10px",padding:"2px 8px 2px 10px",borderRadius:"6px",fontWeight:""},background:{backgroundColor:"#fff",border:"none"},hover:{showHover:!0,hoverColor:"#E5F4FF"}},"message-template-options-styles":{heading:{color:"#2e4156",fontSize:"18pxpx",fontFamily:"Lato,  sans-serif",fontWeight:"700"},sideHeading:{color:"#747f8c",fontSize:"13pxpx",fontFamily:"Lato,  sans-serif",fontWeight:""},description:{color:"#2e4156",fontSize:"15px",fontFamily:"Lato, sans-serif",fontWeight:""},category:{color:"#6b21b7",background:"#fff7f0",fontSize:"14px",fontFamily:"Lato, sans-serif",padding:"2px 8px 2px 10px",borderRadius:"6px",fontWeight:""},selectBox:{backgroundColor:"#ffffff",placeHolder:{text:"Choose your option",color:"#02e415600",fontSize:"15px",fontFamily:"Lato, sans-serif",fontWeight:""},selection:{color:"#2e4156",fontSize:"15px",fontFamily:"Lato, sans-serif",fontWeight:""},item:{color:"#2e4156",fontSize:"15px",fontFamily:"Lato, sans-serif",fontWeight:""}},sendButton:{icon:"send",iconColor:"#5780ce"}}}},updateNumber:function(e){var t=e.value.unviewedMessages;if(+t>0){var i=document.getElementById("stackedNumber"),a=document.getElementById("mbRippleDiv");t=e.value.notclickedMessages,i.innerHTML=t,i.style.display="block",i.classList.add("animateMbCount"),a.classList.add("animateMbRipple"),setTimeout((function(){i.classList.remove("animateMbCount"),a.classList.remove("animateMbRipple")}),4100)}else void 0!==t&&(document.getElementById("stackedNumber").style.display="none")},onclick:function(e){var t=e.value.cta,i=document.createElement("a");i.setAttribute("referrerpolicy","no-referrer"),i.href=t,i.target="_blank",document.body.appendChild(i),i.click()}})}catch(e){}}function constructChatbotDiv(){Crm.client_tracking("Chatbot - Ask Zia Click"),Crm.trackSpotLightAction("Chatbot - Ask Zia Click");var e=$("#chatbotDiv");e.on("keydown",(function(e){13===e.keyCode&&e.target.value.length!==e.target.value.split(" ").length-1&&(askZia.remove_support_when_no_input_from_user(),askZia.message=e.target.value)}));renderingUtils.windowOuterHeight,$("#mainMenuTabDiv").outerHeight(),$("#wmstoolbar").outerHeight();if("visible"!==e.css("visibility")){$(".askZiaIcon").addClass("blinkEl");$("#chatbotText");if(0===$("#ziaChatbotDiv").length){var t=networkUtils.getI18nJSUrl("chatbot");function i(){var t=void 0===Crm.userDetails.ziaZgid?"-1":Crm.userDetails.ziaZgid;e.html("<div id='ziaChatbotDiv'><zia-chat-bot skill-name='zohocrm' show-history='true' show-help='true' portal-id='"+t+"' chat-mode='popup' zia-attr-new-options='true'></zia-chat-bot><div id='entityDetail' class='entityDetail'></div></div><script type='text/javascript'>ziaskills.init({ zia_url:'"+RebrandLinkUtil.getProperty("ZIA_PLATFORM_URL")+"',static_urls:{js_static_url:'/crm/CRMClient/',css_static_url:'/crm/CRMClient/',img_static_url:'/crm/CRMClient/'} });<\/script>"),e.css({position:"fixed",visibility:"visible"}),e.css("bottom","26px"),Lyte.injectResources([networkUtils.returnDependencyFiles(["crm-ask-zia.js"],crmConstants.jsStaticPathForLyte),networkUtils.returnDependencyFiles(["crm-ask-zia.css"],crmConstants.cssStaticPathForLyte)],(function(e){"error"!==e.type&&($("#ziaChatbotDiv").append("<crm-ask-zia></crm-ask-zia>"),$("#chatbotDiv").addClass("hideLoader"))}))}return void networkUtils.loadFeatureScripts(["zcrm_chatbot_ZiaTemp.js",t],(function(){"undefined"!=typeof askZia||networkUtils.loadFeatureScripts(["zcrm_chatbot_Zia.js"],i)}))}e.outerHeight(),askZia.fromFooter()}else $(".askZiaIcon").removeClass("blinkEl"),e.css("visibility","hidden"),askZia.toFooter(),askZia.exportChangesClose()}function showAnimatePopup(e,t){var i=$("#"+e),a=document.getElementsByClassName("modalWithlookup");"searchCreatePopup"===e&&(select2ChangesInFields(i),lookupClassAddFunction(i),noBorderStyleApply(i));var s=i.find(".popup-model-content");i.show().addClass("zcrm-show").find(".popup-model-header").addClass("bxShTp");var r=$(".zcrm-modal select").attr("multiple"),o="undefined"!=typeof module&&null!=module?module.value:null;("multiple"!=r&&"massmail_schedule_alert"!==e&&!Crm.isHeadless||"Users"==o&&"massmail_schedule_alert"!==e&&!Crm.isHeadless)&&wfForm.chosen_show(e),Crm.isHeadless||wfForm.initFormClick(),$("[name=createEntityFormctiapiTasks]").length||setTimeout((function(){"block"==$("#qCreate").css("display")||Crm.isHeadless||$("#intelligenceConfigDiv").length||$("#RoleAction").length||wfForm.inputfieldFocus()}),100),s[0]&&(s.scrollTop()+s.outerHeight()+10<s[0].scrollHeight&&i.find(".popup-model-footer").addClass("scroll-sh"),s.on("scroll",(function(){var t=$("#"+e);s.scrollTop()+s.innerHeight()>=s[0].scrollHeight?t.find(".popup-model-footer").removeClass("scroll-sh"):t.find(".popup-model-footer").addClass("scroll-sh");var i=$(".calculaterInfo");i.is(":visible")&&i.hide()})));var n=$("#freezeBackGround");"deletepopup"===e&&n.css("z-index","30"),"subSecondaryPopup"!==e&&"popup1"!==e||n.css("z-index","30"),a.length&&!0===a[0].ltProp("show")&&n.css("z-index","31");var l=$("#eventCreatePopup").is(":visible");"topBandPopup"===e&&l&&n.css("z-index","32"),$("body").addClass("oH"),t&&t.call(window,e),showFreezeLayer()}function hideAnimatePopup(e,t,i){if(!Crm.isHeadless&&crmNTC.isSignalDetailViewVisible()&&crmNTCGlobal.hideFreezeLayerForSignals(),("topBandPopup"===e||!$("#topBandPopup").is(":visible"))&&(Crm.isHeadless||!crmNTC.isSignalDetailViewVisible()&&!SalesSignalsWrapper.isSignalIFrameOpen)){if(Crm.isFromSalesInbox){var a=$("#qCreate");a&&a[0]&&a[0].childElementCount>0&&$(".freezeLayer").attr("style","z-index : 32 !important")}"topBandPopup"===e&&$("#createMassMailContainer").length>0||hideFreezeLayer()}if("lookupErrorMsg"==e){var s=document.getElementById("kanbanViewSubmit");null!=s&&s.classList.remove("pointerEventsNone","disable")}"topBandPopup"===e&&t&&(CTIAPI.Windows.changeWindowInfo="closed");var r=$("#columnList"),o=$(".columnListNew");("topBandPopup"===e&&r.is(":visible")||"columnList"===e)&&r.removeClass("dBImp"),$(".etTrendsWrapper").length&&"topBandPopup"===e&&$(".temp_freezelayer").css({zIndex:313});var n=$("#"+e);n.find(".popup-model-content").off("scroll"),$(".popup-model-content").off("wheel"),n.find(".popup-model-footer").removeClass("scroll-sh"),n.off("keydown");var l=n.height();n.css({top:"-"+2*l+"px"}),targ=null,srcElement=null,setTimeout((function(){n.removeClass("zcrm-show").css({top:"0px",display:"none"}).width(""),t&&n.empty()}),200);var d=$("#freezeBackGround");if("deletepopup"===e&&d.css("z-index","30"),"subSecondaryPopup"!==e&&"popup1"!==e||d.css("z-index","30"),$("body").removeClass("oH"),i&&i.call(window,e),Crm.userDetails.isNewEditor&&EmailSendingUtil.composeActive){var c=document.getElementById("lookupdiv");c||"none"!==c.style.display||EmailUtil.removeCustomFreezeLayer()}var u=$L(".freezeLayer");"custom_alert_popup"!==e&&"lookupErrorMsg"!==e||($("#serviceAjaxEdit").is(":visible")||$("#appointmentRescheduleDiv").is(":visible")||$("#qc_holder_createEntityForm").is(":visible")||$("#appointmentCompletePopup").is(":visible")?u.show():u.hide()),o&&o.removeClass("popupLookupEnable"),Crm.userDetails.TaskPopup&&u.show()}function showFreezeLayer(){$("#freezeBackGround").css({display:"block"})}function hideFreezeLayer(){$(".temp_freezelayer")&&!$(".etTrendsWrapper").length&&removeTempFreezeLayer(),$("#freezeBackGround").css({display:"none",zIndex:"30"})}function getFormattedName(e,t,i){var a=Crm.userDetails.NAME_FORMAT.split(",");null==t&&(t="");var s=t,r=a.indexOf("First Name"),o=a.indexOf("Last Name"),n=a.indexOf("Salutation");return null!=e&&""!=e&&(s=e+" "+t,r>o&&(s=t+" "+e)),null!=i&&"None"!=i&&(1==n?null!=e&&(s=e+" "+i+" "+t,r>o&&(s=t+" "+i+" "+e)):s=2==n?s+" "+i:i+" "+s),s}function newshowtt(e,t){void 0===t?zctt.showtt(e):zctt.showtt($ESAPI.encoder().encodeForHTML(e)),$("#tooltip-zc").addClass("newtooltipzcdefault")}function newhidett(){zctt.hidett(""),$("#tooltip-zc").hide().removeClass("newtooltipzcdefault")}function enableImportRevamp(e,t,i,a,s,r){commonUtils.showHideLoadingDiv(!0);var o=!1,n=Crm.getCrmBasePath()+"/specific/ImportAction.do?currStep=tryNew&status="+e;null!=t&&null!=t&&"null"!=t&&""!=t&&(n=n+"&module="+t),null!=i&&null!=i&&"null"!=i&&""!=i&&(n=n+"&parentModule="+i),null!=a&&null!=a&&"null"!=a&&""!=a&&(n=n+"&parentId="+a),null!=s&&null!=s&&"null"!=s&&""!=s&&(n=n+"&itsfromMigration="+s,"true"===s&&(o=!0)),null!=r&&null!=r&&"null"!=r&&""!=r&&(n=n+"&feedback="+encodeURIComponent(r)),n=n+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),(new crmRequestPool).initiate({action:n,type:"POST",success:function(e){commonUtils.showHideLoadingDiv();var t="show";$("#show").length&&!o||(t="result"),thirdPartyUtils.unbindChildEvents("#"+t),$("#"+t).empty().html(e)}})}function showDeletePopup(e,t,i,a,s,r,o,n,l,d,c,u,m){var p,f,v=document.getElementsByName("module")[0];v=v?v.value:v;var g=!1;if(1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&detailView.atnAddClassSelected(s),customViewObject&&customViewObject.module&&(v=customViewObject.module),"mailsSub"==e)if($("#draftMails").hasClass("selectTab"))t="crm.button.delete.permanently";else if($("#mails").hasClass("selectTab")){var h=$("#selectMails");"ALL"!=(h.length>0?h:$(getOpenerObj("selectMails"))).attr("lt-prop-selected")&&(t="crm.button.move.to.trash.mail")}var C,w="";if($(s).attr("data-params")){var b=JSON.parse($(s).attr("data-params")).module;b&&(v=b),w=JSON.parse($(s).attr("data-params")).dissociateclick,JSON.parse($(s).attr("data-params")).action&&(JSON.parse($(s).attr("data-params")).action.includes("deleteFilter")?p=JSON.parse($(s).attr("data-params")).action.includes("deleteFilter"):JSON.parse($(s).attr("data-params")).action.includes("deleteCustomView")&&(f=JSON.parse($(s).attr("data-params")).action.includes("deleteCustomView"))),g=!(!JSON.parse($(s).attr("data-params")).isMultiValued||crmTab.isLinkingModule(b))}else"Notes"===r&&(v="Notes");v="Deals"===v?"Potentials":v;try{var T=$(s);C=!!T&&T.attr("id").includes("proj_del_icon")}catch(e){murphy.error(e),C=!1}if(g&&("PriceBooks"===v||"Products"===v))var I=T.attr("data-onclick"),y=I.substr(I.indexOf("#")+1,I.length).split("_")[0].replace("$","_").toUpperCase(),P=returnJson.relListLabelsJson.relListLabelJson.findIndex((function(e){return e.name===y})),_=returnJson.relListLabelsJson.relListLabelJson[P].module;if(C||p||f||g||!v||Crm.userDetails.permissions.hasOwnProperty("Crm_Implied_Delete_"+v)||(crmTab.isZBCustomModule(v)||crmTab.isZSCustomModule(v)||crmTab.isZECustomModule(v))&&Crm.userDetails.permissions.hasOwnProperty("Crm_Implied_View_"+v)||-1!==e.indexOf(I18n.getMsg("crm.confirm.close.task"))||-1!==e.indexOf(I18n.getMsg("crm.massmail.delete.confirm")))if(g&&!w&&_&&Crm.userDetails.MODULE_LIST.hasOwnProperty(_)&&!Crm.userDetails.permissions.hasOwnProperty("Crm_Implied_Edit_"+_)){j='<div onclick=/"sE()" class="w500 p20"><div class="floatL pL20 w430"><div class="f20"><h2 style="color:#E20000";>'+I18n.getMsg("crm.delete.error")+'</h2></div><div class="mT10">'+I18n.getMsg("crm.security.error")+'</div></div><br class="clearB"><div  class="alignright mT20"><input type="button" id="popupok" class="primarybtn" value="'+I18n.getMsg("crm.button.ok")+"\" onclick=\"hide('popupnew');removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30\"></div></div>";renderingUtils.popUpWithFreeze(j),commonUtils.showHideLoadingDiv(),renderingUtils.stopEvent()}else{var D=$("#deletepopup");if(s=$(s),0!=$(".relListMenuDiv").length&&$(".relListMenuDiv").is(":visible")&&$(".relListMenuDiv").css({visibility:"hidden"}),D.length){if(s.data("checkbox")&&0===getNoOfSelected(s.closest("form"),void 0,s.data("checkbox")))return void alert(I18n.getMsg("crm.alert.select.one"));if(r&&"removeSampleData"!=r){var O="Home"===r?$("#homePage_"+e):$("#relatedList_"+e),S=[];0==O.length&&(O=$("#"+e)),"rl"==r&&(O=$("#relatedList_"+e)),"fl"==r&&(O=$("#attachment_"+e));var L=O.text();""==L&&"Notes"===r&&(e=e.replace("ntitle_","ncontent_"),L=$("#"+e).text()),L&&L.length>=40&&(L=L.substr(0,35)+"..."),""==L||null==L?S.push(l):S.push(L),e="mailsSub"==e?(e=I18n.getMsg("crm.warning.delete.record",S)).replace(/"/g,""):I18n.getMsg("crm.warning.delete.record",S)}D.find(".evButtons").hide(),D.find("#warningMsg").text(e),o=o?o+" fromDeletePopup":"redbtn fromDeletePopup";var E=D.find("#deleteButton").val(I18n.getMsg(t)).attr("onclick","").removeAttr("class").addClass(o).off("click").show(),x=s.attr("data-onclick")?"data-onclick":"onclick";if(x=u||x,u){var F=s.parent();F&&F.attr(x)&&(s=F)}if(s.attr("data-cid")?(E.attr("data-cid",s.attr("data-cid")).attr("data-params",s.attr("data-params")),E.data("params",JSON.parse(s.attr("data-params"))),E.removeAttr("onclick")):(E.removeAttr("data-params").removeAttr("data-cid"),s.attr("close-task")?E.attr("onclick",s.attr("close-task")):s.attr(x)?E.attr("onclick",s.attr(x)):E.attr("onclick","massActionDelete('massdelete','MassDelete','');return false;")),w&&""!=w&&$("#dissociatebutton").attr("onclick",w.split("SSIINNGGLLEEQQUUOOTTEE").join("'")).show(),i=i?'"'+(i=i.length>=45?i.substring(0,35)+"...":i)+'"':"",c&&(E.attr("onclick","crmTasks.triggerSaveFieldClickEvnt(true);"),D.find(".newgraybtn").attr("onclick","crmTasks.triggerSaveFieldClickEvnt();")),"mass_transfer"===s.attr("name")&&("Accounts"===zbCustomModuleObjForAccountContactDeletion.module||"Contacts"===zbCustomModuleObjForAccountContactDeletion.module)&&zbCustomModuleObjForAccountContactDeletion.isZBCustomModuleEnabled)return void ZInvoice.getAlertContentOnMassDelete(D,i,a,event);D.find("#delItemName").text(i),a?D.find("#showWarning2").css("display","").find("#noteMsg").text(I18n.getMsg(a)):D.find("#showWarning2").css("display","none"),$("#showDontAskOption").prop("checked",!1);var V=D.find("#showDontAskOptionDiv");if(n?V.show():V.hide(),n){var A=V.find("p"),k=A.text();k=k.replace(".",""),A.text(k)}$("#notifyOwnerOption").prop("checked",!1);var N=D.find("#notifyOwnerOptionDiv");if(d?N.show():N.hide(),"removeSampleData"!=r)setTimeout((function(){showAnimatePopup("deletepopup")}),1),s.blur();else{$("#overlayHeader,#settingInner").hide(),$("#setupshow,#mainResult").show();$("#setupLinkDiv").offset().top;var M=$(window).height(),R=isChatEnabled?26:0;R;var B=M-($("#setup_new_leftmenuDiv").offset().top+R);$("#setup_new_leftmenuDiv").css({height:B+"px"});$("#result").html("<div id='rmvSampledata' class='p30'></div>");var U=$("#rmvSampledata");U.append('<p class="crm-font-bold f20">'+I18n.getMsg("cob.remove.sampledata")+"</p>"),U.append(D.find(".fromDeletepopup").html()),U.find(".newgraybtn").attr("onclick","Lyte.Router.transitionTo('crm.settings.index')")}"undefined"!=typeof event&&(m||renderingUtils.stopEvent(event))}}else{var j='<div onclick=/"sE()" class="w500 p20"><div class="floatL pL20 w430"><div class="f20"><h2 style="color:#E20000";>'+I18n.getMsg("crm.delete.error")+'</h2></div><div class="mT10">'+I18n.getMsg("crm.security.error")+'</div></div><br class="clearB"><div  class="alignright mT20"><input type="button" id="popupok" class="primarybtn" value="'+I18n.getMsg("crm.button.ok")+"\" onclick=\"hide('popupnew');removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30\"></div></div>";renderingUtils.popUpWithFreeze(j),commonUtils.showHideLoadingDiv(),renderingUtils.stopEvent()}}function loadRegForm(e){var t=$(e).siblings("#formDiv");t.find("#sessionDropdown .select2").remove();for(var i=t.find("form").clone(),a=i.find("#sessionDropdown").find("option"),s=0,r=0;r<a.length;r++){var o=$(a[r]),n=o.val().split("#")[1],l=new Date(n.replace(" ","T")+"+00:00");new Date>l||s>=3?o.remove():s++}var d=$("#showCreatorForm");d.empty(),d.append(i),d.find("#saveBtn").attr("onclick","javascript:submitRegFormToCreator(this);sE(event);"),d.find("#cancelBtn").attr("onclick",'crmui.hidePopup("showCreatorForm")'),d.addClass("ppTop p0"),crmui.showPopup("showCreatorForm"),$("#FreezeLayer").css({"z-index":"24"}),trackBannerLink(e)}function submitRegFormToCreator(e){var t=$(e).closest("form"),i=t.find('select[name="sessionDetails"]');if(""===i.val())return t.find("#sessionErrMsg").text(I18n.getValueForFields("crm.login.cannot.empty")).removeClass("dN"),i.parents("tr").addClass("form_err_fld"),i.focus(),!1;t.find("#saveBtn").addClass("inActiveWebinarBtn");var a="sessionDetails="+i.val()+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);$.ajax({type:"POST",url:Crm.getCrmBasePath()+"/Security.do?actionName=pushRegToCreator",data:a,success:function(e){"success"===e?($("#showCeratorForm").empty(),crmui.hidePopup("showCreatorForm"),crmui.showMsgBand("success",I18n.getMsg("crm.banner.webinar.registration.success"),5e3),$("#annoncement").hide()):(t.find("#saveBtn").removeClass("inActiveWebinarBtn"),crmui.showMsgBand("error",I18n.getMsg("crm.tryagain.message"),5e3))},error:function(e){t.find("#saveBtn").removeClass("inActiveWebinarBtn"),crmui.showMsgBand("error",I18n.getMsg("crm.tryagain.message"),5e3)}})}function crmplusImplTriggerActions(e,t){"undefined"!=typeof CrmPlusImpl&&("UIReady"==e?CrmPlusImpl.trigger("UIReady"):CrmPlusImpl.isLoadedInCrmplus()&&("hideSearchBar"==e?($("#newgsearchouterdiv").hide(),$(".adSearchClose").hide()):CrmPlusImpl.trigger(e,t)))}function loadDataForDisplayAndMentions(e,t,i,a,s,r){var o=null!=e&&e,n=null!=i&&i,l=null!=t&&t,d=(r=void 0!==r&&r,Crm.getCrmBasePath()+"/Pulse.do?action=getDataForDisplayAndMentions&isDeletedUsersNeeded="+o+"&isFullLoad="+l+"&isActiveOnly="+n+"&fromFeeds="+r);(new crmRequestPool).initiate({action:d,async:void 0!==a&&a,type:"GET",dataType:"json",success:function(e){!r||!t&&e.infoForPartialLoad?t||!e.infoForPartialLoad?InfoForDisplay=e.infoForDisplay:r?Search.InfoForDefaultDisplayWithLiteUsers=e.InfoForDisplayWithLiteUsers:Search.InfoForDefaultDisplay=e.infoForDisplay:InfoForDisplayWithLiteUsers=e.InfoForDisplayWithLiteUsers,Search.InfoForPartialLoad=e.infoForPartialLoad,InfoForMentions=e.infoForMentions,s&&s()}})}function loadUserDataForPartialLoad(e,t,i,a,s,r){var o=null!=r&&r;if(void 0===Search.InfoForDefaultDisplay||i){var n=null!=t&&t,l=Crm.getCrmBasePath()+"/Pulse.do?action=getDataForDisplayAndMentions&isDeletedUsersNeeded="+n+"&isActiveOnly="+o;i&&(s||(s=""),a||(a=0),l=l+"&isPartialLoad="+i+"&searchKey="+s+"&startRange="+a),(new crmRequestPool).initiate({action:l,async:!0,type:"GET",dataType:"json",success:function(t){a&&a>0||s&&s.length>0?e&&e(t.infoForDisplay):Search.InfoForDefaultDisplay=t.infoForDisplay,InfoForMentions=t.infoForMentions,Search.InfoForPartialLoad=t.infoForPartialLoad}})}}function newPopupCallMethodId(){return"popupNewUiEnhancementLook"===crmTemplate.lookupNewStylePopupId?"popupNewUiEnhancementLook":"topBandPopup"}function triggerClickEvent(e,t){var i=$(t),a=e.currentTarget,s=$(".detailViewContainer.editModeEnable, .newBusinessCardView.editModeEnable");i=i.length>0||void 0===t,$L("#rpBtnResubmit")&&$L("#rpBtnResubmit").is(":visible")&&!detailView.readOnlyField&&$L("#rpBtnResubmit").addClass("disable"),i&&0===s.length&&setTimeout((function(){if(0===window.getSelection().toString().length&&"A"!==e.target.tagName&&!$(e.target).parent().hasClass("calliconOuter")){var t=$(a),i=t.closest(".tabDiv").hasClass("readOnlyFld"),s=t.attr("data-uitypesEle");if("208"!==s||i)if("8"!==s||i)$("#crmspanid").click();else{var r=$("#changeOwnerIco");0===r.length?$L("#rpBtnResubmit").removeClass("disable"):r.click()}else $("#changeLayoutIco").click();e.stopPropagation(),hideMenu()}}),150)}function select2ChangesInFields(e){for(var t=$(e).find(".newChosenSel select:not(#execDaySign_3), .newSelect select:not(#execDaySign_3), select:not(#execDaySign_3)"),i=t.length,a=0;a<i;a++){var s=t.eq(a),r=s.closest(".tabDivCreate");0===r.length&&(r=s.closest("tr")),r.addClass("selectBoxSelect2")}}function lookupClassAddFunction(e){var t=$(e).find(".amountCustom, .lookupDummyClass, .task_lookup, .qcInputModulation, #roleName_Add");if(t.length>0)for(var i=t.length,a=0;a<=i;a++){var s=t.eq(a),r=s.closest("tr");r.length>0?r.addClass("lookupFieldCreate"):s.closest(".tabDivCreate").addClass("lookupFieldCreate")}}function noBorderStyleApply(){$('input[type="checkbox"]').closest(".tabDivCreate").hasClass("nAborderNone")||$('input[type="checkbox"]').closest(".tabDivCreate").addClass("noBorderStyle")}function focusTextareaAction(e){var t=(e=$(e)).outerWidth(),i=e.outerHeight();return 36===i&&e.height(2*i),e.addClass("focusEleField"),e.off("keyup focus paste").on("keyup paste",(function(){var e,i=$(this),a=i.outerHeight();0==(e=$("#span_tarea_new")).length&&((e=$("<span>")).attr({id:"span_tarea_new",class:"dIB"}).css({"font-size":"1rem","overflow-y":"scroll","line-height":"18px"}),$("body").append(e),e.css({width:t}));var s=e.outerHeight();e.text(i.val());var r=s/36*36;r>=150?(e.remove(),i.css({height:"150px","overflow-y":"auto"})):(i.css("overflow-y","hidden"),13===event.keyCode&&(r+=36),r>=a&&$(i).css({height:r}))})),$("#span_tarea_new").remove(),!0}function removeTextareaFocus(e){var t=(e=$(e)).outerHeight(),i=$("#span_tarea_new");if(t>150)return i.remove(),!1;i.text(e.val());var a=""===e.val()?36:t;return e.css({height:a}).removeClass("focusEleField"),i.remove(),!0}function focusEnableFunc(e,t){var i=$("#"+t);e?i.find("input.Macro_Namefield, select, input.textField, textarea.textField").on("focus blur",(function(e){var t=e.type,i=$(this),a=i.parent("td");0===a.length&&(a=i.closest(".labelValCreate")),"focus"===t?a.addClass("focusEleField"):a.removeClass("focusEleField")})):i.find("input.Macro_Namefield, select").off("focus blur")}function focusEnableFuncDetailpage(e){$(e).closest(".mlSelect").find(".select2-search__field").off("focus").on("focus",(function(){$(this).closest(".tabDiv").addClass("focusEleField")}))}function labelWidthFixed(e,t){var i,a=[],s=[];if(void 0===t)var r=$(".columnCal1"),o=$(".columnCal2");else r=$("#"+t+" .columnCal1"),o=$("#"+t+" .columnCal2");for(var n=r.length,l=o.length,d=0;d<n;d++){var c=r.eq(d).outerWidth();a.push(c)}for(d=0;d<l;d++){c=o.eq(d).outerWidth();s.push(c)}var u=Math.max.apply(null,a),m=Math.max.apply(null,s);u>=(i="list"===e?230:"detail"===e?190:210)&&(u=i),m>=i&&(m=i),r.css("width",u+"px"),o.css("width",m+"px")}function getDomWidthCalculation(e,t){var i,a=e.length,s="",r=[],o=[],n=document.createElement("div");n.className="newWidthLabelData",void 0===a&&(a=1);for(var l=0;l<a;l++){if(void 0===e.length)var d=e.FL,c=e.layout;else d=e[l].FL,c=e[l].layout;if("Record Image"!==d.name){var u=d.length;if(void 0!==u)for(var m=0;m<u;m++){var p=d[m];if(!0!==p){var f=$ESAPI.encoder().encodeForHTML(p.displaylabel);s+="2"==c?m%2==0?"<span class='layoutCol1'>"+f+"</span>":"<span class='layoutCol2'>"+f+"</span>":"<span class='layoutCol1'>"+f+"</span>"}}else if("object"==typeof d)s+="<span class='layoutCol1'>"+(f=d.displaylabel)+"</span>"}}n.innerHTML=s,$("body").append(n);var v=$(".layoutCol1"),g=$(".layoutCol2"),h=v.length,C=g.length;for(l=0;l<h;l++){var w=v.eq(l).text();if("undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus())if(Crm.userDetails.detailView_newUI)var b=commonUtils.getTextWidthUsingCanvas(w,{font:"1.5rem LatoRegular"});else b=commonUtils.getTextWidthUsingCanvas(w,{font:"1.4rem LatoRegular"});else if(Crm.userDetails.detailView_newUI)b=commonUtils.getTextWidthUsingCanvas(w,{font:"0.94rem LatoRegular"});else b=commonUtils.getTextWidthUsingCanvas(w,{font:"1.007rem LatoRegular"});r.push(b)}for(l=0;l<C;l++){w=g.eq(l).text();if("undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus())if(Crm.userDetails.detailView_newUI)b=commonUtils.getTextWidthUsingCanvas(w,{font:"1.5rem LatoRegular"});else b=commonUtils.getTextWidthUsingCanvas(w,{font:"1.4rem LatoRegular"});else if(Crm.userDetails.detailView_newUI)b=commonUtils.getTextWidthUsingCanvas(w,{font:"0.94rem LatoRegular"});else b=commonUtils.getTextWidthUsingCanvas(w,{font:"1.007rem LatoRegular"});o.push(b)}var T=Math.max.apply(null,r),I=Math.max.apply(null,o);return T>=(i="list"===t?230:"detail"===t?175:180)&&(T=i),I>=i&&(I=i),$(".newWidthLabelData").remove(),[T,I]}function getExtensionGroup(e){var t="file";if("txt"===e||"pdf"===e||"html"===e||"xml"===e)return t=e;var i={png:["jpeg","jpg","gif","png","webp","bmp","svg"],word:["doc","docx","odt","rtf"],excel:["csv","xls","xlsx","ots","xlsm","ods","numbers","fcs","bks","rdf"],ppt:["odp","pps","pot","pptx","ppt"],movie:["avi","wmv","mp4","mpeg","mpg","mov","flv","mkv","webm"],mp3:["mp3","ogg","oga","wma","m4p","m4a","au","3gp"],zip:["zip","zipx","tar","gz","z","cab","rar","bz2","lzh","7z","img","iso"]};for(var a in i)if(i.hasOwnProperty(a)){var s=i[a];if($.inArray(e,s)>=0){t=a;break}}return t}function showImageType(e){return"fileIcon"+getExtensionGroup(e)}var Encryption={showEncryptionPop:function(e){var t=$("#ENCNOTIFICATION"),i=$("#wmsstatusbar");if(i.find("tr").find("#encProgressIconDiv").length<=0){i.find("tr").prepend("<td style='border-left: 1px solid #ddd;' id='encProgress'><div class='vam pR h30' style='padding: 5px; display: table-cell; bottom: 0px; top: -1px; border-top: 1px solid #fff;'><div id='encProgressIconDiv' data-zcqa='encProgressIcon' class='encProgressIcon cP pR activeProgress'  onclick='Encryption.showProgressDiv()' onmouseover='' data-title='Encryption'></div></div></td>")}if(t.length>0){var a=Handlebars.templates.EncryptionNotification(e);if(t.addClass("schedularOpen"),$("#encryptionMsg"+e.id).length>0?t.find("#encryptionMsg"+e.id).replaceWith(a):$("#ENCNOTIFICATION > ul").append(a),$("#ENCNOTIFICATION li").length>3){var s=$(window).height()/4*3;$("#ENCNOTIFICATION ul").css("max-height",s).addClass("oA")}}else{Handlebars.registerPartial("EncryptionNotification",Handlebars.templates.EncryptionNotification);var r=Handlebars.templates.EncryptionPopup(e);$("body").append(r),t=$("#ENCNOTIFICATION")}if(t.addClass("schedularOpen"),"Progress"===e.status)t.find("#encryptionMsg"+e.id).find(".progressBarAnime").removeClass("dN"),t.find("#encryptionMsg"+e.id).find("#encProgMsg").html(e.message),(o=$("#ENCNOTIFICATION .closeSchedularPop")).addClass("minimizeSchedularPop"),o.removeClass("closeSchedularPop");else if("Success"===e.status||"Failure"===e.status||"Partial"===e.status){var o;if(t.find("#encryptionMsg"+e.id).find(".progressBarAnime").remove(),t.find("#encryptionMsg"+e.id).find(".schedularMsg").removeClass("dN"),t.find("#encryptionMsg"+e.id).find("#encComMsg").html(e.message),t.find("#encryptionMsg"+e.id).find(".viewInfoData").html(e.viewInfo),t.find(".progressBarAnime").length<1)(o=$("#ENCNOTIFICATION .minimizeSchedularPop")).addClass("closeSchedularPop"),o.removeClass("minimizeSchedularPop")}"Success"===e.status?t.find("#encryptionMsg"+e.id).find("#encComMsg").addClass("succesIcoSchedular"):"Failure"===e.status?t.find("#encryptionMsg"+e.id).find("#encComMsg").addClass("failedIcoSchedular"):"Partial"===e.status&&t.find("#encryptionMsg"+e.id).find("#encComMsg").addClass("partialSuccessIcoSchedular")},encPopClose:function(){Encryption.showProgressDiv()},showViewInfo:function(e){$(".viewInfoTbl").removeClass("dN"),$(".viewInfoData").slideUp(300),$(e).addClass("dN"),$(e).siblings(".viewInfoData").slideDown(300)},closeNotification:function(e){var t=$("#ENCNOTIFICATION");$(e).closest("ul").find("li").length<=1?(t.removeClass("schedularOpen",(function(){t.remove()}),100),$("#wmsstatusbar").find("tr").find("#encProgress").remove()):$(e).closest("li").remove()},showProgressDiv:function(){var e=$(".encProgressIcon");e.hasClass("activeProgress")?Encryption.hideEncProgressDiv():(Crm.menu.globalHideMenu(),hideFeedBackPopup(),$("#encProgressDiv").css({bottom:"26px"}),e.addClass("activeProgress"),e.parent().css({top:"-1px","border-top":"1px solid #fff"}),$("#ENCNOTIFICATION").addClass("schedularOpen"))},hideEncProgressDiv:function(){var e=$("#ENCNOTIFICATION");if(e.find(".progressBarAnime").length<1)e.removeClass("schedularOpen",(function(){e.remove()})),$("#wmsstatusbar").find("tr").find("#encProgress").remove();else{$("#encProgressDiv").css({bottom:"-400px"});var t=$(".encProgressIcon");t.removeClass("activeProgress"),t.parent().css({top:"","border-top":""}),e.removeClass("schedularOpen")}}};function showRecordAccess(e){var t=$("#wmsstatusbar");if((i=$("#user_lookup_scheduler")).length<1&&!$L("#recaccProgressIconDiv").length){var i;(i=t.find("tr")[0].insertCell(0)).id="user_lookup_scheduler";var a=networkUtils.returnDependencyFiles(["crm-user-lookup-scheduler.js"],crmConstants.jsStaticPathForLyte),s=networkUtils.returnDependencyFiles(["crm-user-lookup-scheduler.css"],crmConstants.lessStaticPathForLyte),r=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("RecordCoownership")]),o=a.concat(s).concat(r);Lyte.injectResources(o,void 0,(function(){isLoadedInCRMPlusIFrame()?Lyte.Component.render("crm-user-lookup-scheduler",{},"body"):Lyte.Component.render("crm-user-lookup-scheduler",{},i);var t=$L("crm-user-lookup-scheduler")[0].component;t.data.showDiv||t.executeMethod("setInfo",e)}))}else if($L("crm-user-lookup-scheduler")[0].component.executeMethod("setInfo",e),"Success"===e.status)for(var n=e.fldIds,l=n.length,d=0;d<l;d++){delete $("#id_"+n[d]+" >div").data().recaccMode}}function showGDPRCallOut(){$("#emailEntityComposepopup").length<1&&networkUtils.loadFeatureScripts(["zohocrm_gdprCallOut.js"],(function(){setTimeout((function(){var e=$("#gdprcalloutPop"),t=e;0===t.length&&($("body").append(Handlebars.templates.gdprCallOut),t=e),t.length>0&&(mailsetCenter("gdprcalloutPop"),freezeBackground())}),500)}))}function hideGDPRCallOut(e){var t={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};(new crmRequestPool).initiate({action:"/crm/v2/consents/consent_callout_disable",type:"POST",headers:t,data:{},success:function(){var t=$("#gdprcalloutPop");t.css("transform","scale(0)"),removeFreezeLayer(),e&&networkUtils.openUrl(Crm.getCrmBasePath()+"/settings/compliance"),setTimeout((function(){t.remove()}),300)}})}function initAsap(e){if(!Crm.userDetails.DEPLOYMENT.includes("China")&&!Crm.userDetails.LOCALE.includes("zh")&&!isMobileBrowser()){window.ZohoHCAsapSettings={disableDashboard:!0,menuType:"TOP",ticketsSettings:{preFillFields:{email:{defaultValue:$("<div>").html(Crm.userDetails.EMAIL).text(),isHidden:!0},contactName:{defaultValue:Crm.userDetails.DISPLAY_NAME,isHidden:!0},subject:{defaultValue:"Question in "+e}}},customeIcons:{closeIcon:function(e){return'<svg class="contextHelpClose"><use xlink:href="#close_icon"></use></svg>'}},kbSettings:{showArticleTitleInHeader:!0,disableCategoryBreadCrumbs:!0,disableArticleUpdatedInfo:!0,disableArticlesSearch:!0,disableArticlePermalink:!0,articlePageSections:["articlehelp","articlecomments"]},hideLauncherIcon:!0,layoutAdjustments:{maxZindex:32},fontSettings:{fontFamily:"'LatoRegular', sans-serif",fontSize:"15px"}},window.ZohoHCAsapReadyStatus=!1,window.ZohoHCAsapReady=function(e){if(window.ZohoHCAsap__asyncalls=window.ZohoHCAsap__asyncalls||[],window.ZohoHCAsapReadyStatus){e&&window.ZohoHCAsap__asyncalls.push(e);for(var t=window.ZohoHCAsap__asyncalls,i=t.length,a=0;a<i;a++){var s=t[a];s&&s()}window.ZohoHCAsap__asyncalls=null}else e&&window.ZohoHCAsap__asyncalls.push(e)},window.ZohoHCAsap=window.ZohoHCAsap||function(e,t){ZohoHCAsap[e]=t},t=document,(i=t.createElement("script")).type="text/javascript",i.defer=!0,i.src="https://desk.zoho.com/portal/api/web/inapp/4001140137303?orgId=4241905",t.getElementsByTagName("head")[0].appendChild(i)}var t,i}function asapConfigStyles(){var e=document.getElementById("zohohc-asap-web-helper-styles"),t="#zohohc-asap-web-header{background-color: "+Crm.userDetails.SKIN_INFO.NEWBGCOLOR||"#313949};}#hc_asap_header_tabsoption{display: none;}",i=document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t)),e.appendChild(i)}function setKBHeight(e){var t,i=$("#mainMenuTabDiv"),a=i.outerHeight(),s=i.offset().top;t=a+s==void 0?49:a+s;var r=0,o=$("#zohohc-asap-web-layoutbox");(e.includes("Subforms")||e.includes("Interlinking Modules"))&&(t=0),r=renderingUtils.windowHeight-t-28,o.css({height:r,top:t}),Crm.userDetails.RTL_ENABLED&&o.css({right:"initial",left:"0px"}),"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()&&(r=renderingUtils.windowHeight-28,o.css({height:r,top:"0px"}))}function openKB(e){Crm.client_tracking("Help Icon Click",{Feature:e}),"undefined"!=typeof ZohoHCAsap&&"object"!=typeof ZohoHCAsap||initAsap(e),window.ZohoHCAsapReady((function(){setKBHeight(e),asapConfigStyles();var t=RebrandLinkUtil.getProperty("KB_PERMALINK_"+e.replace(/\s/g,"_").toUpperCase()),i=ZohoHCAsap.Actions.History.Index();i&&ZohoHCAsap.Actions.History.Go(-i),ZohoHCAsap.kbArticles.view({permalink:t},{clearPrevious:!0});var a="undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()?"#313949":Crm.userDetails.SKIN_INFO.NEWBGCOLOR||"#313949";(e.includes("Subforms")||e.includes("Interlinking Modules"))&&$("body").addClass("oHImp"),ZohoHCAsap.Actions.UpdateSettings({styles:{customThemeColors:{button:{secondaryBg:"#e3e5ea",primaryBg:"#00a3fe",primaryTextColor:"#ffffff",secondaryTextColor:"#666"},accentBg:"#00a3fe",fontFamily:"DEFAULT",headerAndFab:{secoundaryBg:a,primaryBg:a,textColor:"#fff"},footer:{secoundaryBg:"#ffffff",primaryBg:"#ffffff",primaryTextColor:"#333",separatorBgColor:"#e2e2e2",secoundaryTextColor:"#00a3fe"},text:{primaryColor:"#444444",secondaryColor:"#555555"},body:{secoundaryBg:"#ffffff",borderColor:"#e9e9e9",primaryBg:"#ffffff"}},theme:"CUSTOMTHEME"}})}));var t=$("#zohohc-asap-web-helper-main");t.is(":visible")||t.show(),$(window).keydown((function(t){if(27===t.keyCode&&(e.includes("Subforms")||e.includes("Interlinking Modules")?($("body").removeClass("oHImp"),ZohoHCAsap.Action("close")):ZohoHCAsap.Action("close")),37===t.keyCode||39===t.keyCode){var i=$("#zohohc_asap_mediaviewer_downloadmedia");i&&i.remove()}})),$(window).click((function(){var e=$("#zohohc_asap_mediaviewer_downloadmedia");e&&e.remove()}))}function installAsasp(e){"undefined"!=typeof ZohoHCAsap&&"object"!=typeof ZohoHCAsap||initAsap(e)}function getworkflowjsfiles(e){var t=[];return e?(t.push("zohocrm_workflow.js"),t.push("zohocrm_wfInsights.js"),t.push(networkUtils.getI18nJSUrl("facebook")),t.push(networkUtils.getI18nJSUrl("twitter"))):(t.push("wfNew.js"),t.push("automation/workflow/wfTimeTrigger.js"),t.push("automation/workflow/wfActions.js"),t.push("automation/workflow/wfActionHandler.js"),t.push("automation/workflow/wfmergefield.js"),t.push("automation/workflow/wfTriggers.js"),t.push("automation/workflow/wfDateBased.js"),t.push("automation/workflow/wfOnfupTrigger.js"),t.push("wfCriteria.js"),t.push("automation/workflow/wfFollowupActions.js"),t.push("workflow.js"),t.push("CrmAutomationActions.js"),t.push("CrmUsageCounterTemplate.js"),t.push("CrmCommonActionsTemplate.js"),t.push("CrmWFCriteriaTemplates.js"),t.push("automation/DI/wfBestTime.js"),t.push("WFTask.js"),t.push("automation/actions/wfwebhook.js"),t.push("automation/actions/wfdeluge.js"),t.push("CrmWfInsights.js"),t.push("CrmInsightsTemplate.js")),t.push(networkUtils.getI18nJSUrl("workflowrule")),t.push(networkUtils.getI18nJSUrl("createrecordaction")),t.push(networkUtils.getI18nJSUrl("workflowalert")),t.push(networkUtils.getI18nJSUrl("datebasedworkflow")),t.push(networkUtils.getI18nJSUrl("assignowner")),t.push(networkUtils.getI18nJSUrl("scoringrulesnew")),t.push(networkUtils.getI18nJSUrl("businesshours")),t.push(networkUtils.getI18nJSUrl("workflowtriggerconditions")),t}function fetchWFParamterComponentFiles(){var e=networkUtils.returnDependencyFiles(["automation/common/actions-entity-params-dependencies.js","automation/common/crm-automation-actions-helper.js"],crmConstants.jsStaticPathForLyte);return e=e.concat(networkUtils.returnDependencyFiles(["automation/common/actions-entity-params-dependencies.css"],crmConstants.cssStaticPathForLyte))}function fetchAutomationFunctionFiles(){var e=networkUtils.returnDependencyFiles(["custom-function-model.js","function-model.js"],crmConstants.jsStaticPathForLyte),t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("customfunctions"),"zcrm_custom_functions.min.js"]),i=networkUtils.returnDependencyFiles(["custom-function-editor.js","crm-function-components-wrapper.js","crm-functions-helper.js"],crmConstants.jsStaticPathForLyte),a=networkUtils.returnDependencyFiles(["custom-function-editor.css","crm-reviewprocess-customfunction.css","function-common.css"],crmConstants.cssStaticPathForLyte);Crm.userDetails.RTL_ENABLED&&(a=a.concat(networkUtils.returnDependencyFiles(["function-common-rtl.css"],crmConstants.cssStaticPathForLyte)));var s=networkUtils.returnDependencyFiles(["automation/common/crm-mergefield-multilevel.js"],crmConstants.jsStaticPathForLyte);return s=s.concat(networkUtils.returnDependencyFiles(["automation/common/crm-mergefield-multilevel.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(s=s.concat(networkUtils.returnDependencyFiles(["automation/common/crm-mergefield-multilevel-rtl.css"],crmConstants.cssStaticPathForLyte))),e.concat(t).concat(i).concat(a).concat(s)}function removeViewPortFromAsapWidget(){var e=$("#zohohc-asap-web-helper-core meta[name='viewport']");null!==e&&e.attr("content","")}function deleteUserCheck(e,t,i,a){var s,r=networkUtils.constructUrl(Crm.getCrmBasePath()+"/Security.do?actionName=isDeleteAllowed&id="+e);(new crmRequestPool).initiate({action:r,type:"GET",success:function(r){if(0!=r){for(var o in s=r,$("#automationDiv","#lARhead","#lARdiv","#assgnRestdiv","#assgnResthead","#BMhead","#BMdiv").hide(),s)if(s.hasOwnProperty(o)){var n=s[o];if("assignmentRule"==o)n=constructBusinessMessageDiv(n),validationUtils.isEmpty(n)||(constructParticipateList(n,"lAR"),$("#AssRuleMsg").show());else if("assignmentRestriction"===o)constructParticipateList(n,"assgnRest"),$("#AssRestMsg").show();else if("approvalProcess"===o)constructParticipateList(n,"approvalProcess"),$("#AssRestMsg").show();else if("assignOwner"===o){var l=s[o],d=JSON.parse(JSON.stringify(l));renderAutomationDenyPopComp(d,void 0,void 0,"#automationDiv")}}isDeleteAllowed(!0,t,e,i,a)}else{isDeleteAllowed(!1,t,e,i,a);var c=$L("#userDeletePopup");c.length>0&&c.e.ltProp("show",!1)}}})}function constructBusinessMessageDiv(e){var t={},i=!1;for(var a in e){var s=e[a];2===s.source?i=!0:t[a]=s}return i&&($L("#BMhead").show(),$L("#BMdiv").show()),t}function constructParticipateList(e,t){getElemById(t+"head").style.display="block",getElemById(t+"div").style.display="block",$("#"+t+"div").empty();var i=document.createElement("ul");for(var a in e){var s=document.createElement("li");s.setAttribute("class","p3");var r=document.createElement("a");$(r).empty();var o=e[a],n=null;"lAR"==t?n=Crm.getCrmBasePath()+"/settings/assignment-rules/"+a+"?module="+o.module:"assgnRest"==t?n=Crm.getCrmBasePath()+"/settings/assignment-thresholds/"+a+"?module="+o.module:"WrkF"==t&&(n=Crm.getCrmBasePath()+"/settings/workflow-rules/"+a),r.innerHTML=o.ruleName,r.setAttribute("href",n),r.setAttribute("target","_blank"),s.appendChild(r),i.appendChild(s),getElemById(t+"div").appendChild(i)}}function showThanksPage(){$("#logoutSurveyPop").html(Lyte.Component.render("crm-logout-survey")),setTimeout((function(){Utils.windowLocationHref(crmConstants.logoutURL+"?logoutSurvey=true")}),2e3)}function isMobileBrowser(){return/iPhone|iPad|iPod|Android|webOS|Windows Phone/i.test(navigator.userAgent)}function isLoadedInCRMPlusIFrame(){return"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()}function freezeBackground(){$("#ajax_load_tab").css({top:"0",position:"fixed"});var e=document.createElement("DIV");e.id="FreezeLayer",e.className="freezeLayer";var t=0;document.body&&(document.body.scrollLeft||document.body.scrollTop)?t=document.body.scrollWidth:document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)&&(t=document.documentElement.scrollWidth);var i=renderingUtils.windowHeight;document.body.offsetHeight>i?e.style.height=document.body.offsetHeight+"px":e.style.height=i+"px",e.style.width=0!==t?t+"px":document.body.offsetWidth+"px",getObj("FreezeLayer")||document.body.appendChild(e),"undefined"!=typeof oDialog&&(oDialog.style.zIndex="30"),renderingUtils.scrollPrevent($("#FreezeLayer"))}Storage.prototype.setObject=function(e,t){this.setItem(e,"a"+JSON.stringify(t))},Storage.prototype.getObject=function(e){var t=this.getItem(e);return t&&("{"!==t.charAt(0)&&(t=t.substr(1)),t=JSON.parse(t)),t};var frmName,crmListView={sortTimer:void 0,oldCampaignCustomViewObject:void 0,clickEventIdVsMethodMapping:{selectAllEntity:"crmListView.selectAllEntity",selectEntity:"crmListView.selectEntity",selectOnlineEntities:"crmListView.selectOnlineEntities",selectColumn:"crmListView.selectColumn",navigate_previous_stages:"crmListView.setPrevStageView",navigate_next_stages:"crmListView.loadMoreStageBoards",mLookupselectAllEntity:"multiLookupsView.selectMultiSelectAllEntity",mLookupselectEntity:"multiLookupsView.selectMultiSelectEntity",navigate_previous_listviewmLookup:"multiLookupsView.navigatePrevious",navigate_next_listviewmLookup:"multiLookupsView.navigateNext",campTypeOnClick:"crmListView.viewCampSummaryOnClick",addToCampaigns:"crmListView.addToCampaigns",newCampaignWithMembers:"crmListView.createNewCampaignwithMembers",showPromoPopup:"crmRelatedList.showPromoPopup"},defaultCVFiltersObj:{},modulesWithSmartFilters:["Leads","Contacts","Potentials"],upComingActionTemplateStr:'<div class="w120"><span class="fL w20 h18 mL15 {{getActivityIcon seType}}"></span><span class="fL dIB mR15 pR0 lh16 mT2 h_duedate {{class}}" onmouseenter="crmListView.showActivityDetails(this, \'{{activityId}}\', \'{{encodeJS subject}}\', \'{{seType}}\');" onmouseleave="$(\'#actDetailsDiv,#wf_tooltip\').hide();">{{value}}</span></div>',svUpcomingActionTemplateStr:'<span class="fL dIB pR0 pointer lh16 {{seType}}" data-params=\'{"activityId":"{{activityId}}"}\' onmouseenter="crmListView.showActivityDetails(this, \'{{activityId}}\', \'{{encodeJS value}} - {{encodeJS subject}}\', \'{{seType}}\');" onmouseleave="$(\'#actDetailsDiv,#wf_tooltip\').hide();"><crmutil-icon icon-name="{{toLowerCase seType}}" icon-class="zcicn-{{toLowerCase seType}} crmBaseIcon {{class}}"></crmutil-icon></span>',MAX_FILTER_CNT:15,MAX_STAGECARD_CNT:20,moduleVsDispCol:{Leads:"LASTNAME",Activities:"SUBJECT",Accounts:"ACCOUNTNAME",Contacts:"LASTNAME",Potentials:"POTENTIALNAME",Campaigns:"CAMPAIGNNAME",Cases:"CASESUBJECT",Solutions:"SOLUTIONTITLE",Products:"PRODUCTNAME",Vendors:"VENDORNAME",PriceBooks:"BOOKNAME",Quotes:"QUOTESUBJECT",SalesOrders:"SALESORDERSUBJECT",PurchaseOrders:"PURCHASEORDERSUBJECT",Invoices:"INVOICESUBJECT",Forecasts:"FORECASTNAME",Visits:"VISITEDPAGE"},clickHandler:function(e,t,i){return!this.clickEventIdVsMethodMapping[i]||(Lyte.registeredMixins["crm-utilities"].executeFunctionByName(this.clickEventIdVsMethodMapping[i],window,e,t),!1)},initStageTemplates:function(){Handlebars.registerPartial("stageView",Handlebars.templates.stageView),Handlebars.registerPartial("stageBoard",Handlebars.templates.stageBoard),Handlebars.registerPartial("stageCard",Handlebars.templates.stageCard),crmListView.upComingActionTemplate=Handlebars.compile(crmListView.upComingActionTemplateStr),crmListView.svUpComingActionTemplate=Handlebars.compile(crmListView.svUpcomingActionTemplateStr),crmListView.savedcanvasFiltersTemplate=Handlebars.compile('<li class="f_list cB pL0 lh20 filter_listcontent pR" id="{{filterId}}" data-showForAllCv="{{showForAllCV}}" data-params=\'{"module":"{{module}}", "calleeObj":"crmTab", "fetchOnlyBody":"true", "cvid":"{{cvId}}", "filterId":"{{filterId}}"}\' onClick="Crm.trackSpotLightAction(\'Saved Filter Click\',{\'Module\':\'{{module}}\'});"><link-to lt-prop-route="{{route}}" lt-prop-td=\'{"clearCache" :true,"fetchOnlyBody":"true","clearselectedIds":true}\' lt-prop-dp=\'["{{module}}","{{cvId}}","{{viewid}}"]\' lt-prop-qp = \'{"filter_id" : "{{filterId}}"}\' lt-prop-custom>\t\t\t\t<div class="pL15 pR15 p5"><span class="listText f14 dIB vam mR5" style="max-width:60%;">{{{filterName}}}</span>{{#if displayFilterCount}}<span id="{{filterId}}_count" class="dIB vam f10 listTxtCount"><img src="{{img_link}}/moreloading_90b33f4_.gif"></span>{{/if}}\t\t\t\t<span class="dots3 pA dN svgIcons filterEdit" onclick="crmListView.showFilterOptions(event, \'{{filterId}}\');"></span><div class="cB"></div></div></li></link-to>'),crmListView.savedFiltersTemplate=Handlebars.compile('<li class="f_list cB pL0 lh20 filter_listcontent pR" id="{{filterId}}" data-showForAllCv="{{showForAllCV}}" data-params=\'{"module":"{{module}}", "calleeObj":"crmTab", "fetchOnlyBody":"true", "cvid":"{{cvId}}", "filterId":"{{filterId}}"}\' onClick="Crm.trackSpotLightAction(\'Saved Filter Click\',{\'Module\':\'{{module}}\'});"><link-to lt-prop-route="{{route}}" lt-prop-td=\'{"cvid":"{{cvId}}","clearCache" :true,"fetchOnlyBody":"true","clearselectedIds":true}\' lt-prop-dp=\'["{{module}}","{{cvId}}"]\' lt-prop-qp = \'{"filter_id" : "{{filterId}}"}\' lt-prop-custom>\t\t\t\t<div class="pL15 pR15 p5"><span class="listText f14 dIB vam mR5" style="max-width:60%;">{{{filterName}}}</span>{{#if displayFilterCount}}<span id="{{filterId}}_count" class="dIB vam f10 listTxtCount"><img src="{{img_link}}/moreloading_90b33f4_.gif"></span>{{/if}}\t\t\t\t<span class="dots3 pA dN svgIcons filterEdit" onclick="crmListView.showFilterOptions(event, \'{{filterId}}\');"></span><div class="cB"></div></div></li></link-to>'),crmListView.MUStageOptionsTemplate=Handlebars.compile('<option value="-None-" data-zcqa="pl_MUStage_None">{{getI18n "crm.massupdate.select.stage"}}</option>{{#each stages}}<option value="{{this.display_value}}" {{#if this.colour_code}}data-colorcode="{{this.colour_code}}"{{/if}} data-zcqa="pl_MUStage_{{this.display_value}}">{{this.display_value}}</option>{{/each}}'),crmListView.MUPipelineOptionsTemplate=Handlebars.compile('<option value="-None-" data-zcqa="pl_MUPipeline_None">{{getI18n "crm.massupdate.select.pipeline"}}</option>{{#each pick_list_values}}<option value="{{this.id}}" data-zcqa="pl_MUPipeline_{{this.id}}">{{this.display_value}}</option>{{/each}}'),crmListView.MUPipelineStageTemplate=Handlebars.compile('<div class="pR"><div class="newSelect forpipeline dIB mB15">{{#unless layouts}}<div class="plMSUpdateLable mR15">{{getI18n "crm.label.pipeline"}}</div>{{/unless}}<select id="txt_{{picklist_uitype}}" {{#unless layouts}}class="depField" data-fieldInfo={{pipelineFieldInfo}}{{/unless}} onchange="handlePipelineSelection()" data-zcqa="pl_MUPipeline"><option value="-None-" data-zcqa="pl_MUPipelineNone">{{getI18n "crm.massupdate.select.pipeline"}}</option>{{#each layouts}}{{#layoutHasPipelines this.sections this.id}}<optgroup label="{{../name}}">{{#each this}}<option value="{{../../id}}||{{this.display_value}}" data-zcqa="pl_MUPipeline_{{this.id}}">{{this.display_value}}</option>{{/each}}</optgroup>{{/layoutHasPipelines}}{{/each}}</select></div></div>\t\t<div class="pR"><div class="newSelect forStageSelection dIB mB15 eventNone op5"><div class="plMSUpdateLable mR15">{{getI18n "Stage"}}</div><select id="txt_{{stage_uitype}}" class="depField" data-fieldInfo={{stageFieldInfo}} {{#if layouts}} onchange=handleStageSelection("mPPipe"){{/if}} data-zcqa="pl_MUStage"><option value="-None-" data-zcqa="pl_MUStageNone">{{getI18n "crm.massupdate.select.stage"}}</option></select></div></div>'),crmListView.WFPipelineTemplate=Handlebars.compile('<div class="newSelect forpipeline dIB mB15"><select id="fieldValue1" {{#unless layouts}}class="depField" data-fieldInfo={{pipelineFieldInfo}}{{/unless}} onchange="{{#if onchange}}{{onchange}}{{else}}appendDependencyFields(this){{/if}}"><option value="-None-">{{getI18n "crm.massupdate.select.pipeline"}}</option>{{#each layouts}}{{#layoutHasPipelines this.sections this.id}}<optgroup label="{{../name}}">{{#each this}}<option data-layoutId="{{../../id}}" {{#ifEquals ../../../selectedPipeline this.display_value}} selected {{/ifEquals}} value="{{this.display_value}}">{{this.display_value}}</option>{{/each}}</optgroup>{{/layoutHasPipelines}}{{/each}}</select></div>'),crmListView.MacroPipelineTemplate=Handlebars.compile('{{#each layouts}}{{#layoutHasPipelines this.sections this.id}}<li class="pL10 pT5 cD crm-font-bold" label="{{../name}}" value="{{../id}}">{{../name}}</li>{{#each this}}<li class="Macro_droplistupdateLi crm-font-regular pL20{{#ifEquals ../../../selectedPipeline this.display_value}} Macro_liActive {{/ifEquals}}" onclick="Macro.selectDropListValue(this);sE(event);" data-layoutId="{{../../id}}" data-val="{{this.display_value}}"><span class="pA {{#ifEquals ../../../selectedPipeline this.display_value}} Macro_tickIcon {{/ifEquals}}"></span>{{this.display_value}}</li>{{/each}}{{/layoutHasPipelines}}{{/each}}'),crmListView.BPFieldUpdateTemplate=Handlebars.compile('<div class="newSelect forpipeline dIB mB15"><select id="fieldValue1" onchange="ProcessBuilder.appendDependencyFields(this)" data-zcqa="pl_BPPipeline"><option value="-None-" data-zcqa="pl_BPPipeline_None">{{getI18n "crm.massupdate.select.pipeline"}}</option>{{#each layouts}}{{#layoutHasPipelines this.sections this.id}}<optgroup label="{{../name}}">{{#each this}}<option data-layoutId="{{../../id}}" {{#ifEquals ../../../selectedPipeline this.id}} selected {{/ifEquals}} value="{{this.id}}" data-zcqa="pl_BPPipeline_{{this.id}}">{{this.display_value}}</option>{{/each}}</optgroup>{{/layoutHasPipelines}}{{/each}}</select></div>')},selectEntity:function(e,t){$("body").trigger("click");var i=$(t).data("params").entityId,a=customViewObject.prevSelectedId,s=Lyte.Router.getRouteInstance().transition.info.route,r=Lyte.Router.getRouteInstance().routeName;if(1==e.shiftKey&&null!=a&&a!=i&&0!=$("#"+a).length)return this.shiftSelect(e,t,s,r),!1;var o,n=crmListView.getObject().module,l=$(t).attr("class"),d=customViewObject.isPrivacyListView||customViewObject.isCampaignAddMemberListView?customViewObject.selectedIds:crmTab.getFromCache(n).selectedIds,c=crmListView.getObject().fromIndex,u=$(t).closest("tr").attr("id"),m=0;if($(t).attr("data-params")&&(o=JSON.parse($(t).attr("data-params")).stageId),"customCheckBox"==l){if(d.length==crmConstants.maxSelectCount)return void renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.records.alert",crmConstants.maxSelectCount));if($(t).attr("class","customCheckBoxChecked"),$(t).closest("tr").css("background-color","#FFFCED").addClass("setTdBorBtm"),$("#listViewTable,.fixedrowTd").find("tr#"+u).css("background-color","#FFFCED").addClass("setTdBorBtm"),$("#listViewTable tr#"+u+" .customCheckBox,.fixedrowTd tr#"+u+" .customCheckBox").attr("class","customCheckBoxChecked"),0==$(t).closest("tr").prev("tr").hasClass("setTdBorBtm")&&$(t).closest("tr").prev("tr").addClass("setTdBorBtm"),$(t).closest(".sv-stage-card").addClass("sv-stage-card-selected"),customViewObject.isStageView&&0==d.length&&crmListView.disableSortable(),Lyte.arrayUtils(d,"push",i),crmListView.startIndex.hasOwnProperty(c)?crmListView.startIndex[c]=++crmListView.startIndex[c]:crmListView.startIndex[c]=1,0==(m=o?$("#"+o+" .customCheckBox[data-cid=selectEntity]").length:$(".customCheckBox[data-cid=selectEntity]").length)){var p="";o&&(p=",#"+o+" .stageview-heading-container #checkAll"),$("#listViewTable #checkAll,.fixedheadercolumn #checkAll,#fixedHeader #checkAll,#cvlistViewFilter #cvcheckAll"+p).attr("class","customCheckBoxChecked"),$("#fixedChkSelAll").attr("class","customCheckBoxChecked"),$("#listViewTable #checkAll").attr("class","customCheckBoxChecked"),$("#selectAllRecords").length>0&&($("#selectAllRecords").show(),customViewObject.showSelectAll=!0)}else{p="";o&&(p=",#"+o+" .stageview-heading-container #checkAll"),$("#listViewTable #checkAll,.fixedheadercolumn #checkAll,#fixedHeader #checkAll,#cvlistViewFilter #cvcheckAll"+p).attr("class","partialselect"),$("#listViewTable #checkAll").attr("class","partialselect"),$("#fixedChkSelAll").attr("class","partialselect")}showHideSelectAllLink($("#checkAll").attr("class"),n),"crm.tab.module.custom-view.zia"!=s&&"crm.tab.module.custom-view.list"!=s&&"crm.tab.module.custom-view.kanban"!=s&&"crm.tab.module.custom-view.canvas"!=s&&showHideListViewBtnFn()}else{$(t).attr("class","customCheckBox"),$(t).closest(".sv-stage-card").removeClass("sv-stage-card-selected"),$(t).closest("tr").css("background-color","").removeClass("setTdBorBtm"),$("#listViewTable,.fixedrowTd").find("tr#"+u).css("background-color","").removeClass("setTdBorBtm"),$("#listViewTable tr#"+u+" .customCheckBoxChecked,.fixedrowTd tr#"+u+" .customCheckBoxChecked").attr("class","customCheckBox"),1==$(t).closest("tr").prev("tr").hasClass("setTdBorBtm")&&$(t).closest("tr").prev("tr").removeClass("setTdBorBtm"),Lyte.arrayUtils(d,"removeAt",d.indexOf(i),1),customViewObject.isPredictView||0==d.length&&crmListView.enableSortable(),1==crmListView.startIndex[c]?delete crmListView.startIndex[c]:crmListView.startIndex[c]=--crmListView.startIndex[c];p="";o&&(p="#"+o),0==$(p+" .customCheckBoxChecked[data-cid=selectEntity]").length?(o&&(p+=" .stageview-heading-container #checkAll,"),$(p+"#listViewTable #checkAll,.fixedheadercolumn #checkAll,#fixedHeader #checkAll,#cvlistViewFilter #cvcheckAll").attr("class","customCheckBox"),$("#listViewTable #checkAll").attr("class","customCheckBox"),$("#fixedChkSelAll").attr("class","customCheckBox")):(o&&(p+=" .stageview-heading-container #checkAll,"),$(p+"#listViewTable #checkAll,.fixedheadercolumn #checkAll,#fixedHeader #checkAll,#cvlistViewFilter #cvcheckAll").attr("class","partialselect"),$("#listViewTable #checkAll").attr("class","partialselect"),$("#fixedChkSelAll").attr("class","partialselect"),$("#selectAllRecords").length>0&&$("#selectAllRecords").hide()),showHideSelectAllLink($("#checkAll").attr("class"),n),!customViewObject.doMassActioninScheduler&&d.length>crmConstants.maxSelectCount&&($.each($(".customCheckBoxChecked[data-cid=selectEntity]"),(function(e,t){$(t).attr("class","customCheckBox"),$("#listViewTable tr").eq($(t).closest("tr").index()+1).css("background-color","").removeClass("setTdBorBtm"),$(t).closest("tr").css("background-color","").removeClass("setTdBorBtm"),1==$(t).closest("tr").prev("tr").hasClass("setTdBorBtm")&&$(t).closest("tr").prev("tr").removeClass("setTdBorBtm"),d.removeFirstOccurenceOfElement($(t).data("params").entityId)})),$("#checkAll").attr("class","customCheckBox"),$("#fixedChkSelAll").attr("class","customCheckBox"),d.length>crmConstants.maxSelectCount&&(d=d.slice(0,crmConstants.maxSelectCount))),"crm.tab.module.custom-view.zia"!=s&&"crm.tab.module.custom-view.list"!=s&&"crm.tab.module.custom-view.kanban"!=s&&"crm.tab.module.custom-view.canvas"!=s&&showHideListViewBtnFn()}if("crm.tab.module.custom-view.list"==s||"crm.tab.module.custom-view.zia"==s||"crm.tab.module.custom-view.kanban"==s||"crm.tab.module.custom-view.canvas"==s){var f=Math.round(customViewObject.fromIndex/moduleRecordMapping[n].per_page)+1,v={selectedIds:d,per_page:customViewObject.toIndex,page:f,module:n,start_index:customViewObject.fromIndex-1,route:r};if("customCheckBox"==l&&(v.unCheckedEntitiesCount=m),Lyte.registeredMixins["crm-view-utils"].observeSelectedIds(v),"Leads"==n||"Contacts"==n){var g=$(".customCheckBox").closest("tr").find(".online-entity").length,h=document.querySelector("crm-customview-buttons");if(h)if(h.getData("displayOnlineEntities"))0!=g&&0!=m||h.setData("displayOnlineEntities",!1);else $('[data-id="online-entity-'+i+'-lview"]').length>0&&g>0&&h.setData("displayOnlineEntities",!0)}}customViewObject.selectedIds=d,customViewObject.isPrivacyListView||customViewObject.isCampaignAddMemberListView||(crmTab.getFromCache(n).selectedIds=d),crmListView.editSelectionLayerText(d.length),customViewObject.prevSelectedId=i},selectAllEntity:function(e,t){$("body").trigger("click");var i,a=Lyte.Router.getRouteInstance().transition.info.route,s=crmListView.getObject().module,r=crmTab.getFromCache(s),o=customViewObject.isPrivacyListView||customViewObject.isCampaignAddMemberListView?customViewObject.selectedIds:r&&r.selectedIds?r.selectedIds:[],n=$(t).attr("class"),l=crmListView.getObject().fromIndex;if($(t).attr("data-params")&&(i=JSON.parse($(t).attr("data-params")).stageId),"customCheckBox"==n){customViewObject.selectAllInCurrentView=!0;var d=$("#"+i+" .customCheckBox[data-cid=selectEntity]");if(1==customViewObject.isStageView||1==customViewObject.isPredictView){d=$("#"+i+" .customCheckBox[data-cid=selectEntity]");$("#"+i+" #checkAll").attr("class","customCheckBoxChecked")}else{d=$(".customCheckBox[data-cid=selectEntity]");$(".lv_table_holder #listViewTable #checkAll,.lv_table_holder .fixedheadercolumn #checkAll,.lv_table_holder #fixedHeader #checkAll,#cvlistViewFilter #cvcheckAll").attr("class","customCheckBoxChecked"),$("#fixedChkSelAll").attr("class","customCheckBoxChecked")}0==o.length&&1==customViewObject.isStageView&&crmListView.disableSortable();for(var c=0;c<d.length;c++){var u=$(d).eq(c);if(u.attr("class","customCheckBoxChecked"),u.closest(".sv-stage-card").addClass("sv-stage-card-selected"),!o.contains(u.data("params").entityId)){if(o.length==crmConstants.maxSelectCount&&!customViewObject.doMassActioninScheduler)return customViewObject.selectedIds=o,customViewObject.isPrivacyListView||customViewObject.isCampaignAddMemberListView||(crmTab.getFromCache(s).selectedIds=o),crmListView.editSelectionLayerText(o.length),"crm.tab.module.custom-view.list"!=a&&"crm.tab.module.custom-view.zia"!=a&&"crm.tab.module.custom-view.kanban"!=a&&"crm.tab.module.custom-view.canvas"!=a&&showHideListViewBtnFn(),renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.records.alert",crmConstants.maxSelectCount)),$(t).trigger("click"),$("#fixedChkSelAll").attr("class","customCheckBox"),void(crmListView.startIndex.hasOwnProperty(l)?crmListView.startIndex[l]=crmListView.startIndex[l]+c:crmListView.startIndex[l]=c);u.closest("tr").css("background-color","#FFFCED").addClass("setTdBorBtm").prev("tr").addClass("setTdBorBtm"),Lyte.arrayUtils(o,"push",u.data("params").entityId)}}if(crmListView.startIndex.hasOwnProperty(l)?crmListView.startIndex[l]=crmListView.startIndex[l]+d.length:crmListView.startIndex[l]=d.length,customViewObject.totalCount&&$("#selectAllRecords").length>0)if(customViewObject.totalCount<=Crm.massOperationTotalLimit&&1==customViewObject.showSelectAll){var m=I18n.getMsg("crm.mass.actions.select.all",["",customViewObject.pluralModName]);$("#selectAllRecords").find("a").find("u").text(m),$("#selectAllRecords").show(),customViewObject.showSelectAll=!0}else $("#selectAllRecords").hide(),customViewObject.showSelectAll=!1,$("#scheduleMassActionDiv").hide(),$("#actionMenuForScheduler").css({display:"",visibility:"hidden"});else $("#selectAllRecords").length>0&&1==customViewObject.showSelectAll&&($("#selectAllRecords").show(),customViewObject.showSelectAll=!0);$("#selectAllRecords").length>0&&0==customViewObject.showSelectAll&&(customViewObject.selectAllInCurrentView=!1,customViewObject.doMassActioninScheduler=!1,customViewObject.isPrivacyListView||customViewObject.isCampaignAddMemberListView||(crmTab.getFromCache(s).doMassActioninScheduler=!1)),hideMassOperationsForScheduler()}else if("underLine mL15 cP"==n){if(0!=$(".f_listclick-view").length||0!=$(".checkfilter").length)return renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.selection.all.records.not.available")),void $("#selectAllRecords").css("display","none");if(customViewObject.totalCount){customViewObject.totalCount<=Crm.massOperationTotalLimit?(customViewObject.doMassActioninScheduler=!0,customViewObject.isPrivacyListView||customViewObject.isCampaignAddMemberListView||(crmTab.getFromCache(s).doMassActioninScheduler=!0),showMassOperationsForScheduler(),$(".selCountNum").html(I18n.getMsg("crm.mass.actions.all.selected",["",customViewObject.pluralModName])),overLayForSelectAllClick(!0)):(customViewObject.doMassActioninScheduler=!1,customViewObject.isPrivacyListView||customViewObject.isCampaignAddMemberListView||(crmTab.getFromCache(s).doMassActioninScheduler=!1),$("#selectAllRecords").hide(),customViewObject.showSelectAll=!1,$("#scheduleMassActionDiv").hide(),$("#actionMenuForScheduler").css({display:"",visibility:"hidden"}),crmui.showMsgBand("info",I18n.getMsg("crm.listview.maximum.records.alert",[Crm.massOperationTotalLimit]),4e3,""));d=document.getElementById("totalRecordsCount");var p="Total Records Count";showTotalCount(d,p)}else{customViewObject.doMassActioninScheduler=!0,customViewObject.isPrivacyListView||customViewObject.isCampaignAddMemberListView||(crmTab.getFromCache(s).doMassActioninScheduler=!0);d=document.getElementById("totalRecordsCount"),p="Total Records Count";showTotalCount(d,p)}Crm.trackSpotLightAction("Mass Scheduler - Select All Link",{Module:customViewObject.module})}else{customViewObject.selectedStages&&!customViewObject.selectedStages.length>0?(customViewObject.doMassActioninScheduler=!1,customViewObject.isPrivacyListView||customViewObject.isCampaignAddMemberListView||(crmTab.getFromCache(s).doMassActioninScheduler=!1)):customViewObject.selectedStages&&customViewObject.selectedStages.removeFirstOccurenceOfElement(i);var f=0;divIdStr=1==customViewObject.isStageView||1==customViewObject.isPredictView?"#"+i:"",i&&"#"!=divIdStr?(customViewObject.indTotalCount-=parseInt($("#"+i+" .recordsCount").text().split(" ")[0]),0==customViewObject.indTotalCount&&delete customViewObject.indTotalCount):(divIdStr="",delete customViewObject.indTotalCount),$.each($(divIdStr+" .customCheckBoxChecked[data-cid=selectEntity]"),(function(e,t){$(t).attr("class","customCheckBox"),$(t).closest(".sv-stage-card").removeClass("sv-stage-card-selected"),$("#listViewTable tr").eq($(t).closest("tr").index()+1).css("background-color","").removeClass("setTdBorBtm"),$(t).closest("tr").css("background-color","").removeClass("setTdBorBtm"),1==$(t).closest("tr").prev("tr").hasClass("setTdBorBtm")&&$(t).closest("tr").prev("tr").removeClass("setTdBorBtm"),Lyte.arrayUtils(o,"removeAt",o.indexOf($(t).data("params").entityId)),o.removeFirstOccurenceOfElement($(t).data("params").entityId),f++})),1!=customViewObject.isStageView&&1!=customViewObject.isPredictView||(i?$("#"+i+" #checkAll").attr("class","customCheckBox"):$("#lv_stageview .customCheckBoxChecked[data-cid=selectAllEntity],#lv_stageview .partialselect[data-cid=selectAllEntity]").attr("class","customCheckBox")),1==customViewObject.isStageView?0==o.length&&crmListView.enableSortable():$("#listViewTable #checkAll,.fixedheadercolumn #checkAll,#fixedHeader #checkAll,#cvlistViewFilter #cvcheckAll").attr("class","customCheckBox"),$("#fixedChkSelAll").attr("class","customCheckBox"),crmListView.startIndex[l]=crmListView.startIndex[l]-f,crmListView.startIndex[l]<=0&&delete crmListView.startIndex[l],"customCheckBoxChecked"!=n&&"partialselect"!=n&&(o=[],crmListView.startIndex={}),overLayForSelectAllClick(!1,i)}if(customViewObject.selectedIds=o,customViewObject.isPrivacyListView||customViewObject.isCampaignAddMemberListView||(crmTab.getFromCache(s).selectedIds=o),"crm.tab.module.custom-view.list"==a||"crm.tab.module.custom-view.zia"==a||"crm.tab.module.custom-view.kanban"==a||"crm.tab.module.custom-view.canvas"==a){var v=Math.round(customViewObject.fromIndex/moduleRecordMapping[s].per_page)+1,g={selectedIds:o,data:i,per_page:customViewObject.toIndex,page:v,module:s,start_index:customViewObject.fromIndex-1};Lyte.registeredMixins["crm-view-utils"].observeSelectedIds(g)}else showHideListViewBtnFn(i);if(crmListView.editSelectionLayerText(o.length),"Leads"==s||"Contacts"==s){var h=$("#selectOnlineEntities");h.length>0&&h.hide()}},selectOnlineEntities:function(){for(var e=$(".online-entity"),t=e.length,i=0;i<t;i++){var a=$(e[i]).attr("data-id").split("-")[2],s=$("#selectEntity_"+a);if("customCheckBoxChecked"!=s.attr("class")){crmListView.selectEntity(event,s[0]);var r=crmListView.getObject().module;if(crmTab.getFromCache(r).selectedIds.length==crmConstants.maxSelectCount){renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.records.alert",crmConstants.maxSelectCount));break}}}$("#selectOnlineEntities").hide(),Crm.trackSpotLightAction("Sales IQ - Select All Online Click",{Module:crmListView.getObject().module})},getObject:function(){return customViewObject},latestEntity:function(e){var t=$("#listView_"+e),i=crmListView.getObject();t.length<=0&&i.isCustomizedView&&(t=$("#"+e));var a=i&&i.isStageView;if(0!=t.length)if(a){$(".sv_sel_entity").removeClass("sv_sel_entity");var s=t.closest("div.stageview-data-container").offset().left+t.closest("div.stageview-data-container").width(),r=$("#sv_stage_inner_parent").width();s>r&&$("#sv_stage_inner_parent").scrollLeft(s-r),t.closest("div.stageview-data-container").scrollTop(t.offset().top-250),t.closest("li").addClass("sv_sel_entity"),setTimeout((function(){$(".sv_sel_entity").removeClass("sv_sel_entity")}),5e3)}else $("#listviewtablescroll #lvTred tr#"+e).length?(setTimeout((function(){var t=document.getElementById("tabLayer").offsetHeight,i=document.getElementById("cvpadding"),a=t+(i?i.offsetHeight:"")+document.getElementById("listviewHeaderRow").offsetHeight,s=$("#lvTred tr#"+e).offset().top-a;$("#listviewtablescroll").scrollTop(s)}),50),$("#listViewTable tr[id="+e+"],.fixedrowTd tr[id="+e+"]").attr("class","trialyellowbox"),$("#listViewTable div[id=div"+e+"],.fixedrowTd tr[id="+e+"]").closest("td").addClass("border-left"),setTimeout((function(){$("#listViewTable div[id=div"+e+"],.fixedrowTd tr[id="+e+"]").closest("td").removeClass("border-left")}),2e3)):$("#canvasview-tablescroll #lvTred tr#"+e).length&&(setTimeout((function(){var t=document.getElementById("tabLayer").offsetHeight,i=document.getElementById("cvpadding"),a=t+(i?i.offsetHeight:"")+document.getElementById("cvlistViewFilter").offsetHeight,s=$("#lvTred tr#"+e).offset().top-a;$("#canvasview-tablescroll").scrollTop(s)}),50),$("#listViewTable tr[id="+e+"]").attr("class","trialyellowbox"),$("#listViewTable div[id=div"+e+"]").closest("td").addClass("border-left"),setTimeout((function(){$("#listViewTable div[id=div"+e+"]").closest("td").removeClass("border-left")}),2e3))},renderFilterCount:function(e,t,i){if(customViewObject.displayFilterCount){var a=customViewObject.filterId?void 0:$("#lv_saved_filters").find(".f_listclick-view").attr("id");for(var s in e)if("TotalCount"==s&&null!=t)$(t).find("span").attr("count",e[s]).html("<b>"+e[s]+"</b>&nbsp;"),$(t).children().unwrap(),crmListView.getObject().isPrivacyListView||customViewObject.isCampaignAddMemberListView||!crmTab.getFromCache(i)||(crmTab.getFromCache(i).totalCount=e[s]),!crmListView.getObject().isPrivacyListView&&crmTab.countCache[i]&&(crmTab.countCache[i].TotalCount=e[s]),crmListView.getObject().totalCount=e[s];else{var r=s===a&&null!=e.TotalCount?parseInt(e.TotalCount):parseInt(e[s]),o=$("#"+s+"_count");if(o.length){!crmListView.getObject().isPrivacyListView&&crmTab.getFromCache(i)&&(crmTab.getFromCache(i)[s]=r),!crmListView.getObject().isPrivacyListView&&crmTab.countCache[i]&&(crmTab.countCache[i][s]=r),o.next("#lv_filter_cnt_load").hide(),r>=1e5?o.html("<span class='wsnowrap getWid'>99,999+</span>").attr("title",commonUtils.formatDecimalValue(r)).show().prev("span").attr("style","max-width:60%"):o.html("<span class='wsnowrap getWid'>"+r+"</span>");var n=o.find(".getWid").width();o.css("width",n+"px").find(".getWid").addClass("countAnimi");var l=n+14,d=$("#"+s).find(".listText");d.css("max-width",192-l),"TotalCount"!=s&&thirdPartyUtils.titleForEllipsis(d[0])}$("#filterOptions").bind("onBeforeClose",(function(){$(".filterEdit").addClass("dN")}))}}},checkAll:function(e){var t="partialselect";1!=customViewObject.isStageView&&1!=customViewObject.isPredictView?(0==$(".customCheckBoxChecked[data-cid=selectEntity]").length?t="customCheckBox":0==$(".customCheckBox[data-cid=selectEntity]").length&&(t="customCheckBoxChecked"),$("span[data-cid='selectAllEntity']").attr("class",t)):(0==$("#"+e+" .customCheckBoxChecked[data-cid=selectEntity]").length?t="customCheckBox":0==$("#"+e+" .customCheckBox[data-cid=selectEntity]").length&&(t="customCheckBoxChecked"),$("#"+e+" span[data-cid='selectAllEntity']").attr("class",t)),$("#fixedChkSelAll").attr("class",t)},createPrintView:function(){if(customViewObject.isCustomizedView){for(var e={},t=(customViewObject.body.length,customViewObject.fromIndex-1);t<customViewObject.toIndex&&null!=customViewObject.body[t];t++){var i=customViewObject.body[t],a=$("#customizedholder_"+i.ENTITYID),s="",r=a.find("img").length;if(null!=a&&r>-1){for(var o=a.find("img"),n=$(a.outerHTML()),l=o.length,d=0;d<l;d++){var c=o.eq(d);if(!c.hasClass("canvasDummyImge")&&c.hasClass("entityImg")){var u=c.attr("data-fileid"),m=c.attr("src"),p="";if("n/a"===u)p="canvasDummyImge cd_people_image",m=networkUtils.getImageUrl("image_profile_canvas_1d7b1e9_.svg",ResourceConstants.CRM),n.find("img").eq(d).addClass(p).attr("src",m);else{var f='{"module":"'+customViewObject.module+'","entityId":"'+i.ENTITYID+'","encfileId":"'+u+'"}';n.find("img").eq(d).attr("data-isCanvasImg",!1).attr("data-params",f)}}}s=n.html()}else s=a.html();e[t]='<td id=preview_"'+i.ENTITYID+">"+s+"</td>"}customViewObject.tdData=e;var v=Handlebars.templates.printViewObj(customViewObject);return delete customViewObject.tdData,v}return Handlebars.templates.printViewObj(customViewObject)},createTemplate:function(e,t){var i=e.module;if(renderingUtils.fieldsJSONArray=[],1!=e.showKanbanPopup){if(e.isCustomizedView){for(var a=e.heading?e.heading.length:0,s=[],r=[],o=0;o<a;o++){var n=e.heading[o];if("PHOTO_FILEID"!=n.COLUMNNAME){if(r.indexOf(n.FIELDID)>-1)continue;n.isSortable&&(s.push({FIELDID:n.FIELDID,FIELDLABEL:n.FIELDLABEL}),r.push(n.FIELDID))}}e.sortFields=s,$("#cvfieldMappingdropdown").remove(),e.canModifyCanvas=Crm.userDetails.permissions.Crm_Implied_Customize_Zoho_CRM||Crm.userDetails.USER_ID===e.customizationJSON.created_by&&Crm.userDetails.permissions.Crm_Implied_Manage_CustomViews}if("string"==typeof e.fromIndex&&(e.fromIndex=parseInt(e.fromIndex),e.toIndex=parseInt(e.toIndex)),e.filterId&&(e.filters=customViewObject.filters,e.cross_filters=customViewObject.cross_filters),customViewObject=e,e.maxSelectCount=crmConstants.maxSelectCount,e.isOrchestration=!!e.module&&e.module.startsWith("Orchestration"),e.isOrchestration&&(e.orchestChildModules=Lyte.registeredMixins.orchestration.fetchOrchestrationChildModules()),"false"==e.error&&e.cvName&&(e.module&&e.cvName==="REVIEWPROCESS "+e.module.toUpperCase()||"REVIEWPROCESS CUSTOMMODULE"===e.cvName)&&(e.isReviewProcessView=!0,e.isAdmin=Crm.userDetails.IS_ADMIN),"false"!==e.error||!e.cvName||e.cvName!=="IMAGEVALIDATION"+e.module.toUpperCase()&&"IMAGEVALIDATIONCUSTOMMODULE"!==e.cvName||(e.isImageValidationView=!0),e.body&&null!=e.body&&0!=e.body.length||"false"!=e.error)crmListView.renderNormalView(i,e);else if(1==customViewObject.showBlankState)"Visits"==customViewObject.module?crmListView.renderVistBlankState(e):$("#show").html(Handlebars.templates.newEntityObj(e));else if(1==customViewObject.isDataWaitingForApproval)$("#show").html(Handlebars.templates.customViewObj(e));else{if(e.isKanbanView&&"Closed"==e.columntype&&(e.columns=["Closed","Open","RelatedTo","other"]),"Potentials"==e.module&&(e.isModulePredictionAvailable=Crm.userDetails.isDealPredictionEnabled),moduleRecordMapping[e.module].isRecommendationsEnable){var l=moduleRecordMapping[e.module].recommendationsDetailsJson.what_to;e.recommendation_data=l}$("#viewcontainer").html(Handlebars.templates.customViewObj(e))}if(e.isCustomizedView&&!e.isPredictView){CustomizationLoader.loadJs((function(){new listViewHandler(e).renderListView()})),$("#cvfieldMappingdropdown").remove();var d=$("#CustomizedViewSortColumn"),c=$("#CustomizedViewSortOrder");thirdPartyUtils.bindSelect2("#CustomizedViewSortColumn select",{dropdownParent:d}),thirdPartyUtils.bindSelect2("#CustomizedViewSortOrder select",{dropdownParent:c}),setTimeout((function(){"0"==$("#CustomizedViewSortColumn select").val()?$("#select2-CustomizedViewSortColumnSelect-container").hide():$("#select2-CustomizedViewSortColumnSelect-container").show()}),100)}$("#tagOperList").hide();var u=crmTab.getFiltersFromCache(i);"false"!==e.error||"Leads"!=i&&"Accounts"!=i&&"Contacts"!=i&&"Potentials"!=i?CrmTags.doListViewOperations():crmListView.reorderFiltersForCV(e),e.modulePicklistValues&&(Crm.jsonSelectValues=JSON.parse(JSON.stringify(e.modulePicklistValues))),this.renderFilters(i,e,u),e.isStageView||e.isPredictView?e.showBlankState||crmListView.afterRenderStageView(e):e.isKanbanView?"false"==e.normListView&&"Visits"==e.module?$((function(){$(".footernewClass").addClass("hide"),customViewObject.showBlankState||networkUtils.loadFeatureScripts(["zohocrm_visitstab.js"],(function(){$$zVisits.init(e.posts)}))})):crmListView.afterRenderKanbanView(e):e.isCustomizedView?crmListView.afterRenderCustomizedView(e):crmListView.afterRenderNormalView(e),1===$("#view_toggler a").length&&$("#view_toggler").hide(),setTimeout((function(){placeExtra(),CustomView.initFavorite(),crmNavig.parseCurrentListView(),populateTimeVal($(".ddTime")),e.isCustomizedView||$(".fixedrowTd").html(Handlebars.templates.fixedColumnlistview(e)),e.isCustomizedView&&renderingUtils.tableSorter("listViewTable","0","");var t=e.isCustomizedView?$("#canvasview-tablescroll"):$("#listviewtablescroll");Crm.userDetails.RTL_ENABLED||t.scrollLeft(Crm.tablesorterScrollLeft),t.scrollTop(Crm.tablesorterScrollTop),null==crmTab.countCache[i]&&e.fetchCountValues?showTotalCount($("#tcDiv #totalRecordsCount"),void 0,"true"):null==e.isTotalcountCached&&e.fetchCountValues?showTotalCount($("#tcDiv #totalRecordsCount"),void 0,"false"):crmListView.renderFilterCount(crmTab.countCache[i],$("#tcDiv #totalRecordsCount"),i),"Tasks"!=i&&"Activities"!=i||crmListView.storeVRrules(i,e)}),50),"Visits"==customViewObject.module&&0==$("#printviewBtn").length&&$(".customPluswithImpotBtnCon").hide();var m=$("#listviewtablescroll");m.on("mouseover",".lv_data_user",(function(){crmListView.showUserToolTip(this)})),m.on("mouseout",".lv_data_user",(function(){hideUserBusinessCard()}))}else crmListView.popup(!0,e)},storeVRrules:function(e,t){customViewObject.vRules&&(Crm.validationRuleJSONData||(Crm.validationRuleJSONData={}),Crm.validationRuleJSONData.Tasks={},Crm.validationRuleJSONData.Tasks.validation_rules=customViewObject.vRules,delete customViewObject.vRules)},renderVistBlankState:function(e){$("#show").html(Handlebars.templates.customViewObj(e)),e.isKanbanView?$("#visits_parent_div").html(Handlebars.templates.newEntityObj(e)):$("#idForCV").html(Handlebars.templates.newEntityObj(e)),networkUtils.loadFeatureScripts(["zohocrm_visitsetup.js"],(function(){"All Portals"==customViewObject.screenName&&(VisitsConfig.getEmbedCode(),thirdPartyUtils.bindSelect2("#pListDD"))}))},renderNormalView:function(e,t){$("#divMacro").css("display","none");$("#show");if("Potentials"==t.module&&(t.isModulePredictionAvailable=Crm.userDetails.isDealPredictionEnabled),moduleRecordMapping[t.module]&&moduleRecordMapping[t.module].isRecommendationsEnable){var i=moduleRecordMapping[t.module].recommendationsDetailsJson.what_to;t.recommendation_data=i}if($("#viewcontainer").html(Handlebars.templates.customViewObj(t)),"false"==t.error){var a=t.selectedIds.length,s=$(".tdout");0!=a&&$("#listviewButtonLayerDiv").css("display","block");for(var r=0;a>0&&r<s.length;r++){var o=$(s)[r];-1!=t.selectedIds.indexOf($(o).attr("id"))&&($(o).css("background-color","#FFFCED"),a--)}}},renderSelectedFilters:function(e,t){var i=$("#lv_left_filter");if(i.length){if(i.css("visibility","visible"),e.filters&&e.filters.length){var a=t&&t.filters&&t.filters.length?t:{filters:e.filters};crmListView.populateFilters(a,e)}e.filterId&&$("#"+e.filterId).addClass("f_listclick-view");var s=$("#lv_left_filter").find("input.checkFilter:checked").closest(".filterContainBox");if($("#lv_filter_scroll").children("div").eq(0).prepend(s),e.isVTAdvFilterAvailable){var r=$("#vtFieldOuterDiv"),o=$("#vtMoreSpan");0==i.find("input.checkFilter:checked").closest(".vtColumn").length?(crmListView.setVTDivHt(),o.css("display","inline-block"),o.click((function(){$("#vtFieldDiv").css({height:""}).removeClass("oH"),r.find(o).remove(),r.find(".vt-filter-sep").show()}))):(r.find(".vt-filter-sep").show(),r.find(o).remove())}i.css("visibility","visible");var n=Lyte.Router.getRouteInstance().transition.info.route;e.displayFilters||"crm.tab.module.custom-view.zia"==n||"crm.tab.module.custom-view.kanban"==n||"crm.tab.module.custom-view.list"==n||"crm.tab.module.custom-view.canvas"==n||i.css("display","none"),"crm.tab.module.custom-view.zia"!=n&&"crm.tab.module.custom-view.kanban"!=n&&"crm.tab.module.custom-view.list"!=n&&"crm.tab.module.custom-view.canvas"!=n&&(s.length?$("#lv_filter_hide").css("display","none"):$("#lv_filter_hide").css("display",""))}},renderFilters:function(e,t,i){var a=$("#lv_left_filter");if($("#territorypart a").click((function(){var e=$(this),t=e.attr("id");t=-1!=t.indexOf("a")?t.replace("a_",""):t.replace("sub_",""),Territory.setTerritoryCV(t,e.attr("setvalue"))})),a.length){if(crmListView.renderSelectedFilters(t,i),"Potentials"==e)"Viewed"==localStorage.getItem("dealKanbanViewData")?$(".taskKanbanViewDeactive").addClass("vivewedkanban"):$(".taskKanbanViewDeactive").removeClass("vivewedkanban");"Activities"==e&&$("span[title|='Billable']").closest("div").hide();var s=$("input.userSrchSmartFilter");Search.assignEnter(s),Search.assignOn(s),setTimeout((function(){crmListView.bindPerfectScrollbar()}),1),getElemById("listViewTable")&&(document.getElementById("listViewTable").onselectstart=function(e){if("customCheckBox"==e.target.className||"customCheckBoxChecked"==e.target.className)return!1}),$("#lv_filter_scroll").keypress((function(e){crmListView.toggleFilterOptions(!1,!0)})),$("#lv_filter_scroll").change((function(e){crmListView.toggleFilterOptions(!1,!0)}))}},afterRenderStageView:function(e){var t=$("#sv_visitkanban");if($("#sv_visitnormal").removeClass("listViewTaskActive").addClass("listViewTaskDeactive"),t.removeClass("taskKanbanViewDeactive ripple-wave").addClass("taskKanbanViewActive"),$("#sv_visitcustomization").removeClass("customizedViewActive").addClass("customizedViewDeactive"),"true"!=e.error){if(e.layoutId&&$("#layoutDropdown")[0].ltProp("selected",e.layoutId),"Potentials"==e.module&&e.pipeline&&""!=e.pipeline&&$L("#pipelineSelect")[0].ltProp("selected",e.pipeline),e.sortColumnString){var i=e.sortColumnString;$L("#KanbanViewSortColumnDropdown")[0].ltProp("selected",i);var a=$L("#KanbanViewSortOrderDropdown");"0"===i?a.addClass("nlvDisableOption"):(a[0].ltProp("selected",e.sortOrderString),a.removeClass("nlvDisableOption"))}else $L("#KanbanViewSortColumnDropdown")[0].ltProp("selected","0"),$L("#KanbanViewSortOrderDropdown").addClass("nlvDisableOption");crmListView.createStageIdsArr(e.stageBoards),e.isStageView?(crmListView.checkForNoneStage(e,!0),crmListView.loadStageBoards(e.stageBoardDetails),t.removeClass("taskKanbanViewDeactive").addClass("taskKanbanViewActive")):(crmListView.loadStageBoards(e.predictData),t.removeClass("taskKanbanViewActive").addClass("taskKanbanViewDeactive"),$("#sv_visitpredict").removeClass("predictionKanbanIcon").addClass("predictionKanbanIconAct")),crmListView.checkForEmptyStage(e),crmListView.setWHforStageView(),$("#sv_stage_inner_parent").on("scroll",$L.debounce((function(){crmListView.loadMoreStageBoards()}),100)),e.isStageView&&e.colorScheme&&"random"===e.colorScheme&&crmListView.applyRandomColorForStages(),crmListView.bindScrollToStageBoards(),crmListView.updateStageSummary(),$("#ShowCustomViewDetails").find("br").remove();var s=$("#cvlist");s.length>0&&void 0!==s.perfectScrollbar&&thirdPartyUtils.bindPerfectScroll("#cvlist",{wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!0})}},createStageIdsArr:function(e){var t=[],i=[],a=1;for(key in e)e.hasOwnProperty(key)&&(i.push(e[key].id),a%4==0&&(t.push(i),i=[]),a++);i.length>0&&t.push(i),customViewObject.stageIdsArr=t},checkForEmptyStage:function(e){var t=e.isStageView?e.stageBoardDetails:e.predictData;for(key in t)0===t[key].body.length&&$("#"+key+" #checkAll").hide()},getCustomClasses:function(e){for(var t=e.length,i=0;i<t;i++)e[i].commonClasses={},"Tasks"==e[i].ACTIVITYTYPE?(1==e[i].taskeditperm&&"2"!=e[i].RECORDAPPROVED&&"true"==e[i].ISCOMPLETED&&(e[i].commonClasses.taskCloseClass="dN"),e[i].commonClasses.subjectStyle="max-width: 40%",e[i].commonClasses.subjectClass="f15",e[i].commonClasses.priorityDurationClass="f13 w14per",e[i].commonClasses.priorityDurationTitle=e[i].PRIORITY,e[i].commonClasses.priorityDurationDisplay=e[i].PRIORITY,e[i].commonClasses.statusLocationType=e[i].STATUS,e[i].commonClasses.statusLocationClass="mW35per",""!=e[i].RELATEDTITLE&&(e[i].commonClasses.relatedTitleClass="w75per")):"Events"==e[i].ACTIVITYTYPE?(e[i].commonClasses.subjectClass="font15 mw35per crm-font-bold",e[i].commonClasses.dateClass="mW60per",e[i].commonClasses.dateStyle="width: auto;",e[i].commonClasses.dateTitle=e[i].EVENTLISTVIEWFULLTIME,e[i].commonClasses.dateDisplayVal=e[i].EVENTLISTVIEWTIME,e[i].commonClasses.priorityDurationClass="dN",e[i].commonClasses.statusLocationType=e[i].LOCATION,e[i].commonClasses.statusLocationClass="mL3 w50per",""!=e[i].RELATEDTITLE&&(e[i].commonClasses.relatedTitleClass="w100per")):(e[i].commonClasses.subjectStyle="max-width: 58%",e[i].commonClasses.subjectClass="f15",e[i].commonClasses.dateStyle="width: 32%;",e[i].commonClasses.dateTitle=e[i].CALLSTARTDATETIME_TITLE,e[i].commonClasses.dateDisplayVal=e[i].CALLSTARTDATETIME,e[i].commonClasses.priorityDurationClass="mW35per font11",e[i].commonClasses.priorityDurationDisplay=e[i].CALLDURATION,e[i].commonClasses.statusLocationType=e[i].CALLTYPE,e[i].commonClasses.statusLocationClass="mL3 w45per",""!=e[i].RELATEDTITLE&&(e[i].commonClasses.relatedTitleClass="w65per"))},afterRenderKanbanView:function(e){function t(){$(".tkvcancelLink").click((function(e){e.stopPropagation()})),$(".EditClose").click((function(e){e.stopPropagation()})),TaskKanbanView.setlayoutHt(".leftContainerctn")}TaskKanbanView.KvListItemClickCount=0,TaskKanbanView.kvrecordid=0,TaskKanbanView.iskanbanview=1,TaskKanbanView.kanbanviewloaded=1,e.kvColumnObj&&"false"==e.kvColumnObj.jsonobj.NORECORD&&crmListView.getCustomClasses(e.kvColumnObj.jsonarrayObj),$((function(){$(".footernewClass").addClass("hide");var i=e.isloadmore,a=(e.isRefresh,e.columntype);if("false"===i){if("Closed"===a){e.isFromActivityModule="Activities"===e.module?"true":"false";var s=Handlebars.templates.CrmKanbanViewColumns;$("#"+a+"_leftContainerBody").html(s(e))}t()}else{e.isFromActivityModule="Activities"===e.module?"true":"false";var r=Handlebars.templates.CrmKanbanViewColumns(e);if("false"==e.isRefresh){$("#loadmorediv").html(r),$("ul#"+a+"_Container").append(document.getElementById("loadmorediv").innerHTML);var o=$("#"+a+"_startindex");o.attr("value",parseInt(o.val())+20)}else $("#recordid_"+e.recordid).html(r);$(".tkvcancelLink").off("click"),$(".EditClose").off("click"),t()}"true"==e.nomore&&$("#"+a+"_tkvshowmore").addClass("hide")})),TaskKanbanView.KvCenterItem=0,$(".showhide").removeAttr("style")},afterRenderNormalView:function(e){TaskKanbanView.iskanbanview=0;var t=e.module;null!=e.fetchdate_title||"Leads"!=t&&"Accounts"!=t&&"Contacts"!=t&&"Potentials"!=t||null!=customViewObject.showBlankState&&0!=customViewObject.showBlankState||0!=customViewObject.isDataWaitingForApproval||(setDataFetchDate(),customViewObject.fetchdate_title=getObj("fetchdate_title").title),$("#sv_visitnormal").removeClass("listViewTaskDeactive").addClass("listViewTaskActive"),$("#sv_visitkanban").removeClass("taskKanbanViewActive").addClass("taskKanbanViewDeactive"),$("#sv_visitcustomization").removeClass("customizedViewActive").addClass("customizedViewDeactive"),setTimeout((function(){crmListView.createTableHeader()}),50)},afterRenderCustomizedView:function(e){if($("#sv_visitnormal").removeClass("listViewTaskActive").addClass("listViewTaskDeactive"),$("#sv_visitkanban").removeClass("taskKanbanViewActive").addClass("taskKanbanViewDeactive"),$("#sv_visitcustomization").removeClass("customizedViewDeactive").addClass("customizedViewActive"),LVCGallery.bindCanvasScrollEvent(),e.sortColumnString){var t=e.sortColumnString;0==$("#CustomizedViewSortColumnSelect option[value='"+t+"']").length&&(t="0"),$("#CustomizedViewSortColumnSelect").val(t),"0"==t?$("#CustomizedViewSortOrder").hide():$("#CustomizedViewSortOrderSelect").val(e.sortOrderString)}else $("#CustomizedViewSortColumn").val("0"),$("#CustomizedViewSortOrder").hide(),$("#cvfieldMappingdropdown").remove();Crm.trackSpotLightAction("Canvas - Default View",{Module:e.module}),Crm.client_tracking("Canvas - Default View");var i=$("#cvlist");i.length>0&&void 0!==i.perfectScrollbar&&thirdPartyUtils.bindPerfectScroll("#cvlist",{wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!0})},kanbanView:function(e){for(var t=e.kvColumnObj.jsonarrayObj,i=t.length,a=0;a<i;a++)e.kvmodule.includes("Activities")?t[a].isFromActivityModule="true":t[a].isFromActivityModule="false";if("false"==e.kvColumnObj.jsonobj.NORECORD&&crmListView.getCustomClasses(e.kvColumnObj.jsonarrayObj),"Closed"==e.columntype&&"false"==e.isloadmore){e.columns=["Closed","Open","RelatedTo","other"];var s=Handlebars.templates.TaskKanbanView(e)}function r(){$(".tkvcancelLink").click((function(e){e.stopPropagation()})),$(".EditClose").click((function(e){e.stopPropagation()})),TaskKanbanView.setlayoutHt(".leftContainerctn")}return"Closed"==e.columntype&&($("#idForCV").remove(),$("#ShowCustomViewDetails").append(s)),$((function(){$(".leftContainerctn ul li").on("mouseover",(function(){$(this).hasClass("ligraybackground")||($(this).prev("li").find("div").eq(1).css("border-bottom-color","transparent"),$(this).find("div").eq(1).css("border-bottom-color","transparent"))})),$(".leftContainerctn ul li").on("mouseout",(function(){$(this).hasClass("ligraybackground")||$(this).next("li").hasClass("ligraybackground")&&$(this).find("div").eq(1).css("border-bottom-color","transparent")})),$(".footernewClass").addClass("hide");var t=e.columntype,i=e.nomore;if("false"==e.isloadmore)e.isFromActivityModule="Activities"===e.kvmodule?"true":"false","Closed"!==t&&"Open"!==t&&"RelatedTo"!==t&&"other"!==t||$("#"+t+"_leftContainerBody").html(Handlebars.templates.CrmKanbanViewColumns(e)),r();else{e.isFromActivityModule="Activities"===e.kvmodule?"true":"false";var a=(0,Handlebars.templates.CrmKanbanViewColumns)(e);if("false"==e.isRefresh||null==e.isRefresh){$("#loadmorediv").html(a),$("#"+t+"_Container").append($(a).find("li"));var s=$("#"+t+"_startindex");s.attr("value",parseInt(s.val())+20)}else $("#recordid_"+e.recordid).html(a);$(".tkvcancelLink").off("click"),$(".EditClose").off("click"),r(),i=e.kvColumnObj.jsonobj.NOMORE}"true"==i&&$("#"+t+"_tkvshowmore").addClass("hide"),$(".overDueCtn").on("mouseover",(function(){$(this).find(".overDueTask").addClass("hide"),$(this).find(".overdue").removeClass("hide")})),$(".overDueCtn").on("mouseout",(function(){$(this).find(".overDueTask").removeClass("hide"),$(this).find(".overdue").addClass("hide")})),$(".smFile").on("mouseover",(function(){$(this).siblings(".attachFile").addClass("linkactive")})),$(".smFile").on("mouseout",(function(){$(this).siblings(".attachFile").removeClass("linkactive")})),$(".ddTime").on("focus",(function(){taskDetailsview.ddTime("kanbanTaskDetailctn")})),taskDetailsview.setComposeWindow()})),TaskKanbanView.KvCenterItem=0,s},editSelectionLayerText:function(e){var t=customViewObject.singularModName;if(0!=e){if(1!=e&&(t=customViewObject.pluralModName),customViewObject.selectAllInCurrentView){customViewObject.totalCount&&customViewObject.totalCount>Crm.massOperationTotalLimit&&(customViewObject.doMassActioninScheduler=!1,$("#selectAllRecords").length>0&&(customViewObject.showSelectAll=!1,$("#selectAllRecords").hide()))}customViewObject.doMassActioninScheduler?customViewObject.selectedStages&&customViewObject.selectedStages.length>0&&$(".selCountNum").html(I18n.getMsg("crm.listview.selected.records",[customViewObject.indTotalCount,t])):$(".selCountNum").html(I18n.getMsg("crm.listview.selected.records",[e,t]))}},startIndex:{},changedPermissionsForZBModules:{Crm_Implied_View_CustomModule5001:"Crm_Implied_View_Invoice_Invoices",Crm_Implied_Create_CustomModule5001:"Crm_Implied_Create_Invoice_Invoices",Crm_Implied_Edit_CustomModule5001:"Crm_Implied_Create_Invoice_Invoices",Crm_Implied_View_CustomModule5002:"Crm_Implied_View_Invoice_Estimates",Crm_Implied_Create_CustomModule5002:"Crm_Implied_Create_Invoice_Estimates",Crm_Implied_Edit_CustomModule5002:"Crm_Implied_Create_Invoice_Estimates",Crm_Implied_View_CustomModule5004:"Crm_Implied_View_Invoice_SalesOrders",Crm_Implied_Create_CustomModule5004:"Crm_Implied_Create_Invoice_SalesOrders",Crm_Implied_Edit_CustomModule5004:"Crm_Implied_Create_Invoice_SalesOrders",Crm_Implied_View_CustomModule5003:"Crm_Implied_View_Invoice_PurchaseOrders",Crm_Implied_Create_CustomModule5003:"Crm_Implied_Create_Invoice_PurchaseOrders",Crm_Implied_Edit_CustomModule5003:"Crm_Implied_Create_Invoice_PurchaseOrders"},showColumnList:function(e,t){var i=$(window).scrollTop(),a=$(window).height(),s=$(document).width(),r=$("#wmstoolbar").outerHeight(),o=$("#tabLayer").outerHeight();columnListVDropDown=!0,t=t||"columnList";var n=customViewObject.isCampaignAddMemberListView?$("#lv_table_holder #columnList"):$("#"+t);if(e.preventDefault(),"none"==n.css("display")){$("#listviewHeaderRow #addColumn").addClass("addColumnActive");var l=customViewObject;l.module=customViewObject.isPrivacyListView?customViewObject.module.replace("privacy_",""):customViewObject.module;var d=l.isStageView;if(d||l.hasOwnProperty("columns")){if(d){var c={from:"stageView",save:"crmListView.setStageFilters();",cancel:"hideMenu(event, this);",divid:"sv_sel_stagelist",columns:customViewObject.stageBoards};n.html(Handlebars.templates.columnList(c)),Crm.menu.createMenu(e,t),n.find("li").find('input[type="checkbox"]').off("click").click((function(){!$(this).prop("checked")&&$("#sv_sel_stagelist input:checked").length<2&&(alert("There must be a minimum of 3 stages selected in Stage view"),$(this).prop("checked",!0))}))}else{l.from="listview";var u=Handlebars.templates.columnList(l);n.html(u),delete l.from,Crm.menu.createMenu(e,"columnList"),$("#columnListId").sortable({stop:function(e,t){var i=t.item.find('input[type="checkbox"]');i.length&&(i.prop("disabled",!0),setTimeout((function(){var e=i.attr("data-params");e&&"true"===JSON.parse(e).ismandatory||i.prop("disabled",!1)}),300))}}),n.find("li").find('input[type="checkbox"]').off("click").click((function(){$(this).prop("checked")&&$("#columnListId input:checked").length>Search.MAX_COL_CNT&&(alert(I18n.getMsg("crm.alert.max.cvcols.reached",Search.MAX_COL_CNT)),$(this).prop("checked",!1))}))}n.css("position","fixed"),crmListView.rowClick("listview"),$(document).off("menuItemClicked");var m=$("#cvpadding").outerHeight(),p=$("#notificationCenterContainer").length?$("#notificationCenterContainer").outerHeight():0;if($("#copyListviewHeaderDiv").is(":visible")){n.addClass("fixedTopColumnList");var f=a-(o+m+r)-140}else{n.removeClass("fixedTopColumnList");f=a-(o+m+p+r)-140+i}0==$("#copyListviewHeaderDiv").is(":visible")&&1==$("#cvpadding").hasClass("pFixed")&&n.css("top",parseInt(n.css("top"))+67.5),$("#menuColumnListView").css({"max-height":f}),Crm.userDetails.RTL_ENABLED&&n.css({"min-width":s-($("#addColumn").offset().left+$("#addColumn").width()),zindex:"12 !important"})}else{var v=l.module;(new crmRequestPool).doAjax(Crm.getCrmBasePath()+"/CustomDisplay.do?actionName=show&frmmodule="+v+"&cust_disp_module="+v+"&from=listView&cvid="+l.cvId+"&nocache="+(new Date).getTime(),(function(t){l.columns=t.columns,l.from="listview",l.save="crmListView.saveCustomView(event);",l.cancel="hideMenu(event, this);",l.divid="columnListId";var d=Handlebars.templates.columnList(l);delete l.from,n.html(d),Crm.menu.createMenu(e,"columnList"),n.css("position","fixed"),$("#columnListId").sortable({helper:"clone",stop:function(e,t){var i=t.item.find('input[type="checkbox"]');i.length&&(i.prop("disabled",!0),setTimeout((function(){var e=i.attr("data-params");e&&"true"===JSON.parse(e).ismandatory||i.prop("disabled",!1)}),300))}}),crmListView.rowClick("listview"),$(document).off("menuItemClicked");var c=$("#cvpadding").outerHeight(),u=$("#notificationCenterContainer").length?$("#notificationCenterContainer").outerHeight():0,m=$("#addColumn");if($("#copyListviewHeaderDiv").is(":visible")){n.addClass("fixedTopColumnList");var p=a-(o+c+r)-140}else{n.removeClass("fixedTopColumnList");p=a-(o+c+u+r)-140+i}$("#menuColumnListView").css({"max-height":p}),thirdPartyUtils.bindPerfectScroll("#menuColumnListView",{wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!1}),Crm.userDetails.RTL_ENABLED&&n.css({"min-width":s-(m.offset().left+m.width()),zindex:"12 !important"}),customViewObject.columns=t.columns,n.find("li").find('input[type="checkbox"]').off("click").click((function(){$(this).prop("checked")&&$("#columnListId input:checked").length>Search.MAX_COL_CNT&&(alert(I18n.getMsg("crm.alert.max.cvcols.reached",Search.MAX_COL_CNT)),$(this).prop("checked",!1))})),$("input[value='CrmTask:ISCALLBILLABLE:Billable:']").closest("li").hide()}))}thirdPartyUtils.bindPerfectScroll("#menuColumnListView",{wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!1})}else $("#listviewHeaderRow #addColumn").removeClass("addColumnActive"),n.slideUp(100)},rowClick:function(e){$("#columnListId li").find("label").on("click",(function(t){var a=$(this).find("input");if(a.is(":disabled"))return!1;var s=$("#columnListId li:visible").find("label input:checked").length;t.preventDefault();var r=$(this).closest("li"),o=$("#columnListId li:visible").index($(this).closest("li"));if(a.is(":checked")){a.prop("checked",!1);var n=s-o-1;for(n*=26,r.css({transform:"translateY("+n+"px)",transition:"0.3s all ease"}),i=o+1;i<s;i++)myCSSObj={},myCSSObj.transition="0.3s transform ease",myCSSObj.transition="translateY(-100%)",$($("#columnListId li:visible")[i]).css(myCSSObj);r.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",(function(e){$("#columnListId li").css({transform:"",transition:""}),r.insertAfter($("#columnListId li:visible")[s-1]),r.off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend")}))}else{if($("#columnListId input:checked").length>=Search.MAX_COL_CNT)return crmui.showMsgBand("error",I18n.getMsg("crm.alert.max.cvcols.reached",Search.MAX_COL_CNT),4e3),!1;n=o-s;for(a.prop("checked",!0),n*=26,r.css({transform:"translateY(-"+n+"px)",transition:"0.3s all ease"}),i=s;i<o;i++)myCSSObj={},myCSSObj.transition="0.3s transform ease",myCSSObj.transition="translateY(100%)",$($("#columnListId li:visible")[i]).css(myCSSObj);r.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",(function(e){$("#columnListId li").css({transform:"",transition:""}),r.insertAfter($("#columnListId li:visible")[s-1]),r.off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend")}))}if(Crm.userDetails.isLookupAdvancedSearchEnabled&&"lookupview"==e){var l=$("#columnListId");l.find("input:checked").length>=10?l.find("label input:not(:checked)").attr("disabled","disabled").closest("li").addClass("disable"):l.find("label  input[ismandatory!='true']").removeAttr("disabled").closest("li").removeClass("disable")}}));var t=crmListView.getObject();"Leads"!==t.module&&"Contacts"!==t.module||"lookupview"==e||crmListView.mandatoryCheck()},showAlphaTableList:function(e,t){if(Crm.menu.globalHideMenu(),"none"==$("#alphaRefTable #alphaTable").css("display")){var i=$(t).offset().top,a=$(window).scrollTop;$(t).addClass("alphaSearchActive"),$("#alphaRefTable #alphaTable").css({top:i+34-a}),$("#alphaRefTable #alphaTable").slideDown()}else $("#alphaRefTable #alphaTable").slideUp(100),$(t).removeClass("alphaSearchActive")},alphaSearchHandling:function(){var e=window.event,t=e.target?e.target:e.srcElement;if("A"===t.tagName){var i=objectUtils.cloneObject(Lyte.Router.getRouteInstance().transition.info);if(i.queryParams.page&&(i.queryParams.page=1),"alphaSearch_all"===t.getAttribute("id")||"alphaSearch_remove"===t.getAttribute("id")?delete i.queryParams.search_letter:i.queryParams.search_letter=t.innerHTML,t.getAttribute("data-td"))var a=JSON.parse(t.getAttribute("data-td"));customViewObject.viewid&&a&&delete a.fetchOnlyBody;var s=Lyte.Router.transitionTo(i);a.fetchOnlyBody&&(s.fetchOnlyBody=!0,delete a.fetchOnlyBody),a&&(s.data=a)}},saveCustomView:function(e){var t=crmListView.getObject();t.module=customViewObject.isPrivacyListView?t.module.replace("privacy_",""):t.module;for(var i=$("#columnListId input:checked"),a=!1,s=0;s<t.columns.length;s++)if(t.columns[s]){if(!t.columns[s].hasOwnProperty("SELECTED")){0!=$(i[s]).length&&(a=!0);break}if(0==$(i[s]).length||$(i[s]).data("params").columnname!=t.columns[s].COLUMNNAME){a=!0;break}}if(a){$("#UpdateCustomView").remove(),$("#show").append(CustomView.formSelectColumnString());var r=formData2QueryString(document.getElementById("UpdateCustomView"));return r=r+"&cvid="+t.cvId+"&actionType=addColumn&customviewname="+t.dispCvName+"&"+Territory.csrf(),doAjaxUpdate("json",Crm.getCrmBasePath()+"/UpdateCustomView.do?module="+t.module,r,(function(){var e=crmTab.getFromCache(t.module);crmTab.deleteFromCache(t.module);var i=new crmRequestPool,a={module:t.module,fromIndex:t.fromIndex,toIndex:t.toIndex,currentOption:t.currentOption,fetchOnlyBody:"true",cvid:t.cvId};if(crmListView.getFilterParams(a),crmListView.getAdvSearchCrtFromCVObject(a),"Visits"==t.module){var s=t.portalName;"All Portals"==s?a.allPortals=!0:(a.portalName=s,a.allPortals=!1)}if(customViewObject.isPrivacyListView){var r=objectUtils.cloneObject(Crm.getRouteObject(Lyte.Router.getRouteInstance().transition));return r.data&&delete r.data.fetchOnlyBody,Lyte.Router.transitionTo(r).refresh=!0,!0}if(customViewObject.isCampaignAddMemberListView&&"undefined"!=typeof CrmCampaignInteg)return CrmCampaignInteg.onColumnChange(a,t.module),!0;i.initiate({action:Crm.getCrmBasePath()+"/ShowDetails.do?",data:a,type:"GET",success:function(t){if(t.body&&0!=t.body.length){for(var i=[],a=t.fromIndex-1,s=0;a<=t.toIndex;a++,s++)t.body[s]?i[a]=t.body[s]:i[a]=null;t.body=i}e.body=t.body,e.heading=t.heading,e.fromIndex=t.fromIndex,e.toIndex=t.toIndex,e.sortColumnString="",delete e.columns;var r,o=e.cvFilters.length,n=e.heading,l=n.length;for(a=0;a<o;a++)if(e.isVTAdvFilterAvailable){if(e.cvFilters[a]&&!e.cvFilters[a].crossModule&&!e.cvFilters[a].trackingFilter&&!e.cvFilters[a].isVtColumn){r=a;break}}else if(e.cvFilters[a]&&!e.cvFilters[a].crossModule&&!e.cvFilters[a].trackingFilter){r=a;break}for(a=0;a<l&&r<o;a++,r++){var d,c=n[a].COLUMNNAME;if(e.cvFilters[r]&&e.cvFilters[r].value.split(":")[1]!=c){for(s=r;s<o;s++)if(e.cvFilters[s]&&(e.cvFilters[s].value.split(":")[1]==c||e.cvFilters[s].value.indexOf(c)>-1)){d=e.cvFilters[s];for(s=s;s>r;s--)e.cvFilters[s]=e.cvFilters[s-1]}d?(e.cvFilters[r]=d,d=null):r--}}$(".fixedrowTd").html(Handlebars.templates.fixedColumnlistview(e)),$("#listviewHeaderRow").parent().html(Handlebars.templates.heading(e)),$("#lvTred").html(Handlebars.templates.body(e)),renderingUtils.tableSorter("listViewTable","2","500"),customViewObject=e,crmTab.putInCache(e.module,e),hideMenu(),setTimeout((function(){crmListView.createTableHeader()}),50)}}),delete a.fetchOnlyBody})),!0}this.showColumnList(e)},selectColumn:function(e,t){var i=$(t).find("input");if($(i).prop("disabled"))return!1;$(i).prop("checked")?$(i).pro("checked",!1):$(i).prop("checked",!0)},shiftSelect:function(e,t,i,a){var s=$(t).data("params").entityId,r=customViewObject.body,o=$("#"+customViewObject.prevSelectedId).data("params").recordNum-1,n=$("#"+s).data("params").recordNum-1,l=customViewObject.selectedIds,d=0,c=customViewObject.fromIndex;if("customCheckBox"==$(t).attr("class")){if(n<o)for(var u=o;u>=n;u--){if(l.length==crmConstants.maxSelectCount){renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.records.alert",crmConstants.maxSelectCount));break}if(2!=r[u].approveStatus){var m=r[u].ENTITYID;l.contains(m)||($("#listViewTable #"+m+" .customCheckBox").attr("class","customCheckBoxChecked"),Lyte.arrayUtils(l,"push",m),$("#listViewTable #"+m,".fixedrowTd #"+m).css("background-color","#FFFCED"),$("#listViewTable,.fixedrowTd").find("tr#"+m).css("background-color","#FFFCED").addClass("setTdBorBtm"),$("#fixedrowTd tr#"+m+" .customCheckBox").attr("class","customCheckBoxChecked"),d++)}}else for(u=o;u<=n;u++){if(l.length==crmConstants.maxSelectCount){renderingUtils.showCustomAlert(I18n.getMsg("crm.listview.maximum.records.alert",crmConstants.maxSelectCount));break}if(2!=r[u].approveStatus){m=r[u].ENTITYID;l.contains(m)||($("#listViewTable #"+m+" .customCheckBox").attr("class","customCheckBoxChecked"),Lyte.arrayUtils(l,"push",m),$("#listViewTable #"+m,".fixedrowTd #"+m).css("background-color","#FFFCED"),$("#listViewTable,.fixedrowTd").find("tr#"+m).css("background-color","#FFFCED").addClass("setTdBorBtm"),$("#fixedrowTd tr#"+m+" .customCheckBox").attr("class","customCheckBoxChecked"),d++)}}this.startIndex.hasOwnProperty(c)?this.startIndex[c]=this.startIndex[c]+d:this.startIndex[c]=d,0==$(".customCheckBox[data-cid=selectEntity]").length&&($("#listViewTable #checkAll,.fixedheadercolumn #checkAll,#fixedHeader #checkAll,#cvcheckAll").attr("class","customCheckBoxChecked"),$("#fixedChkSelAll").attr("class","customCheckBoxChecked"))}else{if(n<o){var p=o;o=n,n=p}for(u=o;u<=n;u++)if(2!=r[u].approveStatus){m=r[u].ENTITYID;l.contains(m)&&($("#listViewTable #"+m+" .customCheckBoxChecked").attr("class","customCheckBox"),Lyte.arrayUtils(l,"removeAt",l.indexOf(m),1),$("#listViewTable #"+m,".fixedrowTd #"+m).css("background-color",""),$("#listViewTable,.fixedrowTd").find("tr#"+m).css("background-color",""),$("#fixedrowTd tr#"+m+" .customCheckBoxChecked").attr("class","customCheckBox"),d++)}this.startIndex[c]=this.startIndex[c]-d,0==this.startIndex[c]&&delete this.startIndex[c],0==$(".customCheckBoxChecked[data-cid=selectEntity]").length&&($("#listViewTable #checkAll,.fixedheadercolumn #checkAll,#fixedHeader #checkAll,#cvcheckAll").attr("class","customCheckBox"),$("#fixedChkSelAll").attr("class","customCheckBox"))}if(customViewObject.selectedIds=crmTab.getFromCache(customViewObject.module).selectedIds=l,this.editSelectionLayerText(l.length),"crm.tab.module.custom-view.list"!=i&&"crm.tab.module.custom-view.kanban"!=i&&"crm.tab.module.custom-view.canvas"!=i&&showHideListViewBtnFn(),"crm.tab.module.custom-view.list"==i||"crm.tab.module.custom-view.kanban"==i||"crm.tab.module.custom-view.canvas"==i){var f=Math.round(customViewObject.fromIndex/moduleRecordMapping[customViewObject.module].per_page)+1,v={selectedIds:l,per_page:customViewObject.toIndex,page:f,module:customViewObject.module,start_index:Math.round(customViewObject.fromIndex)-1,route:a};Lyte.registeredMixins["crm-view-utils"].observeSelectedIds(v)}customViewObject.prevSelectedId=s},showSheet:function(){if(!Crm.userDetails.isStorageLimitReached||Crm.isSheetAlertDisabled)if(Crm.userDetails.isStorageLimitReached&&(Crm.isSheetAlertDisabled=!1),Crm.userDetails.permissions["Crm_Implied_ZohoSheet_View_"+customViewObject.module]){var e=customViewObject.searchletter;"All"==e&&(e=null);var t=!1,i=Crm.getCrmBasePath()+"/specific/WebSheetUpload.do?module="+customViewObject.module+"&rangeValue="+customViewObject.currentOption+"&cvid="+customViewObject.cvId+"&searchletter="+e+"&FROM_INDEX="+customViewObject.fromIndex+"&TO_INDEX="+customViewObject.toIndex,a=new FormData;customViewObject.filters&&(a.append("filters",JSON.stringify(customViewObject.filters)),t=!0),customViewObject.cross_filters&&(a.append("cross_filters",JSON.stringify(customViewObject.cross_filters)),t=!0),t&&a.append("isNewFilter",!0),showSheet(i,a)}else openSheetError(I18n.getMsg("crm.security.error"));else Crm.showStorageExceedPopup("sheetAlert")},reportErrorPage:function(e){var t=JSON.parse($(e).attr("data-params"));networkUtils.setCsrfParam(t),(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/FailurePage.do",type:"POST",data:t,success:function(e){$("#listViewErrorMsg").hide(),$("#successMsgContainer").show()}})},getNavigationDiv:function(e){var t=document.getElementsByName("displayCount");$(t).parent("tr").css("display",""),0==e.body.length&&$(t).parent("tr").css("display","none"),1==e.fromIndex?($($(t)[0]).prev("td").html("<div class='previousDisabled'></div>"),$($(t)[1]).prev("td").html("<div class='previousDisabled'></div>")):($($(t)[0]).prev("td").html("<span id='navigatePreviousPage_"+e.fromIndex+"'><input type='button' class='previous' alt='"+I18n.getMsg("crm.label.page.navigation.previous.enabled")+"' name='previoues' id='advancedsearchArrowP' border='0' onclick='crmListView.recordChange({\"module\":\""+e.module+'", "fromIndex":"'+e.fromIndex+'", "nav":"true", "fromListView":"true", "fromApproval":"false", "massActions":"false", "cvid":"'+e.cvId+'","clickId":"navigate_previous_listview"},this)\'></span>'),$($(t)[1]).prev("td").html("<span id='navigatePreviousPage_"+e.fromIndex+"'><input type='button' class='previous' alt='"+I18n.getMsg("crm.label.page.navigation.previous.enabled")+"' name='previoues' id='advancedsearchArrowP' border='0' onclick='crmListView.recordChange({\"module\":\""+e.module+'", "fromIndex":"'+e.fromIndex+'", "nav":"true", "fromListView":"true", "fromApproval":"false", "massActions":"false", "cvid":"'+e.cvId+'","clickId":"navigate_previous_listview"},this)\'></span>')),$($(t)[0]).html("<b>"+e.fromIndex+"</b>&nbsp;<span class='lightgray'>"+I18n.getMsg("crm.label.lowercase.to")+"</span>&nbsp;<b>"+getEndIndex(e.fromIndex,e.toIndex,e.currentOption,e.body)+"</b>"),$($(t)[1]).html("<b>"+e.fromIndex+"</b>&nbsp;<span class='lightgray'>"+I18n.getMsg("crm.label.lowercase.to")+"</span>&nbsp;<b>"+getEndIndex(e.fromIndex,e.toIndex,e.currentOption,e.body)+"</b>"),e.body[e.toIndex]?($($(t)[0]).next("td").html("<span id='navigateNextPage_"+e.fromIndex+"'><input type='button' alt='"+I18n.getMsg("crm.label.page.navigation.next.enabled")+"' class='next fL' name='next' id='advancedsearchArrowN' border='0' onclick='crmListView.recordChange({\"module\":\""+e.module+'", "fromIndex":"'+e.fromIndex+'", "nav":"true", "fromListView":"true", "fromApproval":"false", "massActions":"false", "cvid":"'+e.cvId+'","clickId":"navigate_next_listview"},this)\'></span>'),$($(t)[1]).next("td").html("<span id='navigateNextPage_"+e.fromIndex+"'><input type='button' alt='"+I18n.getMsg("crm.label.page.navigation.next.enabled")+"' class='next fL' name='next' id='advancedsearchArrowN' border='0' onclick='crmListView.recordChange({\"module\":\""+e.module+'", "fromIndex":"'+e.fromIndex+'", "nav":"true", "fromListView":"true", "fromApproval":"false", "massActions":"false", "cvid":"'+e.cvId+'","clickId":"navigate_next_listview"},this)\'></span>')):($($(t)[0]).next("td").html("<div class='nextDisabled'></div>"),$($(t)[1]).next("td").html("<div class='nextDisabled'></div>"))},showCompatibilityError:function(e){renderingUtils.showCustomAlert(I18n.getMsg("crm.filters.incompatible.error.msg")),e&&e.stopPropagation()}};Handlebars.registerHelper("isPipelineEnabled",(function(e,t){var i=crmListView.getObject();if(Crm.userDetails.isMultiPipelineActivated){if(!e){if(!i.layoutId)return t.fn(this);e=i.layoutId}var a=store.peekRecord("layout",e);if(a&&a.sections)for(var s=a.sections,r=s.length,o=0;o<r;o++)if(s[o].fields.filterBy({column_name:"PIPELINE"}).length)return t.fn(this)}return t.inverse(this)})),crmListView.getAdvSearchCrtFromCVObject=function(e){var t=crmListView.getObject();if(t){if(!0===t.criteriaSearch||"true"===t.criteriaSearch){e.rowCount=Search.rowcnt;for(var i=1;i<=Search.rowcnt;i++){e["searchfield"+i]=t["searchfield"+i],1!=i&&(e["match"+i]=t["match"+i]);var a=e["searchfieldtype"+i]=t["searchfieldtype"+i];"U"==a?(e["searchuser"+i]=t["searchuser"+i],e["usercondition"+i]=t["usercondition"+i],e["temp_searchuser"+i]=t["temp_searchuser"+i]):"T"==a?(e["textcondition"+i]=t["textcondition"+i],e["searchtext"+i]=t["searchtext"+i]):"picklist"==a?(e["searchpicklist"+i]=t["searchpicklist"+i],e["textpicklistcondition"+i]=t["textpicklistcondition"+i]):"L"==a?(e["searchlayout"+i]=t["searchlayout"+i],e["textlayoutcondition"+i]=t["textlayoutcondition"+i]):"tag"==a?(e["searchtag"+i]=t["searchtag"+i],e["texttagcondition"+i]=t["texttagcondition"+i]):"N"==a?(e["searchnum"+i]=t["searchnum"+i],e["numcondition"+i]=t["numcondition"+i]):"B"==a?(e["searchboolean"+i]=t["searchboolean"+i],e["booleancondition"+i]=t["booleancondition"+i]):"CML"==a?(e["searchcampcv"+i]=t["searchcampcv"+i],e["campcvcondition"+i]=t["campcvcondition"+i],e["temp_searchcampcv"+i]=t["temp_searchcampcv"+i]):"D"==a?(e["datecondition"+i]=t["datecondition"+i],t["datecondition"+i]==Search.ageCrt||t["datecondition"+i]==Search.dueCrt?(e["ageindayscondition"+i]=t["ageindayscondition"+i],e["ageindays"+i]=t["ageindays"+i]):(e["searchdate"+i]=t["searchdate"+i],e["searchedate"+i]=t["searchedate"+i])):"DT"==a&&(e["datetimecondition"+i]=t["datetimecondition"+i],t["datetimecondition"+i]==Search.ageCrt||t["datetimecondition"+i]==Search.dueCrt?(e["ageindayscondition"+i]=t["ageindayscondition"+i],e["ageindays"+i]=t["ageindays"+i]):(e["searchdatedate"+i]=t["searchdatedate"+i],e["searchsthour"+i]=t["searchsthour"+i],e["searchstminute"+i]=t["searchstminute"+i],e["searchstampm"+i]=t["searchstampm"+i],e["searchenddate"+i]=t["searchenddate"+i],e["searchethour"+i]=t["searchethour"+i],e["searchetminute"+i]=t["searchetminute"+i],e["searchstime"+i]=t["searchstime"+i],e["searchetime"+i]=t["searchetime"+i],e["searchetampm"+i]=t["searchetampm"+i]))}e.patternVal=t.patternVal,e.criteriaSearch=!0}t.searchletter&&"All"!==t.searchletter&&(e.searchletter=t.searchletter);var s=Lyte.Router.getRouteInstance();t.filters&&(e.filters=JSON.stringify(t.filters),"kanban"!=s.routeName&&"canvas"!=s.routeName&&"zia"!=s.routeName||(e.isNewFilter=!0)),t.cross_filters&&(e.cross_filters=JSON.stringify(t.cross_filters),e.isNewFilter=!0),(t.filter_id||t.filterId)&&(e.filterId=t.filter_id?t.filter_id:t.filterId)}},crmListView.showUserToolTip=function(e){if(!Crm.userDetails.CLIENT_ACCOUNT){var t=$(e),i=$("body").outerWidth(),a=t.offset(),s=i<t.closest("td").width()+a.left+300?"left":"right",r=JSON.parse(e.getAttribute("data-params")).userId;Crm.getUserBusinessCard(r,e,s)}};var recordNum,customViewObject={};function getEndIndex(e,t,i,a,s){if(e=parseInt(e),t=parseInt(t),null==i&&(i=t-e+1),i=parseInt(i),!0!==s){if(a&&a.length>=i){if(null!=a[t-1])return e+i-1;for(var r=e-1;null!=a[r];r++);return r}if(a)return a&&a.length>=i&&null!=a[t-1]?e+i-1:e+a.length-1}else if(a)return a&&a.length>=i?e+i-1:e+a.length-1;return 0}function hideMassOperationsForScheduler(){$("#scheduleMassActionDiv").hide(),$("#actionMenuForScheduler").css({display:"",visibility:"hidden"})}function showMassOperationsForScheduler(){$("#macroDiv").css({display:"none",visibility:"hidden"}),$("#selectAllRecords").length>0&&($("#scheduleMassActionDiv").show(),$("#actionMenuForScheduler").css({display:"",visibility:"hidden"}),$("#selectAllRecords").hide(),customViewObject.showSelectAll=!0)}function overLayForSelectAllClick(e,t){var i=customViewObject.fromIndex,a="navigatePreviousPage_"+i,s="navigateNextPage_"+i,r="";t&&(r="#"+t+" .stageview-data-container"),e?$("#lv_stageview "+r+",#lv_left_filter,#lv_table_holder,#listviewHeaderRow,#lvTred,#"+a+",#"+s+",#viewcontainer,crm-custom-filter").addClass("selectAllOverlay"):$("#lv_stageview "+r+",#lv_left_filter,#lv_table_holder,#listviewHeaderRow,#lvTred,#"+a+",#"+s+",#viewcontainer,crm-custom-filter").removeClass("selectAllOverlay")}function reloadAfterMassAction(e,t){if("Leads"===e||"Accounts"===e||"Contacts"===e||"Potentials"===e){var i=$("#fetchdate_title");i.length>0&&i[0].click()}else Utils.windowLocationReload();$("div:visible[id*='job_']").each((function(){$(this).remove()})),massActionNotification.hideMassOperationProgressDiv()}function showHideSelectAllLink(e,t){var i=$("crm-customview-buttons");"customCheckBoxChecked"==e&&Crm.userDetails.ISPAID_USER?(!Lyte.Router.getRouteInstance().getQueryParams().filters&&i&&i.length&&Crm.massOperationTotalLimit>=moduleRecordMapping[t].total_count&&(customViewObject.showHideSelectAllDiv=!0,i[0].setData("showSelectedDiv",!0)),customViewObject.selectAllInCurrentView=!0):(customViewObject.doMassActioninScheduler=!1,customViewObject.isPrivacyListView||customViewObject.isCampaignAddMemberListView||(crmTab.getFromCache(t).doMassActioninScheduler=!1))}function checkDateString(e,t,i){try{var a=Utils.convertUsrtoDefaultDatePattern(i.CONTENT[t],!0)}catch(e){}if(!a||!a.getMonth)return i.CONTENT[t];var s=Utils.getDateInUserDatePattern(a);if($("#currentDate").length&&$("#currentDate").val())var r=$("#currentDate").val().trim().split("-"),o=new Date(r[0],r[1]-1,r[2]);o&&o.getMonth||(o=new Date).setHours(0,0,0,0);var n=Utils.getDayDiff(o,a),l="",d=0===n?"h_todaytask":"h_latertask",c=0===n?I18n.getMsg("Today"):$.datepicker.formatDate("M d",a),u="";a<todaydate&&"false"===i.COMPLETED?(l=a.getTime()<o.getTime()?Utils.getDayDiff(o,a):"",d=0!==n?"h_overdue":d,u=1===n?"crm.label.overdue.late.day":"crm.label.overdue.late.days"):"false"!==i.COMPLETED&&(d="h_completetask");var m=i.ENTITYID;return'<span class="h_duedate '+d+'" title="'+s+'"><input  value="'+c+'" data-old="'+c+'" id="task_'+m+'" name="task_'+m+'" size="6" class="noBdr cP h_duedate '+d+'" onchange="homePageDateEdit(this);" readonly/></span><span class="pL25 f11" name="daydiff" title="'+I18n.getMsg(u,l)+'">'+l+"</span>"}function editmouseover(e,t){var i="#customButtonDetails_"+t;if("phone"==t){var a=$(e).closest("tr");$(a).is(":animated")&&$(a).finish(),$(a).removeClass("tdout").addClass("tdhover"),t=$(a).attr("id"),$("#div"+t).attr("style","visibility:visible"),$(i).attr("style","visibility:visible"),$(e).find("a").attr("style","visibility:visible")}else{$(e).is(":animated")&&$(e).finish(),$(".tdhover").removeClass("tdhover"),$(e).removeClass("tdout").addClass("tdhover");var s=$(e).attr("id");$(".fixedrowTd").find("tr#"+s).removeClass("tdout").addClass("tdhover"),$("#listViewTable tbody").find("#"+s).removeClass("tdout").addClass("tdhover"),$("#div"+t).attr("style","visibility:visible"),$(i).attr("style","visibility:visible"),$(".fixedrowTd").find("#div"+t).attr("style","visibility:visible"),$(".fixedrowTd").find("#div"+t+" a:not(.task_vr_failed)").attr("style","visibility:visible"),$("#selectEntity_"+t+".onHover").attr("style","visibility:visible"),$("#selectEntity_"+t+".customCheckBoxDisabled").attr("style","visibility:visible")}}function editmouseout(e,t){var i="#customButtonDetails_"+t;if("phone"==t){var a=$(e).closest("tr");$(a).removeClass("tdhover").addClass("tdout"),t=$(a).attr("id"),$("#div"+t).attr("style","visibility:hidden"),$(i).attr("style","visibility:hidden"),$(e).find("a").attr("style","visibility:hidden")}else{$("#fixedRowHeader").find();var s=$(e).attr("id");$(".tdhover").removeClass("tdhover"),$(e).removeClass("tdhover").addClass("tdout"),$(".fixedrowTd").find("tr#"+s).removeClass("tdout").addClass("tdhover"),$("#fixedRowHeader").find("#"+s).removeClass("tdhover").addClass("tdout"),$("#div"+t).attr("style","visibility:hidden"),$(i).attr("style","visibility:hidden"),$(".fixedrowTd").find("#div"+t).attr("style","visibility:hidden"),$(".fixedrowTd").find("#div"+t+" a:not(.task_vr_failed)").attr("style","visibility:hidden"),$("#selectEntity_"+t+".onHover").attr("style","visibility:hidden"),$("#selectEntity_"+t+".customCheckBoxDisabled").attr("style","visibility:hidden")}}function getBUFields(e,t,i,a,s){if(null==document.TransferWizardForm.chk)return!1;store.unloadAll("pipeline");var r=document.TransferWizardForm.chk.length,o="";if(null==r){if(!document.TransferWizardForm.chk.checked)return alert(I18n.getMsg("crm.alert.select.one")),!1;o=document.TransferWizardForm.chk.value.split("&&||")[0]}else if(0!=r){if(0==getNoOfChecked())return alert(I18n.getMsg("crm.alert.select.one")),!1;for(C=0;C<r;C++){if(document.TransferWizardForm.chk[C].checked)o=document.TransferWizardForm.chk[C].value.split("&&||")[0]+";"+o}}var n=getObj("fieldUitype").value.split(","),l=getObj("fieldId").value.split(","),d=getObj("fieldLabel").value.split("~~"),c=getObj("fieldLen").value.split(","),u=getObj("fieldName").value.split(","),m=getObj("fieldTableName").value.split(","),p=getObj("fieldDatatype").value.split("~~"),f=u.length,v="<input type='button' value='"+I18n.getMsg("crm.button.cancel")+"' class='newgraybtn' data-zcqa='link_WfDelete_Cancel' href='javascript:;' onclick=\"handleCancelMUNew('"+e+"')\">",g='<h2 class="mB0 pp-header">'+selectfieldtoupdate+"</h2>";g+='<div class="pp-content pB12Imp" style="max-height: 322px;">';var h=(g+='<div class="fieldSelectionWrapper pB7"><table class="w100per"><tbody><tr>')+"<td class='selectCntn'><div class='newSelect'><select id='muFlds' name='muFlds' onChange='setMUFld(this.value, \""+o+'",null,null,"'+t+'","'+i+'","'+a+'",null,null,null,null,"'+e+'","'+s+"\",false,true)'class='fetchLayouts'>";h=h+"<option value='None' style='font-weight:bold'>"+I18n.getMsg("crm.multiselect.massupdate.select")+"</option>";for(var C=0;C<f;C++)"CrmPotential"===m[C]&&"PIPELINE"===u[C]&&(p[C]=p[C].replace("O","M")),h=h+"<option id='"+m[C]+"_"+u[C]+"' <option style='color:black;font-weight:normal' value="+n[C]+"||||"+l[C]+"||||"+encodeURIComponent(d[C])+"||||"+c[C]+"||||"+u[C]+"||||"+m[C]+"||||"+p[C]+"> "+revertSplChrs(d[C])+"</option>";h+="</select></div></td>",h+="<td><div id='dynCont' class='dIB w100per pR'><div class='inputWrapper pL5 pR noFeildSel' id='dummyMassUpdTextFld' name='dummyMassUpdTextFld'><input class='IPArea w100per noborder txtField noBg newuiTextField eventNone' disabled='disabled' data-zcqa='txt_MassUpdate_Value'  maxlength='16'></div></div></td></tr></tbody></table></div>",h+=" </tr></tbody></table>",h=(h=(h+="<div id='multiselectoptionChk' class='actionDecision mT10 dN'>")+"<label class='cP'><input class='rbRealHtml hide' name='multiselect_option' id='multiselect_overwrite' type='radio' data-zcqa='multiselect_overwrite' value='multiselect_overwrite' checked='checked'><span class='rbHtml dIB pR'><span class='rbTickHtml pA'></span></span><span class='rbHtmlLb mL5'>"+I18n.getMsg("crn.social.overrite")+"</span></label>")+"<label class='cP mL20'><input class='rbRealHtml hide' name='multiselect_option' id='multiselect_add' data-zcqa='multiselect-add' value='multiselect_add' onclick='multiselectOptionSelect(true );' type='radio'><span class='rbHtml dIB pR'><span class='rbTickHtml pA'></span></span><span class='rbHtmlLb mL5'>"+I18n.getMsg("crm.import.duplicates.append")+"</span></label>",h=(h+='</div><div id="layoutInfo" class="dN"><p class="pipelineStageInfo pR pL20"><span class="f13"></span></p></div></div>')+'<div class="pp-footer"><div id="cancelButtonDiv" class="dIB">'+v+'</div><div id="saveButtonDiv" class="dIB"><input type="button" value='+I18n.getMsg("crm.button.update")+' disabled="disabled" class="primarybtn"></div></div></div>',$("#bulkUpdateFldsListForScheduler").html(h),showAnimatePopup("bulkUpdateFldsListForScheduler"),freezeBackground(),thirdPartyUtils.bindSelect2("#muFlds");var w=I18n.getMultipleMsg([{key:"crm.massupdate.updatedsuccesfully",params:"' + module + '"},{key:"crm.button.update",params:"' + module + '"},{key:"crm.button.cancel",params:"' + module + '"},{key:"crm.label.lowercase.or",params:"' + module + '"}]),b=(w["crm.massupdate.updatedsuccesfully"],w["crm.button.update"],w["crm.button.cancel"],w["crm.label.lowercase.or"],getObj("muFlds").firstChild);$(b).empty(),b.innerHTML=I18n.getMsg("crm.multiselect.massupdate.select"),thirdPartyUtils.bindSelect2("#muFlds")}function CallonBulkUpdate(e,t,i,a,s,r,o,n,l,d,c){var u=$("#error_status_alert");u.html(""),isWFExecuted=!1;var m="";$(".form_err_msg").empty();var p=[];s=parseInt(s);var f=isFieldValueValid(s,o,a,i,r,u);if(!f)return!1;m=f[0];var v=f[1],g=$(".depField:visible"),h=g.length;if(g.length)for(var C=0;C<h;C++){var w=g[C].getAttribute("data-fieldinfo").split("||||");if(!isFieldValueValid(parseInt(w[0]),w[6],w[4],w[5],w[2],u))return!1;p.push({column:w[4],value:$("#txt_"+w[0]+" :selected").text().trim()})}if(httphandle){if(!mupFieldValidate(r,m,s,o))return 5!=s&&getObj("txt_"+s).focus(),!1;!(m="string"==typeof m?trimBoth(m):m)||1!=s&&11!=s&&27!=s&&127!=s&&62!=s||(m=renderingUtils.removeMultiSpacestoSingleSpace(m)),2==s&&null==m&&(m="");var b="module="+t+"&fieldValue="+encodeURIComponent(m)+"&uiType="+s+"&tableName="+i+"&columnName="+a+"&idlist="+n+"&multiSelectOptionVal="+v+"&from_index="+l+"&to_index="+d+"&rangeValue="+c+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);b+=0!=p.length?"&dependentFieldsUpdate="+JSON.stringify(p):[],httphandle.open("POST",e,!0),httphandle.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),httphandle.onreadystatechange=function(){if(4==httphandle.readyState){var e=httphandle.responseText;if(e.indexOf("Why does my session expire")>-1||e.indexOf("Affordable for Medium Business")>-1)return alert(I18n.getMsg("crm.reauth.login.expired")),void(document.location.href=Crm.getCrmBasePath()+"/ShowHomePage.do");if(200==httphandle.status)if(e.indexOf("SECURITY::::")>-1){var i=e.split("SECURITY::::");divObj=getObj("ShowCustomViewDetails"),$(divObj).empty(),divObj.innerHTML=i[1]}else if(e.indexOf("DELETE::::")>-1){var a=e.split("DELETE::::");divObj=getObj("ShowCustomViewDetails"),$(divObj).empty(),divObj.innerHTML=a[1]}else{var s=!1;try{var r=$.parseJSON(e);s=!0}catch(e){}if(isWFSchedulerUser()&&s&&r.isWFScheduler)return;crmui.showMsgBand("success",I18n.getMsg("crm.label.updated.successfully"),3e3),callMassRecords(l,d,"bulk_mass_update"),crmTab.deleteFromCache(t)}else{if(httphandle.status==crmConstants.errorStatusCode)return void renderingUtils.displayPermissionDenied(httphandle);if(555==httphandle.status)return crmui.showMsgBand("error",httphandle.responseText,"4000",""),void commonUtils.showHideLoadingDiv()}}},httphandle.send(b)}removeFreezeLayer(),hideFreezeLayer(),$("#bulkUpdateFldsListForScheduler").empty(),hideAnimatePopup("bulkUpdateFldsListForScheduler"),$("body").removeClass("oH")}function callMassRecords(e,t,i){var a=i&&"bulk_mass_update"==i;return(a&&Search.getCriteriaDetails(void 0,void 0,!1,void 0)||!a&&Search.validate())&&(a&&(i="mass_update"),document.TransferWizardForm.action=Crm.getCrmBasePath()+"/MassRecords.do?mod=true&actiontype="+i+"&from_index="+e+"&to_index="+t,document.TransferWizardForm.method="post",doAjaxUpdateForm("massResult",document.TransferWizardForm)),!1}Handlebars.registerHelper("getIncludeChild",(function(e,t,i){for(var a=0;a<e.length;a++)if(e[a].id==t)return e[a].hasOwnProperty("ishaving")&&i?e[a].nameanditschild:e[a].name;return""})),Handlebars.registerHelper("IterateMoreActions",(function(e,t,i,a){var s="",r=0,o=3;if("button"!==i){r=o;var n=!0;if((o=e.length)>r)1==o-r&&"scheduleMassOperation"===e[o-1]&&(n=!1);o>r&&n&&(s='<div class="pR dIB fL">',s+='<span class="normalDropDown fL'+(customViewObject.isZBCustomModule?"hide":"")+'">',s+='<span class="newwhitebtn moredot_h2_35 showAct  moredotparentBtn" name="moreAct" data-zcqa="dash_contact_moreAct" id="moreAct" onclick="sE(event);moreAction(this,event)"></span>    \t\t</span>    \t\t<div id="actionMenu" data-zcqa="actionMenu" class="ddM">    \t\t<ul>')}if(o=o>e.length?e.length:o,a)for(;r<o;r++)s+=a.fn(e[r]);return s})),Handlebars.registerHelper("getEndIndex",getEndIndex),Handlebars.registerHelper("I18nDynamicKey",(function(){for(var e=[],t=2;t<arguments.length;t++){var i=arguments[t];null!=Crm.moduleInfo[i]?arguments[t]=Crm.moduleInfo[i].translatedPluralLabel:null!=i.data&&(arguments[t]=arguments[t].data.root.module),e.push(arguments[t])}return I18n.getMsg(arguments[0]+arguments[1],e)})),Handlebars.registerHelper("checkDateString",(function(e,t,i,a){return checkDateString(t,e,i)+a.fn(this)})),crmListView.displayTags=function(e,t,i){for(var a="<ul class='listview_taglists "+(i=i||"w240")+" m0 p0 dIB'>",s=e.length,r=0;r<s;r++){var o=e[r].lastIndexOf("#"),n=e[r],l=n.substring(0,o);""===l&&(l=n.replace("null",""));var d=n.substring(o),c=CrmTags.color_number(d);if(customViewObject.isKanbanView)if(r<2)a+="<li class='tagElementList f13 dIB vam cxAddedTags cxTagCol"+c+"' style=background-color:"+d+"><span>"+$ESAPI.encoder().encodeForHTML(l)+"</span></li>";else{var u=s-2,m=s-u;if(r===m||r>m)if(a+="<li class='tagElementList f13 dIB vam cxAddedTags hiddenTag cxTagCol"+c+"'  style=background-color:"+d+"><span>"+$ESAPI.encoder().encodeForHTML(l)+"</span></li>",r===m)a+='<li class="moreTagOption dIB p0 mB7 mR3 f15 col666 vam">'+('<span class="eventNone" onclick="sE(event);">'+I18n.getMsg("and")+" </span>")+('<span class="moreCount cP" onclick="sE(event);crmListView.showTags(this);">'+parseInt(u)+" "+I18n.getMsg("crm.label.More")+"</span>")+"</li>"}else a+="<li class='tagElementList f13 dIB vam cxAddedTags cxTagCol"+c+"' style=background-color:"+d+"><span>"+$ESAPI.encoder().encodeForHTML(l)+"</span></li>"}return a+"</ul>"},Handlebars.registerHelper("isHiddenModule",(function(e,t){return e?moduleRecordMapping.hasOwnProperty(e)&&4&moduleRecordMapping[e].visibility||"Forecasts"==e||"Notes"==e||"Emails"==e?"":'data-cid="detailView"  data-params=\'{"id":"'+$ESAPI.encoder().encodeForHTML(t)+'","module":"'+$ESAPI.encoder().encodeForHTML(e)+"\"}'":""})),Handlebars.registerHelper("isVisibleModule",(function(e,t,i,a){return a?"<span data-zcqa='colorcode_span_"+t+"_"+i+"' class='colorAppliedPicklist' style='"+getPLStyleObj(a)+"'>"+$ESAPI.encoder().encodeForHTML(t+"")+"</span>":!e||moduleRecordMapping.hasOwnProperty(e)&&4&moduleRecordMapping[e].visibility?$ESAPI.encoder().encodeForHTML(t+""):"Events"!=e&&"Tasks"!=e&&"Calls"!=e||Crm.isActivitySplitDone?"Forecasts"===e&&newForecastsEnabled?'<link-to lt-prop-route="crm.tab.newForecasts.view" lt-prop-dp=\'["'+$ESAPI.encoder().encodeForHTML(i)+'"]\' lt-prop-class="grayblue f15 crm-font-bold">'+$ESAPI.encoder().encodeForHTML(t)+"</link-to>":'<link-to lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp=\'["'+$ESAPI.encoder().encodeForHTML(e)+'","'+$ESAPI.encoder().encodeForHTML(i)+'"]\' lt-prop-class="grayblue f15 crm-font-bold">'+$ESAPI.encoder().encodeForHTML(t)+"</link-to>":'<link-to lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp=\'["Activities","'+$ESAPI.encoder().encodeForHTML(i)+'"]\' lt-prop-qp =\'{"sub_module" : "'+$ESAPI.encoder().encodeForHTML(e)+'"}\' lt-prop-class="grayblue f14 crm-font-bold">'+$ESAPI.encoder().encodeForHTML(t)+"</link-to>"})),Handlebars.registerHelper("checkString",(function(e,t,i,a,s,r,o,n,l,d,c){if(r&&moduleRecordMapping.hasOwnProperty(r)&&4&moduleRecordMapping[r].visibility)return"object"==typeof e?e.DISPLAYLABEL:e;if(Crm.userDetails.CLIENT_ACCOUNT&&(4==t[i].UITYPE||13==t[i].UITYPE||133==t[i].UITYPE||5==t[i].UITYPE||6==t[i].UITYPE||7==t[i].UITYPE||9==t[i].UITYPE||10==t[i].UITYPE||12==t[i].UITYPE||15==t[i].UITYPE||62==t[i].UITYPE||133==t[i].UITYPE)){var u="";return u=a.CONTENT[i].DISPLAYLABEL?"<span>"+a.CONTENT[i].DISPLAYLABEL+"</span>":"<span></span>"}var m="listView_reports"===n;(null==n||m)&&(n="listView");var p=m;if(m=m&&("Forecasts"===r||"Notes"===r||"Emails"===r),customViewObject&&!r&&(recordNum=a.index,t=customViewObject.heading,s=customViewObject.cvId,r=customViewObject.module),s||(s=null),"Contact Roles"==r?r="Contacts":"Invited Events"==r&&(r="Activities"),"Member Status"==t[i].COLUMNALIAS&&null!=a.REMARKS)return"<span style='cursor: pointer' onmouseout='zctt.hidett();' onmouseover='zctt.showtt( \""+a.REMARKS+"\")'>"+c.fn(this)+"</span>";if("PHOTO_FILEID"==t[i].COLUMNNAME&&""!=e){var f=Crm.getCrmBasePath()+"/EntityImageAttach.do?action_module="+r+"&entityId="+a.ENTITYID+"&actionName=readImage&fileId="+e;return f=Crm.getPortalURL(f),"<div id = 'imgContainer' class='emptyAccLogo'><img id="+r+"_"+a.ENTITYID+"_photo src="+f+" class='dvPhotoShadow'/></div>"}if("CONTACTID"===t[i].COLUMNNAME&&("homePage"===n||"customHomepage"===n)&&""!==e&&CrmDashboard.needToLoadContactImage){var v=e.ENTITYID,g=$("<div>").attr("class","Image_Container").attr("style","width:22px;height:22px;float:left");g.append($("<img>").attr("class","Image_"+v).attr("onerror","this.onerror=null;this.src="+networkUtils.getImageUrl("nophoto_80ea3af_.png",ResourceConstants.CRM))),g=g.prop("outerHTML");var h=this.MODULE,C=this.MODULE.toLowerCase();if(void 0===h)return"";var w="Crm_Implied_View_"+h;crmListView.changedPermissionsForZBModules.hasOwnProperty(w)&&(w=crmListView.changedPermissionsForZBModules[w]),w=Crm.userDetails.permissions[w],h=h.slice(0,h.lastIndexOf("s"));var b="<link-to ";if(w>-1)"Tasks"===this.MODULE||"Calls"===this.MODULE||"Events"===this.MODULE?b+='lt-prop-id="'+n+"_"+this.ENTITYID+'" lt-prop-class="link"  style="padding-left:7px"  "lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp=\'["Activities","'+this.ENTITYID+'"]\' lt-prop-qp=\'{"sub_module":"'+this.MODULE+'"}\' lt-prop-td=\'{"relContactId":"'+(a.relContactId?a.relContactId:null)+'","module":"'+this.MODULE+'","id":"'+this.ENTITYID+'","lookback":"true","fromActivityListView":"true"}\' onmouseover="showRelatedFields_new(\''+this.MODULE+"','"+this.ENTITYID+'\',this)" onmouseout="hideLoadingDiv();" data-zcqa="detailView">':b+='lt-prop-id="'+n+"_"+this.ENTITYID+'" lt-prop-class="link" style="padding-left:7px"  lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp=\'["'+this.MODULE+'","'+this.ENTITYID+'"]\' lt-prop-td=\'{"relContactId":"'+(a.relContactId?a.relContactId:null)+'","module":"'+this.MODULE+'","id":"'+this.ENTITYID+'","lookback":"true","fromActivityListView":"true"}\' onmouseover="showRelatedFields_new(\''+this.MODULE+"','"+this.ENTITYID+'\',this)" onmouseout="hideLoadingDiv();" data-zcqa="detailView">';else{b='<a href="javascript:;" style="padding-left:7px"  title="permission denied" data-permission="false">';var T=!0}return"CONTACTID"!==t[i].COLUMNNAME&&(C.includes("custommodule")&&(C="custom"),b+="<div class='dIB vam'><crmutil-icon  icon-name=\""+C+'" icon-class="zcicn-'+C+' crmBaseIcon zcicn_embedSvg crmBaseIcon size_m mR5" ></crmutil-icon></div>'),b+=c.fn(this.DISPLAYLABEL),g+(b+=T?"</a>":"</link-to>")}if("CALLDURATION"==t[i].COLUMNNAME&&":00"==e)e="";else{if("BOUNCE_REASON"===t[i].COLUMNNAME)return u='<span class="lvBounceMsg vam dIB" onmouseleave="crmui.toolTip_hide();" onmouseenter=crmui.toolTip_show(this,"left",$(this).text())>'+e+"</span>";if(t[i].UITYPE==CrmField.UITYPES.SERVICE_DURATION){var I=detailView.converMinToHourAndMin(parseInt(e));return I.length>1?detailView.constructDurationTxt(I[0],I[1]):""}if("object"!=typeof e&&void 0!==t){if(void 0===t[i])return;if(25==t[i].UITYPE)return u='<a data-cid="dummy" class="link" href="mailto:'+c.fn(this)+'">'+c.fn(this)+"</a>";if(21==t[i].UITYPE){u="";var y="http";return""===e||0!=e.indexOf(y)&&0!=e.indexOf("https")?""!=e&&(u='<a data-cid="dummy" class="link" href="http://'+c.fn(this)+'" target="_blank">'+c.fn(this)+"</a>"):u='<a data-cid="dummy" class="link" href="'+c.fn(this)+'" target="_blank">'+c.fn(this)+"</a>",u}if(301==t[i].UITYPE||300==t[i].UITYPE||116==t[i].UITYPE&&"boolean"==t[i].RETURNTYPE){u="";return!0===e||"true"==e?(u='<span class="yes"></span>',customViewObject.isStageView&&(u+='<span class="dIB pL5">'+t[i].FIELDLABEL+"</span>")):(u='<span class="no-new"></span>',customViewObject.isStageView&&(u="")),u}if(100==t[i].UITYPE){u=c.fn(this);return""!=e&&(u=u.replace(/;/g,"; ")),u}if(22==t[i].UITYPE){u="";if(""!=e){var P=c.fn(this);u='<a data-cid="dummy" data-zcqa="dummy" class="link" href="'+RebrandLinkUtil.getProperty("TW_URL")+"/"+$ESAPI.encoder().encodeForURL(P)+'" target="_blank" id="subvalue_Twitter">'+$ESAPI.encoder().encodeForHTML(P)+"</a>"}return u}if(38==t[i].UITYPE)return"TIMESPENT"==t[i].COLUMNNAME||"AVERAGETIMESPENT"==t[i].COLUMNNAME?Utils.convertTimeInDoubleToReadableForm(c.fn(this)):isNaN(parseFloat(c.fn(this)))?"":!0===t[i].separator?c.fn(this):parseFloat(c.fn(this));if(33==t[i].UITYPE){if(""==e)return c.fn(this);if(!1===a.ISCALLALLOWED||t[i].donotshow)return"<div class='phoneRtl' style='min-width:100%'>"+c.fn(this)+"</div>";if(customViewObject&&1==customViewObject.outbound||c&&c.data&&c.data.root&&!0===c.data.root.outbound){customViewObject.ctiprotocol&&(customViewObject.ctiprotocol,c.fn(this));return"<div class='phoneRtl' style='min-width:100%'>"+c.fn(this)+"<a href='javascript:;' class='calliconOuter fN' onmouseover='CTIAPI.showCallButtonlabel(this)' onmouseout=\"CTIAPI.hideCallButtonlabel(this)\" onclick=\"sE();ctiApiNotifier.click2Call('"+$ESAPI.encoder().encodeForJavaScript(this)+"','"+Crm.userDetails.ZGID+"','"+Crm.userDetails.USER_ID+"','"+a.ENTITYID+"','','"+r+"','"+$ESAPI.encoder().encodeForJavaScript(a.ENTITYNAME)+"')\"><i class='callIcon'></i><span id='calllabel1'>"+I18n.getMsg("Call")+"</span></a></div>"}if(Crm.userDetails.ZPBENABLED){var _='asyncFn(crmCallsNew.getClick2CallPromise,"'+a.ENTITYID+'","'+r+'","'+$ESAPI.encoder().encodeForJavaScript(a.ENTITYNAME)+'")';return"<div class='phoneRtl pR pR20'><span class='dIB vam'>"+c.fn(this)+"</span><span class='phoneIcon_lv m0'><zpb-phone number='"+c.fn(this)+"' module='"+r+"' recordid='"+a.ENTITYID+"' callbackparamfn='"+_+"'></zpb-phone></span></div>"}return"<div onmouseover='editmouseover(this, \"phone\");' onmouseout='editmouseout(this, \"phone\");' class='phoneRtl dIB'>"+c.fn(this)+"<a style='visibility:hidden;' class='pH2 phoneRtl' title='"+I18n.getMsg("crm.phoneNo.Link.Title")+"' href='skype:"+c.fn(this)+"?call' onclick='sE();'></a></div>"}if(200!=t[i].UITYPE&&786!=t[i].UITYPE&&14!=t[i].UITYPE&&24!=t[i].UITYPE&&202!=t[i].UITYPE&&333!=t[i].UITYPE&&(116!=t[i].UITYPE||"datetime"!=t[i].RETURNTYPE&&"date"!=t[i].RETURNTYPE)||"en_US"!=Crm.userDetails.COUNTRY_LOCALE&&"en_GB"!=Crm.userDetails.COUNTRY_LOCALE){if(209==t[i].UITYPE&&e&&e.length>0)return crmListView.displayTags(e.split(","));if(3==t[i].UITYPE||110==t[i].UITYPE)return o&&"DESCRIPTION"===t[i].COLUMNNAME?crmListView.toggleText(!0,!1,void 0,e):"<pre style='word-wrap: break-word; white-space:pre-wrap;'> "+c.fn(this)+"</pre>";if(32===t[i].UITYPE||52===t[i].UITYPE||117===t[i].UITYPE)return e;if(2===t[i].UITYPE||26===t[i].UITYPE){if(t[i].colorcode_enabled&&!0===t[i].colorcode_enabled&&e&&""!==e.trim()&&"-None-"!==e){var D=getPicklistStyleObj(e,t[i].picklistmap);return"<span data-zcqa='colorcode_span_"+a.ENTITYID+"_"+t[i].FIELDID+"' class='colorAppliedPicklist' style='"+D+"'>"+c.fn(this)+"</span>"}return c.fn(this)}if(!m&&(0===r.indexOf("CustomModule")&&"NAME"===t[i].COLUMNNAME||6===Crm.moduleInfo[r].genType&&"NAME"===t[i].COLUMNNAME||t[i].COLUMNNAME===crmConstants.listViewMandatoryColumns[r]||"FULLNAME"===t[i].COLUMNNAME)){var O=a.relContactId?a.relContactId:null;w="Crm_Implied_View_"+r;crmListView.changedPermissionsForZBModules.hasOwnProperty(w)&&(w=crmListView.changedPermissionsForZBModules[w]),w=Crm.userDetails.permissions[w];u="<a ",b="<link-to ";if("object"==typeof CrmTracking)CrmTracking.isEntityOnline(r,a.ENTITYID)&&(u="<span data-id='online-entity-"+a.ENTITYID+"-lview' class='online-entity vat'></span><a ",b="<span data-id='online-entity-"+a.ENTITYID+"-lview' class='online-entity lft5 vat'></span><link-to ");if(w>-1?b+="mLookup"==n?"Activities"===r?'lt-prop-target="_blank" lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp=\'["Activities","'+a.ENTITYID+'"]\' lt-prop-qp=\'{"sub_module":"'+a.MODULE+"\"}'":'lt-prop-target="_blank" lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp=\'["'+a.MODULE+'","'+a.ENTITYID+"\"]'":"Activities"===r?' data-zcqa="detailView" lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp=\'["Activities","'+a.ENTITYID+'"]\' lt-prop-qp=\'{"sub_module":"'+a.MODULE+"\"}'":' data-zcqa="detailView" lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp=\'["'+a.MODULE+'","'+a.ENTITYID+"\"]'":u+='href="javascript:;" title="permission denied" data-permission="false"',u+='id="'+n+"_"+a.ENTITYID+'" data-params=\'{"relContactId":"'+O+'","module":"'+a.MODULE+'","id":"'+a.ENTITYID+'","cvid":"'+s+'","recordNum":"'+recordNum+'","lookback":"true"',b+='lt-prop-id="'+n+"_"+a.ENTITYID+'" lt-prop-td=\'{"relContactId":"'+O+'","module":"'+a.MODULE+'","id":"'+a.ENTITYID+'","cvid":"'+s+'","recordNum":"'+recordNum+'","lookback":"true"',"Activities"!==r&&"Tasks"!==r&&"Calls"!==r&&"Events"!==r||p)o&&(u+=',"stageId":"'+o+'"',b+=',"stageId":"'+o+'"');else if("Activities"===r?(u+=',"fromActivityListView":"true"',b+=',"fromActivityListView":"true"'):(u+=',"fromActSubModuleListView":"true"',b+=',"fromActSubModuleListView":"true"'),d){var S=parseInt((parseInt(recordNum)-1)/d)*d+1,L=S+d-1;u+=',"FROM_INDEX":"'+S+'","TO_INDEX":"'+L+'"',b+=',"FROM_INDEX":"'+S+'","TO_INDEX":"'+L+'"'}return"homePage"!=n&&"customHomepage"!=n||!l||(u+=', "layoutId" : "'+l+'"',b+=', "layoutId" : "'+l+'"'),"customHomepage"==n&&(u+=', "toolTip" : "'+I18n.getMsg("crm.custom.home.tooltip")+'"',b+=', "toolTip" : "'+I18n.getMsg("crm.custom.home.tooltip")+'"'),u+='}\' class="link">'+c.fn(this)+"</a>",b+='}\' lt-prop-class="link">'+c.fn(this)+"</link-to>","Activities"!==r&&"Calls"!==r||"homePage"!=n&&"customHomepage"!=n||"Calls"!=a.MODULE||"Scheduled"!=a.callStatus&&"Overdue"!=a.callStatus||(u+="<span id='homePageMore_"+a.ENTITYID+"' class='rep_runbtn vh' data-zcqa='callMoreOption' onclick=\" Crm.scheduledCallMoreOption(this, 'homePage',"+a.OWNERID+",'"+l+'\'); sE1(event);"><i class="sort_desc svgIconsImg"></i></span>',b+="<span id='homePageMore_"+a.ENTITYID+"' class='rep_runbtn vh' data-zcqa='callMoreOption' onclick=\" Crm.scheduledCallMoreOption(this, 'homePage',"+a.OWNERID+",'"+l+'\'); sE1(event);"><i class="sort_desc svgIconsImg"></i></span>'),b}if("Mailing Street"===t[i].FIELDLABEL||"Billing Street"===t[i].FIELDLABEL||"Street"===t[i].FIELDLABEL){var E=c.fn(this).split("~~~"),x=void 0===E[0]||""===E[0]||"null"===E[0]?"&nbsp;":E[0],F=E[1];return u=null!=F&&""!==F&&"null"!==F?'<div class="fromAddress" onmouseenter="newshowtt(\''+F+'\')"  onmouseout="newhidett()">'+x+"</div>":'<div class="fromAddress">'+x+"</div>"}if("Campaigns"==r){if("TYPE"===t[i].COLUMNNAME&&[1,2,3].contains(a.CAMPAIGN_TYPE))return u='<div class="strong">'+c.fn(this)+'<span class="svgIconsImg camTypeDetIcon mL15 cP" onmouseenter="crmui.showTooltip({content: \'View Stats\',isHTML: false,position: \'showOnRight\'});" onmouseleave="crmui.hideTooltip();" data-cid="campTypeOnClick" data-params=\'{"campaignId":"'+a.ENTITYID+"\"}'></span></div>"}else if(o&&"CLOSINGDATE"===t[i].COLUMNNAME){var V;if(!(V=new CrmDate(CrmDateUtils.getDateObjectFromString(e,Crm.userDetails.DATE_PATTERN.toUpperCase()))).isToday()&&!V.isFutureTime())return"<span class='d_overDue'>"+c.fn(this)+"</span>"}return c.fn(this)}return!o||"CLOSINGDATE"!==t[i].COLUMNNAME||(V=new CrmDate(CrmDateUtils.getDateObjectFromString(e,Crm.userDetails.DATE_PATTERN.toUpperCase()))).isToday()||V.isFutureTime()?"<span class='f15'>"+c.fn(this)+"</span>":"<span class='d_overDue'>"+c.fn(this)+"</span>"}if(void 0!==t[i]){if(4==t[i].UITYPE&&("Calls"==a.MODULE||"Tasks"==a.MODULE||"Events"==a.MODULE)){h=this.MODULE,C=this.MODULE.toLowerCase();if(null==h)return"";w="Crm_Implied_View_"+h;crmListView.changedPermissionsForZBModules.hasOwnProperty(w)&&(w=crmListView.changedPermissionsForZBModules[w]),w=Crm.userDetails.permissions[w],h=h.slice(0,h.lastIndexOf("s"));b="<link-to ";if(w>-1)"mLookup"==n?b+='lt-prop-target="_blank" lt-prop-td=\'{"relContactId":"'+(a.relContactId?a.relContactId:null)+'","module":"'+this.MODULE+'","id":"'+this.ENTITYID+'","lookback":"true",,"fromActivityListView":"true"}\' lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp=\'["'+this.MODULE+'","'+this.ENTITYID+'"]\' lt-prop-id="'+n+"_"+this.ENTITYID+'" lt-prop-class="link">':"Tasks"==this.MODULE||"Calls"==this.MODULE||"Events"==this.MODULE?b+='lt-prop-id="'+n+"_"+this.ENTITYID+'" lt-prop-class="link" lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp=\'["Activities","'+this.ENTITYID+'"]\' lt-prop-qp=\'{"sub_module":"'+this.MODULE+'"}\' lt-prop-td=\'{"relContactId":"'+(a.relContactId?a.relContactId:null)+'","module":"'+this.MODULE+'","id":"'+this.ENTITYID+'","lookback":"true","fromActivityListView":"true"}\' onmouseover="showRelatedFields_new(\''+this.MODULE+"','"+this.ENTITYID+'\',this)" onmouseout="hideLoadingDiv();" data-zcqa="detailView">':b+='lt-prop-id="'+n+"_"+this.ENTITYID+'" lt-prop-class="link" lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp=\'["'+this.MODULE+'","'+this.ENTITYID+'"]\' lt-prop-td=\'{"relContactId":"'+(a.relContactId?a.relContactId:null)+'","module":"'+this.MODULE+'","id":"'+this.ENTITYID+'","lookback":"true","fromActivityListView":"true"}\' onmouseover="showRelatedFields_new(\''+this.MODULE+"','"+this.ENTITYID+'\',this)" onmouseout="hideLoadingDiv();" data-zcqa="detailView">';else{b='<a href="javascript:;" title="permission denied" data-permission="false">';T=!0}return"CONTACTID"!=t[i].COLUMNNAME&&(C.includes("custommodule")&&(C="custom"),b+="<div class='dIB vam'><crmutil-icon  icon-name=\""+C+'" icon-class="zcicn-'+C+' zcicn_embedSvg crmBaseIcon size_m mR5" ></crmutil-icon></div>'),b+=c.fn(this.DISPLAYLABEL),b+=T?"</a>":"</link-to>"}if("User"===e.MODULE||"Users"===e.MODULE||"Modules"===e.MODULE)return u='<span class="lv_data_user ellipsistext vam dIB mw100per" data-params=\'{"userId":"'+e.ENTITYID+"\"}'>"+c.fn(this.DISPLAYLABEL)+"</span>";if("OrchestrationState"===e.MODULE)return u='<span class="ellipsistext vam dIB">'+c.fn(this.DISPLAYLABEL)+"</span>";if("BEST_TIME"===t[i].COLUMNNAME)return crmBstTime.getListViewString(e);if(!m){w="Crm_Implied_View_"+r;crmListView.changedPermissionsForZBModules.hasOwnProperty(w)&&(w=crmListView.changedPermissionsForZBModules[w]);u="<a ",b="<link-to ";return(w=Crm.userDetails.permissions[w])>-1?"mLookup"==n?b+='lt-prop-target="_blank" lt-prop-td=\'{"relContactId":"null","module":"'+e.MODULE+'","id":"'+e.ENTITYID+'","lookback":"true"}\' lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp=\'["'+e.MODULE+'","'+e.ENTITYID+'"]\' lt-prop-id="'+n+"_"+e.ENTITYID+'" lt-prop-class="link">':"customHomepage"===n?b+='lt-prop-id="'+n+"_"+this.ENTITYID+'" lt-prop-class="link" lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp=\'["'+e.MODULE+'","'+e.ENTITYID+'"]\' lt-prop-td=\'{"relContactId":"null","module":"'+e.MODULE+'","id":"'+e.ENTITYID+'","lookback":"true", "toolTip" : "'+I18n.getMsg("crm.custom.home.tooltip")+'" }\' data-zcqa="detailView">':"Orchestration"==e.MODULE?b+='lt-prop-target="_blank" lt-prop-class="link" onclick="event.stopPropagation();" lt-prop-route="crm.settings.section.orchestration.edit-orchestration"  lt-prop-dp=\'["'+this.ENTITYID+"\"]'>":"Tasks"==e.MODULE||"Calls"==e.MODULE||"Events"==e.MODULE?b+='lt-prop-id="'+n+"_"+this.ENTITYID+'" lt-prop-class="link" lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp=\'["Activities","'+e.ENTITYID+'"]\' lt-prop-qp=\'{"sub_module":"'+e.MODULE+'"}\' lt-prop-td=\'{"relContactId":"null","module":"'+e.MODULE+'","id":"'+e.ENTITYID+'","lookback":"true", "toolTip" : "'+I18n.getMsg("crm.custom.home.tooltip")+'"}\' data-zcqa="detailView">':b+='lt-prop-id="'+n+"_"+this.ENTITYID+'" lt-prop-class="link" lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp=\'["'+e.MODULE+'","'+e.ENTITYID+'"]\' lt-prop-td=\'{"relContactId":"null","module":"'+e.MODULE+'","id":"'+e.ENTITYID+'","lookback":"true", "toolTip" : "'+I18n.getMsg("crm.custom.home.tooltip")+'", "fromid":"'+a.ENTITYID+'" }\' data-zcqa="detailView">':u+='href="javascript:;" title="Permission denied" data-permission="false" id="'+n+"_"+e.ENTITYID+'" class="link">',u+=c.fn(this.DISPLAYLABEL)+"</a>",b+=c.fn(this.DISPLAYLABEL)+"</link-to>"}}}})),Handlebars.registerHelper("getSpacerImg",(function(){return Search.spacerImg})),Handlebars.registerHelper("isAlphaSearchSupported",(function(e,t){return e.alphaDetails?t.fn(this):"en_US"!==Crm.userDetails.LOCALE&&"en_GB"!==Crm.userDetails.LOCALE||"Zoho"!=customViewObject.brandName?t.inverse(this):(e.alphaDetails=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],t.fn(this))})),Handlebars.registerHelper("deleteObj",(function(e){void 0!==customViewObject&&delete customViewObject[e]})),Handlebars.registerHelper("addObj",(function(e,t){customViewObject[e]=t})),Handlebars.registerHelper("CrmUserDetailsRTL_ENABLED",(function(){return Crm.userDetails.RTL_ENABLED?"left":"right"})),Handlebars.registerHelper("addOptions",(function(e){e.optionList||(e.optionList=["10","20","30","40","50"],Crm.userDetails.ISPAID_USER&&e.optionList.push("100"),500===e.maxRange&&e.optionList.push("500"))})),Handlebars.registerHelper("addSearchLimits",(function(e){e.searchList||(e.searchList=[{"${AGEINMONTHS6}":"Past 6 months"},{"${AGEINMONTHS12}":"Past year"},{all:"Any time"}])})),Handlebars.registerHelper("isKanbanView",(function(){var e=crmListView.getObject();return!!e&&e.isKanbanView})),Handlebars.registerHelper("objPresentAtIndex",(function(e,t,i){return e&&e[t]?i.fn(this):i.inverse(this)})),Handlebars.registerHelper("showSelectAll",(function(e,t,i,a){return 1!=t||e&&e[i]?a.fn(this):a.inverse(this)})),Handlebars.registerHelper("indexOf",(function(e,t,i,a){return e.indexOf(t)==i?a.fn(this):a.inverse(this)})),Handlebars.registerHelper("checkStringForPrintPreview",(function(e,t,i,a){var s=i[t].FIELDLABEL;if("BEST_TIME"===i[t].COLUMNNAME)return"";var r=i[t].UITYPE;if(301==r||300==r||116==r&&"boolean"==i[t].RETURNTYPE)return 1==e||"true"==e?'<img src="'+Search.yesImg+'" class="yes">':'<img src="'+Search.spacerImg+'" class="no-new" width="9" height="9">';if(100==r){var o=a.fn(this);return""!=e&&(o=o.replace(/;/g,"; ")),o}if(80===r)return Handlebars.helpers.setServiceDuration(e);if(38==i[t].UITYPE){var n=parseFloat(a.fn(this));return isNaN(n)?"":!0===i[t].separator?a.fn(this):n}return 200!=r&&786!=r&&14!=r&&24!=r&&202!=r&&333!=r||"en_US"!=Crm.userDetails.COUNTRY_LOCALE&&"en_GB"!=Crm.userDetails.COUNTRY_LOCALE?"object"==typeof e?a.fn(this.DISPLAYLABEL):"Mailing Street"===s||"Billing Street"===s||"Street"===s?void 0!==a.fn(this)?a.fn(this).split("~~~")[0]:a.fn(this):32!==i[t].UITYPE&&52!==i[t].UITYPE||!0!==i[t].separator?a.fn(this):e:"<span class='f15'>"+a.fn(this)+"</span>"})),Handlebars.registerHelper("safestring",(function(e){return new Handlebars.SafeString(e)})),Handlebars.registerHelper("objSizeGreaterThan",(function(e,t,i){return objectUtils.getLength(e)>t?i.fn(this):i.inverse(this)})),Handlebars.registerHelper("getStaticCssPath",(function(e){return crmConstants.cssStaticPath+e})),Handlebars.registerHelper("getHelpUrl",(function(e){return crmConstants.helpUrl["help.domain.url"]+crmConstants.helpUrl[e]})),Handlebars.registerHelper("crmConstants",(function(e){return crmConstants[e]})),Handlebars.registerHelper("checkPermission",(function(e,t,i){return""!=t&&(e=e+"_"+t),crmListView.changedPermissionsForZBModules.hasOwnProperty(e)&&(e=crmListView.changedPermissionsForZBModules[e]),1==Crm.userDetails.permissions[e]?i.fn(this):i.inverse(this)})),Handlebars.registerHelper("checkActivityAuthorization",(function(e){return customViewObject.isActivitiesAuthorized?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("canShowActivity",(function(e){return crmListView.isSmartFilterSupportedModule(customViewObject.module)?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("canCreateActivity",(function(e){return!customViewObject.isActivitiesAuthorized||-1!==["Solutions","PriceBooks","Vendors","Services","Appointments"].indexOf(customViewObject.module)||"Activities"===Crm.activityGrp[customViewObject.module]||customViewObject.cvName&&customViewObject.cvName.indexOf("CONVERTEDVIEWS")>-1?e.inverse(this):e.fn(this)})),Handlebars.registerHelper("isEdit",(function(e,t,i,a){var s=Crm.userDetails.permissions.Crm_Implied_Manage_CustomViews;return"Edit"===t&&e&&-1!=e.indexOf("CONVERTEDVIEWS")||!s||"mLookup"==i?a.inverse(this):a.fn(this)})),Handlebars.registerHelper("showEntity",(function(e,t,i,a,s){for(var r="",o=t-1;o<i&&(null!=e&&null!=e[o]);o++)recordNum=o+parseInt(a),r+=s.fn(e[o]);return r})),Handlebars.registerHelper("showEntityRL",(function(e,t){for(var i="",a=0;a<10&&(null!=e&&null!=e[a]);a++)recordNum=a+1,i+=t.fn(e[a]);return i})),Handlebars.registerHelper("getLengthOfHeading",(function(e,t){t.length=e?e.length+1:0})),Handlebars.registerHelper("recordNum",(function(){return recordNum})),Handlebars.registerHelper("objSizeEqualTo",(function(e,t,i){return e&&e.length==t?i.fn(this):i.inverse(this)})),Handlebars.registerHelper("escape",(function(e){return $ESAPI.encoder().encodeForJavaScript(unescape(e))})),Handlebars.registerHelper("setLengthOfSelectedIds",(function(e){customViewObject.lengthOfSelectedIds=e?e.length:0})),Handlebars.registerHelper("loop",(function(e,t,i,a){var s="";t=parseInt(t);for(var r=e;r<=t;r++)i.index1=r,s+=a.fn(this);return s})),Handlebars.registerHelper("getSearchField",(function(e,t){return e["displaySearchField"+t]}));var dateTemp=["${TODAY}","${TOMORROW}","${TOMORROWPLUS}","${YESTERDAY}","${YESTERDAYMINUS}","${LASTMONTH}","${THISMONTH}","${NEXTMONTH}","${LASTWEEK}","${THISWEEK}","${NEXTWEEK}"];function changeRight(e){for(var t=document.getElementById("SearchStringUL").getElementsByTagName("li"),i=0;i<t.length;i++)t[i].className="";document.getElementById("searchField").value=e}function showHideWarningDivs(){var e=document.allMailMergeForm;null!=e.openfilein&&e.openfilein[1].checked?($("#currentLimitDiv").length>0&&$("#currentLimitDiv").css("display","block"),$("#alertWaringdDiv").length>0&&$("#alertWaringdDiv").css("display","block"),$("#alertMsgDiv").length>0&&$("#alertMsgDiv").css("display","block")):($("#currentLimitDiv").length>0&&$("#currentLimitDiv").css("display","none"),$("#alertWaringdDiv").length>0&&$("#alertWaringdDiv").css("display","none"),$("#alertMsgDiv").length>0&&$("#alertMsgDiv").css("display","none"))}Handlebars.registerHelper("getConditionOrSearchValue",(function(e,t,i,a){var s=e["searchfieldtype"+t];if("condition"!=i){var r=[];switch(s){case"U":"${CURRENTUSER}"!=e["searchuser"+t]&&(r=[e["temp_searchuser"+t]]);break;case"T":r=[e["searchtext"+t]];break;case"picklist":r=[e["searchpicklist"+t].replace("\\,",",")];break;case"L":r=[e["searchlayout"+t].replace("\\,",",")];break;case"tag":r=[e["searchtag"+t].replace("\\,",",")];break;case"N":r=[e["searchnum"+t]];break;case"B":r=[e["searchboolean"+t]];break;case"CML":r=[e["temp_searchcampcv"+t]];break;case"D":e["ageindayscondition"+t]?r=[e["ageindayscondition"+t],e["ageindays"+t]]:dateTemp.contains(e["searchdate"+t])||(r=[e["searchdate"+t]],"between"!=e["datecondition"+t]&&"not between"!=e["datecondition"+t]||r.push(e["searchedate"+t]));break;case"DT":e["ageindayscondition"+t]?r=[e["ageindayscondition"+t],e["ageindays"+t]]:dateTemp.contains(e["searchdatedate"+t])||(r=[e["searchdatedate"+t],e["searchstime"+t],e["searchstampm"+t]],"between"!=e["datetimecondition"+t]&&"not between"!=e["datetimecondition"+t]||(r.push(e["searchenddate"+t]),r.push(e["searchetime"+t]),r.push(e["searchetampm"+t])))}for(var o="",n=0;n<r.length;n++)o+=a.fn(r[n]);return o}switch(s){case"U":return"${CURRENTUSER}"==e["searchuser"+t]?I18n.getMsg("is")+" "+I18n.getMsg(e["usercondition"+t]):I18n.getMsg(e["usercondition"+t]);case"T":return I18n.getMsg(e["textcondition"+t]);case"picklist":return I18n.getMsg(e["textpicklistcondition"+t]);case"L":return I18n.getMsg(e["textlayoutcondition"+t]);case"tag":return I18n.getMsg(e["texttagcondition"+t]);case"N":return I18n.getMsg(e["numcondition"+t]);case"B":return I18n.getMsg(e["booleancondition"+t]);case"CML":return I18n.getMsg(e["campcvcondition"+t]);case"D":return dateTemp.contains(e["searchdate"+t])?I18n.getMsg("is")+" "+I18n.getMsg(e["datecondition"+t]):I18n.getMsg(e["datecondition"+t]);case"DT":return dateTemp.contains(e["searchdatedate"+t])?I18n.getMsg("is")+" "+I18n.getMsg(e["datetimecondition"+t]):I18n.getMsg(e["datetimecondition"+t])}})),Handlebars.registerHelper("getMatchValue",(function(e,t){return 1==t?"":I18n.getMsg(e["match"+t]).toUpperCase()})),Handlebars.registerHelper("isCurrencyField",(function(e,t,i){var a=e[t].UITYPE;if(36==a||77==a||116==a&&"currency"==e[t].RETURNTYPE)return i.fn(this)})),Handlebars.registerHelper("getClassForLVData",(function(e,t,i,a){var s="list"==a?e.ui_type:e[t].UITYPE;if(!a){if("SMOWNERID"===e[t].COLUMNNAME||"SMCREATORID"===e[t].COLUMNNAME||"MODIFIEDBY"===e[t].COLUMNNAME)return"lv_data_textfield lv_data_username";if(36===s||77===s||116===s&&"DOUBLE"===e[t].TYPE)return"lv_data_currency alignright"}return 25===s?"lv_data_email":127===s||1===s||4===s||133===s||9===s||5===s||13===s?"lv_data_textfield":33===s||6===s||7===s||35===s||124===s||200===s?"lv_data_phone":32===s||38===s||52===s||333===s||786===s||14===s||24===s||202===s?"lv_data_number":3===s?"lv_data_desc":"lv_data_textfield"})),Handlebars.registerHelper("getDateTimeCVFilters",(function(e){var t=Search["_"+e];"T"==e&&(this.value.indexOf(":EMAIL")>-1||this.value.indexOf(":ADDN_EMAIL")>-1)&&(t=t.concat(Search._BOUNCE));for(var i=t.length,a="",s=0;s<i;s++){var r=t[s];a+=2===r.length?"<option value='"+r[0]+"'>"+r[1]+"</option>":"<option value='"+r[0]+"' selected>"+r[1]+"</option>"}return a})),Handlebars.registerHelper("leadConvertSubFilter",(function(e){var t=[{label:I18n.getMsg("crm.lead.prediction.convert.high"),value:"high"},{label:I18n.getMsg("crm.lead.prediction.convert.medium"),value:"medium"},{label:I18n.getMsg("crm.lead.prediction.convert.low"),value:"low"}];e.leadConvertAry=t})),Handlebars.registerHelper("leadSubFilterRecordFocus",(function(e){var t=[{label:I18n.getMsg("crm.intelligence.prediction.slowmoving"),value:"slowmoving"},{label:I18n.getMsg("crm.intelligence.prediction.trend.down"),value:"gonedown"}];e.leadRecordFocus=t})),Handlebars.registerHelper("getSentimentCVFilters",(function(){for(var e=[{label:I18n.getMsg("crm.sentiment.Positive"),value:"POSITIVE"},{label:I18n.getMsg("crm.sentiment.Negative"),value:"NEGATIVE"},{label:I18n.getMsg("sentiment.positiveandnegative"),value:"POSITIVE_AND_NEGATIVE"},{label:I18n.getMsg("sentiment.positiveornegative"),value:"POSITIVE_OR_NEGATIVE"},{label:I18n.getMsg("sentiment.positiveonly"),value:"POSITIVE_ONLY"},{label:I18n.getMsg("sentiment.negativeonly"),value:"NEGATIVE_ONLY"},{label:I18n.getMsg("crm.sentiment.Neutral"),value:"NEUTRAL"}],t=e.length,i="",a=0;a<t;a++){var s=e[a];i+="<option value='"+s.value+"'>"+s.label+"</option>"}return i})),Handlebars.registerHelper("setCurrentCVFilterName",(function(e){crmListView.curCVFilterName=e})),Handlebars.registerHelper("getCurrentCVFilterName",(function(){return crmListView.curCVFilterName})),Handlebars.registerHelper("removeCurrentCVFilterName",(function(){delete crmListView.curCVFilterName})),Handlebars.registerHelper("getActivityIcon",(function(e){return"Events"===e?"EventSmall":"Tasks"===e?"TaskSmall":"Calls_small"})),Handlebars.registerHelper("getDefaultFilters",(function(e,t){if(validationUtils.isEmpty(crmListView.defaultCVFiltersObj)&&!Crm.userDetails.CLIENT_ACCOUNT||"Email Status"===e.label){var i=I18n.getMsg("Notes");if(moduleRecordMapping.Activities){var a=I18n.getMsg(moduleRecordMapping.Activities.singular_label);crmListView.defaultCVFiltersObj.ACT=[{label:I18n.getMsg("crm.filter.label.without.open",a),"data-params":'{"searchfield" : "Activities:WITHOUTOPEN"}',subFilters:[],"data-value":"Activities:WITHOUTOPEN"},{label:I18n.getMsg("Overdue"),"data-params":'{"searchfield":"Activities:OVERDUE","searchModule":"Activities"}',"data-value":"OVERDUE"},{label:I18n.getMsg("crm.filter.label.activity.due",a),selected:"checked","data-value":"Activities:DUE","data-params":'{"searchfield" : "Activities:DUE"}',subFilters:["ACTIVITYFILTERS"]},{label:I18n.getMsg("crm.filter.label.without.any",a),"data-value":"Activities:MODIFIEDTIME:WITHOUTANY","data-params":'{"searchfield": "Activities:MODIFIEDTIME:WITHOUTANY"}',subFilters:["DATETIMEFILTERS1"]},{label:I18n.getMsg("crm.filter.label.activity.done",a),"data-value":"Activities:COMPLETED","data-params":'{"searchfield": "Activities:COMPLETED"}',subFilters:["DATETIMEFILTERS"]}]}if(crmListView.defaultCVFiltersObj.NOT=[{label:I18n.getMsg("crm.filter.label.without.any",i),"data-value":"Notes:CREATEDTIME:WITHOUTANY","data-params":'{"searchfield" : "Notes:CREATEDTIME:WITHOUTANY"}',subFilters:["DATETIMEFILTERS1"]},{label:I18n.getMsg("crm.filter.label.notes.added"),"data-value":"Notes:CREATEDTIME","data-params":'{"searchfield" : "Notes:CREATEDTIME"}',subFilters:["DATETIMEFILTERS"]}],moduleRecordMapping.Potentials){var s=I18n.getMsg(moduleRecordMapping.Potentials.singular_label);crmListView.defaultCVFiltersObj.POT=[{label:I18n.getMsg("crm.filter.label.with.open",s),"data-params":'{"searchfield" : "Potentials:WITHOPEN"}',subFilters:["RESTRICTEDDTFILTERS"],"data-value":"Potentials:WITHOPEN"},{label:I18n.getMsg("crm.filter.label.without.open",s),"data-params":'{"searchfield" : "Potentials:WITHOUTOPEN"}',subFilters:["RESTRICTEDDTFILTERS"],"data-value":"Potentials:WITHOUTOPEN"},{label:I18n.getMsg("crm.filter.label.without.any",s),"data-value":"Potentials:CREATEDTIME:WITHOUTANY","data-params":'{"searchfield": "Potentials:CREATEDTIME:WITHOUTANY","condition":"0","value":"${EMPTY}"}'}]}if(moduleRecordMapping.Contacts){var r=I18n.getMsg(moduleRecordMapping.Contacts.singular_label);crmListView.defaultCVFiltersObj.CON=[{label:I18n.getMsg("crm.filter.label.with.module",r),"data-params":'{"searchfield" : "Contacts:WITH"}',"data-value":"Contacts:WITH"},{label:I18n.getMsg("crm.filter.label.without.any",r),"data-value":"Contacts:CREATEDTIME:WITHOUTANY","data-params":'{"searchfield": "Contacts:CREATEDTIME:WITHOUTANY","searchfieldtype":"CON","condition":"0","value":"${EMPTY}"}'}]}crmListView.defaultCVFiltersObj.CHATS=[{label:I18n.getMsg("Attended"),"data-value":"Visits:CHATSATTENDED","data-params":'{"searchfield" : "Visits:CHATSATTENDED", "searchModule" : "Visits"}',subFilters:["DATETIMEFILTERS1"]},{label:I18n.getMsg("Missed"),"data-value":"Visits:CHATSMISSED","data-params":'{"searchfield" : "Visits:CHATSMISSED", "searchModule" : "Visits"}',subFilters:["DATETIMEFILTERS"]}],crmListView.defaultCVFiltersObj.PRE=[{label:I18n.getMsg("crm.intelligence.prediction.likelywin"),"data-params":'{"searchfield" : "winorlose"}',subFilters:[],"data-value":"PREWIN"},{label:I18n.getMsg("crm.intelligence.prediction.trendup"),"data-params":'{"searchfield" : "goneup"}',subFilters:["PREDICTIONFILTER1"],"data-value":"PREGONEUP"},{label:I18n.getMsg("crm.intelligence.prediction.trenddown"),"data-params":'{"searchfield" : "gonedown"}',subFilters:["PREDICTIONFILTER1"],"data-value":"PREGONEDOWN"},{label:I18n.getMsg("crm.intelligence.prediction.recordsfocus"),"data-params":'{"searchfield" : "focus"}',subFilters:["PREDICTIONFILTER2"],"data-value":"PREFOCUS"},{label:I18n.getMsg("crm.intelligence.prediction.score"),"data-params":'{"searchfield" : "score"}',subFilters:["PREDICTIONFILTER3"],"data-value":"PRESCORE"}],"entprofon"==e.trackoption?crmListView.defaultCVFiltersObj.EMA=[{name:"SENT",label:I18n.getMsg("crm.filter.label.sent"),searchfield:"LAST_SENT_TIME"},{name:"NOTSENT",label:I18n.getMsg("crm.filter.label.not.sent"),searchfield:"NOT_SENT"},{name:"OPENED",label:I18n.getMsg("crm.filter.label.opened"),searchfield:"LAST_ACTION_TIME"},{name:"CLICKED",label:I18n.getMsg("crm.label.filter.email.clicked"),searchfield:"LAST_ACTION_TIME"},{name:"NOTOPENED",label:I18n.getMsg("crm.filter.label.not.opened"),searchfield:"NOT_OPENED"},{name:"RECEIVED",label:I18n.getMsg("crm.filter.label.received"),searchfield:"LAST_ACTION_TIME"},{name:"NOTRECEIVED",label:I18n.getMsg("crm.filter.label.not.received"),searchfield:"NOT_RECEIVED"},{name:"BOUNCED",label:I18n.getMsg("crm.filter.label.bounced"),searchfield:"LAST_ACTION_TIME"},{name:"OPENEDNOTREPLIED",label:I18n.getMsg("crm.filter.label.opened.not.replied"),searchfield:"LAST_ACTION_TIME"}]:"stdon"==e.trackoption?crmListView.defaultCVFiltersObj.EMA=[{name:"SENT",label:I18n.getMsg("crm.filter.label.sent"),searchfield:"LAST_SENT_TIME"},{name:"NOTSENT",label:I18n.getMsg("crm.filter.label.not.sent"),searchfield:"NOT_SENT"},{name:"OPENED",label:I18n.getMsg("crm.filter.label.opened"),searchfield:"LAST_ACTION_TIME"},{name:"CLICKED",label:I18n.getMsg("crm.label.filter.email.clicked"),searchfield:"LAST_ACTION_TIME"},{name:"NOTOPENED",label:I18n.getMsg("crm.filter.label.not.opened"),searchfield:"NOT_OPENED"},{name:"BOUNCED",label:I18n.getMsg("crm.filter.label.bounced"),searchfield:"LAST_ACTION_TIME"}]:"entprofoff"==e.trackoption?crmListView.defaultCVFiltersObj.EMA=[{name:"SENT",label:I18n.getMsg("crm.filter.label.sent"),searchfield:"LAST_SENT_TIME"},{name:"NOTSENT",label:I18n.getMsg("crm.filter.label.not.sent"),searchfield:"NOT_SENT"},{name:"RECEIVED",label:I18n.getMsg("crm.filter.label.received"),searchfield:"LAST_ACTION_TIME"},{name:"NOTRECEIVED",label:I18n.getMsg("crm.filter.label.not.received"),searchfield:"NOT_RECEIVED"},{name:"BOUNCED",label:I18n.getMsg("crm.filter.label.bounced"),searchfield:"LAST_ACTION_TIME"}]:crmListView.defaultCVFiltersObj.EMA=[{name:"SENT",label:I18n.getMsg("crm.filter.label.sent"),searchfield:"LAST_SENT_TIME"},{name:"NOTSENT",label:I18n.getMsg("crm.filter.label.not.sent"),searchfield:"NOT_SENT"},{name:"BOUNCED",label:I18n.getMsg("crm.filter.label.bounced"),searchfield:"LAST_ACTION_TIME"}]}e.FILTERS=crmListView.defaultCVFiltersObj[t]})),Handlebars.registerHelper("isSmartFilterSupportedModule",(function(e,t,i){return"mLookup"==t?i.inverse(this):crmListView.isSmartFilterSupportedModule(e)?i.fn(this):void 0})),Handlebars.registerHelper("getUpdatedUpComingActionsJson",(function(e,t){var i=crmListView.getObject();i.upComingActionsJson&&i.upComingActionsJson[e]&&(t.upcomingTime=i.upComingActionsJson[e],delete i.upComingActionsJson[e],validationUtils.isEmpty(i.upComingActionsJson)&&delete i.upComingActionsJson)})),Handlebars.registerHelper("checkPermission_dots",(function(e,t,i){var a="Crm_Implied_Customize_Zoho_CRM",s="Crm_Implied_Print_View",r="Crm_Implied_Tags";return""!=t&&(s=s+"_"+t,r=r+"_"+t),crmListView.changedPermissionsForZBModules.hasOwnProperty(a)&&(a=crmListView.changedPermissionsForZBModules[a]),crmListView.changedPermissionsForZBModules.hasOwnProperty(s)&&(s=crmListView.changedPermissionsForZBModules[s]),crmListView.changedPermissionsForZBModules.hasOwnProperty(r)&&(r=crmListView.changedPermissionsForZBModules[r]),1==Crm.userDetails.permissions[a]&&1==Crm.userDetails.permissions[r]||1==Crm.userDetails.permissions[s]?i.fn(this):i.inverse(this)})),Handlebars.registerHelper("checkPermission_invmodules",(function(e,t,i){var a="Crm_Implied_Customize_Zoho_CRM",s="Crm_Implied_Tags";return""!=t&&(s=s+"_"+t),crmListView.changedPermissionsForZBModules.hasOwnProperty(a)&&(a=crmListView.changedPermissionsForZBModules[a]),crmListView.changedPermissionsForZBModules.hasOwnProperty(s)&&(s=crmListView.changedPermissionsForZBModules[s]),1==Crm.userDetails.permissions[a]&&1==Crm.userDetails.permissions[s]?i.fn(this):i.inverse(this)})),Handlebars.registerHelper("getCampaignData",(function(e,t,i){var a=customViewObject.isPrivacyListView||customViewObject.isCampaignAddMemberListView?t||customViewObject.modulePicklistValues.Campaigns:t||crmListView.getObject().modulePicklistValues.Campaigns;if(e.statusClass="dN",e.typeClass="dN",a&&(a.STATUS&&(e.camp_status=a.STATUS.slice(),e.camp_status.shift(),e.statusClass="oBor mT0 mB5 campLeftFilter"),a.TYPE)){e.camp_types=a.TYPE.slice(),e.camp_types.shift(),e.typeClass="oBor mT0 mB10 campLeftFilter";var s=Crm.partnerName+" Campaigns";(i||crmListView.getObject().modulePicklistValues&&crmListView.getObject().modulePicklistValues["Zoho Campaign Members"])&&-1===e.camp_types.indexOf(s)&&e.camp_types.unshift(s)}})),Handlebars.registerHelper("isDotToBeShown",(function(e,t){var i=!1;if(customViewObject.supportedIntegFeatures)for(var a=customViewObject.supportedIntegFeatures.length,s=0;s<a;s++){var r=customViewObject.supportedIntegFeatures[s];if(r.isSupported&&"true"!==r.isDotNotToBeShown){i=!0;break}}var o=Lyte.registeredMixins["crm-view-utils"].getIntegCampObject();i&&(customViewObject.campaignLayoutSubMenu.forEach((function(e){e.namespace&&delete o[e.namespace]})),0===Object.keys(o).length&&(i=!1));return"Campaigns"===e&&i?t.fn(this):t.inverse(this)})),crmListView.isSmartFilterSupportedModule=function(e){return!(!e||!crmListView.modulesWithSmartFilters.contains(e)&&0!==e.indexOf("LinkingModule")&&(0!==e.indexOf("CustomModule")||crmTab.isZBCustomModule(e)||crmTab.isZSCustomModule(e)))},crmListView.dropCacheOnActivityCreate=function(e,t){var i=crmTab.getFromCache(e),a="Activities"===Crm.activityGrp[t]?"ACT":"Notes"===t?"NOT":void 0;if(i&&a&&crmListView.isSmartFilterSupportedModule(e)){var s=i.filters;if(s&&s.length)for(var r=s.length,o=0;o<r;o++){if(s[o].searchfieldtype===a){crmTab.deleteFromCache(e);break}}}},crmListView.recordChange=function(e,t){var i=t?$(t).data("params"):"";if(i&&i.massActions){var a=["mass_delete","mass_update","mass_convert","mass_transfer"],s=objectUtils.cloneObject(Lyte.Router.getRouteInstance().transition),r=s.info.queryParams;if(a.contains(r.type)&&s.data&&(r=s.data.query_params),r.page=r.page?Number(r.page):1,a.contains(r.type)){"mass_update"==r.type&&(r.type="bulk_mass_update");var o=1,n=10;return"navigate_next"==e.clickId?(o=r.page*parseInt(r.per_page)+1,r.page=r.page+1,n=r.page*parseInt(r.per_page)):(r.page=r.page-1,o=(r.page-1)*parseInt(r.per_page)+1,n=r.page*parseInt(r.per_page)),callMassRecords(o,n,r.type),Lyte.Router.getRouteInstance().transition.data.query_params.page=r.page,!1}return r.page="navigate_next"==e.clickId?r.page+1:r.page-1,Lyte.Router.transitionTo({route:s.info.route,dynamicParams:s.info.dynamicParams,queryParams:r}),!1}if("mLookup"==e.from)return $(t).attr("data-params",JSON.stringify(e)),"navigate_previous_listview"==e.clickId?multiLookupsView.navigatePrevious(event,t):multiLookupsView.navigateNext(event,t);Crm.currentPageData.title="listView",Crm.currentPageData.module=e.module;var l={},d=crmListView.getObject(),c=e.clickId?e.clickId:$(t).attr("id"),u=Number(d.fromIndex),m=Number(d.toIndex),p=d?d.portalName:void 0,f={};null!=p&&"All Portals"!=p?(e.portalName=p,e.allPortals=!1):e.allPortals=!0;var v=$('#lv_filter_savePopup input[name="module"]').val(),g=0,h=[];if($.each($(".newcheckboxfilternew:checked"),(function(){var e=$(this),t=e.data().params?e.data().params.searchModule:"",i=e.data().params.searchfield;""!==t&&t!==v&&-1===h.indexOf(t)?(h.push(t),g++):(e.closest(".filterContainBox").find(".historyTrackerFilterVal").length||i&&"EMAIL"===i.split(":")[1])&&g++})),g>3)return showAnimatePopup("custom_filter_alert_popup"),void $("#freezeBackGround").css({background:"#000000",opacity:"0.4"});if("currentOption"==c){var C=moduleRecordMapping[e.module];e.currentOption=$("#currentOption").val(),C.$.set("per_page",Number(e.currentOption)),e.clearCache=!0}else d?e.currentOption=d.currentOption:getObj("rangeValue")?e.currentOption=getObj("rangeValue").value:e.currentOption=10;e.OnSelect=!0;var w=e.currentOption?parseInt(e.currentOption):d?d.currentOption:parseInt(e.toIndex)-parseInt(e.fromIndex)+1,b=(u=e.fromIndex?parseInt(e.fromIndex):d&&d.fromIndex?parseInt(d.fromIndex):1,parseInt(e.currentOption));"true"==e.changeOption&&1!=u&&u-1<b&&(e.fromIndex=u-b,u=e.fromIndex,e.toIndex=u+w-1);m=u+w-1;var T=d?d.searchletter:$("input[name=searchletter]").val();$L("crm-page-navigator")[0];"navigate_next"!=c&&"navigate_next_listview"!==c||$("#recordNum").val()&&!crmListView.getObject().isCampaignAddMemberListView?"navigate_previous"!=c&&"navigate_previous_listview"!==c||$("#recordNum").val()&&!crmListView.getObject().isCampaignAddMemberListView||(!e.recordNum&&!e.recordNum<u&&(u-=w,m-=w),f.fetchOnlyBody=!0):(u+=w,m+=w,f.fetchOnlyBody=!0),u<0&&(u="1",m=e.currentOption),e.fromIndex=u,e.toIndex=e.currentOption,e.currentOption||delete e.currentOption,T&&"All"!==T&&(e.searchletter=T,l.search_letter=d.searchletter),e.module||(e.module=0!=$("input[name=module]").length?$("input[name=module]").val():crmListView.getObject().module);var I=$("input[name=rangeValue]");I[0]&&(e.rangeValue=I.val()),$("input[name=previous_sort_order]").val()&&$("input[name=previous_sort_column]").val()?(e.sortOrderString||(e.sortOrderString=$("input[name=previous_sort_order]").val(),e.previous_sort_order=e.sortOrderString),e.sortColumnString||(e.sortColumnString=$("input[name=previous_sort_column]").val(),e.previous_sort_column=e.sortColumnString)):"sortingRecords"!==c&&d&&(e.sortColumnString=e.previous_sort_column=d.sortColumnString,e.sortOrderString=e.previous_sort_order=d.sortOrderString);var y=crmHistory.getPageDetailsFromIndex(u,m);if(e.toIndex=m,l.page=y.page,l.per_page=y.perPage,l.sort_by=d.sortColumnString,l.sort_order=d.sortOrderString,d.filterId&&(l.filter_id=d.filterId),d.filters&&(l.filters=JSON.stringify(d.filters)),d.cross_filters&&(l.cross_filters=JSON.stringify(d.cross_filters)),"true"===e.changeOption&&(f.fetchOnlyBody=!0),crmListView.getObject().isPrivacyListView)return CrmPrivacyDashboard.changeCurrentOption(e);if(crmListView.getObject().isCampaignAddMemberListView)return CrmCampaignInteg.changeCurrentOption(e);if(e.cvid=crmListView.getObject().cvId,d.viewid){Lyte.Router.getRouteInstance();(P=Lyte.Router.transitionTo({route:"crm.tab.module.custom-view.canvas",dynamicParams:[d.module,d.cvId,d.viewid],queryParams:l})).data=e,P.fetchOnlyBody=f.fetchOnlyBody}else if(d.module&&d.cvId){var P;(P=Lyte.Router.transitionTo({route:"crm.tab.module.custom-view.list",dynamicParams:[d.module,d.cvId],queryParams:l})).data=e,P.fetchOnlyBody=f.fetchOnlyBody}},crmListView.setVTDivHt=function(e){var t=$("#vtFieldDiv"),i=0;e&&$(e.closest(".vtColumn")).length>0&&$("#vtMoreSpan").is(":visible")&&(t.find(".filterContainBox:lt(3)").each((function(){i+=$(this).innerHeight()})),t.css({height:i}).addClass("oH")),e||(i=93,t.css({height:i}).addClass("oH"))},crmListView.showHiddenRFMFilter=function(e){var t=$(e).closest(".rfmTop").find(".withNotesdays");t.hasClass("dN")?t.removeClass("dN"):t.addClass("dN")},crmListView.showHideSelectedFilter=function(e,t){var i=$("#lv_left_filter"),a=i.find("input.checkFilter:checked"),s=$(e).prop("checked"),r=$(e).attr("data-value"),o=r&&r.indexOf("RECORDACTION")>-1,n=!1;if(s&&a.length>crmListView.MAX_FILTER_CNT)return renderingUtils.showCustomAlert(I18n.getMsg("crm.criteria.max.rowcnt.exceeds")),void $(e).prop("checked",!1);(r&&r.indexOf("TOUCH")>-1||o)&&($(e).parent().parent().find("#lv_touchedRec_filters").toggle(s),$(e).parent().parent().find("#lv_RecordAction_filters").toggle(s&&o));var l="";if($(e).attr("data-params")){var d=JSON.parse($(e).attr("data-params"));d&&d.searchfield&&(l=d.searchfield.split(":")[1])}var c=!0,u=crmListView.getObject();$("#lv_filter_submit").prop("disabled",!1),0!==a.length||u.filters&&0!==u.filters.length&&!u.filterId?($("#lv_filter_submitdiv").css("visibility","visible"),crmListView.toggleFilterOptions(!1),i.find("#clearFilterLink").show()):$("#lv_filter_submitdiv").css("visibility","hidden"),"undefined"==typeof event&&(c=!1);var m=(e=$(e)).attr("id");if("MXN"===t){var p=(b=e.closest("div .facetContainer")).find("input[type=text]");e.prop("checked")&&b.find('[data-connectedmodule="Users"]').length&&(t="U",n=!0)}if("LPR"===t&&($(e).is(":checked")?$("#sub_"+m).find("input[type=radio]").eq(0).prop("checked",!0):$("#sub_"+m).find("input[type=radio]").filter(":checked").prop("checked",!1)),"EMAIL"===t){var f=e.val(),v=i.find("#lv_email_status");return i.find(".subFilters_Email").hide(),i.find("#lv_email_date").show(),"SENT"===f?(v.show(),v.find(".rbCheckHtml:visible").length>1&&0==v.find('input[type="radio"]:checked:visible').length&&v.find('input[type="radio"]').eq(0).click()):(v.hide(),v.find('input[type="radio"][data-value="'+f+'"]').click()),void("NOTSENT"===f?(i.find("#sub_NOTSENT").show().find("select").trigger("change"),i.find("#lv_email_date").hide()):i.find("#lv_email_date").find("select").trigger("change"))}if("T"===t&&"LATITUDE"===l){if(void 0!==u.filters)for(var g=0;g<u.filters.length;g++){f=u.filters[g].value.split(";");$("#latlong").val(f[2]+","+f[1]),$("#km").val(f[3]);var h="";h=""===$("#maps_search").val()?I18n.getMsg("Near By"):$("#km").val()+" "+I18n.getMsg("crm.nearby");var C="textcondition1_"+m.split("_")[1];$("#"+C+" option").text(h).prop("selected",!0)}}else if("REC"===t){var w=e.parents(".facetContainer").find(".subFilters_Recommendations");e.prop("checked")?w.show():w.hide();p=w.find("input[type=text]");T="#"+p[0].name;p=$(p[0]);I=p.data("connectedmodule"),y=p.data("dispsysrefname"),setTimeout((function(){CustomView.bindMultiSelectLookup2(I,T,y)}),100),setTimeout((function(){CustomView.bindMultiSelectLookup2(I,"#recommendation_select_2",y)}),100)}else if("EMA"===t){e.prop("checked")?($("#lv_email_filters").show(),$("#info_button").show()):($("#lv_email_filters").hide(),$("#info_button").hide());f=$("#emailCondition").val(),v=i.find("#lv_email_status");"SENT"===f?0==v.find('input[type="radio"]:checked:visible').length&&v.find('input[type="radio"]').eq(0).click():v.find('input[type="radio"][data-value="'+f+'"]').click()}else if("MXN"===t||"CAM"===t){var b;p=(b=e.closest("div .facetContainer")).find("input[type=text]");if(e.prop("checked")){var T="#campaign_name_select",I="Campaigns",y="Campaign_Name";"MXN"===t&&(T="#"+p[0].name,I=$(p[0]).data("connectedmodule"),y=$(p[0]).data("dispsysrefname")),"MXN"===t?setTimeout((function(){CustomView.bindMultiSelectLookup2(I,T,y),"0"==e.closest("div .facetContainer").find(".filterCondition").val()?e.closest("div .facetContainer").find("#mxnSelect2").css("display","block"):e.closest("div .facetContainer").find("#mxnSelect2").css("display","none")}),100):setTimeout((function(){CustomView.bindMultiSelectLookup2(I,T,y)}),100),$("#lv_camp_filters").show()}else $("#campaign_status_sel").val(""),$("#campaign_type_sel").val("").trigger("change"),setTimeout((function(){$("#"+p[0].name).select2("destroy")}),100),$("#lv_camp_filters").hide()}else if("L"===t){var P="textlayoutcondition1_"+m.split("_")[1];Search.checkEmptyCdn($('select[id="'+P+'"]')[0],void 0,void 0,void 0,JSON.parse(e.attr("data-params")).searchfield)}else if("W"===t){P="textwizardcondition1_"+m.split("_")[1];Search.checkEmptyCdn($('select[id="'+P+'"]')[0],void 0,void 0,void 0,JSON.parse(e.attr("data-params")).searchfield)}else if("tag"===t){if($("#ActivityTag")&&$("#ActivityTag").length>0)$("#ActivityTag").find('input[type="radio"]').prop("checked",!1).closest("div.facetContainer").find("ul.facets").hide(100),e.prop("checked",!0);var _=(P="texttagcondition1_"+m.split("_")[1]).substr(P.lastIndexOf("n")+1);$("input[name=searchtag"+_+"]").val(""),$("select[id=searchtag"+_+"]").val(""),Search.checkEmptyCdn($('select[id="'+P+'"]')[0],void 0,void 0,void 0,JSON.parse(e.attr("data-params")).searchfield)}else if("ActivityTag"==t){var D=$("#ActivityTag"),O=D.find("#activityRelTo");O.is(":visible")?O.hide():O.show(),D.find("div.facetContainer").show(),D.find("input.checkFilter").prop("checked",!1)}else if(!s||"picklist"!==t&&"B"!==t)if("ActivityType"===t&&s){0===e.closest(".facetContainer").find("ul.filter_range").find("#actcondition_chosen").length&&thirdPartyUtils.bindSelect2("#actcondition")}else(r&&r.indexOf("TOUCH")>-1||o)&&($(e).parent().parent().find("#lv_touchedRec_filters").toggle(s),$(e).parent().parent().find("#lv_RecordAction_filters").toggle(s&&o));else{P="B"===t?"booleancondition1_"+m.split("_")[1]:"textpicklistcondition1_"+m.split("_")[1];var S=JSON.parse(e.attr("data-params")),L=$('select[id="'+P+'"]');Search.checkEmptyCdn(L[0],void 0,void 0,void 0,S.searchfield,S.searchModule)}var E=m.split("_")[0];c?$(".subFilters_"+E).slideUp("fast"):$(".subFilters_"+E).hide();var x="filter"===E?e.attr("data-name"):"sub_"+E;n&&$("#sub_"+m).find('option[value="1"]').remove(),s?(c?$("#sub_"+m).slideDown("fast",(function(){crmListView.setVTDivHt(e)})):$("#sub_"+m).show(),"EMA"!=t&&"true"===e.attr("data-subFilters")&&0==$("#sub_"+m).find('input[type="radio"][name="'+x+'"]:checked').length&&$("#sub_"+m).find('input[type="radio"]').eq(0).click()):$("#sub_"+m).slideUp("fast",(function(){crmListView.setVTDivHt(e)}))},crmListView.checkCVLeadFilterCond=function(e,t){var i=$(e).val(),a=$(e).parent().parent("div").parent("a");"14"===i?a.find(".betweenCrt").show():a.find(".betweenCrt").hide()},crmListView.showRecommendationProd=function(e){"all"==$(e).val()?$(e).parent().next().hide():$(e).parent().next().show()},crmListView.checkCVFilterCondition=function(e,t,i){var a=$(e).val(),s=$(e).parent();(crmListView.toggleFilterOptions(!1),$("#lv_filter_submit").prop("disabled",!1),$(e).parent().removeClass("mT3"),!t||"N"===t&&("14"===a||"15"===a||a.startsWith("$"))||"RFM_score"===t&&("14"===a||"15"===a))&&$(e).parent().nextAll().hide().removeClass("filterValue").find(".filterValue").removeClass("filterValue");if("U"===t){var r=$("#temp_searchuser"+i);r.find("li").remove(),$("#searchuser"+i).val(""),"${CURRENTUSER}"===a?(r.find("ul").prepend('<li class="search-choice">${CURRENTUSER}</li>').children("input").css({readonly:"true",display:"none"}),$("#searchuser"+i).val("${CURRENTUSER}")):void 0===r.find("li").eq(0).attr("id")&&r.children("ul").children("input").attr("placeholder",I18n.getMsg("crm.label.select.user"))}if(a&&a.startsWith("$"))$(e).parent().addClass("mT3"),$(e).parent().nextAll("#searchdate").addClass("filterValue"),"picklist"!=t&&"tag"!=t&&"SMA"!=i?$(e).closest("li").find(".filterValue").attr("readonly","readonly").hide():"SMA"!=i&&$(e).closest("li").find(".filterValue").parent().hide();else if(a===Search.dueCrt||a===Search.ageCrt)$(e).parent().parent("div").find("#ageindays").show().addClass("filterValue").parent().show(),$(e).parent().nextAll("#selDays").show();else if("N"===t||"RFM_score"===t||"14"!==a&&"15"!==a)if("RFM_score"===t)if("14"===a||"15"===a){(l=s.parent("div")).find(".betweenCrt").show();var o="readonly",n="filterValue";l.find("#fromnum").show().removeAttr(o).val("").addClass(n),l.find("#tonum").show().removeAttr(o).val("").addClass(n),l.find("#betweenDateText").show()}else{(l=s.parent("div")).find(".betweenCrt").hide(),l.find("#fromnum").removeClass("filterValue").hide(),l.find("#tonum").removeClass("filterValue").hide(),l.find("#searchnum1").show().val("").addClass("filterValue"),$(e).closest(".rfmTop").find(".filterValue").removeAttr("readonly").show(),s.next().focus()}else if("N"===t){if("14"===a||"15"===a)(l=$(e).parent().parent("div")).find(".betweenCrt").show(),l.find("#fromnum").show().removeAttr("readonly").val("").addClass("filterValue"),l.find("#tonum").show().removeAttr("readonly").val("").addClass("filterValue");else(l=$(e).parent().parent("div")).find(".betweenCrt").hide(),l.find("#fromnum").removeClass("filterValue").hide(),l.find("#tonum").removeClass("filterValue").hide(),l.find("#searchnum1").show().val("").addClass("filterValue"),$(e).closest("li").find(".filterValue").removeAttr("readonly").show(),$(e).parent().next().find('input[type="text"]').focus();$(e).parent().parent("div").find("#currencyCode1").length>0&&$(e).parent().parent("div").find("#currencyCode1").show()}else"picklist"===t||"L"===t||"W"===t||"tag"==t?$(e).closest("li").find(".filterValue").parent().show():t?($(e).closest("li").find(".filterValue").removeAttr("readonly").show(),$(e).parent().next().find('input[type="text"]').focus()):$(e).parent().nextAll("#searchdate").removeAttr("readonly").val("").show().addClass("filterValue");else{var l;(l=$(e).parent().parent("div")).find(".betweenCrt").show(),l.find("#fromdate").show().removeAttr("readonly").val("").addClass("filterValue"),l.find("#todate").show().removeAttr("readonly").val("").addClass("filterValue")}$(e).hasClass("historyTrackerFilterCond")&&(0==a?(""==$(".historyTrackerFilterVal").val()||""!==$(".historyTrackerFilterVal").val()&&$(".historyTrackerFilterVal").val().split(",").length<=5)&&$(".historyMoreOpt").removeClass("hide"):$(".historyMoreOpt").addClass("hide"))},crmListView.formFilterValues=function(e,t){for(var i=1;i<e.length;i++)t=t+","+e.eq(i).val();return t},crmListView.checkMXNCVFilterCondition=function(e,t,i){var a=$(e).val();crmListView.toggleFilterOptions(!1),$("#lv_filter_submit").prop("disabled",!1),$(e).parent().removeClass("mT3"),a&&a.startsWith("$")?($(e).parent().addClass("mT3"),$($(e).closest("div .facetContainer")).find("#mxnSelect2").css("display","none")):$($(e).closest("div .facetContainer")).find("#mxnSelect2").css("display","block")},crmListView.processLeadPrediction=function(e,t,i){e.filter(":checked").attr("id");var a,s=$(t).attr("data-value"),r=$("#sub_filter_l1").find("input[type=radio]").filter(":checked");if("LPCON"==s)a=$(e).find("input[type=radio]").filter(":checked").val();else if("LPSCR"==s){var o=$(e).find("select").val(),n=$(e).find(".filterValue");if(!crmListView.predictionFilterValidation(r,n,"LPSCR",o))return i=void 0,null;if("14"==o){if(n.length>0&&(a=n.eq(0).val(),a=crmListView.formFilterValues(n,a),!crmListView.validateBetweenCrt(n.eq(0),n.eq(1))))return n.eq(1).focus(),alert(I18n.getMsg("crm.lead.prediction.field.less.than.to")),null}else a=n.eq(0).val();i.condition=o}else if("LPREC"==s){var l,d=$(e).eq(0).find("select").val();(l=$(e).find('input[type="radio"]:checked').parent().find(".filterValue")).length>0&&(a=(a=d)+","+l.eq(0).val(),a=crmListView.formFilterValues(l,a))}else if("LPRFOC"==s){var c=$(e).find('input[type="checkbox"]:checked');c.length>0&&(a=c.eq(0).val(),a=crmListView.formFilterValues(c,a))}i.searchfield=s,i.value=a},crmListView.formFilterValues=function(e,t){for(var i=1;i<e.length;i++)t=t+","+e.eq(i).val();return t},crmListView.handleRecommendationType=function(e){var t=$("#already_bought_div"),i=$("#rebuy_date_div");"CWBAB"===(e=$(e)).val()?(t.show(),i.hide()):"REBUY"===e.val()?(t.hide(),i.show()):(t.hide(),i.hide())},crmListView.handleRecommendationRebuyOption=function(e){var t=$("#rec_searchdate");"custom"===$(e).val()?t.show():t.hide()},crmListView.formFilterConditions=function(e){for(var t=0,i=$("#lv_filter_scroll"),a=!1,s=i.find("input.checkFilter:checked").not(".rfmFilter"),r=s.length,o=[],n={filters:o},l=$("#camp_service_status_sel").val(),d=void 0!==l?l.join(","):"",c=0;c<r;c++){var u={},m=s.eq(c),p=$("#sub_"+m.attr("id")),f=p.find("li"),v=m.data("name"),g=m.attr("data-params")?JSON.parse(m.attr("data-params")):{};for(var h in g)u[h]=g[h];if("RFM_score"===u.searchfieldtype){var C=f.find(".rfmFilter:checked"),w=C.length;if(!w)return alert(I18n.getValueForFields("crm.field.valid.check",f.closest(".filterContainBox").find(".filterLabel").attr("title"))),null;for(var b=u.searchfield.split(":::"),T={},I=b.length,y=0;y<I;y++)b[y].includes("CF_R")?T.CF_R=b[y]:b[y].includes("CF_F")?T.CF_F=b[y]:b[y].includes("CF_M")&&(T.CF_M=b[y]);for(var P=0;P<w;P++){for(var _=$(C.get(P)),D=_.attr("id"),O=_.closest(".rfmTop"),S=O.find(".filterValue"),L=S.val(),E=S.length,x=1;x<E;x++)L=L+","+S.eq(x).val();if(u.condition?(u.condition=u.condition+":::"+O.find(".filterCondition").val(),u.value=u.value+":::"+L,u.searchfield=u.searchfield+":::"+T[D]):(u.condition=O.find(".filterCondition").val(),u.value=L,u.searchfield=T[D]),!crmListView.validateFilterValue(S[0],u,L,!1))return null}}if("CAM"===u.searchfieldtype){if(crmListView.selectedCampaigns=[],$.each($("#campaign_name_select option:selected"),CustomView.populateCampaigns),u.searchfield="Campaigns:CAMPAIGNID",validationUtils.isEmpty(crmListView.selectedCampaigns))return crmui.showMsgBand("warning",I18n.getValueForFields("crm.field.valid.check",I18n.getMsg("crm.module.name",$ESAPI.encoder().encodeForHTML(I18n.getMsg(moduleRecordMapping.Campaigns.singular_label)))),"2500"),null;u.value=JSON.stringify(crmListView.selectedCampaigns);var F,V=$("#camp_member_status_sel").val().join(",");if(""!=V)(F=jQuery.extend(!0,{},u)).searchfield="Campaigns:MEMBERSTATUS",F.value=V,o.push(F);if(""!=d)(F=jQuery.extend(!0,{},u)).searchfield="Campaigns:SERVICESTATUS",F.value=d,o.push(F)}if("REC"===u.searchfieldtype){var A={},k=$("#recommendation_type");if(u.searchfield="Recommendation:"+k.val(),"all"!==$("#product_choose").val()){var N=[],M=(W=$("#recommendation_select_id")).attr("name");if(0==(q=(G=$("#"+M+" option:selected")).length))return crmui.showMsgBand("warning",I18n.getMsg("crm.dashboard.sharing.empty.value.alert"),"2500"),W.next().find("input").trigger("click"),null;for(var R=0;R<q;R++){var B={},U=$(G[R]);B.id=U.val(),B.value=U.text(),N.push(B)}A.selected_products=N}if("REBUY"===k.val()){var j={},H=$("#rebuy_select").val();if(j.option=H,"custom"===H){var z=$("#rec_searchdate");if(!crmListView.validateFilterValue(z[0],void 0,z.val()))return null;j.custom_date=z.val()}A.rebuy_options=j}else if("CWBAB"===k.val()){N=[];var q,Y=(W=$("#recommendation_select_2_id")).attr("name"),J=$("#"+Y+" option:selected");if(0==(q=J.length))return crmui.showMsgBand("warning",I18n.getMsg("crm.dashboard.sharing.empty.value.alert"),"2500"),W.next().find("input").trigger("click"),null;for(R=0;R<q;R++){B={},U=$(J[R]);B.id=U.val(),B.value=U.text(),N.push(B)}A.in_fields=N}u.value=JSON.stringify(A)}if("MXN"===u.searchfieldtype){var W;N=[],M=(W=$(f.find("input[type=text]"))).attr("name");if(W.data("connectedmodule")){var G=$("#"+M+" option:selected");for(R=0;R<G.length;R++){B={},U=$(G[R]);B.id=U.val(),B.value=U.text(),N.push(B)}}else{for(var Q=W.attr("id"),K=$(f.find("li")),R=0;R<K.length;R++){var B={},U=$(K[R]);B.id=U.data("id"),B.value=U.text(),N.push(B)}W=$("#"+Q.replace("hostSearch_temp_",""))}if(u.searchfield=W.data("sysrefname")+":ID",u.searchModule=W.data("connectedmodule"),u.linkingModule=W.data("linkingmodule"),u.dispsysrefname=W.data("dispsysrefname"),u.sysrefname=W.data("sysrefname"),u.tagName=W.data("sysrefname")+"_select",u.condition=f.find(".filterCondition").val(),validationUtils.isEmpty(N)&&"0"==u.condition)return crmui.showMsgBand("warning",I18n.getValueForFields("crm.field.valid.check",I18n.getMsg("crm.module.name",$ESAPI.encoder().encodeForHTML(I18n.getMsg(moduleRecordMapping[u.searchModule].singular_label)))),"2500"),null;u.value=JSON.stringify(N)}else if(u.searchfield.indexOf("TOUCH")>-1)u.searchfield=u.searchfield+":"+m.closest(".filterContainBox").find("#touchSource").val();else if(u.searchfield.indexOf("RECORDACTION")>-1){var X=m.closest(".filterContainBox");u.searchfield=u.searchfield+":"+X.find("#actionType").val()+":"+X.find("#touchSource").val()}if("PRE"==u.searchfieldtype){var Z,ee=f.find(".predictionMain").filter(":checked").attr("id"),te=$("#sub_"+ee).find(".preSubFilter"),ie=$(".predictionMain:checked").attr("data-value");if("PREWIN"===ie)u.searchfield=ie,be=$(".predictionMain:checked").closest("li").find(".predFilterVal").val();else if("PREGONEUP"===ie||"PREGONEDOWN"===ie){if(u.searchfield=ie,(Z=$(te).find('input[type="radio"]:checked').closest(".preSubFilter").find(".predFilterVal")).length>0){be=Z.eq(0).val();for(x=1;x<Z.length;x++)be=be+","+Z.eq(x).val()}}else if("PREFOCUS"===ie){u.searchfield=ie;var ae=$(te).find('input[type="checkbox"]:checked');if(ae.length>0){be=ae.eq(0).val();for(x=1;x<ae.length;x++)be=be+","+ae.eq(x).val()}}else if("PRESCORE"===ie){u.searchfield=ie;var se=$(te).find("select").val();be=$(te).find('input[type="text"]').val(),u.condition=se}u.value=be}else if("LPRE"==u.searchfieldtype&&(crmListView.processLeadPrediction(f,m,u),!u.searchfield)){a=!0;continue}if("true"===m.attr("data-subFilters"))if("EMA"===u.searchfieldtype){var re=(ue=i.find("#emailCondition").find("option:selected")).attr("data-value");u.searchfield=customViewObject.module+":"+re,f="NOTSENT"===(ue=ue.val())?i.find("#sub_NOTSENT"):$("#lv_email_date");customViewObject.module;var oe=i.find("#lv_email_status").find('input[name="mail_status"]:checked').attr("data-value");"SENT"===ue&&(oe="OPENED"==oe?"SENT_OPENED":oe||ue),u.searchfield=u.searchfield+":"+oe}else if("SMA"!=u.searchfieldtype&&"Prediction"!=v){f=(ue=p.find('input[name="'+v+'"]:checked')).closest("li");var ne=JSON.parse(ue.attr("data-params"));for(var h in ne)u[h]=ne[h];if("OVERDUE"===ue.attr("data-value")){var le=f.find("select").val();u.searchfield=le+":OVERDUE",u.searchModule=le}else if("true"===ue.attr("data-subFilters")){var de=ue.closest("li").find('input[name="sub_'+v+'"]:checked');if(f=de.length?de.closest("div"):f,de.attr("data-params")){f=de.closest("div");var ce=JSON.parse(de.attr("data-params"));for(var h in ce)u[h]=ce[h]}}t++}if("SMA"===u.searchfieldtype){var ue=i.find("#emailSentimentCondition").find("option:selected").val(),me=u.searchfield.split(":")[0];f=$("#lv_email_sentiment_date");var pe=i.find("#lv_email_sentiment_status").find('input[name="sentiment_status"]:checked'),fe=pe.closest("li"),ve=(oe=pe.attr("data-value"),fe.find("#sub_Sentiment_1New").find("option:selected").val()),ge=fe.find("#ageindays1").val();if(oe&&(!ge||""===ge.trim()||isNaN(ge))&&"LASTMAIL"!=oe)return crmui.showMsgBand("error",I18n.getMsg("crm.mb.field.startnum.notn.number"),6e3),fe.find("#ageindays1").focus(),null;u.searchfield=ge&&ve?me+":"+ue+":"+oe+":"+ve+":"+ge:me+":"+ue+":"+(oe||"COUNT")}if("RFM_score"!=u.searchfieldtype&&"PRE"!=u.searchfieldtype&&"LPRE"!=u.searchfieldtype&&!u.condition&&f.find(".filterCondition").length){if(u.condition=f.find(".filterCondition").val(),"${BLOCKED}"==u.condition||"${NOTBLOCKED}"==u.condition){var he=u.searchfield.split(":")[1],Ce=u.searchfield.split(":")[0];u.searchfield=Ce+":"+he,"EMAIL"==he?u.searchModule="PRIM_Bounce":"ADDN_EMAIL"==he&&(u.searchModule="SEC_Bounce"),t++}"near to"==u.condition&&null!=$("#latlong")&&(u.latlong=$("#latlong").val())}if("RFM_score"!=u.searchfieldtype&&"PRE"!=u.searchfieldtype&&"LPRE"!=u.searchfieldtype&&!u.value&&f.find(".filterValue").length){var we=f.find(".filterValue");if(Search.defaultFilters.contains(u.condition)||Search.bounceDefaultFilters.contains(u.condition))var be=u.condition;else{be=we.val();if("searchdate"==we[0].id||"fromdate"==we[0].id)try{var Te=CrmDateUtils.getDateObjectFromString(be);be=CrmDateUtils.getFormattedDate(Te)}catch(e){murphy.error(e)}for(x=1;x<we.length;x++){var Ie=we.eq(x).val();if("todate"==we[x].id)try{Te=CrmDateUtils.getDateObjectFromString(Ie);Ie=CrmDateUtils.getFormattedDate(Te)}catch(e){murphy.error(e)}be=be+","+Ie}}var ye=be&&"string"==typeof be&&-1!==be.indexOf("${LASTAGEINMONTHS")?be.replace("${LASTAGEINMONTHS","").replace("}",""):be;if(!crmListView.validateFilterValue(we[0],u,ye,e))return null;be=u.condition===Search.dueCrt?"+"+be:be,"ageindays"===we.attr("name")&&(be=u.condition===Search.dueCrt?we.next("#selDays").find("select").val().replace("LAST","")+be+"}":we.next("#selDays").find("select").val()+be+"}"),u.value=be,"U"===u.searchfieldtype&&Search.formUserConditionValues(n,"1_"+we.attr("id").split("_")[1],"temp_searchuser"+c,be)}if(!u.value&&Search.defaultFilters.contains(u.condition)&&(u.value=u.condition),"picklist"===u.searchfieldtype){var Pe=f.find(".historyMoreOpt");if(Pe.length>0&&Pe.is(":visible")&&!Pe.hasClass("disableHistory")){if(u.trackerOption="none",Pe.find("#historyTrackedPickList_duration").is(":checked")){u.trackerOption="duration",u.trackerOptionCond=Pe.find("#historyTracker_duration_cond").val();var $e=Pe.find("#histTrackDurationDays");if($e&&(""===$e.val()||parseInt($e.val())<0||/\D/.test($e.val())))return alert(I18n.getMsg("crm.smartfilter.history.duration")),$e.focus(),null;u.trackerOptionDays=$e.val()}t++}}if("ActivityType"===u.searchfieldtype&&(u.searchfieldtype="T"),"tag"==u.searchfieldtype&&("CrmTask:TAGMODULEREFID"===u.searchfield||"CrmCall:TAGMODULEREFID"===u.searchfield||"CrmEvent:TAGMODULEREFID"===u.searchfield)){if(null!=e){if(e)continue;if(!e&&$("#filter_activityTag").length>0&&0==$("#filter_activityTag:checked").length)continue}"CrmTask:TAGMODULEREFID"===u.searchfield?u.searchModule="Tasks":"CrmCall:TAGMODULEREFID"===u.searchfield?u.searchModule="Calls":Crm.isActivitySplitDone||"Calls"==u.searchModule||"Tasks"==u.searchModule||"Events"==u.searchModule||(u.searchfield="CrmActivity:TAGMODULEREFID")}o.push(u)}return a?null:(t>3&&alert(I18n.getMsg("crm.smartfilter.related.module.msg")),n)},crmListView.populateFilters=function(e,t){t||(t=crmListView.getObject());var i=e.filters,a=i.length,s=$("#lv_filter_scroll");if(0!==s.length){for(var r=s.find("#lv_email_status"),o=r.find("#anyEmailStatus"),n=$("#historyTrackedPickList_duration"),l=0;l<a;l++){var d=i[l],c=d.searchfieldtype,u=d.searchfield,m=u.split(":"),p=u.indexOf("TOUCHED")>-1||u.indexOf("RECORDACTION")>-1;m=m&&m.length>=5||p?m[0]+":"+m[1]:u;var f=d.condition;if("MXN"===c&&"Users"===d.searchModule){c="U";var v=u.replace(":ID","");m=(I=(V=s.find('[data-sysrefname="'+v+'"]')).closest(".filterContainBox")).closest(".filterContainBox").find('input[type="checkbox"]').data("value"),d.ovalue=d.ovalue?d.ovalue:d.value;for(var g=$.parseJSON(d.ovalue),h=g.length,C=0;C<h;C++)0==C?ne=g[C].id:ne+=","+g[C].id}if("EMA"===c){var w=(P=u.split(":"))[2],b=-1!==(u=P.splice(0,2).join(":")).indexOf("LAST_SENT_TIME")?"SENT":w,T=s.find("#emailCondition"),I="NOTSENT"===b?s.find("#sub_NOTSENT"):$("#lv_email_date");T.find('option[value="'+b+'"]').prop("selected",!0),T.trigger("onchange"),I.closest(".filterContainBox").find('input[type="checkbox"]').prop("checked","checked").trigger("onchange");var y=r.find('input[data-value="'+w+'"]');y.length?y.trigger("click"):"SENT"===w&&o.trigger("click")}else if("SMA"===c){var P,_=(P=u.split(":"))[1];w=P[2];if(P.length>3)var D=P[3],O=P[4];b=-1!==(u=P.splice(0,2).join(":")).indexOf("POSITIVE")?"POSITIVE":_,T=s.find("#emailSentimentCondition"),I=$("#lv_email_sentiment_date");if(T.find('option[value="'+b+'"]').prop("selected",!0),T.trigger("onchange"),I.closest(".filterContainBox").find('input[type="checkbox"]').prop("checked","checked").trigger("onchange"),"COUNT"!==w||D||O){var S=s.find("#lv_email_sentiment_status").find('input[data-value="'+w+'"]');if(S.trigger("click"),D&&O){var L=S.closest("ul").closest("li");L.find("#ageindays1").val(O),L.find("#sub_Sentiment_1New").find('option[value="'+D+'"]').prop("selected",!0)}}}else if("CAM"===c){if("Campaigns:CAMPAIGNID"!=u){var E=d.value.split(",");CustomView.showOrHideMemberStatusDiv(!0),$("#camp_member_status_sel").val(E).trigger("change");continue}var x=$("#campaign_name_select"),F=JSON.parse(d.value);CustomView.populateSelectedCampaignNames(F),(I=x.closest(".filterContainBox")).closest(".filterContainBox").find('input[type="checkbox"][data-name="Campaigns"]').prop("checked","checked").trigger("onchange")}else if("MXN"===c){v=u.replace(":ID","")+"_select";var V=$("#"+v),A=!0;try{$.parseJSON(d.value)}catch(e){A=!1}if(A){var k=JSON.parse(d.value);CustomView.populateSelectedMxNNames(k,v)}else CustomView.populateSelectedMxNNames([],v);(I=V.closest(".filterContainBox")).find(".filterCondition").val(f).trigger("onchange"),I.closest(".filterContainBox").find('input[type="checkbox"]').prop("checked","checked").trigger("onchange")}else if("PRE"===c){if((I=$(".predictionMain."+u)).attr("checked","checked").trigger("onchange"),I.closest(".filterContainBox").find('input[type="checkbox"]').prop("checked",!0).trigger("onchange"),"PREWIN"===u)$("#predWinSel").val(d.value).change();else if("PRESCORE"===u)$(".filterCondition.predictionScore option[value="+d.condition+"]").prop("selected",!0),$(".predFilterVal.predictionScore").val(d.value);else if("PREFOCUS"===u){$(".predSubFilter.PREFOCUS input").prop("checked",!1);var N=d.value.split(",");for(l=0;l<N.length;l++)$('.predSubFilter.PREFOCUS input[value="'+N[l]+'"]').prop("checked",!0)}else if("PREGONEUP"===u||"PREGONEDOWN"===u){var M=$(".predSubFilter."+u),R=d.value.split(",");1==R.length?M.find("input.trendLast3").prop("checked",!0):(M.find("input.trendLastN").prop("checked",!0),M.find(".predFilterVal.ageindays").val(R[0]),M.find("select.predFilterVal.period").val(R[1]).change())}}else if("REC"===c){if((I=s.find('[data-name="Recommendation"]')).prop("checked","checked").trigger("onchange"),$("#recommendation_type").val(u.split(":")[1]).trigger("onchange"),void 0!==(Q=JSON.parse(d.value)).selected_products&&($("#product_choose").val("selected").trigger("onchange"),CustomView.populateSelectedMxNNames(Q.selected_products,"recommendation_select")),void 0!==Q.rebuy_options){var B=Q.rebuy_options;$("#rebuy_select").val(B.option).trigger("onchange"),"custom"===B.option&&$("#rec_searchdate").val(B.custom_date)}void 0!==Q.in_fields&&CustomView.populateSelectedMxNNames(Q.in_fields,"recommendation_select_2")}else if("LPRE"===c){(I=$('.leadPreFilter[data-value="'+u+'"]')).attr("checked","checked").trigger("onchange");var U=$('.leadPreFilter[data-value="'+u+'"]').attr("id");if("LPCON"==u){M=$("#sub_"+U).find('input[type="radio"]');$(':radio[name="lead_Convert_radio"][value="'+d.value+'"]').prop("checked",!0)}else if("LPRFOC"==u){M=$("#sub_"+U).find("input[type='checkbox']");var j=d.value.split(",");for(l=0;l<j.length;l++)M.filter('input[name="'+j[l]+'"]').prop("checked",!0)}else if("LPSCR"==u){$("#sub_"+U).find("select").val(d.condition).change();for(M=$("#sub_"+U).find('input[type="text"]'),j=d.value.split(","),l=0;l<j.length;l++)$(M[l]).val(j[l]).change()}else if("LPREC"==u){j=d.value.split(","),M=$("#sub_"+U);var H=$(M).find("select");H.eq(0).val(j[0]).change(),j.length>2?(M.find('input[type="radio"]').eq(0).prop("checked",!0),M.find('input[type="text"]').val(j[1]),H.eq(1).val(j[2]).change()):M.find('input[type="radio"]').eq(1).prop("checked",!0)}}else{if(-1!==u.indexOf("OVERDUE")){var z=u.split(":")[0];m=u=u.split(":")[1]}if("tag"==c&&-1!=m.indexOf("CrmActivity")){var q=d.searchModule;"Activities"==q&&(q=crmListView.getActivitySubModule(d.value,q,i)),"Calls"==q?(m="CrmCall:TAGMODULEREFID",u="CrmCall:TAGMODULEREFID"):"Tasks"==q?(m="CrmTask:TAGMODULEREFID",u="CrmTask:TAGMODULEREFID"):"Events"==q&&(m="CrmEvent:TAGMODULEREFID",u="CrmEvent:TAGMODULEREFID")}var Y=!1;if(!(M=s.find('[data-value="'+m+'"]')).length){if(!(M=s.find('.rfmTop[rfmdetails="'+m+'"]')).length)continue;Y=!0}I=null;var J=null;if(Y)J=(I=M.closest(".filterContainBox")).closest(".filterContainBox").find('input[type="checkbox"]');else I="checkbox"===M.attr("type")?M.closest(".filterContainBox"):M.closest("li");if("OVERDUE"===u)I.find("select").val(z),M.attr("data-params",JSON.stringify(d));else if("true"===M.attr("data-subFilters")){var W=$("#sub_"+M.attr("id"));I=W,W.find('[data-value="'+f+'"]').length&&(I=W.find('[data-value="'+f+'"]').click())}else if(p){if(u.indexOf("RECORDACTION")>-1){I.find("#actionType").val(u.split(":")[2]);var G=u.split(":")[3]}else G=u.split(":")[2];I.find("#touchSource").val(G)}Y?J.not(".rfmFilter").prop("checked","checked").trigger("onchange"):I.closest(".filterContainBox").find('input[type="checkbox"]').prop("checked","checked").trigger("onchange"),M.attr("name")&&-1!==M.attr("name").indexOf("sub_")&&M.closest("li").find('input[type="radio"]').click(),M.prop("checked")||Y||M.prop("checked","checked").trigger("onchange")}if(I.find(".filterCondition").length){Y?(M.find(".rfmFilter").prop("checked","checked").trigger("onchange"),M.find(".filterCondition").val(f).trigger("onchange")):(I.find(".filterCondition").closest("div").prev('input[type="radio"]').click(),I.find(".filterCondition").val(f).trigger("onchange"));var Q=d.value+"",K=I.find(".filterValue");if(!Q||-1===Q.indexOf("${LASTAGE")&&-1===Q.indexOf("${AGE"))if("N"==c||14!=f&&15!=f)if("N"!=c||14!=f&&15!=f){if(!Search.defaultFilters.contains(f)&&!Search.bounceDefaultFilters.contains(f)){if("searchdate"==K.attr("id"))try{Q=CrmDateUtils.convertDateToUserPattern(CrmDateUtils.getDateObjectFromString(Q,"YYYY-MM-DD"))}catch(e){murphy.error(e)}K.hasClass("historyTrackerFilterVal")?(d.trackerOption&&""!==d.trackerOption&&"duration"===d.trackerOption?(n.prop("checked",!0),$("#histTrackDurationDays").val(d.trackerOptionDays),$("#historyTracker_duration_cond").val(d.trackerOptionCond)):n.prop("checked",""),K.val(Q)):Y?M.find(".filterValue").val(Q):I.find(".filterValue").val(Q)}}else if(Y){M.find(".betweenCrt").show();var X="readonly",Z="filterValue";M.find("#fromnum").show().removeAttr(X).val(Q.split(",")[0]).addClass(Z),M.find("#tonum").show().removeAttr(X).val(Q.split(",")[1]).addClass(Z)}else I.find(".betweenCrt").show(),I.find("#fromnum").show().removeAttr("readonly").val(Q.split(",")[0]).addClass("filterValue"),I.find("#tonum").show().removeAttr("readonly").val(Q.split(",")[1]).addClass("filterValue");else{I.find(".betweenCrt").show();var ee=Q.split(",")[0],te=Q.split(",")[1];try{ee=CrmDateUtils.convertDateToUserPattern(CrmDateUtils.getDateObjectFromString(ee,"YYYY-MM-DD")),te=CrmDateUtils.convertDateToUserPattern(CrmDateUtils.getDateObjectFromString(te,"YYYY-MM-DD"))}catch(e){murphy.error(e)}I.find("#fromdate").removeAttr("readonly").val(ee).addClass("filterValue").show(),I.find("#todate").removeAttr("readonly").val(te).addClass("filterValue").show()}else{if(0===I.find(".filterValue").find('option[value="'+Q+'"]').length){f===Search.dueCrt&&(Q=Q.replace("+","").replace("${","${LAST"));var ie=-1!==(Q=Q.split("}")[0]).indexOf("${LASTAGEIN")?Q.lastIndexOf("S")+1:Q.lastIndexOf("E")+1;I.find(".filterValue").next("#selDays").find("select").val(Q.substring(0,ie)),Q=Q.substr(ie)}K.val(Q)}if("picklist"===c||"B"===c){var ae="1_"+K.attr("name").split("_")[1],se="B"===c?"booleancondition1_"+K.attr("name").split("_")[1]:"textpicklistcondition1_"+K.attr("name").split("_")[1],re='select[id="';"picklist"===c?Search.checkEmptyCdn($(re+se+'"]')[0],void 0,void 0,void 0,u,d?d.searchModule:void 0):$('select[id="searchboolean'+ae+'"]').val(Q).trigger("change.select2")}else if("L"===c){se="textlayoutcondition1_"+K.attr("name").split("_")[1];Search.checkEmptyCdn($('select[id="'+se+'"]')[0],void 0,void 0,void 0,u)}else if("W"===c){se="textwizardcondition1_"+K.attr("name").split("_")[1];Search.checkEmptyCdn($('select[id="'+se+'"]')[0],void 0,void 0,void 0,u)}else if("tag"===c){se="texttagcondition1_"+K.attr("name").split("_")[1];Search.checkEmptyCdn($('select[id="'+se+'"]')[0],void 0,void 0,void 0,u)}else if("U"===c){var oe=K.attr("id"),ne=[],le=!0;try{var de=$.parseJSON(d.value)}catch(e){le=!1}if(le&&!de.length&&(le=!1),le)for(h=de.length,C=0;C<h;C++)0==C?ne=de[C].id:ne+=","+de[C].id;else ne=Q;Search.populateUserConditionValues(ne,e["temp_searchuser"+l],$("#temp_"+oe))}else"T"===c&&-1!==u.indexOf("CrmActivity:ACTIVITYTYPE")&&I.find("#actcondition").val(Q.split(",")).trigger("change.select2")}var ce=I.closest(".filterContainBox").find('input[type="checkbox"]').eq(0).attr("id").split("_")[1];t.filterDispIndex=ce&&parseInt(ce)>t.filterDispIndex?++t.filterDispIndex:t.filterDispIndex}a?($("#lv_left_filter").find("#clearFilterLink").show(),$("#lv_filter_submit").prop("disabled",!0),customViewObject.filterId,setTimeout((function(){$("#lv_filter_scroll").scrollTo(s.find("input.checkFilter:checked").eq(0).closest(".filterContainBox"))}),100)):$("#lv_filter_submitdiv").css("visibility","hidden")}},crmListView.validateFilterValue=function(e,t,i,a){var s=i||e.value,r=$(e).attr("data-fieldlabel");if("rec_searchdate"===e.id)return!(!Search.defaultFilters.contains(s)&&!dateValidate("searchdate",r||I18n.getMsg("Date"),"OTH","lv_left_filter",e))||(e.focus(),!1);if("searchdate"===e.id&&!Search.defaultFilters.contains(s)&&!dateValidate("searchdate",r||I18n.getMsg("Date"),"OTH","lv_left_filter",e))return e.focus(),!1;if("fromdate"!==e.id||Search.defaultFilters.contains(s)){if("ageindays"===e.id&&(!s||/\D/.test(s)||s.length>4)){var o=I18n.getMsg(s?"crm.mb.field.common.splc":"crm.mb.field.common.empt");return s&&s.length>4&&(o=I18n.getMsg("crm.mb.field.common.lenp",4)),alert(o),e.focus(),!1}if("N"!==t.searchfieldtype&&"RFM_score"!==t.searchfieldtype||"fromnum"==e.id)if("N"!==t.searchfieldtype&&"RFM_score"!==t.searchfieldtype||"fromnum"!==e.id){if("L"===t.searchfieldtype||"U"===t.searchfieldtype||"W"===t.searchfieldtype||"picklist"===t.searchfieldtype||"T"===t.searchfieldtype||"B"===t.searchfieldtype||"ActivityType"===t.searchfieldtype){if(!s)return alert(I18n.getValueForFields("crm.field.valid.check",r)),e.focus(),!1;if("U"!==t.searchfieldtype&&s.replace(/^\s+/g,"").replace(/\s+$/g,"").indexOf("*")>-1)return alert(I18n.getMsg("crm.alert.character.not.allowed",["*"])),e.focus(),!1}else if("tag"===t.searchfieldtype&&!s&&null!=a&&!a)return("Events"==t.searchModule||"Calls"==t.searchModule||"Tasks"==t.searchModule)&&$("#filter_activityTag").length>0&&0==$("#filter_activityTag:checked").length||(alert(I18n.getMsg("crm.tag.customview.filter.select.one.tag")),e.focus(),!1)}else{l=s.split(","),n=/^-?\d+(,(\d)+)*(\.\d{1,2})*$/;if(!Search.defaultFilters.contains(l[0])&&(isNaN(l[0])||!n.test(l[0])))return alert(I18n.getValueForFields("crm.field.valid.check",r)),e.focus(),!1;if(!Search.defaultFilters.contains(l[1])&&(isNaN(l[1])||!n.test(l[1])))return alert(I18n.getValueForFields("crm.field.valid.check",r)),$(e).parent().find("#tonum").focus(),!1;if(!commonUtils.compareNumber(l[0].replace(/^\s+/g,"").replace(/\s+$/g,""),l[1].replace(/^\s+/g,"").replace(/\s+$/g,"")))return e.focus(),renderingUtils.showCustomAlert(I18n.getMsg("crm.custom.field.less.than.to"),void 0,!0),!1}else{s=s.replace(/^\s+/g,"").replace(/\s+$/g,"");var n=/^-?\d+(,(\d)+)*(\.\d{1,2})*$/;if(!Search.defaultFilters.contains(s)&&(isNaN(s)||!n.test(s)))return alert(I18n.getValueForFields("crm.field.valid.check",r)),e.focus(),!1}}else{var l=s.split(",");if(!dateValidate("fromdate",r||I18n.getMsg("Date"),"OTH","lv_left_filter",e))return e.focus(),!1;if(!dateValidate("todate",r||I18n.getMsg("Date"),"OTH","lv_left_filter",$(e).next().next()[0]))return $(e).next().next()[0].focus(),!1;var d=new Date(l[0]),c=new Date(l[1]);if(!Utils.compareDate(d,c)){var u="'"+I18n.getMsg("workflow.option.webhookFailure.fromDate")+"'",m="'"+I18n.getMsg("workflow.option.webhookFailure.toDate")+"'";return renderingUtils.showCustomAlert(I18n.getMsg("crm.custom.field.less.than.equalto",[u,m]),void 0,!0),e.focus(),!1}}return!0},crmListView.isNewFilter=function(e,t){if(!e)return 0!==t.length;var i=e.length;if(i!==t.length)return!0;for(var a=0;a<i;a++){var s=e[a],r=t[a];for(var o in r)if(r[o]!=s[o])return!0}return!1},crmListView.setViewProps=function(e,t){e.hasOwnProperty("isStageView")?t.stageView=e.isStageView:t.stageView=!1,e.hasOwnProperty("isPredictView")?t.predictview=e.isPredictView:t.predictview=!1,e.hasOwnProperty("normListView")?t.normListView=e.normListView:t.stageView||t.predictview?t.normListView=!1:t.normListView=!0,e.hasOwnProperty("isCustomizedView")&&(t.normListView=!1,t.predictview=!1,t.stageView=!1,t.view="customisedview")},crmListView.submitFilters=function(e){var t=crmListView.getObject(),i={module:t.module,fetchOnlyBody:"true"};if(customViewObject.isPrivacyListView&&(i.module=t.module.replace("privacy_",""),i.privacyDetails=customViewObject.privacyDetails),e?(crmListView.setFiltersToDefaultState(),$("#lv_filter_hide").show(),delete t.filterId,$(".filter_listcontent").removeClass("f_listclick-view"),crmListView.setViewProps(t,i)):($("#lv_filter_hide").hide(),i.isFilterApplied=!0,crmListView.setViewProps(t,i)),crmListView.getAdvSearchCrtFromCVObject(i),delete i.filters,i.latlong=$("#latlong").val(),void 0!==$("#km")?i.meter=$("#km").val():i.meter=$("#meter").val(),crmListView.getFilterParams(i,!0,e),null===i.filters&&!i.filterSearch)return!1;if(!e)if(t.filterId||$("#lv_saved_filters").find(".f_listclick-view").attr("id")){if(!i.filters)return alert(I18n.getMsg("crm.warning.select.filter")),!1;crmListView.toggleFilterOptions(!0,t.savedFilters.length<5,!0)}else i.filters&&t.savedFilters.length<5&&!Crm.userDetails.CLIENT_ACCOUNT&&crmListView.toggleFilterOptions(!0);if("All Portals"==t.portalName?i.allPortals=!0:(i.portalName=t.portalName,i.allPortals=!1),i.filters&&JSON.parse(i.filters).length>0?$("#lv_left_filter").find("#clearFilterLink").show():($("#lv_left_filter").find("#clearFilterLink").hide(),$("#lv_filter_hide").show()),Crm.userDetails.RTL_ENABLED||$("#listviewtablescroll").scrollLeft(0),$("#lv_filter_submit").prop("disabled",!0),t.isStageView&&1==t.isStageView&&t.layoutId&&"0"!=t.layoutId&&(i.layoutId=t.layoutId),customViewObject.isCampaignAddMemberListView)return e&&(customViewObject.filters=[]),CrmCampaignInteg.applyFilters(i),!1;if(i.clearCache=!0,customViewObject.isPrivacyListView)return e&&(customViewObject.filters=[]),CrmPrivacyDashboard.applyFilters(i),!1;delete i.filterSearch,i.cvid=t.cvId;var a=void 0;i.filters&&(a=i.filters,JSON.parse(i.filters).length>0&&!customViewObject.isPrivacyListView&&(customViewObject.showSelectAll=!1));var s=Lyte.Router.getRouteInstance().transition.info.route;"crm.tab.module.custom-view.canvas"===s?Lyte.Router.transitionTo({route:s,dynamicParams:[t.module,t.cvId,t.viewid],queryParams:{filters:a}}).data=i:Lyte.Router.transitionTo({route:s,dynamicParams:[t.module,t.cvId],queryParams:{filters:a}}).data=i;return!1},crmListView.setFiltersToDefaultState=function(){var e=$("#lv_left_filter").find("input.checkFilter:checked"),t=e.closest(".filterContainBox");t.find('input[type="radio"]:checked').prop("checked",!1),t.find(".filterCondition").find("option:selected").prop("selected",!1),t.find(".filterCondition:visible").trigger("change"),t.find("#filter_activityTag")&&(t.find("#filter_activityTag").trigger("click"),$("#ActivityTag").find("input.checkFilter").each((function(){$(this).prop("selected",!1)}))),t.find(".filterValue").length&&(t.find("input.filterValue").each((function(){var e=$(this).data("defvalue")?$(this).data("defvalue"):"";$(this).val(e);var t=$(this).attr("id");t&&-1!==t.indexOf("searchuser")&&$("#temp_"+t).find("li").remove();var i=$(this).attr("name");!i||-1==i.indexOf("searchpicklist")&&-1==i.indexOf("searchboolean")&&-1==i.indexOf("searchtag")||$("#"+i).find("option:selected").prop("selected",!1).trigger("change.select2")})),t.find("select.filterValue").each((function(){$(this).find("option:selected").prop("selected",!1).trigger("change.select2")}))),e.click(),$("#lv_filter_submitdiv").css("visibility","hidden"),$("#lv_filter_submit").val(I18n.getMsg("crm.button.apply.filter")),$("#lv_filter_scroll").scrollTop(0)},crmListView.getFilterParams=function(e,t,i){i=null!=i&&i;var a=Lyte.Router.getRouteInstance(),s=crmListView.getObject(),r={};if(s&&e.module===s.module){if(s.filters)(r=s.filters).constructor==Object&&("kanban"!=a.routeName&&"canvas"!=a.routeName&&"zia"!=a.routeName||(e.isNewFilter=!0),e.filters=JSON.stringify(r));if(s.cross_filters&&(e.isNewFilter=!0,e.cross_filters=JSON.stringify(s.cross_filters)),t&&$("#lv_left_filter").length){var o=crmListView.formFilterConditions(i);if(null==o)return void(e.filters=null);var n=o.filters;if(!crmListView.isNewFilter(r,n))return void(e.filters=null);s.filterId&&(o.filterId=s.filterId),crmTab.putFiltersInCache(e.module,o),r=n,e.filterSearch=!0}if(r&&r.length>0&&(e.filters=JSON.stringify(r),"kanban"!=a.routeName&&"canvas"!=a.routeName&&"zia"!=a.routeName||(e.isNewFilter=!0)),s.filter_id&&!s.filters&&!s.cross_filters&&("kanban"==a.routeName||"canvas"==a.routeName||"zia"==a.routeName)){var l=store.peekRecord("filter",s.filter_id);l.criteria&&(e.isNewFilter=!0,e.filters=JSON.stringify(l.criteria)),l.cross_filters&&(e.isNewFilter=!0,e.cross_filters=JSON.stringify(l.cross_filters))}}},crmListView.updateUpComingActions=function(e){"object"!=typeof e&&(e=JSON.parse(e));var t=crmListView.getObject();t.upComingActionsJson=e;var i=t.isStageView||t.isPredictView?"#detailView_":"#";for(var a in e){var s=e[a],r=$(i+a).find("#upComingActionstd");if(t.isStageView)r.next("#sv_act_create_div").remove(),$(r).html(crmListView.svUpComingActionTemplate(s)).show(),r.find("span").attr("onmouseout","crmui.hideTooltip()");else if(t.isPredictView)for(var o=t.stageIdsArr[0],n=0;n<o.length;n++)r=$("#data-container_"+o[n]+"_inner").find(i+a).find("#upComingActionstd"),crmListView.svUpActionTemplate(r,s);else customViewObject.fromLyte||$(r).html(crmListView.upComingActionTemplate(s)).show()}customViewObject.fromLyte||($(".setTdBorBtm").css("background-color",""),renderingUtils.tableSorter("listViewTable","2",""),crmListView.createTableHeader())},crmListView.svUpActionTemplate=function(e,t){e.next("#sv_act_create_div").remove(),$(e).html(crmListView.svUpComingActionTemplate(t)).show(),e.find("span").attr("onmouseout","crmui.hideTooltip()")},crmListView.refreshRecords=function(e){var t=crmListView.getObject();if(t.isStageView)e||(e=$("#stageView_create_act").find("a").attr("data-relid")),crmListView.refreshStageBoards($("#detailView_"+e).closest("div.sv_each_stage").attr("id"));else{var i={module:t.module,calleeObj:"crmTab",clickId:"tab",fetchOnlyBody:"true",filterSearch:!0};crmListView.getAdvSearchCrtFromCVObject(i)}},crmListView.showSearchBarSF=function(e){$(e).hide(),$("#lv_filter_srchdiv").show(),$("#lv_filter_srchdiv #lv_filter_srch_input").focus()},crmListView.clearSearchResults=function(e){sE(event),0==$("#lv_filter_srch_input").val().length&&($(e).hide(),$("#lv_filter_srchdiv").hide(),$("#lv_filter_search").show(),$("#lv_filter_scroll .filterContainBox").show(),$("#lv_filter_caption").show(),$("#lv_filter_srchIcon").show()),$("#lv_filter_srch_input").val("").focus().trigger("keyup")},crmListView.applyRandomColorForStages=function(){for(var e=$("#stageViewContainer"),t=e.find(".sv_each_stage"),i=t.length,a=0;a<i;a++){var s=a%15;t.eq(a).addClass("randomcolor_"+s)}e.removeClass("kanban_revamp_mono_theme")},crmListView.clearStageSelectionNew=function(){for(var e=$("#stageViewContainer").find(".sv-stage-card-selected"),t=e.length,i=0;i<t;i++){e.eq(i).removeClass("sv-stage-card-selected")}},crmListView.showHideNoResult=function(e,t){(t=t||$("#values_"+e)).find(".sv-stage-card").length>0?$("#noRecordsCont_"+e).hide():$("#noRecordsCont_"+e).show()},crmListView.toggleText=function(e,t,i,a){var s,r;if(e){var o=a.length>170;return r=o?$ESAPI.encoder().encodeForHTML(a.substring(0,170)):$ESAPI.encoder().encodeForHTML(a),r=o?r+'... <a class="kv_showMoreLink" onclick="crmListView.toggleText(false, true, this)">'+I18n.getMsg("crm.wf.summary.label.ShowInstantActions")+"</a>":r,s='<span class="more_desc" data-value="'+$ESAPI.encoder().encodeForHTMLAttribute(a)+"\"><pre style='word-wrap: break-word; white-space:pre-wrap; font-size: 15px; color: #373737; line-height: 1.33'>"+r+"</pre></span>"}var n=$(i).closest(".more_desc");a=n.data("value"),s=t?(r=$ESAPI.encoder().encodeForHTML(a))+'<a class="kv_showMoreLink" onclick="crmListView.toggleText(false, false, this)">'+I18n.getMsg("crm.wf.summary.label.HideInstantActions")+"</a>":(r=$ESAPI.encoder().encodeForHTML(a.substring(0,170)))+'... <a class="kv_showMoreLink" onclick="crmListView.toggleText(false, true, this)">'+I18n.getMsg("crm.wf.summary.label.ShowInstantActions")+"</a>",n.find("pre").html(s)},crmListView.calculateStageWidth=function(){var e=customViewObject.stageSize,t=(customViewObject.module_info.filter_status?window.innerWidth-301:window.innerWidth)-20;return 320*e>=t?320:t/e},crmListView.setWHforStageView=function(){thirdPartyUtils.bindSelect2("#svEditSetting .newChosenSel select",{width_auto:!0});var e=$("#sv_stage_inner_parent");if(e.length){var t=window.innerWidth,i=window.innerHeight,a="0",s=document.getElementById("lv_left_filter"),r=s?s.style.display:"";"block"!=r&&""!=r||(a="301");var o=customViewObject.displayFilters?a:0;null==renderingUtils.listviewTable&&(renderingUtils.listviewTable=document.getElementById("cvpadding").offsetTop+67);var n=e.offset().top,l=crmListView.calculateStageWidth();getElemById("sv_stage_inner_parent").style.width=t-o+"px",getElemById("lv_stageview").style.height=i-(n+48)+"px";document.getElementsByClassName("sv_each_stage"),parseInt($("#svEditSetting").outerHeight());var d=i-(n+48);$(".stageview-heading-container").height();getElemById("sv_stage_inner_parent").style.height=d+"px",getElemById("stageViewContainer").style.width=customViewObject.stageSize*l+5+"px",getElemById("stageViewContainer_parent").style.width=customViewObject.stageSize*l+5+"px";var c=d-parseInt($(".stageview-heading-container").outerHeight());$(".sv_each_stage").css({width:l+"px",height:d+"px"}),$(".sv_each_stage:first-child").css({width:l+5+"px"}),$(".sv_each_stage .sv-stage-card").css({width:l-20+"px"}),$(".stageview-data-container").css("height",c-10+"px"),getElemById("stageViewContainer_parent").style.height=d+"px",localStorage.setItem("dealKanbanViewData","Viewed"),"Viewed"==localStorage.getItem("dealKanbanViewData")?$(".taskKanbanViewDeactive:after").hide():$(".taskKanbanViewDeactive:after").show()}},crmListView.showActivityDetails=function(e,t,i,a){var s=$("#actDetailsDiv").length?$("#actDetailsDiv"):$("#idForCV").append('<div id="actDetailsDiv" class="newPopup pL10 pR10 pT4 pB2" onmouseout="$(this).hide().html(\'\');" onmouseover="$(this).stop().show();"></div>').find("#actDetailsDiv"),r=(e=$(e)).offset();r.left,r.top;if(customViewObject.isStageView)o=Crm.isActivitySplitDone?'<div class="sv-tooltip" id="tooltip_'+t+'"><link-to lt-prop-target="_blank" lt-prop-class="f11 whiteClr" lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp=["'+a+'","'+t+'"]>'+$ESAPI.encoder().encodeForHTML(i)+"</link-to></div>":'<div class="sv-tooltip" id="tooltip_'+t+'"><link-to lt-prop-target="_blank" lt-prop-class="f11 whiteClr" lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp=["Activities","'+t+'"] lt-prop-qp=\'{"sub_module" : "'+a+"\"}'>"+$ESAPI.encoder().encodeForHTML(i)+"</link-to></div>";else{var o='<div><link-to lt-prop-target="_blank" lt-prop-class="f13 whiteClr" lt-prop-route="crm.tab.module.entity.detail" ';Crm.isActivitySplitDone?o+='lt-prop-dp=["'+a+'","'+t+'"]>':o+='lt-prop-dp=["Activities","'+t+'"] lt-prop-qp={"sub_module":"'+a+'"}>',o+=$ESAPI.encoder().encodeForHTML(i)+"</link-to></div>",s.html(o)}crmui.showTooltip({content:o,isHTML:!0,position:"center"}),e.off("click").on("click",(function(){if($("#actDetailsDiv").find("a")[0])$("#actDetailsDiv").find("a")[0].click();else{var t=JSON.parse(e.attr("data-params"));t&&$("#tooltip_"+t.activityId).find("a")[0]&&$("#tooltip_"+t.activityId).find("a")[0].click()}return!1}))},crmListView.bindPerfectScrollbar=function(){var e=$("#lv_filter_scroll"),t=$("#lv_filter_scroll").offset().top+$("#lv_left_filter .lv_filter_options:visible").outerHeight();if($("#lv_filter_scroll").length&&!$("#lv_filter_scroll").parent("#intelConfigFltrsDiv").length){if(thirdPartyUtils.unbindPerfectScroll("#lv_filter_scroll"),"absolute"===$("#lv_left_filter").css("position"))$("#lv_filter_scroll").css({height:$(window).height()-t});else{if(customViewObject.isKanbanView)var i=t;else i=t;$("#lv_filter_scroll").css({height:$(window).height()-i})}e.hasClass("cxSmartFilterScrollElem")||thirdPartyUtils.bindPerfectScroll("#lv_filter_scroll",{wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!1}),e.addClass("oH")}},crmListView.reorderFiltersForCV=function(e){var t=$("#lv_left_filter");if(t.length){var i=e.heading,a=(i.length,$('input[data-cm="true"].checkFilter').length+$('input[data-trackingFilter="true"].checkFilter').length);if(customViewObject.module&&CrmTags.doListViewOperations(),e.filterDispIndex=i.length+a-1,e.isVTAdvFilterAvailable){var s=$('<div id="vtFieldOuterDiv"><div id="vtHeadDiv" class="lvDivSubHead"><span class="ld-filter-span fL">'+I18n.getMsg("crm.website.activity")+'</span><div class="cB"></div></div> <div id="vtFieldDiv"> </div><div class=" mL15"><span class="vt-filter-more f10 cP pR dIB" id="vtMoreSpan" style="display:none">'+I18n.getMsg("crm.general.label.more")+'</span><div class="vt-filter-sep mL0" style="display:none"></div></div></div>');a=$('input[data-cm="true"].checkFilter').length+$('input[data-trackingFilter="true"].checkFilter').length,s.insertBefore(t.find(".filterContainBox").eq(a)),$("#lv_filter_scroll .vtColumn").each((function(){0==$(this).find("input.checkFilter:checked").length&&$(this).detach().appendTo("#vtFieldDiv")}))}}},crmListView.loadStageBoards=function(e){for(var t in e){var i=e[t],a=$("#values_"+t);if(a.length){i.smartFilterSupported=crmListView.isSmartFilterSupportedModule(customViewObject.module),i.selectedIds=customViewObject.selectedIds,a.html(Handlebars.templates.stageCard(i)),crmListView.checkAll(t),crmListView.showHideNoResult(t,a),delete i.selectedIds;var s=$("#data-container_"+t),r=JSON.parse(s.attr("data-params"));r.noOfRecords=r.noOfRecords?parseInt(r.noOfRecords)+i.body.length:i.body.length,s.attr("data-params",JSON.stringify(r)),s.attr("data-loaded","true")}}},crmListView.loadMoreStageBoardsAfterRender=function(){var e=$("#stageViewContainer").find('div.stageview-data-container[data-loaded = "false"]:visible').eq(0);if(0!==e.length){var t=e.data()?e.data().params.stageId:void 0;if(t){var i=$("#"+t),a=i.offset().left;(renderingUtils.windowWidth>a&&a>0||a+i.width()>0)&&crmListView.loadMoreStageBoards()}}else crmListView.setWHforStageView()},crmListView.loadMoreStageBoards=function(){var e=$("#stageView_create_act");if(e.is(":visible")){var t=$L("#manualCallListPopover")[0];t&&t.ltProp({show:!1})}e.trigger("onBeforeClose");var i=$("#stageViewContainer").find('div.stageview-data-container[data-loaded = "false"]:visible'),a=i.length;if(0!=a){for(var s=[],r=0;r<a;r++){var o=i.eq(r),n=o.data()?o.data().params.stageId:void 0,l=o.data()?o.data().index:void 0,d=$("#"+n).offset();if(n&&(renderingUtils.windowWidth>d.left&&d.left>0||renderingUtils.windowWidth>d.right&&d.left>0)){var c=Math.floor(parseInt(l)/4);s=customViewObject.stageIdsArr[c];break}}var u=s.length;if(0!=u){for(r=0;r<u;r++)$("#"+s[r]+" .stageview-data-container").attr("data-loaded","loading");var m={module:customViewObject.module,stageId:s.join(";"),fetchOnlyBody:"true",cvid:customViewObject.cvId};0!=customViewObject.layoutId&&(m.layoutId=customViewObject.layoutId),customViewObject.pipeline&&"0"!=customViewObject.pipeline&&(m.pipeline=customViewObject.pipeline),crmListView.getFilterParams(m),crmListView.getAdvSearchCrtFromCVObject(m);var p=new crmRequestPool;$("#sv_stage_inner_parent").addClass("sv_stage_prevent_scroll"),p.initiate({action:Crm.getCrmBasePath()+"/ShowSelectedCustomView.do?",data:m,type:"POST",success:function(e){var t=crmTab.getFromCache(e.module)?crmTab.getFromCache(e.module):customViewObject,i=t.stageBoardDetails;i=$.extend({},i,e.stageBoardDetails),t.stageBoardDetails=i,crmListView.checkForNoneStage(t,!0),crmListView.checkForEmptyStage(t),crmTab.putInCache(e.module,t),crmListView.loadStageBoards(e.stageBoardDetails),$("#sv_stage_inner_parent").removeClass("sv_stage_prevent_scroll"),crmListView.setWHforStageView(),crmListView.bindScrollToStageBoards(),customViewObject.viewSummary&&crmListView.checkStageSummary(s),crmNavig.parseCurrentListView()}})}}else crmListView.setWHforStageView()},crmListView.bindScrollToStageBoard=function(e){e.on("scroll",$L.debounce((function(){var e=$(this);"true"===e.attr("data-load")&&crmListView.loadMoreStageCards(e);var t=$("#stageView_create_act");if(t.is(":visible")){var i=$L("#manualCallListPopover")[0];i&&i.ltProp({show:!1})}t.trigger("onBeforeClose"),e.data("scrollTimer")&&clearTimeout(e.data("scrollTimer")),e.prev(".stageview-heading-container").addClass("dv_shadow"),e.data("scrollTimer",setTimeout((function(){e.scrollTop()<=10&&e.prev(".stageview-heading-container").removeClass("dv_shadow")}),300))}),250))},crmListView.bindScrollToStageBoards=function(){for(var e=$("#stageViewContainer").find('div.stageview-data-container[scroll-binded != "true"]'),t=e.length,i=0;i<t;i++){var a=e.eq(i),s=JSON.parse(a.attr("data-params"));s.noOfRecords&&(a.attr("scroll-binded","true"),"true"===a.attr("data-scupdate")||s.noOfRecords>crmListView.MAX_STAGECARD_CNT&&s.noOfRecords%crmListView.MAX_STAGECARD_CNT==1?(s.module=customViewObject.module,s.cvId=customViewObject.cvId,s.fromIndex=s.noOfRecords,a.attr("data-params",JSON.stringify(s)),a.attr("data-load","true")):a.attr("data-load","false"),crmListView.bindScrollToStageBoard(a))}setTimeout((function(){customViewObject.isPredictView?$(".stageview-data-container").addClass("prediction_dont_drag"):($(".stageview-data-container.prediction_dont_drag").removeClass("prediction_dont_drag"),crmListView.enableStageCardsSortable())}),1)},crmListView.enableStageCardsSortable=function(){if(Crm.userDetails.permissions["Crm_Implied_Edit_"+customViewObject.module]&&(!customViewObject.isReadOnlyPermission||"UNSUBSCRIBEDMODE"==customViewObject.stageColumn)){crmListView.addListenerToStageCards();var e=!1;$("#stageViewContainer").find(".sv_sortable").sortable({items:".sv-stage-card:not('.sv_approve_wait')",connectWith:".sv_acceptable",placeholder:"ui-state-highlight stagesPlaceHolder",scroll:!0,scrollSensitivity:100,scrollSpeed:10,containment:"#stageViewContainer_parent",cursor:"move",forcePlaceholderSize:!0,revert:!1,helper:function(e,t){var i=$(t).clone(),a=$(t).outerHeight();i.css({position:"absolute",overflow:"hidden"});return a>190&&(a=190,$(this).height(a),i.css({height:a})),i.get(0)},start:function(e,t){$(".stageview-data-container").css("overflow","hidden"),t.item.addClass("sv_sort_element"),$("ul.currsortable").removeClass("currsortable"),t.item.closest("ul").addClass("currsortable")},sort:function(e,t){$(e.target);$("#sv_stage_inner_parent").offset().top>$("#stageViewContainer_parent").offset().top&&$("#sv_stage_inner_parent").animate({scrollTop:0})},over:function(e){var t=$(e.target).closest(".sv_each_stage").find(".noRecordsCont:visible");t.length&&t.hide()},out:function(e){var t=$(e.target).closest(".sv_each_stage");0===t.find(".sv-stage-card:not('.ui-sortable-helper'):visible").length&&t.find(".noRecordsCont").show()},beforeStop:function(t,i){var a=i.item,s=a.attr("id").replace("detailView_",""),r=JSON.parse($("#listView_"+s).parents().eq(0).attr("lt-prop-td")).stageId;a.closest(".sv_each_stage").attr("id")===r?(i.item.removeClass("sv_sort_element"),$(".stageview-data-container").css("overflow","auto"),e=!0):e=!1},update:function(){e&&$(this).sortable("cancel")},stop:function(t,i){if(zctt.hidett(),e){var a=$(t.target).closest(".sv_each_stage");a.find(".sv-stage-card").length&&a.find(".noRecordsCont").hide()}else{$(".stageview-data-container").css("overflow","auto"),i.item.removeClass("sv_sort_element"),$(".sv_sel_entity").removeClass("sv_sel_entity"),i.item.addClass("sv_sel_entity"),setTimeout((function(){$(".sv_sel_entity").removeClass("sv_sel_entity")}),5e3);var s=i.item,r=s.attr("id").replace("detailView_",""),o=s.closest(".sv_each_stage").attr("id"),n=$("#listView_"+r),l=n.attr("data-params");l||(l=n.parent("link-to").attr("lt-prop-td"));var d=JSON.parse(l).stageId,c=s.data("layout"),u=!1;if("Potentials"===customViewObject.module&&customViewObject.stageBoards){var m=$("div#"+o).attr("name"),p=customViewObject.stageBoards,f=p.length;crmListView.haltStateParams={},crmListView.haltStateParams.curStageId=o,crmListView.haltStateParams.prevStageId=d;for(var v=0;v<f;v++)if(p[v].label===m){if("Closed Won"===p[v].fcType||"Closed Lost"===p[v].fcType)u=!0,(w={module:customViewObject.module,entityId:r,layoutId:c+""})[csrfParamName]=encodeURIComponent(csrfToken),w.onlyEntityDetails=!0,(h=new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/FormRule.do?action=getLayoutRuleNEntityInfo",data:w,type:"POST",success:function(e){(returnJson=$.parseJSON(e.entityInfo)).module="Potentials",closePotentialFromDV(p[v].probability+":"+m,"kanbanview")},error:function(){u||crmListView.updateStageError(o,d)}});break}}var g=!1;if((void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(customViewObject.module))&&(g=!0,Crm.VR||(Crm.VR={}),Crm.VR.ajaxEditFieldLabel=customViewObject.stageColumn),CFRExec&&(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(customViewObject.module)))if(""===c||""!==c&&Crm.userDetails.LRINVOLVEDLAYOUTID.contains(c)){freezeBackground(),(w={module:customViewObject.module,entityId:r,layoutId:c+""})[csrfParamName]=encodeURIComponent(csrfToken),g&&(w.includeVR=!0);var h=new crmRequestPool,C="";"Potentials"===customViewObject.module&&(C=$(s.parent()[0]).data("probability")),h.initiate({action:Crm.getCrmBasePath()+"/FormRule.do?action=getLayoutRuleNEntityInfo",data:w,type:"POST",success:function(e){if(returnJson=$.parseJSON(e.entityInfo),Crm.validationRuleJSONData[customViewObject.module]=JSON.parse(e.validationRuleJSON),validationUtils.isEmpty(returnJson))return renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),void crmListView.updateStageError(o,d);var t=$($("div#"+o)[0]).attr("name");g&&(Crm.VR.entityDetails=returnJson,CVRExec.storeStageValue(t,customViewObject.stageColumn)),CFRExec.init(e.layoutRuleJSONObj,customViewObject.module,"list");t=$($("div#"+o)[0]).attr("name");if(CFRExec.evalAjaxEditForLayoutRule(customViewObject.module,customViewObject.stageColumn,"Potentials"===customViewObject.module&&"STAGE"===customViewObject.stageColumn?C+":"+t:t)){var i={type:"StageView"};if(i.valId=o,i.prevStageId=d,"STAGE"!=customViewObject.stageColumn){var a=customViewObject.stageBoards;for(v in a)if(o==a[v].id){o=a[v].label.trim();break}}nparams={module:customViewObject.module,columnName:customViewObject.stageColumn,fieldValue:o,moduleid:r,fieldLabel:customViewObject.stageLabel,type:"StageView"},nparams[csrfParamName]=encodeURIComponent(csrfToken),nparams.check=i,CFRExec.haltStageChange(nparams)}else g?new Promise((function(e){e(crmListView.executeVRForStageDropping(o,r,d))})).then((function(e){e||(removeFreezeLayer(),CFRExec.haltStageChange({}),u||crmListView.updateStage(r,o,d))})):(removeFreezeLayer(),CFRExec.haltStageChange({}),u||crmListView.updateStage(r,o,d))},error:function(e){u||crmListView.updateStageError(o,d)}})}else u||crmListView.updateStage(r,o,d);else if(g){var w;freezeBackground(),(w={module:customViewObject.module,entityId:r,layoutId:c+""})[csrfParamName]=encodeURIComponent(csrfToken),w.onlyEntityDetails=!0,w.includeVR=!0;h=new crmRequestPool,C="";"Potentials"===customViewObject.module&&(C=$(s.parent()[0]).data("probability")),h.initiate({action:Crm.getCrmBasePath()+"/FormRule.do?action=getLayoutRuleNEntityInfo",data:w,type:"POST",success:function(e){returnJson=$.parseJSON(e.entityInfo),Crm.validationRuleJSONData[customViewObject.module]=JSON.parse(e.validationRuleJSON),Crm.VR.entityDetails=returnJson;var t=$($("div#"+o)[0]).attr("name");CVRExec.storeStageValue(t,customViewObject.stageColumn),new Promise((function(e){e(crmListView.executeVRForStageDropping(o,r,d))})).then((function(e){e||(removeFreezeLayer(),u||crmListView.updateStage(r,o,d))}))},error:function(e){u||crmListView.updateStageError(o,d)}})}else u||crmListView.updateStage(r,o,d);$(".sv_sortable").sortable("refresh"),Utils.detachObjects.push($.ui.ddmanager.current),setTimeout((function(){crmListView.addListenerToStageCards([o,d])}),500)}}}).disableSelection(),"PRICINGMODEL"!=customViewObject.stageColumn&&"UNSUBSCRIBEDMODE"!=customViewObject.stageColumn&&"INTEGRATION_TYPE"!==customViewObject.stageColumn||crmListView.disableSortable()}},crmListView.addListenerToStageCards=function(e){if(e)for(var t=e.length,i=0;i<t;i++)$("#data-container_"+e[i]).find(".sv-stage-card").mousedown((function(){crmListView.mouseDownOnStageCard($(this))}));else $(".sv_sortable").find(".sv-stage-card").mousedown((function(){crmListView.mouseDownOnStageCard($(this))}))},crmListView.mouseDownOnStageCard=function(e){var t=e.attr("data-layout"),i=$("#pipeDropdown"),a=e.attr("data-pipeline");if(t&&"null"!==t)$(".sv_acceptable").removeClass("sv_acceptable"),"STAGE"!==customViewObject.stageColumn||i.hasClass("eventNone")||!a||"null"===a?$('.sv_sortable[data-layouts*="'+t+'"').addClass("sv_acceptable"):$('.sv_sortable[data-layouts*="'+t+'"][data-pipelines*="'+a+'"]').addClass("sv_acceptable");else{var s=$L("#pipelineSelect"),r=!i.hasClass("eventNone")&&s.length?$L("#pipelineSelect")[0].ltProp("selected"):void 0;r&&"0"==r?($(".sv_acceptable").removeClass("sv_acceptable"),$('.sv_sortable[data-pipelines*="'+a+'"').addClass("sv_acceptable")):r&&"DELETED"==r?$(".sv_acceptable").removeClass("sv_acceptable"):$(".sv_sortable").addClass("sv_acceptable")}},crmListView.enableSortable=function(){if(Crm.userDetails.permissions["Crm_Implied_Edit_"+customViewObject.module]&&!customViewObject.isReadOnlyPermission&&"PRICINGMODEL"!=customViewObject.stageColumn&&"UNSUBSCRIBEDMODE"!=customViewObject.stageColumn&&"INTGERATION_TYPE"!==customViewObject.stageColumn){var e=$("#stageViewContainer");e.find(".sv_sortable").sortable("enable"),e.removeClass("sv-sortable-disabled")}},crmListView.disableSortable=function(){if(Crm.userDetails.permissions["Crm_Implied_Edit_"+customViewObject.module]&&!customViewObject.isReadOnlyPermission){var e=$("#stageViewContainer");e.find(".sv_sortable").sortable("disable"),e.addClass("sv-sortable-disabled")}},crmListView.updateStageSuccess=function(e,t,i,a,s){commonUtils.showHideLoadingDiv();var r,o="";if("object"!=typeof a&&(a.indexOf("SECURITY::::")>-1||a.indexOf("CRM_ERROR_PAGE_500::::")>-1))alert("Unable to process your request");else{if(a.responseJSON){var n=a.responseJSON;if("MANDATORY_NOT_FOUND"===n.code||n.data&&"MANDATORY_NOT_FOUND"===n.data[0].code)return Crm.showErrorMsg(I18n.getMsg("crm.field.valid.check",[cm_fl.data("displaylabel")]),cm_fl),void(itsonview=!0);if("NO_PERMISSION"===n.code||n.data&&"RECORD_IN_BLUEPRINT"===n.data[0].code||n.data&&"MAPPING_MISMATCH"===n.data[0].code||n.data&&"CANNOT_PERFORM_ACTION"===n.data[0].code)return renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),void crmListView.updateStageError(t,i);if("Internal Server Error"===n.message||n.data[0].message&&"invalid data"===n.data[0].message)return renderingUtils.displayPermissionDenied(null,null,n.message),void crmListView.updateStageError(t,i);if(n.data&&"NOT_ALLOWED"===n.data[0].code)return void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.alert.can.not.edit.email"));if("duplicate data"===n.data[0].message){var l={},d=n.data[0].details,c=returnJson.entityMapJson,u="",m=n.data[0].details.api_name;for(var p in c)c[p].sysRefName===m&&(u=c[p].displaylabel);var f=d.duplicate_record;l.FIELDLABEL=u,l.OWNERNAME=f.Owner.name,l.MODULE=module,l.RECORDS={},l.COUNT=d.more_records?2:1,l.ZUID=f.Owner.zuid,delete f.Owner;var v={};v.ENTITYID=f.id,delete f.id;var g=[];if(Object.keys(f).length>1){var h=Crm.userDetails.NAME_FORMAT;h=h.split(",");var C=[];h.forEach((function(e){"Salutation"!==e&&(e=e.replace(" ","_")),f[e]&&C.push(f[e])})),v.ENTITYNAME=C.join(" "),v.ENTITYNAMEFORPOPOVER=C.join(" ")}else for(var w in f)v.ENTITYNAME=f[w],v.ENTITYNAMEFORPOPOVER=f[w];g.push(v),l.RECORDS=g,Crm.hideDuplicateErrorMsg("viewentityform"),itsonview=!0;var b=Crm.getDuplicateErrorMsg(l,!1);return Crm.showErrorMsg(b,$("#Crm_"+module+"_"+fieldLabel),module),void commonUtils.showHideLoadingDiv()}if("DUPLICATE_LINKING_DATA"===n.data[0].code){var T=n.data[0].details.duplicate_record,I=T.id,y=T.Name,P="This Association is already exist in <a href="+(Crm.getCrmBasePath()+"/EntityInfo.do?module="+module+"&id="+I)+"  target = 'new'>"+y+"</a> entity.";renderingUtils.showCustomAlert(P,"",!0),Crm.hideDuplicateErrorMsg("viewentityform"),itsonview=!0}}var _;r=(_=a).data&&"SUCCESS"===_.data[0].code?"true":"false",o=_.outputValue,"true"===r&&(o.includes("##")&&(o=o.split("##")[1]),"Potentials"==customViewObject.module&&"STAGE"==customViewObject.stageColumn||(o=$(".sv_each_stage[name='"+o+"']").attr("id")),"popupsave"===s&&(o=t),1==$("#"+o).find(".sv-stage-card").length&&($("#"+t+" #checkAll").show(),$("#noRecordsCont_"+t).hide()),0==$("#"+i).find(".sv-stage-card").length&&($("#"+i+" #checkAll").hide(),$("#noRecordsCont_"+i).show()),crmListView.updateSummaryOnEdit(e,o,_.data[0].details))}},crmListView.updateStageError=function(e,t){$(".currsortable").sortable("cancel");var i=customViewObject.stageBoardDetails[t],a=$("#values_"+t);a.length>0&&(a.html(Handlebars.templates.stageCard(i)),crmListView.showHideNoResult(t)),i=customViewObject.stageBoardDetails[e],(a=$("#values_"+e)).length>0&&(a.html(Handlebars.templates.stageCard(i)),crmListView.showHideNoResult(e)),$(".sv_sortable").sortable("refresh"),crmListView.addListenerToStageCards([e,t])},crmListView.executeVRForStageDropping=function(e,t,a){return CVRExec.setAjaxEditPrimaryField(!0),new Promise((function(e){e(CVRExec.evalRules("view",customViewObject.module,customViewObject.stageColumn,!0,!0))})).then((function(s){if(s)return!1;hideAnimatePopup("deletepopup");var r={type:"StageView"};if(r.valId=e,r.prevStageId=a,"STAGE"!=customViewObject.stageColumn){var o=customViewObject.stageBoards;for(i in o)if(e==o[i].id){e=o[i].label.trim();break}}var n={module:customViewObject.module,columnName:customViewObject.stageColumn,fieldValue:e,moduleid:t,fieldLabel:customViewObject.stageLabel,type:"StageView"};return n[csrfParamName]=encodeURIComponent(csrfToken),n.check=r,CVRExec.storeCachedParams(n),!0}))},crmListView.updateStage=function(e,t,a){commonUtils.showHideLoadingDiv(!0);var s=t;$("#listView_"+e),a=JSON.parse($("#listView_"+e).parents().eq(0).attr("lt-prop-td")).stageId;if("STAGE"!=customViewObject.stageColumn){var r=customViewObject.stageBoards;for(i in r)if(t==r[i].id){t=r[i].label.trim();break}}var o={},n={},l=[];n[customViewObject.stageSysRefName]=t;var d={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};clientPortalName&&(d["X-CRMPORTAL"]=window.clientPortalName),l.push(n),o.data=l;var c=new crmRequestPool,u="Campaigns"===customViewObject.module||"FORECAST_CATEGORY"===customViewObject.stageColumn?"/crm/v2.2/":"/crm/v2/";c.initiate({action:u+moduleApiMapping[customViewObject.module]+"/"+e+"?affected_data=true",headers:d,contentType:"application/json",data:JSON.stringify(o),type:"PUT",success:function(i){if("INVALID_DATA"===i.data[0].code)return renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),void crmListView.updateStageError(t,a);i.outputValue=t,crmListView.updateStageSuccess(e,s,a,i)},error:function(e){if(commonUtils.showHideLoadingDiv(!1),"NO_PERMISSION"===e.responseJSON.code||e.responseJSON.data&&("RECORD_IN_BLUEPRINT"===e.responseJSON.data[0].code||"CANNOT_PERFORM_ACTION"===e.responseJSON.data[0].code||"INVALID_DATA"===e.responseJSON.data[0].code||"MAPPING_MISMATCH"===e.responseJSON.data[0].code))renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"));else if("NOT_ALLOWED"===e.responseJSON.data[0].code)crmListView.updateStageError(s,a),"Zoho Campaign can't be updated after the campaign is sent"===e.responseJSON.data[0].message?crmui.showMsgBand("error",I18n.getMsg("crm.zcampaign.edit.campaign.disallowed.dynamic",Crm.integrationsAppName.ZOHO_CAMPAIGNS),4e3):"Integration fields can be updated only for respective integration campaigns"===e.responseJSON.data[0].message&&crmui.showMsgBand("error",I18n.getMsg("crm.campaign.integfield.edit.layout.mismatch",Crm.partnerName),4e3);else{if("DELETED_ZOHO_CAMPAIGN_UPDATE"===e.responseJSON.data[0].code)return crmListView.updateStageError(s,a),void crmui.showMsgBand("error",I18n.getMsg("crm.zcampaign.record.deleted.campaigns.dynamic",Crm.integrationsAppName.ZOHO_CAMPAIGNS),4e3);if("UNAUTHORIZED_CAMPAIGN_USER"===e.responseJSON.data[0].code)return crmListView.updateStageError(s,a),void crmui.showMsgBand("error",I18n.getMsg("crm.campaign.non.campaign.user.error.dynamic",Crm.integrationsAppName.ZOHO_CAMPAIGNS),4e3);if("NO_PERMISSION_FOR_EMAILID"===e.responseJSON.data[0].code)return crmListView.updateStageError(s,a),void crmui.showMsgBand("error",I18n.getMsg("crm.zcampaign.emailid.permission.denied"),4e3)}crmListView.updateStageError(s,a)}})},crmListView.animateCount=function(e,t,i,a,s){var r=s.format.split("|");e.ltProp({useGrouping:!0,separator:r[0],decimalSeperator:r[1],prefix:s.symbol+" ",suffix:"",decimals:s.decimals,start:t,end:i,duration:a}),e.ltProp("state","start")},crmListView.updateSummaryOnEdit=function(e,t,i){var a,s=$("#listView_"+e),r=(M=JSON.parse(s.parents().eq(0).attr("lt-prop-td"))).stageId,o=s.closest("li").find(".sv_AMOUNT"),n=o.text(),l=customViewObject.summarizeById?customViewObject.module_info.fields.find((function(e){return e.id===customViewObject.summarizeById})):void 0,d=!(!l||!i.affected_data)&&l.api_name in i.affected_data[0],c=n.trim();M.stageId=t,s.parents().eq(0).attr("data-params",JSON.stringify(M)),-1!=n.indexOf("(")&&(n=n.split("(")[1].replace(")","").trim());var u=Territory.getCurrencyObj(n),m=parseFloat(Territory.formatCurrencytoNum({amtStr:n},u).amtStr);if(d){var p=-1!=c.indexOf("(")?c.split("(")[0].trim().match(/^.*?(?=[0-9])/)[0].trim():u.symbol;c=-1!=(c=crmListView.convertCurrencyForAffectedStageCard(p,i.affected_data[0].Expected_Revenue)).indexOf("(")?c.split("(")[1].replace(")","").trim():c,a=parseFloat(Territory.formatCurrencytoNum({amtStr:c},u).amtStr)}var f=customViewObject.viewSummary[r],v=customViewObject.viewSummary[t];if(v||(customViewObject.viewSummary[t]=v={recordsCount:0,amount:0}),f.recordsCount=parseInt(f.recordsCount)-1,v.recordsCount=parseInt(v.recordsCount)+1,m||0===m){var g=parseFloat(f.amount)-m,h=parseFloat(v.amount)+(d?a:m),C=o.data("amountValue");if(C){C=parseFloat(C),"AMOUNT"===l.column_name&&(h=h+C-m);for(var w=customViewObject.heading,b=w.length,T=0,I=0;I<b;I++)"AMOUNT"===w[I].COLUMNNAME&&(T=I);var y=(L=customViewObject.stageBoardDetails[r].body).length;for(I=0;I<y;I++){(F=L[I]).ENTITYID===e&&(F.CONTENT[T]=currencyUtils.returnValueInDefaultCurrency(u.symbol,C))}}if(Lyte.Component.registeredComponents["lyte-counter"]){var P=$("#"+r),_=P.find(".amount")[0];crmListView.animateCount(_,f.amount,g,.5,u);var D=!!moduleRecordMapping[customViewObject.module].modified_by;P.find(".recordsCount").text(f.recordsCount+" "+(1==parseInt(f.recordsCount)?D?moduleRecordMapping[customViewObject.module].singular_label:I18n.getMsg(moduleRecordMapping[customViewObject.module].singular_label):D?moduleRecordMapping[customViewObject.module].plural_label:I18n.getMsg(moduleRecordMapping[customViewObject.module].plural_label)));var O=$("#"+t),S=O.find(".amount")[0];crmListView.animateCount(S,v.amount,h,.5,u),O.find(".recordsCount").text(v.recordsCount+" "+(1==parseInt(v.recordsCount)?D?moduleRecordMapping[customViewObject.module].singular_label:I18n.getMsg(moduleRecordMapping[customViewObject.module].singular_label):D?moduleRecordMapping[customViewObject.module].plural_label:I18n.getMsg(moduleRecordMapping[customViewObject.module].plural_label))),v.amount=h,f.amount=g}else v.amount=h,f.amount=g,crmListView.updateStageSummary(!0)}else crmListView.updateStageSummary(!0);var L,E,x=customViewObject.stageBoardDetails[r];for(y=(L=x.body).length,I=0;I<y;I++){var F;if((F=L[I]).ENTITYID===e){E=objectUtils.cloneObject(F),L.splice(I,1),y%crmListView.MAX_STAGECARD_CNT==0&&(x.bindScroll=!0);break}}var V,A=$("#data-container_"+r);if((M=JSON.parse(A.attr("data-params"))).noOfRecords=parseInt(M.noOfRecords)-1,x.toIndex=parseInt(x.toIndex)-1,A.attr("data-params",JSON.stringify(M)),E){E=crmListView.updateAffectedDetailsInStageCard(E,i,u);var k=customViewObject.stageBoardDetails[t],N=$("#values_"+t).find("#detailView_"+e).index();k.body.splice(N,0,E);var M;A=$("#data-container_"+t);(M=JSON.parse(A.attr("data-params"))).noOfRecords=parseInt(M.noOfRecords)+1,k.toIndex=parseInt(k.toIndex)+1,A.attr("data-params",JSON.stringify(M))}(V=$("#values_"+r)).length>0&&V.html(Handlebars.templates.stageCard(x)),(V=$("#values_"+t)).length>0&&V.html(Handlebars.templates.stageCard(k)),$(".sv_sel_entity").removeClass("sv_sel_entity"),$("#detailView_"+e).addClass("sv_sel_entity"),setTimeout((function(){$(".sv_sel_entity").removeClass("sv_sel_entity")}),2e3),crmNavig.parseCurrentListView()},crmListView.updateAffectedDetailsInStageCard=function(e,t,i){if(t.affected_data&&t.affected_data[0].id===e.ENTITYID){var a,s=t.affected_data[0],r=function(e){return customViewObject.heading.findIndex((function(t){if(t.COLUMNNAME===e)return!0}))};if(s.Expected_Revenue&&(a=r("EXPECTEDREVENUE"))>-1){var o=e.CONTENT[a],n=-1!=o.indexOf("(")?o.split("(")[0].trim().match(/^.*?(?=[0-9])/)[0].trim():i.symbol;o=crmListView.convertCurrencyForAffectedStageCard(n,s.Expected_Revenue),e.CONTENT[a]=o}s.Probability&&(a=r("PROBABILITY"))>-1&&(e.CONTENT[a]=s.Probability)}return e},crmListView.convertCurrencyForAffectedStageCard=function(e,t){var i;for(var a in Crm.userDetails.CURRENCY_DETAILS)Crm.userDetails.CURRENCY_DETAILS[a].symbol===e&&(i=a);return i=i||Crm.userDetails.BASE_CURRENCY,featuresAvailable.MultiCurrency&&void 0!==Crm.userDetails.CURRENCY_DETAILS[i]?currencyUtils.returnValueInDefaultCurrency(i,t,Crm.userDetails.CURRENCY_DETAILS[i].decimals):currencyUtils.returnValueInDefaultCurrency(i,t)},crmListView.loadMoreStageCards=function(e,t,i){if((t||e.scrollTop()+e.outerHeight()>=e[0].scrollHeight-200)&&"loading"!=e.attr("data-loaded")){e.attr("data-loaded","loading");var a=new crmRequestPool,s=JSON.parse(e.attr("data-params"));delete s.index,customViewObject.isPredictView&&null!=s.stageId&&(s.predictId=s.stageId,delete s.stageId),s.toIndex=parseInt(s.fromIndex)+crmListView.MAX_STAGECARD_CNT-1,0!=customViewObject.layoutId&&(s.layoutId=customViewObject.layoutId),customViewObject.pipeline&&"0"!=customViewObject.pipeline&&(s.pipeline=customViewObject.pipeline),crmListView.getFilterParams(s),crmListView.getAdvSearchCrtFromCVObject(s),a.initiate({action:Crm.getCrmBasePath()+"/ShowSelectedCustomView.do?",data:s,type:"POST",success:function(t){var a,r;customViewObject.isPredictView?(a=s.predictId,r=t.predictData):(a=s.stageId,r=t.stageBoardDetails);var o=r;if(o&&o[a]){o=o[a],$("#values_"+a).append(Handlebars.templates.stageCard(o)),o.body.length<crmListView.MAX_STAGECARD_CNT+1&&(e.attr("data-load","false"),e.removeAttr("data-scupdate")),i&&crmListView.latestEntity(i);var n=JSON.parse(e.attr("data-params"));n.fromIndex=parseInt(s.fromIndex)+o.body.length-1,e.attr("data-params",JSON.stringify(n)),crmListView.updateStageCardsInCache(a,o,t.module,!1,customViewObject.isPredictView),crmNavig.parseCurrentListView()}e.attr("data-loaded","true"),crmListView.checkAll(s.stageId)}})}},crmListView.changeLayout=function(e){var t=e.value,i=(new crmRequestPool,{module:customViewObject.module,fetchOnlyBody:"true",cvid:customViewObject.cvId,clearCache:!0});0!=t&&(i.layoutId=t);var a={layout_id:i.layoutId};if(customViewObject.territoryId&&(i.territoryId=customViewObject.territoryId,i.includechild=customViewObject.includeChild?1:0),customViewObject.filters&&(i.filters=JSON.stringify(customViewObject.filters),a.filters=JSON.stringify(customViewObject.filters)),"Potentials"==customViewObject.module){var s=$L("#pipelineSelect"),r=s.hasClass("pipeChanged")?s[0].ltProp("selected"):"0";"0"!=r&&(a.pipeline=r,i.pipeline=r)}Lyte.Router.transitionTo({route:"crm.tab.module.custom-view.kanban",dynamicParams:[customViewObject.module,i.cvid],queryParams:a}).data=i},crmListView.changeSortColumn=function(e,t){var i=e;"0"!=(e=$("#"+e).val())?t=$("#"+t).val():(e="",t="sort_desc");var a={module:customViewObject.module,clearCache:!0,cvid:customViewObject.cvId,webTab:!1};customViewObject.viewid?a.fetchOnlyBody=!1:a.fetchOnlyBody=!0,a.sortColumnString=e,a.sortOrderString=t,customViewObject.layoutId&&"0"!=customViewObject.layoutId&&(a.layoutId=customViewObject.layoutId),customViewObject.pipeline&&"0"!=customViewObject.pipeline&&(a.pipeline=customViewObject.pipeline),customViewObject.territoryId&&(a.territoryId=customViewObject.territoryId,a.includechild=customViewObject.includeChild?1:0);var s=store.peekRecord("custom_view",customViewObject.cvId);s&&(s.sort_order=t&&t.split("sort_")[1]?t.split("sort_")[1]:void 0,s.sort_by=""!=e?{id:e,api_name:store.peekRecord("field",e).api_name}:void 0),""!=e&&"0"!=e||"CustomizedViewSortColumnSelect"!=i||!$("#canvasview-container").length?($("#select2-CustomizedViewSortColumnSelect-container").show(),$("#CustomizedViewSortOrder").show()):($("#select2-CustomizedViewSortColumnSelect-container").hide(),$("#CustomizedViewSortOrder").hide());var r={dynamicParams:[],queryParams:{}},o=Lyte.Router.getRouteInstance().transition.info,n=o.queryParams.filters;n&&(r.queryParams.filters=n),o.queryParams.cross_filters&&(r.queryParams.cross_filters=o.queryParams.cross_filters),o.queryParams.filter_id&&(r.queryParams.filter_id=o.queryParams.filter_id),r.queryParams.sort_by=e,r.queryParams.sort_order=t,r.dynamicParams=o.dynamicParams,customViewObject.viewid?(r.dynamicParams.push(customViewObject.viewid),r.route="crm.tab.module.custom-view.canvas"):customViewObject&&customViewObject.isPredictView?r.route="crm.tab.module.custom-view.zia":r.route="crm.tab.module.custom-view.kanban",a.clearselectedIds=!0,Lyte.Router.transitionTo(r).data=a},crmListView.formSelectColumnString=function(){var e=document.getElementById("selectedColumns").getElementsByTagName("li"),t={selectedColumns:[]};for(i=0;i<e.length;i++)t.selectedColumns[i]=e[i].getAttribute("value");return t.kanbanViewName=document.getElementById("KanbanViewName").value,t.groupByColumn=document.getElementById("groupByColumn").value,document.getElementById("summarizeByColumn")&&(t.summarizeByColumn=document.getElementById("summarizeByColumn").value),t.colorScheme=document.getElementById("colorThemeType").value,t},crmListView.saveKanbanViewSetup=function(e){var t=$(e),i=!1;if(emptyCheck("KanbanViewName",$("#KNLabel").text(),void 0,"KanbanSetupForm","inline")){var a=getClrTxtPtnResChars($("#KanbanViewName").val(),/[^~`#%^&*+={}[\]|;"<>\\]/g);if(a.length&&a.length>0){var s=getElm("KanbanSetupForm","KanbanViewName");renderingUtils.displayErrorDiv("KanbanViewName",void 0,I18n.getMsg("crm.alert.label.special.characters"),s),i=!0}}else i=!0;if(emptyCheck("groupByColumn",$("#KVGroupBy").text(),void 0,"KanbanSetupForm","inline")||(i=!0),emptyCheck("summarizeByColumn",$("#KVSummarizeBy").text(),void 0,"KanbanSetupForm","inline")||(i=!0),!i){t.addClass("disable pointerEventsNone");for(var r=crmListView.formSelectColumnString(),o=JSON.stringify(r),n=0,l="",d=r.selectedColumns.length,c=0;c<d;c++){var u=store.peekAll("field").filterBy({api_name:r.selectedColumns[c]})[0];"lookup"==u.data_type&&(l=l.concat(u.field_label+", "),n++)}if(n>5)getElemById("lookupCrt").style.display="none",getElemById("lookupSelect").style.display="",getElemById("lookupSelectCol").innerText=l,showAnimatePopup("lookupErrorMsg"),$(".columnListNew").addClass("popupLookupEnable");else{var m={};m.kvSettings=o,m.crmcsrfparam=csrfToken;(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/CustomView.do?action=editAndSaveKanbanViewSetup&module="+Lyte.Router.getRouteInstance().currentModel.module,data:m,type:"POST",success:function(e){if(crmui.showMsgBand("success",I18n.getMsg("crm.info.kanbanview.settings.success"),4e3),hideAnimatePopup("topBandPopup"),$("#KanbanViewPopup").remove(),e){crmListView.checkForNoneStage(e,!0);var t=crmTab.getFromCache(e.module);t=e,crmTab.putInCache(e.module,t);var i=Lyte.Router.getRouteInstance();if("crm.tab.module.custom-view.kanban"!=i.transition.info.route||i.getQueryParams().layout_id)Lyte.Router.transitionTo({route:"crm.tab.module.custom-view.kanban",dynamicParams:[i.parent.parent.getDynamicParam(),i.parent.getDynamicParam()]});else{var a=i.getQueryParams();a.filters||a.cross_filters||a.filter_id?i.setQueryParams({filters:void 0,cross_filters:void 0,filter_id:void 0}):i.refresh()}}},error:function(e){if(555==e.status){if(e.responseText.includes("selectfields"))crmui.showMsgBand("error",I18n.getMsg("crm.info.kanbanview.selectfieldslimit"),4e3);else{var i=$("[name='KanbanSetupForm'] [name='groupByColumn']"),a=I18n.getMsg("crm.info.kanbanview.limitexceed");renderingUtils.displayErrorDiv("groupByColumn",void 0,a,i),$("#displayContent_groupByColumn").addClass("form_err_kv_popup")}t.removeClass("disable pointerEventsNone")}else crmui.showMsgBand("error","Unable to process your request",4e3),$("#KanbanViewPopup").remove()}})}}},crmListView.removeErrorTr=function(){blockContent("groupByColumn")},crmListView.setSelectOpacity=function(e){var t=$(e),i=t.attr("id");if(null==t.val()||null==t.val()?t.closest(".newSelect").addClass("js-arrow-disable"):t.closest(".newSelect").removeClass("js-arrow-disable"),"summarizeByColumn"!==i){var a=$("#groupByColumn option:selected").text();crmListView.setHeaderStyle($("#groupByColumn option:selected").val(),customViewObject.module,a)}},crmListView.setHeaderStyle=function(e,t,i){var a=isColorCodeEnabled(e,t),s=$("#colorThemeType").val(),r=$("#KanbanViewPopup .kanbanviewFormTable");if(a&&"random"===s){var o=I18n.getMsg("crm.picklist.color.enabled.note",i);$("#color_enabled_note_content").text(o),$("#color_enabled_note").show(),r.addClass("mB80")}else a&&"mono"!==s||($("#color_enabled_note").hide(),r.removeClass("mB80"))},crmListView.editKanbanViewSetup=function(){(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/CustomView.do?action=editKanbanViewSetup&module="+customViewObject.module,data:{},type:"GET",success:function(e){var t=Handlebars.templates.kanbanViewSettings(e);if($("#topBandPopup").html(t),e.selectedJson){if($("#groupByColumn").val(e.selectedJson.groupBy),$("#groupByColumn").closest(".newSelect").removeClass("js-arrow-disable"),e.selectedJson.summarizeBy&&(0==$("#summarizeByColumn option[value='"+e.selectedJson.summarizeBy+"']").length?$("#summarizeByColumn").val(""):$("#summarizeByColumn").val(e.selectedJson.summarizeBy),$("#summarizeByColumn").closest(".newSelect").removeClass("js-arrow-disable")),$("#KanbanViewName").val(e.selectedJson.kanbanViewName),e.selectedJson.colorScheme&&$("#colorThemeType").val(e.selectedJson.colorScheme),"random"===e.selectedJson.colorScheme){var i=$("#groupByColumn option:selected").text();crmListView.setHeaderStyle(e.selectedJson.groupBy,customViewObject.module,i)}var a=e.selectedJson.selectColumns;a.forEach((function(e){var t=$("#availableList").find('li[value="'+e+'"]')[0];t&&commonUtils.moveToListOnDoubleClick(t)}))}var s=$("#kanbanSettingsColumn_Last_Name");!s.length||-1!=a.indexOf("Last_Name")||crmModuleConstants.Leads!==customViewObject.module&&crmModuleConstants.Contacts!==customViewObject.module||commonUtils.moveToListOnDoubleClick(s[0]),showAnimatePopup("topBandPopup",renderingUtils.sectionSorting()),select2ChangesInFields($("#topBandPopup"))},failure:function(e){alert("failure")}})},crmListView.cancelKanbanPopup=function(){hideAnimatePopup("topBandPopup"),$("#KanbanViewPopup").remove()},crmListView.updateStageSummary=function(e){if(customViewObject.viewSummary){for(var t=$("#stageViewContainer").find("div.sv_each_stage"),i=t.length,a=!!moduleRecordMapping[customViewObject.module].modified_by,s=Crm.userDetails.defaultOrgCurrency&&Crm.userDetails.DEFAULT_ORG_CURRENCY?void 0:Crm.userDetails.BASE_CURRENCY,r=0;r<i;r++){var o=t.eq(r),n=o.attr("id"),l=0,d=0,c=!1;customViewObject.viewSummary[n]&&(d=(d=parseInt(customViewObject.viewSummary[n].recordsCount))+" "+(1==d?a?moduleRecordMapping[customViewObject.module].singular_label:I18n.getMsg(moduleRecordMapping[customViewObject.module].singular_label):a?moduleRecordMapping[customViewObject.module].plural_label:I18n.getMsg(moduleRecordMapping[customViewObject.module].plural_label)),l=customViewObject.viewSummary[n].amount,c=!0),o.find(".recordsCount").show().text(c?d:d+" "+(a?moduleRecordMapping[customViewObject.module].plural_label:I18n.getMsg(moduleRecordMapping[customViewObject.module].plural_label))),o.find(".amount")[0].component.setData("result",currencyUtils.returnValueInDefaultCurrency(s,l))}!e&&customViewObject.isStageView&&customViewObject.stageIdsArr&&crmListView.checkStageSummary(customViewObject.stageIdsArr[0])}},crmListView.checkStageSummary=function(e){var t,i=e.length,a=customViewObject.stageBoardDetails,s=customViewObject.viewSummary.summarizeById,r=customViewObject.heading.length,o=!!moduleRecordMapping[customViewObject.module].modified_by,n=Crm.userDetails.defaultOrgCurrency&&Crm.userDetails.DEFAULT_ORG_CURRENCY?void 0:Crm.userDetails.BASE_CURRENCY;if("0"!=s)for(var l=0;l<r;l++)customViewObject.heading[l].FIELDID==s&&(t=l);for(l=0;l<i;l++){var d=e[l];if(a[d]){var c=a[d].body.length;if(!(c>crmListView.MAX_STAGECARD_CNT)){var u=0,m=0;if(t)for(var p=0;p<c;p++){amtStr=a[d].body[p].CONTENT[t],-1!=amtStr.indexOf("(")&&(amtStr=amtStr.split("(")[1].replace(")","").trim());var f=Territory.getCurrencyObj(amtStr);entityAmt=parseFloat(Territory.formatCurrencytoNum({amtStr:amtStr},f).amtStr),isNaN(entityAmt)||(m+=entityAmt)}if(!((u=c)<0||m<0)){customViewObject.viewSummary[d]||(customViewObject.viewSummary[d]={recordsCount:0,amount:0}),customViewObject.viewSummary[d].recordsCount=u,customViewObject.viewSummary[d].amount=m;var v=$("#stageViewContainer").find("div#"+d);u=u+" "+(1==u?o?moduleRecordMapping[customViewObject.module].singular_label:I18n.getMsg(moduleRecordMapping[customViewObject.module].singular_label):o?moduleRecordMapping[customViewObject.module].plural_label:I18n.getMsg(moduleRecordMapping[customViewObject.module].plural_label)),v.find(".recordsCount").show().text(u),t&&v.find(".amount")[0].component.setData("result",currencyUtils.returnValueInDefaultCurrency(n,m))}}}}},crmListView.loadPredictSummary=function(){var e=new crmRequestPool,t={module:customViewObject.module};t.cvid=customViewObject.cvId,customViewObject.territoryId&&(t.territoryId=customViewObject.territoryId,t.includechild=customViewObject.includeChild?1:0),t.crmcsrfparam=csrfToken,crmListView.getFilterParams(t),crmListView.getAdvSearchCrtFromCVObject(t),e.initiate({action:Crm.getCrmBasePath()+"/ViewSummaryAction.do?action=predictSummary",data:t,type:"POST",success:function(e){var t=["Lose","Ten_Days","This_Month"];customViewObject.viewSummary||(customViewObject.viewSummary={});for(var i=t.length,a=0;a<i;a++){var s=t[a];e[s]?customViewObject.viewSummary[s]=e[s]:delete customViewObject.viewSummary[s]}crmListView.updateStageSummary()}})},crmListView.loadStageSummary=function(e,t,i){var a=new crmRequestPool,s={module:customViewObject.module,cvid:customViewObject.cvId};e&&(s.stageIds=e),t&&"0"!=t&&(s.layoutId=t),customViewObject.pipeline&&(s.pipeline=customViewObject.pipeline),s.searchLetter=customViewObject.searchletter,customViewObject.territoryId&&(s.territoryId=customViewObject.territoryId,s.includechild=customViewObject.includeChild?1:0),i&&(s.refresh=!0),crmListView.getFilterParams(s),crmListView.getAdvSearchCrtFromCVObject(s),s.crmcsrfparam=csrfToken,a.initiate({action:Crm.getCrmBasePath()+"/ViewSummaryAction.do?action=summary",data:s,type:"POST",success:function(t){if(e){customViewObject.viewSummary||(customViewObject.viewSummary={});for(var i=e.split(","),a=i.length,s=0;s<a;s++){var r=i[s];t[r]?customViewObject.viewSummary[r]=t[r]:delete customViewObject.viewSummary[r]}}else customViewObject.viewSummary=t;crmListView.updateStageSummary()}})},crmListView.showActivityCreateOptions=function(e,t,i){if(0===$("#stageView_create_act").length){var a='<div id="stageView_create_act" class="eventActionsMenu nwrp" style="z-index:20;display:none;" onclick="sE(event)" data-options="ACTIVITYPERSONALITY">\t\t\t<a class="dummyForLeftPanel createlink" id ="TaskPopupKanban" href="javascript:void(0);"  onclick="Q.selectAction(\'NewTask\', undefined,\''+customViewObject.module+"' ,'', 'listview',undefined, undefined, this, event);\">"+I18n.getMsg("crm.label.newTask")+'</a>\t\t\t<a class="dummyForLeftPanel createlink" href="javascript:void(0);" onclick="Q.selectAction(\'NewEvent\', undefined,\''+customViewObject.module+"' ,'', 'stageView',undefined, undefined, this, event);\">"+I18n.getMsg("crm.label.newEvent",[Events.getModuleName(!0,!0,!0)])+"</a>";a=isNewCallView?a+'<a class="dummyForLeftPanel createlink" href="javascript:void(0);" data-zcqa="Detail_createcall" onclick="Q.selectAction(\'NewCall\', undefined,\''+customViewObject.module+"' ,'', 'stageView',undefined, undefined, this, event);\">"+I18n.getMsg("crm.label.newCall")+"</a>":a+'<a class="dummyForLeftPanel createlink" href="javascript:void(0);" data-zcqa="Detail_createcall" onclick="Q.selectAction(\'NewCall\', undefined,\''+customViewObject.module+"' ,'', 'listview',undefined, undefined, this, event);\">"+I18n.getMsg("crm.label.newCall")+"</a>",i&&(a=a+'<a class="dummyForLeftPanel createlink" href="javascript:void(0);" data-zcqa="Detail_createApppointment" onclick="Events.globalCreate(\'Appointments\',\'listview\', this);">'+I18n.getMsg("crm.label.newEvent",[moduleRecordMapping.Appointments.singular_label])+"</a>"),a+="</div>",$("#show").append(a)}var s={id:"stageView_create_act",clickSelector:"a",hideOnMenuClick:!1,fitInWindow:!0};if(Crm.menu.createMenu(event,s),Crm.userDetails.TaskPopup){var r="crmRelatedList.relTaskCreate(this,'"+t+"','"+customViewObject.module+"','"+customViewObject.module+"');";$("#TaskPopupKanban").attr("onclick",r)}$("#stageView_create_act").find("a").attr("data-relid",t);$(e).offset();$(".stageview-data-container li").removeClass("liclicked"),$("#detailView_"+t).addClass("liclicked"),$("#stageView_create_act").addClass("act-menu-opened"),$("#tooltip-zc").hide()},crmListView.refreshStageBoards=function(e){var t=new crmRequestPool,i={module:customViewObject.module,stageId:e,fetchOnlyBody:"true",cvid:customViewObject.cvId};crmListView.getFilterParams(i),crmListView.getAdvSearchCrtFromCVObject(i),t.initiate({action:Crm.getCrmBasePath()+"/ShowSelectedCustomView.do?",data:i,type:"POST",success:function(t){$("#values_"+e).replaceWith(Handlebars.templates.stageCard(t.stageBoardDetails[e])),crmListView.setWHforStageView(),crmListView.bindScrollToStageBoards(),crmListView.loadStageSummary(e),crmListView.updateStageCardsInCache(e,t.stageBoardDetails[e],t.module,!0,!1),crmNavig.parseCurrentListView()}})},crmListView.updateStageCardsInCache=function(e,t,i,a,s){var r,o=crmTab.getFromCache(i);if((r=s?o.predictData[e]:o.stageBoardDetails[e])&&r.body){var n=r.body.length;if(a)r=t;else{var l=r.body;l.splice(n-1,1),l.push.apply(l,t.body),r.toIndex=t.body.length<crmListView.MAX_STAGECARD_CNT+1?l.length:l.length-1}crmTab.putInCache(i,o)}},Handlebars.registerHelper("addNoWrap",(function(e,t){return 33==e[t].UITYPE?"nowrap":""})),Handlebars.registerHelper("containsRelatedInfo",(function(e,t,i){if("object"==typeof e&&e.MODULE&&"Accounts"===e.MODULE)for(var a=0;a<t.length;a++){var s=t[a];if("object"==typeof s&&s.MODULE&&"Contacts"===s.MODULE)return i.fn(this)}return i.inverse(this)})),Handlebars.registerHelper("isCompactView",(function(e){return Crm.userDetails.CUSTOMIZE_INFO&&Crm.userDetails.CUSTOMIZE_INFO.viewType?e.fn(this):e.inverse(this)})),Handlebars.registerHelper("getClassNameForStageView",(function(e,t){var i,a="";if(customViewObject&&(i=(a=customViewObject.heading)[t].UITYPE),301==i&&"false"==e)return"dN";var s="";return 0==t?s+="sv-box-heading crm-font-bold f15":200==a[t].UITYPE||786==a[t].UITYPE||14==a[t].UITYPE||24==a[t].UITYPE||202==a[t].UITYPE||333==a[t].UITYPE||116==a[t].UITYPE&&"datetime"==a[t].RETURNTYPE?s+="sv_date f14":36==a[t].UITYPE||77==a[t].UITYPE||143==a[t].UITYPE||144==a[t].UITYPE||145==a[t].UITYPE?customViewObject&&customViewObject.isStageView?a[t].FIELDID==customViewObject.summarizeById?s+="sv_AMOUNT f14":s+="sv-box-normal f14":s+="sv_AMOUNT f14":customViewObject&&customViewObject.isStageView&&a[t].FIELDID==customViewObject.summarizeById?s+="sv_AMOUNT f14":s+="sv-box-normal f14",s})),crmListView.showHideFilters=function(e){clearTimeout(crmListView.filterTimeout);var t=!$(e).find("span").hasClass("fCollapseIn");$("#lv_left_filter").toggle("fast"),$(e).toggleClass("cvFilters_show","fast"),(customViewObject.isStageView||customViewObject.isPredictView?$("#lv_stageview"):$("#lv_table_holder")).toggleClass("cvFilters_show","fast","",(function(){customViewObject.isStageView?(crmListView.setWHforStageView(),crmLayout.Resize.All()):crmListView.createTableHeader(),$(e).find("span").toggleClass("fCollapseIn"),$(e).find("span").toggleClass("fCollapseOut"),renderingUtils.tableSorter("listViewTable","2","")}));var i=customViewObject.module;customViewObject.displayFilters=t,crmListView.filterTimeout=setTimeout((function(){crmListView.updateFilterStatus(i,t),crmListView.filterTimeout=void 0}),3e3)},crmListView.updateFilterStatus=function(e,t){if(e&&void 0!==t){var i={module:e,filterStatus:t,action:"setFilterStatus"};i[csrfParamName]=encodeURIComponent(csrfToken),(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/CustomView.do",data:i,type:"POST",success:function(e){}})}},crmListView.checkForNoneStage=function(e,t){var i=e.stageBoards,a=i.length,s=i[a-1];if("0"===s&&((s={}).DISPLAYLABEL=s.label=I18n.getMsg("crm.label.unmapped.stages"),s.id="0",s.selected=!0,s.presence=!1,i[a-1]=s),t)for(var r=0;r<a;r++){var o=i[r],n=o.id,l=e.stageBoardDetails[n];probability="0",o.probability&&(probability=o.probability),(!1===o.presence||"-None-"===o.label&&"0"===probability)&&l&&0===l.body.length?(o.selected&&e.stageSize--,$("#"+n+":visible").length&&$("#"+n).hide(),i.splice(r,1),delete e.stageBoardDetails[n],r--,a--):"-None-"===o.label&&"0"===o.probability&&(o.presence=!1)}},crmListView.popup=function(e,t){if(e){var i=Handlebars.templates.kanbanViewSettings(t);$("#topBandPopup").html(i),crmListView.makeFullNameMandatory(),showAnimatePopup("topBandPopup",renderingUtils.sectionSorting())}else{var a=new crmRequestPool,s={module:customViewObject.module,action:"editKanbanViewSetup"};a.initiate({action:Crm.getCrmBasePath()+"/CustomView.do",data:s,type:"POST",success:function(e){var t=Handlebars.templates.kanbanViewSettings(e);$("#topBandPopup").html(t),crmListView.makeFullNameMandatory(),showAnimatePopup("topBandPopup",renderingUtils.sectionSorting())}})}},crmListView.makeFullNameMandatory=function(){var e=$("#kanbanSettingsColumn_Full_Name");if(e.length&&(crmModuleConstants.Leads===customViewObject.module||crmModuleConstants.Contacts===customViewObject.module)){var t=document.createElement("sup"),i=$(t);i.attr({class:"red mL3 top8"}),i.html("*"),e.append(t)}},crmListView.showtt=function(e,t){zctt.showtt($ESAPI.encoder().encodeForHTML(customViewObject.heading[t].FIELDLABEL))},crmListView.showttNew=function(e,t){newshowtt($ESAPI.encoder().encodeForHTML(customViewObject.heading[t].FIELDLABEL))},crmListView.moveToSelectedList=function(e,t,i){selectedColumnsLength=$("#selectedColumns li").length,25==selectedColumnsLength||selectedColumnsLength>25?(crmui.showMsgBand("error",I18n.getMsg("crm.info.kanbanview.selectfieldslimit"),4e3),$("#KanbanViewPopup").find("#availableList").addClass("disable-all-list")):("dbClick"==e&&commonUtils.moveToListOnDoubleClick(t,void 0),"addButton"==e&&commonUtils.moveToSelectedList(i,void 0))},crmListView.moveToAvailableList=function(e){selectedColumnsLength=$("#selectedColumns li").length,25==selectedColumnsLength&&$("#KanbanViewPopup").find("#availableList").removeClass("disable-all-list"),commonUtils.moveToList(e,void 0)},crmListView.setStageFilters=function(){var e=$("#sv_sel_stagelist input:checked"),t=CustomView.getFavoriteCVIDsAsString(e),i=CustomView.getFavoriteCVIDsAsString($('#sv_sel_stagelist input[data-selected="true"]:not(:checked)')),a={module:customViewObject.module,action:"setStageFilters",stageIds:t};i&&(a.removedStageIds=i),a[csrfParamName]=encodeURIComponent(csrfToken),(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/CustomView.do",data:a,type:"POST",success:function(e){hideMenu();var t=CustomView.getFavoriteCVIDsAsString($('#sv_sel_stagelist input[data-selected!="true"]:checked'));crmListView.updateStagesInView(customViewObject,t,i),crmListView.loadStageSummary(t)}})},crmListView.updateStagesInView=function(e,t,i){var a=(e=customViewObject).stageBoards,s=a.length;t=t?t.split(","):[];for(var r=(i=i?i.split(","):[]).length,o=t.length,n=0;n<s;n++){var l=a[n],d=l.id;if(i.contains(d)?(delete l.selected,delete e.stageBoardDetails[d],$("#"+d).hide(),e.stageSize--,r--):t.contains(d)&&(l.selected=!0,$("#"+d).show(),o--),0===r&&0===o)break}$("#sv_stage_inner_parent").trigger("scroll")},crmListView.searchFilters=function(e,t){if($("#lv_filters_loadMore").click(),$("#lv_filter_search_clear").show(),showMacroSuggest(e,t,"lv_left_filter",".filterLabel","lv_filter_noMatch","","","300px","",void 0,"false",!0,".filterContainBox"),customViewObject.isVTAdvFilterAvailable){var i=$("#vtMoreSpan"),a=$("#vtHeadDiv"),s=$("#vtFieldOuterDiv"),r=s.find(".vt-filter-sep");s.length&&s.css("display",""),""!=e.value?i.length&&i.is(":visible")&&i.css("display","none"):i.length?(i.css("display",""),crmListView.setVTDivHt()):(r.css("display",""),$("#vtFieldDiv").css({height:""}).removeClass("oH")),$("#vtFieldOuterDiv").find(".vtColumn:visible").length?(""==e.value&&i.length&&(i.css("display",""),r.css("display","none")),a.css("display",""),i.length&&"none"!==i.css("display")||(r.css("display",""),$("#vtFieldDiv").css({height:""}).removeClass("oH"))):(a.length&&a.is(":visible")&&a.css("display","none"),r.length&&r.is(":visible")&&r.css("display","none"),$("#vtFieldOuterDiv").find("input:checkbox:checked").length||s.css("display","none"))}},crmListView.arrangeTagActivityFilters=function(){var e=$("#lv_left_filter").find("input#searchtag1");if(customViewObject.isActivitiesView){(f=e.closest("div.filterContainBox")).parent("div").append('<div class="oneFacet filterContainBox" id="ActivityTag"><div class="facetContainer"> <div class="head fk-uppercase"><div class="facet-title pR"><h2 class="unit fk-font-15"><span><label class="fL" ><input type="checkbox" data-name="" data-zcqa="filter_ActivitiesTag" id="filter_activityTag" data-params="{&quot;searchfieldtype&quot;:&quot;ActivityTag&quot;,&quot;searchModule&quot;:&quot;Activities&quot;}" onchange="crmListView.showHideSelectedFilter(this,\'ActivityTag\');" class=" newcheckboxfilternew" data-subfilters="true" data-value="CrmActivity:ActivityTag"><span class="mL2 vam cP filterLabel crm-font-semibold f13" title="Subject">'+I18n.getMsg("crm.label.tag")+'</span></label></span>  </h2><div id="activityRelTo" style="display:none;color:#111;position:relative;top:26px;margin-bottom:26px;left:-18px;font-size:12.5px;font-weight:bold">'+I18n.getMsg("crm.label.tag.related.to")+'</div></div></div><ul id="sub_filter_activityTag" style="padding: 0;margin: 2px 0px 1px 20px"></ul></div></div>');for(var t=void 0,i=$("ul#sub_filter_activityTag"),a=f.length,s=0;s<a;s++){var r=$("<li></li>",{html:$(f[s]).html()}).appendTo(i);r.css("padding","0px 0px 0px 7px");var o=(e=r.find('input[type="checkbox"]')).attr("id").split("_")[1],n=e.parent("label");e.attr("type","radio"),e.removeClass("newcheckboxfilternew"),n.addClass("rbCheckHtml");var l=e.data("value"),d=r.find("ul.facets").find("select#searchtag1_"+o);if(null!=d&&d.length>0){t=r.find("div.facetContainer"),customViewObject.tagFilterValue=$("input[name=searchtag1_"+o+"]").val();var c=t.find("ul#sub_filter_"+o);null!=customViewObject.tagFilterValue&&""!=customViewObject.tagFilterValue&&(c.removeClass("dN"),customViewObject.shownTagFilter="sub_filter_"+o),c.css("height","75px")}if(l){var u=n.find("span");-1!=l.indexOf("CrmCall")&&u.removeClass("filterLabel").text(I18n.getMsg("Calls")),-1!=l.indexOf("CrmEvent")&&u.removeClass("filterLabel").text(I18n.getMsg(Crm.getModuleDisplayName(!1,!0,!0))),-1!=l.indexOf("CrmTask")&&u.removeClass("filterLabel").text(I18n.getMsg("Tasks"))}var m=$("<span></span>",{class:"rbHtml dIB pR"}).insertAfter(e);$("<span></span>",{class:"rbTickHtml pA"}).appendTo(m),$(f[s]).remove()}null==t?$("#ActivityTag").find("input#searchtag1").closest("div.facetContainer").hide():($("#ActivityTag").find('input[type="checkbox"]').prop("checked",!0),t.find('input[type="radio"]').trigger("click"),t.show()),$("#manageTagOp").remove()}else if(customViewObject.isCallsView||customViewObject.isEventsView||customViewObject.isTasksView){var p=e.closest("div.facetContainer").hide();for(a=p.length,s=0;s<a;s++){var f;(l=(f=$(p[s])).find('input[type="checkbox"]').data("value"))&&(customViewObject.isCallsView&&-1!=l.indexOf("CrmCall")&&(f.find("label span").text(I18n.getMsg("crm.label.tag")),f.show()),customViewObject.isEventsView&&-1!=l.indexOf("CrmEvent")&&(f.find("label span").text(I18n.getMsg("crm.label.tag")),f.show()),customViewObject.isTasksView&&-1!=l.indexOf("CrmTask")&&(f.find("label span").text(I18n.getMsg("crm.label.tag")),f.show()))}}else e.closest("div.facetContainer").hide(),$("#manageTagOp").remove()},crmListView.showTags=function(e){var t=$(e);t.closest("li").hide(),t.closest("ul").find("li.tagElementList").removeClass("hiddenTag")},crmListView.showAddRemoveOptions=function(e,t){hideMenu(t);var i=$(e),a=i.offset();Crm.menu.menusInDisplay.tagOperList=!0;var s=$("#tagOperList"),r=a.top+i.outerHeight();(!s||!s.length>0)&&(s=crmListView.getConstructedTagDialogueBox());var o=s.find("#listview_remove_tags_li");crmListView.bindOrunbindTagEvents(o,!1);var n=crmListView.getTagOptions(customViewObject.module);(!n||null!=n&&0==n.length)&&crmListView.bindOrunbindTagEvents(o,!0),s.show(100),s.css("top",r),s.css("left",a.left),s.find("ul li").on("mouseover",(function(){$(this).css("background-color","#f8f8f8")})),s.find("ul li").on("mouseout",(function(){$(this).css("background-color","white")}))},crmListView.getConstructedTagDialogueBox=function(){var e=$("#tagPopups");e||(e=CrmTags.renderTagUtilityDiv());var t=$("<div></div>",{class:"ddM",id:"tagOperList"});t.attr("style","display:none;background-color:white;position:absolute;z-index:15 !important;"),t.appendTo(e);var i=$("<ul></ul");i.appendTo(t);var a=$("<li></li>",{style:"background-color: rgb(255, 255, 255);",onclick:"crmListView.showTagOpPopup(this,'add')",class:""}),s=$("<a></a>",{text:I18n.getMsg("crm.label.add.tags")});s.appendTo(a),a.appendTo(i);var r=$("<li></li>",{id:"listview_remove_tags_li",style:"background-color: rgb(255, 255, 255);",onclick:"crmListView.showTagOpPopup(this,'remove')",class:""});return(s=$("<a></a>",{text:I18n.getMsg("crm.label.remove.tags")})).appendTo(r),r.appendTo(i),t},crmListView.bindOrunbindTagEvents=function(e,t){t?(e.addClass("disabled"),e.on("mouseover",(function(){crmui.showTooltip(I18n.getMsg("crm.tags.listview.remove.onhover.no.tags.avail"),!1,"center",$(this))})).on("mouseout",(function(){crmui.hideTooltip()})).attr("onclick","sE(event)")):(e.removeClass("disabled"),e.attr("onclick","crmListView.showTagOpPopup(this,'remove')"),e.off("mouseover").off("mouseout"))},crmListView.getTagOptions=function(e){return"Activities"===e||Crm.isActivitySplitDone&&("Calls"===e||"Events"===e||"Tasks"===e)?(customViewObject.isCallsView?e="Calls":customViewObject.isEventsView?e="Events":customViewObject.isTasksView&&(e="Tasks"),options=Crm.jsonSelectValues.Tags[e]):options=Crm.jsonSelectValues[e].TAGMODULEREFID,options},crmListView.showTagOpPopup=function(e,t){if(t&&"add"===t||"remove"==t){var i=Crm.userDetails.RTL_ENABLED?"rtl":"ltr",a=customViewObject.module,s=[],r="add"==t?"addTagsDiv":"removeTagsDiv",o=$("#"+r),n="add"==t?"addTagsSel":"removeTagsSel";"add"==t?(CrmTags.clientJSON={},CrmTags.clientJSON.names=[],CrmTags.clientJSON.newlyAdded=[],CrmTags.clientJSON.selectedIds=[],CrmTags.clientJSON.existingNames=[],CrmTags.clientJSON.existingtags={},CrmTags.clientJSON.existingNameVsIdMap={},$("#addTagsDiv #addTagButton").removeClass("disable eventNone"),Crm.trackSpotLightAction("Tagging - List View Add Tags Click",{Module:a})):(CrmTags.clientJSON={},CrmTags.clientJSON.existingtags={},CrmTags.clientJSON.existingNameVsIdMap={},CrmTags.clientJSON.existingNames=[],$("#removeTagsDiv #removeTagButton").removeClass("disable eventNone"),Crm.trackSpotLightAction("Tagging - List View Remove Tags Click",{Module:a})),a&&""!=a&&(s=crmListView.getTagOptions(a),$("#selectModule").remove(),$("<input>",{type:"hidden",value:a,id:"selectModule"}).appendTo("#"+r));var l=CrmTags.unbindSelectEvent(n);if(s&&s.length>0)for(var d=s.length,c={},u=null,m=0;m<d;m++)c=s[m],"add"==t&&CrmTags.clientJSON.names.push(c.name.toLowerCase()),u=c.id,CrmTags.clientJSON.existingtags[u]=c.name,CrmTags.clientJSON.existingNames.push(c.name),CrmTags.clientJSON.existingNameVsIdMap[c.name.toLowerCase()]=u,$("<option></option>",{value:c.name,text:c.name,id:"tagOption_"+u}).appendTo(l);if(t&&"add"==t)l.select2({dir:i,tags:!0,placeholder:I18n.getMsg("crm.label.listView.add.tags.info"),tokenSeparators:[","],closeOnSelect:!1,createTag:function(e){var t=$(".select2-results__options");t.show();var i=$.trim(e.term);return""===i?null:(i&&(i=i.substr(0,25),l.find("input.select2-search__field").val(i)),","===i?(l.find("input.select2-search__field").val("").focus(),t.hide(),null):CrmTags.checkExistingNames(i,!1,!1,!0)?{id:i,text:$ESAPI.encoder().encodeForHTML(i),tagName:i,newTag:!0}:(t.find("span.f11").hide(),null))},templateResult:function(e){return e.newTag?"<span class='color2 mR5 f11 proxmial'>"+I18n.getMsg("crm.label.tag.new")+"</span><span id='select2NewTagSpan'>"+e.text+"</span>":(e.tagName=e.text,$ESAPI.encoder().encodeForHTML(e.text))},escapeMarkup:function(e){return e}}).on("select2:select",(function(e){e.params.data.newTag&&!CrmTags.clientJSON.newlyAdded.contains(e.params.data.id)?CrmTags.clientJSON.newlyAdded.push(e.params.data.id):e.params.data.newTag||CrmTags.clientJSON.selectedIds.contains(e.params.data.id)||CrmTags.clientJSON.selectedIds.push(e.params.data.id);var t=o.find(".select2-search__field");CrmTags.checkTagEditionAndRecordLimitCount(e.params.data.newTag,"addTagsSel",CrmTags.clientJSON.names.length,!1,!1,!0)&&CrmTags.checkCharacter(e.params.data.tagName)?(CrmTags.clientJSON.inputVal="",t.val("").focus()):(CrmTags.clientJSON.inputVal1=CrmTags.clientJSON.inputVal,o.find('li.select2-selection__choice[title="'+e.params.data.text+'"]').find("span").trigger("click"),CrmTags.clientJSON.inputVal=CrmTags.clientJSON.inputVal1,e.params.data.newTag&&setTimeout((function(){t.val(CrmTags.clientJSON.inputVal)}),0),t.focus()),CrmTags.focusOutEvent(null,f),l.select2("close"),l.select2("open")})).on("select2:unselect",(function(e){CrmTags.clientJSON.inputVal="",CrmTags.clientJSON.newlyAdded.contains(e.params.data.tagName)?CrmTags.clientJSON.newlyAdded.splice(CrmTags.clientJSON.newlyAdded.indexOf(e.params.data.tagName),1):CrmTags.clientJSON.selectedIds.contains(e.params.data.id)&&CrmTags.clientJSON.selectedIds.splice(CrmTags.clientJSON.selectedIds.indexOf(e.params.data.id),1)}));else{thirdPartyUtils.bindSelect2("#"+n,{no_results_text:I18n.getMsg("crm.no.tag.present"),placeholder_text_multiple:I18n.getMsg("crm.label.listView.add.tags.info")});var p=$("#"+n);p.on("select2:select",(function(e){var t=0;null!=p.val()&&(t=p.val().length),t>10&&(crmui.showMsgBand("warning",I18n.getMsg("crm.tags.remove.limit.reached"),3e3,""),$("#removeTagsDiv").find('li.select2-selection__choice[title="'+e.params.data.text+'"]').find("span").trigger("click"))}))}var f=$("#addTagsDiv .select2-search__field");f.css("width","200%"),f.attr("maxlength",25),f.addClass("mL5"),f.attr("onfocusout","CrmTags.focusOutEvent(event,this)"),f.attr("onkeyup","CrmTags.onkeyupevent('"+r+"')"),f.focusin((function(){CrmTags.clientJSON.inputVal=""})),"add"==t&&f.attr("onkeydown","CrmTags.checkTagInputVal(event,'"+r+"',false)"),$(e).parent().parent().hide(),crmui.showPop(r),f.focus()}},crmListView.handleTagOpEvent=function(e,t){var i="add"==t?"addTagsDiv":"removeTagsDiv",a="add"==t?"#addTagsSel":"#removeTagsSel";switch(e){case"cancel":crmui.hidePopup(i),$(a).html(""),thirdPartyUtils.unbindChildSelect2($("#"+i)),"add"==t&&$("#addTagsDiv").find('input[name="overWriteRecords"]').prop("checked",!1),delete CrmTags.clientJSON;break;case"save":var s=$(a).val();if("add"!=t){if(!s||s&&0==s.length)return void renderingUtils.showCustomAlert(I18n.getMsg("crm.no.tag.selected"),I18n.getMsg("crm.label.small.tags"),!1);$("#removeTagsDiv #removeTagButton").addClass("disable eventNone")}if("add"==t){if(!CrmTags.checkAndPopulateNewlyAdded("addTagsDiv"))return!1;if(0==CrmTags.clientJSON.selectedIds.length&&0==CrmTags.clientJSON.newlyAdded.length)return void renderingUtils.showCustomAlert(I18n.getMsg("crm.no.tag.selected"),"",!1);$("#addTagsDiv #addTagButton").addClass("disable eventNone")}var r=customViewObject.selectedIds,o="add"==t?0:2,n=[],l=[],d=0,c=$("#addTagsDiv");if(t&&"remove"!=t&&c.find('input[name="overWriteRecords"]').is(":checked")&&(o=1,c.find('input[name="overWriteRecords"]').prop("checked",!1)),s&&"add"!=t){d=s.length;for(var u=0;u<d;u++)n.push(s[u])}if(s&&"add"==t&&CrmTags.clientJSON.selectedIds){d=CrmTags.clientJSON.selectedIds.length;for(var m=0;m<d;m++)n.push(CrmTags.clientJSON.selectedIds[m])}if("add"==t&&CrmTags.clientJSON.newlyAdded){d=CrmTags.clientJSON.newlyAdded.length;for(m=0;m<d;m++)l.push(CrmTags.clientJSON.newlyAdded[m])}var p=$("#selectModule").val();if("Activities"===p&&(customViewObject.isCallsView?p="Calls":customViewObject.isEventsView?p="Events":customViewObject.isTasksView&&(p="Tasks")),"add"==t&&null!=l&&l.length>0){var f=[],v={};d=l.length;for(m=0;m<d;m++)null!=l[m]&&l[m].length>0&&((v={}).name=l[m],f.push(v));var g={};g.tags=f;JSON.stringify(g);var h={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};(new crmRequestPool).initiate({action:"/crm/v2/settings/tags?module="+moduleRecordMapping[p].api_name+"&fromPage=view",type:"post",data:JSON.stringify(g),headers:h,async:!1,success:function(e){var s=e.tags;CrmTags.validateSymbol(e);var l=[];if(l="Calls"==p||"Events"==p||"Tasks"==p?Crm.jsonSelectValues.Tags[p]:Crm.jsonSelectValues[p].TAGMODULEREFID,s&&s.length>0){d=s.length;for(var c=0;c<d;c++){var u=s[c].details;if(u.name){var m={};m.id=u.modRefId,m.name=u.name,l.push(m),n.push(u.name),CrmTags.clientJSON.existingNames.push(u.name),CrmTags.clientJSON.names.push(u.name.toLowerCase()),CrmTags.clientJSON.existingtags[u.modRefId]=u.name}}"Activities"===p?(customViewObject.isCallsView?p="Calls":customViewObject.isEventsView?p="Events":customViewObject.isTasksView&&(p="Tasks"),Crm.jsonSelectValues.Tags[p]=l,crmListView.getObject().modulePicklistValues&&crmListView.getObject().modulePicklistValues.Tags&&(crmListView.getObject().modulePicklistValues.Tags[p]=l)):(Crm.jsonSelectValues[p].TAGMODULEREFID=l,crmListView.getObject().modulePicklistValues&&crmListView.getObject().modulePicklistValues[p]&&(crmListView.getObject().modulePicklistValues[p].TAGMODULEREFID=l)),Crm.trackSpotLightAction("Tagging - List View Tags Create",{Module:p,Count:d})}crmListView.processTagOperation(n,o,p,r,a,t,i)},error:function(){crmListView.processTagOperation(n,o,p,r,a,t,i)}})}else crmListView.processTagOperation(n,o,p,r,a,t,i);break;default:return crmui.hidePopup(i),void delete CrmTags.clientJSON}},crmListView.processTagOperation=function(e,t,i,a,s,r,o){isWFExecuted=!1;var n=CrmTags.getCommaSeparatedValue(a),l="",d=0;if(e.length>=1){var c=CrmTags.clientJSON.existingNames;d=e.length;for(var u=0;u<d;u++)c.contains(e[u])&&(l+=e[u]+",");l=l.substring(0,l.length-1)}var m="add_tags";2==t?(m="remove_tags",Crm.trackSpotLightAction("Tagging - List View Remove Tags Save",{Module:i,Count:e.length})):Crm.trackSpotLightAction("Tagging - List View Add Tags Save",{Module:i,Count:e.length,"Over write":1==t}),customViewObject.isCallsView?i="Calls":customViewObject.isEventsView?i="Events":customViewObject.isTasksView&&(i="Tasks");var p=new crmRequestPool,f="/crm/v2/"+moduleRecordMapping[i].api_name+"/actions/"+m,v={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken},g={};g.ids=n,g.tag_names=l,1==t?g.over_write=!0:0==t&&(g.over_write=!1),p.initiate({action:f,type:"post",data:g,headers:v,success:function(e){if(!isWFSchedulerUser()||!e.isWFScheduler){var t=e;if(t&&t.data&&t.data.length>0){var i="add"==r?I18n.getMsg("crm.tags.list.view.added.successfully"):I18n.getMsg("crm.tags.removed.successfully"),n=!1;n="add"==r&&t.success_count?crmListView.addTagsPopupMsg(t.success_count,a.length,customViewObject.tagRecordLimit,t.locked_count):crmListView.addTagsPopupMsgFrOverWrite(t.locked_count,a.length,"add"==r);var l=crmTab.getFromCache(customViewObject.module),d={module:$("#selectModule").val(),fromIndex:customViewObject.fromIndex,toIndex:customViewObject.toIndex,currentOption:customViewObject.currentOption,fetchOnlyBody:"true",cvid:customViewObject.cvId};crmListView.getFilterParams(d),(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/ShowDetails.do?",data:d,type:"GET",success:function(e){if(1!=e.isStageView){if(e.body&&0!=e.body.length){for(var t=[],a=e.fromIndex-1,r=0;a<=e.toIndex;a++,r++)e.body[r]?t[a]=e.body[r]:t[a]=null;e.body=t}l.body=e.body}else l.stageBoardDetails=e.stageBoardDetails,l.stageBoards=e.stageBoards;(l.heading=e.heading,l.fromIndex=e.fromIndex,l.toIndex=e.toIndex,l.sortColumnString="",l.selectedIds=[],delete l.columns,customViewObject=l,crmTab.putInCache(l.module,l),thirdPartyUtils.unbindChildSelect2($("#"+o)),$(s).html(""),l.isCustomizedView)?($("#lvTred").html(Handlebars.templates.body(l)),new listViewHandler(l).renderListView()):1!=l.isStageView?($(".fixedrowTd").html(Handlebars.templates.fixedColumnlistview(l)),$("#listviewHeaderRow").parent().html(Handlebars.templates.heading(l)),$(".fixedheadercolumn #checkAll, .stageview-heading-container #checkAll").addClass("customCheckBox").removeClass("customCheckBoxChecked"),$("#lvTred").html(Handlebars.templates.body(l)),renderingUtils.tableSorter("listViewTable","2",""),$("#listviewtablescroll").removeClass("oH")):($("#lv_stageview").html(Handlebars.templates.stageView(l)),crmListView.afterRenderStageView(l));crmListView.checkAll(),showHideListViewBtnFn(),crmui.hidePopup(o),n?crmui.showPop("maximumReach"):crmui.showMsgBand("success",i,3e3,"")}})}else t&&"FAILURE"==t.code&&"permission denied to  update records"==t.message?(crmui.hidePopup(o),crmui.showMsgBand("warning",I18n.getMsg("crm.tags.add.tags.per.den.all.record"),2e3,"")):(crmui.hidePopup(o),crmui.showMsgBand("info",I18n.getMsg("crm.tags.add.unsuccessful"),2e3,""));delete CrmTags.clientJSON}},error:function(e){var t=e.responseJSON;t&&-1!=t.message.indexOf("permission denied to  update records")?renderingUtils.displayPermissionDenied(e):t&&-1!=t.message.indexOf("Tag edition limit exceeded")?($(s).html(""),thirdPartyUtils.unbindChildSelect2($("#"+o)),crmui.hidePopup(o),crmui.showMsgBand("error",I18n.getMsg("crm.tag.edition.limit.exceeded"),1e3,"")):t&&-1!=t.message.indexOf("Tags record limit exceeded")?crmui.showMsgBand("error",I18n.getMsg("crm.tags.records.limit.reached",customViewObject.tagRecordLimit),1e3,""):($(s).html(""),crmui.hidePopup(o),crmui.showMsgBand("info",I18n.getMsg("crm.tags.add.unsuccessful"),1e3,"")),delete CrmTags.clientJSON}})},crmListView.addTagsPopupMsg=function(e,t,i,a){var s=!1,r=parseInt(e),o=null!=a&&null!=a?parseInt(a):0,n=$("#maximumReach");return 0==r&&0==o?(n.find("#firstMsg").text(""),t>1?n.find("#secondMsg").text(I18n.getMsg("crm.tags.list.view.all.records.limit.reached",[i])):n.find("#secondMsg").text(I18n.getMsg("crm.tags.list.view.single.record.limit.reached",[i])),s=!0):0==r&&o>0?(n.find("#firstMsg").text(""),t>1?o==t?n.find("#secondMsg").text(I18n.getMsg("crm.tags.list.view.all.record.locked")):n.find("#secondMsg").html(I18n.getMsg("crm.tags.list.view.some.record.not.updated",[t-o])+"<br>"+I18n.getMsg("crm.tags.list.view.some.record.locked",[o])):n.find("#secondMsg").text(I18n.getMsg("crm.tags.list.view.single.record.locked")),s=!0):r<t&&0==o?(t>1?n.find("#firstMsg").text(I18n.getMsg("crm.tags.record.limit.reached.server.side.msg1",r)):n.find("#firstMsg").text(""),n.find("#secondMsg").text(I18n.getMsg("crm.tags.record.limit.reached.server.side.msg2",[t-parseInt(r),i])),s=!0):r<t&&o>0&&(t>1?n.find("#firstMsg").text(I18n.getMsg("crm.tags.record.limit.reached.server.side.msg1",r)):n.find("#firstMsg").text(""),0==o?n.find("#secondMsg").text(I18n.getMsg("crm.tags.record.limit.reached.server.side.msg2",[t-r,i])):n.find("#secondMsg").html(I18n.getMsg("crm.tags.record.limit.reached.server.side.msg3",[t-r-o,i])+"<br>"+I18n.getMsg("crm.tags.list.view.some.records.locked.remaining",[o])),s=!0),s},crmListView.addTagsPopupMsgFrOverWrite=function(e,t,i){var a=parseInt(e);if(a>0){var s=$("#maximumReach");return a==t?(s.find("#firstMsg").text(""),i?t>1?s.find("#secondMsg").text(I18n.getMsg("crm.tags.list.view.all.record.locked")):s.find("#secondMsg").text(I18n.getMsg("crm.tags.list.view.single.record.locked")):t>1?s.find("#secondMsg").text(I18n.getMsg("crm.tags.list.view.all.record.locked.remove")):s.find("#secondMsg").text(I18n.getMsg("crm.tags.list.view.single.record.locked.remove"))):i?(s.find("#firstMsg").text(I18n.getMsg("crm.tags.record.limit.reached.server.side.msg1",[t-a])),s.find("#secondMsg").text(I18n.getMsg("crm.tags.list.view.remaning.records.locked.limit.add",[a]))):(s.find("#firstMsg").text(I18n.getMsg("crm.tags.list.view.records.removed.limit",[t-a])),s.find("#secondMsg").text(I18n.getMsg("crm.tags.list.view.remaning.records.locked.limit.remove",[a]))),!0}return!1},Handlebars.registerHelper("isSubjectField",(function(e,t,i){return"SUBJECT"==t[e].COLUMNNAME?i.fn(this):i.inverse(this)})),Handlebars.registerHelper("isPickListField",(function(e,t,i){return 2===t[e].UITYPE?i.fn(this):i.inverse(this)})),Handlebars.registerHelper("isDueDateField",(function(e,t,i){return"DUEDATE"==t[e].COLUMNNAME?i.fn(this):i.inverse(this)})),crmListView.toggleFilterOptions=function(e,t,a){var s=crmListView.getObject(),r=crmTab.getFiltersFromCache(s.module),o=$("#lv_filter_save");if(null!=r&&null!=r.filters){var n=!1;for(i=0;i<r.filters.length;i++)"Recommendation"==r.filters[i].searchModule?e=!1:"LPRE"===r.filters[i].searchfieldtype||"Prediction"==r.filters[i].searchModule?(n=!0,o.addClass("disabledbtnForPrediction"),o.attr({onmouseenter:"crmui.showTooltip('This action is not supported for prediction.',false,'top',this)",onmouseleave:"crmui.hideTooltip()",onclick:""})):n||(o.removeClass("disabledbtnForPrediction"),o.attr({onmouseenter:"",onmouseleave:"",onclick:"crmListView.showSaveFilterWizard()"}))}if($("#lv_filter_savediv").toggle(e),customViewObject.isPrivacyListView||customViewObject.isCampaignAddMemberListView||$("#lv_filter_submitdiv").toggle(!e),crmListView.bindPerfectScrollbar(),e){a=void 0!==a&&a;var l=$("#lv_filter_savediv");l.find("#lv_filter_save_opt").toggle(a),l.find("#lv_filter_save").toggle(!a);var d=(s=crmListView.getObject()).filterId?s.filterId:$("#lv_saved_filters").find(".f_listclick-view").attr("id");if(a&&d){$("#lv_filter_save_menu").find(".saveTypBtn").eq(1).attr("data-filterId",d);var c=s.module,u=crmTab.getFiltersFromCache(c);u&&u.filterId&&delete u.filterId,delete s.filterId}t?$("#lv_filter_save_menu").find(".saveTypBtn").eq(0).removeClass("disabled"):$("#lv_filter_save_menu").find(".saveTypBtn").eq(0).addClass("disabled")}if(t){$("#lv_filter_submit").prop("disabled",!1);var m=$("#lv_left_filter");m.find("input.checkFilter:checked").length&&m.find("#clearFilterLink").show()}},crmListView.showSaveFilterWizard=function(e,t){if(!$(t).hasClass("disabled")){var i=$("#lv_filter_savePopup"),a=$("#filterName");if($("#displayContent_filterName").remove(),i.find(".form_err_fld").removeClass("form_err_fld"),$(".errMsg").remove(),$(".form_err_msg").remove(),crmui.showPopup("lv_filter_savePopup",!1),e){i.find("#lv_save_msg").text(I18n.getMsg("crm.filter.rename.label"));var s=$(t).attr("data-filterId"),r=$("#"+s).find("span:first");a.val(r.text().trim()).focus(),i.find("#save_filterId").val(s),i.find("form").attr("action",Crm.getCrmBasePath()+"/CustomView.do?action=updateFilterProps"),i.find("form").removeAttr("data-filters")}else i.find("#lv_save_msg").text(I18n.getMsg("crm.email.save.filter")),a.val("").focus(),i.find("#save_filterId").val(""),i.find("form").attr("action",Crm.getCrmBasePath()+"/CustomView.do?action=saveFilters"),i.find("form").attr("data-filters",!0);a.off("focus").on("focus",(function(){$(this).closest("td").addClass("wf_setFocus")}))}},crmListView.checkForDuplicateFilterNames=function(){for(var e=$("#filterName"),t=$("#lv_saved_filters").find("li"),i=t.find(".listText"),a=t.length,s=e.val().toLowerCase().trim(),r=$("#lv_filter_savePopup").find("#save_filterId").val(),o=0;o<a;o++)if(t.eq(o).attr("id")!==r&&i.eq(o).text().toLowerCase().trim()===s)return Crm.showErrorMsg(I18n.getMsg("crm.warning.duplicate.filter.name"),$("#filterName"),void 0,!0),!1;return!0},crmListView.saveFilters=function(e){$(".form_err_fld").removeClass("form_err_fld"),$(".errMsg").remove(),$(".form_err_msg").remove();var t=formData2QueryString(e);return!!(emptyCheck("filterName",I18n.getMsg("crm.email.filter.name"),void 0,void 0,"inline")&&checkSplChars("filterName",I18n.getMsg("crm.email.filter.name"),"inlineCenter")&&crmListView.checkForDuplicateFilterNames())&&($(e).attr("data-filters")&&(t+="&filters="+encodeURIComponent(JSON.stringify(customViewObject.filters))),t+="&"+Territory.csrf(),(new crmRequestPool).initiate({action:e.action,data:t,type:"POST",success:function(e){if(crmui.hidePopup("lv_filter_savePopup"),$("#lv_save_container").show(),e.module=customViewObject.module,e.cvId=customViewObject.cvId,e.displayFilterCount=customViewObject.displayFilterCount,e.route=Lyte.Router.getRouteInstance().transition.info.route,customViewObject.viewid){e.viewid=customViewObject.viewid;var t=crmListView.savedcanvasFiltersTemplate(e)}else t=crmListView.savedFiltersTemplate(e);var i=e.filterId;if($("#"+i).length)$("#"+i).replaceWith(t),crmListView.updateFilterInCache(e),crmui.showMsgBand("success",I18n.getMsg("crm.filter.save.msg",I18n.getMsg("crm.button.cvfilter")),"2000",""),$("#"+i+"_count").html("&nbsp;<b>"+crmTab.countCache[customViewObject.module][i]+"</b>&nbsp;");else{$("#lv_saved_filters").append(t),customViewObject.savedFilters.push(e),crmListView.showHideSavedFilters(!0),customViewObject.filterId=i;var a=crmTab.getFiltersFromCache(customViewObject.module);a&&(a.filterId=i),$(".f_listclick-view").removeClass("f_listclick-view"),crmui.showMsgBand("success",I18n.getMsg("crm.custom.module.complete.alert.title",I18n.getMsg("crm.button.cvfilter")),"2000","")}showTotalCount(void 0,void 0,!1),customViewObject.filterId===i&&($("#"+i).addClass("f_listclick-view"),crmTab.countCache[customViewObject.module]&&(crmTab.countCache[customViewObject.module][i]=crmTab.countCache[customViewObject.module].TotalCount),crmListView.renderFilterCount(crmTab.countCache[customViewObject.module])),crmListView.toggleFilterOptions(!1)},error:function(e){commonUtils.showHideLoadingDiv(),555==e.status&&e.responseText&&alert(e.responseText)}}),!1)},crmListView.updateFilterInCache=function(e){for(var t=e.filterId,i=customViewObject.savedFilters,a=i.length,s=0;s<a;s++){if(i[s].filterId===t){customViewObject.savedFilters[s]=e;break}}},crmListView.showFilterOptions=function(e,t,i){$("#"+t+"_count").next(".svgIcons").removeClass("dN"),$("#filterOptions").find("a").attr("data-filterId",t);var a={id:"filterOptions",clickSelector:"a"};Crm.menu.createMenu(e,a),renderingUtils.stopEvent(e);var s=$("#renameOpt");i?s.addClass("dN"):s.removeClass("dN")},crmListView.deleteFilter=function(e){var t={module:customViewObject.module,filterId:$("#filterOptions").find("a").attr("data-filterId")};t[csrfParamName]=encodeURIComponent(csrfToken),(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/CustomView.do?action=deleteFilter",data:t,type:"POST",success:function(e){hideAnimatePopup("deletepopup"),$("#"+t.filterId).remove(),crmui.showMsgBand("success",I18n.getMsg("crm.filter.delete.msg"),"2000",""),$("#lv_saved_filters").find("li").length||$("#lv_save_container").hide(),crmListView.removeDeletedFilterFromCache(t.filterId),crmListView.bindPerfectScrollbar()}}),Crm.trackSpotLightAction("Delete Saved Filters",{Module:customViewObject.module})},crmListView.removeDeletedFilterFromCache=function(e){for(var t=customViewObject.savedFilters,i=t.length,a=0;a<i;a++){if(t[a].filterId===e){customViewObject.savedFilters.splice(a,1);break}}var s=customViewObject.module,r=crmTab.getFiltersFromCache(s);crmTab.deleteFromCacheCount(s,e),e===customViewObject.filterId&&(delete customViewObject.filterId,$("#lv_filter_submit").val(I18n.getMsg("crm.button.apply.filter"))),r&&r.filterId===e&&delete r.filterId},crmListView.showHideSavedFilters=function(e){$("#lv_saved_filter_div:visible").length&&!0!==e?$("#lv_saved_filter_div").slideUp(crmListView.bindPerfectScrollbar):$("#lv_saved_filter_div").slideDown(crmListView.bindPerfectScrollbar)},crmListView.cvPrintView=function(e,t,i,a,s,r,o,n){if(Crm.userDetails.permissions["Crm_Implied_Print_View_"+e]){var l=document.title,d=crmListView.createPrintView();mR(Crm.getCrmBasePath()+"/PrintPreviewListView.do?",(function(e){e+=d;var t=window.open("/crm/html/content1.html","Printview","width=700,height=600,menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes");t.document.writeln(e),t.document.close(),t.document.title=l}))}},crmListView.reloadCurrentListView=function(e,t,i){document.getElementsByTagName("crm-list-view")[0];var a=Lyte.Router.getRouteInstance();if(crmTab.deleteFromCache(this.getObject().module),-1!=a.transition.target.indexOf("custom-view")){var s;"Visits"==this.getObject().module&&(s=customViewObject.screenName);var r,o=Object.keys(crmListView.startIndex).sort((function(e,t){return e-t}))[0];if(o=Number(o),!isNaN(o)){var n=Number(crmListView.getObject().currentOption);r=(o+n-1)/n}a.fetchCount=!0,a.getQueryParams().hasOwnProperty("page")&&r&&r!=a.getQueryParams().page?a.setQueryParams("page",r).data={clearCache:!0,portalName:s}:a.refresh({refreshTemplate:!0}).data={refreshTemplate:!0,portalName:s}}},crmListView.mandatoryCheck=function(){var e=!1,t=!1;$("#columnListId li label input").each((function(){var i=$(this).attr("value");i&&-1!=i.indexOf("LASTNAME")&&$(this).is(":checked")&&(e=!0),i&&-1!=i.indexOf("FULLNAME")&&$(this).is(":checked")&&(t=!0)})),e&&t?$("#columnListId li label input").each((function(){var e=$(this).attr("value");-1!=e.indexOf("LASTNAME")&&$(this).prop("disabled",!1),-1!=e.indexOf("FULLNAME")&&$(this).prop("disabled",!1)})):e&&!t?$("#columnListId li label input").each((function(){var e=$(this).attr("value");-1!=e.indexOf("LASTNAME")&&$(this).prop("disabled",!0),-1!=e.indexOf("FULLNAME")&&$(this).prop("disabled",!1)})):!e&&t&&$("#columnListId li label input").each((function(){var e=$(this).attr("value");-1!=e.indexOf("LASTNAME")&&$(this).prop("disabled",!1),-1!=e.indexOf("FULLNAME")&&$(this).prop("disabled",!0)}))},crmListView.relatedMandatoryCheck=function(e){var t=!1,i=!1,a=$("#"+e+" li label input");a.each((function(){var e=$(this).attr("value");-1!=e.indexOf("LASTNAME")&&$(this).is(":checked")&&(t=!0),-1!=e.indexOf("FULLNAME")&&$(this).is(":checked")&&(i=!0)})),t&&i?a.each((function(){var e=$(this).attr("value");-1!=e.indexOf("LASTNAME")&&$(this).prop("disabled",!1),-1!=e.indexOf("FULLNAME")&&$(this).prop("disabled",!1)})):t&&!i?a.each((function(){var e=$(this).attr("value");-1!=e.indexOf("LASTNAME")&&$(this).prop("disabled",!0),-1!=e.indexOf("FULLNAME")&&$(this).prop("disabled",!1)})):!t&&i&&a.each((function(){var e=$(this).attr("value");-1!=e.indexOf("LASTNAME")&&$(this).prop("disabled",!1),-1!=e.indexOf("FULLNAME")&&$(this).prop("disabled",!0)}))},crmListView.createTableHeader=function(){$("#cvlist").length>0&&(void 0!==$("#cvlist").perfectScrollbar&&thirdPartyUtils.bindPerfectScroll("#cvlist",{wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!0}),$("#lv_filter_scroll").length&&crmListView.bindPerfectScrollbar(),customViewObject.doMassActioninScheduler&&"inline"===$("#scheduleMassActionDiv").css("display")&&($("#checkAll").attr("class","customCheckBox"),crmListView.selectAllEntity("",$("#checkAll"))))},crmListView.viewCampSummaryOnClick=function(e,t){networkUtils.loadFeatureScripts(["ZCrmCampaigns.js"],(function(){ZCampaigns.onClickSummary(t)}))},crmListView.updateFilters=function(e){$(".saveTyp").hide();var t=crmListView.getObject(),i=$(e).attr("data-filterId");if(i){if(!t.filters)return alert(I18n.getMsg("crm.warning.select.filter")),!1;crmListView.toggleFilterOptions(!1);var a={action:"updateFilters",filters:JSON.stringify(t.filters),module:t.module,cvid:t.cvId,filterId:i};a[csrfParamName]=encodeURIComponent(csrfToken),(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/CustomView.do",data:a,type:"POST",success:function(e){var t=crmListView.getObject(),a=t.module;t.filterId=i;var s=crmTab.getFiltersFromCache(a);s&&(s.filterId=i),crmTab.countCache[customViewObject.module]||(crmTab.countCache[customViewObject.module]={}),crmTab.countCache[customViewObject.module][i]=crmTab.countCache[customViewObject.module].TotalCount?crmTab.countCache[customViewObject.module].TotalCount:0,crmListView.renderFilterCount(crmTab.countCache[customViewObject.module]),crmui.showMsgBand("success",I18n.getMsg("crm.filter.save.msg",I18n.getMsg("crm.button.cvfilter")),"2000","")}})}},crmListView.cancelFilterSave=function(){$("#lv_saved_filters").find(".f_listclick-view").removeClass("f_listclick-view"),$("#lv_filter_save_menu").find(".saveTypBtn").eq(1).removeAttr("data-filterId"),crmListView.toggleFilterOptions(!1);var e=crmListView.getObject();crmTab.countCache[e.module]&&crmListView.renderFilterCount(crmTab.countCache[e.module]);e.filterId;delete e.filterId},crmListView.showFilterSaveOptions=function(e){var t={id:"lv_filter_save_menu",clickSelector:"div",setDefaultPos:!1};Crm.menu.createMenu(e,t),renderingUtils.stopEvent(e)},crmListView.compareAndFetchCount=function(e,t){var i=crmTab.countCache[t],a=!1;for(var s in e){if(i[s]&&i[s]!=e[s]){a=!0;break}i[s]=e[s]}a?(delete crmTab.countCache[module],showTotalCount($("#tcDiv #totalRecordsCount"),void 0,"true",!0)):crmListView.renderFilterCount(crmTab.countCache[t],$("#tcDiv #totalRecordsCount"),t)},crmListView.checkSelectedCondVal=function(e,t){var i=$(e).attr("id").split("_")[1],a=$("#filter_"+i).attr("data-value").split(":")[1],s=$("#filter_"+i).attr("data-value").split(":")[0];if("T"==t&&"EMAIL"===a){var r=$("[data-value='"+s+":ADDN_EMAIL']");if(0===r.length)return;var o=r.attr("id").split("_")[1],n=$("#"+("textcondition1_"+o)+" option:selected").val(),l="textcondition1_"+i;$($("#"+l+" option")[$("#"+l+" option").length-1]).show(),$($("#"+l+" option")[$("#"+l+" option").length-2]).show(),!r.is(":checked")||"${BLOCKED}"!==n&&"${NOTBLOCKED}"!==n||($($("#"+l+" option")[$("#"+l+" option").length-1]).hide(),$($("#"+l+" option")[$("#"+l+" option").length-2]).hide())}else if("T"==t&&"ADDN_EMAIL"===a){var d=$("[data-value='CrmLeadDetails:EMAIL']");if(0===d.length)return;o=d.attr("id").split("_")[1],n=$("#"+("textcondition1_"+o)+" option:selected").val(),l="textcondition1_"+i;$($("#"+l+" option")[$("#"+l+" option").length-1]).show(),$($("#"+l+" option")[$("#"+l+" option").length-2]).show(),!d.is(":checked")||"${BLOCKED}"!==n&&"${NOTBLOCKED}"!==n||($($("#"+l+" option")[$("#"+l+" option").length-1]).hide(),$($("#"+l+" option")[$("#"+l+" option").length-2]).hide())}},crmListView.callChecked=function(e){var t=$(e),i=t.parents("#emailFilterSentiment");i.find("label").next(".cB").hide(),i.find("#lv_email_sentiment_date").hide();var a=t.parents("label").find("input").attr("data-value");if(t.is(":checked")){var s=t.parents("li:not(.facet)"),r=s.find("label").next(".cB"),o=s.find("label").next(".cB");"COUNT"===a||"PERCENTAGE"===a?(r.show(),o.show()):"LASTMAIL"===a?(r.hide(),o.show()):"NOTHING"!==a&&"ONLY"!==a||(r.removeClass("hide").show(),o.show()),$(".andsecClear").show()}},crmListView.getActivitySubModule=function(e,t,i){if(!e)return t;if("${EMPTY}"==e||"${NOTEMPTY}"==e){for(var a=i.length,s=0;s<a;s++){var r=i[s];if("tag"!=r.searchfieldtype&&(null!=r.searchfield&&"CrmActivity:SETYPE"==r.searchfield&&null!=r.value))return r.value}return"Tasks"}var o=["Tasks","Calls","Events"],n=e.split(",");for(s=0;s<3;s++)for(var l=Crm.jsonSelectValues.Tags[o[s]],d=l.length,c=0;c<d;c++){var u=l[c];if(null!=u&&u.id&&n.contains(u.id))return o[s]}return t},crmListView.sectionInpClear=function(){var e=$(".emailFilterSentimentSecClear");e.find('input[type="radio"]').prop("checked",!1),e.find("li .cB").hide(),$(".andsecClear").hide(),crmListView.toggleFilterOptions(!1,!0)},crmListView.showSentimentSubFilterOptions=function(e){var t=$(e).val();"POSITIVE_AND_NEGATIVE"==t?($(".sentimentinpercentage").show(),$(".sentimentforthelastmail").hide()):"POSITIVE_ONLY"==t||"NEGATIVE_ONLY"==t?($(".sentimentforthelastmail").hide(),$(".sentimentinpercentage").hide()):$(".sentimentinpercentage, .sentimentforthelastmail").show()},crmListView.showPredictionToolTip=function(e){var t="<div class='w100p mB10 mT15 f15 crm-font-bold'>"+I18n.getMsg("crm.lead.prediction.tooltip")+"</div>";t+="<table border=0 cellpadding=0 cellspacing=0><thead><tr><td>"+I18n.getMsg("crm.lead.prediction.tooltip.convert")+"</td>",t+="<td>"+I18n.getMsg("crm.lead.prediction.tooltip.score")+"</td></tr></thead>",t+="<tbody id=lvTred><tr><td>"+I18n.getMsg("crm.lead.prediction.convert.high")+"</td>",t+="<td>61 - 100</td></tr><tr><td>"+I18n.getMsg("crm.lead.prediction.convert.medium")+"</td>",t+="<td>41 - 60</td></tr><tr><td>"+I18n.getMsg("crm.lead.prediction.convert.low")+"</td>",t+="<td>1 - 40</td></tr></tbody></table>",crmui.showTooltip(t,!0,"left",e),$("#wf_tooltip").addClass("wf_tooltip_bgwhite")},crmListView.lastThreeInfo=function(e){crmui.showTooltip(I18n.getMsg("zia.last3.help",[Events.getModuleName(!1,!1,!0)]),!0,"left",e)},crmListView.validateBetweenCrt=function(e,t){return!!commonUtils.compareNumber(e.val().replace(/^\s+/g,"").replace(/\s+$/g,""),t.val().replace(/^\s+/g,"").replace(/\s+$/g,""))},crmListView.validateNumberIsInBetween=function(e,t,i){var a=!1,s=parseInt(e.replace(/^\s+/g,"")),r=parseInt(t.replace(/^\s+/g,"")),o=parseInt(i.replace(/^\s+/g,""));return s===r||o>=s&&o<=r&&(a=!0),a},crmListView.predictionFilterValidation=function(e,t,i,a){var s,r,o,n,l,d=e.val(),c=t;return!($(e).is(":checked")&&("LPSCR"==i&&(null!=a&&"14"!=a?c=t.eq(0):null!=a&&"14"===a&&(c=t.eq(1)),l=c.val(),"high"==d?(o="61",n="100",s="High"):"medium"==d?(o="41",n="60",s="Medium"):"low"==d&&(o="1",n="40",s="Low")),r=o+" - "+n,!crmListView.validateNumberIsInBetween(o,n,l)))||($("#pre_check1").html(I18n.getMsg("crm.lead.prediction.popup.text",[s,r])),crmui.showPopup("showAlertForConfirmation"),!1)},crmListView.showCusTooltip=function(e,t,i){if(0==$("#"+e).length){var a=$(event.target),s=$("<div>"),r=$("<div>");s.attr({id:e,class:"cusTooltip wf_tooltip fs bottom left "+i}),r.attr({id:e+"ctn",class:"cusTooltipCtn"}).html(t),s.append(r),$("body").append(s),$("#"+e).css({top:a.offset().top+a.outerHeight()+2,left:a.offset().left+8}).show()}else{a=$(event.target);$("#"+e+"ctn").html(t),$("#"+e).css({top:a.offset().top+a.outerHeight()+2,left:a.offset().left+8}).show()}},crmListView.hideCusTooltip=function(e){$("#"+e).hide()},crmListView.evaluteHistoryTracker=function(e){var t=$(".historyMoreOpt"),i=$(".historyMoreOpt").find("li"),a=t.find(".rbCheckHtml"),s=i.find(".durationFilter");$(e).val().length>10||0==$(e).val().length?(t.addClass("disableHistory"),t.find('input[type="checkbox"]').attr("checked",""),t.find("input,select").attr("disabled",!0),s.find("input").val(""),s.closest("li").find(".rbCheckHtml").find("input").removeAttr("checked"),s.addClass("eventNone"),s.find("select option:first-child").prop("selected",!0),$(e).val().length>10&&(a.attr("onmouseenter"," crmListView.showCusTooltip('cusTooltip','"+I18n.getMsg("crm.smartfilter.picklist.options.msg")+"','custWidth')"),a.attr("onmouseleave","crmListView.hideCusTooltip('cusTooltip');"))):(t.removeClass("disableHistory"),t.find("input,select").removeAttr("disabled"),a.removeAttr("onmouseenter onmouseleave"))},crmListView.picklistDuration=function(e){var t=$(e).closest("li").find(".durationFilter"),i=t.find("input,select"),a=t.find("input"),s=t.find("select");$(e).is(":checked")?(i.attr("disabled",!1),t.removeClass("eventNone")):(i.attr("disabled",!0),t.addClass("eventNone"),a.val(""),s.find("option:first-child").prop("selected",!0))},crmListView.addToCampaigns=function(e,t){var i=$(t).attr("data-relid"),a=[],s="",r={},o="";if(i){s=crmRelatedList.getPersonalityModuleObj(i).module,o="relatedList";var n="CB_"+i;CustomButtonJSObjectInit.checkBox&&CustomButtonJSObjectInit.checkBox[n]&&CustomButtonJSObjectInit.checkBox[n].length&&(a=CustomButtonJSObjectInit.checkBox[n]),r.listRelationId=i}else s=crmListView.getObject().module,o="listView",a=crmTab.getFromCache(s).selectedIds;if(!a.length>0)crmui.showMsgBand("error",I18n.getMsg("crm.campaign.member.email.empty"),3e3);else{crmListView.memberCopyObj={frommodule:s,idList:a.join(";"),from:o},i&&(crmListView.memberCopyObj.listRelationId=i,r.campaign_id=detailView.entityId),r.memberStatus=store.peekAll("campaign_status"),r.showPopup=!0;var l=networkUtils.returnDependencyFiles(["crm-add-to-campaign-popup.js"],crmConstants.jsStaticPathForLyte),d=networkUtils.returnDependencyFiles(["crm-add-to-campaign-popup.css"],crmConstants.cssStaticPathForLyte),c=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("variables")]),u=l.concat(d);u=u.concat(c);Lyte.injectResources(u,void 0,(function(){Lyte.Component.render("crm-add-to-campaign-popup",r,"#show")})),crmListView.trackAddToCampaignClick(o)}},crmListView.createNewCampaignwithMembers=function(e,t){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var i,a=$(t),s=a.attr("data-relid"),r=a.data("layoutid"),o=[],n="",l="";if(s){l="relatedList",n=crmRelatedList.getPersonalityModuleObj(s).module;var d="CB_"+s;CustomButtonJSObjectInit.checkBox&&CustomButtonJSObjectInit.checkBox[d]&&CustomButtonJSObjectInit.checkBox[d].length&&(o=CustomButtonJSObjectInit.checkBox[d]),i=detailView.entityId}else l="listView",n=crmListView.getObject().module,o=crmTab.getFromCache(n).selectedIds;if(!o.length>0)crmui.showMsgBand("error",I18n.getMsg("crm.campaign.member.email.empty"),3e3);else{crmListView.createCampaignMemberObj={member_info:{module:n,idList:o,from:l},parentCampaignId:i};var c=Crm.getCrmBasePath()+"/QuickCreateAction.do?module=Campaigns&createWithMember=true&searchmodule=Campaigns&newModel=true";i&&(c=c+"&parentCampaignId="+i),r&&(c=c+"&layoutId="+r),commonUtils.openCustomLookup(c,void 0,"searchCreatePopup"),crmListView.trackCampaignCreatePage("Entity_"+l,a.text())}}},crmListView.getMemberStatusArray=function(){var e=crmListView.getObject();return e&&e.modulePicklistValues&&e.modulePicklistValues["Campaign Members"]?crmListView.getObject().modulePicklistValues["Campaign Members"].MEMBERSTATUS:returnJson&&returnJson[detailView.currentModule]&&returnJson[detailView.currentModule]["Campaign Members"]?returnJson[detailView.currentModule]["Campaign Members"].MEMBERSTATUS:"add-to-campaigns"===Lyte.Router.getRouteInstance().routeName?bulkAddWizard.MEMBERSTATUS:void 0},crmListView.showCampaignOptions=function(e){var t=$("#zcampMoreOptions"),i=t.outerWidth(),a=t.position().top,s=$("#zCampMoreActionMenu");"open"===e?s.removeClass("dN").css({top:a,left:i}):s.addClass("dN").removeAttr("style")},crmListView.trackCampaignCreatePage=function(e,t){var i={from:e,layoutType:t,filtersUsed:validationUtils.isNotEmpty(crmRelatedList.filters)};Crm.trackSpotLightAction("Campaign Create Form Rendered",i)},crmListView.trackAddToCampaignClick=function(e){var t={from:e,filtersUsed:validationUtils.isNotEmpty(crmRelatedList.filters)};Crm.trackSpotLightAction("Add To Campaign Click",t)},crmListView.trackAddToCampaignSave=function(e){var t={campaignType:e};Crm.trackSpotLightAction("Add To Campaign Save",t)},crmListView.trackInviteMail=function(e){var t={campaignType:e};Crm.trackSpotLightAction("Campaign Integ - Invite Mail Sent",t)},crmListView.trackSendMailClickFromRL=function(e){var t={module:e,filtersUsed:validationUtils.isNotEmpty(crmRelatedList.filters),campType:detailView.getCurrentCampaignType()};Crm.trackSpotLightAction("Send Mail Click From RL",t)},Handlebars.registerHelper("layoutHasPipelines",(function(e,t,i){for(var a=e.length,s=0;s<a;s++){var r=e[s].fields.filterBy({column_name:"PIPELINE"});if(r.length&&r[0][t])return i.fn(r[0][t].pick_list_values)}return i.inverse(this)})),Handlebars.registerHelper("getRebrandValueByKey",(function(e){return RebrandLinkUtil.getProperty(e)})),crmListView.setHideActionInModule=function(){var e=moduleRecordMapping[customViewObject.module].actions;if(e&&e.length&&!e.filter((function(e){return"hideSelectAllRecords"==e.name})).length){moduleRecordMapping[customViewObject.module].actions.push({display_label:"Select all  records in this view",layouts:null,name:"hideSelectAllRecords",type:"action"})}};var returnJson=returnJson||{},ProcessFlow={recordIdVsTransitionDetails:{},transitionIdVsTransitionDetails:{},nextTransitions:[],API_VERSION:"v2"};ProcessFlow.PROCESS_URL=Crm.getCrmBasePath()+"/ProcessFlow.do",ProcessFlow.TRANSITION_URL=Crm.getCrmBasePath()+"/FlowTransition.do",ProcessFlow.MODULE_PAGELAYOUT=Crm.getCrmBasePath()+"/PageLayout.do",ProcessFlow.ACTION="action",ProcessFlow.SHOW_ALL_PROCESSES="showAllProcesses",ProcessFlow.GET_PROCESS_RELATED_DATA="getProcessRelatedData",ProcessFlow.GET_RELATED_TRANSITIONNAMES="getRelatedTansitionNames",ProcessFlow.SAVE_PROCESS_ORDER="saveProcessOrder",ProcessFlow.DO_TRANSITION="doTransition",ProcessFlow.SAVE_FLOWCHANGEACTION="SaveFlowChangeAction",ProcessFlow.UPDATE_PROCESS_STATUS="updateProcessStatus",ProcessFlow.GET_NEXT_TRANSITION="nextTransition",ProcessFlow.TRANSITION_FIELD_UPDATE="transitionFieldUpdate",ProcessFlow.GET_LAYOUT_AND_FIELDS="getLayoutAndFields",ProcessFlow.SAVE_PROCESS="saveProcess",ProcessFlow.CREATE_PROCESS="CreateProcess",ProcessFlow.UPDATE_PROCESS="UpdateProcess",ProcessFlow.GET_RECORDSINVOLVED_COUNT="getRecordsInvolvedCount",ProcessFlow.DELETE_PROCESS="deleteProcess",ProcessFlow.CREATE_TRANSITION="CreateTransition",ProcessFlow.UPDATE_TRANSITION="UpdateTransition",ProcessFlow.GET_DURINGFIELDS_FOR_MODULE="getDuringFieldsForModule",ProcessFlow.GET_DEPENDENT_DURINGFIELDS="getDependentDuringFields",ProcessFlow.POST_REQUEST_TYPE="POST",ProcessFlow.GET_REQUEST_TYPE="GET",ProcessFlow.RESPONSE_SUCCESS="Success",ProcessFlow.RESPONSE_FAILURE="Failure",ProcessFlow.STATUS="Status",ProcessFlow.SUPPORTED_MODULES=[],ProcessFlow.processCurrentViewResponse={},ProcessFlow.fieldIdVsData={},ProcessFlow.criteriaProperties=[],ProcessFlow.processIdVsTransitionNames={},ProcessFlow.moduleVsLayouts={},ProcessFlow.layoutIdVsFields={},ProcessFlow.isRequestSent=!1,ProcessFlow.currentProcessDetails={},ProcessFlow.isAllProcessLoaded=!1,ProcessFlow.moduleProcessLength={},ProcessFlow.ACTION_CHANGE=1,ProcessFlow.ACTION_SCROLL=2,ProcessFlow.ACTION_REORDER=3,ProcessFlow.PROCESS_LIMIT=200,ProcessFlow.PROCESS_COUNT=0,ProcessFlow.ExcecutionObjs={},ProcessFlow.ActivityModules=["Tasks","Events","Calls"],ProcessFlow.PipelineOptionsTemplate="",ProcessFlow.FieldDependency={},ProcessFlow.loadProcesses=function(e,t,i,a){var s={},r=$("#modOpt"),o=$("#status"),n=$("#processListHeader");s[ProcessFlow.ACTION]=ProcessFlow.SHOW_ALL_PROCESSES;var l=r.parent();"All"!==e?l.addClass("filterApplied"):l.removeClass("filterApplied"),e?(ProcessFlow.isAllProcessLoaded=!1,ProcessBuilder.ProcessPageCnt=0):e=r.val(),t||(t=$("#status").val());var d=o.parent();if("All"!==t?d.addClass("filterApplied"):d.removeClass("filterApplied"),a?s.SearchText=a:$("#bluePrintSearchTxt").val(""),s.module=e,i===ProcessFlow.ACTION_SCROLL)ProcessBuilder.ProcessPageCnt++,s.Page=ProcessBuilder.ProcessPageCnt;else if(i===ProcessFlow.ACTION_REORDER){if(ProcessBuilder.ProcessPageCnt=0,s.Page=ProcessBuilder.ProcessPageCnt,t="All","All"==e)return!1;n.find("select").prop("disabled",!0)}s.Status=t,ProcessBuilder.listViewModule=e,commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({type:ProcessFlow.GET_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:s,success:function(a){if(ProcessBuilder.ProcessSearchReqSent=!1,ProcessFlow.isAllProcessLoaded=a.IsAllProcessLoaded,ProcessFlow.setProcessListViewData(a,i),ProcessFlow.PROCESS_LIMIT=a.totalProcessLimit,ProcessFlow.PROCESS_COUNT=a.totalCnt,ProcessFlow.hideCreateProcessOnModuleLengthExceed(a),i!==ProcessFlow.ACTION_SCROLL){t?$("#processListHeader #status").val(t):$("#processListHeader #status").val("All");var s=$("#reOrderBtn");"All"==e?(s.addClass("disabledBtn"),s[0].setAttribute("onmouseover","crmui.toolTip_show(this,'left','"+I18n.getMsg("crm.automation.process.reorder.disabled.msg")+"')"),s[0].setAttribute("onmouseout","crmui.toolTip_hide()")):(s.removeClass("disabledBtn"),s.removeAttr("onmouseover"),s.removeAttr("onmouseout")),i===ProcessFlow.ACTION_REORDER&&($("#processDataContainer .processDataRow").each((function(e,t){var i=$(t);i.removeClass("hide"),i.addClass("reorderIc")})),ProcessFlow.doReorderActions(!0))}}})},ProcessFlow.hideCreateProcessOnModuleLengthExceed=function(e){e.hasOwnProperty("selectedModuleLength")&&(ProcessFlow.moduleProcessLength[e.selectedModule]=e.selectedModuleLength),ProcessFlow.hideCreateProcessButtonOnLimitExceed(e.totalCnt)},ProcessFlow.hideCreateProcessButtonOnLimitExceed=function(e){var t=$("#pa_createProcessBtn");e>=ProcessFlow.PROCESS_LIMIT?(t.prop("disabled",!0),t.attr("title",I18n.getMsg("crm.process.max.limit.reached.msg",[ProcessFlow.PROCESS_LIMIT]))):t.prop("disabled",!1)},ProcessFlow.tabAction=function(e){var t=$(".NodeContextMenu"),i=$(".linkContextMenu");if("block"!=i.css("display")&&"block"!=t.css("display")||(t.hide(),i.hide()),"pb_processInfo"==e&&ProcessBuilder.unSavedAction)return ProcessBuilder.showHideUnsavedAction(),!1;var a=$(".select2-container.select2-container--open");a.is(":visible")&&a.remove();var s=$("#"+e),r=s.siblings();"pb_transitionInfo"==e?(s.removeClass("hide"),$("#pb_stateInfo").addClass("hide")):"pb_stateInfo"==e?(s.removeClass("hide"),$("#pb_transitionInfo").addClass("hide")):(r.addClass("hide"),$("#pb_stateInfo, #pb_transitionInfo").addClass("hide")),s.addClass("sel"),r.removeClass("sel");var o=r[0],n=r[1];if(void 0!==o){var l=o.getAttribute("id");$("."+l).css("display","none")}if(void 0!==n){var d=n.getAttribute("id");$("."+d).css("display","none")}thirdPartyUtils.bindSelect2(".pb_form_ele"),$("."+e).fadeIn(200);var c=$(".actTransition"),u=$("#canvas .window.jtk-node, .jsplumb-overlay.aLabel"),m=$("#hotSpotSwitch");"pb_processInfo"==e?(u.removeClass("cTstates"),ProcessBuilder.setFieldDivHeight(),ProcessBuilder.applyCommonlineStyle(),m.removeClass("bpHelpClose"),$(".hotspots").removeClass("dIB").addClass("dN"),$(".pb_tabClass .commentabmenu").find("#pb_processInfo").removeClass("mR36"),$(".pb_property_toll").removeClass("hotspotOn")):0==c.find(".reverseSkew").length?m.addClass("dN"):m.removeClass("dN")},ProcessFlow.setProcessListViewData=function(e,t){var i=$("#processDataContainer");if(t===ProcessFlow.ACTION_SCROLL){if(e.Processes.length>0){ProcessFlow.processCurrentViewResponse.Processes=ProcessFlow.processCurrentViewResponse.Processes.concat(e.Processes);var a=Handlebars.templates.ProcessListViewData({processes:e.Processes,isReOrder:e.ALLOWREORDER});i.append(a)}}else{$(".setupleftmenutd").show(),$("#setupInnerLinks").show(),$(".new_setupview").removeClass("newSetupRightShow"),ProcessFlow.processCurrentViewResponse=e,e.SUPPORTED_MODULES&&(ProcessFlow.SUPPORTED_MODULES=e.SUPPORTED_MODULES);a=Handlebars.templates.ProcessListViewData({processes:e.Processes,isReOrder:e.ALLOWREORDER});ProcessBuilder.RegexValidators=e.RegexValidators;var s=$("#reOrderBtn"),r=$("#noProcessMessageDiv");i.html(a),s.hide(),r.addClass("hide"),$("#saveReOrderBtn, #cancelReOrderBtn").hide();var o=i.find(".processDataRow").length;0===o?r.removeClass("hide"):o>1&&s.show()}commonUtils.showHideLoadingDiv(),ProcessBuilder.bindMoreActions()},ProcessFlow.filterProcessLitView=function(e){var t=$("#processListHeader"),i=$("#modOpt").val(),a=t.find("#status").val();if(e){if("All"==i)return!1;t.find("select").prop("disabled",!0)}$("#processDataContainer .processDataRow").each((function(t,i){var s=$(i),r=s.attr("data-status");e?(s.removeClass("hide"),s.addClass("reorderIc")):"All"===a||a===r?s.removeClass("hide"):s.addClass("hide")})),e&&ProcessFlow.doReorderActions(!1)},ProcessFlow.getProcessIdVsDetails=function(e){var t={};return e.each((function(e){t[e.Id]=e})),t},ProcessFlow.bpRelatedListTab=function(e){var t=$(e),i=t.attr("data-tab");if(ProcessFlow.bpRelatedListTabSwitch(t.attr("data-tab")),t.addClass("sel"),"Calls_rlContainer"!==i&&"Tasks_rlContainer"!==i&&"Events_rlContainer"!==i)setTimeout((function(){for(var e=$(".duringTabDivsClass .bpRl-tab-content:visible"),t=[],i=e.find(".tabDivCreate .labelTabCreate"),a=i.length,s=0;s<a;s++){var r=i.eq(s).outerWidth();t.push(r)}var o=Math.max.apply(null,t);o>=190&&(o=190),i.css("width",o+"px");var n=e.find(".assignmentRestrictionDiv");n&&n.length>0&&(Crm.userDetails.RTL_ENABLED&&(o=-i.outerWidth()),n.css("left",o+"px"))}),100);else if(isNewCallView&&"Calls_rlContainer"===i){var a=$("#duringTabDivs #Calls_fldRow_CALLTYPE select"),s=$("#duringTabDivs #Calls_fldRow_OUTBOUNDCALLSTATUS select");a.val(a.find("option").filterByData("actual-value","Outbound").val()),s.val(s.find("option").filterByData("actual-value","Completed").val()),a.attr("disabled",!0),s.attr("disabled",!0)}select2ChangesInFields($("#duringTabDivs"))},ProcessFlow.bpRelatedListTabSwitch=function(e){$("ul.bpRLcommentabmenu li").removeClass("sel"),$(".bpRl-tab-content").removeClass("current");var t=$("#"+e),i=$("#"+e+"_header");if(t.addClass("current"),i.addClass("sel"),t.hasClass("expandWidth")?$("#multipleFieldsEditPop").addClass("w90per").removeClass("w900"):$("#multipleFieldsEditPop").removeClass("w90per").addClass("w900"),"checkListContainer"!==e){var a=t.find(".restrictAssignment .labelTabCreate");if(a.length>0&&a.length>0){var s,r,o=a.attr("id");o=o.split("_label")[0];var n=$("#"+o);if("fieldsContainer"===e)s=$("#multipleFieldEditModule").val(),r=t.find("crm-threshold-grant"),$.each(a,(function(e,t){var i=$(t),a=i.attr("id");a=a.split("_label")[0];var o,l=(n=$("#"+a)).data("entitymodule");if(void 0!==l&&s!==l){var d={};d.ownerid=n.data("id"),d.moduleName=l;var c="#"+i.parent().attr("id")+" .assignmentRestrictionDiv";(o=$(c).find("crm-threshold-grant")).length>0?(o=o[0]).setData("ownerid",d.ownerid):((o=Lyte.Component.render("crm-threshold-grant",d,c)).id="assRestGrant",o.classList.add("dIB",a),o.component.executeMethod("addRestrictionMessage",o))}else r.length>0&&((o=r[0]).setData("ownerid",n.data("id")),o.classList.add(a),o.component.executeMethod("addRestrictionMessage",o))}));else{s=i.data("mod");var l={};l.ownerid=n.data("id"),l.moduleName=s;var d="#"+t.find(".restrictAssignment").attr("id")+" .assignmentRestrictionDiv";(r=$(d).find("crm-threshold-grant")).length>0?(r=r[0]).setData("ownerid",l.ownerid):((r=Lyte.Component.render("crm-threshold-grant",l,d)).id="assRestGrant",r.classList.add("dIB")),r.classList.add(o),r.component.executeMethod("addRestrictionMessage",r)}}}},ProcessFlow.saveProcessReOrder=function(){var e=ProcessFlow.getProcessIdVsDetails(ProcessFlow.processCurrentViewResponse.Processes),t={},i=[];$("#processDataContainer .processDataRow").each((function(a,s){var r=$(s).attr("data-pid");t[r]=a+1,i.push(e[r])})),ProcessFlow.processCurrentViewResponse.Processes=i,commonUtils.showHideLoadingDiv(!0);var a=$("#modOpt").val(),s={};s[ProcessFlow.ACTION]=ProcessFlow.SAVE_PROCESS_ORDER,s.module=a,s.sequenceDetails=JSON.stringify(t),networkUtils.setCsrfParam(s),(new crmRequestPool).initiate({type:ProcessFlow.POST_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:s,success:function(e){commonUtils.showHideLoadingDiv(),e[ProcessFlow.STATUS]===ProcessFlow.RESPONSE_SUCCESS&&ProcessFlow.cancelProcessReOrder(!0),ProcessFlow.hideCreateProcessButtonOnLimitExceed(ProcessFlow.PROCESS_COUNT),$("#bluePrintSearchTxt").css("pointer-events","");var t=$("#processDataContainer");t.removeClass("cM ui-sortable"),t.data("ui-sortable")&&t.sortable("destroy"),ProcessBuilder.bindMoreActions()}})},ProcessFlow.interceptTransition=function(e,t,i,a,s,r){if(CScriptLib){var o={},n=(ProcessFlow.recordIdVsTransitionDetails[t].Transitions||[]).filter((function(e){return e.TransitionRelId===i}));n.length&&(o={id:n[0].TransitionRelId,name:n[0].TransitionName}),CScript.dispatchIEvent("beforeTransition",void 0,o).then((function(o){!0===o&&ProcessFlow.doTransition(e,t,i,a,s,r)}))}else ProcessFlow.doTransition(e,t,i,a,s,r)},ProcessFlow.doTransition=function(e,t,i,a,s,r){"entity"===Lyte.Router.getRouteInstance().parent.routeName&&"canvas"===Lyte.Router.getRouteInstance().routeName&&(s="Canvas",Crm.canvasScroll=$L("crm-detail-view-blueprint-action")[0].parentElement.closest("[id]").id),void 0===a&&(a=$("#entityName").val()),ProcessFlow.ExcecutionObjs.module=e,ProcessFlow.ExcecutionObjs.entityId=t,ProcessFlow.ExcecutionObjs.entityName=a,ProcessFlow.ExcecutionObjs.isContinuousBP=1==r;var o={};o[ProcessFlow.ACTION]=ProcessFlow.DO_TRANSITION,o.module=e,o.entityId=t,o.transitionRelId=i,networkUtils.setCsrfParam(o),commonUtils.showHideLoadingDiv(!0);var n=$("#pb_processButtonLayerInner, #transitionBtnLayer");n.find(".pb_transitionState").addClass("eventNone"),(void 0!==s&&"Approvals"===s||"Canvas"===s)&&(o.getLayoutRuleJSON=!0),(new crmRequestPool).initiate({type:ProcessFlow.POST_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:o,success:function(a){if(commonUtils.showHideLoadingDiv(),a[ProcessFlow.STATUS]===ProcessFlow.RESPONSE_SUCCESS){ProcessFlow.currentTransitionDetails=a.Transition;var s=a.DuringFields?a.DuringFields:[],r=a.NextTransitions?a.NextTransitions.Transitions:[];ProcessFlow.fieldDependency=a.fieldDependency?a.fieldDependency:void 0;for(var o=a.dependentFields?a.dependentFields:void 0,l=!1,d=r.length,c=[],u=0;u<d;u++)r[u].IsCriteriaMatched&&c.push(r[u]),l=l||r[u].IsCriteriaMatched;if(ProcessFlow.nextTransitions=c,ProcessFlow.duringFieldDetails=s,CFRExec&&void 0!==a.layoutRuleJSONObj&&!$.isEmptyObject(a.layoutRuleJSONObj)&&(returnJson=$.parseJSON(a.entityInfo),CFRExec.init(a.layoutRuleJSONObj,e,"list")),s.length>1||l){var m=!1;s.each((function(e){var t=e.Type;"Note"!==t&&"rlFields"!==t||(m=!0)})),n.find(".pb_transitionState").removeClass("eventNone"),Crm.userDetails.isStorageLimitReached&&m?Crm.showStorageExceedPopup():ProcessFlow.showDuringTransitionFieldsPop(e,s,t,i,c,ProcessFlow.currentTransitionDetails,ProcessFlow.fieldDependency,o)}else ProcessFlow.saveStateChange(e,t,ProcessFlow.currentTransitionDetails.ProcessFieldId,i)}else null!=a.Error&&a.Error.indexOf("We will reload this record")>-1?renderingUtils.showCustomAlert(a.Error,void 0,void 0,(function(){crmHistory.refreshCurrentPage()}),void 0,void 0):renderingUtils.showCustomAlert(a.Error),n.find(".pb_transitionState").removeClass("eventNone")}}),Crm.trackSpotLightAction("Process Automation - Record Level Transition",{Module:e})},ProcessFlow.checkForTransitionPreview=function(e,t){if(void 0===ProcessFlow.recordIdVsTransitionDetails[e]){var i={};i[ProcessFlow.ACTION]=ProcessFlow.GET_NEXT_TRANSITION,i.module=t,i.entityId=e,(new crmRequestPool).initiate({type:ProcessFlow.GET_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:i,success:function(t){void 0!==t.NextTransitions&&(ProcessFlow.recordIdVsTransitionDetails[e]=t.NextTransitions,ProcessFlow.showTransitionPreview(e))}})}else ProcessFlow.showTransitionPreview(e)},ProcessFlow.showTransitionPreview=function(e){var t=ProcessFlow.recordIdVsTransitionDetails[e],i=$("[id=pb_configProcess][entityId="+e+"]"),a=renderingUtils.windowHeight-150;if(i.length<=0){var s=Handlebars.templates.ProcessPreviewPop({EntityId:e,ProcessName:t.ProcessName,CurrentStateDisplayValue:t.CurrentStateDisplayValue,Transitions:t.Transitions}),r=$L("#canvasPopupDiv");r&&r.length?r.html(s):$("#pb_processPreviewLayer").html(s),(i=$("[id=pb_configProcess][entityId="+e+"]")).find(".pre_trans").each((function(){$(this).hover((function(){var t=$(this),i=t.offset(),a=$("#pb_configProcess").position().left,s=i.top+t.outerHeight()+10,r=i.left,o=$("[id=pb_preview_criteria_tootip][entityId="+e+"]"),n=t.attr("relId"),l=ProcessFlow.getTransitionRelIdVstransitionDetails(e)[n];if(l.Summary){var d="<div class='pR dIB'><span class='pb_topArr'></span><div class='pb_criteriaSummaryView'>"+l.Summary+"</div></div>";o.html(d);var c=$(".pb_criteriaSummaryView").find(".viewCriRow");1===c.length&&c.find(".wf_oprView").remove(),o.css({top:s,left:r-a}).show()}}),(function(){$("#pb_preview_criteria_tootip").hide()}))}))}i.find(".pb_preview").css("max-height",a),crmui.showPopup(i.attr("id"),!0);var o=$("#processPreviewTable");if(o.find(".pb_prevProcess_layer").length>1){var n=o.find("tr td:nth-child(2)"),l=n.outerHeight()-66;n.append('<span class="pbMorePreiview"></span>'),o.find("span.pbMorePreiview").css({height:l})}},ProcessFlow.saveStateChange=function(e,t,i,a){Crm.requestParamWithColname={};var s=ProcessFlow.getFieldIdVsFieldDetailsJson(e,ProcessFlow.duringFieldDetails)[i];if(s){Crm.requestParamWithColname[s.colname]=ProcessFlow.currentTransitionDetails.ToStateValue;var r=ProcessFlow.getParamsForMulitipleFieldsSave(e,t,a),o=JSON.parse(r.duringFields).ChildModuleFields;(o=ProcessFlow.changeToOldFormat(o)).module=r.module,o.moduleid=r.moduleid,o.transitionRelId=r.transitionRelId,(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(e))&&CFRExec&&CFRExec.evalAjaxEditForLayoutRule(e,o.columnName,o.fieldValue,"formRuleMandatoryFields")?(o.check={type:"processFlow"},CFRExec.haltStageChange(o)):(CFRExec.haltStageChange({}),ProcessFlow.saveFields(e,r,t))}},ProcessFlow.getTransitionRelIdVstransitionDetails=function(e,t){var i={};if(void 0!==ProcessFlow.recordIdVsTransitionDetails[e]||void 0===t)return ProcessFlow.recordIdVsTransitionDetails[e].Transitions.each((function(e){i[e.TransitionRelId]=e})),ProcessFlow.nextTransitions.each((function(e){i[e.TransitionRelId]=e})),i;var a={};a[ProcessFlow.ACTION]=ProcessFlow.GET_NEXT_TRANSITION,a.module=t,a.entityId=e,(new crmRequestPool).initiate({type:ProcessFlow.GET_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:a,async:!1,success:function(t){if(void 0!==t.NextTransitions)return ProcessFlow.recordIdVsTransitionDetails[e]=t.NextTransitions,ProcessFlow.recordIdVsTransitionDetails[e].Transitions.each((function(e){i[e.TransitionRelId]=e})),ProcessFlow.nextTransitions.each((function(e){i[e.TransitionRelId]=e})),i}})},ProcessFlow.getDuringTransitionDependentFields=function(e,t){var i=$("#multipleFieldEditModule").val(),a={};a[ProcessFlow.ACTION]=ProcessFlow.GET_DEPENDENT_DURINGFIELDS,a.Module=i,a.TransitionRelId=$("#multipleFieldEditTransRelId").val(),a.EntityId=e,a.FieldId=t,networkUtils.setCsrfParam(a),commonUtils.showHideLoadingDiv(!0),crmRequestPool().initiate({type:ProcessFlow.POST_REQUEST_TYPE,action:ProcessFlow.TRANSITION_URL,data:a,success:function(e){if(e[ProcessFlow.STATUS]===ProcessFlow.RESPONSE_SUCCESS&&void 0!==e.FieldMeta){commonUtils.showHideLoadingDiv(!1);for(var t=$("#multipleFieldsEditPop").find(".fieldsContainer"),a=e.FieldMeta,s=a.length,r=0;r<s;r++){var o,n=a[r],l=ProcessFlow.constructDuringFields(i,n),d=$("#"+l.id),c=d.prev();if("SMOWNERID"===n.colname&&(o=$("#"+l.id+" .assignmentRestrictionDiv").attr("style")),d.remove(),0==c.length?t.prepend(l):c.after(l),"SMOWNERID"===n.colname){var u="#"+l.id,m=document.createElement("div");(m=$(m)).addClass("dN pR mT7 assignmentRestrictionDiv dIB"),$(u).append(m);var p=u+" .assignmentRestrictionDiv";$(p).attr("style",o);var f=n.attrObj?n.attrObj.id:"",v={};v.ownerid=n.defaultid,v.moduleName=n.entityModule;var g=Lyte.Component.render("crm-threshold-grant",v,p);g.id="assRestGrant",g.classList.add("dIB",f),g.component.methods.addRestrictionMessage(g)}}t.find(".infotoolTip").length&&crmTemplate.bindFldTooltip();var h=t.find("select");h.length&&thirdPartyUtils.bindSelect2(h),t.find(".readonlyF").length<=0&&$("#multipleFieldEditSaveBtn").prop("disabled",!1)}}})},ProcessFlow.constructDuringFields=function(e,t){var i={changeOwnerPermission:!0,module:e};"SMOWNERID"===t.colname||"Boolean"===t.type?t.mandate="false":t.mandate="true",void 0!==t.reasonrestrict?t.readonly="true":t.readonly="false",i.callFrm="processflow";var a=crmTemplate.createFieldRow(1,e,void 0,t,i),s=$(a).find(".labelValCreate [data-colname]");return void 0!==t.isdependfield&&s.attr("data-dependfield",!0).attr("data-fieldid",t.fieldid),void 0!==t.suffixIndex&&s.attr("data-suffixIndex",t.suffixIndex),void 0!==t.entityModule&&s.attr("data-entityModule",t.entityModule),void 0!==t.entityId&&s.attr("data-entityId",t.entityId),void 0!==t.reasonrestrict&&s.attr("data-reasonrestrict","true"),"445"===t.uitype&&(s.val(s.data("selectedid")),s.addClass("bp-mxn-field")),"444"===t.uitype&&(s.data({selectedid:t.selectedid,confirmselectedid:t.confirmSelectedId,confirmunselectedid:t.confirmUnSelectedId}),s.addClass("bp-mxn-field")),"8"===t.uitype&&void 0!==t.isFieldOfLookup&&s.attr("data-isFieldOfLookup",t.isFieldOfLookup).attr("data-actionFol","Blueprint"),a},ProcessFlow.showDuringTransitionFieldsPop=function(e,t,i,a,s,r,o,n){i=i||$("#id").val(),ProcessFlow.dependentFields=[];var l={module:e,entityId:i,transitionRelId:a},d=$("#multipleFieldsEditPop"),c=d.is(":visible"),u=Handlebars.templates.MultipleFieldsEdit({data:l,SkipContainer:c}),m=$("#blueprintAttachmentContextMenu");c?d.html(u):(d.remove(),$("#show").prepend(u),d=$("#multipleFieldsEditPop"));var p,f,v,g=t.filter((function(e){if("widget"===e.Type)return e}))[0];if(g){var h={widget:g.widget,transition:{id:r.TransitionId,name:r.Name},stateId:r.FromStateId,recordId:i,module:e,recordName:ProcessFlow.ExcecutionObjs.entityName};ProcessFlow.widgetCache||(ProcessFlow.widgetCache=[]),ProcessFlow.widgetCache.push(h),d.addClass("h600");var C={Entity:moduleRecordMapping[e].api_name,EntityId:i};return WidgetHandler.Blueprint.render(r.TransitionId,"multipleFieldsEditPop",C),void crmui.showPopup("multipleFieldsEditPop")}d.removeClass("h600"),d.find(".pp-header").text(r.Name),t=ProcessFlow.restructureDuringFieldObj(t);var w=$("#assignmentRestriction"),b=$L("#assRestGrant");t.each((function(t){var i=t.Type,a=t.tempNotes;if("Note"===i){var s=ProcessFlow.getFieldsContainer(d),o=$(document.createElement("div"));o.attr({class:"tabDiv noborder notesCommonClass",id:"transitionNotesDiv"}),(D=$(document.createElement("div"))).addClass("tabDivCreate newmandatory"),o.append(D),(O=$(document.createElement("div"))).addClass("labelTabCreate"),O.text(I18n.getMsg("crm.label.notes")),D.append(O),(S=$(document.createElement("div"))).addClass("labelValCreate"),S.text(I18n.getMsg("crm.label.notes")),S.html("<textarea class='textField w200' maxlength='3000' id='transitionNotes' onclick=\"bindMentions(this,'transitionNotes');\"></textarea>"),D.append(S),s.append(o),(p=$("#transitionNotes")).click(),void 0!==a&&(p.val(a),Notes.tempNotes=t.noteContent)}else if("Tags"===i){var n=a||[],l=$("crm-detailview-tag")[0];if(void 0!==l)var c=l.component.data.tagnamevscolor;var u=n.length;if(void 0!==c)for(var g=0;g<u;g++)void 0!==c[n[g].name]&&(n[g].color_code=c[n[g].name]);if(!Array.isArray(n))throw new Error("typeof tag object should be JSON Array");s=ProcessFlow.getFieldsContainer(d);var h=$(document.createElement("div"));h.attr({class:"tabDiv noborder",id:"transitionTagsDiv"}),(D=$(document.createElement("div"))).addClass("tabDivCreate newmandatory"),h.append(D),(O=$(document.createElement("div"))).addClass("labelTabCreate"),O.text(I18n.getMsg("crm.label.small.tags")),D.append(O),(S=$(document.createElement("div"))).addClass("labelValCreate");var C={};C.cxPropTags=n;var T=Lyte.Component.render("crux-tag",C);T.id="tagCruxContainer",S.append(T),D.append(S),s.append(h),store.findAll("tag",{module:moduleApiMapping[e],fromPage:"view"}).then((function(e){if(Array.isArray(e)){var t=[],i={};e.forEach((function(e){e.name&&(i[e.name]=!0,t.push({name:e.name,id:e.id,color_code:e.color_code}))}));var a=T.getData("cxPropTags");a=a.map((function(e){return i[e.name]||(e.isNewtag=!0),e}));var s=e.$.meta;T.cxProp({tagOptions:t,tags:a,maxTagLimit:s.record_limit,maxOptionsLimit:s.allowed_count}),T.setMethods({onError:function(e,t){3==t.errorCode?renderingUtils.showAlertMsg(I18n.getMsg("crm.tags.records.limit.reached",s.record_limit),"error"):2==t.errorCode&&renderingUtils.showAlertMsg(I18n.getMsg("crm.tag.edition.limit.exceeded"),"error")},onBeforeAddTag:function(e){if(!CrmTags.checkCharacter(e))return T.toggle("close"),!1;var t=T.getData("cxPropTags");if(void 0!==CrmTags.clientJSON&&void 0!==CrmTags.clientJSON.value&&void 0!==CrmTags.clientJSON.value.length&&void 0!==t&&t.length>=s.record_limit-CrmTags.clientJSON.value.length)return renderingUtils.showAlertMsg(I18n.getMsg("crm.tags.records.limit.reached",s.record_limit),"error"),T.toggle("close"),!1;if(void 0!==CrmTags.clientJSON&&void 0!==CrmTags.clientJSON.value.length&&void 0!==t&&t.length>=s.record_limit-CrmTags.clientJSON.value.length)return renderingUtils.showAlertMsg(I18n.getMsg("crm.tags.records.limit.reached",s.record_limit),"error"),T.toggle("close"),!1;t=T.getData("cxPropTags");return!(void 0!==CrmTags.clientJSON&&void 0!==CrmTags.clientJSON.value.length&&void 0!==t&&t.length>=s.record_limit-CrmTags.clientJSON.value.length)||(renderingUtils.showAlertMsg(I18n.getMsg("crm.tags.records.limit.reached",s.record_limit),"error"),T.toggle("close"),!1)},onColorTagPaletteHide:function(e,t){var i=document.getElementById("tagCruxContainer"),a=i.component.bodyDrop.querySelector("crux-color-palette lyte-popover");t&&t.target&&!i.component.bodyDrop.contains(t.target)&&!a.component.childComp.contains(t.target)&&i.toggle("close")}})}})).catch((function(){crmui.showMsgBand("error","Error while fetching available tags",3e3,"")}))}else if("Attachment"===i){if(m.length<1){var I=document.createElement("div"),y=$(I);y.attr("id","blueprintAttachmentContextMenu"),y.css({position:"absolute",visibility:"hidden","z-index":"10"}),d.append(y)}s=ProcessFlow.getFieldsContainer(d);var P=t.relListId,_=t.persName;ProcessFlow.updateRelatedListObj(P,_);var D,O,S,L=$(document.createElement("div"));L.attr({class:"tabDiv noborder",id:"transitionAttachDiv"}),(D=$(document.createElement("div"))).addClass("tabDivCreate newmandatory"),L.append(D),(O=$(document.createElement("div"))).addClass("labelTabCreate"),O.text(I18n.getMsg("Attachments")),D.append(O),(S=$(document.createElement("div"))).addClass("labelValCreate attachmentsLabel"),S.text(I18n.getMsg("Attachments")),D.append(S);var E=t.tempAttachments,x={},F=networkUtils.returnDependencyFiles("zohocrm_blueprintattachment.js");Lyte.injectResources(F,void 0,(function(){if(E){E=JSON.parse(E),BlueprintAttachment.validateFilePreview(E).then((function(e){var i=JSON.parse(e).isPreviewAvailable;$.each(E,(function(e,t){var a=x[t.type];switch(void 0===a&&(a=$("<div>",{id:"attachmentList-"+t.type,type:t.type})),t.name="string"==typeof t.name?[t.name]:t.name,t.type){case"attachLink":t.$link_url="string"==typeof t.$link_url?[t.$link_url]:t.$link_url,(s=ProcessFlow.getFileNamesHtmlForTransPop({names:t.name,ids:t.$link_url},t.type))&&a.append(s);break;case"fileUpload":t.$file_id="string"==typeof t.$file_id?[t.$file_id]:t.$file_id,(s=ProcessFlow.getFileNamesHtmlForTransPop({names:t.name,ids:t.$file_id,isPreviewAvailable:i},t.type))&&a.append(s);break;case"attachDocuments":t.$attachDocs="string"==typeof t.$attachDocs?[t.$attachDocs]:t.$attachDocs,(s=ProcessFlow.getFileNamesHtmlForTransPop({names:t.name,ids:t.$attachDocs,isPreviewAvailable:i},t.type))&&a.append(s);break;case"attachZDocs":t.$attachZDocs="string"==typeof t.$attachZDocs?[t.$attachZDocs]:t.$attachZDocs,t.service="string"==typeof t.service?[t.service]:t.service,(s=ProcessFlow.getFileNamesHtmlForTransPop({names:t.name,ids:t.$attachZDocs,service:t.service,isPreviewAvailable:i},t.type))&&a.append(s);break;case"attachFromTeamDrive":(s=ProcessFlow.getFileNamesHtmlForTransPop({names:t.name,ids:t.$attachTeamDriveDocIds,linkUrls:t.teamDriveLinkUrls},t.type))&&a.append(s);break;case"attachGDocs":var s;(s=ProcessFlow.getFileNamesHtmlForTransPop({names:t.name,ids:t.$attachGDocs,service:t.service,isPreviewAvailable:i},t.type))&&a.append(s)}x[t.type]=a}));var a=Object.values(x);if(a.length>0){S.removeClass("attachmentsLabel"),S.html("");var s=$(ProcessFlow.getAttachDropdown(t));s.addClass("attachmentsLabel blueprintAttachment"),s.removeAttr("style"),s.css("margin","7px"),D.after().append(s.outerHTML()),BlueprintAttachment.appendClickEventForDropdown(),$.each(a,(function(e,t){S.append(t)})),S.attr("isAttachmentAdded","true")}}))}else{var e=Handlebars.templates.personalityAction({actions:t.Actions,rid:t.relListId,name:t.persName,mailObj:t.mailObj,entityId:crmRelatedList.EntityId,moduleName:t.Module,fromSrc:"bluePrint"}),i=$(e),a=$("body"),s=i.find(".atch-droplist").clone();s.attr("id","bp-attachment"),i.find(".atch-droplist").remove(),$("#bp-attachment").hasClass("atch-droplist")||a.append(s),S.html(i)}})),s.append(L)}else if("Info"===i){s=ProcessFlow.getFieldsContainer(d);var V=$(document.createElement("div"));V.addClass("textFld tabDivCreate pT20 pB5 italic"),V.css("word-break","break-word"),V.html(t.Info),s.append(V)}else if("Field"===i){var A=t.FieldObject,k=r.ProcessFieldId===A.fieldid;k&&(A.defaultvalue=r.ToStateValue,A.default=r.ToStateValue,f=t.FieldObject.colname,v=r.ToStateValue);var N=ProcessFlow.constructDuringFields(e,A);s=ProcessFlow.getFieldsContainer(d,!0);if(k?$(N).hide():$("#fieldsContainer_header").removeClass("hide"),0==s.length&&!k){var M=$("#duringTabs"),R=$("<li>",{class:"",onclick:"ProcessFlow.bpRelatedListTab(this)","data-tab":"fieldsContainer",id:"fieldsContainer_header"}).html($("<a>",{class:"setuplink",text:"Notes, Attachments & Fields"}));M.append(R);var B=$("<div>",{class:"pp-content pR crm-font-regular bpRl-tab-content newInputStyleEle fieldsContainer moduleParent",id:"fieldsContainer"});M.append(B),s=d.find("#fieldsContainer")}if("SMOWNERID"===A.colname&&b.length>0){if(A.entityModule){var U=document.createElement("div");(H=$(U)).addClass("dN pR mT7 assignmentRestrictionDiv dIB"),$(N).append(H)}else{var j=w.clone();j.addClass("assignmentRestrictionDiv dIB"),$(N).append(j)}$(N).addClass("restrictAssignment")}if(s.append(N),"SMOWNERID"===A.colname&&0===b.length){if(A.entityModule){var H;U=document.createElement("div");(H=$(U)).addClass("dN pR mT7 assignmentRestrictionDiv dIB"),$(N).append(H)}else{var z="#"+N.id;U=document.createElement("div");(U=$(U)).addClass("dN pR mT7 assignmentRestrictionDiv dIB"),$(z).append(U);var q=z+" .assignmentRestrictionDiv",Y=A.attrObj?A.attrObj.id:"",J={};J.ownerid=A.defaultid,J.moduleName=e;var W=Lyte.Component.render("crm-threshold-grant",J,q);W.id="assRestGrant",W.classList.add("dIB",Y)}$(N).addClass("restrictAssignment")}crmTab.isLinkingModule(e)&&A.colname.startsWith("LINKINGMXN")&&$(N).on("autocompleteselect",function(t,i){var a=t.target,s=i.item.seId,r=t.currentTarget.id.split("_")[2];ProcessFlow.checkDuplicateAssociation(a,s,r,e)}.bind(this))}else if("rlFields"==i){var G=t.Module,Q=t.ModLabel,K=t.FieldObjects,X=(P=t.relListId,_=void 0===t.relListName?G:t.relListName,void 0===t.relListLabel?Q:t.relListLabel);ProcessFlow.updateRelatedListObj(P,_);R=$("<li>",{class:"",onclick:"ProcessFlow.bpRelatedListTab(this)","data-mod":G,"data-tab":P+"_rlContainer",id:P+"_rlContainer_header",layoutid:t.LayoutId}).html($("<a>",{class:"setuplink",text:void 0!==t.relListLabel?X+" - "+Q:Q}));$("#duringTabs").append(R);var Z="";"Calls"!==P&&"Tasks"!==P&&"Events"!==P&&(Z="newInputStyleEle");B=$("<div>",{class:"pp-content pR crm-font-regular bpRl-tab-content moduleParent "+Z,id:P+"_rlContainer"});$("#duringTabDivs").append(B);var ee=$("#"+P+"_rlContainer");K.each((function(e){var t=e.FieldObject,i={changeOwnerPermission:!0,module:G,isBPExec:!0};if(t[G]&&t[G].subforms){window[G].createEditJson=t,window[G].formulaObj=new crmFormulaInit,window[G].formulaObj.resetProps(),t.module=G;var a=crmTemplate.createSectionLayout(t,G);ee.append(a);var s=ee.find(".subformParentSection").eq(0);crmCommonModule.renderSubformInSection(ee,t,!0,{relListId:P}),crmTemplate.bindFldTooltip(),crmTemplate.contentLoaded(t,G,ee),crmTemplate.bindSubformScrollEvent(),ProcessFlow.designSubforForBPLayout(s)}else{"SMOWNERID"==t.colname?(t.mandate="false",Crm.userDetails.LITE.IS_LITE_USER&&(""!==t.defaultid&&t.defaultid!==Crm.userDetails.USER_ID&&t.defaultvalue!==Crm.userDetails.DISPLAY_NAME&&""!==t.defaultvalue||(t.defaultvalue=I18n.getMsg("None"),t.defaultid=null))):t.mandate="true",t.readonly=!1,!0===e.isLookupFld&&(t.defaultid=ProcessFlow.ExcecutionObjs.entityId,t.defaultvalue=ProcessFlow.ExcecutionObjs.entityName),"Events"==G&&(Events.currentStatus="create"),i.callFrm="processflow",i.bp_type=e.Type;var r=crmTemplate.createFieldRow(1,G,void 0,t,i);"PRODUCTDETAILS"==t.colname&&r.classList.add("ProductDetailsContainer");var o=$(r),n=o.find(".labelValCreate [data-colname]");if(void 0!==t.suffixIndex&&n.attr("data-suffixIndex",t.suffixIndex),"PRODUCTDETAILS"!==t.colname&&o.find(".labelTabCreate").addClass("columnCal1"),"8"===t.uitype&&void 0!==t.isFieldOfLookup&&n.attr("data-isFieldOfLookup",t.isFieldOfLookup).attr("data-actionFol","Blueprint"),"SMOWNERID"===t.colname&&t.defaultid&&b.length>0){var l=document.createElement("div"),d=$(l);d.addClass("dN pR mT7 assignmentRestrictionDiv dIB"),o.append(d),o.addClass("restrictAssignment")}if(ee.append(r),"PRODUCTDETAILS"==t.colname&&Crm.isInventoryModule(G)&&productDetails.init(t,G,"blueprint",{relListId:P}),crmTab.isLinkingModule(G)&&t.colname.startsWith("LINKINGMXN")&&o.on("autocompleteselect",function(e,t){var i=e.target,a=t.item.seId,s=e.currentTarget.id.split("_")[2];ProcessFlow.checkDuplicateAssociation(i,a,s,G)}.bind(this)),"PRODUCTDETAILS"==t.colname&&t.productLineItems&&t.productLineItems.totalProductCount>0){if(ee.find("#linesTbody").children().remove(),Crm.userDetails.isLookupAdvancedSearchEnabledInLineItem){var c=t.productLineItems;c.fieldMeta=t,productDetails.setValuesForAddedRowForEdit(c,void 0,!0,{relListId:P})}else productDetails.setValuesForAddedRowForEdit(t.productLineItems,void 0,!0,{relListId:P});ee.find("#productList").find(".pB20").show(),ee.find("#productList").find(".pB20").find(".wrap").show(),ee.find("#addLinesBtnLwr").hide()}!0===e.isLookupFld&&o.hide()}}))}else if("checkList"===i){var te=t.CheckLists;void 0!==te.title&&""!==te.title||(te.title=I18n.getMsg("crm.untitled.default.label")),t.TransitionRelId;var ie=te.items;if(0===d.find("#checkListContainerHeader").length){var ae=$("<li>",{class:"",onclick:"ProcessFlow.bpRelatedListTab(this)","data-tab":"checkListContainer",id:"checkListContainerHeader"}).html($("<a>",{class:"setuplink",text:I18n.getMsg("crm.process.during.checklist")}));$("#duringTabs").append(ae);var se=$("<div>",{class:"pp-content pR crm-font-regular bpRl-tab-content newInputStyleEle moduleParent mL20",id:"checkListContainer"});se.append($("<h3>",{class:"m0 mB20 f22",id:"checkListsTitle"}).text(te.title)),se.append($("<ul>",{class:"bp_checkListConfig crm-font-regular f15 mL10"}));var re=$("<div>",{class:"f15 crm-font-regular mT15",id:"cl_completed_div"});re.append($("<span>",{id:"cl_completed"}).text("0")),re.append(" / "),re.append($("<span>",{id:"cl_total"}).text(ie.length)),re.append(" "),re.append(I18n.getMsg("Completed")),se.append(re),$("#duringTabDivs").append(se)}var oe=$("#checkListContainer"),ne=oe.find(".bp_checkListConfig"),le=!0;ie.each((function(e){var t=objectUtils.getKeys(e)[0],i=e[t],a=$("<li>",{value:t});le&&(a.addClass("pT0"),le=!1);var s=$("<label>",{class:"newCustomchkbox-md"});if(s.append($("<input>",{type:"checkbox",onclick:"ProcessFlow.handleChkListClick(this)",checked:i})),s.append($("<span>",{class:"vam chkbxIcon"})),s.append($("<span>",{class:"dIB vat mL5 cLC "+(i?"strikeT":"")}).text(t)),a.append(s),ne.append(a),i){var r=oe.find("#cl_completed").eq(0);r.text(parseInt(r.text().trim())+1)}}))}})),d.find(".infotoolTip").length&&crmTemplate.bindFldTooltip();var T=d.find("select");T.length&&thirdPartyUtils.bindSelect2(T),(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(e))&&CFRExec&&CFRExec.holdFormRule()&&(CFRExec.handleChangeEventForFREval(d),CFRExec.valChangesNeedsLayoutRuleEval(f)&&CFRExec.evalAjaxEditForLayoutRule(e,f,v)&&$("#fieldsContainer_header").removeClass("hide"));var I=ProcessFlow.getDuringTabtotalbWidth();if(I>900&&$("#multipleFieldsEditPop").removeClass("w900").addClass("w89per"),$("#duringTabs").css("width",I),s&&s.length>0){var y=$("<div class='p20' align='center' id='transitionBtnLayer'/>"),P=0;s.each((function(e){if(!e.IsAutoTrans&&e.IsAccessible){var t=e.IsCriteriaMatched?"pb_transitionState dIB grnBtn primarybtn bt-smallprimarybtn":"pb_transitionState dIB grnBtn primarybtn bt-smallprimarybtn bpTransDisable",i='<input data-zcqa="doTransition_'+$ESAPI.encoder().encodeForHTMLAttribute(e.TransitionName)+'" type="button" class="'+t+'" onclick="ProcessFlow.saveMulitipleFieldsEdit(\''+$ESAPI.encoder().encodeForJavaScript(e.TransitionRelId)+'\')" value="'+$ESAPI.encoder().encodeForHTMLAttribute(e.TransitionName)+'"/>';y.append(i),e.IsCriteriaMatched&&P++}})),P>0&&(d.append(y),d.find(".pp-footer").hide())}ProcessFlow.bpRelatedListTab($("#duringTabs").find("li:not(.hide)")[0]);var _=$(".fieldsContainer .labelValCreate input,.fieldsContainer .labelValCreate textarea").eq(0);if(void 0!==_){var D=_.attr("data-uitype");void 0!==D&&"1"!=D&&"110"!=D||_.addClass("focusEleField").focus()}c||crmui.showPopup("multipleFieldsEditPop",!0),crmTemplate.setDependentFields(e,"edit");var O=-1,S=-1,L=-1;for(var E in t)if(t.hasOwnProperty(E)){var x=t[E];x.FieldId==Crm.userDetails.isMultiPipelineActivated?O=E:null!=x.FieldObject&&x.FieldObject.uitype==CrmField.UITYPES.STAGE&&(S=E)}for(var F in n)n.hasOwnProperty(F)&&n[F].FieldId==Crm.userDetails.isMultiPipelineActivated&&(L=F);var V=[],A=t.length;if(Crm.userDetails.isMultiPipelineActivated&&-1==S)for(var k=0;k<A;k++)if("rlFields"===t[k].Type){for(var N=(V=t[k].FieldObjects).length,M=0;M<N&&!(O>-1&&S>-1);M++)O=V[M].FieldId===Crm.userDetails.isMultiPipelineActivated?M:O,S=V[M].FieldObject.uitype===CrmField.UITYPES.STAGE.toString()?M:S;S=O>-1?S:-1;break}if(O>-1&&S>-1){var R=$(document),B=(W=(z=V.length?V[O]:t[O]).FieldObject).default[0].html,U=V.length?z.Module:e,j=W.suffixIndex&&"Tasks"!=e&&"Calls"!=e&&"Events"!=e?U+"_"+W.suffixIndex:U;Crm.setDependentValuesByParentNameValue(j,W.colname,B,R,o)}else if(S>-1&&L>-1){R=$(document);var H=t[S];if(r.ProcessFieldId!=H.FieldId){var z,q=H.FieldObject,Y=q.suffixIndex&&"Tasks"!=e&&"Calls"!=e&&"Events"!=e?e+"_"+q.suffixIndex:e,J=q.parentcolname,W=(z=n[L]).FieldObject;Crm.setDependentValuesByParentNameValue(Y,J,W.defaultvalue,R)}}},ProcessFlow.designSubforForBPLayout=function(e){e.removeClass("pL30 pR30"),e.find(".contHeadInfo").removeClass("contHeadInfo"),e.find(".subFrmAggTablWrapper").css({"max-width":"100%",width:"100%"}),e.find(".subFrmTablWrapper").addClass("leftFixedSubFrmDisp")},ProcessFlow.getStageVsDetails=function(e){for(var t=e.length,i={},a=0;a<t;a++)if("none"!==e.value){var s=e[a];i[e[a].html]=s}return i},ProcessFlow.restructureDuringFieldObj=function(e){for(var t={},i=-1,a=e.length,s=0;s<a;s++)if(e[s].FieldId===Crm.userDetails.isMultiPipelineActivated){i=s;break}if(i>-1){var r=e[i].FieldObject;Array.isArray(r.picklistmap)&&!r.picklistmap.some((function(e){e.uservalue,r.defaultvalue}))?r.defaultvalue=r.picklistmap[0].uservalue:r.picklistmap.uservalue&&r.defaultvalue!=r.picklistmap.uservalue&&(r.defaultvalue=r.picklistmap.uservalue)}if(i>-1&&!e.some((function(e){return e.FieldObject&&e.FieldObject.uitype==CrmField.UITYPES.STAGE}))){var o=JSON.parse($("#mouseArea__STAGE").attr("data-params")),n={FieldId:o.fieldid,ModLabel:Crm.moduleInfo.Potentials.apiname,Module:o.module,Type:"Field",FieldObject:o};e.splice(i+1,0,n)}a=e.length;var l=[];for(s=0;s<a;s++){var d=e.splice(0,1)[0];"rlFields"===d.Type?(void 0===t[d.FieldObject.relListId]&&(t[d.FieldObject.relListId]=[],l[l.length]=void 0),t[d.FieldObject.relListId].push(d)):l.push(d)}var c=0,u=l.length;for(var m in t){var p=t[m],f={Type:"rlFields"};f.Module=p[0].Module,f.ModLabel=p[0].ModLabel,f.FieldObjects=p,f.LayoutId=p[0].FieldObject.LayoutId,f.relListId=m,f.relListName=p[0].FieldObject.persName,f.relListLabel=p[0].FieldObject.relListLabel;var v=!1;for(s=c;s<u;s++)if(void 0===l[s]){l[s]=f,c=s,v=!0;break}v||l.push(f)}return l},ProcessFlow.getParamsForMulitipleFieldsSave=function(e,t,i){var a={};a.module=e||$("#multipleFieldEditModule").val(),a.moduleid=t||$("#multipleFieldEditEntityId").val(),a.transitionRelId=i||$("#multipleFieldEditTransRelId").val();var s={},r={};for(var o in Crm.requestParamWithColname){var n=Crm.requestParamWithColname[o];if(o.indexOf("_")>-1){var l={value:n},d=o.split("_")[1];if(-1!=$.inArray(d,Crm.requestParamWithColname))var c=$("#Crm_"+a.module+"_"+d).data();else c=$("#mouseArea__"+d).data().params;l.id=void 0!==c.id?c.id:c.defaultid,l.lookupmodule=c.lookupmodule,r[o]=l}else s[o]=n}var u={ChildModuleFields:s,ParentModuleFields:r};return a.duringFields=JSON.stringify(u),a},ProcessFlow.saveFields=function(e,t,i,a,s){$("#pb_processButtonLayerInner, #transitionBtnLayer").find(".pb_transitionState").addClass("eventNone"),$("#multipleFieldEditSaveBtn").prop("disabled",!0),t.hasMXNField=$("#multipleFieldsEditPop .bp-mxn-field").length>0,t[ProcessFlow.ACTION]=ProcessFlow.TRANSITION_FIELD_UPDATE,commonUtils.showHideLoadingDiv(!0),networkUtils.setCsrfParam(t),detailView.isWFExecInKafka=!1,detailView.refreshInWms=!1,(new crmRequestPool).initiate({type:ProcessFlow.POST_REQUEST_TYPE,action:ProcessFlow.TRANSITION_URL,data:t,success:function(t){if(t[ProcessFlow.STATUS]===ProcessFlow.RESPONSE_SUCCESS){isWFKafkaUser()&&(detailView.isWFExecInKafka=t.isWFExecInKafka,detailView.refreshInWms=t.callWMS,detailView.prevModule=t.module),$("#bp-attachment").remove(),ProcessFlow.destroyUploaderObj(),ProcessFlow.removeMultiUserDropdown(),commonUtils.showHideLoadingDiv(!1);var r=$("#duringTabDivs").find(".activitesColor");if(r.length>0){var o=r.css("background-color"),n=$("#detailView_"+i).find(".activitesColor");n.length>0?n.css("background-color",o):$("#cvlist_"+i).find("a").append('<span class="activitesColor" data-zcqa="relcvColor_'+i+'" style="background: '+Events.rgbtohex(o)+'"></span>')}if(CFRExec&&CFRExec.relatedEntityMap&&($("#pb_processButtonLayerInner, #transitionBtnLayer").find(".pb_transitionState").removeClass("eventNone"),CFRExec.relatedEntityMap={}),a){var l=t.DuringFields;commonUtils.showHideLoadingDiv(),ProcessFlow.currentTransitionDetails=t.Transition;for(var d=t.NextTransitions?t.NextTransitions:[],c=!1,u=d.length,m=[],p=0;p<u;p++)d[p].IsCriteriaMatched&&m.push(d[p]),c=c||d[p].IsCriteriaMatched;ProcessFlow.nextTransitions=ProcessFlow.nextTransitions.concat(m),ProcessFlow.duringFieldDetails=l,l.length>1||c?ProcessFlow.showDuringTransitionFieldsPop(e,l,i,a,m,t.Transition):ProcessFlow.saveStateChange(e,i,ProcessFlow.currentTransitionDetails.ProcessFieldId,a)}else ProcessFlow.postTransitionAction(e,i,s)}else if("FILTER_CRITERIA_NOT_SATISFIED"===t.Status){var f=[];ProcessFlow.getAllRelatedModulesInDuringTrans(f);var v=$("#Crm_"+t.data.MODULE+"_"+f[0].relId+"_"+t.data.COLUMNNAME);if(0!==v.length){var g=t.data.SINGULARTABLABEL;Crm.showErrorMsg(I18n.getMsg("crm.lookupfilter.entity.errormsg",g),v,t.MODULE,!0)}else renderingUtils.showMsgBox(I18n.getMsg("crm.lookupfilter.migration.criteria.error",t.data.FIELDLABEL),"error")}else if("DUPLICATE"===t.Error){$("#multipleFieldEditSaveBtn").prop("disabled",!1),$("#pb_processButtonLayerInner, #transitionBtnLayer").find(".pb_transitionState").removeClass("eventNone");var h=t.UNIQFIELD_DETAILS,C=h.length;if(h&&C>0)for(p=0;p<C;p++){var w=h[p],b=crmTemplate.getElemIdByColname(e,w.COLUMNNAME),T=Crm.getDuplicateErrorMsg(w,!1,!0);Crm.showErrorMsg($ESAPI.encoder().encodeForHTMLAttribute(T),$("#"+b),e,!0)}}else"Tags"===objectUtils.getValueFromObj(t,["Error","api_name"])?(renderingUtils.showAlertMsg(I18n.getMsg("crm.tags.records.limit.reached",t.Error.limit),"error"),$("#multipleFieldEditSaveBtn").prop("disabled",!1),$("#pb_processButtonLayerInner, #transitionBtnLayer").find(".pb_transitionState").removeClass("eventNone")):ProcessFlow.showFieldValidationErrors(e,t.FiledsValdation);commonUtils.showHideLoadingDiv()}}),1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&detailView.setCurrentStageSetOnChange()},ProcessFlow.refreshButtonLayer=function(e,t,i,a,s){var r={};r[ProcessFlow.ACTION]=ProcessFlow.GET_NEXT_TRANSITION,r.module=e,r.entityId=t,(new crmRequestPool).initiate({type:ProcessFlow.GET_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:r,success:function(r){$("[id=pb_configProcess][entityId="+t+"]").remove();var o=!1;if("canvas"===Lyte.Router.getRouteInstance().routeName||"canvas"===Lyte.Router.getRouteInstance().parent.routeName){var n=Lyte.registeredMixins["crm-detailcanvas-utils"],l=n.showStage,d=n.isBluePrintTrans,c=!!Lyte.Router.getRouteInstance().currentModel&&(Lyte.Router.getRouteInstance().currentModel.record&&Lyte.Router.getRouteInstance().currentModel.record.$process_flow);"Potentials"!==e||l||d||!c||(o=!0)}if(void 0!==r.NextTransitions&&r.NextTransitions.Transitions.length>0){ProcessFlow.recordIdVsTransitionDetails[t]=r.NextTransitions;for(var u=r.NextTransitions.IsCriteriaTransEnabled,m=r.NextTransitions,p=!1,f=!1,v=r.NextTransitions.Transitions,g=v.length,h=0;h<g;h++)if(v[h].IsCriteriaMatched&&v[h].IsAccessible){p=!0;break}for(h=0;h<g;h++)v[h].IsAccessible&&(f=!0),ProcessFlow.transitionIdVsTransitionDetails[v[h].TransitionId]=v[h];if(m.IsAccessibleTransitionAvailable=f,m.IsActiveTransitionFound=p,m.IsTransitionFound=u?f:p,m.IsCriteriaTransEnabled=u,m.PreviewLink="<span data-zcqa='pa_preview_transition_actions' class='pb_link' onclick=\"ProcessFlow.showTransitionPreview('"+$ESAPI.encoder().encodeForJavaScript(t)+"')\">"+I18n.getMsg("crm.process.view.process.preview")+"</span>",m.orchestrations=i,m.autoTransAvailable=!v.every((function(e){return!e.IsAutoTrans})),p&&(m.isbothactive=!0),a&&(m.isIntercepted=!0),!clientPortalName&&!o||"canvas"!==Lyte.Router.getRouteInstance().routeName&&"canvas"!==Lyte.Router.getRouteInstance().parent.routeName){var C=Handlebars.templates.TransitionButtonLayer(m),w=!1;if(s)(O=s.querySelector(".crm-blueprint-lyte-comp"))&&($(O).html(C),w=!0);if(!w&&$("#pb_processButtonLayer").html(C),u){var b=networkUtils.returnDependencyFiles(["lyte-hovercard.js","crm-blueprint.js"],crmConstants.jsStaticPathForLyte),T=networkUtils.returnDependencyFiles(["crm-blueprint-dependents.css"],crmConstants.cssStaticPathForLyte);T=T.concat(b),Lyte.injectResources(T,void 0,(function(){Lyte.Component.render("crm-blueprint-hovercard",{buttonElementId:"#InnerTransDivider",criteriaString:""},"#bp_hoverCardDiv")}))}$(".pb_processDiv .TransDivider").find(".pb_transitionState.primarybtn.bt-smallprimarybtn.bpTransDisable").each((function(){var e=$(this),t=ProcessFlow.transitionIdVsTransitionDetails[e.data("transitionid")].Summary;e.attr({onmouseover:'ProcessFlow.showCriteriaSummary(this,"'+t+'")',onmouseout:"ProcessFlow.hideCriteriaSummary()"})}))}else ProcessFlow.getClientPortalStatus(m.CurrentStateDisplayValue);if("canvas"==Lyte.Router.getRouteInstance().routeName&&"Potentials"==e){var I=$("#pb_processButtonLayer").closest(".zc-list-component").find(".zcanvas-title-editor").find(".zcstatictext");if(!clientPortalName&&I[0].innerText==I18n.getMsg("Stage")){I[0].innerText=I18n.getMsg("crm.label.cf.blueprint");var y=$(I[0]).closest(".zc-tab-content")[0],P=y?y.id:void 0;if(P){var _=$(".tab[data-tab=#"+P+"]")[0];_&&_.innerText==I18n.getMsg("Stage")&&(_.innerText=I18n.getMsg("crm.label.cf.blueprint"))}}}"canvas"===Lyte.Router.getRouteInstance().routeName&&(Lyte.registeredMixins["crm-detailcanvas-utils"].blueprintFldId=r.NextTransitions.ProcessFieldId)}else if("canvas"===Lyte.Router.getRouteInstance().routeName||"canvas"===Lyte.Router.getRouteInstance().parent.routeName||s)if((clientPortalName||o)&&void 0!==r.NextTransitions)ProcessFlow.getClientPortalStatus(r.NextTransitions.CurrentStateDisplayValue);else{var D=document.createElement("div");D.append(I18n.getMsg("crm.canvas.blueprint.empty")),D.classList.add("emptyBlueprintMessage");var O,S=$("#pb_processButtonLayer");if(s)(O=s.querySelector(".crm-blueprint-lyte-comp"))&&(S=$(O));S.length>0&&0===S[0].children.length&&S[0].append(D),S.addClass("rl_NoRec")}else $("#pb_processButtonLayer").remove();var L=Lyte.registeredMixins["crm-detailcanvas-utils"];L&&L.onSpecialCompLoaded(["stage_navigator","blueprint"])}})},ProcessFlow.getFieldElemIds=function(e,t){var i={};t.find(".labelValCreate [data-colname]").each((function(t,a){var s=$(a),r=s.attr("id");if($.inArray(r,e)>-1||"Crm_Calls_CALLDURATION_Mins"==r||"Crm_Calls_CALLDURATION_Secs"==r){var o=s.data("suffixindex");if(void 0===s.data("reasonrestrict")){void 0===o&&(o="childField");var n=[];i.hasOwnProperty(o)&&(n=i[o]),n.push(r),i[o]=n}}}));var a=t.find(".PRODUCTDETAILS").length;$.each(e,(function(e,t){if(t.endsWith("_PRODUCTDETAILS")){var s=t.split("_")[2];if(a>0){var r=[];return i.hasOwnProperty(s)&&(r=i[s]),r.push(t),i[s]=r,!1}}}));var s=t.find(".subFrmAggTablWrapper");if(s.length>0){var r=t.find(".subFrmTablWrapper table").attr("rellistid");s.find("input").each((function(){var t=$(this).attr("id");if($.inArray(t,e)>-1){var a=[];i.hasOwnProperty(r)&&(a=i[r]),a.push(t),i[r]=a}}))}return i},ProcessFlow.removeNoteMandatory=function(){var e=$("#transitionNotesDiv"),t=e.find(".newmandatory");e.find(".errMsg").remove(),t.removeClass("errorFieldP")},ProcessFlow.removeNoteMandatory=function(){ProcessFlow.removeMandatoryErrIndicator($("#transitionNotesDiv"))},ProcessFlow.removeTagsMandatory=function(){ProcessFlow.removeMandatoryErrIndicator($("#transitionTagsDiv"))},ProcessFlow.removeMandatoryErrIndicator=function(e){var t=e.find(".newmandatory");e.find(".errMsg").remove(),t.removeClass("errorFieldP")},ProcessFlow.saveMulitipleFieldsEdit=function(e){var t=$("#multipleFieldsEditPop"),i=t.find(".fieldsContainer"),a=$("#multipleFieldEditModule").val(),s=$("#multipleFieldEditEntityId").val(),r=i.find(".labelValCreate div[id^='Crm_'],:input[id^='Crm_'],crm-user-wrapper[id^='Crm_']").not("input[id$='_TimeOption']"),o=!1,n=!0,l=ProcessFlow.isAllFldsEmpty(a),d=!(!ProcessFlow.ExcecutionObjs.isContinuousBP&&!e),c=i.find(".LR").length>0,u=l||d||c,m=[],p=r.length;for(X=0;X<p;X++)m.push($(r[X]).attr("id"));if(n){var f=ProcessFlow.getFieldElemIds(m,$("#fieldsContainer")),v={};for(var g in f)if(f.hasOwnProperty(g)&&(n=n&&Crm.validateEntityAndShowErrorMsg(f[g],a,!0,void 0,!u),v[g]=Crm.requestParamWithColname,crmTab.isLinkingModule(a)))for(var h=f[g].length,C=0;C<h;C++){if((A=$("#"+f[g][C])).data("colname").startsWith("LINKINGMXN")&&A.data("isMXNDuplicate"))return Crm.showErrorMsg(I18n.getMsg("crm.blueprint.duplicate.association"),A,a,!0),!1}}var w=[];ProcessFlow.getAllRelatedModulesInDuringTrans(w);for(var b=w.length,T={},I={},y=$("#Crm_Calls_CALLSTARTDATETIME"),P=$("#Calls_rlContainer_header"),_=$("#Crm_Calls_CALLSTARTDATETIME_label"),D=_.closest(".tabDivCreate"),O=0;O<b;O++){var S=w[O],L=S.relId,E=S.module;I[L]=E;m=Crm.fieldsObj[E];var x=ProcessFlow.getFieldElemIds(m,$("#"+L+"_rlContainer"));for(var g in x)if(x.hasOwnProperty(g)){var F={isContinuous:!!e,relListId:L,fieldsArr:x[g],isFrmBP:!0},V=Crm.validateEntityAndShowErrorMsg(x[g],E,!0,void 0,!u,F);if(n=n&&V,"Calls"==E&&-1!==x[g].indexOf("Crm_Calls_CALLSTARTDATETIME")&&-1===Object.keys(Crm.requestParamWithColname).indexOf("CALLSTARTDATETIME")&&void 0!==y)return void 0!==P&&void 0!==P.data("tab")&&ProcessFlow.bpRelatedListTabSwitch(P.data("tab")),D.addClass("labelValTwo"),Crm.showErrorMsg(I18n.getMsg("crm.field.empty.check",$ESAPI.encoder().encodeForHTML(y.data("displaylabel"))),_,"Calls",!0),!1;if(crmTab.isLinkingModule(E))for(h=x[g].length,C=0;C<h;C++){var A;if((A=$("#"+x[g][C])).data("colname").startsWith("LINKINGMXN")&&A.data("isMXNDuplicate"))return Crm.showErrorMsg(I18n.getMsg("crm.blueprint.duplicate.association"),A,E,!0),!1}T[g]=Crm.requestParamWithColname,Crm.isInventoryModule(E)&&!Crm.userDetails.isLineItemSubformMvmtDone&&ProcessFlow.addProductDetailsInfoInReqParams(T[g],$("#"+L+"_rlContainer #totalProductCount").val(),"PRODUCTDETAILS");var k=crmTab.tabVsSubTabs[E],N=!0,M=!1;if(k&&k.length>0){for(var R=k.length,B=0;B<R;B++)N=N&&F[k[B]].resultObj.mandateFailed,M=M||F[k[B]].resultObj.maxRowlimitFailed;if(!(Object.keys(T[g]).length>0)&&N||M)for(B=0;B<R;B++){if((j=$("#subform_"+k[B])).attr("rellistid")===g){var U=j.data("dataSubformsectionlabel").replace(" ","_");U="secHead_"+U,Crm.showErrorMessage(F[k[B]].resultObj,$("#"+U),a,j.data("dataColumnname"),j.data("dataSubformsectionlabel"),j.data())}}else for(var B=0;B<R;B++){var j;if((j=$("#subform_"+k[B])).attr("rellistid")===g){var H=j.find("tbody tr").closest("table").data("data-columnname"),z=T[g];z[H]=Crm.requestParam["property("+H+")"];var q=F[k[B]].aggFldObj;for(var Y in q)z[Y]=q[Y]}}}}}var J=$("#transitionNotes"),W=void 0;if(J.length>0){W=$("textarea[id='transitionNotes']").val().trim();try{Notes.tempNotes&&(Notes.tempNotes=Notes.tempNotes.trim()),Notes.transNoteContent?W=Notes.transNoteContent:Notes.tempNotes&&W&&(W=Notes.tempNotes)}catch(e){}u&&(!W||W.length<=0?(Crm.showErrorMsg(I18n.getMsg("crm.process.notes.not.empty"),J,a,!0),o=!0,n=!1):ProcessFlow.removeNoteMandatory()),W.length>3e3?(Crm.showErrorMsg(I18n.getMsg("crm.process.notes.limit.error"),J,a,!0),o=!0,n=!1):W.length>0&&ProcessFlow.removeNoteMandatory()}var G=$("#transitionAttachDiv .labelValCreate"),Q=void 0!==G[0]?$(G[0]):void 0;void 0!==Q&&u&&"true"!==Q.attr("isAttachmentAdded")&&(Crm.showErrorMsg(I18n.getMsg("crm.process.empty.attachment"),G.children(),a,!0),o=!0,n=!1);var K=document.querySelector("#transitionTagsDiv crux-tag");if(K&&(u&&0==K.component.getData("cxPropTags").length?(Crm.showErrorMsg(I18n.getMsg("crm.tag.not.empty"),$(K),a,!0),o=!0,n=!1):ProcessFlow.removeTagsMandatory()),u){$.each($("#checkListContainer .bp_checkListConfig li"),(function(e,t){if(!$(t).find("input").eq(0).is(":checked"))return!1}));var X=0;if((b=(be=ProcessFlow.getCheckListDet()).length)>0){for(var Z=!0,ee=0;ee<b;ee++){var te=be[ee];!0===te[Object.keys(te)[0]]&&(Z=!1,X+=1)}d&&X!==b&&(Z=!0);$("#duringTabDivs #checkListContainer .errMsg");if(u&&Z&&Z&&!o&&(ProcessFlow.bpRelatedListTabSwitch("checkListContainer"),$("#checkListContainer").hasClass("current")))return crmui.showMsgBand("alert",I18n.getMsg("crm.process.checklist.not.empty"),2e3,t),!1;n=n&&!Z}}if(o&&(n=!1),!n)return setTimeout((function(){var e=$("#duringTabDivs"),t=e.find(".errMsg.errorMsgDesc");0===t.length&&(t=e.find("#addLinesBtnLwr .errMsg")),t=0===t.length||o?"fieldsContainer":t.eq(0).parents(".moduleParent").attr("id"),$("ul.bpRLcommentabmenu li").removeClass("sel"),$(".bpRl-tab-content").removeClass("current"),$("#"+t+"_header").addClass("sel"),$("#"+t).addClass("current")}),500),!1;var ie={};ie.module=a,ie.moduleid=s,ie.transitionRelId=$("#multipleFieldEditTransRelId").val();var ae={},se={};for(var re in v)if(v.hasOwnProperty(re)){var oe=v[re];for(var ne in oe)if(oe.hasOwnProperty(ne)){var le=oe[ne];if("STAGE"===ne&&-1!==le.indexOf(":")&&(le=le.substring(le.indexOf(":")+1)),"childField"!==re){var de={};if(se.hasOwnProperty(re))de=se[re];else{var ce=null,ue=null,me=$("#Crm_"+a+"_"+re).data();if(void 0!==me)ce=me.id,ue=me.lookupModule;else{var pe=ne;"SALUTATION"===ne&&(pe="FIRSTNAME_"+ne);var fe=$("#Crm_"+a+"_"+re+"_"+pe);ce=fe.data("entityid"),ue=fe.data("entitymodule")}de.id=ce,de.lookupmodule=ue}de[ne]=le,se[re]=de}else ae[ne]=le}}for(var ve in T){var ge=I[ve];for(depRelCol in T[ve]){le=T[ve][depRelCol];if("STAGE"===depRelCol&&-1!==le.indexOf(":")&&(le=le.substring(le.indexOf(":")+1),T[ve][depRelCol]=le),"ACCOUNTID"===depRelCol&&"Accounts"!=ge){""!==le&&void 0!==le?le+=":":le=":";var he=$("#Crm_"+ge+"_"+ve+"_"+depRelCol).val();T[ve][depRelCol]=le+he}}}v={ChildModuleFields:ae,ParentModuleFields:se,rlDetails:T};if(ie.duringFields=JSON.stringify(v),ie.Notes=W,$("#transitionAttachDiv .labelValCreate").children().attr("type")&&(ie.Attachments=JSON.stringify(ProcessFlow.getAttachmentsJSON())),e&&(ie.NextTransitionRelId=e),K){var Ce=K.component.getData("cxPropTags"),we=Ce.length;for(ee=0;ee<we;ee++)"noFill"===Ce[ee].color_code&&(Ce[ee].color_code=null);Ce.length>0&&(ie.Tags=JSON.stringify(Ce))}var be=ProcessFlow.getCheckListDet();Object.keys(be).length>0&&(ie.checkLists=JSON.stringify(be)),ProcessFlow.validateAndSaveFields(a,ie,s,e,ProcessFlow.ExcecutionObjs.entityName),void 0!==detailView.oldfieldUpdateJson&&detailView.oldfieldUpdateJson.length>0&&detailView.updateTimerValue(),Notes.transNoteContent=void 0,t.find(".lyteMentionsInnerDiv").length>0&&Notes.destroyMentionsComponent("transitionNotes")},ProcessFlow.showFieldValidationErrors=function(e,t){if(t){for(var i,a=t.length,s=0;s<a;s++){var r="";if("Notes"===t[s].ColumnName||"Attachments"===t[s].ColumnName)r="transition"+t[s].ColumnName,t[s].IsValid?$("#errorMsg_"+r).hide():(Crm.showErrorMsg($ESAPI.encoder().encodeForHTML(t[s].Error),$("#"+r),e,!0),i||(i="fieldsContainer"));else{if(5===t[s].type){var o=t[s].ColumnName.split("::");if("Events"!=o[1]&&"Tasks"!=o[1]&&"Calls"!=o[1]&&(o[0]=t[s].relListId+"_"+o[0]),t[s].hasOwnProperty("index")){o[0]=o[0]+"_"+(t[s].index+1);var n=(r=$($("#subform_"+t[s].relListId).find("tr"))[t[s].index]).querySelector("textarea[data-colname="+t[s].ColumnName.split("::")[0]+"]");r=n?n.id:r.querySelector("input[data-colname="+t[s].ColumnName.split("::")[0]+"]").id}else r=crmTemplate.getElemIdByColname(o[1],o[0])}else r=crmTemplate.getElemIdByColname(e,t[s].ColumnName);"Crm_Events_LOCATION"===r||"Crm_Events_SUBJECT"===r||t[s].hasOwnProperty("index")||(r+="_label"),t[s].IsValid?$("#errorMsg_"+r).hide():(i||5!==t[s].type?i||(i="fieldsContainer"):i=t[s].relListId+"_rlContainer",t[s].Error.includes("Duplicate")||(t[s].Error=$ESAPI.encoder().encodeForHTML(t[s].Error)),$("#"+r).closest(".tabDivCreate").addClass("labelValTwo"),Crm.showErrorMsg(t[s].Error,$("#"+r),e,!0),setTimeout(ProcessFlow.addStyleToErrorMsg(r),501))}}$("#multipleFieldsEditPop #duringTabs #"+i+"_header").addClass("sel");var l=$("#"+i);setTimeout((function(){l.scrollTo(l.find(".errorFieldP:eq(0)"))}),600)}else crmui.showMsgBand("error","Error while saving Transition.",4e3,"");$("#multipleFieldEditSaveBtn").prop("disabled",!1),$("#pb_processButtonLayerInner, #transitionBtnLayer").find(".pb_transitionState").removeClass("eventNone")},ProcessFlow.addStyleToErrorMsg=function(e){return function(){$("#errorMsg_"+e).css("white-space","initial")}},ProcessFlow.getFieldIdVsFieldDetailsJson=function(e,t){var i={};return t.each((function(e){if("Field"===e.Type){var t=e.FieldObject;i[t.fieldid]=t}})),i},ProcessFlow.cancelProcessReOrder=function(){$("#saveReOrderBtn, #cancelReOrderBtn").hide(),$("#reOrderBtn").show(),$("#modOpt").prop("disabled",!1);var e=$("#processDataContainer");e.find(".processDataRow").removeClass("reorderIc");var t=ProcessFlow.processCurrentViewResponse,i=Handlebars.templates.ProcessListViewData({processes:t.Processes,isReOrder:t.ALLOWREORDER});e.html(i);var a=$("#processListHeader"),s=$("#processDataContainer");a.find("#status").val("All"),a.find("select").prop("disabled",!1),$("#bluePrintSearchTxt").css("pointer-events",""),s.removeClass("cM ui-sortable"),s.sortable("destroy"),$("#bp_reorderHintMgs").addClass("hide"),ProcessFlow.hideCreateProcessButtonOnLimitExceed(ProcessFlow.PROCESS_COUNT)},ProcessFlow.updateProcessStatus=function(e,t,i){var a=$("#processDataRow_"+e),s="Active"===a.attr("data-status")?"InActive":"Active",r=a.attr("data-module");if("InActive"!==s||t){var o=!1;i&&"exit"===$("#deleteprocesspopup input[name='recordaction']:checked").val()&&(o=!0),"Active"==s?Crm.trackSpotLightAction("Process Automation - Active Click"):Crm.trackSpotLightAction("Process Automation - DeActivate Click"),commonUtils.showHideLoadingDiv(!0);var n={};n[ProcessFlow.ACTION]=ProcessFlow.UPDATE_PROCESS_STATUS,n.module=r,n.processId=e,n.status=s,n.IsExitRecords=o,networkUtils.setCsrfParam(n),(new crmRequestPool).initiate({type:ProcessFlow.POST_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:n,success:function(t){if(t[ProcessFlow.STATUS]===ProcessFlow.RESPONSE_SUCCESS)ProcessFlow.processCurrentViewResponse.Processes.each((function(t){t.Id==e&&(t.ProcessStatus=s)})),crmui.hidePopup("deleteprocesspopup"),commonUtils.showHideLoadingDiv(),a.attr("data-status",s),a.find("input.onOffcb").prop("checked","Active"===s),a.find(".hoverDiv").removeAttr("onmouseover").mouseover((function(){crmui.toolTip_show(this,"center","Active"===s?I18n.getMsg("Active"):I18n.getMsg("Inactive"))}));else if(t.Error===ProcessBuilder.LIMIT_REACHED||"LAYOUT_DEACTIVATED"==t.Error)renderingUtils.showCustomAlert(t.ErrorMsg),commonUtils.showHideLoadingDiv();else if(t.Error===ProcessBuilder.LICENSE_TYPE_NOT_SUPPORTED){commonUtils.showHideLoadingDiv();var i=ProcessBuilder.getUnsupportedConfigurationMessage(["blueprint.unsupported.sla.actions","blueprint.automatictransition","crm.label.widgets"]),r='<div class="alertPrimaryMsg">'+I18n.getMsg("unsupported.configuration")+'</div><div class="alertSecondaryMsg">'+i+"</div>",o={val:I18n.getMsg("review.blueprint"),fn:function(){Lyte.Router.transitionTo("crm.settings.section.blueprint.view-blueprint",e)}},n={val:I18n.getMsg("crm.button.cancel")};$("#customConfirmationPop").addClass("bpLicenseErr"),ProcessBuilder.showWarning(r,n,o)}},error:function(e){"object"==typeof e.responseJSON&&"Usage of V1 API is Deprecated"==e.responseJSON.message&&renderDenyTemp(e.responseJSON,"blueprint","statuschange")}})}else ProcessFlow.confirmDeleteWarning("ProcessFlow.updateProcessStatus",window,"crm.process.deactivate.warning","inactive",e,!0)},ProcessFlow.getRecordInvolvedCount=function(e){commonUtils.showHideLoadingDiv(!0);var t={RecordCount:0,IsMigrationInProgress:!1},i={};return i[ProcessFlow.ACTION]=ProcessFlow.GET_RECORDSINVOLVED_COUNT,i.processId=e,i.module=$("#modOpt").val(),(new crmRequestPool).initiate({type:ProcessFlow.GET_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:i,async:!1,success:function(e){commonUtils.showHideLoadingDiv(),e[ProcessFlow.STATUS]===ProcessFlow.RESPONSE_SUCCESS&&(t=e)}}),t},ProcessFlow.deleteProcess=function(e,t){var i=$("#processDataRow_"+e);"undefined"==t&&(t=i.attr("data-module")),commonUtils.showHideLoadingDiv(!0);var a={};a[ProcessFlow.ACTION]=ProcessFlow.DELETE_PROCESS,a.module=t,a.processId=e,networkUtils.setCsrfParam(a),(new crmRequestPool).initiate({type:ProcessFlow.POST_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:a,success:function(){ProcessFlow.PROCESS_COUNT--,crmui.hidePopup("deleteprocesspopup"),commonUtils.showHideLoadingDiv(),i.remove();var t=[];ProcessFlow.processCurrentViewResponse.Processes.each((function(i){i.Id!==e&&t.push(i)})),ProcessFlow.processCurrentViewResponse.Processes=t,t.length<=1&&$("#reOrderBtn").hide();var a=$("#pa_createProcessBtn");a.show(),ProcessFlow.PROCESS_COUNT<ProcessFlow.PROCESS_LIMIT&&a.prop("disabled",!1)}}),Crm.trackSpotLightAction("Process Automation - Delete Process",{Module:t})},ProcessFlow.getLayoutAndFields=function(e){var t={};(t[ProcessFlow.ACTION]=ProcessFlow.GET_LAYOUT_AND_FIELDS,t.module=e,ProcessFlow.moduleVsLayouts[e])||(commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({type:ProcessFlow.GET_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:t,async:!1,success:function(t){commonUtils.showHideLoadingDiv(),ProcessFlow.moduleVsLayouts[e]=t.Layouts,ProcessBuilder.Process.AproverMeta=t.AproverMeta,BluePrintUserUtil&&BluePrintUserUtil.initUserComboBox(t.AproverMeta),ProcessFlow.moduleProcessLength[t.selectedModule]=t.selectedModuleLength}}));return ProcessFlow.moduleVsLayouts[e]},ProcessFlow.getLayoutOptions=function(e){if(ProcessFlow.getLayoutAndFields(e),Array.isArray(ProcessFlow.moduleVsLayouts[e])&&0!=ProcessFlow.moduleVsLayouts[e].length){r="";for(var t=ProcessFlow.moduleVsLayouts[e].length,i=0;i<t;i++){var a=ProcessFlow.moduleVsLayouts[e][i],s=a.Name;r+="Standard"==s?"<option value='"+$ESAPI.encoder().encodeForHTMLAttribute(a.Id)+"'>"+$ESAPI.encoder().encodeForHTML(I18n.getMsg("Standard"))+"</option>":"<option value='"+$ESAPI.encoder().encodeForHTMLAttribute(a.Id)+"'>"+$ESAPI.encoder().encodeForHTML(s)+"</option>",ProcessFlow.layoutIdVsFields[a.Id]=a.Fields}}else var r="<option value='none'>-"+I18n.getMsg("None")+"-</option>";return r},ProcessFlow.updateFieldOptions=function(e){var t="<option value='none'>-"+I18n.getMsg("crm.label.picklist.none")+"-</option>";if("none"!=e)for(var i=ProcessFlow.layoutIdVsFields[e].length,a=0;a<i;a++){var s=ProcessFlow.layoutIdVsFields[e][a];t+='<option colname="'+$ESAPI.encoder().encodeForHTMLAttribute(s.Column)+'" value="'+$ESAPI.encoder().encodeForHTMLAttribute(s.Id)+'">'+$ESAPI.encoder().encodeForHTML(s.Label)+"</option>"}var r=$("#processFieldListTmp");r.find("select").html(t),r.find(".select2-selection__rendered").text(I18n.getMsg("crm.label.picklist.none")).attr("title",I18n.getMsg("crm.label.picklist.none")),$("#pipelineInput").hide()},ProcessFlow.showCreateProcessPop=function(e,t){var i=renderingUtils.windowHeight,a=$("#modOpt");e="All"==(e=e||a.val())?a.find("option").eq(1).attr("value"):e,commonUtils.showHideLoadingDiv(!0);var s=$("#createProcessPopDiv"),r=ProcessFlow.getLayoutOptions(e);if(!s.is(":visible")){var o,n=ProcessFlow.SUPPORTED_MODULES;(o=n.indexOf("Calls"))>-1&&n.splice(o,1);var l=Handlebars.templates.CreateProcessPop({modulesList:n});s.html(l),$("#pipelineInput").hide(),$("#ruleNameTmp, #ruleDescTmp").val(""),crmui.showPopup(s.attr("id"),!0),wfForm.initFormClick(),$("#limitWarnDIV").hide();a=$("#moduleSel"),"object"==typeof Crm.userDetails.MODULE_LIST?Crm.userDetails.MODULE_LIST:JSON.parse(Crm.userDetails.MODULE_LIST);a.trigger("chosen:activate"),a.val(e),a.trigger("change.select2")}var d=$("#processLayoutListTmp");d.find("select").html(r);var c=d.find("option").eq(0).text();c=="-"+I18n.getMsg("None")+"-"?d.find(".select2-selection__rendered").text(I18n.getMsg("None")).attr("title",I18n.getMsg("None")):d.find(".select2-selection__rendered").text(c).attr("title",c),ProcessFlow.updateFieldOptions(d.find("select").val()),t&&ProcessBuilder.showCriteriaEditor(e,void 0,"process",!0),commonUtils.showHideLoadingDiv(),$("#processNameTmp").focus(),$('<style type="text/css">.pp-content{ max-height:'+(i-230)+"px !important;}</style>").appendTo(document.head),$(".searchfld").each((function(){"Calls.Billable"!=$(this).val()&&$(this).parent().find("select option[value='Calls.Billable']").remove().trigger("change.select2")})),store.unloadAll("layout")},ProcessFlow.hideCreateProcessPop=function(){crmui.hidePopup("createProcessPopDiv"),ProcessFlow.moduleVsLayouts={},ProcessFlow.layoutIdVsFields={},thirdPartyUtils.unbindPerfectScroll("#createProcessPopDiv .pp-content")},ProcessFlow.showRemindDiv=function(e,t){1==$(e).is(":checked")?$("#"+t).css("opacity",0).slideDown(300).animate({opacity:1},{queue:!1,duration:400}):$("#"+t).slideUp("fast")},ProcessFlow.setExitAsFlowChangeAction=function(){ProcessBuilder.flowChangeAction="exit"},ProcessFlow.initProcessBuilder=function(e){(Crm.userDetails.ISROMODE||!0===ProcessBuilder.isReportPreview)&&(ProcessBuilder.isBlueprintROMode=!0),ProcessFlow.initProcessBuilder_beforeRender(e);var t=Handlebars.templates.ProcessBuilder({Process:ProcessBuilder.Process});ProcessBuilder.TransitionIdVsDetails={};var i=$("#result");if(i.html(t),ProcessBuilder.Process.IsReadOnly||ProcessBuilder.Process.IsOrphanProcess){var a='<div class="bp-transparentLayer-forProcess"></div>';if(i.find("#canvasContainer").prepend(a),i.find(".pb_property_toll").prepend(a),ProcessBuilder.Process.IsReadOnly){if(e.IsMigrationInProgress)return void renderingUtils.showCustomAlert(I18n.getMsg("crm.blueprint.migration.inprogress.republish.alert"));ProcessBuilder.showFlowChangeRecordAction(e.NoOfRecordsInvolved,e.UnAvailNodeIds,e.ExistingNodeIds)}else{var s=null;$("#saveFlowChange").removeClass("hide"),s=1===e.NoOfRecordsInvolved?I18n.getMsg("crm.process.orphan.flowchange.record.action.msg"):I18n.getMsg("crm.process.orphan.flowchange.records.action.msg",e.NoOfRecordsInvolved),s+=I18n.getMsg("crm.blueprint.orphan.flowchange.alert"),renderingUtils.showCustomAlert($ESAPI.encoder().encodeForHTMLAttribute(s),I18n.getMsg("crm.process.title.attention"),!0,ProcessFlow.setExitAsFlowChangeAction)}}else i.find(".bp-transparentLayer-forProcess").remove();ProcessFlow.initProcessBuilder_afterRender(e)},ProcessFlow.renderProcessResponce=function(e){ProcessBuilder.populateDefaultProcessDetails(e),ProcessBuilder.getApproverIdVsNameMap(e)},ProcessFlow.initProcessBuilder_beforeRender=function(e){ProcessBuilder.resetProcessCreateRelatedObjects(),ProcessBuilder.delAlertTriggers=[],ProcessBuilder.cloneProcessDetails={},ProcessBuilder.flowChangeAction="",ProcessBuilder.unSavedAction=!1,ProcessBuilder.TranistionCreated=[],e.convertTransIds&&(ProcessBuilder.convertTransitionIds=e.convertTransIds),e.Id&&Crm.trackSpotLightAction("Process Automation - Edit Or View Process",{Module:e.Module}),ProcessBuilder.panXVal=0,ProcessBuilder.panYVal=0,thirdPartyUtils.bindSelect2(".chosenSel",{placeholder_text_single:" e.g. User, Groups & Roles"}),ProcessFlow.renderProcessResponce(e),e.RegexValidators&&(ProcessBuilder.RegexValidators=e.RegexValidators);var t=!1;return"Potentials"===e.Tab.Name&&"STAGE"===e.Field.Column&&(t=!0),e.isPotentialStage=t,ProcessBuilder.Process=e,ProcessBuilder.ProcessOwnersNameMap=e.ProcessOwnersNameMap,Handlebars.registerPartial("ProcessInfo",Handlebars.templates.ProcessInfo),Handlebars.registerPartial("ProcessVersionHistory",Handlebars.templates.ProcessInfo),ProcessBuilder.IsProcessCriteriaUpdated=!1,e.Error===ProcessBuilder.LIMIT_REACHED?$("#savePublishBtn").prop("disabled",!0):$("#savePublishBtn").prop("disabled",!1),ProcessBuilder.LicenseLimits=jQuery.extend(!0,ProcessBuilder.LicenseLimits,e.LicenseLimits),ProcessBuilder.Process.lockedStates=[],ProcessBuilder.Process.appName=Crm.appName,e},ProcessFlow.getDropCanvasHeight=function(){var e=$("#tabLayer").outerHeight(),t=$("#annoncement");t.is(":visible")&&(e+=t.outerHeight());var i=$("#wmstoolbar"),a=1==i.is(":visible")?i.outerHeight():28;return renderingUtils.windowHeight-(e+a)},ProcessFlow.getDropCanvasWidth=function(e){return e||(e=480),renderingUtils.windowOuterWidth-e},ProcessFlow.initProcessBuilder_afterRender=function(e){BluePrintUserUtil.initUserComboBox(ProcessBuilder.Process.AproverMeta),ProcessBuilder.resetCacheInfo();var t=$("#savePublishBtn");e.Error===ProcessBuilder.LIMIT_REACHED?(t.prop("disabled",!0),t.attr("title",e.ErrorMsg)):t.prop("disabled",!1);var i=$("#tabLayer"),a=i[0].getBoundingClientRect().top,s=i.outerHeight(),r=ProcessFlow.getDropCanvasHeight(),o=$(".pp_all_saveCancel").outerHeight(),n=$("#pb_all_saveCancel"),l=n.outerHeight(),d=$(".pb_summaryview").outerHeight(),c=$("#processDescription");if(pBDescription.showDesc(c,"processDesc_div"),wfmergefield.initMergeFieldDetl("Blueprint"),wfmergefield.checkAvailabilityAndFetchMergeFieldAPIJSON(ProcessBuilder.Process.Module),e.Continuous&&(ProcessBuilder.showOwnerData(),thirdPartyUtils.bindSelect2(".pb_form_ele"),thirdPartyUtils.bindSelect2(".chosenSel",{placeholder_text_single:" e.g. User, Groups & Roles"})),e.CriteriaContentFromCreatePop){var u=$("#"+ProcessBuilder.PROCESS_CRITERIA_ID),m=ProcessBuilder.gather(u);u.find(".pp-content").remove(),u.find("form[name='processCriteriaForm']").append(e.CriteriaContentFromCreatePop),ProcessBuilder.deploy(m);var p=Search.getCriteriaDetails(void 0,"_1",void 0,"createProcess");p&&p.length>0&&Search.showSummaryView("processFlow","1",!1,$("#pA_process_condition_pop"),!0,void 0,"createProcess")}var f=1;$("#pb_processInfoContainer .viewCriRow").each((function(){$(this).find("span.criNum").length<=0&&($(this).prepend("<span class='color_3 pR10'>"+f+"</span>"),f++)})),2===f&&$("#pb_processInfoContainer .viewCriRow .wf_oprView").addClass("hide"),$("#setupInnerLinks, .setupleftmenutd").hide(),$(".new_setupview").addClass("newSetupRightShow"),$("#picklistOptions").css({height:"270px"}).addClass("oH pR").perfectScrollbar({wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!1});var v=$("#canvasContainer"),g=ProcessFlow.getDropCanvasWidth(480),h=$("#pb_dragAndDropBox");$("#setup_new_ContentDiv").height(r);var C=$("#canvas");C.css({width:"1px",height:"1px"}),ProcessBuilder.Process.IsReadOnly,$("#processDropCanvas").css({height:Math.round(r-o),width:g}),n.css({width:g}),v.css({height:Math.round(r-o),width:g}),Crm.userDetails.RTL_ENABLED?h.css({right:g/2-200,top:(r-l)/2-200}):h.css({left:g/2-200,top:(r-l)/2-200});var w=$(".pb_property_toll");if(w.css({width:480,height:Math.round(r),top:s+a+"px"}),$(".bp_versionHistory").css({height:r-d}),1==$(".pb_tabClass").is(":visible"))var b=r-51;else b=r;if($(".pb_transitionInfo, .pb_processInfo, #pb_stateInfoContainer").css({height:b,"box-sizing":"border-box"}),w.addClass("open"),h.css("display","none"),ProcessBuilder.init(),C.on("click",(function(){ProcessFlow.tabAction("pb_processInfo")})),$(".moreIcon").on("mouseenter",(function(){$(this).addClass("showMoreHvr");var e=$(this).next(".more-opt-list");e.css("display","block"),e.on("mouseleave",(function(){e.closest(".moreIcon").removeClass("showMoreHvr"),$(this).css("display","none")}))})),ProcessBuilder.setFieldDivHeight(),ProcessBuilder.unSavedChanges=!1,ProcessBuilder.Process.IsReadOnly||ProcessBuilder.Process.IsOrphanProcess){var T='<div class="bp-transparentLayer-forProcess"></div>';if(v.prepend(T),w.prepend(T),ProcessBuilder.Process.IsReadOnly){if(e.IsMigrationInProgress)return void renderingUtils.showCustomAlert(I18n.getMsg("crm.blueprint.migration.inprogress.republish.alert"));ProcessBuilder.showFlowChangeRecordAction(e.NoOfRecordsInvolved,e.UnAvailNodeIds,e.ExistingNodeIds)}else{var I=null;$("#saveFlowChange").removeClass("hide"),I=1===e.NoOfRecordsInvolved?I18n.getMsg("crm.process.orphan.flowchange.record.action.msg"):I18n.getMsg("crm.process.orphan.flowchange.records.action.msg",e.NoOfRecordsInvolved),I+=I18n.getMsg("crm.blueprint.orphan.flowchange.alert"),renderingUtils.showCustomAlert($ESAPI.encoder().encodeForHTMLAttribute(I),I18n.getMsg("crm.process.title.attention"),!0,ProcessFlow.setExitAsFlowChangeAction)}}else $(".bp-transparentLayer-forProcess").remove()},ProcessFlow.showProcessDetailsPage=function(){var e=$("#moduleSel").val(),t=$("#processField"),i=$("#processNameTmp"),a=$("#processDescTmp"),s=$("#pipelineList"),r=trimBoth(i.val()),o=trimBoth(a.val()),n=!0,l=$("#createProcessPopDiv");if(l.find(".form_err_fld").removeClass("form_err_fld"),l.find(".form_err_msg").remove(),""===r?(renderingUtils.displayErrorDiv(i.attr("id"),void 0,I18n.getMsg("crm.automation.process.empty.name")),i.focus(),n=!1):""!==getClrTxtPtnResChars(i.val()).join(", ")?(renderingUtils.displayErrorDiv("processNameTmp",void 0,I18n.getMsg("crm.automation.process.name.spl.char")),i.focus(),n=!1):ProcessBuilder.isProcessNameAlreadyExist(e,r)&&(renderingUtils.displayErrorDiv(i.attr("id"),void 0,I18n.getMsg("crm.automation.process.duplicate.name")),i.focus(),n=!1),"none"===t.val()&&(renderingUtils.displayErrorDiv("processField",void 0,I18n.getMsg("crm.automation.process.filed.empty")),n=!1),s.length>0&&""===s.val()&&(renderingUtils.displayErrorDiv("pipelineList",void 0,I18n.getMsg("crm.blueprint.pipeline.field.empty")),n=!1),o.length>1e3&&(renderingUtils.displayErrorDiv(a.attr("id"),void 0,I18n.getMsg("crm.workflow.rule.description.limitExceed.alert",[1e3])),a.focus(),n=!1),ProcessFlow.PROCESS_COUNT>=ProcessFlow.PROCESS_LIMIT&&(renderingUtils.displayErrorDiv("moduleSel",void 0,I18n.getMsg("crm.process.max.limit.reached.msg",[ProcessFlow.PROCESS_LIMIT])),n=!1),!n)return!1;var d=$("#pb_creteria_conditions"),c=Search.getCriteriaDetails(void 0,"_1",void 0,"createProcess");if(void 0!==c&&(c&&c.length>0&&(n=Search.showSummaryView("processFlow","1",!1,d,!0,void 0,"createProcess")),!1===c||!n))return!1;var u=t.val(),m=$("#layoutSel").val(),p=$("#processField :selected"),f=$("#pipelineInput :visible"),v={Module:e,ProcessStatus:"Active",Name:r,Description:o};v.Layout={Name:$("#layoutSel :selected").text(),Id:m},v.Tab={Name:e,Id:moduleRecordMapping[e].id},v.Field={Name:p.text(),Column:p.attr("colname"),Id:u},v.Continuous=$("#isProcessContinuous").is(":checked"),v.Continuous&&(v.Owners=objectUtils.cloneObject_new(BluePrintUserUtil.convertToConstantTypes("#bp_continuous_ownercount")));var g={};g[ProcessFlow.ACTION]=ProcessFlow.GET_PROCESS_RELATED_DATA,f.length>0&&(g.pipeline=$("#pipelineList :selected").text()),g.module=e,g.fieldId=u,g.layoutId=m,commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({type:ProcessFlow.GET_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:g,success:function(e){ProcessBuilder.validatePickListValues(g,e.PicklistValues),commonUtils.showHideLoadingDiv(),removeFreezeLayer(),v.PicklistValues=e.PicklistValues,v.TimeBoxConfig=e.TimeBoxConfig,v.AproverMeta=e.AproverMeta,v.Pipeline=e.Pipeline,v.RegexValidators=e.RegexValidators,v.state_actions=e.state_actions,v.isBlueprintMinorTweakEnabled=e.isBlueprintMinorTweakEnabled,thirdPartyUtils.unbindChildSelect2(d),d.addClass("pp-content p25");var t=ProcessBuilder.gather(d),i=d.clone(!0);ProcessBuilder.deploy(t),i=ProcessBuilder.copySelectValues(i,d),v.CriteriaContentFromCreatePop=i,v.ProcessStatus="Draft",v.Source=1,ProcessBuilder.unSavedChanges=!0,thirdPartyUtils.unbindPerfectScroll("#createProcessPopDiv .pp-content"),ProcessFlow.initProcessBuilder(v),$("#pb_dragAndDropBox").css("display","block"),ProcessBuilder.hideShowAddState(),ProcessBuilder.hideShowStagelist(),e.LicenseLimits&&(ProcessBuilder.LicenseLimits=jQuery.extend(!0,ProcessBuilder.LicenseLimits,e.LicenseLimits)),ProcessBuilder.Process.lockedStates=[]}}),Crm.trackSpotLightAction("Process Automation - Next Click")},ProcessFlow.bindSortable=function(){var e=$("#processDataContainer");e.addClass("cM");var t=0,i=0,a=0,s=!1,r=null,o=null,n=null,l=null,d=null,c=null;e.sortable({placeholder:"placeholder",items:".processDataRow",appendTo:"body",start:function(e,a){if(s=!1,i=t=e.pageY,r=a.item,c=a.placeholder,r.addClass("sortingItems").siblings("div").addClass("sortAnim sortingItems"),o=$(this).find(".sortingItems"),!s){var u=r.outerHeight();r.addClass("sortingEle"),n=r[0].offsetTop,l=r.parent().outerHeight()-n-u,d=u}},sort:function(e){s=!0,t=e.pageY,(a=t-i)<-n&&(a=-n),a>l&&(a=l),r.css({transform:"translateY("+a+"px)","-moz-transform":"translateY("+a+"px)"}),o.each((function(){var e=$(this);if(e[0]!==r[0]){var t=e[0].offsetTop,i=e.outerHeight(),s=r[0].offsetTop+a;if(s>=t-i/2&&r.index()<e.index())e.css({transform:"translateY(-"+d+"px)"}),c.insertAfter(e);else{if(s<=t+i/2&&r.index()>e.index())return e.css({transform:"translateY("+d+"px)"}),c.insertBefore(e),!1;$(this).css({transform:"translateY(0px)"})}}}))},stop:function(){s=!1,r.removeClass("sortingEle"),o.removeClass("sortAnim").removeAttr("style")}})};var pBDescription={onFocus:function(e){$(e).closest(".labelValCreate").addClass("focusEleField")},addDesc:function(e){var t=$("#"+e),i=t.find(".processDesc_inp");t.find(".addDescLink").addClass("hide"),i.removeClass("hide");var a=i.find(".textField");a.focusin(setFocusClass),i.find(".textField").focus(),ProcessBuilder.unSavedChanges=!0,a.blur(removeFocusClass)},editDesc:function(e){var t=$("#"+e),i=t.find(".processDesc_inp");t.find(".processDesc_span").addClass("hide"),t.find(".descReadMore").addClass("hide"),i.removeClass("hide");var a=i.find(".textField");a.focusin(setFocusClass),i.find(".textField").focus(),a.blur(removeFocusClass),ProcessBuilder.unSavedChanges=!0},showDesc:function(e,t){var i=$(e),a=$("#"+t),s=i.val(),r=s?s.trim():"",o=a.find(".processDesc_inp"),n=a.find(".processDesc_span");if(""===r)i.closest(".labelValCreate").removeClass("focusEleField"),o.addClass("hide"),a.find(".addDescLink").removeClass("hide");else{var l=n.find("span");o.addClass("hide"),l.text(r),n.removeClass("hide");var d=n.find(".descReadMore");r.length>55?(l.addClass("mw250"),d.removeClass("hide")):(l.removeClass("mw250"),d.addClass("hide"))}},taskDesc:function(e){var t=$(e),i=$("#processTaskDesc_div"),a=i.find(".processDesc_inp");""!==t.val().trim()||t.hasClass("err_fld")||(t.closest(".labelValCreate").removeClass("focusEleField"),a.addClass("hide"),i.find(".addDescLink").removeClass("hide"))}};ProcessFlow.confirmDeleteWarning=function(e,t,i,a,s,r,o,n){$("#deleteprocesspopup").remove();var l="",d=0,c=null,u=null,m=!1,p=I18n.getMsg("crm.label.yes");if(0==$("#canvasContainer").length&&("delete"===a||"inactive"===a)){var f=ProcessFlow.getRecordInvolvedCount(s);if(d=f.RecordCount,(m=f.IsMigrationInProgress)&&"delete"===a)return void renderingUtils.showCustomAlert(I18n.getMsg("crm.blueprint.migration.inprogress.delete.alert"))}"delete"===a?(d>0&&(i=I18n.getMsg("crm.process.delete.record.exists.warning")),l=I18n.getMsg("crm.process.title.warning"),p=I18n.getMsg("crm.button.delete")):"inactive"===a?(d>0?(l=I18n.getMsg("crm.process.title.attention"),1==d?(i=I18n.getMsg("crm.process.record.exit.msg1"),c=I18n.getMsg("crm.process.record.action.continue"),u=I18n.getMsg("crm.process.record.action.exit")):d>0&&(i=I18n.getMsg("crm.process.records.exit.msg1",d),c=I18n.getMsg("crm.process.records.action.continue"),u=I18n.getMsg("crm.process.records.action.exit")),o=!0):l=I18n.getMsg("crm.process.title.warning"),p=I18n.getMsg("crm.label.deactivate")):"save"===a&&(p=I18n.getMsg("crm.button.save"));var v={functionName:e,param1:s+"",param2:r+"",param3:o+"",param4:n+"",context:"window",noText:I18n.getMsg("crm.button.cancel"),yesText:p,warningMsg:I18n.getMsg(i),title:l,recordContinueMsg:c,recordExitMsg:u,isMigrationInProgress:m};Handlebars.registerPartial("ProcessDeleteWarning",Handlebars.templates.ProcessDeleteWarning),$("#deletepopup").after(Handlebars.templates.ProcessDeleteWarning(v)),crmui.showPopup("deleteprocesspopup",!0)},ProcessFlow.cancelMulitipleFieldsEdit=function(){ProcessFlow.destroyUploaderObj(),Notes.transNoteContent=void 0,$("#multipleFieldsEditPop").find(".lyteMentionsInnerDiv").length>0&&Notes.destroyMentionsComponent("transitionNotes"),crmui.hidePopup("multipleFieldsEditPop"),CFRExec.relatedEntityMap={},$("#bp-attachment").remove();var e=$("#unsubscripeEmails");e&&e.length>0&&e.remove(),ProcessFlow.removeMultiUserDropdown(),ProcessFlow.removeTagsDropDown()};var processHelp={showHotspots:function(){var e=$("#hotSpotSwitch"),t=$(".pb_tabClass .commentabmenu").find("#pb_processInfo"),i=$(".pb_property_toll"),a=$(".hotspots");e.hasClass("bpHelpClose")?(e.removeClass("bpHelpClose").attr("title",I18n.getMsg("crm.topmenu.help")),a.removeClass("dIB").addClass("dN"),t.removeClass("mR36"),i.removeClass("hotspotOn")):(e.addClass("bpHelpClose").attr("title",I18n.getMsg("crm.button.close")),a.removeClass("dN").addClass("dIB"),t.addClass("mR36"),i.addClass("hotspotOn")),$("#canvasContainer").on("click.hotspotListen",(function(){$(".pb_property_toll").removeClass("hotspotOn"),$(".hotspots").removeClass("dIB").addClass("dN"),$(".pb_tabClass .commentabmenu").find("#pb_processInfo").removeClass("mR36"),$("#canvasContainer").off("click.hotspotListen"),$("#hotSpotSwitch").removeClass("hide")}))},showHotspotHelp:function(e){var t=null,i=null,a=null,s="",r="",o="",n="",l="",d="",c="",u="",m="";switch(e){case"info_and_states":a=renderingUtils.windowHeight-210,c="enabled";break;case"pb_transition":t="crm.auditlog.transition",u="enabled";break;case"cont_trans_help":t="crm.process.continuous.transition.label",i="crm.helpcontent.continuoustransition.desc";break;case"global_trans_help":t="crm.process.global.transition.label",i="crm.helpcontent.globaltransition.desc",m="enabled";break;case"before_help":t="crm.process.automation.before.trans",i="crm.helpcontent.beforetrans.desc",o="enabled";break;case"during_help":t="crm.process.automation.during.trans",i="crm.helpcontent.duringtrans.desc.new",n="enabled";break;case"after_help":t="crm.process.automation.after.trans",i="crm.helpcontent.aftertrans.desc",l="enabled";break;case"approveuser":t="crm.process.automation.whocanexecute",i="crm.helpcontent.whocanexecute.desc";break;case"criteria":t="crm.process.automation.conditiontodisplay",i="crm.conditiontodisplay.desc",s="crm.condition.display.line1",r="crm.condition.display.line2";break;case"insertmessage":t="crm.process.builder.during.header",i="crm.helpcontent.insertmes",d="enabled"}var p=$(".pb_property_toll").width(),f=$(".hotSpotHelp");f.find("#hotspothelp_heading").html(I18n.getMsg(t)),f.find(".hotspothelp_content").html(I18n.getMsg(i,Crm.appName));var v=f.find("#bp_before_Transoptions"),g=f.find("#bp_during_Transoptions"),h=f.find("#bp_after_Transoptions"),C=f.find("#bp_insertDuring_Transoptions"),w=f.find("#bp_insertInfoAndStates"),b=f.find("#bp_Transition"),T=f.find("#pb_global_trans_help"),I=f.find("#critList");""!=s?(I.removeClass("dN"),I.find(".crit1").html(I18n.getMsg(s)),I.find(".crit2").html(I18n.getMsg(r))):I.addClass("dN"),"enabled"===o?v.removeClass("dN"):v.addClass("dN"),"enabled"===n?g.removeClass("dN"):g.addClass("dN"),"enabled"===l?h.removeClass("dN"):h.addClass("dN"),"enabled"===d?C.removeClass("dN"):C.addClass("dN"),"enabled"===c?w.removeClass("dN"):w.addClass("dN"),"enabled"===m?T.removeClass("dN"):T.addClass("dN"),"enabled"===u?b.removeClass("dN"):b.addClass("dN"),f.css({left:p,"z-index":31}),$(".pb_property_toll.open").css("z-index","21"),f.removeClass("dN"),$("#bp_insertInfoAndStates .bpAccordionBtnContent:eq(1)").css("height",a),$(".hotSpotHelpInner").scrollTop(0),setTimeout((function(){f.css({left:"0px"})}),10),$("#pb_freezeLayer").css({width:"100%",right:"initial"}).fadeIn(200)},closeHotspotHelp:function(){var e=$(".pb_property_toll").width(),t=$(".hotSpotHelp");t.css({left:e}),setTimeout((function(){t.addClass("dN"),$(".pb_property_toll.open").css("z-index","1")}),500),$("#pb_freezeLayer").fadeOut(200)}};ProcessFlow.getDuringTabtotalbWidth=function(){var e=0;return $.each($("#duringTabs li"),(function(t,i){e+=$(i).outerWidth()+5+24})),Math.round(e+50)},ProcessFlow.getAllRelatedModulesInDuringTrans=function(e){var t=$("#duringTabs").find("li");$.each(t,(function(){var t=$(this).attr("data-tab");if("fieldsContainer"===t||"checkListContainer"===t)return!0;t=t.split("_")[0],e.push({relId:t,module:$(this).attr("data-mod")})}))},ProcessFlow.showAttachPopUp=function(e,t){switch($("#freezeBackGround").removeClass("hide"),e){case"fileUpload":showAnimatePopup("attachPopup");break;case"attachLink":var i=Handlebars.templates.LinkAttachPopUp();$("#topBandPopup").html(i),showAnimatePopup("topBandPopup");var a=$("#attachmentUrl");a.val(t).prop("disabled",!1),t&&a.find("#attachlinkbtn").prop("disabled",!1),setTimeout((function(){a.focus()}),100);break;case"attachDocuments":crmRelatedList.attachDocs();break;case"attachZDocs":crmRelatedList.attachZDocs()}},ProcessFlow.updateRelatedListObj=function(e,t){void 0===crmRelatedList.EachModuleData[e]&&(crmRelatedList.EachModuleData[e]={listRelationId:e,name:t})},ProcessFlow.handleChkListClick=function(e){var t=(e=$(e)).parents("li").find(".cLC"),i=$("input[type='checkbox']").length;1==e.is(":checked")?t.addClass("strikeT"):t.removeClass("strikeT");var a=$(".bp_checkListConfig  input[type='checkbox']:checked").length,s=$("#cl_completed_div");a==i?s.addClass("cLcc"):s.removeClass("cLcc"),$("#cl_completed").text(a)},ProcessFlow.getCheckListDet=function(){var e=[];return $.each($("#checkListContainer .bp_checkListConfig li"),(function(t,i){var a=$(i),s=a.attr("value"),r=!1;a.find("input").eq(0).is(":checked")&&(r=!0);var o={};o[s]=r,e.push(o)})),e},ProcessFlow.toggleCheckLists=function(e){var t=(e=$(e)).parent().outerWidth(),i=e.attr("chkLiId"),a=e.parents("tr").eq(0).next("tr #ChkLiItems_"+i);if(a.find(".bp_rl_checkList tr td:nth-child(1)").css("width",t-7),a.length>0)a.is(":visible")?a.slideUp(100,(function(){e.find("span").removeClass("toggleRotate")})):(a.slideDown(),e.find("span").addClass("toggleRotate"));else{var s={};s.module=$("#module").val(),s.checkListId=i,s[ProcessFlow.ACTION]="getCheckListItems",(new crmRequestPool).initiate({type:ProcessFlow.GET_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:s,success:function(a){var r={};r.checkListId=s.checkListId,r.CheckLists=a.CheckLists;var o=Handlebars.templates.CheckListsRLView(r);e.parents("tr").eq(0).after(o);var n=e.parents("tr").eq(0).next("tr #ChkLiItems_"+i);n.find(".bp_rl_checkList tr td:nth-child(1)").css("width",t-7);var l=n.find(".bp_rl_checkList tr td");l.hasClass("tableData")||l.addClass("tableData"),e.find("span").addClass("toggleRotate")},error:function(){renderingUtils.showCustomAlert("Please try again later")}})}},ProcessFlow.isAllFldsEmpty=function(e){var t=Crm.fieldsObj[e],i=ProcessFlow.getFieldElemIds(t,$("#fieldsContainer")),a={};for(var s in i)if(i.hasOwnProperty(s)){Crm.validateEntityAndShowErrorMsg(i[s],e,!0,void 0,!0),a[s]=Crm.requestParamWithColname;var r="childField"===s?1:0;if(r=1===r&&a[s].hasOwnProperty("SALUTATION")?r+1:r,Object.keys(a[s]).length>r)return!1}var o=[];ProcessFlow.getAllRelatedModulesInDuringTrans(o);for(var n=o.length,l={},d=$("#Crm_Calls_CALLSTARTDATETIME"),c=0;c<n;c++){var u=o[c],m=u.relId,p=u.module,f=(t=Crm.fieldsObj[p],ProcessFlow.getFieldElemIds(t,$("#"+m+"_rlContainer")));for(var s in f)if(f.hasOwnProperty(s)){var v={isFrmBP:!0};if(Crm.validateEntityAndShowErrorMsg(f[s],p,!0,void 0,!0,v),l[s]=Crm.requestParamWithColname,isNewCallView&&"Calls"===p&&Crm.requestParamWithColname.CALLSTARTDATETIME&&new CrmDate(d.data("date-obj")).isFutureTime()){var g=I18n.getValueForFields("crm.custom.field.less.than.equalto",[I18n.getMsg("Call Start Time"),I18n.getMsg("currentDateTime")]);return Crm.showErrorMsg(g,d),!0}Crm.isInventoryModule(p)&&!Crm.userDetails.isLineItemSubformMvmtDone&&ProcessFlow.addProductDetailsInfoInReqParams(l[s],$("#"+m+"_rlContainer #totalProductCount").val(),"PRODUCTDETAILS");var h=crmTab.tabVsSubTabs[p],C=!0,w=!1;if(h&&h.length>0){for(var b=h.length,T=0;T<b;T++)C=C&&v[h[T]].resultObj.mandateFailed,w=w||v[h[T]].resultObj.maxRowlimitFailed;if(!(Object.keys(l[s]).length>0)&&C||w)for(T=0;T<b;T++){if((y=$("#subform_"+h[T])).attr("rellistid")===s){var I=y.data("dataSubformsectionlabel").replace(" ","_");I="secHead_"+I,Crm.showErrorMessage(v[h[T]].resultObj,$("#"+I),e,y.data("dataColumnname"),y.data("dataSubformsectionlabel"),y.data())}}else for(var T=0;T<b;T++){var y;if((y=$("#subform_"+h[T])).attr("rellistid")===s){var P=y.find("tbody tr").closest("table").data("data-columnname"),_=l[s];_[P]=Crm.requestParam["property("+P+")"];var D=v[h[T]].aggFldObj;for(var O in D)_[O]=D[O]}}}if(Object.keys(l[s]).length>0)return!1}}var S=$("#transitionNotes"),L=void 0;if(S.length>0){L=S.val().trim();if(Notes.transNoteContent&&(Notes.transNoteContent=Notes.transNoteContent.trim(),Notes.transNoteContent&&(L=Notes.transNoteContent)),L&&!(L.length<=0))return!1}var E=$("#transitionAttachDiv .labelValCreate")[0],x=void 0!==E?$(E):void 0;if(void 0!==x&&"true"===x.attr("isAttachmentAdded"))return!1;for(var F=ProcessFlow.getCheckListDet(),V=(n=F.length,0);V<n;V++){var A=F[V];if(!0===A[Object.keys(A)[0]])return!1}var k=document.querySelector("#transitionTagsDiv crux-tag");return!k||!(k.component.getData("cxPropTags").length>0)},ProcessFlow.doReorderActions=function(e){ProcessFlow.bindSortable(),$("#reOrderBtn").hide(),$("#saveReOrderBtn, #cancelReOrderBtn").show(),$("#pa_createProcessBtn").prop("disabled",!0),$("#bluePrintSearchTxt").css("pointer-events","none"),$("#processDataContainer table tr td").find("div.delleftPo").css("visibility","hidden"),e&&$("#modOpt").prop("disabled",!0),$("#bp_reorderHintMgs").removeClass("hide")},ProcessFlow.getFieldsContainer=function(e,t){var i=e.find(".fieldsContainer");if(0==i.length){var a=$("<li>",{class:t?"hide":"",onclick:"ProcessFlow.bpRelatedListTab(this)","data-tab":"fieldsContainer",id:"fieldsContainer_header"}).html($("<a>",{class:"setuplink",text:I18n.getMsg("crm.process.notes.attachments.fields")}));$("#duringTabs").append(a);var s=$("<div>",{class:"pp-content pR crm-font-regular bpRl-tab-content newInputStyleEle fieldsContainer moduleParent",id:"fieldsContainer",onscroll:"ProcessFlow.hideBpAttachmentUl()"});$("#duringTabDivs").append(s),i=e.find(".fieldsContainer")}return i},ProcessFlow.hideBpAttachmentUl=function(){var e=$("#bp-attachment");e.is(":visible")&&e.hide()},ProcessFlow.showRelatedTransImpl=function(e){for(var t=e.length,i="",a=0;a<t&&a<5;a++)i+="<p class='p5'>"+$ESAPI.encoder().encodeForHTML(e[a])+"</p>";t>5&&(i+="<p class='p5'>+"+(t-5)+" more</p>"),""!==i&&crmui.toolTip_show(currentElem,"center",i,!0)},ProcessFlow.addProductDetailsInfoInReqParams=function(e,t,i){for(var a=[],s=1;s<=t;s++){var r={};r.product=Crm.requestParam["property(hdnProductId"+s+")"],r.quantity_in_stock=Crm.requestParam["property(hdnQtyStock"+s+")"],r.quantity=parseFloat(Crm.requestParam["property(txtQty"+s+")"]),r.unit_price=parseFloat(Crm.requestParam["property(hdnUnitPrice"+s+")"]),r.list_price=parseFloat(Crm.requestParam["property(txtListPrice"+s+")"]),r.total=parseFloat(Crm.requestParam["property(hdnTotal"+s+")"]),r.Discount=parseFloat(Crm.requestParam["property(hdnDiscount"+s+")"]),r.total_after_discount=parseFloat(Crm.requestParam["property(hdnTotalAfterDiscount"+s+")"]),r.Tax=parseFloat(Crm.requestParam["property(hdnTax"+s+")"]),r.net_total=parseFloat(Crm.requestParam["property(hdnNetTotal"+s+")"]),r.product_description=Crm.requestParam["property(itemDescription"+s+")"];var o=Crm.requestParam["property(hdnPrdTaxDet"+s+")"];r.line_tax=ProcessFlow.getTaxDet(o),a.push(r)}if(0!==a.length){e[i]=a;o=Crm.requestParam["property(recordTaxDet)"];e.$line_tax=ProcessFlow.getTaxDet(o),e.Sub_Total=Crm.requestParam["property(Sub Total)"],e.Discount=Crm.requestParam["property(Discount)"],e.Tax=Crm.requestParam["property(Tax)"],e.Adjustment=Crm.requestParam["property(Adjustment)"],e.Grand_Total=Crm.requestParam["property(Grand Total)"]}},ProcessFlow.getTaxDet=function(e){var t=[];return e&&e.split(";;;").forEach((function(e){if(-1!=e.indexOf("===")){var i=e.split("==="),a=i[0];if(!a)return;var s=a;productDetails.isTaxDisplayName(a)?(s=productDetails.getTaxIdFromDisplayName(a),a=productDetails.getTaxTypeAndValue(a)[0]):a=productDetails.taxIdVsName[a][0];var r=parseFloat(i[1].split(":::")[0]);t.push({name:a,percentage:r,id:s})}})),t},ProcessFlow.getAttachmentsJSON=function(){var e=$("#transitionAttachDiv .labelValCreate"),t=[];return $.each(e.children(),(function(e,i){var a=$(i).attr("type"),s={};s.type=a;var r=$("#attachmentList-"+a+" #BP_fileDetails li>a"),o=[],n=[],l=[],d=[];if(r.length>0){switch($.each(r,(function(e,t){t=$(t),o.push(t.data("fileId")),n.push(t.text().trim()),t.data("service")&&l.push(t.data("service")),t.data("linkUrl")&&d.push(t.data("linkUrl"))})),a){case"attachLink":s.$link_url=o,s.name=n;break;case"fileUpload":s.$file_id=o,s.name=n;break;case"attachDocuments":s.$attachDocs=o,s.name=n;break;case"attachZDocs":s.$attachZDocs=o,s.name=n,s.service=l;break;case"attachFromTeamDrive":s.$attachTeamDriveDocIds=o,s.name=n,s.teamDriveLinkUrls=d;break;case"attachGDocs":s.$attachGDocs=o,s.name=n,s.service=l}t.push(s)}})),t},ProcessFlow.getFileNames=function(e,t){switch(e){case"fileUpload":if(t){for(var i=t.files,a=[],s=[],r=[],o=t.options.successfullyUploadedFiles,n=o.length,l=i.length,d=0;d<n;d++)if("success"==i[d].status){s.push(o[d].uploadId);for(var c=0;c<l;c++)o[d].eventid===i[c].upload.id&&(a.push(i[c].name),r.push(i[c].size.toString()))}return{names:a,ids:s,size:r}}break;case"attachDocuments":if(t&&t.indexOf("&")>-1){var u=[],m=[],p=t.split("&");if(p[0].startsWith("docIds")&&p[1].startsWith("docNames")){u=p[0].split("=")[1].split(",");var f=(m=p[1].split("=")[1].split(",")).length;for(d=0;d<f;d++)m[d]=m[d].replace(/\+/g,"%20"),m[d]=decodeURIComponent(m[d]);return{names:m,ids:u}}}break;case"attachZDocs":if(t){var v=[];void 0===t.docIds&&""===t.docIds||(v=v.concat(t.docIds.split(",")));var g=[];void 0===t.docNames&&""===t.docNames||(g=g.concat(t.docNames.split(",")));var h=[];return void 0===t.service&&""===t.service||(h=t.service.split(",")),{names:g,ids:v,service:h}}break;case"attachFromTeamDrive":if(t){var C=[],w=[],b=[];return $.each(t,(function(e,t){C[e]=t.File_Name,w[e]=t.$resource_id,b[e]=t.$link_url})),{names:C,ids:w,linkUrls:b}}break;case"attachGDocs":if(t){var T={};return void 0!==t.GdocId&&""!==t.GdocId&&(T.ids=t.GdocId.split(":")),void 0!==t.GdocName&&""!==t.GdocName&&(T.names=t.GdocName.split(":")),void 0!==t.service&&""!==t.service&&(T.service=t.service.split(":")),T}}},ProcessFlow.getFileNamesHtmlForTransPop=function(e,t){if(e){for(var i,a,s=$("<ul>",{id:"BP_fileDetails",class:"pL0 mL0"}),r=e.names,o=e.ids,n=e.service,l=e.linkUrls,d=o.length,c=$("#module").val(),u=$("#multipleFieldEditEntityId").val(),m=$(document.createElement("li")),p=$(document.createElement("a")),f=$(document.createElement("span")),v=e.isPreviewAvailable,g=[],h=0;h<d;h++){var C,w=s.clone(),b=p.clone();n&&(i=n[h]),void 0!==v&&Object.keys(v).length>0&&(C=v[o[h]]),l&&(a=l[h],b.data("linkUrl",a));var T=BlueprintAttachment.appendAttachmentOptions(I,t,o[h],r[h],c,u,i,C,a),I=m.clone();b.text(r[h]),b.attr({class:"pL0 mL0",id:"bp_attachitem_"+o[h]}),b.data("fileId",o[h]),b.css("cursor","pointer"),n&&b.data("service",n[h]),void 0!==C&&b.data("isPreviewAvailable",C),void 0!==T&&(void 0!==T.clickFunction?T.isImage?(b.attr({onclick:"showImagePreview(this)",href:T.clickFunction,name:"cboxElement"}),b.addClass("cboxElement")):b.attr({onclick:T.clickFunction,target:"_blank"}):void 0!==T.downloadFunction&&b.attr("href",T.downloadFunction));var y=f.clone(),P=BlueprintAttachment.getAttachIconClass(t,r[h]);y.addClass(P+" mR10 dIB vmiddle"),I.append(y),I.append(b),I=BlueprintAttachment.appendContextMenu(o[h],I,t,T),w.append(I),g.push(w)}if(g.length>0)return g}},ProcessFlow.destroyUploaderObj=function(){var e=$("#multipleFieldsEditPop"),t=e.data("attachUploaderObj");if(t&&Object.keys(t).length>1){var i=$(".crm-msg.fileuploader");i&&i.remove(),t.clean(),e.removeData("attachUploaderObj")}},ProcessFlow.changeToOldFormat=function(e){for(var t=Object.keys(e),i={},a=0,s=t.length,r=0;r<s;r++){var o=t[r],n=0===a?"fieldValue":"fieldValue"+a;i[0===a?"columnName":"columnName"+a]=o,i[n]=e[o],a++}return i},ProcessFlow.validateAndSaveFields=function(e,t,i,a,s){if(t.duringFields){var r=JSON.parse(t.duringFields);if(objectUtils.getValueFromObj(r,["rlDetails","Events"])){var o=$("#Crm_Events_SMOWNERID"),n=o.length>0?o.attr("data-id"):Crm.userDetails.USER_ID;Events.currentStatus="create",Events.createSource="Blueprint";var l={start:$("#Crm_Events_STARTDATETIME").data("dateObj"),end:$("#Crm_Events_ENDDATETIME").data("dateObj"),activityType:"Events",oldEnd:"",ownerId:n,isAllday:!1};return void Events.checkDuplicateEvent(l,!0,(function(){ProcessFlow.saveFields(e,t,i,a,s)}),!1)}}ProcessFlow.saveFields(e,t,i,a,s)},ProcessFlow.validateAndRenderPipelineInput=function(){var e=$("#moduleSel").val(),t=$("#processField option:selected").attr("colname");if("Potentials"===e&&"STAGE"===t){var i=$("#layoutSel").val();0===store.peekAll("layout").length?store.findAll("layout",{module:Crm.moduleInfo.Potentials.apiname}).then((function(){ProcessFlow.renderPipelineOptions(i)})):ProcessFlow.renderPipelineOptions(i)}else $("#pipelineInput").hide()},ProcessFlow.renderPipelineOptions=function(e){store.model.layout.data.filterBy({id:e})[0].sections.forEach((function(t){var i=t.fields.filterBy({column_name:"PIPELINE"});0!=i.length&&(ProcessFlow.PipelineOptionsTemplate||(ProcessFlow.PipelineOptionsTemplate=Handlebars.compile("{{#each pick_list_values}}<option>{{this.display_value}}</option>{{/each}}")),$("#pipelineList").html(ProcessFlow.PipelineOptionsTemplate(i[0][e])).trigger("change"),$("#pipelineInput").show())}))},ProcessFlow.getAttachDropdown=function(e){var t=Handlebars.templates.personalityAction({actions:e.Actions,rid:e.relListId,name:e.persName,mailObj:e.mailObj,entityId:crmRelatedList.EntityId,moduleName:e.Module,fromSrc:"bluePrint"}),i=$(t),a=$(".bodycontainer"),s=i.find(".atch-droplist"),r=s.clone();return r.attr("id","bp-attachment"),s.remove(),$("#bp-attachment").hasClass("atch-droplist")||a.append(r),i},ProcessFlow.refreshPage=function(e,t){"canvas"===Lyte.Router.getRouteInstance().routeName&&"entity"===Lyte.Router.getRouteInstance().parent.routeName?Lyte.Router.getRouteInstance().refresh():(crmTab.deleteFromCache(e),reloadCurrentEntityView(t,e,(function(){CFRExec&&(CFRExec.promptIfMandatory=!1,CFRExec.haltStageChange({}),CFRExec.evalRules("view",!0))})))},ProcessFlow.postTransitionAction=function(e,t,i){if(crmui.hidePopup("multipleFieldsEditPop"),removeFreezeLayer(),detailView.setScoreRulePreviousData(),CScriptLib){var a={};ProcessFlow.currentTransitionDetails&&ProcessFlow.currentTransitionDetails.TransitionId&&(a.id=ProcessFlow.currentTransitionDetails.TransitionId,a.name=ProcessFlow.currentTransitionDetails.Name),CScript.dispatchEvent("afterTransition",void 0,a)}if(detailView.refreshInWms)detailView.hideElementsForKafkaWorkFlow(e);else if($("#awtAppRecsDIV").length>0){var s={};s[ProcessFlow.ACTION]=ProcessFlow.GET_NEXT_TRANSITION,s.module=e,s.entityId=t,(new crmRequestPool).initiate({type:ProcessFlow.GET_REQUEST_TYPE,action:ProcessFlow.PROCESS_URL,data:s,success:function(a){$("#multipleFieldEditSaveBtn").prop("disabled",!1),$("#pb_processButtonLayerInner, #transitionBtnLayer").find(".pb_transitionState").removeClass("eventNone");var s=objectUtils.getValueFromObj(a,["NextTransitions","Transitions"]);if(s){var r=$("#listView_"+t),o=r.find(".nextTrans"),n=r.find(".bptname"),l="",d="",c=a.NextTransitions.IsCriteriaTransEnabled;if(s.length>0){var u=0,m=a.Continuous;d=d+'<div class="ellipsistext">'+a.NextTransitions.ProcessName+"</div>",n.html(d);var p=[];s.forEach((function(s){if((c||s.IsCriteriaMatched)&&s.IsAccessible)if(u++,s.IsAutoTrans)p.push(s);else{var r="",o="",n="";void 0!==s.progress&&(r='<progress max="'+s.progress.total+'" value="'+s.progress.saved+'" class="bp_progressbar_btn"></progress>');var d='class="my-jobs-bp-trans-buttons"';!s.IsCriteriaMatched&&c?(o='onmouseover=ProcessFlow.showCriteriaSummary(this,"'+$ESAPI.encoder().encodeForJavaScript(s.Summary)+'",true,false)',n='onmouseout="ProcessFlow.hideCriteriaSummary(true)"',d='class="my-jobs-bp-trans-buttons bpTransDisable"',l=l+'<p id="transBtn_'+a.NextTransitions.EntityId+"_"+s.TransitionId+'" onclick="sE(event);" data-stateid="'+a.NextTransitions.CurrentStateId+'" '+d+" "+o+" "+n+">"+$ESAPI.encoder().encodeForHTML(s.TransitionName)+r+"</p>"):s.IsCriteriaMatched&&(l=l+'<p data-stateid="'+a.NextTransitions.CurrentStateId+'" '+d+" onclick=\"sE(event);ProcessFlow.doTransition('"+$ESAPI.encoder().encodeForJavaScript(e)+"', '"+$ESAPI.encoder().encodeForJavaScript(t)+"', '"+$ESAPI.encoder().encodeForJavaScript(s.TransitionRelId)+"', '"+$ESAPI.encoder().encodeForJavaScript(i)+"',"+void 0+","+m+')">'+$ESAPI.encoder().encodeForHTML(s.TransitionName)+r+"</p>")}})),p.forEach((function(e){l=l+'<p class="readOnlyMode cB vab w100p"><span style="color:#d3a921">'+$ESAPI.encoder().encodeForHTML(e.TransitionName)+"</span> "+I18n.getMsg("blueprint.autotrans.exec.msg")+'<span class="proximal color_6">'+e.execution_time+"</span></p>"})),0===u&&(l=l+'<span style="position: static;" class="pbconfigProcess" onclick="sE(event);ProcessFlow.checkForTransitionPreview(\''+$ESAPI.encoder().encodeForJavaScript(t)+"','"+$ESAPI.encoder().encodeForJavaScript(e)+'\' );">View Configured Process</span><div id="pb_processPreviewLayer" onclick="sE(event);"></div>'),l+='<div class="cB"></div>',o.html(l)}else{r.remove();var f=$("#awtAppRecsDIV > table > tbody").find("tr").length,v=$L("crm-myjobs")[0];1!==v.getData("totalNumberOfRecords")-v.getData("initialIndex")&&0!==f||(v.getData("page")-1>0&&v.getData("records")&&(v.setData("page",v.getData("page")-1),v.setData("initialIndex",(v.getData("page")-1)*v.getData("recordPerPage"))),v.component.methods.showMoreProcessRecords(v.getData("type"),v))}}}})}else detailView.isBlueprintPageRefresh=!0,ProcessFlow.refreshPage(e,t)},ProcessFlow.proceedWidget=function(){var e=ProcessFlow.widgetCache.pop(),t=e.recordId,i=e.module,a=e.recordName,s={blueprint:[{transition_id:e.transition.id,data:{widget:{id:e.widget.id}}}]},r={params:JSON.stringify(s),headers:{"Content-Type":"application/json"}};networkUtils.lyteInitiateRequest("/crm/v2.1/"+moduleRecordMapping[i].api_name+"/"+t+"/actions/blueprint","PUT",r).then((function(){ProcessFlow.postTransitionAction(i,t,a)})).catch((function(s){var r=s.responseJSON;if("invalid transition"!==r.message){var o=objectUtils.getValueFromObj(r,["details","validation_error",0]);o&&"widget"===o.api_name&&"Invalid widget"===o.message?renderingUtils.showCustomAlert(I18n.getMsg("blueprint.transition.removed.widget",[e.transition.name])):renderingUtils.showAlertMsg(I18n.getMsg("crm.errorpage.note1")),crmui.hidePopup("multipleFieldsEditPop"),removeFreezeLayer()}else{renderingUtils.showAlertMsg(I18n.getMsg("blueprint.transition.invalid",[e.transition.name]),void 0,void 0,{onAccept:function(){ProcessFlow.postTransitionAction(i,t,a)}})}}))},ProcessFlow.validateAndClosePopUp=function(){var e=ProcessFlow.widgetCache.pop(),t=e.recordId;if(($("#awtAppRecsDIV").length>0?document.getElementById("listView_"+t).querySelector(".nextTrans p"):document.querySelector(".pb_transitionState")).getAttribute("data-stateid")===e.stateId)crmui.hidePopup("multipleFieldsEditPop");else{var i=e.module,a=e.recordName;ProcessFlow.postTransitionAction(i,t,a)}},ProcessFlow.checkDuplicateAssociation=function(e,t,i,a){var s=[],r=!1,o=ProcessFlow.ExcecutionObjs.module===a?$("#fieldsContainer"):$("#"+i+"_rlContainer"),n=$(e);if($.each(o.find("input"),(function(i,a){if((a=$(a)).data("colname").startsWith("LINKINGMXN"))if(a.data("isMXNDuplicate")&&($("#errorMsg_"+a.attr("id")).remove(),a.closest(".errorFieldP").removeClass("errorFieldP"),a.data("isMXNDuplicate",!1)),a.attr("id")===e.id)s.push(t);else{var o=a.data("id");validationUtils.isEmpty(o)&&(r=!0),s.push(o)}})),!r){var l={};l.module=a,l.linkingLookupValue1=s[0],l.linkingLookupValue2=s[1],l.action="checkDuplicateAssociation",networkUtils.setCsrfParam(l);var d={};d.params=l,networkUtils.lyteInitiateRequest(ProcessFlow.PROCESS_URL,"GET",d).then((function(t){var i=JSON.parse(t),s=i.isDuplicate&&i.duplicateRecordId!==ProcessFlow.ExcecutionObjs.entityId;s?Crm.showErrorMsg(I18n.getMsg("crm.blueprint.duplicate.association"),n,a,!0):($("#errorMsg_"+e.id).remove(),n.closest(".errorFieldP").removeClass("errorFieldP")),n.data("isMXNDuplicate",s)}))}},ProcessFlow.removeMultiUserDropdown=function(){$.each(Crm.fieldsObj[ProcessFlow.ExcecutionObjs.module],(function(e,t){var i=$("#"+t);445===i.data("uitype")&&i.data("colname").indexOf("MXNDUMMYCOLUMN")>-1&&$("#ownerNameLookup_"+t).remove()}))},ProcessFlow.removeTagsDropDown=function(){var e=$L("#tagCruxContainer")[0];e&&e.toggle("close")},ProcessFlow.getOwnerLookupHeight=function(e){var t=e.parent(),i=t.offset(),a={};return a.topOffset=t.innerHeight()+i.top,a.leftOffset=i.left,a},ProcessFlow.getClientPortalStatus=function(e){var t=document.createElement("div");t.classList.add("flex-grid-skeleton","p30","detailviewRevampStage","relatedlist-bg");var i=document.createElement("div");i.classList.add("color_6","mB20","bp_lockedstage_heading","crm-font-bold"),i.innerText=I18n.getMsg("crm.stage.lock.msg");var a=document.createElement("div");a.classList.add("mB20","bp_locked_stage_txt","displayFlex");var s=document.createElement("span");s.classList.add("mR30"),s.innerText=I18n.getMsg("crm.transition.current.stage");var r=document.createElement("span");r.classList.add("color_3","pR","bp_locked_stage"),r.innerText=e,a.appendChild(s),a.appendChild(r);var o=document.createElement("div");o.classList.add("bp_locked_stage_txt"),o.innerText=I18n.getMsg("crm.stage.lock.desc.new",Crm.appName),t.appendChild(i),t.appendChild(a),t.appendChild(o),$("#pb_processButtonLayer").html(t)},ProcessFlow.showCriteriaSummary=function(e,t,i,a,s){var r=$(e);if(i){a||(s=r[0].id),0!==document.getElementById("bp_hoverCardDiv").childNodes.length||a||ProcessFlow.initBlueprintLyteHoverCard(i,"show","bp_hoverCardDiv",r[0].id,t);var o=document.getElementById("blueprintCriteriaHover"),n=document.getElementById("blueprint-criteria-hovercard");o&&(o.ltProp("originElem","#"+s),o.ltProp("show",!0),n.setData("criteriaString",t))}else{$("#bp_hoverCardDiv");(o=document.getElementById("blueprintCriteriaHover")).ltProp("originElem","#"+r[0].id),o.ltProp("show",!0),(n=document.getElementById("blueprint-criteria-hovercard")).setData("criteriaString",t)}},ProcessFlow.initBlueprintLyteHoverCard=function(e,t,i,a,s){var r=networkUtils.returnDependencyFiles(["lyte-hovercard.js","crm-blueprint.js"],crmConstants.jsStaticPathForLyte),o=networkUtils.returnDependencyFiles(["crm-blueprint-dependents.css"],crmConstants.cssStaticPathForLyte);o=o.concat(r),Lyte.injectResources(o,void 0,(function(){Lyte.Component.render("crm-blueprint-hovercard",{buttonElementId:"#"+t,criteriaString:""},"#"+i),ProcessFlow.showCriteriaSummary(void 0,s,e,!0,a)}))},ProcessFlow.hideCriteriaSummary=function(e){if(e){var t=document.getElementById("bp_hoverCardDiv").childNodes;if(t.length>0)t[0].ltProp("show",!0)}else{document.getElementById("blueprintCriteriaHover").ltProp("show",!0)}};