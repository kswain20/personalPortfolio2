var CFRExec={formRuleModule:null,oldResJson:{},CFRules:{},actionTakenTrueHolder:{},actionTakenFalseHolder:{},LayoutRuleHiddenElem:[],LayoutRuleConditionInvolvedElem:[],mandatoryInputNeededElem:[],lrMandatoryElem:[],relatedEntityMap:{},_relatedEntityMap:{},tabIndexingResult:[],ruleLayoutId:null,ajaxEditedFields:[],ajaxEditHaltedFieldColName:void 0,ajaxEditHaltNeeded:!1,promptIfMandatory:!1,workOnDom:!1,haltStateParams:{},revertPotentials:void 0,tempHolder:{},setDependentCall:!1,isServiceAvailabilitySection:!1,fromVR:!1,feature:void 0,CONSTANTFORSTRING:{EMPTYSTRING:"",FORMRULEDATATYPE:"frDT"},OPERATIONCONSTANT:{EDIT:"edit",VIEW:"view",PRINT:"print",LIST:"list",QUICK_CREATE:"quick_create"},DATATYPE:{PICKLIST:"picklist",DATE:"D",DATETIME:"DT",NUMBER:"N",TEXT:"T",BOOLEAN:"B",USER:"U"},COMMONCOMPARATOR:{EMPTY:"${EMPTY}",NOTEMPTY:"${NOTEMPTY}"},TEXTCOMPARATOR:{IS:"is",ISNT:"isn't",CONTAINS:"contains",DOESNTCONTAINS:"doesn't contain",STARTSWITH:"starts with",ENDSWITH:"ends with"},NUMBERCOMPARATOR:{EQUAL:"=",NOTEQUAL:"!=",LESSTHAN:"<",LESSTHANEQUAL:"<=",GREATERTHAN:">",GREATERTHANEQUAL:">=",BETWEEN:"between",NOTBETWEEN:"not between"},DATETIMECOMPARATOR:{TODAY:"${TODAY}",TOMORROW:"${TOMORROW}",STARTINGTOMORROW:"${TOMORROWPLUS}",YESTERDAY:"${YESTERDAY}",TILLYESTERDAY:"${YESTERDAYMINUS}",LASTMONTH:"${LASTMONTH}",CURRENTMONTH:"${THISMONTH}",NEXTMONTH:"${NEXTMONTH}",AGEORDUE:"${AGE",LASTWEEK:"${LASTWEEK}",CURRENTWEEK:"${THISWEEK}",NEXTWEEK:"${NEXTWEEK}",BETWEEN:"between",NOTBETWEEN:"not between",ISAFTER:"is after",ISBEFORE:"is before",ISNT:"isn't",IS:"is"},CFRule:function(){this.cfPrimaryFieldName,this.queryObj={}},CFQuery:function(){this.actionsObj={},this.conditionsObj={},this.logicRepresentation},CFRCondition:function(){this.relationalcriteriaid,this.conditionElementName,this.dataType,this.comparatorStr,this.compareValue=[],this.userCompareDTValue=[],this.islookup,this.casesensitive},CFRAction:function(){this.actionElementId,this.actionElementName,this.actionType,this.actionValue},init:function(e,t,a,i){var n=CFRExec.OPERATIONCONSTANT.QUICK_CREATE===a;if(n?CFRExec.initQCObject(t,i):(CFRExec.moveToTempHold(),CFRExec.CFRules={},CFRExec.ruleLayoutId=null,CFRExec.haltStateParams={},CFRExec.relatedEntityMap={},CFRExec.oldResJson=e,CFRExec.formRuleModule=t),"string"==typeof e&&(e=$.parseJSON(e)),!validationUtils.isEmpty(e.rules)){for(var r in CFRExec.ruleLayoutId=e.layoutId,CFRExec.LayoutRuleConditionInvolvedElem=[],CFRExec.LayoutRuleHiddenElem=[],e.rules){var s=e.rules[r],o=new CFRExec.CFRule;o.cfPrimaryFieldName=s.pfcol;for(var l=s.qarr,d=l?l.length:0,c=0;c<d;c++){var m=l[c].actns,u=l[c].cnds,v=new CFRExec.CFQuery;v.logicRepresentation=l[c].lrep;for(var p=u.length,h=0;h<p;h++){var g=u[h],C=new CFRExec.CFRCondition;C.casesensitive=g.cs,C.relationalcriteriaid=g.rcid,C.conditionElementName=g.col,C.compareStr=g.cmps,C.compareValue=g.cmpv,C.dataType=g.dt,C.userCompareDTValue=g.ufdtarr,!0===g.islkup&&(C.isLookup=g.islkup),v.conditionsObj[h+1]=C,CFRExec.LayoutRuleConditionInvolvedElem.pushUniqValues(g.col)}for(var f=m.length,E=0;E<f;E++){var I=m[E],y=new CFRExec.CFRAction;if(y.actionType=I.atyp,1===y.actionType||4===y.actionType)y.actionElementId=CFRExec.getElemId(a,I.aenm,I.isAggField),y.isAggField=I.isAggField;else{if(n)continue;y.actionElementId="secDiv_"+I.aenm.replace(/ /g,"_")}y.actionElementName=I.aenm,y.actionValue=I.val,v.actionsObj[E+1]=y}o.queryObj[c+1]=v}CFRExec.CFRules[r]=o}a===CFRExec.OPERATIONCONSTANT.EDIT&&$("#preHTMLContainer_"+t).find(".labelValCreate :input,crm-user-wrapper[id^=Crm_]").not("[data-subformdisplaylabel]").on("executeFormRules",(function(){var e=$(this).data(),t=e.colname;if(void 0!==e.colname&&void 0===e.subformdisplaylabel){var i=CFRExec.getValueFromEditForm(this,a);CFRExec.setValue(t,i,CFRExec.OPERATIONCONSTANT.EDIT),CFRExec.isColTriggerLayoutRule&&CFRExec.evalRules(a,!0)}}))}n&&(i.qcObject.LayoutRuleConditionInvolvedElem=CFRExec.LayoutRuleConditionInvolvedElem,i.qcObject.LayoutRuleHiddenElem=CFRExec.LayoutRuleHiddenElem,i.qcObject.ruleLayoutId=CFRExec.ruleLayoutId)},getValueFromEditForm:function(e,t){var a=$(e).data("colname"),i=$(e).data("uitype"),n=$(e).val();return n!==CFRExec.CONSTANTFORSTRING.EMPTYSTRING?786===i||30===i||14===i||333===i?n=CFRExec.getDateTimeValue(a,t):4===i||5===i||6===i||7===i||9===i||10===i||12===i||13===i||15===i||133===i||i===CrmField.UITYPES.SYSTEM_SINGLE_LOOK_UP_ENTITY?n=$(e).data("id")+"#"+n:301!==i&&300!==i||(n=$(e).is(":checked")?"true":"false"):8===i&&(n=$(e).data("id")+"#"+n),n},getDateTimeValue:function(e,t){if(t===CFRExec.OPERATIONCONSTANT.QUICK_CREATE){var a=CFRExec.getContainerDiv(t),i=".Crm_"+CFRExec.formRuleModule+"_"+e;return"HH:mm"===Crm.userDetails.TIME_FORMAT?a.find(i).val()+" "+a.find(i+"_dateTime").val():a.find(i).val()+" "+a.find(i+"_dateTime").val()+" "+a.find(i+"_ampm").val()}return $("#Crm_"+CFRExec.formRuleModule+"_"+e).val()+" "+$("#Crm_"+CFRExec.formRuleModule+"_"+e+"_TimeOption").val()},evalRules:function(e,t){var a=CFRExec.OPERATIONCONSTANT.QUICK_CREATE===e;if(!a&&void 0!==Lyte.Router.getRouteInstance()&&void 0!==Lyte.Router.getRouteInstance().currentModel){var i=Lyte.Router.getRouteInstance().currentModel.module;void 0===i&&Lyte.Router.getRouteInstance().currentModel.model&&(i=Lyte.Router.getRouteInstance().currentModel.model.module)}if(a||void 0!==CFRExec.previousModuleName||(CFRExec.previousModuleName=i),"60005199882"==Crm.userDetails.ZGID&&(murphy.addCustomTracking({message:JSON.stringify(CFRExec.CFRules),name:"CFRules",type:"custom event"}),murphy.addCustomTracking({message:e,name:"Operation",type:"custom event"}),murphy.addCustomTracking({message:!validationUtils.isEmpty(CFRExec.CFRules),name:"holdFormRule",type:"custom event"}),murphy.addCustomTracking({message:CFRExec.ruleLayoutId,name:"layoutid",type:"custom event"}),murphy.addCustomTracking({message:Crm.userDetails.LAYOUTRULEAVAILABLE,name:"layoutruleAvailable",type:"custom event"}),murphy.addCustomTracking({message:CFRExec.getCurrentLayoutId(e),name:"currentlayoutid",type:"custom event"}),murphy.addCustomTracking({message:CFRExec.getCurrentLayoutId(e)===CFRExec.ruleLayoutId,name:"layoutidcondition",type:"custom event"}),murphy.addCustomTracking({message:CFRExec.getCurrentLayoutId(e)==CFRExec.ruleLayoutId,name:"layoutidcondition2",type:"custom event"}),murphy.error(new Error("cx2 Layout Rule Related Information-rEMapAfterCFRules"))),!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&CFRExec.holdFormRule()&&CFRExec.getCurrentLayoutId(e)===CFRExec.ruleLayoutId){for(var n in CFRExec.actionTakenFalseHolder={},CFRExec.actionTakenTrueHolder={},CFRExec.workOnDom=t,0===Object.keys(CFRExec.relatedEntityMap).length&&(CFRExec.relatedEntityMap=CFRExec.getRelatedEntityMap(e)),a||"Leads"!==CFRExec.formRuleModule&&"Contacts"!==CFRExec.formRuleModule||CFRExec.correctEntityMapForSalutation(e),"675892647"!=Crm.userDetails.ZGID&&"659089839"!=Crm.userDetails.ZGID&&"55171602"!=Crm.userDetails.ZGID&&"60005199882"!=Crm.userDetails.ZGID||(murphy.addCustomTracking({message:JSON.stringify(CFRExec.relatedEntityMap),name:"relatedEntityMapAfter",type:"custom event"}),murphy.addCustomTracking({message:JSON.stringify(CFRExec.CFRules),name:"CFRules",type:"custom event"}),murphy.addCustomTracking({message:JSON.stringify(CFRExec.LayoutRuleHiddenElem),name:"LayoutRuleHiddenElem",type:"custom event"}),murphy.addCustomTracking({message:JSON.stringify(CFRExec.mandatoryInputNeededElem),name:"mandatoryInputNeededElem",type:"custom event"}),murphy.addCustomTracking({message:JSON.stringify(CFRExec.lrMandatoryElem),name:"lrMandatoryElem",type:"custom event"}),murphy.error(new Error("Layout Rule Related Information-rEMapAfterCFRules"))),CFRExec.CFRules)if(CFRExec.relatedEntityMap.hasOwnProperty(CFRExec.CFRules[n].cfPrimaryFieldName))for(var r in CFRExec.CFRules[n].queryObj){var s=CFRExec.CFRules[n].queryObj[r].logicRepresentation,o=null,l=null;for(var d in 1===s.length?(o=!1,l=!1):null===s.match(/\|/)?o=!0:null===s.match(/&/)&&(l=!0),CFRExec.CFRules[n].queryObj[r].conditionsObj){var c=!1;if(CFRExec.relatedEntityMap.hasOwnProperty(CFRExec.CFRules[n].queryObj[r].conditionsObj[d].conditionElementName)>0){var m=CFRExec.getValue(CFRExec.CFRules[n].queryObj[r].conditionsObj[d].conditionElementName,e,CFRExec.CFRules[n].queryObj[r].conditionsObj[d].dataType);if("Potentials"===CFRExec.formRuleModule&&"STAGE"===CFRExec.CFRules[n].queryObj[r].conditionsObj[d].conditionElementName&&-1!==m.indexOf(":")){m=m.substring(m.indexOf(":")+1,m.length);var u=CFRExec.CFRules[n].queryObj[r].conditionsObj[d].compareValue;if("${OPEN}"===u[0]||"${CLOSEDWON}"===u[0]||"${CLOSEDLOST}"===u[0]){var v=$("#Crm_Potentials_STAGE"),p=v.data("values"),h="html",g="fcCategory";!p&&ajaxEdit&&(p=returnJson.entityMapJson.STAGE.val,h="name",g="fccategory");var C=null;if(p)for(var f=p.length,E=0;E<f;E++)if(p[E][h]===m){C=p[E][g];break}C||(C=v.find("option:selected").attr("fctype")),"Pipeline"===C||"Open"===C?m="${OPEN}":"Closed"===C||"Closed Won"===C?m="${CLOSEDWON}":"Omitted"!==C&&"Closed Lost"!==C||(m="${CLOSEDLOST}")}}CFRExec.fieldVsValue&&(CFRExec.fieldVsValue[CFRExec.CFRules[n].queryObj[r].conditionsObj[d].conditionElementName]=m),c=CFRExec.getCompareResult(CFRExec.CFRules[n].queryObj[r].conditionsObj[d].conditionElementName,CFRExec.CFRules[n].queryObj[r].conditionsObj[d].dataType,m,CFRExec.CFRules[n].queryObj[r].conditionsObj[d].compareStr,CFRExec.CFRules[n].queryObj[r].conditionsObj[d].compareValue,CFRExec.CFRules[n].queryObj[r].conditionsObj[d].userCompareDTValue,CFRExec.CFRules[n].queryObj[r].conditionsObj[d].casesensitive);var I=CFRExec.CFRules[n].queryObj[r].actionsObj,y=!1;for(var R in I)if(1===I[R].actionType){y=!0;break}if(c!=CFRExec.tabIndexingResult[d]&&y&&(CFRExec.tabIndexingResult[n]=c,CFRExec.tabIndexingRequired=!0),CFRExec.CFRules[n].cfPrimaryFieldName===CFRExec.CFRules[n].queryObj[r].conditionsObj[d].conditionElementName&&!1===c){s=!1;break}}else c=s.indexOf(CFRExec.CFRules[n].queryObj[r].conditionsObj[d].relationalcriteriaid+"&")>-1||s.indexOf("&"+CFRExec.CFRules[n].queryObj[r].conditionsObj[d].relationalcriteriaid)>-1;if("ignore"===c){s="ignore";break}if(o&&!1===c){s=!1;break}if(l&&!0===c){s=!0;break}s=s.replace(CFRExec.CFRules[n].queryObj[r].conditionsObj[d].relationalcriteriaid,c)}var b=s;if("boolean"!=typeof s){if("ignore"===s)break;b=CFRExec.evalBooleanExpression(s)}CFRExec.handleActionTakenLaterHolder(CFRExec.CFRules[n].queryObj[r].actionsObj,b,e)}CFRExec.performActionFromHolder(e),!CFRExec.tabIndexingRequired&&CFRExec.previousModuleName==i||null==i||(CFRExec.previousModuleName=i,CFRExec.tabIndexingRequired=!1,CFRExec.tabIndexing()),e===CFRExec.OPERATIONCONSTANT.VIEW&&CFRExec.promptIfMandatory&&CFRExec.promptMandatoryInputIfApplicable()}CFRExec.actionTakenFalseHolder={},CFRExec.actionTakenTrueHolder={},CFRExec.fromVR=!1},addListenerForQCMode:function(e,t){if(CFRExec.QCObj&&validationUtils.isNotEmpty(CFRExec.QCObj.CFRules)){var a=$("#"+t);a.find(".labelValCreate :input,crm-user-wrapper[id^=Crm_]").on("change",(function(){CFRExec.collectFieldInfoForQCAndTrigger(this,e)})),a.find(".labelTabCreate :input,crm-user-wrapper[class^=Crm_]").on("change",(function(){CFRExec.collectFieldInfoForQCAndTrigger(this,e)}))}},collectFieldInfoForQCAndTrigger:function(e,t){var a=$(e).data(),i=a.colname;if(void 0!==a.colname){var n=CFRExec.getValueFromEditForm(e,CFRExec.OPERATIONCONSTANT.QUICK_CREATE);CFRExec.setValue(i,n,CFRExec.OPERATIONCONSTANT.QUICK_CREATE),CFRExec.isColTriggerLayoutRule(i)&&CFRExec.evalRulesForQCMode(t)}},evalRulesForQCMode:function(e,t){if(CFRExec.QCObj&&validationUtils.isNotEmpty(CFRExec.QCObj)&&validationUtils.isNotEmpty(CFRExec.QCObj.CFRules)){if(t)for(var a=Object.keys(t),i=a.length,n=0;n<i;n++){var r=t[a[n]],s=r.column_name,o=$(".Crm_"+e+"_"+s);o&&(o.data({colname:s,uitype:r.uitype}),"DateTime"===r.type&&$(".Crm_"+e+"_"+s+"_dateTime").data({colname:s,uitype:r.uitype})),CFRExec.relatedEntityMap[s]={uitype:r.uitype+"",type:r.type,mandate:r.mandatory};var l=CFRExec.getValueFromEditForm(o,CFRExec.OPERATIONCONSTANT.QUICK_CREATE);CFRExec.setValue(s,l,CFRExec.OPERATIONCONSTANT.QUICK_CREATE)}CFRExec.evalRules(CFRExec.OPERATIONCONSTANT.QUICK_CREATE,!0)}},initQCObject:function(e,t){var a=t.qcObject;a.formRuleModule=e,a.ruleLayoutId=null,a.relatedEntityMap={},a.CFRules={},a.promptIfMandatory=!1,a.LayoutRuleHiddenElem=[],a.LayoutRuleConditionInvolvedElem=[],CFRExec.QCObj&&(t.previousModeTempHolder.previousQCObject=CFRExec.QCObj),CFRExec.makeReallocationForQC(a,!1,t.previousModeTempHolder)},makeReallocationForQC:function(e,t,a){var i=["formRuleModule","ruleLayoutId","CFRules","relatedEntityMap","LayoutRuleConditionInvolvedElem","LayoutRuleHiddenElem","promptIfMandatory"],n=i.length;if(t){if(a)for(r=0;r<n;r++)CFRExec[i[r]]=a[i[r]];delete CFRExec.QCObj}else{CFRExec.QCObj=e;for(var r=0;r<n;r++)a[i[r]]=CFRExec[i[r]],CFRExec[i[r]]=e[i[r]]}},flushQCDataForMod:function(e){var t=CFRExec[e];void 0!==t&&(t&&validationUtils.isNotEmpty(t)&&(CFRExec.makeReallocationForQC(void 0,!0,t),t.previousQCObject&&(CFRExec.QCObj=t.previousQCObject)),delete CFRExec[e])},getWorkingContainer:function(){var e=$("#multipleFieldsEditPop");!1===e.is(":visible")&&!1===(e=$("#closedWon")).is(":visible")&&(e=$("#formRuleMandatoryFields"));var t=$("#VRAjaxEdit");return(CFRExec.fromVR||!0===t.is(":visible"))&&(e=t),e},tabIndexing:function(){var e=$(".secContent"),t=1;setTimeout((function(){$(".select2-hidden-accessible").length>0&&$.fn.select2.defaults.reset();for(var a=e.length,i=0;i<a;i++){for(var n=e[i],r=$(n).children(),s=$(r[0]).children(),o=$(r[1]).children(),l=0,d=s.length,c=o.length,m=0;m<d;m++){var u=$(s[m]).find(".labelValCreate");if("none"!=s[m].style.display){if(t=CFRExec.tabIndexingForFields(u,t),o[l]&&"2"==$(e[i]).attr("tab-traversal"))for(var v=l;v<c;v++){u=$(o[v]).find(".labelValCreate");if("none"!=o[v].style.display){t=CFRExec.tabIndexingForFields(u,t),l++;break}CFRExec.setTabindexForHiddenFields(u),l++}}else CFRExec.setTabindexForHiddenFields(u)}for(var p=l;p<c;p++){u=$(o[p]).find(".labelValCreate");"none"!=o[p].style.display?t=CFRExec.tabIndexingForFields(u,t):CFRExec.setTabindexForHiddenFields(u)}}}),1)},hideWorkingContainer:function(){var e="multipleFieldsEditPop",t=$("#multipleFieldsEditPop");!1===t.is(":visible")&&(e="closedWon",!1===(t=$("#closedWon")).is(":visible")&&(e="formRuleMandatoryFields",t=$("#formRuleMandatoryFields"))),CFRExec.fromVR&&(e="VRAjaxEdit",t=$("#VRAjaxEdit")),t.empty(),crmui.hidePopup(e)},promptMandatoryInputIfApplicable:function(){for(var e=[],t=$("#subSecondaryPopup").is(":visible"),a=CFRExec.getWorkingContainer(),i=CFRExec.lrMandatoryElem.length,n=0;n<i;n++){var r=CFRExec.lrMandatoryElem[n];if("FIRSTNAME"!==r)if(!CFRExec.isLayoutRuleHiddenElem(r)||CFRExec.skipActionForFeature(1)){if(CFRExec.mandatoryInputNeededElem.contains(r))e.push(r);else if(a.length>0){(s=a.find("#"+CFRExec.formRuleModule+"_fldRow_"+r)).find(".labelTabCreate").addClass("newmandatory"),s.find(".labelValCreate").find(":input[id^=Crm_],div[id^=Crm_],crm-user-wrapper[id^=Crm_]").data("mandate","true"),s.show()}}else if(a.length>0){var s;(s=a.find("#"+CFRExec.formRuleModule+"_fldRow_"+r)).find(".labelTabCreate").removeClass("newmandatory"),s.find(".labelValCreate").find(":input[id^=Crm_],div[id^=Crm_],crm-user-wrapper[id^=Crm_]").data("mandate","false"),s.hide()}}if(e.length>0){var o=a.is(":visible");if(o){var l=a.find(".fieldsContainer"),d=e.length;crmTemplate.dependentFieldsList=[];for(var c=0;c<d;c++){var m=l.find("#"+CFRExec.getElemId(CFRExec.OPERATIONCONSTANT.EDIT,e[c]));m.find(".labelTabCreate").hasClass("newmandatory")||m.addClass("LR"),m.length>0?m.hasClass("LR")&&(m.find(".labelTabCreate").addClass("newmandatory"),m.find(".labelValCreate").find(":input[id^=Crm_],div[id^=Crm_],crm-user-wrapper[id^=Crm_]").data("mandate","true")):l.append(CFRExec.getFieldRow(e[c]))}CFRExec.makeFieldsOptionalIfNeeded(a,CFRExec.lrMandatoryElem),t&&($("#subSecondaryPopup .fieldsContainer .labelTabCreate").addClass("columnCal1"),labelWidthFixed("","subSecondaryPopup"))}else{var u=$(Handlebars.templates.FormRuleMandatoryFieldsInput()),v=(l=u.find(".fieldsContainer"),e.length);for(c=0;c<v;c++)l.append(CFRExec.getFieldRow(e[c]));$("#show").prepend(u),a=$("#formRuleMandatoryFields")}for(var p=a.find(".labelValCreate").find("input,select,textarea"),h=p.length,g=0;g<h;g++)p[g].setAttribute("tabindex",g+1);if(void 0!==CFRExec.ajaxEditHaltedFieldColName&&(CFRExec.ajaxEditHaltNeeded=!0),commonUtils.showHideLoadingDiv(),!o){var C=p.eq(0);if(void 0!==C){var f=C.attr("data-uitype");void 0===f||"1"==f||"110"==f?C.addClass("focusEleField").focus():C.focus()}crmui.showPopup("formRuleMandatoryFields",!0)}"60005199882"==Crm.userDetails.ZGID&&(murphy.addCustomTracking({message:JSON.stringify(CFRExec.lrMandatoryElem),name:"CFRExec.lrMandatoryElem",type:"custom event"}),murphy.addCustomTracking({message:JSON.stringify(CFRExec.mandatoryInputNeededElem),name:"CFRExec.mandatoryInputNeededElem",type:"custom event"}),murphy.addCustomTracking({message:JSON.stringify(CFRExec.LayoutRuleHiddenElem),name:"CFRExec.LayoutRuleHiddenElem",type:"custom event"}),murphy.error(new Error("promptMandatoryInputIfApplicable function tracking")))}else CFRExec.ajaxEditHaltNeeded=!1,CFRExec.promptIfMandatory=!1,CFRExec.makeFieldsOptionalIfNeeded(a,CFRExec.lrMandatoryElem);CFRExec.handleChangeEventForFREval(a),CFRExec.setDependentCall&&(crmTemplate.setDependentFields(detailView.currentModule,CFRExec.OPERATIONCONSTANT.VIEW),CFRExec.setDependentCall=!1)},getFieldRow:function(e){var t=crmTemplate.createFieldRow(returnJson.layout_jsonarrayObj.currLayoutId,CFRExec.formRuleModule,void 0,CFRExec.relatedEntityMap[e]);return"2"!==CFRExec.relatedEntityMap[e].uitype&&"100"!==CFRExec.relatedEntityMap[e].uitype||(CFRExec.setDependentCall=!0),$(t).addClass("LR"),t},modifyAndTriggerDomChangeEvent:function(e){if("36"==$(e).data().uitype){var t=$("#multipleFieldsEditPop").is(":visible"),a=$("#formRuleMandatoryFields").is(":visible");if(t||a){var i=$(e).parent().find(".resultValue").attr("data-valueres");null!=i&&null!=i&&(e.value=i)}}$(e).trigger("create_edit_clone_DomChange",e)},handleChangeEventForFREval:function(e){var t=e.find(":not(.sfFormulaCalcBP).labelValCreate").find(":input[id^=Crm_],div[id^=Crm_]");t.off("change").on("change",(function(){CFRExec.modifyAndTriggerDomChangeEvent(this)})),t.off("create_edit_clone_DomChange").on("create_edit_clone_DomChange",(function(e){var t=CFRExec.validateObject(this);100===$(t).data("uitype")?CFRExec.setValue($(t).data("colname"),CFRExec.getValueFromEditForm($(t)),CFRExec.OPERATIONCONSTANT.VIEW):CFRExec.validateElementAndEvaluateLayoutRule(t),"SELECT"==$(this).prop("tagName")&&crmTemplate.modifySelectBox(e)})),thirdPartyUtils.bindSelect2(e.find("select")),crmTemplate.bindFldTooltip()},validateObject:function(e){var t=$(e).attr("id");if(-1!==t.indexOf("_TimeOption")){var a=t.substring(0,t.indexOf("_TimeOption"));return document.getElementById(a)}return e},makeFieldsOptionalIfNeeded:function(e,t){for(var a=e.find("div.LR"),i=a.length,n=null!=document.getElementById("multipleFieldsEditPop"),r=0;r<i;r++){var s=a.eq(r),o=s.find(".labelValCreate").find(":input[id^=Crm_],div[id^=Crm_],crm-user-wrapper[id^=Crm_]"),l=o.data("colname");t.contains(l)||(n?s.remove():(s.find(".labelTabCreate").removeClass("newmandatory"),o.data("mandate","false")))}},validateElementAndEvaluateLayoutRule:function(e){var t=[],a=$(e),i=CFRExec.OPERATIONCONSTANT.VIEW;if(t.push(a.attr("id")),Crm.validateEntityAndShowErrorMsg(t,detailView.currentModule,!0)){0==Object.keys(CFRExec.relatedEntityMap).length&&(CFRExec.relatedEntityMap=CFRExec.getRelatedEntityMap(i));var n=a.data("colname");"Lookup"===a.data("contentType")?a.val()===CFRExec.CONSTANTFORSTRING.EMPTYSTRING?CFRExec.setValue(n,"#",i):CFRExec.setValue(n,Crm.requestParamWithColname[a.data("colname")]+"#"+a.val(),i):CFRExec.setValue(n,CFRExec.getValueFromEditForm(e),i),CFRExec.promptIfMandatory=!0,CFRExec.evalRules(i,!1)}},performActionFromHolder:function(e){var t=!1,a=!1,i=CFRExec.getContainerDiv(e);for(var n in CFRExec.mandatoryInputNeededElem=[],CFRExec.lrMandatoryElem=[],CFRExec.actionTakenTrueHolder)switch(CFRExec.actionTakenTrueHolder[n].actionType){case 1:if(void 0!==CFRExec.relatedEntityMap[CFRExec.actionTakenTrueHolder[n].actionElementName]){var r=CFRExec.relatedEntityMap[CFRExec.actionTakenTrueHolder[n].actionElementName];if(CFRExec.workOnDom){if((u=i.find("#"+CFRExec.getElemId(e,CFRExec.actionTakenTrueHolder[n].actionElementName,CFRExec.actionTakenTrueHolder[n].isAggField))).hasClass("agrFld"))u.closest("#tr_"+CFRExec.actionTakenTrueHolder[n].actionElementName).show();else if(u.hasClass("PRICINGMODEL")){var s=$("#"+crmTemplate.getElemIdByColname("PriceBooks","PRICINGMODEL")).val();"-None-"!=s&&s&&$("#secDiv_Pricing_Details").show(),u.show()}else e===CFRExec.OPERATIONCONSTANT.QUICK_CREATE?(u.addClass("formruleshow"),a=!0):u.show();if(e===CFRExec.OPERATIONCONSTANT.VIEW&&CFRExec.handleBusinessCardVisibility(CFRExec.actionTakenTrueHolder[n].actionElementName,!0),"Events"!==CFRExec.formRuleModule){var o=u.closest("."+e+"ParentSection"),l=o.attr("id")+"~2";void 0===o.data("nofield")||CFRExec.actionTakenFalseHolder.hasOwnProperty(l)||o.show()}}CFRExec.LayoutRuleHiddenElem.removeLastOccurenceOfElement(CFRExec.actionTakenTrueHolder[n].actionElementName)}break;case 2:case 6:CFRExec.showHideRequestedSection(i,e,CFRExec.actionTakenTrueHolder[n].actionElementId,!1);break;case 4:if(void 0!==CFRExec.relatedEntityMap[CFRExec.actionTakenTrueHolder[n].actionElementName])if("true"!==(r=CFRExec.relatedEntityMap[CFRExec.actionTakenTrueHolder[n].actionElementName]).restricted&&!0!==r.restricted&&"true"!==r.readonly&&!0!==r.readonly){if(void 0!==r.mandate&&!1!==r.mandate&&"false"!==r.mandate||("boolean"==typeof r.mandate?r.mandate=!0:r.mandate="true",r.frmandate=!0),!0===r.frmandate&&CFRExec.workOnDom){var d=i.find("#"+CFRExec.actionTakenTrueHolder[n].actionElementId);if(e===CFRExec.OPERATIONCONSTANT.EDIT)"FIRSTNAME"===CFRExec.actionTakenTrueHolder[n].actionElementName?d.find("input[id^='Crm_'],textarea[id^='Crm_'],select[id^='Crm_'],div[id^='Crm_'],crm-user-wrapper[id^='Crm_']").not("[id*='SALUTATION']").data("mandate",r.mandate):d.find("input[id^='Crm_'],textarea[id^='Crm_'],select[id^='Crm_'],div[id^='Crm_'],crm-user-wrapper[id^='Crm_']").data("mandate",r.mandate),d.find("#Crm_"+CFRExec.formRuleModule+"_"+CFRExec.actionTakenTrueHolder[n].actionElementName+"_label").addClass("newmandatory");else if(e===CFRExec.OPERATIONCONSTANT.VIEW&&d.data("params"))d.data("params").mandate=r.mandate;else if(e===CFRExec.OPERATIONCONSTANT.QUICK_CREATE){var c=CFRExec.QCObj,m="Crm_"+CFRExec.formRuleModule+"_"+CFRExec.actionTakenTrueHolder[n].actionElementName;c&&c.qcFlow?d.find("#"+m+"_label").addClass("newmandatory"):d.find("td").eq(0).addClass("wf_requiredMark"),d.find("."+m).data("mandate",r.mandate)}}e===CFRExec.OPERATIONCONSTANT.VIEW&&(("Pick List"!==CFRExec.relatedEntityMap[CFRExec.actionTakenTrueHolder[n].actionElementName].type||""!==r.defaultvalue&&"-None-"!==r.defaultvalue)&&("Lookup"!==r.type||void 0!==r.defaultvalue&&""!==r.defaultvalue)&&("Currency"!==r.type||"null"!==r.defaultvalue&&r.defaultvalue!==CFRExec.CONSTANTFORSTRING.EMPTYSTRING)?556!==parseInt(r.uitype)&&""===r.defaultvalue&&CFRExec.mandatoryInputNeededElem.pushUniqValues(CFRExec.actionTakenTrueHolder[n].actionElementName):CFRExec.mandatoryInputNeededElem.pushUniqValues(CFRExec.actionTakenTrueHolder[n].actionElementName),556===parseInt(r.uitype)&&(void 0!==d?0===d.find("crm-image-upload-detail")[0].component.data.imageData.length&&CFRExec.mandatoryInputNeededElem.pushUniqValues(CFRExec.actionTakenTrueHolder[n].actionElementName):""===r.defaultvalue&&CFRExec.mandatoryInputNeededElem.pushUniqValues(CFRExec.actionTakenTrueHolder[n].actionElementName)),CFRExec.lrMandatoryElem.pushUniqValues(CFRExec.actionTakenTrueHolder[n].actionElementName),CFRExec.manateFldVsValue&&(CFRExec.manateFldVsValue[CFRExec.actionTakenTrueHolder[n].actionElementName]=r.defaultvalue))}}for(var n in CFRExec.actionTakenFalseHolder)switch(CFRExec.actionTakenFalseHolder[n].actionType){case 1:if(void 0!==CFRExec.relatedEntityMap[CFRExec.actionTakenFalseHolder[n].actionElementName]){var u;r=CFRExec.relatedEntityMap[CFRExec.actionTakenFalseHolder[n].actionElementName];if(CFRExec.workOnDom)(u=i.find("#"+CFRExec.getElemId(e,CFRExec.actionTakenFalseHolder[n].actionElementName,CFRExec.actionTakenFalseHolder[n].isAggField))).hasClass("agrFld")?u.closest("#tr_"+CFRExec.actionTakenFalseHolder[n].actionElementName).hide():u.hasClass("PRICINGMODEL")?($("#secDiv_Pricing_Details").hide(),u.hide()):e===CFRExec.OPERATIONCONSTANT.QUICK_CREATE?(u.addClass("formruledn"),t=!0):u.hide(),e===CFRExec.OPERATIONCONSTANT.VIEW&&CFRExec.handleBusinessCardVisibility(CFRExec.actionTakenFalseHolder[n].actionElementName,!1),CFRExec.LayoutRuleHiddenElem.pushUniqValues(CFRExec.actionTakenFalseHolder[n].actionElementName)}break;case 6:case 2:CFRExec.showHideRequestedSection(i,e,CFRExec.actionTakenFalseHolder[n].actionElementId,!0);break;case 4:if(void 0!==CFRExec.relatedEntityMap[CFRExec.actionTakenFalseHolder[n].actionElementName])if("true"!==(r=CFRExec.relatedEntityMap[CFRExec.actionTakenFalseHolder[n].actionElementName]).restricted&&!0!==r.restricted&&"true"!==r.readonly&&!0!==r.readonly){if(void 0===r.frmandate&&"false"!==r.mandate&&!1!==r.mandate||("boolean"==typeof r.mandate?r.mandate=!1:r.mandate="false",r.frmandate=!1),!1===r.frmandate&&CFRExec.workOnDom){d=i.find("#"+CFRExec.actionTakenFalseHolder[n].actionElementId);if(e===CFRExec.OPERATIONCONSTANT.EDIT)d.find("#Crm_"+CFRExec.formRuleModule+"_"+CFRExec.actionTakenFalseHolder[n].actionElementName+"_label").removeClass("newmandatory"),d.find("input[id^='Crm_'],textarea[id^='Crm_'],select[id^='Crm_'],div[id^='Crm_'],crm-user-wrapper[id^='Crm_']").data("mandate",r.mandate);else if(e===CFRExec.OPERATIONCONSTANT.VIEW&&d.data("params"))d.data("params").mandate=r.mandate;else if(e===CFRExec.OPERATIONCONSTANT.QUICK_CREATE){c=CFRExec.QCObj,m="Crm_"+CFRExec.formRuleModule+"_"+CFRExec.actionTakenFalseHolder[n].actionElementName;c&&c.qcFlow?d.find("#"+m+"_label").removeClass("newmandatory"):d.find("td").eq(0).removeClass("wf_requiredMark"),d.find("."+m).data("mandate",r.mandate)}}CFRExec.mandatoryInputNeededElem.removeLastOccurenceOfElement(CFRExec.actionTakenFalseHolder[n].actionElementName),CFRExec.lrMandatoryElem.removeLastOccurenceOfElement(CFRExec.actionTakenFalseHolder[n].actionElementName)}}t&&setTimeout((function(){i.find(".formruledn").removeClass("formruledn").hide()}),250),a&&setTimeout((function(){i.find(".formruleshow").removeClass("formruleshow").show()}),250),CFRExec.workOnDom&&CFRExec.hideSectionIfEmpty(e)},handleBusinessCardVisibility:function(e,t){var a=$("#headerlabel_"+e);a&&(t?a.parent().show():a.parent().hide())},skipActionForFeature:function(e){return!!CFRExec.feature&&("blueprint"===CFRExec.feature&&!e)},handleActionTakenLaterHolder:function(e,t,a){for(var i in e){var n=e[i],r=n.actionType;CFRExec.skipActionForFeature(r)||(a===CFRExec.OPERATIONCONSTANT.PRINT&&4===r||(t?(CFRExec.actionTakenFalseHolder=objectUtils.removeKeyFromGivenObj(CFRExec.actionTakenFalseHolder,n.actionElementId+"~"+r),CFRExec.actionTakenTrueHolder=objectUtils.addKeyToGivenObj(CFRExec.actionTakenTrueHolder,n.actionElementId+"~"+r,n),1===r&&CFRExec.LayoutRuleHiddenElem.removeLastOccurenceOfElement(n.actionElementName)):CFRExec.actionTakenTrueHolder.hasOwnProperty(n.actionElementId+"~"+r)||(CFRExec.actionTakenFalseHolder=objectUtils.addKeyToGivenObj(CFRExec.actionTakenFalseHolder,n.actionElementId+"~"+r,n))))}},correctEntityMapForSalutation:function(e){if(e!==CFRExec.OPERATIONCONSTANT.EDIT){if(void 0===CFRExec.relatedEntityMap.FIRSTNAME){var t=$.extend({},CFRExec.relatedEntityMap.LASTNAME),a={},i=t.nameInfo;void 0!==i&&(t.defaultvalue=i.lastname,a.defaultvalue=i.firstname,a.colname="FIRSTNAME",a.type="Text",CFRExec.relatedEntityMap.LASTNAME=t,CFRExec.relatedEntityMap.FIRSTNAME=a)}}else if(void 0===CFRExec.relatedEntityMap.SALUTATION&&void 0!==CFRExec.relatedEntityMap.FIRSTNAME){var n=$.extend({},CFRExec.relatedEntityMap.FIRSTNAME.salDataObj),r={};r.defaultvalue=CFRExec.CONSTANTFORSTRING.EMPTYSTRING,void 0!==n["data-old-value"]&&(r.defaultvalue=n["data-old-value"]),r.colname=n["data-colname"],r.type="Pick List",CFRExec.relatedEntityMap[r.colname]=r}},convertCurrencyToHomeCurrencyIfRequired:function(e,t){var a=t;if(a!==CFRExec.CONSTANTFORSTRING.EMPTYSTRING){if(!$.isEmptyObject(Crm.userDetails.CURRENCY_DETAILS)&&void 0!==CFRExec.relatedEntityMap.CURRENCYISOCODE&&void 0!==CFRExec.relatedEntityMap[e]&&"Currency"===CFRExec.relatedEntityMap[e].type&&CFRExec.relatedEntityMap.CURRENCYISOCODE.defaultvalue!==CFRExec.CONSTANTFORSTRING.EMPTYSTRING){var i=CFRExec.relatedEntityMap.CURRENCYISOCODE.defaultvalue,n=Crm.userDetails.CURRENCY_DETAILS[i].er;return a=parseFloat(a)/parseFloat(n)}return parseFloat(a)}return a},getCompareResult:function(e,t,a,i,n,r,s){var o=null;switch("U"===t&&"-1"===n&&(n=Crm.userDetails.USER_ID),t){case CFRExec.DATATYPE.NUMBER:a=Search.reverseFormatNumber(a),a=CFRExec.convertCurrencyToHomeCurrencyIfRequired(e,a),o=CFRExec.evalNumberComparision(a,i,n);break;case CFRExec.DATATYPE.USER:o=CFRExec.evalNumberComparision(a,i,n);break;case CFRExec.DATATYPE.DATE:o=CFRExec.evalDateComparision(a,i,n,r,CFRExec.DATATYPE.DATE);break;case CFRExec.DATATYPE.DATETIME:o=CFRExec.evalDateComparision(a,i,n,r,CFRExec.DATATYPE.DATETIME);break;case CFRExec.DATATYPE.BOOLEAN:o=CFRExec.evalBooleanComparision(a,n);break;case CFRExec.DATATYPE.PICKLIST:case CFRExec.DATATYPE.TEXT:var l=!1;i===CFRExec.TEXTCOMPARATOR.ISNT&&(l=!0);for(var d=n.length,c=0;c<d;c++)if("isn't"===i){if(!CFRExec.evalTextComparision(a,i,n[c],s)){l=!1;break}}else if(CFRExec.evalTextComparision(a,i,n[c],s)){l=!0;break}o=l}return o},handleBusinessCardFields:function(){for(var e=$("#bcWraperDiv").find(".bcCardDetail tbody").find('td[id^="headerlabel"]'),t=$("#preHTMLContainer"),a=e.length,i=[],n=[],r=0;r<a;r++){var s=e.eq(r),o=s.attr("id");i[r]={},i[r].columnVal=o.substring(o.indexOf("_")+1),i[r].fieldDiv=t.find("#"+CFRExec.getElemId(CFRExec.OPERATIONCONSTANT.VIEW,i[r].columnVal)),i[r].fieldDivD=i[r].fieldDiv.css("display"),i[r].fieldDivCD=i[r].fieldDiv.closest("[id^=secDiv_]").css("display"),n[r]={},n[r].dom=s.closest("tr"),n[r].columnVal=n[r].dom.find("#header_"+i[r].columnVal),n[r].HcolumnVal=n[r].dom.find("#headerlabel_"+i[r].columnVal)}for(r=0;r<a;r++)i[r].fieldDiv.length>0&&("none"!==i[r].fieldDivD&&"none"!==i[r].fieldDivCD?void 0===i[r].fieldDiv.attr("onmouseover")&&(n[r].columnVal.removeAttr("onmouseover"),n[r].HcolumnVal.removeAttr("onmouseover")):n[r].dom.hide())},evalBooleanComparision:function(e,t){return e===t},evalNumberComparision:function(e,t,a){e=e===CFRExec.CONSTANTFORSTRING.EMPTYSTRING||isNaN(e)?CFRExec.CONSTANTFORSTRING.EMPTYSTRING:parseFloat(e);var i=null;if(a===CFRExec.COMMONCOMPARATOR.EMPTY)i=e===CFRExec.CONSTANTFORSTRING.EMPTYSTRING;else if(a===CFRExec.COMMONCOMPARATOR.NOTEMPTY)i=e!==CFRExec.CONSTANTFORSTRING.EMPTYSTRING;else switch("between"!=t&&"not between"!=t&&(a=parseFloat(a)),t){case CFRExec.NUMBERCOMPARATOR.EQUAL:i=e==a;break;case CFRExec.NUMBERCOMPARATOR.NOTEQUAL:i=e!=a;break;case CFRExec.NUMBERCOMPARATOR.LESSTHAN:i=e<a;break;case CFRExec.NUMBERCOMPARATOR.LESSTHANEQUAL:i=e<=a;break;case CFRExec.NUMBERCOMPARATOR.GREATERTHAN:i=e>a;break;case CFRExec.NUMBERCOMPARATOR.GREATERTHANEQUAL:i=e>=a;break;case CFRExec.NUMBERCOMPARATOR.BETWEEN:i=e>=parseFloat(a[0])&&e<=parseFloat(a[1]);break;case CFRExec.NUMBERCOMPARATOR.NOTBETWEEN:i=!(e>=parseFloat(a[0])&&e<=parseFloat(a[1]));break;default:i=e===a}return i},evalTextComparision:function(e,t,a,i){var n=null;if(e=e.trim(),a===CFRExec.COMMONCOMPARATOR.EMPTY)n=e===CFRExec.CONSTANTFORSTRING.EMPTYSTRING;else if(a===CFRExec.COMMONCOMPARATOR.NOTEMPTY)n=e!==CFRExec.CONSTANTFORSTRING.EMPTYSTRING;else switch(a=a.trim(),0===i&&(e=e.toLowerCase(),a=a.toLowerCase()),t){case CFRExec.TEXTCOMPARATOR.IS:n=e===a;break;case CFRExec.TEXTCOMPARATOR.ISNT:n=e!==a;break;case CFRExec.TEXTCOMPARATOR.CONTAINS:n=-1!==e.indexOf(a.replace(/\*/g,""));break;case CFRExec.TEXTCOMPARATOR.DOESNTCONTAINS:n=-1===e.indexOf(a.replace(/\*/g,""));break;case CFRExec.TEXTCOMPARATOR.STARTSWITH:n=e.startsWith(a.replace(/\*/g,""));break;case CFRExec.TEXTCOMPARATOR.ENDSWITH:n=e.endsWith(a.replace(/\*/g,""));break;default:n=e===a}return n},compareDateObj:function(e,t,a){var i=null;switch(a){case CFRExec.DATETIMECOMPARATOR.IS:i=e.getTime()-t[0].getTime()==0;break;case CFRExec.DATETIMECOMPARATOR.ISNT:i=e.getTime()-t[0].getTime()!=0;break;case CFRExec.DATETIMECOMPARATOR.ISBEFORE:i=e.getTime()-t[0].getTime()<0;break;case CFRExec.DATETIMECOMPARATOR.ISAFTER:i=e.getTime()-t[0].getTime()>0;break;case CFRExec.DATETIMECOMPARATOR.BETWEEN:i=e.getTime()-t[0].getTime()>=0&&e.getTime()-t[1].getTime()<=0;break;case CFRExec.DATETIMECOMPARATOR.NOTBETWEEN:i=e.getTime()-t[0].getTime()<0&&e.getTime()-t[1].getTime()>0;break;case"near by":break;default:i=e.getTime()-t[0].getTime()==0}return i},evalDateComparision:function(e,t,a,i,n){return a[0]===CFRExec.COMMONCOMPARATOR.EMPTY?e===CFRExec.CONSTANTFORSTRING.EMPTYSTRING:a[0]===CFRExec.COMMONCOMPARATOR.NOTEMPTY?e!==CFRExec.CONSTANTFORSTRING.EMPTYSTRING:e===CFRExec.CONSTANTFORSTRING.EMPTYSTRING?"isn't"===t:n===CFRExec.DATATYPE.DATE?CFRExec.compareDateObj(new Date(e),CFRExec.getCompareDateObjWithTime(a,t,!0),t):CFRExec.compareDateObj(new Date(e),CFRExec.getCompareDateObjWithTime(void 0===i?CFRExec.getBrowserCompatibleDateTime(a):CFRExec.getBrowserCompatibleDateTime(i),t,void 0===i),t)},getBrowserCompatibleDateTime:function(e){for(var t=new Array,a=e.length,i=0;i<a;i++){var n=e[i].split(" "),r=n[0].split("-"),s=n[1].substring(0,n[1].indexOf(".")).split(":");t.push(new Date(r[0],r[1]-1,r[2],s[0],s[1],s[2]))}return t},getCompareDateObjWithTime:function(e,t,a){var i=[],n=new Date(e[0]);if(!0===a&&n.setHours(0,0,0,0),i.push(n),"between"===t||"not between"===t){var r=new Date(e[1]);!0===a&&r.setHours(0,0,0,0),i.push(r)}return i},getDateObjectFromDateTimeStr:function(e,t){var a=[];if("HH:mm"===Crm.userDetails.TIME_FORMAT)a=t.split(":");else{var i=t.substring(t.indexOf(" ")+1,t.length);(a=t.substring(0,t.indexOf(" ")).split(":"))[0]=Utils.convertTimeTo24HoursFormat(parseInt(a[0]),i)}return Utils.getDateObject(e,{hrs:a[0],mins:a[1]})},hideSectionIfEmpty:function(e){if("Events"!==CFRExec.formRuleModule&&e!==CFRExec.OPERATIONCONSTANT.QUICK_CREATE){var t=null,a=null;e===CFRExec.OPERATIONCONSTANT.EDIT?(t=$("#preHTMLContainer_"+CFRExec.formRuleModule),a=".tabDivCreate"):e===CFRExec.OPERATIONCONSTANT.VIEW?(t=$("#preHTMLContainer"),a=".tabDiv"):e===CFRExec.OPERATIONCONSTANT.PRINT&&(t=$($("#pdfPreviewFrame")[0].contentDocument).find("#preHTMLContainer"),a=".rowTR");for(var i=t.find("."+e+"ParentSection:visible").not(".subformParentSection"),n=i.length,r=0;r<n;r++){var s=$(i[r]);0===s.find(a+":visible").length&&0==s.find(".subFrmLayout").length&&s.data("nofield",!0).hide()}}},getValue:function(e,t,a){0==Object.keys(CFRExec.relatedEntityMap).length&&(CFRExec.relatedEntityMap=CFRExec.getRelatedEntityMap(t));var i=CFRExec.relatedEntityMap[e].defaultvalue;if(void 0!==i&&i!==CFRExec.CONSTANTFORSTRING.EMPTYSTRING||(i=CFRExec.CONSTANTFORSTRING.EMPTYSTRING),"picklist"===a&&"Services"==CFRExec.formRuleModule&&1==CFRExec.isServiceAvailabilitySection||"Appointments"==CFRExec.formRuleModule&&"APPOINTMENTLOCATION"==e&&"view"!==t){var n=$("#Crm_"+CFRExec.formRuleModule+"_"+e);i=n.length?n.val():""}else"B"===a&&i===CFRExec.CONSTANTFORSTRING.EMPTYSTRING?i="false":"picklist"===a&&"-None-"===i?i=CFRExec.CONSTANTFORSTRING.EMPTYSTRING:"picklist"===a&&""===i&&"edit"===t?i=$("#Crm_"+CFRExec.formRuleModule+"_"+e).find("option").val():"U"===a?i=CFRExec.relatedEntityMap[e].defaultid:"SERVICEID"==e&&"Appointments"==CFRExec.formRuleModule&&(CFRExec.relatedEntityMap[e].defaultid&&CFRExec.relatedEntityMap[e].defaultvalue&&""!=CFRExec.relatedEntityMap[e].defaultvalue?i=CFRExec.relatedEntityMap[e].defaultid:($("div#checkDuplicateEventAlert").remove(),i=""));return i},setValue:function(e,t,a){0==Object.keys(CFRExec.relatedEntityMap).length&&(CFRExec.relatedEntityMap=CFRExec.getRelatedEntityMap(a));var i=CFRExec.relatedEntityMap[e];if(i){var n=!1;if("STAGE"===e&&(n=!0),t===CFRExec.CONSTANTFORSTRING.EMPTYSTRING)n&&void 0!==CFRExec.relatedEntityMap.PROBABILITY&&(CFRExec.relatedEntityMap.PROBABILITY.defaultvalue=t),CFRExec.relatedEntityMap[e].defaultvalue=t,"4"!==i.uitype&&"5"!==i.uitype&&"6"!==i.uitype&&"7"!==i.uitype&&"9"!==i.uitype&&"10"!==i.uitype&&"12"!==i.uitype&&"13"!==i.uitype&&"15"!==i.uitype&&"133"!==i.uitype||(CFRExec.relatedEntityMap[e].defaultid=CFRExec.CONSTANTFORSTRING.EMPTYSTRING);else if("none"===t&&n)CFRExec.relatedEntityMap[e].defaultvalue=CFRExec.CONSTANTFORSTRING.EMPTYSTRING,void 0!==CFRExec.relatedEntityMap.PROBABILITY&&(CFRExec.relatedEntityMap.PROBABILITY.defaultvalue=CFRExec.CONSTANTFORSTRING.EMPTYSTRING);else{switch(i.type){case"DateTime":var r=Utils.getDateInUserDatePattern(crmCalendar.getDateObjectFromGivenDateString(t)),s=t.substring(r.length+1,t.length);CFRExec.relatedEntityMap[e].defaultvalue=CFRExec.getDateObjectFromDateTimeStr(r,s)+CFRExec.CONSTANTFORSTRING.EMPTYSTRING,CFRExec.relatedEntityMap[e].dateVal=r,CFRExec.relatedEntityMap[e].timeVal=s;break;case"Date":r=crmCalendar.getDateObjectFromGivenDateString(t,Crm.userDetails.DATE_PATTERN);CFRExec.relatedEntityMap[e].defaultvalue=r+CFRExec.CONSTANTFORSTRING.EMPTYSTRING,CFRExec.relatedEntityMap[e].dateVal=t;break;case"Lookup":var o=t.indexOf("#"),l=t.substring(0,o),d=t.substring(o+1,t.length);CFRExec.relatedEntityMap[e].defaultvalue=d,CFRExec.relatedEntityMap[e].defaultid=l;break;case"Currency":case"Boolean":CFRExec.relatedEntityMap[e].defaultvalue="null"===d?CFRExec.CONSTANTFORSTRING.EMPTYSTRING:t;break;default:CFRExec.relatedEntityMap[e].defaultvalue=t}n&&void 0!==CFRExec.relatedEntityMap.PROBABILITY&&(CFRExec.relatedEntityMap.PROBABILITY.defaultvalue=parseInt(t))}}},getElemId:function(e,t,a){switch(e){case CFRExec.OPERATIONCONSTANT.EDIT:case CFRExec.OPERATIONCONSTANT.QUICK_CREATE:return CFRExec.formRuleModule+"_fldRow_"+t;case CFRExec.OPERATIONCONSTANT.VIEW:var i=null;return i="Services"==CFRExec.formRuleModule&&1==CFRExec.isServiceAvailabilitySection?CFRExec.formRuleModule+"_fldRow_"+t:"mouseArea__"+t,a&&(i+=".agrFld"),i;case CFRExec.OPERATIONCONSTANT.PRINT:return"rowTR_"+t;default:return t}},evalBooleanExpression:function(e){for(var t=[],a=[],i=(e=e.replace(/true/g,"1").replace(/false/g,"0")).length,n=0;n<i;n++){var r=e[n];if("("===r)t.push(r);else if("1"===r||"0"===r)a.push(r);else if("&"===r){"("===(s=t.pop())||"|"===s?t.push(s):a.push(s),t.push(r)}else if("|"===r){var s;"("===(s=t.pop())?t.push(s):a.push(s),t.push(r)}else if(")"===r)for(var o=t.pop();"("!==o;)a.push(o),o=t.pop()}for(o=t.pop();void 0!==o&&"("!==o;)a.push(t),o=t.pop();return CFRExec.evalPostFixExpression(a)},evalPostFixExpression:function(e){for(var t=[],a=e.length,i=0;i<a;i++){var n=e[i];if("1"===n||"0"===n)t.push(n);else if("&"===n){var r=t.pop(),s=t.pop();"1"===r&&"1"===s?t.push("1"):t.push("0")}else if("|"===n){r=t.pop(),s=t.pop();"1"===r||"1"===s?t.push("1"):t.push("0")}}return"1"===t.pop()},showHideRequestedSection:function(e,t,a,i){if(void 0!==CFRExec.relatedEntityMap[a]){for(var n=CFRExec.relatedEntityMap[a].FL,r=n.length,s=0;s<r;s++)void 0!==n[s]&&CFRExec.workOnDom&&(i?CFRExec.LayoutRuleHiddenElem.pushUniqValues(n[s]):CFRExec.LayoutRuleHiddenElem.removeLastOccurenceOfElement(n[s]),CFRExec.handleBusinessCardVisibility(n[s],!i));if(CFRExec.workOnDom){a=a.replace(/ |'/g,"_");i?e.find("[id='"+a+"']").hide():e.find("[id='"+a+"']").show()}}},getContainerDiv:function(e){if(e===CFRExec.OPERATIONCONSTANT.VIEW)return"Services"==CFRExec.formRuleModule&&1==CFRExec.isServiceAvailabilitySection?$("#serviceAjaxEditFields"):"Events"===CFRExec.formRuleModule?$("#eventBCViewDiv"):$("#preHTMLContainer");if(e===CFRExec.OPERATIONCONSTANT.PRINT){var t=$("#pdfPreviewFrame")[0],a=$(t.contentDocument);return"Events"===CFRExec.formRuleModule?a.find("#eventBCViewDiv"):a.find("#preHTMLContainer")}if(e===CFRExec.OPERATIONCONSTANT.EDIT)return $("#preHTMLContainer_"+CFRExec.formRuleModule);if(e===CFRExec.OPERATIONCONSTANT.QUICK_CREATE){var i=CFRExec.QCObj;return $("#"+(i.containerDiv?i.containerDiv:"searchCreateDiv"))}},getCurrentLayoutId:function(e){return e===CFRExec.OPERATIONCONSTANT.VIEW||e===CFRExec.OPERATIONCONSTANT.LIST?returnJson.layout_jsonarrayObj.currLayoutId:e===CFRExec.OPERATIONCONSTANT.PRINT?parent.returnJson.layout_jsonarrayObj.currLayoutId:e===CFRExec.OPERATIONCONSTANT.EDIT?window[CFRExec.formRuleModule].createEditJson.layout_jsonarrayObj.currLayoutId:e===CFRExec.OPERATIONCONSTANT.QUICK_CREATE?CFRExec.getContainerDiv(e).find('[name="layoutId"]').val():void 0},getRelatedEntityMap:function(e){if(e===CFRExec.OPERATIONCONSTANT.QUICK_CREATE){if(CFRExec.QCObj)if(CFRExec.QCObj&&qcObj.relatedEntityMap)return qcObj.relatedEntityMap;return{}}var t=null,a=null;if(e===CFRExec.OPERATIONCONSTANT.VIEW||e===CFRExec.OPERATIONCONSTANT.LIST?(t=objectUtils.cloneObject(returnJson.entityMapJson),void 0!==returnJson[CFRExec.formRuleModule]&&void 0!==returnJson[CFRExec.formRuleModule].section&&(a=returnJson[CFRExec.formRuleModule].section)):e===CFRExec.OPERATIONCONSTANT.PRINT?(t=parent.returnJson.entityMapJson,void 0!==parent.returnJson[CFRExec.formRuleModule].section&&(a=parent.returnJson[CFRExec.formRuleModule].section)):e===CFRExec.OPERATIONCONSTANT.EDIT&&(t=objectUtils.cloneObject(window[CFRExec.formRuleModule].createEditJson.entityMapJson),void 0!==window[CFRExec.formRuleModule].createEditJson[CFRExec.formRuleModule].section&&(a=window[CFRExec.formRuleModule].createEditJson[CFRExec.formRuleModule].section)),"Potentials"===CFRExec.formRuleModule){var i=t.STAGE.defaultvalue;void 0!==t.PROBABILITY&&i!==CFRExec.CONSTANTFORSTRING.EMPTYSTRING&&(t.PROBABILITY.defaultvalue=parseInt(i))}if(void 0!==a)for(var n=a.length,r=0;r<n;r++){var s=[],o={},l=a[r];if(void 0!==l.FL){for(var d=l.FL.length,c=0;c<d;c++)void 0!==l.FL[c].colname&&("221"===l.FL[c].uitype&&(t[l.FL[c].colname].popup="true"),s.push(l.FL[c].colname));o.FL=s,o.id=l.name.replace(/ /g,"_"),t["secDiv_"+o.id]=o}}return t},valChangesNeedsLayoutRuleEval:function(e){return CFRExec.holdFormRule()&&CFRExec.isColTriggerLayoutRule(e)},isColTriggerLayoutRule:function(e){return-1!==CFRExec.LayoutRuleConditionInvolvedElem.indexOf(e)||"STAGE"===e&&-1!==CFRExec.LayoutRuleConditionInvolvedElem.indexOf("PROBABILITY")},holdFormRule:function(){return!validationUtils.isEmpty(CFRExec.CFRules)},evalAjaxEditForLayoutRule:function(e,t,a,i){if(CFRExec.holdFormRule()){var n=CFRExec.OPERATIONCONSTANT.VIEW;return void 0!==CFRExec.formRuleModule&&"Calls"!==CFRExec.formRuleModule||(CFRExec.formRuleModule=e),0!=Object.keys(CFRExec.relatedEntityMap).length&&"Calls"!==e||(CFRExec.relatedEntityMap=CFRExec.getRelatedEntityMap(n)),CFRExec.ajaxEditedFields=[],CFRExec.ajaxEditedFields.push(t),CFRExec.fieldVsValue={},CFRExec.manateFldVsValue={},"675892647"!=Crm.userDetails.ZGID&&"659089839"!=Crm.userDetails.ZGID&&"55171602"!=Crm.userDetails.ZGID||"Tasks"!==e||"STATUS"!==t||"Completed"!==a||void 0!==CFRExec.relatedEntityMap.STATUS?(CFRExec.setValue(t,a,n),"675892647"!=Crm.userDetails.ZGID&&"659089839"!=Crm.userDetails.ZGID&&"55171602"!=Crm.userDetails.ZGID||(murphy.addCustomTracking({message:JSON.stringify(CFRExec.relatedEntityMap),name:"relatedEntityMapinevalAjaxEditForLayoutRule",type:"custom event"}),murphy.error(new Error("Layout Rule Related Information-relatedEntityMapinevalAjaxEditForLayoutRule"))),CFRExec.ajaxEditHaltedFieldColName=t,CFRExec.promptIfMandatory=!0,CFRExec.ajaxEditHaltNeeded=!1,void 0!==i?CFRExec.evalRules(n,!0):CFRExec.evalRules(n,!1),$("#multipleFieldsEditPop").is(":visible")||!1!==CFRExec.ajaxEditHaltNeeded||(CFRExec.relatedEntityMap={}),CFRExec.ajaxEditHaltNeeded):(renderingUtils.showCustomAlert("An error occurred while closing the task. Please refresh and try again. If the issue still persists, contact support"),murphy.addCustomTracking({message:JSON.stringify(CFRExec.relatedEntityMap),name:"CloseTaskAlert",type:"custom event"}),murphy.error(new Error("Layout Rule-CloseTaskAlert ")),-1)}return!1},isLayoutRuleHiddenElem:function(e){return-1!==CFRExec.LayoutRuleHiddenElem.indexOf(e)},saveMandatoryFields:function(){for(var e=[],t=CFRExec.getWorkingContainer().find(".labelValCreate").find(":input[id^=Crm_],div[id^=Crm_],crm-user-wrapper[id^=Crm_]").not("input[id$='_TimeOption']"),a=t.length,i=0;i<a;i++)e.push(t.eq(i).attr("id"));if(Crm.validateEntityAndShowErrorMsg(e,detailView.currentModule,!0)){var n=t.length;for(i=0;i<n;i++){var r=$(t.eq(i)).data("colname");CFRExec.setValue(r,CFRExec.getInputedValue($(t.eq(i))),CFRExec.OPERATIONCONSTANT.VIEW),CFRExec.ajaxEditedFields.push(r)}CFRExec.evalRules(CFRExec.OPERATIONCONSTANT.VIEW,!1),!1===CFRExec.ajaxEditHaltNeeded&&new Promise((function(e){e(CVRExec.validateRulesForLayoutRule(CFRExec.ajaxEditedFields,CFRExec.haltStateParams))})).then((function(e){e&&CFRExec.saveFieldsFinally()}))}},executeLayoutRulesForVR:function(e){CFRExec.formRuleModule=e;for(var t=$("#VRAjaxEdit").find(".labelValCreate").find(":input[id^=Crm_],div[id^=Crm_]").not("input[id$='_TimeOption']"),a=t.length,i=0;i<a;i++){var n=$(t[i]).data("colname");CFRExec.setValue(n,CFRExec.getInputedValue($(t[i])),CFRExec.OPERATIONCONSTANT.VIEW),CFRExec.ajaxEditedFields.push(n)}return CFRExec.fromVR=!0,CFRExec.promptIfMandatory=!0,CFRExec.evalRules(CFRExec.OPERATIONCONSTANT.VIEW,!1),CFRExec.promptIfMandatory=!0,!CFRExec.ajaxEditHaltNeeded},getInputedValue:function(e){var t=CFRExec.CONSTANTFORSTRING.EMPTYSTRING;switch(e.data("contentType")){case"Multiselect Pick List":for(var a=e.find("option"),i=!1,n=a.length,r=0;r<n;r++)!0===a[r].selected&&(i?t=t+";"+a.eq(r).val():(t=a.eq(r).val(),i=!0));break;case"Lookup":t=e.data("id")+"#"+e.val();break;case"User Lookup":t=e.data("id");break;case"DateTime":t=e.val()+" "+$("#"+e.attr("id")+"_TimeOption").val();break;case"Boolean":"on"===(t=e.val())&&(t=e.is(":checked")?"true":"false");break;default:t=e.val()}if(556===parseInt(e.data("uitype"))){var s=e.find("crm-image-upload-create");if(void 0!==s[0])return s[0].component.data.imageData}return t},saveFieldsFinally:function(){if(!1===validationUtils.isEmpty(CFRExec.haltStateParams)){var e=null,t=null,a=1,i={};for(var n in Crm.requestParamWithColname)Crm.requestParamWithColname.hasOwnProperty(n)&&(e="columnName"+a,t="fieldValue"+a,CFRExec.haltStateParams[e]=n,CFRExec.haltStateParams[t]=Crm.requestParamWithColname[n],i[n]=Crm.requestParamWithColname[n],a++);var r=CFRExec.haltStateParams.check;if(delete CFRExec.haltStateParams.check,"processFlow"===r.type)(s={}).module=CFRExec.haltStateParams.module,s.transitionRelId=CFRExec.haltStateParams.transitionRelId,s.moduleid=CFRExec.haltStateParams.moduleid,s.duringFields=JSON.stringify({ChildModuleFields:i}),ProcessFlow.saveFields(CFRExec.haltStateParams.module,s,CFRExec.haltStateParams.moduleid),CFRExec.hideWorkingContainer();else"StageView"===r.type?(new crmRequestPool).doAjax1("/crm/v2/",(function(e){"STAGE"!==CFRExec.haltStateParams.columnName?crmListView.updateStageSuccess(CFRExec.haltStateParams.moduleid,r.valId,r.prevStageId,e):crmListView.updateStageSuccess(CFRExec.haltStateParams.moduleid,CFRExec.haltStateParams.fieldValue,r.prevStageId,e),CFRExec.hideWorkingContainer()}),CFRExec.haltStateParams,(function(){renderingUtils.showCustomAlert(I18n.getMsg("game.common.error")),CFRExec.hideWorkingContainer()})):"closeTask"===r.type&&CFRExec.saveGivenFields(CFRExec.haltStateParams,r.module,r.id,r.from,r.url)}else{var s=CFRExec.retriveParamsToUpdate();CFRExec.saveGivenFields(s,detailView.currentModule,detailView.entityId,"detailspage")}},saveGivenFields:function(e,t,a,i,n){var r=e.columnName;(new crmRequestPool).doAjax1("/crm/v2.2/",(function(s){Crm.VR&&delete Crm.VR;var o=null,l=null,d=null,c=s.responseJSON?s.responseJSON:s;if("string"==typeof s&&(o=s.split("AJAX::::"),l=trim(o[1]),d=o[2],d=revertSplChrs(d)),s.responseJSON){if("MANDATORY_NOT_FOUND"===c.code||c.data&&"MANDATORY_NOT_FOUND"===c.data[0].code)return Crm.showErrorMsg(I18n.getMsg("crm.field.valid.check",[cm_fl.data("label")]),cm_fl),void CFRExec.hideWorkingContainer();if("NO_PERMISSION"===c.code||c.data&&"RECORD_IN_BLUEPRINT"===c.data[0].code||c.data&&"CANNOT_PERFORM_ACTION"===c.data[0].code||c.data&&"MAPPING_MISMATCH"===c.data[0].code)return renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),void CFRExec.hideWorkingContainer();if(c.data&&"NOT_ALLOWED"===c.data[0].code)return void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.alert.can.not.edit.email"));if("Internal Server Error"===c.message||"INVALID_DATA"===c.data[0].code)return renderingUtils.displayPermissionDenied(null,null,c.message),void CFRExec.hideWorkingContainer();if("FILTER_CRITERIA_NOT_SATISFIED"===c.code||c.data&&"FILTER_CRITERIA_NOT_SATISFIED"===c.data[0].code){let e={},a=returnJson.entityMapJson;const i=c.data[0].details.api_name;let n="",s="";for(let e in a)a[e].sysRefName===i&&(n=a[e].displaylabel,s=a[e].colname);return e.FIELDLABEL=n,e.MODULE=t,Crm.showErrorMsg(c.data[0].message,$("#Crm_"+t+"_"+s),t),void(r===s&&CFRExec.cancelPopupNdClearParamHistory())}if("duplicate data"===c.data[0].message){var m={},u=c.data[0].details.duplicate_record,v=returnJson.entityMapJson,p=c.data[0].details.api_name,h="",g="";for(var C in v)v[C].sysRefName===p&&(h=v[C].displaylabel,g=v[C].colname);m.FIELDLABEL=h,m.OWNERNAME=u.Owner.name,m.MODULE=t,m.RECORDS={},m.COUNT=u.more_records?2:1,m.ZUID=u.Owner.zuid,delete u.Owner;var f=[],E={};if(E.ENTITYID=u.id,delete u.id,Object.keys(u).length>1){var I=Crm.userDetails.NAME_FORMAT;I=I.split(",");var y=[];I.forEach((function(e){"Salutation"!==e&&(e=e.replace(" ","_")),u[e]&&y.push(u[e])})),E.ENTITYNAME=y.join(" "),E.ENTITYNAMEFORPOPOVER=y.join(" ")}else for(var R in u)E.ENTITYNAME=u[R],E.ENTITYNAMEFORPOPOVER=u[R];f.push(E),m.RECORDS=f;var b=Crm.getDuplicateErrorMsg(m,!1);return Crm.showErrorMsg(b,$("#Crm_"+t+"_"+g),t),void(r===g&&CFRExec.cancelPopupNdClearParamHistory())}if("DUPLICATE_LINKING_DATA"===c.data[0].code){var T=c.data[0].details.duplicate_record,D=T.id,w=T.Name,M="This Association is already exist in <a href="+(Crm.getCrmBasePath()+"/EntityInfo.do?module="+t+"&id="+D)+"  target = 'new'>"+w+"</a> entity.";return renderingUtils.showCustomAlert(M,"",!0),Crm.hideDuplicateErrorMsg("viewentityform"),itsonview=!0,void CFRExec.hideWorkingContainer()}}if(l="SUCCESS"===(o=s).data[0].code?"true":"false",d=o.outputValue,d=revertSplChrs(d),"true"===l){switch(i){case"relatedList":var S=Crm.isActivitySplitDone?"CALLSPERSONALITY;EVENTSPERSONALITY;TASKSPERSONALITY;CALLSHISTORYPERSONALITY;EVENTSHISTORYPERSONALITY;TASKSHISTORYPERSONALITY":"ACTIVITYPERSONALITY;ACTIVITYHISTORYPERSONALITY";crmRelatedList.ajaxReq({pname:S,module:t,id:a},null,!Crm.isActivitySplitDone),Lyte.triggerEvent("related_list",{module:"Activities"}),!0==!validationUtils.isEmpty(CFRExec.tempHolder)&&CFRExec.initFromTempHolder();break;case"detailspage":if(CFRExec.relatedEntityMap={},CFRExec.promptIfMandatory=!1,"Tasks"===t){var L=$("#completedTask").find("#completedValue").text();if(d.includes("Status")||d.includes("undefined"))for(var A=d.split("||"),_=A.length,O=0;O<_;O++){var N=A[O].split("##");if("Status"===N[0]||"undefined"===N[0]){$("#cvlist_"+a).find("#lp_Status").text(N[1]).attr("title",N[1]);break}}returnJson&&returnJson.entityMapJson&&returnJson.entityMapJson.STATUS&&detailView.replaceDataParams("STATUS",L),reloadCurrentEntityView(a,t,(function(){CFRExec.evalRules(CFRExec.OPERATIONCONSTANT.VIEW,!0),$("#followup").show()}))}else{if("Events"===t){var P=$("#formRuleMandatoryFields").find(".activitesColor");if(P.length>0){var k=P.css("background-color"),F=$("#detailView_"+a).find(".activitesColor");F.length>0?F.css("background-color",k):$("#cvlist_"+a).find("a").append('<span class="activitesColor" data-zcqa="relcvColor_'+a+'" style="background: '+Events.rgbtohex(k)+'"></span>')}}reloadCurrentEntityView(a,t,(function(){CFRExec.evalRules(CFRExec.OPERATIONCONSTANT.VIEW,!0)}))}break;case"kanbanview":$("#recordid_"+a).find('[class="seperatorLine"]').hide(),$("#listViewClose_"+a).hide();break;case"dashboard":var x=objectUtils.URL(n).getParams();CrmDashboard.loadDashboards(void 0,void 0,{clickId:"loadHomePage",currentOption:"20",dashletId:x.dashletId,layoutId:x.layoutId,module:"Tasks"});break;case CFRExec.OPERATIONCONSTANT.LIST:$("#tab_Activities").trigger("click")}if("Potentials"===t&&e&&e.subject&&e.description&&businessCardJson.userInRole.notesPermission)if("string"==typeof s){var U=o.slice(-1);Notes.addNoteCallBack(void 0,void 0,"Potentials",void 0,void 0,void 0,U,!1,$("#note_subject"),$("#noteContextTxt"))}else{(x={}).Note_Title=e.subject,x.Note_Content=e.description,x.Parent_Id=e.moduleid,x.se_module=e.module;var V={};(f=[]).push(x),V.data=f;var B={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};clientPortalName&&(B["X-CRMPORTAL"]=window.clientPortalName),(new crmRequestPool).initiate({action:"/crm/v2/Notes",type:"POST",data:JSON.stringify(V),headers:B,contentType:"application/json",success:function(t){var a={};a.noteTitle=$ESAPI.encoder().encodeForHTML(e.subject),a.noteContent=$ESAPI.encoder().encodeForHTML(e.description),a.relModuleName=x.se_module,a.isEditAllowed=!0,a.createdDate="now",a.modifiedDate="now",a.mainEntId=x.Parent_Id,a.nId=t.data[0].details.id,a.isDelAllowed=!0,a.noteContentWithRegex=$ESAPI.encoder().encodeForHTML(e.description),a.modiName=t.data[0].details.Modified_By.name,a.seId=void 0===x.se_moduleid?x.Parent_Id:x.se_moduleid,a.dispModuleName=void 0===returnJson[x.se_module].rpModuleName?x.se_module:returnJson[x.se_module].rpModuleName,a.i18nModName=void 0===returnJson[x.se_module].rpModuleName?x.se_module:returnJson[x.se_module].rpModuleName,a.mainEntityName=returnJson[x.se_module].entityName,a.CONTACTSURL=Crm.userDetails.contactServerUrl+"/file";var i=new Date(t.data[0].details.Created_Time);a.createdDateFull=Utils.convertDateToGivenPattern("M d",i)+" "+Utils.getTimeInUserFormat(i,!0);var n=new Date(t.data[0].details.Modified_Time);a.modifiedDateFull=Utils.convertDateToGivenPattern("M d",n)+" "+Utils.getTimeInUserFormat(n,!0),a.modifiedZuid=Crm.userDetails.ZUID,a.clientPortalName=void 0!==window.clientPortalName?window.clientPortalName:"",a.clientPortalUrlContext="portal",a.isSharedToClient=!!$("#sharetoclient").prop("checked"),Notes.addNoteCallBack(void 0,void 0,"Potentials",void 0,void 0,void 0,a,!1,$("#note_subject"),$("#noteContextTxt"))}})}CFRExec.hideWorkingContainer(),CFRExec.promptIfMandatory=!1}else"false"===l?(renderingUtils.showCustomAlert("Error:"+o.data[0].message),CFRExec.promptIfMandatory=!1):(renderingUtils.showCustomAlert("Invalid response!!!!"),CFRExec.promptIfMandatory=!1)}),e,(function(){renderingUtils.showCustomAlert(I18n.getMsg("game.common.error")),CFRExec.hideWorkingContainer()}))},cancelPopupNdClearParamHistory:function(){$("#formRuleMandatoryFields").hide(),removeFreezeLayer(),CFRExec.relatedEntityMap={},CFRExec.haltStageChange({})},retriveParamsToUpdate:function(){var e={},t=null;e.columnName=CFRExec.ajaxEditHaltedFieldColName;var a=CFRExec.relatedEntityMap[CFRExec.ajaxEditHaltedFieldColName].uitype;"786"===a||"14"===a||"30"===a||"333"===a?e.fieldValue=CFRExec.relatedEntityMap[CFRExec.ajaxEditHaltedFieldColName].dateVal+" "+CFRExec.relatedEntityMap[CFRExec.ajaxEditHaltedFieldColName].timeVal:"24"===a||"202"===a?e.fieldValue=CFRExec.relatedEntityMap[CFRExec.ajaxEditHaltedFieldColName].dateVal:"Lookup"===CFRExec.relatedEntityMap[CFRExec.ajaxEditHaltedFieldColName].type?e.fieldValue=CFRExec.relatedEntityMap[CFRExec.ajaxEditHaltedFieldColName].defaultid:e.fieldValue=CFRExec.relatedEntityMap[CFRExec.ajaxEditHaltedFieldColName].defaultvalue,""!==e.fieldValue||"Lookup"!==CFRExec.relatedEntityMap[CFRExec.ajaxEditHaltedFieldColName].type||"ACCOUNTID"!==e.columnName&&"PARENTACCOUNTID"!==e.columnName||"4"!==a&&"133"!==a||(e.fieldValue=CFRExec.relatedEntityMap[CFRExec.ajaxEditHaltedFieldColName].defaultvalue,e.uitype=a),"Potentials"!==CFRExec.formRuleModule||""===e.fieldValue||"Lookup"!==CFRExec.relatedEntityMap[CFRExec.ajaxEditHaltedFieldColName].type||"ACCOUNTID"!==e.columnName||"4"!==a&&"133"!==a||!1!==isNaN(e.fieldValue)||(e.fieldValue=CFRExec.relatedEntityMap[CFRExec.ajaxEditHaltedFieldColName].defaultvalue,e.uitype=a),"Tasks"!==detailView.currentModule||"STATUS"!==e.columnName||Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup||detailView.taskStatusMap.Completed!=e.fieldValue||($("#showDontAskOption").prop("checked")&&(e.isDontAskAgainChecked=!0),$("#notifyOwnerOption").prop("checked")&&(e.isNotifyOwnerChecked=!0));var i=1;for(var n in Crm.requestParamWithColname)Crm.requestParamWithColname.hasOwnProperty(n)&&(t="fieldValue"+i,"uitype"+i,e["columnName"+i]=n,CFRExec.relatedEntityMap[n]&&["133","55","221"].contains(CFRExec.relatedEntityMap[n].uitype)&&(e.filterQueryId="true"),e[t]=Crm.requestParamWithColname[n],i++);return e.moduleid=returnJson[CFRExec.formRuleModule].entityid,e.module=detailView.currentModule,e[csrfParamName]=csrfToken,e},getIndexForTab:function(e,t){return e&&t&&(e.includes("Lookup")||e.includes("Owner")||e.includes("Handler")?t+=4:t++),t},performCancelMandatory:function(){if(CFRExec.hideWorkingContainer(),!0==!validationUtils.isEmpty(CFRExec.haltStateParams)){"StageView"===CFRExec.haltStateParams.check.type?crmListView.updateStageError(CFRExec.haltStateParams.fieldValue,CFRExec.haltStateParams.check.prevStageId):"processFlow"===CFRExec.haltStateParams.check.type&&$("#pb_processButtonLayerInner, #transitionBtnLayer").find(".pb_transitionState").removeClass("eventNone"),CFRExec.relatedEntityMap={};var e="closeTask"===CFRExec.haltStateParams.check.type&&"detailspage"===CFRExec.haltStateParams.check.from||"processFlow"===CFRExec.haltStateParams.check.type;delete CFRExec.haltStateParams,e&&CFRExec.evalRules(CFRExec.OPERATIONCONSTANT.VIEW,!0)}else $("#saveCancelSpan").find('a[name="button__'+CFRExec.ajaxEditHaltedFieldColName+'"]').trigger("click"),"STAGE"===CFRExec.ajaxEditHaltedFieldColName&&$("crm-stage-detailview").length>0&&Lyte.registeredMixins["crm-detail-view-utils"].renderStageComponent(),CFRExec.relatedEntityMap={},CFRExec.evalRules(CFRExec.OPERATIONCONSTANT.VIEW,!0);CFRExec.revertPotentials&&(cancelPotentialPopup(),CFRExec.revertPotentials=!1),$("#formRuleMandatoryFields").remove()},haltStageChange:function(e){CFRExec.haltStateParams=objectUtils.cloneObject(e)},getTaskCompletedOptionLabel:function(e){if(0===Object.keys(CFRExec.relatedEntityMap).length&&(CFRExec.relatedEntityMap=CFRExec.getRelatedEntityMap(e)),CFRExec.relatedEntityMap.STATUS)for(var t=CFRExec.relatedEntityMap.STATUS.picklistmap,a=t.length,i=0;i<a;i++)if("Completed"===t[i].systemvalue)return t[i].uservalue;return"Completed"},moveToTempHolder:function(){CFRExec.tempHolder={},CFRExec.tempHolder.oldJson="undefined"!=typeof returnJson?returnJson:null,CFRExec.tempHolder.oldResJson=CFRExec.oldResJson,CFRExec.tempHolder.module=CFRExec.formRuleModule},initFromTempHolder:function(){returnJson=CFRExec.tempHolder.oldJson,CFRExec.init(CFRExec.tempHolder.oldResJson,CFRExec.tempHolder.module,CFRExec.OPERATIONCONSTANT.VIEW),CFRExec.tempHolder={}},moveToTempHold:function(){CFRExec.tempHold={},CFRExec.tempHold.oldResJson=CFRExec.oldResJson,CFRExec.tempHold.formRuleModule=CFRExec.formRuleModule},tabIndexingForFields:function(e,t){var a,i=t,n=$(e).find(".textField"),r=$(e).find(".select2-selection");if(a=n.attr("data-content-type")){var s=$(e).find("select");if(s.length>0&&(r.length>0?(r.attr("tabindex",i),i=CFRExec.getIndexForTab("select",i)):(s.attr("tabindex",i),thirdPartyUtils.bindSelect2($(e).find(".selNone")),i=CFRExec.getIndexForTab("select",i))),a.includes("Lookup")){if(e&&n.attr("data-content-type").includes("Lookup")){var o=$(e).find("input , img");$.each(o,(function(e){$(o[e]).attr("tabindex",i),i=CFRExec.getIndexForTab("children",i)}))}}else n.attr("tabindex",i),i=CFRExec.getIndexForTab(a,i)}else{var l=$(e).find(".select2-search__field"),d=$(e).find("input"),c=$(e).find(".select"),m=$(e).find("crm-user-wrapper"),u=$(e).find("img");r.length>0?(l.length>0?l.attr("tabindex",i):r.attr("tabindex",i),i=CFRExec.getIndexForTab("select",i)):c.length>0?$(e).find(".cNfileUpladBtn").length>0?($(e).find(".fileUploadLabel").attr("tabindex",i),i=CFRExec.getIndexForTab("select",i)):c.length>0&&(c.attr("tabindex",i),i=CFRExec.getIndexForTab("select",i)):m.length>0?(u.attr("tabindex",i),m.attr("tab-index",i),i=CFRExec.getIndexForTab("fileUpload",i)):d.length>0&&(d.attr("tabindex",i),i=CFRExec.getIndexForTab("input",i))}return i},setTabindexForHiddenFields:function(e){if(e.find("[tabindex]").length>0)for(var t=$(e).find("[tabindex]").length,a=0;a<t;a++){$(e).find("[tabindex]")[a].setAttribute("tabindex",-1)}},setHaltedFieldLabel:function(e){CFRExec.ajaxEditHaltedFieldColName=e},getFormRuleDataParams:function(){var e={};return CFRExec.manateFldVsValue&&(e.manateFldVsValue=CFRExec.manateFldVsValue),CFRExec.fieldVsValue&&(e.fieldVsValue=CFRExec.fieldVsValue),e.mandatoryInputNeededElem=CFRExec.mandatoryInputNeededElem,e.lrMandatoryElem=CFRExec.lrMandatoryElem,e.LayoutRuleHiddenElem=CFRExec.LayoutRuleHiddenElem,e}},CrmIntelligence={inc:0,userList:"",tempCount:0,monthShortNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],monthFullNames:["January","February","March","April","May","June","July","August","September","October","November","December"],init:function(){Handlebars.registerPartial("NotificationSummary",Handlebars.templates.NotificationSummary),Handlebars.registerPartial("ZiaOnboard",Handlebars.templates.ZiaOnboard),Handlebars.registerPartial("DetailViewPrediction",Handlebars.templates.DetailViewPrediction)},cFlag:0,checkAlertStatus:function(e){var t={};t.action=e||"status",t[csrfParamName]=csrfToken,(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/crminotification.do",type:"POST",data:t,success:function(e){var t=e.newnoti+e.unseen+e.seen;0===e.status?($(".ziaCount").text(t),$("#di-notification-icon").addClass("ziaCountActive")):1===e.status&&$("#di-notification-icon").addClass("zia-active"),"false"!==e.seenfirsttime&&!1!==e.seenfirsttime||$(".jiaAnimatedDiv").addClass("animkey")}})},notifyOnWms:function(e){var t=$("#di-notification-icon"),a=!(!e||void 0===e.status)&&e.status;if("true"===a||!0===a){var i=e.count;void 0!==i?($(".ziaCount").text(i),t.addClass("ziaCountActive"),t.removeClass("zia-active")):t.addClass("zia-active")}var n=Crm.userDetails.CUSTOMIZE_INFO.desktop_notification_enabled;if(void 0!==n&&n&&"granted"===Notification.permission){var r="",s="",o="";if(e&&void 0!==e.summary&&e.summary.length>0)for(var l=e.summary.length,d=0;d<l;d++)if("title"===e.summary[d].type&&(r=I18n.getMsg(e.summary[d].key)),"body"===e.summary[d].type&&(s=I18n.getMsg(e.summary[d].key),o=e.summary[d].key),"Prediction"===r&&"extra_info"===e.summary[d].type&&e.summary[d].extra_info){var c=e.summary[d].extra_info.name,m=e.summary[d].extra_info.tabid,u=[];u.push(c),u.push(store.peekAll("module").filterBy({id:m})[0].plural_label),s=I18n.getMsg(o,u)}""===r&&(r=I18n.getMsg("crm.zia.config.notification")),""===s&&(s=I18n.getMsg("crm.zianotification.new.notification"));var v=networkUtils.getImageUrl("zia-logo-512_52c9704_.png",ResourceConstants.CRMClient);new Notification(r,{body:s,icon:v}).onclick=function(e){CrmIntelligence.getZiaNotificationSummary(e,this)}}CrmIntelligence.checkAlertStatus("setnotified")},getZiaNotificationSummary:function(e,t){sE(e);var a=$("#diNotificationDiv"),i=$("#freezeBackGround").is(":visible"),n="block"===a.css("display"),r="none"===a.css("display"),s=$("#di-notification-icon");if(CrmIntelligence.loadAnimation(t,s,a),a.addClass("ziaNotificationLoader"),!i&&(!0===Crm.userDetails.CUSTOMIZE_INFO.UNPIN_RECENT_ITEM||void 0===Crm.userDetails.CUSTOMIZE_INFO.UNPIN_RECENT_ITEM||a&&r))if(a&&n)CrmIntelligence.hideDiNotification();else{CrmIntelligence.fromFooter(a);var o=store.triggerAction("zianotificationpanel","categorize",null,{group_by:"type"},"GET",null),l=store.findAll("zianotificationpanel",{type:"all"});Crm.client_tracking("Zia Notification - icon clicked");var d=networkUtils.returnDependencyFiles(["crm-zia-notification.js"],crmConstants.jsStaticPathForLyte),c=networkUtils.returnDependencyFiles(["crm-zia-notification.css"],crmConstants.cssStaticPathForLyte),m=d.concat(c),u=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("notification")],crmConstants.jsStaticPath),v=m.concat(u);Lyte.injectResources(v,void 0,(function(){Lyte.resolvePromises({__zia_notifications:l,categorize:o}).then((function(e){if(""===a.html()){var t=CrmIntelligence.processAPIresponse(e);a.removeClass("ziaNotificationLoader"),Lyte.Component.render("crm-zianotification-popup",t,"#diNotificationDiv")}EmailSendingUtil.closeTabALertPopup(),EmailSendingUtil.composeActive&&EmailCompose.etMinimiseCompose()}),(function(e){-1!==JSON.parse(e.response).code.indexOf("NO_PERMISSION")?renderingUtils.displayPermissionDenied():renderingUtils.showCustomAlert(I18n.getMsg("crm.zianotification.common.error.msg"))}))}))}},processAPIresponse:function(e){if(e.__zia_notifications=void 0!==e.__zia_notifications?e.__zia_notifications:e,0===e.__zia_notifications.length)return{fromFilter:!1,noNotification:!0,showMarkAllAsRead:!1};var t,a,i=0,n=0,r=0,s=0,o=0,l=0,d=0,c=0,m=[],u=[],v=[],p=[],h=[],g=[],C=[],f=[],E=e.__zia_notifications,I=!1,y=e.__zia_notifications.$.meta.more_records;t=void 0!==Crm.userDetails.CUSTOMIZE_INFO.desktop_notification_enabled&&Crm.userDetails.CUSTOMIZE_INFO.desktop_notification_enabled,(a=void 0!==Crm.userDetails.CUSTOMIZE_INFO.unread_only&&Crm.userDetails.CUSTOMIZE_INFO.unread_only)&&(E=E.filter((function(e){return!1===e.read})));var R=[];if(e.categorize){var b=e.categorize.categorize;if(b){for(var T=b.length,D=0;D<T;D++)R.push(b[D].value);-1!==R.indexOf("anomaly")&&-1!==R.indexOf("analytics")&&R.splice(R.indexOf("analytics"),1,"")}}else{var w=$L("crm-zianotification-popup")[0];w&&(R=w.component.data.availableFeatures)}var M="";return E.forEach((function(e){e.date=e.notification_time;var t=e.date.split("-"),a=parseInt(t[0]),E=parseInt(t[1])-1,y=parseInt(t[2]),R=CrmIntelligence.processDateString(new Date(a,E,y),!0);switch(M!==R?(e.date=R,M=R):e.date=void 0,e.read?e.cls="jarvisSectionBox alreadyClicked":(e.cls="jarvisSectionBox",I=!1===I||I),e.type){case"prediction":var b=e.associated_resources[0].resources[0].name,T=e.associated_resources[0].resources[0].createdBy,D=e.associated_resources[0].resources[0].details.module[0].id,w=[];w.push(b);var S=store.peekRecord("module",D);void 0!==S?w.push(S.$.get("plural_label")):w.push(""),-1!==e.summary.indexOf("{2}")&&w.push(T);var L=I18n.getMsg(e.summary,w);e.summary=L,m[i]=[e],i++,e.iconClass="configSetup";break;case"workflow":if(e.associated_resources[0].type.includes("system_workflow")){var A=e.associated_resources[0].type;if("106"===A.substr(A.length-3)){var _=e.associated_resources[0].resources,O=I18n.getMsg("crm.wf.di.usage.vs.records.body",_);e.summary=O}}g[n]=[e],n++,e.iconClass="suggestionAI";break;case"anomaly":case"analytics":_=e.associated_resources[0].resources;var N=I18n.getMsg(e.summary,_);e.summary=N,C[r]=[e],r++,e.iconClass="suggestionAI";break;case"competitor_alert":_=e.associated_resources[0].resources,O=I18n.getMsg(e.summary,_);e.summary=O,f[s]=[e],s++,e.iconClass="cmpAl";break;case"chat_bot":_=e.associated_resources[0].resources,O=I18n.getMsg("crm.intelligence.notification.body",_);e.summary=O,e.iconClass="cmpAl";break;case"recommendation":var $,P=e.summary.split("$"),k=P[0],F="daily"===P[1]?I18n.getMsg("Daily"):I18n.getMsg("Weekly"),x=store.peekRecord("module",e.associated_resources[0].resources[0].whom_module_id),U=[F,$=x.hasOwnProperty("recommendationsDetailsJson")?"re_buy"===k?x.recommendationsDetailsJson.suggestion_type.rebuy.label:x.recommendationsDetailsJson.suggestion_type[k].label:CrmIntelligence.getDefaultSuggestionTypeLabel(k),x.plural_label];e.summary=I18n.getMsg("zia.recommendation.notification.ziapanel.summary",U),e.recommendation_notifications=e.associated_resources[0].resources[0],e.recommendation_notifications.suggestion_type=$,e.recommendation_notifications.suggestion_type_api_name=k,u[o]=[e],o++,e.iconClass="configSetup";break;case"similarity":e.title=I18n.getMsg("crm.setup.system.ziasimilarity");var V=e.summary.split(",");1===V.length?e.summary=I18n.getMsg("zia.similarity.notification.summary.current",V):e.summary=I18n.getMsg("zia.similarity.notification.summary.all",V),h[c]=[e],c++,e.iconClass="configSetup";break;case"recommendation_builder":u[o]=[e],o++,e.iconClass="configSetup";break;case"email_extracted_activities":v[l]=[e],l++,e.iconClass="suggestionAI";break;case"cns":p[d]=[e],d++,e.iconClass="cmpAl"}})),{fromFilter:!1,notifications:E,noNotification:!1,predNotifications:m,recommendationNotifications:u,similarityNotifications:h,wfNotifications:g,anomalyNotifications:C,prev:"",desktopEnabled:t,unreadOnly:a,showMarkAllAsRead:I,availableFeatures:R,isMoreRecAvailable:y}},loadAnimation:function(e,t,a){t.removeClass("ziaCountActive zia-active"),Crm.menu.globalHideMenu(),$(".crm-wms-icon").removeClass("blinkEl"),$(e).addClass("blinkEl"),a.off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend"),$("#diNotificationDetails").off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend"),$(".remainder-notifi,#LDPOP").hide(),$("#chatbotDiv").css("visibility","visible"),hideFeedBackPopup(),massActionNotification.hideMassOperationProgressDiv(),$(".timericon,#wVisTitBar").removeClass("footIconActive timericonAct ldchatPop_active")},getNotificationSummary:function(e,t){var a=$("#diNotificationDiv"),i="block"===a.css("display"),n="none"===a.css("display"),r=$("#di-notification-icon");if(loadAnimation(t,r,a),$(".timericon,#wVisTitBar").removeClass("footIconActive timericonAct ldchatPop_active"),!$("#freezeBackGround").is(":visible")&&(!0===Crm.userDetails.CUSTOMIZE_INFO.UNPIN_RECENT_ITEM||void 0===Crm.userDetails.CUSTOMIZE_INFO.UNPIN_RECENT_ITEM||a&&n))if(a&&i)CrmIntelligence.hideDiNotification();else{if(""===a.html()){var s=Handlebars.templates.NotificationSummary({template:"skeleton"});a.html(s),Crm.trackSpotLightAction("AI Trend Dashboard - ZIA Summary Click"),CrmIntelligence.getNotification()}EmailSendingUtil.closeTabALertPopup(),EmailSendingUtil.composeActive&&EmailCompose.etMinimiseCompose(),sE(e)}},getNotification:function(e){var t=$("#diNotificationDiv"),a=new crmRequestPool,i={action:"summary",from:e?e+=1:e=1},n=!1,r=$(".jiaAnimatedDiv");r.hasClass("animkey")&&(n=!0,r.removeClass("animkey"),i.isFirstTime=!0),i[csrfParamName]=csrfToken,a.initiate({action:Crm.getCrmBasePath()+"/crminotification.do",type:"POST",data:i,success:function(t){var a=!1;t.hasOwnProperty("isFirstTime")&&(a=t.isFirstTime);var i=$("#diNotificationDiv");if(!a&&t.hasOwnProperty("notificationList")){var r=t.notificationList,s=r.length;s>200&&r.pop();var o=new Map;r.forEach((function(e){var t=e.date.split("-"),a=new Date(t[0],parseInt(t[1])-1,t[2]).getTime(),i=e.notification,n=e.id,r=e.seen,s=e.featureid;CrmIntelligence.replaceModuleI18n(s,i);var l,d,c,m=e.extra_info?e.extra_info:{};if("333"===s&&(m=e.notification[2].extra_info?e.notification[2].extra_info:{},l=e.notification[2].extra_info.prediction_id),"334"===s&&(m=e.notification[2].extra_info?e.notification[2].extra_info:{},d=e.notification[2].extra_info.prediction_id),"335"===s){var u,v=JSON.parse(i[1].key),p="daily"===v.frequency?I18n.getMsg("Daily"):I18n.getMsg("Weekly"),h=store.peekRecord("module",i[2].extra_info.whom_module_id),g=v.suggestion_type,C=[p,u=h.hasOwnProperty("recommendationsDetailsJson")?"re_buy"===v.suggestion_type?h.recommendationsDetailsJson.suggestion_type.rebuy.label:h.recommendationsDetailsJson.suggestion_type[g].label:CrmIntelligence.getDefaultSuggestionTypeLabel(g),h.plural_label];i[1].key=I18n.getMsg("zia.recommendation.notification.ziapanel.summary",C),(m=e.notification[2].extra_info?e.notification[2].extra_info:{}).suggestion_type=u,m.suggestion_type_api_name=g,c=e.notification[2].extra_info.prediction_id}var f={elements:i,id:n,seen:r,featureid:s,extra_info:JSON.stringify(m),prediction_id:l,recommendation_id:d,recommendation_notification:c};if("301"===s||"501"===s){for(var E=i.length,I=0;I<E;I++)if("title"!==i[I].type)for(var y=i[I].values.length,R=0;R<y;R++)i[I].values[R]=$ESAPI.encoder().encodeForHTML(I18n.getMsg(i[I].values[R]+""));f.elements=i}var b=null;o.has(a)?(b=o.get(a))[b.length]=f:b=[f],o.set(a,b)}));var l=[],d=0;o.forEach((function(e,t){l[d]=[t,e],d++}));var c=l.sort((function(e,t){return(e=e[0])>(t=t[0])?-1:e<t?1:0})).map((function(e){return{date:CrmIntelligence.processDateString(new Date(e[0])),notificationList:e[1].map((function(e){var t=e.elements.map((function(e,t,a){var i,n=e.type;return"301"===this.featureid&&"title"===n?i=e.key:"333"===this.featureid&&"body"===n&&a[2].extra_info.isNew?(e.values=[],e.values.push(a[2].extra_info.name),e.values.push(store.peekAll("module").filterBy({id:a[2].extra_info.tabid})[0].plural_label),e.values.push(a[2].extra_info.created_by),i=I18n.getMsg(e.key,e.values)):i=I18n.getMsg(e.key,e.values),{type:n,message:i}}),{featureid:e.featureid});return e.elements=t,e}))}}));if(c.length>0){var m={datelist:c,template:"summaryContainer"};if(1===e)Handlebars.registerPartial("summary",Handlebars.templates.NotificationRenderSummary),i.append(Handlebars.templates.NotificationSummary(m));else $("#notificationContainer").append(Handlebars.templates.NotificationRenderSummary(m));CrmIntelligence.bindScrollEvent()}else{var u=I18n.getMsg("crm.intelligence.zia.nonotification");n&&(u=I18n.getMsg("crm.intelligence.zia.nonotification.firsttime")),i.append('<div class="jarvisSectionBoxNoNotificaion crm-font-regular">'+u+"</div>")}thirdPartyUtils.bindPerfectScroll($(".jarvisScrollContainer")),s-e+1<200&&$("#diScrollContainer").off("scroll")}else a?(i.find(".jarvisTitleBig").hide(),i.append(Handlebars.templates.ZiaOnboard(t.ziaOnboardImage))):i.append("Notifications Unavailable");CrmIntelligence.fromFooter(i),$(".jarvisSectionBox.alreadyClicked").addClass("ziaNotificationClicked")},error:function(){CrmIntelligence.fromFooter(t)}})},replaceModuleI18n:function(e,t){if(109===e||106===e||4===e||"109"===e||"106"===e||"4"===e){var a=t[1].values;if(106===e||"106"===e){var i=crmTab.getDisplayName(a[2],!1);a[2]=null==i?I18n.getMsg(a[2]):i}if(109===e||"109"===e){i=crmTab.getDisplayName(a[1],!1);a[1]=null==i?I18n.getMsg(a[1]):i}4!==e&&"4"!==e||(a[0]=Crm.moduleInfo.Leads.translatedPluralLabel)}},bindScrollEvent:function(){var e=$("#diScrollContainer");e.on("scroll",$L.debounce((function(){var t=e.scrollTop(),a=e.outerHeight()+1,i=e[0].scrollHeight;if(t>0&&t+a>=i){var n=e.find(".jarvisSectionBox").length;CrmIntelligence.getNotification(n)}}),100))},processDateString:function(e,t){var a=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],i=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"),n=null,r=new Date,s=new Date((new Date).setDate(r.getDate()-1));return e.toDateString()===r.toDateString()?(n=I18n.getMsg("Today"),t||(n+=", "+I18n.getMsg(a[e.getDay()]))):e.toDateString()===s.toDateString()?(n=I18n.getMsg("Yesterday"),t||(n+=", "+I18n.getMsg(a[e.getDay()]))):n=e.getFullYear()===r.getFullYear()?I18n.getMsg(a[e.getDay()])+", "+I18n.getMsg(i[e.getMonth()])+" "+e.getDate():I18n.getMsg(i[e.getMonth()])+" "+e.getDate()+", "+e.getFullYear(),n},hideDiNotification:function(){($L(".etTrendsWrapper").length||$L(".etTrendsWrapperCNS").length)&&(document.getElementById("etTrendsOuterDiv1").ltProp("show",!1),$("#qCreate").html(""),$("#eventCreatePopup").html(""),$L("#createEditCallDiv").css("display","none"),removeFreezeLayer());var e=$("#di-notification-icon");$(".jarvisSectionBox").length>$(".jarvisSectionBox.ziaNotificationClicked").length&&e.addClass("zia-active"),CrmIntelligence.toFooter($("#diNotificationDiv"));var t=$("#diNotificationDetails"),a=$("#diNotificationDetailsContent");a&&(thirdPartyUtils.unbindHighcharts(a),a.empty());var i=$(".clickedSection");e.removeClass("blinkEl"),t.is(":visible")&&(t.css({right:"-900px"}),t.bind("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",(function(){var e=$(this);e.hide(),e.off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend")}))),$(".jarvisFreeze").removeClass("showFreeze").hide(),$L("body").removeClass("oH"),i.addClass("alreadyClicked").removeClass("clickedSection"),delete CrmIntelligence.notificationDetailJson},ignoreNotification:function(e,t){if(t){var a=new crmRequestPool,i={action:"ignoreNotification",id:e};i[csrfParamName]=csrfToken,a.initiate({action:Crm.getCrmBasePath()+"/crminotification.do",type:"POST",data:i,success:function(e){if("Success"===e.Status){var t=$("div[data-noti-id='"+e.NotificationId+"']");if(t.length){CrmIntelligence.closeDINotificationDetails();var a=t.closest(".notificationSummaryDateWise");crmui.showMsgBand("success",I18n.getMsg("crm.wf.di.ignore.success.msg"),1500),a.find(".jarvisSectionBox").length<=1?(a.addClass("ignoreNotification"),a.on("animationend webkitAnimationEnd oAnimationEnd",(function(){this.remove()}))):(t.addClass("ignoreNotification"),t.on("animationend webkitAnimationEnd oAnimationEnd",(function(){this.remove()})))}}else crmui.showMsgBand("error",I18n.getMsg("crm.security.error.add.user"),1500)}})}else{var n={val:I18n.getMsg("crm.wf.di.ignore.snooz",[90]),fn:function(){CrmIntelligence.ignoreNotification(e,!0)}},r={val:I18n.getMsg("crm.button.cancel")};renderingUtils.showCustomConfirmMessageNewModel(I18n.getMsg("crm.wf.di.ignore.confirmation",[90]),n,r)}},matchWidthinDiffTable:function(){for(var e=0,t=0;t<=3;t++){var a=$("#templateSubColTab_"+t).outerWidth();a>e&&(e=a)}$(".templateSubColTabWidth").css({width:e})},matchWidthinDiffTableForSecond:function(){for(var e=0,t=0;t<=3;t++){var a=$("#templateSubColTabSecond_"+t).outerWidth();a>e&&(e=a)}$(".templateSubColTabSecondWidth").css({width:e})},getZiaNotificationDetails:function(e,t){var a=0,i=0,n=0,r=0,s="",o=0,l="",d=e.id,c=0,m="",u="";if(store.peekRecord("zianotificationpanel",d).$.set("read",!0),"Macro Suggestions"===e.title)c=105;else if("prediction"===e.associated_resources[0].type)c=333;else if("recommendation_builder"===e.associated_resources[0].type)c=334;else if("workflow_suggestion"===e.associated_resources[0].type)c=112;else if("analytics"===e.type)c=301;else if("recommendation"===e.type)c=335;else if("similarity"===e.type)c=336;else if("anomaly"===e.type)c=4;else if(e.associated_resources[0].type.includes("system_workflow")){var v=e.associated_resources[0].type;c=parseInt(v.substr(v.length-3))}else"email_extracted_activities"===e.type?(m=!0,c=700):"cns"===e.type&&(u=!0,c=800);switch(c){case 333:a=e.associated_resources[0].resources[0].id;break;case 334:i=e.associated_resources[0].resources[0].id;break;case 301:n=e.associated_resources[0].resources[0].details.components[0].id,r=e.associated_resources[0].resources[0].id,s=e.associated_resources[0].resources[0].details.components[0].name;break;case 112:o=e.associated_resources[0].resources[0].id,l=e.associated_resources[0].resources[0].details.module[0].api_name}commonUtils.showHideLoadingDiv(!0),e=$(e),$L(".ziaNotificationClicked").removeClass("ziaNotificationClicked");var p=$L(t).hasClass("alreadyClicked");$L(t).addClass("alreadyClicked").addClass("ziaNotificationClicked");var h=$(".clickedSection"),g=$("#diNotificationDetails"),C=$("#diNotificationDetailsContent"),f=new crmRequestPool;Crm.trackSpotLightAction("AI Trend Dashboard - ZIA Notifications Click");var E={action:"details",id:d};if(c>=101&&c<150&&(E.action="diRuleDetails"),700!==c){var I=$L("crm-ziaforemails")[0];if(I)I.component.executeMethod("close")}if(800!==c){var y=$L("crm-ziaforcns")[0];if(y)y.component.executeMethod("close")}switch(E[csrfParamName]=csrfToken,c){case 112:Lyte.injectResources(networkUtils.returnDependencyFiles(["workflow-suggestion-components.js"],crmConstants.jsStaticPathForLyte),void 0,(function(){store.batch((function(){commonUtils.showHideLoadingDiv(!0),store.findRecord("workflow_suggestion_details",o),store.findAll("field",{module:l})})).then((function(t){var a=t[0][0];if(CrmIntelligence.showNotificationDetails(e,h,g,C),commonUtils.showHideLoadingDiv(),g.addClass("p0"),a.status&&"failure"===a.status)$("#dIchartTitle").text("No Suggestion Found");else{var i=a.execute_when,n="";"create"===i.type&&(n="Create"),"edit"===i.type&&(n="Edit"),a.fields=t[1],a.module.plural_name=store.model.module.data.filterBy({api_name:a.module.api_name})[0].plural_label,i.execute_on=I18n.getMsg("crm.workflow.rule.label.On"+n),C.empty(),$("#dIchartTitle").addClass("hide"),Lyte.Component.render("crm-workflow-suggestion-details-inner",{suggestion:a,call_from:"zia"},"#diNotificationDetailsContent")}}))}));break;case 301:CrmIntelligence.showNotificationDetails(e,h,g,C),g.find(".jarvisClosebtn").hide();var R=!1;"undefined"!=typeof CrmAnalytics&&(R=!0),R?CrmIntelligence.requestAnalyticsData(C,n,s,r):Lyte.injectResources(networkUtils.returnDependencyFiles(["zohocrm_analytics.js"].concat(networkUtils.includeChartFiles()).concat(networkUtils.getI18nJSUrl("dashboard"))),void 0,(function(){CrmAnalytics.init(),CrmAnalytics.isAnomalyNotificationEnabled=!0,CrmIntelligence.requestAnalyticsData(C,n,s,r)})),p||CrmIntelligence.setNotificationAsSeen(d),commonUtils.showHideLoadingDiv(!1);break;case 105:CrmIntelligence.showMacroSuggestion(d,e,C);break;default:g.removeClass("p0"),f.initiate({type:"POST",data:E,action:Crm.getCrmBasePath()+"/crminotification.do",success:function(t){var n=C;commonUtils.showHideLoadingDiv();var r=$(".jarvisFreeze");if(700===c)if(r.removeClass("showFreeze"),t.entityPresence)viewMail(t.messageId,t.mailType,"Close",t.sentOrReceived,"","",!0,t.entityId,this,"",d,"",!0);else{var s=$L("crm-ziaforemails")[0];if(s)s.component.executeMethod("close");crmui.showMsgBand("error",I18n.getMsg("crm.label.zia.email.cns.recorddeleted"),4e3)}if(800===c)if(r.removeClass("showFreeze"),t.entityPresence)viewMail(t.msgid,t.mailType,"Close","Received","","",!0,t.entityId,this,"",d,"",void 0,!0);else{var o=$L("crm-ziaforcns")[0];if(o)o.component.executeMethod("close");crmui.showMsgBand("error",I18n.getMsg("crm.label.zia.email.cns.recorddeleted"),4e3)}if(c>=0&&c<100)CrmIntelligence.showAnomalyDetails(t,c);else if(c>100&&c<150)if($("#dIchartTitle").hide(),$("#wfDINotificationHeader").show(),Crm.isZohoChartsEnabled?thirdPartyUtils.unbindZohoCharts(n):thirdPartyUtils.unbindHighcharts(n),101===c||103===c||103===c||104===c){var l,m,u="";u=101===c||103===c?I18n.getMsg("crm.wf.di.duplicate.email.same.template.header",[I18n.getMsg(Crm.userDetails.MODULE_LIST[t.EmailModule].singular_label)]):I18n.getMsg("crm.wf.di.duplicate.email.diff.template.header",[I18n.getMsg(Crm.userDetails.MODULE_LIST[t.EmailModule].singular_label)]),t.IsSameTemplate&&(l=t.Rules[0].Alerts[0].EncryptedTemplateId,m=t.Rules[0].Alerts[0].TemplateName);var v='<a data-zcqa="btn_di_ignoreNotification" href="javascript:void(0)" onclick="CrmIntelligence.ignoreNotification(\''+d+'\')" class="link">'+I18n.getMsg("crm.wf.di.btn.ignore")+"</a>";v=I18n.getMsg("crm.wf.di.ignore.desc",[v]);var p=Handlebars.templates.WFDuplicateMailDetails({data:t,EncryptedTemplateId:l,TemplateName:m,Description:u,NotificationId:d,IgnoreNotificationMsg:v});n.html(p)}else if(106===c){var h=t.Module,g=t.TotalCreatedModule,f=t.TotalCreatedModuleTouched,E=0;if(g>0){var I=100*(g-f);E=Math.floor(I/g)}var y=t.PluralLevelName,R=t.SingularLevelName,b=t.workFlowNotUsed.RulesDetails,T={Module:h,RulesDetails:b,TotalPercentage:E,PluralLevelName:y,SingularLevelName:R};p=Handlebars.templates.CrmWFUsageDetails({Result:t,Data:T});n.html(p);var D=t.NotTouchedRecordsCounts;if(Crm.isZohoChartsEnabled){var w=!1;"undefined"!=typeof $ZC&&(w=!0),w?CrmIntelligence.crmUsagePieChartZCharts(D,y):Lyte.injectResources(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles()),void 0,(function(){CrmIntelligence.crmUsagePieChartZCharts(D,y)}))}else{w=!1;"undefined"!=typeof Highcharts&&(w=!0),w?CrmIntelligence.crmUsagePieChart(D,y):Lyte.injectResources(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles()),void 0,(function(){CrmIntelligence.crmUsagePieChart(D,y)}))}var M=$("#diNotificationDetailCase1"),S=D[1]||0;if(S>0){var L=I18n.getMsg("crm.wf.di.unused.records.criteria",[I18n.getMsg(y)]);T={Module:h,UntouchedRecords:t.workFlowNotUsed.RecordsDetails},p=Handlebars.templates.DIRecordsDoesNotHaveAnyFollowup({Data:T,Heading:L,HeadingVsI18n:t.workFlowNotUsed.RecordsHeadings,HeadingAvailable:t.workFlowNotUsed.HeadingAvailability}),M.append(p)}var A=!1;t.workFlowNotUsed.RecordsDetails.length>0&&(A=!0),S>0&&!A&&M.append('<div class="m30 p30 aligncenter f18">'+I18n.getMsg("crm.wf.di.records.deleted.error.msg")+"</div>"),t.RuleNotUsedCount>0&&0===b.length&&$("#wfDiPoPForWorkflowRules").append('<div class="m15 p15 aligncenter f18">'+I18n.getMsg("crm.wf.di.wf.rule.deleted.error.msg")+"</div>")}else if(109===c){h=t.Module;var _=t.UntouchedRecords.length;if(_>0){var O=t.PluralLevelName,N=(L=I18n.getMsg("crm.wf.di.records.without.any.followup",[I18n.getMsg(O)]),Handlebars.templates.DIRecordsDoesNotHaveAnyFollowup({Data:t,Heading:L,HeadingVsI18n:t.RecordsHeadings,HeadingAvailable:t.HeadingAvailability,IsrecordSample:_}));n.html(N)}else n.html('<div class="m30 p30 aligncenter f18">'+I18n.getMsg("crm.wf.di.records.deleted.error.msg")+"</div>")}else if(107===c||110===c){var P=new Date(t.ModifieyOn),k=t.IsDropped?"Drop":"Increased";if(n.html(Handlebars.templates.CrmWFUsageAfterModification({Data:t,ModifiedOn:P.toDateString(),DroppedOrIncreased:k})),!jQuery.isEmptyObject(t.CrtDetails)){var F=WFAuditLog.addCriteriaDetailsInfo(t.CrtDetails,!0);$("#diNotificationDetailsCase2CriteriaDetails").html(F)}}else 108!==c&&111!==c||CrmIntelligence.showWFDetails108_111(t);else if(201===c){var x=networkUtils.getI18nJSUrl("chatbot");networkUtils.loadFeatureScripts(["zcrm_chatbot_ZiaTemp.js","zcrm_chatbot_Zia.js",x],(function(){ziaRenderResult(t,$("#diNotificationDetailsContent"));var e=$("#dIchartTitle");e.text(t.name),e.removeClass("aligncenter").addClass("mB0")}))}else 501===c?CrmIntelligence.showCompetitorAlertDetails(t,e,d):333===c?CrmIntelligence.showPredictionNotificationDetails(e,a):334===c?CrmIntelligence.showRecommendationNotificationDetails(e,i):335===c?CrmIntelligence.showRecommendationtypeNotifications(e):336===c&&CrmIntelligence.showSimilarityNotifications(e)},error:function(){C.append("Notification Details Unavailable"),commonUtils.showHideLoadingDiv(!1)}}),m||u||CrmIntelligence.showNotificationDetails(e,h,g,C)}},getNotificationDetails:function(e){commonUtils.showHideLoadingDiv(!0),(e=$(e)).addClass("ziaNotificationClicked");var t=e.data("noti-id"),a=$(".clickedSection"),i=$("#diNotificationDetails"),n=e.hasClass("alreadyClicked"),r=new crmRequestPool;Crm.trackSpotLightAction("AI Trend Dashboard - ZIA Notifications Click");var s={action:"details",id:t};s[csrfParamName]=csrfToken;var o=parseInt(e.data("featureid"));o>=101&&o<150&&(s.action="diRuleDetails");var l=$("#diNotificationDetailsContent");if(112===o)Lyte.injectResources(networkUtils.returnDependencyFiles(["workflow-suggestion-components.js"],crmConstants.jsStaticPathForLyte),void 0,(function(){var t=e.data("extrainfo");store.batch((function(){commonUtils.showHideLoadingDiv(!0),store.findRecord("workflow_suggestion_details",t.suggest_id),store.findAll("field",{module:t.module})})).then((function(t){var n=t[0][0];if(CrmIntelligence.showNotificationDetails(e,a,i,l),commonUtils.showHideLoadingDiv(),i.addClass("p0"),n.status&&"failure"===n.status)$("#dIchartTitle").text("No Suggestion Found");else{var r=n.execute_when,s="";"create"===r.type?s="Create":"edit"===r.type&&(s="Edit"),n.fields=t[1],n.module.plural_name=store.model.module.data.filterBy({api_name:n.module.api_name})[0].plural_label,r.execute_on=I18n.getMsg("crm.workflow.rule.label.On"+s),l.empty(),$("#dIchartTitle").addClass("hide"),Lyte.Component.render("crm-workflow-suggestion-details-inner",{suggestion:n,call_from:"zia"},"#diNotificationDetailsContent")}}))}));else if(301===o){var d=e.data("extrainfo"),c=d.component_id,m=d.dashboard_id,u=d.component_name;CrmIntelligence.showNotificationDetails(e,a,i,l),i.find(".jarvisClosebtn").hide();var v=!1;"undefined"!=typeof CrmAnalytics&&(v=!0),v?CrmIntelligence.requestAnalyticsData(l,c,u,m):Lyte.injectResources(networkUtils.returnDependencyFiles(["zohocrm_analytics.js"].concat(networkUtils.includeChartFiles()).concat(networkUtils.getI18nJSUrl("dashboard"))),void 0,(function(){CrmAnalytics.init(),CrmAnalytics.isAnomalyNotificationEnabled=!0,CrmIntelligence.requestAnalyticsData(l,c,u,m)})),n||CrmIntelligence.setNotificationAsSeen(t),commonUtils.showHideLoadingDiv(!1)}else 105===o?CrmIntelligence.showMacroSuggestion(t,e,l):(i.removeClass("p0"),r.initiate({action:Crm.getCrmBasePath()+"/crminotification.do",type:"POST",data:s,success:function(a){commonUtils.showHideLoadingDiv();var i=l;if(o>=0&&o<100)$("#dIchartTitle").html(I18n.getMsg(a.title,[I18n.getMsg(a.title.split(" ")[0])])).show(),$("#wfDINotificationHeader").hide(),CrmDashboard.reprocessTrendAnalysisResponse(a),a.start=0,a.end=a.currentPeriodIndex?a.currentPeriodIndex+1:7,CrmDashboard.createTrendDashboardGraph("diNotificationDetailsContent",a,o);else if(o>100&&o<150){$("#dIchartTitle").hide(),$("#wfDINotificationHeader").show();var n=i.highcharts();if(n&&n.destroy(),101===o||103===o||104===o){var r,s,d="";d=101===o||103===o?I18n.getMsg("crm.wf.di.duplicate.email.same.template.header",[I18n.getMsg(Crm.userDetails.MODULE_LIST[a.EmailModule].singular_label)]):I18n.getMsg("crm.wf.di.duplicate.email.diff.template.header",[I18n.getMsg(Crm.userDetails.MODULE_LIST[a.EmailModule].singular_label)]),a.IsSameTemplate&&(r=a.Rules[0].Alerts[0].EncryptedTemplateId,s=a.Rules[0].Alerts[0].TemplateName);var c='<a data-zcqa="btn_di_ignoreNotification" href="javascript:void(0)" onclick="CrmIntelligence.ignoreNotification(\''+t+'\')" class="link">'+I18n.getMsg("crm.wf.di.btn.ignore")+"</a>";c=I18n.getMsg("crm.wf.di.ignore.desc",[c]);var m=Handlebars.templates.WFDuplicateMailDetails({data:a,EncryptedTemplateId:r,TemplateName:s,Description:d,NotificationId:t,IgnoreNotificationMsg:c});i.html(m)}else if(106===o){var u=a.Module,v=a.TotalCreatedModule,p=a.TotalCreatedModuleTouched,h=0;v>0&&(h=Math.floor(100*(v-p)/v));var g=a.PluralLevelName,C=a.SingularLevelName,f=a.workFlowNotUsed.RulesDetails,E={Module:u,RulesDetails:f,TotalPercentage:h,PluralLevelName:g,SingularLevelName:C};m=Handlebars.templates.CrmWFUsageDetails({Result:a,Data:E});i.html(m);var I=a.NotTouchedRecordsCounts;if(Crm.isZohoChartsEnabled){var y=!1;"undefined"!=typeof $ZC&&(y=!0),y?CrmIntelligence.crmUsagePieChartZCharts(untouchedRecCount,g):Lyte.injectResources(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles()),void 0,(function(){CrmIntelligence.crmUsagePieChartZCharts(untouchedRecCount,g)}))}else{y=!1;"undefined"!=typeof Highcharts&&(y=!0),y?CrmIntelligence.crmUsagePieChart(untouchedRecCount,g):Lyte.injectResources(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles()),void 0,(function(){CrmIntelligence.crmUsagePieChart(untouchedRecCount,g)}))}var R=$("#diNotificationDetailCase1"),b=I[1]||0;if(b>0){var T=I18n.getMsg("crm.wf.di.unused.records.criteria",[I18n.getMsg(g)]);E={Module:u,UntouchedRecords:a.workFlowNotUsed.RecordsDetails},m=Handlebars.templates.DIRecordsDoesNotHaveAnyFollowup({Data:E,Heading:T,HeadingVsI18n:a.workFlowNotUsed.RecordsHeadings,HeadingAvailable:a.workFlowNotUsed.HeadingAvailability}),R.append(m)}var D=!1;a.workFlowNotUsed.RecordsDetails.length>0&&(D=!0),b>0&&!D&&R.append('<div class="m30 p30 aligncenter f18">'+I18n.getMsg("crm.wf.di.records.deleted.error.msg")+"</div>"),a.RuleNotUsedCount>0&&0==f.length&&$("#wfDiPoPForWorkflowRules").append('<div class="m15 p15 aligncenter f18">'+I18n.getMsg("crm.wf.di.wf.rule.deleted.error.msg")+"</div>")}else if(109==o){u=a.Module;var w=a.UntouchedRecords.length;if(w>0){g=a.PluralLevelName,T=I18n.getMsg("crm.wf.di.records.without.any.followup",[I18n.getMsg(g)]),m=Handlebars.templates.DIRecordsDoesNotHaveAnyFollowup({Data:a,Heading:T,HeadingVsI18n:a.RecordsHeadings,HeadingAvailable:a.HeadingAvailability,IsrecordSample:w});i.html(m)}else i.html('<div class="m30 p30 aligncenter f18">'+I18n.getMsg("crm.wf.di.records.deleted.error.msg")+"</div>")}else if(107===o||110===o){var M=new Date(a.ModifieyOn),S=a.IsDropped?"Drop":"Increased";if(i.html(Handlebars.templates.CrmWFUsageAfterModification({Data:a,ModifiedOn:M.toDateString(),DroppedOrIncreased:S})),!jQuery.isEmptyObject(a.CrtDetails)){var L=WFAuditLog.addCriteriaDetailsInfo(a.CrtDetails,!0);$("#diNotificationDetailsCase2CriteriaDetails").html(L)}}else 108!==o&&111!==o||showWFDetails108_111(a)}else if(201===o){var A=networkUtils.getI18nJSUrl("chatbot");networkUtils.loadFeatureScripts(["zcrm_chatbot_ZiaTemp.js","zcrm_chatbot_Zia.js",A],(function(){ziaRenderResult(a,$("#diNotificationDetailsContent"));var e=$("#dIchartTitle");e.text(a.name),e.removeClass("aligncenter").addClass("mB0")}))}else 501===o?showCompetitorAlertDetails(a,e,t):333===o?CrmIntelligence.showPredictionNotificationDetails(e,e.data("extrainfo").prediction_id):334===o?CrmIntelligence.showRecommendationNotificationDetails(e,e.data("extrainfo").recommendation_id):335===featureId&&CrmIntelligence.showRecommendationtypeNotifications(e)},error:function(){l.append("Notification Details Unavailable")}}),CrmIntelligence.showNotificationDetails(e,a,i,l))},getDefaultSuggestionTypeLabel:function(e){var t;switch(e){case"re_buy":t="rebuy";break;case"first_buy":t="firstbuy";break;case"next_buy":t="nextbuy";break;case"customer_also_bought":t="cwbab";break;case"frequently_bought_together":t="fbt"}return I18n.getMsg("crm.filter.label."+t)},showSimilarityNotifications:function(e){(e=$(e)).addClass("ziaNotificationClicked");var t=$(".clickedSection"),a=e.find(".ziaSeemorecontainer"),i=$("#diNotificationDetails"),n=e[0];t.addClass("alreadyClicked").removeClass("clickedSection"),e.removeClass("alreadyClicked").addClass("clickedSection"),a.show(),i.removeClass("p0");var r=networkUtils.returnDependencyFiles(["recommendation-similarity.css"],crmConstants.lessStaticPathForLyte),s=networkUtils.returnDependencyFiles(["recommendation-similarity-detailed.js","zia-error.js"],crmConstants.jsStaticPathForLyte),o=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("SimilarityRecommendation")],crmConstants.jsStaticPath),l=s.concat(r).concat(o),d={errorMsg:I18n.getMsg("zia.similarity.error.message")},c=n.associated_resources[0].resources[0].similarity_id;Lyte.injectResources(l,void 0,(function(){commonUtils.showHideLoadingDiv(!0),store.findRecord("similarity",c).then((function(e){if(!e||void 0===e[0]||!e[0].hasOwnProperty("module"))return commonUtils.showHideLoadingDiv(!1),void Lyte.Component.render("crm-zia-error",d,"#diNotificationDetailsContent");store.findRecord("module",e[0].module.id).then((function(t){var a={};a.similarity=e[0],a.module=t[0],a.similarity.module=a.module,a.isNotification=!0,$L("#dIchartTitle").hide(),commonUtils.showHideLoadingDiv(!1),Lyte.Component.render("crm-similarity-detailedview",a,"#diNotificationDetailsContent")}))}),(function(){commonUtils.showHideLoadingDiv(!1),Lyte.Component.render("crm-zia-error",d,"#diNotificationDetailsContent")}))}))},showRecommendationtypeNotifications:function(e){(e=$(e)).addClass("ziaNotificationClicked");var t=$(".clickedSection"),a=e.find(".ziaSeemorecontainer"),i=$("#diNotificationDetails"),n=e[0].recommendation_notifications;t.addClass("alreadyClicked").removeClass("clickedSection"),e.removeClass("alreadyClicked").addClass("clickedSection"),a.show(),i.removeClass("p0");var r=networkUtils.returnDependencyFiles(["recommendation-notification-list.css"],crmConstants.cssStaticPathForLyte),s=networkUtils.returnDependencyFiles(["recommendation-notification-list.js"],crmConstants.jsStaticPathForLyte),o=networkUtils.returnDependencyFiles(["zia-error.js"],crmConstants.jsStaticPathForLyte),l=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("recommendation")],crmConstants.jsStaticPath),d=s.concat(o).concat(r).concat(l),c=function(e,t,a,i){var n=-e.getTimezoneOffset(),r=n>=0?"+":"-",s=function(e){var t=Math.floor(Math.abs(e));return(t<10?"0":"")+t};return e.getFullYear()+"-"+s(e.getMonth()+1)+"-"+s(e.getDate())+"T"+s(t)+":"+s(a)+":"+s(i)+r+s(n/60)+":"+s(n%60)},m=null;if("re_buy"===n.suggestion_type_api_name){var u=parseInt(n.re_buy_date);m=[c(new Date(u),0,0,0),c(new Date(u),23,59,59)]}var v=store.peekRecord("module",n.whom_module_id),p=store.peekRecord("module",n.what_module_id),h=[n.suggestion_type,v.plural_label],g=I18n.getMsg("zia.recommendation.notification.list.title",h),C=n.recommendation_id,f=n.notification_id,E=v.api_name,I="/crm/v2.2/settings/zia/recommendations/"+C+"/notifications/"+f+"/notification_info";commonUtils.showHideLoadingDiv(!0);var y=store.findRecord("custom_view",v.cvid,{module:v.api_name}),R=store.findAll("field",{module:E}),b="/crm/v2/"+E,T={params:{ids:null}},D={},w=networkUtils.lyteInitiateRequest(I,"GET",{skip_load_tab:!0}),M="/crm/v2.2/settings/zia/recommendations/"+C+"/notifications/"+f,S=networkUtils.lyteInitiateRequest(M,"GET"),L=[];Promise.all([y,R,w,S]).then((function(e){if(void 0!==e[0]&&void 0!==e[0].fields&&void 0!==e[1]&&0!==e[1].length&&void 0!==e[2]&&void 0!==e[2].notification_info&&e[3]&&e[3].recommendation_notifications){for(var t=e[0].fields,a=e[1],i=t.length,r=a.length,s=0;s<i;s++)for(var o=0;o<r;o++)if(t[s].id===a[o].id){L.push(a[o]);break}var l=function(e,t){var a={comparator:"equal",value:e,field:{api_name:"Item_Id__s"}},i={comparator:"between",value:t,field:{api_name:"Bought_Date__s"}},r={api_name:"frequently_bought_together"===n.suggestion_type_api_name?"bundle_whom":"customer_also_bought"===n.suggestion_type_api_name?"cross_selling_whom":n.suggestion_type_api_name+"_whom"};return e?"re_buy"===n.suggestion_type_api_name?JSON.stringify([{include_objects:!0,relation:r,criteria:{group_operator:"and",group:[a,i]}}]):JSON.stringify([{include_objects:!0,relation:r,criteria:a}]):JSON.stringify([{include_objects:!0,relation:r,criteria:{comparator:"not_equal",value:"${EMPTY}",field:{api_name:"Item_Id__s"}}}])}(e[3].recommendation_notifications[0].selected_records,m),c=e[2].notification_info,u=c[0].whom_to.id;D[c[0].whom_to.id]=c[0].what_to;for(var h=c.length,C=1;C<h;C++)u=u+","+c[C].whom_to.id,D[c[C].whom_to.id]=c[C].what_to;T.params.ids=u,T.skip_load_tab=!0;var f=null;networkUtils.lyteInitiateRequest(b,"GET",T).then((function(e){if(void 0!==e){var t={};t.whatModule=!0===p.module_name.includes("CustomModule")?"CustomModule":p.api_name,t.whomModule=!0===v.module_name.includes("CustomModule")?"CustomModule":v.api_name;var a={module:JSON.stringify({whatModule:t.whatModule,whomModule:t.whomModule}),suggestion_type:n.suggestion_type_api_name};Crm.client_tracking("Zia Recommendation Notification ZiaPanelView",a),f=e.data,Lyte.injectResources(d,void 0,(function(){var e={query_params:{}};e.query_params.cross_filters=l,e.contentTitle=g,e.whomToVwhatTo=D,e.whomToRecords=f,e.whomToFields=L,e.whom_module=v,e.whatModuleSingularLabel=p.singular_label,$L("#dIchartTitle").hide(),commonUtils.showHideLoadingDiv(!1),Lyte.Component.render("crm-recommendation-notification-list",e,"#diNotificationDetailsContent")}))}else Lyte.injectResources(d,void 0,(function(){commonUtils.showHideLoadingDiv(!1),Lyte.Component.render("crm-zia-error",{},"#diNotificationDetailsContent")}))}),(function(){Lyte.injectResources(d,void 0,(function(){commonUtils.showHideLoadingDiv(!1),Lyte.Component.render("crm-zia-error",{},"#diNotificationDetailsContent")}))}))}else Lyte.injectResources(d,void 0,(function(){commonUtils.showHideLoadingDiv(!1),Lyte.Component.render("crm-zia-error",{},"#diNotificationDetailsContent")}))}),(function(){Lyte.injectResources(d,void 0,(function(){commonUtils.showHideLoadingDiv(!1),Lyte.Component.render("crm-zia-error",{},"#diNotificationDetailsContent")}))}))},showRecommendationNotificationDetails:function(e,t){(e=$(e)).addClass("ziaNotificationClicked");var a=$(".clickedSection"),i=e.find(".ziaSeemorecontainer"),n=$("#diNotificationDetails");t=t;a.addClass("alreadyClicked").removeClass("clickedSection"),e.removeClass("alreadyClicked").addClass("clickedSection"),i.show(),n.removeClass("p0");var r=networkUtils.returnDependencyFiles(["recommendation-detailed.css"],crmConstants.cssStaticPathForLyte),s=networkUtils.returnDependencyFiles(["recommendation-detailed.js","orchestration_config.js","zia-helpers.js"],crmConstants.jsStaticPathForLyte),o=networkUtils.returnDependencyFiles(["zia-error.js"],crmConstants.jsStaticPathForLyte),l=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("recommendation")],crmConstants.jsStaticPath),d=s.concat(r).concat(l).concat(o);Lyte.injectResources(d,void 0,(function(){Lyte.resolvePromises({recommendation:store.findRecord("recommendations",t)}).then((function(e){var t=e.recommendation;if(void 0!==t&&void 0!==t.id){var a=[],i=[],n=[];n.push(t.what_module.id),n.push(t.whom_module.id),n.push(t.based_module.id),n.forEach((function(e){var t=e;if(!a.contains(t)){a.push(t);var n=void 0===store.peekRecord("module",t).fields||0===store.peekRecord("module",t).fields.length?store.findRecord("module",t,void 0,void 0,void 0):store.peekRecord("module",t);i.push(n)}})),Lyte.resolvePromises({recommendationJson:t,prom1:Lyte.resolvePromises(i)}).then((function(e){var a={isNotification:!0,recommendationJson:e.recommendationJson,what_fields:t.what_module.fields,whom_fields:t.whom_module.fields,based_fields:t.based_module.fields,profilename:Crm.userDetails.PROFILE_NAME,records_count:networkUtils.lyteInitiateRequest("/crm/v2.2/settings/zia/recommendations/"+t.id+"/actions/record_count","GET",null)};$L("#dIchartTitle").hide(),Lyte.Component.render("crm-recommendation-detailedview",a,"#diNotificationDetailsContent")}))}else Lyte.Component.render("crm-zia-error",{},"#diNotificationDetailsContent")}),(function(){Lyte.Component.render("crm-zia-error",{},"#diNotificationDetailsContent")}))}))},showAnomalyDetails:function(e,t){$("#dIchartTitle").html(I18n.getMsg(e.title,[I18n.getMsg(e.title.split(" ")[0])])).show(),$("#wfDINotificationHeader").hide(),CrmDashboard.reprocessTrendAnalysisResponse(e),e.start=0,e.end=e.currentPeriodIndex?e.currentPeriodIndex+1:7,CrmDashboard.createTrendDashboardGraph("diNotificationDetailsContent",e,t)},showMacroSuggestion:function(e,t,a){var i,n=$(".clickedSection"),r=$("#diNotificationDetails"),s=t.hasClass("alreadyClicked"),o=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("macrosuggestion")],crmConstants.jsStaticPath),l=networkUtils.returnDependencyFiles(["macro-suggestion-components-zia.js"],crmConstants.jsStaticPathForLyte),d=networkUtils.returnDependencyFiles(["macro-suggestion-common.js"],crmConstants.jsStaticPathForLyte);i=!0===Crm.userDetails.RTL_ENABLED?networkUtils.returnDependencyFiles(["crm-macrosuggestions-listview-rtl.css","crm-macrosuggestions-listview.css"],crmConstants.cssStaticPathForLyte):networkUtils.returnDependencyFiles(["crm-macrosuggestions-listview.css"],crmConstants.cssStaticPathForLyte);var c=o.concat(l).concat(d).concat(i);Lyte.injectResources(c,void 0,(function(){store.findAll("macro_suggestion",{include_inner_details:"module.display_label,field_updates.field.field_label,field_updates.field.ui_type"}).then((function(i){CrmIntelligence.showNotificationDetails(t,n,r,a);var o=a,l={},d=[];$("#dIchartTitle").hide(),Crm.isZohoChartsEnabled?thirdPartyUtils.unbindZohoCharts(o):thirdPartyUtils.unbindHighcharts(o),commonUtils.showHideLoadingDiv(),i||(i=[]),i.length<=0&&CrmIntelligence.removeNotification(e);for(var c=i,m=c.length,u=0;u<m;u++){var v=c[u];v.macroName="",v.isMacroNameValid=!1,v.savErrorMsg="";var p=v.created_on.split("-"),h=parseInt(p[0]),g=parseInt(p[1])-1,C=parseInt(p[2]),f=CrmIntelligence.processDateString(new Date(h,g,C),!0);v.displaydate=f;var E=l[f];d.indexOf(f)<0&&(d.push(f),E=[],l[f]=E),E.push(v)}Lyte.Component.render("crm-macrosuggestions-zia",{dateWiseArr:l},"#diNotificationDetailsContent"),!s&&i.length>0&&CrmIntelligence.setNotificationAsSeen(e)}),(function(){commonUtils.showHideLoadingDiv(),crmui.showMsgBand("error",I18n.getMsg("crm.security.error.add.user"),1500),a.append("Notification Details Unavailable")}))}))},showWFDetails108_111:function(e){var t=e.TemplateOpenInfoOnModified,a=t.OpenedBeforeModification,i=t.DeliveredBeforeModification,n=t.BouncedBeforeModification,r=i+n,s=t.ClickedBeforeModification,o=t.OpenedAfterModification,l=t.DeliveredAfterModification,d=t.BouncedAfterModification,c=l+d,m=t.ClickedAfterModification,u=r>c,v=r>c?CrmIntelligence.findPercentage(r,r-c):CrmIntelligence.findPercentage(c,c-r),p=CrmIntelligence.findPercentage(r,i),h=CrmIntelligence.findPercentage(c,l),g=CrmIntelligence.findPercentage(i,a),C=CrmIntelligence.findPercentage(l,o),f=CrmIntelligence.findPercentage(a,s),E=CrmIntelligence.findPercentage(o,m);e.WFOrTemplate=I18n.getMsg(e.WFOrTemplate);var I=e.IsDrop?"Drop":"Increased",y=new Date(e.ModifieyOn),R=[{bCount1:r,aCount1:c,Name1:I18n.getMsg("Sent"),IsDropped:u,Per:v},{Name1:I18n.getMsg("Delivered"),Name2:I18n.getMsg("Bounced"),bCount1:i,bPer1:p,bCount2:n,bPer2:r>0?100-p:0,aCount1:l,aPer1:h,aCount2:d,aPer2:c>0?100-h:0},{Name1:I18n.getMsg("Opened"),Name2:I18n.getMsg("crm.templatestats.label.unopened"),bCount1:a,bPer1:g,bCount2:i-a,bPer2:i>0?100-g:0,aCount1:o,aPer1:C,aCount2:l-o,aPer2:l>0?100-C:0,IsDropped:e.IsDrop,Per:e.LessUsgePercentage},{Name1:I18n.getMsg("Clicked"),bCount1:s,bPer1:f,aCount1:m,aPer1:E}];if($objCont.html(Handlebars.templates.CrmTemplateOpenRateAfterModification({Data:R,Result:e,DroppedOrIncreased:I,ModifiedOn:y.toDateString()})),CrmIntelligence.matchWidthinDiffTable(),CrmIntelligence.matchWidthinDiffTableForSecond(),!jQuery.isEmptyObject(e.CrtDetails)){var b=WFAuditLog.addCriteriaDetailsInfo(e.CrtDetails,!0);$("#diNotificationDetailsCase2CriteriaDetails").html(b)}},showCompetitorAlertDetails:function(e,t,a){var i=networkUtils.returnDependencyFiles(["crm-competitor-mention-list.js","crm-competitors-utilities.js"],crmConstants.jsStaticPathForLyte),n=networkUtils.returnDependencyFiles(["crm-competitor-mention-list.css"],crmConstants.cssStaticPathForLyte);Lyte.injectResources(i.concat(n),void 0,(function(){var t={notificationObjs:[{id:a,from:"di-notification",metadata:e.metadata,signal:{namespace:crmNTC.MAIL_INCOMING_COMPETITORS_ALERT,display_label:crmNTC.MAIL_INCOMING_COMPETITORS_ALERT,extension:{namespace:crmNTC.EXT_EMAILTRACKING,display_label:I18n.getMsg(crmNTC.EXT_EMAILTRACKING)}},date:e.date}]};$L("#diNotificationDetailsContent").html(Handlebars.templates.signalDetailViewTemplate(t)),t={notificationObj:t.notificationObjs[0],entityObj:e.entity_info},$L("#ntc-detailv-content-"+a).html(Handlebars.templates.signalEmailDetailView(t)),$L("#dIchartTitle").hide()})),CrmIntelligence.notificationDetailJson=e},showPredictionNotificationDetails:function(e,t){commonUtils.showHideLoadingDiv(!0),(e=$(e)).addClass("ziaNotificationClicked");var a=$(".clickedSection"),i=e.find(".ziaSeemorecontainer"),n=$("#diNotificationDetails");a.addClass("alreadyClicked"),a.removeClass("clickedSection"),e.removeClass("alreadyClicked").addClass("clickedSection"),i.show(),n.removeClass("p0");var r=networkUtils.returnDependencyFiles(["prediction.js"],crmConstants.jsStaticPathForLyte),s=networkUtils.returnDependencyFiles(["zia-error.js"],crmConstants.jsStaticPathForLyte),o=networkUtils.returnDependencyFiles(["prediction-mixins.js"],crmConstants.jsStaticPathForLyte);o=o.concat(networkUtils.returnDependencyFiles(["zia-commons.js"],crmConstants.jsStaticPathForLyte));var l=networkUtils.returnDependencyFiles(["prediction.css","crm-zia-error.css"],crmConstants.cssStaticPathForLyte),d=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("prediction")],crmConstants.jsStaticPath),c=r.concat(s).concat(o).concat(l).concat(d);Lyte.injectResources(c,void 0,(function(){Lyte.resolvePromises({prediction:store.findRecord("prediction",t)}).then((function(e){var a=e.prediction[0];void 0!==a?Lyte.resolvePromises({module:store.findRecord("module",a.module.id),consent_module:void 0!==moduleRecordMapping.Consents&&Crm.userDetails.privacyPrefEnabledModules.contains(a.module.module_name)?store.findRecord("module",moduleRecordMapping.Consents.id,void 0,void 0,void 0,{getFields:!0}):void 0,unused_fields:store.findAll("field",{module:a.module.api_name,type:"Unused"}),prediction_meta:store.findRecord("dummy",t,{},void 0,!1,{url:"crm/v2.2/settings/zia/predictions/"+t+"/models"})}).then((function(e){commonUtils.showHideLoadingDiv(!1),e.unused_fields.map((function(e){e.unused=!0})),Lyte.registeredMixins["crm-prediction-route-utils"].processPredictionMeta(a,{meta:e.prediction_meta.models[0]}).then((function(e){Lyte.Component.render("crm-prediction-view",e,"#diNotificationDetailsContent")})),$L("#dIchartTitle").hide()})):(commonUtils.showHideLoadingDiv(!1),Lyte.Component.render("crm-zia-error",{},"#diNotificationDetailsContent"))}),(function(){commonUtils.showHideLoadingDiv(!1),Lyte.Component.render("crm-zia-error",{},"#diNotificationDetailsContent")}))}))},setNotificationAsSeen:function(e){var t={action:"setseen",id:e};t[csrfParamName]=csrfToken,(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/crminotification.do",type:"POST",data:t})},removeNotification:function(e){var t=new crmRequestPool,a={action:"ignoreNotification",id:e};a[csrfParamName]=csrfToken,t.initiate({action:Crm.getCrmBasePath()+"/crminotification.do",type:"POST",data:a})},requestAnalyticsData:function(e,t,a,i){$("#dIchartTitle").removeClass().addClass("widgetHeading").html(a),e.append(Handlebars.templates.AnalyticsNotificationLayout({component_id:t,component_name:a,dashboard_id:i}));var n=networkUtils.returnDependencyFiles(["crm-analytics.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles(["crm-analytics.css"],crmConstants.cssStaticPathForLyte);Crm.userDetails.RTL_ENABLED&&(r=r.concat(networkUtils.returnDependencyFiles(["crm-analytics-rtl.css"],crmConstants.cssStaticPathForLyte)));var s=[n,r];Lyte.injectResources([s],void 0,(function(){if(void 0===CrmAnalytics.isNewAnomalyNotificationEnabled){CrmAnalytics.getApiData("/crm/v2/__internal/Analytics/actions/new_anomaly_notification",crmConstants.requestMethods.GET,(function(e){CrmAnalytics.isNewAnomalyNotificationEnabled=e.new_anomaly_notification.enabled,CrmAnalytics.loadComponentData(t,i,void 0,void 0,!1,!0)}))}else CrmAnalytics.loadComponentData(t,i,void 0,void 0,!1,!0)}))},showNotificationDetails:function(e,t,a,i){a.find(".jarvisClosebtn").show(),$L("#dIchartTitle").show(),$(".jarvisFreeze").show().addClass("showFreeze"),$L("body").addClass("oH"),t.addClass("alreadyClicked"),t.removeClass("clickedSection"),e.removeClass("alreadyClicked").addClass("clickedSection");var n=0;a.is(":visible")||(a.css({display:"inline-block"}),clearTimeout(n),n=setTimeout((function(){var t=201==parseInt(e.data("featureid"))?"400px":"900px";a.css({right:"437px",width:t})}),30)),i.empty()},closeDINotificationDetails:function(){var e=$(".clickedSection"),t=$("#diNotificationDetails");$L(".ziaNotificationClicked").removeClass("ziaNotificationClicked"),$("#diNotificationDetailsContent").empty(),t.removeClass("p0"),$("#dIchartTitle").removeClass("hide"),hideFreezeLayer();var a=$(".jarvisFreeze");a.removeClass("showFreeze").hide(),$L("body").removeClass("oH"),a.removeAttr("onclick"),a.off("click").attr("onclick","javascript:sE(event);"),a.off(),e.addClass("alreadyClicked"),e.removeClass("clickedSection"),t.css({right:"-900px"}),t.bind("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",(function(){var e=$(this);e.hide(),e.off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend")})),delete CrmIntelligence.notificationDetailJson},fromFooter:function(e){var t=(e=$(e)).outerHeight();0!=CrmIntelligence.cFlag?(e.css({bottom:"-"+t+"px"}),e.show().css({bottom:"26px"})):(crmui.fromFooter("diNotificationDiv"),CrmIntelligence.cFlag=1)},toFooter:function(e){var t=(e=$(e)).outerHeight();e.css({bottom:"-"+t+"px"}),e.bind("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",(function(){var e=$(this);e.hide(),$("#diNotificationDiv").html(""),e.off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend")}))},sliderCreation:function(e,t,a){a=a.toString();var i=$(".dateSlider."+a);i.slider({range:!0,min:0,max:30,values:[CrmDashboard.trendDBOptionsJSON.startsteps,CrmDashboard.trendDBOptionsJSON.endsteps],slide:function(e,t){$("#amount").text("$"+t.values[0]+" - $"+t.values[1])},change:function(e,t){CrmDashboard.trendDBDateRangeChange(a,t.values[0],t.values[1])}});var n=100/30,r=0,s=15,o=0;if(!i.find(".tickPar").length){for(var l={name:"div",attr:{class:"w100p fL cB ui-slider-labels tickPar"},child:[]},d=0;d<=30;d++){s<0&&(s=1,o=1);var c=null;0==s?c={name:"div",attr:{class:"pointTodayTickDiv"},css:{left:n*r+"%"}}:(c={name:"div",attr:{class:"ui-slider-label-ticks"},css:{left:n*r+"%"}}).child=[{name:"span",html:""}],l.child[d-0]=c,r+=1,0==o?s-=1:s+=1}i.append(renderingUtils.createHTML(l));var m=i.children();m.eq(1).attr("id","slideStart_"+a),m.eq(2).attr("id","slideEnd_"+a)}},slider:function(e,t){t=t.toString(),CrmDashboard.setTrendDashboardFilters(t),$(".diUserListContainerData,.dIMonthRelatedDropdownUl").hide(),$(".custom.dateFilter."+t).hasClass("selected")||$(".dIDateRangeinInputCont").hide(),$(e).parents(".dIDateRangeContainer").find(".diUserSettingContainerData").fadeIn(200),CrmIntelligence.addActiveBorder(e)},showDateToolTip:function(e){$(e).find(".thisisNewTool").show(),$(".TeamSettingDiv,.TeamSettingDivSub").hide();var t=CrmDashboard.trendDBOptionsJSON.startsteps,a=CrmDashboard.trendDBOptionsJSON.endsteps,i=13-CrmDashboard.trendDBDateRange.length,n=i<t?t-i:0,r=i<=a?a-i:0;$("#trendDBStartDate").text(CrmDashboard.trendDBDateRange[n]),$("#trendDBEndDate").text(CrmDashboard.trendDBDateRange[r]),Crm.trackSpotLightAction("AI Trend DashBoard - Period Menu Click")},showTeamViewPop:function(e){e=$(e);var t=$(".TeamSettingDiv"),a=$(".titPanner"),i=a.offset().top+a.outerHeight()+2,n=e.offset().left-3;if(parseInt(n)+t.outerWidth()>=renderingUtils.windowWidth){n=e.offset().left-(parseInt(n)+t.outerWidth())-renderingUtils.windowWidth-20;t.css({top:i,left:n}).show().css({opacity:"1"})}else t.css({top:i,left:n}).show().css({opacity:"1"});$(".thisisNewTool").hide(),Crm.trackSpotLightAction("AI Trend DashBoard - Team View Click")},showSubSettingList:function(e,t){e=$(e);var a=$(".titPanner"),i=$(".TeamSettingDivSub");if(t)i.hide(),$(".TeamSettingDiv").hide();else{var n=a.offset().top+a.outerHeight()+2,r=e.parent().offset().left-i.outerWidth()-27,s=renderingUtils.windowHeight-($("#DashboardHeadingDiv").outerHeight()+$("#tabLayer").outerHeight()+$("#wmstoolbar").outerHeight());i.css({"max-height":s,top:n,left:r}).show().css("opacity",1),$(".crmUserListDiv").css({"max-height":s-140}),$(".viewSelected").removeClass("viewSelected"),e.parents("li").addClass("viewSelected")}},disableResizableandFixWidth:function(){var e=$("#dashboardItemsSort"),t=$("#dashboard-leftpanel").outerWidth(),a=$(".crmTrendDashBoard").find(".dashBrdContent");a.eq(0).hasClass("ui-resizable")&&a.resizable("destroy"),e.hasClass("ui-sortable")&&e.sortable("destroy"),a.removeClass("mR30").removeClass("mB30").addClass("mB20").addClass("pR30 pL30");var i=renderingUtils.windowWidth-t-40;a.css({width:i}),a.find(".sortClass").addClass("cD")},inputSearchUser:function(e){var t=$(e).val(),a=$(e).parents(".diUserListContainerData").find(".dIUserListScrollContainer ul").attr("id").split("_")[1],i=CrmDashboard.trendDashboardObj[a],n=$(e).parents(".diUserListContainerData"),r=n.find(".dIUserListScrollContainer");(r.find("ul").html(""),""==t)?($(e).parents().find(".diUserListContainerData").find(".selectAllUser").removeClass("hide"),n.find(".diAllCheckBoxContainerSection").show(),CrmDashboard.trendDashboardObj[a].filters.searchList=[],CrmDashboard.trendDashboardObj[a].dashboardUserOrGroupCount=0):(n.find(".diAllCheckBoxContainerSection .noneSelected").length>0?n.find(".diAllCheckBoxContainerSection").hide():n.find(".diAllCheckBoxContainerSection").show(),i.dashboardUserOrGroupCount=0);var s=CrmDashboard.trendDashboardObj[a].filters.selected.group,o=$.extend(!0,[],s?CrmDashboard.trendDBGroupList:CrmDashboard.trendDBUserList),l=[];CrmDashboard.trendDashboardObj[a].filters.searchList=l,o.each((function(e){-1!=e.name.toUpperCase().search(t.toUpperCase())&&l.push(e)})),CrmIntelligence.diScrollOrSearchInitiated(r.find("ul"))},showWorkflowUnused:function(){var e=$(".popforWorkflowAction"),t=$("#diNotificationDetails"),a=(t.offset().top+t.outerHeight())/2-$("#popforWorkflowAction").outerHeight()/2;e.css({top:a,left:0,right:0,margin:"0 auto"}).show(),$(".freezwhite").show()},hidePop:function(e){$(e).hide(),$(".popforWorkflowAction").hide()},crmUsagePieChart:function(e,t){var a=e[9]||0,i=e[2]||0,n=e[1]||0,r=e[4]||0;$(".chartC").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},credits:{enabled:!1},tooltip:{enabled:!0,useHtml:!0,formatter:function(){return"<div class='fL cB mB3 crm-font-regular' style='font-size:14px'>"+this.key+" - "+this.y+"</div><div class='fL cB crm-font-bold bold' style='font-size:14px'>"+this.percentage.toFixed(1)+" %</div>"},pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1},showInLegend:!0,center:[90,90]}},legend:{floating:!0,align:"left",verticalAlign:"middle",useHTML:!0,layout:"vertical",labelFormatter:function(){return 0==this.index?'<div class="crm-font-regular dIB labelLegendForm" onclick="sE(event)" >'+this.name+' - <span class="crm-font-regular pR color333 removehovele">'+this.y+'</span><span class="dIB wfInfoIconDet cP" onmouseover="crmui.showTooltip(\''+I18n.getMsg("crm.wf.di.notification.import.info")+"',false,'center',this)\" onmouseout=crmui.hideTooltip()></span></div>":1==this.index?'<div class="crm-font-regular dIB labelLegendForm" onclick="sE(event)" >'+this.name+' - <span class="crm-font-regular pR color333 removehovele">'+this.y+'</span><span class="dIB wfInfoIconDet cP" onmouseover="crmui.showTooltip(\''+I18n.getMsg("crm.wf.di.notification.api.info")+"',false,'center',this)\" onmouseout=crmui.hideTooltip()></span></div>":'<div class="crm-font-regular dIB labelLegendForm" onclick="sE(event)" >'+this.name+' - <span class="crm-font-regular pR color333 removehovele">'+this.y+"</span></div>"},itemMarginTop:5,itemMarginBottom:10,x:240,symbolRadius:4,symbolHeight:20,borderWidth:0,symbolWidth:20,shadow:!1},series:[{name:"Brands",colorByPoint:!0,data:[{name:I18n.getMsg("crm.wf.di.unused.records.import",[I18n.getMsg(t)]),y:a,color:"#52519e"},{name:I18n.getMsg("crm.wf.di.unused.records.api",[I18n.getMsg(t)]),y:i,sliced:!1,selected:!1,color:"#1cadda"},{name:I18n.getMsg("crm.wf.di.unused.records.other",[I18n.getMsg(t)]),y:r,color:"#1e4f2e"},{name:I18n.getMsg("crm.wf.di.unused.records.criteria",[I18n.getMsg(t)]),y:n,color:"#ee5b2e"}]}]},(function(e){for(var t=[$(".chartC .highcharts-legend-item .labelLegendForm"),$(".chartC .labellegentNum"),$(".chartC .highcharts-legend .highcharts-legend-item"),$(".chartC .highcharts-legend-item span")],a=t.length,i=0;i<a;i++)CrmIntelligence.removeLegendHoverAnimationPieChart(t[i],e)}))},removeLegendHoverAnimationPieChart:function(e,t){$(e).each((function(e,a){$(a).hover((function(){return $(a).parent().css("cursor","default"),!1}),(function(){t.tooltip.hide()}))}))},crmUsagePieChartZCharts:function(e,t){var a=e[9]||0,i=e[2]||0,n=e[1]||0,r=e[4]||0,s=$(".chartC");s.empty();var o={legend:{layout:"vertical",colors:["#52519e","#1cadda","#1e4f2e","#ee5b2e"],vAlign:"center",hAlign:"right",showAs:"{{val(0)}} - {{val(1)}}",marginLeft:0,marginRight:75,maxWidth:"70%",fontSize:14,fontWeight:"bolder",itemHeight:25,highlightEffect:{selectedSeries:"illuminate"},colorBox:{strokeWidth:10},textPadding:15},tooltip:{backgroundColor:"#FFFFFF",fontColor:"#333333",borderRadius:1,opacity:1,maxWidth:"100%",borderWidth:"2"},chart:{plot:{plotoptions:{pie:{outerPadding:15,maxRadius:105}}},marginLeft:0},metadata:{axes:{x:[0],y:[[1]],tooltip:["<div class='p10'><div class='fL cB mB3 crm-font-regular' style='font-size:14px'>{{val(0)}} -  {{val(1)}} </div><div class='fL cB mB3 crm-font-bold bold' style='font-size:14px'>{{per(1)}}</div></div>"]},columns:[{dataindex:0,columnname:"Year(Date)",datatype:"ordinal"},{dataindex:1,columnname:"Sum(Sales)",datatype:"numeric"}]},seriesdata:{chartdata:[{type:"pie",data:[[[I18n.getMsg("crm.wf.di.unused.records.import",[I18n.getMsg(t)]),a],[I18n.getMsg("crm.wf.di.unused.records.api",[I18n.getMsg(t)]),i],[I18n.getMsg("crm.wf.di.unused.records.other",[I18n.getMsg(t)]),r],[I18n.getMsg("crm.wf.di.unused.records.criteria",[I18n.getMsg(t)]),n]]]}]},canvas:{shadow:{show:!1},title:{show:!1},subtitle:{show:!1},border:{show:!1},fontColor:"#000000",background:{color:null}}};CrmChartUtil.renderChart(s[0],o,!0)},showAllRecSecthis:function(e){$(".thirdModificationDifTable").css({"background-color":"#fff"}),$(e).hide(),$(".thirdTabModBody").fadeOut(100,(function(){$(".thirdTabMobBodyDetailed").fadeIn(200)}))},findPercentage:function(e,t){var a=0;return e>0&&(a=100*t/e),Math.floor(a)},nextArrowPress:function(e,t){CrmDashboard.slideGraph(e,0==t?-10:10)},convertToIntArray:function(e){for(var t=[],a=e.length,i=0;i<a;i++)t.push(Math.round(e[i]));return t},convertToPositiveArray:function(e){for(var t=[],a=e.length,i=0;i<a;i++)t.push(e[i]<0?0:e[i]);return t},getReadableDate:function(e,t){var a=e.getFullYear(),i=e.getMonth(),n=e.getDate(),r=I18n.getMsg(CrmIntelligence.monthShortNames[i]),s=(new Date(a,i,1).getDay()+6)%7,o=Math.ceil((e.getDate()+s)/7),l=null;switch(t){case"day":l=n+" "+r+" "+a;break;case"week":switch(o){case 1:l=I18n.getMsg("crm.emailstats.firstweek",[r])+" "+a;break;case 2:l=I18n.getMsg("crm.emailstats.secondweek",[r])+" "+a;break;case 3:l=I18n.getMsg("crm.emailstats.thirdweek",[r])+" "+a;break;case 4:l=I18n.getMsg("crm.emailstats.fourthweek",[r])+" "+a;break;case 5:l=I18n.getMsg("crm.emailstats.fifthweek",[r])+" "+a;break;case 6:l=I18n.getMsg("crm.emailstats.sixthweek",[r])+" "+a}break;case"month":l=r+" "+a.toString();break;case"year":l=a.toString()}return l},showDateChangeDropdown:function(e,t){if(e=e.toString(),$(t).prev().text($(t).val()),$(t).addClass("valAddedInField"),$(t).parent().hasClass("startDate")){var a=$(t).val(),i=$(".customPeriod.endDate."+e+" input"),n=i.val();null!=n&&""!=n.trim()&&(a=crmCalendar.getDateObjectFromGivenDateString(a),n=crmCalendar.getDateObjectFromGivenDateString(n),a.getTime()>=n.getTime()&&(a.setDate(a.getDate()+1),i.val(crmCalendar.convertToUserDatePattern(a.getDate()+" "+a.getMonth()+" "+a.getFullYear())),i.trigger("click")))}},calendarUpd:function(e,t,a){var i=$(e).val();CrmIntelligence.inc=0,1==a?(CrmIntelligence.inc=i,crmCalendar.updateDatePicker(t,void 0,1,void 0,1)):(CrmIntelligence.inc=i-1,crmCalendar.updateDatePicker(t,1,void 0,void 0,1)),crmCalendar.updateDatePicker(t)},getPeriodEndDate:function(e,t){var a=e.split("-"),i=new Date;switch(t){case"year":i.setFullYear(parseInt(a[0])+1,0,0);break;case"month":i.setFullYear(parseInt(a[0]),parseInt(a[1]),0);break;case"week":i.setFullYear(parseInt(a[0]),parseInt(a[1])-1,parseInt(a[2])+6)}return CrmIntelligence.convertDateObjectToString(i)},convertDateObjectToString:function(e){var t=e.getMonth()+1,a=e.getDate();return e.getFullYear()+"-"+(t<10?"0":"")+t+"-"+(a<10?"0":"")+a},closeSettingContainer:function(){$(".dIDateRangeinInputCont").css({bottom:"-400px"}).hide(),$(".dIRangeFreeze").hide(),$(".diUserSettingContainerData").hide(),$("#Calendar").hide(),$(".dIactiveBorder").removeClass("dIactiveBorder")},calendarDropAppend:function(){if($(".crmTrendDashBoard").length){for(var e=(new Date).getFullYear(),t=[],a=e-5;a<=e;a++)t.push(a);var i,n,r=Handlebars.templates.CalendarMonthFilter({months:CrmIntelligence.monthFullNames}),s=Handlebars.templates.CalendarYearFilter({years:t}),o=$(".sCalMon");o.text(""),$("#calendarMonthid").length||(o.append(r),i=$("#calendarMonthid")),$("#calendarYearid").length||(o.append(s),n=$("#calendarYearid"));var l=CrmIntelligence.monthFullNames[crmCalendar.currMonth],d=crmCalendar.currYear;i.find("option.month_"+l).attr("selected",!0),n.find("option.year_"+d).attr("selected",!0)}},showFilterCalendar:function(e,t,a){a=a.toString();var i=$(t).parent().hasClass("startDate"),n=new Date;if(i){var r="1,1,"+(n.getFullYear()-5);n=n.getMonth()+1+","+n.getDate()+","+n.getFullYear(),crmCalendar.showCalendar(e,t,void 0,void 0,void 0,void 0,r,n)}else{r=$(".customPeriod.startDate."+a+" input").val();(r=crmCalendar.getDateObjectFromGivenDateString(r)).setDate(r.getDate()+1),r=r.getMonth()+1+","+r.getDate()+","+r.getFullYear(),n=n.getMonth()+1+","+n.getDate()+","+n.getFullYear(),crmCalendar.showCalendar(e,t,void 0,void 0,void 0,void 0,r,n)}},showUserContainer:function(e){$(".diUserSettingContainerData").hide(),$(e).find(".diUserListContainerData").fadeToggle(200),$(e).find(".selectAllUser").show(),CrmIntelligence.addActiveBorder(e)},addActiveBorder:function(e){var t=$(e),a=$(".diUserSettingContainerData"),i=$(".diUserListContainerData"),n=t.find("select"),r=t.parents(".crmTrendDashBoard"),s=t.parents(".dashBrdContent"),o=r.outerHeight()-40,l=s.position().top+r.scrollTop(),d=a.outerHeight()+s.position().top,c=i.outerHeight()+s.position().top;$(".dIactiveBorder").removeClass("dIactiveBorder"),t.hasClass("trendDBRowSectionDate")&&(a.hide(),i.hide(),n.on("select2:close",(function(){$(".dIactiveBorder").removeClass("dIactiveBorder")}))),t.addClass("dIactiveBorder"),$(".select2-container").find(".select2-dropdown").addClass("addselect2Arrow"),t.hasClass("dISubModuleconta")?d>o&&r[0].scroll({top:l-30,behavior:"smooth"}):t.hasClass("dIUserListContainer")&&c>o&&r[0].scroll({top:l-30,behavior:"smooth"}),t.hasClass("trendDBRowSectionDate")&&(n.on("select2:open",(function(){$(this).addClass("remHidToolTip"),crmui.hideTooltip()})),n.on("select2:close",(function(){$(this).removeClass("remHidToolTip"),crmui.hideTooltip()})))},displayTooltipPlotLines:function(e,t,a){var i=$(t.target).parents(".dashBrdContent").find(".tooltiptext");i.hide(),i.text(I18n.getMsg("Today")),i.show(),i.css({left:parseInt(parseInt(a)+17)})},scrolltoBottomShadow:function(e){$(e).scrollTop()>10?$("#DashboardHeadingDiv").addClass("dashbtmshad"):$("#DashboardHeadingDiv").removeClass("dashbtmshad")},showTodayDrop:function(e){$("#Calendar").hide(),$(e).parents(".dIDateRangeContainerUlLi").find("li").removeClass("selected"),$(e).addClass("selected"),"custom"==$(e).attr("datetype")?($(".dIRangeFreeze").show(),$(e).parents(".diUserSettingSubContainer").find(".dIDateRangeinInputCont").fadeIn(200)):$(e).parents(".diUserSettingSubContainer").find(".dIDateRangeinInputCont").fadeOut(200),"LI"==$(e)[0].tagName&&$(e).find("input").focus()},areArraysEqual:function(e,t){var a=!1,i=e.length;if(i==t.length){a=!0;for(var n=0;n<i;n++)if(-1==t.indexOf(e[n])){a=!1;break}}return a},areObjectsEqual:function(e,t){var a=Object.keys(e),i=a.length,n=!1;if(i==Object.keys(t).length){n=!0;for(var r=0;r<i;r++)if(!t.hasOwnProperty(a[r])||e[a[r]]!=t[a[r]]){n=!1;break}}return n},getDayDifferenceFromDateStr:function(e,t,a){var i=crmCalendar.getDateObjectFromGivenDateString(e,a),n=crmCalendar.getDateObjectFromGivenDateString(t,a);return CrmIntelligence.getDayDifference(i,n)},getDayDifference:function(e,t){var a=e.getTime();return(t.getTime()-a)/864e5},getAllowedPeriods:function(e){var t=[];return e>0&&e<=99?t=[0,1]:e>99&&e<=693?t=[1,2]:e>693&&e<=2970?t=[2,3]:e>2970&&(t=[3]),t},diUserListScrollAddShad:function(e){var t=$(e).parents(".diUserListContainerData").find(".diUserListActContainer");$(e).scrollTop()>30?t.addClass("setShadow"):t.removeClass("setShadow"),$(e).scrollTop()+$(e).outerHeight()>=e.scrollHeight&&CrmIntelligence.diScrollOrSearchInitiated($(e).find("ul"))},diScrollOrSearchInitiated:function(e){var t,a,i=$(e).attr("id").split("_")[1],n=$("#trendDBUserList_"+i),r=CrmDashboard.trendDashboardObj[i];if(""==$(e).parents(".diUserListContainerData").find(".trendDBUserSearch").val()?(t=CrmDashboard.trendDashboardObj[i].filters.selected.group,a=$.extend(!0,[],t?CrmDashboard.trendDBGroupList:CrmDashboard.trendDBUserList)):a=CrmDashboard.trendDashboardObj[i].filters.searchList,a.length>r.dashboardUserOrGroupCount){var s=a.slice(r.dashboardUserOrGroupCount,r.dashboardUserOrGroupCount+10);n.append(Handlebars.templates.TrendDashboardUserList({dbItemId:i,userlist:s})),CrmDashboard.checkSelectedIds(i),r.dashboardUserOrGroupCount=r.dashboardUserOrGroupCount+10}},hideOtherpops:function(){$(".dIuserOpenChange").hide()}},Events={isSlimScrollEnabled:-1==navigator.userAgent.indexOf("Mac OS X"),reminderNotificationImgUrl:networkUtils.getImageUrl("event_reminder_feed_chrome_ac1ff70_.png",ResourceConstants.CRM),cloneEntId:void 0,reminderNotificationEnabled:!0,viewInviteeReqSent:!1,quickViewEv:void 0,callStartTime:new Date,viewInviteeRecordAvailable:!1,inviteesViewPageNo:0,loadedInvIds:[],lastLoadedType:"3",invPreparedPageCnt:0,currentEventObjectInQV:void 0,currentQuickViewId:void 0,eventNoteReqSent:!1,isLinksModified:!1,isPageLayoutModified:!1,formRuleModified:!1,moduleName:"Events",currentStatus:void 0,createSource:void 0,relatedToSelectBox:void 0,currentEventObjectInView:void 0,addMoreDetailsClicked:void 0,invAddLinkClicked:!1,calScrollYval:0,whatIdModulesArr:[],scrollOnSetHTML:!1,reqInvRecAvail:{t:!1,u:!1,l:!1,c:!1,lv:!1,cv:!1,g:!1,r:!1,rs:!1},isAddInvReqSent:!1,addInvPageCnt:{t:0,u:0,l:0,c:0,lv:0,cv:0,g:0,r:0,rs:0,rc:0},invJsonCreate:{t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},invDelListCreate:{t:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},invRemoveJson:{t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},invAddJson:{t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},meetingToolNameObj:{JOINME_MEETING:"JoinMeMeeting",GOTO_MEETING:"GoToMeeting",ZOHO_MEETING:"ZohoMeeting",TEAMV_MEETING:"TeamVMeeting",ZOOM_MEETING:"ZoomMeeting",BLUEJEANS_MEETING:"BlueJeansMeeting",WEBEX_MEETING:"WebexMeeting",RINGCENTRAL_MEETING:"RingCentralMeeting",CLICK_MEETING:"ClickMeeting",MEGA_MEETING:"MegaMeeting",STARLEAF_MEETING:"StarLeafMeeting",RCVIDEOMEETING:"RCVideoMeeting"},displayToolName:{GoToMeeting:"GoToMeeting",ZohoMeeting:"Zoho Meeting",JoinMeMeeting:"Join.Me",TeamVMeeting:"TeamViewer",ZoomMeeting:"Zoom",BlueJeansMeeting:"BlueJeans",WebexMeeting:"Cisco Webex",RingCentralMeeting:"Ring Central",ClickMeeting:"Click Meeting",MegaMeeting:"Mega Meeting",StarLeafMeeting:"StarLeaf",RCVideoMeeting:"RingCentral Video"},meetingTitleLength:{JoinMeMeeting:100,GoToMeeting:255,ZoomMeeting:200,TeamVMeeting:255,ZohoMeeting:255,BlueJeansMeeting:255,WebexMeeting:128,RingCentralMeeting:200,ClickMeeting:200,MegaMeeting:255,StarLeafMeeting:255,RCVideoMeeting:255},showMeetingAuthorizeHelpIcon:["MegaMeeting","ClickMeeting"],meetingLoginPopupField:{siteName:["WebexMeeting","MegaMeeting"],userName:["WebexMeeting","MegaMeeting","ClickMeeting","StarLeafMeeting"],password:["WebexMeeting","StarLeafMeeting"]},selInvPageCnt:0,selInviteesCnt:0,selInvPagerecAvail:!0,selInvPagereqSent:!1,selInvlinkClicked:!1,isCVSelected:!1,isViaCopyPaste:!1,addInvEmailsList:{},removeInvEmailsList:{},isRecurringEditAvail:!1,evtWidfor15Mins:39,tilePageNo:0,isAllUsersLoaded:!1,isUsersLoadReqSent:!1,totalUsersCount:0,isRecEvent:!1,recCntIdsArr:{add:{l:{},c:{},t:{},lv:{},cv:{},g:{},r:{},rs:{},u:{}},remove:{l:{},c:{},t:{},lv:{},cv:{},g:{},r:{},rs:{},u:{}}},modifyingEvent:void 0,selectedCVId:void 0,timeEntryAdded:!1,tileLoadingUserId:"",monthStartDate:null,monthEndDate:null,weekStartDate:null,weekEndDate:null,userImgSrc:null,prevTempObj:null,calHTML:"",srchVal:"",mouseStillDown:!1,multiUserCalMovement:null,userEvents:{},onMouseOverTimeOut:null,multiUserDayScrollTime:null,isMultiUserDayScrolled:!1,tdWidth:null,isMouseOnArrw:!1,relAccId:"",relAccName:"",relAccMod:!1,addressInfo:[],maxReminderValue:0,reminderCount:0,reminders:[],allDayReminders:[],evtCreateFrom:"",addPartCheck:!0,showDuplicateContView:[],eventDesc:"",skipEventAlert:!1,startMeetingWindowObject:void 0,eventMeetingOnboardingShown:!1,meetingOnboardScrollBlock:!1,scheduleOnlineEvent:!1,meetingToolName:"",inviteeslimit:50,remainingInvitees:50,pastEventInvCnt:void 0,exceededInviteesList:[],meetingCheckBoxEnabled:!1,relatedParticipantName:"",finalIdsJson:{},invTypeVsUserIdsMap:{},sendNotificationMail:!1,jobSheetMAC:!1,statusDropDownObj:[{html:I18n.getMsg("Prepared"),value:"0"},{html:I18n.getMsg("Confirmed"),value:"1"},{html:I18n.getMsg("Cancelled"),value:"-1"}],numberStringArray:[{html:I18n.getMsg("First"),value:"1"},{html:I18n.getMsg("Second"),value:"2"},{html:I18n.getMsg("Third"),value:"3"},{html:I18n.getMsg("Fourth"),value:"4"},{html:I18n.getMsg("Last"),value:"5"}],numberStringArrayWidthDay:[{html:I18n.getMsg("Day"),value:"Day"},{html:I18n.getMsg("First"),value:"1"},{html:I18n.getMsg("Second"),value:"2"},{html:I18n.getMsg("Third"),value:"3"},{html:I18n.getMsg("Fourth"),value:"4"},{html:I18n.getMsg("Last"),value:"5"}],recDateArrray:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],recurringElemIds:["Crm_Events_REPEATTYPE","Crm_Events_RECURRING_FREQUENCY","Crm_Events_RECURRING_END_NEVER","Crm_Events_RECURRING_END_NOOFTIMES","Crm_Events_RECURRING_END_ON","Crm_Events_RECURRING_REPEAT_COUNT","Crm_Events_RECURRING_END_DATE","Crm_Events_RECURRING_INVITATIONMAIL_0","Crm_Events_EXCEPT_HOLIDAY_0","Crm_Events_RECURRING_CUSTOM_PERIODS_COUNT","Crm_Events_RECURRING_CUSTOM_WEEK_REPEAT_ON","Crm_Events_RECURRING_CUSTOM_MONTH_REPEAT_ON","Crm_Events_RECURRING_CUSTOM_MONTH_REPEAT_ON_DAY","Crm_Events_RECURRING_CUSTOM_MONTH_REPEAT_ON","Crm_Events_RECURRING_CUSTOM_OCCUR_FIRST","Crm_Events_RECURRING_CUSTOM_OCCUR_DAY","Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_MONTH","Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_FIRST","Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_DAY_DATE","Crm_Events_STARTDATETIME","Crm_Events_ENDDATETIME"],weekDaysDropdownObj_lastDay:[{html:I18n.getMsg("Sunday"),value:"1"},{html:I18n.getMsg("Monday"),value:"2"},{html:I18n.getMsg("Tuesday"),value:"3"},{html:I18n.getMsg("Wednesday"),value:"4"},{html:I18n.getMsg("Thursday"),value:"5"},{html:I18n.getMsg("Friday"),value:"6"},{html:I18n.getMsg("Saturday"),value:"7"},{html:I18n.getMsg("crm.event.rec.last.day"),value:"-1"},{html:I18n.getMsg("crm.event.rec.last.working.day"),value:"0"}],weekDaysDropdownObj:[{html:I18n.getMsg("Sunday"),value:"1"},{html:I18n.getMsg("Monday"),value:"2"},{html:I18n.getMsg("Tuesday"),value:"3"},{html:I18n.getMsg("Wednesday"),value:"4"},{html:I18n.getMsg("Thursday"),value:"5"},{html:I18n.getMsg("Friday"),value:"6"},{html:I18n.getMsg("Saturday"),value:"7"}],monthsDropdownObj:[{html:I18n.getMsg("Januray"),value:"0"},{html:I18n.getMsg("February"),value:"1"},{html:I18n.getMsg("March"),value:"2"},{html:I18n.getMsg("April"),value:"3"},{html:I18n.getMsg("May"),value:"4"},{html:I18n.getMsg("June"),value:"5"},{html:I18n.getMsg("July"),value:"6"},{html:I18n.getMsg("August"),value:"7"},{html:I18n.getMsg("September"),value:"8"},{html:I18n.getMsg("October"),value:"9"},{html:I18n.getMsg("November"),value:"10"},{html:I18n.getMsg("December"),value:"11"}],invTypeVsDispMsg:{c:I18n.getMsg("Contacts"),l:I18n.getMsg("Leads"),u:I18n.getMsg("Users"),r:I18n.getMsg("roles"),g:I18n.getMsg("groups"),t:I18n.getMsg("Territories"),cv:I18n.getMsg("crm.invitees.filter.contact.customeview.label"),lv:I18n.getMsg("crm.invitees.filter.lead.customeview.label"),rs:I18n.getMsg("crm.security.roles.and.subordinates")},eventRemindAtOptions:[],init:function(){this.timeStrForAllDayReminder=Utils.getTimeStrForAllDayReminder(),this.eventRemindAtOptions_allday=[{value:"none",html:I18n.getMsg("None")},{value:"0",html:I18n.getMsg("crm.event.allday.remind.ondate",[I18n.getMsg([this.timeStrForAllDayReminder]),Events.getModuleName(!0,!1,!0)])},{value:"1 days",html:I18n.getMsg("crm.event.remind.allday.day",["1",I18n.getMsg(this.timeStrForAllDayReminder)])},{value:"2 days",html:I18n.getMsg("crm.event.remind.allday.days",["2",I18n.getMsg(this.timeStrForAllDayReminder)])},{value:"1 weeks",html:I18n.getMsg("crm.event.remind.allday.week",["1",I18n.getMsg(this.timeStrForAllDayReminder)])}],this.eventRemindAtOptions=[{value:"none",html:I18n.getMsg("None")},{value:"0",html:I18n.getMsg("crm.event.remind.ontime",[Crm.getModuleDisplayName(!0,!1,!0)])},{value:"5 mins",html:I18n.getMsg("crm.event.remind.mins",["5"])},{value:"10 mins",html:I18n.getMsg("crm.event.remind.mins",["10"])},{value:"15 mins",html:I18n.getMsg("crm.event.remind.mins",["15"])},{value:"30 mins",html:I18n.getMsg("crm.event.remind.mins",["30"])},{value:"1 hrs",html:I18n.getMsg("crm.event.remind.hr",["1"])},{value:"2 hrs",html:I18n.getMsg("crm.event.remind.hrs",["2"])},{value:"1 days",html:I18n.getMsg("crm.event.remind.day",["1"])},{value:"2 days",html:I18n.getMsg("crm.event.remind.days",["2"])}]},globalCreate:function(e,t,a,i,n,r,s,o,l){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{if(Crm.userDetails.isPhoneNoNewView&&Crm.loadPhoneFieldComponentJSFiles(),a&&("Appointments"===a||a.dataset&&"Detail_createApppointment"===a.dataset.zcqa||a[0]&&a[0].dataset&&a[0].dataset.appointment)&&!l){var d=[];d=(d=(d=d.concat(networkUtils.returnDependencyFiles(["zohocrm_services.js"]))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")]))).concat(networkUtils.returnDependencyFiles(["crm-image-upload.js","crm-image-mixin.js","crm-image-preview.js","crm-image-upload-create.js","lyte-scrollTo.js","exif-plugin.js","lyte-cropper.js","lyte-colorbox.js"],crmConstants.jsStaticPathForLyte));var c=[];Crm.userDetails.RTL_ENABLED&&(c=networkUtils.returnDependencyFiles(["crm-image-upload-rtl.css","crm-image-upload-ziaError.css"],crmConstants.cssStaticPathForLyte)),c=c.concat(networkUtils.returnDependencyFiles(["crm-image-upload.css","crm-image-preview.css","crm-image-upload-create.css"],crmConstants.cssStaticPathForLyte)),d=(d=d.concat(c)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("imageupload")]));var m=networkUtils.getI18nJSUrl("serviceentitykeys");return d=d.concat(networkUtils.returnDependencyFiles([m])),void Lyte.injectResources(d,void 0,(function(){Events.globalCreate(e,t,a,i,n,r,s,o,!0)}))}Lyte.injectResources(networkUtils.returnDependencyFiles(["businessHoursmixin.js"],crmConstants.jsStaticPathForLyte),void 0,(function(){Lyte.injectResources(Lyte.registeredMixins["business-hours-utils"].downloadRecourceFile(),void 0)})),this.closeEntity(),this.allDayField=n,this.addMoreDetailsClicked=!1,this.currentStatus="create";var u=Events.getPositionObjFromEvent(e);if(Events.createSource=t,Events.evtCreateFrom=t,Events.currentEventHostId=r,a)if("Appointments"===a||a.dataset&&"Detail_createApppointment"===a.dataset.zcqa||a[0]&&a[0].dataset&&a[0].dataset.appointment){if(this.moduleName="Appointments",$("#saveAppointmentsBtn").attr("value",I18n.getMsg("Save")),"relatedlist_new"==t)"canvas"!=Lyte.Router.getRouteInstance().routeName&&(Events.appointmentParams={},Events.appointmentParams.listRelationId=$(a).data().relid,Events.appointmentParams.entityid=detailView.entityId,Events.appointmentParams.relmodule=detailView.currentModule,Events.appointmentParams.entityname=$("#entityName").val());else if("krp"===t){if(!Lyte.Router.getRouteInstance()||"canvas"!==Lyte.Router.getRouteInstance().routeName){var v=$("#krp_Rightpanel_InfoContainer").find("#entityName").val();CSU.setAppointmentParams($$rightPanel.entityId,v,$$rightPanel.currentModule)}}else if("salessignals"===t){var p=$("#ss_entityId").val(),h=$("#ntcBusinessCard"+p).find("#subvalue_LASTNAME").text();CSU.setAppointmentParams(p,h,$("#ss_module").val())}else if("kanban"===Lyte.Router.getRouteInstance().routeName&&"listview"===t){var g=$(a).attr("data-relid"),C=$("[name='module']").val();CSU.setAppointmentParams(g,$("#listView_"+g).text(),C)}else Events.appointmentPos=u,Events.evtappointment=e,Events.crntEleappointment=a;if("calendar"==t){if("monthview"===calView.currCalView&&"calendarGlobelAdd"!=t||"weekview"===calView.currCalView&&calView.isMultiUserView){if("24:00"!==Crm.calPreferences.DAYSTARTSAT)if(Utils.isToday(i)){var f=new Date;i.setHours(f.getHours()),i.setMinutes(f.getMinutes()),i=Events.getRoundedDateTime(i)}else i.setHours(parseInt(Crm.calPreferences.DAYSTARTSAT))}else"dayview"!==calView.currCalView&&"weekview"!==calView.currCalView||i.setMinutes(0);Events.appointmentClickedDate=i}}else("JobSheets"===a||a.dataset&&"Detail_createJobSheet"===a.dataset.zcqa)&&(this.moduleName="JobSheets");Events.createEntity(this.moduleName,void 0,(function(){"ACTIVITYPERSONALITY"==$(a).parent().attr("data-options")&&($(a).parent().css("z-index",19),Events.hideObjId=$(a).parent().attr("id"),Crm.menu.menusInDisplay[Events.hideObjId]&&delete Crm.menu.menusInDisplay[Events.hideObjId],renderingUtils.stopEvent(e)),Events.eventCreateCBn(t,a,e,void 0,u);var n="eventCreateFrom";if(Crm.requestParam[n]=t,"calendar"!==t&&$("#calSelUserHeader").is(":visible")&&(Crm.requestParam[n]="calendarGlobelAdd"),"calendar"==t||"calendarGlobelAdd"==t){if("monthview"===calView.currCalView&&"calendarGlobelAdd"!=t||"weekview"===calView.currCalView&&calView.isMultiUserView){if("24:00"!==Crm.calPreferences.DAYSTARTSAT)if(Utils.isToday(i)){var l=new Date;i.setHours(l.getHours()),i.setMinutes(l.getMinutes()),i=Events.getRoundedDateTime(i)}else i.setHours(parseInt(Crm.calPreferences.DAYSTARTSAT))}else"dayview"!==calView.currCalView&&"weekview"!==calView.currCalView||i.setMinutes(0);calView.isMultiUserView?r&&s||(s=Crm.userDetails.DISPLAY_NAME,r=Crm.userDetails.USER_ID):(s=crmCalendar.currCalSelusrName,r=calView.currCalSelusr);var d=s;return d.length>15&&(s=s.substr(0,14)+"..."),Crm.userDetails.LITE&&Crm.userDetails.LITE.IS_LITE_USER||($("#Crm_Events_SMOWNERID").attr("title",d).data("id",r).data("oldValue",r),$("#Crm_Events_SMOWNERID span").text(s)),Events.setStartDateAndTime(i),Events.setEndDateAndTime(!0,!1),"calendar"==t&&$("#eventCreatePopup").addClass("eventCreateCalenderView"),!0}if("crmEmail"==t)return Events.setStartDateAndTime(i),Events.setEndDateAndTime(!0,!1),!0;a||Events.setEndDateAndTime(!0,!1,void 0,!0),o&&o()})),thirdPartyUtils.bindSelect2($(".newChosenSel").find("select"))}},createEntity:function(e,t,a,i,n){Crm.requestParam={},commonUtils.showHideLoadingDiv(!0),Crm.isFromSalesInbox&&"Appointments"===e&&void 0===window.Appointments.setStatus&&(window.Appointments=void 0);var r=Crm.getModuleObj(e);Crm.userDetails.USER_ID;i=i||"create",window[e].setStatus(i);var s=Crm.getCrmBasePath()+"/Create.do";Crm.fieldsObj[e]=[],Crm.currencyFields[e]=[];var o={module:e,format:"json"};for(var l in Events.appointmentParams&&(t=Events.appointmentParams),t)/clickId|calleeObj/.test(l)||(o[l]=t[l]),Crm.requestParam[l]=t[l];Events.finalIdsJson={},o.tstamp=(new Date).getTime(),"setup"==window[e].currentStatus&&(o.isPageLayout="true");var d=new crmRequestPool;return d.initiate({type:"GET",url:s,data:o,async:!0,dataType:"json",success:function(t){if(t.responseText&&-1!=t.responseText.indexOf("FEATURELIMIT_ERROR_403::::FEATURELIMITEXCEEDS"))return renderingUtils.showCustomAlert(I18n.getMsg("crm.newfree.limit.exceed")),void commonUtils.showHideLoadingDiv();t.eventMeetingOnboardingShown&&(Events.eventMeetingOnboardingShown=!0),t.productLineItems&&(window[e].currentStatus="create"),null!=n&&null!=n&&""!=n&&"clientPortal"===n?r.createTemplate(t,a,"layoutPreview"):"Campaigns"==t.module&&"true"==t.intermediatePage?r.showIntermediatePage(t,a):r.createTemplate(t,a),t.meetingConfZuid&&(Events.meetingConfZuid=t.meetingConfZuid,Events.meetingSiteUrl=t.meetingSiteUrl,Events.MBProvidersNameVsIdMap=t.MBProvidersNameVsIdMap),t.inviteeslimit&&(Events.inviteeslimit=t.inviteeslimit,Events.remainingInvitees=t.inviteeslimit),commonUtils.showHideLoadingDiv()},error:function(e){var t="crm.record.delete.message";if(-1!=e.responseText.indexOf("FEATURELIMIT_ERROR_403::::FEATURELIMITEXCEEDS")&&(t="crm.newfree.limit.exceed"),-1===e.responseText.indexOf("INSUFFICIENT_PRIVILEGES")){var a='<div onclick=/"sE()" class="w500 p20"><div class="floatL pL20 w430"><div class="f20"><h2 style="color:#E20000";>'+I18n.getMsg("crm.delete.error")+'</h2></div><div class="mT10">'+I18n.getMsg(t,[Crm.getCrmBasePath()])+'</div></div><br class="clearB"><div  class="alignright mT20"><input type="button" id="popupok" class="primarybtn" value="'+I18n.getMsg("crm.button.ok")+"\" onclick=\"hide('popupnew');removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30\"></div></div>";renderingUtils.popUpWithFreeze(a)}commonUtils.showHideLoadingDiv()}}),(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(o.module))&&(o.getLayoutRuleJSON=!0,Crm.layoutRuleJSONData={},d.addUp({type:"GET",action:s,data:o,dataType:"json",success:function(e){null!==e&&(CFRExec.init(e,o.module,"edit"),CFRExec.promptIfMandatory=!1,CFRExec.evalRules("edit",!0))},error:function(){commonUtils.showHideLoadingDiv(),Crm.layoutRuleJSONData={}}})),(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(o.module))&&Crm.downloadValidationRules(s+"?format=json&module="+e+(o.layoutId?"&layoutId="+o.layoutId:""),e),!1},initCreateLayout:function(e){Events.createEntity(this.moduleName,void 0,(function(){this.currentStatus=void 0,e&&e()}),"setup")},createFieldRow:function(e,t,a){if(a){var i=a.label,n=a.colname;if("setup"!=this.currentStatus){if("Who Id"==i){var r=a.defaultvalue;(E=document.createDocumentFragment()).appendChild(t);var s=t.cloneNode(!0),o=(g=$(t).find("input")[0]).id,l=a.label,d=$(s.firstChild);$(g).val(""),d.html(I18n.getMsg("Related To")),a.mandate+""=="true"&&d.append("<sup class='red'>*</sup>");d.firstChild;var c=$(s.childNodes[1]),m=objectUtils.getKeys(crmConstants.defaultWhoId[this.moduleName]),u=renderingUtils.createSelectBox((function(e){var t=Crm.moduleInfo[m[e]]?Crm.moduleInfo[m[e]].translatedSingularLabel:I18n.getMsg(crmConstants.defaultWhoId[Events.moduleName][m[e]]);if(!t)return!1;var i={html:t,value:m[e]};return(0===e||r&&a.lookupmodule===m[e])&&(i.defaultVal="true"),i})),v=$(u);v.removeClass("select"),v.css({width:"135px"}),v.attr({id:o+"_select"}).data({displaylabel:I18n.getMsg("Related To"),uitype:a.uitype,mandate:a.mandate,name:l,maxlength:a.maxlength}),Crm.fieldsObj[this.moduleName].push(o+"_select"),v.change((function(){Events.showEventRelatedToOptions(this,!0)}));var p=$(document.createElement("div"));if($(c[0]).empty(),c.html(p),p.attr("class","createSelect newChosenSel"),p.html(u),$(s).find("#addpartCheck").remove(),E.insertBefore(s,t),r){var h=a.lookupmodule;v.val(h),$(g).val(r).data("displaylabel",h).data("id",a.entityid)}else $(t).hide(),"create"!==this.currentStatus&&(v.val("Others"),a.defaultvalue="Others");return E}if("What Id"==i){r=a.defaultvalue;var g=$(t).find("input"),C=$(t).find("select");if(C.length){C.removeClass("select");var f=$(t).find("div").first();p=$(document.createElement("div"));f.append(p),p.attr("class","createSelect newChosenSel"),p.append(C)}r?($(t).find("select").val(a.entitymodule),$(t).find("#Crm_Events_SEID").attr("recId",a.defaultid),Events.relAccMod=!0,crmTab.tabList.contains(a.entitymodule)||$(t).find("#Crm_Events_SEID_img").hide(),$(g).val(r).data("id",a.entityid)):$(t).hide()}else if(("ALLDAYEVENT"==n||"STARTDATETIME"==n||"ENDDATETIME"==n)&&($(t).attr("id",this.moduleName+"_fldRow_"+n),"ALLDAYEVENT"==n)){var E;(E=document.createDocumentFragment()).appendChild(t);var I=document.createElement("div");$(I).attr({id:"timeAlertTR",style:"display:none"});p=document.createElement("div");return $(p).attr({style:"border:1px solid #f0f0f0; background:#FAFAE7; padding:3px;"}),$(I).append($(p)),E.appendChild(I),E}}else{if("Who Id"==i){d=$(t).find("table td div").eq(0);var y=$("<select>",{style:"pointer-events:none; cursor:move; width:115px"});y.append($("<option>").html(I18n.getMsg("None")));var R=$(t).find("table td div").eq(1),b=" <sup class='red'></sup>";"true"==a.mandate&&(b=" <sup class='red'>*</sup>"),d.html(I18n.getMsg("Related To")+b),(p=$(document.createElement("div"))).attr("class","newSelect"),p.append(y),R.html(p)}else if("What Id"==i)return;$(t).attr("uitype",a.uitype)}return t}return t},createTemplate:function(e,t,a){Events.loadeventCreatePopup(),Crm.isHeadless||1!=Crm.userDetails.detailView_newUI||null==Crm.userDetails.detailView_newUI||detailView.atnAddClassSelected($("tr#"+e.entityId).find(".neweditIcon")),Events.createEditJson=e;var i=this.moduleName;Events.eventRemindAtOptions=[{value:"none",html:I18n.getMsg("None")},{value:"0",html:I18n.getMsg("crm.event.remind.ontime",[Crm.getModuleDisplayName(!0,!1,!0)])},{value:"5 mins",html:I18n.getMsg("crm.event.remind.mins",["5"])},{value:"10 mins",html:I18n.getMsg("crm.event.remind.mins",["10"])},{value:"15 mins",html:I18n.getMsg("crm.event.remind.mins",["15"])},{value:"30 mins",html:I18n.getMsg("crm.event.remind.mins",["30"])},{value:"1 hrs",html:I18n.getMsg("crm.event.remind.hr",["1"])},{value:"2 hrs",html:I18n.getMsg("crm.event.remind.hrs",["2"])},{value:"1 days",html:I18n.getMsg("crm.event.remind.day",["1"])},{value:"2 days",html:I18n.getMsg("crm.event.remind.days",["2"])}],Crm.userDetails.changeOwnerPermission=e.changeOwnerPermission,e[i].fieldDependency&&(Crm.fieldDependency[i]=JSON.parse(e[i].fieldDependency)),e.DatePattern&&(Crm.userDetails.DATE_PATTERN=e.DatePattern.toLowerCase()),e.DISPLAY_NAME&&(Crm.userDetails.DISPLAY_NAME=e.DISPLAY_NAME),e[i].calPreferences&&(Crm.calPreferences=e[i].calPreferences),e.WhatId&&(this.whatIdModulesArr=e.WhatIdArr.split(":::"),crmConstants.defaultWhatId[i]=window[i].whatIdModulesArr),e.currencyDetails&&(this.currencyDetails=e.currencyDetails),"Appointments"!==i&&(crmConstants.defaultWhoId[this.moduleName].None="None",moduleRecordMapping.Leads.viewable&&moduleRecordMapping.Leads.visible&&(crmConstants.defaultWhoId[this.moduleName].Leads="Leads"),moduleRecordMapping.Contacts.visible&&moduleRecordMapping.Contacts.visible&&(crmConstants.defaultWhoId[this.moduleName].Contacts="Contacts"),crmConstants.defaultWhoId[this.moduleName].Others="Others",e[this.moduleName].section.length||(this.addMoreDetailsClicked=!0,$("#showMoreFiledsLink").hide()),this.isEventStarted=e.isEventStarted?e.isEventStarted:0,this.selInviteesCnt=e.invCnt?parseInt(e.invCnt):0,this.status=e.status?e.status:0,Crm.requestParam["property(EventStatus)"]=this.status);var n=crmTemplate.create(e,this.moduleName,e[this.moduleName].section);if("setup"==this.currentStatus){var r=n;$("#"+a).html(""),"Appointments"===i?($elemId.append(r.find("#secContent_Appointment_Information li")),$elemId.append(r.find("#secContent_Appointment_Additional_Information li "))):($("#"+a).append(r.find("#secContent_Event_Information li")),$("#"+a).append(r.find("#secContent_Event_Additional_Information li ")))}else{var s=n,o=s.find("#Crm_Events_ALLDAYEVENT").data("oldValue");if("false"==o||""==o?($(renderingUtils.createSelectBox(Events.eventRemindAtOptions)),"create"==this.currentStatus&&Crm.calPreferences.REMINDAT):($(renderingUtils.createSelectBox(Events.eventRemindAtOptions_allday)),s.find("#Crm_Events_STARTDATETIME_TimeOption, #Crm_Events_ENDDATETIME_TimeOption").css({visibility:"hidden"}),"create"==this.currentStatus&&Crm.calPreferences.ALLDAYEVENTREMINDER),"relatedlist_meetnow"==Events.createSource){for(var l=["#Events_fldRow_LOCATION","#Events_fldRow_ALLDAYEVENT","#Events_fldRow_STARTDATETIME","#Events_fldRow_ENDDATETIME","#Events_fldRow_SMOWNERID","#Events_fldRow_RECURRING","#Events_fldRow_REMINDAT","#CrmEventMeetingInteg","#Events_fldRow_REMINDINVITEESAT"],d=l.length,c=0;c<=d;c++){var m=l[c];s.find(m).attr("style","display:none")}s.find("#secDiv_Event_Additional_Information").removeAttr("style"),s.find("#meetingInclude").attr("checked","true"),s.find("#Crm_Events_MeetingSolutions_select").find("option").attr("name",Events.meetToolsel);var u=s.find("#Events_fldRow_SUBJECT"),v=$(Handlebars.templates.meetingDurationField());u.after(v),u.after(s.find("#Events_fldRow_DESCRIPTION")),thirdPartyUtils.bindSelect2("#Crm_Events_DURATION")}if("Appointments"===i){var p=$("<div>",{id:"AppointmentCreateErrorRespDiv",align:"center",style:"display:none",class:"red11 m0 f13"});this.addMoreDetailsClicked=!0,$("#showMoreFiledsLink").hide(),$("div.contHeadInfo.eventHeaderStyle.f21").text(I18n.getMsg("Appointments"))}else p=$("<div>",{id:"eventCreateErrorRespDiv",align:"center",style:"display:none",class:"red11 m0 f13"});if(!Crm.isHeadless&&SalesSignalsWrapper.isSignalIFrameOpen){"Appointments"===i?$("#preHTMLContainer_Appointments"):$("#preHTMLContainer_Events"),top.signalsIframe.prehtmlcontainerModule.remove();var h=$(document.getElementById("eventCreationInnerDiv_ss"));if(h.prepend(s),crmTemplate.bindFldTooltip(),"edit"===Events.currentStatus)"Appointments"===i?(g=$("#secDiv_Appointment_Information "),C=$("#secContent_Appointment_Additional_Information div.tabDivCreate")):(g=$("#secDiv_Event_Information "),C=$("#secContent_Event_Additional_Information div.tabDivCreate")),g.eq(0).append(C);h.prepend(p),thirdPartyUtils.bindPerfectScroll(h),h.css({"padding-right":"12px"})}else{var g,C;if(("Appointments"===i?$("#preHTMLContainer_Appointments"):$("#preHTMLContainer_Events")).remove(),$("#eventCreationInnerDiv").prepend(s),crmTemplate.bindFldTooltip(),"edit"===Events.currentStatus)"Appointments"===i?(g=$("#secDiv_Appointment_Information "),C=$("#secContent_Appointment_Additional_Information div.tabDivCreate")):(g=$("#secDiv_Event_Information "),C=$("#secContent_Event_Additional_Information div.tabDivCreate")),g.eq(0).append(C);$("#eventCreationInnerDiv").prepend(p),thirdPartyUtils.bindPerfectScroll("#eventCreationInnerDiv"),$("#eventCreationInnerDiv").css({"padding-right":"12px"})}"Appointments"!==i&&Events.setSelInvCnt()}if(void 0!==a)renderingUtils.setTooltip($("#"+crmTemplate.getElemIdByColname(this.moduleName,"SMOWNERID")+" span")[0],$("#"+crmTemplate.getElemIdByColname(this.moduleName,"SMOWNERID"))[0].title);else if("setup"===this.currentStatus){var f=$("#Crm_"+this.moduleName+"_setup_SMOWNERID")[0].title;$("#Crm_"+this.moduleName+"_setup_SMOWNERID span")[0].innerText=f,$("#Crm_"+this.moduleName+"_setup_SMOWNERID")[0].title=f}else if(!Crm.isHeadless&&SalesSignalsWrapper.isSignalIFrameOpen){f=top.signalsIframe.$("#Crm_"+this.moduleName+"_SMOWNERID")[0].title;top.signalsIframe.$("#Crm_"+this.moduleName+"_SMOWNERID span")[0].innerText=f,top.signalsIframe.$("#Crm_"+this.moduleName+"_SMOWNERID")[0].title=f,top.signalsIframe.$("#Crm_"+this.moduleName+"_SMOWNERID")[0].setAttribute("data","bodyappend:'yes',innerscrollid:'eventCreationInnerDiv_ss'"),top.signalsIframe.$("#Crm_"+this.moduleName+"_SMOWNERID")[0].dataset.bodyappend="yes",top.signalsIframe.$("#Crm_"+this.moduleName+"_SMOWNERID")[0].dataset.innerscrollid="eventCreationInnerDiv_ss"}else{f=$("#Crm_"+this.moduleName+"_SMOWNERID")[0].title;$("#Crm_"+this.moduleName+"_SMOWNERID span")[0].innerText=f,$("#Crm_"+this.moduleName+"_SMOWNERID")[0].title=f,$("#Crm_"+this.moduleName+"_SMOWNERID")[0].setAttribute("data","bodyappend:'yes',innerscrollid:'eventCreationInnerDiv'"),$("#Crm_"+this.moduleName+"_SMOWNERID")[0].dataset.bodyappend="yes",$("#Crm_"+this.moduleName+"_SMOWNERID")[0].dataset.innerscrollid="eventCreationInnerDiv"}if(crmTemplate.setDependentFields("Events",this.currentStatus),t&&t(),$("#saveEventsBtn").prop("disabled",!1).siblings("input[type=button]").prop("disabled",!1),Events.loadInvitationConfirmDiv(),$("#invitationConfirmDiv .send,#invitationConfirmDiv .dntSend").prop("disabled",!1),crmTemplate.contentLoaded(e,this.moduleName,s),"edit"==Events.currentStatus&&"Appointments"!==i){$("#Crm_Events_STARTDATETIME").data("dateObj").getTime(),(new Date).getTime();Events.isRecEvent&&(Events.isRecurringEditAvail=!0)}$("#Crm_Events_ENDDATETIME_TimeOption").trigger("create_edit_clone_DomChange"),s&&thirdPartyUtils.bindSelect2(s.find(".newChosenSel select,.mlSelect select"));var E=$("#eventCreatePopup");if("skyDesk"===Crm.brandName){var I=renderingUtils.windowHeight;$(window).scrollTop(0),E.attr("style","width:95%;height:"+90*I/100+"px;"),$("#eventCreateContainerDiv").attr("style","width:100%;height:"+90*I/100*90/100+"px;"),$("#eventCreationDiv").attr("style","width:95%;height:"+90*I/100*90/100+"px;"),$("#eventCreationInnerDiv").attr("style","width:95%;height:"+90*I/100*80/100+"px;Overflow:hidden;"),E.css({top:"2%",left:"2%"})}$(".fixedSearch").is(":visible")&&E.addClass("pFixed")},setStartDateAndTime:function(e){var t,a=!1;if("HH:mm"===Crm.userDetails.TIME_FORMAT&&(a=!0),e)t=new Date(e);else{t=new Date($("#Crm_Events_STARTDATETIME").data("dateObj"));var i=trimBoth($("#Crm_Events_STARTDATETIME_TimeOption").val().split(" ")[0]),n=$("#Crm_Events_STARTDATETIME_TimeOption").timeEntry("getTime");if(n){var r=Utils.getMeridiem(n).toUpperCase();a?t.setHours(parseInt(i.split(":")[0],10)):t.setHours(Utils.convertTimeTo24HoursFormat(parseInt(i.split(":")[0],10),r)),t.setMinutes(parseInt(i.split(":")[1],10))}}if(a)$("#Crm_Events_STARTDATETIME_TimeOption").val(Utils.formatTimeVal(t.getHours())+":"+Utils.formatTimeVal(t.getMinutes()));else{var s=Utils.convertTo12HoursFormatTimeObj(t);$("#Crm_Events_STARTDATETIME_TimeOption").val(s.hrs+":"+s.mins+" "+I18n.getMsg(s.meridiem.toUpperCase()))}$("#Crm_Events_STARTDATETIME").val(crmCalendar.convertToUserDatePattern(t.getDate()+" "+t.getMonth()+" "+t.getFullYear())),$("#Crm_Events_STARTDATETIME").data("dateObj",t)},checkAvailability:function(e,t,a,i,n,r,s){$.ajax({url:Crm.getCrmBasePath()+"/events/EventAction.do",type:"GET",data:"type=checkAvail&st="+e+"&et="+t+"&hostId="+a+"&entityId="+n+"&actType="+i+"&meetNow="+r,success:s})},checkDuplicateEvent:function(e,t,a,i){var n=$("#Crm_Events_SMOWNERID");$("#saveEventsBtn").attr("disabled","disabled"),e||((e={start:$("#Crm_Events_STARTDATETIME").data("dateObj"),end:$("#Crm_Events_ENDDATETIME").data("dateObj"),activityType:"Events"}).oldStart=new Date($("#Crm_Events_STARTDATETIME").data("oldValue")),e.oldEnd=$("#Crm_Events_ENDDATETIME").data("oldValue"),e.ownerId=n.data("id"),e.oldOwnerId=n.data("oldValue"),e.isAllday=$("#Crm_Events_ALLDAYEVENT").is(":checked"),e.entityId=Events.entityId);var r="";e.entityId&&""!==e.entityId&&(r=e.entityId);var s=e.activityType,o=e.start,l=new Date,d=e.ownerId,c=e.oldOwnerId,m="";if($("#Crm_Events_SMOWNERID").length>0&&(m=n.attr("data-id")),("edit"===this.currentStatus&&o.getTime()===e.oldStart.getTime()&&m===d||Utils.compareDateandTime(o,l)||"calendar"===Events.createSource&&("weekview"===calView.currCalView||"dayview"===calView.currCalView)&&d===c)&&"Events"===s||"Calls"===s&&Utils.compareDateandTime(u,l)){if("calendar"!==Events.createSource||"weekview"!==calView.currCalView&&"dayview"!==calView.currCalView||"Events"!==s)return a&&a(),$("#saveEventsBtn").attr("disabled",!1),!1;Events.skipEventAlert=!0}var u=Utils.getTimeStringWithAmPm(o),v=Utils.getDateInUserDatePattern(o)+" "+u.hrs+":"+u.mins+" "+u.meridiem,p=Utils.getTimeStringWithAmPm(e.end),h=Utils.getDateInUserDatePattern(e.end)+" "+p.hrs+":"+p.mins+" "+p.meridiem,g="relatedlist_meetnow"==Events.createSource;Events.checkAvailability(v,h,e.ownerId,s,r,g,(function(r){Events.skipEventAlert=!1;e.isAllday;var o,l=r.activityType,c=r.isAllDay;if(null==r.isbusinesshours){var m="<a target='_blank' href='"+Crm.getCrmBasePath()+"/EntityInfo.do?module="+l+"&id="+r.entityId+"'>"+r.subject+"</a>";o="Appointments"===l?Crm.userDetails.USER_ID===d?r.startCoincides?I18n.getMsg("crm.duplicate.appointment.overlapwith.otherevent.start.you",[m,r.endtimeStr,Crm.moduleInfo[s].translatedSingularLabel.toLocaleLowerCase()]):I18n.getMsg("crm.duplicate.appointment.overlapwith.otherevent.end.you",[m,r.starttimeStr,Crm.moduleInfo[s].translatedSingularLabel.toLocaleLowerCase()]):r.startCoincides?I18n.getMsg("crm.duplicate.event.overlapwith.start.otherevent.other",[r.ownerName,m,r.endtimeStr,Crm.moduleInfo[s].translatedSingularLabel.toLocaleLowerCase()]):I18n.getMsg("crm.duplicate.event.overlapwith.end.otherevent.other",[r.ownerName,m,r.starttimeStr,Crm.moduleInfo[s].translatedSingularLabel.toLocaleLowerCase()]):"Events"===s?Crm.userDetails.USER_ID===d?"Events"===l?c?I18n.getMsg("crm.duplicate.event.overlap.allday.you",[m,Events.getModuleName(!0,!1,!0)]):r.startCoincides?I18n.getMsg("crm.duplicate.event.overlapwith.event.start.you",[m,r.endtimeStr,Events.getModuleName(!0,!1,!0)]):I18n.getMsg("crm.duplicate.event.overlapwith.event.end.you",[m,r.starttimeStr,Events.getModuleName(!0,!1,!0)]):r.startCoincides?I18n.getMsg("crm.duplicate.event.overlapwith.call.start.you",[m,r.starttimeStr,Events.getModuleName(!0,!1,!0)]):I18n.getMsg("crm.duplicate.event.overlapwith.call.end.you",[m,r.starttimeStr,Events.getModuleName(!0,!1,!0)]):"Events"===l?c?I18n.getMsg("crm.duplicate.event.overlap.allday.other",[r.ownerName,m,Events.getModuleName(!0,!1,!0)]):r.startCoincides?I18n.getMsg("crm.duplicate.event.overlapwith.event.start.other",[r.ownerName,m,r.endtimeStr,Events.getModuleName(!0,!1,!0)]):I18n.getMsg("crm.duplicate.event.overlapwith.event.end.other",[r.ownerName,m,r.starttimeStr,Events.getModuleName(!0,!1,!0)]):r.startCoincides?I18n.getMsg("crm.duplicate.event.overlapwith.call.start.other",[r.ownerName,m,r.starttimeStr,Events.getModuleName(!0,!1,!0)]):I18n.getMsg("crm.duplicate.event.overlapwith.call.end.other",[r.ownerName,m,r.starttimeStr,Events.getModuleName(!0,!1,!0)]):Crm.userDetails.USER_ID===d?"Events"===l?c?I18n.getMsg("crm.duplicate.call.overlap.allday.you",[m]):r.startCoincides?I18n.getMsg("crm.duplicate.call.overlapwith.event.start.you",[m,r.endtimeStr,Events.getModuleName(!0,!1,!0)]):I18n.getMsg("crm.duplicate.call.overlapwith.event.end.you",[m,r.starttimeStr,Events.getModuleName(!0,!1,!0)]):I18n.getMsg("crm.duplicate.call.overlapwith.call.you",[m,r.starttimeStr]):"Events"===l?c?I18n.getMsg("crm.duplicate.call.overlap.allday.other",[r.ownerName,m,Events.getModuleName(!0,!1,!0)]):r.startCoincides?I18n.getMsg("crm.duplicate.call.overlapwith.event.start.other",[r.ownerName,m,r.endtimeStr,Events.getModuleName(!0,!1,!0)]):I18n.getMsg("crm.duplicate.call.overlapwith.event.end.other",[r.ownerName,m,r.starttimeStr,Events.getModuleName(!0,!1,!0)]):I18n.getMsg("crm.duplicate.call.overlapwith.call.other",[r.ownerName,m,r.starttimeStr])}else{var u=$("#Crm_Events_REPEATTYPE");if(null!=u.val()&&"none"!=u.val())r.isAvail=!1;else switch(r.type){case"business":o=I18n.getMsg("bh.wrng.user.bh.time");break;case"shift":o=I18n.getMsg("bh.wrng.user.sh.time",[r.ownerName]);break;case"Unavailable":switch(r.unavailabletype){case 1:o=I18n.getMsg("bh.wrng.user.busy.time1",[r.ownerName,r.starttime,r.endtime]);break;case 2:o=I18n.getMsg("bh.wrng.user.busy.time2",[r.ownerName]);break;case 3:o=I18n.getMsg("bh.wrng.user.busy.time3",[r.ownerName,r.startdate,r.enddate]);break;default:o=I18n.getMsg("bh.wrng.user.busy.time4",[r.ownerName,r.starttime,r.startdate,r.endtime,r.enddate])}break;case"holiday":o=I18n.getMsg("bh.wrng.user.holiday",[r.time,r.ownerName]);break;case"break":o=I18n.getMsg("bh.wrng.user.break.time",[r.ownerName])}}if(r.isAvail&&!t){if($("#checkDuplicateEvent").remove(),"Calls"===s){var v=renderingUtils.createHTML({name:"div",attr:{id:"checkDuplicateEvent"},css:{background:"#fafafa",padding:"3px",border:"1px solid #f0f0f0","padding-left":"10px","border-bottom":"none"},child:[{name:"table",attr:{cellpadding:"3",cellspacing:"0",border:"0"},child:[{name:"tbody",child:[{name:"tr",child:[{name:"td",attr:{valign:"top"},child:[{name:"span",attr:{class:"dupTimeAlert"}}]},{name:"td",attr:{class:"pL5 color_6 f12"},html:o}]}]}]}]});$("#callDateSpanEdit").is(":visible")?($(v).insertAfter("#callQuickviewTable"),$("#quickViewContentDiv").scrollTo("#callTimeSpanEdit")):$("#compCalDiv").length>0?$(v).insertAfter("#compCalDiv"):$("#whichCallDiv").parent().append($(v))}else{v=renderingUtils.createHTML({name:"div",attr:{id:"checkDuplicateEvent",class:"timeAlert"},child:[{name:"div",attr:{},child:[{name:"div",css:{background:"#fafafa",padding:"3px",border:"1px solid #f0f0f0","border-bottom":"none"},child:[{name:"table",attr:{cellpadding:"3",cellspacing:"0",border:"0"},child:[{name:"tbody",child:[{name:"tr",child:[{name:"td",attr:{valign:"top"},child:[{name:"span",attr:{class:"dupTimeAlert"}}]},{name:"td",attr:{class:"f12 color_6"},html:o}]}]}]}]}]}]});if(i)$(v).insertAfter(n.parents("div").eq(0));else{$("#Crm_Events_ENDDATETIME");$(v).insertAfter($("#Events_fldRow_STARTDATETIME")[0])}var p="";p=r.isFromBusinessHour?$("#Crm_Events_SMOWNERID"):$("#Events_fldRow_ENDDATETIME"),$("#errorMsg_Crm_Events_ENDDATETIME").is(":visible")?v.classList.add("pT15"):v.classList.remove("pT15"),$(v).insertAfter(p)}a&&a(r.isAvail)}else if(r.isAvail){var h=[{val:I18n.getMsg("crm.button.create"),fn:function(){$("#duplicateEventMsg").hide(),a&&(a(r.isAvail),renderingUtils.removeDummyBackground())}},{val:I18n.getMsg("crm.button.cancel"),fn:function(){$("#duplicateEventMsg").hide(),renderingUtils.removeDummyBackground()}}],g="crm.events.duplicate.create.msg2";"edit"===Events.currentStatus&&(h=[{val:I18n.getMsg("crm.button.save"),fn:function(){$("#duplicateEventMsg").hide(),a&&(a(r.isAvail),renderingUtils.removeDummyBackground())}},{val:I18n.getMsg("crm.button.cancel"),fn:function(){$("#duplicateEventMsg").hide(),renderingUtils.removeDummyBackground()}}],g="crm.events.duplicate.edit.msg2"),renderingUtils.showCustomConfirmMessage("duplicateEventMsg",[o,I18n.getMsg(g,[Events.getModuleName(!0,!1,!0)])],h),renderingUtils.dummyBackground(!1,"duplicateEventMsg")}else $("#checkDuplicateEvent").remove(),a&&a();$("#saveEventsBtn").attr("disabled",!1),Events.userChange&&($("#saveEventsBtn").attr("disabled","disabled"),Events.userChange=!1)}))},setEndDateAndTime:function(e,t,a,i){var n=!1;"HH:mm"===Crm.userDetails.TIME_FORMAT&&(n=!0);var r=$("#Crm_Events_ENDDATETIME_TimeOption"),s=$("#Crm_Events_ENDDATETIME"),o=!t&&s.data("edited"),l=new Date($("#Crm_Events_STARTDATETIME").data("dateObj")),d=crmCalendar.monthName[l.getMonth()].html;if($("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_ON_label").text(I18n.getMsg("crm.recurring.custom.yearly.repeat.on",I18n.getMsg([d]))),$("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_DAY_DATE")[0]){for(var c=Utils.getMonthEnd(l.getMonth(),l.getFullYear()),m=crmConstants.dateArray.slice(0),u=m.length-1;u>0&&c!==m[u];u--)m.splice(u,1);$("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_DAY_DATE").html(renderingUtils.createSelectBox(m).innerHTML).data("name","yearlydays1select")}if(o){if(!e&&!t){v=a?new Date(a):new Date(s.data("dateObj"));if(n)r.val(Utils.formatTimeVal(v.getHours())+":"+Utils.formatTimeVal(v.getMinutes()));else{C=Utils.convertTo12HoursFormatTimeObj(v);r.val(C.hrs+":"+C.mins+" "+I18n.getMsg(C.meridiem.toUpperCase()))}s.val(crmCalendar.convertToUserDatePattern(v.getDate()+" "+v.getMonth()+" "+v.getFullYear())),renderingUtils.triggerEvent("change",s),s.data("dateObj",v),r.trigger("create_edit_clone_DomChange")}}else{var v=a?new Date(a):new Date(s.data("dateObj"));if(e&&(v=new Date($("#Crm_Events_STARTDATETIME").data("dateObj"))).setMinutes(v.getMinutes()+Crm.calPreferences.EVENTDURATION),t){var p=trimBoth(r.val().split(" ")[0]),h=r.timeEntry("getTime");if(h){var g=Utils.getMeridiem(h).toUpperCase();n?v.setHours(parseInt(p.split(":")[0],10)):v.setHours(Utils.convertTimeTo24HoursFormat(parseInt(p.split(":")[0],10),g)),v.setMinutes(parseInt(p.split(":")[1],10))}}if(n)r.val(Utils.formatTimeVal(v.getHours())+":"+Utils.formatTimeVal(v.getMinutes()));else{var C=Utils.convertTo12HoursFormatTimeObj(v);r.val(C.hrs+":"+C.mins+" "+I18n.getMsg(C.meridiem.toUpperCase()))}s.val(crmCalendar.convertToUserDatePattern(v.getDate()+" "+v.getMonth()+" "+v.getFullYear())),renderingUtils.triggerEvent("change",s),s.data("dateObj",v),r.trigger("create_edit_clone_DomChange")}i||this.checkDuplicateEvent(),Events.showHideMeetingIntegDiv()},showMoreFields:function(){var e=$("#secDiv_Event_Additional_Information"),t=$("#secDiv_Event_Information"),a=e.children().first();t.eq(0).append(e.children()),!a.length||window.ctiApiNotifier&&ctiApiNotifier.eventCreate&&validationUtils.isNotEmpty($("#ctiapi_folloup_event_list_subject").text())||$("#eventCreationInnerDiv").scrollTo(a,{duration:"slow"}),thirdPartyUtils.bindSelect2(t.find(".newChosenSel select,.mlSelect select")),$("#showMoreFiledsLink").hide(),this.addMoreDetailsClicked=!0},resetEntityVars:function(){this.entityId=void 0,this.cloneEntId=void 0,this.currentStatus=void 0,this.invAddLinkClicked=!1,this.reqInvRecAvail={t:!1,u:!1,l:!1,c:!1,lv:!1,cv:!1,g:!1,r:!1,rs:!1},this.isAddInvReqSent=!1,this.addInvPageCnt={t:0,u:0,l:0,c:0,lv:0,cv:0,g:0,r:0,rs:0,rc:0},this.invJsonCreate={t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},this.invDelListCreate={t:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},this.invRemoveJson={t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},this.invAddJson={t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},this.selInvPageCnt=0,this.selInviteesCnt=0,this.selInvPagerecAvail=!0,this.selInvPagereqSent=!1,this.selInvlinkClicked=!1,this.isCVSelected=!1,this.addInvEmailsList={},this.removeInvEmailsList={},this.isViaCopyPaste=!1,this.recCntIdsArr={add:{l:{},c:{},t:{},lv:{},cv:{},g:{},r:{},rs:{},u:{}},remove:{l:{},c:{},t:{},lv:{},cv:{},g:{},r:{},rs:{},u:{}}},this.isRecurringEditAvail=!1,this.isRecEvent=!1,this.modifyingEvent=void 0,this.selectedCVId=void 0,this.timeEntryAdded=!1,this.isPageLayoutModified=!1,this.formRuleModified=!1,this.currentQuickViewId=void 0,this.maxReminderValue=1,this.reminderCount=1,this.showDuplicateContView=[],this.authNotificationSentUsers={},this.withMeetingTool=void 0},resetParticipantJson:function(){this.invJsonCreate={t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},this.invRemoveJson={t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},this.invAddJson={t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}}},closeEntity:function(e,t){Events.closeOnboarding(),Events.hideObjId&&($("#"+Events.hideObjId).hide().trigger("onBeforeClose"),Events.hideObjId=void 0);var a=$("#saveEventsBtn"),i=$("#eventCreatePopup");if(i.hide(),"create"!==Events.currentStatus&&"edit"!==Events.currentStatus||!CFRExec.tempHold||validationUtils.isEmpty(CFRExec.tempHold.oldResJson)||(CFRExec.init(CFRExec.tempHold.oldResJson,CFRExec.tempHold.formRuleModule,CFRExec.OPERATIONCONSTANT.VIEW),CFRExec.tempHold={}),$("#doneRecurringBtn, #eventCreateErrorRespDiv").hide(),i.removeClass("eventCreateCalenderView"),a.show(),$("#cancelEventBtn").show(),a.val(I18n.getMsg("crm.button.save")),"edit"!==Events.currentStatus&&$("#showMoreFiledsLink").show(),Utils.detachObjects.push($.ui.ddmanager.current),$("#eventRecurringDiv, #participantDiv, #addpartCheckbox").remove(),0==$(".temp_freezelayer").length&&removeFreezeLayer(),removeFreezeLayer2(),e&&"calendar"===Events.createSource&&"monthview"===calView.currCalView&&Events.currentEventObjectInQV){var n=Events.currentEventObjectInQV.scrollTop;n&&$(window).scrollTop(n)}if(crmCalendar.close(),Events.resetEntityVars(),i.empty().remove(),window.ctiApiNotifier&&ctiApiNotifier.notifierCloseEvent(t),"skyDesk"===Crm.brandName){var r=$(window).height();$("#eventCreatePopup").attr("style","width:95%;height:"+90*r/100+"px;display:none;"),$("#eventCreateContainerDiv").attr("style","width:100%;height:"+90*r/100*90/100+"px;"),$("#eventCreationDiv").attr("style","width:95%;height:"+90*r/100*90/100+"px;"),$("#eventCreationInnerDiv").attr("style","width:100%;height:"+90*r/100*80/100+"px;Overflow:hidden;")}$("div[name='ownerNameLookup']").remove(),$("#eventPopupArrow").hide(),Crm.isRecordModified=!1,$(".eventActionsMenu a, .quickCreateLink a").removeClass("quickCreateLinkAct"),$("body").removeClass("oH"),Events.moduleName="Events",Events.module="Events",Events.movePVInitialvalue(),Crm.isHeadless||1!=Crm.userDetails.detailView_newUI||null==Crm.userDetails.detailView_newUI||(detailView.btnRemoveClassSelected(!0),detailView.atnRemoveClassSelected(!0))},closeOnboarding:function(){$("#eventCreationInnerDiv").off("scroll.ArrowVisibility"),$(".eventsOnboarding").remove(),$(".markBlueDot").hide(),$("#eventPopupArrow").show()},getCurrEventjson:function(){var e=$("#Crm_Events_STARTDATETIME").data("dateObj").getTime(),t=$("#Crm_Events_ENDDATETIME").data("dateObj").getTime(),a=$("#Crm_Events_SMOWNERID").data("id"),i=$("#Crm_Events_SMOWNERID").val(),n=$("#Crm_Events_SUBJECT").val(),r=$("#Crm_Events_ALLDAYEVENT").is(":checked"),s=$("#selectColorComponent").css("background-color");return s&&(s=Events.rgbtohex(s)),{activityType:"Events",start:e,end:t,host:a,title:n,allday:r,hostName:i,color:s}},getCurrAppointmentjson:function(e){var t=$("#Crm_Appointments_APPOINTMENTDATEANDTIME").data("dateObj").getTime(),a=60*JSON.parse($("#Crm_Appointments_SERVICEID").attr("serviceJSON")).Duration*1e3,i=new Date(t+a).getTime(),n=$("#Crm_Appointments_SMOWNERID").data("id"),r=$("#Crm_Appointments_SMOWNERID").val();return{activityType:"Appointments",start:t,end:i,host:n,title:e.title,allday:!1,hostName:r}},isEventModified:function(e,t){var a=!1;return e&&(e.start===t.start&&e.end===t.end&&e.host===t.host&&e.title===t.title&&e.allday===t.allday&&e.color===t.color||(a=!0)),a},isEventTimeModified:function(e,t){var a=!1;return e&&(e.start===t.start&&e.end===t.end&&e.allday===t.allday||(a=!0)),a},isRefreshNeeded:function(e,t,a){if(calView.needRefresh=!1,a){var i=new Date(e.start),n=new Date(e.end),r=new Date(i.getFullYear(),i.getMonth(),i.getDate()),s=new Date(n.getFullYear(),n.getMonth(),n.getDate()),o=$.datepicker.formatDate("yy-mm-dd",v),l=$.datepicker.formatDate("yy-mm-dd",p),d=(s.getTime(),r.getTime(),Utils.getDayDiff(s,r));for(o!==l&&0===s.getHours()&&0===s.getMinutes()&&d--,k=0;k<d;k++){var c=$.datepicker.formatDate("yy-mm-dd",r);if(Events.eventsCntDatewise[c]>4){calView.needRefresh=!0;break}Events.eventsCntDatewise[c]--,r.setDate(r.getDate()+1)}}if(!calView.needRefresh){var m=new Date(t.start),u=new Date(t.end),v=new Date(m.getFullYear(),m.getMonth(),m.getDate()),p=new Date(u.getFullYear(),u.getMonth(),u.getDate()),h=$.datepicker.formatDate("yy-mm-dd",v),g=$.datepicker.formatDate("yy-mm-dd",p);d=Utils.getDayDiff(p,v);for(h!==g&&0===p.getHours()&&0===p.getMinutes()&&d--,k=0;k<d;k++){c=$.datepicker.formatDate("yy-mm-dd",v);if(Events.eventsCntDatewise[c]>4){calView.needRefresh=!0;break}Events.eventsCntDatewise[c]++,v.setDate(v.getDate()+1)}}return calView.needRefresh},addCallToCalendar:function(e){var t=JSON.parse(e);if(t.eventObj){var a=t.entityId,i=t.eventObj;if(showAlertMessage("bulkUpdateSuccess",!0,I18n.getMsg("crm.call.sheduled.success.msg"),1e3),calView.isMultiUserView){var n=t.userImg;n||(n=""+networkUtils.getImageUrl("nophoto_80ea3af_.png",ResourceConstants.CRM)),Events.userImgSrc=n,"dayview"===calView.currCalView?Events.handleEvtAddinMulUserDayView(a,void 0,i):"weekview"===calView.currCalView?Events.handleEvtAddinMulUserWeekView(a,void 0,i):Events.handleEvtAddinMulUserMonthView(a,void 0,i)}else i.ownerId.toString()===calView.currCalSelusr&&$("#calendarBd").fullCalendar("renderEvent",i);Q.close()}},saveEntity:function(e,t,a,i){var n=$("#eventCreateErrorRespDiv");if($("#saveEventsBtn").attr("disabled","disabled"),""==$("#Crm_Events_SUBJECT").val()&&$("#saveEventsBtn").removeAttr("disabled"),Events.hideObjId&&($("#"+Events.hideObjId).hide().trigger("onBeforeClose"),Events.hideObjId=void 0),"calendar"!==Events.createSource&&$("#calSelUserHeader").is(":visible")&&(Events.createSource="calendarGlobelAdd"),"calendar"===i){Events.createSource="calendar",Events.currentStatus="create";Crm.requestParam.eventCreateFrom="calendar",$("#saveEventsBtn").attr("onclick","Events.saveEntity(event)")}if(Crm.requestParam.sendNotificationMail=Events.sendNotificationMail,t&&!a){var r=trimBoth($("#Crm_Events_SUBJECT").val()),s=this.status,o={title:r,start:$("#Crm_Events_STARTDATETIME").data("dateObj"),status:s};if(returnVal=Events.showSendMailAlert(o),!returnVal)return!0}"stageView"===Events.createSource&&$("#lv_left_filter").length&&0===$("#lv_left_filter").find('input[type=checkbox][data-name="Activities"]:checked').length&&(Crm.requestParam.fetchUpcomingActivities=!0);var l=$("#meetingInclude");if(l.prop("checked")&&l.is(":visible")){$("#Events_fldRow_ALLDAYEVENT").is(":visible")||$("#Crm_Events_ALLDAYEVENT").prop("checked",!1);var d=$("#Crm_Events_MeetingSolutions_select option:selected").attr("name");if(!Events.getInstalledMeetingTools().contains(d)&&!JSON.stringify(Events.meetingConfZuid).indexOf(d))return crmui.showMsgBand("error",I18n.getMsg("crm.meeting.disable.provider.errMsg",[d]),"2000"),!1;if(0==Events.changeLocationValue("SaveEntity"))return!1}if(Events.selInviteesCnt>Events.inviteeslimit&&Events.isFutureEvent())return Events.showInvExceedPopup(),!1;Crm.saveEntity(e,this.moduleName,(function(e,t){if($(".temp_freezelayer").length>0&&!($("#signalDetailViewClose").length>0&&$("#ntcInnerDivContent").length>0)&&reloadActivityRL(),Crm.trackSpotLightAction("Event - Added"),n.hide(),"stageView"===Events.createSource)!e||t||e.error||validationUtils.isEmpty(e)?t||crmListView.refreshRecords($(Q.currElem).attr("data-relid")):crmListView.updateUpComingActions(e),Events.closeEntity();else if(!e||t||e.error){if(e.errorCode)Events.showMeetingErrorMsg(),mailsetCenter("meetingBuy");else{if("edit"!=Events.currentStatus)if(e.errMsg)if("Invalid Refresh Token"==e.errMsg)Events.eventMeetingReAuthorize(e);else if("NOT_AUTHORIZED"==e.errMsg){var a=e.hostUserName;renderingUtils.showAlertMsg(I18n.getMsg("crm.event.meeting.host.notauthorize.alert.new",[a,e.toolName,Crm.appName]),"warning",I18n.getMsg("crm.button.ok"),(function(){var e=document.getElementById("lyteAlertMsg");e||(e=Lyte.Component.render("lyte-alert",{id:"lyteAlertMsg",ltPropButtonPosition:"center",ltPropAllowMultiple:"true",ltPropButtons:I18n.getMsg("crm.button.ok"),ltPropContentAlign:"center"},"body")),e.ltProp("wrapperClass","changeHostAlert"),$("#lyteAlertMsg").attr("lt-prop-show-close-button",!1)})),Crm.userDetails.MEETING_BRIDGE_ENABLED&&Events.sendAuthorizationNotificationToHost(e.toolName,e.hostUserId)}else crmui.showMsgBand("error",$ESAPI.encoder().encodeForHTML(I18n.getMsg(e.errMsg)),6e3);else n.html(I18n.getMsg("crm.event.create.error.msg")).show();else if(e.errMsg)if("Invalid Refresh Token"==e.errMsg)Events.eventMeetingReAuthorize(e);else if("NOT_AUTHORIZED"==e.errMsg){a=e.hostUserName;renderingUtils.showAlertMsg(I18n.getMsg("crm.event.meeting.host.notauthorize.alert.new",[a,e.toolName,Crm.appName]),"warning",I18n.getMsg("crm.button.ok"),(function(){var e=document.getElementById("lyteAlertMsg");e||(e=Lyte.Component.render("lyte-alert",{id:"lyteAlertMsg",ltPropButtonPosition:"center",ltPropAllowMultiple:"true",ltPropButtons:I18n.getMsg("crm.button.ok"),ltPropContentAlign:"center"},"body")),e.ltProp("wrapperClass","changeHostAlert"),$("#lyteAlertMsg").attr("lt-prop-show-close-button",!1)})),Crm.userDetails.MEETING_BRIDGE_ENABLED&&Events.sendAuthorizationNotificationToHost(e.toolName,e.hostUserId)}else crmui.showMsgBand("error",$ESAPI.encoder().encodeForHTML(I18n.getMsg(e.errMsg)),6e3);else n.html(I18n.getMsg("crm.event.edit.error.msg",[Events.getModuleName(!0,!1,!0)])).show();$("#eventCreationDiv").scrollTo(n)}"callPopup"==i&&Events.closeEntity()}else{if(!Crm.isHeadless)if(detailView.currentStatus=Events.currentStatus,crmNTC.isSignalDetailViewVisible()||SalesSignalsWrapper.isSignalIFrameOpen)crmNTC.showQuickCreateSuccessMsg(e);else if(document.getElementById("iskanbanview")&&"true"==document.getElementById("iskanbanview").value||"Appointments"===e.module||"JobSheets"===e.module)if("Appointments"===e.module){if(Crm.requestApp2)return void("calendar"!==Events.createSource&&"calendarGlobelAdd"!==Events.createSource||(Crm.calJSON=e));if(crmui.hidePopup("appointmentCreate"),"edit"===Events.currentStatus)crmui.showMsgBand("success",I18n.getMsg("crm.appointments.edit.success.msg",$ESAPI.encoder().encodeForHTML(moduleRecordMapping.Appointments.singular_label)),4e3);else{var r="krp"===Events.createSource?e.appId:e.entityId,s="<a target='_blank' href='"+(RebrandLinkUtil.getProperty("URLPROTOCOL")+"://"+RebrandLinkUtil.getProperty("CRMURL")+Crm.getCrmBasePath()+"/tab/Appointments/"+r)+"' >"+I18n.getMsg("crm.invitation.view.details.label")+"</a>";crmui.showMsgBand("success",I18n.getMsg("crm.appointments.create.success.msg",[$ESAPI.encoder().encodeForHTML(moduleRecordMapping.Appointments.singular_label),s]),4e3)}}else if("JobSheets"===e.module&&Crm.appId){crmui.hidePopup("jobSheetCreateDiv"),$("#FreezeLayer").css("z-index","19"),"calendar"===Events.createSource?$("#qCreate").hide():crmui.hidePopup("appointmentCreate"),hideFreezeLayer();s="<a target='_blank' href='"+(RebrandLinkUtil.getProperty("URLPROTOCOL")+"://"+RebrandLinkUtil.getProperty("CRMURL")+Crm.getCrmBasePath()+"/tab/Appointments/"+Crm.appId)+"' >"+I18n.getMsg("crm.invitation.view.details.label")+"</a>";if(crmui.showMsgBand("success",I18n.getMsg("crm.appointments.create.success.msg",[$ESAPI.encoder().encodeForHTML(moduleRecordMapping.Appointments.singular_label),s]),4e3),delete Crm.requestApp,delete Crm.appFormRule,window.Appointments&&"clone"===window.Appointments.currentStatus)return Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:["Appointments",Crm.appId]}),void delete Crm.appId;delete Crm.appId}else"JobSheets"===e.module?(crmui.hidePopup("jobSheetCreateDiv"),$("#FreezeLayer").css("z-index","19"),Events.jobSheetMAC?CSU.markAsCompleteAppointment():"edit"===Events.currentStatus?(crmui.showMsgBand("success",I18n.getMsg("crm.jobsheets.edit.success.msg"),4e3),hideFreezeLayer()):"create"!==Events.currentStatus||Events.jobSheetMAC||(crmui.showMsgBand("success",I18n.getMsg("crm.jobsheets.create.success.msg"),4e3),hideFreezeLayer())):detailView.refreshInWms||Events.showEventSuccessMessage(Events.currentStatus,i,!0,e.entityId);else detailView.refreshInWms||Events.showEventSuccessMessage(Events.currentStatus,i,!1,e.entityId);if("calendar"===Events.createSource||"calendarGlobelAdd"===Events.createSource){var o="JobSheets"===e.module&&Crm.calJSON?Crm.calJSON:e;if(delete Crm.calJSON,o.eventObj||"Appointments"===o.module&&0!==Crm.calPreferences.ACTIVITYTYPE&&1!==Crm.calPreferences.ACTIVITYTYPE&&2!==Crm.calPreferences.ACTIVITYTYPE){var l,d=o.entityId,c=(Events.status,$("#Crm_Events_REPEATTYPE").val()),m=Events.modifyingEvent;l="Appointments"===o.module?Events.getCurrAppointmentjson(o.appointmentObj):Events.getCurrEventjson(),void 0===o.color&&o.eventObj&&(o.eventObj.color=l.color);var u=Events.isEventTimeModified(m,l),v=Events.isEventModified(m,l);if(calView.isMultiUserView){var p=o.userImg;if(p||(p="/nophoto_80ea3af_.png"),Events.userImgSrc=p,"dayview"===calView.currCalView?"edit"===Events.currentStatus?v&&Events.handleEvtAddinMulUserDayView(d,m,l):Events.handleEvtAddinMulUserDayView(d,void 0,l):"weekview"===calView.currCalView?"edit"===Events.currentStatus?v&&Events.handleEvtAddinMulUserWeekView(d,m,l):Events.handleEvtAddinMulUserWeekView(d,void 0,l):"edit"===Events.currentStatus?v&&Events.handleEvtAddinMulUserMonthView(d,m,l):Events.handleEvtAddinMulUserMonthView(d,void 0,l),u)Events.closeQuickView();else{Events.eventQuickView(l.activityType,d,void 0,void 0,!0,!1,!1,l.invitedby);var h=$("#dCMU_"+d),g=h.find(".activitesColor");if(g.length>0&&o.eventObj.color)g.css("background-color",o.eventObj.color);else if(o.eventObj.color){var C='<span class="activitesColor act_mul_week" data-zcqa="weekViewcolor_'+$ESAPI.encoder().encodeForHTML(o.eventObj.title)+'" style="background:'+o.eventObj.color+'"></span>';h.append(C)}else!o.eventObj.color&&g.length>0&&g.remove()}"Appointments"===o.module&&CSU.hideAppointment_calendar()}else{var f,E=new Date(l.start),I=new Date(l.end);f="Appointments"===o.module?o.appointmentObj:o.eventObj,1==l.allday&&(E=new Date(E),I=new Date(Utils.getDateInUserDatePattern(I)),I=new Date(I.getTime()+86399998),f.durationEditable=!1),"monthview"===calView.currCalView&&(calView.needRefresh=Events.isRefreshNeeded(m,f,"edit"===Events.currentStatus));var y=Events.currentStatus;if(m&&m.host+""==f.ownerId+""&&(calView.needRefresh=!0),c&&"none"!==c)calView.needRefresh=!0;else if("edit"===y&&Events.currentEventObjectInQV&&"true"===Events.currentEventObjectInQV.isRecEvent)calView.refresh(u,Events.currentEventObjectInQV.id);else{if("edit"===Events.currentStatus){if(v&&($("#calendarBd").fullCalendar("removeEvents",d),m.host+""==f.ownerId+""?$("#calendarBd").fullCalendar("renderEvent",f):Events.closeQuickView()),u?Events.closeQuickView():Events.eventQuickView(f.activityType,d,void 0,void 0,!0,!1,!1,l.invitedby),"calendar"===Events.createSource&&"monthview"===calView.currCalView&&Events.currentEventObjectInQV){var R=Events.currentEventObjectInQV.scrollTop;R&&setTimeout((function(){$(window).scrollTop(R)}),0)}}else"edit"!==Events.currentStatus&&f.ownerId.toString()===calView.currCalSelusr&&$("#calendarBd").fullCalendar("renderEvent",f);"Appointments"===o.module&&CSU.hideAppointment_calendar()}calView.needRefresh&&calView.refresh()}}}else if("listview"==Events.createSource)Crm.latestEntId=e.entityId,"Appointments"===Events.moduleName&&($("#appointmentCreationInnerDiv").empty(),crmui.hidePopup("appointmentCreate")),Lyte.Router.getRouteInstance().refresh();else if("detailView"==Events.createSource)if(!Crm.isHeadless&&detailView.refreshInWms)detailView.hideElementsForKafkaWorkFlow("Events");else if("Appointments"===Events.moduleName)$("#appointmentCreationInnerDiv").empty(),crmui.hidePopup("appointmentCreate"),Lyte.Router.getRouteInstance().refresh();else if("JobSheets"===Events.moduleName){$("#jobSheetCreateDivFields").empty(),crmui.hidePopup("jobSheetCreateDiv"),$("#FreezeLayer").css("z-index","19"),hideFreezeLayer();var b=getObj("module").value,T="undefined"==typeof entityId?$("#entityId").val():"object"==typeof entityId?$(entityId).val():entityId,D={module:b,id:T};crmRelatedList.ajaxReq(D)}else reloadCurrentEntityView(e.entityId,"Events");else if("relatedlist"==Events.createSource||"rightpannel"==Events.createSource||"relatedlist_new"==Events.createSource||"relatedlist_meetnow"==Events.createSource){var w=document.getElementById("iskanbanview");if(!w||"true"!=w.value){getElemById("relatedPageContent"),b=getObj("module").value,T="undefined"==typeof entityId?$("#entityId").val():"object"==typeof entityId?$(entityId).val():entityId;"relatedlist_new"==Events.createSource||"relatedlist_meetnow"==Events.createSource?setTimeout((function(){var t={module:b,id:T,fromIndex:1};if(crmRelatedList.ajaxReq(t,void 0,!1),crmui.hidePopup("appointmentCreate"),"canvas"==Lyte.Router.getRouteInstance().routeName&&"entity"==Lyte.Router.getRouteInstance().parent.routeName&&Lyte.triggerEvent("relatedList",{refresh:!0}),refreshFollowDiv(b,"Events"),"relatedlist_meetnow"==Events.createSource)if(e.meetingStartUrl){var a=I18n.getMsg("crm.label.popup.blocker.msg.startmeeting.new",Crm.appName)+" <a target='_blank' onclick='hideAnimatePopup('custom_alert_popup')' href='"+e.meetingStartUrl+"' rel='noopener noreferrer'>"+I18n.getMsg("crm.event.start.meeting")+"</a>";networkUtils.openUrlwithpopBlockerHandle(e.meetingStartUrl,a)}else if("TeamVMeeting"==e.meetingToolName){a=I18n.getMsg("crm.label.popup.blocker.msg.startmeeting.new",Crm.appName)+" <a target='_blank' onclick='hideAnimatePopup('custom_alert_popup')' href='"+RebrandLinkUtil.getProperty("TEAMVIEWER_DOWNLOAD_URL")+"' rel='noopener noreferrer'>"+I18n.getMsg("crm.event.start.meeting")+"</a>";window.location="teamviewer8://",setTimeout((function(){networkUtils.openUrlwithpopBlockerHandle(RebrandLinkUtil.getProperty("TEAMVIEWER_DOWNLOAD_URL")+"",a)}),5e3)}else{(new crmRequestPool).initiate({type:"POST",url:Crm.getCrmBasePath()+"/events/EventAction.do",data:"type=startMeeting&toolName="+e.meetingToolName+"&meetingid="+e.meetingid+"&eventId="+e.entityId+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),success:function(e){networkUtils.openUrlwithpopBlockerHandle(e)}})}}),1e3):$.ajax({url:Crm.getCrmBasePath()+"/NewRelatedList.do?action=getAllData&module="+getObj("module").value+"&id="+T,type:"POST",success:function(t){crmRelatedList.load(crmRelatedList.Module,crmRelatedList.EntityId,e,!0),refreshFollowDiv(b,"Events"),Events.createSource=void 0,"canvas"==Lyte.Router.getRouteInstance().routeName&&"entity"==Lyte.Router.getRouteInstance().parent.routeName&&Lyte.triggerEvent("relatedList",{res:e})}})}}else if("homePage"==Events.createSource){if("Appointments"===e.module){var M=$("#applayoutId").html();return void(M&&$("#datafetchdate_"+M)[0].click())}var S=getElemById("show");$(S).empty(),$(S)[0].innerHTML=e,EvalInnerScript(S)}else"krp"===Events.createSource&&$$rightPanel.refreshOnCreatingNewEntity("Activities",e);Events.closeEntity()}if(this.currentStatus=void 0,Crm.isHeadless)if(t)WindowsCommunicator.notifyParent("cancel-operation");else{var L=new BasicEntityInfo(Events.moduleName,e.entityId,e.name);WindowsCommunicator.notifyParent("crm-followup-create",L)}}),t),setTimeout((function(){var e=$("#checkDuplicateEvent");$("#errorMsg_Crm_Events_ENDDATETIME").is(":visible")?e.addClass("pT15"):e.removeClass("pT15")}),500),Events.movePVInitialvalue(),Events.closeOnboarding()},showMeetingErrorMsg:function(){var e={},t="Administrator"==Crm.userDetails.PROFILE_NAME;e.isOrgAdmin=t,e.crmAppName=Crm.appName,e.brandName=Crm.defaultBrandName;var a=$(Handlebars.templates.eventMeetingErrorPop(e));$("body").append(a),renderingUtils.dummyBackground(!1,"meetingBuy"),mailsetCenter("meetingBuy")},showEventSuccessMessage:function(e,t,a,i){if("edit"!=e){if("callPopup"!==t){var n=RebrandLinkUtil.getProperty("CRMURL");window.isSandboxAcc&&"true"==window.isSandboxAcc&&(n=RebrandLinkUtil.getProperty("SANDBOXURL"));Crm.isActivitySplitDone?RebrandLinkUtil.getProperty("URLPROTOCOL")+"://"+n+Crm.getCrmBasePath()+"/tab/Events/"+i:RebrandLinkUtil.getProperty("URLPROTOCOL")+"://"+n+Crm.getCrmBasePath()+"/tab/Activities/"+i+"?sub_module=Events";var r="<a target='_blank' href='"+(RebrandLinkUtil.getProperty("URLPROTOCOL")+"://"+n+Crm.getCrmBasePath()+"/tab/Activities/"+i+"?sub_module=Events")+"' >"+I18n.getMsg("crm.invitation.view.details.label")+"</a>";crmui.showMsgBand("success",I18n.getMsg("crm.event.create.success.msg.viewdetails",[r,Events.getModuleName(!0,!0,!0)]),4e3),$("#qCreate").hasClass("ziaForEmailsCheck")&&validation.updateEventCreatedInfo();var s=$("#upcoming");a&&s&&s.hasClass("liselected")&&s.click()}}else crmui.showMsgBand("success",I18n.getMsg("crm.event.edit.success.msg",[Events.getModuleName(!0,!0,!0)]),4e3)},showEventRelatedToOptions:function(e,t,a){var i=$("#addpartCheck"),n=$("#Crm_Events_CONTACTID"),r=$("#Crm_Events_SEID");if(e){$("#errorMsg_Crm_Events_CONTACTID").remove(),$("#errorMsg_Crm_Events_SEID").remove(),n.removeClass("errorHighlight").css({"border-color":""});var s=$(e).val();if("Others"==s)n.closest("div").parents("div").eq(0).hide(),r.closest("div").parents("div").eq(0).css("display",""),n.data("id","").val("");else if("Leads"==s){n.closest("div").parents("div").eq(0).css("display",""),$("#Crm_Events_CONTACTID_img").data("lookupModule",s).show(),n.data("lookupModule",s),crmTab.tabList.contains(s)||$("#Crm_Events_CONTACTID_img").hide(),r.closest("div").parents("div").eq(0).hide();var o=Crm.moduleInfo[s].translatedSingularLabel;if($("#Crm_Events_CONTACTID_labSpan").text(o),t){var l=Crm.moduleInfo[s].singularLabel;n.val("").data("id","").data("displaylabel",l),r.val("").data("id",""),crmTab.tabList.contains("Accounts")&&$("#Crm_Events_SEID_label_select").val("Accounts")}}else if("Contacts"==s){o=Crm.moduleInfo[s].translatedSingularLabel;if($("#Crm_Events_CONTACTID_labSpan").text(I18n.getMsg(o)),n.closest("div").parents("div").eq(0).css("display",""),$("#Crm_Events_CONTACTID_img").data("lookupModule",s).show(),n.data("lookupModule",s),crmTab.tabList.contains(s)||$("#Crm_Events_CONTACTID_img").hide(),("relatedlist_new"==Events.createSource||"relatedlist_meetnow"==Events.createSource)&&null!=$("#subvalue_ACCOUNTID").html()&&""!=$("#subvalue_ACCOUNTID").html()){if(""!=$("#subvalue_ACCOUNTID").text()){var d=$("#subvalue_ACCOUNTID").data("params").module;"false"==Crm.moduleInfo[d].isVisible&&""!=d&&($("#Crm_Events_SEID_label_select").append("<option value="+d+">"+d+"</option>"),$("#Crm_Events_SEID_label_select").val(d),$("select[name='property(modsel)'] option[value='"+d+"']").prop("selected",!0))}else"true"!=Crm.moduleInfo.Accounts.isVisible&&$("#Events_fldRow_SEID").remove()}if(r.closest("div").parents("div").eq(0).css("display",""),t){l=Crm.moduleInfo[s].singularLabel;n.val("").data("id","").data("displaylabel",l)}if("krp"==Events.createSource&&null==typeof requestFromEmailClient){var c=returnJson.entityMapJson.SEID.defaultid;c&&"null"!=c&&(r.val(returnJson.entityMapJson.SEID.defaultvalue),r.data("id",c))}}else n.closest("div").parents("div").eq(0).hide(),r.closest("div").parents("div").eq(0).hide(),r.val("").data("id",""),crmTab.tabList.contains("Accounts")&&$("#Crm_Events_SEID_label_select").val("Accounts"),n.val("").data("id","");if("Contacts"!=s&&"Leads"!=s&&i.hide(),"Contacts"==s||"Leads"==s){var m=n.data("id")+"";(g=$("#addpartCheckbox")).attr("module",s),g.attr("onclick","Events.addRelatedParticipant($(this),'"+m+"','"+s+"')");var u=[n.val()],v=I18n.getMsg("crm.event.add.contact",u);$("#addpartCheckboxTitle").text(v),0==$("#Events_fldRow_PARTICIPANTID").length&&i.hide(),"relatedlist_meetnow"==Events.createSource&&($("#showMoreFiledsLink").remove(),$("#saveEventsBtn").val(I18n.getMsg("crm.event.start.meeting")),($("#social_dmm_group").length>0||"canvas"===Lyte.Router.getRouteInstance().routeName)&&(g.prop("checked",!0),Events.addRelatedParticipant(g,m,s)),i.hide())}else if(!s&&("relatedlist_meetnow"==Events.createSource||Events.scheduleOnlineEvent)){if($("#showMoreFiledsLink").remove(),"relatedlist_meetnow"==Events.createSource&&$("#saveEventsBtn").val(I18n.getMsg("crm.event.start.meeting")),$("#social_dmm_group").length>0||"canvas"===Lyte.Router.getRouteInstance().routeName){var p=$("#id").val(),h=$("#module").val(),g=$("<input id='addpartCheckbox' style='display:none' recId='"+p+"' module= '"+h+"' type='checkbox' checked />");$("body").append(g),Events.addRelatedParticipant(g,p,h)}Events.scheduleOnlineEvent=!1}}else n.closest("div").parents("div").eq(0).hide(),r.closest("div").parents("div").eq(0).hide(),r.val("").data("id",""),crmTab.tabList.contains("Accounts")&&$("#Crm_Events_SEID_label_select").val("Accounts"),n.val("").data("id","");if(t){var C=n.data(),f=C.lookupModule;if(f===e.value&&(n.val(C.oldValue),n.data("id",C.oldId)),(C=r.data())&&(f=C.lookupModule)===$("#Crm_Events_SEID_label_select").val()){r.val(C.oldValue).data("id",C.oldId);l=Crm.moduleInfo[f].singularLabel;r.data("displaylabel",l)}i.hide()}r.length>0&&r.attr({"data-selectedlookupvalue":r.val(),"data-selectedid":r.data().id}),n.length>0&&n.attr({"data-selectedlookupvalue":n.val(),"data-selectedid":n.data().id}),thirdPartyUtils.bindSelect2($("#Crm_Events_SEID_label_select")),Events.invitationLimitValidation(!0,void 0,void 0,t?"onChange":void 0,a)},constructRecurringEnd:function(e,t){var a={colname:"RECURRING_END_NEVER",customfield:"false",displaylabel:I18n.getMsg("Ends"),val:[{html:I18n.getMsg("crm.databackup.backupends.none"),value:"1"}],label:"endRadioOption",mandate:"true",maxlength:"120",readonly:"false",type:"radio",uitype:"17",defaultvalue:"1"},i=crmTemplate.createFieldRow(1,"Events",i,a);e.append(i),a={colname:"RECURRING_END_NOOFTIMES",customfield:"false",displaylabel:"",val:[{html:I18n.getMsg("crm.recurring.after.times"),value:"2"}],label:"endRadioOption",mandate:"false",maxlength:"120",readonly:"false",type:"radio",uitype:"17",dynamicFields:[{colname:"RECURRING_REPEAT_COUNT",customfield:"false",defaultvalue:1,displaylabel:"",label:"repeatEndCount",mandate:"false",maxlength:"2",readonly:"false",type:"int",uitype:"32"}]},i=crmTemplate.createFieldRow(1,"Events",i,a),$(i).attr("height","5px"),e.append(i);var n=new Date;"daily"===t?n.setDate(n.getDate()+1):"monthly"===t?n.setMonth(n.getMonth()+1):"weekly"===t?n.setDate(n.getDate()+7):n.setYear(n.getFullYear()+1),a={colname:"RECURRING_END_ON",customfield:"false",displaylabel:"",val:[{html:I18n.getMsg("crm.recurring.end.date.on"),value:"3"}],label:"endRadioOption",false:"true",maxlength:"120",readonly:"false",type:"radio",uitype:"17",dynamicFields:[{colname:"RECURRING_END_DATE",defaultvalue:n,customfield:"false",displaylabel:"",label:"repeatEndDate",mandate:"false",maxlength:"120",readonly:"false",type:"date",uitype:"24"}]},i=crmTemplate.createFieldRow(1,"Events",i,a),$(i).attr("height","5px"),e.append(i)},showPeriodDetails:function(e){var t=e.value,a=$("#Events_fldRow_REPEATTYPE");a.nextAll().remove();var i=$(document.createDocumentFragment());switch(t){case"none":break;case"custom":var n={colname:"RECURRING_FREQUENCY",customfield:"false",displaylabel:I18n.getMsg("crm.calendar.freq"),val:[{html:I18n.getMsg("Daily"),value:"daily",attr:{repeatLab:"crm.recurring.no.days"}},{html:I18n.getMsg("Weekly"),value:"weekly",attr:{repeatLab:"crm.recurring.no.weeks"}},{html:I18n.getMsg("Monthly"),value:"monthly",attr:{repeatLab:"crm.recurring.no.months"}},{html:I18n.getMsg("Yearly"),value:"yearly",attr:{repeatLab:"crm.recurring.no.years"}}],label:"period",mandate:"false",maxlength:"120",readonly:"false",type:"radio",uitype:"28"},r=crmTemplate.createFieldRow(1,"Events",r,n);$(r).insertAfter(a),a=r,recDropDown=$(a).find("select").eq(0),Events.showFrequencyDetails(recDropDown);break;case"daily":Events.createEditJson.isBusinessHoursCreated&&(n={colname:"EXCEPT_BUSINESS_HOLIDAY",customfield:"false",displaylabel:"",val:[{html:I18n.getMsg("bh.except.week.holidays"),value:undefined}],label:"exceptHoliday",mandate:"false",maxlength:"120",readonly:"false",type:"checkbox",uitype:"18"},r=crmTemplate.createFieldRow(1,"Events",r,n),i.append(r)),"daily"==t&&this.constructRecurringEnd(i,t),i.insertAfter(a);break;case"weekly":case"yearly":case"monthly":this.constructRecurringEnd(i,t),n={colname:"RECURRING_INVITATIONMAIL",customfield:"false",displaylabel:" ",val:[{value:I18n.getMsg("crm.event.recurring.turnon.msg",[Events.getModuleName(!1,!1,!0)]),html:I18n.getMsg("crm.event.invitation.mail",[Events.getModuleName(!0,!1,!0)])}],label:"invitationMail",mandate:"false",maxlength:"120",readonly:"false",type:"checkbox",uitype:"18"},r=crmTemplate.createFieldRow(1,"Events",r,n),i.append(r),i.insertAfter(a)}},showFrequencyDetails:function(e){var t=$("#Events_fldRow_RECURRING_FREQUENCY");t.nextAll().remove();var a=e.val(),i=$(document.createDocumentFragment());switch(a){case"daily":case"weekly":case"monthly":case"yearly":var n={colname:"RECURRING_PERIODS_NO",customfield:"false",displaylabel:I18n.getMsg("crm.databackup.repeat.every"),val:I18n.getMsg({daily:"crm.recurring.no.days",weekly:"crm.recurring.no.weeks",monthly:"crm.recurring.no.months",yearly:"crm.recurring.no.years"}[a]),label:"daily11",mandate:"false",maxlength:"120",readonly:"false",type:"text",uitype:"60",dynamicFields:[{colname:"RECURRING_CUSTOM_PERIODS_COUNT",defaultvalue:"1",customfield:"false",displaylabel:"",label:"repeatEveryCnt",mandate:"true",maxlength:"2",readonly:"false",type:"int",uitype:"32"}]},r=crmTemplate.createFieldRow(1,"Events",r,n);if(i.append(r),"daily"==a&&Events.createEditJson&&Events.createEditJson.isBusinessHoursCreated){n={colname:"EXCEPT_BUSINESS_HOLIDAY",customfield:"false",displaylabel:"",val:[{html:I18n.getMsg("bh.except.week.holidays"),value:"true"}],label:"exceptHoliday",mandate:"false",maxlength:"120",readonly:"false",type:"checkbox",uitype:"18",isBusHoliday:!0};r=crmTemplate.createFieldRow(1,"Events",r,n);i.append(r)}if("weekly"==a)n={colname:"RECURRING_CUSTOM_WEEK_REPEAT_ON",customfield:"false",displaylabel:I18n.getMsg("crm.recurring.week.repeat.on"),val:this.weekDaysDropdownObj,label:"selectedWeekDays",mandate:"true",maxlength:"120",readonly:"false",type:"multipicklist",uitype:"100"},r=crmTemplate.createFieldRow(1,"Events",r,n),i.append(r);else if("monthly"==a){n={colname:"RECURRING_CUSTOM_MONTH_REPEAT_ON",customfield:"false",displaylabel:I18n.getMsg("crm.recurring.week.repeat.on"),val:[{html:I18n.getMsg("crm.recurring.custom.day.choose"),value:"1"}],label:"monthlyhidden",mandate:"true",defaultvalue:"1",maxlength:"120",readonly:"false",type:"radio",uitype:"17",dynamicFields:[{colname:"RECURRING_CUSTOM_MONTH_REPEAT_ON_DAY",customfield:"false",displaylabel:I18n.getMsg("crm.calendar.freq"),val:this.recDateArrray,label:"monthly1select",mandate:"false",maxlength:"120",readonly:"false",type:"radio",uitype:"28"}]};r=crmTemplate.createFieldRow(1,"Events",r,n);if(i.append(r),Events.createEditJson&&Events.createEditJson.isBusinessHoursCreated){n={colname:"NEXT_BUSINESS_HOLIDAY",customfield:"false",displaylabel:"",val:[{html:I18n.getMsg("bh.next.business.holiday",[Events.getModuleName(!1,!1,!0)]),value:"true"}],label:"exceptBus_Holiday",mandate:"false",maxlength:"120",readonly:"false",type:"checkbox",uitype:"18",isBusHoliday:!0};r=crmTemplate.createFieldRow(1,"Events",r,n)}i.append(r),n={colname:"RECURRING_CUSTOM_MONTH_REPEAT_ON_1",customfield:"false",displaylabel:"",val:[{html:I18n.getMsg("crm.common.two.dynamic.value"),value:"2"}],label:"monthlyhidden",mandate:"false",maxlength:"120",readonly:"false",type:"radio",uitype:"17",dynamicFields:[{colname:"RECURRING_CUSTOM_OCCUR_FIRST",customfield:"false",displaylabel:"",val:Events.numberStringArray,label:"weeksequence",mandate:"false",maxlength:"120",readonly:"false",type:"radio",uitype:"28"},{colname:"RECURRING_CUSTOM_OCCUR_DAY",customfield:"false",displaylabel:"",val:this.weekDaysDropdownObj,label:"weekdays",mandate:"false",maxlength:"120",readonly:"false",type:"radio",uitype:"28"}]};r=crmTemplate.createFieldRow(1,"Events",r,n);i.append(r)}else if("yearly"==a){for(var s=$("#Crm_Events_STARTDATETIME").data("dateObj"),o=Utils.getMonthEnd(s.getMonth(),s.getFullYear()),l=crmConstants.dateArray.slice(0),d=l.length-1;d>0&&o!==l[d];d--)l.splice(d,1);var c=crmCalendar.monthName[s.getMonth()].html;n={colname:"RECURRING_CUSTOM_YEAR_REPEAT_ON",customfield:"false",displaylabel:I18n.getMsg("crm.recurring.custom.yearly.repeat.on",I18n.getMsg([c])),val:[I18n.getMsg("crm.common.two.dynamic.value")],label:"daily11",mandate:"false",maxlength:"120",readonly:"false",type:"radio",uitype:"60",dynamicFields:[{colname:"RECURRING_CUSTOM_YEAR_REPEAT_FIRST",customfield:"false",displaylabel:"",val:Events.numberStringArrayWidthDay,label:"weeksequence1",mandate:"false",maxlength:"120",readonly:"false",type:"radio",uitype:"28"},{colname:"RECURRING_CUSTOM_YEAR_REPEAT_DAY_DATE",customfield:"false",displaylabel:"",val:l,label:"yearlydays1select",mandate:"false",maxlength:"120",readonly:"false",type:"radio",uitype:"28"}]},r=crmTemplate.createFieldRow(1,"Events",r,n),i.append(r),Events.createEditJson&&Events.createEditJson.isBusinessHoursCreated&&(n={colname:"NEXT_BUSINESS_HOLIDAY",customfield:"false",displaylabel:"",val:[{html:I18n.getMsg("bh.next.business.holiday",[Events.getModuleName(!1,!1,!0)]),value:"true"}],label:"exceptBus_Holiday",mandate:"false",maxlength:"120",readonly:"false",type:"checkbox",uitype:"18",isBusHoliday:!0},r=crmTemplate.createFieldRow(1,"Events",r,n),i.append(r))}default:this.constructRecurringEnd(i,a),"daily"!=a&&(n={colname:"RECURRING_INVITATIONMAIL",customfield:"false",displaylabel:" ",val:[{value:I18n.getMsg("crm.event.recurring.turnon.msg",[Events.getModuleName(!1,!1,!0)]),html:I18n.getMsg("crm.event.invitation.mail",[Events.getModuleName(!0,!1,!0)])}],label:"InvitationMail",mandate:"false",maxlength:"120",readonly:"false",type:"checkbox",uitype:"18"},r=crmTemplate.createFieldRow(1,"Events",r,n),i.append(r))}$("#eventRecurringInnerDiv").scrollTo("#Crm_Events_RECURRING_FREQUENCY",300),i.insertAfter(t),thirdPartyUtils.bindSelect2("#Crm_Events_RECURRING_FREQUENCY"),thirdPartyUtils.bindSelect2($("#Crm_Events_RECURRING_CUSTOM_OCCUR_FIRST")),thirdPartyUtils.bindSelect2($("#Crm_Events_RECURRING_CUSTOM_OCCUR_DAY")),thirdPartyUtils.bindSelect2($("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_FIRST")),"weekly"==a&&thirdPartyUtils.bindSelect2("#Crm_Events_RECURRING_CUSTOM_WEEK_REPEAT_ON")},createFieldLabel:function(e,t){if("setup"==this.currentStatus)t&&t.attr({align:"right",class:"bord"});else{var a="Crm_"+this.moduleName+"_"+e.colname;if(a=a.replace(/ /g,"_"),t&&(t.removeAttr("align"),t.removeAttr("nowrap"),t.attr({class:"labelTabCreate pL5"}),"true"==e.mandate&&t.closest(".labelTabCreate").addClass("newmandatory"),e.isSystemMandate&&"true"==e.isSystemMandate&&t.find("sup").remove(),4==e.uitype&&"Who Id"==e.label)){var i=$("<span>",{id:a+"_labSpan"});i.text(I18n.getMsg(e.lookupmodule)),t.html(i),t.attr("class","labelTabCreate pL5")}}return t},createFieldContent:function(e,t){if(t.attr("align","left"),"setup"==this.currentStatus)e.defaultvalue="","SMOWNERID"===e.colname&&t.find(".customSel").css({cursor:"move","pointer-events":"none"});else{t.removeAttr("align"),t.attr("class","labelValCreate"),4==e.uitype&&t.find("input").width("160px");var a=e.uitype,i=e.colname;if("RECURRING_END_NEVER"===i||"RECURRING_END_NOOFTIMES"===i||"RECURRING_END_ON"===i)t.find("input").click((function(){$(this).data("dynamicFields");for(var e=$(this).attr("id"),t=$("input[name='"+$(this).attr("name")+"']"),a=0;a<t.length;a++){var i=$(t[a]),n=i.data("dynamicFields"),r=i.attr("id")==e?"true":"false";if(i.data("mandate",r),n&&n.length)for(j=0;j<n.length;j++){var s=$("#Crm_Events_"+n[j].colname);if(s.data("mandate",r),"false"==r){var o=s.data("oldValue");"24"===s.data("uitype")&&(o=Utils.getDateInUserDatePattern(new Date(o))),s.val(o)}}}}));else if("RECURRING_CUSTOM_WEEK_REPEAT_ON"==i)t.find("select").attr({"data-placeholder":I18n.getMsg("None"),style:"width:180px;"});else if("RECURRING_CUSTOM_MONTH_REPEAT_ON_DAY"==i||"RECURRING_CUSTOM_YEAR_REPEAT_DAY_DATE"==i){t.find(".newSelect").css({"min-width":"inherit"})}else if("RECURRING_END_NOOFTIMES"==i||"RECURRING_INVITATIONMAIL"==i||"EXCEPT_HOLIDAY"==i||"RECURRING_END_ON"==i||"RECURRING_PERIODS_NO"==i||"RECURRING_CUSTOM_MONTH_REPEAT_ON"==i||"RECURRING_CUSTOM_MONTH_REPEAT_ON_1"===i||"RECURRING_CUSTOM_YEAR_REPEAT_ON"==i){var n=$("<span>");n.append(t.contents()),t.html(n),"EXCEPT_HOLIDAY"===i&&t.css({"padding-top":"0"})}else if("RECURRING_REPEAT_COUNT"==i||"RECURRING_CUSTOM_PERIODS_COUNT"==i){var r=t.find("input[type='text']");r.removeAttr("style"),r.attr("class","textField w20 vmiddle"),"RECURRING_CUSTOM_PERIODS_COUNT"===i&&r.css({"margin-right":"5px"})}else if("RECURRING_END_DATE"==i){var s=t.find("input[type='text']");s.removeAttr("style"),s.attr("class","textField recurringEndDateField")}else if("RECURRING_CUSTOM_YEAR_REPEAT_FIRST"==i){t.find(".newSelect").css({"min-width":"inherit"}),t.find("select").first().change((function(){"Day"==$(this).val()?($("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_DAY_DATE").html(renderingUtils.createSelectBox(crmConstants.dateArray).innerHTML).data().name="yearlydays1select",$("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_MONTH").data.name="yearmonths",$(".NEXT_BUSINESS_HOLIDAY").removeClass("dN")):($("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_DAY_DATE").html(renderingUtils.createSelectBox(Events.weekDaysDropdownObj).innerHTML).data().name="weekdays1",$("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_MONTH").data.name="yearmonths1",$(".NEXT_BUSINESS_HOLIDAY").addClass("dN"),$("#Crm_Events_NEXT_BUSINESS_HOLIDAY_0").prop("checked",!1))}))}else"RECURRING_CUSTOM_YEAR_REPEAT_MONTH"===i?t.find(".newSelect").css({"min-width":"inherit","margin-left":"5px"}):"ALLDAYEVENT"==i?t.find("input").css("margin-top","0px"):"RECURRING_CUSTOM_OCCUR_FIRST"==i?(t.find(".newSelect").css({"min-width":"inherit"}),t.find("select").change((function(){var e;e="5"==$(this).val()?renderingUtils.createSelectBox(Events.weekDaysDropdownObj_lastDay):renderingUtils.createSelectBox(Events.weekDaysDropdownObj);var t=$("#Crm_Events_RECURRING_CUSTOM_OCCUR_DAY"),a=t.val();t.html($(e).html()),t.val(a)}))):"RECURRING_CUSTOM_OCCUR_DAY"===i?t.find(".newSelect").css({"min-width":"inherit"}):"STARTDATETIME"!=i&&"ENDDATETIME"!=i||(t.find("input[type='text']").removeAttr("style"),t.find("input[type='text']")[0].setAttribute("style","width:110px;"),t.find("input[type='text']")[1].setAttribute("style","width: 80px; margin-left: 10px;"))}if(123!=a||"create"!==Events.currentStatus&&"clone"!==Events.currentStatus&&"setup"!==Events.currentStatus)if(41===a||"41"===a){var o=$("<span>").addClass("rec vmiddle p0"),l="setup"===this.currentStatus?"Crm_Events_setup_"+e.colname:"Crm_Events_"+e.colname;o.attr("id",l),o.attr({"data-zcqa":l}),o.css({"white-space":"normal",padding:"2px",display:"inline-block","min-width":"70px","max-width":"140px"}),o.html(I18n.getMsg("None")),o.data({mandate:e.mandate,colname:e.colname,uitype:e.uitype,name:e.label,maxlength:e.maxlength,customfield:e.customfield});m=$("<a>").attr({href:"javascript:void(0)"}).attr({"data-zcqa":"Lookup_event_addparticipant"}).addClass("createlink p0").html(I18n.getMsg("crm.button.add"));"setup"!=this.currentStatus&&m[0].setAttribute("onclick","Events.showAddParticipants()"),t.html(o),null==Events.createEditJson.sourceid&&t.append(m)}else"LOCATION"===i&&("relatedlist_new"==Events.evtCreateFrom?(t.children("input").attr("onfocus","detailView.setEventLocation($('#Crm_Events_CONTACTID_select').val())"),t.children("input").attr("onblur","Events.hideLocationPop();"),t.attr("onclick","detailView.setEventLocation($('#Crm_Events_CONTACTID_select').val())")):(t.children("input").attr("onfocus","Events.setLocation($('#Crm_Events_CONTACTID_select').val());sE(event)"),t.children("input").attr("onblur","Events.hideLocationPop();"),t.attr("onclick","Events.setLocation($('#Crm_Events_CONTACTID_select').val())")),t.find("input[type='text']").attr("autocomplete","off"));else{var d=$("<span>").addClass("rec vmiddle p0"),c="setup"===this.currentStatus?"Crm_Events_setup_"+e.colname:"Crm_Events_"+e.colname;d.attr({id:c}),d.attr({"data-zcqa":c}),d.css({"white-space":"normal",padding:"2px",display:"inline-block","min-width":"70px","max-width":"190px"}),d.html(I18n.getMsg("None")),d.data({mandate:e.mandate,colname:e.colname,uitype:a,name:e.label,maxlength:e.maxlength,customfield:e.customfield});var m=$("<a>").attr({href:"javascript:void(0)"}).attr({"data-zcqa":"Lookup_event_editparticipant"}).attr({title:I18n.getMsg("crm.label.change")}).addClass("neweditIconSvg");"setup"!=this.currentStatus&&($(m).click((function(){Events.showRecurringActivity()})),d.click((function(){Events.showRecurringActivity()}))),t.html(d),t.append(m)}2===a&&t.find("select").change(Events.loadColorNearSelect2($(this)));return t},showSelHeaders:function(){var e=["cv","lv","c","l","u","g","r","rs"];for(i=0;i<e.length;i++){var t=$("#invselListTr_"+e[i]),a=t.next();if(a.length>0&&!a.hasClass("invSelListHd")){$("#selectedInvDiv").find(".ui-list").scrollTo(t);break}}},showRecurringActivity:function(){if(!$("#eventRecurringDiv").is(":visible")){if($("#doneAddParticipantBtn").hide(),getElemById("eventRecurringDiv"))$("#eventRecurringDiv").fadeIn("",(function(){$(this).css({opacity:"1"})}));else{var e=$("<div>",{id:"eventRecurringDiv",class:"eventForm-create",style:"width:100%; padding:20px;margin:0;box-sizing:border-box; display:none; left: 395px"}),t=$("<div>",{id:"eventRecurringInnerDiv",class:"eventForm-ins",style:"height:342px;width:100%;"});e.append($("<div>",{html:I18n.getMsg("crm.workflow.scheduler.repeatRate"),class:"contHeadInfo"})),e.append(t);var a=$("<div>",{id:"recEventTimeInfoDiv"}),i=$("<table>",{border:"0",cellpadding:"0",cellspacing:"0",style:"width:100%;"});i.append("<tbody>"),a.append(i),t.append(a);var n=[{colname:"REPEATTYPE",customfield:"false",displaylabel:I18n.getMsg("Repeat Type"),label:"period",mandate:"false",maxlength:"120",readonly:"false",type:"Pick List",uitype:"42",val:[{html:I18n.getMsg("None"),value:"none"},{html:I18n.getMsg("Daily"),value:"daily"},{html:I18n.getMsg("Weekly"),value:"weekly"},{html:I18n.getMsg("Monthly"),value:"monthly"},{html:I18n.getMsg("Yearly"),value:"yearly"},{html:I18n.getMsg("Custom"),value:"custom"}]}];crmTemplate.createSubFields(this.moduleName,t[0],"recurringInner",n),t.find("#recurringInner").removeAttr("width","100%"),$("#eventCreateContainerDiv ").append(e),e.show(),thirdPartyUtils.bindPerfectScroll("#"+t.attr("id"))}$("#doneRecurringBtn").show();var r=$("#recEventTimeInfoDiv tbody").eq(0);r.prepend($("#Events_fldRow_ENDDATETIME")),r.prepend($("#Events_fldRow_STARTDATETIME")),r.prepend($("#Events_fldRow_ALLDAYEVENT")),$("#saveEventsBtn, #cancelEventBtn, #doneAddParticipantBtn").hide(),setTimeout((function(){$("#eventCreationDiv").css({left:"-100%",opacity:"0"}),$("#eventRecurringDiv").css({left:"0%",opacity:"1"})}),1),thirdPartyUtils.bindSelect2($("#eventRecurringDiv").find("select")),$("#showMoreFiledsLink").hide()}},doneRecCallBack:function(){var e=$("#Events_fldRow_LOCATION");e.after($("#Events_fldRow_ENDDATETIME")),e.after($("#Events_fldRow_STARTDATETIME")),e.after($("#Events_fldRow_ALLDAYEVENT")),e.after($("#CrmEventMeetingInteg")),$("#checkDuplicateEvent").remove(),$("#doneRecurringBtn").hide(),$("#doneAddParticipantBtn").hide(),$("#saveEventsBtn, #cancelEventBtn").show(),$("#eventCreationDiv").css({left:"0%",opacity:"1"}),$("#eventRecurringDiv").css({left:"100%",opacity:"0"}),this.addMoreDetailsClicked||$("#showMoreFiledsLink").show()},getLastWorkingDay:function(e){var t=e.getMonth(),a=Utils.getMonthEnd(t,e.getFullYear()),i=new Date(e.getTime()),n=0;do{a-=n,i.setDate(a);var r=i.getDay();n++}while(Crm.calPreferences.HOLIDAY1==r||Crm.calPreferences.HOLIDAY2==r);return i},validateRecurringData:function(e,t,a,i){var n,r,s,o,l,d,c=$("#Crm_Events_STARTDATETIME"),m=$("#Crm_Events_ENDDATETIME"),u=1;if(this.isRecEvent){if(this.recVal)switch(e=(A=(t=this.recVal).split("*#"))[0]){case"daily":f=A[3].split("^")[1],g=A[4];break;case"weekly":f=A[2].split("^")[1],n=A[3].split("^^");case"monthly":1===(r=parseInt(A[1]))?(s=A[4],g=A[5]):(l=A[4],o=A[5],g=A[6]);break;case"yearly":var v;1===(v=A[1])?(d=A[4],L=A[5],g=A[6]):(v=A[4],o=A[5],d=A[6],g=A[7])}if(""===t)return!0}a=a||c.data("dateObj"),i=i||m.data("dateObj");if(!t){var p,h,g,C=parseInt($("input:radio[name='endRadioOption']:checked").val());if(3===C)var f=(p=$("#Crm_Events_RECURRING_END_DATE")).data("dateObj");else 2===C&&(h=$("#Crm_Events_RECURRING_REPEAT_COUNT").val());if((g=$("#Crm_Events_RECURRING_CUSTOM_PERIODS_COUNT"))[0]){if((u=parseInt(g.val()))<1)return!1;g=g[0]}}var E=new Date(a.getTime()),I=i.getTime()-a.getTime();switch(e){case"daily":if(g&&(E.setDate(a.getDate()+u),!Utils.compareDateandTime(i,E)))return!1;if(h&&h<1)return!1;if(p&&(E.setDate(a.getDate()+crmConstants.recurringEndDateLimit[e]),!Utils.compareDateandTime(a,f)||!Utils.compareDateandTime(i,f)||!Utils.compareDateandTime(f,E)))return!1;break;case"weekly":if(g){var y=7;if($("#Crm_Events_RECURRING_CUSTOM_WEEK_REPEAT_ON")[0]){n||(n=$("#Crm_Events_RECURRING_CUSTOM_WEEK_REPEAT_ON").val());for(var R=0;R<n.length;R++){var b=n[R+1]-n[R];y=b>0&&b<y?b:y}}if(u=y,E.setDate(a.getDate()+u),!Utils.compareDateandTime(i,E))return!1}if(h&&h<1)return!1;if(p&&(E.setDate(a.getDate()+crmConstants.recurringEndDateLimit[e]),!Utils.compareDateandTime(a,f)||!Utils.compareDateandTime(i,f)||!Utils.compareDateandTime(f,E)))return!1;break;case"monthly":if(g){if(r||(r=parseInt($("input:radio[name='monthlyhidden']:checked").val())),1==r){s||(s=$("#Crm_Events_RECURRING_CUSTOM_MONTH_REPEAT_ON_DAY").val()),a.setDate(s);var T=new Date(a.getTime());T.setTime(T.getTime()+I),this.setStartDateAndTime(a),this.setEndDateAndTime(!1,!1,T)}else if(2==r){if(l||(l=$("#Crm_Events_RECURRING_CUSTOM_OCCUR_FIRST").val()-1),o||(o=$("#Crm_Events_RECURRING_CUSTOM_OCCUR_DAY").val()-1),-2==o){var D=new Date(a.getTime()),w=Utils.getMonthEnd(a.getMonth(),a.getFullYear());D.setDate(w),o=D.getDay()}else-1==o&&(o=this.getLastWorkingDay(a).getDay());var M=Events.weekOfDay(a,l,o),S=new Date;(Utils.compareDateandTime(M,a)||Utils.compareDateandTime(M,S))&&(a.setMonth(a.getMonth()+1),M=Events.weekOfDay(a,l,o)),a=M,this.setStartDateAndTime(M),this.setEndDateAndTime(!1,!1,new Date(M.getTime()+I))}if(E.setMonth(a.getMonth()+1),!Utils.compareDateandTime(i,E))return!1}if(h&&h<1)return!1;if(p&&(E.setDate(a.getDate()+crmConstants.recurringEndDateLimit[e]),!Utils.compareDateandTime(a,f)||!Utils.compareDateandTime(i,f)||!Utils.compareDateandTime(f,E)))return!1;break;case"yearly":if(g[0]){if(d||(d=$("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_MONTH").val()),v||(v=$("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_FIRST").val()),"Day"==v){var L=$("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_DAY_DATE").val();(A=new Date).setDate(L),A.setMonth(d),A.getTime()<a.getTime()&&A.setFullYear(A.getFullYear()+1),this.setStartDateAndTime(A),this.setEndDateAndTime(!1,!1,new Date(A.getTime()+I))}else{var A;(A=new Date(a.getTime())).setMonth(d),o||(o=$("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_DAY_DATE").val()),(A=Events.weekOfDay(A,v,o)).getTime()<a.getTime()&&(A.setFullYear(A.getFullYear()+1),A=Events.weekOfDay(A,v,o)),this.setStartDateAndTime(A),this.setEndDateAndTime(!1,!1,new Date(A.getTime()+I))}if(a=A,E.setFullYear(a.getFullYear()+1),!Utils.compareDateandTime(i,E))return!1}else(p=new Date(a.getTime())).setDate(p.getDate()+365),f||(f=p);if(h&&h<1)return!1;if(E.setDate(a.getDate()+crmConstants.recurringEndDateLimit[e]),p&&(!Utils.compareDateandTime(a,f)||!Utils.compareDateandTime(i,f)||!Utils.compareDateandTime(f,E)))return!1;break;case"custom":var _=$("#Crm_Events_RECURRING_FREQUENCY").val();return this.validateRecurringData(_)}return!0},doneRecuring:function(){if(!Crm.validateEntityAndShowErrorMsg(this.recurringElemIds,this.moduleName))return!1;var e=$("#Crm_Events_REPEATTYPE").val();if(!this.validateRecurringData(e))return alert("Recurring Validation Failed"),!1;if("none"!=$("#Crm_Events_REPEATTYPE").val()){$("#CrmEventMeetingInteg").hide();var t=$("#Crm_Events_RECURRING_FREQUENCY").val();if("monthly"==t&&"2"==$("input:radio[name='monthlyhidden']:checked").val()){var a=$("#Crm_Events_RECURRING_CUSTOM_OCCUR_FIRST").val(),i=$("#Crm_Events_RECURRING_CUSTOM_OCCUR_DAY").val();"5"!=a||"0"!=i&&"-1"!=i||(Crm.requestParam.monthlyhidden="1",Crm.requestParam.monthly1select=i)}else"monthly"==t&&"1"==$("input:radio[name='monthlyhidden']:checked").val()&&(Crm.requestParam.monthlyhidden="1");null!=t&&"daily"!=t?Crm.requestParam.nextbusin_holiday=$("#Crm_Events_NEXT_BUSINESS_HOLIDAY_0").is(":checked"):Crm.requestParam.exceptholiday=$("#Crm_Events_EXCEPT_BUSINESS_HOLIDAY_0").is(":checked"),Crm.requestParam.hostId=$("#Crm_Events_SMOWNERID").data("id"),$.ajax({url:Crm.getCrmBasePath()+"/events/EventAction.do?type=getRecText",data:Crm.requestParam,type:"GET",success:function(e){$("#Crm_Events_RECURRING").html(e),$("#Crm_Events_RECURRING").css({display:"block","margin-right":"0"}),Events.doneRecCallBack()}})}else $("#Crm_Events_RECURRING").html(I18n.getMsg("None")),$("#Crm_Events_RECURRING").css({display:"inline-block","margin-right":"5px"}),delete Crm.requestParam["property(Recurring Activity)"],Events.doneRecCallBack(),Events.showHideMeetingIntegDiv();$("#eventRecurringDiv").fadeOut()},delEventAttachment:function(e,t){hideAnimatePopup("deletepopup");var a=parseInt($("#attachTotCnt").val()),n=$("#"+t),r=t.split("_")[1],s=new getHTTPObject;try{s.open("POST",e,!0),s.onreadystatechange=function(){if(4==s.readyState){if($("#attTotalCnt").text(a-1),$("#attachTotCnt").val(a-1),n.remove(),1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI)var e=$("#eventsRightPanelAttachDiv"),t=$("#eventsAttachButtonDiv");if(a<=1)1!=Crm.userDetails.detailView_newUI&&$("#eventAttTable").remove(),$("#eventAttachmentDataDiv").remove(),$("#noAttachmentTable").show(),$("#attTotalCnt").closest(".cntSpn").hide(),1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&(e.addClass("noDataFountDetail"),t.parent("td").addClass("noDataFountDetailtxt"));else{var o=$("#eventAttachmentDataDiv").find("tr").first().find("td"),l=[];if(o.each((function(){l.push($(this).outerWidth())})),1!=Crm.userDetails.detailView_newUI){var d=$("#eventAttTable").find("td");o.each((function(e){d.eq(e).css("width",l[e])}))}for(i=r+1;i<=a;i++){var c=i-1,m=$("#attTabCnt_"+i);m.attr("id","attTabCnt_"+c),m.find(".slNo").text(c+".")}1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&(e.removeClass("noDataFountDetail"),t.parent("td").removeClass("noDataFountDetailtxt"))}}}}catch(e){alert(e)}s.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),s.send(csrfParamName+"="+encodeURIComponent(csrfToken))},initEventRightPannel:function(e,t){$("#addAttach").click((function(e){return showPopupMenuOld(this,"addAttOptions","right","bottom",event),!1})),$("#addAttchmentFromDetailMenu").mouseenter((function(e){$("#attachOptionsFromDetailMenu").css({right:$("#eventActionsMenu").outerWidth()-2,top:"50px"}).show(),$("#invStULFromDetailMenu").hide()})),$("#addAttchmentFromDetailMenu").mouseleave((function(e){$("#attachOptionsFromDetailMenu").hide()})),$("#eventActionsMenu").mouseleave((function(e){$("#invStULFromDetailMenu, #eventActionsMenu, #addAttOptions").hide()})),$("#invStatusFromDetailMenu").mouseenter((function(e){$("#invStULFromDetailMenu").css({right:-$("#invStULFromDetailMenu").outerWidth(),top:"60px"}).show()})),$("#invStatusFromDetailMenu").mouseleave((function(e){$("#invStULFromDetailMenu").hide()})),$("#addAttOptions a, .eventActionsMenu a ul li").click((function(){hideMenu()})),$("#invStatusDropdown, #addAttOptions").mouseleave((function(e){$(this).hide()})),$("#statusBtn").click((function(e){return $("#invStatusDropdown").show(),!1})),$("#attachOptionsFromDetailMenu").html($("#addAttOptions").html());var a=$("#eventInvitationStatus").val();$("#invSt_"+a).hide(),$("#invStDet_"+a).addClass("on"),$("#addNoteFromDetailMenu").click((function(e){var t=$("#eventActionsBtn").offset();$("#newNoteDivId").css({top:t.top+40,left:t.left-170}),$("#newNoteDivId").html($("#fullInfoNoteDiv").html()).show(),$("#fullInfoNoteDiv").html(""),Notes.initNote("open"),getElemById("save_comment").setAttribute("onclick","Notes.addNoteFromEventActionMenu($(this).closest('table'))"),getElemById("cancel_comment").setAttribute("onclick","Notes.initNote('close', true)")})),parseInt($("#attachTotCnt").val())<=0?($("#attTotalCnt").closest(".cntSpn").hide(),$("#noAttachmentTable").show()):($("#attTotalCnt").closest(".cntSpn").show(),$("#noAttachmentTable").hide(),$("#eventsRightPanelAttachDiv").removeClass("noDataFountDetail"));var i=$("#internalUserInvDiv");i.length&&($("#right_invUserDetails").prepend(i),$("#internalUserInvDiv").show())},updateInvStatusFromDetails:function(e,t,a,i,n,r){commonUtils.showHideLoadingDiv(!0),i||(i=$("#dvInvRow_invId").val()),$.ajax({url:Crm.getCrmBasePath()+"/events/Invitation.do",type:"POST",data:"eventId="+e+"&type=updateInvStatus&status="+t+"&invId="+i+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),success:function(e){if(commonUtils.showHideLoadingDiv(),null!=n){$("#inv"+n).closest("div").remove();var i=parseInt($("#myinvitationCnt").val())-1;$("#inviCnt").html(i),$("#myinvitationCnt").val(i),i<=0&&$(".eventForm-ins-myinv").html("<div align='center'>"+I18n.getMsg("crm.cal.inv.no.invitation")+"</div>")}else if("quickView"===r){$("#qv_myStatusDrpdowp").val(t),$("#qv_invitationRow").show(),$("#qv_statusBtnsDiv").remove(),$("#qv_invDelBtnsDiv").show(),$("#doneBtnForInvitedEvent").show();var s=parseInt($("#myinvitationCnt").val());s<=1&&$("#myInvites").hide(),$("#myinvitationCnt").val(s-1),$("#inviCnt").text(s-1)}else if("qvOnChange"===r)"decline"===t?$("#hideInvitedEventBtn").show():$("#hideInvitedEventBtn").hide();else{$("a[id^='invSt_']").show(),$("li[id^='invStDet_']").removeAttr("class"),$("#statusBtn span").html($("#invSt_"+t).html());var o=$("#eventInvitationStatus").val();a&&($("#buttonTable").hide(),$("#statSpan").show(),$("#invSt_"+t).hide(),$("#invStatusFromDetailMenu").show(),$("#eventInvitationStatus").val(t)),$("#invStDet_"+t).addClass("on"),$("#invSt_"+t).hide(),$("#invStatusDropdown").hide();trimBoth($("#right_invCnt_"+t).html());var l=$("#invCntJsonHid").val();if(""!=l){var d=JSON.parse(l),c=parseInt(d[t])+1;if(d[t]=c,o&&""!==o){var m=parseInt(d[o])-1;d[o]=m}$("#right_invCnt_accept").text(d.accept),$("#right_invCnt_maybe").text(d.maybe),$("#right_invCnt_decline").text(d.decline),$("#right_invCnt_invited").text(d.invited),$("#invCntJsonHid").val(JSON.stringify(d))}$("#eventInvitationStatus").val(t)}}})},cancelEvent:function(e,t,a,i,n,r){if(!a){var s=$("#deletepopup");return s.find("#deleteButton").hide(),s.find("#dissociatebutton").hide(),$("#warningMsg").html(I18n.getMsg("crm.listview.delete.alert.participant",[Events.getModuleName(!1,!1,!0)])),s.find("#showWarning2").css("display","none"),s.find("#delItemName").text(""),s.find(".evButtons.fromDeletePopup").eq(0).val(I18n.getMsg("crm.button.send")).show().off("click").click((function(a){Events.cancelEvent(e,t,!0,1,n,a),renderingUtils.stopEvent(a),Crm.trackSpotLightAction("Calendar Booking - Booking cancelled, Email Sent")})).removeAttr("data-cid").removeAttr("data-params"),s.find(".evButtons.fromDeletePopup").eq(1).val(I18n.getMsg("crm.button.dont.send")).show().off("click").click((function(a){return Events.cancelEvent(e,t,!0,0,n,a),renderingUtils.stopEvent(a),Crm.trackSpotLightAction("Calendar Booking - Booking cancelled, Email not sent"),!1})).removeAttr("data-cid").removeAttr("data-params"),showAnimatePopup("deletepopup"),!1}void 0===i&&(i=0),$.ajax({url:Crm.getCrmBasePath()+"/events/EventAction.do",type:"POST",data:"type=updateEventStatus&newStatus=-1&eventId="+e+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&isCancelMailNeeded="+i,success:function(t){if(hideAnimatePopup("deletepopup"),-1==(t=JSON.stringify(t)).indexOf("error"))n?Events.eventQuickView("Events",e,void 0,r,!0):reloadCurrentEntityView();else if(-1!=t.indexOf("Invalid Refresh Token"))t=JSON.parse(t),Events.eventMeetingReAuthorize(t);else if("NOT_AUTHORIZED"==t.errMsg){var a=res.hostUserName;renderingUtils.showAlertMsg(I18n.getMsg("crm.event.meeting.host.notauthorize.alert.new",[a,res.toolName,Crm.appName]),"warning",I18n.getMsg("crm.button.ok"),(function(){var e=document.getElementById("lyteAlertMsg");e||(e=Lyte.Component.render("lyte-alert",{id:"lyteAlertMsg",ltPropButtonPosition:"center",ltPropAllowMultiple:"true",ltPropButtons:I18n.getMsg("crm.button.ok"),ltPropContentAlign:"center"},"body")),e.ltProp("wrapperClass","changeHostAlert"),$("#lyteAlertMsg").attr("lt-prop-show-close-button",!1)})),Crm.userDetails.MEETING_BRIDGE_ENABLED&&Events.sendAuthorizationNotificationToHost(res.toolName,res.hostUserId)}else-1!=t.indexOf("crm.limit.reached")?(t=JSON.parse(t),crmui.showMsgBand("error",I18n.getMsg(t.errMsg),4e3)):t.indexOf("PERMISSION_DENIED")?(hideAnimatePopup("deletepopup"),renderingUtils.displayPermissionDenied(),commonUtils.showHideLoadingDiv()):alert("failure")},error:function(){hideAnimatePopup("deletepopup"),renderingUtils.displayPermissionDenied(),commonUtils.showHideLoadingDiv()}})},SendMailToParticipant:function(e,t,a,i,n){if(!a){Events.loadInvitationConfirmDiv();var r=$("#invitationConfirmDiv"),s=r.find(".msgBody"),o=r.find(".msgTitle"),l=r.find(".send").prop("disabled",!1),d=r.find(".dntSend").prop("disabled",!1),c=r.find(".cancel").prop("disabled",!1);l.val(I18n.getMsg("crm.button.send")),d.val(I18n.getMsg("crm.button.dont.send")).show(),c.hide(),o.html(I18n.getMsg("crm.event.inv.create.alert.msg1")).show(),s.html(I18n.getMsg("crm.event.inv.create.alert.msg2")),l.off("click").click((function(a){r.hide(),renderingUtils.removeDummyBackground(),Events.sendNotificationMail=!0,Events.SendMailToParticipant(e,t,!0,i,a),renderingUtils.stopEvent(a)})),d.off("click").click((function(e){return r.hide(),renderingUtils.removeDummyBackground(),Events.sendNotificationMail=!1,!1}));var m=r.attr("id");return mailsetCenter(m),renderingUtils.dummyBackground(!1,m),r.show(),!1}var u="type=updateEventStatus&newStatus=1&eventId="+e+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);$.ajax({url:Crm.getCrmBasePath()+"/events/EventAction.do",type:"POST",data:u,success:function(t){-1==(t=JSON.stringify(t)).indexOf("error")?i?Events.eventQuickView("Events",e,void 0,n,!0):reloadCurrentEntityView():"crm.limit.reached"===(t=JSON.parse(t)).errMsg?crmui.showMsgBand("error",$ESAPI.encoder().encodeForHTML(I18n.getMsg(t.errMsg)),4e3):alert("failure")}})},edit:function(e,t,a){var i=a.from;this.addMoreDetailsClicked=!1,this.entityId=e,t.entityId=e,this.currentStatus="edit",Events.evtCreateFrom=i,"Appointments"===a.module&&(this.moduleName=a.module),this.createTemplate(t),this.createSource=i;if(Crm.requestParam.eventCreateFrom=i,Events.eventCreateCBn(i,void 0,void 0,a),"Appointments"!==a.module){var n=$("#Crm_Events_CONTACTID"),r=$("#Crm_Events_SEID"),s=r.data("id");if(s&&"null"!==s||n.data("id")&&"null"!==n.data("id")||$("#Crm_Events_CONTACTID_select").val("None"),"Accounts"==$("#Crm_Events_SEID_label_select").val()&&(Events.relAccId=s+"",Events.relAccName=r.val(),Events.relAccMod=!0),Events.withMeetingTool){var o=new Date,l=o.getDate()<10?"0"+o.getDate():o.getDate(),d=o.getMonth()<10?"0"+(o.getMonth()+1):o.getMonth()+1,c=o.getFullYear();(o=d+"/"+l+"/"+c)==$("#Crm_Events_STARTDATETIME").val()&&$("#Events_fldRow_ALLDAYEVENT").hide(),Events.changeTitleMessageDiv(Events.meetingToolName)}Events.showEventRelatedToOptions($("#Crm_Events_CONTACTID_select"),void 0,!1),($("#moreEventsAllDiv").is(":visible")||$("#showAllEventsDIV").is(":visible"))&&(Events.closeMoreEventsPop(!0),Events.closeQuickView(),Events.closeMoreEventDiv(!0)),Events.changeEditPopLocationValue(),Events.modifyingEvent=Events.getCurrEventjson(),Events.modifyingEvent.invMailType=t.invMailType+"",Events.modifyingEvent.status=t.status+"",Events.modifyingEvent.id=e,Events.modifyingEvent.hostName=t.hostName,Events.modifyingEvent.invCnt=t.invCnt,Events.modifyingEvent.invCntJson=t.invCnt,Events.modifyingEvent.sourceid=t.sourceid,Events.pastEventInvCnt=t.invCnt>t.inviteeslimit?t.invCnt:t.inviteeslimit,Events.inviteesLimit=t.inviteeslimit,Events.remainingInvitees=t.inviteeslimit-t.invCnt,Events.formatInvDetailsToFinalIdsJson(t)}},clone:function(e,t){var a=$("#eventViewPopup");Crm.requestParam["property(cloneEntityId)"]=e,this.addMoreDetailsClicked=!1,this.currentStatus="clone",t.eventMeetingOnboardingShown&&(Events.eventMeetingOnboardingShown=!0),t.meetingConfZuid&&(Events.meetingConfZuid=t.meetingConfZuid),this.createTemplate(t),"calendar"===Events.createSource&&$("#eventCreatePopup").addClass("eventCreateCalenderView"),Events.eventCreateCBn(),a.is(":visible")&&(Events.closeMoreEventsPop(!0),Events.closeQuickView(),Events.closeMoreEventDiv(!0));var i=$("#Crm_Events_SEID").data("id"),n=$("#Crm_Events_CONTACTID");i&&"null"!==i||n.data("id")&&"null"!==n.data("id")||$("#Crm_Events_CONTACTID_select").val("None"),t.entityMapJson.LOCATION.meetingToolName&&Events.changeTitleMessageDiv(t.entityMapJson.LOCATION.meetingToolName),Events.showEventRelatedToOptions($("#Crm_Events_CONTACTID_select"),void 0,!1),Events.invJsonCreate=t.inviteeJson,Events.cloneEntId=e,Events.pastEventInvCnt=t.invCnt>t.inviteeslimit?t.invCnt:t.inviteeslimit,Events.inviteesLimit=t.inviteeslimit,Events.remainingInvitees=t.inviteeslimit-t.invCnt,Events.formatInvDetailsToFinalIdsJson();var r=$("#Crm_Events_LOCATION"),s=t.entityMapJson.LOCATION.meetingToolName;Events.isFutureEvent()?void 0===s&&($("#Events_fldRow_LOCATION").removeClass("disable-events"),r.val(null!=Events.locationValue?Events.locationValue:""),$("#meetingInclude").prop("checked",!1)):($("#CrmEventMeetingInteg").hide(),null!=s?$("#meetingInclude").prop("checked",!0):($("#Events_fldRow_LOCATION").removeClass("disable-events"),r.val(null!=Events.locationValue?Events.locationValue:""),$("#meetingInclude").prop("checked",!1)))},appendEventParams:function(e){if("REPEATTYPE"==e&&"none"!=$("#Crm_Events_REPEATTYPE").val()&&(Crm.requestParam["property(Recurring Activity)"]="on",Crm.requestParam["property(Start Date1)"]=$("#Crm_Events_STARTDATETIME").val(),Crm.requestParam["property(End Date1)"]=$("#Crm_Events_ENDDATETIME").val()),"RECURRING_FREQUENCY"===e&&(Crm.requestParam.mainSelect="custom"),"EXCEPT_HOLIDAY"==e)holDay="Holidays and weekends";else if("daily"==$("#Crm_Events_RECURRING_FREQUENCY").val())"RECURRING_FREQUENCY"==e?(Crm.requestParam.dailyhidden=2,Crm.requestParam.exceptholiday=!!$("#Crm_Events_EXCEPT_BUSINESS_HOLIDAY_0").is(":checked")):"RECURRING_CUSTOM_PERIODS_COUNT"==e&&(Crm.requestParam.daily111=$("#Crm_Events_RECURRING_CUSTOM_PERIODS_COUNT").val());else if("RECURRING_CUSTOM_YEAR_REPEAT_FIRST"==e&&"yearly"==$("#Crm_Events_RECURRING_FREQUENCY").val())"Day"==$("#Crm_Events_RECURRING_CUSTOM_YEAR_REPEAT_FIRST").val()?Crm.requestParam.yearlyhidden="1":Crm.requestParam.yearlyhidden="2",Crm.requestParam.yearmonths=$("#Crm_Events_STARTDATETIME").data("dateObj").getMonth(),Crm.requestParam.yearmonths1=$("#Crm_Events_STARTDATETIME").data("dateObj").getMonth();else if(!$("#Crm_Events_RECURRING_FREQUENCY").length&&$("#Crm_Events_REPEATTYPE").length){var t=$("#Crm_Events_REPEATTYPE").val();if("REPEATTYPE"==e){var a=new Date($("#Crm_Events_STARTDATETIME").data("dateObj"));Crm.requestParam.repeatEveryCnt=1,"none"!=t&&("daily"==t?Crm.requestParam.dailyhidden=1:"weekly"==t?Crm.requestParam.selectedWeekDays=a.getDay()+1:"monthly"==t?(Crm.requestParam.monthlyhidden=1,Crm.requestParam.monthly1select=a.getDate()):"yearly"==t&&(Crm.requestParam.yearlyhidden=1,Crm.requestParam.yearmonths=a.getMonth(),Crm.requestParam.yearlydays1select=a.getDate()))}}},eventCreateCBn:function(e,t,a,i,n){"edit"!==Events.currentStatus&&"calendar"===e?$("#eventViewPopup,#unAvailablePopup").hide():$("#eventViewPopup").is(":visible")&&(Events.currentEventObjectInQV.scrollTop=$(window).scrollTop()),"clone"==Events.currentStatus&&Events.showOrHideAllDayEvent();var r=$("#Events_fldRow_REMINDINVITEESAT");if($("#Crm_Events_ALLDAYEVENT").is(":checked")?r.hide():r.show(),Events.createSource=e,t&&"Appointments"!==t){var s=0;if("calendarGlobelAdd"==e?(Events.createSource="calendar",s=300,$("#eventCreatePopup").show()):"rightpannel"!=e&&"krp"!==e||(s=150),"calendar"==e||"relatedlist"===e||"rightpannel"===e||"krp"===e||"crmEmail"===e||"fromMap"===e||"relatedlist_new"==e||"relatedlist_meetnow"==e||"stageView"==e)$("#crmEmailOuterContainerDiv").is(":visible")?mailsetCenterNew("eventCreatePopup"):(renderingUtils.positionArrow(t,"eventCreatePopup",a,"eventPopupArrow",n),$("body").addClass("oH"));else if("salessignals"===e)crmNTC.positionEventQcreatePopup(t),renderingUtils.positionArrow(t,"eventCreatePopup",a,"eventPopupArrow",n),$("body").addClass("oH");else if("skyDesk"!=Crm.brandName){var o=$(t).offset(),l=t.offsetWidth,d=t.offsetHeight;$("#eventCreatePopup").css({top:o.top+d+10,left:o.left-l-s});var c=$("#eventCreatePopup").offset();$("#eventPopupArrow").css({top:"",left:o.left-c.left+l/4}).attr("class","arrwTop")}else $("#eventCreatePopup").css({top:"2%",left:"2%"});$("#eventPopupArrow").show(),freezeBackground(),$("#FreezeLayer").css("opacity",.2)}else PopSetCenter("eventCreatePopup"),Crm.isHeadless||(freezeBackground(),"skyDesk"===Crm.brandName&&PopSetCenter("eventCreatePopup")),"clone"===Events.currentStatus&&$("#eventCreatePopup").css({position:"absolute",top:"0%",left:"50%",transform:"translate(-50%,0%)",margin:"0"}),$("#eventPopupArrow").hide();if("edit"===Events.currentStatus||this.addMoreDetailsClicked?$("#showMoreFiledsLink").hide():$("#showMoreFiledsLink").show(),("relatedlist"===e||"relatedlist_new"==e||"relatedlist_meetnow"==e||"rightpannel"===e||"krp"===e||"fromMap"===e||"listview"===e||"stageView"===e||"salessignals"===e)&&"create"===this.currentStatus||"call_popup"===e){var m=getObj("module")?getObj("module").value:null;m="krp"===e?$$rightPanel.currentModule:m,"salessignals"===e&&(m=$("#ss_module").val());var u="krp"===e?$$rightPanel.entityId:$("#entityId").val();if("salessignals"==e&&(u=$("#ss_entityId").val()),"stageView"==e)u=$(t).attr("data-relid");else"call_popup"===e&&(m=$("#Ctiapi_entityModule").attr("value"),u=$("#Ctiapi_entityId").attr("value"));if("object"==typeof u&&(u=$(u).val()),null!=m){$("#Crm_Events_CONTACTID_select").val(m);var v=$("#associatedContName"),p=$("#Crm_Events_CONTACTID");if("relatedlist_new"!==e&&"relatedlist_meetnow"!==e||"Accounts"!==m||(Events.relAccName=$("#entityName").val(),Events.relAccId=$("#entityId").val(),Events.relAccMod=!0),"Leads"==m||"Contacts"==m){if($("#Crm_Events_CONTACTID_select").val(m),"krp"===e){var h=$("#krp_Rightpanel_InfoInnerContainer").find("#entityName").val();h?p.val(h):p.val($("#associatedContName").val())}else"stageView"===e?$("#Crm_Events_CONTACTID").val($("#listView_"+u).text()):"salessignals"===e?p.val($("#ss_entityName").val()):"call_popup"===e?(p.val($("#Ctiapi_entityName").attr("value")),"Contacts"===m&&ctiApiNotifier.populteRelDetEvent()):p.val($("#entityName").val());p.data("id",u),"Contacts"==m&&""!=$("#subvalue_ACCOUNTID").html()&&null!=$("#subvalue_ACCOUNTID").html()&&("relatedlist_new"!==e&&"relatedlist_meetnow"!==e&&"krp"!==e||(Events.relAccName=$("#subvalue_ACCOUNTID").text(),Events.relAccId=$("#subvalue_ACCOUNTID").data("params").id,Events.relAccMod=!0),$("#Crm_Events_SEID").val($("#subvalue_ACCOUNTID").text()),$("#Crm_Events_SEID").data("id",$("#subvalue_ACCOUNTID").data("params").id),$("#Crm_Events_SEID_label_select").val("Accounts"))}else{if(v[0]&&""!==v.val()&&"create"===Events.currentStatus?($("#Crm_Events_CONTACTID_select").val("Contacts"),p.val(v.val()).data("id",$("#cntId").val())):$("#Crm_Events_CONTACTID_select").val("Others"),document.getElementById("iskanbanview")&&"true"==document.getElementById("iskanbanview").value)"stageView"===e?$("#Crm_Events_SEID").val($("#listView_"+u).text()):$("#Crm_Events_SEID").val($("#modname1").val());else if("krp"===e){var g=$("#krp_Rightpanel_InfoInnerContainer").find("#entityName").val();$("#Crm_Events_SEID").val(void 0!==g?g:$("#krp_Rightpanel_InfoContainer").find("#entityName").val())}else"stageView"===e?$("#Crm_Events_SEID").val($("#listView_"+u).text()):$("#Crm_Events_SEID").val($("#entityName").val());$("#Crm_Events_SEID").data("id",u),$("#Crm_Events_SEID_label_select").val(m)}"create"==Events.currentStatus&&"relatedlist_new"!=Events.createSource&&"krp"!=Events.createSource&&"stageView"!=Events.createSource&&"relatedlist_meetnow"!=Events.createSource&&"salessignals"!=Events.createSource&&$("#Crm_Events_CONTACTID_select").val("None")}else $("#Crm_Events_CONTACTID_select").val("None");if("stageView"!==e&&"call_popup"!==e&&document.getElementById("iskanbanview")&&"true"==document.getElementById("iskanbanview").value){if(kvEventPopLeft=$("#eventCreatePopup").css("left").replace("px",""),kvEventPopTop=$("#eventCreatePopup").css("top").replace("px",""),eventPopupArrowTop=$("#eventPopupArrow").css("top").replace("px",""),$("#eventCreatePopup").is(":visible")&&($("#eventCreatePopup").addClass("kveventCreatePopup"),$("#eventCreatePopup").css("left",parseInt(kvEventPopLeft)-40+"px"),$("#eventCreatePopup").css("top",parseInt(kvEventPopTop)-35+"px")),getObj("whoid")){m=getObj("whoidmodule").value;var C=getObj("whoid").value;$("#Crm_Events_CONTACTID_select").val(m),$("#Crm_Events_CONTACTID").val($("#entityName").val()),$("#Crm_Events_CONTACTID").data("id",C)}if(getObj("modid")){$("#Crm_Events_SEID").val($("#modname1").val());var f=getObj("modid").value;$("#Crm_Events_SEID").data("id",f);var E=getObj("modsel").value;$("#Crm_Events_SEID_label_select").val(E)}}Events.showEventRelatedToOptions($("#Crm_Events_CONTACTID_select"))}if("clone"===this.currentStatus&&(Events.relAccName=$("#Crm_Events_SEID").val(),Events.relAccId=$("#Crm_Events_SEID").attr("recid"),Events.relAccMod=!0),i&&"true"===i.isAjaxEdit)i&&"true"===i.isAjaxEdit&&$("#cancelEventBtn").focus();else{var I=$("#"+Crm.fieldsObj[this.moduleName][0]);I.focus()}"create"===this.currentStatus&&I.select(),$("#eventCreationInnerDiv").scrollTop(0),Events.createSource=e;var y=$("#wid_calCreate_opts_menu");y.length>0&&y.is(":visible")&&y.hide()},getPositionObjFromEvent:function(e){var t={};return e&&(t.mouseclientY=e.clientY,t.mouseclientX=e.clientX,t.mousepageY=e.pageY?e.pageY:e.clientY+document.body.scrollTop+document.documentElement.scrollTop,t.mousepageX=e.pageX?e.pageX:e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft),t},eventQuickView:function(e,t,a,i,n,r,s,o){$("#eventViewPopup");var l=$("#allUsrMonthView");if("Unavailable"!==e){$("#wid_calCreate_opts_menu").hide();var d=Events.getPositionObjFromEvent(i);clearTimeout(Events.onMouseOverTimeOut),zctt.hidett(!0);var c=Crm.getCrmBasePath()+"/ShowEntityInfo.do?action=eventQuickView&module="+e+"&id="+t;n?c+="&isInnerRequest=true":commonUtils.showHideLoadingDiv(!0),$("#unAvailablePopup").hide(),Events.quickViewEv=d,$.ajax({url:c,type:"POST",success:function(c){commonUtils.showHideLoadingDiv();var m=$("#posArrow").attr("class"),u=$("#posArrow").attr("style");if(n)$("#eventViewPopup")[0]&&($("#eventViewPopup").empty(),$("#eventViewPopup")[0].innerHTML=c,EvalInnerScript(getElemById("eventViewPopup")),$("#posArrow").attr({class:m,style:u}));else{$("#eventViewPopup").remove();var v=getElemById("basic")?"basic":"show",p=document.createElement("div");if(p.innerHTML=c,-1==c.indexOf("quickViewMainDiv"))return $("#show").html(c),!1;getElemById(v).appendChild(p),EvalInnerScript(getElemById("eventViewPopup")),i?(renderingUtils.positionArrow(a,"eventViewPopup",i,void 0,d),l.css("overflow","hidden"),"Events"===e&&(Events.currentEventObjectInQV.curQviewStyle=$("#eventViewPopup").attr("style"),Events.currentEventObjectInQV.curQviewArrowCls=$("#posArrow").attr("class"),Events.currentEventObjectInQV.curQviewArrowStyle=$("#posArrow").attr("style"))):Events.currentEventObjectInQV.curQviewStyle&&"Events"===e&&$("#posArrow").attr({class:Events.currentEventObjectInQV.curQviewArrowCls,style:Events.currentEventObjectInQV.curQviewArrowStyle}),Events.currentQuickViewId=id}if("undefined"!=typeof eventStatus&&"0"==eventStatus.value&&$(".invitedSt").html(0),r&&Events.currentEventObjectInQV&&"monthview"===calView.currCalView){var h=Events.currentEventObjectInQV.scrollTop;h&&$(window).scrollTop(h)}if($("#eventViewPopup").css({"z-index":""}),!n){if("Events"===e){var g=$(window).scrollTop();Events.currentEventObjectInQV.scrollTop=g}s&&$("#eventViewPopup").css({"z-index":"32"})}if("Calls"===e){if(populateTimeVal(".ddTime"),Events.currQuickViewBCDetails){var C=Events.businessCardViewHTML(Events.currQuickViewBCDetails);$("#businessCardDetailsTD").append(C)}}else if("Appointments"===e)crmui.hidePopup("appointmentCreate");else if(o&&""!=o){var f=$("#eventHead_"+t);f.addClass("fc-event-invited-mon"),f.mouseover((function(e){zctt.showtt(o,void 0,!1,e)})),f.mouseout((function(e){zctt.hidett()}))}},error:function(e){if(0!==e.status){var t='<div onclick=/"sE()" class="w500 p20"><div class="floatL pL20 w430"><div class="f20"><h2 style="color:#E20000";>'+I18n.getMsg("crm.delete.error")+'</h2></div><div class="mT10">'+I18n.getMsg("crm.record.delete.message",[Crm.getCrmBasePath()])+'</div></div><br class="clearB"><div  class="alignright mT20"><input type="button" id="popupok" class="primarybtn" value="'+I18n.getMsg("crm.button.ok")+"\" onclick=\"hide('popupnew');removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30\"></div></div>";renderingUtils.popUpWithFreeze(t),commonUtils.showHideLoadingDiv()}}}),crmui.hideTooltip(),renderingUtils.stopEvent(i)}else{Lyte.injectResources(Lyte.registeredMixins["business-hours-utils"].downloadHolidayFile(),void 0,(function(){Lyte.registeredMixins["business-hours-utils"].getCurrentUnavailableInfo(t,a,i)}))}},getRoundedDateTime:function(e){var t;return e||(e=new Date),(t=e.getMinutes()<30?new Date(e.valueOf()+36e5):new Date(e.valueOf()+36e5+36e5)).setMinutes(0),t},getDateTimeValForQuickView:function(e,t,a){var i="",n=new Date,r=$.datepicker.formatDate("dd mm y M D MM",e).split(" "),s=$.datepicker.formatDate("dd mm y M D MM",t).split(" "),o=Utils.convertTo12HoursFormatTimeObj(e),l=Utils.convertTo12HoursFormatTimeObj(t),d=o.hrs+"."+o.mins+" "+I18n.getMsg(o.meridiem.toUpperCase()),c=l.hrs+"."+l.mins+" "+I18n.getMsg(l.meridiem.toUpperCase()),m=r[0]+"-"+r[1]+"-"+r[2],u=s[0]+"-"+s[1]+"-"+s[2],v="",p="";return n.getFullYear()!=e.getFullYear()&&(v=e.getFullYear()+""),n.getFullYear()!=t.getFullYear()&&(p=t.getFullYear()+""),m==u?a?(""!=v&&(v=", "+v),i=I18n.getMsg(r[4])+" "+I18n.getMsg(r[5])+" "+r[0]+v):(""!=v&&(v=", '"+v.substring(2)),i=I18n.getMsg(r[4])+" "+I18n.getMsg(r[3])+" "+r[0]+v+", "+d+" - "+c):a?(""!=v&&(v=", "+v),""!=p&&(p=", "+p),i=I18n.getMsg(r[4])+" "+I18n.getMsg(r[5])+" "+r[0]+v+" - "+I18n.getMsg(s[4])+" "+s[0]+" "+I18n.getMsg(s[5])+p):(""!=v&&(v=", '"+v.substring(2)),""!=p&&(p=", '"+p.substring(2)),i=I18n.getMsg(r[4])+" "+I18n.getMsg(r[3])+" "+r[0]+v+", "+d+" - "+I18n.getMsg(s[4])+" "+s[0]+" "+I18n.getMsg(s[3])+p+", "+c),i},closeQuickView:function(){$("#eventViewPopup,#unAvailablePopup").hide(),$("#allUsrMonthView").css("overflow","scroll"),$("#eventViewPopup").html(""),Events.invAddLinkClicked=!1,Events.currentQuickViewId=void 0,crmCalendar.close(),$("body").removeClass("oH")},valDeleteEvent:function(e,t,a,i,n){t||(t=!1);var r="detailView";if(t||(r="calendar"),a&&""!==a&&"onlyThis"!=a){i=I18n.getMsg("crm.event.rec.del.msg1",[Events.getModuleName(!0,!1,!0)])+"<br>"+I18n.getMsg("crm.event.rec.del.msg2",[Events.getModuleName(!0,!1,!0)]);var s=$("#deletepopup"),o=s.find(".evButtons");s.find("#deleteButton").hide(),s.find("#warningMsg").html(i),s.find("#showWarning2").css("display","none"),s.find("#delItemName").text(""),s.find("#delItemName").append("<br>"),s.find("#dissociatebutton").remove(),s.find("#showDontAskOptionDiv").remove(),s.find("#notifyOwnerOptionDiv").remove();var l='{"module":"Events","id":"'+e+'","delOpt":"upcomingEv", "from":"'+r+'"}';o=s.find(".evButtons");$(o).removeClass("fromDeletePopup"),o.eq(0).show().attr({"data-cid":"deleteEntity","data-params":l,value:I18n.getMsg("crm.event.rec.del.btn.all",Events.getModuleName(!1,!0,!0))}).off("click"),l='{"module":"Events","id":"'+e+'","delOpt":"onlyThis","from":"'+r+'"}',o.eq(1).show().attr({"data-cid":"deleteEntity","data-params":l,value:I18n.getMsg("crm.event.rec.del.btn.one",Events.getModuleName(!0,!0,!0))}).off("click"),showAnimatePopup("deletepopup")}else showDeletePopup(i,"crm.button.delete","","",n);return!1},deleteEvent:function(e,t,a){if(a){var i=Crm.getCrmBasePath()+"/MassDelete.do?fromPage=eventDetail&delOpt="+t+"&module="+module+"&id="+id;document.deleteForm.action=i,document.deleteForm.submit()}else $.ajax({url:Crm.getCrmBasePath()+"/MassDelete.do",type:"POST",data:"module=Events&deleteFrom=calquickview&delOpt="+t+"&id="+e+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),success:function(a){renderingUtils.positionCenter("bulkUpdateSuccess"),renderingUtils.removeDummyBackground(),-1!==a.indexOf("success")?(calView.isMultiUserView?"dayview"===calView.currCalView?Events.handleEvtDelinMulUserDayView(e):"weekview"===calView.currCalView?Events.handleEvtDelinMulUserWeekView(e):Events.handleEvtDelinMulUserMonthView(e):"upcomingEv"==t?calView.refresh():$("#calendarBd").fullCalendar("removeEvents",e),showAlertMessage("bulkUpdateSuccess",!0,I18n.getMsg("crm.event.delete.success.msg",[Events.getModuleName(!0,!0,!0)]),1e3)):showAlertMessage("bulkUpdateSuccess",!1,I18n.getMsg("crm.event.delete.error.msg",[Events.getModuleName(!0,!1,!0)]),1e3),Events.closeQuickView()}})},getQuickViewRelatedToContent:function(e){var t="",a=I18n.getMsg("Related To");try{var i=trimBoth(e["Who Id"]);i&&-1!=i.indexOf(",#;")&&(i=i.replace(/,#;/g,'"'));var n=trimBoth(e["What Id"]);n&&-1!=n.indexOf(",#;")&&(n=n.replace(/,#;/g,'"'));var r=trimBoth(e.leContModSel),s=trimBoth(e.modus2);if(r&&"Leads"==r){if(i){var o=$("#compName_Laeds").val();t=i+(o=o?" ( "+o+" )":"");a=Crm.moduleInfo.Leads.translatedSingularLabel}}else{if(i&&!n)a=Crm.moduleInfo.Contacts.translatedSingularLabel,t=i;else if(n&&!i)t=n,a=I18n.getMsg(s);else if(i&&n){a=Crm.moduleInfo.Contacts.translatedSingularLabel,t="Accounts"==trimBoth(e.modsel)?i+" ( "+n+" )":I18n.getMsg("crm.bc.related.mode.quickview.info",[i,I18n.getMsg(trimBoth(e.modus2)),n])}}}catch(e){}return""===t&&(t=I18n.getMsg("None")),{label:a,val:t}},showCurrInvDiv:function(e){$(".invList").hide(),$("#invListDiv_"+e).show()},showhideContacts:function(e){"c"==e&&("relContactOption"==$("#invFilterDropDown :selected")[0].id?$(".contactTR").hide():$(".contactTR").show())},getParticipantsListBasedOnStatus:function(e){for(var t=[],a=returnJson.inviteeDetails,i=a.length,n=0;n<i;){var r=a[n];(r.status==e||-1==e&&4!=r.status)&&t.push(r),n++}return t},showMoreOpt:function(e,t){sE();var a=$(e).parent().find(".moreOptionsDiv").html(),i=$(e).offset().top-10,n=$(e).offset().left+20,r=$(".moreOptions"),s=$(".currentActiveIcon"),o=$(".moreOptionsDiv"),l=$("#moreOptionsDiv");if(r.css({visibility:"hidden"}),t){$(e).children().find(".moreOptionsDiv").is(":visible")&&o.hide(),setTimeout((function(){l.is(":visible")?$(e).addClass("currentActiveIcon"):s.removeClass("currentActiveIcon")}),100)}else{if($(e).parent().children(".moreOptionsDiv").is(":visible")&&o.hide(),o.hide(),l.html(a),Crm.userDetails.RTL_ENABLED){l.show();var d=l.outerWidth()+25;l.css({visibility:"visible",top:i,left:n-d})}else l.css({visibility:"visible",top:i,left:n}).show();r.css({visibility:"hidden"}),$(e).css({visibility:"visible"}).addClass("currentActiveIcon")}},hideMoreOpt:function(){var e=$(".currentActiveIcon"),t=$(".moreOptions"),a=$("#moreOptionsDiv");e.removeClass("currentActiveIcon"),t.css({visibility:"hidden"}),a.hide()},getStringForStatus:function(e){switch(e){case-1:return"invited";case 0:return"noreply";case 1:return"accept";case 2:return"maybe";case 3:return"decline";default:return""}},getStatusForType:function(e){switch(e){case"invited":return-1;case"noreply":return 0;case"accept":return 1;case"maybe":return 2;case"decline":return 3;default:return""}},showCurrentTab:function(e){var t=$(e).index(),a=$(e).closest(".tabContent_wrapper").children().find(".tabContent_evt");a.hide(0),a.eq(t).show(),$(".tabHeader_evt li").removeClass("selected_tab"),$(e).addClass("selected_tab")},getInviteesDetails:function(e,t){t&&Events.showCurrentTab(t);var a=Events.getStringForStatus(e),i={},n=$("#tabContent_"+a),r=$(".noPartticipantTxt");i.option=a,i.Events={entityid:returnJson.Events.entityid},Handlebars.registerPartial("eventParticipantsListInner",Handlebars.templates.eventParticipantsListInner),i.inviteeDetails=Events.getParticipantsListBasedOnStatus(e);var s=Handlebars.templates.eventParticipantsListInner(i);0==n.size()&&$("#participants_tabContent_wrapper").append(s),null==Events.previousOption&&(Events.previousOption="invited"),r.css("display","block"),i.inviteeDetails.length>0&&r.css("display","none"),-1==e&&$("#tabContent_invited").find(".attendedInvitees").closest("li").remove(),$("#tabContent_"+Events.previousOption).hide(),n.show(),thirdPartyUtils.bindPerfectScroll("#tabContent_"+a),thirdPartyUtils.bindPerfectScroll(".added_OnlyevtParticipants"),Events.previousOption=a},viewInviteesPop:function(e,t,a,i){commonUtils.showHideLoadingDiv(!0);var n=returnJson||Events.returnJson;Events.selInviteesCnt=parseInt($("#right_invCnt_invited").text()),Events.pastEventInvCnt=n&&n.invCntJson.invited>Events.inviteeslimit?n.invCntJson.invited:Events.pastEventInvCnt,"onChange"===t&&(Events.loadedInvIds=[],Events.invPreparedPageCnt=0,Events.lastLoadedType="3",Events.viewInviteeRecordAvailable=!1,Events.viewInviteeReqSent=!1,Events.viewInviteeRecordAvailable=!1,Events.inviteesViewPageNo=0);var r=$("#id").val(),s=trimBoth($("#viewInviteesSearchTxt").val());s||(s=""),Events.searchInvRel=!1;var o="viewInviteesInner";t?"onChange"==t?Events.inviteesViewPageNo=0:"onScroll"==t&&Events.inviteesViewPageNo++:(o="viewInvitees",Events.inviteesViewPageNo=0),e||(e=$("#invStatusFilter").val());var l=0;l=$("#eventViewPopup").is(":visible")?Events.currentEventObjectInQV.status:Events.currentEventObjectInView.status;var d=0;if(returnJson&&returnJson.entMetaData&&returnJson.entMetaData.meeting_detials){var c=JSON.parse(returnJson.entMetaData.meeting_detials);c.attendees_details&&(d=Object.keys(c.attendees_details).length)}var m="action="+o+"&calledFrom="+a+"&eventStatus="+l+"&pageno="+Events.inviteesViewPageNo+"&invStatus="+e+"&eventId="+r+"&searchTxt="+encodeURIComponent(s)+"&invType="+Events.lastLoadedType;m+="&cvPageCnt="+Events.invPreparedPageCnt+"&attendeeCount="+d,$.ajax({url:Crm.getCrmBasePath()+"/events/ViewInvitees.do",data:m,type:"POST",success:function(n){if(commonUtils.showHideLoadingDiv(),Events.formatInvDetailsToFinalIdsJson(),"onChange"==t)$("#viewInviteesListDiv").html(n),thirdPartyUtils.bindPerfectScroll("#viewInviteesListDiv"),bindEventsForViewPop();else if("onScroll"==t)$("#viewInviteesListDiv").append(n),thirdPartyUtils.bindPerfectScrollUpdate("#viewInviteesListDiv"),Events.viewInviteeReqSent=!1,bindEventsForViewPop();else if(thirdPartyUtils.bindPerfectScroll("#viewInviteesListDiv"),a&&"quickView"==a){var r=parseInt($("#quickViewRelDivCont").prev().css("top"),10),s=parseInt($("#quickViewRelDivCont").parent().css("top"),10);$("#qvInvitedListDivInner").html(n),$("#doneViewPartFromDetail").remove(),$("#cancelBtneventQform").remove(),Events.initViewInviteesPop(),$("#quickViewMainDiv").animate({left:"-440px"},500),$("#quickViewRelDivCont").animate({height:"380"},500),$("#quickViewRelDivCont").parent().animate({top:s-125},500),$("#quickViewRelDivCont").prev().animate({top:r+125},500),$("#qvInvitedListDivCont").show().animate({left:"0px"},500),$("#eventViewPopup").find(".eventFooter").hide(),$("#doneBtnQuickView").show(),$("#doneBtnDetailsView").hide()}else{Events.loadViewInviteesPopDiv();var o=$("#viewInviteesPop");o[0].innerHTML=n,o.show(),EvalInnerScript(o[0]),PopSetCenter("viewInviteesPop"),freezeBackground(),Events.initViewInviteesPop(i),$("#doneBtnQuickView").hide()}thirdPartyUtils.bindSelect2($(".newSelect").find("select"));var d=$("#inviteesViewPageNoHid_"+Events.inviteesViewPageNo).val();Events.viewInviteeRecordAvailable="true"==d,i&&($("#eventActionsMenu").hide(),Events.showAddParticipants(void 0,void 0,"detailView",i)),4==e||"0"==l?$("#viewInviteesSearchTxt").hide():$("#viewInviteesSearchTxt").show()}})},closeViewInviteesPop:function(){removeFreezeLayer2(),$("#viewInviteesPop").html("").hide(),Events.loadedInvIds=[],Events.invPreparedPageCnt=0,Events.lastLoadedType="3",Events.viewInviteeRecordAvailable=!1,Events.viewInviteeReqSent=!1,Events.viewInviteeRecordAvailable=!1,Events.inviteesViewPageNo=0},closeAddPartEvent:function(){Events.closeViewInviteesPop(),Events.invAddLinkClicked=!1,Events.selInvlinkClicked=!1,Events.resetEntityVars()},initViewInviteesPop:function(e){var t=trimBoth($("#invStatusHidden").val()),a=$("#inviteesViewPageNoHid_0").val();Events.viewInviteeRecordAvailable="true"==a,e||$("#viewInvPopDivCont").show(),$("#invStatusFilter").val(t),bindEventsForViewPop(),$("#viewInviteesSearchTxt").keyup((function(){Events.viewInviteesPop(void 0,"onChange")})),$("#viewInvPopInnerDiv").css({height:"465px"})},initAddParticipant:function(){var e=$("#invListDiv_c");e.off("scroll").scroll($L.debounce((function(){!Events.isAddInvReqSent&&e.scrollTop()>=e.get(0).scrollHeight-e.get(0).clientHeight-40&&Events.reqInvRecAvail.c&&(Events.isAddInvReqSent=!0,Events.addInvPageCnt.c=Events.addInvPageCnt.c+1,Events.showAddParticipants("c","onScroll"))}),250));var t=$("#invListDiv_t");t.off("scroll").scroll($L.debounce((function(){!Events.isAddInvReqSent&&t.scrollTop()>=t.get(0).scrollHeight-t.get(0).clientHeight-40&&Events.reqInvRecAvail.t&&(Events.isAddInvReqSent=!0,Events.addInvPageCnt.t=Events.addInvPageCnt.t+1,Events.showAddParticipants("t","onScroll"))}),250));var a=$("#invListDiv_l");a.off("scroll").scroll($L.debounce((function(){!Events.isAddInvReqSent&&a.scrollTop()>=a.get(0).scrollHeight-a.get(0).clientHeight-40&&Events.reqInvRecAvail.l&&(Events.isAddInvReqSent=!0,Events.addInvPageCnt.l=Events.addInvPageCnt.l+1,Events.showAddParticipants("l","onScroll"))}),250));var i=$("#invListDiv_u");i.off("scroll").scroll($L.debounce((function(){!Events.isAddInvReqSent&&i.scrollTop()>=i.get(0).scrollHeight-i.get(0).clientHeight-40&&Events.reqInvRecAvail.u&&(Events.isAddInvReqSent=!0,Events.addInvPageCnt.u=Events.addInvPageCnt.u+1,Events.showAddParticipants("u","onScroll"))}),250));var n=$("#invListDiv_g");n.off("scroll").scroll($L.debounce((function(){!Events.isAddInvReqSent&&n.scrollTop()>=n.get(0).scrollHeight-n.get(0).clientHeight-40&&Events.reqInvRecAvail.g&&(Events.isAddInvReqSent=!0,Events.addInvPageCnt.g=Events.addInvPageCnt.g+1,Events.showAddParticipants("g","onScroll"))}),250));var r=$("#invListDiv_r");r.off("scroll").scroll($L.debounce((function(){!Events.isAddInvReqSent&&r.scrollTop()>=r.get(0).scrollHeight-r.get(0).clientHeight-40&&Events.reqInvRecAvail.r&&(Events.isAddInvReqSent=!0,Events.addInvPageCnt.r=Events.addInvPageCnt.r+1,Events.showAddParticipants("r","onScroll"))}),250));var s=$("#invListDiv_rs");s.off("scroll").scroll($L.debounce((function(){!Events.isAddInvReqSent&&s.scrollTop()>=s.get(0).scrollHeight-s.get(0).clientHeight-40&&Events.reqInvRecAvail.rs&&(Events.isAddInvReqSent=!0,Events.addInvPageCnt.rs=Events.addInvPageCnt.rs+1,Events.showAddParticipants("rs","onScroll"))}),250));var o=$("#invListDiv_cv");o.off("scroll").scroll($L.debounce((function(){!Events.isAddInvReqSent&&o.scrollTop()>=o.get(0).scrollHeight-o.get(0).clientHeight-40&&Events.reqInvRecAvail.cv&&(Events.isAddInvReqSent=!0,Events.addInvPageCnt.cv=Events.addInvPageCnt.cv+1,Events.showAddParticipants("cv","onScroll"))}),250));var l=$("#invListDiv_lv");l.off("scroll").scroll((function(){!Events.isAddInvReqSent&&l.scrollTop()>=l.get(0).scrollHeight-l.get(0).clientHeight-40&&Events.reqInvRecAvail.lv&&(Events.isAddInvReqSent=!0,Events.addInvPageCnt.lv=Events.addInvPageCnt.lv+1,Events.showAddParticipants("lv","onScroll"))})),$("#invListDiv_rc").off("scroll").scroll((function(){var e=$("#invListDiv_rc");if(!Events.isAddInvReqSent&&e.scrollTop()>=e.get(0).scrollHeight-e.get(0).clientHeight-40){var t="rc";Events.reqInvRecAvail.rc&&(Events.isAddInvReqSent=!0,Events.addInvPageCnt.rc=Events.addInvPageCnt.rc+1,Events.showAddParticipants(t,"onScroll"))}}));var d=!1;$("#invFilterTextBox").keyup((function(){d||(d=!0,setTimeout((function(){Events.showAddParticipants($("#invFilterDropDown").val(),"onKeyup"),d=!1}),1e3))})),$("#withEmtEmailChk").click((function(){Events.showAddParticipants($("#invFilterDropDown").val(),"onKeyup")})),Events.loadTagitPlugin()},loadTagitPlugin:function(){var e=$("#invEmailsListBox");if(e.tagit({placeholderText:I18n.getMsg("crm.inv.label.add.emails"),fieldName:"addEmailInvs",removeConfirmation:!0,caseSensitive:!1,allowSpaces:!0,singleField:!0,singleFieldDelimiter:",",tagLimit:100,beforeTagAdded:function(t,a){var i=e.find(".ui-autocomplete-input"),n=e.tagit("tagLabel",a.tag);if(-1!=n.indexOf(",")){var r=n.split(",");i.val("");for(var s=0;s<r.length;s++){var o=trimBoth(r[s]);e.tagit("createTag",o)}return!1}"edit"==Events.currentStatus&&(Events.addInvEmailsList[n]=n,i.val(""))},afterTagAdded:function(t,a){var i=e.find(".ui-autocomplete-input");i.length>0&&(i.removeAttr("placeholder"),e.scrollTo(i));var n=e.tagit("tagLabel",a.tag);Events.invJsonCreate.e[n]=n,Events.finalIdsJson[n]={},Events.finalIdsJson[n].e=[n],Events.setSelInvCnt(Object.keys(Events.finalIdsJson).length),Events.invitationLimitValidation(!0,$("#invFilterDropDown").val(),Events.isFromSel),"edit"==Events.currentStatus&&(Events.removeInvEmailsList[n]?delete Events.removeInvEmailsList[n]:Events.addInvEmailsList[n]=n)},afterTagRemoved:function(t,a){e.find("li").length<=1&&e.find(".ui-autocomplete-input").attr("placeholder",I18n.getMsg("crm.inv.label.add.emails"));var i=e.tagit("tagLabel",a.tag);if(delete Events.finalIdsJson[i],Events.setSelInvCnt(Object.keys(Events.finalIdsJson).length),Events.invitationLimitValidation(!1,$("#invFilterDropDown").val(),Events.isFromSel),"edit"==Events.currentStatus)Events.addInvEmailsList[i]?delete Events.addInvEmailsList[i]:Events.removeInvEmailsList[i]=i;else{Events.invJsonCreate.e&&delete Events.invJsonCreate.e[i]}},onTagExists:function(t,a){var i=e.find(".ui-autocomplete-input");i.length>0&&i.val("")},onTagLimitExceeded:function(e,t){return!1}}),"edit"==Events.currentStatus){Events.addInvEmailsList={},Events.removeInvEmailsList={};Events.invJsonCreate.e={},e.find("li").length>=1&&e.find(".ui-autocomplete-input").removeAttr("placeholder")}if("clone"===Events.currentStatus||window.ctiApiNotifier&&ctiApiNotifier.eventCreate)for(var t=objectUtils.getKeys(Events.invJsonCreate.e),a=0;a<t.length;a++){var i=t[a];e.tagit("createTag",i),Events.setSelInvCnt(Events.selInviteesCnt)}},validateEmailIdsInTagit:function(){var e=$("#invEmailsListBox"),t=e.tagit("assignedTags"),a=e.find(".ui-autocomplete-input"),n=!1;for(i=0;i<t.length;i++){var r=t[i];if(!validationUtils.isValidEmail(r)){alert(I18n.getMsg("crm.participant.invalid.email.id",[r])),n=!0,a.focus();break}}return!n},showAddParticipants:function(e,t,a,i,n){commonUtils.showHideLoadingDiv(!0),crmui.hideMsgBand(),$("#saveEventsBtn").removeAttr("disabled");var r=0;"detailView"===a||"quickView"===a?r=$("#eventViewPopup").is(":visible")?Events.currentEventObjectInQV.status:Events.currentEventObjectInView.status:this.currentStatus&&"create"!==this.currentStatus&&(r=Events.status),null==r&&(r=0),"detailView"!=a&&"quickView"!=a||(Events.entityId=$("#id").val(),Events.currentStatus="edit");var s=$("#invListDiv_"+e),o=$("#withEmtyEmailRec");if("onChange"==t)if("c"==e||"l"==e||"rc"==e){o.addClass("dB"),o.removeClass("dN");var l=$("#invFilterDropDown :selected").text();o.find("label").text(I18n.getMsg("crm.inv.exclude.empty.email.msg",I18n.getMsg([l])))}else o.addClass("dN"),o.removeClass("dB");if($("#meetingInclude").is(":checked")&&(Events.meetingToolName=$("#Crm_Events_MeetingSolutions_select option:selected").attr("name")),Events.searchInvRel=!1,"onChange"!=t||""==trimBoth(s.html())||Events.relAccMod)if(e||!Events.invAddLinkClicked||Events.relAccMod){var d=$("#invFilterTextBox").val();d||(d="");var c=0;"onScroll"==t&&(c=Events.addInvPageCnt[e]),e&&(Events.addInvPageCnt[e]=c);var m,u="getInviteesPop";t&&(u="getInviteesPopInner"),$("#invFilterDropDown").length>0&&(m=$("#invFilterDropDown").val());var v=Crm.getCrmBasePath()+"/AddInvitees.do?action="+u+"&status="+r+"&pageno="+c+"&operation="+Events.currentStatus+"&srchTxt="+encodeURIComponent(d);if(Events.relAccMod||"getInviteesPopInner"==u&&"rc"==m?(v+="&accountIdforRelCont="+Events.relAccId,"detailView"!=a&&"onChange"!=t&&(Events.relAccMod=!1),"getInviteesPopInner"==u&&(v+="&selmodule="+m)):m&&(v+="&selmodule="+m),Events.entityId&&(v+="&eventId="+Events.entityId),"clone"===Events.currentStatus&&(v+="&cloneEntId="+Events.cloneEntId),t||($("#addInvDivFromView").removeClass("addInvFromViewInv"),n&&$("#addInvDivFromView").addClass("addInvFromViewInv")),$("#withEmtEmailChk").length>0)v+="&withEmtEmail="+$("#withEmtEmailChk").is(":checked");$.ajax({url:v,type:"POST",success:function(r){if(commonUtils.showHideLoadingDiv(),"undefined"!=typeof returnJson&&(Events.inviteeslimit=returnJson.inviteeslimit,Events.remainingInvitees=Events.inviteeslimit-returnJson.invCnt,Events.pastEventInvCnt=returnJson.invCnt>returnJson.inviteeslimit?returnJson.invCnt:returnJson.inviteeslimit),"detailView"==a){$("#addInvFromDetCont").empty(),$("#addInvFromDetCont")[0].innerHTML=r;var o=$("#invFilterDropDown").val();thirdPartyUtils.bindPerfectScroll("#invListDiv_"+o),EvalInnerScript(getElemById("addInvFromDetCont")),Events.initAddParticipant(),i?($("#doneViewPartFromDetail")[0].setAttribute("onclick","Events.saveParticipantFromView('detailView', true, true)"),$("#viewInvPopDivCont").css({left:"-100%",opacity:"0"}),$("#addInvDivFromView").show().css({left:"0%",opacity:"1"})):($("#viewInvPopDivCont").animate({left:"-500px"},500),$("#addInvDivFromView").show().animate({left:"0px"},500)),thirdPartyUtils.bindSelect2($("#invFilterDropDown")),$("#viewInvPopInnerDiv").css({height:"495px"}),t||(n?$("#qvAddInvFoterBtns_fromView").show():$("#qvAddInvFoterBtns_fromView").hide(),Events.relAccId&&""!=Events.relAccId?($("#relContactOption").text(I18n.getMsg("crm.related.contact.account",[Crm.moduleInfo.Contacts.translatedPluralLabel,Events.relAccName])),$("#invFilterDropDown").val("rc")):$("#relContactOption").remove())}else if("quickView"==a){var l=parseInt($("#quickViewRelDivCont").prev().css("top"),10),d=parseInt($("#quickViewRelDivCont").parent().css("top"),10);$("#qvParticipantDivInner").empty(),$("#qvParticipantDivInner")[0].innerHTML=r;o=$("#invFilterDropDown").val();thirdPartyUtils.bindPerfectScroll("#invListDiv_"+o),EvalInnerScript(getElemById("qvParticipantDivInner")),Events.initAddParticipant(),$("#quickViewRelDivCont").animate({height:"380"},500),$("#quickViewRelDivCont").parent().animate({top:d-125},500),$("#quickViewRelDivCont").prev().animate({top:l+125},500),$("#quickViewMainDiv").animate({left:"-440px"},500),$("#qvParticipantDivCont").show().animate({left:"0px"},500,(function(){$(window).height()<550&&renderingUtils.positionArrow(void 0,"eventViewPopup",void 0,void 0,Events.quickViewEv)})),$("#qv_editBtnDiv").hide(),$("#qvAddInvFoterBtns").show(),$("#qvAddInvFoterBtns_fromView").show(),n?$("#qvAddInvFoterBtns_fromView").show():$("#qvAddInvFoterBtns_fromView").hide()}else if(t){o=$("#invFilterDropDown").val();"onChange"==t||"onKeyup"==t?($(s[0]).empty(),s[0].innerHTML=r,thirdPartyUtils.bindPerfectScroll("#invListDiv_"+o)):(s.append(r),thirdPartyUtils.bindPerfectScrollUpdate("#invListDiv_"+o)),EvalInnerScript(s[0])}else{$("#participantDiv").remove();var c=$("<div>",{id:"participantDiv",class:"w100per eventForm-create p20",style:"display:none;left: 395px;margin:0;"});c.append($("<div>",{id:"participantInnerDiv",class:"eventForm-ins",style:"width:362px"})),$("#eventCreateContainerDiv").append(c);var m=$("#participantInnerDiv"),u=$("#relContactOption");m[0].innerHTML=r,Events.relAccId&&""!=Events.relAccId?(u.text(I18n.getMsg("crm.related.contact.account",[Crm.moduleInfo.Contacts.translatedPluralLabel,Events.relAccName])),$("#invFilterDropDown").val("rc")):$("#relContactOption").remove(),EvalInnerScript(getElemById("participantDiv")),Events.initAddParticipant(),$("#eventCreationDiv").show(),$("#saveEventsBtn, #cancelEventBtn, #doneRecurringBtn").hide(),$("#doneAddParticipantBtn").show(),$("#eventCreationDiv").css({left:"-100%"}),$("#participantDiv").show().css({left:"0px"}),thirdPartyUtils.bindSelect2($("#invFilterDropDown"));var o=$("#invFilterDropDown").val();thirdPartyUtils.bindPerfectScroll("#invListDiv_"+o),$("#showMoreFiledsLink").hide()}if(Events.showRelatedpartSelected(t,!1),Events.isAddInvReqSent=!1,e){var v=Events.invJsonCreate[e];for(key in v)if(!$("#invSelRow"+e+"_"+v[key]).length&&window.ctiApiNotifier&&ctiApiNotifier.eventCreate)$("#"+e+"_"+v[key]).trigger("click");else{var p=$("#"+e+"_"+v[key]);p.removeClass("beforeAdd"),p.is(":disabled")&&p.prop("disabled",!1),$("#"+e+"_"+v[key]).prop("checked",!0)}for(key in Events.invAddJson[e])$("#"+e+"_"+v[key]).prop("checked",!0)}Events.invAddLinkClicked=!0;var h=$("[name='cvRadioBtn']:checked"),g=$("[name='lvRadioBtn']:checked");h.length>0?$("[name='lvRadioBtn']").prop("disabled",!0):g.length>0&&$("[name='cvRadioBtn']").prop("disabled",!0),deselectFromRemoveJson(Events.invRemoveJson,e),Events.setSelInvCnt();var C=$("#invFilterDropDown :selected").text();$("#withEmtyEmailRec").find("label").text(I18n.getMsg("crm.inv.exclude.empty.email.msg",I18n.getMsg([C])))}})}else{$("#eventCreationDiv").show(),$("#saveEventsBtn, #cancelEventBtn, #doneRecurringBtn").hide(),$("#removeEvents_link").hide(),$("#doneAddParticipantBtn").show(),$("#eventCreationDiv").css({left:"-100%",opacity:"0"}),$("#participantDiv").show().css({left:"0%",opacity:"1"}),$("#showMoreFiledsLink").hide();var p=$("[name='cvRadioBtn']:checked"),h=$("[name='lvRadioBtn']:checked");p.length>0?$("[name='lvRadioBtn']").prop("disabled",!0):h.length>0&&$("[name='cvRadioBtn']").prop("disabled",!0),deselectFromRemoveJson(Events.invRemoveJson,e),Events.setSelInvCnt(),commonUtils.showHideLoadingDiv(),Events.showRelatedpartSelected(t)}else Events.showCurrInvDiv(e),Events.showhideContacts(e),Events.setSelInvCnt(),commonUtils.showHideLoadingDiv(),Events.showRelatedpartSelected(t);Events.invitationLimitValidation(Events.invReached,e,void 0,t,!1),Events.showRelatedpartSelected(t,!1)},doneAddParticipants:function(){if(Events.validateEmailIdsInTagit()){for(var e=$("#selectedInvDiv").find(".invChkBox"),t=0;t<e.length;t++){var a=$(e[t]);a.is(":checked")||a.closest("tr").remove()}if($("#eventCreationDiv").css({left:"0%",opacity:"1"}),$("#participantDiv").css({left:"100%",opacity:"0"}),$("#doneAddParticipantBtn, #doneRecurringBtn").hide(),$("#saveEventsBtn, #cancelEventBtn").show(),window.ctiApiNotifier&&ctiApiNotifier.eventCreate&&validationUtils.isNotEmpty($("#ctiapi_folloup_event_list_subject").text())&&$("#removeEvents_link").show(),this.addMoreDetailsClicked||"edit"===Events.currentStatus||$("#showMoreFiledsLink").show(),$("#selectedInvDiv").is(":visible")){var i=$("#invFilterDropDown").val();$("#selectedInvDiv").hide(),$("#invListDiv_"+i).show();var n="";if("lv"===i||"cv"===i){var r="lv"===i?Crm.moduleInfo.Leads.translatedSingularLabel:Crm.moduleInfo.Contacts.translatedSingularLabel;n=I18n.getMsg("crm.invitees.filter.customview.label",[r])}else n=Events.invTypeVsDispMsg[i];$("#invFilterDropDown").attr({disabled:!1}).find("option[value='"+i+"']").text(n),$("#invFilterTextBox").prop({disabled:!1}),$(".invAnc").removeClass("invAncSel"),$(".invAnc").eq(0).addClass("invAncSel")}}if(Events.withMeetingTool||$("#meetingInclude").is(":checked")){var s=Events.meetingToolName;s||""!==s||(s=$("#Crm_Events_MeetingSolutions_select option:selected").attr("name")),Events.checkAuthorizeDone(s)}Events.showHideMeetingIntegDiv()},showHideMeetingIntegDiv:function(){if("relatedlist_meetnow"!=Events.createSource){if("secContent_Event_Information"==$("#Events_fldRow_STARTDATETIME").parent().parent().attr("id")){var e=$("#Crm_Events_STARTDATETIME").data("dateObj").getTime(),t=(new Date).getTime(),a=$("#Events_fldRow_RECURRING"),i=$("#meetingOnlineProviders"),n=$("#Events_fldRow_LOCATION"),r=$("#Crm_Events_MeetingSolutions_select option:selected").attr("name");r||(r=Events.meetingToolName);var s=$("#meetingInclude");e<t||Events.selInviteesCnt>99?($(a).show(),i.hide(),n.removeClass("disable-events"),s.prop("checked")&&$("#Crm_Events_LOCATION").val(""),$("#CrmEventMeetingInteg").hide(),s.prop("checked",Events.meetingCheckBoxEnabled),Events.closeOnboarding()):(s.prop("checked")&&(i.show(),$("#Crm_Events_LOCATION").val(I18n.getMsg("crm.event.meeting.online.poweredby",Events.displayToolName[r])),n.addClass("disable-events"),$(a).hide()),1==$("#Crm_Events_MeetingSolutions_select").length&&i.addClass("nobdr"),$("#CrmEventMeetingInteg").show())}var o=$("#Crm_Events_REPEATTYPE").val();o&&"none"!=o&&$("#CrmEventMeetingInteg").hide(),Events.showOrHideAllDayEvent(!0)}},showHideSelIns:function(){var e=["c","cv","l","lv","u","g","r","rs","t"];for(idx=0;idx<e.length;idx++){var t=e[idx],a=$("#invSelTbody_"+t);a.append($("#SelListTbody_"+t).html());var i=a.find("tr"),n=$("#selInvHeader_"+t);i.length>0?(n.show(),n.next().show()):(n.hide(),n.next().hide())}},showInvList:function(e,t,a,i){t||($(".invAnc").removeClass("invAncSel"),$(a).addClass("invAncSel"));var n=$("#withEmtyEmailRec"),r=$("#invFilterDropDown");if(e&&"sel"==e){if(!validationUtils.validateCommaSepEmails("invMoreEmails"))return!1;this.invDelListCreate={u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}};var s=this.entityId;"clone"==Events.currentStatus&&(s=Events.cloneEntId);var o="&searchInvRel=false";if(Events.searchInvRel&&(o="&searchInvRel=true",-1!=Events.searchInvRelPageCnt&&(Events.selInvPageCnt=1)),Events.isFromSel=!0,!s||Events.selInvlinkClicked&&"onScroll"!=t)Events.showHideSelIns(),i&&($("#eventCreationDiv").animate({left:"-430px"},500),$("#participantDiv").show().animate({left:"0px"},500)),Events.selInviteesCnt<=0?$("#selectedInviteesEmpty").show():$("#selectedInviteesEmpty").hide();else{var l=Crm.getCrmBasePath()+"/AddInvitees.do?action=showSelInvs&pageno="+Events.selInvPageCnt+"&eventId="+s+o;$.ajax({url:l,type:"POST",success:function(e){if(Events.selInvlinkClicked=!0,$("#popupnew")[0].innerHTML=e,EvalInnerScript(getElemById("popupnew")),Events.selInvPagereqSent=!1,Events.showHideSelIns(),i&&($("#eventCreationDiv").animate({left:"-430px"},500),$("#participantDiv").show().animate({left:"0px"},500)),$("#popupnew").html(""),"onScroll"!=t){Events.showSelHeaders();var a=$("#selectedInvDiv");a.scroll((function(e){!Events.selInvPagereqSent&&a.scrollTop()>=a.get(0).scrollHeight-a.get(0).clientHeight-100&&Events.selInvPagerecAvail&&(Events.selInvPagereqSent=!0,Events.selInvPageCnt++,Events.showInvList("sel","onScroll"))}))}i||removeRowsFromSelInvList(Events.invRemoveJson),Events.selInviteesCnt<=0?$("#selectedInviteesEmpty").show():$("#selectedInviteesEmpty").hide()}})}$(".invList").hide();var d=$("#invFilterDropDown option:selected");Events.selectedOldVal=d.text(),d.text(I18n.getMsg("All")),(c=$("#invFilterDropDown")).prop("disabled",!0),c.parent().css({opacity:"0.5"}),$("#invFilterTextBox").prop("disabled",!0),$("#selectedInvDiv").show(),$(".topNav a").eq(0).removeClass("active"),$(".topNav a").eq(1).addClass("active"),n.removeClass("dB"),n.addClass("dN")}else{removeRowsFromSelInvList(Events.invDelListCreate),$("#selectedInvDiv").hide(),$("#invFilterDropDown").closest("td").show(),$("#invFilterTextBox").closest("div").show(),$(".topNav a").eq(0).addClass("active"),$(".topNav a").eq(1).removeClass("active"),$("#invListDiv_"+$("#invFilterDropDown").val()).show();var c,m=$("#invFilterDropDown").val();"c"!=m&&"l"!=m||(n.addClass("dB"),n.removeClass("dN")),Events.isFromSel=!1,(d=$("#invFilterDropDown option:selected")).text(d.attr("dispval")),(c=$("#invFilterDropDown")).prop("disabled",!1),$("#invFilterDropDown_chosen").removeClass("chosen-disabled"),c.trigger("change.select2"),c.parent().css({opacity:"1"}),$("#invFilterTextBox").prop("disabled",!1)}n.is(":visible")&&$("#invListDiv_"+r.val()).attr("style","height:188px !important"),$("#selectedInvDiv").perfectScrollbar()},setSelInvCnt:function(e){null!=e&&(this.selInviteesCnt=e),$("#selInvCntSpan").text(this.selInviteesCnt),0==this.selInviteesCnt?$("#Crm_Events_PARTICIPANTID").text(I18n.getMsg("None")):$("#Crm_Events_PARTICIPANTID").text(I18n.getMsg("crm.create.inv.cnt.label",[this.selInviteesCnt])),$("#selectedInvDiv").is(":visible")||(Events.selInviteesCnt<=0?$("#selectedInviteesEmpty").show():$("#selectedInviteesEmpty").hide())},isFutureEvent:function(){var e=(new Date).getTime(),t=$("#Crm_Events_STARTDATETIME").data("dateObj");return e<(t?t.getTime():Events.currentQuickViewId?Events.currentEventObjectInQV.start.getTime():returnJson.entityMapJson.STARTDATETIME.valueinLong)},parseInvTypeUserIdMap:function(e){var t=JSON.parse(e[0]),a=JSON.parse(e[1]);Events.getInvTypeUserIdMap(t),Events.getInvTypeUserIdMap(a)},getInvTypeUserIdMap:function(e){for(var t in"string"==typeof e&&(e=JSON.parse(e)),e){var a=e[t];if(Events.invTypeVsUserIdsMap[t]){var i=Events.invTypeVsUserIdsMap[t];for(var n in a)i[n]||(i[n]=a[n])}else Events.invTypeVsUserIdsMap[t]=a}},updateFinalIdJson:function(e){var t=e.split("actModule=")[1].split("&")[0].substring(0,1).toLowerCase(),a=e.split("actId=")[1].split("&")[0],i={},n={},r=[];r.push(a),i[a]=r,n[t]=i,Events.getSelectedInviteesCnt({},n),returnJson&&returnJson.inviteeDetails.every((function(e,t){return e.id!==a||(returnJson.inviteeDetails.deleteElementAt(t),!1)}))},getSelectedInviteesCnt:function(e,t){for(var a in"string"==typeof e&&(e=JSON.parse(e),t=JSON.parse(t)),e){var i=e[a];for(invId in i){var n=i[invId];Events.checkAvailabilityInInvAddArray(n,invId,a)}}for(var a in t){i=t[a];for(invId in i){n=i[invId];Events.checkAvailabilityInInvRemArray(n,invId,a)}}return Object.keys(Events.finalIdsJson).length},checkAvailabilityInInvAddArray:function(e,t,a){e.forEach((function(e){var i=Events.finalIdsJson[e];if(-1==Object.keys(Events.finalIdsJson).indexOf(e)){var n={};n[a]=[t],Events.finalIdsJson[e]=n}else i[a]&&-1==i[a].indexOf(t)?i[a].push(t):i[a]=[t]}))},checkAvailabilityInInvRemArray:function(e,t,a){e.forEach((function(e){var i=Events.finalIdsJson[e];if(i){if(i[a]&&-1!==i[a].indexOf(t)){var n=Events.finalIdsJson[e][a].indexOf(t);delete Events.finalIdsJson[e][a][n]}i&&0==Object.keys(i[a]).length&&delete Events.finalIdsJson[e][a],i&&0==Object.keys(i).length&&delete Events.finalIdsJson[e]}}))},formatInvDetailsToFinalIdsJson:function(e){var t=returnJson||Events.returnJson,a=e?e.inviteeDetails:t.inviteeDetails;Events.finalIdsJson={},"create"==Events.currentStatus?a.forEach((function(e){var t=Events.finalIdsJson[e.id],a=e.type[0].toLowerCase();t?-1===t.indexOf(a)&&t.push(a):Events.finalIdsJson[e.id]=[a]})):a.forEach((function(e){if("Email"===e.type){var t=e.name;Events.finalIdsJson[t]={},Events.finalIdsJson[t].e=[t]}else Events.finalIdsJson[e.id]=e.invTypeOfCurrUser}))},convertIntoResetCntJsonFormat:function(e){var t={};for(invType in e){var a=0,i=e[invType];if(0!==Object.keys(i).length&&("u"!=invType||"c"!=invType||"l"!=invType)){for(typeId in i)a+=i[typeId].length;t[invType]=a}}return t},convertIntoResponseFormat:function(e,t){var a={};if("l"==t||"c"==t||"u"==t||"e"==t)return e;for(var i in e){var n=e[i];if(0==Object.keys(n).length)a[i]={};else for(var r in n){var s;s="u"==i||"l"==i||"c"==i||"e"==i?[r]:Events.invTypeVsUserIdsMap[i][r],a[i]||(a[i]={}),a[i][r]=s}}return a},invitationLimitValidation:function(e,t,a,i,n,r){var s=$(".beforeAdd"),o=$("#invListDiv_"+t),l=$(".eventInvitationInfo-alert"),d=$("#showInviteeslimitalert"),c=$("#addpartCheckbox");Events.inviteeslimit==Events.selInviteesCnt&&Events.isFutureEvent()||Events.selInviteesCnt==Events.pastEventInvCnt&&!Events.isFutureEvent()?(Events.remainingInvitees=0,Events.invReached=!0,c.is(":checked")||c.attr("disabled","disabled"),Events.positionEmailTextBox(a,t,o,r),l.show(),d.text(I18n.getMsg("crm.event.participant.limit",Events.inviteeslimit)),s.attr("disabled",!0),Events.enableDisableEmailListBox(!0),a||Events.enableDisableDoneButton(!1)):Events.inviteeslimit<Events.selInviteesCnt&&Events.isFutureEvent()||Events.selInviteesCnt>Events.pastEventInvCnt&&!Events.isFutureEvent()?("onChange"!=i&&"onScroll"!=i&&e&&0!=n&&Events.showInvExceedPopup(),Events.positionEmailTextBox(a,t,o,r),c.is(":checked")||c.attr("disabled","disabled"),Events.enableDisableParticipantsDropDown(!1,!1),l.show(),d.text(I18n.getMsg("crm.event.participant.limit",Events.inviteeslimit)),s.attr("disabled",!0),Events.enableDisableEmailListBox(!0),Events.enableDisableDoneButton(!0)):e||(Events.remainingInvitees=Events.pastEventInvCnt-Events.selInviteesCnt,Events.isFutureEvent()&&(Events.remainingInvitees=Events.inviteeslimit-Events.selInviteesCnt),c.attr("disabled",!1),Events.invReached=!1,l.hide(),Events.positionEmailTextBox(a,t,o,r),s.attr("disabled",!1),Events.enableDisableEmailListBox(!1),Events.inviteeslimit>Events.selInviteesCnt&&!a&&Events.enableDisableParticipantsDropDown(!1,!1),Events.enableDisableDoneButton(!1))},positionEmailTextBox:function(e,t,a,i){e||0==i||"c"!=t&&"l"!=t||("rc"==$("#invFilterDropDown").val()?$("#invListDiv_rc").attr("style","height:188px !important"):a.attr("style","height:188px !important"))},enableDisableEmailListBox:function(e){var t=$("#invEmailsListBox");$("#invEmailsListBox input").attr("disabled",e),t.css("background-color","white"),e&&t.css("background-color","#E9E9E9")},enableDisableDoneButton:function(e){$("#doneAddParticipantBtn").attr("disabled",e),$("#doneViewPartFromDetail").attr("disabled",e)},enableDisableParticipantsDropDown:function(e,t,a){e=Events.isBothStatusSame(e,a);var i=$("#invFilterDropDown"),n=i.parent();i.prop("disabled",e),n.css({opacity:"1"}),t&&n.css({opacity:"0.5"}),$("#invFilterTextBox").prop("disabled",e)},isBothStatusSame:function(e,t){return Events.selInviteesCnt>=0&&$("#selectedInviteesEmpty").hide(),t?-1==$(".invAncSel").html().indexOf("All")&&(-1!=$(".invAncSel").html().indexOf("Selected")||void 0):e},showInvExceedPopup:function(){networkUtils.loadFeatureScripts(["zohocrm_invitationExceedPopup.js"],(function(){var e=document.createElement("DIV");e.innerHTML=Handlebars.templates.InvitationExceedPopup(),document.body.appendChild(e);var t=$("#invExceedMsg");t.length>0&&""==t[0].innerHTML&&(t[0].innerHTML=I18n.getMsg("crm.event.participant.limit.htmldetail",Events.inviteeslimit));var a=$("#invitationExceedPopup"),i=(renderingUtils.windowHeight-a.height()-70)/2;a.attr("style","top:"+i+"px !important"),crmui.showPopup({id:"invitationExceedPopup"}),$(".freezeLayer_zi32").length<1&&$(".bodycontainer,.commonRightPanel").append('<div class="freezeLayer_zi32 zi34"></div>'),$(".freezeLayer_zi32").show()}))},removeSelectedOptionFromExceededPopup:function(){var e=$("#invFilterDropDown").val(),t=e||Events.selectedOption;Events.invitationLimitValidation(!0,t,Events.isFromSel),$("#invitationExceedPopup").hide(),$(".freezeLayer_zi32").hide()},completeMultipleInviteesSelectRequest:function(e,t,a){Events.totalReqSent=Events.totalReqSent<=0||Events.totalReqSent-e<=0?0:Events.totalReqSent-e,0==Events.totalReqSent&&(Events.enableDisableDoneButton(!1),t?Events.enableDisableParticipantsDropDown(!0,!0,a):Events.enableDisableParticipantsDropDown(!1,!1,a),Events.enableDisableEmailListBox(!1)),Events.inviteeslimit==Events.selInviteesCnt&&(Events.enableDisableEmailListBox(!0),t||Events.enableDisableParticipantsDropDown(!1,!1,a)),Events.inviteeslimit>Events.selInviteesCnt&&(Events.enableDisableEmailListBox(!1),Events.enableDisableParticipantsDropDown(!1,void 0,a),t&&0==Events.totalReqSent&&Events.enableDisableParticipantsDropDown(!0,!1,a),Events.enableDisableDoneButton(!1))},initializeMultipleInviteesSelectRequest:function(){Events.totalReqSent=Events.totalReqSent+1,Events.enableDisableParticipantsDropDown(!0,!0),Events.enableDisableDoneButton(!0),Events.enableDisableEmailListBox(!0)},saveParticipantFromView:function(e,t,a,i,n){if(Events.validateEmailIdsInTagit()){var r=(l="quickView"===e?Events.currentEventObjectInQV:Events.currentEventObjectInView).id;if(a)Events.showSendMailAlert(l,!0,e,n);else{commonUtils.showHideLoadingDiv(!0);var s=Crm.getCrmBasePath()+"/AddInvitees.do",o="pageno=0&eventId="+r;Events.invAddJson.e=Events.addInvEmailsList,Events.invRemoveJson.e=Events.removeInvEmailsList;var l,d=1==Events.sendNotificationMail?"1":"0";o+="quickView"==e?"&calledFrom="+e+"&action=addInvfromQV&invAddJson="+encodeURIComponent(JSON.stringify(Events.invAddJson))+"&invRemoveJson="+encodeURIComponent(JSON.stringify(Events.invRemoveJson)):"&calledFrom="+e+"&eventStatus="+d+"&action=addInvfromDetail&invAddJson="+encodeURIComponent(JSON.stringify(Events.invAddJson))+"&invRemoveJson="+encodeURIComponent(JSON.stringify(Events.invRemoveJson))+"&invStatus="+$("#invStatusFilter").val()+"&"+trimBoth($("#viewInviteesSearchTxt").val()),Crm.requestParam&&Crm.requestParam.isCancelMailNeeded&&(o+="&isCancelMailNeeded="+Crm.requestParam.isCancelMailNeeded),i&&(o+="&isNeedupdateStatus="+i),n&&(o+="&responsePage="+n),o+="&"+csrfParamName+"="+encodeURIComponent(csrfToken),$.ajax({url:s,type:"POST",data:o,success:function(a){if(commonUtils.showHideLoadingDiv(),-1==a.indexOf("error")){if("detailView"==e)t&&"viewInvitees"!==n?(Events.closeViewInviteesPop(),reloadCurrentEntityView()):(Events.closeEntity(),freezeBackground(),Events.loadedInvIds=[],Events.invPreparedPageCnt=0,Events.lastLoadedType="3",Events.viewInviteeRecordAvailable=!1,Events.viewInviteeReqSent=!1,Events.viewInviteeRecordAvailable=!1,Events.inviteesViewPageNo=0,Events.loadViewInviteesPopDiv(),$("#viewInviteesPop")[0].innerHTML=a,EvalInnerScript($("#viewInviteesPop")[0]),$("#addInvFromDetCont").html(""),Events.initViewInviteesPop(),$("#doneBtnQuickView").hide()),Events.selInviteesCnt=0;else if("quickView"==e){$("#eventViewPopup").offset().top;var r=parseInt($("#quickViewRelDivCont").prev().css("top"),10),s=parseInt($("#quickViewRelDivCont").parent().css("top"),10);if("viewInvitees"===n)Events.loadedInvIds=[],Events.invPreparedPageCnt=0,Events.lastLoadedType="3",Events.viewInviteeRecordAvailable=!1,Events.viewInviteeReqSent=!1,Events.viewInviteeRecordAvailable=!1,Events.inviteesViewPageNo=0,$("#qvInvitedListDivInner").empty(),$("#qvInvitedListDivInner")[0].innerHTML=a,EvalInnerScript($("#qvInvitedListDivCont")[0]),$("#addInvFromDetCont").html(""),Events.initViewInviteesPop(),$("#qvAddInvFoterBtns_fromView").hide(),$("#doneBtnQuickView").show(),$("#doneBtnDetailsView").hide();else{var o=parseInt(a),d=$("#value_Participants").find(".invited");if(0==o)d.html(I18n.getMsg("None")),d.addClass("invNone"),$("#textarea_Participants").hide();else{d.removeClass("invNone"),d[0].setAttribute("onclick","Events.viewInviteesPop(-2, undefined, 'quickView')"),d.text(I18n.getMsg("crm.create.inv.cnt.label",[o]));(["1","2","3","4"].indexOf(l.status)>-1||i)&&($("#textarea_Participants").find(".invitedSt").text("("+o+")"),$("#textarea_Participants").css({display:"block"}))}$("#qvAddInvFoterBtns").hide(),$("#qvAddInvFoterBtns_fromView").hide(),$("#qv_editBtnDiv").show(),$("#qvAddInvFoterBtns").hide(),$("#quickViewRelDivCont").animate({height:"305px"},500),$("#quickViewRelDivCont").parent().animate({top:s+125},500),$("#quickViewRelDivCont").prev().animate({top:r-125},500),$("#qvParticipantDivCont").show().animate({left:"440px"},500),$("#quickViewMainDiv").animate({left:"0"},500,(function(){$("#qvParticipantDivInner").html("")})),Events.resetEntityVars()}}thirdPartyUtils.bindPerfectScroll("#viewInviteesListDiv"),Events.addInvEmailsList={},Events.removeInvEmailsList={},Events.selInvlinkClicked=!1,Events.invAddLinkClicked=!1,Events.invAddJson={t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},Events.invRemoveJson={t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},Events.maxReminderValue=1,Events.reminderCount=1,Events.allDayReminders=[],Events.reminders=[]}else{var c=JSON.parse(a);crmui.showMsgBand("error",$ESAPI.encoder().encodeForHTML(I18n.getMsg(c.errMsg)),1e3)}}})}}},donePartViewFromQuickView:function(){$("#qvDoneParViewFoterBtns").hide(),$("#qvInvitedListDivCont").show().animate({left:"440px"},500),$("#qv_editBtnDiv").show(),$("#quickViewMainDiv").animate({left:"0"},500),Events.invAddLinkClicked=!1},loadMap:function(e,t,a){var i=encodeURIComponent(e),n="https://maps.google.com/maps?q="+i,r="https://maps.google.com/maps?q=to:"+i;$("#event_map_loc").html($ESAPI.encoder().encodeForHTML(e)),$("#eventDetail_MapDiv .viewMap").attr("href",n),$("#eventDetail_MapDiv .getDir").attr("href",r);var s="https://maps.googleapis.com/maps/api/staticmap?center="+i+"&zoom=13&size="+t+"x"+a+"&sensor=false";$("#event_static_map").attr("src",s);var o=$("#event_map_bubDiv"),l=o.outerWidth(),d=(t-l)/2;o.css({left:d});var c=$("#eventDetail_MapDiv .mapPointer"),m=l/2-c.outerWidth()/2;c.css({left:m})},setEditOption:function(e,t){Crm.requestParam.eventEditOption=t,Events.saveEntity(e,!0,!1)},editRecurringAlert:function(e,t,a){var i=!1;if(Crm.isRecordModified||a){var n=t.id+"";$.ajax({url:Crm.getCrmBasePath()+"/events/EventAction.do",type:"POST",data:"type=getLastOccurrenceId&eventId="+n+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),async:!1,success:function(r){if(trimBoth(r)!==n){Events.loadEditRecAlertMsgDiv(),renderingUtils.positionCenter("editRecAlertMsgDiv");var s=$("#editRecAlertMsgDiv");s.find(".allUpCome").prop("disabled",!1).off("click").click((function(){$("#editRecAlertMsgDiv").hide(),e?calView.saveEventDrop(t,a,!0):Events.setEditOption(event,"allUpCome"),renderingUtils.removeDummyBackground()})),s.find(".onlyThis").prop("disabled",!1).off("click").click((function(){$("#editRecAlertMsgDiv").hide(),e?calView.saveEventDrop(t,a,!1):Events.setEditOption(event,"onlyThis"),renderingUtils.removeDummyBackground()})),s.find(".cancel").prop("disabled",!1).off("click").click((function(){$("#editRecAlertMsgDiv").hide(),e&&a(),renderingUtils.removeDummyBackground()})),renderingUtils.dummyBackground(!1,"editRecAlertMsgDiv"),s.find(".allUpCome").focus(),s.show()}else i=!0}})}else i=!0;return i},getDateTimeInRespFormat:function(e){var t=e.split(" ");return t[0]+" "+t[1]+" "+t[2]+" "+t[3]+" "+t[4]},getUserFormat:function(e){var t=e.split(" "),a=t[t.length-1].split(":"),i=a[0]+":"+a[1];if("HH:mm"===Crm.userDetails.TIME_FORMAT)return i;var n=a[0]<12?" AM":" PM";return" PM"===n?a[0]=a[0]<=12?a[0]:a[0]-12:" AM"===n&&("0"!==a[0]&&"00"!==a[0]||(a[0]=12)),a[0]+":"+a[1]+n},changeTime:function(e,t,a,i,n,r,s,o){encodeURIComponent("Start DateTime"),encodeURIComponent(t),encodeURIComponent(a),csrfParamName,encodeURIComponent(csrfToken);var l="/crm/v2/Events/"+e+"?affected_data=true",d={},c={},m=[],u="Events";if("Events"===n.activityType){var v=Crm.userDetails.TIME_ZONE.split(".");v=v[0]+":"+v[1],c.Start_DateTime=apiDateTimeFormat(t)+v,c.End_DateTime=apiDateTimeFormat(a)+v,c.All_day="true"===i||!0===i,d.update_all_future_events=r||!1}else"Calls"===n.activityType&&(l="/crm/v2/Calls/"+e+"?affected_data=true",c={},u="Calls",o?("module=Calls&uitype=786&tableName=CrmTask&moduleid="+e+"&type=scheduleCallUpdate&itsFrom=calendarView&fieldLabel="+encodeURIComponent("Call Status")+"&fieldValue=Scheduled&columnName=CALLSTATUS&tableName1=CrmTask&fieldLabel1="+encodeURIComponent("Call Start Time")+"&columnName1=CALLSTARTDATETIME&fieldValue1="+encodeURIComponent(t)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),c.Call_Status="Scheduled",c.Call_Start_Time=apiDateTimeFormat(t)):("module=Calls&uitype=786&tableName=CrmTask&columnName=CALLSTARTDATETIME&moduleid="+e+"&fieldLabel="+encodeURIComponent("Call Start Time")+"&fieldValue="+encodeURIComponent(t)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),c.Call_Start_Time=apiDateTimeFormat(t)));n.cancelMail&&("&cancelMail="+n.cancelMail,c.Send_Notification_Email=n.cancelMail),r||(r=!1),null!=n.futureToPast&&n.futureToPast;var p=$("#loadedCalendarUserIds").val();p&&"null"!==p||(p=""),encodeURIComponent(p),m.push(c),d.data=m;var h={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};clientPortalName&&(h["X-CRMPORTAL"]=window.clientPortalName),$.ajax({url:l,type:"PUT",data:JSON.stringify(d),headers:h,contentType:"application/json",success:function(t){if("error"===t.data.status?t="error":((t={}).startFormatted=n.startFormatted,t.invitedby=n.invitedby,t.editable=n.editable,t.start=Events.getDateTimeInRespFormat(n.start.toString()),t.title=n.title,t.ownerId=n.ownerId,t.duration=n.duration,t.isRecEvent=n.isRecEvent,t.cus_allDay=n.cus_allDay,t.endFormatted=n.endFormatted,t.end=Events.getDateTimeInRespFormat(n.end.toString()),t.onlineEvent=n.onlineEvent,t.id=n.id,t.isInvitedEvent=n.isInvitedEvent,t.activityType=n.activityType,t.startInUserFormat=Events.getUserFormat(t.start),t.endInUserFormat=Events.getUserFormat(t.end),"Events"===u?(t.toolTip=t.title+"<br><span class='toLower'>"+t.startInUserFormat+" - "+t.endInUserFormat+"</span>",t.color=n.color):t.toolTip=t.title+"<br><span class='toLower'>"+t.startInUserFormat+"</span>"),renderingUtils.positionCenter("bulkUpdateSuccess"),"Calls"===n.activityType?showAlertMessage("bulkUpdateSuccess",!0,I18n.getMsg("crm.call.re.schedule.success.msg"),1e3):"error"!==t?showAlertMessage("bulkUpdateSuccess",!0,I18n.getMsg("crm.event.edit.success.msg",[Events.getModuleName(!0,!0,!0)]),1e3):showAlertMessage("bulkUpdateSuccess",!1,I18n.getMsg("crm.event.edit.error.msg",[Events.getModuleName(!0,!1,!0)]),500),!calView.isMultiUserView){$.datepicker.formatDate("yy-mm-dd",new Date(calView.currEventObject.start)),$.datepicker.formatDate("yy-mm-dd",new Date(n.start));if(r)calView.needRefresh=!0;else if("monthview"===calView.currCalView){if(Events.isRefreshNeeded(calView.currEventObject,n,!0))calView.needRefresh=!0;else{var a=t;i&&(a.durationEditable=!1),$("#calendarBd").fullCalendar("removeEvents",e),$("#calendarBd").fullCalendar("renderEvent",a)}}else{a=t;i&&(a.durationEditable=!1),$("#calendarBd").fullCalendar("removeEvents",e),$("#calendarBd").fullCalendar("renderEvent",a)}calView.needRefresh&&calView.refresh()}calView.currEventObject=void 0},error:function(e){e.status===crmConstants.errorStatusCode&&s&&s()}})},loadTileForDayCal:function(e,t){if(getElemById("allUserTbl")){var a=$("#multiUsrScroll").scrollTop();if((Events.calScrollYval!==a||e)&&(Events.calScrollYval=a,!Events.isAllUsersLoaded&&!Events.scrollOnSetHTML||e)){Events.isUsersLoadReqSent=!0;var i="";if(e?(Events.tileLoadingUserId=e,i="&userId="+e):Events.tileLoadingUserId="",t){i+="&isTailLoadCall=true";var n=$("#loadedUserIds").val();n&&"null"!==n&&void 0!==n&&(i=i+"&idStr="+n);var r=$("#loadedUserViewType").val(),s="MYEVENT";"user"===r?s="u":"group"===r?s="g":"territory"===r?s="t":"ALLEVENT"===r&&(s="ALLEVENT"),i+="&calViewType="+s}var o=crmCalendar.calcTDWidth(calView.currCalView),l=$("#topdivbg"),d=Math.ceil(($(window).height()-(l.length>0?l.height():0)-100)/100);mR(Crm.getCrmBasePath()+"/events/CalendarView.do?type="+calView.currCalView+"&userCalView="+getElemById("selUser").value+"&obtaineddate="+getElemById("obtaineddate").value+"&pageNo="+Events.tilePageNo+i+"&tdWidthParam="+o+"&userFetchCnt="+d,Events.reConstructTileForDayCal)}}else window.onscroll=null},reConstructTileForDayCal:function(e){if(""===Events.tileLoadingUserId){var t=$("#multiUsrScroll").scrollTop();$("#allUserTbl").fixedHeaderTable("destroy"),Events.calHTML+=e,$("#allUserTbl").html(Events.calHTML),$(".fht-fixed-column").remove();var a=Events.getWidgetHeight();(r=getElemById("allUserTbl").offsetHeight-4)<a&&(a=r),$("#allUserTbl").fixedHeaderTable({footer:!1,cloneHeadToFoot:!0,fixedColumn:!0,height:a,create:function(){$("#multiUsrScroll .fancyTable tbody").find("tr").each((function(e,t){$(this).attr("event_row_idx",e+1),(e+1)%2==0&&$(this).attr("class","evenrow")})),$("#multiUsrScroll2 .fancyTable tbody").find("tr").each((function(e,t){$(this).attr("event_row_idx",e+1),(e+1)%2==0&&$(this).attr("class","evenrow")})),$("#multiUsrScroll").scrollTop(t)}}),Events.scrollOnSetHTML=!1,setTimeout((function(){Events.moveMultiUserCal(!0,Events.multiUserDayScrollTime)}),0),$(".fht-tbody").height(a-20+"px"),$(".fht-fixed-body .fht-tbody").on("mousemove",(function(e){Events.showNaviForMultiUserCal(e,this)}))}else if(getElemById("userRow_"+Events.tileLoadingUserId)){var i=getElemById("userRow_"+Events.tileLoadingUserId).getAttribute("event_row_idx"),n=getElemById("userRow_"+Events.tileLoadingUserId).offsetHeight,r=getElemById("allUserTbl").offsetHeight-4;if($("tr#userRow_"+Events.tileLoadingUserId).replaceWith(e),getElemById("userRow_"+Events.tileLoadingUserId).setAttribute("event_row_idx",i),$("tr[event_row_idx='"+i+"']").css("height",n+"px"),$("tr[event_row_idx='"+(parseInt(i)-Events.totalUsersCount)+"']").css("height",n+"px"),$('span[id^="userEventCnt_"]',$("tr[event_row_idx='"+parseInt(i)+"']")).each((function(e){this.innerHTML=$('span[id^="userEventCnt_"]',$("#userRow_"+Events.tileLoadingUserId))[0].innerHTML})),"dayview"===calView.currCalView)r<(a=Events.getWidgetHeight())&&(a=r),$(".fht-tbody").height(a+"px"),$("#allUserTbl").fixedHeaderTable({height:a})}JSEvalScript(getElemById("allUserTbl")),Events.isUsersLoadReqSent=!1,Events.isAllUsersLoaded||""!==Events.tileLoadingUserId||Events.tilePageNo++},callMonthCalScroller:function(e,t,a){if($("div#monthUserList_"+e+" dl").length>5){if(a||(a=$("#monthUserCont_"+e).scrollTop()),!t){var i=$("div#monthUserList_"+e+" dl");(i.length-5)*(i[0].offsetHeight+3)>a+i.length?($("#usrMoreDown_"+e).show(),$("#usrMoreDown_"+e).attr("class","usrMore usrMoreDown")):($("#usrMoreDown_"+e).hide(),$("#usrMoreDown_"+e).attr("class","usrMore usrMoreDownSm"),Events.callMonthCalScrollLoader(e,a))}t&&(a>15?($("#usrMoreUp_"+e).show(),$("#usrMoreUp_"+e).attr("class","usrMore usrMoreUp")):($("#usrMoreUp_"+e).hide(),$("#usrMoreUp_"+e).attr("class","usrMore usrMoreUpSm"),Events.callMonthCalScrollLoader(e,a)))}},callMonthCalScrollLoader:function(e,t){if($("div#monthUserList_"+e+" dl").length>5){t||(t=$("#monthUserCont_"+e).scrollTop());var a=$("div#monthUserList_"+e+" dl");(a.length-5)*(a[0].offsetHeight+3)>t+a.length?($("#usrMoreDown_"+e).show(),$("#usrMoreDown_"+e).attr("class","usrMore usrMoreDownSm")):$("#usrMoreDown_"+e).hide(),t>15?($("#usrMoreUp_"+e).show(),$("#usrMoreUp_"+e).attr("class","usrMore usrMoreUpSm")):$("#usrMoreUp_"+e).hide()}},showConfirmForModify:function(e,t,a,i,n){var r=t.id;$.ajax({url:Crm.getCrmBasePath()+"/events/EventAction.do",data:"type=getInvitedCnt&eventId="+r,type:"POST",success:function(r){if(parseInt(r)>0){Events.loadInvitationConfirmDiv();var s=$("#invitationConfirmDiv"),o=s.find(".msgBody"),l=s.find(".msgTitle"),d=s.find(".send").prop("disabled",!1),c=s.find(".dntSend").prop("disabled",!1),m=s.find(".cancel").prop("disabled",!1);if(l.hide(),e){d.val(I18n.getMsg("crm.event.btn.notify.part")),c.val(I18n.getMsg("crm.event.btn.dnt.notify.part")).show();var u=$ESAPI.encoder().encodeForHTML(t.title);o.html(I18n.getMsg("crm.future.to.past.msg",[u])),m.show(),d.off("click").click((function(r){s.hide(),Events.sendNotificationMail=!0,renderingUtils.removeDummyBackground(),i?n?n():(t.futureToPast=e,t.cancelMail="true",calView.saveEventDrop(t,a)):n?n():Events.saveEntity(r,!0,!1)})),c.off("click").click((function(r){s.hide(),Events.sendNotificationMail=!1,renderingUtils.removeDummyBackground(),i?n?n():(t.futureToPast=e,t.cancelMail="false",calView.saveEventDrop(t,a)):n?n():Events.saveEntity(r,!0,!1)})),m.off("click").click((function(e){i&&a(),s.hide(),renderingUtils.removeDummyBackground()}))}else d.val(I18n.getMsg("crm.button.send")),c.val(I18n.getMsg("crm.cancel.this.change")).show(),o.text(I18n.getMsg("crm.past.to.future.msg")),m.hide(),d.off("click").click((function(r){s.hide(),Events.sendNotificationMail=!0,renderingUtils.removeDummyBackground(),i?n?n():(t.futureToPast=e,calView.saveEventDrop(t,a)):n?n():Events.saveEntity(r,!0,!1)})),c.off("click").click((function(e){i&&a(),s.hide(),Events.sendNotificationMail=!1,renderingUtils.removeDummyBackground()}));if(null!=t.sourceid&&e)return c.click(),!0;var v=s.attr("id");return renderingUtils.dummyBackground(!1,v),mailsetCenter(v),s.show(),d.focus(),!0}i?n?n():calView.saveEventDrop(t,a):n?n():Events.saveEntity(event,!0,!1)}})},handleEvtDelinMulUserWeekView:function(e){var t=getElemById("dCMU_"+e).getAttribute("host");Events.loadTileForDayCal(t)},handleEvtAddinMulUserWeekView:function(e,t,a){t&&t.host!==a.host&&Events.loadTileForDayCal(t.host),setTimeout((function(){var e=a.host;e||(e=a.ownerId),getElemById("userRow_"+e)&&Events.loadTileForDayCal(e)}),500)},handleEvtDelinMulUserDayView:function(e){var t=getElemById("dCMU_"+e).getAttribute("host");Events.loadTileForDayCal(t)},handleEvtAddinMulUserDayView:function(e,t,a){t&&t.host!==a.host&&Events.handleEvtDelinMulUserDayView(e),setTimeout((function(){var e=a.host;e||(e=a.ownerId),getElemById("userRow_"+e)&&Events.loadTileForDayCal(e)}),500)},handleEvtDelinMulUserMonthView:function(e){var t=getElemById("dCMU_"+e),a=parseInt(t.getAttribute("idx")),n=parseInt(t.getAttribute("eventDur"));for(i=1;i<n;i++){var r=getElemById("dCMU_"+e+"_"+(a+i));r&&r.parentNode.removeChild(r)}t.parentNode.removeChild(t)},handleEvtAddinMulUserMonthView:function(e,t,a){t&&Events.handleEvtDelinMulUserMonthView(e);var n=a.host;n||(n=a.ownerId),t&&t.color!==a.color&&calView.refresh();var r=new Date(a.start),s=new Date(a.end),o=(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),new Date(a.start)),l=new Date(a.end),d=(new Date,r.getHours()),c=(r.getMinutes(),s.getHours(),s.getMinutes(),a.allday),m=a.title,u=m;u.length>25&&(u=u.substring(0,22)+"..."),o.setHours(0),o.setMinutes(0),o.setSeconds(0),l.setHours(0),l.setMinutes(0),l.setSeconds(0),Events.monthStartDate.setHours(0),Events.monthStartDate.setMinutes(0),Events.monthStartDate.setSeconds(0),Events.monthEndDate.setHours(0),Events.monthEndDate.setMinutes(0),Events.monthEndDate.setSeconds(0);var v=Math.ceil((l.getTime()-o.getTime())/864e5);o.getTime()<Events.monthStartDate.getTime()&&(o=Events.monthStartDate);var p=Events.monthStartDate.getTime(),h=Events.monthEndDate.getTime(),g=o.getTime(),C=a.end;if(g>p&&C<h||C<h&&C>p||g<h&&g>p){var f=Math.ceil((o.getTime()-Events.monthStartDate.getTime())/864e5);o.getTimezoneOffset()!=Events.monthStartDate.getTimezoneOffset()&&calView.refresh(),l.getTime()>Events.monthEndDate.getTime()&&(l=Events.monthEndDate);var E=l.getTime()===o.getTime()?0:Math.ceil((l.getTime()-o.getTime())/864e5);++E>42&&(E=42);var I=c?"wAllday cmLdl":v>0?"wMutipleDay cmLdl":"",y="";if(!c){var R=(k=r.getHours())<13?" AM":" PM";k=(k=0===(k=k>13?k-12:k)?12:k)<10?"0"+k:k;var b=(F=s.getHours())<13?" AM":" PM";F=(F=0===(F=F>13?F-12:F)?12:F)<10?"0"+F:F;var T=r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate()+" "+k+":"+(r.getMinutes()<10?"0"+r.getMinutes():r.getMinutes())+R,D=s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate()+" "+F+":"+(s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes())+b,w=T.split(" "),M=D.split(" ");y=o-l!=0?w[1]+" "+w[2]:w[1]+" "+w[2]+" - "+M[1]+" "+M[2]}(P=document.createElement("dl")).setAttribute("stHr",r.getHours()),P.setAttribute("stMin",r.getMinutes()),P.setAttribute("idx",f),P.setAttribute("id","dCMU_"+e),P.setAttribute("stMin",r.getMinutes()),P.setAttribute("eventCont",!1),P.setAttribute("eventDur",E);var S=document.createElement("img");if("Unavailable"==a.activityType?(P.setAttribute("onclick","Events.showUnavailablePopUp('"+e+"',this, event,'"+a.host+"','monthview')"),S.src="//"+RebrandLinkUtil.getProperty("CONTACTS_URL")+"/file?ID="+a.zuid+"&fs=thumb"):(P.setAttribute("onclick","Events.eventQuickView('"+a.activityType+"', '"+e+"', this, event, false, false, false, '"+a.invitedby+"')"),S.src=Events.userImgSrc),P.style.position="relative",P.className=I,P.classList.add("cmLdl"),P.classList.add("event-title-padding"),(x=document.createElement("dt")).setAttribute("class","cmLdt"),S.title=a.hostName,x.appendChild(S),(U=document.createElement("dd")).setAttribute("class","cmLdd"),(V=document.createElement("span")).innerText=u,V.title=m,U.appendChild(V),0===Crm.calPreferences.ACTIVITYTYPE&&"Calls"===a.activityType){var L=document.createElement("div");$(L).addClass("fc-schedule-call"),U.appendChild(L)}var A=document.createTextNode(y),_=document.createElement("br");if(U.appendChild(_),(B=document.createElement("span")).setAttribute("class","toLower"),B.appendChild(A),U.appendChild(B),P.appendChild(x),P.appendChild(U),0===(H=$("div#monthUserList_"+f+" dl")).length)getElemById("monthUserList_"+f).appendChild(P);else{var O=!1;for(i=0;i<H.length;i++){var N=H[i];if((k=parseInt(N.getAttribute("stHr")))>(d=r.getHours())){getElemById("monthUserList_"+f).insertBefore(P,N),O=!0;break}if(k===d&&parseInt(N.getAttribute("stMin"))>=r.getMinutes()){getElemById("monthUserList_"+f).insertBefore(P,N),O=!0;break}}O||getElemById("monthUserList_"+f).appendChild(P)}if(E>1)for(j=1;j<E;j++){var P;y="";if(!c&&E===j+1){var k;R=(k=r.getHours())<13?" AM":" PM";k=(k=0===(k=k>13?k-12:k)?12:k)<10?"0"+k:k;var F;b=(F=s.getHours())<13?" AM":" PM";F=(F=0===(F=F>13?F-12:F)?12:F)<10?"0"+F:F;T=r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate()+" "+k+":"+(r.getMinutes()<10?"0"+r.getMinutes():r.getMinutes())+R,D=s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate()+" "+F+":"+(s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes())+b,w=T.split(" ");y=" ends "+(M=D.split(" "))[1]+" "+M[2]}(P=document.createElement("dl")).setAttribute("stHr",r.getHours()),P.setAttribute("stMin",r.getMinutes()),P.setAttribute("idx",f),P.setAttribute("id","dCMU_"+e+"_"+(f+j)),P.setAttribute("stMin",r.getMinutes()),P.setAttribute("eventCont",!1),P.setAttribute("eventDur",E);var x,U,V;S=document.createElement("img");if("Unavailable"==a.activityType?(P.setAttribute("onclick","Events.showUnavailablePopUp('"+e+"',this, event,'"+a.host+"','monthview')"),S.src="//"+RebrandLinkUtil.getProperty("CONTACTS_URL")+"/file?ID="+a.zuid+"&fs=thumb"):(P.setAttribute("onclick","Events.eventQuickView('"+a.activityType+"', '"+e+"', this, event, false, false, false, '"+a.invitedby+"')"),S.src=Events.userImgSrc),P.style.position="relative",P.className=I,P.classList.add("cmLdl"),P.classList.add("event-title-padding"),(x=document.createElement("dt")).setAttribute("class","cmLdt"),S.title=a.hostName,x.appendChild(S),(U=document.createElement("dd")).setAttribute("class","cmLdd"),(V=document.createElement("span")).innerText=u,V.title=m,U.appendChild(V),0===Crm.calPreferences.ACTIVITYTYPE&&"Calls"===a.activityType){L=document.createElement("div");$(L).addClass("fc-schedule-call"),U.appendChild(L)}var B,H;A=document.createTextNode(y),_=document.createElement("br");U.appendChild(_),(B=document.createElement("span")).setAttribute("class","toLower"),B.appendChild(A),U.appendChild(B),P.appendChild(x),P.appendChild(U),0===(H=$("div#monthUserList_"+(f+j)+" dl")).length?getElemById("monthUserList_"+(f+j)).appendChild(P):getElemById("monthUserList_"+(f+j)).insertBefore(P,H[0])}}},setStatus:function(e){this.currentStatus=e},getStatusObj:function(e,t){var a=Events.statusDropDownObj,i=parseInt(e);i&&i>8&&(i=parseInt(i)-10);return 0===i?(a=[Events.statusDropDownObj[0],Events.statusDropDownObj[1]],t&&(a=a.slice(0,1))):-1===i?a=[Events.statusDropDownObj[2]]:1===i&&(a=[Events.statusDropDownObj[1],Events.statusDropDownObj[2]],t&&(a=a.slice(0,1))),a},moveMultiUserCal:function(e,t){if(Events.mouseStillDown||t){var a=null;"dayview"===calView.currCalView&&(t||(Events.isMultiUserDayScrolled=!0)),a=Events.tdWidth+1,t&&(a*=t),"weekview"===calView.currCalView&&(a=0),e?t?$(".fht-table-wrapper .fht-tbody").scrollLeft(a):($(".fht-table-wrapper .fht-tbody").animate({scrollLeft:"+="+a+"px"},200),Events.multiUserDayScrollTime<18&&(Events.multiUserDayScrollTime+=1)):t?$(".fht-table-wrapper .fht-tbody").scrollLeft(a):($(".fht-table-wrapper .fht-tbody").animate({scrollLeft:"-="+a+"px"},200),Events.multiUserDayScrollTime>0&&(Events.multiUserDayScrollTime-=1))}else clearInterval(Events.multiUserCalMovement)},showMoreEvents:function(e,t,a){getElemById("moreEvent_"+e+"_"+t);var n=$("div#moreEvent_"+e+"_"+t+" p"),r=$("#moreEventLink_"+e+"_"+t).offset(),s=getElemById("event_"+e+"_"+t).offsetWidth,o=$("#showMoreEventsDIV").outerHeight(),l=window.innerHeight,d=document.body.clientHeight;$("#showMoreEventsDIV").find("p").each((function(){$(this).remove()}));var c=$("#wid_calCreate_opts_menu");c.is(":visible")&&c.hide();var m=getElemById("showMoreEventsDIV");for(i=0;i<n.length;i++){var u=n[i].cloneNode(!0);if(m.appendChild(u),9===i&&n.length>10){var v=document.createElement("p");$(v).addClass("andMoreEv"),v.innerHTML=I18n.getMsg("crm.events.calender.multiUser.month.moreEvents",[n.length-10]),m.appendChild(v);break}}m.style.display="block",m.style.left=parseInt(r.left-10)+"px",m.style.width=s+"px";var p=a.clientY,h=(a.pageY,(l||d)-p),g=parseInt(r.top)+20;h<o+24&&(g=g-20-o),m.style.top=g+"px",$("#showAllEventsInnerDIV").scrollTop(0)},hideMoreEvents:function(e,t){getElemById("showMoreEventsDIV").style.display="none"},showAllEvents:function(e,t,a){var n=getElemById("showAllEventsInnerDIV");$("#showAllEventsInnerDIV").find("p").each((function(){$(this).remove()})),$("#tempShowEvent_"+e+"_"+t).find("p").each((function(){$(this).remove()}));getElemById("userRow_"+e).getAttribute("username");var r=getElemById("weekRowHeader_"+t).getAttribute("dT");getElemById("allEventsPopHeader").innerText=r;var s=$("div#event_"+e+"_"+t+" p");for(i=0;i<s.length;i++){var o=s[i].cloneNode(!0);o.style.position="",o.id="temp_"+s[i].id,o.style.left="",o.style.top="",o.style.marginTop="10px",o.style.cursor="pointer",o.style.position="relative",o.style.width="";var l=o.innerHTML,d=s[i].id.split("_")[1],c=$(s[i]),m=c.attr("mod");"Unavailable"==m?o.setAttribute("onclick",c.attr("onclick")):o.setAttribute("onclick","Events.eventQuickView('"+m+"','"+d+"', this, event, undefined, undefined, true, false)")," "!==l&&"&nbsp;"!==l||(o.innerText=o.getAttribute("dT")),n.appendChild(o)}freezeBackground(),PopSetCenter("showAllEventsDIV"),renderingUtils.stopEvent(a)},closeMoreEventsPop:function(e){getElemById("showAllEventsDIV")&&(getElemById("showAllEventsDIV").style.display="none"),e||removeFreezeLayer2()},showConfirmAlertForMandateonDrop:function(e){var t=$(e.item),a=t.find(".tdW130").text();a=a.substr(0,a.length-1);var i=$("#mandateConfirmBox");i.find(".infoCont").text(I18n.getMsg("crm.event.cancel.required.field",[I18n.getMsg([a]),Events.getModuleName(!0,!0,!0)]));var n=i.find(".confirm"),r=i.find(".cancel");n.val(I18n.getMsg("crm.event.btn.make.non.mandate")),r.val(I18n.getMsg("crm.event.btn.dnt.move.field"));var s=t.prev();n.off("click").click((function(){var e=t.find(".icnSetting");$("#secContent_Event_Additional_Information").append(t),t.attr("section","2"),e.attr("mandate","false"),t.find("sup").html(""),s.length<1&&(s=$(".dummyLiInLayout")),t.insertAfter(s),i.hide(),renderingUtils.removeDummyBackground()})),r.off("click").click((function(){i.hide(),renderingUtils.removeDummyBackground()})),$(e.sender).sortable("cancel");var o=i.attr("id");renderingUtils.dummyBackground(!1,o),mailsetCenter(o),i.show()},showConfirmAlertForMandate:function(e,t){var a=$(renderingUtils.getTargetElem(e));a.closest(".eventActionsMenu").hide();var i=$("#mandateConfirmBox");i.find(".infoCont").html(I18n.getMsg("crm.event.more.mandate.confirm.msg",[$ESAPI.encoder().encodeForHTML(I18n.getMsg([t])),Events.getModuleName(!0,!0,!0),Events.getModuleName(!0,!1,!0)]));var n=i.find(".confirm"),r=i.find(".cancel");n.val(I18n.getMsg("crm.event.btn.move.field")),r.val(I18n.getMsg("crm.event.btn.dnt.mandate")),n.off("click").click((function(){var e=a.closest(".layoutCreate-Drag"),t=a.closest(".icnSetting");$("#secContent_Event_Information").append(e),e.attr("section","1"),t.attr("mandate","true"),e.find("sup").html("*"),i.hide(),renderingUtils.removeDummyBackground()})),r.off("click").click((function(){i.hide(),renderingUtils.removeDummyBackground()}));var s=i.attr("id");renderingUtils.dummyBackground(!1,s),mailsetCenter(s),i.show()},showSendMailAlert:function(e,t,a,i){var n;if(t?(Events.invAddJson.e=Events.addInvEmailsList,Events.invRemoveJson.e=Events.removeInvEmailsList,n=$("#eventViewPopup").is(":visible")?Events.currentEventObjectInQV:Events.currentEventObjectInView):n=Events.modifyingEvent,Events.sendNotificationMail=!1,"edit"!==Events.currentStatus&&!t||"1"!==n.invMailType||"0"!==n.status){Events.loadInvitationConfirmDiv();var r=$("#invitationConfirmDiv"),s=r.find(".msgBody"),o=r.find(".msgTitle"),l=r.find(".send").prop("disabled",!1),d=r.find(".dntSend").prop("disabled",!1),c=r.find(".cancel").prop("disabled",!1),m=parseInt(e.status),u=!1,v=Events.selInviteesCnt,p=Events.getCountFromInvJson(Events.invAddJson),h=Events.getCountFromInvJson(Events.invRemoveJson);if((p>0||h>0)&&(u=!0),new Date(e.start).getTime()>(new Date).getTime()&&(u||v>0)&&-1!==m){var g="";if(t?"0"===m.toString()&&u?g="createConfirmedEv":p>0&&0===h?g="onlyAddInv":h>0&&0===p?g="onlyRemoveInv":h>0&&p>0&&(g="addAndRemove"):("create"===Events.currentStatus||"clone"===Events.currentStatus)&&v>0||"edit"===Events.currentStatus&&"0"===n.status&&p>0?g="createConfirmedEv":p>0&&0===h?g="onlyAddInv":h>0&&0===p?g="onlyRemoveInv":h>0&&p>0&&(g="addAndRemove"),"createConfirmedEv"===g){if($("#meetingInclude").prop("checked")){Events.status="1";return Crm.requestParam["property(EventStatus)"]="1",Events.saveEntity(void 0,!0,!0),!1}l.val(I18n.getMsg("crm.button.send")),d.val(I18n.getMsg("crm.button.dont.send")).show(),c.show(),o.html(I18n.getMsg("crm.event.inv.create.alert.msg1")).show(),s.html(I18n.getMsg("crm.event.inv.create.alert.msg2")),l.off("click").click((function(e){if(r.hide(),Events.sendNotificationMail=!0,renderingUtils.removeDummyBackground(),t)Events.saveParticipantFromView(a,!0,!1,!0,i),renderingUtils.stopEvent(e);else{Events.status="1";Crm.requestParam["property(EventStatus)"]="1",Events.saveEntity(e,!0,!0)}})),d.off("click").click((function(e){if(r.hide(),Events.sendNotificationMail=!1,renderingUtils.removeDummyBackground(),t)Events.saveParticipantFromView(a,!0,!1,!1,i),renderingUtils.stopEvent(e);else{Events.status="0";Crm.requestParam["property(EventStatus)"]="0",store.findAll("field",{module:"Events"},!0).then((function(t){t.forEach((function(e){"REMINDINVITEESAT"==e.column_name&&(Events.loadDontSendReminderDiv(),$("#dontSendReminderDivOk").off("click").click((function(e){$("#dontSendReminderDiv").remove()})))})),Events.saveEntity(e,!0,!0)}))}})),c.off("click").click((function(e){r.hide(),renderingUtils.removeDummyBackground()}))}else if("onlyAddInv"===g)l.val(I18n.getMsg("crm.button.send")),c.hide(),o.hide(),d.val(I18n.getMsg("crm.event.button.dnt.add.part")).show(),s.text(I18n.getMsg("crm.event.inv.only.add.alert.msg",[p])),l.off("click").click((function(e){r.hide(),Events.sendNotificationMail=!0,renderingUtils.removeDummyBackground(),t?(Events.saveParticipantFromView(a,!0,!1,!1,i),renderingUtils.stopEvent(e)):Events.saveEntity(e,!0,!0)})),d.off("click").click((function(e){r.hide(),Events.sendNotificationMail=!1,renderingUtils.removeDummyBackground(),Events.resetParticipantJson(),t?(Events.saveParticipantFromView(a,!0,!1,!1,i),renderingUtils.stopEvent(e)):(Crm.requestParam.invAddJson=JSON.stringify(Events.invAddJson),Events.saveEntity(e,!0,!0))}));else if("onlyRemoveInv"===g)l.val(I18n.getMsg("crm.event.btn.notify.part")),c.hide(),o.hide(),d.val(I18n.getMsg("crm.event.btn.dnt.notify.part")).show(),s.text(I18n.getMsg("crm.event.inv.only.remove.alert.msg",[h,I18n.getMsg(e.title)])),l.off("click").click((function(e){r.hide(),Events.sendNotificationMail=!0,renderingUtils.removeDummyBackground(),Crm.requestParam.isCancelMailNeeded="1",t?(Crm.requestParam={},Crm.requestParam.isCancelMailNeeded="1",Events.saveParticipantFromView(a,!0,!1,!1,i),renderingUtils.stopEvent(e)):Events.saveEntity(e,!0,!0)})),d.off("click").click((function(e){r.hide(),Events.sendNotificationMail=!1,renderingUtils.removeDummyBackground(),Crm.requestParam.isCancelMailNeeded="0",t?(Crm.requestParam={},Crm.requestParam.isCancelMailNeeded="0",Events.saveParticipantFromView(a,!0,!1,!1,i),renderingUtils.stopEvent(e)):Events.saveEntity(e,!0,!0)}));else if("addAndRemove"===g)l.val(I18n.getMsg("crm.event.btn.notify.part")),c.hide(),o.hide(),d.val(I18n.getMsg("crm.event.button.dnt.add.remove.part")).show(),s.text(I18n.getMsg("crm.event.add.remove.alert.msg",[p,h])),l.off("click").click((function(e){r.hide(),Events.sendNotificationMail=!0,renderingUtils.removeDummyBackground(),t?(Events.saveParticipantFromView(a,!0,!1,!1,i),renderingUtils.stopEvent(e)):Events.saveEntity(e,!0,!0)})),d.off("click").click((function(e){r.hide(),Events.sendNotificationMail=!1,renderingUtils.removeDummyBackground(),Events.invAddJson={t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},Events.invRemoveJson={t:{},e:{},u:{},l:{},c:{},lv:{},cv:{},g:{},r:{},rs:{}},t?(Events.saveParticipantFromView(a,!0,!1,!1,i),renderingUtils.stopEvent(e)):Events.saveEntity(e,!0,!0)}));else{if("cancelEv"!==g)return t&&Events.saveParticipantFromView(a,!0,!1,!1,i),!0;o.html(I18n.getMsg("crm.event.inv.cancel.alert.msg1",[Events.getModuleName(!0,!0,!0)])).show(),s.html(I18n.getMsg("crm.event.inv.cancel.alert.msg2")),l.off("click").click((function(e){r.hide(),Events.sendNotificationMail=!0,renderingUtils.removeDummyBackground(),Crm.requestParam.isCancelMailNeeded="1",Events.saveEntity(e,!0,!0)})),d.off("click").click((function(e){r.hide(),Events.sendNotificationMail=!1,renderingUtils.removeDummyBackground(),Crm.requestParam.isCancelMailNeeded="0",Events.saveEntity(e,!0,!0)})),c.off("click").click((function(){r.hide(),renderingUtils.removeDummyBackground()}))}l.focus();var C=r.attr("id");return renderingUtils.dummyBackground(!1,C),mailsetCenter(C),r.show(),!1}return t&&Events.saveParticipantFromView(a,!0,!1,!1,i),!0}return t&&Events.saveParticipantFromView(a,!0,!1,!1,i),!0},getCountFromInvJson:function(e){var t=0;for(type in e)t+=objectUtils.getKeys(e[type]).length;return t},doneViewInviteesFromQV:function(){var e=parseInt($("#quickViewRelDivCont").prev().css("top"),10),t=parseInt($("#quickViewRelDivCont").parent().css("top"),10);$("#quickViewRelDivCont").animate({height:"305px"},500),$("#quickViewRelDivCont").parent().animate({top:t+125},500),$("#quickViewRelDivCont").prev().animate({top:e-125},500);var a=Events.currentEventObjectInQV.invCntJson,i=$("#textarea_Participants");if(i.find(".invitedSt").length>0){i.find(".going").text("("+a.going+")"),i.find(".maybe").text("("+a.maybe+")"),i.find(".invitedSt").text("("+a.invited+")");var n=parseInt(a.total),r=$("#value_Participants").find(".invited");msg=I18n.getMsg("None"),n>0?(msg=I18n.getMsg("crm.create.inv.cnt.label",[n]),r[0].setAttribute("onclick","Events.viewInviteesPop(-2, undefined, 'quickView')")):r[0].setAttribute("onclick",""),r.text(msg)}else{var s=document.createElement("span"),o=document.createElement("span"),l=document.createElement("span"),d=document.createElement("span"),c=document.createElement("span"),m=document.createElement("span");s.setAttribute("onclick","Events.viewInviteesPop(1, undefined, 'quickView')"),o.setAttribute("onclick","Events.viewInviteesPop(2, undefined, 'quickView')"),l.setAttribute("onclick","Events.viewInviteesPop(-1, undefined, 'quickView')"),$(s).addClass("partLab cP").html(I18n.getMsg("crm.invitation.status.going.label")),$(o).addClass("partLab cP").html(I18n.getMsg("crm.quickview.mystatus.maybe")),$(l).addClass("partLab cP").html(I18n.getMsg("Invited")),$(d).addClass("partVal going").text("("+a.accept+")"),$(c).addClass("partVal maybe").text("("+a.maybe+")"),$(m).addClass("partVal invitedSt").text("("+a.invited+")"),i.css({display:"block"}),i.append(l),i.append(m),i.append(s),i.append(d),i.append(o),i.append(c)}$("#qvInvitedListDivCont").show().animate({left:"440px"},500),$("#quickViewMainDiv").animate({left:"0"},500),$("#eventViewPopup").find(".eventFooter").show(),Events.loadedInvIds=[],Events.invPreparedPageCnt=0,Events.lastLoadedType="3",Events.viewInviteeRecordAvailable=!1,Events.viewInviteeReqSent=!1,Events.viewInviteeRecordAvailable=!1,Events.inviteesViewPageNo=0},showNaviForMultiUserCal:function(e,t){if(calView.showNaviForMultiUserCal){var a,i="dayview"===calView.currCalView?-2808:-370,n=$("#arrwCont"),r=$(window).height()/2,s=$("#calWidget").width()-66,o=$("#fancyParentDIV").height()/2-70;e.pageX-t.offsetLeft-230<$(t).width()/2?"0px"===$(".fht-fixed-body .fht-table").not("#allUserTbl").css("marginLeft")?(a="Next",n.removeClass("prevT").addClass("nextT")):(a="Prev",n.removeClass("nextT").addClass("prevT")):"weekview"===calView.currCalView&&parseInt($(".fht-fixed-body .fht-table").not("#allUserTbl").css("marginLeft"))<=i||"dayview"===calView.currCalView&&Events.multiUserDayScrollTime>=18?(a="Prev",n.removeClass("nextT").addClass("prevT")):(a="Next",n.removeClass("prevT").addClass("nextT")),r=r>o?o:r,n.show(),n.show().css({left:"Prev"===a?"246px":s,top:r})}},showNaviForMultiUserCalForArrow:function(){$("#arrwCont").show()},globalCreateFromMultiUserView:function(e,t,a,i,n,r,s){Crm.userDetails.isPhoneNoNewView&&Crm.loadPhoneFieldComponentJSFiles();var o=new Date,l=null;"dayview"===calView.currCalView?(l=new Date(calView.currCalDateObj)).setHours(s):"weekview"===calView.currCalView?((l=new Date(Events.weekStartDate)).setTime(l.getTime()+864e5*s),l=Events.getRoundedDateTime(l)):((l=new Date(Events.monthStartDate)).setTime(l.getTime()+864e5*s),l=Events.getRoundedDateTime(l));var d=!n||Crm.userDetails.USER_ID==n,c=Events.getPositionObjFromEvent(e),m=$("#wid_calCreate_opts_menu"),u=m.height();renderingUtils.positionArrow(void 0,m.attr("id"),e,"abcd",c);var v=$("body").height(),p=Crm.calPreferences.ACTIVITYTYPE;if(Crm.moduleInfo.Appointments&&(Crm.moduleInfo.Appointments.showSubMenu||(6==p||3==p?p=0:4==p?p=1:5==p&&(p=2))),Crm.calPreferences.ACTIVITYTYPE=p,0===Crm.calPreferences.ACTIVITYTYPE&&l.getTime()>o.getTime()){var h=$(m[0]);h.find(".call").removeClass(" hide "),h.find(".event").removeClass(" hide "),h.find(".appointment").addClass(" hide "),d?h.find(".markbusy").removeClass(" hide "):h.find(".markbusy").addClass(" hide "),m.find(".event").off("click").click((function(s){Events.globalCreate(e,t,a,l,i,n,r)})),m.find(".call").off("click").click((function(i){var s=Events.getPositionObjFromEvent(e);Events.clickPosObj=s,Events.callHostId=n||Crm.userDetails.USER_ID,isNewCallView?Crm.globalCreate(e,t,a,l,n,r):(Q.isFromCalTop=!1,Q.selectAction("NewCall","","Calls","0","calendar",!1,void 0,void 0,e)),"monthview"===calView.currCalView&&l.setHours(parseInt(Crm.calPreferences.DAYSTARTSAT.split(":")[0],10)),Events.callStartTime=l})),m.find(".markbusy").off("click").click((function(e){Lyte.injectResources(Lyte.registeredMixins["business-hours-utils"].downloadHolidayFile(),void 0,(function(){Lyte.registeredMixins["business-hours-utils"].createUnavailability(e,l,!0,calView.currCalView)}))}))}else if(3===Crm.calPreferences.ACTIVITYTYPE){var g=$(m[0]),C=(c=Events.getPositionObjFromEvent(e),m.height());if(g.find(".call").addClass(" hide "),l.getTime()<o.getTime()){var f=$("#eventViewPopup"),E=g.find(".markbusy");d?E.removeClass(" hide "):E.addClass(" hide "),f.is(":visible")&&f.hide();var I=$("#wid_calCreate_opts_menu a:visible").length;v-(y=m.offset()).top>C+120?calView.setOptionsMenuPosistion(m,y,"top",I):calView.setOptionsMenuPosistion(m,y,"bottom",I)}else{g.find(".event").addClass(" hide "),g.find(".appointment").removeClass("hide");I=$("#wid_calCreate_opts_menu a:visible").length;v-(y=m.offset()).top>C+120?calView.setOptionsMenuPosistion(m,y,"top",I):calView.setOptionsMenuPosistion(m,y,"bottom",I)}renderingUtils.stopEvent(e),m.find(".appointment").off("click").click((function(){var t=renderingUtils.targetElement(e);"true"!==getElemById("profPermForActy").value||$(t).hasClass("fc-day-number")||(this.dataset.appointment=!0,Events.globalCreate(e,"calendar",$(this),l,i))})),m.find(".markbusy").off("click").click((function(){Lyte.injectResources(Lyte.registeredMixins["business-hours-utils"].downloadHolidayFile(),void 0,(function(){"monthview"!=calView.currCalView||Utils.isToday(l)||"24:00"==Crm.calPreferences.DAYSTARTSAT?"monthview"==calView.currCalView&&l.setHours((new Date).getHours()):l.setHours(parseInt(Crm.calPreferences.DAYSTARTSAT.split(":")[0])),Lyte.registeredMixins["business-hours-utils"].createUnavailability(e,l,!0,calView.currCalView)}))}))}else if(4===Crm.calPreferences.ACTIVITYTYPE||5===Crm.calPreferences.ACTIVITYTYPE){g=$(m[0]),c=Events.getPositionObjFromEvent(e);if(l.getTime()<o.getTime()){C=m.height(),f=$("#eventViewPopup");g.find(".call").addClass(" hide ");E=g.find(".markbusy");d?E.removeClass(" hide "):E.addClass(" hide "),f.is(":visible")&&f.hide();I=$("#wid_calCreate_opts_menu a:visible").length}else{C=m.height();g.find(".call").removeClass("hide"),g.find(".appointment").removeClass("hide");I=$("#wid_calCreate_opts_menu a:visible").length}renderingUtils.stopEvent(e),4===Crm.calPreferences.ACTIVITYTYPE&&(g.find(".call").addClass(" hide "),m.find(".event").off("click").click((function(){var t=renderingUtils.targetElement(e);"true"!==getElemById("profPermForActy").value||$(t).hasClass("fc-day-number")||Events.globalCreate(e,"calendar",$(this),l,i)}))),m.find(".appointment").off("click").click((function(){var t=renderingUtils.targetElement(e);"true"!==getElemById("profPermForActy").value||$(t).hasClass("fc-day-number")||(this.dataset.appointment=!0,Events.globalCreate(e,"calendar",$(this),l,i))})),5===Crm.calPreferences.ACTIVITYTYPE&&(g.find(".event").addClass(" hide "),m.find(".call").off("click").click((function(){var t=Events.getPositionObjFromEvent(e);if(Events.clickPosObj=t,isNewCallView){var a=renderingUtils.targetElement(e);"true"!==getElemById("profPermForActy").value||$(a).hasClass("fc-day-number")||Crm.globalCreate(jsEvent,"calendar",$(this),l)}else Q.isFromCalTop=!1,Q.selectAction("NewCall","","Calls","0","calendar",!1,void 0,void 0,e);"monthview"===calView.currCalView&&l.setHours(parseInt(Crm.calPreferences.DAYSTARTSAT.split(":")[0],10)),Events.callStartTime=l}))),m.find(".markbusy").off("click").click((function(){Lyte.injectResources(Lyte.registeredMixins["business-hours-utils"].downloadHolidayFile(),void 0,(function(){"monthview"!=calView.currCalView||Utils.isToday(l)||"24:00"==Crm.calPreferences.DAYSTARTSAT?"monthview"==calView.currCalView&&l.setHours((new Date).getHours()):l.setHours(parseInt(Crm.calPreferences.DAYSTARTSAT.split(":")[0])),Lyte.registeredMixins["business-hours-utils"].createUnavailability(e,l,!0,calView.currCalView)}))}))}else if(6===Crm.calPreferences.ACTIVITYTYPE){g=$(m[0]),c=Events.getPositionObjFromEvent(e),E=g.find(".markbusy");if(d?E.removeClass(" hide "):E.addClass(" hide "),l.getTime()<o.getTime()){C=m.height(),f=$("#eventViewPopup");g.find(".call").addClass(" hide "),f.is(":visible")&&f.hide();I=$("#wid_calCreate_opts_menu a:visible").length}else{C=m.height();g.find(".call").removeClass("hide"),g.find(".appointment").removeClass(" hide ");I=$("#wid_calCreate_opts_menu a:visible").length;renderingUtils.stopEvent(e)}m.find(".event").off("click").click((function(){var t=renderingUtils.targetElement(e);"true"!==getElemById("profPermForActy").value||$(t).hasClass("fc-day-number")||Events.globalCreate(e,"calendar",$(this),l,i)})),m.find(".appointment").off("click").click((function(){var t=renderingUtils.targetElement(e);"true"!==getElemById("profPermForActy").value||$(t).hasClass("fc-day-number")||(this.dataset.appointment=!0,Events.globalCreate(e,"calendar",$(this),l,i))})),m.find(".call").off("click").click((function(){var t=Events.getPositionObjFromEvent(e);if(Events.clickPosObj=t,isNewCallView){var a=renderingUtils.targetElement(e);"true"!==getElemById("profPermForActy").value||$(a).hasClass("fc-day-number")||Crm.globalCreate(e,"calendar",$(this),l)}else Q.isFromCalTop=!1,Q.selectAction("NewCall","","Calls","0","calendar",!1,void 0,void 0,e);"monthview"===calView.currCalView&&l.setHours(parseInt(Crm.calPreferences.DAYSTARTSAT.split(":")[0],10)),Events.callStartTime=l})),m.find(".markbusy").off("click").click((function(){Lyte.injectResources(Lyte.registeredMixins["business-hours-utils"].downloadHolidayFile(),void 0,(function(){"monthview"!=calView.currCalView||Utils.isToday(l)||"24:00"==Crm.calPreferences.DAYSTARTSAT?"monthview"==calView.currCalView&&l.setHours((new Date).getHours()):l.setHours(parseInt(Crm.calPreferences.DAYSTARTSAT.split(":")[0])),Lyte.registeredMixins["business-hours-utils"].createUnavailability(e,l,!0,calView.currCalView)}))}))}else{if(2===Crm.calPreferences.ACTIVITYTYPE){isNewCallView||(l.getTime()<o.getTime()?$(m[0]).find(".call").addClass(" hide "):$(m[0]).find(".call").removeClass("hide"));g=$(m[0]);m.find(".call").off("click").click((function(i){var s=Events.getPositionObjFromEvent(e);Events.clickPosObj=s,Events.callHostId=n||Crm.userDetails.USER_ID,isNewCallView?Crm.globalCreate(e,t,a,l,n,r):(Q.isFromCalTop=!1,Q.selectAction("NewCall","","Calls","0","calendar",!1,void 0,void 0,e)),"monthview"===calView.currCalView&&l.setHours(parseInt(Crm.calPreferences.DAYSTARTSAT.split(":")[0],10)),Events.callStartTime=l})),g.find(".event").addClass(" hide "),g.find(".appointment").addClass(" hide "),m.find(".markbusy").off("click").click((function(e){Lyte.injectResources(Lyte.registeredMixins["business-hours-utils"].downloadHolidayFile(),void 0,(function(){Lyte.registeredMixins["business-hours-utils"].createUnavailability(e,l,!0,calView.currCalView)}))}))}else{(g=$(m[0])).find(".call").addClass(" hide "),g.find(".event").removeClass(" hide "),g.find(".appointment").addClass(" hide "),m.find(".markbusy").off("click").click((function(e){Lyte.injectResources(Lyte.registeredMixins["business-hours-utils"].downloadHolidayFile(),void 0,(function(){Lyte.registeredMixins["business-hours-utils"].createUnavailability(e,l,!0,calView.currCalView)}))})),m.find(".event").off("click").click((function(s){Events.globalCreate(e,t,a,l,i,n,r)}))}E=g.find(".markbusy");d?E.removeClass(" hide "):E.addClass(" hide ")}var y,R=(y=m.offset()).top,b=y.left;m.css({top:R+u-20,left:b-50}),renderingUtils.stopEvent(e)},getWidgetHeight:function(){return $(window).height()-$("#calendarBd, #calWidget").offset().top-60},constructInviteeResponse:function(e){var t=document.createElement("table");$(t).attr({cellpadding:"3",cellspacing:"0",border:"0",width:"100%",class:"invitees"});var a=document.createElement("tbody");for(t.appendChild(a),i=0;i<e.length;i++){var n=e[i];if(-1===Events.loadedInvIds.indexOf(n.id)){var r=document.createElement("tr");$(r).attr("srch",n.name+n.email),$(r).addClass("trIninviteesPop"),a.appendChild(r);var s=document.createElement("td");$(s).addClass("l-ht").attr("valign","top"),r.appendChild(s);var o=document.createElement("a");s.appendChild(o),n.href&&$(o).attr({href:n.href,target:"_blank"}),$(o).html(n.dispName),s.appendChild(document.createElement("br"));var l=document.createElement("span");$(l).addClass("color4").html(n.dispEmail),s.appendChild(l),Events.loadedInvIds.push(n.id)}}$("#viewInviteesListDiv").append($(t))},searchInvitee:function(e,t){showMacroSuggest(e,t,"viewInviteesListDiv","tr",void 0,void 0,"viewInviteesListDiv",300,void 0,"srch","false")},closeReminderPop:function(e,t){var a="eventReminderPop_"+e;$("#"+a).remove(),$(".eventReminderPop").length<1&&Events.removeremindFrzLayer(),t||localStorage.setItem("closeReminder",a)},refreshAlldayReminderOptions:function(){Events.timeStrForAllDayReminder=Utils.getTimeStrForAllDayReminder(),Events.eventRemindAtOptions_allday=[{value:"none",html:I18n.getMsg("None")},{value:"0",html:I18n.getMsg("crm.event.allday.remind.ondate",[I18n.getMsg([Events.timeStrForAllDayReminder]),Events.getModuleName(!0,!1,!0)])},{value:"1 days",html:I18n.getMsg("crm.event.remind.allday.day",["1",I18n.getMsg(Events.timeStrForAllDayReminder)])},{value:"2 days",html:I18n.getMsg("crm.event.remind.allday.days",["2",I18n.getMsg(Events.timeStrForAllDayReminder)])},{value:"1 weeks",html:I18n.getMsg("crm.event.remind.allday.week",["1",I18n.getMsg(Events.timeStrForAllDayReminder)])}]},showWhoIdToolTipInDetails:function(e){$("#whoToolTip").length>0&&zctt.showtt(getElemById("whoToolTip").innerHTML,void 0,!0,e)},showWhatIdToolTipInDetails:function(e){$("#whatToolTip").length>0&&zctt.showtt(getElemById("whatToolTip").innerHTML,void 0,!0,e)},bindSlimScroll:function(e,t,a){e=trimBoth(e);var i=$(e);if(!Events.isSlimScrollEnabled||t){if(i.css({"overflow-x":"hidden","overflow-y":"auto"}),a&&a.start)i.scrollTo(a.start);else if(a&&a.scrolVal){var n=parseInt(a.scrolVal.replace("px",""));i.scrollTop(n)}}else i.slimScroll(a),a&&a.scrolVal&&i.slimScroll({scrollTo:a.scrolVal+"px"})},sendMailToInvitees:function(e,t,a,i,n){$("#moreOptionsDiv").css({visibility:"hidden"}),t||(t=$("#eventViewPopup").is(":visible")?Events.currentEventObjectInQV.title:Events.currentEventObjectInView.title),null!=a?simpleEmail.SendMailPopup(e,t,$(a).attr("invId"),"Events",i,n):simpleEmail.SendMailPopup(e,t,void 0,"Events")},removeremindFrzLayer:function(){renderingUtils.removeDummyBackground(),$("#remindFrzLayer").remove()},checkEventAvailToSendCancel:function(e,t,a){if(e){var n=e.split(";"),r=!1;for(i=0;i<n.length;i++){var s=n[i],o=$("#listView_"+s).attr("data-params");if(o)if(JSON.parse(o).module===t){r=!0;break}}if(r){var l=$("#deletepopup");return l.find("#deleteButton").hide(),$("#warningMsg").html(I18n.getMsg("crm.listview.delete.alert.participant",[Events.getModuleName(!1,!1,!0)])),l.find("#showWarning2").css("display","none"),l.find("#delItemName").text(""),l.find(".evButtons").eq(0).val(I18n.getMsg("crm.button.send")).show().off("click").click((function(){a(!0)})).removeAttr("data-cid").removeAttr("data-params"),l.find(".evButtons").eq(1).val(I18n.getMsg("crm.button.dont.send")).show().off("click").click((function(){a(!1)})).removeAttr("data-cid").removeAttr("data-params"),showAnimatePopup("deletepopup"),!0}}return!1},handleMouseOverInView:function(e){$(e).find(".editLinkClass").show()},businessCardViewHTML:function(e){var t="",a=e.useridVsProfileidMap,i=e.moduleVsProfiles,n=i[e.entitymodule][a[Crm.userDetails.USER_ID]],r=Object.keys(n);t+='<div class="wwbw pT5" style="display:none" id="callBusinessCardDivInCal">',t+='<div class="fL">';for(var s=0;s<e.orderedbusinessCard.length;s++){var o=e.orderedbusinessCard[s],l=o.labelName,d=o.p_moduleName,c=o.uiType;if(void 0!==a&&void 0!==i&&-1!==r.indexOf(l)){if(t+='<p class="pT5">',t+='<span class="lightgray">',t+=$ESAPI.encoder().encodeForHTML(I18n.getMsg(l,Crm.moduleInfo[d].translatedSingularLabel)),t+="</span>",t+=" : ",t+='<span class="dvValueTxt">',validationUtils.isNotEmpty(e.businessCard[l]))if("9"===c&&"Vendors"===d){var m=e.businessCard[l],u=m.entityid,v=m.entityName;validationUtils.isNotEmpty(v)&&(t+="<a href='javascript:void(0);' onclick=\"CTIAPI.openUrl('"+u+"','"+d+"')\">"+$ESAPI.encoder().encodeForHTML(v)+"</a>")}else t+=$ESAPI.encoder().encodeForHTML(e.businessCard[l]+"");t+="</span>",t+="</p>"}}return t+='<textarea class="w100p mT10 p5 h50" id="callNotes" onkeyup="localStorage.setItem(\'callnotes\',this.value);" placeholder="'+I18n.getMsg("crm.tpi.ctiapi.label.notification.callnotes")+'"  style="display:none"></textarea>',t+="</div>",t+='<br class="clearB">',t+="</div>"},callDuplicateCheckHandler:function(e,t){if("ScheduleCall"===$("input:radio[name='whichCall']:checked").val()||$("#callTimeSpanEdit").is(":visible")){var a,i,n,r=Crm.userDetails.USER_ID;if(r=$("#callDateSpanEdit").is(":visible")?$("#qownerName_reschedule").val():$("#qownerName_select").is(":visible")?$("#qownerName_select").val():$("#ownerId").val(),t)a=$("input[name='property(Call Start Time)']").val(),$("#callTimeSpanEdit").is(":visible")&&(a=$("#callDateSpanEdit").val()),i=parseInt(t[0],10),"HH:mm"!==Crm.userDetails.TIME_FORMAT&&(i=Utils.convertTimeTo24HoursFormat(i,t[2])),n=parseInt(t[1],10);else if($("#callTimeSpanEdit").is(":visible")){if(a=$("#callDateSpanEdit").val(),i=parseInt($("#calltimefrmhour").val(),10),"HH:mm"!==Crm.userDetails.TIME_FORMAT){var s=$("#calltimefrmampm").val();i=Utils.convertTimeTo24HoursFormat(i,s)}n=parseInt($("#calltimefrmminute").val(),10)}else if(a=$("input[name='property(Call Start Time)']").val(),"Call Start Time"===e){if(i=parseInt($("input[name='property(Call Start Timehour)']").val(),10),"HH:mm"!==Crm.userDetails.TIME_FORMAT){s=$("input[name='property(Call Start Timeampm)']").val();i=Utils.convertTimeTo24HoursFormat(i,s)}n=parseInt($("input[name='property(Call Start Timeminute)']").val(),10)}var o=Utils.getDateObject(a,{hrs:i,mins:n}),l={start:o,end:o,activityType:"Calls"};l.ownerId=r,l.oldOwnerId=r,l.isAllday=!1,$("#callTimeSpanEdit").is(":visible")?l.entityId=$("#id").val():l.entityId=$("input[name='property(id)']").val(),Number.isNaN(parseInt(r))||Events.checkDuplicateEvent(l)}},callDuplicationDateHandler:function(){Events.callDuplicateCheckHandler("Call Start Time")},showPopupDropdown:function(e,t){var a=$(e).position().top+$(e).outerHeight()+2,i=$(e).position().left,n=$("#calBd"),r=$("#allUsrMonthView"),s=$("#"+t);if("none"===s.css("display")){var o=$(e).outerWidth(),l=s.outerWidth(),d=$(window).scrollTop(),c=$(window).height(),m=s.outerHeight();$(".rep_runreportPop,#dropDownMenu").css("display","none"),s.css({top:a+"px",left:i+"px",visibility:"hidden",display:"block"});var u=s.offset().top+m-d+28;$("#"+t).offset().left;if(c<=u?s.css({top:"-65px",left:i-l+o,visibility:"visible"}):s.css({top:a+"px",left:i-l+o,visibility:"visible"}).show(),n.is(":visible")||r.is(":visible")){a=$(e).position().top-2;s.css({top:a-m+"px",left:i-l+o,visibility:"visible"}).show()}}else s.css("display","none")},exportEvent:function(e){var t=Crm.getCrmBasePath()+"/ExportEntity.do?module=Events&format=ics&source=exportFromDetailView";e&&(t+="&entityId="+e),showAlertMessage("bulkUpdateSuccess",!0,I18n.getMsg("crm.text.exporting")+"...",1e3),document.exportEventForm.action=t,document.exportEventForm.submit()},weekOfDay:function(e,t,a){e=e||new Date;var i=new Date(e.getTime());i.setDate(1);var n=i.getMonth(),r=Utils.getMonthEnd(n,i.getFullYear()),s=(i.getDay(),[]),o=0;do{var l=i.getDate()+6;0==o&&(l-=i.getDay()),l>r&&(l=r);var d=i.getDay()+(l-i.getDate());s[o]={startDate:i.getDate(),endDate:l,stDay:i.getDay(),endDay:d},i.setDate(l+1),o++}while(i.getMonth()==n);s[0].stDay>a&&(t+=1);var c=s[t]?s[t]:s[s.length-1];0==t&&(c=a>=s[0].stDay&&a<=s[0].endDay?s[0]:s[1]);d="endDay";if(4!=t||a>=c.stDay&&a<=c[d]||(c=s[s.length-2]),a>=c.stDay&&a<=c[d]){var m=c.startDate;for(o=c.stDay;o<a;o++)m++;e.setDate(m)}else e.setDate(1),e.setMonth(e.getMonth()+1),e=this.weekOfDay(e,t,a);return e},closeMoreEventDiv:function(e){$("#moreEventsAllDiv").hide(),e||removeFreezeLayer2(),calView.refresh()},reinviteParticipantAlert:function(e,t,a){$("#moreOptionsDiv").css({visibility:"hidden"});var i=$("#reinvitepopup");t=$(t),i.find("#reinviteAlertWarningMsg").html(I18n.getMsg("crm.event.reinvite.participant",[$ESAPI.encoder().encodeForHTML(a)]));var n=i.find("#reinvite_participant").show();n.unbind("click").click((function(t){Events.reinviteParticipant(e),renderingUtils.stopEvent(t),hideAnimatePopup("reinvitepopup")})),n.focus(),showAnimatePopup("reinvitepopup"),t.blur(),event&&renderingUtils.stopEvent(event)},reinviteParticipant:function(e){var t={action:"reinviteForEvent"};t.entityId=$("#id").val(),t.inviteeId=e,t[csrfParamName]=csrfToken,(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/mailer/EntReply.do",data:t,type:"POST",async:!1,success:function(e){-1!=e.indexOf("success")?crmui.showMsgBand("success",I18n.getMsg("crm.events.reinvite.success"),4e3):-1!=e.indexOf("dayLimitReached")?crmui.showMsgBand("error",I18n.getMsg(e),4e3):-1!=e.indexOf("Email has been unsubscribed")?crmui.showMsgBand("error",I18n.getMsg("crm.unsubscription.event.invitie.blocked"),4e3):crmui.showMsgBand("error",I18n.getMsg("crm.unable.to.process.request"),4e3)}})},sendAuthorizationNotificationToHost:function(e,t){(!Events.authNotificationSentUsers.hasOwnProperty(e)||Events.authNotificationSentUsers.hasOwnProperty(e)&&!Events.authNotificationSentUsers[e].contains(t))&&(Events.authNotificationSentUsers.hasOwnProperty(e)||(Events.authNotificationSentUsers[e]=[]),Events.authNotificationSentUsers[e].push(t),store.findAll("dummy",{type:"sendAuthorizationNotificationToHost",toolName:e,currHost:t},!1,!1,{url:Crm.getCrmBasePath()+"/events/EventAction.do"}).then((function(){return!0})))},removeHostAuthKey:function(e){var t={type:"removeHostAuthKey"};t.toolName=e,t[csrfParamName]=csrfToken,(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/events/EventAction.do",data:t,type:"GET",success:function(){return!0}})},hideMouseHoverSettingIcon:function(e){(e=$(e).children("td:last")).find(".relListMenuDiv").css("visibility","hidden").find(".scaleCont").removeClass("scaleOne")},reminderAddorRemove:function(e){var t=(e=$(e)).parent("ul").attr("currentId");if(e.closest("ul").find("li").removeClass("selectedOpt"),"eventPartReminderDiv"===t)return Events.saveValtoopt(t,e),void e.addClass("selectedOpt");if("none"==e.attr("data-value")){if("none"==$("#Crm_"+Events.module+"_REMINDAT"+t.substring(16)).val())return;if(Events.reminderCount>1&&Events.reminderCount<=20)$("#"+t).parent().remove();else if(20==Events.reminderCount){$("#"+t).parent().remove(),Events.maxReminderValue++,(a=$("#eventReminderDiv").clone()).css({display:"inline-block"}),a.attr("id","eventReminderDiv"+Events.maxReminderValue),a.find("input").attr("id","Crm_"+Events.module+"_REMINDAT"+Events.maxReminderValue),$("#eventReminderDiv").parent().append($("<div>").append($("<div>").append(a)).html())}else Events.saveValtoopt(t,e);Events.reminderCount--}else{var a,i;if("none"==$("#"+t).find("input").attr("data-value")&&Events.reminderCount<20)Events.saveValtoopt(t,e),Events.reminderCount++,Events.maxReminderValue++,(a=$("#eventReminderDiv").clone()).css({display:"inline-block"}),a.attr("id","eventReminderDiv"+Events.maxReminderValue),a.find("input").attr("id","Crm_"+Events.module+"_REMINDAT"+Events.maxReminderValue),$("#eventReminderDiv").parent().append($("<div>").append($("<div>").append(a)).html()),i=(Events.reminderCount-2>0?Events.maxReminderValue-2:"")>0?$("#eventReminderDiv"+Events.maxReminderValue).parent("div").prev("div").prev("div").find("div.selectBoxInput").eq(0).attr("id"):"Crm_"+Events.module+"_REMINDAT_label",$("#eventCreationInnerDiv").scrollTo("#"+i);else(20==Events.reminderCount||Events.maxReminderValue>=t.substring(16))&&Events.saveValtoopt(t,e)}},getMultipleRemindersAsJson:function(){var e="{",t=[],a=1;for(i=1;i<=Events.maxReminderValue;i++)$("#Crm_Events_REMINDAT"+i).length&&"none"!=$("#Crm_Events_REMINDAT"+i).attr("data-value")&&-1==$.inArray($("#Crm_Events_REMINDAT"+i).attr("data-value"),t)&&(t.push($("#Crm_Events_REMINDAT"+i).attr("data-value")),e=e+'"'+a+'":"'+$("#Crm_Events_REMINDAT"+i).attr("data-value")+'",',a++);return e=e.substring(0,e.length-1),e+="}"},getReminderforParticipants:function(e,t){var a=[],i={},n="minutes";if("0"!==e){var r=e.split(" ");switch(n=r[1]){case"mins":n="minutes";break;case"hrs":n="hours"}e=r[0]}return i.remind="before",i.period=n,i.unit=e,a.push(i),t?a:JSON.stringify({partRem:a})},saveRemindersState:function(){for(i=1;i<=Events.maxReminderValue;i++){var e=$("#Crm_"+Events.module+"_REMINDAT"+i);0!=e.length&&"none"!=e.attr("data-value")&&Events.reminders.push({value:e.attr("data-value"),html:$("#eventReminderDiv"+i).find(".slctOptVal").text()})}},retrieveReminders:function(){for(i=0;i<Events.reminders.length;i++){Events.reminderCount++,Events.maxReminderValue++;var e=$("#eventReminderDiv").clone();e.css({display:"inline-block"}),e.attr("id","eventReminderDiv"+Events.maxReminderValue),e.find("input").attr("id","Crm_"+Events.module+"_REMINDAT"+Events.maxReminderValue),(e=$($("<div>").append($("<div>").append(e)).html())).insertBefore($("#eventReminderDiv1").parent());var t=Events.getValueForRemInputBox(Events.reminders[i].value),a="eventReminderDiv"+Events.maxReminderValue,n=renderingUtils.saveValtoopt(a,t,Events.reminders[i].value),r=Events.getHtmlForReminders(Events.reminders[i].value,n,$("#Crm_Events_ALLDAYEVENT").prop("checked"));$("#"+a).html(r),$("#"+a).removeClass("SlctListAtv")}20==Events.reminders.length&&$("#eventReminderDiv1").parent().remove(),Events.reminders=[]},removeReminders:function(){for(i=1;i<Events.maxReminderValue;i++)$("#eventReminderDiv"+i).parent().remove();var e=$("#Crm_"+Events.module+"_REMINDAT"+Events.maxReminderValue);e.hide(),e.attr("data-value","none");var t=$("#eventReminderDiv"+Events.maxReminderValue);t.find(".slctOptVal").text(I18n.getMsg("None")),t.attr("id","eventReminderDiv1"),e.attr("id","Crm_"+Events.module+"_REMINDAT1"),$("#eventReminderDiv1").find(".slctOptVal").css({"padding-left":"10px"}),Events.maxReminderValue=1,Events.reminderCount=1},saveAllDayRemindersState:function(){for(i=1;i<=Events.maxReminderValue;i++){var e=$("#Crm_"+Events.module+"_REMINDAT"+i);0!=e.length&&"none"!=e.attr("data-value")&&Events.allDayReminders.push({value:e.attr("data-value"),html:$("#eventReminderDiv"+i).find(".slctOptVal").text()})}},retrieveAllDayReminders:function(){for(0==Events.allDayReminders.length&&"create"==Events.currentStatus&&"none"!=Crm.calPreferences.ALLDAYEVENTREMINDER&&Events.allDayReminders.push({value:Crm.calPreferences.ALLDAYEVENTREMINDER}),i=0;i<Events.allDayReminders.length;i++){Events.reminderCount++,Events.maxReminderValue++;var e=$("#eventReminderDiv").clone();e.css({display:"inline-block"}),e.attr("id","eventReminderDiv"+Events.maxReminderValue),e.find("input").attr("id","Crm_"+Events.module+"_REMINDAT"+Events.maxReminderValue),(e=$($("<div>").append($("<div>").append(e)).html())).insertBefore($("#eventReminderDiv1").parent());var t=Events.getValueForRemInputBox(Events.allDayReminders[i].value),a="eventReminderDiv"+Events.maxReminderValue,n=renderingUtils.saveValtoopt(a,t,Events.allDayReminders[i].value),r=Events.getHtmlForReminders(Events.allDayReminders[i].value,n,$("#Crm_Events_ALLDAYEVENT").prop("checked"));$("#"+a).html(r),$("#"+a).removeClass("SlctListAtv")}20==Events.allDayReminders.length&&$("#eventReminderDiv1").parent().remove(),Events.allDayReminders=[]},getHtmlForReminders:function(e,t,a){var i=Events.getHtmlForEventReminder(e,t,a);return i+="</span></div><div class='cB'></div>"},getHtmlForEventReminder:function(e,t,a,i){var n=e.split(" "),r="",s=!1,o=null;if("Appointments"==this.moduleName||"Appointments"==crmCommonModule.moduleName?(o=moduleRecordMapping.Appointments.singular_label.toLowerCase(),o=I18n.getMsg(o)):o=Crm.getModuleDisplayName(!0,!1,!0),"HH:mm"===Crm.userDetails.TIME_FORMAT&&(s=!0),n.length>1){var l=parseInt(n[0]),d=0,c=0,m=0;if(("hrs"==n[1]||"mins"==n[1])&&a){var u=parseInt(Crm.calPreferences.DAYSTARTSAT.split(":")[0])-1;if(t=isNaN(t)?t:"","hrs"==n[1]&&l>24){if(l/168>=1)return l-=168*(c=Math.floor(l/168)),a&&0!=l&&(l=u-l),l=l<0?l+=24:l,s?l=l<10?"0"+l:l+":00":(isAmPm=l>=12?" PM":" AM",l=(l=(l=(l=0==l?12:l)>12?l-12:l)<10?"0"+l:l)+":00"+isAmPm),c>1?t+I18n.getMsg("crm.event.remind.allday.weeks1",[c,l]):"true"==i?t+I18n.getMsg("crm.event.remind.allday.week1",[c,l]):t+I18n.getMsg("crm.event.remind.allday.week",[c,l]);if(l/24>=1)return l-=24*(m=Math.floor(l/24)),a&&0!=l&&(l=u-l),l=l<0?l+=24:l,s?l=l<10?"0"+l:l+":00":(isAmPm=l>=12?" PM":" AM",l=(l=(l=(l=0==l?12:l)>12?l-12:l)<10?"0"+l:l)+":00"+isAmPm),m>1?"true"==i?t+I18n.getMsg("crm.event.remind.allday.days1",[m,l]):t+I18n.getMsg("crm.event.remind.allday.days",[m,l]):"true"==i?t+I18n.getMsg("crm.event.remind.allday.day1",[m,l]):t+I18n.getMsg("crm.event.remind.allday.day",[m,l])}else if("mins"==n[1]&&l>60){if(l/10080>=1)return(l-=10080*(c=Math.floor(l/10080)))/60>=1&&(l-=60*(d=Math.floor(l/60)),a&&0!=d&&(d-=u),d=d<0?d+=24:d),s?l=d<10?"0"+d:d+":"+(l<10)?"0"+l:l:(isAmPm=d>=12?" PM":" AM",l=(d=(d=(d=0==d?12:d)>12?d-12:d)<10?"0"+d:d)+":"+(l=l<10?"0"+l:l)+isAmPm),c>1?"true"==i?t+I18n.getMsg("crm.event.remind.allday.weeks1",[c,l]):t+I18n.getMsg("crm.event.remind.allday.weeks",[c,l]):"true"==i?t+I18n.getMsg("crm.event.remind.allday.week1",[c,l]):t+I18n.getMsg("crm.event.remind.allday.week",[c,l]);if(l/1440>=1)return(l-=1440*(m=Math.floor(l/1440)))/60>=1&&(l-=60*(d=Math.floor(l/60)),a&&0!=d&&(d-=u),d=d<0?d+=24:d),s?l=d<10?"0"+d:d+":"+(l<10)?"0"+l:l:(isAmPm=d>=12?" PM":" AM",l=(d=(d=0==d?12:d)<10?"0"+d:d)+":"+(l=l<10?"0"+l:l)+isAmPm),c>1?"true"==i?t+I18n.getMsg("crm.event.remind.allday.days1",[m,l]):t+I18n.getMsg("crm.event.remind.allday.days",[m,l]):"true"==i?t+I18n.getMsg("crm.event.remind.allday.day1",[m,l]):t+I18n.getMsg("crm.event.remind.allday.day",[m,l])}}switch(n[1]){case"mins":r="true"==i?I18n.getMsg("crm.event.remind.mins1",[n[0]]):I18n.getMsg("crm.event.remind.mins",[t]);break;case"hrs":r="true"==i?I18n.getMsg(n[0]>1?"crm.event.remind.hrs1":"crm.event.remind.hr1",[n[0]]):I18n.getMsg(n[0]>1?"crm.event.remind.hrs":"crm.event.remind.hr",[t]);break;case"days":r=a?"true"==i?I18n.getMsg(n[0]>1?"crm.event.remind.days1":"crm.event.remind.day1",[n[0],I18n.getMsg(Events.timeStrForAllDayReminder)]):I18n.getMsg(n[0]>1?"crm.event.remind.allday.days":"crm.event.remind.allday.day",[t,I18n.getMsg(Events.timeStrForAllDayReminder)]):"true"==i?I18n.getMsg(n[0]>1?"crm.event.remind.days1":"crm.event.remind.day1",[n[0]]):I18n.getMsg(n[0]>1?"crm.event.remind.days":"crm.event.remind.day",[t]);break;case"weeks":r=a?n[0]<1?"true"==i?t+I18n.getMsg("crm.event.allday.remind.ondate1",[Events.getModuleName(!0,!1,!0)]):t+I18n.getMsg("crm.event.allday.remind.ondate",[Events.timeStrForAllDayReminder,Events.getModuleName(!0,!1,!0)]):"true"==i?I18n.getMsg(n[0]>1?"crm.event.remind.weeks1":"crm.event.remind.week1",[n[0]]):I18n.getMsg(n[0]>1?"crm.event.remind.allday.weeks":"crm.event.remind.allday.week",[t,I18n.getMsg(Events.timeStrForAllDayReminder)]):n[0]<1?"true"==i?'<span class="m0 f14 mR5 color_3 fL">'+I18n.getMsg("crm.event.remind.ontime",[o])+"</span>":t+I18n.getMsg("crm.event.remind.ontime",[o]):"true"==i?I18n.getMsg(n[0]>=1?"crm.event.remind.days1":"crm.event.remind.day1",[7*n[0]]):I18n.getMsg(n[0]>=1?"crm.event.remind.days":"crm.event.remind.day",[t])}}else r="none"==n[0]?t+I18n.getMsg("None"):a?"true"==i?t+I18n.getMsg("crm.event.allday.remind.ondate1",[Events.getModuleName(!0,!1,!0)]):t+I18n.getMsg("crm.event.allday.remind.ondate",[I18n.getMsg([this.timeStrForAllDayReminder]),Events.getModuleName(!0,!1,!0)]):"true"==i?'<span class="m0 f14 mR5 color_3 fL">'+I18n.getMsg("crm.event.remind.ontime",[o])+"</span>":t+I18n.getMsg("crm.event.remind.ontime",[o]);return r},convertObjToKeyValuePair:function(e){var t="";for(var a in e)void 0!==e[a]&&("string"==typeof e[a]?t+=a+'= "'+$ESAPI.encoder().encodeForHTMLAttribute(e[a])+'"  ':t+=a+'= "'+e[a]+'" ');return t},constructMultipleRemindersOptions:function(e,t,a){var n=null;"Appointments"==this.moduleName||"Appointments"==crmCommonModule.moduleName?(n=moduleRecordMapping.Appointments.singular_label.toLowerCase(),n=I18n.getMsg(n)):n=Crm.getModuleDisplayName(!0,!1,!0),Events.eventRemindAtOptions=[{value:"none",html:I18n.getMsg("None")},{value:"0",html:I18n.getMsg("crm.event.remind.ontime",[n])},{value:"5 mins",html:I18n.getMsg("crm.event.remind.mins",["5"])},{value:"10 mins",html:I18n.getMsg("crm.event.remind.mins",["10"])},{value:"15 mins",html:I18n.getMsg("crm.event.remind.mins",["15"])},{value:"30 mins",html:I18n.getMsg("crm.event.remind.mins",["30"])},{value:"1 hrs",html:I18n.getMsg("crm.event.remind.hr",["1"])},{value:"2 hrs",html:I18n.getMsg("crm.event.remind.hrs",["2"])},{value:"1 days",html:I18n.getMsg("crm.event.remind.day",["1"])},{value:"2 days",html:I18n.getMsg("crm.event.remind.days",["2"])}],null==e&&(null!=a&&a?a&&(e=Events.eventRemindAtOptions_allday):e=Events.eventRemindAtOptions),null==t&&(t="none");var r=$("#eventMultipleRemindersDiv");for(r.html(""),i=0;i<e.length;i++){var s=$("<li>",{class:e[i].value==t?"selectedOpt":"",onclick:"Events.reminderAddorRemove(this);","data-value":e[i].value});$("<span>",{class:"slctOptTxt",html:e[i].html}).appendTo(s),s.appendTo(r)}},saveValtoopt:function(e,t){e.substring(16);$(t).parent("ul").hide();var a=Events.getValueForRemInputBox(t.attr("data-value")),i=renderingUtils.saveValtoopt(e,a,t.attr("data-value")),n=Events.getHtmlForReminders(t.attr("data-value"),i,$("#Crm_Events_ALLDAYEVENT").prop("checked"));$("#"+e).html(n),$("#"+e).removeClass("SlctListAtv")},selectInput:function(e){if("INPUT"!==event.target.tagName){var t=$(e).outerHeight(),a=$(e).offset().top,i=$(e).offset().left,n=$(window).height(),r=$(e).children("input").attr("data-value"),s=$("#eventMultipleRemindersDiv"),o=s.find("li");0===o.length&&Events.constructMultipleRemindersOptions(),o.removeClass("selectedOpt"),$(e).closest("ul").find("li").removeClass("selectedOpt"),o.each((function(){$(this).attr("data-value")!==r||$(this).addClass("selectedOpt")})),$(e).addClass("SlctListAtv");var l={top:a+t,left:i,display:"block",visibility:"hidden"},d={top:c,left:i,visibility:"visible"};s.css(l);var c=0;c=s.offset().top+s.outerHeight()>=n?a-s.outerHeight():a+t,s.css(d),s.attr("currentId",$(e).attr("id"))}},getValueForRemInputBox:function(e){var t=e.split(" ");return t.length>1&&!isNaN(t[0])?"0"==t[0]?"":t[0]:""},changeVal:function(e){var t=$(e).val(),a=$(e).attr("data-value").split(" ");$(e).attr("data-value",t+$(e).attr("data-value").substring(a[0].length))},getDataValue:function(e){var t=e.split(" ");return"0"==t[0]?"0":"weeks"==t[1]?7*parseInt(t[0])+" days":e},setPadding:function(e){return""==Events.getValueForRemInputBox(e)},setPreviousValue:function(e,t){(e=$(e)).attr("prevVal",e.val())},validateTimeNumeralFieldOfReminders:function(e){""==(e=$(e)).val()&&e.attr("data-value",e.attr("prevVal"))},showReminderList:function(e,t){if("fromQV"==t){var a=$(e).offset().top,i=$(e).offset().left;$("#reminderListQV").css({top:a,left:i}),$("#reminderListQV").show()}else $("#remListDiv").parent("div").show();thirdPartyUtils.bindPerfectScroll("#remListDiv",{wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!1})},hideReminderList:function(e){$("#reminderListQV").hide()},remindersInQuickView:function(e,t){var a=JSON.parse(e);if(0==a.length)return"";var n="<div class='pR'>",r="";if(a.length>1){n=n+"<div class='multpl_remainList dIB pB10'><a href='javascript:;' onclick='renderingUtils.stopEvent()' onmouseover='Events.showReminderList(this,&#39;fromQV&#39;)' onmouseout='Events.hideReminderList(this)' class='pL10'>"+I18n.getMsg("crm.event.number.of.reminders",[a.length])+"</a>";$("<ul>",{class:"remListUL p0 dIB m0"});var s=t["All day"];for(s=$(s),"none"==("yes_All day"==$(s[0]).attr("id")?s[1]:s[0]).style.display,i=0;i<a.length;i++)r=r+"<li class='m0'><span class='f13 fL'>"+a[i].remTime+"</span><div class='cB'></div></li>";$("#remListDiv").find("ul").html(r)}else n=n+"<div class='multpl_remainList dIB pB10 mL10'><span class='f13 w150 fR nwrp'>"+a[0].remTime+"</span></div></div>";return n},addRelatedParticipant:function(e,t,a){var i=e.is(":checked");if(this.relatedParticipantName=i?$("#Crm_Events_CONTACTID").val():"",-1!=a.indexOf("Lead")?Events.selectInv(e,"l",t):-1!=a.indexOf("Contact")&&Events.selectInv(e,"c",t),crmui.hideMsgBand(),$("#saveEventsBtn").removeAttr("disabled"),Events.withMeetingTool||$("#meetingInclude").is(":checked")){var n=Events.meetingToolName;n||""!==n||(n=$("#Crm_Events_MeetingSolutions_select option:selected").attr("name")),Events.checkAuthorizeDone(n)}Events.showHideMeetingIntegDiv(),Events.invitationLimitValidation($("#addpartCheckbox").is(":checked"),$("#invFilterDropDown").val())},showRelatedpartSelected:function(e,t){var a=$("#addpartCheckbox"),i=a.attr("recId"),n=a.attr("module");"Contacts"==n?n="c":"Leads"==n&&(n="l");var r="invSelRow"+n+"_"+i;if("c"==n||"l"==n)if(a.is(":checked")){if($("#"+n+"_"+i).prop("checked",!0),null==document.getElementById(r)){var s=$("#invRow"+n+"_"+i).clone();s.attr("id","invSelRow"+n+"_"+i);var o="sel"+n+"_"+i;if(s.find("input").attr({id:o}),s.find("label").attr({for:o}),s.find("input")[0])s.find("input")[0].setAttribute("onclick","selectInv(this, '"+n+"', true)"),$("#invSelTbody_"+n).prepend(s);else{var l=document.createElement("TR");l.setAttribute("id","invSelRow"+n+"_"+i);var d=this.relatedParticipantName;d||(d=$("#entityName").val());var c='<td valign="top" width="15"><label class="newCustomchkbox-md" for="sel'+n+"_"+i+'"><input data-zcqa="Lookup_event_contactidlistchik" id="sel'+n+"_"+i+'" checked cnt="1" recid="'+i+'" onclick="selectInv(this, \''+n+'\', true)" class="invChkBox" type="checkbox"><span class="chkbxIcon"></span></label></td>';c=c+"<td class='l-ht' valign='top'><label data-zcqa='Lookup_event_contactidlistlabel' for='sel"+n+"_"+i+"'><span><a class='link' data-zcqa='Lookup_event_contactidlistname'>"+d+"</a></span><span class='color2' data-zcqa='Lookup_event_contactidlistcompanyname'></span><br><span class='color4 dIB mT3 lh18' data-zcqa='Lookup_event_contactidlistemail'>&nbsp;</span></label></td>",l.innerHTML=c,$("#invSelTbody_"+n).prepend(l)}}}else null!=document.getElementById(r)&&$("#invSelRow"+n+"_"+i).remove(),$("#"+n+"_"+i).prop("checked",!1);if("c"==(n=$("#invFilterDropDown").val())||"rc"==n){for(var m=0;m<Events.showDuplicateContView.length;m++){var u=Events.showDuplicateContView[m];null!=$("#c_"+u)?($("#c_"+u).removeClass("beforeAdd"),$("#invListDiv_c").find("#c_"+u).prop("checked",!0),$("#invListDiv_rc").find("#c_"+u).prop("checked",!0)):($("#invListDiv_c").find("#c_"+u).prop("checked",!1),$("#invListDiv_rc").find("#c_"+u).prop("checked",!1))}$(".beforeAdd").attr("disabled",!1)}Events.invitationLimitValidation(Events.invReached,n,void 0,e,t)},loadeventCreatePopup:function(){var e=$("#eventCreatePopup");0==e.length&&(e=$(Handlebars.templates.eventCreatePopup()),$("body").append(e),$(".etTrendsWrapper").length&&e.addClass("ziaForEmailsCheck"))},loadInvitationConfirmDiv:function(){var e=$("#invitationConfirmDiv");0==e.length&&(e=$(Handlebars.templates.invitationConfirmDiv()),$("body").append(e))},loadViewInviteesPopDiv:function(){var e=$("#viewInviteesPop");0==e.length?(e=$(Handlebars.templates.viewInviteesPop()),$("body").append(e)):$(e[0]).empty()},loadDontSendReminderDiv:function(){var e=$("#dontSendReminderDiv");0===e.length&&(e=$(Handlebars.templates.dontSendReminderDiv()),$("body").append(e)),e.show(),$(".bodycontainer").append('<div class="freezeLayer_zi32"></div>'),$(".freezeLayer_zi32").show(),mailsetCenter("dontSendReminderDiv")},loadEditRecAlertMsgDiv:function(){var e=$(Handlebars.templates.editRecAlertMsgDiv());$("body").append(e)},selectInv:function(e,t,a){var i=$(e).is(":checked"),n="";n="edit"==Events.currentStatus?Events.invAddJson[t]:Events.invJsonCreate[t];var r=["t","lv","cv","g","r","rs"],s=0;if(i){if(n[a]=a,Events.selCntIdsArr=Events.recCntIdsArr,delete Events.selCntIdsArr.remove[t][a+""],Events.selCntIdsArr.add[t][a+""]=[a],s=Events.getSelectedInviteesCnt(Events.convertIntoResponseFormat(Events.selCntIdsArr.add,t),Events.convertIntoResponseFormat(Events.selCntIdsArr.remove,t)),-1!=r.indexOf(t)){delete Events.recCntIdsArr.remove[t][a]}Events.invRemoveJson[t][a]&&(delete Events.invRemoveJson[t][a],delete Events.invAddJson[t][a])}else{if(delete n[a],Events.selCntIdsArr=Events.recCntIdsArr,Events.selCntIdsArr.remove[t][a+""]=[a],delete Events.selCntIdsArr.add[t][a+""],s=Events.getSelectedInviteesCnt(Events.convertIntoResponseFormat(Events.selCntIdsArr.add,t),Events.convertIntoResponseFormat(Events.selCntIdsArr.remove,t)),-1!=r.indexOf(t)){delete Events.recCntIdsArr.add[t][a]}"edit"==Events.currentStatus&&(i?Events.invRemoveJson[t][a+""]?delete Events.invRemoveJson[t][a+""]:Events.invAddJson[t][a+""]=a:Events.invAddJson[t][a+""]?delete Events.invAddJson[t][a+""]:Events.invRemoveJson[t][a+""]=a)}Events.setSelInvCnt(parseInt(s))},setLocation:function(e){if(renderingUtils.stopEvent(),!$("#meetingInclude").prop("checked")){if("Others"==e){var t=$("#Crm_Events_SEID_label_select").val();e="Accounts"==t||"SalesOrders"==t?t:"Vendors"}Events.setAddrDetails(e,(function(e){e&&$(".evtLocationDD").slideDown(300)}))}},addLocationData:function(e,t){e.stopPropagation();var a=$(t).text();$("#Crm_Events_LOCATION").val(a),$(".evtLocationDD").hide()},setAddrDetails:function(e,t){var a=[];if("Contacts"==e||"Accounts"==e||"SalesOrders"==e){var n=null!=Events.addressInfo.contactBilAddr?Events.addressInfo.contactBilAddr:"",r=null!=Events.addressInfo.contactShipAddr?Events.addressInfo.contactShipAddr:"";""==n&&""==r||(a=[n,r]);var s=null!=Events.addressInfo.accountBilAddr?Events.addressInfo.accountBilAddr:"",o=null!=Events.addressInfo.accountShipAddr?Events.addressInfo.accountShipAddr:"";""==s&&""==o||(a.push(s),a.push(o))}else a[0]=null!=Events.addressInfo[e]?Events.addressInfo[e]:"";var l=$("#locationDataDiv ul");for(l.empty(),i=0;i<a.length;i++)""!=a[i]&&l.append("<li class='color_3 pB5 cP' onclick='Events.addLocationData(event,this)'>"+$ESAPI.encoder().encodeForHTML(a[i])+"</li>");""!=a&&t(!0)},setAddressInfo:function(e,t){if("Leads"==t){var a="";null!=e.LANE&&"null"!=e.LANE&&(a+=e.LANE+", "),null!=e.CITY&&"null"!=e.CITY&&(a+=e.CITY+", "),null!=e.STATE&&"null"!=e.STATE&&(a+=e.STATE+", "),null!=e.COUNTRY&&"null"!=e.COUNTRY&&(a+=e.COUNTRY+", "),null!=e.CODE&&"null"!=e.CODE&&(a+=e.CODE+", "),a=Events.removeExtraComma(a),Events.addressInfo[t]=a}else if("Contacts"==t||"Accounts"==t||"SalesOrders"==t){var i="",n="";null!=e.BILLINGSTREET&&(i+=e.BILLINGSTREET+", "),null!=e.BILLINGCITY&&(i+=e.BILLINGCITY+", "),null!=e.BILLINGSTATE&&(i+=e.BILLINGSTATE+", "),null!=e.BILLINGCOUNTRY&&(i+=e.BILLINGCOUNTRY+", "),null!=e.BILLINGCODE&&(i+=e.BILLINGCODE+", "),null!=e.SHIPPINGCITY&&(n+=e.SHIPPINGCITY+", "),null!=e.SHIPPINGSTREET&&(n+=e.SHIPPINGSTREET+", "),null!=e.SHIPPINGSTATE&&(n+=e.SHIPPINGSTATE+", "),null!=e.SHIPPINGCOUNTRY&&(n+=e.SHIPPINGCOUNTRY+", "),null!=e.SHIPPINGCODE&&(n+=e.SHIPPINGCODE+", ");if(i=Events.removeExtraComma(i),n=Events.removeExtraComma(n),"Contacts"==t){Events.addressInfo.contactBilAddr=i,Events.addressInfo.contactShipAddr=n}else{Events.addressInfo.accountBilAddr=i,Events.addressInfo.accountShipAddr=n}}else if("Vendors"==t){var r="",s="ZIPCODE";null!=e.STREET&&"null"!=e.STREET&&(r+=e.STREET+", "),null!=e.CITY&&"null"!=e.CITY&&(r+=e.CITY+", "),null!=e.STATE&&"null"!=e.STATE&&(r+=e.STATE+", "),null!=e.COUNTRY&&"null"!=e.COUNTRY&&(r+=e.COUNTRY+", "),null!=e[s]&&"null"!=e[s]&&(r+=e[s]+", "),r=Events.removeExtraComma(r),Events.addressInfo[t]=r}},removeExtraComma:function(e){return e=e.slice(0,e.length-2),e+="."},movePVInitialvalue:function(){Events.relAccId="",Events.relAccName="",Events.relAccMod=!1,Events.addressInfo=[],Events.showDuplicateContView=[],Events.authNotificationSentUsers={}},removeParticipant:function(e,t){var a=e,i=new crmRequestPool,n={};n[csrfParamName]=csrfToken,i.initiate({action:e,type:"post",data:n,success:function(e){if(commonUtils.showHideLoadingDiv(),hideAnimatePopup("removepopup"),"success"===e){Events.updateFinalIdJson(a),crmui.showMsgBand("success",I18n.getMsg("crm.event.participant.removed"),4e3);var i=$("#invStatusFilter").val();Crm.userDetails.detailView_newUI||Events.viewInviteesPop(i);var n=-1==i?"invited":1==i?"accept":2==i?"maybe":null;null!=n&&void 0!==n&&$("#right_invCnt_"+n).text($("#right_invCnt_"+n).text()-1),t.closest("tr").remove(),Crm.userDetails.detailView_newUI&&reloadCurrentEntityView()}else crmui.showMsgBand("error",I18n.getMsg("crm.security.error.add.user"),3e3,"")}})},hideLocationPop:function(){setTimeout((function(){$("#locationDataDiv").hide()}),500)},showUnavailablePopUp:function(e,t,a,i,n){var r=this;$("#eventViewPopup").remove();Lyte.injectResources(Lyte.registeredMixins["business-hours-utils"].downloadHolidayFile(),void 0,(function(){Lyte.registeredMixins["business-hours-utils"].showUnavailableinMultiUserView(a,e,t,r,i,n)})),sE(a)},loadMeetingConfigPage:function(e){var t={type:"showMeetingPage",toolName:e};(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/events/EventMeetingAuthorize.do",data:t,type:"GET",success:function(e){$("#internalExtensionDetail").html(e)}})},eventMeetingOAuthSuccess:function(e){Events.closeAuthorizationPopUp();var t=Events.meetingConfZuid[e.toolName],a=0,i=!1;if(t){"string"==typeof t&&(t=JSON.parse(t));for(var n=t.length;a<n;){for(key in t[a])key==Crm.userDetails.USER_ID&&(t[a][Crm.userDetails.USER_ID]=!0,i=!0);a++}}if(!i){var r={};r[Crm.userDetails.USER_ID]=!0,t[t.length]=r}Events.meetingConfZuid[e.toolName]=JSON.stringify(t),$("#saveEventsBtn").attr("disabled",!1),$("#errorMsg_authorizationError").hide(),$("#meetingOnlineProviders").removeClass("errorFieldP"),"undefined"!=typeof calendarSchedule&&calendarSchedule.closePopUp();var s=JSON.parse(Crm.calPreferences.MEETINGPREFDETAILS);if(-1==JSON.stringify(s).indexOf(e.toolName)){var o={conference_details:"",type:"1"};o.toolName=e.toolName,s.push(o),Crm.calPreferences.MEETINGPREFDETAILS=JSON.stringify(s)}crmui.showMsgBand("success",I18n.getMsg("crm.tpi.ctiapi.msg.alert.authorizedsuccess",Events.displayToolName[e.toolName]),"2000"),$("#meetingauthorize").remove()},eventMeetingOAuthFailure:function(e){$(".errMsg").hide(),$("#errorMsg_authorizationError1").show()},eventMeetingReAuthorize:function(e){Events.showMeetingAuthorizationPopUp(e.toolName,void 0,!0,e.isCalendarBooking)},disableMeetingTool:function(e){var t={type:"disableMeetingTool",toolName:e};t[csrfParamName]=csrfToken,(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/events/EventMeetingAuthorize.do",data:t,type:"POST",success:function(t){moduleRecordMapping.Campaigns&&moduleRecordMapping.Campaigns.fields&&delete moduleRecordMapping.Campaigns.fields,"GoToMeeting"==e?(removeFreezeLayer(),$("#pluginIPClick").click()):($("#internalExtensionDetail").html(t),Utils.windowLocationReload())}}),crmui.hidePopup("disablemeetingpopup")},showonboardingChanges:function(){Events.eventMeetingOnboardingShown&&networkUtils.loadFeatureScripts(["zohocrm_eventMeetingOnBoarding.js"],(function(){var e={},t=[{class:"onBoarding-inviteIcon dIB",heading:I18n.getMsg("crm.event.meeting.onboarding.invite.more"),desc:I18n.getMsg("crm.event.meeting.onboarding.invite.desc")}];t.push({class:"onBoarding-hostmeetingIcon dIB",heading:I18n.getMsg("crm.event.meeting.onboarding.host"),desc:I18n.getMsg("crm.event.meeting.onboarding.host.desc.new",[Crm.appName])}),t.push({class:"onBoarding-insightsIcon dIB",heading:I18n.getMsg("crm.event.meeting.onboarding.view"),desc:I18n.getMsg("crm.event.meeting.onboarding.view.desc")}),e.crmAppName=Crm.appName,e.newData=t;var a=Handlebars.templates.eventMeetingOnboarding(e);$("body").append(a),setTimeout((function(){if($("#meetingInclude").is(":visible")){var e=$("#eventCreatePopup"),t=$("#eventCreationInnerDiv"),a=$("#eventCreateContainerDiv"),i=$("#CrmEventMeetingInteg").offset(),n=e.position().left,r=e.width(),s=$(window).scrollTop(),o=$(".gotomettingpreference").prev().width();t.off("scroll.ArrowVisibility");var l=$(".eventsOnboarding"),d=$("#Events_fldRow_LOCATION").offset().top-105,c=a.offset(),m=a.outerWidth(),u=c.left-l.outerWidth()-10;d<=0&&(d=0),u<=0?(l.removeClass("popOverLeftarrow").addClass("popOverrightarrow"),u=c.left+m+10):l.addClass("popOverLeftarrow").removeClass("popOverrightarrow"),l.show();var v=l.width(),p=renderingUtils.windowWidth,h=0;u+v>p&&(h=u+v-p+30,e.css("left",n-h));var g=u-h;l.css({top:d,left:g});var C=$("#eventPopupArrow");l.is(":visible")?C.hide():C.show();var f,E,I,y=i.top-s,R=$("#eventOnboardingSvg");if(l.hasClass("popOverrightarrow")){f='<svg style="width: 320px; height: 35px;" id="evBoardRightArw"><defs><marker id="arrowhead" viewBox="0 0 30 30" refX="24" refY="20" markerWidth="30" markerHeight="30" orient="auto"> <path d="M 8 8 L 25 20 L 5 30" /></marker></defs><g marker-end="url(#arrowhead)"> '+'<path style="display: block" id="path_1" d="M0 0 C90 45 250 45 304 -69" stroke-dashoffset="350" stroke-dasharray="350"></path>'+"</g></svg>",I=i.left+o,r<500&&(I-=20)}else{f='<svg style="width: 100px; height: 50px;" id="evBoardLeftArw"><defs><marker id="arrowhead1" viewBox="0 0 30 30" refX="24" refY="20" markerWidth="30" markerHeight="30" orient="auto"> <path d="M 10 10 L 25 20 L -15 50" /></marker></defs><g marker-end="url(#arrowhead1)"> '+'<path style="display: block" id="path_1" d="M102 -2 C90 5 30 5 0 -45" stroke-dashoffset="150" stroke-dasharray="150"/>'+"</g></svg>",I=g+v-70}E=y+25,R.css({left:I,top:E}).html(f),setTimeout((function(){R.find("#path_1").css("stroke-dashoffset","0")}),10),Events.meetingOnboardScrollBlock=!1,t.on("scroll.ArrowVisibility",Events.onboardArrowScrollListen)}}),600),Events.eventMeetingOnboardingShown=!1}))},onboardArrowScrollListen:function(){if(Events.meetingOnboardScrollBlock)return!1;var e=$("#eventOnboardingSvg"),t=350;e.find("#evBoardLeftArw").length>0&&(t=150),e.find("#path_1").css("stroke-dashoffset",t),Events.meetingOnboardScrollBlock=!0,e.addClass("op0"),setTimeout((function(){var e=$("#eventOnboardingSvg"),t=$("#CrmEventMeetingInteg"),a=$(".eventsOnboarding-title"),i=$(".gotomettingpreference"),n=i.width(),r=i.offset(),s=a.offset(),o=a.outerHeight(),l=t.position(),d=t.offset(),c=d.top-$(window).scrollTop();e.css("top",c+25);var m,u=e.offset(),v=u.left,p=u.top,h=s.top,g=s.left;if("evBoardRightArw"==e.find("svg").attr("id")){var C={x:g+10-v,y:h+o-p};m="M 0, 0 C"+((f={x:r.left+n-v,y:r.top-p+20}).x+40)+","+(f.y+50)+" "+(C.x-20)+","+(C.y+100)+" "+(C.x+10)+","+(C.y+10)}else{var f;C={x:0,y:h+o-p};m="M 102,-2 C"+((f={x:100,y:d.top-p+20}).x-30)+","+(f.y+45)+" "+(C.x+20)+","+(C.y+40)+" 0,"+(C.y+10)}var E=e.find("#path_1");E.attr("d",m),l.top>-5&&(e.removeClass("op0"),E.css({"stroke-dashoffset":"0"})),Events.meetingOnboardScrollBlock=!1}),1e3)},generateAccessToken:function(e,t,a){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var i={};if(i.type="authorizeMeetingTool","enableMeeting"!==t||(i.type=t,"WebexMeeting"!==e&&"MegaMeeting"!==e))i.toolName=e,i[csrfParamName]=csrfToken,(new crmRequestPool).initiate({url:Crm.getCrmBasePath()+"/events/EventMeetingAuthorize.do",type:"POST",data:i,success:function(a){var i=document.getElementsByClassName("crmBodyWin")[0],n=document.createElement("input");if(n.setAttribute("type","hidden"),n.setAttribute("id","removedRSO"),n.setAttribute("value","true"),moduleRecordMapping.Campaigns&&moduleRecordMapping.Campaigns.fields&&delete moduleRecordMapping.Campaigns.fields,"enableMeeting"===t)switch(t){case"RSO":Lyte.Router.transitionTo("crm.settings.section.extensions.zoho-extensions.zoho-apps");break;case"meetingBuy":Lyte.Router.transitionTo("crm.settings.section.extensions.zoho-extensions.meeting");break;case"meetingBuyObserver":i.append(n);break;default:Utils.windowLocationReload()}else{if($("#meetingauthorize").remove(),$("#calschmeetingauthorize").remove(),a.error&&a.errMsg)return void crmui.showMsgBand("error",a.errMsg,"5000");if("ZohoMeeting"!==e&&"WebexMeeting"!==e){var r=a.authorizeUrl;window.open(r,"Login Meeting","height=800,width=600").opener=null,removeFreezeLayer()}else switch(a.paid_user&&crmui.showMsgBand("error",a.message,"5000"),t){case"RSO":case"meetingBuy":Lyte.Router.transitionTo("crm.settings.section.extensions.zoho-extensions.zoho-apps");break;case"meetingBuyObserver":i.append(n);break;default:Utils.windowLocationReload()}Events.removeHostAuthKey(e)}}});else Events.getLoginCredentials(t,e,a)}},getLoginCredentials:function(e,t,a){networkUtils.loadFeatureScripts(["zohocrm_loginPopup.js"],(function(){var i={};i.toolName=t||"WebexMeeting",i.type=e,i.siteUrl=Events.meetingSiteUrl?Events.meetingSiteUrl:{},i.operation=a,i.showMeetingAuthorizeHelpIcon=Events.showMeetingAuthorizeHelpIcon,i.meetingLoginPopupField=Events.meetingLoginPopupField,i.crmAppName=Crm.appName;var n=document.createElement("DIV");n.innerHTML=Handlebars.templates.loginPopup(i);var r=renderingUtils.windowHeight,s=$("#meetingauthorize");0!=s.length?s.replaceWith(n):document.body.appendChild(n);var o=(r-(s=$("#meetingauthorize")).height()-70)/2;$("#eventCreatePopup").css("z-index",19),s.attr("style","top:"+o+"px !important"),crmui.showPopup({id:"meetingauthorize"})}))},authorizeUsingPwdCredentials:function(e,t){var a={},i=$("#calschmeetingauthorize");a.toolName=e,a.type=t;var n=!1;(commonUtils.showHideLoadingDiv(!0),t?(a.siteUrl=$("#siteUrl").val(),n=Events.validateCredentialFields(!0)):(a.type="authorizeMeetingTool",a.emailAddress=$("#webexemailAddress").val(),a.password=$("#webexPassword").val(),n=Events.validateCredentialFields(!1)),n)?commonUtils.showHideLoadingDiv(!1):(a[csrfParamName]=csrfToken,(new crmRequestPool).initiate({url:Crm.getCrmBasePath()+"/events/EventMeetingAuthorize.do",type:"POST",data:a,success:function(){"enableMeeting"==t&&Utils.windowLocationReload(),i.remove(),commonUtils.showHideLoadingDiv(!1)},error:function(){commonUtils.showHideLoadingDiv(!1),$(".errMsg").hide(),$("#errorMsg_authorizationError1").show()}}),$("#eventCreatePopup").is(":visible")||i.css({"z-index":"31"}))},validateCredentialFields:function(e){var t=$("#errorMsg_authorizationError2"),a=$("#errorMsg_authorizationError3"),i=$("#errorMsg_authorizationError4"),n=$("#webexemailAddress"),r=$("#webexPassword");if(e){if(""==$("#siteUrl").val())return t.show(),!0;t.hide()}else if(""==n.val()||""==r.val()){if(a.hide(),i.hide(),$("#errorMsg_authorizationError1").hide(),""==n.val())return a.show(),!0;if(""==r.val())return i.show(),!0}},constructMeetingToolSelectBox:function(e){var t=Object.keys(e),a="[";for(i=0;i<t.length;i++){a=a+'{"toolName":"'+t[i]+'"},'}return a=a.substring(0,a.length-1),a+="]"},startMeeting:function(e,t,a){var i=JSON.parse($("#meetingDetails").val());null!=a&&(i=JSON.parse(a));var n=i.meeting_toolName,r=i.meeting_id;if(s=i.meeting_starturl){var s=i.meeting_starturl;window.open(s).opener=null}else if("TeamVMeeting"==n)window.location="teamviewer8://",setTimeout((function(){networkUtils.openUrl(RebrandLinkUtil.getProperty("TEAMVIEWER_DOWNLOAD_URL")+"")}),5e3);else{var o="";o="Reminder"==e?t:$("#id").val(),(new crmRequestPool).initiate({type:"POST",url:Crm.getCrmBasePath()+"/events/EventAction.do",data:"type=startMeeting&toolName="+n+"&meetingid="+r+"&eventId="+o+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),success:function(e){networkUtils.openUrlwithpopBlockerHandle(e)}})}Crm.trackSpotLightAction("Event Start Meeting",{Place:e})},getModuleName:function(e,t,a){return Crm.getModuleDisplayName(e,t,a)},joinMeeting:function(e){var t=JSON.parse($("#meetingDetails").val());null!=e&&(t=JSON.parse(e));t.meeting_toolName,t.meeting_id;var a=t.meeting_joinurl;window.open(a).opener=null},openCalendarPref:function(){commonUtils.showHideLoadingDiv(!0);var e=$("#eventCreationDiv").is(":visible");e&&$("#FreezeLayer").css("z-index","31"),(new crmRequestPool).initiate({url:Crm.getCrmBasePath()+"/events/Calendar.do?type=getCalPreferences",type:"POST",success:function(t){document.getElementById("pref")||$("body").append("<div id='pref' class='newpopup zi32 pref' style='padding:30px; display:none'></div>"),Crm.trackSpotLightAction("Activities - Calendar Preferences Click"),commonUtils.showHideLoadingDiv(),$("#pref").html(t).show(),manipulateScriptElems(getElemById("pref"));var a=$("#frbtnalign").position().left;$("#prefBtns").css("margin-left",a-30),freezeBackground(),preference_pos(),Events.calPrefCenter("pref"),showHideDuration("openCalendarPref"),e?$("#pref").css({top:$(window).scrollTop()}):$("#pref").css({top:0});var i=$(window).height()-($("#pref .recLabelDiv").outerHeight()+$("#pref #prefBtns").innerHeight()+126);$("#calPrefer_outer").animate({height:i}),e&&$("#calPrefer_inner").scrollTo($("#audio_pref_container").offset().top-100,500)}})},calPrefCenter:function(e){$top=$(window).height()/2,$contop=$("#"+e).height()/2,$left=$(window).width()/2,$conleft=$("#"+e).width()/2,$topCont=$("#tabLayer").height()/2,getElemById(e).style.display="block",$("#FreezeLayer").show(),$(document.body).find().children(".topdivcontainer"),$("#"+e).css({top:"0px",left:$left-$conleft}),window.document.documentElement.style.overflow="hidden"},changeMeetingPref:function(e,t){"ap-own-pref"==e.value?($("#confrencedetails_"+t).css("display","table-cell"),$("#confid"+t).focus()):$("#confrencedetails_"+t).css("display","none")},showAttendessToolTip:function(e,t,a){crmui.showTooltip({content:I18n.getMsg("crm.event.joined.meeting")+": <b> "+e+"</b><br> "+I18n.getMsg("crm.event.left.meeting")+": <b> "+t+"</b><br> "+I18n.getMsg("crm.event.duration.meeting")+":<b>"+a+"</b>",isHTML:!0,position:"showOnRight"}),$(".moreOptions").addClass("hide")},loadHtmlForMeetingLength:function(e){var t='<div id="meetingLength" class="timeAlert" style="display:none"><div><div style="background: rgb(250, 250, 250); padding: 3px; border-top: 1px solid rgb(240, 240, 240); border-right: 1px solid rgb(240, 240, 240); border-bottom: none; border-left: 1px solid rgb(240, 240, 240); border-image: initial;"><table cellpadding="3" cellspacing="0" border="0"><tbody><tr><td valign="top"><span class="dupTimeAlert"></span></td><td class="f12 color_6">';return t+=I18n.getMsg("crm.event.meeting.title.length.limit.msg",[e,Events.meetingTitleLength[e]]),t+="</td></tr></tbody></table></div></div></div>",$(t)},changeTitleMessageDiv:function(e){e=$("#Crm_Events_MeetingSolutions_select option:selected").attr("name");var t=$("#meetingLength");if(e||(e=Events.meetingToolName),($("#meetingInclude").is(":checked")&&"edit"!=Events.currentStatus||Events.withMeetingTool&&"edit"==Events.currentStatus)&&$("#Crm_Events_SUBJECT").val().length>Events.meetingTitleLength[e]){var a=Events.loadHtmlForMeetingLength(e);t.replaceWith(a[0]),(t=Events.getObj("meetingLength")).show()}else t.hide()},getObj:function(e){return $("#"+e)},changeEditPopLocationValue:function(){var e=$("#meetingInclude"),t=$("#meetingOnlineProviders"),a=$("#CrmEventMeetingInteg");"secContent_Event_Information"===$("#Events_fldRow_STARTDATETIME").parent().parent().attr("id")&&($("#Crm_Events_STARTDATETIME").data("dateObj").getTime()>(new Date).getTime()?Events.withMeetingTool?(e.attr("checked",!0),t.show()):(e.attr("checked",!1),t.hide()):a.hide())},changeLocationValue:function(e){var t=$("#Events_fldRow_RECURRING"),a=$("#meetingOnlineProviders"),i=$("#Events_fldRow_LOCATION"),n=$("#Crm_Events_MeetingSolutions_select option:selected").attr("name"),r=$("#meetingInclude"),s=$("#errorMsg_authorizationError"),o=$("#Crm_Events_LOCATION");if(s.is(":visible")&&(s.hide(),a.removeClass("errorFieldP")),"SaveEntity"!=e&&Events.showOrHideAllDayEvent(),r.prop("checked")){Events.meetingCheckBoxEnabled=!0,$(t).hide(),a.show(),$("#Events_fldRow_ALLDAYEVENT").hide(),Events.changeTitleMessageDiv(n),i.addClass("disable-events"),o.val(I18n.getMsg("crm.event.meeting.online.poweredby",Events.displayToolName[n]));var l=Events.checkAuthorizeDone(n,e);return o.attr("readOnly",!0),1==$("#Crm_Events_MeetingSolutions_select").length&&a.addClass("nobdr"),l}Events.meetingCheckBoxEnabled=!1,$(t).show(),a.hide(),$("#meetingLength").hide(),i.removeClass("disable-events"),o.val(""),o.attr("readOnly",!1),$("#Events_fldRow_ALLDAYEVENT").show()},showOrHideAllDayEvent:function(e){$("#meetingInclude").is(":checked")?$("#Events_fldRow_ALLDAYEVENT").hide():$("#Events_fldRow_ALLDAYEVENT").show(),e||Events.checkDuplicateEvent(void 0,!1)},checkAuthorizeDone:function(e,t,a){if(Events.userChange=!1,"ZohoMeeting"!=e&&Events.meetingConfZuid){var i=Crm.userDetails.USER_ID,n=$("#ownerNameLookupSpan"),r=n.attr("userId"),s=n.text(),o=$("#Crm_Events_SMOWNERID");if("calendar"!=Events.createSource||"dayview"!==calView.currCalView&&"weekview"!==calView.currCalView||(r=Events.currentEventHostId),!r)if("edit"==Events.currentStatus){r=$("#changeOwnerPopUp").data("id");var l=document.querySelector("crm-user-wrapper");l&&(s=l.component.getData("userName")),r||(r=o.attr("data-id"),s=o.attr("title"))}else"create"!=Events.currentStatus&&"clone"!=Events.currentStatus||(r=o.attr("data-id"),s=o.attr("title"));var d=null!=a?a:[];if(Events.GetAuthorizedUserCallBack?Events.GetAuthorizedUserCallBack=!1:d=Events.getAuthorizedUsers(e,i,t),i==r&&d&&!d.contains(i)){if("SaveEntity"!==t)if(Crm.userDetails.MEETING_BRIDGE_ENABLED){if(MeetingBridge){var c=Events.MBProvidersNameVsIdMap[e];MeetingBridge.loadAuthorizePopup(c)}}else Events.showMeetingAuthorizationPopUp(e,t);else Events.showAuthorizationError();return $("#saveEventsBtn").attr("disabled","disabled"),!1}if(i!=r&&d&&!d.contains(r)){var m=$("#Crm_Events_MeetingSolutions_select").val();m||(m=Events.meetingToolName),renderingUtils.showAlertMsg(I18n.getMsg("crm.event.meeting.host.notauthorize.alert.new",[s,m,Crm.appName]),"warning",I18n.getMsg("crm.button.ok"),(function(){var e=document.getElementById("lyteAlertMsg");e||(e=Lyte.Component.render("lyte-alert",{id:"lyteAlertMsg",ltPropButtonPosition:"center",ltPropAllowMultiple:"true",ltPropButtons:I18n.getMsg("crm.button.ok"),ltPropContentAlign:"center"},"body")),e.ltProp("wrapperClass","changeHostAlert"),$("#lyteAlertMsg").attr("lt-prop-show-close-button",!1)})),Crm.userDetails.MEETING_BRIDGE_ENABLED&&Events.sendAuthorizationNotificationToHost(e,r),"ChangeOwner"!=t&&$("#saveEventsBtn").attr("disabled","disabled"),Events.userChange=!0}}},showAuthorizationError:function(){var e="crm.event.meeting.errormsg2",t=$("#CrmEventMeetingInteg").offset().top-($("#eventCreatePopup").offset().top+50);1==document.getElementById("Crm_Events_MeetingSolutions_select").length&&(e="crm.event.meeting.errormsg1"),$("#errorMsg_authorizationError").html(I18n.getMsg(e,[Events.displayToolName[$("#Crm_Events_MeetingSolutions_select option:selected").attr("name")],Events.getModuleName(!0,!1,!0)])),$("#errorMsg_authorizationError").show(),$("#meetingOnlineProviders").addClass("errorFieldP"),$("#eventCreationInnerDiv").scrollTop(t)},loadMeetingbridge:function(){if(Crm.userDetails.MEETING_BRIDGE_ENABLED&&"object"!=typeof MeetingBridge){var e={serviceName:"ZohoCRM",serviceID:Crm.userDetails.ZGID,mbDomain:RebrandLinkUtil.getProperty("MEETINGBRIDGE_URL")};Events.downloadMeetingbridge(e)}},downloadMeetingbridge:function(e){var t={};t.parts=location.hostname.split("."),t.subdomain=t.parts.shift(),t.uplvldom=t.parts.join("."),t.server=e.mbDomain;var a=document.createElement("script"),i=new XMLHttpRequest;i.open("GET",t.server+"/meetingbridge/v1/loadJS",!0),i.withCredentials=!0,i.send(null),i.onreadystatechange=function(){if(4===i.readyState){var t=JSON.parse(i.response);a.src=t.MeetingBridgeJS,a.pbJsUrl=t.PBJsUrl,a.onload=function(){MeetingBridge.parentDomain=window.origin,MeetingBridge.init(a,e)},document.head.appendChild(a)}}},getAuthorizedUsers:function(e,t,a){var i=[];if(!Crm.userDetails.MEETING_BRIDGE_ENABLED){var n=Events.meetingConfZuid[e];"string"==typeof n&&(n=JSON.parse(n));for(var r=n?n.length:0,s=0;s<r;){var o=n[s];for(id in"string"==typeof o&&(o=JSON.parse(o)),o)o.hasOwnProperty(id)&&1==o[id]&&i.push(id);s++}return i}store.findAll("dummy",{type:"getAuthorizedUsers",providerId:Events.MBProvidersNameVsIdMap[e],userId:t},!1,!1,{url:Crm.getCrmBasePath()+"/events/EventAction.do",method:"GET"}).then((function(t){Events.GetAuthorizedUserCallBack=!0,Events.checkAuthorizeDone(e,a,t instanceof Object?t:JSON.parse(t))}))},getInstalledMeetingTools:function(){var e=[];if(!Crm.userDetails.MEETING_BRIDGE_ENABLED){if(""==Crm.calPreferences.MEETINGPREFDETAILS||!Crm.calPreferences.MEETINGPREFDETAILS)return[];for(var t=JSON.parse(Crm.calPreferences.MEETINGPREFDETAILS),a=t.length,i=0;i<a;i++){var n=t[i];n.toolName in e||e.push(n.toolName)}}return e},showMeetingAuthorizationPopUp:function(e,t,a,i){networkUtils.loadFeatureScripts(["zohocrm_meetingAuthorizePopUp.js"],(function(){a&&Events.startMeetingWindowObject&&Events.startMeetingWindowObject.close();var n={};n.toolName=e,n.origin=t,n.isReauthorize=a,n.isCalendarBooking=i,n.crmAppName=Crm.appName;var r=document.createElement("DIV");r.innerHTML=Handlebars.templates.meetingAuthorizePopUp(n);var s=renderingUtils.windowHeight,o=$("#meetingauthorize");0!=o.length?o.replaceWith(r):document.body.appendChild(r);var l=(s-(o=$("#meetingauthorize")).height()-70)/2;$("#eventCreatePopup").css("z-index",19),o.attr("style","top:"+l+"px !important"),crmui.showPopup({id:"meetingauthorize"})}))},closeAuthorizationPopUp:function(e,t){var a=$("#saveEventsBtn"),i=$(".eventPop"),n=$("#eventCreatePopup");crmui.hidePopup("meetingauthorize",!0),a.attr("disabled",!1),n.css("z-index",31),$("#meetingInclude").prop("checked",!0),0==n.length?$("#calschmeetingauthorize").css({"z-index":"31"}):i.is(":visible")?i.is(":visible")&&freezeBackground():removeFreezeLayer(),commonUtils.showHideLoadingDiv(!1),Events.removeHostAuthKey(e)},sharedRecorded:function(){var e={type:"getMailDetailsforShareRecording",eventId:$("#id").val(),email:Crm.userDetails.LOGIN_NAME};(new crmRequestPool).initiate({type:"GET",url:Crm.getCrmBasePath()+"/events/EventAction.do",data:e,success:function(e){var t={};t.fromemail=Crm.userDetails.LOGIN_NAME;var a=Handlebars.templates.eventMeetingShareRecording(t);$("#BodyContent").append($(a)),Events.loadTagitPlugin(),$("#EMAIL_MSG_TEXT_AREA").html(e.mailBody),$("#shareScreenSubject").val(e.mailSubject),$("#Crm_Events_SENDTO_select").select2({minimumResultsForSearch:-1}),crmui.showPopup({id:"sharerecordingpopup"})}})},shareRecoredInMail:function(){var e=$("#id").val(),t=$("#Crm_Events_SENDTO_select").val(),a=$("#EMAIL_MSG_TEXT_AREA").html(),i=$("#shareScreenSubject").val(),n={type:"sendRecordedDetails",eventId:e,shareRecordingType:t,mailContent:a,additionEmailids:JSON.stringify(Events.invJsonCreate.e),mailSubject:i};crmui.hidePopup("sharerecordingpopup"),(new crmRequestPool).initiate({type:"POST",url:Crm.getCrmBasePath()+"/events/EventAction.do",data:n,success:function(e){Events.invJsonCreate.e={},crmui.showMsgBand("success","Recording sent",4e3)}})},setEmailIdsInSharingTextArea:function(e,t){var a="",i=t?JSON.parse(t):returnJson.entMetaData.all_participants.clone(),n=JSON.parse(returnJson.entMetaData.meeting_detials);if("Not Attended"==e){if(0!=(o=objectUtils.getKeys(n.attendees_details)).length&&0!=i.length)for(var r=0;r<o.length;r++){var s=i.indexOf(o[r]);s>=0&&i.splice(s,1)}a=i.join(", ")}else if("All Participants"==e)a=i.join(", ");else if("Attendees"==e){var o;a=(o=objectUtils.getKeys(n.attendees_details)).join(", ")}$("#EMAIL_ID_TEXT_AREA").val(a).prop("readonly",!0)},loadEmailToShareRecored:function(e){var t=$("#EMAIL_ID_TEXT_AREA");if("Others"===e)t.val("").prop("readonly",!1);else if(returnJson.entMetaData.all_participants)Events.setEmailIdsInSharingTextArea(e,void 0);else{var a=new crmRequestPool,i={type:"participantDetails",eventId:$("#id").val()+"",option:e};a.initiate({action:Crm.getCrmBasePath()+"/events/EventAction.do",data:i,type:"GET",success:function(t){returnJson.entMetaData.all_participants=JSON.parse(t),Events.setEmailIdsInSharingTextArea(e,t)}})}},callAuthorization:function(){if(Crm.userDetails.MEETING_BRIDGE_ENABLED){var e=Events.MBProvidersNameVsIdMap[toolName];MeetingBridge.loadAuthorizePopup(e)}else Events.authorizeMeetingIndividual($("#Crm_Events_MeetingSolutions_select option:selected").attr("name"))},authorizeMeetingIndividual:function(e,t){if(Crm.userDetails.MEETING_BRIDGE_ENABLED){var a=Events.MBProvidersNameVsIdMap[e];MeetingBridge.loadAuthorizePopup(a)}else{if($("#eventCreatePopup").is(":visible")||$("#calschmeetingauthorize").css({"z-index":"19"}),("WebexMeeting"===e||"ClickMeeting"===e||"MegaMeeting"===e||"StarLeafMeeting"===e)&&"Login"!==t)return void Events.getLoginCredentials(void 0,e,"create");Events.generateAccessToken(e,"")}},showMeetingDetailsTooltip:function(){var e=" ",t=$("#Crm_Events_MeetingSolutions_select");1==t.length&&("Zoho Meeting"==t[0].value&&(e=" (powered by Zoho Meeting) "));crmui.showTooltip({content:I18n.getMsg("crm.event.meeting.toolTip.point1",e)+" <br><br> "+I18n.getMsg("crm.event.meeting.toolTip.point2",[Events.getModuleName(!0,!1,!0)]),isHTML:!0,position:"showOnRight"})},meetingTrialExpireOkClicked:function(){$("#meetingBuy").remove(),$("#Crm_Events_LOCATION").val(""),$("#meetingInclude").prop("checked",!1)},meetingBuyNowClicked:function(){$("#meetingBuy").remove(),0!=$("#modDiv").length&&0==$("#eventCreationDiv").length&&removeFreezeLayer(),renderingUtils.removeDummyBackground();var e=RebrandLinkUtil.getProperty("MEETING_PAYMENTS_URL");window.open(e)},viewInvitationDetails:function(){freezeBackground();var e={};e.eventTitle=$("#entityNameInBCView").text(),e.eventDateTime=returnJson.eventStartDateTime;var t=returnJson.entMetaData.meeting_detials;if(null!=t){var a=JSON.parse(t);e.joinURL=a.meeting_joinurl,a.meeting_dialIn&&"build-in"!=a.meeting_dialIn&&(e.dialDetails=a.meeting_dialIn)}var i=Handlebars.templates.viewOnlineInvitationDetails(e);$("body").append(i),mailsetCenter("onlinemeetingInvitationDetails")},closeOnlineMeetingJoinDetails:function(){$("#onlinemeetingInvitationDetails").remove(),removeFreezeLayer()},copyonlinemeetingDetails:function(){var e=$("#meetingjoinurlval");e.val($("#meeting-join-url").text()),e.select(),document.execCommand("copy"),Events.closeOnlineMeetingJoinDetails(),e.val("")},loadColorPicker:function(e){var t,a=$(e).prop("id"),i=document.getElementById("colorpicker"),n="",r=document.querySelector("crm-user-eventtype");if(t=$(e).hasClass("picklistColorNoFill")?"transparent":$(e).find(".colorDropper_mb").css("background-color")){var s;s="transparent"===(t=Events.rgbtohex(t))?"bg_"+t:"bg_"+t.slice(1),["bg_88413e","bg_cc5e5a","bg_ff4e47","bg_ffa246","bg_f8f65f","bg_ccff33","bg_56fb56","bg_4cc381","bg_7ee7ff","bg_9dc4ff","bg_5590ff","bg_5f80bd","bg_6c6cee","bg_a076ff","bg_c14adf","bg_e789ff","bg_ffb8e8","bg_ff879b","bg_ff4d77","bg_b7b7b7"].contains(s)&&(t=s)}if(r&&(n=r.component.data.from),i&&"Events"===CrmPageLayout.module||i&&"calendar"===n){i.setData({originElem:"#"+a,show:!0,selectedColor:t,from:n,domElements:{pickList_Wrapper:{show:!1}}});var o=$L("crm-picklist-colorpicker")[0].component;o&&o.getData("customColorlen")>=0?i.setData({originElem:"#"+a,show:!0,selectedColor:t,from:n,domElements:{pickList_Wrapper:{show:!1}}}):Lyte.Component.render("crm-picklist-colorpicker",{originElem:"#"+a,id:"colorpicker",from:n,selectedColor:t},"body")}else Lyte.Component.render("crm-picklist-colorpicker",{originElem:"#"+a,id:"colorpicker",from:n,selectedColor:t},"body")},loadColorNearSelect2:function(e){var t=e.children("option:selected")[0],a=$(t).attr("data-colorcode");a&&$('<span class="dIB activitesColor" data-zcqa="color_span" style="background:'+a+'"></span>').insertBefore(e)},customTemplate:function(e){var t=e.text;if(void 0!==e.element){var a=JSON.parse($(e.element.parentElement).attr("data-picklistmap"));if(a[1].colorCode){var i=a[$(e.element).index()].colorCode;return $('<span class="dIB activitesColor" data-zcqa="color_custom_span" style="background:'+i+'"></span><span>'+t+"</span>")}}},rgbtohex:function(e){if(void 0!==e){if(e.startsWith("rgba"))return Events.rgbatohexa(e);if(-1===e.search("rgb"))return e;{function t(e){return("0"+parseInt(e).toString(16)).slice(-2)}return"#"+t((e=e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/))[1])+t(e[2])+t(e[3])}}},rgbatohexa:function(e){function t(e){return("0"+parseInt(e).toString(16)).slice(-2)}return"#"+t((e=e.substr(5).split(")")[0].split(","))[0])+t(e[1])+t(e[2])+(0==(a=e[3])?"00":Math.round(255*a).toString(16));var a}},CrmReminderNotification={};function openPrintTemplatePop(e,t){var a=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/Template.do?step=previewPop&entityId="+e+"&module="+t+"&action=print");if(a=Crm.getPortalURL(a),$("#tIdx").length>0&&(a+="&tIdx="+$("#tIdx").val()),$("#relParentId").length>0&&(a+="&relParentId="+$("#relParentId").val()),$("#TotalNotesCount").length>0&&(a+="&TotalNotesCount="+$("#TotalNotesCount").val()),$("#currentCount").length>0&&(a+="&currentCount="+$("#currentCount").val()),$("#model").length>0&&(a+="&model="+$("#model").val()),$("#notesTypeHolder").length>0&&(a+="&isallnotes="+$("#notesTypeHolder").attr("isallnotes")),$("#hiddenNotes").length>0&&($("#hiddenNotes").is(":visible")?a+="&hiddenNotes=true":a+="&hiddenNotes=false"),"Accounts"===t){var i=$("#contactSelDropdownInAcc :selected").attr("value");i&&(a+="&contactId="+i)}adjustScreenAndOpen(a,t)}function adjustScreenAndOpen(e,t){if("undefined"!=typeof crmNewPortal&&crmNewPortal)Crm.showURLChangeAlert(!1);else{var a=window.screen.availWidth,i=window.screen.availHeight,n=a,r=i;r=i<450?440:i<600?550:i>700?680:i-50,a<1200||a<=1440?n=1150:a>1500&&(n=1200),Crm.userDetails.ISPAID_USER||Crm.isInventoryModule(t)||(n=800);var s=100;a>n&&(s=(a-n)/2),window.open(Crm.getOrgSpecificURL(e),"","toolbar=no, scrollbars=yes, resizable=yes, top=0, left="+s+", width="+n+", height="+r)}}function showPopupMenuOld(e,t,a,i,n,r){hideMenu(n);var s=e.offsetWidth,o=e.offsetHeight,l=findPosY(getObj(e.id)),d=findPosX(getObj(e.id)),c=getObj(t),m=0;if(-1!=navigator.userAgent.indexOf("Firefox")&&getObj("detailViewButtonLayerDiv")&&"fixed"==getObj("detailViewButtonLayerDiv").style.position&&"Contact Tools"==e.id)m=document.getElementById("show").offsetLeft;c.style.display="block";var u=c.offsetWidth,v=c.offsetHeight;if(null!=r&&(e.className=r),"addAttach"===$(e).attr("id")&&$("#dvinner").length){var p=$(e).offset();return $(c).offset({top:p.top+o,left:p.left-m-u}),void $(c).offset({top:p.top+o,left:p.left-m-u})}c.style.left=null==a||"left"==a?d-m+"px":d+s-u-m+"px",c.style.top=null==i||"bottom"==i?l+o+"px":l-v+"px"}CrmReminderNotification.init=function(){var e=window.Notification||window.mozNotification||window.webkitNotification;e&&"denied"!==e.permission&&"granted"!==e.permission&&$(document.body).one("click",(function(){e.requestPermission()}))},CrmReminderNotification.show=function(e,t,a,i){var n={icon:e,body:a};i.id&&(n.tag=i.id);var r=new Notification(t,n);i.clickUrl&&(r.onclick=function(){window.open(i.clickUrl,"_blank")})},Handlebars.registerHelper("getValueForRemInputBox",(function(e,t){var a=Events.getValueForRemInputBox(e);return""==a?t.inverse(this):a})),Handlebars.registerHelper("getValueForRemInputBoxAndSpanRemInv",(function(e,t,a,i,n,r){var s=e.split(" "),o=s[0],l="";if(2===s.length)return Handlebars.helpers.getValueForRemInputBoxAndSpan(e,t,a,i,n,r);switch(s[1]){case"minutes":o=s[0],l="mins";break;case"days":case"day":o=s[0],l="days";break;case"hour":o=s[0],l="hrs";break;case"time":o=0,l="weeks"}var d=o+" "+l;return"None"===o&&(d="none"),Handlebars.helpers.getValueForRemInputBoxAndSpan(d,t,a,i,n,r)})),Handlebars.registerHelper("getValueForRemInputBoxAndSpan",(function(e,t,a,i,n,r){null==e&&(e=a.indexOf("Appointment")>0?Crm.calPreferences.APPOINTMENT_REMINDAT:Crm.calPreferences.REMINDAT);var s=Events.getValueForRemInputBox(e),o=e.split(" ");t||"weeks"==o[1]&&(s*=7);var l="<input type='text' value='",d=null;d=t&&("hrs"==o[1]&&s>24||"mins"==o[1]&&s>1440)?s+"' style='display:none;'":0==s?"0' style='display:none;'":s+"'";var c=a+(parseInt(r)+3);return"Crm_Events_REMINDINVITEESAT"===a&&(c=a),l=(l+=d)+" id='"+c+"' onmouseenter='$(this).css(&#39;border&#39;,&#39;1px solid #ddd&#39;);$(&#39;.selectBoxInput&#39;).css(&#39;border&#39;,&#39;&#39;);' onmouseleave='$(this).css(&#39;border&#39;,&#39;&#39;);sE(event)' onkeyup='Events.changeVal(this)' onkeypress='return event.charCode >=48 && event.charCode <=57' onclick='this.setSelectionRange(0, this.value.length)' onfocusout='Events.validateTimeNumeralFieldOfReminders(this)' onfocus='Events.setPreviousValue(this)' data-value='"+Events.getDataValue(e,t)+"' class='selectBoxField dIB vam' maxlength='2'"+Events.convertObjToKeyValuePair(i)+Events.convertObjToKeyValuePair(n),"true"==n["data-readonly"]&&"Crm_Events_REMINDINVITEESAT"===a&&(l+="readonly='true'"),l+="'/>",l+="<div class='selectOpt dIB vam' onmouseenter='$(this).parent(&#39;.selectBoxInput&#39;).css(&#39;border&#39;,&#39;1px solid #ddd&#39;);' onmouseleave='$(this).parent(&#39;.selectBoxInput&#39;).css(&#39;border&#39;,&#39;&#39;);sE(event);'>",l+="<span class='slctOptVal'",1==Events.setPadding(e)&&(l+="style='padding-left:10px'"),l+=">",Events.getHtmlForReminders(e,l,t)})),Handlebars.registerHelper("isUndefinedOrEmpty",(function(e,t){return null==e||""==e?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("setReminderVars",(function(e){null==e||""==e?(Events.maxReminderValue=1,Events.reminderCount=1,Events.reminders=[],Events.allDayReminders=[]):(Events.maxReminderValue=e.length+2,Events.reminderCount=e.length+1,Events.reminders=[],Events.allDayReminders=[])})),Handlebars.registerHelper("sum",(function(e,t){return parseInt(e)+parseInt(t)})),Handlebars.registerHelper("constructMultipleRemindersOptions",(function(e){return Events.constructMultipleRemindersOptions(void 0,void 0,e)})),Handlebars.registerHelper("getDataValue",(function(e){return Events.getDataValue(e)})),Handlebars.registerHelper("getNumberOfRemindersText",(function(e){return I18n.getMsg("crm.event.number.of.reminders",[e.length])})),Handlebars.registerHelper("getDisplayReminderText",(function(e,t,a){return Events.getHtmlForEventReminder(e,Events.getValueForRemInputBox(e),t,a)})),Handlebars.registerHelper("isReminderDivNeeded",(function(e,t){return 1==e.length?t.inverse(this):t.fn(this)})),Handlebars.registerHelper("isNoneNeeded",(function(e,t){return null!=e&&e.length>=20?t.inverse(this):t.fn(this)})),Handlebars.registerHelper("isPreferenceReminderNeeded",(function(e,t){if("Appointments"!==Events.moduleName&&"Appointments"!==crmCommonModule.moduleName||void 0===Crm.calPreferences.APPOINTMENT_REMINDAT){if(void 0!==e&&e.length<=1||"edit"===Events.currentStatus||"clone"===Events.currentStatus||"none"===Crm.calPreferences.REMINDAT)return t.inverse(this)}else if("edit"===Events.currentStatus||"clone"===Events.currentStatus||"edit"===crmCommonModule.currentStatus||"clone"===crmCommonModule.currentStatus||"none"===Crm.calPreferences.APPOINTMENT_REMINDAT)return t.inverse(this);return Events.reminderCount=2,Events.maxReminderValue=2,t.fn(this)}));var crmRelatedList={Module:"",ModuleApiName:"",EntityId:"",EachModuleData:{},CampaignEmailObj:{},ListIds:[],filters:{},openCusData:{},closeCusData:{},mandFields:{},load:function(e,t,a,i,n){if(resetCustomRelatedListTrigger(),!a.Converted_Lead&&"undefined"!=typeof returnJson&&returnJson&&"canvas"!=Lyte.Router.getRouteInstance().routeName){if("Potentials"===e&&returnJson.entityMapJson.CONTACTID){var r=returnJson.entityMapJson.CONTACTID.defaultid;if(r&&"null"!==r&&!$("#dIBestTime").length&&$("#BestTimeDetailsPage").length){var s=networkUtils.returnDependencyFiles(["crm-besttime-zia.js"],crmConstants.jsStaticPathForLyte);s=s.concat(networkUtils.returnDependencyFiles(["crm-besttime-zia.css"],crmConstants.cssStaticPathForLyte));Lyte.injectResources(s,void 0,(function(){Crm.userDetails.detailView_newUI?Lyte.Component.render("crm-besttime-new",{seid:r,viewType:"DetailsPage",module:"Contacts",dueDate:new Date,type:"CALLTEXT"},"#BestTimeDetailsPage"):Lyte.Component.render("crm-besttime-zia",{seid:r,viewType:"DetailsPage",module:"Contacts",dueDate:new Date,type:"Call"},"#BestTimeDetailsPage"),crmBstTime.setPosition()}))}}if(Crm.userDetails.isSegmentationEnabled&&returnJson.isSegmentationAllowed&&!window.clientPortalName&&networkUtils.loadFeatureScripts([networkUtils.getI18nJSUrl("segmentation")],(function(){$("#segmentation").is(":visible")||crmRelatedList.loadSegmentationInfo(t,e)})),"Appointments"===e&&a.Appointments&&CSU.isJobSheetSupported){var o,l=detailView.Service_needed_Details.Job_Sheet_Required;CSU.servicePreferences&&(o=CSU.servicePreferences.job_sheet_enabled);var d=$("#jobSheetInfoSection"),c=$("#jobSheetEditBtn");if(a.JobSheets){Handlebars.registerPartial("crmDetailView",Handlebars.templates.crmDetailView),detailView.sectionInit(a.JobSheets,"JobSheets");var m,u=Handlebars.templates.crmDetailView(a.JobSheets.JobSheets);m=1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI?".showhideDetailsDivEle":"#fullInfoDiv",0==d.length?$('<div id = "jobSheetInfoSection" style="display:block" class="mT30 mB40">'+u+"</div> ").insertAfter(m):$($(d).html(u)).insertAfter(m),(d=$("#jobSheetInfoSection")).find(".labelTab").addClass("columnCal1");var v=$(".detailViewContainer .columnCal1").outerWidth();if($("#jobSheetInfoSection").find(".columnCal1").css("width",v),c.length>=0){var p='{"module":"JobSheets","id":"'+a.JobSheets.JobSheets.entityid+'","from":"detailView"}';if(1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI)var h='<div id="jobSheetEditBtn">'+('<a href="javascript:void(0)" class="f13 mL15" type="button" data-zcqa="editBtn" onclick="hideMenu();" id="editRecordbtn" data-cid="editbtn" data-params='+p+">"+I18n.getMsg("crm.button.edit")+"</a>")+"</div>";else h='<div id="jobSheetEditBtn" class="mL10">'+('<input class="neweditIcon dIB mR8" type="button" data-zcqa="editBtn" onclick="hideMenu();" id="editRecordbtn" data-cid="editbtn" data-params='+p+' name="'+I18n.getMsg("crm.button.edit")+'"/>')+"</div>";detailView.Service_needed_Details.EDIT_ALLOWED_SA&&$("#secDiv_Job_Sheet_Information .contHeadInfo").append(h)}}$("#relatedPageContent").children("#RelatedListCommonDiv").each((function(){if("JOBSHEETSPERSONALITY"==this.getAttribute("ddname")){var e;if("Cancelled"!==renderingUtils.getPickListDefaultValToActualValDetailView(returnJson.entityMapJson.APPOINTMENTSTATUS)&&!a.JobSheets&&(0===d.length||0===c.length)&&l&&"Yes"===l.systemvalue&&o)e=1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI?".showhideDetailsDivEle":"#fullInfoDiv",$('<div id = "jobSheetInfoSection" style="display:block" class="mT30 mB40 relatedlist-bg">'+this.innerHTML+"</div> ").insertAfter(e);return $(this).children().hide(),!1}}))}var g,C=[],f=[],E=!1,I=0,y="",R="",b="",T="",D="",w=[],M=[],S="",L="",A="",_="",O=0,N=0,P=0,k=0,F=0,x="",U=!1,V=null;if("string"==typeof a&&(a=JSON.parse(a)),e!=crmRelatedList.Module&&(crmRelatedList.EachModuleData={}),a.listLabelsJson){if("Appointments"===e)for(var B=a.listLabelsJson.length,j=0;j<B;j++)if("JOBSHEETSPERSONALITY"===a.listLabelsJson[j].name){a.listLabelsJson.splice(j,1);break}returnJson.relListLabelsJson.relListLabelJson=a.listLabelsJson,returnJson.relListLabelsJson.isNotesRLPresent=a.isNotesRLPresent,detailView.formNewLeftPanel();var H=Handlebars.templates.RelatedList(returnJson.relListLabelsJson);$("#relatedPageContent").html(H)}crmRelatedList.Module=e,crmRelatedList.EntityId=t;var Y=a[crmRelatedList.Module];"Deals"===crmRelatedList.Module&&void 0===Y&&(crmRelatedList.Module="Potentials",Y=a[crmRelatedList.Module]),"Meetings"===crmRelatedList.Module&&void 0===Y&&(crmRelatedList.Module="Events",Y=a[crmRelatedList.Module]),Handlebars.registerPartial("zdeskActions",Handlebars.templates.zdeskActions);document.querySelector("crm-backstage-detail-wrapper");var J=0,z={},q={},G={data:[]},W={data:[]},Z={data:[]},Q={},K={},X=$L("crm-activity-rel-actions"),ee=$L("crm-activity-rel-customize"),te=0===ee.length?ee:"openActivities"===ee[0].component.data.btn_name?ee[0]:ee[1],ae=0===ee.length?ee:"closedActivities"===ee[0].component.data.btn_name?ee[0]:ee[1],ie=null,ne=null,re=null,se=null;for(key1 in Y){var oe={};J++,Y.hasOwnProperty(key1)&&(oe=Y[key1],crmRelatedList.EachModuleData[key1]=oe);var le=$("#"+oe.listRelationId);if("ACTIVITYHISTORYPERSONALITY"!==oe.name&&"ACTIVITYPERSONALITY"!==oe.name||!Crm.isActivitySplitDone){var de=oe.filtersAvailable;if("SCOREPERSONALITY"!==oe.name)if("undefined"==typeof businessCardJson||!businessCardJson||7!=businessCardJson.isApproved&&8!=businessCardJson.isApproved&&10!=businessCardJson.isApproved&&12!=businessCardJson.isApproved&&13!=businessCardJson.isApproved||"ACTIVITYHISTORYPERSONALITY"==oe.name||"ACTIVITYPERSONALITY"==oe.name||"EMAILSPERSONALITY"==oe.name||"ATTACHMENTSPERSONALITY"==oe.name||null==oe.label||(f.push(oe.listRelationId),C.push(oe.label),"SUPPORTPERSONALITY"==oe.name&&(E=!0)),"SALESORDERSPERSONALITY"!=oe.name&&"INVOICESPERSONALITY"!=oe.name&&"POTENTIALSPERSONALITY"!=oe.name&&"CONTACTSPERSONALITY"!=oe.name&&"ACCOUNTSPERSONALITY"!=oe.name||(w.push(oe.listRelationId),M.push(oe.label)),"CHILDCAMPAIGNSPERSONALITY"!==oe.name)if("MESSAGESPERSONALITY"!==oe.name){de&&("CHILDCAMPAIGNSPERSONALITY"!==oe.name&&("LEADSPERSONALITY"!==oe.name&&"CONTACTSPERSONALITY"!==oe.name||("LEADSPERSONALITY"===oe.name?!0:!0,crmRelatedList.recipientScrollToId=crmRelatedList.recipientScrollToId?crmRelatedList.recipientScrollToId:oe.listRelationId),crmRelatedList.hideOnCheckRlActions(oe.listRelationId)),crmRelatedList.preProcessForV2Model(oe));var ce=null,me=!("APPOINTMENTSPERSONALITY"!==oe.name||"Services"!==e&&Crm.isActivitySplitDone)||void 0;if("TASKSHISTORYPERSONALITY"!==oe.name&&"CALLSHISTORYPERSONALITY"!==oe.name&&"EVENTSHISTORYPERSONALITY"!==oe.name&&"TASKSPERSONALITY"!==oe.name&&"EVENTSPERSONALITY"!==oe.name&&"CALLSPERSONALITY"!==oe.name&&"APPOINTMENTSPERSONALITY"!==oe.name&&"APPOINTMENTSHISTORYPERSONALITY"!==oe.name||me)ce=Handlebars.templates.RelatedListData(oe);else{oe.rel_module=e;var ue=oe.body;oe.body={},oe.headings=ue.headings?ue.headings:[],oe.fields=ue.fields?ue.fields:[],oe.data=ue.data,oe.info=ue.info,oe.entity_id=t,oe.personality=oe.name,oe.list_relation_id=oe.listRelationId,oe.name.indexOf("HISTORY")>0?(q[oe.module]=oe,le.length>0&&(se=le)):(z[oe.module]=oe,le.length>0&&(re=le))}if("RELATEDLISTPERSONALITY"==oe.name)$("#customRelatedListDiv_"+oe.listRelationId).html(ce);else if("SUPPORTPERSONALITY"==oe.name);else{if("ATTACHMENTSPERSONALITY"==oe.name){var ve,pe=[],he=detailView.currentModule,ge=store.peekRecord(moduleRecordMapping[he].id,t);ge||pe.push(store.findRecord(moduleRecordMapping[he].id,t,{approved:"both"}));var Ce=store.peekRecord("related_list",oe.listRelationId);Ce||pe.push(store.findRecord("related_list",oe.listRelationId,{module:moduleApiMapping[he]}));var fe=function(){var e='#RelatedListCommonDiv[ddname="ATTACHMENTSPERSONALITY"]';$(e).length<=0||("Events"===he&&(e="#eventsRightPanelAttachDiv"),$(e).html(""),Lyte.Component.render("crm-related-list-view-header",{entityId:t,module:he,relatedList:Ce,record:ge,layoutId:ve},e))};if(pe.length>0){var Ee=oe.listRelationId;Promise.all(pe).then((function(){ge||(ge=store.peekRecord(moduleRecordMapping[he].id,t)),ve=ge&&ge.Layout?ge.Layout.id:store.peekRecord("module",moduleRecordMapping[he].id).layouts[0].id,Ce||(Ce=store.peekRecord("related_list",Ee)),fe()})).catch((function(e){murphy.error(e)}))}else ve=ge.Layout?ge.Layout.id:store.peekRecord("module",moduleRecordMapping[he].id).layouts[0].id,fe();continue}if("SURVEYPERSONALITY"==oe.name){if(store.pushPayload("zsurvey_rl",oe),$L("crm-zsurvey-rl-body")[0]){var Ie=document.getElementsByTagName("crm-zsurvey-rl-body")[0].component;Ie.loadCompData.call(Ie)}}else"LINKEDIN_SALES_NAVIGATOR_PERSONALITY"!==oe.name&&null!==ce?$("#"+oe.listRelationId).html(ce):null===ce&&$("#"+oe.listRelationId).hide()}var ye="CB_"+key1;if(CustomButtonJSObjectInit.checkBox&&null!=CustomButtonJSObjectInit.checkBox[ye]){var Re=CustomButtonJSObjectInit.checkBox[ye].length;if(0==Re)$("#"+ye).addClass("customCheckBox").removeClass("customCheckBoxChecked"),$("#customButtonDetails_"+key1).hide();else{for(j=0;j<Re;j++)$("#CB_"+CustomButtonJSObjectInit.checkBox[ye][j]).addClass("customCheckBoxChecked");var be=$(".customDom[data-cid=selectEntity_"+key1+"]").length,Te=$(".customCheckBoxChecked[data-cid=selectEntity_"+key1+"]").length;0!=be&&Te==be&&$("#"+ye).removeClass("customCheckBox").addClass("customCheckBoxChecked")}$("#relatedListRecVal_"+key1).text(Re)}var De=$("#norec_"+oe.listRelationId),we=$("#ract_"+oe.listRelationId);if(ie||!we.length||-1!==oe.name.indexOf("HISTORY")||crmRelatedList.isNotActivitySubPersonality(oe.name,me)||(ie="#ract_"+oe.listRelationId),ne||!we.length||-1===oe.name.indexOf("HISTORY")||crmRelatedList.isNotActivitySubPersonality(oe.name,me)||(ne="#ract_"+oe.listRelationId),oe.isShowColumns){var Me="";!crmRelatedList.isNotActivitySubPersonality(oe.name,me)?$("#"+oe.name+"_"+oe.listRelationId).siblings("#relatedListCols_"+oe.name).length&&(Me=$("#"+oe.name+"_"+oe.listRelationId).siblings("#relatedListCols_"+oe.name)):$("#"+oe.name+"_"+oe.listRelationId).siblings("#relatedListCols").length&&(Me=$("#"+oe.name+"_"+oe.listRelationId).siblings("#relatedListCols")),$("#"+oe.name+"_"+oe.listRelationId).after(Me)}else $("[ddid="+oe.listRelationId+"]").find("#showCustomizeList").remove();if("EMAILSPERSONALITY"==oe.name&&("Vendors"==crmRelatedList.Module||"Cases"==crmRelatedList.Module||"Leads"==crmRelatedList.Module||"Contacts"==crmRelatedList.Module||"Accounts"==crmRelatedList.Module||"Potentials"==crmRelatedList.Module||"Quotes"==crmRelatedList.Module||"SalesOrders"==crmRelatedList.Module||"PurchaseOrders"==crmRelatedList.Module||"Invoices"==crmRelatedList.Module||oe.isCustomModule||crmRelatedList.Module&&(-1!==crmRelatedList.Module.indexOf("CustomModule")||-1!==crmRelatedList.Module.indexOf("LinkingModule")))){if(oe.mailObj.email_related_list){var Se=oe.mailObj.mailType;oe.mailObj=oe.mailObj.email_related_list[0],oe.mailObj.mailType=Se}oe.mailObj.module=crmRelatedList.Module,oe.mailObj.entityId=crmRelatedList.EntityId,oe.mailObj.loginUserId=Crm.userDetails.USER_ID,oe.mailObj.singularMod=moduleRecordMapping[crmRelatedList.Module].singular_label,Crm.frameOriginForEmail=oe.frameOriginForEmail,_=oe.listRelationId,O=1,"Accounts"===crmRelatedList.Module&&(oe.contactObject||oe.mailObj.email_related_list&&oe.mailObj.email_related_list[0].contacts_details)&&crmTab.tabList.contains("Contacts")&&(oe.mailObj.contactObject=null!=oe.mailObj.email_related_list?oe.mailObj.email_related_list[0].contacts_details:oe.contactObject)}if("CONTACTSROLESPERSONALITY"==oe.name&&oe.ACTIONS&&oe.ACTIONS.forEach((function(e){var t=$("#accountId");if(t.length&&(e.accId=t.val()),returnJson.entityMapJson.ACCOUNTID){var a=returnJson.entityMapJson.ACCOUNTID.defaultid;void 0!==a&&"null"!==a&&""!==a&&(e.accId=a)}})),"SURVEYPERSONALITY"!=oe.name){var Le=$("#eventsRightPanelAttachDiv"),Ae=$("#eventsAttachButtonDiv"),_e=null;if(crmRelatedList.isNotActivitySubPersonality(oe.name,me)?_e=Handlebars.templates.personalityAction({actions:oe.ACTIONS,rid:oe.listRelationId,name:oe.name,mailObj:oe.mailObj,entityId:crmRelatedList.EntityId,moduleName:crmRelatedList.Module,isRecordLocked:oe.isRecordLocked,body:oe.body,isCustLookUp:oe.isCustLookUp,filtersAvailable:oe.filtersAvailable}):-1==oe.name.indexOf("HISTORY")&&0==X.length&&(G.parentid=oe.listRelationId,oe.ACTIONS&&(Q[oe.module]=oe.ACTIONS[0])),oe.isShowColumns&&!crmRelatedList.isNotActivitySubPersonality(oe.name,me)&&(W.parentid||-1!==oe.name.indexOf("HISTORY")?Z.parentid||-1===oe.name.indexOf("HISTORY")||(Z.parentid=oe.listRelationId):W.parentid=oe.listRelationId,oe.data&&0!==oe.data.length)){var Oe={};if(Oe.module=oe.module,Oe.zcqa="customize_"+oe.module,Oe.personality=oe.name,Oe.label="Events"===oe.module?"Meetings":oe.module,Oe.label=I18n.getMsg(Oe.label),Oe.parentid=oe.listRelationId,-1===oe.name.indexOf("HISTORY")){if(!ie&&te&&0!==te.length&&te.component.data.parentid)ie="#ract_"+te.component.data.parentid;K[oe.module]=Oe}else{if(!ne&&ae&&0!==ae.length&&ae.component.data.parentid)ne="#ract_"+te.component.data.parentid;K[oe.module+"_History"]=Oe}}var Ne=$("#rel_newui_"+oe.listRelationId);if(0!=oe.body.length||crmRelatedList.filters[oe.listRelationId]||"PROJECTSPERSONALITY"==oe.name||"ATTACHMENTSPERSONALITY"==oe.name)!crmRelatedList.isNotActivitySubPersonality(oe.name,me)&&X.length>0||we.html(_e);else if("SOCIALPERSONALITY"==oe.name)U=!0,V=oe.SocialObj;else if("EMAILSPERSONALITY"==oe.name&&1==oe.isFromAPI){var $e={rid:oe.listRelationId,mailObj:oe.mailObj,erlCheckboxChecked:!1};store.pushPayload("emails_rl_user",{content:"shared_users_"+crmRelatedList.EntityId,data:$e}),le.empty(),Lyte.Component.render("crm-rl-users-list",$e,"[id='"+oe.listRelationId+"']"),Crm.userDetails.mailConfigured=$e.mailObj.mailConfigured,("Potentials"==crmRelatedList.Module||"Deals"==crmRelatedList.Module)&&Lyte.Component.registeredHelpers.getUserStatus("IMAP_STATUS")&&$e.mailObj.mailConfigured&&disablePOPUsers($e.mailObj);var Pe={isRecordLocked:oe.isRecordLocked,mailObj:oe.mailObj};Lyte.Component.render("crm-rl-share-email",Pe,"[id='ract_"+oe.listRelationId+"']")}else we.html(""),De.html(_e),1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&(Ne.parents("#RelatedListCommonDiv").addClass("noDataFountDetail"),we.parent("td").addClass("noDataFountDetailtxt"));1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&(oe.body.length>0?"Events"===e&&"ATTACHMENTSPERSONALITY"==oe.name?(Le.removeClass("noDataFountDetail"),Ae.parent("td").removeClass("noDataFountDetailtxt")):(Ne.parents("#RelatedListCommonDiv").removeClass("noDataFountDetail"),we.parent("td").removeClass("noDataFountDetailtxt")):"PROJECTSPERSONALITY"==oe.name&&(Ne.parents(".component1").addClass("noDataFountDetail"),we.parent("td").addClass("noDataFountDetailtxt"))),"RELATEDLISTPERSONALITY"==oe.name&&($("#relPersAction_"+oe.listRelationId).html(De.html()),De.remove(),we.html(_e)),"PROJECTSPERSONALITY"==oe.name&&(b=oe.ProjectObj.authMsg,T=oe.ProjectObj.portalName,$("#portalname").val(T),null!=oe.ProjectObj.projectIdList&&""!=oe.ProjectObj.projectIdList&&(I=1,y=oe.listRelationId,R=oe.name.toLowerCase()+"_"+oe.listRelationId,D=oe.ProjectObj.projectIdList,De.remove())),"SUPPORTPERSONALITY"==oe.name&&oe.SupportObj&&(null!=oe.SupportObj.crmAdmin&&null!=oe.SupportObj.portalUser||null!=oe.SupportObj.supportTicket&&oe.SupportObj.supportzuid),"ZINVOICEPERSONALITY"==oe.name&&(N=1,S=oe.listRelationId),"ZEXPENSEPERSONALITY"==oe.name&&(P=1,L=oe.listRelationId),"ZSUBSCRIPTIONSPERSONALITY"==oe.name&&(k=1,A=oe.listRelationId);var ke=detailView.relatedPersonalityList[oe.name];i&&"updateCampaignStatus"!==n||!ke||detailView.loadRelatedDetails($("#module").val(),$("#entityId").val(),ke),"navigate_next_rellist"!==n&&"navigate_previous_rellist"!==n||populateRLCount(oe.listRelationId,void 0,!0),oe.isCustLookUp||"Campaigns"!==e||"LEADSPERSONALITY"!==oe.name&&"CONTACTSPERSONALITY"!==oe.name||crmRelatedList.showOnCheckRlActions(oe.listRelationId)}}else F=1,x=oe.listRelationId;else{var Fe=document.querySelector("crm-child-campaigns");oe.isLoading=!1,Fe.setData(oe)}else oe.isRulesAvailable?g={entity_scores:oe.body,module:e}:$L(".scorigRulesTable").css("display","none")}}if("undefined"!=typeof detailview_log&&location.host.includes("zoho.in")&&"60010197171"===crmZgid){detailview_log.nodeCountAfterRender=$("*").length,detailview_log.logEndTime=(new Date).getTime();var xe={module_dependency_hook:detailview_log.moduleDependency_diff,module_model_hook:detailview_log.isGSearch?detailview_log.module_diff:"",entity_redirect_hook:detailview_log.entityRedirect_diff,detail_dependency_hook:detailview_log.detailDependency_diff,detail_model_hook:detailview_log.detailModel_diff,detail_afterRender_hook:detailview_log.detailAfterRender_diff,createTemplate:detailview_log.createTemplate_diff,loadRelatedDetails:detailview_log.loadRelatedDetails_diff,init:detailview_log.initJS_diff,zuid:Crm.userDetails.ZUID,entityId:t,isGlobalSearch:detailview_log.isGSearch,speedIndex:speedBenchmarkEnd-speedBenchmarkStart,lastRefresh:Crm.userDetails.lastRefresh,timeStamp:$L.moment().toDate().getTime(),type:"gmetrics",nodeCountAfterRender:detailview_log.nodeCountAfterRender,nodeCountRenderTemp:detailview_log.nodeCountRenderTemp,xhrTimings:detailview_log.xhrTiming,logStartTime:detailview_log.logStartTime,logEndTime:detailview_log.logEndTime,resourcesTime:detailview_log.resourceTime},Ue={url:RebrandLinkUtil.getProperty("LOGS_API_URL")+"?logtype=jslogs",type:"POST",data:xe},Ve=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),Be=Ue.async||!0;Ve.open(Ue.type,Ue.url,Be),Ve.addEventListener("load",Ue.success),Ve.addEventListener("error",Ue.error),Ve.setRequestHeader("content-type","application/json"),Ve.send(JSON.stringify(Ue.data)),detailview_log.isGSearch=!1,detailview_log.xhrTiming=[],detailview_log.resourceTime=[],detailview_log.getRes=[]}g&&(g.layout_id=returnJson.layoutIdOfEntity?returnJson.layoutIdOfEntity:store.peekRecord("module",moduleRecordMapping[detailView.currentModule].id).layouts[0].id,detailView.arry=[],crmRelatedList.renderScoringRelList(g)),G.parentid&&0===X.length&&(Q.Tasks&&G.data.push(Q.Tasks),Q.Events&&G.data.push(Q.Events),Q.Calls&&G.data.push(Q.Calls),Q.Appointments&&G.data.push(Q.Appointments),Lyte.Component.render("crm-activity-rel-actions",G,ie));var je=["Tasks","Events","Calls","Appointments"],He=["Tasks_History","Events_History","Calls_History","Appointments_History"];if(W.parentid&&(W.btn_name="openActivities",W.outer_selector="openActivities_customize_outer",te&&0!==te.length&&te.getData().data.forEach((function(e){!je.contains(e.module)||K[e.module]||void 0!==z[e.module]&&void 0===z[e.module].data||(K[e.module]=e)})),K.Tasks&&W.data.push(K.Tasks),K.Events&&W.data.push(K.Events),K.Calls&&W.data.push(K.Calls),K.Appointments&&W.data.push(K.Appointments),W.outer_selector="openActivities_customize_outer",te&&0!==te.length?te.setData("data",W.data):0===te.length&&Lyte.Component.render("crm-activity-rel-customize",W,ie)),Z.parentid&&(Z.btn_name="closedActivities",Z.outer_selector="closedActivities_customize_outer",ae&&0!==ae.length&&ae.getData().data.forEach((function(e){!He.contains(e.module+"_History")||K[e.module+"_History"]||void 0!==q[e.module]&&void 0===q[e.module].data||(K[e.module+"_History"]=e)})),K.Tasks_History&&Z.data.push(K.Tasks_History),K.Events_History&&Z.data.push(K.Events_History),K.Calls_History&&Z.data.push(K.Calls_History),K.Appointments_History&&Z.data.push(K.Appointments_History),Z.outer_selector="closedActivities_customize_outer",ae&&0!==ae.length?ae.setData("data",Z.data):0===ae.length&&Lyte.Component.render("crm-activity-rel-customize",Z,ne)),crmRelatedList.renderSplitActivity(z,"activity_split_wrapper",i,re),crmRelatedList.renderSplitActivity(q,"activity_history_split_wrapper",i,se),detailView.isLeadOrContactPresent=!1,crmRelatedList.clearHiglihtData(),returnJson.isUIHidden&&2==businessCardJson.isApproved)for(var Ye=w.length,Je=0;Je<Ye;Je++){var ze=w[Je];if(null!=ze)$("#norec_"+ze).addClass("hide"),$("#ract_"+ze).addClass("hide"),$("#newleft_"+ze).find("#addNewIcP_"+M[Je].replace(/ /g,"\\ ")).hide()}if($L(".actColumnList").scroll({preventHorizontal:!0}),crmCommonModule.isApproved=businessCardJson.isApproved,"undefined"!=typeof businessCardJson&&(7==businessCardJson.isApproved||8==businessCardJson.isApproved||10==businessCardJson.isApproved||12==businessCardJson.isApproved||13==businessCardJson.isApproved)){Ye=f.length;E&&$("#noTicket_newTicketLink").hide();for(Je=0;Je<Ye;Je++){var qe=f[Je];if(null!=qe)$("#norec_"+qe).addClass("hide"),$("#ract_"+qe).addClass("hide"),$("#newleft_"+qe).find("#addNewIcP_"+C[Je].replace(/ /g,"\\ ")).hide()}$("#newRelatedListDiv").hide()}var Ge=$("#accountId"),We=$("#Potential_accountId"),Ze=$("#fullname"),Qe=$("#entityName"),Ke=$("#emailId"),Xe=$("#zmailEmail");Ge&&We&&We.val(Ge.val()),Qe&&Ze&&Ze.val(Qe.val()),Ke&&Xe&&Ke.val(Xe.val());var et=""+I+O+0+N+P+k+F;if(et.indexOf("1")>-1){var tt=detailView.changedBCJson.hidden.cvid;getIntegList(et,y,crmRelatedList.EntityId,R,crmRelatedList.Module,tt||getObj("cvid").value,T,b,1,D,crmRelatedList.EntityId,S,L,A,"true","active",x,_)}if(Crm.userDetails.permissions.Crm_Implied_LinkedIn_Sales_Navigator_Integration&&(Crm.userDetails.detailView_newUI?networkUtils.loadFeatureScripts(["zcrm4.js","zcrm_detailviewNew.js"],(function(){SalesNavigator.loadSalesNavigator()})):networkUtils.loadFeatureScripts(["zcrm4.js","zcrm_detailviewOld.js"],(function(){SalesNavigator.loadSalesNavigator()}))),U){var at=!1,it=[];if($.each(V.accounts,(function(e,t){"twitter"===t.network&&t.status<=1&&t.perm_type<=3&&it.push(t.id)})),void 0!==V&&void 0!==V.accounts&&V.accounts.length>0){var nt=void 0!==V.SOCIALPROFILES?V.SOCIALPROFILES.twitter:"";nt=(nt=void 0===nt?"":nt).trim(),it.length>0&&null!==nt&&""!==nt&&void 0!==nt&&(at=!0)}crmRelatedList.new_social=V.new_social,V.new_social?networkUtils.loadFeatureScripts(["zcrm_zsoInteg.js",networkUtils.getI18nJSUrl("social")],(function(){at&&(crmSocialInteg.processPersonalAccounts(void 0,V,!0),crmSocialInteg.showDMSection(it),crmSocialInteg.showTweetSection()),crmSocialInteg.brand_vs_connection_obj=V.SOCIALPROFILES_BY_BRANDS,crmSocialInteg.twitterIds=it,crmSocialInteraction.fetchSocialRelatedList(V)})):networkUtils.loadFeatureScripts(["zohocrm_zsocial.js","zohocrm_zsocialinteg.js",networkUtils.getI18nJSUrl("social")],(function(){at&&(crmSocialInteg.processPersonalAccounts(void 0,V,!0),crmSocialInteg.showDMSection(it),crmSocialInteg.showTweetSection()),crmSocialInteg.twitterIds=it,crmSocialInteraction.fetchSocialRelatedList(V)}))}var rt=!1;if(a.notes&&a.isNotesRLPresent){Notes.registerPartial();var st=Handlebars.templates.CrmNotes_DetailsPage;Notes.addNotesClass(a.notes),$("#relNotesInRL").html(st(a.notes)),setTimeout((function(){"undefined"!=typeof Notes&&"function"==typeof Notes.callLeafletForVisibleNotes&&Notes.callLeafletForVisibleNotes()}),1e3),$("a.imageGallery").colorbox({photo:!0}),rt=!0,Notes&&""!=Notes.noteInEditMode&&(Notes.noteInEditMode="")}if(transferRelatedDetails(rt,a.isNotesRLPresent),placeExtra(),fetchCustomRelatedList(),"navigate_next_rellist"!==n&&"navigate_previous_rellist"!==n&&(1===J?populateRLCount(oe.listRelationId):populateRLCount()),"undefined"!=typeof Crm){var ot=document.location.href;if(ot.indexOf("#")>-1){var lt=ot.substr(ot.indexOf("#")+1,ot.length);Crm.scrollToElem=lt}Crm.scrollPage(),Crm.bindEventForUserBCView()}}},renderSplitActivity:function(e,t,a,i){try{if(e.Events||e.Tasks||e.Calls||e.Appointments){var n,r=$L("#"+(t+" crm-activity-rel-wrapper"))[0],s=[],o={},l={},d=80;if(i&&(n=i.parent().parent()),r){for(var c=!1,m=0,u=r.getData("subModuleData"),v=0;v<=3;v++)if(u[v]){m++;var p=u[v].module;if(e[p]){e[p].data&&(c=c||!0),Lyte.Component.set(u[v],"headings",e[p].headings);var h=e[p].fields&&e[p].fields.fields?e[p].fields.fields:void 0;if(h){for(var g={fields:h.removeArrayElements(["Subject","Event_Title","Appointment_Name","Due_Date","Owner","Start_DateTime","End_DateTime","All_day","Call_Start_Time","Appointment_Start_Time","Member","_bindings"])},C=(l=e[p].headings,{}),f=l.length,E=0;E<f;E++){var I=l[E].api_name;h.contains(I)&&(C[I]=l[E])}var y=void 0===u[v].fieldsforrel?{}:u[v].fieldsforrel;y[e[p].personality]=C,Lyte.Component.set(u[v],"fieldsforrel",y),Lyte.Component.set(u[v],"personality",e[p].personality),Lyte.Component.set(u[v],"fields",g)}Lyte.Component.set(u[v],"data",u[v].data&&a?u[v].data.concat(e[p].data):e[p].data),Lyte.Component.set(u[v],"info",e[p].info),u[v].info=e[p].info}else u[v].data&&u[v].data.length>0&&(c=!0)}c&&m<=2&&i&&(n.addClass(m>1?"doubleAct_list":"singleAct_list"),d=1==m?152:d),!c&&i&&n.removeClass("singleAct_list doubleAct_list"),r.setData("showBlankState",!c),r.setData("txt_ln",d)}else{e.Tasks&&s.push(e.Tasks),e.Events&&s.push(e.Events),e.Calls&&s.push(e.Calls),e.Appointments&&s.push(e.Appointments);var R=crmRelatedList.isActDataPresent(e);R&&s.length<=2&&i&&(n.addClass(s.length>1?"doubleAct_list":"singleAct_list"),d=1==s.length?152:d),o={subModuleData:s,parent_relation_name:t.indexOf("history")>-1?"Activities_History":"Activities",showBlankState:!R,txt_ln:d},$L("#"+t).length&&Lyte.Component.render("crm-activity-rel-wrapper",o,"#"+t)}var b=m>0?m:s.length;if(b>2){var T=$L("#newLeftPanel").width(),D=(window.innerWidth-T-61)/b;if(4===b){var w=.26*D;0===T&&(w=.05*D),D+=w}$L("crm-activity-rel-list").css("width",D)}}}catch(e){murphy.error(e)}},validateLimit:function(e,t){if(t=void 0===t?e.parentElement.parentElement.parentElement.parentElement.id.split("_")[1]:t,Crm.isActivitySplitDone&&!crmRelatedList.isNotActivitySubPersonality(t,"Services"===getObj("module").value||void 0)){var a=$("#relatedListCols_"+t),i=void 0!==e?e.parentElement:a[0],n=[],r="#relateList_"+(void 0!==e?$(i)[0].id.split("_")[1]:a.find("ul")[0].id.split("_")[1]);$(r+" input[type='checkbox']:checked").each((function(e,t){n.push($(t).val())}));var s=crmRelatedList.mandFields[t]+5,o=a.find(".columnListBtn"),l=a.find("#customize_error");if(n.length>=s){var d=a.width()-38;l.css("width",d+"px"),l.show(),o.addClass("actColumnsDiv");var c=$("#"+i.id).find(".ccNotSelected");c.addClass("disableColumns"),c.removeClass("enableColumns"),$(r+" input[type='checkbox']:checked").each((function(e,t){var a=$(t.parentElement.parentElement);a.addClass("enableColumns"),a.removeClass("disableColumns")})),$(".disableColumns input[type='checkbox']").attr("disabled","disabled"),$("#currentRL").find(".ddMenus.boxShadowMask").find("#menuColumnListView").removeClass("oH pR").addClass("oA").css({"max-height":renderingUtils.windowOuterHeight/3-50})}else{o.removeClass("actColumnsDiv"),l.hide(),$(".disableColumns input[type='checkbox']").removeAttr("disabled","");var m=$("#"+i.id).find(".ccNotSelected");m.removeClass("disableColumns"),m.addClass("enableColumns")}}},restrictMandatorySortable:function(e){if(Crm.isActivitySplitDone&&!crmRelatedList.isNotActivitySubPersonality(e,"Services"===getObj("module").value||void 0)){var t="#relatedListCols_"+e+" .sortable ";$(t+"input[type='checkbox']:disabled").each((function(e,t){$(t.parentElement.parentElement).addClass("actMandColUnSort")})),$(t).sortable({placeholder:"ui-state-highlight",items:"li:not(.actMandColUnSort)"})}},renderScoringRelList:function(e,t,a){var i=networkUtils.returnDependencyFiles(["scoring_entityscore.js","scoringrules_store.js"],crmConstants.jsStaticPathForLyte);i=(i=(i=i.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("scoringRulesChart")]))).concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles()))).concat(networkUtils.returnDependencyFiles(["scoring_entityscore.css"],crmConstants.cssStaticPathForLyte));var n=document.querySelector("crm-entityscores-view");null===n&&void 0===a?Lyte.injectResources(i,void 0,(function(){Lyte.Component.render("crm-entityscores-view",e,"#scorigRulesTable"),t&&t()})):a?Lyte.injectResources(i,void 0,(function(){Lyte.Component.render("crm-entityscores-view",e,"#scorigRuleTable"),t&&t()})):(n.component.setData(e),t&&t())},isNotActivitySubPersonality:function(e,t){return!(Crm.isActivitySplitDone&&("TASKSHISTORYPERSONALITY"===e||"CALLSHISTORYPERSONALITY"===e||"EVENTSHISTORYPERSONALITY"===e||"TASKSPERSONALITY"===e||"EVENTSPERSONALITY"===e||"CALLSPERSONALITY"===e||"APPOINTMENTSPERSONALITY"===e||"APPOINTMENTSHISTORYPERSONALITY"===e)&&!t)},isActDataPresent:function(e){return!!(e.Calls&&e.Calls.data||e.Events&&e.Events.data||e.Tasks&&e.Tasks.data||e.Appointments&&e.Appointments.data)},clearHiglihtData:function(){0===$("#fieldHighlightId").length&&void 0!==detailView.oldfieldUpdateJson&&detailView.oldfieldUpdateJson.length>0&&(detailView.oldfieldUpdateJson={})},loadSegmentationInfo:function(e,t){store.findRecord("rfm_entity",e,null,null,null,t).then((function(e){e&&e[0]&&((e=e[0]).$.set("module",t),Lyte.Component.render("related-list-segment",e,"#segmentation"),document.getElementById("segmentation").style.display="block")}))},mOverEv:function(e){var t=$(e);$("#rlDropDown_"+t.attr("ddid")).css("visibility","visible"),$("#"+t.attr("ddname")+"_"+t.attr("ddid")).css("visibility","visible")},mOutEv:function(e){var t=$(e);1!=Crm.userDetails.detailView_newUI&&("newRlEdit"==$("#rlDropDown_"+t.attr("ddid")).attr("class")&&$("#rlDropDown_"+t.attr("ddid")).css("visibility","hidden"),"newRlEdit"==$("#"+t.attr("ddname")+"_"+t.attr("ddid")).attr("class")&&$("#"+t.attr("ddname")+"_"+t.attr("ddid")).css("visibility","hidden"))},attachmentsDropView:function(e,t){e.find("[name=rellistrow]").each((function(){$(this).on("mouseenter",(function(){$(this).find(".relatedlist_dropIcon").css("visibility","visible")})),$(this).on("mouseleave",(function(){$(this).find(".relatedlist_dropIcon").css("visibility","hidden")}))}));for(var a=e.find("[name=rellistrow]"),i=a.length,n=0,r=i;n<r;n++){var s=$(a[n]);t.body[n].deleteElement=$(s.find("[id=deletelink]")).prop("outerHTML"),s.find("[id=div"+t.body[n].ENTITYID+"]").remove(),t.body[n].downloadElement=$(s.find("[id=downloadlink]")).prop("outerHTML"),s.find("[name=downloadcontainer]").remove()}var o=function(t){var a=function(e,t,a,i){return function(n){openSheetForExport(Crm.getCrmBasePath()+"/specific/ViewAttachment?fileId="+(i||e.body[t].FILEID)+"&module="+encodeURIComponent(crmRelatedList.Module)+"&parentId="+e.body[t].ParentId+"&creatorId="+e.body[t].CreaterId+"&id="+e.body[t].ENTITYID+"&name="+encodeURIComponent(a)+"&downLoadMode=pdfViewPlugin","pdfViewPlugin"),sE(n)}},i=function(e,t,a,i,n){return function(r){openSheetForExport(Crm.getCrmBasePath()+"/specific/ViewAttachment?fileId="+(n||e.body[t].FILEID)+"&module="+encodeURIComponent(crmRelatedList.Module)+"&parentId="+e.body[t].ParentId+"&creatorId="+e.body[t].CreaterId+"&id="+e.body[t].ENTITYID+"&name="+encodeURIComponent(a)+"&downLoadMode="+i),sE(r)}},n=function(e,t){return function(){$("#relatedList_"+e.body[t].ENTITYID).trigger("click")}},r=function(e,t,a){return function(i){triggerLinkDocsView(Crm.getCrmBasePath()+"/specific/ViewAttachment?fileId="+e.body[t].ZDOCS_FILEID+"&module="+encodeURIComponent(crmRelatedList.Module)+"&parentId="+e.body[t].ParentId+"&creatorId="+e.body[t].CreaterId+"&id="+e.body[t].ENTITYID+"&name="+encodeURIComponent(a)+"&linkDocs=true",e.body[t].attachExt),sE(i)}},s=function(e,t,a){return function(i){crmRelatedList.openLinkAndTitleChange(Crm.getCrmBasePath()+"/specific/ViewAttachment?module="+encodeURIComponent(crmRelatedList.Module)+"&id="+e.body[t].ENTITYID+"&name="+encodeURIComponent(a)+"&linkURL="+encodeURIComponent(e.body[t].linkURL),e.body[t].linkURL,this),sE(i)}},o=function(e,t,a){return function(i){var n=networkUtils.returnDependencyFiles(["editlinkurl.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles(["mailmerge.css"],crmConstants.cssStaticPathForLyte),s=n.concat(r);Lyte.injectResources(s,void 0,(function(){Lyte.Component.render("crm-linkattachment",{linkUrl:e.body[t].linkURL,filename:a,module:crmRelatedList.Module,record:crmRelatedList.EntityId,header:I18n.getMsg("crm.customlink.editlink"),method:"edit",isEdit:!0,attachmentId:e.body[t].ENTITYID},"#show"),document.getElementById("showLinkUrlPop").ltProp("show",!0)})),sE(i)}},l=function(e,t){return function(){if($("[id=attachdropdownarrow"+e.body[t].ENTITYID+"]").css("visibility","visible"),$("[id=attachdropdown"+e.body[t].ENTITYID+"]").removeAttr("style"),Crm.userDetails.detailView_newUI){var a=$("[id=attachdropdownarrow"+e.body[t].ENTITYID+"]").parent("td").outerHeight(),i=$("[id=attachdropdown"+e.body[t].ENTITYID+"]").parent().outerHeight();i>a&&$(".attachDropMenuContainer").css("top","-"+i/2+"px")}}},d=function(e,t){return function(){$("[id=attachdropdownarrow"+e.body[t].ENTITYID+"]").css("visibility","hidden"),$("[id="+e.body[t].ENTITYID+"]").find(".relatedlist_dropIcon").css("visibility","hidden");for(var a=function(){showPlayIcon(this)},i=function(){hidePlayIcon(this)},n=function(){$(this).find(".relatedlist_dropIcon").css("visibility","visible")},r=function(){$(this).find(".relatedlist_dropIcon").css("visibility","hidden")},s=0,o=e.body.length;s<o;s++){var l=$("[id="+e.body[s].ENTITYID+"]");hidePlayIcon(l.find(".atchName").parent("td")),l.find(".atchName").parent("td").on("mouseenter",a),l.find(".atchName").parent("td").on("mouseleave",i),l.on("mouseenter",n),l.on("mouseleave",r)}for(var d=$("[id=attachdropdown"+e.body[t].ENTITYID+"]");d&&d.contents()[0];)$(d.contents()[0]).off(),$(d.contents()[0]).remove();d&&d.off()}};return function(c){for(var m=t.body.length,u=0,v=m;u<v;u++){var p=$("[id="+t.body[u].ENTITYID+"]");p.off("mouseenter"),p.off("mouseleave"),p.find(".atchName").parent("td").off("mouseenter"),p.find(".atchName").parent("td").off("mouseleave")}var h=0;for(v=m;h<v;h++)if($(this).parent().parent().attr("id")===t.body[h].ENTITYID){var g=null;if(t.body[h].ENTITYID&&(g=e.find("[id="+t.body[h].ENTITYID+"]")),g){var C=t.body[h].deleteElement&&$($(t.body[h].deleteElement.trim())[0]),f=t.body[h].downloadElement&&$($(t.body[h].downloadElement.trim())[0]);C&&C.removeClass(),f&&f.removeClass(),C&&C.addClass("attachDropMenuRow"),f&&f.addClass("attachDropMenuRow");var E=null,I=!1,y=I18n.getMsg("crm.view.attachment.download"),R=I18n.getMsg("crm.label.view"),b=I18n.getMsg("crm.label.delete");C&&C.append(b),f&&f.append(y);var T=t.body[h].CONTENT[0],D=T.length,w=T.lastIndexOf("."),M="";0!=D&&w>-1&&(M=(M=T.substring(w+1,D)).toLowerCase());var S=t.body[h].extn;S||(S="file");var L=t.body[h].mode,A=t.body[h].isPreviewAvailable;void 0===A&&(A=!0);var _=t.body[h].isLinkDocs,O=$("<a></a>"),N=null;null!=_&&0==_?"pdf"==M&&A?(O.attr("id","relatedList_"+t.body[h].ENTITYID),O.click(a(t,h,T)),O.append(R)):""!=L&&A?(O.attr("id","relatedList_"+t.body[h].ENTITYID),O.click(i(t,h,T,L)),O.append(R)):"png"==S&&A&&(O.attr("id","relatedList_"+t.body[h].ENTITYID),O.attr("href",Crm.getCrmBasePath()+"/ViewImage?fileId="+t.body[h].FILEID+"&module="+encodeURIComponent(crmRelatedList.Module)+"&parentId="+t.body[h].ParentId+"&creatorId="+t.body[h].CreaterId+"&id="+t.body[h].ENTITYID+"&name="+encodeURIComponent(T)+"&downLoadMode=default"),O.addClass("cboxElement"),O.click((function(){showImagePreview(this)})),O.append(R)):null!=_&&1==_&&A?"png"==S?(O.click(n(t,h)),O.append(R)):"pdf"!=M&&""==L||!A||(O.attr("id","relatedList_"+t.body[h].ENTITYID),O.click(r(t,h,T)),O.append(R)):null==_||2!=_&&3!=_||(O.attr("id","relatedList_"+t.body[h].ENTITYID),O.attr("target","_blank"),O.click(s(t,h,T)),O.append(R),(N=O.clone()).attr("id","edit"),N.click(o(t,h,T)),N.text(""),N.append(I18n.getMsg("crm.button.edit")),N.addClass("attachDropMenuRow"),Crm.userDetails.permissions.hasOwnProperty("Crm_Implied_Create_Attachments")&&(I=!0)),t.body[h].isPreviewAvailable&&O&&O.contents()[0]&&(E=O,$(E).addClass("attachDropMenuRow"));for(var P=g.find("[id=attachdropdown"+t.body[h].ENTITYID+"]");P.contents()[0];)P.contents()[0].remove();E&&P.append(E),I&&P.append(N),f&&P.append(f),C&&P.append(C);var k={};k.id="attachdropdown"+t.body[h].ENTITYID,k.clickSelector="a",Crm.menu.createMenu(c,k),P.on("onBeforeShow",l(t,h)),P.on("onBeforeClose",d(t,h))}}}};for(n=0,r=i;n<r;n++){(s=$($(a[n]).find(".relatedlist_dropIcon"))).click(o(t))}return e},navigate:function(e,t){var a=(t=$(t)).attr("data-cid"),i={};t&&(i=JSON.parse(t.attr("data-params")));var n={};n.id=crmRelatedList.EntityId,n.module=crmRelatedList.Module,n.rid=i.rid,n.isSortRequest=!1,"navigate_next_rellist"===a?n.fromIndex=parseInt(i.fromIndex)+10:"navigate_previous_rellist"===a&&(n.fromIndex=parseInt(i.fromIndex)-10),crmRelatedList.ajaxReq(n,a)},ajaxReq:function(e,t,a){var i=new crmRequestPool;crmRelatedList.addFiltersParam(e),i.initiate({action:Crm.getCrmBasePath()+"/NewRelatedList.do?action=getData",type:"GET",data:e,success:function(i){if(crmRelatedList.load(e.module,e.id,i,a,t),i&&i[e.module]&&i[e.module][e.rid]){var n=i[e.module][e.rid];n.isLinkingModule&&!1===e.isSortRequest&&multiLookupsView.updateMXNFieldValue(void 0,n.listRelationId,n.defaultvalue)}if(crmRelatedList.populateFilterValues(e.rid),Crm.userDetails.detailView_newUI){$L("#RelatedListCommonDiv #RelatedListDataScrollInteg,#RelatedListCommonDiv #RelatedListDataScroll,#RelatedListCommonDiv #ticketsDropDiv").scroll({preventVertical:!0});var r=$L.debounce(detailView.detailViewRelatedListDataScrollHandler,1);$("#RelatedListCommonDiv .lyteScrollBar").off("scroll",r).on("scroll",r)}}})},sortColumn:function(e,t){var a=JSON.parse($(t).attr("data-params")),i=$(t).attr("data-enc"),n=a.fieldLabel,r=!(void 0!==i&&(!0===i||"true"===i)),s=a.fieldId;""==s&&(s=n,a.fieldId=n);for(var o,l=crmRelatedList.getSetSinglePersonalityData(a.rid,"get"),d=l.sortColumnId,c=l.sortOrderString,m="",u=l.heading.length,v=0;v<u;v++)if(l.heading[v].FIELDID==d||""==l.heading[v].FIELDID&&l.heading[v].FIELDLABEL==d){m=l.heading[v].FIELDLABEL,m=l.heading[v].COLUMNNAME==a.columnName?l.heading[v].FIELDLABEL:l.heading[v].FIELDID;break}"INVITEDEVENTSPERSONALITY"!=l.name?void 0!==r&&r&&crmRelatedList.showRelListSortDiv(a.fieldLabel,l.name.toLowerCase()+"_"+l.listRelationId,""==s?null:m,t,e,I18n.getMsg("crm.column.sort.asc"),I18n.getMsg("crm.column.sort.desc"),m,c,I18n.getMsg("crm.column.unsort"),!0,s):(o=s==d&&"sort_asc"==c?"Desc":"Asc",sortViewColumns($ESAPI.encoder().encodeForJavaScript(a.fieldLabel),l.name.toLowerCase()+"_"+l.listRelationId,$ESAPI.encoder().encodeForJavaScript(""==s?null:encodeURIComponent(m)),o,"false",!0,s));sE(e)},getPersonalityModuleObj:function(e){var t=crmRelatedList.EachModuleData;for(key in t)if(t.hasOwnProperty(key)&&key==e)return t[key]},getSetSinglePersonalityData:function(e,t,a){var i=crmRelatedList.EachModuleData;for(var n in i)if(i[n].listRelationId==e){if("get"==t)return i[n];i[n]=a}},getTaregetString:function(e){var t=crmRelatedList.getPersonalityModuleObj(e);return t?t.name.replace(/_/g,"$").toLowerCase()+"_"+t.listRelationId:""},toggle:function(e){var t=JSON.parse($(e.target).attr("data-params")).rid;$("div[data-rnode='"+t+"']").toggleClass("listHide")},checkBodyContent:function(e){return 0!=crmRelatedList.getSetSinglePersonalityData(e,"get").body.length},createEditLink:function(e,t,a,i){var n=crmRelatedList.Module,r=crmRelatedList.EntityId,s=Crm.getCrmBasePath()+"/EditEntity.do?module="+encodeURIComponent(e)+"&id="+t+"&returnAnchor="+a+"&editprimmodule="+(null==n?null:encodeURIComponent(n))+"&parenteditentityid="+r;return null!=i&&(s=s+"&recordNum="+(null==i?null:encodeURIComponent(i))),s},createDeleteLink:function(e,t,a,i,n,r,s){var o=crmRelatedList.Module,l=crmRelatedList.EntityId,d=Crm.getCrmBasePath()+"/MassDelete.do?module="+encodeURIComponent(e)+"&id="+t+"&actModule="+(null==o?null:encodeURIComponent(o))+"&actId="+l+"&nextStep=relatedlist";return i&&(d=d+"&tomodule="+encodeURIComponent(r)),null!=n&&(d=d+"&isCustLukup="+n),d=d+"&isajax=true#"+a},createRemoveEntityFromEventLink:function(e,t,a,i,n){void 0===i&&(i=crmRelatedList.Module),void 0===n&&(n=crmRelatedList.EntityId);var r=Crm.getCrmBasePath()+"/RemoveInvitees.do?action=removeEntity&module="+encodeURIComponent(e)+"&id="+t+"&actModule="+(null==i?null:encodeURIComponent(i))+"&actId="+n+"&fromSrc=rl&isajax=true";return void 0!==a&&(r=r+"#"+a),r},createStatusChangeLink:function(e,t,a,i){var n=crmRelatedList.Module,r=crmRelatedList.EntityId,s=crmRelatedList.getSetSinglePersonalityData(e,"get"),o=s.sortColumnId,l=s.sortOrderString;return Crm.getCrmBasePath()+"/CampaignStatusChange.do?module="+encodeURIComponent(t)+"&id="+a+"&parentModule="+(null==n?null:encodeURIComponent(n))+"&action=showStatus&parentId="+r+"&isajax=true&returnAnchor="+i+"&sortColumnString_"+e+"="+(null==o?null:encodeURIComponent(o))+"&sortOrderString_"+e+"="+(null==o?null:encodeURIComponent(l))+"&listRelationID="+e},createCloseLink:function(e,t){var a=crmRelatedList.Module;return Crm.getCrmBasePath()+"/closeTask.do?action=CloseTask&taskid="+e+"&&module="+(null==a?null:encodeURIComponent(a))+"&id="+crmRelatedList.EntityId+"&nextStep=relatedlist&isajax=true#"+t},creareEditLinkForProducts:function(e,t,a,i,n,r){var s=crmRelatedList.Module;return Crm.getCrmBasePath()+"/ShowMultiValuesForAdd.do?moduleid="+crmRelatedList.EntityId+"&rid="+e+"&pname="+t+"&returnAnchor="+a+"&tomodule="+encodeURIComponent(r)+"&Edit=true&othermoduleid="+i+"&frommodule="+(null==s?null:encodeURIComponent(s))},createRemoveLinkForContactRole:function(e,t,a){var i="";return null!=e&&(i=i+"&whoId="+e),null!=t&&(i=i+"&whatId="+t),Crm.getCrmBasePath()+"/potentials/deleteContPotRel.do?module=Potentials"+i+"&nextStep=relatedlist&isajax=true#"+a},bindFileUploaderForRelatedListAttachments:function(e){$(e.save).prop("disabled",!0);$(e.clickable).FileUploader({previewsContainer:e.container,createImageThumbnails:!1,needWMSFallback:!0,needVirusFilter:!0,clickable:e.clickable,previewTemplate:e.previewtemplate,uploadMethod:e.uploadmethod,maxFiles:e.uploadlimit,maxFilesize:e.uploadsizelimit,totalFilesize:e.uploadsizelimit,flexSize:e.uploadsizeflex,parallelUploads:e.parallelupload,progressRatio:e.progressratio,fileSizeBase:e.filesizebase,save:e.save,cancel:e.cancel,preventUploadObjDestroy:e.preventUploadObjDestroy,init:function(){var t=this;t.on("proceed",(function(t){if(t.preventDefault(),t.stopPropagation(),"proceed"===fileAttachSubmitIntercept("fileUpload",this)){var a,i=new FormData(document[e.mainform]);this.getIdsAsFormData("uploadId","uploadIds",i),loadAjaxTab(""),$.ajax({url:document[e.mainform].action,type:"POST",data:i,contentType:!1,processData:!1,success:(a=this,function(t){commonUtils.showHideLoadingDiv(),document.querySelector('crm-related-list-view-header[related-module="Attachments"]')?(Lyte.triggerEvent("relatedList",{module:"Attachments"}),refreshFollowDiv()):$(e.attachframe).contents().find("body").html(t),$(a.options.cancel).click()}),error:function(e){return function(){$(e.options.cancel).hide(),crmui.showMsgBand(e.options.messageType.error,I18n.getMsg("crm.fileuploader.message.uploadfailedretry"),"infinity"),$(e.options.cancel).click()}}(this)}),$(this.options.save).prop("disabled",!0)}})),t.on("error",(function(e){if(e.previewElement){if(e.virus){var t=$(e.previewElement).find(".virusAlert");t.css("display","inline-block");var a=t.parent()[0];a.addEventListener("mouseenter",(function(){crmui.showTooltip(I18n.getMsg("crm.fileuploader.ToolTip.virusdetected"))})),a.addEventListener("mouseleave",(function(){crmui.hideTooltip()}))}var i=e.previewElement.querySelector("[data-dz-errormessage]");i&&i.innerHTML.length>20&&$(i).attr("title",i.innerHTML)}})),t.on("customizepreviewtemplate",(function(e){if(e.previewElement){var t=e.previewElement.querySelector("[data-dz-name]"),a=e.name;a&&a.length>20&&$(t).attr("title",a);var i="";a&&""!==a&&-1!==a.lastIndexOf(".")&&(i=a.slice(a.lastIndexOf(".")+1)),(t=e.previewElement.querySelector(".dz-filename"))&&$(t).prepend(FileUploader.createElement('<span class="mR15 '+function(e){var t="file";if("txt"===e||"pdf"===e||"html"===e||"xml"===e)return e;var a={png:["jpeg","jpg","gif","png","webp","bmp","svg"],word:["doc","docx","odt","rtf"],excel:["csv","xls","xlsx","ods","xlsm","sxc","tsv"],ppt:["odp","pps","pot","pptx","ppt"],movie:["avi","wmv","mp4","mpeg","mpg","mov","flv","mkv","webm"],mp3:["mp3","ogg","oga","wma","m4p","m4a","au","3gp"],zip:["zip","zipx","tar","gz","z","cab","rar","bz2","lzh","7z","img","iso"]};for(var i in a)if(a.hasOwnProperty(i)){var n=a[i];if($.inArray(e,n)>=0){t=i;break}}return t}(i)+'-icon"></span>')),(t=e.previewElement.querySelector("[data-dz-size]"))&&(t.textContent="("+this.options.getFileSize(e.size)+")")}})),t.on("terminate",(function(){hideAnimatePopup(e.popupname),setTimeout((function(){$("#attachPopup").remove()}),100)}))},uploadBean:{crmHandback:{entityId:e.entityid,module:e.module,action:e.action},user:{zgid:e.zgid},uploadTo:e.resourcetype,folderId:e.workspace}})},attachDocs:function(){crmRelatedList.hideAttachDropList(),openZDocsLinkDialog(Crm.userDetails.ZGID)},attachFromTeamDrive:function(e,t){var a={WDDomainURL:httpprotocol+RebrandLinkUtil.getProperty("teamdriveURL"),primaryActionCallBack:crmRelatedList.addAttachmentsFromTeamDrive,countToSelectMaxFiles:10,width:"850px",height:"calc( "+renderingUtils.windowHeight+"px - 3rem - 20px )",disableFolderSelection:!1,canShare:!0,service:"ZohoCRM",showSearch:!0,zsoid:crmZgid},i={showshareDialog:!0,shareFields:{collaboratorShare:!1,teamShare:!0,orgShare:!1,externalShare:!0,linkOnly:!0},defaultShare:"teamShare",externalShareTag:"crm_team"};1==e?(a.countToSelectMaxFiles=t,a.handBackObj={fieldId:fileupload.fieldID},a.primaryActionCallBack=crmRelatedList.addAttachmentFieldFromTeamDrive,i={showshareDialog:!0,shareFields:{collaboratorShare:!1,teamShare:!0,orgShare:!1,externalShare:!0,linkOnly:!0},defaultShare:"teamShare",externalShareTag:"crm_team"},Crm.trackSpotLightAction("Workdrive Picker Click",{Place:"file upload field"})):Crm.trackSpotLightAction("Workdrive Picker Click",{Place:"related list"}),a.shareOptions=i;var n=RebrandLinkUtil.getProperty("TD_JS_STATIC_URL");Lyte.removeFromCache([n]),Lyte.injectResources([n],void 0,(function(){(new WorkDrive).showResourcePicker(a),crmRelatedList.hideAttachDropList()}))},attachFromCloudPicker:function(){var e={feature:"attachments",cloud_services:"gdrive,box,skydrive,dropbox,evernote",callback:crmRelatedList.addAttachmentsFromCloudPicker,max_file_selection:5},t=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("cloudpicker")]),a=networkUtils.returnDependencyFiles(["crmcloudpicker.js"],crmConstants.jsStaticPathForLyte),i=t.concat(a);Lyte.injectResources(i,void 0,(function(){Lyte.Component.render("crm-cloud-picker",{options:e,showCloudPicker:!0},"#show")}))},attachDesktop:function(){var e=$(event.target);1==Crm.userDetails.detailView_newUI&&detailView.btnAddClassSelected(e),showCustomizePopup("Attach",crmRelatedList.getTaregetString(e.attr("data-relid")),void 0,e.attr("data-fromsrc"))},attachZDocs:function(){crmRelatedList.hideAttachDropList(),openForDocs("zdoc",RebrandLinkUtil.properties.docsURL)},attachGDocs:function(e){crmRelatedList.hideAttachDropList();var t=window.location.hostname;t==RebrandLinkUtil.properties.CRMURL?openForDocs("gdoc",RebrandLinkUtil.properties.GadGetsURL,RebrandLinkUtil.properties.CRMURL,e):openForDocs("gdoc",RebrandLinkUtil.properties.GadGetsURL,t,e)},attachLink:function(){if(crmRelatedList.hideAttachDropList(),$("#multipleFieldsEditPop").is(":visible")){var e=Handlebars.templates.LinkAttachPopUp();$("#topBandPopup").html(e),showAnimatePopup("topBandPopup"),setTimeout((function(){$("#attachmentUrl").focus()}),100)}else{var t=networkUtils.returnDependencyFiles(["editlinkurl.js"],["editlinkurl.js"],crmConstants.jsStaticPathForLyte),a=networkUtils.returnDependencyFiles(["linkattachment.css"],["linkattachment.css"],crmConstants.cssStaticPathForLyte),i=t.concat(a);Lyte.injectResources(i,void 0,(function(){Lyte.Component.render("crm-linkattachment",{module:crmRelatedList.Module,record:crmRelatedList.EntityId,header:I18n.getMsg("crm.attach.link.from.url")},"#show"),document.getElementById("showLinkUrlPop").ltProp("show",!0)}))}},hideAttachDropList:function(){$(".atch-droplist").hide(0)},addNew:function(e,t){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var a=crmRelatedList.getPersonalityModuleObj($(e.target).attr("data-relid")),i={module:a.module,primid:crmRelatedList.EntityId,primmodule:encodeURIComponent(crmRelatedList.Module),returnAnchor:a.name.toLowerCase()+"_"+a.listRelationId,listRelationId:a.listRelationId,fillUpModule:encodeURIComponent(crmRelatedList.Module),entityid:crmRelatedList.EntityId,relmodule:encodeURIComponent(crmRelatedList.Module),entityname:$("#entityName").val()};if("REPORTINGCONTACTSPERSONALITY"===a.name){var n=$("#subvalue_ACCOUNTID");if(!n[0]||n[0]&&""===n[0].text){var r=Crm.moduleInfo.ContactstranslatedSingularLabel,s=Crm.moduleInfo.Accounts.translatedSingularLabel;return void crmui.showMsgBand("error",I18n.getMsg("crm.contact.hierarchy.new_reporting_contact_error",[r,s]),"7000")}}"true"!=i.isCustLookup&&("Accounts"==i.relmodule||"Contacts"==i.relmodule?i.fillUpFieldId=getObj("id").value:getObj("accountId")&&(i.fillUpFieldId=getObj("accountId").value)),Lyte.Router.transitionTo({route:"crm.tab.module.create",dynamicParams:[a.module]}).data=i}},addProducts:function(e){var t=crmRelatedList.getPersonalityModuleObj($(e.target).attr("data-relid")),a=t.name.toLowerCase()+"_"+t.listRelationId;addMultiValue(crmRelatedList.EntityId,encodeURIComponent(crmRelatedList.Module),encodeURIComponent(t.module),a,void 0,void 0,t.listRelationId),1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&detailView.btnAddClassSelected($(e.target))},addPotentialsProducts:function(e){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var t=crmRelatedList.getPersonalityModuleObj($(e.target).attr("data-relid")),a=t.name.toLowerCase()+"_"+t.listRelationId,i=$("#parentCurrencyISOCode").val(),n=$("#parentExchangeRate").val();addMultiValue(crmRelatedList.EntityId,encodeURIComponent(crmRelatedList.Module),encodeURIComponent(t.module),a,i,n,t.listRelationId)}},importListPrice:function(e,t){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var a=crmRelatedList.getPersonalityModuleObj($(e.target).attr("data-relid")),i={module:encodeURIComponent(a.module),priceBookId:crmRelatedList.EntityId,step:"1"};$(t).attr("data-params",JSON.stringify(i)),Lyte.Router.transitionTo({route:"crm.settings.import",queryParams:i}).data={itsRelatedModule:"true",currStep:"sourceType",parentModule:encodeURIComponent(crmRelatedList.Module),parentId:crmRelatedList.EntityId}}},editProducts:function(e){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var t=crmRelatedList.getPersonalityModuleObj($(e.target).attr("data-relid"));editAllValues(crmRelatedList.EntityId,encodeURIComponent(crmRelatedList.Module),encodeURIComponent(t.module),void 0,void 0,t.listRelationId,t.name)}},newTask:function(e,t){Crm.userDetails.isStorageLimitReached?Crm.showStorageExceedPopup():(selectAction("NewTask",crmRelatedList.getTaregetString($(e.target).attr("data-relid")),encodeURIComponent(crmRelatedList.Module),crmRelatedList.EntityId,t,e),1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&detailView.btnAddClassSelected(t))},newEvent:function(e,t){Events.globalCreate(e,"relatedlist_new",t),1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&detailView.btnAddClassSelected(t)},logCall:function(e,t){Crm.userDetails.isStorageLimitReached?Crm.showStorageExceedPopup():(isNewCallView?Crm.globalCreate(e,"relatedlist_new",t):selectAction("NewCall",crmRelatedList.getTaregetString($(e.target).attr("data-relid")),encodeURIComponent(crmRelatedList.Module),crmRelatedList.EntityId,t,e),1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&detailView.btnAddClassSelected(t))},newAppointment:function(e,t){Events.globalCreate("Appointments","relatedlist_new",t),!0===Crm.userDetails.detailView_newUI&&void 0!==Crm.userDetails.detailView_newUI&&detailView.btnAddClassSelected(t)},sendMailEvent:function(){var e=moduleRecordMapping[crmRelatedList.Module].singular_label;EntSendMail(encodeURIComponent(crmRelatedList.Module),crmRelatedList.EntityId,"",e)},associateMxN:function(e,t){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var a=crmRelatedList.getPersonalityModuleObj($(e.target).attr("data-relid")),i=JSON.parse('{"fldName":""}');i.fldName=a.mxnfieldid,i.relatedlist=!0,multiLookupsView.frameMLJSON(i);var n=multiLookupsView.getParamJson(i.fldName);n.entityId=crmRelatedList.EntityId,n.relatedlist=!0,n.searchmodule=a.searchmodule,Crm.trackSpotLightAction("Multi Select Lookup - Add Click",{Module:n.searchmodule}),n.select=!1,n.fldName=a.mxnfieldid,n.linkingmodule=a.module,n.relid=a.listRelationId,multiLookupsView.submitMultiLookupForm("addmore",Crm.getCrmBasePath()+"/Search.do","topBandPopup",n),1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&detailView.btnAddClassSelected(t)}},associateLookupRel:function(e){var t=crmRelatedList.getPersonalityModuleObj($(e.target).attr("data-relid"));if("REPORTINGCONTACTSPERSONALITY"===t.name){var a=$("#subvalue_ACCOUNTID");if(!a[0]||a[0]&&""===a[0].text){var i=Crm.moduleInfo.Contacts.translatedSingularLabel,n=Crm.moduleInfo.Accounts.translatedSingularLabel;return void crmui.showMsgBand("error",I18n.getMsg("crm.contact.hierarchy.assign_reporting_contact_error",[i,n]),"7000")}}var r=JSON.parse('{"fldName":""}');r.fldName=t.listRelationId,r.relatedlist=!0,r.lookuprel=!0,multiLookupsView.frameMLJSON(r);var s=multiLookupsView.getParamJson(r.fldName);s.entityId=crmRelatedList.EntityId,s.parentModule=crmRelatedList.Module,s.relatedlist=!0,s.searchmodule=t.module,s.lookuprel=!0,s.select=!1,s.linkingmodule=null,s.relid=t.listRelationId,multiLookupsView.submitMultiLookupForm("addmore",Crm.getCrmBasePath()+"/Search.do","topBandPopup",s),1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&detailView.btnAddClassSelected(e.target)},dissociateMxN:function(e,t){var a=crmRelatedList.getPersonalityModuleObj($(e.target).attr("data-relid")),i="{}";i.fldName=a.mxnfieldid,multiLookupsView.frameMLJSON(i);var n=multiLookupsView.getParamJson(i.fldName);n.entityId=crmRelatedList.EntityId,n.link="edit",n.relatedlist=!0,n.searchmodule=a.searchmodule,Crm.trackSpotLightAction("Multi Select Lookup - Edit Click",{Module:n.searchmodule}),n.select=!0,n.fldName=a.mxnfieldid,n.linkingmodule=a.module,n.relid=a.listRelationId,multiLookupsView.submitMultiLookupForm("addmore",Crm.getCrmBasePath()+"/Search.do","topBandPopup",n),1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&detailView.btnAddClassSelected(t)},editLookupRel:function(e){var t=crmRelatedList.getPersonalityModuleObj($(e.target).attr("data-relid")),a=JSON.parse('{"fldName":""}');a.fldName=t.listRelationId,a.relatedlist=!0,a.lookuprel=!0,multiLookupsView.frameMLJSON(a);var i=multiLookupsView.getParamJson(a.fldName);i.entityId=crmRelatedList.EntityId,i.parentModule=crmRelatedList.Module,i.link="edit",i.relatedlist=!0,i.mlaction="edit",i.searchmodule=t.module,Crm.trackSpotLightAction("Multi Select Lookup - Edit Click",{Module:i.searchmodule}),i.select=!0,i.linkingmodule=t.module,i.relid=t.listRelationId,multiLookupsView.submitMultiLookupForm("edit",Crm.getCrmBasePath()+"/Search.do","topBandPopup",i),1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&detailView.btnAddClassSelected(e.target)},newPotential:function(e,t){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var a=crmRelatedList.getPersonalityModuleObj($(e.target).attr("data-relid")),i="";"Accounts"==crmRelatedList.Module||"Contacts"==crmRelatedList.Module?i=getObj("id").value:getObj("accountId")&&(i=getObj("accountId").value);var n={module:encodeURIComponent(a.module),primid:crmRelatedList.EntityId,primmodule:encodeURIComponent(crmRelatedList.Module),returnAnchor:a.name.toLowerCase()+"_"+a.listRelationId,listRelationId:a.listRelationId,isCustLookup:!1,entityid:crmRelatedList.EntityId,fillUpModule:encodeURIComponent(crmRelatedList.Module),fillUpFieldId:encodeURIComponent(i),relmodule:encodeURIComponent(crmRelatedList.Module),entityname:$("#entityName").val()};Lyte.Router.transitionTo({route:"crm.tab.module.create",dynamicParams:[a.module]}).data=n,1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&detailView.btnAddClassSelected(t)}},newPotentialForContacts:function(e,t){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var a=crmRelatedList.getPersonalityModuleObj($(e.target).attr("data-relid")),i={module:encodeURIComponent(a.module),primid:crmRelatedList.EntityId,primmodule:encodeURIComponent(crmRelatedList.Module),returnAnchor:a.name.toLowerCase()+"_"+a.listRelationId,listRelationId:a.listRelationId,recordNum:$("#recordNum").val(),relmodule:encodeURIComponent(crmRelatedList.Module),fillUpModule:encodeURIComponent(crmRelatedList.Module),entityid:crmRelatedList.EntityId,relmodule:encodeURIComponent(crmRelatedList.Module),entityname:$("#entityName").val()};Lyte.Router.transitionTo({route:"crm.tab.module.create",dynamicParams:[a.module]}).data=i,1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&detailView.btnAddClassSelected(t)}},newCompetitor:function(e){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var t=crmRelatedList.getPersonalityModuleObj($(e.target).attr("data-relid"));selectAction("Competitor",crmRelatedList.getTaregetString($(e.target).attr("data-relid")),void 0,void 0,t.listRelationId,e)}},newProject:function(){selectAction("Project",crmRelatedList.getTaregetString($(event.target).attr("data-relid")),void 0,void 0,void 0,event)},newAssociateProject:function(){selectAction("Associate Project",crmRelatedList.getTaregetString($(event.target).attr("data-relid")),void 0,void 0,void 0,event)},importAction:function(e,t){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var a=crmRelatedList.getPersonalityModuleObj($(e.target).attr("data-relid")),i={module:encodeURIComponent(a.module),campaignId:crmRelatedList.EntityId,step:"1"};$(t).attr("data-params",JSON.stringify(i)),Lyte.Router.transitionTo({route:"crm.settings.import",queryParams:i}).data={itsRelatedModule:"true",dataScope:"myOrgData",currStep:"sourceType",parentModule:encodeURIComponent(crmRelatedList.Module),parentId:crmRelatedList.EntityId}}},updateCampaignStatus:function(e){var t=$(e.target).attr("data-relid");crmRelatedList.showCampaignStatusDiv(t)},importOrgAction:function(e,t){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var a=crmRelatedList.getPersonalityModuleObj($(e.target).attr("data-relid")),i={module:encodeURIComponent(a.module),campaignId:crmRelatedList.EntityId,dataScope:"myOrgData"};$(t).attr("data-params",JSON.stringify(i)),Lyte.Router.transitionTo({route:"crm.settings.import",queryParams:i}).data={currStep:"sourceType",parentId:crmRelatedList.EntityId}}},hideRLPersonality:function(e){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var t=crmRelatedList.getPersonalityModuleObj($(e.target.parentElement).attr("data-relid"));CustomRelatedListObj.doCustomRleatedList(t.name.toLowerCase()+"_"+t.listRelationId,"hide")}},reorderRLPersonality:function(e){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var t=crmRelatedList.getPersonalityModuleObj($(e.target.parentElement).attr("data-relid"));CustomRelatedListObj.doCustomRleatedList(t.name.toLowerCase()+"_"+t.listRelationId,"reorder")}},editRLPersonality:function(e){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var t=crmRelatedList.getPersonalityModuleObj($(e.target.parentElement).attr("data-relid"));CustomRelatedListObj.doCustomRleatedList(t.name.toLowerCase()+"_"+t.listRelationId,"edit")}},deleteRLPersonality:function(e){if(Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup();else{var t=crmRelatedList.getPersonalityModuleObj($(e.target.parentElement).attr("data-relid"));CustomRelatedListObj.doCustomRleatedList(t.name.toLowerCase()+"_"+t.listRelationId,"del")}},sendsurvey:function(e,t){var a=null,i={action:"surveyDetails",from:"sendsurvey",entityId:crmRelatedList.EntityId,module:crmRelatedList.Module};null!=$("#entIdForZMail")&&"null"!==$("#entIdForZMail").val()&&null!=$("#entIdForZMail").val()&&(a=$("#entIdForZMail").val(),i.entIdForZMail=a),$(t).attr("data-params",JSON.stringify(i)),ZSurvey.showSurveyDetails(t)},attendsurvey:function(e,t){var a=null,i={action:"surveyDetails",from:"attendsurvey",entityId:crmRelatedList.EntityId,module:crmRelatedList.Module};null!=$("#entIdForZMail")&&"null"!==$("#entIdForZMail").val()&&null!=$("#entIdForZMail").val()&&(a=$("#entIdForZMail").val(),i.entIdForZMail=a),$(t).attr("data-params",JSON.stringify(i)),ZSurvey.showSurveyDetails(t)},addDefaultRelatedList:function(e,t){var a=$("#id").val(),i=$("[name='module']").val();i||(i=detailView.currentModule);var n=Crm.getCrmBasePath()+"/CustomRelatedList.do?action=addUnselectedRelatedList&module="+i+"&listRelationId="+t+"&entityId="+a,r=csrfParamName+"="+encodeURIComponent(csrfToken);mR(n,(function(e){n=Crm.getCrmBasePath()+"/CustomizePage.do?module="+i+"&id="+t+"&entityid="+a+"&from=frmCustomRL",mR(n,(function(e){$("#topBandPopup").html(e),$("#DefaultRLSuccessMsg").html(I18n.getMsg("crm.newrelatedlist.label.releatedList.added")),mailsetCenter("DefaultRLSuccessMsg"),show("DefaultRLSuccessMsg"),setTimeout((function(){$("#DefaultRLSuccessMsg").hide()}),2e3),$("[name='rlContentChngd']").length>0&&$("[name='rlContentChngd']").val("true")}))}),r)},changePortal:function(e){var t=$(e),a=t.val();if(a!=t.attr("prevVal")){t.attr("prevVal",a);var i=JSON.parse(t.attr("data-params")),n={};n.id=crmRelatedList.EntityId,n.module=crmRelatedList.Module,n.rid=i.rid,n.isSortRequest=!1;var r=$("#portalRListSel option:selected").text();"All Portals"!=a?(n.portalName=r,n.allPortals=!1):n.allPortals=!0,crmRelatedList.ajaxReq(n)}},showatchPop:function(e,t){var a,i,n,r,s=$(e),o=$(".eventActionsMenu");i=s.offset().top+s.outerHeight(),renderingUtils.windowWidth,s.offset().left,s.outerWidth();var l=$("body").find("#bp-attachment");"none"==l.css("display")&&"bluePrint"==t&&(i=(r=s.parents(".attachmentsLabel")).offset().top+r.outerHeight(),a=r.offset().left,n=r.outerWidth(),l.css({top:i,position:"absolute",right:"initial","z-index":"29",left:a,display:"block",width:n}));s=$(e);$(o).is(":visible")&&1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&o.hide(),"none"==s.parent().children("ul").css("display")?s.parent().children("ul").stop().slideDown(200):s.parent().children("ul").stop().slideUp(0),1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&detailView.btnAddClassSelected($(e))},enableBtnAtc:function(e){""!=$(e).val()?$("#attachlinkbtn").prop("disabled",!1):$("#attachlinkbtn").prop("disabled",!0)},openLinkAndTitleChange:function(e,t,a){window.open(t).opener=null},addLink:function(e){var t=$("#attachmentUrl").val();if(t.length>3e3)return crmui.showMsgBand("error",I18n.getMsg("maxlenmsg"),"2500"),!1;if(!validationUtils.isValidWebUrl(t))return crmui.showMsgBand("error",I18n.getMsg("crm.custombutton.valid.url.check"),"2500"),!1;var a=Crm.getCrmBasePath()+"/fileattach.do";if(getElemById("attachTotCnt")&&(a+="?attachTotCnt="+getElemById("attachTotCnt").value),"proceed"!==fileAttachSubmitIntercept("attachLink"))return!1;var i={module:$("#module")[0].value,id:$("#id")[0].value,attachmentUrl:t};return networkUtils.makeRequest(a,"POST",{params:i,success_callback:function(t){if(!e)if("Link already exists"==t)crmui.showMsgBand("error",I18n.getMsg("crm.attach.link.exists"),"2500");else if("invalid_link"===t||""===t)crmui.showMsgBand("error",I18n.getMsg("crm.custombutton.valid.url.check"),"2500");else if(crmRelatedList.hideLinkPopup(),"canvas"==Lyte.Router.getRouteInstance().routeName&&"entity"==Lyte.Router.getRouteInstance().parent.routeName)Lyte.triggerEvent("relatedList",{res:t});else if(document.querySelector('crm-related-list-view-header[related-module="Attachments"]'))Lyte.triggerEvent("relatedList",{module:"Attachments"}),refreshFollowDiv();else if(getElemById("attachTotCnt")){var a=document.createElement("tempDivForAttLink");a.innerHTML=t;var i=getElemById("eventAttachmentDiv");i.appendChild(a),EvalInnerScript(a),i.removeChild(a),$("#eventsRightPanelAttachDiv").removeClass("noDataFountDetail"),$("#eventsAttachButtonDiv").parent("td").removeClass("noDataFountDetailtxt")}else crmRelatedList.load(crmRelatedList.Module,crmRelatedList.EntityId,t)}}),!1},addAttachmentsFromCloudPicker:function(e){var t=document.querySelector("crm-cloud-picker").component;t.hidePicker.call(t);var a=e,i=moduleApiMapping[detailView.currentModule],n="/crm/v2.2/"+i+"/"+detailView.entityId+"/Attachments",r=a.length;if(r>0){freezeBackground();var s={data:a},o={attachments:JSON.stringify(s)};"Events"===i?(o.id=detailView.entityId,o.module=i,o.attachTotCnt=$("#attachTotCnt").val(),n=Crm.getCrmBasePath()+"/fileattach.do",networkUtils.makeRequest(n,"POST",{params:o,success_callback:function(e){if(removeFreezeLayer(),document.querySelector('crm-related-list-view-header[related-module="Attachments"]')){if(e.startsWith("maxsizereached_")){var t=e.split("maxsizereached_")[1],a=I18n.getMsg("crm.attachment.error.upload",[t])+" "+I18n.getMsg("crm.attachment.max.size.reached",[10]);crmui.showMsgBand("error",a,1e4)}else if(e.startsWith("failure")){t=e.split("failure_")[1],a=I18n.getMsg("crm.attachment.error.upload",[t])+" "+I18n.getMsg("crm.tryagain.message");crmui.showMsgBand("error",a,1e4)}Lyte.triggerEvent("relatedList",{module:"Attachments"}),refreshFollowDiv()}else{var i=document.createElement("tempDivForAttLink");i.innerHTML=e;var n=getElemById("eventAttachmentDiv");n.appendChild(i),EvalInnerScript(i),n.removeChild(i)}}})):networkUtils.makeRequest(n,"POST",{params:o,success_callback:function(e){removeFreezeLayer(),crmRelatedList.processCloudPickerAttachmentsResponse(e),Crm.trackSpotLightAction("Cloudpicker Files Attached",{Place:"related list",Count:r});var t={id:detailView.entityId,module:detailView.currentModule,pname:"ATTACHMENTSPERSONALITY"};"canvas"==Lyte.Router.getRouteInstance().routeName&&"entity"==Lyte.Router.getRouteInstance().parent.routeName&&Lyte.triggerEvent("relatedList",{module:"Attachments"}),networkUtils.makeRequest(Crm.getCrmBasePath()+"/NewRelatedList.do?action=getData","GET",{params:t,success_callback:function(e){crmRelatedList.load(detailView.currentModule,detailView.entityId,e)}})}})}},processCloudPickerAttachmentsResponse:function(e){var t=e.data;if(t||"NO_PERMISSION"!==e.code){for(var a=t.length,i=0,n=!1,r=1024,s=0;s<a;s++){var o=t[s];if("SUCCESS"!==o.code&&(i++,"FILE_SIZE_EXCEEDS"===o.code)){n=!0;var l=o.details.size/1048576;r=Math.round(100*l)/100}}if(i>0){var d=I18n.getMsg("crm.attachment.error.upload",[i]);d+=n?" "+I18n.getMsg("crm.attachment.max.size.reached",[r]):" "+I18n.getMsg("crm.tryagain.message"),crmui.showMsgBand("error",d,1e4)}}else crmui.showMsgBand("error",I18n.getMsg("crm.security.error"),1e4)},addAttachmentsFromTeamDrive:function(e){var t=e.callbackDataFromWorkDrive,a=t.filesModel,i=t.permissionModel,n=moduleApiMapping[detailView&&detailView.currentModule?detailView.currentModule:$L("#module")[0].value],r="/crm/v2/"+n+"/"+detailView.entityId+"/Attachments",s=i.length;if(s>0){for(var o=[],l=0;l<s;l++){var d=i[l],c={$link_url:d.link,File_Name:d.fileName,$resource_id:a[l].id,$type:"teamdrive"};o.push(c);var m={data:o}}if("proceed"!==fileAttachSubmitIntercept("attachFromTeamDrive",o))return!1;"canvas"==Lyte.Router.getRouteInstance().routeName&&"entity"==Lyte.Router.getRouteInstance().parent.routeName&&Lyte.triggerEvent("relatedList",{module:"Attachments"});var u={attachments:JSON.stringify(m)};"Events"==n?(u.id=detailView.entityId,u.module=n,u.attachTotCnt=$("#attachTotCnt").val(),r=Crm.getCrmBasePath()+"/fileattach.do",networkUtils.makeRequest(r,"POST",{params:u,success_callback:function(e){if(document.querySelector('crm-related-list-view-header[related-module="Attachments"]'))Lyte.triggerEvent("relatedList",{module:"Attachments"}),refreshFollowDiv();else{var t=document.createElement("tempDivForAttLink");t.innerHTML=e;var a=getElemById("eventAttachmentDiv");a.appendChild(t),EvalInnerScript(t),a.removeChild(t)}}})):networkUtils.makeRequest(r,"POST",{params:u,success_callback:function(){Crm.trackSpotLightAction("Workdrive Files Attached",{Place:"related list",Count:s});var e={id:detailView.entityId,module:detailView.currentModule,pname:"ATTACHMENTSPERSONALITY"};networkUtils.makeRequest(Crm.getCrmBasePath()+"/NewRelatedList.do?action=getData","GET",{params:e,success_callback:function(e){Lyte.triggerEvent("relatedList",{module:"Attachments"}),crmRelatedList.load(detailView.currentModule,detailView.entityId,e)}})}})}return!1},addAttachmentFieldFromTeamDrive:function(e){var t=e.callbackDataFromWorkDrive,a={};a.resources=t.permissionModel;var i=t.handbackobj.fieldId;a.fieldId=i;var n=t.permissionModel,r=n.length;if(r>0){for(var s=[],o=0;o<r;o++){var l={$link_url:(e=n[o]).link,File_Name:e.fileName,$type:"teamdrive"};s.push(l);var d={data:s}}if("proceed"!==fileAttachSubmitIntercept("attachFromTeamDrive",s))return!1;var c={attachments:JSON.stringify(d)};c.id=i,c.action="storeTeamDriveAttachments";for(var m=Crm.getCrmBasePath()+"/fileattach.do",u=a.resources.length,v=[],p=0;p<u;p++)v.push(a.resources[p]);networkUtils.makeRequest(m,"POST",{params:c,success_callback:function(e){for(var t=e.teamDriveData,i=t.length,n=0;n<i;n++)for(var r=v.length,s=0;s<r;s++)if(v[s].link===t[n].link){v[s].encryptedUploadId=t[n].encryptedUploadId;break}a.resources=v,fileupload.createAttachElement(a,"FieldAttachmentsTeamDrive")}})}return!1},hideLinkPopup:function(){hideAnimatePopup("topBandPopup"),1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&(detailView.hideDetailviewMenu(!0),detailView.btnRemoveClassSelected(),hideMenu())},showRelListSortDiv:function(e,t,a,i,n,r,s,o,l,d,c,m){m=""==m?null:m;var u=$("#sortrellist_div").css("display","block").offset({left:0,top:0});u.offset({left:$(i).offset().left,top:$(i).offset().top+16});var v=$("#sorted_column"),p="<div><ul>";(e=$ESAPI.encoder().encodeForJavaScript(e),a=$ESAPI.encoder().encodeForJavaScript(a),o=$ESAPI.encoder().encodeForJavaScript(o),null!=v)?(null!=v.attr("title")&&(sortOrderString=v.attr("class")),p+=o==e?"sort_asc"==l?"<li><a style='' href='javascript:void(0);' onclick=\"javascript:sortViewColumns('"+e+"','"+t+"','"+a+"','Desc','false',"+c+",'"+m+"');\">"+s+"&nbsp;<span class='svgIconsImg sort_desc'></span></a></li>":"<li><a style='' href='javascript:void(0);' onclick=\"sortViewColumns('"+e+"','"+t+"','"+a+"','Asc','false',"+c+",'"+m+"');\">"+r+"&nbsp;<span class='svgIconsImg sort_asc'></span></a></li>":"<li><a href='javascript:void(0);' onclick=\"sortViewColumns('"+e+"','"+t+"','"+a+"','Asc','false',"+c+",'"+m+"');\">"+r+"&nbsp;<span class='svgIconsImg sort_asc'></span></a></li><li><a href='javascript:void(0);' onclick=\"sortViewColumns('"+e+"','"+t+"','"+a+"','Desc','false',"+c+",'"+m+"');\">"+s+"&nbsp;<span class='svgIconsImg sort_desc'></span></a></li>"):p+="<li><a href='javascript:void(0);' onclick=\"sortViewColumns('"+e+"','"+t+"','"+a+"','Asc','false',"+c+",'"+m+"');\" >"+r+"&nbsp;<span class='svgIconsImg sort_asc'></span></a></li><li><a href='javascript:void(0);' onclick=\"sortViewColumns('"+e+"','"+t+"','"+a+"','Desc','false',"+c+",'"+m+"');\">"+s+"&nbsp;<span class='sort_desc'></span></a></li>";o==e&&(p+="<li><a href='javascript:void(0);' onclick=\"sortViewColumns('"+e+"','"+t+"','"+a+"','Unsort','true',"+c+",'"+m+"');\" >"+d+"&nbsp;</a></li>"),p+="</ul></div>",u.html(p),u.show()},createNewChildCampaign:function(e){var t=$(e.target),a=crmRelatedList.getPersonalityModuleObj(t.attr("data-relid")),i=t.attr("data-layoutid"),n={module:a.module,primid:crmRelatedList.EntityId,primmodule:crmRelatedList.Module,returnAnchor:a.name.toLowerCase()+"_1458",listRelationId:a.listRelationId,recordNum:$("#recordNum").val(),relmodule:crmRelatedList.Module,fillUpModule:crmRelatedList.Module,entityid:crmRelatedList.EntityId,relmodule:crmRelatedList.Module,entityname:$("#entityName").val(),isCreateChildCampaign:!0};i&&(n.layoutId=i),Lyte.Router.transitionTo({route:"crm.tab.module.create",dynamicParams:[a.module]}).data=n},clickEventIdVsMethodMapping:{toggleList:"crmRelatedList.toggle",navigate_previous_rellist:"crmRelatedList.navigate",navigate_next_rellist:"crmRelatedList.navigate",sortColumnRL:"crmRelatedList.sortColumn",attachDocuments:"crmRelatedList.attachDocs",teamDrivePicker:"crmRelatedList.attachFromTeamDrive",cloudPicker:"crmRelatedList.attachFromCloudPicker",attachDesktop:"crmRelatedList.attachDesktop",attachZDocs:"crmRelatedList.attachZDocs",attachGDocs:"crmRelatedList.attachGDocs",attachLink:"crmRelatedList.attachLink",addProducts:"crmRelatedList.addProducts",add:"crmRelatedList.addProducts",addNew:"crmRelatedList.addNew",addVendorProducts:"crmRelatedList.addVendorProducts",addPotentialsProducts:"crmRelatedList.addPotentialsProducts",importListPrice:"crmRelatedList.importListPrice",editProducts:"crmRelatedList.editProducts",newTask:"crmRelatedList.newTask",newEvent:"crmRelatedList.newEvent",logCall:"crmRelatedList.logCall",sendMailEvent:"crmRelatedList.sendMailEvent",addCampaigns:"crmRelatedList.addProducts",associateMxN:"crmRelatedList.associateMxN",dissociateMxN:"crmRelatedList.dissociateMxN",editLookupRel:"crmRelatedList.editLookupRel",associateLookupRel:"crmRelatedList.associateLookupRel",newPotential:"crmRelatedList.newPotential",newPotentialForContacts:"crmRelatedList.newPotentialForContacts",newCompetitor:"crmRelatedList.newCompetitor",addContactRoles:"crmRelatedList.addContactRoles",editContactRoles:"crmRelatedList.editContactRoles",newProject:"crmRelatedList.newProject",newAssociateProject:"crmRelatedList.newAssociateProject",importAction:"crmRelatedList.importAction",updateCampaignStatus:"crmRelatedList.updateCampaignStatus",importOrgAction:"crmRelatedList.importOrgAction",hideRLPersonality:"crmRelatedList.hideRLPersonality",reorderRLPersonality:"crmRelatedList.reorderRLPersonality",editRLPersonality:"crmRelatedList.editRLPersonality",deleteRLPersonality:"crmRelatedList.deleteRLPersonality",sendsurvey:"crmRelatedList.sendsurvey",attendsurvey:"crmRelatedList.attendsurvey",viewCampaignSummary:"ZCampaigns.viewCampaignSummary",viewCampaignRecipientFilters:"ZCampaigns.viewCampaignRecipientFilters",viewRecipientsFromSummary:"ZCampaigns.viewRecipientsFromSummary",navigateCampaignRecipients:"ZCampaigns.filterRecipients",sendMailToMembers:"crmRelatedList.sendNormalMailToMembers",showMembersListView:"CrmCampaignInteg.showMembersListView",newChildCampaign:"crmRelatedList.createNewChildCampaign",showHideFilter:"crmRelatedList.showHideFilter"},clickHandler:function(e,t,a){return!this.clickEventIdVsMethodMapping[a]||(Lyte.registeredMixins["crm-utilities"].executeFunctionByName(this.clickEventIdVsMethodMapping[a],window,e,t),!1)},showMenuList:function(e){if($("#RelatedListDataScroll").length){var t=$(e).offset().top-11,a=$(e).offset().left+20,i=$(e).parent().find(".relListMenuDiv").outerWidth()+20;Crm.userDetails.RTL_ENABLED&&(a-=i),$(e).parent().find(".relListMenuDiv").css({visibility:"visible",position:"fixed",left:a,top:t}).find(".scaleCont").addClass("scaleOne")}else $(e).parent().find(".relListMenuDiv").css("visibility","visible").find(".scaleCont").addClass("scaleOne")},showMouseHoverSettingIcon:function(e){$(e).children("td:first").find(".moreOptions").addClass("activeMenu")},hideMouseHoverSettingIcon:function(e){$(e).children("td:first").find(".moreOptions").removeClass("activeMenu"),$(e).children("td:first").find(".relListMenuDiv").css("visibility","hidden").find(".scaleCont").removeClass("scaleOne")},showRemovePopup:function(e,t,a,i){$(".relListMenuDiv").css({visibility:"hidden"});var n=$("#removepopup"),r=(e=$(e)).attr("data-stdt"),s=(new Date).getTime(),o=e.attr("data-onclick"),l=e.attr("data-stat");if(void 0===a&&(a=$(e.closest("tr").find("td:first").find("a")[0]).text()),void 0===i&&(i=getObj("entityName").value),r>s&&-1!=parseInt(l)){n.find("#remWarningMsg").text(I18n.getMsg("crm.label.event.remove.alert",[i,a]));var d=n.find("#notifyButton").show(),c=n.find("#dontnotifyButton").show();d.unbind("click").click((function(a){var i;-1!==o.indexOf("#")?(i=o.substr(0,o.indexOf("#")),o=i+"&isCancelMailNeeded=1"+o.substr(o.indexOf("#"))):o=(i=o)+"&isCancelMailNeeded=1","rl"===t?new Promise((function(e){e(sortRelatedList(o))})).then((function(){renderingUtils.stopEvent(a)})):(commonUtils.showHideLoadingDiv(),Events.removeParticipant(o,e),renderingUtils.stopEvent(a))})),c.unbind("click").click((function(a){var i;commonUtils.showHideLoadingDiv(),-1!==o.indexOf("#")?(i=o.substr(0,o.indexOf("#")),o=i+"&isCancelMailNeeded=0"+o.substr(o.indexOf("#"))):o=(i=o)+"&isCancelMailNeeded=0","rl"===t?new Promise((function(e){e(sortRelatedList(o))})).then((function(){renderingUtils.stopEvent(a)})):(commonUtils.showHideLoadingDiv(),Events.removeParticipant(o,e),renderingUtils.stopEvent(a))})),d.focus()}else{n.find("#remWarningMsg").text(I18n.getMsg("crm.label.event.remove.participant.message",[i,a,Events.getModuleName(!0,!1)]));var m=n.find("#notifyButton").val(I18n.getMsg("crm.label.event.remove.participant",[i])).show();n.find("#dontnotifyButton").hide(),m.removeAttr("data-params").removeAttr("data-cid"),m.unbind("click").click((function(a){"rl"===t?new Promise((function(e){e(sortRelatedList(o))})).then((function(){renderingUtils.stopEvent(a)})):(commonUtils.showHideLoadingDiv(),Events.removeParticipant(o,e),renderingUtils.stopEvent(a))}))}showAnimatePopup("removepopup"),e.blur(),event&&renderingUtils.stopEvent(event)},getEditDeleteLinks:function(e,t,a,i,n){var r="",s="",o="",l="",d="0",c="",m="",u="",v="",p=!1,h=crmRelatedList.getPersonalityModuleObj(e),g=h.name,C=crmRelatedList.getTaregetString(e),f=!1;i.links={};var E=!1,I="",y=$("#topSectionTitle").find("span:first").map((function(){return $(this).text()})).get(),R=y[0]?y[0].trim():null;if((!h.isStandardLookup||g.includes("POTSTAGEHISTPERSONALITY")||g.includes("ATTACHMENTSPERSONALITY")||g.includes("HISTORYPERSONALITY")||g.includes("REPORTINGCONTACTSPERSONALITY")||"Accounts"===crmRelatedList.Module&&"CONTACTSPERSONALITY"===g||"Contacts"===crmRelatedList.Module&&"POTENTIALSPERSONALITY"===g||"CHILDACCOUNTSPERSONALITY"===g)&&(!h.isCustLookUp||h.isLinkingModule)||(E=!0),h.isCustLookUp||E){i.links.lookuprel=!0;var b="&fldName="+e+"&fldId="+e+"&entityId="+crmRelatedList.EntityId+"&parentModule="+crmRelatedList.Module+"&module="+crmRelatedList.Module+"&searchmodule="+t.MODULE+"&unselectedid="+t.ENTITYID;f=!0,1==t.isEditPermissionDenied?(r="",I="multiLookupsView.permissionIssueWarningShow("+t.ENTITYID+","+e+","+t.MODULE+",1)"):(r=crmRelatedList.createEditLink(t.MODULE,t.ENTITYID,C),I="multiLookupsView.submitMultiLookupForm('dissociate', '"+Crm.getCrmBasePath()+"/Search.do?lookuprel=true&relatedlist=true&select=true&mlaction=remove"+b+"', 'deletepopup',null,"+t.ENTITYID+")")}if("ACCOUNTSPERSONALITY"===g||h.isCustomModule&&!h.isLinkingModule)f=!0,r=crmRelatedList.createEditLink(t.MODULE,t.ENTITYID,C),s=crmRelatedList.createDeleteLink(t.MODULE,t.ENTITYID,C,f,void 0,t.MODULE);else if("CHILDACCOUNTSPERSONALITY"==g||"POTENTIALSPERSONALITY"==g||"CASESPERSONALITY"==g||"QUOTESPERSONALITY"==g||"SALESORDERSPERSONALITY"==g||"PURCHASEORDERSPERSONALITY"==g||"INVOICESPERSONALITY"==g||"SOLUTIONSPERSONALITY"==g||"VENDORSPERSONALITY"==g||"REPORTINGCONTACTSPERSONALITY"==g)f=!1,"POTENTIALSPERSONALITY"==g&&(f=!0),r=crmRelatedList.createEditLink(t.MODULE,t.ENTITYID,C,$("#recordNum").val()),"SOLUTIONSPERSONALITY"!=g&&"VENDORSPERSONALITY"!=g||(r=crmRelatedList.createEditLink(t.MODULE,t.ENTITYID,C)),s=crmRelatedList.createDeleteLink(t.MODULE,t.ENTITYID,C,f,void 0,t.MODULE);else if("CONTACTSPERSONALITY"==g||"CAMPAIGNSPERSONALITY"==g||"LEADSPERSONALITY"==g){f=!0;var T=crmRelatedList.Module;!h.isCustLookUp&&"Campaigns"==T||!h.isCustLookUp&&"CAMPAIGNSPERSONALITY"==g?(r=crmRelatedList.createStatusChangeLink(e,t.MODULE,t.ENTITYID,C,$("#recordNum").val()),s=crmRelatedList.createDeleteLink("MultiValued",t.ENTITYID,C,f,h.isCustLookUp,t.MODULE)):(r="LEADSPERSONALITY"==g?crmRelatedList.createEditLink(t.MODULE,t.ENTITYID,C):crmRelatedList.createEditLink(t.MODULE,t.ENTITYID,C,$("#recordNum").val()),s=crmRelatedList.createDeleteLink(t.MODULE,t.ENTITYID,C,f,h.isCustLookUp,t.MODULE))}else if("VISITSPERSONALITY"==g)f=!0,s=crmRelatedList.createDeleteLink(t.MODULE,t.ENTITYID,C,f,h.isCustLookUp,t.MODULE);else if(h.isCustomModule&&!h.isLinkingModule)f=!0,r=crmRelatedList.createEditLink(t.MODULE,t.ENTITYID,C),s=crmRelatedList.createDeleteLink(t.MODULE,t.ENTITYID,C,f,h.isCustLookUp,t.MODULE);else if("EMAILSPERSONALITY"==g)f=!1,s=crmRelatedList.createDeleteLink(t.MODULE,t.ENTITYID,C,f);else if("ACTIVITYPERSONALITY"===g||"TASKSPERSONALITY"===g||"ACTIVITYHISTORYPERSONALITY"===g||"INVITEDEVENTSPERSONALITY"===g||"TASKSPERSONALITY"===g||"TASKSHISTORYPERSONALITY"===g||"EVENTSPERSONALITY"===g||"EVENTSHISTORYPERSONALITY"===g||"CALLSPERSONALITY"===g||"CALLSHISTORYPERSONALITY"===g)f=!1,s=crmRelatedList.createDeleteLink(t.MODULE,t.ENTITYID,C,f),r=crmRelatedList.createEditLink(t.MODULE,t.ENTITYID,C,$("#recordNum").val()),"Tasks"==t.MODULE&&"ACTIVITYHISTORYPERSONALITY"!=g&&2!=t.approveStatus&&(crmRelatedList.EachModuleData[e].isCloseTaskReq&&(o=crmRelatedList.createCloseLink(t.ENTITYID,C)),void 0!==t.recordInsideProcess&&(d=t.recordInsideProcess),u="lnk_delete_Tasks"),"Calls"!=t.MODULE||"ACTIVITYHISTORYPERSONALITY"==g||2==t.approveStatus||"Scheduled"!=t.CALLSTATUS&&"Overdue"!=t.CALLSTATUS||(p=!0,m="relatedListMore_Calls"),"INVITEDEVENTSPERSONALITY"==g&&(l=crmRelatedList.createRemoveEntityFromEventLink(t.MODULE,t.ENTITYID,C),v="lnk_remove_entity");else if("COMPETITORSPERSONALITY"==g){var D=$("#recordNum").val();r=Crm.getCrmBasePath()+"/potentials/EditCompetitor.do?id="+crmRelatedList.EntityId+"&module=Potentials&competitorid="+t.ENTITYID+"&rid="+e+"&returnAnchor="+C+"&recordNum="+(null==D?null:encodeURIComponent(D)),s=Crm.getCrmBasePath()+"/potentials/DeletingCompetitor.do?competitorid="+t.ENTITYID+"&nextStep=relatedlist&isajax=true#"+C}else if("PRICEBOOKSPERSONALITY"==g){f=!0,r="Products"!=(w=crmRelatedList.Module)||h.isCustLookUp?crmRelatedList.createEditLink(t.MODULE,t.ENTITYID,C):crmRelatedList.creareEditLinkForProducts(e,g,C,t.ENTITYID,crmRelatedList.Module,t.MODULE),s=crmRelatedList.createDeleteLink(t.MODULE,t.ENTITYID,C,f,h.isCustLookUp,t.MODULE),h.isCustLookUp||(s=crmRelatedList.createDeleteLink("MultiValued",t.ENTITYID,C,f,h.isCustLookUp,t.MODULE))}else if("PRODUCTSPERSONALITY"===g||h.isLinkingModule){f=!0;var w=crmRelatedList.Module,M=t.MODULE;if(h.isLinkingModule&&(M=h.module,isReadOnly=h.readonly,isReadOnly))return;r=crmRelatedList.creareEditLinkForProducts(e,g,C,t.ENTITYID,crmRelatedList.Module,t.MODULE),h.isCustLookUp&&(r=crmRelatedList.createEditLink(t.MODULE,t.ENTITYID,C)),s=crmRelatedList.createDeleteLink(t.MODULE,t.ENTITYID,C,f,h.isCustLookUp,M),h.isCustLookUp||(s=crmRelatedList.createDeleteLink("MultiValued",t.ENTITYID,C,f,h.isCustLookUp,M)),"PriceBooks"==w&&"Products"==M||"Products"==w&&"PriceBooks"==M||(h.isLinkingModule?r=t.JID?crmRelatedList.createEditLink(a,t.JID,C):crmRelatedList.createEditLink(t.MODULE,t.ENTITYID,C):"Vendors"==w?(f=!1,r=crmRelatedList.createEditLink(t.MODULE,t.ENTITYID,C),s=crmRelatedList.createDeleteLink(t.MODULE,t.ENTITYID,C,f)):r=h.isCustLookUp?crmRelatedList.createEditLink(t.MODULE,t.ENTITYID,C):"")}else"CONTACTSROLESPERSONALITY"==g?s=crmRelatedList.createRemoveLinkForContactRole(t.CONTACTID,t.POTENTIALID,C):"ATTACHMENTSPERSONALITY"==g?s=Crm.getCrmBasePath()+"/deleteattachment.do?attachmentid="+t.ENTITYID+"&module="+encodeURIComponent(crmRelatedList.Module)+"&id="+crmRelatedList.EntityId+"&nextStep=relatedlist&isajax=true&creatorId="+t.CreaterId+"#"+C:"APPOINTMENTSPERSONALITY"==g&&(r=crmRelatedList.createEditLink(t.MODULE,t.ENTITYID,C,$("#recordNum").val()),s=crmRelatedList.createDeleteLink(t.MODULE,t.ENTITYID,C,f,h.isCustLookUp,t.MODULE));if(h.readonly){s="",I="",l="";var S=!0}if(""!=r){var L,A,_,O=!1,N=null,P={};if(-1!=r.indexOf("EditEntity.do?")){var k=r.substring(r.indexOf("?")+1),F=k.substring(0,k.indexOf("&"));F=F.substring(F.indexOf("=")+1),"ACTIVITYPERSONALITY"==g||"ACTIVITYHISTORYPERSONALITY"==g||"INVITEDEVENTSPERSONALITY"==g?-1!=k.indexOf("Events")?(L=!0,c="relatedListEdit_Events",P={module:"Events",id:t.ENTITYID,from:"relatedlist_new"}):isNewCallView&&-1!=k.indexOf("Calls")?(N="Missed"!=t.CALLTYPE&&"Cancelled"!=t.CALLSTATUS&&("Scheduled"==t.CALLSTATUS||"Overdue"==t.CALLSTATUS||t.SMOWNERID==Crm.userDetails.USER_ID),c="relatedListEdit_Calls",P={module:"Calls",id:t.ENTITYID,from:"relatedlist_new"}):(_=!0,c="relatedListEdit_"+$ESAPI.encoder().encodeForHTML(t.MODULE),P={goTo:C,module:encodeURIComponent(t.MODULE),id:t.ENTITYID}):h.isLinkingModule?k.indexOf("module=LinkingModule")>-1?(_=!0,c="relatedListEdit_"+a,P={goTo:C,module:encodeURIComponent(a),id:t.JID}):(_=!0,c="relatedListEdit_"+$ESAPI.encoder().encodeForHTML(t.MODULE),P={goTo:C,module:encodeURIComponent(t.MODULE),id:t.ENTITYID}):"APPOINTMENTSPERSONALITY"==g&&k.indexOf("Appointments")>-1?(L=!0,c="editBtn",P={module:"Appointments",id:t.ENTITYID,from:"relatedlist_new"}):(_=!0,c="relatedListEdit_"+$ESAPI.encoder().encodeForHTML(t.MODULE),P={goTo:C,module:encodeURIComponent(t.MODULE),id:t.ENTITYID})}else h.isCustLookUp||"CAMPAIGNSPERSONALITY"!=g&&"CONTACTSPERSONALITY"!=g&&"LEADSPERSONALITY"!=g?(h.isCustLookUp||"PRODUCTSPERSONALITY"!=g&&"PRICEBOOKSPERSONALITY"!=g)&&"COMPETITORSPERSONALITY"!=g||(O=!0):(c="relatedListEdit_Campaigns",A=!0);i.links.editObj={url:r,dataCid:"editbtn",dataParams:P,isShowStatusChange:A,isEditEntity:_,isEventEdit:L,isCallEdit:N,isProductPers:O,editzcqa:c}}if(""!=s&&(!Crm.userDetails.CLIENT_ACCOUNT||Crm.userDetails.CLIENT_ACCOUNT&&Crm.userDetails.CLIENT_TYPE!==crmRelatedList.Module&&Crm.userDetails.moduleVsCriteriaLookup[crmRelatedList.Module]&&Crm.userDetails.moduleVsCriteriaLookup[crmRelatedList.Module][0]!==n.mxnfieldid||!h.isCustLookUp&&"CAMPAIGNSPERSONALITY"===g)){var x=!1,U=!1,V="",B={};if(h.isCustLookup||"INVOICESPERSONALITY"!=g&&"SALESORDERSPERSONALITY"!=g&&"QUOTESPERSONALITY"!=g?"VISITACTIONSPERSONALITY"!=g&&"SURVEYPERSONALITY"!=g&&(m="lnk_delete_"+t.MODULE):(x=!0,m="showSettings_"+t.MODULE,B={module:encodeURIComponent(t.MODULE),relatedContactId:t.relContactId,id:t.ENTITYID,deleteLink:s,isApproved:t.approveStatus}),!h.isCustLookUp&&("CAMPAIGNSPERSONALITY"==g||"PRODUCTSPERSONALITY"==g||"PRICEBOOKSPERSONALITY"==g||"CONTACTSROLESPERSONALITY"==g||h.isLinkingModule||"Campaigns"==crmRelatedList.Module&&("Leads"==t.MODULE||"Contacts"==t.MODULE))){m="",U=!0;var j="";j="CONTACTSROLESPERSONALITY"==g?moduleRecordMapping.Contacts.singular_label:moduleRecordMapping[t.MODULE].singular_label,V=I18n.getMsg("crm.mxnLookup.dissociateselectedmessage",[t.CONTENT[0],j.toLowerCase(),R,moduleRecordMapping[crmRelatedList.Module].singular_label.toLowerCase()])}E&&(j=moduleRecordMapping[t.MODULE].singular_label,V=I18n.getMsg("crm.warning.deassociateordelete.entity",j),x&&(B.dissociatelink=I,B.warningMsg=V)),i.links.deleteObj={url:s,isShowInvoiceMenu:x,isRemoveLink:U,warningMsg:V,dataParamsDel:B,isCallLink:p,deletezcqa:m,withDissociate:E,dissociatelink:I}}else h.readonly&&(i.links.deleteObj={isDeletePermissionDenied:S});if(""!=l){V="";j=I18n.getMsg(Crm.getModuleDisplayName(!1,!0,!0)),V=I18n.getMsg("crm.mxnLookup.dissociateselectedmessage",[t.CONTENT[0],j.toLowerCase(),R,moduleRecordMapping[crmRelatedList.Module].singular_label.toLowerCase()]);var H=$("#entityName").val();i.links.removeObj={url:l,warningMsg:V,dataParamsRem:B,removezcqa:v,entityName:H}}else h.readonly&&(i.links.removeObj={isDeletePermissionDenied:S});""!=o&&(i.links.closeObj={isUnderProcess:d,url:o,closezcqa:u})},sendNormalMailToMembers:function(e){var t=$(e.target).attr("data-relid"),a=crmRelatedList.getPersonalityModuleObj(t).module,i="CB_"+t;if(CustomButtonJSObjectInit.checkBox&&CustomButtonJSObjectInit.checkBox[i]&&CustomButtonJSObjectInit.checkBox[i].length>0){var n=CustomButtonJSObjectInit.checkBox[i],r={from:"relatedList"};r.frommodule=a,r.isCampaignEmail=!0,r.fromRelatedListNormal=!0,r.idList=n.join(";"),r.listRelationId=t,CrmCampaignInteg.CampaignEmailObject=r,CrmCampaignInteg.sendMailToMembers(),crmListView.trackSendMailClickFromRL(a)}else crmui.showMsgBand("error",I18n.getMsg("crm.campaign.member.email.empty"),3e3)},preProcessForV2Model:function(e){for(var t=e.body,a=t.length,i=[],n=[],r=0;r<a;r++){for(var s=t[r],o={},l=(i=[],e.heading),d=l.length,c=0;c<d;c++){var m=l[c],u=m.SYS_REF_NAME,v="";(null!=s[u="Member_Status1"===u?"Member_Status":u]||s.$member_info&&m.campaign_member_field&&null!=s.$member_info[u])&&(v=crmRelatedList.getDisplayValueByUIType(s,u,m),"Backstage_No_of_Tickets"===u&&"Purchaser"===s.$member_info.Backstage_Role&&(v+=" true")),133===m.UITYPE&&(v.MODULE=m.MODULE_NAME),i.push(v)}o.CONTENT=i,o.approveStatus=s.$approved?1:2,o.MODULE=e.module,o.ENTITYID=s.id,s.$campaign_type&&(o.$campaign_type=s.$campaign_type),s.$member_info&&s.$member_info.Received_By&&(o.Received_By=s.$member_info.Received_By),n.push(o)}e.body=n},getDisplayValueByUIType:function(e,t,a){var i=a.UITYPE,n=a.campaign_member_field?e.$member_info[t]:e[t];if("Full_Name"==a.SYS_REF_NAME){var r=Crm.userDetails.NAME_FORMAT;r=r.split(",");var s=[];return r.forEach((function(t){"Salutation"!=t&&(t=t.replace(" ","_"),e[t]&&s.push(e[t]))})),s.join(" ")}if(133===i)n={MODULE:n.module,ENTITYID:n.id,DISPLAYLABEL:n.name};else if(20===i||8===i||221===i)n={MODULE:"User",ENTITYID:n.id,DISPLAYLABEL:n.name};else if(116===i)"DOUBLE"===a.TYPE?n=parseFloat(n):"DATE"!==a.TYPE&&"BIGINT"!==a.TYPE||(n=Handlebars.helpers.getDateTime(n.replace(/[+-]\d{2}:\d{2}/,"").replace(/-/g,"/").replace(/[T|Z]/g," "),i,a.TYPE.toLowerCase()));else if(100===i)n=n.join(";");else if(999===i)n=n.join(",");else if(209===i){for(var o=n.length,l=[],d=0;d<o;d++)l.push(n[d].name);n=l.length?l.join(";"):""}else 786===i||200===i||24===i||202===i||333===i?n=Handlebars.helpers.getDateTime(n.replace(/[+-]\d{2}:\d{2}/,"").replace(/\-/g,"/").replace(/[T|Z]/g," "),i):208===i?n=n.name:36===i||143===i||144===i||145===i?n=Handlebars.helpers.formatCurrencyValue(n,e.Currency):34===i?n=parseFloat(n).toFixed(2):40===i?n=parseFloat(n).toFixed(9):"object"==typeof n&&n.name&&(n=n.name);return n},getReloadParams:function(e){var t={};return t.id=crmRelatedList.EntityId,t.module=crmRelatedList.Module,t.isSortRequest=!1,t.rid=e,t},renderFilters:function(e){var t=$("#filterIcon_"+e);if(t.hasClass("zWebSITableFilterDivOpen")&&crmRelatedList.filters[e]){var a=crmRelatedList.getReloadParams(e);delete crmRelatedList.filters[e],crmRelatedList.ajaxReq(a),Crm.trackSpotLightAction("RelatedList Filters - Clear and Closed",{personalityName:crmRelatedList.getPersonalityModuleObj(e).name})}else crmRelatedList.insertFilterTr(e),t.addClass("zWebSITableFilterDivOpen")},showHideFilter:function(e,t){var a=$(t).data("params").rid,i=$("#filterIcon_"+a);i.hasClass("zWebSITableFilterDivOpen")&&!crmRelatedList.filters[a]?(crmRelatedList.removeFilterTr(a),i.removeClass("zWebSITableFilterDivOpen"),Crm.trackSpotLightAction("RelatedList Filters - Closed",{personalityName:crmRelatedList.getPersonalityModuleObj(a).name})):(crmRelatedList.filters[a]||Crm.trackSpotLightAction("RelatedList Filters - Opened",{personalityName:crmRelatedList.getPersonalityModuleObj(a).name}),crmRelatedList.renderFilters(a))},showPromoPopup:function(e){var t={},a=Lyte.registeredMixins["crm-view-utils"].getIntegCampObject()[e.target.id];if(t.show=!0,t.integTitle=a.name,t.route=a.route,t.iconClass=a.iconClass,Lyte.Component.registeredComponents["crm-integ-promo-popup"])Lyte.Component.render("crm-integ-promo-popup",t,"#show");else{var i=networkUtils.returnDependencyFiles(["crm-integ-promo-popup.js"],crmConstants.jsStaticPathForLyte),n=networkUtils.returnDependencyFiles(["crm-integ-promo-popup.css"],crmConstants.cssStaticPathForLyte),r=i.concat(n);Lyte.injectResources(r,void 0,(function(){Lyte.Component.render("crm-integ-promo-popup",t,"#show")}))}},removeFilterTr:function(e){$(".zWebSITableFilterSelectTr_"+e).remove()},insertFilterTr:function(e){var t=Handlebars.templates.RelatedListFilters(crmRelatedList.getPersonalityModuleObj(e));$("#rlHeader_"+e).after($(t))},showRlLoading:function(e){$("#"+e).find(".topband_dv_row, .norec, #rlTotalCount").remove();var t=$("#filterFooter_"+e);t&&t[0]?t.after(Handlebars.templates.RelatedListLoading()):$("#rlHeader_"+e).after(Handlebars.templates.RelatedListLoading())},applyFilter:function(e){var t=crmRelatedList.getReloadParams(e);crmRelatedList.formFilters(e)?(crmRelatedList.addFiltersParam(t),crmRelatedList.showRlLoading(e),crmRelatedList.ajaxReq(t),Crm.trackSpotLightAction("RelatedList Filters - Apply Clicked",{personalityName:crmRelatedList.getPersonalityModuleObj(e).name})):crmui.showMsgBand("error",I18n.getMsg("crm.label.empty.value"),"2500")},clearFilter:function(e){if(crmRelatedList.filters[e]){var t=crmRelatedList.getReloadParams(e);crmRelatedList.filters[e]=[],crmRelatedList.showRlLoading(e),crmRelatedList.ajaxReq(t)}else crmRelatedList.removeFilterTr(e),crmRelatedList.insertFilterTr(e);Crm.trackSpotLightAction("RelatedList Filters - Clear Clicked",{personalityName:crmRelatedList.getPersonalityModuleObj(e).name})},fillFiltersRecursively:function(e,t){return t instanceof Array||(t=[t]),0===t.length?t.push(e):1===t.length?(t.push("and"),t.push(e)):3===t.length&&(t[2]=crmRelatedList.fillFiltersRecursively(e,t[2])),t},formFilters:function(e){var t=[];return $("#"+("filters_"+e)+" .rlFiltersInput").each((function(){var a,i=$(this),n=i.prop("tagName").toLowerCase(),r=i[0],s=i.data("ui-type");if("lyte-dropdown"===n)(a=r.ltProp("selected"))&&301!=s&&999!=s&&(a=[a]);else if("crm-user-autocomplete-wrapper"===n){var o=r.querySelector("crux-user-dropdown").cxProp("selectedUser");o&&o.id&&(a={id:o.id,full_name:o.full_name})}else a=r.ltProp("value");if(a){786!==s&&200!==s&&24!==s&&202!==s&&333!==s||(a=CrmDateUtils.convertDateToUserPattern(CrmDateUtils.getDateObjectFromString(a),"YYYY-MM-DD"));var l=i.closest("td").find("#comparator_"+e)[0].ltProp("selected"),d={api_name:i.data("field-name"),comparator:l,value:a};t.push(d)}})),0!==t.length&&(crmRelatedList.filters[e]=t,!0)},addFiltersParam:function(e){var t=crmRelatedList.filters[e.rid];if(t&&validationUtils.isEmpty(e.filters)){var a=t.length;if(a){for(var i=[],n=0;n<a;n++){var r=t[n],s={api_name:r.api_name,comparator:r.comparator};s.value=r.value.id?[r.value.id]:r.value,i=crmRelatedList.fillFiltersRecursively(s,i)}e.filters=JSON.stringify(i)}}},populateFilterValues:function(e){var t=crmRelatedList.filters[e];if(t){getElemById("filterIcon_"+e).click();var a=t.length;if(0===a)delete crmRelatedList.filters[e];else var i=$("#filters_"+e);for(var n=0;n<a;n++){var r=t[n],s=r.api_name.replace(".","\\."),o=r.comparator,l=r.value,d=i.find("#rlFiltersInput_"+s);d.closest("td").find("#comparator_"+e)[0].ltProp("selected",o);var c=d.prop("tagName").toLowerCase(),m=d.data("ui-type");786!==m&&200!==m&&24!==m&&202!==m&&333!==m||(l=Utils.getDateInUserDatePattern(new Date(l)));var u=d[0];"lyte-dropdown"===c?u.ltProp("selected",301!=m&&999!=m?l[0]:l):"crm-user-autocomplete-wrapper"===c?u.querySelector("crux-user-dropdown").cxProp("selectedUser",l):u.ltProp("value",l)}}},showCampaignStatusDiv:function(e,t){var a={};a.memberStatus=store.peekAll("campaign_status"),a.list_relation_id=e,a.record_id=t,a.showPopup=!0,crmRelatedList.renderMemberStatusPopup(a),1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&detailView.atnAddClassSelected(event.currentTarget)},renderMemberStatusPopup:function(e){var t=$("#addCampaignMembersNextButton");t.length&&t.addClass("eventNone op5");var a=networkUtils.returnDependencyFiles(["crm-update-member-status-popup.js"],crmConstants.jsStaticPathForLyte),i=networkUtils.returnDependencyFiles(["crm-update-member-status-popup.css"],crmConstants.cssStaticPathForLyte),n=a.concat(i);Lyte.injectResources(n,void 0,(function(){t.length&&(t.blur(),t.removeClass("eventNone op5")),e.memberStatus=store.peekAll("campaign_status"),Lyte.Component.render("crm-update-member-status-popup",e,"#show")}))},showOnCheckRlActions:function(e){var t="CB_"+e;CustomButtonJSObjectInit.checkBox&&CustomButtonJSObjectInit.checkBox[t]&&CustomButtonJSObjectInit.checkBox[t].length>0&&($("#ract_"+e+" > a").hide(),$("#ract_"+e+" > .onCheckRLActions").show().addClass("tb_newsmallbtn"))},hideOnCheckRlActions:function(e){var t="CB_"+e;(!CustomButtonJSObjectInit.checkBox||!CustomButtonJSObjectInit.checkBox[t]||!CustomButtonJSObjectInit.checkBox[t].length>0)&&($("#ract_"+e+" > a").show(),$("#ract_"+e+" > .onCheckRLActions").hide().removeClass("tb_newsmallbtn"))},getContactTreeData:function(e,t){var a="crm/v2.2/"+t+"/"+e+"/__contacts_hierarchy";store.findRecord("dummy",e,{},!1,!1,{url:a}).then((function(t){var a=t.data;if("TOO_MANY_RECORDS"===a.code){var i=Crm.moduleInfo.Contacts.translatedPluralLabel,n=Crm.moduleInfo.Accounts.translatedSingularLabel;crmui.showMsgBand("info",I18n.getMsg("crm.contact.hierarchy.view.Tree_not_supported",[$ESAPI.encoder().encodeForHTML(n),$ESAPI.encoder().encodeForHTML(i)]),"10000")}else{var r=crmRelatedList.constructTree(a),s=[{value:{Account_Name:{name:a[0].Account_Name.name},isAccount:"true"},children:r}],o=networkUtils.returnDependencyFiles(["crm-contact-hierarchyview.js","lyte-tree.js"],crmConstants.jsStaticPathForLyte),l=[];Crm.userDetails.RTL_ENABLED&&(l=networkUtils.returnDependencyFiles(["crm-contact-hierarchyview-rtl.css"],crmConstants.cssStaticPathForLyte));var d=o.concat(l);Lyte.injectResources(d,void 0,(function(){Lyte.Component.render("crm-contact-hierarchyview",{treeData:s,currentEntityId:e,isPopUp:!0},"#contactTreePopupId")}))}}),(function(e){if("TOO_MANY_RECORDS"===JSON.parse(e.response).code){var t=Crm.moduleInfo.Contacts.translatedPluralLabel,a=Crm.moduleInfo.Accounts.translatedSingularLabel;crmui.showMsgBand("info",I18n.getMsg("crm.contact.hierarchy.view.Tree_not_supported",[$ESAPI.encoder().encodeForHTML(a),$ESAPI.encoder().encodeForHTML(t)]),"10000")}}))},parseRLForActivitySplt:function(e,t){var a={},i=!1,n=!1,r=1,s="Services"===t||!Crm.isActivitySplitDone||void 0,o={data:[]},l={data:[]},d=[];for(key in e){var c=key.match(/(\d+)/);if(null==c||isNaN(c[0]))a[key]=e[key];else d[c[0]]=e[key]}var m={};return d.forEach((function(e){var d="RL"+r,c=!("APPOINTMENTSPERSONALITY"!==e.name||"Services"===t||!Crm.isActivitySplitDone)||void 0;if("TASKSPERSONALITY"===e.name||"EVENTSPERSONALITY"===e.name||"CALLSPERSONALITY"===e.name||c?i||(a[d]=e,i=!0,r++):"TASKSHISTORYPERSONALITY"===e.name||"EVENTSHISTORYPERSONALITY"===e.name||"CALLSHISTORYPERSONALITY"===e.name||"APPOINTMENTSHISTORYPERSONALITY"===e.name?n||(a[d]=e,n=!0,r++):(a[d]=e,r++),!0===e.isShowColumns&&!crmRelatedList.isNotActivitySubPersonality(e.name,s)){o.parentid||-1!==e.name.indexOf("HISTORY")?l.parentid||-1===e.name.indexOf("HISTORY")||(l.parentid=void 0===e.listRelationId?e.name:e.listRelationId):o.parentid=void 0===e.listRelationId?e.name:e.listRelationId,crmRelatedList.actRecordSelector||-1!==e.name.indexOf("HISTORY")||(crmRelatedList.actRecordSelector="#manageRLColumns_Activity"),crmRelatedList.closedRecordSelector||-1===e.name.indexOf("HISTORY")||(crmRelatedList.closedRecordSelector="#manageRLColumns_Activity_History");var u={};u.module=e.module,u.zcqa="customize_"+e.module,u.label="Events"===e.module?"Meetings":e.module,u.personality=e.name,u.parentid=void 0===e.listRelationId?e.name:e.listRelationId,-1===e.name.indexOf("HISTORY")?(o.parentid=u.parentid,m[e.module]=u):(l.parentid=u.parentid,m[e.module+"_History"]=u)}})),o.parentid&&(o.btn_name="openActivities",m.Tasks&&o.data.push(m.Tasks),m.Events&&o.data.push(m.Events),m.Calls&&o.data.push(m.Calls),m.Appointments&&o.data.push(m.Appointments)),l.parentid&&(l.btn_name="closedActivities",m.Tasks_History&&l.data.push(m.Tasks_History),m.Events_History&&l.data.push(m.Events_History),m.Calls_History&&l.data.push(m.Calls_History),m.Appointments_History&&l.data.push(m.Appointments_History)),this.openCusData=o,this.closeCusData=l,a},constructTree:function(e){for(var t=[],a={},i=e.length,n=0;n<i;n++){var r=e[n],s=r.Reporting_To;(null===s?t:a[s.id]||(a[s.id]=[])).push({value:r})}for(var o=function(e){if(a[e.value.id]){var t=a[e.value.id];e.children=t;for(var i=0,n=t.length;i<n;++i)o(t[i])}},l=(n=0,t.length);n<l;++n)o(t[n]);return t},handleIntegCampaignDissociation:function(e,t){var a=networkUtils.returnDependencyFiles(["crm-campaign-disassociate-popup.js","crm-campaign-detail-utils.js"],crmConstants.jsStaticPathForLyte),i=networkUtils.returnDependencyFiles(["crm-campaign-disassociate-popup.css"],crmConstants.cssStaticPathForLyte),n=a.concat(i);Lyte.injectResources(n,void 0,(function(){Lyte.Component.render("crm-campaign-disassociate-popup",{pModule:e,campaignType:t},"#show")}))},showCircuitPreview:function(e,t){$("#crm-msg").remove(),commonUtils.showHideLoadingDiv(!0);var a=networkUtils.returnDependencyFiles(["crm-circuits-preview-display.js"],crmConstants.jsStaticPathForLyte);a=a.concat(networkUtils.returnDependencyFiles(["crm-circuits-preview-display.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(a=a.concat(networkUtils.returnDependencyFiles(["crm-circuits-rtl.css"],crmConstants.cssStaticPathForLyte))),a=(a=a.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("circuits")],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles(["crm-circuits-common.js"],crmConstants.jsStaticPathForLyte)),Lyte.injectResources(a,void 0,(function(){if(e){var a=$("crm-circuits-preview");0!==a.length||(Lyte.Component.render("crm-circuits-preview",void 0,"#show"),a=$("crm-circuits-preview"));var i={circuit_name:t,preview_url:e};Lyte.triggerEvent("cirPrev_set_data",i),Lyte.triggerEvent("cirPrev_show_preview_pop",!0),commonUtils.showHideLoadingDiv(!1)}else $L("crm-circuits-preview")[0].component.executeMethod("errorHandling",{})}),e,t)},getRelatedMails:function(e,t,a){var i=csrfParamName+"="+encodeURIComponent(csrfToken),n=document.getElementById("iskanbanview");if(n&&"true"===n.value)t=document.getElementById("userid").value;var r=Crm.getCrmBasePath()+"/ZMailConfig.do?action=showRelatedMails&msgid="+e+"&user_id="+t+"&threadId="+a;n&&"true"===n.value&&(r+="&iskanbanview=true");var s,o="RelMails_"+e,l=document.getElementById(o),d=document.getElementById("mail_type");if(l&&(s=$("#test_"+e+",#"+o)),l&&d&&"GMail"===d.value)"none"!==l.style.display?s.hide():s.show();else if(l&&"none"!==l.style.display&&!n)s.hide();else if(n&&"true"===n.value){var c=$("#mailthreads_"+e);if(c.hasClass("hide"))return void(new crmRequestPool).initiate({action:r,data:i,type:"POST",success:function(){var e=setInterval((function(){var t=$("#addactionmain");""!==t.html()&&(c.html(t.html()),c.removeClass("hide"),clearInterval(e))}),100)}});c.addClass("hide")}else loadAjaxTab(""),new AjaxAPI({id:o,url:r,params:i,callbackfn:function(){commonUtils.showHideLoadingDiv(),$("#test_"+e+",#"+o).show()}}).post()},showSrTable:function(){$L("crm-entityscores-view").e[0].component.showSrList()},showSrChart:function(){$L("crm-entityscores-view").e[0].component.showSrChart()},relTaskCreate:function(e,t,a,i,n){var r=crmRelatedList.getPersonalityModuleObj($(e).attr("data-relid")),s=$("#newRelatedListPopUpDiv");s&&s.empty();var o=Crm.getCrmBasePath()+"/Create.do",l=new crmRequestPool,d={module:"Tasks",format:"json"};if(r?(d.listRelationId=r.listRelationId,d.fillUpModule=crmRelatedList.Module,d.entityid=crmRelatedList.EntityId,d.relmodule=crmRelatedList.Module,d.entityname=$("#entityName").val()):t&&(d.fillUpModule=i,d.entityid=t,d.relmodule=i,d.entityname=a,d.taskCheckKey=!0),"followup"===n){returnJson.entityMapJson.CONTACTID&&("null"!=returnJson.entityMapJson.CONTACTID.defaultid?d.entityid=returnJson.entityMapJson.CONTACTID.defaultid:delete d.entityid,"null"!=returnJson.entityMapJson.CONTACTID.lookupmodule?d.fillUpModule=returnJson.entityMapJson.CONTACTID.lookupmodule:delete d.fillUpModule);var c=returnJson.entityMapJson.CONTACTID?returnJson.entityMapJson.CONTACTID.lookupmodule:i;d.relmodule=c,d.entityname=returnJson.entityMapJson.CONTACTID?returnJson.entityMapJson.CONTACTID.defaultvalue:void 0,d.taskCheckKey=!0}var m="bulk"===n?getIdsAndNames():void 0;networkUtils.setCsrfParam(d),l.initiate({action:o,data:d,datatype:"json",success:function(t){var i=JSON.parse(t);i.isFromRelatedList=!0;var r=Crm.getModuleObj("Tasks");r.currentStatus="create";var s=e.firstElementChild;e&&s&&"TaskPopup"===s.id||"fromSaveandNew"===e?r.createTemplate(i,void 0,"TaskPopup"):r.createTemplate(i),labelWidthFixed("list","preHTMLContainer_Tasks");var o=$("#newRelatedListPopUpDiv");o.addClass("createTaskPopContainer");var l=$("#preHTMLContainer_Tasks"),d=$('<div id="tasksPopFreezeLayer" class="tasksPopupFreezeLayer hide"></div>');l.append(d);var c=$("#secDiv_Task_Information").height();d.height(c),thirdPartyUtils.bindSelect2($(".newChosenSel").find("select")),thirdPartyUtils.bindSelect2($(".mlSelect").find("select")),thirdPartyUtils.bindSelect2($(".labelTabCreate").find("select"));var u=$("#FreezeLayer");if("salessignals"==a&&(u.addClass("bulkTaskfreezeZi"),o.addClass("bulkTaskPopZi")),null!=m){var v=JSON.stringify(m),p=$('<input type="hidden" id="bulkTaskNewPopup" value='+v+"></input>");o.append(p),$("#Tasks_fldRow_CONTACTID").addClass("bulkTaskPopupHide"),$("#Tasks_fldRow_SEID").addClass("bulkTaskPopupHide"),u.addClass("bulkTaskfreezeZi"),o.addClass("bulkTaskPopZi")}if("followup"==n){var h=$('<input type="hidden" id="followUpTask"></input>');o.append(h)}var g=$("#Tasks_Notify_Owner"),C=o.find(".topband_tb");C.prepend(g),C.addClass("taskPopTopband_tb"),$(".ui-menu").addClass("bulkTaskPopZi"),l.scroll((function(){$(".lookFieldSrcWrap").hide(),$(".ui-menu").hide()}))},error:function(){commonUtils.showHideLoadingDiv(),renderingUtils.showCustomAlert(I18n.getMsg("crm.assignment.rule.internal.error"))}}),(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(d.module))&&(d.getLayoutRuleJSON=!0,Crm.layoutRuleJSONData={},l.addUp({type:"GET",action:o,data:d,dataType:"json",success:function(e){null!==e&&(CFRExec.init(e,d.module,"edit"),CFRExec.promptIfMandatory=!1,CFRExec.evalRules("edit",!0))},error:function(){commonUtils.showHideLoadingDiv(),Crm.layoutRuleJSONData={}}})),(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(d.module))&&Crm.downloadValidationRules(o+"?format=json&module=Tasks","Tasks")}};function triggerLinkDocsView(e,t,a,i){var n;if(-1!=e.indexOf("linkDocs=true")){if(a||(a=renderingUtils.getTargetElem(event)),null!=usernameNeeded&&"boolean"==typeof usernameNeeded&&1==usernameNeeded&&-1==jQuery.inArray("zdoc",usernameNotNeeded))return commonUtils.checkUsernameNeeded((function(){showExportMenu(e,t,attachId,a)}),"zdoc"),!1;var r=objectUtils.URL(e).getParams();$.ajax({type:"POST",url:Crm.getCrmBasePath()+"/ZDocs.do?mode=isTrashedDocInZDocs",async:!1,data:"fileId="+r.fileId+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),success:function(n){if("true"==trimBoth(n)){var r=I18n.getMsg("crm.trashdoc.alert");return alert(r),!1}if($.inArray(t,["jpeg","jpg","gif","png","webp","bmp","svg"])>-1)return event.preventDefault(),"fileupload"===i?$("#fileUploadField_"+a).attr({onclick:"showImagePreview(this)",href:e,name:"cboxElement"}):$("#relatedList_"+a).attr({onclick:"showImagePreview(this)",href:e,name:"cboxElement"}),renderingUtils.triggerEvent("click",$("#relatedList_"+a)),!1}})}n="pdf"==t?"pdfViewPlugin":function(){var e={sheet:["excel","xls","csv"],show:["ppt","pptx","pps","odp"],writer:["word","txt","doc","docx","htm","html","sxw","odt","rtf"]};for(var a in e)if(e[a].indexOf(t)>-1)return a}(),"pdf"==t?openSheetForExport(encodeURI(e)+"&downLoadMode=pdfViewPlugin","pdfViewPlugin"):-1==$.inArray(t,["jpeg","jpg","gif","png","webp","bmp","svg"])&&openSheetForExport(encodeURI(e)+"&downLoadMode="+n)}function sortViewColumns(e,t,a,i,n,r,s){var o=t.split("_"),l=o[o.length-1];append_sort_column="sortColumnString_"+l,append_sort_order="sortOrderString_"+l;var d=e,c="sort_asc";"Desc"==i&&(c="sort_desc"),getObj(append_sort_column)&&getObj(append_sort_order)&&(getObj(append_sort_column).value=d,getObj(append_sort_order).value=c);var m=$("#module").val(),u=$("#id").val();if(r){"true"==n&&(s=null);var v={rid:l,module:m,id:u,fromIndex:1,sortOrderString:null!=s?c:"",sortColumnId:null!=s?s:"",isSortRequest:!0};crmRelatedList.ajaxReq(v)}$("#sortrellist_div").hide()}function setPlayOrPauseMessage(e){$(e).hasClass("icon_pause")?$(e).attr("title",I18n.getMsg("crm.button.pause")):$(e).attr("title",I18n.getMsg("crm.button.play"))}function showInvoiceMenu(e){var t=JSON.parse($(e).attr("data-params")),a=$("#invoiceMenuList").children("a"),i=a.length,n="";"2"===t.isApproved&&(n="none"),t.dissociatelink?a.eq(0).attr("onclick","showDeletePopup('"+t.warningMsg+"', 'crm.mb.label.move.to.trash', '', '', this)").attr("data-params",'{"dissociateclick":"javascript:'+t.dissociatelink+'","module":"'+t.module+'"}').attr("data-onclick",'javascript:sortRelatedList("'+t.deleteLink+'")').css("display",n):a.eq(0).attr("onclick","showDeletePopup('"+t.id+"', 'crm.button.delete', '', '', this)").attr("data-onclick",'javascript:sortRelatedList("'+t.deleteLink+'")').css("display",n),delete t.deleteLink,delete t.isApproved,t=JSON.stringify(t);for(var r=1;r<i;r++)a.eq(r).attr("data-params",t);var s={id:"invoiceMenuList",clickSelector:"a"};Crm.menu.createMenu(event,s),$("#invoiceMenuList").css("position","fixed")}function saveRelatedListColumns(e){var t=[],a=Crm.listRId[0],i=!("APPOINTMENTSPERSONALITY"!==a||"Services"!==getObj("module").value&&Crm.isActivitySplitDone)||void 0,n=!crmRelatedList.isNotActivitySubPersonality(a,i);if(n?$("#relateList_"+e+" input[type='checkbox']:checked").each((function(e,a){t.push($(a).val())})):($("[ddid="+e+"] #relateList_"+e+" input[type='checkbox']:checked").each((function(e,a){t.push($(a).val())})),$("#"+Crm.listRId[0]+"_"+Crm.listRId[1]).addClass("newRlEdit").removeClass("selectRlEdit").css("visibility","hidden")),t=t.join(";"),getObj("selectList").value!=t+";"){var r=Crm.listRId[1];if("ACTIVITYPERSONALITY"!==a&&"ACTIVITYHISTORYPERSONALITY"!==a||"true"===Crm.userDetails.MPL_MIGRATION_COMPLETED)if(0==a.indexOf("HISTORYPERSONALITY")){r=[],r=$("[ddname="+a+"]").attr("ddid");l=0!==$("[ddname="+a+"]").find("[name=rellistrow]").length}else{l=0!==$("[ddname="+Crm.listRId[0]+"]").find("[name=rellistrow]").length;n&&(l=!0)}else{a="ACTIVITYPERSONALITY;ACTIVITYHISTORYPERSONALITY",r=[];var s=$("[ddname=ACTIVITYPERSONALITY]").attr("ddid");null!=s&&r.push(s);var o=$("[ddname=ACTIVITYHISTORYPERSONALITY]").attr("ddid");null!=o&&r.push(o);var l=0!==$("[ddname=ACTIVITYPERSONALITY]").find("[name=rellistrow]").length||0!==$("[ddname=ACTIVITYHISTORYPERSONALITY]").find("[name=rellistrow]").length}var d=$("[ddid="+e+"]"),c=n?$("#frmmodule_"+e).val():d.find("#frmmodule").val(),m=Crm.getCrmBasePath()+"/CustomDisplay.do?actionName=update&cust_disp_module="+getObj("module").value+"&sellist="+encodeURIComponent(t)+"&frmmodule="+c+"&pname="+a+"&from=detailView&id="+getObj("entityId").value;m+="&rid="+r;var u={};if(u[csrfParamName]=csrfToken,u.reload=l,"VISITSPERSONALITY"==a){var v=$("#portalRListSel").val(),p=$("#portalRListSel option:selected").text();"All Portals"!=v?(u.portalName=p,u.allPortals=!1):u.allPortals=!0}mR(m,(function(e){if(!0===l&&""!==e){if(n){var i={module:crmRelatedList.Module,id:crmRelatedList.EntityId,fromIndex:1};crmRelatedList.ajaxReq(i,void 0,!1)}else crmRelatedList.load(crmRelatedList.Module,crmRelatedList.EntityId,e);$("#selectList").val(t+";")}if(Crm.scrollToElem=(Crm.listRId[0]+"_"+Crm.listRId[1]).toLowerCase(),Crm.scrollPage(),hideMenu(),n){var r=-1===a.indexOf("HISTORY")?"openActivities":"closedActivities";$L("#customizePopover_"+r)[0].ltProp("show",!1)}}),u)}else n&&hideCustomizeListPopup("relatedListCols_"+a)}function sortRelatedList(e,t,a,i){if(http){var n=e.substr(e.indexOf("#")+1,e.length),r=n.split("_")[1],s=n.split("_")[0].replace("$","_").toUpperCase();e.indexOf("#")>-1&&(e=e.substr(0,e.indexOf("#")));var o=!1;if((e+="&pname="+s).indexOf("closeTask.do")>-1){var l=localStorage.getItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID);if("string"==typeof l&&(l="true"===l),l&&(Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup=!0),!Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup&&"hidden"===$("#deletepopup").css("visibility")){var d=window.event,c=renderingUtils.getTargetElem(d),m=networkUtils.parseUrl(e).params,u=(d=window.event,c=renderingUtils.getTargetElem(d),new crmRequestPool);return m[csrfParamName]=encodeURIComponent(csrfToken),m.action="showNotifyOwner",void u.initiate({action:Crm.getCrmBasePath()+"/closeTask.do",data:m,type:"POST",success:function(e){$("#freezeBackGround").css("z-index","30");var t=Crm.isActivitySplitDone?"deleteAction":void 0;showDeletePopup(I18n.getMsg("crm.confirm.close.task"),"crm.label.mark.completed","","",c,void 0,"primarybtn",!0,void 0,"true"==e,!1,t),i&&i.setData("showpopover",!1)},error:function(){$("#freezeBackGround").css("z-index","30"),showDeletePopup(I18n.getMsg("crm.confirm.close.task"),"crm.label.mark.completed","","",c,void 0,"primarybtn",!0,void 0,!1,!1)}})}var v=crmRelatedList.personalityArr.indexOf("taskshistorypersonality")>-1||crmRelatedList.personalityArr.indexOf("eventshistorypersonality")>-1||crmRelatedList.personalityArr.indexOf("callshistorypersonality")>-1;(crmRelatedList.personalityArr.indexOf("activityhistorypersonality")>-1||v)&&(e+="TASKSPERSONALITY"===s?";TASKSHISTORYPERSONALITY":"EVENTSPERSONALITY"===s?";EVENTSHISTORYPERSONALITY":"CALLSPERSONALITY"===s?";CALLSHISTORYPERSONALITY":";ACTIVITYHISTORYPERSONALITY",crmRelatedList.personalityArr.indexOf("taskspersonality")>-1&&(e+=";TASKSPERSONALITY"));var p=$("#showDontAskOption").prop("checked");p&&(localStorage.setItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID,!0),Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup=!0),!Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup&&p&&(e+="&isDontAskAgainChecked="+p);var h=$("#notifyOwnerOption").prop("checked");Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup||(e+="&isNotifyOwnerChecked="+h),o=!0}e+="&rid="+r;var g=csrfParamName+"="+encodeURIComponent(csrfToken);null!=t&&"false"==t&&(g=""),getObj("parentCurrencyISOCode")&&(e+="&parentCurrencyISOCode="+getObj("parentCurrencyISOCode").value),getObj("parentExchangeRate")&&(e+="&parentExchangeRate="+getObj("parentExchangeRate").value);var C=$("#portalRListSel").val(),f=$("#portalRListSel option:selected").text();e+="All Portals"!=C?"&portalName="+f+"&allPortals=false":"&allPortals=true";var E="CB_"+r;if(CustomButtonJSObjectInit.checkBox&&CustomButtonJSObjectInit.checkBox[E]){var I=CustomButtonJSObjectInit.checkBox[E].indexOf(a);CustomButtonJSObjectInit.checkBox[E].splice(I,1);var y=CustomButtonJSObjectInit.checkBox[E].length;$("#relatedListRecVal_"+r).text(y)}var R=!1;if(o&&(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains("Tasks"))&&(R=!0,Crm.VR||(Crm.VR={}),Crm.VR.ajaxEditFieldLabel="STATUS"),o&&(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains("Tasks"))){freezeBackground();var m={module:"Tasks",entityId:a,layoutId:""};return R&&(m.includeVR=!0),m[csrfParamName]=encodeURIComponent(csrfToken),void(u=new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/FormRule.do?action=getLayoutRuleNEntityInfo",data:m,type:"POST",success:function(t){CFRExec.moveToTempHolder(),returnJson=$.parseJSON(t.entityInfo),R&&(Crm.validationRuleJSONData.Tasks=JSON.parse(t.validationRuleJSON),Crm.VR.entityDetails=returnJson),CFRExec.init(t.layoutRuleJSONObj,"Tasks","list");var i=CFRExec.getTaskCompletedOptionLabel("list"),r=CFRExec.evalAjaxEditForLayoutRule("Tasks","STATUS",i);if(-1!=r)if(r){hideAnimatePopup("deletepopup");var s={};s.moduleid=a,s.module="Tasks",s.columnName="STATUS",s.fieldValue=i,networkUtils.setCsrfParam(s);var o=objectUtils.URL(e).getParams();s.check={type:"closeTask",from:"relatedList",module:o.module,id:o.id},CFRExec.haltStageChange(s)}else R?new Promise((function(t){t(executeVRRule(a,e))})).then((function(t){t||(removeFreezeLayer(),performOperationNdReloadList(e,n,g))})):(removeFreezeLayer(),performOperationNdReloadList(e,n,g));else removeFreezeLayer()},error:function(e){}})}if(o&&R)return freezeBackground(),(m={module:"Tasks",entityId:a,layoutId:""})[csrfParamName]=encodeURIComponent(csrfToken),m.onlyEntityDetails=!0,m.includeVR=!0,void(u=new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/FormRule.do?action=getLayoutRuleNEntityInfo",data:m,type:"POST",success:function(t){Crm.VR.entityDetails=$.parseJSON(t.entityInfo),Crm.validationRuleJSONData.Tasks=JSON.parse(t.validationRuleJSON),new Promise((function(t){t(executeVRRule(a,e))})).then((function(t){t||(removeFreezeLayer(),performOperationNdReloadList(e,n,g))}))},error:function(e){}});i?performOperationNdReloadList(e,n,g,i.data):performOperationNdReloadList(e,n,g)}("Campaigns"==getObj("module").value&&getObj("totalContact")||getObj("totalLead"))&&loadCampaingSummary()}function executeVRRule(e,t){CVRExec.getTaskCompletedUserValue();return CVRExec.setAjaxEditPrimaryField(!0),new Promise((function(e){e(CVRExec.evalRules("view","Tasks","STATUS",!0,!0))})).then((function(a){if(!a){hideAnimatePopup("deletepopup");var i={};i.moduleid=e,i.module="Tasks",i.columnName="STATUS",i.fieldValue="Completed",networkUtils.setCsrfParam(i);var n=objectUtils.URL(t).getParams();return i.check={type:"closeTask",from:"relatedList",module:n.module,id:n.id},n.isNotifyOwnerChecked?i.isNotifyOwnerChecked="true":n.isDontAskAgainChecked&&(i.isDontAskAgainChecked="true"),CVRExec.storeCachedParams(i),!0}return!1}))}function performOperationNdReloadList(e,t,a,i){loadAjaxTab("","lightblue"),http.open("POST",e,!0),http.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),http.setRequestHeader("X-Requested-With","XMLHttpRequest"),http.onreadystatechange=function(){if(4==http.readyState){hideAnimatePopup("removepopup"),hideAnimatePopup("deletepopup");var a=http.responseText;if(http.status==crmConstants.errorStatusCode)return commonUtils.showHideLoadingDiv(),void renderingUtils.displayPermissionDenied(http);if(validationUtils.isJson(a)&&JSON.parse(a).CannotDelete){commonUtils.showHideLoadingDiv();var n='<div onclick="sE()" class="w500 p20"><div class="floatL pL20 w430"><div class="f20"><h2 style="color:#E20000";>'+I18n.getMsg(JSON.parse(a).CannotDelete[0])+'</h2></div><div class="mT10">'+I18n.getMsg(JSON.parse(a).CannotDelete[1])+'</div></div><br class="clearB"><div  class="alignright mT20"><input type="button" id="popupok" class="primarybtn" value="'+I18n.getMsg("crm.button.ok")+"\" onclick=\"hide('popupnew');removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30\"></div></div>";return void renderingUtils.popUpWithFreeze(n)}if(validationUtils.isJson(a)&&"object"!=typeof a&&"PARENT_RECORD_DELETED"===JSON.parse(a).STATUS)return commonUtils.showHideLoadingDiv(),void crmui.showMsgBand("error",I18n.getMsg("crm.record.perform.deleted.revoked"),5e3);if(a.indexOf(":::CampaignMemberDisAssociationException:::")>-1){commonUtils.showHideLoadingDiv();var r=JSON.parse(a);return void renderingUtils.showCustomAlert(r.msg,r.title,!1)}if(a.indexOf("ALERTERROR:::")>-1){var s=a.split("ALERTERROR:::");return commonUtils.showHideLoadingDiv(),s[1].indexOf(I18n.getMsg("crm.security.error"))>-1?void renderingUtils.displayPermissionDenied():void alert(s[1])}if(e.indexOf("pname")>-1){var o=objectUtils.URL(e).getParams();e.includes("MassDelete.do")&&null!=o&&"EMAILSPERSONALITY"==o.pname&&0==$("#isFromNewAPI").length?$("#selectMails").val("ALL").change():crmRelatedList.load(crmRelatedList.Module,crmRelatedList.EntityId,a),Lyte.triggerEvent("relatedList",{res:a});var l=JSON.parse(a)[crmRelatedList.module?crmRelatedList.module:$L("#module")[0].value][o.rid];if(l&&l.isLinkingModule&&multiLookupsView.updateMXNFieldValue(void 0,o.rid,l.defaultvalue),!0==!validationUtils.isEmpty(CFRExec.tempHolder)&&CFRExec.initFromTempHolder(),i){if(!i.canvas||"Activities"===!i.list_relation_id){var d=o.module;crmTab.deleteFromCache(d),d=o.actModule,crmTab.deleteFromCache(d)}}else{d=o.module;crmTab.deleteFromCache(d),d=o.actModule,crmTab.deleteFromCache(d)}}else crmRelatedList.load(crmRelatedList.Module,crmRelatedList.EntityId,a),!0==!validationUtils.isEmpty(CFRExec.tempHolder)&&CFRExec.initFromTempHolder();commonUtils.showHideLoadingDiv(),showDrillDownPtr(t),refreshFollowDiv()}},http.send(a)}function reloadPersonality(e){for(var t,a=crmRelatedList.personalityArr.split("||"),i=0;i<a.length;i++){var n=a[i].split("_");if(n[0]===e){e=n[0],t=n[1];break}}if(void 0!==t){var r=Crm.getCrmBasePath()+"/NewRelatedList.do?action=getData&module="+getObj("module").value+"&id="+getObj("id").value+"&cvid="+getObj("cvid").value+"&pname="+e.toLocaleUpperCase();mR(r,(function(e){crmRelatedList.load(crmRelatedList.Module,crmRelatedList.EntityId,e)}))}}function resetCustomRelatedListTrigger(){for(var e=$("div[id^='customRelatedListDiv_']:visible"),t=e.length,a=0;a<t;a++)$(e[a]).attr("istriggered","false")}function fetchCustomRelatedList(){var e=$("div[id^='customRelatedListDiv_']:visible"),t=$("[name='module']").val();t||(t=detailView.currentModule);var a=$("[name='id']").val();for(i=0;i<e.length;i++){var n=$("#dvinner").scrollTop(),r=n+$(window).height(),s=findPosY(e[i]),o=s+$(e[i]).height();if("true"!=$(e[i]).attr("istriggered")&&o>=n&&s<=r&&o<=r&&s>=n){$(e[i]).attr("istriggered","true");var l=$(e[i]).attr("id").split("_")[1],d={Entity:moduleRecordMapping[t].api_name,EntityId:a},c="undefined"!=typeof WidgetHandler?WidgetHandler.getWidget("RelatedList",l):void 0;c?WidgetHandler.RelatedList.render(c,l,d):CustomRelatedListObj.connectToCustomRelatedList(t,l,a)}}}function mailToolTipHvr(e,t){if(t){var a=$(e).offset().top,i=$(e).offset().left,n=$(e).outerHeight();setTimeout((function(){$(".mailDetailToolTip").css({left:i-37,top:a+n+4}).show()}),400)}else $(".mailDetailToolTip").hide()}function updateUsersList(e,t){var a=getObj("status_"+t);if(a){a.disabled="disabled";var i=getObj("zmailkey").value,n=Crm.getCrmBasePath()+"/ZMailConfig.do?action=updateUsersList&entId="+e+"&shareMails="+a.checked+"&zmailkey="+i,r="&"+csrfParamName+"="+csrfToken;loadAjaxTab(""),mR(n,(function(e){commonUtils.showHideLoadingDiv(),$("#bulkUpdateSuccess").empty(),getObj("bulkUpdateSuccess").innerHTML=e,show("bulkUpdateSuccess"),mailsetCenter("bulkUpdateSuccess"),setTimeout((function(){hide("bulkUpdateSuccess"),a.disabled=""}),4e3)}),r)}}function updateISCTicket(e,t){if(Notifier.close(),""!=e.trim()){var a=Crm.getCrmBasePath()+"/ZMailConfig.do?action=updateISCTicket&user_id="+e+"&entityID="+getObj("id").value+"&module="+getObj("module").value;new AjaxAPI({id:"relatedPageContent",url:a,callbackfn:function(){}}).post(),hide("alertDiv"),removeFreezeLayer(),$("#bulkUpdateSuccess").empty(),getObj("bulkUpdateSuccess").innerHTML=t,show("bulkUpdateSuccess"),mailsetCenter("bulkUpdateSuccess"),setTimeout((function(){hide("bulkUpdateSuccess")}),4e3)}else alert("UserId cannot be empty")}function potentialPopUp(e,t){var a=$("#entityId").attr("value"),i=$("#cntId").attr("value");null==i&&(i=$("crm-emailsrl-canvas-view").attr("associated-cont-id")),$(t).closest("tr").attr("tobehidden",!0);var n=Crm.getCrmBasePath()+"/Search.do?searchmodule=Potentials&entityId="+a+"&msgId="+e+"&contactId="+i;commonUtils.openCustomLookup(n,void 0,"topBandPopup",renderingUtils.windowWidth-300)}function getIntegList(e,t,a,i,n,r,s,o,l,d,c,m,u,v,p,h,g,C){var f,E,I,y=Crm.getCrmBasePath()+"/GetIntegrationList.do",R="action=getIntegList&projectlistrelid="+t+"&module="+n;if("1"==e[0]&&((getObj("isProjectCalled")&&"N"==getObj("isProjectCalled").value||getOpenerObj("isProjectCalled")&&"N"==getOpenerObj("isProjectCalled").value)&&(getObj("isProjectCalled")?getObj("isProjectCalled").value="S":getOpenerObj("isProjectCalled").value="S"),R+="&reqid="+a+"&returnAnchor="+i+"&cvid="+r+"&portalName="+s+"&msg="+o+"&pageno="+l+"&projId="+d+"&sortorder="+h),"1"==e[1]){var b="false";if(getObj("mailListRelId"))if(getObj("mailConfigType")){E=(f=getObj("mailConfigType").value.split("#"))[0];var T=getObj("mailListRelId").value,D=$("#sendEntityMailLink");getObj("getMailOpt")&&getObj("getMailOpt").innerHTML,"1"==E&&f[1]?($("crm-rl-share-email").length>0&&D.hide(),$("#maillistid").empty(),document.getElementById(T).innerHTML="<table cellspacing='0' cellpadding='0' width='100%' border='0' class='norec' align='center'><tbody><tr><td valign='center' ><div class='pR30 italic fontsmooth'>"+f[1]+"</div><br/></td></tr></table><br/>"):"2"==E&&f[1]?(b="true",D.hide()):getObj("entIdForZMail")&&(b="true",n&&"Potentials"!=n&&(getObj("zmailRS").style.display=""))}else b="true";if("true"==b){var w=null,M=null,S=null,L=E,A=$("crm-rl-users-list").length>0,_="true"==$("#isMailAppsFlow").val();getObj("selectMails")&&(S=getObj("selectMails"));var O=$("#contactSelDropdownInAcc"),N=A?O:$("#contactSelDropdownInAcc :selected");if(null==S||"IMAP_ALL"!==S.value&&"IMAP_ALL"!==S.getAttribute("lt-prop-selected")||"Accounts"===n&&N.length>0&&("ALL"==N.attr("lt-prop-selected")||"ALL"==N.attr("value")))if("Accounts"===n&&N.length>=0&&("ALL"==N.attr("lt-prop-selected")||"ALL"==N.attr("value")))R+=A?"&mailType=all_contacts_sent_crm_emails":"&mailType=ALLUSERSMAILS";else if(null==S||"ALL_MAIL_VIEW"!==S.value&&"ALL_MAIL_VIEW"!==S.getAttribute("lt-prop-selected"))if(null==S||"ALL"==S.value||"ALL"==S.getAttribute("lt-prop-selected")||"Accounts"===n&&N.length>0&&("ALL"==N.attr("lt-prop-selected")||"ALL"==N.attr("value")))R+=A?"&mailType=sent_from_crm":"&mailType=ALLUSERSMAILS";else{var P=S.value?S.value:S.getAttribute("lt-prop-selected");w=P.substring(0,P.indexOf("_")),M=P.substring(P.indexOf("_")+1,P.length)}else R+="Accounts"===n?"&mailType=IMAP_ALLUSERSMAILS":"&mailType=";else _?R=R+"&mailType="+S.getAttribute("lt-prop-selected"):(R+="&mailType=IMAP_ALLUSERSMAILS","true"===$("#isALLOptOnly").val()&&(R+="&mailType1=IMAP_CRMMAILS"));var k=c;if("Potentials"==n){k=c=getObj("id")?getObj("id").value:getOpenerObj("id").value;var F=$("#dealOnlyDropDown");"Potentials"!=n||"dealsOnly"!==F.val()&&"dealsOnly"!==F.attr("lt-prop-selected")||(R+="&isDealsMail=true")}else if(null!=N&&N.length>0){var x=$("#addNewIcP_Emails");if(0==x.length)try{x=$("#addNewIcP_"+I18n.getMsg("Emails"))}catch(e){x=$("#newleft_"+C+" .addNewIcP")}"ACCOUNTS_ALL"==N||"ACCOUNTS_ALL"==N.attr("lt-prop-selected")||"ACCOUNTS_ALL"==N.attr("value")?(k=c,$("#sendEntityMailLink").hide(),$("#relatedMailList").hide(),R+="&isAccountsMail=true"):"ALL"!=N.attr("lt-prop-selected")&&"ALL"!=N.attr("value")?(k=null==(k=N.attr("value"))?N.attr("lt-prop-selected"):k,L=N.attr("email"),$("#sendEntityMailLink").show(),x.removeClass("hide"),$("#relatedMailList").show()):(k=$("#id").val(),$("#relatedMailList").hide(),$("#sendEntityMailLink").hide(),x.addClass("hide"),R+="&entityType=allContacts")}else"Accounts"===n&&(k=c,$("#contactSelDropdownInAcc").closest(".newSelect").remove(),$("#sendEntityMailLink").remove(),$("#relatedMailList").remove(),R+="&isAccountsMail=true");var U=getObj("entityName").value;getObj("zmailEmail")&&(L=getObj("zmailEmail").value);var V="Cases"===n||"Vendors"===n?$("#zs_EMAIL"):null;if(V){var B=$("#subvalue_EMAIL");B&&(V.value=B.text()),L=V.value}R+=void 0!==L?"&listRelationId="+getObj("mailListRelId").value+"&entId="+k+"&moduleId="+c+"&user_id="+w+"&user_name="+encodeURIComponent(M)+"&searchid="+encodeURIComponent(L)+"&fullname="+encodeURIComponent(U)+"&Zmail=true":"&listRelationId="+getObj("mailListRelId").value+"&entId="+k+"&moduleId="+c+"&user_id="+w+"&user_name="+encodeURIComponent(M)+"&fullname="+encodeURIComponent(U)+"&Zmail=false"}else if(getObj("zs_EMAIL")&&(getObj("zs_EMAIL1")?getObj("zs_EMAIL").value=getObj("zs_EMAIL1").value:getObj("subvalue_EMAIL")&&(getObj("zs_EMAIL").value=getObj("subvalue_EMAIL").innerHTML)),-1==(e=e[0]+"0"+e[2]+e[3]+e[4]+e[5]+e[6]).indexOf("1"))return}if("1"==e[2]){var j=deskInteg.getKeyValueForTicketCriteria();if(!j)return $("#deskLoadingDiv div").text(I18n.getMsg("crm.new.label.no.records")),void(e=e[0]+e[1]+"0"+e[3]+e[4]+e[5]+e[6]);"email"==j.key&&(R=R+"&"+j.key+"="+encodeURIComponent(j.value));var H=deskInteg.getCurrentTicketType();null!=H&&(R=R+"&ticketType="+H),-1==R.indexOf("&moduleId=")&&(R=R+"&moduleId="+crmRelatedList.EntityId),0==deskCache.get(crmRelatedList.EntityId)&&(R+="&deskstats=true")}("1"==e[3]&&(R=R+"&invoiceListRelationId="+m),"1"==e[4]&&(R=R+"&expenseListRelationId="+u),"1"==e[5]&&(R=R+"&zsubscriptionsListRelationId="+v),"1"==e[3]||"1"==e[4]||"1"==e[5])&&(R=R+"&isRefresh="+(p=void 0!==p&&p)+"&entityId="+c);if("1"===e[6]&&-1===R.indexOf("&entityId=")&&(R=R+"&entityId="+crmRelatedList.EntityId),R+="&map="+e,Lyte.registeredMixins["crm-email-emotions-mixin"])I=Lyte.registeredMixins["crm-email-emotions-mixin"].findZiaEmailConfigDetails();else{var Y=networkUtils.returnDependencyFiles(["email-emotions.js"],crmConstants.jsStaticPathForLyte);Lyte.injectResources(Y,void 0).then((function(){I=Lyte.registeredMixins["crm-email-emotions-mixin"].findZiaEmailConfigDetails()}))}I.then((function(t){var a=!1;if(t&&t.zia_config.configs.length>0){var i=t.zia_config.configs[0].configs;8===i.length&&(a=i[7].status)}Crm.userDetails.isEmotionsEnabled=a,networkUtils.loadFeatureScripts(["zohocrm_projectDeatils_list.js"],function(){httphandle.open("POST",y,!0),httphandle.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),httphandle.onreadystatechange=function(){if(3==httphandle.readyState)try{if(d="["+(d=httphandle.responseText).substring(1)+"]",null!=(c=JSON.parse(d))[c.length-1].project&&"1"==e[0]){var t=JSON.parse(c[c.length-1].project);store.unloadAll("zprojects_rl"),store.pushPayload("zprojects_rl",t.projectList),ZProjects&&ZProjects.errorProject&&(t.errorProject=ZProjects.errorProject),projectProcess(t);var a=parseInt(t.current_filter_count)+1,i=$("div[ddname='PROJECTSPERSONALITY']").attr("ddid"),r=$('#RelatedListCommonDiv[ddid="'+i+'"]');a?(a>10&&(a="10+"),a>100&&(a="100+"),$("#newleft_"+i).find("span.numCountn").addClass("numCountVal").text(a),r.removeClass("noDataFountDetail")):($("#newleft_"+i).find("span.numCountn").text("").removeClass("numCountVal"),r.addClass("noDataFountDetail")),null!=t&&(e="0"+e[1]+e[2]+e[3]+e[4]+e[5]+e[6]),ZProjects.projectsNavigated=!1}else if(null!=c[c.length-1].mail&&"1"==e[1]){if((t=JSON.parse(c[c.length-1].mail)).hasOwnProperty("isFromNewAPI")?mailProcess(t):mailProcess(Handlebars.templates.MailDetailsList(t)),null!=t){if(e=e[0]+"0"+e[2]+e[3]+e[4]+e[5]+e[6],t.mailRange){var s=t.mailRange;crmRelatedList.mailRange={},crmRelatedList.mailRange[0]=s}else{var o=null!=(C=t.mailsList)?C.length:0;C&&C[o-1]&&C[o-1].hasOwnProperty("mail_index")?(Crm.mailIndex={},Crm.mailIndex[0]=C[o-1].mail_index):t.hasOwnProperty("next_index")&&(Crm.mailIndex={},Crm.mailIndex[0]=t.next_index)}if(t.hasOwnProperty("isFromNewAPI")){var l='<div class="ernCount vH mL20 pB10 dIB f14 col333" style="padding-bottom: 10px;"><span id="ernRowCount" class="proximas">1</span><span class="pL10 ">Row Selected</span><input type="hidden" value="" id="mailsToDelete"/><div style="display:none;" id="mailsSub"></div><input type="hidden" value="listRelationId"><span class="mL10 svgIcons dIB ernDeleteIcon cP vaBaseLine" onClick="showDeletePopup(\'mailsSub\',\'crm.button.move.to.trash\', \'\', \'\',this,true)" id="deleteMailsButton"></span></div>';$($("div[ddname=EMAILSPERSONALITY]").children("table").find("tr").children()[0]).append(l)}}}else if(null!=c[c.length-1].support&&"1"==e[2]){null!=(t=JSON.parse(c[c.length-1].support))&&(e=e[0]+e[1]+"0"+e[3]+e[4]+e[5]+e[6])}else if(null!=c[c.length-1].invoice&&"1"==e[3]){t=JSON.parse(c[c.length-1].invoice);ZInvoice.loadRL("ZINVOICEPERSONALITY",crmRelatedList.Module,m,crmRelatedList.EntityId,t),null!=t&&(e=e[0]+e[1]+e[2]+"0"+e[4]+e[5]+e[6],"Potentials"===n&&ZInvoice.refreshpotentialEstInvRL(t))}else if(null!=c[c.length-1].expense&&"1"==e[4]){t=JSON.parse(c[c.length-1].expense);ZInvoice.loadRL("ZEXPENSEPERSONALITY",crmRelatedList.Module,u,crmRelatedList.EntityId,t),null!=t&&(e=e[0]+e[1]+e[2]+e[3]+"0"+e[5]+e[6])}else if(null!=c[c.length-1].zsubscriptions&&"1"==e[5]){t=JSON.parse(c[c.length-1].zsubscriptions);ZInvoice.loadRL("ZSUBSCRIPTIONSPERSONALITY",crmRelatedList.Module,v,crmRelatedList.EntityId,t),null!=t&&(e=e[0]+e[1]+e[2]+e[3]+e[4]+"0"+e[6])}else null!==c[c.length-1].messages&&"1"===e[6]&&(e=showMessagesList(c[c.length-1].messages,e,g))}catch(e){murphy.error(e)}if(4==httphandle.readyState){var d;d="["+(d=httphandle.responseText).substring(1)+"]";var c,p,h=(c=JSON.parse(d)).length;for(p=0;p<h;p++)if(null!=c[p].project&&"1"==e[0]){t=JSON.parse(c[p].project);store.unloadAll("zprojects_rl"),store.pushPayload("zprojects_rl",t.projectList),ZProjects&&ZProjects.errorProject&&(t.errorProject=ZProjects.errorProject),projectProcess(t);a=parseInt(t.current_filter_count)+1,i=$("div[ddname='PROJECTSPERSONALITY']").attr("ddid"),r=$('#RelatedListCommonDiv[ddid="'+i+'"]');a?(a>10&&(a="10+"),a>100&&(a="100+"),$("#newleft_"+i).find("span.numCountn").addClass("numCountVal").text(a),r.removeClass("noDataFountDetail")):($("#newleft_"+i).find("span.numCountn").text("").removeClass("numCountVal"),r.addClass("noDataFountDetail")),null!=t&&(e="0"+e[1]+e[2]+e[3]+e[4]+e[5]+e[6]),ZProjects.projectsNavigated=!1}else if(null!=c[p].mail&&"1"==e[1]){if((t=JSON.parse(c[p].mail)).hasOwnProperty("isFromNewAPI")?mailProcess(t):mailProcess(Handlebars.templates.MailDetailsList(t)),null!=t){if(e=e[0]+"0"+e[2]+e[3]+e[4]+e[5]+e[6],t.mailRange){s=t.mailRange;crmRelatedList.mailRange={},crmRelatedList.mailRange[0]=s}else{var C;o=(C=t.mailsList).length;C&&C[o-1]&&C[o-1].hasOwnProperty("mail_index")?(Crm.mailIndex={},Crm.mailIndex[0]=C[o-1].mail_index):t.hasOwnProperty("next_index")&&(Crm.mailIndex={},Crm.mailIndex[0]=t.next_index)}if(t.hasOwnProperty("isFromNewAPI")){l='<div class="ernCount vH mL20 pB10 dIB f14 col333" style="padding-bottom: 10px;"><span id="ernRowCount" class="proximas">0</span><span class="pL10 ">Row Selected</span><input type="hidden" value="" id="mailsToDelete"/><div style="display:none;" id="mailsSub"></div><input type="hidden" value="listRelationId"><span class="mL10 svgIcons dIB ernDeleteIcon cP vaBaseLine vH" onClick="showDeletePopup(\'mailsSub\',\'crm.button.move.to.trash\', \'\', \'\',this,true)" id="deleteMailsButton"></span></div>';$($("div[ddname=EMAILSPERSONALITY").children("table").find("tr").children()[0]).append(l)}}}else if(null!=c[p].support&&"1"==e[2]){t=JSON.parse(c[p].support);deskInteg.loadDeskintegration(t),null!=t&&(e=e[0]+e[1]+"0"+e[3]+e[4]+e[5]+e[6])}else if(null!=c[p].invoice&&"1"==e[3]){t=JSON.parse(c[p].invoice);ZInvoice.loadRL("ZINVOICEPERSONALITY",crmRelatedList.Module,m,crmRelatedList.EntityId,t),null!=t&&(e=e[0]+e[1]+e[2]+"0"+e[4]+e[5]+e[6],"Potentials"===n&&ZInvoice.refreshpotentialEstInvRL(t))}else if(null!=c[p].expense&&"1"==e[4]){t=JSON.parse(c[p].expense);ZInvoice.loadRL("ZEXPENSEPERSONALITY",crmRelatedList.Module,u,crmRelatedList.EntityId,t),null!=t&&(e=e[0]+e[1]+e[2]+e[3]+"0"+e[5]+e[6])}else if(null!=c[p].zsubscriptions&&"1"==e[5]){t=JSON.parse(c[p].zsubscriptions);ZInvoice.loadRL("ZSUBSCRIPTIONSPERSONALITY",crmRelatedList.Module,v,crmRelatedList.EntityId,t),null!=t&&(e=e[0]+e[1]+e[2]+e[3]+e[4]+"0"+e[6])}else null!==c[p].messages&&"1"===e[6]&&(e=showMessagesList(c[p].messages,e,g))}Crm.userDetails.detailView_newUI&&$L("#RelatedListCommonDiv #RelatedListDataScrollInteg,#RelatedListCommonDiv #RelatedListDataScroll,#newRelDetailsScroll,#RelatedListCommonDiv #deskIntegDiv").scroll({preventVertical:!0})},httphandle.send(R)}.bind(this))}))}function showMessagesList(e,t,a){var i=JSON.parse(e);if(null!==i){t=t[0]+t[1]+t[2]+t[3]+t[4]+t[5]+"0";var n=networkUtils.returnDependencyFiles(["crm-msg-utils.js"],crmConstants.jsStaticPathForLyte),r=networkUtils.returnDependencyFiles(["crm-msg-related-list.js"],crmConstants.jsStaticPathForLyte),s=networkUtils.returnDependencyFiles(["crm-msg-related-list.css"],crmConstants.cssStaticPathForLyte);Crm.userDetails.RTL_ENABLED&&(s=s.concat(networkUtils.returnDependencyFiles(["crm-msg-rtl.css"],crmConstants.cssStaticPathForLyte)));var o=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("bmrelatedlist")],null);Lyte.injectResources(r.concat(s).concat(o).concat(n),void 0,(function(){var e=document.createElement("crm-msg-related-list");e.setData({conversations:i.messages,listRelationId:a}),$("#"+a).html("").append(e),i.messages&&i.messages.length>0?$("#newleft_"+a).find("span.numCountn").addClass("numCountVal").text(i.messages.length):$("#newleft_"+a).find("span.numCountn").text("").removeClass("numCountVal"),$("[ddid="+a+"]").find("#showCustomizeList").remove()}))}return t}$((function(){$("#show").on("mouseenter","#relatedPageContent .modRow",(function(){crmRelatedList.showMouseHoverSettingIcon(this)})).on("mouseleave","#relatedPageContent .modRow",(function(){crmRelatedList.hideMouseHoverSettingIcon(this)})),$("#show").on("mouseenter","#relatedPageContent .showModMenu",(function(){event.stopPropagation(),1==Crm.userDetails.detailView_newUI&&$(".DetailsPageBox").length&&crmRelatedList.showMenuList(this),$(this).closest("td").find(".relListMenuDiv").css({visibility:"visible",transition:"visibility 0s linear 600ms"})})),$("#show").on("mouseenter","#relatedPageContent .moreOptions",(function(){event.stopPropagation(),1==Crm.userDetails.detailView_newUI&&$(".DetailsPageBox").length&&crmRelatedList.showMenuList(this),$(this).closest("td").find(".relListMenuDiv").css({visibility:"visible"})})),$("#show").on("mouseleave","#relatedPageContent .showModMenu",(function(){$(".relListMenuDiv").css({visibility:"hidden",transition:""})}))})),Handlebars.registerHelper("checkIfSubjectField",(function(e,t,a,i){return"SUBJECT"!=e[t].COLUMNNAME||"ACTIVITYHISTORYPERSONALITY"!=a&&"ACTIVITYPERSONALITY"!=a?i.inverse(this):i.fn(this)})),Handlebars.registerHelper("stringify",(function(e){return JSON.stringify(e)})),Handlebars.registerHelper("showNavigation",(function(e,t,a,i,n){return e=parseInt(e),crmRelatedList.showNavigation(e,t,a,i.length)?n.fn(this):n.inverse(this)})),crmRelatedList.showNavigation=function(e,t,a,i){return e>=parseInt(a)||i>=parseInt(a)},Handlebars.registerHelper("isNotUndefined",(function(e,t){return e?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("isBodyContentAvailable",(function(e,t){return crmRelatedList.checkBodyContent(e)?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("compareNumbers",(function(e,t,a){return e===t?a.fn(this):a.inverse(this)})),Handlebars.registerHelper("getId",(function(e,t){return"RELATEDLISTPERSONALITY"==e?"customRelatedListDiv_"+t:"SUPPORTPERSONALITY"==e?"supportdiv":t})),Handlebars.registerHelper("getStyleAttr",(function(e,t){return"RELATEDLISTPERSONALITY"!=e&&"SUPPORTPERSONALITY"!=e?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("checkForRlHandling",(function(e,t,a,i){if("COMPETITORNAME"==e[t].COLUMNNAME)return i.fn(this);return"SUBJECT"===e[t].COLUMNNAME&&["ACTIVITYHISTORYPERSONALITY","ACTIVITYPERSONALITY","CALLSPERSONALITY","EVENTSPERSONALITY","TASKSPERSONALITY","CALLSHISTORYPERSONALITY","EVENTSHISTORYPERSONALITY","TASKSHISTORYPERSONALITY"].contains(a)?i.fn(this):("ATTACHMENTSPERSONALITY"!=a||"NAME"!=e[t].COLUMNNAME&&"ATTACHMENTSIZE"!=e[t].COLUMNNAME&&"MODIFIEDTIME"!=e[t].COLUMNNAME)&&("SURVEYPERSONALITY"!=a||"UNIQUEID"!=e[t].COLUMNNAME&&"SOURCE"!=e[t].COLUMNNAME)?"CHILDCAMPAIGNSPERSONALITY"==a&&"CAMPAIGNNAME"==e[t].COLUMNNAME?i.fn(this):"LEADSPERSONALITY"!=a&&"CONTACTSPERSONALITY"!=a||"SERVICERESPONSEID"!=e[t].COLUMNNAME&&"BACKSTAGE_NOOFTICKETS"!=e[t].COLUMNNAME?i.inverse(this):i.fn(this):i.fn(this)})),Handlebars.registerHelper("checkIfSubjectField",(function(e,t,a,i){return"SUBJECT"!=e[t].COLUMNNAME||"ACTIVITYHISTORYPERSONALITY"!=a&&"ACTIVITYPERSONALITY"!=a?i.inverse(this):i.fn(this)})),Handlebars.registerHelper("chattedDiv",(function(e){return null!=e&&0!=e?"<td><span class='siq-chatted'></span></td>":"<td></td>"})),Handlebars.registerHelper("checkStringRL",(function(e,t,a,i,n,r,s,o,l,d){var c="";if("COMPETITORSPERSONALITY"==s)c="<a id='relatedList_"+i.ENTITYID+"_"+n+"' data-zcqa='relatedList_"+d.fn(this)+"_"+n+"' class='link' href='javascript:;' onclick='commonUtils.openCustomLookup(\""+Crm.getCrmBasePath()+"/potentials/ViewCompetitor.do?id="+i.ENTITYID+"&module=Potentials&returnAnchor=competitorspersonality_"+r+'", undefined, "topBandPopup");\'>'+d.fn(this)+"</a>";else if(["ACTIVITYHISTORYPERSONALITY","ACTIVITYPERSONALITY","CALLSPERSONALITY","EVENTSPERSONALITY","TASKSPERSONALITY","CALLSHISTORYPERSONALITY","EVENTSHISTORYPERSONALITY","TASKSHISTORYPERSONALITY"].contains(s)){var m="ap";m="ACTIVITYHISTORYPERSONALITY"===s?"ahp":"ACTIVITYPERSONALITY"===s?"ap":m;if(0==n.indexOf("CustomModule")&&"NAME"==t[a].COLUMNNAME||t[a].COLUMNNAME=={Leads:"LASTNAME",Activities:"SUBJECT",Tasks:"SUBJECT",Calls:"SUBJECT",Events:"SUBJECT",Accounts:"ACCOUNTNAME",Contacts:"LASTNAME",Potentials:"POTENTIALNAME",Campaigns:"CAMPAIGNNAME",Cases:"CASESUBJECT",Solutions:"SOLUTIONTITLE",Products:"PRODUCTNAME",Vendors:"VENDORNAME",PriceBooks:"BOOKNAME",Quotes:"QUOTESUBJECT",SalesOrders:"SALESORDERSUBJECT",PurchaseOrders:"PURCHASEORDERSUBJECT",Invoices:"INVOICESUBJECT",Forecasts:"FORECASTNAME",Visits:"VISITEDPAGE"}[n]){var u="Crm_Implied_View_"+n;crmListView.changedPermissionsForZBModules.hasOwnProperty(u)&&(u=crmListView.changedPermissionsForZBModules[u]);c="<a ";c+=(u=Crm.userDetails.permissions[u])>-1?'data-cid="detailView" href="'+Crm.getCrmBasePath()+"/EntityInfo.do?id="+i.ENTITYID+"&module="+i.MODULE+'"':'href="javascript:;" title="permission denied" data-permission="false"',c+="ACTIVITYHISTORYPERSONALITY"===s||"ACTIVITYPERSONALITY"===s?'id="relatedList_'+i.ENTITYID+"\" data-zcqa='relatedList_"+d.fn(this)+"_"+n+'\' data-params=\'{"fromActivityListView":"true","pfrom":"rel","module":"'+i.MODULE+'","id":"'+i.ENTITYID+'","pn":"'+m+'","peId":"'+crmRelatedList.EntityId+'","bMod":"'+crmRelatedList.Module+'","lookback":"true"':'id="relatedList_'+i.ENTITYID+"\" data-zcqa='relatedList_"+d.fn(this)+"_"+n+'\' data-params=\'{"fromActSubModuleListView":"true","pfrom":"rel","module":"'+i.MODULE+'","id":"'+i.ENTITYID+'","pn":"'+s+'","peId":"'+crmRelatedList.EntityId+'","bMod":"'+crmRelatedList.Module+'","lookback":"true"',c+='}\' class="link"',c+=">"+d.fn(this)+"</a>"}}else if("ATTACHMENTSPERSONALITY"==s)if("NAME"==t[a].COLUMNNAME){var v=e,p=v.length,h=v.lastIndexOf("."),g="";0!=p&&h>-1&&(g=(g=v.substring(h+1,p)).toLowerCase());var C=i.extn,f=i.mode,E=i.isLinkDocs,I=i.isPreviewAvailable;void 0===i.isPreviewAvailable&&(I=!0);c='<div class="atchName" style="max-width:600px">';if(1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI)c='<div class="atchName w90per">';null!=E&&0==E?c+="pdf"==g&&I?"<a data-zcqa='relatedList_"+d.fn(this)+"_"+n+"' id='relatedList_"+i.ENTITYID+"' title=\""+$ESAPI.encoder().encodeForHTMLAttribute(v)+'" onClick="javascript:openSheetForExport(\''+Crm.getCrmBasePath()+"/specific/ViewAttachment?fileId="+i.FILEID+"&module="+encodeURIComponent(crmRelatedList.Module)+"&parentId="+i.ParentId+"&creatorId="+i.CreaterId+"&id="+i.ENTITYID+"&name="+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(encodeURIComponent(v)))+"&downLoadMode=pdfViewPlugin','pdfViewPlugin');sE(event);\" style=\"cursor: pointer\"><span> <span class='"+$ESAPI.encoder().encodeForHTMLAttribute(C)+"-icon dIB vam'></span></span>":""!=f&&I?"<a data-zcqa='relatedList_"+d.fn(this)+"_"+n+"' id='relatedList_"+i.ENTITYID+"' title=\""+$ESAPI.encoder().encodeForHTMLAttribute(v)+'" onClick="javascript:openSheetForExport(\''+Crm.getCrmBasePath()+"/specific/ViewAttachment?fileId="+i.FILEID+"&module="+encodeURIComponent(crmRelatedList.Module)+"&parentId="+i.ParentId+"&creatorId="+i.CreaterId+"&id="+i.ENTITYID+"&name="+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(encodeURIComponent(v)))+"&downLoadMode="+f+'\');sE(event);" style="cursor: pointer"> <span><span class=\''+$ESAPI.encoder().encodeForHTMLAttribute(C)+"-icon dIB vam'></span></span>":"png"==C&&I?"<a data-zcqa='relatedList_"+d.fn(this)+"_"+n+"' id='relatedList_"+i.ENTITYID+"' title=\""+$ESAPI.encoder().encodeForHTMLAttribute(v)+'" onClick="showImagePreview(this)" href="'+Crm.getCrmBasePath()+"/ViewImage?fileId="+i.FILEID+"&module="+encodeURIComponent(crmRelatedList.Module)+"&parentId="+i.ParentId+"&creatorId="+i.CreaterId+"&id="+i.ENTITYID+"&name="+$ESAPI.encoder().encodeForHTMLAttribute(encodeURIComponent(v))+'&downLoadMode=default" class="cboxElement" style="cursor: pointer" name=\'cboxElement\'> <span><span class=\''+$ESAPI.encoder().encodeForHTMLAttribute(C)+"-icon dIB vam'></span></span>":"<a data-zcqa='relatedList_"+d.fn(this)+"_"+n+"' id='relatedList_"+i.ENTITYID+"' title=\""+$ESAPI.encoder().encodeForHTMLAttribute(v)+'" href="'+Crm.getCrmBasePath()+"/specific/ViewAttachment?fileId="+i.FILEID+"&module="+encodeURIComponent(crmRelatedList.Module)+"&parentId="+i.ParentId+"&creatorId="+i.CreaterId+"&id="+i.ENTITYID+"&name="+$ESAPI.encoder().encodeForHTMLAttribute(encodeURIComponent(v))+'&downLoadMode=default" style="cursor: pointer" title=\''+I18n.getMsg("crm.view.attachment.download")+" "+$ESAPI.encoder().encodeForHTMLAttribute(v)+"' > <span><span class='"+$ESAPI.encoder().encodeForHTMLAttribute(C)+"-icon dIB vam'></span></span>":null!=E&&1==E?c+="<a data-zcqa='relatedList_"+d.fn(this)+"_"+n+"' id='relatedList_"+i.ENTITYID+"' title=\""+$ESAPI.encoder().encodeForHTMLAttribute(v)+'" onClick="triggerLinkDocsView(\''+Crm.getCrmBasePath()+"/specific/ViewAttachment?fileId="+i.ZDOCS_FILEID+"&module="+encodeURIComponent(crmRelatedList.Module)+"&parentId="+i.ParentId+"&creatorId="+i.CreaterId+"&id="+i.ENTITYID+"&name="+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(encodeURIComponent(v)))+"&linkDocs=true','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(i.attachExt))+"','"+i.ENTITYID+'\');sE(event);" style="cursor: pointer"><span> <span class=\''+$ESAPI.encoder().encodeForHTMLAttribute(C)+"-icon dIB vam'></span></span>":null!=E&&2==E?1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI?c+='<div class = "link-iconAtc mR10 dIB vmiddle w90per" border="0" hspace="3" height="16px" width="16px" align="absmiddle"></div> <a data-zcqa=\'relatedList_'+d.fn(this)+"_"+n+"' id='relatedList_"+i.ENTITYID+"' title=\""+$ESAPI.encoder().encodeForHTMLAttribute(v)+'"  onClick="crmRelatedList.openLinkAndTitleChange(\''+Crm.getCrmBasePath()+"/specific/ViewAttachment?module="+encodeURIComponent(crmRelatedList.Module)+"&id="+i.ENTITYID+"&name="+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(encodeURIComponent(v)))+"&linkURL="+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(encodeURIComponent(i.linkURL)))+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(i.linkURL))+'\',this);sE(event);" target="_blank" style="cursor: pointer">':c+='<div class = "link-iconAtc mR10 dIB vmiddle" border="0" hspace="3" height="16px" width="16px" align="absmiddle"></div> <a data-zcqa=\'relatedList_'+d.fn(this)+"_"+n+"' id='relatedList_"+i.ENTITYID+"' title=\""+$ESAPI.encoder().encodeForHTMLAttribute(v)+'"  onClick="crmRelatedList.openLinkAndTitleChange(\''+Crm.getCrmBasePath()+"/specific/ViewAttachment?module="+encodeURIComponent(crmRelatedList.Module)+"&id="+i.ENTITYID+"&name="+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(encodeURIComponent(v)))+"&linkURL="+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(encodeURIComponent(i.linkURL)))+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(i.linkURL))+'\',this);sE(event);" target="_blank" style="cursor: pointer">':null!=E&&3==E&&(c+='<div class = "svgIcons ico-teamDrive mR10 dIB vmiddle" border="0" hspace="3" height="16px" width="16px" align="absmiddle"></div> <a data-zcqa=\'relatedList_'+d.fn(this)+"_"+n+"' id='relatedList_"+i.ENTITYID+"' title=\""+$ESAPI.encoder().encodeForHTMLAttribute(v)+'"  onClick="networkUtils.openUrl(\''+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(i.linkURL))+'\');sE(event);" rel="noopener noreferrer" target="_blank" style="cursor: pointer">'),null!=E&&3==E?1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI?c+='<span class="dIB ellipsistext vam" >'+d.fn(this)+'</span><span class="dIB mL10 vam"></span></a>':c+='<span class="dIB ellipsistext vam" style="max-width: 400px;">'+d.fn(this)+'</span><span class="dIB mL10 vam"></span></a>':c+=d.fn(this)+"</a>","mp3"!=g&&"wav"!=g||(c+='<span class="cP icon_play notPlaying dIB" onclick="playAudio(this,\''+i.ENTITYID+'\')" style="margin-left:10px;display: none;" onmouseover="setPlayOrPauseMessage(this);"></span>',c+="<audio id='"+i.ENTITYID+'_audio\' class="mt10" hidden="true" src="'+Crm.getCrmBasePath()+"/specific/ViewAttachment?fileId="+i.FILEID+"&module="+encodeURIComponent(crmRelatedList.Module)+"&parentId="+i.ParentId+"&creatorId="+i.CreaterId+"&id="+i.ENTITYID+"&name="+$ESAPI.encoder().encodeForHTMLAttribute(encodeURIComponent(v))+'" controls preload="none">'),c+="</div>"}else if("ATTACHMENTSIZE"==t[a].COLUMNNAME){var y=e;if(null!=(E=i.isLinkDocs)&&1==E&&(y=i.FILESIZE),null!=E&&(2==E||3==E))return"-";y.indexOf("KB")>-1?c=y.replace(/KB/g,I18n.getMsg("KB")):y.indexOf("MB")>-1&&(c=y.replace("/MB/g",I18n.getMsg("MB")))}else"MODIFIEDTIME"==t[a].COLUMNNAME&&(c="<span onmouseover=\"zctt.showtt('"+i.dateToolTip+'\')" onmouseout="zctt.hidett()">'+e+"</span>");else if("CHILDCAMPAIGNSPERSONALITY"==s){u="Crm_Implied_View_"+n;crmListView.changedPermissionsForZBModules.hasOwnProperty(u)&&(u=crmListView.changedPermissionsForZBModules[u]);c="";(u=Crm.userDetails.permissions[u])>-1?(2==i.CAMPAIGN_TYPE&&(c+='<span data-cid="subCampaigns" data-params=\'{"id":"'+i.ENTITYID+'","rid":"'+r+'"}\' class="cP svgIconsImg camTrArrow dIB vam mR8"></span>'),c+='<a data-cid="detailView" href="'+Crm.getCrmBasePath()+"/EntityInfo.do?id="+i.ENTITYID+"&module="+i.MODULE+'"'):c+='<a href="javascript:;" title="permission denied" data-permission="false"',c+='id="relatedList_'+i.ENTITYID+"\" data-zcqa='relatedList_"+d.fn(this)+"_"+n+'\' data-params=\'{"pfrom":"rel","module":"'+i.MODULE+'","id":"'+i.ENTITYID+'","recordNum":"'+recordNum+'","lookback":"true"}\' class="link',c+=o?' mL20">':'">',c+=d.fn(this)+"</a>"}else if("SURVEYPERSONALITY"==s){if("SOURCE"==t[a].COLUMNNAME)c=I18n.getMsg(e);else if("UNIQUEID"==t[a].COLUMNNAME){var R=i.uniqueId,b=encodeURIComponent(i.sEmail);c=i&&i.RESPONSEID&&"-1"===i.RESPONSEID?'<span class="f12" >'+I18n.getMsg("crm.survey.status.visited")+"</span>":null!=R&&0!=R?1==l?"<a href='javascript:void(0);' data-zcqa='viewResponse' onclick='ZSurvey.viewResponse(this);' data-params='{\"action\" : \"viewResponse\", \"uniqueid\":\""+R+'","responseid":"'+i.RESPONSEID+'" , "zcrmemail":"'+b+"\"}'>"+I18n.getMsg("crm.zsurvey.label.view.response")+"</a>":"<a href='javascript:void(0);' data-zcqa='viewResponse' onmouseenter=\"crmui.showTooltip('"+I18n.getMsg("crm.zsurvey.no.viewresponse.surveydisabled.brandchange",Crm.integrationsAppName.ZOHO_SURVEY)+'\');" onmouseleave="crmui.hideTooltip();">'+I18n.getMsg("crm.zsurvey.label.view.response")+"</a>":'<span class="f12" >'+I18n.getMsg("crm.survey.response.yettorespond")+"</span>"}}else if("LEADSPERSONALITY"==s||"CONTACTSPERSONALITY"==s)if("SERVICERESPONSEID"==t[a].COLUMNNAME){if(!validationUtils.isEmptyString(e)){var T=encodeURIComponent(i.Received_By);if(returnJson&&returnJson.Campaigns&&returnJson.Campaigns.surveyUniqueId&&!validationUtils.isEmptyString(T)){var D=returnJson.Campaigns.surveyUniqueId;c=1==l?'<a href=\'javascript:void(0);\' data-zcqa=\'viewResponse\' onclick=\'ZSurvey.viewResponse(this);\' data-params=\'{"hideSummary" : "true", "action" : "viewResponse", "uniqueid":"'+D+'","responseid":"'+e+'" , "zcrmemail":"'+T+"\"}'>"+I18n.getMsg("crm.zsurvey.label.view.response")+"</a>":"<a href='javascript:void(0);' data-zcqa='viewResponse' onmouseenter=\"crmui.showTooltip('"+I18n.getMsg("crm.zsurvey.no.viewresponse.surveydisabled.brandchange",Crm.integrationsAppName.ZOHO_SURVEY)+'\');" onmouseleave="crmui.hideTooltip();">'+I18n.getMsg("crm.zsurvey.label.view.response")+"</a>"}}}else"BACKSTAGE_NOOFTICKETS"==t[a].COLUMNNAME&&(c=e&&e.split&&2===e.split(" ").length?e.split(" ")[0]+" <span class='zBSEmptyChartImg zBSSmallTicketIcon dIB mL5'></span>":e);i.colorCode&&""!==i.colorCode&&(c="<div class='pR'><span class='dIB eventColor_lv_fr' data-zcqa='rlcolor_"+e+"' style='background: "+i.colorCode+"'></span></div>"+c);return c})),Handlebars.registerHelper("getDownloadLink",(function(e,t,a,i,n,r,s){var o="",l=i.isLinkDocs;if("ATTACHMENTSPERSONALITY"==s&&2!=l&&3!=l&&0==a){for(var d="",c=t.length,m=0;m<c;m++)if("NAME"==t[m].COLUMNNAME){d=i.CONTENT[m];break}var u="",v="";null!=l&&1==l?(u=i.ZDOCS_FILEID,v="&linkDocs=true"):(u=i.FILEID,v=""),o+='<div name="downloadcontainer" style="display:inline-block;"><a id="downloadlink" class="svgIconsImg dIB downloadLinkImg" href="'+Crm.getCrmBasePath()+"/specific/ViewAttachment?fileId="+u+"&module="+encodeURIComponent(crmRelatedList.Module)+"&parentId="+i.ParentId+"&creatorId="+i.CreaterId+"&id="+i.ENTITYID+"&name="+encodeURIComponent(d)+"&downLoadMode=default"+v,o+='" style="cursor: pointer"></a></div>'}return o})),Handlebars.registerHelper("checkSortArrow",(function(e,t,a,i){return""==e&&t==a||e==t?i.fn(this):i.inverse(this)})),Handlebars.registerHelper("getClassNames",(function(e){return e?e+" createlink rel_listRelationButton":"tb_newsmallbtn"})),Handlebars.registerHelper("getSplitValues",(function(e,t,a){return e.split(t)[a]})),Handlebars.registerHelper("getEditDeleteLinks",(function(e,t,a,i){return crmRelatedList.getEditDeleteLinks(e,t,a,this,i.data.root),i.fn(this)})),Handlebars.registerHelper("isSortableRL",(function(e,t,a){return 3==e||999==e||208==e||207==e||209==e||110==e||1e3==e||132==e||"POTSTAGEHISTPERSONALITY"==t?a.inverse(this):a.fn(this)})),Handlebars.registerHelper("ifNotInventoryModule",(function(e,t){return"Quotes"!=e&&"Invoices"!=e&&"PurchaseOrders"!=e&&"SalesOrders"!=e?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("isCustomCheckBoxChecked",(function(e,t,a){var i="CB_"+t;return CustomButtonJSObjectInit.checkBox&&CustomButtonJSObjectInit.checkBox[i]&&CustomButtonJSObjectInit.checkBox[i].length>0&&-1!=CustomButtonJSObjectInit.checkBox[i].indexOf(e)?a.fn(this):a.inverse(this)})),Handlebars.registerHelper("isHeaderCustomCheckBoxChecked",(function(e,t,a){var i="CB_"+t;if(void 0===CustomButtonJSObjectInit.checkBox||void 0===CustomButtonJSObjectInit.checkBox[i]||CustomButtonJSObjectInit.checkBox[i].length<=0)return a.inverse(this);if(e.body&&e.body.length>0){for(var n=e.body.length,r=0;r<n;r++){var s=e.body[r].ENTITYID;if(CustomButtonJSObjectInit.checkBox&&CustomButtonJSObjectInit.checkBox[i]&&CustomButtonJSObjectInit.checkBox[i].length>0&&CustomButtonJSObjectInit.checkBox[i].indexOf(s)<0)return a.inverse(this)}return a.fn(this)}})),Handlebars.registerHelper("checkStringRelList",(function(e,t,a,i,n,r,s,o){var l="";if(r.indexOf("LinkingModule")>-1&&(l=r,r=i.MODULE,i.searchmodule?r=i.searchmodule:i.isCustLookUp&&(r=e.MODULE)),n||(n=null),"Contact Roles"==r)r="Contacts";else if("Invited Events"==r){if("SUBJECT"==t[a].COLUMNNAME){var d=$("<ul/>",{class:"m0 modListMenuDD"}),c=$("<li/>",{class:"modListLi crm-font-regular f13 color_7 cP"});if(2==i.approveStatus){(u=c.clone()).attr("href","javascript;:"),u.text(I18n.getMsg("crm.approvalProcess.label.waitingForApproval")),d.html(u)}else{if(crmRelatedList.getEditDeleteLinks(s.listRelationId,i,s.module,crmRelatedList),crmRelatedList.links.editObj){var m=crmRelatedList.links.editObj,u=c.clone();m.isShowStatusChange?(u.attr("href","javascript:;").attr("data-zcqa",m.editzcqa).attr("onclick","javascript:showCampaignStatusDiv('"+m.url+"');retrun false;"),u.text(I18n.getMsg("crm.button.edit")),d.append(u)):m.isEditEntity?(u.attr("href",m.url).attr("data-zcqa",m.editzcqa).attr("data-cid",m.dataCid).attr("data-params",JSON.stringify(m.dataParams)),u.text(I18n.getMsg("crm.button.edit")),d.append(u)):m.isEventEdit&&(u.attr("href","javascript:;").attr("data-zcqa",m.editzcqa).attr("data-cid",m.dataCid).attr("data-params",JSON.stringify(m.dataParams)),u.text(I18n.getMsg("crm.button.edit")),d.append(u))}if(crmRelatedList.links.deleteObj){m=crmRelatedList.links.deleteObj;(u=c.clone()).attr("href","javascript;:").attr("data-zcqa",m.deletezcqa).attr("data-onclick","javascript:sortRelatedList('"+m.url+"')").attr("onclick","showDeletePopup('"+i.ENTITYID+"', 'crm.button.delete', '', '',  this, 'rl', undefined,false,'"+$ESAPI.encoder().encodeForJavaScript(i.CONTENT[0])+"')"),u.text(I18n.getMsg("crm.button.delete")),d.append(u)}if(crmRelatedList.links.removeObj){m=crmRelatedList.links.removeObj;(u=c.clone()).attr("href","javascript;:").attr("data-zcqa",m.removezcqa).attr("data-onclick",m.url).attr("data-stdt",i.stDt).attr("data-stat",i.status).attr("onclick","crmRelatedList.showRemovePopup(this, 'rl')"),u.text(I18n.getMsg("crm.label.event.remove.participant",[m.entityName])),d.append(u)}}var v=$("<div/>",{class:"scaleCont scaleZero"}).html(d),p=$("<div/>",{class:"p0 relListMenuDiv",style:"visibility: hidden;"}).append($("<i/>",{class:"setDDPopupLeft",style:"top: 14px;left: -8px;"}).append($("<i/>",{class:"setDDPopupLeftA"})));p.append(v);var h=$("<div/>",{class:"pR crm-font-regular f14 color_4"}).append($("<a/>",{"data-zcqa":"detailView","data-cid":"detailView",href:Crm.getCrmBasePath()+"/EntityInfo.do?id="+i.ENTITYID+"&module=Events",id:"relatedListView_"+i.ENTITYID,"data-params":"{'module':'Events', 'id':'"+i.ENTITYID+"'}",class:"link fL showModMenu textWarp"}).text(i.CONTENT[0]));if(h.append($("<div/>",{class:"pR fL mL10"}).append($("<span/>",{class:"moreOptions formBuildIconsSvg","data-zcqa":"RL_OptionsIcon",onclick:"crmRelatedList.showMenuList(this)"})).append(p)),i.colorCode&&""!==i.colorCode){var g="<div class='pR'><span class='dIB eventColor_lv_fr' data-zcqa='rlcolor_"+e+"' style='background: "+i.colorCode+"'></span></div>";$(g).insertBefore(h.find(".pR"))}return $("<div/>").html(h).html()}if("STATUS"==t[a].COLUMNNAME){var C="",f="";switch(e){case"5":C="noreplyDisc",f=I18n.getMsg("crm.label.event.invitation.not.sent");break;case"4":C="noreplyDisc",f=I18n.getMsg("crm.label.event.invitation.sent");break;case"1":C="greenDisc",f=I18n.getMsg("crm.label.event.invitation.accept");break;case"2":C="orangeDisc",f=I18n.getMsg("crm.label.event.invitation.may.be");break;case"3":C="redDisc",f=I18n.getMsg("crm.label.event.invitation.decline")}return"<em class='"+C+" vmiddle mR5'>&nbsp;</em>"+f}r="Activities"}else if("CheckLists"===r){var E,I=$("<div>");return"TITLE"===t[a].COLUMNNAME?(E=""===e||void 0===e?"("+I18n.getMsg("crm.untitled.default.label")+")":e,I.append($("<a>",{class:"link cP pR bpChkListRL",onclick:"ProcessFlow.toggleCheckLists(this)",chkLiId:i.checkListId}).text(E).append($("<span>",{class:"checkListArrow"})))):(E=I18n.getMsg("crm.process.completed.via.transition",$ESAPI.encoder().encodeForHTML(e)),I.append(E)),I.html()}if("Member Status"==t[a].COLUMNALIAS&&null!=i.REMARKS)return"<span style='cursor: pointer' onmouseout='zctt.hidett();' onmouseover='zctt.showtt( \""+i.REMARKS+"\")'>"+o.fn(this)+"</span>";if("object"!=typeof e&&void 0!==t){if(void 0===t[a])return;if(21==t[a].UITYPE){var y="",R="http";return""===e||0!=e.indexOf(R)&&0!=e.indexOf("https")?""!=e&&(y='<a data-cid="dummy" class="link" href="http://'+o.fn(this)+'" target="_blank">'+o.fn(this)+"</a>"):y='<a data-cid="dummy" class="link" href="'+o.fn(this)+'" target="_blank">'+o.fn(this)+"</a>",y}if(301==t[a].UITYPE||300==t[a].UITYPE){y="";return y=!0===e||"true"==e?'<img src="'+Search.spacerImg+'" class="yes">':'<img src="'+Search.spacerImg+'" class="no-new" width="9" height="9">'}if(100==t[a].UITYPE){y=o.fn(this);return""!=e&&(y=y.replace(/;/g,"; ")),y}if(22==t[a].UITYPE){y="";if(""!=e){var b=o.fn(this),T={screen_name:e,mode:"get_twitter_name"};(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/socialIntegration.do",data:T,async:!1,success:function(e){y=null!=e&&"null"!=e&&e.trim().length>0?' <a data-cid="dummy" class="link" href="'+RebrandLinkUtil.getProperties("TW_URL")+"/"+e+'" target="_blank"  id="subvalue_Twitter">'+b+"</a>":' <span id="subvalue_Twitter">'+b+"</span>"}})}return y}if(38===t[a].UITYPE){var D=parseFloat(o.fn(this));return"TIMESPENT"==t[a].COLUMNNAME||"AVERAGETIMESPENT"==t[a].COLUMNNAME?Utils.convertTimeInDoubleToReadableForm(o.fn(this)):isNaN(D)?"":!0===t[a].separator?o.fn(this):D}if(33===t[a].UITYPE){if(""===e)return o.fn(this);if(!1===i.ISCALLALLOWED||t[a].donotshow||"Activities"===r)return"<div class='phoneRtl dvphoneRtl' style='min-width:100%'>"+o.fn(this)+"</div>";if(null==returnJson[crmRelatedList.Module]||1!=returnJson[crmRelatedList.Module].isOutboundAllowed||t[a].donotshow){if(Crm.userDetails.ZPBENABLED){var w='asyncFn(crmCallsNew.getClick2CallPromise,"'+i.ENTITYID+'","'+r+'","'+$ESAPI.encoder().encodeForJavaScript(i.ENTITYNAME)+'")';return"<div class='phoneRtl' style='min-width:100%;position:relative;'>"+o.fn(this)+"<span style='position:absolute'><zpb-phone number='"+o.fn(this)+"' module='"+r+"' recordid='"+i.ENTITYID+"' callbackparamfn='"+w+"'></zpb-phone></span></div>"}return"<div onmouseover='editmouseover(this, \"phone\");' onmouseout='editmouseout(this, \"phone\");' class='phoneRtl dvphoneRtl' style='min-width:100%'>"+o.fn(this)+"<a style='visibility:hidden;' class='pH2 phoneRtl' title='"+I18n.getMsg("crm.phoneNo.Link.Title")+"' href='skype:"+e+"?call' onclick='sE();'></a></div>"}return"<div class='phoneRtl' style='min-width:100%'>"+o.fn(this)+"<a href='javascript:;' class='calliconOuter fN' onmouseover='CTIAPI.showCallButtonlabel(this)' onmouseout=\"CTIAPI.hideCallButtonlabel(this)\" onclick=\"sE();ctiApiNotifier.click2Call('"+$ESAPI.encoder().encodeForJavaScript(e)+"','"+Crm.userDetails.ZGID+"','"+Crm.userDetails.USER_ID+"','"+i.ENTITYID+"','','"+r+"','"+$ESAPI.encoder().encodeForJavaScript(i.ENTITYNAME)+"')\"><i class='callIcon'></i><span id='calllabel1'>"+I18n.getMsg("Call")+"</span></a></div>"}if("TIMESPENT"==t[a].COLUMNNAME||"AVERAGETIMESPENT"==t[a].COLUMNNAME)return Utils.convertTimeInDoubleToReadableForm(o.fn(this));if(32===t[a].UITYPE||38===t[a].UITYPE||52===t[a].UITYPE||117===t[a].UITYPE)return null!==t[a].separator&&t[a].separator,e;if(t[a].UITYPE==CrmField.UITYPES.SERVICE_DURATION)return Handlebars.helpers.setServiceDuration(e);var M;if(t[a].UITYPE===CrmField.UITYPES.PICK_LIST||t[a].UITYPE===CrmField.UITYPES.STAGE)return"Activities"!==r&&t[a].colorcode_enabled&&!0===t[a].colorcode_enabled&&""!==o.fn(this)?i.colorCode&&""!==i.colorCode?(M=getPLStyleObj(i.colorCode),"<span data-zcqa='colorcode_rellistvalue_"+r+"_"+t[a].FIELDID+"_"+o.fn(this)+"' class='colorAppliedPicklist' style='"+M+"'>"+o.fn(this)+"</span>"):(M=getPicklistStyleObj(e,t[a].picklistmap),"<span data-zcqa='colorcode_rellistvalue_"+r+"_"+t[a].FIELDID+"_"+o.fn(this)+"' class='colorAppliedPicklist' style='"+M+"'>"+o.fn(this)+"</span>"):o.fn(this);if(0==r.indexOf("CustomModule")&&"NAME"==t[a].COLUMNNAME||0==l.indexOf("LinkingModule")&&"NAME"==t[a].COLUMNNAME&&2!=t[a].UITYPE&&0!=s.name.indexOf("HISTORYPERSONALITY")||t[a].COLUMNNAME=={Leads:"LASTNAME",Activities:"SUBJECT",Accounts:"ACCOUNTNAME",Contacts:"LASTNAME",Potentials:"POTENTIALNAME",Campaigns:"CAMPAIGNNAME",Cases:"CASESUBJECT",Solutions:"SOLUTIONTITLE",Products:"PRODUCTNAME",Vendors:"VENDORNAME",PriceBooks:"BOOKNAME",Quotes:"QUOTESUBJECT",SalesOrders:"SALESORDERSUBJECT",PurchaseOrders:"PURCHASEORDERSUBJECT",Invoices:"INVOICESUBJECT",Forecasts:"FORECASTNAME",Visits:"VISITEDPAGE",Appointments:"APPOINTMENTNAME",Services:"SERVICENAME"}[r]||(r.indexOf("Leads")||r.indexOf("Contacts"))&&"FULLNAME"==t[a].COLUMNNAME||"Campaigns"===r&&"PARENT_CAMPAIGNID"==t[a].COLUMNNAME){var S=i.relContactId?i.relContactId:null,L="Crm_Implied_View_"+r;crmListView.changedPermissionsForZBModules.hasOwnProperty(L)&&(L=crmListView.changedPermissionsForZBModules[L]),L=Crm.userDetails.permissions[L];y="<a ";var A="<link-to ";l||i.MODULE,i.JID?i.JID:i.ENTITYID;return L>-1?t[a].JFIELDID&&"NAME"==t[a].COLUMNNAME?A+=' lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp=\'["'+l+'","'+i.JID+"\"]'":A+=' lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp=\'["'+i.MODULE+'","'+i.ENTITYID+"\"]'":y+='href="javascript:;" title="permission denied" data-permission="false"',t[a].JFIELDID&&"NAME"==t[a].COLUMNNAME&&i.JID?A+="data-zcqa='relatedList_"+o.fn(this)+"_"+r+"' lt-prop-id=\"relatedList_"+i.JID+"\" data-zcqa='relatedList_"+o.fn(this)+'\' lt-prop-td=\'{"pfrom":"rel","relContactId":"'+S+'","module":"'+l+'","id":"'+i.JID+'","cvid":"'+n+'","recordNum":"'+recordNum+'","lookback":"true"}\' lt-prop-class="link">':A+="data-zcqa='relatedList_"+o.fn(this)+"_"+r+"' lt-prop-id=\"relatedList_"+i.ENTITYID+"\" data-zcqa='relatedList_"+o.fn(this)+'\' lt-prop-td=\'{"pfrom":"rel","relContactId":"'+S+'","module":"'+i.MODULE+'","id":"'+i.ENTITYID+'","cvid":"'+n+'","recordNum":"'+recordNum+'","lookback":"true"}\' lt-prop-class="link">',y+='}\' class="link"',y+=">"+o.fn(this)+"</a>",A+=o.fn(this)+"</link-to>"}return o.fn(this)}if(void 0!==t[a]){if(4==t[a].UITYPE&&"Accounts"==i.MODULE)return o.fn(this.DISPLAYLABEL);if(4!=t[a].UITYPE||"Calls"!=i.MODULE&&"Tasks"!=i.MODULE&&"Events"!=i.MODULE){if("User"===e.MODULE||"Users"===e.MODULE)return'<span purpose="showUserBC" data-params=\'{"userId":"'+this.ENTITYID+"\"}'>"+o.fn(this.DISPLAYLABEL)+"</span>";L="Crm_Implied_View_";0==l.indexOf("LinkingModule")&&0==t[a].COLUMNNAME.indexOf("LINKINGMXN")&&2!=t[a].UITYPE&&0!=s.name.indexOf("HISTORYPERSONALITY")?L+=l:L+=r,crmListView.changedPermissionsForZBModules.hasOwnProperty(L)&&(L=crmListView.changedPermissionsForZBModules[L]),L=Crm.userDetails.permissions[L];y="<a ";return y+=L>-1?'data-cid="detailView" data-params=\'{"pfrom":"rel","relContactId":"null","module":"'+e.MODULE+'","id":"'+e.ENTITYID+"\",\"lookback\":\"true\"}' onclick=\"Crm.trackSpotLightAction('Lookup Click',{'Module':'"+e.MODULE+'\'});" onmouseenter="crmLookupBusinessCard.showLookupDetails(this)" onmouseout="crmui.hideTooltip()" href="'+Crm.getCrmBasePath()+"/EntityInfo.do?id="+e.ENTITYID+"&module="+e.MODULE+'"':'href="javascript:;" title="Permission denied" data-permission="false"',y+='id="relatedList_'+e.ENTITYID+"\" data-zcqa='relatedList_"+o.fn(this.DISPLAYLABEL)+"_"+r+'\' class="link">'+o.fn(this.DISPLAYLABEL)+"</a>"}var _=this.MODULE,L="Crm_Implied_View_"+_;crmListView.changedPermissionsForZBModules.hasOwnProperty(L)&&(L=crmListView.changedPermissionsForZBModules[L]),L=Crm.userDetails.permissions[L],_=_.slice(0,_.lastIndexOf("s"));var y="<a ";return y+=L>-1?'data-cid="detailView" data-params=\'{"pfrom":"rel","relContactId":"'+(i.relContactId?i.relContactId:null)+'","module":"'+this.MODULE+'","id":"'+this.ENTITYID+'","lookback":"true"}\' href="'+Crm.getCrmBasePath()+"/EntityInfo.do?id="+this.ENTITYID+"&module="+this.MODULE+'"onmouseover="showRelatedFields_new(\''+this.MODULE+"','"+this.ENTITYID+'\',this)" onmouseout="hideLoadingDiv();"':'href="javascript:;" title="permission denied" data-permission="false"',y+=' id="relatedList_'+this.ENTITYID+"\" data-zcqa='relatedList_"+o.fn(this.DISPLAYLABEL)+"_"+r+'\' class="link">',y+=o.fn(this.DISPLAYLABEL),y+="</a>"}})),Handlebars.registerHelper("showNoRecords",(function(e,t){var a=e.listRelationId||e.rid;return e.body&&0===e.body.length&&crmRelatedList.filters&&!crmRelatedList.filters[a]?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("setFilterComparators",(function(e){var t;e.disabled=!1,"Response"===e.SYS_REF_NAME&&"SERVICERESPONSEID"===e.COLUMNNAME?(e.disabled=!0,t=[{name:I18n.getMsg("crm.label.hyphenselect"),value:""}]):e.picklist_values?("-None-"===e.picklist_values[0].ActualValue&&e.picklist_values.splice(0,1),t=999===e.UITYPE?[{name:I18n.getMsg("contains"),value:"equal"}]:[{name:I18n.getMsg("is"),value:"equal"},{name:I18n.getMsg("isn't"),value:"not_equal"}]):32===e.UITYPE||34===e.UITYPE||36===e.UITYPE||38===e.UITYPE||40===e.UITYPE||52===e.UITYPE||116===e.UITYPE||143===e.UITYPE||144===e.UITYPE||145===e.UITYPE?t=[{name:I18n.getMsg("is"),value:"equal"},{name:I18n.getMsg("isn't"),value:"not_equal"}]:301===e.UITYPE?(t=[{name:I18n.getMsg("is"),value:"equal"}],e.picklist_values=[{DisplayValue:I18n.getMsg("crm.label.selected"),ActualValue:"true"},{DisplayValue:I18n.getMsg("crm.label.notSelected"),ActualValue:"false"}]):786===e.UITYPE||200===e.UITYPE||24===e.UITYPE||202===e.UITYPE||333===e.UITYPE?(e.showCal=!0,t=[{name:I18n.getMsg("On"),value:"equal"},{name:I18n.getMsg("Before"),value:"less_than"},{name:I18n.getMsg("After"),value:"greater_than"}]):20===e.UITYPE||8===e.UITYPE||221===e.UITYPE?(e.userType=!0,t=[{name:I18n.getMsg("is"),value:"equal"},{name:I18n.getMsg("isn't"),value:"not_equal"}]):t=[{name:I18n.getMsg("contains"),value:"contains"},{name:I18n.getMsg("doesn't contain"),value:"not_contains"}],e.filterComparators=t})),Handlebars.registerHelper("getRelatedListLabel",(function(e){return crmRelatedList.getPersonalityModuleObj(e).label})),Handlebars.registerHelper("getAPINameForFilters",(function(e){return e.campaign_member_field?"member_info."+e.SYS_REF_NAME:e.SYS_REF_NAME})),Handlebars.registerHelper("isCampaignMemberPersonality",(function(e,t,a,i){return"CONTACTSPERSONALITY"!=t&&"CAMPAIGNSPERSONALITY"!=t&&"LEADSPERSONALITY"!=t||a||!("Campaigns"===detailView.currentModule&&detailView.isIntegCampaign()||("Contacts"===detailView.currentModule||"Leads"===detailView.currentModule)&&-1!==[1,2,3,4,5,7,8].indexOf(e.$campaign_type))?i.inverse(this):i.fn(this)})),Handlebars.registerHelper("isTdHtmlNeeded",(function(e,t){return crmRelatedList.getPersonalityModuleObj(e).customButton?t.fn(this):t.inverse(this)})),Handlebars.registerHelper("isActivitySplitNotDone",(function(){return!Crm.isActivitySplitDone}));var dTemp,timer,CrmDashboard={clickEventIdVsMethodMapping:{customizeHome:"CrmDashboard.customizeHomePage",showPrintPreview:"CrmDashboard.showPrintPreview",setDomainNames:"CrmDashboard.setDomainNames",showEmbedUrl:"CrmDashboard.loadDashboards",showChatNotification:"Crm.loadChatIntegrations",showSlackNotification:"Crm.loadChatIntegrations",showCiscoNotification:"Crm.loadChatIntegrations",addToHome:"CrmDashboard.addToHome",showLayout:"CrmDashboard.showLayout",navigateLayout:"CrmDashboard.loadDashboards",addDashboardComponent:"CrmDashboard.validateLayout",customizeLayout:"CrmDashboard.loadDashboards",deleteLayout:"CrmDashboard.deleteDbAction",newWindow:"CrmDashboard.openDashboard",deleteComponent:"CrmDashboard.deleteDbAction",delDashboard:"CrmDashboard.deleteDbAction",getFavorites:"CrmDashboard.loadDashboards",changeStar:"CrmDashboard.changeStar",getReports:"CrmDashboard.loadDashboards",goBack:"CrmDashboard.goBack",deleteDashboard:"CrmDashboard.deleteDbAction",createDashboard:"CrmDashboard.validateDashboard",hidePopup:"CrmDashboard.hidePopup",addcomponent:"CrmDashboard.addComponent",editDashboard:"CrmDashboard.loadDashboards",refreshComponent:"CrmDashboard.loadDashboards",newDashboard:"CrmDashboard.loadDashboards",getCompDetails:"CrmDashboard.loadDashboards",AddComponent:"CrmDashboard.loadDashboards",showDashboard:"Crm.lyteTransition",addComponent:"CrmDashboard.addComponent",dashComponent:"CrmDashboard.showDashContainer",dashSettings:"CrmDashboard.showDashContainer",updateCrmVersion:"CrmDashboard.updateCrmVersion",refreshAllComponents:"CrmDashboard.refreshPageComponents",refreshDashboardComponent:"CrmDashboard.loadDashboards"},clickIdVsResObjMapping:{showOtherDashboard:"showdbItems",showDashboard:"showdbItems",createDashboard:"show",deleteDashboard:"show",userOptionChange:"showdbItems"},maxComponentAllowed:20,clickIdActionsMapping:{dashSettings:["editDashboard","delDashboard"],dashComponent:["AddComponent","deleteComponent","showPrintPreview","showChatNotification","showSlackNotification","showCiscoNotification","addToHome","showEmbedUrl"],report:["AddComponent"],gallery:["AddComponent"],Dashboards:["addDashboardComponent"]},ajaxActionMapping:{fetchRecords:"ReportsRelatedCV.do",loadHomePage:"HomePageLayout.do",showLayout:"HomePageLayout.do",navigateLayout:"NavigateByRecords.do",getCompDetails:"HomePageLayout.do",refreshComponent:"HomePageLayout.do",customizeLayout:"HomePageLayout.do",deleteLayout:"HomePageLayout.do",changeView:"HomePageLayout.do",refreshAllComponents:"HomePageLayout.do"},deleteIdMapping:{deleteComponent:"comp_dbItemId",delDashboard:"dash_dbId",deleteLayout:"layoutName_layoutId"},clickIdFocusMapping:{newDashboard:"dbName",editDashboard:"dbName",AddComponent:"header"},hideAjaxObj:["loadHomePage","populateChart","saveComponentChanges","setFavorites"],maxFavorites:10,changedFavorites:0,createLayoutContent:"",processingIds:[],processedIds:[],needToLoadContactImage:!0,layoutImageMap:{},layoutTypeIdMap:{},toRenderObj:{},chartCache:{},trendDashboardObj:{},trendDBUserList:void 0,trendDBGroupList:void 0,trendDBPeriodKeys:{day:"crm.label.today",week:"crm.thisweek",month:"crm.label.this.month",year:"crm.thisyear"},trendDBSubPeriods:{year:"month",month:"week",week:"day"},trendDBMaxDateFilters:4,periodSingularKeys:{day:"Day",week:"crm.emailstats.week",month:"Month",year:"crm.emailstats.year"},periodPluralKeys:{day:"days",week:"weeks",month:"months",year:"crm.label.years"},dashboardUserOrGroupCount:0,fromMicrosoftTeams:!1,fromAuditLog:!1,init:function(){CrmDashboard.typeVsChartImg={0:"big-table-chart",16:"big-horizontal-chart",13:"big-horizontal-chart",17:"big-horizontal-stacked-chart",14:"big-horizontal-stacked-chart",15:"big-horizontal-100-chart",3:"big-vertical-chart",5:"big-vertical-stacked-chart",10:"big-vertical-100-chart",6:"big-line-chart",9:"big-funnel-chart",8:"big-pie-chart",12:"big-area-chart",11:"big-donut-chart"},CrmDashboard.crm_csrf=csrfParamName+"="+encodeURIComponent(csrfToken),CrmDashboard.dashboardListTemplate=Handlebars.compile("<div class='leftinnermenu sel'><link-to lt-prop-route='crm.tab.dashboards.view' lt-prop-dp='[\"{{DBID}}\"]' lt-prop-id='dash_{{DBID}}' lt-prop-class='leftinnermenulinkto'>{{{DBNAME}}}</link-to><span class='gear_icon dIB dboard-set' data-cid='dashSettings' data-params='{\"dbId\":\"{{DBID}}\", \"type\":\"Dashboard\", \"ajaxLoad\":\"true\"}'></span></div>"),CrmDashboard.reportsTemplate=Handlebars.compile('{{#FORMRIGHTPANEL .}}<option value="{{REPORTID}}">{{{REPORTNAME}}}</option>{{/FORMRIGHTPANEL}}'),CrmDashboard.printChartOptions='<div id="printDashView" style="display:none"><div align="center" class="mT20 buttoncontainer"><input type="button" name="Print" class="newgraybtn" value="'+I18n.getMsg("crm.button.print")+'" onClick="window.print()"> <input type="button" name="Close" class="newgraybtn" value="'+I18n.getMsg("crm.button.close")+'" onClick="window.close()"></div><div class="p30"><div id="chartdiv" class="eventNone" style="width:640px;height:520px;"></div></div></div',Handlebars.registerPartial("TrendDashboardToolTip",Handlebars.templates.TrendDashboardToolTip),Handlebars.registerPartial("TrendDashboardFeatureSelector",Handlebars.templates.TrendDashboardFeatureSelector),Handlebars.registerPartial("TrendDashboardUserList",Handlebars.templates.TrendDashboardUserList),Handlebars.registerPartial("homePageComponent",Handlebars.templates.homePageComponent),Handlebars.registerPartial("navigateByRecords_home",Handlebars.templates.navigateByRecords_home),Handlebars.registerPartial("HomePageDetailsRow",Handlebars.templates.HomePageDetailsRow)},showaddcomponentUi:function(){$("#showHome").length>0&&($(".dashBrdContent").length===CrmDashboard.maxComponentAllowed?($("#addNewComponent").hide(),$("#addComponentErrorMsg").show()):($("#addNewComponent").show(),$("#addComponentErrorMsg").hide()))},loadDashboards:function(e,t,a,i,n){var r=$(t);if(!a&&r.attr("data-params")&&(a=JSON.parse(r.attr("data-params"))),"customizeLayout"===a.clickId&&"editLayout"===a.action){var s=r.closest(".grid-stack-item");if(s.attr("data-params")){var o=JSON.parse(s.attr("data-params"));if(o.isNewUserHomePage&&o.isDefaultLayout)return}}var l=a.clickId,d=a.url;if(l=l||a.action,CrmDashboard.favoriteTimeout&&"showDashboard"===l)CrmDashboard.setFavorites(void 0,a);else{if("undefined"!=typeof CrmAnalytics&&"customizeLayout"==a.clickId){var c=$("#"+a.layoutId),m={x:c.attr("data-gs-x"),y:c.attr("data-gs-y"),height:c.attr("data-gs-height"),width:c.attr("data-gs-width")};CrmDashboard.prevCoordinates=m}if(h=h||{},!d)if(l)d=CrmDashboard.ajaxActionMapping[l]?crmHistory.locationOrigin+Crm.getCrmBasePath()+"/"+CrmDashboard.ajaxActionMapping[l]:crmHistory.locationOrigin+Crm.getCrmBasePath()+"/specific/Dashboard.do";else{var u=window.location.href,v=networkUtils.parseUrl(u);if(u.indexOf("specific")>-1)d=v.action+".do";else d="specific/"+v.action+".do"}if(l&&(resObj=this.clickIdVsResObjMapping[l]?this.clickIdVsResObjMapping[l]:"dashboardPopup"),"addorUpdate"===a.clickId&&"undefined"!=typeof CrmAnalytics)var p=a.dbId;if(i)h=i;else if(a.queryStr)h=a.queryStr;else{var h={isload:!0};for(var g in a)/clickId|calleeObj|url|isDefaultLayout|isNewUserHomePage|displayMsg|hideObj/.test(g)||(h[g]=a[g])}if(CrmDashboard.hideAjaxObj.indexOf(l)<0)if("refreshComponent"===l||"refreshDashboardComponent"===l){if(event.stopPropagation(),a.module,r.closest(".refreshAnim").addClass("ref_visible"),r.find(".tb_small_loader").addClass("ref_loading"),CrmDashboard.isAnalyticsEnabled&&"undefined"!=typeof CrmAnalytics&&"refreshComponent"==l){var C=$("#"+a.layoutId);if(CrmAnalytics.insertLoader(C),"Dashboards"==a.module){p=JSON.parse($("#"+a.layoutId).attr("data-params")).dashboardId;delete CrmDashboard.chartCache[a.layoutId];var f=CrmAnalytics.base_url+"/"+p+"/components/"+a.dashletId+"/refresh";return void CrmAnalytics.getApiData(f,crmConstants.requestMethods.POST,(function(e){CrmDashboard.loadAnayticsChart(a.layoutId,a.dashletId,p),CrmDashboard.postRefreshComponentActions(r)}))}}}else loadAjaxTab("");if(0===parseInt($("#HomePage_Selector").find("a").attr("data-category"))&&"Dashboards"===h.module&&(h.noCache=!0),csrfParamName&&(h[csrfParamName]=encodeURIComponent(csrfToken)),"showDashboard"!=l)(new crmRequestPool).initiate({action:d,type:"POST",data:h,success:function(e){if(n&&CrmDashboard.loadDashboards(void 0,void 0,n),"refreshComponent"===l||"refreshDashboardComponent"===l)CrmDashboard.postRefreshComponentActions(r);else if("refreshAllComponents"===l){var t=$(".hview-refresh .tb_small_loader").removeClass("ref_loading").addClass("ref_complete");setTimeout((function(){t.removeClass("ref_complete")}),800)}else commonUtils.showHideLoadingDiv();if(a.hideObj&&CrmDashboard.hidePopup(void 0,!0,a.hideObj),e){if(CrmDashboard.isAnalyticsEnabled&&"undefined"!=typeof CrmAnalytics&&"loadHomePage"==a.clickId&&"Dashboards"!=a.module&&CrmAnalytics.setMinMaxDimensions("cv",a.layoutId),"refreshAllComponents"===a.clickId&&"success"===e){var i=null!=getObj("homePageView")?"homePageView":"dashboardItems";if(null!=i)return CrmDashboard.populateVisibleComponents(i),void $("#"+i).scroll($L.debounce((function(){CrmDashboard.populateVisibleComponents(this.id)}),300))}else if("addorUpdate"===a.clickId&&"cv"===a.type)CrmDashboard.addOrUpdateCVComponent(e,a);else if("addorUpdate"===a.clickId&&"widgets"===a.type)Utils.windowLocationHref(window.location.href);else if("addorUpdate"===a.clickId)p&&(e.dashboardId=p),CrmDashboard.addOrUpdateDbComponent(e,a);else if("refreshComponent"===a.clickId||"loadHomePage"===a.clickId||"navigateLayout"===a.clickId||"updateDefaultHomeCV"===a.action||"updateDefaultHomeCVRange"===a.action){var s=$("#HomePage_Selector").find("a").attr("data-category");if("Dashboards"===a.module&&"undefined"!=typeof CrmAnalytics&&CrmDashboard.isAnalyticsEnabled&&"undefined"!=typeof CrmAnalytics)return"0"!==s&&CrmDashboard.chartCache[a.layoutId]&&delete CrmDashboard.chartCache[a.layoutId],void CrmDashboard.loadAnayticsChart(e.layoutId,e.dashletId,e.dashboardId);if("Dashboards"===a.module)$("#datafetchdate_"+a.layoutId).length&&setDataFetchDate($("#datafetchdate_"+a.layoutId)[0],e.chartJson.dataFetchDate),"0"===s||CrmDashboard.chartCache[a.layoutId]&&CrmDashboard.chartCache[e.layoutId].dashletId===e.dbItemId||(CrmDashboard.chartCache[a.layoutId]=objectUtils.cloneObject(e)),CrmDashboard.createChart("chartdiv_"+a.layoutId,e.chartJson||e);else{if("Widgets"===a.module)return WidgetHandler.HomePage.render(a.dashletId),void $('[data-dashletid="'+a.dashletId+'"]').attr("data-loaded","true");if($("#datafetchdate_"+a.layoutId).length&&setDataFetchDate($("#datafetchdate_"+a.layoutId)[0]),"object"!=typeof e){if(e===I18n.getMsg("crm.component.permission.denied")){var o=a.layoutId;$("#layout_"+o).html("<br><br><div class='noPermissionDiv'><p class='noPermissionText'>"+I18n.getMsg("crm.analytics.components.permission.denied")+" <span class='svgIcons dIB vam mL5 info_icon cP' id='infoicon_permission_"+o+"' onmouseenter='CrmAnalytics.triggerPermissionPopover(this);'></span></p><lyte-hovercard id='infoicon_permission_popover_"+o+"' lt-prop-placement = 'bottom' lt-prop-class = 'hovercardPermissionClass' lt-prop-origin-elem='#infoicon_permission_"+o+"'><template is = 'registerYield' yield-name = 'hoverCardYield'><lyte-hovercard-content><p>"+I18n.getMsg("crm.analytics.components.permission.denied.tooltip.one")+"</p><p>"+I18n.getMsg("crm.analytics.components.permission.denied.tooltip.or")+"</p><p>"+I18n.getMsg("crm.analytics.components.permission.denied.tooltip.two")+"</p></lyte-hovercard-content></template></lyte-hovercard></div>")}else $("#layout_"+a.layoutId).html("<br><br><div class='noDataDiv' align='center'><span></span><h4>"+e+"</h4></div>");return void $("#"+a.layoutId).attr("data-loaded","true")}e.fromPage="homePage",e.category=s,"0"===s&&a.module&&(e.modname=I18n.getMsg(moduleRecordMapping[a.module].plural_label));var d=!0;e.body&&e.body[e.currentOption]&&(e.body[e.currentOption]=void 0,d=!1),e.isLast=d,CrmDashboard.renderCV(e,a.layoutId,s,h.module),CrmDashboard.needToLoadContactImage&&CrmDashboard.populateContactsImageMapAndLoadCv(e,a.layoutId,s,h.module)}}else if("deleteLayout"===a.clickId&&"SUCCESS"==e)CrmDashboard.deleteComponent(e,a);else if("delDashboard"===a.clickId){var c=$("#dash_"+a.dbId);$("#dbId").val()===a.dbId&&(c.next("a").length?c.next("a").click():$("#dash_0")[0].click()),c.remove()}else if("deleteComponent"===a.clickId&&"SUCCESS"==e){var m=$("#"+a.dbItemId);if(0!=m.find("span.selectedStar").length){var u=$("#favoritesCount");u.val(parseInt(u.val())-1)}m.remove();var v=$("#dashboardItemCount");v.val(parseInt(v.val())-1);var g=$("#dashboardItems");0===g.find("div.dashBrdContent").length&&(g.height(0),$("#addCompdiv").hide(),$("#emptyDashboard").css("display","")),Crm.sharedworker.makeRequest("trigger","trigger","CrmDashboard.findAndRemoveCachedVal",a.dbItemId),CrmDashboard.populateVisibleComponents("dashboardItems")}else if("populateChart"===a.clickId||"refreshDashboardComponent"===a.clickId){$("#datafetchdate_"+a.dbItemId).length&&setDataFetchDate($("#datafetchdate_"+a.dbItemId)[0],e.dataFetchDate);var C=$("#newDashWindow").val();"trenddb"==a.dbname||"trendDBOptionsChange"==a.action?(CrmIntelligence.disableResizableandFixWidth(),CrmDashboard.plotTrendDBGraph(a.dbItemId,e)):CrmDashboard.createChart("chartdiv_"+a.dbItemId,e,C),$("#"+a.dbItemId).attr("data-loaded","true")}else if("updateDashboard"===a.clickId){e=e.split("###"),$("#dbId").val()===e[0]&&$("#dbTitle").text(e[1]);var f=$("#dash_"+e[0]+" a"),E=(f=f.length>0?f:$("a#dash_"+e[0])).find("span");f.text(e[1]),f.prepend(E),CrmDashboard.hidePopup()}else if("getReportDetails"===a.action){$("#reportErrorMsg").hide();var I=$("#reportId");I.find("option.prevSelected").removeClass("prevSelected"),I.find("option:selected").addClass("prevSelected"),CrmDashboard.updateReportDetails(e,void 0,!1===a.checkGrouping)}else if("showOtherDashboard"===a.clickId){var y=$("<div>").html(e).find("#dbId").val();Lyte.Router.transitionTo({route:"crm.tab.dashboards.view",dynamicParams:[y]})}else if("dashboardContent"===a.clickId)CrmDashboard.createChart(a.clickId,e),$("#dashboardContent_componentName").html(e.chartTitle);else if("changeView"===a.clickId){CrmDashboard.showSelectedHomePage(e);var R=$("#HomeSelectorDD");if(!R.find('a[data-category="4"]').length){var b=R.find(".sel"),T=(s=parseInt(b.attr("data-category")),R.find('a[data-category="2"]').length);0===s&&T?cookieUtils.setCookie("classicId",b.attr("id")):2!==s&&T||cookieUtils.deleteCookie("classicId")}}else{if("dashboardPopup"===resObj||"deletepopup"===resObj){showAnimatePopup("dashboardPopup");var D=$("#dashboardPopup");D.hasClass("newInputStyleEle")&&D.find("input,select,textarea,.newSelect").focusin(setFocusClass).blur(removeFocusClass)}else CrmDashboard.hidePopup();$("#"+resObj).html(e),"customizeLayout"===l&&"editLayout"===h.action&&"Widgets"===h.module&&$("#module").trigger("change.select2")}$("#chartdiv_"+e.layoutId).find("#tablediv").length>0&&$("#"+e.layoutId+"_homeslack").remove()}else"dashboardContent"===a.clickId&&$("#dashboardContent").closest("td").hide();if(a.displayMsg&&crmui.showMsgBand("success",$ESAPI.encoder().encodeForHTML(a.displayMsg),"2000",""),CrmDashboard.clickIdFocusMapping[l]){var w=CrmDashboard.clickIdFocusMapping[l];$("#"+w)[0].focus(),setTimeout((function(){$("#"+w).focus()}),300)}},error:function(e){if(commonUtils.showHideLoadingDiv(),555!==e.status||"EXCEEDS LIMIT"!==e.responseText){if("changeView"===a.clickId&&555===e.status){renderingUtils.showCustomAlert(e.responseText,void 0,!1);var t=$("#getStart").length>0?"gettingStarted":$("#HomeSelectorDD").find(".sel").attr("id");$("[value="+a.customizationId+"]").remove(),$("#HomePage_Selector").val(t).trigger("change")}else if(e.responseText){if(555==e.status&&e.responseText){var i=e.responseText.split("###");2===i.length?(renderingUtils.displayErrorDiv(i[1],void 0,i[0]),$("#"+i[1]).focus()):alert(i[0])}else if(550==e.status){a.hideObj&&CrmDashboard.hidePopup(void 0,void 0,a.hideObj);var n=$("#lookupdiv");n.html(e.responseText),mailsetCenter("lookupdiv"),n.find('input[data-cid="back"]').removeAttr("data-cid").click((function(){CrmDashboard.hidePopup(void 0,void 0,"lookupdiv")}))}else CrmDashboard.hidePopup(void 0,void 0,"dashboardPopup");if("getReportDetails"===a.action){var r=$("#reportId");r.find("option.prevSelected").val()&&r.val(r.find("option.prevSelected").val()).trigger("change.select2")}else"navigateLayout"===a.clickId&&$("#home_next").after('<div class="next_disabled floatL"></div>').remove()}}else{var s=I18n.getMsg("crm.dashboard.add.component.error.msg",CrmDashboard.maxComponentAllowed);renderingUtils.showCustomAlert(s,void 0,!1)}}})}},deleteComponent:function(e,t){$("#"+t.layoutId).remove();var a=$("#lastSortOrderId");a.val(parseInt(a.val())-1),CrmDashboard.chartCache[t.layoutId]=void 0,CrmDashboard.populateVisibleComponents("homePageView"),CrmDashboard.showaddcomponentUi()},clickHandler:function(e,t,a){if(this.clickEventIdVsMethodMapping[a]){if("hidePopup"!=a){var i=$(t);"showDashboard"==a&&(i.trigger("mouseleave"),"Sales Follow-up Trend"!==i.attr("title")&&"Sales Trend"!==i.attr("title")||(CrmDashboard.trendDashboardObj={}));var n=JSON.parse(i.attr("data-params"));n.calleeObj="CrmDashboard",n.clickId=a,i.attr("data-params",JSON.stringify(n))}return Lyte.registeredMixins["crm-utilities"].executeFunctionByName(this.clickEventIdVsMethodMapping[a],window,e,t),!1}return!0},changeHomeView:function(e){$(".hview-refresh").remove(),3==e.category&&delete e.customizationId,e.customizationId===parseInt($("#HomePage_Selector").find("a").attr("id"))||3==e.category&&$("#getStart").length>0||(e.action="changeView",Lyte.Router.transitionTo({route:"crm.tab.module.begin",queryParams:{customizationId:e.customizationId,category:e.category},dynamicParams:["Home"]}).data={changeView:!0,dataObj:e})},specialcharcheck:function(e,t){var a;if(a=t?/[^~`#^&*+={}()%[\]|;"<>\\]/g:/[^~`#^&*+={}[\]|;"<>\\]/g,""!=getClrTxtPtnResChars(e,a))return!0},deleteDbAction:function(e,t){var a=$(t),i=JSON.parse(a.attr("data-params"));if(a.hasClass("fromDeletePopup"))i[csrfParamName]=encodeURIComponent(csrfToken),i.hideObj="deletepopup",i.displayMsg=I18n.getMsg("crm.label.deleted.successfully"),i.customizationId=$("#HomePage_Selector").find("a").attr("id"),CrmDashboard.loadDashboards(void 0,void 0,i);else{var n=CrmDashboard.deleteIdMapping[i.clickId].split("_"),r=$("#"+n[0]+"_"+i[n[1]]).text(),s="delDashboard"===i.clickId?I18n.getMsg("crm.warning.delete.dashboard","Dashboard"):I18n.getMsg("crm.warning.delete.component",r);showDeletePopup(s,"crm.button.mass.delete","","crm.delete.warning",t)}},createOptions:function(e,t,a,i,n){var r="";for(var s in e){var o=e[s].split(":");n&&o.length>3&&(e[s]=o[0]+":"+o[1]+":"+o[2]),r+='<option value="'+$ESAPI.encoder().encodeForHTMLAttribute(e[s])+'">'+$ESAPI.encoder().encodeForHTML(s)+"</option>"}return t.html(r).find('option[value="'+a+'"]').attr("selected","selected"),r},updateReportDetails:function(e,t,a){if(t||(t={}),e.summaryCols){var i=a?$("#yaxis"):$('select[name="yaxis"]'),n=CrmDashboard.createOptions(e.summaryCols,i,t.dataColumn,a);a&&(i.closest(".tabDivCreate").show(),thirdPartyUtils.bindSelect2(i),CrmDashboard.showHideCountOptions(i[0]));var r=$('select[name="yaxis2"]').html(n);t.dataColumn2&&r.find('option[value="'+t.dataColumn2+'"]').prop("selected",!0)}if(e.groupingCols){n=CrmDashboard.createOptions(e.groupingCols,$('select[name="xaxis"]'),t.catagoryColumn,void 0,!0);$('select[name="series"]').html(n).find('option[value="'+t.seriesColumn+'"]').prop("selected",!0),$("#series option[value='CrmActivity:ACTIVITYTYPE:Host or Participant']").remove(),$("#series option[value='CrmActivitiesSharing:SHAREDTO:Host or Participant']").remove()}if(e.dateFields){var s=Handlebars.templates.kpiDateColTemplate(e.dateFields),o=$("#kpi_dateFields");o.html(s).find('option[value="'+t.catagoryColumn+'"]').prop("selected",!0),o.trigger("change.select2")}},getReportDetails:function(e){var t=$("#reportId").val();if(t){var a={};a.srcReport=t,a.action="getReportDetails",a.clickId="customizeDashboard",!0===e&&(a.checkGrouping=!1,$("#yaxis").closest(".tabDivCreate").hide()),$("#isFromGallery").length&&(a.isFromGallery=!0),a.isload=!0,this.loadDashboards(void 0,void 0,a)}},hidePopup:function(e,t,a){if(!a){a="dashboardPopup";var i=$(t).attr("data-params");if(i)a=JSON.parse(i).id}for(var n=(a=a.split(",")).length,r=0;r<n;r++)"dashboardPopup"!==a[r]&&$("#"+a[r]).hide();hideAnimatePopup("dashboardPopup","true"),"dashboardPopup"!==a&&removeFreezeLayer()},enableSortable:function(e,t,a){$("#"+e).sortable({placeholder:"ui-state-highlight fL mR30 mB30",handle:".sortClass",opacity:.6,cursor:"move",start:function(e,i){i.placeholder.css({width:i.item.width(),height:i.item.outerHeight(),"box-sizing":"border-box"}),CrmDashboard.saveComponentChanges(t,a)},sort:function(){CrmDashboard.saveComponentChanges(t,a)},update:function(e){if(CrmDashboard.sortOrderChanged=!0,a){var i=$("#showHome"),n=i.find("."+t).length-1;i.find("."+t).eq(n).after($("#addNewComponent"))}CrmDashboard.saveComponentChanges(t,a);var r=a?"homePageView":"dashboardItems";CrmDashboard.populateVisibleComponents(r),renderingUtils.stopEvent(e)}})},enableResize:function(e,t,a){a=a?a.not(".dashBrdContent_kpi"):$("."+e).not(".dashBrdContent_kpi");var i=t?"homePageView":"dashboardItems",n=$("#"+i).height()-20,r=a.parent().width()-40;a.resizable({minHeight:300,minWidth:500,maxHeight:n,maxWidth:r,resize:function(){CrmDashboard.saveComponentChanges(e,t)},stop:function(a,n){CrmDashboard.resizeComponent(n),CrmDashboard.saveComponentChanges(e,t),CrmDashboard.populateVisibleComponents(i)}})},resizeComponent:function(e,t){var a=e.element,i=a.attr("id");if("fromCustomHome"===t)var n=$("#customModule_Holder");else n=a.parent();var r=n.height(),s=$(window).height(),o=a.height(),l=parseInt(a.css("width")),d=(l/n.width()*100).toFixed(2);a.css("width",d+"%");var c=r/s*100,m=a.find("#chartdiv_"+i).width(l-40).height(o-60);if(m.find("#tablediv").height(o-60),m.highcharts()){m.highcharts().reflow();var u=m.find(".highcharts-container");u.width(u.width()-1).width(m.width())}var v={width:d,height:(o/r*100).toFixed(2)+","+c.toFixed(2)};if("fromCustomHome"!==t)CrmDashboard.resizedComponentDetails||(CrmDashboard.resizedComponentDetails={}),CrmDashboard.resizedComponentDetails[i]=v;else{var p=JSON.parse(a.attr("data-params"));p.layoutProps=v,a.attr("data-params",JSON.stringify(p))}},setDashboardHeight:function(e,t,a,i){if(e){!t&&a&&(t=e[a]);var n=$("#"+t);if(null!=i)var r=i;else r=$(window).height();if(n.hasClass("dashBrdContent_kpi"))$("#chartdiv_"+t).css("min-height","95px");else if(e.layoutProps&&(e=e.layoutProps),e&&e.height){var s=e.height.split(","),o=s[1]*r/100,l=s[0]*o/100;n.height(l);var d=$("#chartdiv_"+t);d.height(l-60),e.dateFilters&&(CrmDashboard.formFiltersForDefaultCharts(e,t),d.height(l-100))}}},populateCharts:function(e,t,a){var i=e.length,n="id";"homePageView"===t&&(n="layoutId");for(var r=0;r<i;r++)CrmDashboard.setDashboardHeight(e[r],void 0,n,a);"homePageView"===t&&$("#addNewComponent").length&&CrmDashboard.setaddComponentSize(),CrmDashboard.populateVisibleComponents(t)},setaddComponentSize:function(){var e=$("#addNewComponent"),t=e.prev("div.dashBrdContent"),a="350px",i="47%";t.length&&(a=e.offset().left>t.offset().left?t.css("height"):parseInt(t.css("height"))>350?"350px":t.css("height"),i=parseInt(t[0].style.width)<=45?parseInt(t[0].style.width)+"%":"47%"),e[0].style.width=i,e[0].style.height=a},setScrollTimeout:function(e){e instanceof jQuery||(e=$(e)),e.data("scrollTimeout")&&clearTimeout(e.data("scrollTimeout")),e.data("scrollTimeout",setTimeout((function(){CrmDashboard.populateVisibleComponents(e.attr("id"))}),300))},populateVisibleComponents:function(e){var t=CrmDashboard.getVisibleComponentIds(e);if(t){var a=t.length;a>2&&(a=2,CrmDashboard.setScrollTimeout($("#"+e)));var i=$("#"+e);if(i.find('div.grid-stack-item[data-loaded="loading"]').length>4)CrmDashboard.setScrollTimeout(i);else for(var n=0;n<a;n++){var r=t[n],s=Object.keys(r),o=r[s];if($("#"+s).attr("data-loaded","loading"),"loadHomePage"===o.clickId&&"Dashboards"===o.module&&CrmDashboard.isAnalyticsEnabled&&"undefined"!=typeof CrmAnalytics)CrmDashboard.loadAnayticsChart(o.layoutId,o.dashletId,o.dashboardId),setDataFetchDate($("#datafetchdate_"+o.layoutId)[0]);else if("loadHomePage"==o.clickId&&"Dashboards"===o.module&&CrmDashboard.chartCache[o.layoutId]){setDataFetchDate($("#datafetchdate_"+o.layoutId)[0],CrmDashboard.chartCache[o.layoutId].chartJson.dataFetchDate);var l=objectUtils.cloneObject(CrmDashboard.chartCache[o.layoutId].chartJson);CrmDashboard.createChart("chartdiv_"+o.layoutId,l),$("#"+o.layoutId).attr("data-loaded","true")}else"customHome"===e?CustomHomePage.loadComponent(o):"loadHomePage"==o.clickId&&"Widgets"===o.module?("undefined"!=typeof CrmAnalytics&&CrmAnalytics.setMinMaxDimensions("widget",o.layoutId),WidgetHandler.HomePage.render(o.dashletId),$('[data-dashletid="'+o.dashletId+'"]').attr("data-loaded","true")):CrmDashboard.loadDashboards(void 0,void 0,o)}}},getVisibleComponentIds:function(e){var t=$("#"+e),a=t.find('div.dashBrdContent[data-loaded="false"]'),i=a.length;if(0===i)return t.off("scroll"),void("dashboardItems"===e&&t.scroll((function(){$("#dashContainer").hide(),$("#embedUrl").hide()})));for(var n=[],r=t.offset().top,s=r+t.height(),o={},l=0;l<i;l++){var d=a.eq(l),c=d.offset().top,m=c+d.height();if(c>=r&&c<=s||m>=r&&m<=s){o=JSON.parse(d.attr("data-params"));var u={};u[d.attr("id")]=o,n.push(u)}}return n},getComponentChanges:function(e){for(var t={},a=e.split(","),i=a.length,n=0;n<i;n++){var r=a[n],s={};CrmDashboard.resizedComponentDetails&&CrmDashboard.resizedComponentDetails[r]&&(s=CrmDashboard.resizedComponentDetails[r]),s.order=n+1,t[r]=s}return t},saveComponentChanges:function(e,t){clearTimeout(CrmDashboard.timeoutVal);var a=$("#dbId");if(a.length)var i=a.val();var n=$("."+e);CrmDashboard.timeoutVal=setTimeout((function(){if(n.hasClass("ui-sortable-placeholder"))CrmDashboard.saveComponentChanges(e,t);else{var a=CrmDashboard.getdbItemIdList(n),r={};CrmDashboard.sortOrderChanged&&(i&&0==i?r.dbItemIds=a:r.compSizeJson=JSON.stringify(CrmDashboard.getComponentChanges(a))),CrmDashboard.resizedComponentDetails&&!r.compSizeJson&&(r.compSizeJson=JSON.stringify(CrmDashboard.resizedComponentDetails)),(r.compSizeJson||r.dbItemIds)&&(r[csrfParamName]=encodeURIComponent(csrfToken),r.action="saveComponentChanges",r.clickId="saveComponentChanges",t?r.url=Crm.getCrmBasePath()+"/HomePageLayout.do":r.dbId=i,CrmDashboard.loadDashboards(void 0,void 0,r)),CrmDashboard.resizedComponentDetails=void 0,CrmDashboard.sortOrderChanged=!1}}),5e3)},changeStar:function(e,t){if(clearTimeout(CrmDashboard.favoriteTimeout),(t=$(t)).hasClass("emptyStar")){if(parseInt($("#favoritesCount").val())+CrmDashboard.changedFavorites>=CrmDashboard.maxFavorites)return void alert(I18n.getMsg("crm.alert.favorite.dashboard.maxlimit"));CrmDashboard.changedFavorites++,"2"==(a=t.addClass("selectedStar").removeClass("emptyStar").closest("div.dashBrdContent")).attr("data-value")?a.removeAttr("data-value"):a.attr("data-value","1")}else{var a;CrmDashboard.changedFavorites--,"1"==(a=t.removeClass("selectedStar").addClass("emptyStar").closest("div.dashBrdContent")).attr("data-value")?a.removeAttr("data-value"):a.attr("data-value","2")}var i=CrmDashboard.getFavoritesParams();CrmDashboard.favoriteTimeout=setTimeout((function(){CrmDashboard.setFavorites(i)}),3e3)},getFavoritesParams:function(){var e={action:"setFavorites"},t=$("#dashboardItems").find("div.dashBrdContent");e.removedFavorites=CrmDashboard.getFavorites(t.filter('[data-value="2"]'));var a=$("#dbId").val();return"0"!==a&&(e.favorites=CrmDashboard.getFavorites(t.filter('[data-value="1"]'))),e.clickId="setFavorites",e.dbId=a,e[csrfParamName]=encodeURIComponent(csrfToken),e},setFavorites:function(e,t){e||(e=CrmDashboard.getFavoritesParams()),$("#dashboardItems").find("div.dashBrdContent").removeAttr("data-value"),clearTimeout(CrmDashboard.favoriteTimeout),CrmDashboard.favoriteTimeout=void 0;var a=$("#favoritesCount");a.val(parseInt(a.val())+CrmDashboard.changedFavorites),CrmDashboard.changedFavorites=0,e.removedFavorites||e.favorites?CrmDashboard.loadDashboards(void 0,void 0,e,void 0,t):t&&CrmDashboard.loadDashboards(void 0,void 0,t)},getdbItemIdList:function(e){var t=e.length,a="";if(t>0){a=e.eq(0).attr("id");for(var i=1;i<t;i++)a+=","+e.eq(i).attr("id")}return a},getFavorites:function(e){var t=e.length,a="";if(t>0){a=JSON.parse(e.eq(0).attr("data-params")).dbItemId;for(var i=1;i<t;i++)a+=","+JSON.parse(e.eq(i).attr("data-params")).dbItemId}return a},showDashContainer:function(e,t){var a=$(t),i=a.attr("data-cid"),n=$("#dashContainer").find("a"),r=CrmDashboard.clickIdActionsMapping[i],s=JSON.parse(a.attr("data-params")),o=a.attr("data-editnotneeded");s.clickId=void 0;var l=r.length,d=s.catagory;if(s.catagory=void 0,void 0!==s.chartType){var c=s.isKpi="kpi"===s.chartType;delete s.chartType}for(var m=n.length,u=0;u<m;u++)if(s.action=r[u],"showChatNotification"!==s.action||"false"!==$("#isChatConfigured").val()&&!c){var v=$("#chartdiv_"+s.dbItemId);"showSlackNotification"===s.action&&(c||"false"===$("#isSlackConfigured").val()||v.find("#tablediv").length>0)?$(n[u]).removeAttr("data-cid").removeAttr("data-params").hide():(v.find("#tablediv").length||c)&&"showEmbedUrl"===s.action||(0==d||2==d)&&("deleteComponent"===s.action||"delDashboard"===s.action)||d>2&&"AddComponent"===s.action?$(n[u]).addClass("disabled").removeAttr("data-cid").removeAttr("data-params"):u>=l?$(n[u]).hide().prev("div.dash_dd_sep").hide():("showChatNotification"===s.action&&(s.reqFrom="analytics",s.chatType="cliq"),"showSlackNotification"===s.action&&(s.reqFrom="analytics",s.chatType="slack"),"showCiscoNotification"===s.action&&(s.reqFrom="analytics",s.chatType="cisco"),$(n[u]).attr("data-params",JSON.stringify(s)).attr("data-zcqa",s.action).attr("data-cid",s.action).removeClass("disabled").show().prev("div.dash_dd_sep").show(),delete s.isKpi,s.chatType&&(delete s.chatType,delete s.reqFrom),"true"===o&&"deleteComponent"!==s.action&&$(n[u]).addClass("disabled").removeAttr("data-cid").removeAttr("data-params"))}else $(n[u]).removeAttr("data-cid").removeAttr("data-params").hide();var p={id:"dashContainer",clickSelector:"a"};Crm.menu.createMenu(e,p),$("#dashContainer").on("onBeforeShow",(function(e,t){var a=renderingUtils.getTargetElem(t);$(a).addClass("sankar")})).on("onBeforeClose",(function(){$("#dashboardList .sankar").removeClass("sankar"),$(this).off("onBeforeClose").off("onBeforeShow")}))},openDashboard:function(e,t){var a=JSON.parse($(t).attr("data-params")),i=Crm.getCrmBasePath()+"/tab/Dashboards/"+a.dbId+"/expand";a.isAnalyticsTrends&&(i+="?isAnalyticsTrends="+a.isAnalyticsTrends);var n="height="+$(window).height()-700+"top=0,left=0,menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes";window.lookUpWin=window.open(Crm.getOrgSpecificURL(i),"newPopup",n)},limitSeriesValues:function(e){var t=75,a=e.series.length;if(a>t&&"object"==typeof e.series[0].data&&e.series[0].data.length>t){var i=a-t;e.series.splice(t,i),i=e.xAxis.categories.length-t,e.xAxis.categories.splice(t,i);for(var n=0;n<t;n++)e.series[n].data.splice(t,i)}},setChartOptions:function(e){var t=CrmDashboard.getHighChartOptions();if(e.colors=["#F26E6E","#FF92BE","#8C79DE","#2C97DE","#0AD3FF","#38E4AE","#63D471","#ADD463","#ED7F65","#E99E5B","#FCE970","#C39878","#EBDCB5"],e.tooltip={borderWidth:2,style:{padding:0},useHTML:!0,formatter:t.tooltip.formatter},e.plotOptions&&e.plotOptions[e.chart.type])switch(e.chart.type){case"column":e.plotOptions.column.dataLabels=e.plotOptions.column.dataLabels?e.plotOptions.column.dataLabels:{},e.plotOptions.column.dataLabels.formatter=t.plotOptions.column.dataLabels.formatter;break;case"bar":e.plotOptions.bar.dataLabels=e.plotOptions.bar.dataLabels?e.plotOptions.bar.dataLabels:{},e.plotOptions.bar.dataLabels.formatter=t.plotOptions.bar.dataLabels.formatter;break;case"areaspline":e.plotOptions.areaspline.dataLabels=e.plotOptions.areaspline.dataLabels?e.plotOptions.areaspline.dataLabels:{},e.plotOptions.areaspline.dataLabels.formatter=t.plotOptions.areaspline.dataLabels.formatter;break;case"pie":e.plotOptions.pie.dataLabels=e.plotOptions.pie.dataLabels?e.plotOptions.pie.dataLabels:{},e.plotOptions.pie.dataLabels.formatter=t.plotOptions.pie.dataLabels.formatter;break;case"funnel":e.plotOptions.funnel.dataLabels=e.plotOptions.funnel.dataLabels?e.plotOptions.funnel.dataLabels:{},e.plotOptions.funnel.dataLabels.formatter=t.plotOptions.funnel.dataLabels.formatter}e.legend&&(e.legend.labelFormatter=function(){return $ESAPI.encoder().encodeForHTML(this.name)})},createChart:function(e,t,a){var i=$("#"+e),n=i.parent().height();if(i.length)if(a&&($("#parentChartDiv").height("480px"),i.height(n-100),Crm.isZohoChartsEnabled&&t.component_type))ZChartRenderer.renderComponent(t,void 0,e);else if(!t.msg&&t.series&&t.series[0]&&t.series[0].data.length>0){"undefined"!=typeof CrmAnalytics&&CrmDashboard.setChartOptions(t),i.closest(".dashBrdContent").show(),CrmDashboard.limitSeriesValues(t);var r="";if("tabular"==t.chart.type)t.dbItemId=e,r=i.html(Handlebars.templates.tabularChart(t)).find("#tablediv").find("table").eq(0),i.find("#tablediv").height(i.height());else{if("KPI"==t.chart.type)return void CrmDashboard.processKpiData(t,e);if(!t.processed){t.xAxis&&(t.xAxis.title.text=$ESAPI.encoder().encodeForHTML(t.xAxis.title.text)),t.yAxis&&(t.yAxis.title.originalText=t.yAxis.title.text,t.yAxis.title.text=$ESAPI.encoder().encodeForHTML(t.yAxis.title.text));var s=t.additionalInfo&&void 0!==t.additionalInfo.decimalDigits?t.additionalInfo.decimalDigits:void 0,o=t.chart.type;if(("bar"==o||"column"===o)&&t.plotOptions[o].stacking){var l=t.plotOptions[o].stacking;t.tooltip={borderWidth:2,useHTML:!0,shared:!0,formatter:function(){for(var e="<b>"+$ESAPI.encoder().encodeForHTML(this.x)+"</b>",a=this.points.length,i=this.points[0].series.chart.options,n=i.chart.type,r=i.additionalInfo&&void 0!==t.additionalInfo.decimalDigits?t.additionalInfo.decimalDigits:void 0,s=0;s<a;s++){var o=this.points[s];if(o.percentage){var l=o.y;i.currencyColumn&&void 0===i.currency||!0===o.series.userOptions.currency?l=currencyUtils.returnValueInDefaultCurrency(Crm.userDetails.BASE_CURRENCY,o.y):r&&(l=commonUtils.formatDecimalValue(l,r,!0)),e+='<br><span style="color:'+o.series.color+'" class="p0 mR3">●</span>'+$ESAPI.encoder().encodeForHTML(o.series.name)+" : "+l+("percent"===i.plotOptions[n].stacking?" ("+o.percentage.toFixed(2)+"%)":"")}}return e}}}t.currencyColumn&&("pie"===t.chart.type?t.plotOptions[t.chart.type].dataLabels.formatter=function(){return $ESAPI.encoder().encodeForHTML(this.point.name)+"<br><span class='dB nwrp'>"+(0===this.y||void 0!==this.series.userOptions.currency&&!0!==this.series.userOptions.currency?0===this.y?"":this.y:currencyUtils.returnValueInDefaultCurrency(Crm.userDetails.BASE_CURRENCY,this.y))+" ( "+this.percentage.toFixed(2)+"% )</span>"}:"funnel"!==t.chart.type&&"percent"!==l&&(t.plotOptions[t.chart.type].dataLabels.formatter=function(){var e=this.series.userOptions.decimalDigits?this.series.userOptions.decimalDigits:s;return 0===this.y||void 0!==this.series.userOptions.currency&&!0!==this.series.userOptions.currency?0===this.y?"":commonUtils.formatDecimalValue(this.y,e,!0):currencyUtils.returnValueInDefaultCurrency(Crm.userDetails.BASE_CURRENCY,this.y)}),l||(t.tooltip={borderWidth:2,style:{padding:0},useHTML:!0,formatter:function(){var e=this.series.userOptions.decimalDigits?this.series.userOptions.decimalDigits:s;return"<b>"+$ESAPI.encoder().encodeForHTML(this.series.name)+"</b></br>"+this.key+" : "+(void 0===this.series.userOptions.currency||!0===this.series.userOptions.currency?currencyUtils.returnValueInDefaultCurrency(Crm.userDetails.BASE_CURRENCY,this.y):commonUtils.formatDecimalValue(this.y,e,!0))}})),"bar"!=t.chart.type&&"column"!==t.chart.type&&"line"!==t.chart.type&&"areaspline"!==t.chart.type||(t.xAxis.labels.formatter=function(){var e=this.value;return e.length>23?$ESAPI.encoder().encodeForHTML(e.substring(0,23))+"...":$ESAPI.encoder().encodeForHTML(e)},"bar"!==t.chart.type&&(t.xAxis.labels.rotation=-45)),t.plotOptions.series.point={events:{click:function(e){$(renderingUtils.getTargetElem(e)).closest("div.dashBrdContent").addClass("ptClick"),CrmDashboard.fetchRecords(this,e),renderingUtils.stopEvent(e)}}},t.isDefaultChart&&(t.plotOptions.series.point={events:{click:function(e){CrmDashboard.fetchDefaultChartRecords(t.xAxis.categories,e,this)}}},t.legend.labelFormatter=function(){var e=0;if("Pipeline"!==this.name)for(var t=this.options.data.length,a=0;a<t;a++)e+=this.options.data[a];return this.name+(e?"("+e+")":"")}),t.processed=!0}i.highcharts(t),r=i.prepend("<br><br>").find(".highcharts-container")}t.isDefaultChart||(r.find("div.highcharts-data-labels").click((function(e){var t=$(renderingUtils.getTargetElem(e)),a=t.closest("div.dashBrdContent").addClass("ptClick");renderingUtils.stopEvent(e);var i=t.closest(".highcharts-data-labels").prevAll(".highcharts-data-labels").length,n=t.closest("div").prevAll("div").length;a.children("div").eq(1).highcharts().series[i].data[n].firePointEvent("click")})),a||r.addClass("cP").click((function(e){CrmDashboard.showReport(t.reportId,e)})))}else if(a&&"fromCustomHome"!=a)i.closest(".dashBrdContent").hide();else{var d=t.msg?t.msg:"crm.data.not.available";i.parent().hasClass("dashBrdContent_kpi")?i.html("<br><br>"+I18n.getMsg(d)):i.html("<br><br><div class='noDataDiv' align='center'><span></span><h4>"+I18n.getMsg(d)+"</h4></div>")}},fetchRecords:function(e,t){var a=[],i=$(renderingUtils.getTargetElem(t)).closest("div.dashBrdContent");i.addClass("ptClick"),setTimeout((function(){$(".ptClick").removeClass("ptClick")}),0);var n=e.category,r=e.series.userOptions,s=e.series.chart.userOptions.additionalInfo,o=s.category?s.category:s.series;if(o){-1!=(n=s.originalCategories&&void 0!==s.originalCategories[e.x]?s.originalCategories[e.x]:n).indexOf(",")&&(n=n.replace(/,/g,"\\,"));var l={api_name:o,comparator:"equal",value:"None"===n?"${EMPTY}":n};a.push(l);var d=s.yaxisFun+"##"+(s.yaxis?s.yaxis:"");if(r.index&&s.series){var c=r.index;c=s.originalGroups.length-c,-1!=(n="None"!==s.originalGroups[c]?s.originalGroups[c]:"${EMPTY}").indexOf(",")&&(n=n.replace(/,/g,"\\,")),l={api_name:s.series,comparator:"equal",value:n},a.push("and"),a.push(l)}else e.series.index&&(d=s["yaxis"+e.series.index+"Fun"]+"##"+(s["yaxis"+e.series.index]?s["yaxis"+e.series.index]:""));r.decimalDigits?r.decimalDigits:s.decimalDigits;var m=e.y,u={};u.module=s.module,u.criteria=JSON.stringify(a),u.summaryCol=d,u.summaryValue=m,u.action="getDetails";var v=i.attr("id");if(v&&"chartdiv"!==v&&"parentChartDiv"!==v)u.dbItemId=v;else if(document.NewReport&&formValidate()){var p=formData2QueryString(document.NewReport),h=objectUtils.parseURLParamString(p);if(h.stdDateFilterField){var g;if("Age in Days"===h.stdDateFilter||"Due in Days"===h.stdDateFilter){var C=h.stdageindays;C&&(g="stdDateFilter="+(C=h.stdageindayscondition+"###${AGE"+("Age in Days"===h.stdDateFilter?C:"+"+C)+"}"))}else h.startdate&&h.enddate&&(g="startDate="+h.startdate+",endDate="+h.enddate+",stdDateFilter="+crmReports.escapeSplChars(h.stdDateFilter));g&&(u.stdDateFilter=g+",stdDateFilterField="+crmReports.escapeSplChars(h.stdDateFilterField))}}var f=Lyte.Router.getURL({route:"crm.tab.reports.records",dynamicParams:[e.series.chart.userOptions.reportId],queryParams:u});window.lookUpWin=window.open(f,"","")}},fetchRecordsForTable:function(e,t,a,i){var n=[];if(t=t[0],e.originalCategories){if(e.originalCategories.length<=a)return;t=e.originalCategories[a]?e.originalCategories[a]:t}var r=$(renderingUtils.getTargetElem(event)).closest("div.dashBrdContent");r.addClass("ptClick"),setTimeout((function(){$(".ptClick").removeClass("ptClick")}),0),t&&-1!=(t+"").indexOf(",")&&(t=t.replace(/,/g,"\\,"));var s=e.category?e.category:e.series;if(s){var o={api_name:s,comparator:"equal",value:"None"===t?"${EMPTY}":t};n.push(o);var l=renderingUtils.getTargetElem(event),d=e.yaxisFun+"##"+(e.yaxis?e.yaxis:""),c=e.decimalDigits?parseFloat($(l).val()):$(l).val(),m=(c=$(l).closest("tr").find("td").eq(1).text(),Territory.getCurrencyObj(c));c=parseFloat(Territory.formatCurrencytoNum({yVal:c},m).yVal);var u={};u.module=e.module,u.criteria=JSON.stringify(n),u.summaryCol=d,u.summaryValue=c,u.dbItemId=r.attr("id"),u.action="getDetails";var v=Lyte.Router.getURL({route:"crm.tab.reports.records",dynamicParams:[i],queryParams:u});window.lookUpWin=window.open(v,"","")}},fetchDefaultChartRecords:function(e,t,a){var i=[],n=$(renderingUtils.getTargetElem(t)).closest("div.dashBrdContent"),r=a.category,s=a.series.userOptions,o=a.series.userOptions.recordType,l=a.series.chart.userOptions.additionalInfo,d=l[o.toUpperCase()];if(d){i=$.extend([],d.filters);var c=d.pattern}else s.filters&&(i=$.extend([],s.filters));var m=l.stageIds,u={searchfield:d&&d.searchfield?d.searchfield:l.searchfield,searchfieldtype:"T",searchModule:"Potentials"},v=a.index,p=$.extend({},u);if("Pipeline"===o&&m.length>v){var h=$.extend([],m).splice(v+1).join(",");p.searchfield="CrmPotential:PREVIOUSSTAGEID",p.condition=8,p.value=h,i.push(p),(p=$.extend({},u)).condition=8,p.value=h,i.push(p)}else p.condition=0,m.length>v?p.value=m[v]:(p.value=r,p.searchfield=p.searchfield.replace("ID","")),i.push(p);0===v&&"Loss"===o&&((p=$.extend({},u)).value=p.condition="${EMPTY}",c="( 1 and ( 2 or 3 ) )",i.push(p));var g=l.customFilters;if(g){var C=i.length;if(i.push.apply(i,g),c)for(var f=C+g.length;C<f;C++)c="( "+c+" and "+(C+1)+" )"}var E=Crm.getCrmBasePath()+"/ReportsRelatedCV.do?action=getChartData&module=Potentials&dbItemId="+n.attr("id")+"&type="+o+"&filters="+JSON.stringify(i);c&&(E+="&pattern="+encodeURIComponent(c)),window.lookUpWin=window.open(E,"","")},setNavigationDiv:function(e){var t=$("#reportsPagNation"),a=e.orderBy?e.orderBy:"ascending";if(e.totalRowCount=e.summaryJson&&e.summaryJson.info.more_records?e.totalRowCount+1:e.totalRowCount,e.totalRowCount>e.listLimitCount&&1==e.ReqFromIndex){var i="<div class='fR cP' id='showMoreDiv' onClick=\"CrmDashboard.navigateRecords('next', "+e.listLimitCount+","+(e.sortCol?"'"+e.sortCol+"','"+a+"'":void 0)+")\"><span class='vmiddle mR3 color_1 crm-font-bold'>"+(e.ReqFromIndex+(e.totalRowCount-2))+"</span><span class='dIB next vmiddle'></span></div><span class='dIB mL10 mR10 vmiddle color_1'>to</span> <div class='fL' id='showPreviousDiv'><span class='dIB previousDisabled vmiddle'></span><span class='vmiddle mL3 color_1 crm-font-bold'>"+e.ReqFromIndex+"</span></div>";t.append(i)}else e.totalRowCount<e.listLimitCount&&1!=e.ReqFromIndex&&(i="<div class='fR' id='showMoreDiv'><span class='vmiddle mR3 color_1 crm-font-bold'>"+(e.ReqFromIndex+e.totalRowCount-1)+"</span><span class='dIB nextDisabled vmiddle'></span></div><span class='dIB mL10 mR10 vmiddle color_1'>to</span> <div class='fL  cP' id='showPreviousDiv' onClick=\"CrmDashboard.navigateRecords('previous', "+e.listLimitCount+")\"><span class='dIB previous vmiddle'></span><span class='vmiddle mL3 crm-font-bold color_1'>"+e.ReqFromIndex+"</span></div>",t.html(i));1!=e.ReqFromIndex&&e.totalRowCount>e.listLimitCount&&(i="<div class='fR cP' id='showMoreDiv' onClick=\"CrmDashboard.navigateRecords('next', "+e.listLimitCount+","+(e.sortCol?"'"+e.sortCol+"','"+a+"'":void 0)+")\"><span class='vmiddle mR3 crm-font-bold color_1'>"+(e.ReqFromIndex+(e.totalRowCount-2))+"</span><span class='dIB next vmiddle'></span></div><span class='dIB mL10 mR10 vmiddle color_1'>to</span> <div class='fL  cP' id='showPreviousDiv' onClick=\"CrmDashboard.navigateRecords('previous', "+e.listLimitCount+")\"><span class='dIB previous vmiddle'></span><span class='vmiddle mL3 color_1 crm-font-bold'>"+e.ReqFromIndex+"</span></div>",t.html(i));var n={module:e.module,isAjax:!0};"drillDown"===e.reqType?(n.action=e.isAnalyticDrillDown?"fetchRecords":"getDetails",n.criteria=JSON.stringify(e.criteria),n.reportId=e.reportId,e.dbItemId?(n.dbItemId=e.dbItemId,n.dbId=e.dbId):(n.summaryCol=e.summaryCol,n.summaryValue=e.summaryValue,n.sortCol=e.sortCol,n.orderBy=e.orderBy,e.stdDateFilter&&(n.stdDateFilter=e.stdDateFilter)),e.subDbItemId&&(n.subDbItemId=e.subDbItemId)):(n.filters=JSON.stringify(e.filters),n.dbItemId=e.dbItemId,n.action="getChartData",e.pattern&&(n.pattern=e.pattern)),n.FROM_INDEX=e.ReqFromIndex,"Appointments"===e.module&&"viewAppointments"===e.actions&&(n.action=e.actions,n.title=e.title),t.data("params",n)},navigateRecords:function(e,t,a,i){var n=$("#reportsPagNation").data("params"),r={criteria:n.criteria};"newSort"!==e&&(r.FROM_INDEX="next"===e?n.FROM_INDEX+t:n.FROM_INDEX-t),a&&(r.sortCol=a,i&&(r.orderBy=i)),n.dbItemId?(n.subDbItemId&&(r.subComponentId=n.subDbItemId),Lyte.Router.transitionTo({route:"crm.tab.dashboards.dashboardId.records",dynamicParams:[n.dbId,n.dbItemId],queryParams:r}).data={isAjax:!0}):("Appointments"===n.module&&"viewAppointments"===n.action?(r.action=n.action,r.module=n.module,r.title=n.title):(r.action="getDetails",r.module=n.module,r.summaryCol=n.summaryCol,r.summaryValue=n.summaryValue,n.stdDateFilter&&(r.stdDateFilter=n.stdDateFilter)),Lyte.Router.transitionTo({route:"crm.tab.reports.records",dynamicParams:[n.reportId],queryParams:r}).data={isAjax:!0})},showReport:function(e,t,a){var i=$(renderingUtils.getTargetElem(t)),n=i.attr("class");if(!n||-1===n.indexOf("highcharts-legend-nav")){a=a||"dashBrdContent";var r,s=i.closest("div."+a);if(!$(s).hasClass("ptClick"))r=newReportsEnabled?Lyte.Router.getURL({route:"crm.tab.newReports.view",dynamicParams:[e]}):Lyte.Router.getURL({route:"crm.tab.reports.view",dynamicParams:[e],queryParams:{fromDashboard:!0}}),window.lookUpWin=window.open(r,"","")}},showDashboardSettings:function(){var e=$("#dashboardList");$("#dashboardList a").mouseenter((function(){$(this).find(".ds_setting").show()})).mouseleave((function(){var e=$(this).find(".ds_setting");e.hasClass("sankar")||e.hide()})),Territory.doHighLight("#dashboardList",e.find(".sel").eq(0),250,$(window).height()-280)},drillDownSort:function(){var e=JSON.parse($(event.target).attr("data-params")),t=e.orderBy;"false"!==e.isSortable&&(t=t||"ascending",CrmDashboard.navigateRecords("newSort",e.listLimitCount,e.fieldId,t))},drillDownSortForQuickchart:function(){var e=JSON.parse($(event.target).attr("data-params")),t=e.orderBy?e.orderBy:"ascending";CrmDashboard.navigateRecords("newSort",e.listLimitCount,e.apiName,t)},setDomainNames:function(e,t){var a=JSON.parse($(t).attr("data-params"));a.action="setDomainNames";var i=$("#domainList"),n=i.val().trim();if(n){var r=/^[0-9a-zA-Z][-.\w]*(:[0-9])*(\/?)([a-zA-Z0-9\-\.\?\,\:\'\/\\\+=&amp;%\$#_\[\]@!\(\)\*;~]*)?$/,s=n.split(","),o=s.length;n="";for(var l=0;l<o;l++)if(s[l]){if(!r.test(s[l]))return void renderingUtils.displayErrorDiv("domainList",void 0,I18n.getMsg("crm.mail.send.invalidhostname")+"\n"+$ESAPI.encoder().encodeForHTML(s[l]));n=n+s[l]+","}n&&(n=n.substr(0,n.length-1))}else{if("true"===i.attr("data-defvalue"))return i.after('<div style="height:10%" id="displayContent_domainList">'+I18n.getMsg("crm.label.no.domains.given")+"</div>"),void i.attr("data-defvalue","changed");if(!i.attr("data-defvalue"))return void crmui.hidePopup("dashboardPopup")}a.domainNames=n,a[csrfParamName]=encodeURIComponent(csrfToken),CrmDashboard.loadDashboards(void 0,void 0,a)},showPrintPreview:function(e,t){var a=JSON.parse($(t).attr("data-params")),i=document.title;$("body").append(CrmDashboard.printChartOptions);var n=$("#chartdiv_"+a.dbItemId),r=$("#chartdiv");r.before($("#comp_"+a.dbItemId).clone().removeClass("fL").attr("align","center"));var s=$("#printDashView");if(n.find("#tablediv").length)r.html(n.find("#tablediv").html());else if(n.parent().hasClass("dashBrdContent_kpi"))r.html(n.html());else{if(!n.length||!n.highcharts())return void s.remove();var o=n.highcharts().options;o.plotOptions.series.animation=!1,r.highcharts(o),o.plotOptions.series.animation=!0}mR(Crm.getCrmBasePath()+"/PrintPreviewListView.do?",(function(e){e+=s.html(),s.remove();var t=window.open("/crm/html/content1.html","Printview","width=700,height=600,menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes");t.document.writeln(e),t.document.close(),t.document.title=i}))},postRefreshComponentActions:function(e){e.closest(".refreshAnim").removeClass("ref_visible"),e.find(".tb_small_loader").removeClass("ref_loading").addClass("ref_complete"),setTimeout((function(){e.find(".tb_small_loader").removeClass("ref_complete")}),800)},showSelectedHomePage:function(e,t,a){var i=renderingUtils.windowHeight;$(".hview-refresh").remove(),a&&(e.currentDate=a),e.maxComp=CrmDashboard.maxComponentAllowed;var n=$("#HomeSelectorDD").find(".sel");t||(t=n.attr("id"));var r=parseInt(n.attr("data-category")),s=$("#homePageView");if(3!==r){e.isAdmin=Crm.userDetails.IS_ADMIN,s.html(Handlebars.templates.MainHomePage(e));var o={customizationId:t,category:r};if(!CrmDashboard.refreshPageIcon){CrmDashboard.refreshPageIcon=Handlebars.compile('<a id="refreshPage_{{customizationId}}" data-zcqa="home_refresh" class="fR hview-refresh" href="javascript:" data-cid="refreshAllComponents" data-params=\'{"clickId":"refreshAllComponents", "action":"refreshAllComponents", "pageId": "{{customizationId}}", "category": "{{category}}"}\' onmouseover="newshowtt(\'{{getI18n \'crm.homepage.refresh.all.components\'}}\',true)" onmouseout="newhidett()"><div class="tb_small_loader vmiddle" id="tb_small_loader" style="  "><span class="ld_init" id="ld_init"><crmutil-icon icon-name="reload" icon-class="zcicn-reload zcicn16 crmBaseIcon"></crmutil-icon></span><span class="ld_process"></span></div></a>')}$("#homeSelect").append(CrmDashboard.refreshPageIcon(o)),0===r||2===r?($(".sortClass").attr("style","cursor:auto").removeClass("sortClass"),$(".moreOptionIcon ,.HomemoreOptionIcon").remove()):(CrmDashboard.enableSortable("showHome","dashBrdContent",!0),CrmDashboard.enableResize("dashBrdContent",!0),CrmDashboard.setaddComponentSize(),CrmDashboard.showaddcomponentUi()),s.css("height",i-(s.position().top+26)).scroll($L.debounce((function(){CrmDashboard.populateVisibleComponents(this.id)}),300)),e.layoutComponents?(CrmDashboard.populateCharts(e.layoutComponents,"homePageView",i),CrmDashboard.populateVisibleComponents("homePageView")):2==r&&$("#noComponentDiv").show();var l=$("#homePage_cv_selector option:selected");(Crm.userDetails.isBestTimeEnabled&&Crm.userDetails.isZiaReminderEnabled&&l.text()===I18n.getMsg("My Todays Tasks")||l.text()===I18n.getMsg("My Today+Overdue Tasks"))&&$("#remindByZia").attr("cvid",l.val()).addClass("diZiaDashBoard")}else s.html(e)},replaceTaskDiv:function(e,t){e.fromPage="homePage",e.category="0",e.modname=I18n.getMsg(moduleRecordMapping[t].plural_label),$(".dbBtnRefresh").remove();var a=!0;e.body&&e.body[e.currentOption]&&(e.body[e.currentOption]=void 0,a=!1),e.isLast=a,CrmDashboard.renderCV(e,e.layoutId,e.category,t),CrmDashboard.needToLoadContactImage&&CrmDashboard.populateContactsImageMapAndLoadCv(e,e.layoutId,e.category,t)},changeDefaultTasks:function(e){var t=$(e),a=t.closest(".dashBrdContent"),i=a.find(".dbBtnRefresh"),n=JSON.parse(a.attr("data-params")),r=t.val(),s="currentOption"===t.attr("id"),o=JSON.parse(i.attr("data-params"));s?(n.currentOption=r,o.currentOption=r):(n.dashletId=r,o.dashletId=r),i.attr("data-params",JSON.stringify(o)),a.attr("data-params",JSON.stringify(n)),n.action=s?"updateDefaultHomeCVRange":"updateDefaultHomeCV",n[csrfParamName]=encodeURIComponent(csrfToken),n.url=Crm.getCrmBasePath()+"/HomePageLayout.do",a.find("#layout_"+n.layoutId).empty(),CrmDashboard.loadDashboards(void 0,void 0,n);var l=$('#homePage_cv_selector option[value="'+r+'"]').text();Crm.userDetails.isBestTimeEnabled&&Crm.userDetails.isZiaReminderEnabled&&(l===I18n.getMsg("My Todays Tasks")||l===I18n.getMsg("My Today+Overdue Tasks"))?($("#remindByZia").attr("cvid",r).addClass("diZiaDashBoard").hide(),$(t).parents(".dashBrdContent").find(".classicViewRight").addClass("ziarefreshPos")):($(t).parents(".dashBrdContent").find(".classicViewRight").removeClass("ziarefreshPos"),$("#remindByZia").hide().removeAttr("cvid").removeClass("diZiaDashBoard"))},searchDashboard:function(e,t,a){$("#dummyLiElm").remove();var i=$(e).val().toLowerCase();$("#"+t).find("."+a).each((function(e,t){-1!=$(this).text().trim().toLowerCase().indexOf(i)||-1!=$(this).text().trim().toUpperCase().indexOf(i)||-1!=$(this).text().trim().indexOf(i)?$(this).show():$(this).hide()})),0==$("#"+t+" a:visible").length&&0==$("#"+t).find("."+a+":visible").length?$("#"+t).append("<li id='dummyLiElm' class='pL25'  style='display: list-item;clear: both;'>"+I18n.getMsg("crm.module.matching.empty.message",I18n.getMsg("Dashboard"))+"</li>"):$("#"+t).scrollTop(0)},customizeHomePage:function(e,t){var a=JSON.parse($(t).attr("data-params")),i=a.operation,n={};switch("homePage"===a.from?(n.from=a.from,n.category=a.category,n.customizationId=a.customizationId):n.from="settings",i){case"create":Lyte.Router.transitionTo({route:"crm.settings.create-home-customization"});break;case"edit":Lyte.Router.transitionTo({route:"crm.settings.edit-home-customization",dynamicParams:[a.customizationId]}).data=n;break;case"clone":Lyte.Router.transitionTo({route:"crm.settings.clone-home-customization",dynamicParams:[a.customizationId]});break;default:Lyte.Router.transitionTo({route:"crm.settings.section.home-customization"})}}};function upgradeAccount(){var e=getObj("companyName").value;mR("/jsp/UpgradeUser.jsp?orgName="+e,(function(e){$("#upgradeDiv").empty(),document.getElementById("upgradeDiv").innerHTML=e}))}function closeDashletDiv(e){if("sheetTips"===e?crmui.hidePopup(e):"loadingDiv"===e?crmui.hidePopup("loadingDiv",!1,(function(){$("#loadingDiv").addClass("roundedCornerPop").removeClass("ppTop")})):getObj(e).style.display="none",getObj("MainMatrix")){$(getObj(e)).empty();for(var t=$("#MainMatrix").sortable("toArray").toString().split(","),a=0;a<t.length;a++)t[a]=t[a].replace(/home_/g,""),getObj("dashboardContent_"+t[a])&&(getObj("dashboardContent_"+t[a]).style.display="block")}document.getElementById("FreezeLayer")&&document.body.removeChild(document.getElementById("FreezeLayer"))}function JSEvalScript(e,t){EvalInnerScript(e,t)}function manipulateScriptElems(e){for(var t=e.getElementsByTagName("SCRIPT"),a=0;a<t.length;a++){var i=document.createElement("SCRIPT");i.type="text/javascript",i.language="javascript",""!=t[a].src&&(i.src=t[a].src),i.text=t[a].text,void 0===document.getElementsByTagName("HEAD")[0]?document.createElement("HEAD").appendChild(i):document.getElementsByTagName("HEAD")[0].appendChild(i)}}function ajaxGSearch(e){$(".searchLoadingIcon").hide(),$("#gsearchTextBox").blur(),e=e||"searchStr";var t=$("#"+e)[0];t.value=trimBoth(t.value);var a=t.value.replace(/[A-Z a-z 0-9]/,"");if(!(t.value.length>1||a))return alert(I18n.getMsg("crm.search.letters.check")),t.focus(),!1;crmNavig.removeFeaturCacheObj("gsearch");var n=document.gsearchForm;"gsearchTextBox"===e&&(n=document.searchForm);var r=n.sModule.length,s="";if(r>0){for(i=1;i<r;i++){var o=n.sModule[i],l=o.checked;if("AllEntities"==o.value&&l){s="AllEntities";break}l&&(s=0==s.length?o.value:s+","+o.value)}s||(s="AllEntities")}var d={searchword:t.value};""!=s&&(d.sModules=s),"gsearchTextBox"!==e&&(d.userOption=$("input[name=userOption]").is(":checked"));var c=$("#change_menu").find(".sel").data("params");if("global-search"===Lyte.Router.getRouteInstance().routeName){var m=Lyte.Router.getRouteInstance().getQueryParams();if(m.searchword===d.searchword&&m.sModules===d.sModules&&(null!=m.userOption&&m.userOption===d.userOption||null==m.userOption&&!d.userOption))Lyte.Router.getRouteInstance().refresh();else Lyte.Router.getRouteInstance().transitionTo("crm.global-search","",d).data={selectedmodule:c?c.module:"Home"}}else{Lyte.Router.getRouteInstance().transitionTo("crm.global-search","",d).data={selectedmodule:c?c.module:"Home"}}return $L(".primarySearchList").hide(),$L(".topbandSearchInpt").addClass("ui-corner-all"),!1}function sendQuickMail(e,t){var a=document.getElementsByTagName("crm-list-view");if(a.length)var i=(a=a[0]).getData("per_page"),n=u=a.getData("page"),r=i*(n-1)+1,s=n*i,o=a.getData("cvId"),l=a.getData("module"),d=a.getData("selectedIds").join(";");else{r=crmListView.getObject().fromIndex,s=crmListView.getObject().toIndex;var c,m,u=crmListView.getObject().currentOption;o=customViewObject.cvId;if(t&&"undefined"!=typeof CrmCampaignInteg&&CrmCampaignInteg.CampaignEmailObject&&CrmCampaignInteg.CampaignEmailObject.isCampaignEmail)l=CrmCampaignInteg.CampaignEmailObject.frommodule,d=CrmCampaignInteg.CampaignEmailObject.idList,CrmCampaignInteg.CampaignEmailObject.fromRelatedListNormal?(c="campRelatedListNormal",Crm.trackSpotLightAction("Mail Sent From RL",g)):!0===CrmCampaignInteg.CampaignEmailObject.isFromAddToCampaign&&"relatedList"===CrmCampaignInteg.CampaignEmailObject.from?c="AddToCampaignRel":CrmCampaignInteg.CampaignEmailObject.isFromAddToCampaignNew&&"relatedList"==CrmCampaignInteg.CampaignEmailObject.from?c="AddToCampaignNewFromCampMod":"add-to-campaigns"===Lyte.Router.getRouteInstance().routeName&&(c="AddToCampaignTool");else if(void 0===crmListView.getObject()||validationUtils.isEmpty(crmListView.getObject()))crmRelatedList.CampaignEmailObj&&!validationUtils.isEmpty(crmRelatedList.CampaignEmailObj)?(l=crmRelatedList.CampaignEmailObj.emailModule,d=crmRelatedList.CampaignEmailObj.selectedIds):(l=getObj("module").value,d=getElemById("idlist")?getElemById("idlist").value:getElemById("id").value);else if(l=crmListView.getObject().module,crmListView.getObject().selectedIds){d="";for(var v=0;v<crmListView.getObject().selectedIds.length;v++)d+=crmListView.getObject().selectedIds[v]+";"}}var p=getObj("emailTemplateId").value,h=getObj("showcvdetails");if(getObj("TransferWizardForm")&&(h=getObj("TransferWizardForm")),!emptyCheck("emailTemplateId","crm.workflow.alert.emailTemplate"))return!1;if(""==$("#emailTemplateId").siblings(".templateName").find("a").html())return alert(I18n.getMsg("crm.alert.template.notempty")),!1;var g=csrfParamName+"="+encodeURIComponent(csrfToken),C=getElemById("mode"),f=!(!customViewObject||"forecast"!==customViewObject.from);if(!f&&(null==C||"reminderToOwner"!=C.value)){if(!emptyCheck("fromAddress","crm.template.fromaddress.warn"))return!1;if(g+="&fromAddress="+$("#fromAddress").find("option:selected").val(),g+="&fromType="+$("#fromType").val(),g+="&replyToAddress="+$("#replyToAddress").find("option:selected").val(),g+="&replyType="+$("#replyType").val(),$("#crmMailServerType").length>0){g+="&mailServerType=",$("#crmMailServerType").is(":checked")?g+=$("#crmMailServerType").val():g+=$("#smtpMailServerType").val();var E=$("#smtpFromAddress");E.length>0&&""!==E.val()&&(g+="&smtpFromAddress="+E.val());var I=$("#smtpReplytoAddress");I.length>0&&""!==I.val()&&(g+="&smtpReplytoAddress="+I.val())}}f&&(r=1,s=100,u=100);var y=Crm.getCrmBasePath()+"/mailer/TemplateSendMail.do?step=sendMail&throughajax=yes&templateId="+p+"&cvid="+o+"&start_index="+r+"&end_index="+s+"&rangeValue="+u;if(C&&!f){var R=C.value;"reminderToOwner"==R&&(y+="&mode="+R,d=getElemById("idlist")?getElemById("idlist").value:getElemById("id").value,l=getElemById("module").value)}if(f&&(y+="&mode=reminderToOwner",";"===d.charAt(d.length-1)&&(d=d.substring(0,d.length-1))),y+=e?"&module="+encodeURIComponent(l)+"&consent=true&consent_status="+customViewObject.privacyDetails.status:"&module="+encodeURIComponent(l),t&&"undefined"!=typeof CrmCampaignInteg&&(CrmCampaignInteg.CampaignEmailObject.fromCampaignAddMemberListView||CrmCampaignInteg.CampaignEmailObject.isFromAddToCampaign||CrmCampaignInteg.CampaignEmailObject.isFromAddToCampaignNew)&&(m="campaignIntegMail",y+="&mode=campaignIntegMail&campaignId="+encodeURIComponent(CrmCampaignInteg.CampaignEmailObject.emailCampaignId),CrmCampaignInteg.CampaignEmailObject.memberStatus&&""!=CrmCampaignInteg.CampaignEmailObject.memberStatus&&(y+="&memberStatus="+encodeURIComponent(CrmCampaignInteg.CampaignEmailObject.memberStatus)),CrmCampaignInteg.CampaignEmailObject.isFromAddToCampaign?crmListView.trackAddToCampaignSave(CrmCampaignInteg.CampaignEmailObject.campaignIntegType):crmListView.trackInviteMail(CrmCampaignInteg.CampaignEmailObject.campaignIntegType)),$("#massMailstatsPop").hide(),crmui.showPopup("mass_sending_mail"),$("html,body").css("overflow","hidden"),f||null!=h&&"add-to-campaigns"!==Lyte.Router.getRouteInstance().routeName){P=0,k=0;var b,T,D,w,M,S="",L=(F=0,x=0,d.split(";").length);y+="&idlist="+d,$.ajax({type:"POST",dataType:"json",url:y,data:g,success:function(t){var a=t;if(null==a.isSpam&&(P+=a.totalCount,k+=a.sentMailCount,S=a.smtpError,a.optoutCount&&(F+=a.optoutCount),a.unconfOwnerCount&&(x+=a.unconfOwnerCount),null==_&&a.blockedEmailsList.length>=1?_=a.blockedEmailsList.join():a.blockedEmailsList.length>=1&&(_=_+","+a.blockedEmailsList.join()),null==O&&a.dmarcRejectedEmailsList.length>=1?O=a.dmarcRejectedEmailsList.join():a.dmarcRejectedEmailsList.length>=1&&(O=O+","+a.dmarcRejectedEmailsList.join()),null==A&&a.smtpRejectedEmailsList.length>=1?A=a.smtpRejectedEmailsList.join():a.smtpRejectedEmailsList.length>=1&&(A=A+","+a.smtpRejectedEmailsList.join()),null==N&&a.invalidMailsList.length>=1?N=a.invalidMailsList.join():a.invalidMailsList.length>=1&&(N=N+","+a.invalidMailsList.join()),null==b&&a.subLengthExceedMailList.length>=1?b=a.subLengthExceedMailList.join():a.subLengthExceedMailList.length>=1&&(b=b+","+a.subLengthExceedMailList.join()),null==T&&a.consentMailList.length>=1?T=a.consentMailList.join():a.consentMailList.length>=1&&(T=T+","+a.consentMailList.join()),null==D&&a.attachmentExceedMailList.length>=1?D=a.attachmentExceedMailList.join():a.attachmentExceedMailList.length>=1&&(D=D+","+a.attachmentExceedMailList.join()),null==w&&a.zsurveyRejectedEmails.length>=1?w=a.zsurveyRejectedEmails.join():a.zsurveyRejectedEmails.length>=1&&(w=w+","+a.zsurveyRejectedEmails.join()),null==M&&a.campaignExistingMemberEmails.length>=1?M=a.campaignExistingMemberEmails.join():a.campaignExistingMemberEmails.length>=1&&(M=M+","+a.campaignExistingMemberEmails.join())),0!=d.length&&0==a.countExceded&&null==a.isSpam)sendMassMail(y,g,d.join(";"),P,k,_,O,N,L,l,A,S,F,x,b,T,D,w,e,M,c,m);else{var i={};i.smtpRejectedEmailsList=A&&""!==A&&0!==A?A:"undefined",i.blockedEmailsList=_&&""!==_&&0!==_?_:"undefined",i.invalidMailsList=N&&""!==N&&0!==N?N:"undefined",i.subLengthExceedMailList=b&&""!==b&&0!==b?b:"undefined",i.consentMailList=T&&""!==T&&0!==b?T:"undefined",i.attachmentExceedMailList=D&&""!==D&&0!==D?D:"undefined",i.zsurveyRejectedEmails=w&&""!==w&&0!==w?w:"undefined",i.campaignExistingMemberEmails=M&&""!==M&&0!==M?M:"undefined",i.dmarcRejectedEmailsList=O&&""!==O&&0!==O?O:"undefined";var n=Crm.getCrmBasePath()+"/ShowTemplates.do?action=MassMail",r="module="+l+"&totalCount="+P+"&sentMailCount="+k+"&optoutCount="+F+"&unconfOwnerCount="+x+"&errorList="+encodeURIComponent(JSON.stringify(i))+"&countExceded="+a.countExceded+"&smtpError="+a.smtpError+"&length="+L+"&isSpam="+a.isSpam;e&&(r+="&consent=true"),c&&(r+="&campaignMailType="+c),m&&(r+="&mode="+m),mR(n,(function(e){var t=renderingUtils.windowHeight,a=$("#massMailstatsResult");$("#prLayer").show(),hide("progressBar"),document.getElementById("loadingDiv").style.display="none",$("#massMailstatsPop").hide(),$("body").append('<div id="massMailstatsResult" class="newPopup w550 topBandPopShadow ppTop p0 " style="z-index:35;"></div>'),a.empty(),document.getElementById("massMailstatsResult").innerHTML=e,a.css("max-height",t-110),$("#massMailstatsResult .massMailoADiv").css("max-height",t-180),crmui.hidePopup("mass_sending_mail",!0),crmui.showPopup("massMailstatsResult");var i=parseInt($(".massMailstatsPop").css("margin-top"))-$("#wmstoolbar").outerHeight()-12;$("#massMailstatsPop").css("margin-top",i),$("html,body").css("overflow","hidden"),freezeBackground()}),r)}},error:function(){closeMassMail("massMailstatsResult",!1),closeMassMail("mass_sending_mail"),hide("massMailstatsPop"),hide("loadingDiv")}})}else{var A,_,O,N,P=0,k=0,F=0,x=0,U=t?d.split(";").length:crmListView.getObject().selectedIds.length;sendMassMail(y,g,d,P,k,_,O,N,U,l,A,void 0,void 0,void 0,void 0,void 0,void 0,void 0,e,void 0,c,m)}}function sendMassMail(e,t,a,i,n,r,s,o,l,d,c,m,u,v,p,h,g,C,f,E,I,y){var R=(a=a.split(";")).splice(0,crmConstants.maxRecOperCnt).join(";"),b=e+"&idlist="+R;u||(u=0),v||(v=0),$.ajax({type:"POST",url:b,dataType:"json",data:t,success:function(R){var b=R;if(null==b.isSpam&&(i+=b.totalCount,n+=b.sentMailCount,u+=b.optoutCount,v+=b.unconfOwnerCount,m=b.smtpError,null==c&&b.smtpRejectedEmailsList.length>=1?c=b.smtpRejectedEmailsList.join():b.smtpRejectedEmailsList.length>=1&&(c=c+","+b.smtpRejectedEmailsList.join()),null==r&&b.blockedEmailsList.length>=1?r=b.blockedEmailsList.join():b.blockedEmailsList.length>=1&&(r=r+","+b.blockedEmailsList.join()),null==s&&b.dmarcRejectedEmailsList.length>=1?s=b.dmarcRejectedEmailsList.join():b.dmarcRejectedEmailsList.length>=1&&(s=s+","+b.dmarcRejectedEmailsList.join()),null==o&&b.invalidMailsList.length>=1?o=b.invalidMailsList.join():b.invalidMailsList.length>=1&&(o=o+","+b.invalidMailsList.join()),null==p&&b.subLengthExceedMailList.length>=1?p=b.subLengthExceedMailList.join():b.subLengthExceedMailList.length>=1&&(p=p+","+b.join()),null==h&&b.consentMailList.length>=1?h=b.consentMailList.join():b.consentMailList.length>=1&&(h=h+","+b.consentMailList.join()),null==g&&b.attachmentExceedMailList.length>=1?g=b.attachmentExceedMailList.join():b.attachmentExceedMailList.length>=1&&(g=g+","+b.attachmentExceedMailList.join()),null==C&&b.zsurveyRejectedEmails.length>=1?C=b.zsurveyRejectedEmails.join():b.zsurveyRejectedEmails.length>=1&&(C=C+","+b.zsurveyRejectedEmails.join()),null==E&&b.campaignExistingMemberEmails.length>=1?E=b.campaignExistingMemberEmails.join():b.campaignExistingMemberEmails.length>=1&&(E=E+","+b.campaignExistingMemberEmails.join())),0!=a.length&&0==b.countExceded&&null==b.isSpam)sendMassMail(e,t,a.join(";"),i,n,r,s,o,l,d,c,m,u,v,p,h,g,C,f,E,I,y);else{var T="false";null!=b.fromTool&&"true"===b.fromTool&&(T="true");var D={};D.smtpRejectedEmailsList=c&&""!==c&&0!==c?c:"undefined",D.blockedEmailsList=r&&""!==r&&0!==r?r:"undefined",D.invalidMailsList=o&&""!==o&&0!==o?o:"undefined",D.subLengthExceedMailList=p&&""!==p&&0!==p?p:"undefined",D.consentMailList=h&&""!==h&&0!==p?h:"undefined",D.attachmentExceedMailList=g&&""!==g&&0!==g?g:"undefined",D.zsurveyRejectedEmails=C&&""!==C&&0!==C?C:"undefined",D.campaignExistingMemberEmails=E&&""!==E&&0!==E?E:"undefined",D.dmarcRejectedEmailsList=s&&""!==s&&0!==s?s:"undefined";var w=Crm.getCrmBasePath()+"/ShowTemplates.do?action=MassMail",M="module="+d+"&totalCount="+i+"&sentMailCount="+n+"&optoutCount="+u+"&unconfOwnerCount="+v+"&smtpError="+b.smtpError+"&errorList="+encodeURIComponent(JSON.stringify(D))+"&countExceded="+b.countExceded+"&length="+l+"&isSpam="+b.isSpam+"&fromMassMailTool="+T;f&&(M+="&consent=true"),I&&(M+="&campaignMailType="+I),y&&(M+="&mode="+y),mR(w,(function(e){freezeBackground();var t=renderingUtils.windowHeight,a=$("#massMailstatsResult");if($("#prLayer").show(),crmui.hidePopup("mass_sending_mail",!0),document.getElementById("loadingDiv").style.display="none",$("#massMailstatsPop").hide(),$("body").append('<div  id="massMailstatsResult" class="newPopup w550 topBandPopShadow ppTop p0 " style="z-index:35;"></div>'),a.empty(),document.getElementById("massMailstatsResult").innerHTML=e,a.css("max-height",t-110),$("#massMailstatsResult .massMailoADiv").css("max-height",t-180),$("html,body").css("overflow","hidden"),crmui.showPopup("massMailstatsResult",!0),null!=b.fromTool&&"true"===b.fromTool){var i=$("#sendTable").find("input[name='massmailNext']");i.length>0&&i.trigger("click")}}),M)}},error:function(){closeMassMail("massMailstatsResult",!1),closeMassMail("mass_sending_mail"),hide("massMailstatsPop"),hide("loadingDiv")}})}function closeMassMail(e,t,a,i){var n,r=$("body");if(hide(e),removeFreezeLayer(),customViewObject&&"forecast"===customViewObject.from){var s=document.querySelector("crm-forecast-deals-modal");s&&s.component.executeMethod("onModalClose")}null!=t&&0==t&&-1==["campRelatedListNormal","AddToCampaignRel","AddToCampaignNewFromCampMod","AddToCampaignTool"].indexOf(i)&&(currCVId=crmListView.getObject().cvId,clearSelection()),hide("prLayer"),$("#step1").length>0||$("#step2").length>0?$("html,body").css("overflow","auto"):$("html,body").css("overflow",""),(e="massMailstatsResult")&&r.hasClass("oH")&&r.removeClass("oH"),hide("progressBar"),n=null!=crmListView.getObject().module?crmListView.getObject().module:getObj("module").value,Macro.autoSuggest(n,!1),$("#freezeBackGround").fadeOut(),a&&(Events.isPageLayoutModified=!0,CrmPrivacyDashboard.reloadCurrentListView()),"undefined"!=typeof CrmCampaignInteg&&CrmCampaignInteg.campaignMassMailSendCallBack()}function clearSelection(e){if(null!=e)for(noofrows=e&&e.chk?e.chk.length:null,i=0;i<noofrows;i++)e.allcheck&&e.allcheck.checked&&(e.allcheck.checked=!1),e.chk[i].checked&&(e.chk[i].checked=!1,e.chk[i].parentNode.parentNode.style.backgroundColor="");else customViewObject.fromLyte?(crmListView.startIndex={},crmListView.reloadCurrentListView()):(noofrows=$(".tdout").length+$(".tdhover").length,$("#checkAll")&&$("#checkAll").attr("class","customCheckBoxChecked")&&$("[id=checkAll]").attr("class","customCheckBox"),$(".customCheckBoxChecked[data-cid=selectEntity]").parent().parent().parent().css("background-color",""),$(".customCheckBoxChecked[data-cid=selectEntity]").attr("class","customCheckBox"),customViewObject.isStageView&&crmListView.clearStageSelectionNew(),crmListView.checkAll(),showHideListViewBtnFn(),$("#fixedChkSelAll").attr("class","customCheckBox"))}function showRelatedFields_new(e,t,a){var i=crmListView.getObject(),n=["Leads","Accounts","Cases","Vendors","Contacts"].contains(e),r=["Leads","Contacts","Cases","Vendors"].contains(e)||0==e.indexOf("CustomModule"),s=($(a).parents("tr").attr("id"),$(a).offset().left),o=$(a).offset().top;i&&(n||r)&&(i.relEntityDetails&&i.relEntityDetails[t]?formRelDetails(i.relEntityDetails[t],$(a).attr("id")||$(a).attr("lt-prop-id"),n,r,o,s):$(a).attr("data-loading")||(clearTimeout(timer),timer=setTimeout((function(){var l=Crm.getCrmBasePath()+"/GetRelatedDetails.do?action=getRelatedFields",d={module:e,seid:t};$(a).attr("data-loading",!0),(new crmRequestPool).initiate({action:l,type:"POST",data:d,success:function(e){if(null!=e){void 0===i.relEntityDetails&&(i.relEntityDetails={});var t=e.SEID;if(delete e.SEID,t){var l=$(a).attr("id")||$(a).attr("lt-prop-id");i.relEntityDetails[t]=e,formRelDetails(e,l,n,r,o,s)}}},error:function(e){commonUtils.showHideLoadingDiv(),e.responseText&&555==e.status&&alert(e.responseText)}})}),1e3)))}function formRelDetails(e,t,a,i,n,r){var s=$("#"+t);if($(s).length){var o='<table width="100%" border="0" cellspacing="0" cellpadding="5">';if(a){var l=e.PHONE,d=l;"en_US"==Crm.userDetails.COUNTRY_LOCALE&&d.match(/[0-9]/)&&(d="(",10==l.length?d+=l.substring(0,3)+") "+l.substring(3,6)+"-"+l.substring(6,10):9==l.length?d+=l.substring(0,5)+")-"+l.substring(5,9):d=l),o+='<tr><td class="alignright" width="50">'+I18n.getMsg("Phone")+':</td><td class="alignleft">',null!=d&&"undefined"!=d&&(o+=$ESAPI.encoder().encodeForHTML(d)),o+="</td></tr>"}if(i){var c=e.EMAIL;o+='<tr><td class="alignright" width="50">'+I18n.getMsg("Email")+':</td><td class="alignleft">',null!=c&&"undefined"!=c&&(o+='<a href="mailto:'+$ESAPI.encoder().encodeForHTMLAttribute(c)+'">'+$ESAPI.encoder().encodeForHTML(c)+"</a>"),o+="</td></tr>"}o+="</table>";var m=$("#loadingDiv");m.html(o),m.addClass("rellistpopup");var u="";$("#listviewtablescroll").length&&(u=$("#listviewtablescroll").scrollLeft()),u>0&&200;var v=r,p=n+15;m.css({width:"auto","min-width":"210px",left:v,top:p}),m.show(),m.addClass("hoverRoundedCorner")}}function hideLoadingDiv(){clearTimeout(timer),timer=setTimeout((function(){hideRelatedDiv()}),100)}function hideRelatedDiv(){document.getElementById("loadingDiv").style.display="none",$("#loadingDiv").removeClass("hoverRoundedCorner")}function updateResponseStatus(e){var t=getObj("responderId").value;if(""==t)alert(I18n.getMsg("crm.field.none.check",I18n.getMsg(e)));else{var a,i,n={};if(n[csrfParamName]=encodeURIComponent(csrfToken),getObj("idForCV")){a=crmListView.getObject().module,i=crmListView.getObject().selectedIds.join(";");var r=Crm.getCrmBasePath()+"/AutoResponder.do?step=updateStatus&module="+a+"&responderId="+encodeURIComponent(t)+"&fromListView=true";n.idlist=i,mR(r,(function(e){$("#loadingDiv").empty(),document.getElementById("loadingDiv").innerHTML=e,clearSelection(),setTimeout((function(){crmui.hidePopup("loadingDiv")}),3e3),crmListView.startIndex={}}),n)}else{a=getObj("module").value,i=getObj("idlist").value,loadAjaxTab("","lightblue");r=Crm.getCrmBasePath()+"/AutoResponder.do?step=updateStatus&module="+a+"&idlist="+i+"&responderId="+encodeURIComponent(t);var s=document.getElementById("lookupdiv");s.style.display="block",s.style.zIndex=30,s.style.overflow="hidden",s.style.width="680px",s.style.height="500px",mailsetCenter("lookupdiv"),new AjaxAPI({id:"lookupdiv",url:r,callbackfn:function(){commonUtils.showHideLoadingDiv(),$("#bulkUpdateSuccess").empty(),document.getElementById("bulkUpdateSuccess").innerHTML=I18n.getMsg("crm.massupdate.updatedsuccesfully"),mailsetCenter("bulkUpdateSuccess"),setCenter(document.getElementById("bulkUpdateSuccess")),show("bulkUpdateSuccess"),setTimeout((function(){document.getElementById("bulkUpdateSuccess").style.display="none"}),2e3)},params:n}).post()}}}function exportReport(e){var t=formData2QueryString(document.zohodb);document.getElementById("loadingDiv").style.display="block",document.getElementById("loadingDiv").style.zIndex=30,document.getElementById("loadingDiv").style.width="400px",$("#loadingDiv").empty(),document.getElementById("loadingDiv").innerHTML="Loading...",mailsetCenter("loadingDiv"),freezeBackground();t=t+"&fileType=zohodb&module="+e;var a=Crm.getCrmBasePath()+"/PushToZohoDB.do";mR(a,(function(e){$("#loadingDiv").empty(),document.getElementById("loadingDiv").innerHTML="Updated..",setTimeout((function(){hide("loadingDiv")}),3e3)}),t)}function getAutoChk(){var e=document.showEntity.chk.length,t=0;for(i=0;i<e;i++)document.showEntity.chk[i].checked&&t++;return t}function responseUpdate(e){var t=document.showEntity.chk.length,a="";if(null==t){if(!document.showEntity.chk.checked)return alert(I18n.getMsg("crm.alert.select.one")),!1;var n=document.showEntity.chk.value;getObj("idlist").value=n,updateResponseStatus(e)}else{if(0==t)return!1;if(0==getAutoChk())return alert(I18n.getMsg("crm.alert.select.one")),!1;for(i=0;i<t;i++)if(document.showEntity.chk[i].checked){n=document.showEntity.chk[i].value;a=""==a?n:a+";"+n}getObj("idlist").value=a,updateResponseStatus(e)}}function selectAllChk(){if(null!=document.showEntity.chk){var e=document.showEntity.chk.length,t=document.showEntity.allcheck.checked;for(null==e&&(document.showEntity.chk.checked=t),i=0;i<e;i++)document.showEntity.chk[i].checked=t}}function relatedFields(e){$(".rfields").hide(),$("#rfields_"+e).show(),$("#rfieldsDiv").scrollTop(0),$(".modulesel").removeClass("modulesel"),$("#rmodules_"+e).addClass("modulesel");var t={Potentials:"#showStageHistOpt",SalesOrders:"#showSalesOrderOpt",PurchaseOrders:"#showPurchaseOrderOpt",Quotes:"#showQuoteOpt",Invoices:"#showInvoiceOpt"};if(e in t)for(eachmodule in t)e==eachmodule?$(t[e]).show():$(t[eachmodule]).hide();else for(eachmodule in t)$(t[eachmodule]).hide()}function showReportConfig(e,t){var a="";"true"==t&&(a=csrfParamName+"="+encodeURIComponent(csrfToken)),freezeBackground(),new AjaxAPI({id:"loadingDiv",url:e,params:a,callbackfn:function(e){$("#loadingDiv").css({zIndex:30,top:document.body.scrollTop+100+"px",left:"20%",width:"900px"}).show()}}).post()}CrmDashboard.showCustomViews=function(e){document.querySelector("#customView crm-customview-dropdown").component.setData("module",e.value)},CrmDashboard.validateLayout=function(e){var t={clickId:"addorUpdate"};t.type=$("[name=type]:checked").val(),t.type||(t.type=$("[name=type]").val());var a=$("#hp_addlayout").find(".errorMsgDesc");a.closest(".errorFieldP").removeClass("errorFieldP"),a.remove();var i=$("#isFromCustomHome").val();if(!$("[name=type]:checked").val()&&!$('input[name="type"][type="hidden"]').val())return Crm.showErrorMsg(I18n.getMsg("crm.field.valid.check",[I18n.getMsg("crm.dashboard.component.type")]),$('input[name="type"]')),!1;var n=$(".customviewdiv:visible").length;if(n&&""===$("#module").val().trim())return Crm.showErrorMsg(I18n.getMsg("crm.alert.select.module"),$("#module")),!1;if(n&&!emptyCheck("cvid","crm.label.customview",void 0,void 0,"inline"))return!1;if("true"===i){var r=$("#dashletId").val();return CustomHomePage.updateComponent(r),!1}var s=$("#layoutName"),o=s.val(),l=getClrTxtPtnResChars(o,/[^~`#^&*+={}[\]|\;"<>\\]/g);if(!emptyCheck("layoutName","crm.component.name",void 0,void 0,"inline"))return s.focus(),!1;if(""!=l)return Crm.showErrorMsg(I18n.getMsg("crm.clearTextPattern.validationFail.alert",[I18n.getMsg("crm.component.name"),l]),s),s.focus(),!1;t.url=getAttr(e,"action");var d=$("#layoutId");d.length?(t.layoutId=d.val(),t.displayMsg=I18n.getMsg("crm.massupdate.updatedsuccesfully")):t.displayMsg=I18n.getMsg("crm.label.added.successfully");var c=$("#componentId");c&&c.is(":visible")&&(t.componentId=c.val(),t.dbId=$("#componentId :selected").parent().attr("id")),t.hideObj="dashboardPopup";var m=formData2QueryString(e)+"isload=true&"+CrmDashboard.crm_csrf;return"undefined"!=typeof CrmAnalytics&&"cv"==t.type&&(m=m+"&layout="+AnalyticsChart.getTempWidgetLayout("chart")),"undefined"!=typeof CrmAnalytics&&t.dbId?(t.queryStr=m,CrmAnalytics.getComponentJson(t.componentId,t.dbId,t)):CrmDashboard.loadDashboards(void 0,void 0,t,m),!1},CrmDashboard.addClassToHomeType=function(){var e=$("#sLogo");e.attr("data-src")&&e.html('<img src="'+e.attr("data-src")+'" name="compLogo" id="compLogo">'),Crm.userDetails.RTL_ENABLED&&$("#compLogo").css("margin-left","10px")},CrmDashboard.selectStackedType=function(e){$(".tb_newmenu a").removeClass("sel"),(e=$(e)).addClass("sel");var t=e.attr("data-stacked");"2"===t?$("#yaxis2labelPar").show():$("#yaxis2labelPar").hide();var a=$("#grouping, #series, #groupingPar, #seriesPar");a.hide(),"1"!==t&&"100"!==t||(a.show(),$("#series option[value='CrmActivity:ACTIVITYTYPE:Host or Participant']").remove(),$("#series option[value='CrmActivitiesSharing:SHAREDTO:Host or Participant']").remove());var i=e.attr("data-type");$("#chartType").val(i),$("#chartimg").removeClass().addClass(CrmDashboard.typeVsChartImg[i])},CrmDashboard.selectChartType=function(e,t){var a=["13","14","15","16"],i=["3","5","10","17"],n=$(".dash-container");n.removeClass("sel"),!e&&t?e=n.filter('[data-type="'+t+'"]').addClass("sel"):t=(e=$(e)).addClass("sel").attr("data-type"),$("#stackedSec").hide(),$(".secHeadMarg").css({"padding-bottom":"4px"}),$("#grouping, #series, #totalrows, #maxRows, #groupingPar, #seriesPar, #totalrowsPar, #maxRowsPar, #yaxis2Par, #yaxis2labelPar").hide(),$("#xaxisdiv, #yaxisLabel").show(),a.contains(t)?CrmDashboard.setStackedChartType(a,t,"13"):i.contains(t)?CrmDashboard.setStackedChartType(i,t,"3"):"12"===t?$("#grouping, #series, #groupingPar, #seriesPar").show():"0"===t&&$("#totalrows, #maxRows, #totalrowsPar, #maxRowsPar").show(),$("#chartType").val(t),$("#chartimg").removeClass().addClass(CrmDashboard.typeVsChartImg[t])},CrmDashboard.setStackedChartType=function(e,t,a){$(".secHeadMarg").css({"padding-bottom":"10px"});for(var i=$("#stackedSec").show().find("a").removeClass("sel"),n=0;n<4;n++)i.eq(n).attr("data-type",e[n]);var r=i.filter('[data-type="'+t+'"]').addClass("sel");CrmDashboard.selectStackedType(r),$(".dash-container").filter('[data-type="'+a+'"]').addClass("sel")},CrmDashboard.showLayout=function(e,t){var a=$("#lastSortOrderId").val();a>=CrmDashboard.maxComponentAllowed?renderingUtils.showCustomAlert(I18n.getMsg("crm.dashboard.add.component.error.msg",CrmDashboard.maxComponentAllowed),void 0,!1):20===CrmDashboard.maxComponentAllowed&&a>=5&&"L"==Crm.userDetails.LICENSE_TYPE?renderingUtils.showCustomAlert(I18n.getMsg("crm.alert.add.component1"),void 0,!1):CrmDashboard.loadDashboards(e,t)},CrmDashboard.changeType=function(e,t){if("cv"===e&&!document.querySelector("#customView crm-customview-dropdown")){var a=$("#module").val(),i=document.querySelector("#cvid").value;Lyte.Component.render("crm-customview-dropdown",{module:a,cvId:i},"#customView .labelValCreate div")}if($("#nextSectionBtn, #widgetInfoDiv,#tabDivCreateComponent").hide(),$("#saveEditComponentDiv").show(),"Dashboards"===e)$(".customviewdiv").hide(),$(".dashboarddiv").show(),$("#dashboardPopup #tabDivCreateComponent").show(),$("#tabDivCreateComponent #layoutName").focus();else if($('input[name="type"]').is(":checked")&&void 0===e||"cv"!==e&&"cv"!==$(document.LayoutForm).find('input:hidden[name="type"]').val()||"widgets"===e)"widgets"==e?($("#nextSectionBtn").show(),$("#saveEditComponentDiv").hide(),$(".customviewdiv,.dashboarddiv,#tabDivCreateComponent").hide()):($(".dashboarddiv").hide(),$(".customviewdiv").hide(),thirdPartyUtils.bindSelect2(".customviewdivSel"));else{var n=$("#dashboardPopup #tabDivCreateComponent");t?n.show():n.hide(),$("#dashboardPopup .dashboarddiv").hide(),$("#dashboardPopup .customviewdiv").show(),thirdPartyUtils.bindSelect2("#module"),""!==$("#dashboardPopup #customView .newSelect #cvid").val()?n.show():n.hide()}""!==$("#module").val()&&$("#cvModuleDiv").is(":visible")?$("#customView").css("display",""):$("#customView").css("display","none");var r=$("#dashboardPopup");r.hasClass("newInputStyleEle")&&r.find("input,select,textarea,.newSelect").focusin(setFocusClass).blur(removeFocusClass)},CrmDashboard.associateWidgets=function(e){$("#dashboardPopup").html(createLayoutContent),$("#nextSectionBtn, .customviewdiv, .dashboarddiv").hide(),$("#saveEditComponentDiv").show(),$(".widgetInfoDiv").show(),$("#widgetName").val($.trim($("#div_"+e).attr("wid_name"))),$("#widgetId").val(e),$("[name=type]").val(["widgets"]),$L("crm-widgets-listview-popup")[0].component.setData("showListPopup",!1),showAnimatePopup("dashboardPopup"),$("#dashboardPopup #tabDivCreateComponent").show()},CrmDashboard.initWidgets=function(e){$("#dashboardPopup crm-customview-dropdown").remove(),createLayoutContent=$("#dashboardPopup").html(),Lyte.injectResources([networkUtils.returnDependencyFiles(["crm-widget-container.js"],crmConstants.jsStaticPathForLyte)[0],networkUtils.returnDependencyFiles(["widget/crm-widget-container.css"],crmConstants.lessStaticPathForLyte)[0]],void 0,(function(){var e=$("input[name=customizationId]").val();hideAnimatePopup("dashboardPopup"),Lyte.registeredMixins["crm-widget-utils"].loadWidgetListViewPopup("HOME_PAGE_DASHBOARD",void 0,e)}))},CrmDashboard.getHighChartOptions=function(){return{colors:["#F26E6E","#FF92BE","#8C79DE","#2C97DE","#0AD3FF","#38E4AE","#63D471","#ADD463","#ED7F65","#E99E5B","#FCE970","#C39878","#EBDCB5"],chart:{style:{fontFamily:"",fontSize:"12px"}},tooltip:{borderWidth:2,style:{padding:0},useHTML:!0,formatter:function(){if(this.series.chart.options&&this.series.chart.options.additionalInfo&&void 0!==this.series.chart.options.additionalInfo.isBlueprint)return ProcessBuilder.getChartInfo(this);var e;if(CrmDashboard.isDateField(this))e=Utils.convertTimeInDoubleToReadableForm(this.y/6e4);else{var t=this.series.chart.options.additionalInfo.decimalDigits;e=commonUtils.formatDecimalValue(this.y,t,!0)}return"<b>"+$ESAPI.encoder().encodeForHTML(this.series.name)+"</b></br>"+$ESAPI.encoder().encodeForHTML(this.key)+" : "+e}},plotOptions:{column:{dataLabels:{formatter:function(){if(CrmDashboard.isDateField(this))return Utils.convertTimeInDoubleToReadableForm(this.y/6e4);var e=void 0!==this.series.userOptions.decimalDigits?this.series.userOptions.decimalDigits:this.series.chart.options.additionalInfo.decimalDigits;return this.total&&this.percentage&&"percent"===this.series.chart.options.plotOptions.column.stacking?parseInt(this.percentage)+"%":this.total&&0===this.y?"":commonUtils.formatDecimalValue(this.y,e,!0)+""}}},bar:{dataLabels:{formatter:function(){if(CrmDashboard.isDateField(this))return Utils.convertTimeInDoubleToReadableForm(this.y/6e4);var e=void 0!==this.series.userOptions.decimalDigits?this.series.userOptions.decimalDigits:this.series.chart.options.additionalInfo.decimalDigits;return this.total&&this.percentage&&"percent"===this.series.chart.options.plotOptions.bar.stacking?parseInt(this.percentage)+"%":this.total&&0===this.y?"":commonUtils.formatDecimalValue(this.y,e,!0)+""}}},areaspline:{dataLabels:{formatter:function(){if(CrmDashboard.isDateField(this))return Utils.convertTimeInDoubleToReadableForm(this.y/6e4);var e=this.series.chart.options.additionalInfo.decimalDigits;return 0===this.y?"":commonUtils.formatDecimalValue(this.y,e,!0)+""}}},pie:{dataLabels:{formatter:function(){if(CrmDashboard.isDateField(this))return Utils.convertTimeInDoubleToReadableForm(this.y/6e4);var e=void 0!==this.series.userOptions.decimalDigits?this.series.userOptions.decimalDigits:this.series.chart.options.additionalInfo.decimalDigits;return $ESAPI.encoder().encodeForHTML(this.point.name)+"<br>"+commonUtils.formatDecimalValue(this.y,e,!0)+" ( "+this.percentage.toFixed(2)+"% )"}}},funnel:{dataLabels:{formatter:function(){return $ESAPI.encoder().encodeForHTML(this.point.name)}}}},legend:{labelFormatter:function(){var e;try{e=this.series&&this.series.chart&&this.series.chart.renderTo&&this.series.chart.renderTo.getAttribute("id")}catch(t){e=""}return"zBSPieChart"===e?this.name:$ESAPI.encoder().encodeForHTML(this.name)}},yAxis:{labels:CrmDashboard.yAxisLabelConfigJson}}},CrmDashboard.initChart=function(){Crm.isZohoChartsEnabled||Highcharts.setOptions(CrmDashboard.getHighChartOptions())},CrmDashboard.setClickEvents=function(e,t){t=t||"tabDivCreate",$("#"+e).find("."+t).click((function(e){if($(this).find("select").length){var t=$(renderingUtils.getTargetElem(e));if(t.parent("[class^=chosen]").length||t.filter("[class^=chosen]").length)return void($(this).closest(".dashboarddiv:visible").length&&$("#tabDivCreateComponent #layoutName").focus());$("body").trigger("click"),sE(),$(this).find("select").trigger("select2:open")}else $(this).children().find("#combo").length&&0===$(this).find("#optionsHolder:visible").length?($("body").trigger("click"),sE(),$(this).children().find("#combo").click()):$(this).find('input[type="text"]').length?$(this).find('input[type="text"]').focus():$(this).find("textarea").length&&$(this).find("textarea").focus()}))},CrmDashboard.removeCachedVal=function(e){CrmDashboard.chartCache[e]=void 0},CrmDashboard.findAndRemoveCachedVal=function(e){for(var t in CrmDashboard.chartCache)if(CrmDashboard.chartCache[t].dashletId===e){CrmDashboard.chartCache[t]=void 0;break}},CrmDashboard.formFiltersForDefaultCharts=function(e,t){for(var a=$("#"+t+"_filters").find("#datefilter"),i=e.dateFilters,n=i.length,r="",s=0;s<n;s++){var o=i[s];r+='<option value="'+$ESAPI.encoder().encodeForHTMLAttribute(o.val)+'" '+(o.sdate?'data-sdate="'+o.sdate+'" data-edate="'+o.edate+'"':"")+" "+(o.selected?"selected":"")+">"+$ESAPI.encoder().encodeForHTML(o.displayLabel)+"</option>"}a.append(r),thirdPartyUtils.bindSelect2(a),a.trigger("onchange"),CrmDashboard.formUserFilter(t)},CrmDashboard.changeFilters=function(e){var t=(e=$(e)).closest(".report_FilterSection"),a=e.find("option:selected");"${AGE"===e.val()?(t.find("#ageindaysfields").show(),t.find("#datefields").hide()):(t.find("#ageindaysfields").hide(),a.attr("data-sdate")?(t.find("#startdate").val(a.attr("data-sdate")),t.find("#enddate").val(a.attr("data-edate"))):t.find("#startdate, #enddate").val(""),t.find("#datefields").show())},CrmDashboard.applyFilter=function(e){var t=$("#"+e+"_filters"),a=[],i={searchfieldtype:"DT",searchfield:"CrmPotential:CREATEDTIME",searchModule:"Potentials"},n=t.find("#datefilter").val();if("${AGE"===n){var r=t.find("#ageindays").val();if(!r)return;i.value=t.find("#selDays").find("select").val()+r+"}",i.condition=6}else if("custom"===n){i.condition=14;var s=t.find("#startdate").val(),o=t.find("#enddate").val();if(!dateValidate("startdate","startdate",void 0,void 0,t.find("#startdate")[0])||!dateValidate("enddate","enddate",void 0,void 0,t.find("#enddate")[0]))return;if(i.value=t.find("#startdate").val()+","+t.find("#enddate").val(),Utils.getDayDiff(new Date(o),new Date(s))>93)return void renderingUtils.showCustomAlert("Please provide a date interval within 3 months",void 0,!1)}else i.condition=14,i.value=n;a.push(i);var l=t.find("#userFilter");"0"!==l.val()&&((i=JSON.parse(l.attr("data-params"))).value=l.val(),a.push(i));var d=JSON.parse($("#"+e).attr("data-params"));d.filters=JSON.stringify(a),CrmDashboard.loadDashboards(void 0,void 0,d)},CrmDashboard.formUserFilter=function(e){var t=$("#"+e+"_filters").find("#userFilter"),a=Crm.userDetails.USER_ID;void 0===InfoForDisplay&&loadDataForDisplayAndMentions(!1,!0);var i=JSON.parse(InfoForDisplay);i=i.filter((function(e){return"user"==e.type}));for(var n=Crm.userDetails.NAME_FORMAT,r=n.indexOf("First")<n.indexOf("Last"),s=i.length,o="",l=0;l<s;l++){var d=i[l];if(r)var c=(d.firstName&&0!=d.firstName.length?d.firstName+" ":"")+d.lastName;else c=(d.lastName&&0!=d.lastName.length?d.lastName+" ":"")+d.firstName;o+='<option value="'+d.id+'">'+$ESAPI.encoder().encodeForHTML(c)+"</option>"}"Administrator"===Crm.userDetails.PROFILE_NAME&&(o+='<option value="0">'+I18n.getMsg("AllUsers")+"</option>",a="0"),t.append(o),t.val(a),thirdPartyUtils.bindSelect2(t)},CrmDashboard.refreshPageComponents=function(e,t){var a=$(t);a.attr("data-params")&&(dataObj=JSON.parse(a.attr("data-params")));$(".hview-refresh .tb_small_loader").addClass("ref_loading");if(CrmDashboard.isAnalyticsEnabled&&$(".dashboardContent").empty(),$(".dashBrdContent").each((function(){delete CrmDashboard.chartCache[this.id];var e=$(this);e.attr("data-loaded",!1),CrmDashboard.isAnalyticsEnabled&&CrmAnalytics.insertLoader(e)})),CrmDashboard.isAnalyticsEnabled){var i="/crm/v2/Home/"+dataObj.pageId+"/refresh";CrmAnalytics.getApiData(i,crmConstants.requestMethods.POST,(function(e){CrmDashboard.loadDashboards(void 0,void 0,dataObj),commonUtils.showHideLoadingDiv(!1)}))}else CrmDashboard.loadDashboards(void 0,void 0,dataObj)},CrmDashboard.populateContactsImageMapAndLoadCv=function(e,t,a,i){for(var n=e.heading,r=n.length,s=!1,o=0,l=0;l<r;l++){if("CONTACTID"===n[l].COLUMNNAME){s=!0,o=l;break}}var d=e.body;if(s&&d.length){var c=CrmDashboard.getContactIds(d,o);CrmDashboard.loadContactImages(c)}},CrmDashboard.renderCV=function(e,t,a,i){var n=Handlebars.templates.moduleCV(e);if($("#layout_"+t).html(n),Crm.userDetails.isBestTimeEnabled&&Crm.userDetails.isZiaReminderEnabled&&"Tasks"===i){var r=$("#remindByZia");r.hasClass("diZiaDashBoard")&&e.body.length?r.show():r.hide()}crmNavig.parseCurrentListView(),"0"===a&&$("input.h_duedate").each(crmTemplate.bindEventsToDateField),$("#"+t).attr("data-loaded","true")},CrmDashboard.loadContactImages=function(e){if(e.length){var t="/crm/v2.2/Contacts?ids="+e+"&fields=Record_Image,Layout";CrmDashboard.processingIds=CrmDashboard.processingIds.concat(e),CrmAnalytics.getApiData(t,crmConstants.requestMethods.GET,(function(t){CrmDashboard.processingIds=CrmDashboard.processingIds.filter((function(t){return!e.includes(t)}));for(var a=t.data,i=a.length,n=0;n<i;n++){var r,s=a[n].id,o=a[n].Record_Image;r=a[n].Layout?a[n].Layout.id:CrmDashboard.layoutTypeIdMap.Standard,!$.isEmptyObject(CrmDashboard.layoutImageMap)&&CrmDashboard.layoutImageMap[r]||(o=null);for(var l=null!==o?Crm.getCrmBasePath()+"/EntityImageAttach.do?action_module=Contacts&entityId="+s+"&actionName=readImage&fileId="+o:networkUtils.getImageUrl("nophoto_80ea3af_.png",ResourceConstants.CRM),d=$(".Image_"+s),c=d.length,m=0;m<c;m++){d.eq(m).attr({src:l,style:"width:100%;height:100%;border-radius: 50%;"})}}}),(function(){CrmDashboard.needToLoadContactImage=!1;for(var e=$(".Image_"+contactId),t=e.length,a=0;a<t;a++){e.eq(a).attr("src",networkUtils.getImageUrl("nophoto_80ea3af_.png",ResourceConstants.CRM))}}))}},CrmDashboard.removeAlreadyProcessedContactIds=function(e){for(var t=CrmDashboard.processedIds,a=t.length,i=0;i<a;i++){var n=e.indexOf(t[i]);n>-1&&e.splice(n,1)}return!(e.length>0)},CrmDashboard.getContactIds=function(e,t){for(var a={},i=e.length,n=[],r=0;r<i;r+=1){var s=e[r];if(void 0===s)break;var o=s.CONTENT[t];if(""!==o){var l=o.ENTITYID;!a.hasOwnProperty(l)&&CrmDashboard.processingIds.indexOf(l)<=-1&&(n.push(l),a[l]=!0)}}return n},CrmDashboard.loadTrendDashboard=function(e,t,a){var i={};i.dbItemId=e,i.clickId="populateChart",i.action="trendDBOptionsChange",i.isload=!0,i.persist=a,i.filters=JSON.stringify(t),$("#"+e).find(".dIdashFreeze").length||$("#"+e).append('<div class="dIdashFreeze"></div>'),CrmDashboard.loadDashboards(void 0,void 0,i)},CrmDashboard.showTrendDBUserSelector=function(e,t){e=e.toString();var a=$("#trendDBUserList_"+e);t||(CrmDashboard.trendDashboardObj[e].filters.selected.group=CrmDashboard.trendDashboardObj[e].filters.current.group,CrmDashboard.trendDashboardObj[e].filters.selected.group?(CrmDashboard.trendDashboardObj[e].filters.selected.groupids=$.extend(!0,[],CrmDashboard.trendDashboardObj[e].filters.current.ids),CrmDashboard.trendDashboardObj[e].filters.selected.userids=[]):(CrmDashboard.trendDashboardObj[e].filters.selected.userids=$.extend(!0,[],CrmDashboard.trendDashboardObj[e].filters.current.ids),CrmDashboard.trendDashboardObj[e].filters.selected.groupids=[]));var i=CrmDashboard.trendDashboardObj[e].filters.selected.group,n=$.extend(!0,[],i?CrmDashboard.trendDBGroupList:CrmDashboard.trendDBUserList),r=[];n.forEach((function(e,t){t<10&&r.push(e)})),CrmDashboard.trendDashboardObj[e].dashboardUserOrGroupCount=10,$("#userOrGroup_"+e+" li[usertype="+(i?"group":"user")+"]").click(),a.empty().append(Handlebars.templates.TrendDashboardUserList({dbItemId:e,userlist:r})),CrmDashboard.checkSelectedIds(e),"none"===$(".diUserListContainerData."+e).css("display")&&Crm.trackSpotLightAction("AI Trend DashBoard - User Select Click")},CrmDashboard.checkSelectedIds=function(e,t){e=e.toString(),$("#trendDBUserList_"+e+" li").removeClass("selected"),$("#trendDBUserList_"+e+" li input").prop("checked",!1);var a=CrmDashboard.trendDashboardObj[e].filters.selected[CrmDashboard.trendDashboardObj[e].filters.selected.group?"groupids":"userids"];a.forEach((function(t){var a=$("#trendDBUserList_"+e+" li[data-id="+t+"]");null!=a&&(a.addClass("selected"),a.find("input").prop("checked",!0))})),CrmDashboard.trendDashboardObj[e].filters.selected.usercount=a.length,CrmDashboard.trendDBCheckSelectAll(e),CrmDashboard.updateUserCount(e)},CrmDashboard.trendDBUserTypeChange=function(e,t){e=e.toString();var a="group"==$(t).attr("usertype");CrmDashboard.trendDashboardObj[e].filters.selected.group!=a&&(CrmDashboard.trendDashboardObj[e].dashboardUserOrGroupCount=0,CrmDashboard.trendDashboardObj[e].filters.selected.group=a,CrmDashboard.showTrendDBUserSelector(e,!0))},CrmDashboard.trendDBSelectUser=function(e,t){e=e.toString(),t=$($(t).parent());var a=CrmDashboard.trendDashboardObj[e].filters,i=a.selected.group,n=t.data("id"),r=a.selected[i?"groupids":"userids"],s=r.indexOf(n);t.hasClass("selected")?(t.removeClass("selected"),a.selected.usercount=a.selected.usercount-1,-1!=s&&r.splice(s,1)):(t.addClass("selected"),a.selected.usercount=a.selected.usercount+1,-1==s&&r.push(n)),CrmDashboard.trendDBCheckSelectAll(e),CrmDashboard.updateUserCount(e)},CrmDashboard.trendDBSelectAllUser=function(e){e=e.toString();var t=CrmDashboard.trendDashboardObj[e].filters,a=t.selected.group;if($("#userSelectAll_"+e).prop("checked"))if("yes"==$("#userSelectAll_"+e).attr("partialCheck"))$("#userSelectAll_"+e).prop("checked",!1),$("#userSelectAll_"+e).attr("partialCheck","false"),$("#trendDBUserList_"+e+" li").removeClass("selected"),$("#trendDBUserList_"+e+" li input").prop("checked",!1),CrmDashboard.trendDashboardObj[e].filters.selected.usercount=0,t.selected[a?"groupids":"userids"]=[],CrmDashboard.updateUserCount(e,0);else{$("#trendDBUserList_"+e+" li").addClass("selected"),$("#trendDBUserList_"+e+" li input").prop("checked",!0);var i=CrmDashboard.trendDashboardObj[e].filters.selected;i.usercount=i.group?CrmDashboard.trendDBGroupList.length:CrmDashboard.trendDBUserList.length,t.selected[a?"groupids":"userids"]=[],CrmDashboard.updateUserCount(e,i.usercount)}else $("#trendDBUserList_"+e+" li").removeClass("selected"),$("#trendDBUserList_"+e+" li input").prop("checked",!1),CrmDashboard.trendDashboardObj[e].filters.selected.usercount=0,t.selected[a?"groupids":"userids"]=[],CrmDashboard.updateUserCount(e,0)},CrmDashboard.updateUserCount=function(e,t){e=e.toString(),t=null!=t?t:CrmDashboard.trendDashboardObj[e].filters.selected.usercount;var a=$("#trendDBUserCount_"+e),i=a.parents(".diAllCheckBoxContainerSection");i.show(),t>0?(a.hasClass("noneSelected")&&(a.parent().show(),a.removeClass("noneSelected")),a.text(t)):a.hasClass("noneSelected")||(a.parent().hide(),a.addClass("noneSelected"),i.find(".selectAllUser").hasClass("hide")&&i.hide())},CrmDashboard.trendDashbboardUserFilterChange=function(e){e=e.toString();var t=[],a=CrmDashboard.trendDashboardObj[e].filters.current,i=CrmDashboard.trendDashboardObj[e].filters.selected.group,n=$("#userSelectAll_"+e);n.prop("checked")?"yes"!=n.attr("partialCheck")&&(i?CrmDashboard.trendDBGroupList.each((function(e){t.push(e.id)})):CrmDashboard.trendDBUserList.each((function(e){t.push(e.id)}))):t=i?CrmDashboard.trendDashboardObj[e].filters.selected.groupids:CrmDashboard.trendDashboardObj[e].filters.selected.userids,a.group==i&&CrmIntelligence.areArraysEqual(a.ids,t)||(a.ids=t,a.usercount=t.length,a.group=i,CrmDashboard.trendDashboardObj[e].filters.selected=$.extend(!0,{},a),CrmDashboard.trendDashboardObj[e].dataloaded=!1,CrmDashboard.loadTrendDashboard(e,CrmDashboard.getProccessedFilters(a),!0),$(".userSettings."+e).text(I18n.getMsg(i?"crm.label.selected.groups":"crm.label.selectedusers")+": "+a.usercount)),$("#"+e).find(".diUserListContainerData").find("input").val(""),$("#"+e).find(".diUserListContainerData").find("li").show(),$("#"+e).find(".diUserListContainerData").fadeOut(200),CrmDashboard.trendDashboardObj[e].filters.searchList=[],CrmDashboard.trendDashboardObj[e].dashboardUserOrGroupCount=0,$("#trendDBUserList_"+e).html()},CrmDashboard.trendDashbboardUserFilterReset=function(e){var t=CrmDashboard.trendDashboardObj[e].filters.selected;t.group?(t.groupids=$.extend(!0,[],t.ids),t.userids=[]):(t.userids=$.extend(!0,[],t.ids),t.groupids=[]),CrmDashboard.trendDashboardObj[e].filters.searchList=[],CrmDashboard.trendDashboardObj[e].dashboardUserOrGroupCount=0,$("#trendDBUserList_"+e).html()},CrmDashboard.trendDashbboardDateChange=function(e,t,a){e=e.toString();var i=CrmDashboard.trendDashboardObj[e].filters.current.date,n=CrmDashboard.trendDashboardObj[e].filters.current,r=$(".periodFilterDrop."+e+" select").val();t||(a=CrmDashboard.getCurrentDateFilter(e)),CrmIntelligence.areObjectsEqual(a,i)&&r==n.period||(CrmDashboard.processPeriodSelector(e,a),n.date=a,n.period=$(".periodFilterDrop."+e+" select").val(),CrmDashboard.trendDashboardObj[e].filters.selected=$.extend(!0,{},n),CrmDashboard.trendDashboardObj[e].dataloaded=!1,CrmDashboard.updateTrendDashboardRecentFilters(e,a),CrmDashboard.setTrendDashboardRecentFilters(e),CrmDashboard.loadTrendDashboard(e,CrmDashboard.getProccessedFilters(n),!0)),$("#"+e).find(".diUserSettingContainerData").fadeOut(200)},CrmDashboard.trendDashbboardPeriodChange=function(e,t){e=e.toString(),CrmDashboard.trendDashboardObj[e].filters.current.period!=t&&(filters=CrmDashboard.trendDashboardObj[e].filters.current,filters.period=t,CrmDashboard.trendDashboardObj[e].filters.selected=$.extend(!0,{},filters),CrmDashboard.trendDashboardObj[e].dataloaded=!1,CrmDashboard.loadTrendDashboard(e,CrmDashboard.getProccessedFilters(filters),!0))},CrmDashboard.getCurrentDateFilter=function(e){e=e.toString();var t={},a=$(".dateFilter.selected."+e).attr("datetype");switch(t.type=a,a){case"last":t.steps=$(".lastPeriodSteps."+e+" select").val();case"current":t.period=$(".dateFilterDrop."+a+"Period."+e+" select").val();break;case"custom":t.start=CrmIntelligence.convertDateObjectToString(crmCalendar.getDateObjectFromGivenDateString($(".startDate.customPeriod."+e+" input").val())),t.end=CrmIntelligence.convertDateObjectToString(crmCalendar.getDateObjectFromGivenDateString($(".endDate.customPeriod."+e+" input").val()))}return t},CrmDashboard.getProccessedFilters=function(e){var t={};return t.period=e.period,t.date=e.date,t.group=e.group,t.userIds=t.group?[]:$.extend(!0,[],e.ids),t.groupIds=t.group?$.extend(!0,[],e.ids):[],t.criteria=e.criteria,t.seriesIndex=e.seriesIndex,t},CrmDashboard.plotTrendDBGraph=function(e,t){e=e.toString();var a=t.result,i=$("#chartdiv_"+e);if(null!=a){switch(a.code){case 0:CrmDashboard.preprocessTrendDashboardItem(e,t);var n=CrmDashboard.trendDashboardObj[e];CrmDashboard.reprocessTrendAnalysisResponse(a),a.start=0,a.end=30,a.length=a.date.length,a.seriesIndex=n.filters.current.seriesIndex,CrmDashboard.createTrendDashboardGraph("chartdiv_"+e,a,e,!0,!0),CrmDashboard.activateSlider(e);break;case 2:CrmDashboard.preprocessTrendDashboardItem(e,t);var r=$("#"+e).find(".dIEmailAnamoly");r.length&&r.remove(),!Crm.isZohoChartsEnabled&&i.highcharts()&&i.highcharts().destroy(),i.empty(),i.html("<br/><br/>"+I18n.getMsg(a.info))}$("#"+e).find(".dIdashFreeze").length&&$("#"+e).find(".dIdashFreeze").remove()}else!Crm.isZohoChartsEnabled&&i.highcharts()&&i.highcharts().destroy(),i.html("<br/><br/>"+I18n.getMsg(t.error))},CrmDashboard.preprocessTrendDashboardItem=function(e,t){e=e.toString();var a=t.result,i=$("#trendDashboardFilters_"+e),n=$(".trendDBRowSectionDate"),r=n.find("select");if(!$.trim(i.html())){i.empty().append(Handlebars.templates.TrendDashboardUserFilter({dbItemId:e,userSettings:I18n.getMsg("crm.security.usersList"),userType:I18n.getMsg("Users")}));for(var s=[],o=1;o<100;o++)s[o-1]=o;i.append(Handlebars.templates.TrendDashboardDateFilter({dbItemId:e,dateSettings:I18n.getMsg("crm.emailstats.daterange"),thisYear:(new Date).getFullYear(),range:s}));var l=$("#trendDashboardFilters_"+e);l.addClass("pR"),$('<span class="dIDashboardReset" onclick="CrmDashboard.resetTrendDashboardGraph(\''+e+"')\"></span>").insertBefore(l.find(".dIUserListContainer")),n.find(".select2").length&&thirdPartyUtils.unbindChildSelect2(r),thirdPartyUtils.bindSelect2($(".lastPeriodSteps."+e+" select")),thirdPartyUtils.bindSelect2(r),thirdPartyUtils.bindSelect2($(".dIDateRangeContainerUlLi").find("select"))}var d=CrmDashboard.trendDashboardObj[e];null==d&&(d={},CrmDashboard.trendDashboardObj[e]=d,d.filters={},d.filters.recent=t.options,d.filters.current=CrmDashboard.getTrendDashboardCurrentFilters(t.options),d.filters.selected=$.extend(!0,{},d.filters.current),d.iszoomed=!1,CrmDashboard.getGroupList(),CrmDashboard.getUserList(),d.parent={},d.dashboardUserOrGroupCount=0,CrmDashboard.setTrendDashboardRecentFilters(e)),d.result=a,CrmDashboard.proccessTrendDBDateFilters(e,a.startdate,a.enddate),d.iszoomed?d.dataloaded=!0:CrmDashboard.setTrendDashboardFilters(e),CrmDashboard.setTrendDashboardDate(e)},CrmDashboard.proccessTrendDBDateFilters=function(e,t,a){e=e.toString();var i="yyyy-MM-dd",n=CrmDashboard.trendDashboardObj[e],r=crmCalendar.getDateObjectFromGivenDateString(t,i),s=crmCalendar.getDateObjectFromGivenDateString(a,i),o=new Date;o.getTime()<s.getTime()&&(s=o);var l=crmCalendar.convertToUserDatePattern(r.getDate()+" "+r.getMonth()+" "+r.getFullYear()),d=crmCalendar.convertToUserDatePattern(s.getDate()+" "+s.getMonth()+" "+s.getFullYear()),c=CrmIntelligence.getReadableDate(r,"day"),m=CrmIntelligence.getReadableDate(s,"day");n.filters.selected.date.start={},n.filters.selected.date.end={},n.filters.selected.date.start.str=t,n.filters.selected.date.end.str=a,n.filters.selected.date.start.obj=r,n.filters.selected.date.end.obj=s,n.filters.selected.date.start.userformat=l,n.filters.selected.date.end.userformat=d,n.filters.selected.date.start.day=c,n.filters.selected.date.end.day=m,CrmDashboard.trendDashbboardUserFilterReset(e)},CrmDashboard.getTrendDashboardCurrentFilters=function(e){var t={};return t.period=e.period[0],t.date=$.extend(!0,{},e.date[0]),t.group=e.group,t.ids=t.group?$.extend(!0,[],e.groupIds):$.extend(!0,[],e.userIds),t.usercount=t.ids.length,t.criteria=$.extend(!0,[],e.criteria),t},CrmDashboard.setTrendDashboardFilters=function(e){e=e.toString();var t=CrmDashboard.trendDashboardObj[e].filters.selected,a=t.date.type;switch($(".dateFilter."+e).removeClass("selected"),$(".dateFilter."+e+"."+a).addClass("selected").click(),a){case"last":var i=".lastPeriodSteps."+e+" select";$(i).val(t.date.steps).trigger("change");case"current":i=".dateFilterDrop."+a+"Period."+e+" select";$(i).val(t.date.period).trigger("change");case"custom":i=".startDate.customPeriod."+e+" input";$(i).val(t.date.start.userformat),i=".endDate.customPeriod."+e+" input",$(i).val(t.date.end.userformat)}i=".periodFilterDrop."+e+" select";$(i).val(t.period).trigger("change"),i=".userSettings."+e,$(i).text(I18n.getMsg(t.group?"crm.label.selected.groups":"crm.label.selectedusers")+": "+t.usercount),CrmDashboard.trendDashboardObj[e].dataloaded=!0,CrmDashboard.restrictYearPeriodSteps(e),CrmDashboard.processPeriodSelector(e)},CrmDashboard.updateTrendDashboardRecentFilters=function(e,t){e=e.toString();for(var a=CrmDashboard.trendDashboardObj[e].filters.recent.date,i=a.length,n=0;n<a.length;n++)if(CrmIntelligence.areObjectsEqual(t,a[n])){i=n;break}for(;i>0;)i<CrmDashboard.trendDBMaxDateFilters&&(a[i]=a[i-1]),i--;a[i]=t},CrmDashboard.setTrendDashboardRecentFilters=function(e){e=e.toString();for(var t=CrmDashboard.trendDashboardObj[e].filters.recent.date,a=t.length,i=[],n=1;n<a;n++)i.push({}),i[n-1].text=CrmDashboard.getDateString(t[n]),i[n-1].filter=JSON.stringify(t[n]);if(0!=i.length){var r=$(".trendDBrecentFilters."+e);r.removeClass("hide"),r.prev().removeClass("hide");var s=Handlebars.templates.TrendDashboardFilterList({filters:i,dbItemId:e});r.empty().html(s)}},CrmDashboard.getDateString=function(e){var t;switch(e.type){case"current":t=I18n.getMsg("crm.ln.lable.current")+" "+I18n.getMsg(CrmDashboard.periodSingularKeys[e.period]);break;case"last":t=I18n.getMsg("Last")+" "+e.steps+" "+(e.steps>1?I18n.getMsg(CrmDashboard.periodPluralKeys[e.period]):I18n.getMsg(CrmDashboard.periodSingularKeys[e.period]));break;case"custom":var a=crmCalendar.getDateObjectFromGivenDateString(e.start,"yyyy-MM-dd"),i=crmCalendar.getDateObjectFromGivenDateString(e.end,"yyyy-MM-dd");t=crmCalendar.convertToUserDatePattern(a.getDate()+" "+a.getMonth()+" "+a.getFullYear())+" - "+crmCalendar.convertToUserDatePattern(i.getDate()+" "+i.getMonth()+" "+i.getFullYear())}return t},CrmDashboard.setTrendDashboardDate=function(e){e=e.toString();var t=CrmDashboard.trendDashboardObj[e].filters.current.date,a=CrmDashboard.getDateString(t);$(".dateRangeHeader."+e).text(a)},CrmDashboard.slideGraph=function(e,t){e=e.toString();var a=CrmDashboard.trendDashboardObj[e].result,i=a.start,n=a.end,r=(a.length,i+t),s=n+t;a.start=r,a.end=s,CrmDashboard.createTrendDashboardGraph("chartdiv_"+e,a,e,!0,!0),CrmDashboard.activateSlider(e)},CrmDashboard.activateSlider=function(e){e=e.toString();var t=CrmDashboard.trendDashboardObj[e].result.start,a=CrmDashboard.trendDashboardObj[e].result.end,i=CrmDashboard.trendDashboardObj[e].result.length;0==t?$(".dIChartPrevArr."+e).hide():$(".dIChartPrevArr."+e).show(),i<=a?$(".dIChartNextArr."+e).hide():$(".dIChartNextArr."+e).show()},CrmDashboard.zoomInTrendDashboard=function(e,t,a){e=e.toString();var i=CrmDashboard.trendDashboardObj[e],n=CrmDashboard.trendDBSubPeriods[i.filters.selected.period];if(n){var r=i.result.start;t+=r,a+=r,$.isEmptyObject(i.parent)&&(i.parent.result=$.extend(!0,{},i.result),i.parent.filters=$.extend(!0,{},i.filters),i.iszoomed=!0);var s=CrmDashboard.getProccessedFilters(i.filters.current),o={type:"custom"};o.start=i.result.rawDate[t],o.end=CrmIntelligence.getPeriodEndDate(i.result.rawDate[a],s.period),s.date=o,s.period=n,i.filters.selected.period=n,i.dataloaded=!1,CrmDashboard.loadTrendDashboard(e,s,!1),$("#trendDashboardFilters_"+e).find(".dIDashboardReset").css("display","inline-block"),setTimeout((function(){$("#trendDashboardFilters_"+e).find(".dIDashboardReset").css("opacity","1")}),300)}},CrmDashboard.resetTrendDashboardGraph=function(e){e=e.toString();var t=CrmDashboard.trendDashboardObj[e];t.result=t.parent.result,t.filters=t.parent.filters,t.parent={},t.iszoomed=!1,CrmDashboard.createTrendDashboardGraph("chartdiv_"+e,t.result,e,!0,!0),$("#trendDashboardFilters_"+e).find(".dIDashboardReset").fadeOut(200)},CrmDashboard.trendDBSeriesChange=function(e,t,a){e=e.toString(),$(a).parent().find(".dIEmailAnamolySelected").removeClass("dIEmailAnamolySelected"),$(a).addClass("dIEmailAnamolySelected"),CrmDashboard.trendDashboardObj[e].filters.current.seriesIndex=t;var i=CrmDashboard.trendDashboardObj[e].result;CrmDashboard.trendDashboardObj[e].filters.current.seriesIndex=t,i.seriesIndex=t,CrmDashboard.createTrendDashboardGraph("chartdiv_"+e,i,e,!0,!0),"crm.emailstats.bounces"==i.features[t]||"crm.emailstats.opens"==i.features[t]?$("#chartdiv_"+e).highcharts().yAxis[0].axisTitle.attr({text:I18n.getMsg("crm.zinvoice.invoiceDetailedView.rate")}):$("#chartdiv_"+e).highcharts().yAxis[0].axisTitle.attr({text:I18n.getMsg("crm.api.count")}),CrmDashboard.activateSlider(e)},CrmDashboard.reprocessTrendAnalysisResponse=function(e){for(var t=e.date,a=e.features,i=e.original,n=e.normal,r=e.anomaly,s=(e.date,e.period),o=e.currentPeriodIndex,l=[],d=[],c=t.length,m=0;m<c;m++){var u,v=crmCalendar.getDateObjectFromGivenDateString(t[m],"yyyy-MM-dd");if("week"==s){var p=new Date(v.getFullYear(),v.getMonth(),v.getDate()+7);v.getMonth()!=p.getMonth()&&p.getDate()>1&&v.setFullYear(p.getFullYear(),p.getMonth(),1)}Crm.isZohoChartsEnabled||(u=CrmIntelligence.getReadableDate(v,s)),u=CrmDashboard.getReadableDate(v,s),l.push(u),d.push({date:t[m],label:CrmDashboard.getTrendDashboardAxisParams(v,s),labelStr:u,isCurrentPeriod:m==o,period:s})}e.date=l,e.rawDate=t,e.dateParams=d,e.features.forEach((function(t){e.original[t]=CrmIntelligence.convertToPositiveArray(CrmIntelligence.convertToIntArray(e.original[t])),e.anomaly[t]=CrmIntelligence.convertToIntArray(e.anomaly[t]),e.normal[t]=CrmIntelligence.convertToPositiveArray(CrmIntelligence.convertToIntArray(e.normal[t]))}));var h={symbol:"circle",fillColor:"#FFFFFF",lineWidth:2,lineColor:null},g={symbol:"circle",fillColor:"#fff",strokeColor:"#ff6666",lineColor:"#ff6666",states:{hover:{strokeColor:"#ff6666",lineColor:"#ff6666"}}},C={symbol:"circle",fillColor:"#fff",strokeColor:"#ff6666",lineColor:"#ff6666",states:{hover:{strokeColor:"#ff6666",lineColor:"#ff6666"}}};a.forEach((function(e,t){var a=i[e],s=n[e],l=r[e];Crm.isZohoChartsEnabled?l.forEach((function(e,t){var i=a[t];l[t]=-1!=e&&t!=o?i:null})):l.forEach((function(e,t){var i=a[t];a[t]={},-1!=e&&t!=o?(a[t].marker=i<s[t]?g:C,l[t]=i):(a[t].marker=h,l[t]=null),a[t].y=i}))}));var f={};f.name=I18n.getMsg("crm.intelligence.actual"),f.color="#437ec8",f.marker=h,f.index=0,f.stickyTracking=!1;var E={};E.name=I18n.getMsg("crm.intelligence.trend"),E.color="#fdaf89",E.marker={symbol:"circle",fillColor:"#FFFFFF",lineWidth:2,lineColor:null},E.index=1,E.stickyTracking=!1;var I={};I.name=I18n.getMsg("crm.intelligence.anomaly"),I.color="#ff3832",I.marker={symbol:"circle",fillColor:"#fff",strokeColor:"#ff6666",lineColor:"#ff6666",strokeWidth:2,lineWidth:2},I.index=2,I.stickyTracking=!1,e.series=[],e.series.push(f),e.series.push(E),e.series.push(I)},CrmDashboard.getReadableDate=function(e,t){var a=e.getFullYear(),i=e.getMonth(),n=e.getDate(),r=I18n.getMsg(CrmIntelligence.monthShortNames[i]),s=(new Date(a,i,1).getDay()+6)%7,o=Math.ceil((e.getDate()+s)/7),l=null;switch(t){case"day":l=n+" "+r+","+a;break;case"week":switch(o){case 1:l=I18n.getMsg("crm.emailstats.firstweek",[r]).replace("-","")+","+a;break;case 2:l=I18n.getMsg("crm.emailstats.secondweek",[r]).replace("-","")+" "+a;break;case 3:l=I18n.getMsg("crm.emailstats.thirdweek",[r]).replace("-","")+" "+a;break;case 4:l=I18n.getMsg("crm.emailstats.fourthweek",[r]).replace("-","")+" "+a;break;case 5:l=I18n.getMsg("crm.emailstats.fifthweek",[r]).replace("-","")+" "+a;break;case 6:l=I18n.getMsg("crm.emailstats.sixthweek",[r]).replace("-","")+" "+a}break;case"month":l=r+" "+a.toString();break;case"year":l=a.toString()}return l},CrmDashboard.getTrendDashboardAxisParams=function(e,t){var a=null;switch(t){case"day":a=[e.getDate(),I18n.getMsg(CrmIntelligence.monthShortNames[e.getMonth()])+" "+e.getFullYear()];break;case"week":var i=(new Date(e.getFullYear(),e.getMonth(),1).getDay()+6)%7,n=Math.ceil((e.getDate()+i)/7);a=[n=1==n?n+I18n.getMsg("st"):2==n?n+I18n.getMsg("nd"):3==n?n+I18n.getMsg("rd"):n+I18n.getMsg("th"),I18n.getMsg(CrmIntelligence.monthShortNames[e.getMonth()])+" "+e.getFullYear()];break;case"month":a=[I18n.getMsg(CrmIntelligence.monthShortNames[e.getMonth()]),e.getFullYear()];break;case"year":a=e.getFullYear()}return a},CrmDashboard.createTrendDashboardGraph=function(e,t,a,i,n){if(Crm.isZohoChartsEnabled){var r={};CrmDashboard.setChartMetadata(r,t),CrmDashboard.setSeriesData(r,t),r.canvas=CrmChartUtil.getCanvasData().canvas,r.tooltip=CrmChartUtil.getTooltipData(!0,!1,"#fff","black",!0,void 0).tooltip,r.legend=CrmChartUtil.getLegendData("true",!1,void 0,"center","bottom").legend;var s=$("#"+e);s.empty(),CrmChartUtil.renderChart(s[0],r,!0)}else{var o=t.start?t.start:0,l=t.end?t.end:0,d=t.seriesIndex?t.seriesIndex:0,c=$("#"+e),m=(a=e.split("_")[1],$(".crmTrendDashBoard")),u=c.highcharts(),v=t.dateParams.slice(o,l),p=t.features,h=p[d],g=t.currentPeriodIndex<l?t.currentPeriodIndex-o:-1,C=t.series;if("day"==t.period?c.addClass("disableZoomColor"):c.removeClass("disableZoomColor"),C[0].data=t.original[h].slice(o,l),C[1].data=t.normal[h].slice(o,l),i&&null!=u)return u.xAxis[0].plotLinesAndBands[0].options.value=g,u.xAxis[0].setCategories(v),u.series[1].setData(C[1].data),u.series[0].setData(C[0].data),u.xAxis[0].dataMax=v.length,u.xAxis[0].max=v.length,void(n&&u.redraw());c.empty();var f=I18n.getMsg("crm.api.count"),E="";if("Amount"==h){var I=Crm.userDetails.CURRENCY_DETAILS[Crm.userDetails.BASE_CURRENCY];I&&(E=I.symbol),f=I18n.getMsg("Amount")}$("#"+e).height(410);var y="rgba(51,92,173,0.25)";"diNotificationDetailsContent"==e&&(y="none"),c.highcharts({chart:{type:"spline",zoomType:"x",width:m.length?$("#diNotificationDetails").is(":visible")?null:c.width()-100:null,height:m.length?p.length>1?350:390:null,selectionMarkerFill:y,animation:{duration:1e3},events:{load:function(){if(p.length>1){var e={features:p,dbItemId:a},t=Handlebars.templates.TrendDashboardFeatureSelector(e);$(t).insertBefore(c)}var i=c.highcharts().series[2].legendItem.element,n=$(i).parent();n.attr("class","highcharts-legend-item cD makeallcD");var r=n.html();i.onclick=function(){$(this).parent().html(r)},$(c).find("svg").parent().addClass("pR");var s='<div class="dIChartPrevArr '+a+' cP" onclick="CrmIntelligence.nextArrowPress(\''+a+'\',0)"></div><div class="dIChartNextArr '+a+' cP" onclick="CrmIntelligence.nextArrowPress(\''+a+"',1)\"></div>";$(c).addClass("pR").append(s);var o=$(c).find(".tooltiptext");if(!o.length){t="<div class='tooltiptext greenC crm-font-regular'>Today</div>";$(c).append(t)}o.css({visibility:"visible",opacity:1})},selection:function(t){if("none"!=y&&t.xAxis){var a=Math.ceil(t.xAxis[0].min),i=Math.floor(t.xAxis[0].max);a<=i&&CrmDashboard.zoomInTrendDashboard(e.split("_")[1],a,i)}return!1}}},credits:{enabled:!1},subtitle:{text:null},xAxis:{plotLines:[{color:"#bababa",value:g,width:1,dashStyle:"dash",events:{mouseover:function(e){CrmIntelligence.displayTooltipPlotLines(this,e,this.svgElem.d.split(" ")[1])},mouseout:function(){$(".tooltiptext").hide()}}}],alternateGridColor:"#fdfcfc",categories:v.slice(o,l),gridLineWidth:0,gridLineDashStyle:"dash",gridLineColor:"#ebebeb",startOnTick:!1,endOnTick:!1,labels:{useHTML:!0,y:25,rotation:0,formatter:function(){var e="";if("object"==typeof this.value){this.isFirst&&"week"==this.value.period&&(e=e+'<div class="forWeeklyEnabled">'+I18n.getMsg("weeks")+"</div>");var t="year"==this.value.period?this.value.label:this.value.label[1];e=e+'<div class="dIB dIChartLabelColor crm-font-regular'+(this.value.isCurrentPeriod?"dselected":"")+'">'+("year"==this.value.period?this.value.label:this.value.label[0])+"</div>",dTemp!=t&&"year"!=this.value.period&&(e=e+'<div class="fL cB mT10 dIChartPrimaryLabel crm-font-regular  pA">'+this.value.label[1]+"</div>",dTemp=t)}return e}}},yAxis:{allowDecimals:!1,gridLineDashStyle:"dash",gridLineWidth:1,gridLineColor:"#efefef",title:{text:f,margin:20},labels:{x:-25},lineColor:"#ccc",min:0,plotLines:[{value:0,width:1,color:"#808080"}]},legend:{enabled:!0,align:"center",verticalAlign:"bottom",layout:"horizontal",backgroundColor:"#FFF",borderRadius:"5px",floating:!1,margin:30,symbolHeight:10,symbolWidth:10,symbolRadius:60,itemDistance:30,itemStyle:{fontFamily:"LatoRegular",fontSize:"14px",Color:"#111",backgroundColor:"#FFF",borderRadius:"5px"},useHTML:!0,legendFormatter:function(){return $ESAPI.encoder().encodeForHTML(this.name)}},tooltip:{borderWidth:2,style:{padding:0},useHTML:!0,formatter:function(){var e={data:{name:this.point.marker&&"#ff6666"==this.point.marker.strokeColor?I18n.getMsg("crm.intelligence.anomaly"):this.series.name,value:this.key.labelStr+" : "+E+" "+this.y}};return Handlebars.templates.TrendDashboardToolTip(e)}},plotOptions:{spline:{dashStyle:"solid"},series:{shadow:{width:15,offsetX:2,offsetY:2,color:"rgba(0,0,0,.070)"}}},series:$.extend(!0,[],C)})}},CrmDashboard.setChartMetadata=function(e,t){var a=[],i=[],n=[],r=[];a.push(0),n.push(0),r.push({dataindex:0,columnname:"week"});for(var s=t.series.length,o=0;o<s;o++){var l={dataindex:1,columnname:$ESAPI.encoder().encodeForHTML(t.series[o].name),datatype:"numeric"};0==i.length&&(i[0]=[]),i[0].push(o+1),n.push(o+1),r.push(l)}e.metadata=CrmChartUtil.getMetaData(a,i,r,n).metadata},CrmDashboard.setSeriesData=function(e,t){var a=t.start?t.start:0,i=t.end?t.end:0,n=t.seriesIndex?t.seriesIndex:0,r=t.dateParams.slice(a,i),s=t.features[n],o=t.series;o[0].data=t.original[s].slice(a,i),o[1].data=t.normal[s].slice(a,i),o[2].data=t.anomaly[s].slice(a,i);for(var l=[],d=r.length,c=o.length,m=[],u=0;u<d;u++){for(var v=r[u].labelStr,p=0;p<c;p++)if(l[p]||(l[p]={seriesname:$ESAPI.encoder().encodeForHTML(o[p].name+""),type:"line",data:[],yaxiscolumnorder:[0,p]},2==p&&(l[p].type="scatter",l[p].plotoptions={datalabels:{show:!1},animation:{enabled:!1}}),l[p].data[0]=[]),-1!=o[p].data[u]){var h=[v,o[p].data[u]];l[p].data[0].push(h)}m.push(v)}e.seriesdata=CrmChartUtil.getSeriesData(l).seriesdata;var g=CrmChartUtil.getPlotOptionForLine("cardinal");e.chart=CrmChartUtil.getChartAxesData(!1,!0,!0,void 0,void 0,!0,!0,!1,I18n.getMsg("crm.api.count"),!0,void 0,void 0,void 0,m,g,void 0,!1).chart},CrmDashboard.trendDBCheckSelectAll=function(e){e=e.toString();var t=$("#userSelectAll_"+e);CrmDashboard.trendDashboardObj[e].filters.selected.usercount>=CrmDashboard.trendDBUserList.length?(t.prop("checked",!0),t.attr("partialCheck","false")):(t.prop("checked",!1),t.attr("partialCheck","yes"))},CrmDashboard.getUserList=function(){if(null==CrmDashboard.trendDBUserList&&!CrmDashboard.trendDBUserListProcessed){var e=Crm.getCrmBasePath()+"/ShowEmailStatsUserGroup.do?usertype=allusers&category=user";mR(e,(function(e){CrmDashboard.trendDBUserList=[],JSON.parse(e).userlist.forEach((function(e){var t={};t.id=e.usersid,t.name=e.usersname,t.photo=e.userphoto,CrmDashboard.trendDBUserList.push(t)}))}))}CrmDashboard.trendDBUserListProcessed=!0},CrmDashboard.getGroupList=function(){if(null==CrmDashboard.trendDBGroupList&&!CrmDashboard.trendDBGroupListProcessed){var e=Crm.getCrmBasePath()+"/ShowEmailStatsUserGroup.do?usertype=groups&category=user";mR(e,(function(e){CrmDashboard.trendDBGroupList=[],JSON.parse(e).grouplist.forEach((function(e){var t={};t.id=e.groupid,t.name=e.groupname,CrmDashboard.trendDBGroupList.push(t)}))}))}CrmDashboard.trendDBGroupListProcessed=!0},CrmDashboard.processPeriodSelector=function(e,t){if(e=e.toString(),CrmDashboard.trendDashboardObj[e]&&CrmDashboard.trendDashboardObj[e].dataloaded){var a=[],i=["day","week","month","year"];t=t||CrmDashboard.getCurrentDateFilter(e);var n=i.indexOf($(".periodFilterDrop."+e+" select").val());switch(t.type){case"current":var r=i.indexOf(t.period);a=[0,1,2,3].slice(r-2>0?r-2:0,r);break;case"last":var s=[1,7,30,365][r=i.indexOf(t.period)]*t.steps;a=CrmIntelligence.getAllowedPeriods(s);break;case"custom":if(null!=t.start&&null!=t.end&&""!=t.start.trim()&&""!=t.end.trim()){s=CrmIntelligence.getDayDifferenceFromDateStr(t.start,t.end,"yyyy-MM-dd");a=CrmIntelligence.getAllowedPeriods(s)}}if(CrmDashboard.trendDashboardObj[e].allowedPeriods||(CrmDashboard.trendDashboardObj[e].allowedPeriods=[]),a.length>0&&!CrmIntelligence.areArraysEqual(CrmDashboard.trendDashboardObj[e].allowedPeriods,a)){var o=$(".periodFilterDrop."+e+" select");o.select2(),o.select2("destroy"),o.find("option").prop("disabled",!0),a.forEach((function(e,t){o.find("option").eq(e).prop("disabled",!1)})),-1==a.indexOf(n)&&o.find("option").eq(a[0]).prop("selected",!0),thirdPartyUtils.bindSelect2(o),CrmDashboard.trendDashboardObj[e].allowedPeriods=a}}},CrmDashboard.restrictYearPeriodSteps=function(e){if(e=e.toString(),CrmDashboard.trendDashboardObj[e]&&CrmDashboard.trendDashboardObj[e].dataloaded){var t=CrmDashboard.getCurrentDateFilter(e);if("last"==t.type){if("year"==t.period){(i=$(".lastPeriodSteps."+e+" select")).select2(),i.select2("destroy"),i.find("option").prop("disabled",!0);for(var a=0;a<5;a++)i.find("option").eq(a).prop("disabled",!1);t.steps>5&&i.find("option").eq(4).prop("selected",!0)}else{var i;if((i=$(".lastPeriodSteps."+e+" select")).select2(),i.select2("destroy"),i.find("option").prop("disabled",!1),"month"==t.period){i.find("option").prop("disabled",!0);for(a=0;a<60;a++)i.find("option").eq(a).prop("disabled",!1);t.steps>60&&i.find("option").eq(59).prop("selected",!0)}}thirdPartyUtils.bindSelect2(i)}}},CrmDashboard.showHideCountOptions=function(e){if("None"===(e=$(e)).val())return $("#kpi_summaryFields, #kpi_common, #kpi_objective, #kpi_count_label").hide(),void $("#kpi_save_button").attr("disabled","disabled");var t="0"===e.val();e.parent().find("#kpi_summaryFields").toggle(!t),$("#kpi_common, #kpi_save, #kpi_objective").show(),$("#kpi_objective").show(),$("[name=objective]:checked").val()||$('input[name="objective"][value="1"]').click(),$("#kpi_dateFields").val()&&t&&e.parent().find("#kpi_summaryFields").val()&&$("#kpi_save_button").removeAttr("disabled");var a=t?I18n.getMsg("of")+" "+$("#module").find("option:selected").text():I18n.getMsg("of");$("#kpi_count_label").show().find("span").text(a)},Handlebars.registerHelper("checkColType",(function(e,t,a){var i=e.data_type;return"formula"===i&&e.formula&&(i=e.formula.return_type),"number"===t&&!0!==e["data-enc"]&&["double","integer","currency","bigint"].contains(i)&&207!==e.uitype&&208!==e.uitype&&40!==e.uitype&&80!==e.uitype||"date"===t&&!0!==e["data-enc"]&&("date"===i||"datetime"===i)||"picklist"===t&&"picklist"===i?a.fn(this):a.inverse(this)})),Handlebars.registerHelper("getTranslatedTabLabel",(function(e,t,a){var i=moduleRecordMapping[t],n=i.plural_label;return a&&(n=i.singular_label),I18n.getMsg(e,n)})),CrmDashboard.processKpiData=function(e,t){e.currencyColumn;var a=e.xAxis.categories,i=e.series[0].data;a.length?1===a.length&&(i="Q2"===a[0]?[0,i[0]]:[i[0],0]):i=[0,0];var n="Increase"===e.objective,r=n?i[0]-i[1]:i[1]-i[0],s=n?r>0?i[0]:i[1]:r>0?i[1]:i[0];r<0&&0!=s?(e.className="percentageChange_red",e.imgClass="arrow-down-big",e.percent=-(r/s*100).toFixed(2)+"%"):r>0&&0!=s&&(e.percent=(r/s*100).toFixed(2)+"%",e.className="percentageChange",e.imgClass="arrow-up-big"),e.processedData=i;var o={"${TODAY-2}":I18n.getMsg("crm.label.day.before"),"${YESTERDAY}":I18n.getMsg("Yesterday"),"${WEEK-2}":I18n.getMsg("crm.label.week.before"),"${MONTH-2}":I18n.getMsg("crm.label.month.before"),"${THISYEAR}":I18n.getMsg("crm.thisyear"),"${LASTYEAR}":I18n.getMsg("Last year"),"${LASTWEEK}":I18n.getMsg("Last Week"),"${LASTMONTH}":I18n.getMsg("Last Month")};e.comparingRange=o[e.comparingRange]?o[e.comparingRange]:e.comparingRange,$("#"+t).html(Handlebars.templates.kpi(e))},Handlebars.registerHelper("getkpiData",(function(e,t,a){var i=e.currencyColumn,n=e.processedData[t],r=e.additionalInfo&&void 0!==e.additionalInfo.decimalDigits&&"count"!==e.additionalInfo.yaxisFun?e.additionalInfo.decimalDigits:void 0,s=n;return i?s=currencyUtils.returnValueInDefaultCurrency(Crm.userDetails.BASE_CURRENCY,n):void 0!==r&&(s=commonUtils.formatDecimalValue(n,r,!0)),s})),CrmDashboard.loadAnayticsChart=function(e,t,a){var i=CrmAnalytics.base_url+"/"+a+"/components/"+t;if(CrmDashboard.chartCache[e]){var n=CrmDashboard.chartCache[e].chartJson,r=n.component_type;return r=n.component_props&&n.component_props.visualization_props.type?r+"_"+n.component_props.visualization_props.type:r,CrmAnalytics.setMinMaxDimensions(r,e),CrmAnalytics.renderComponent(n,e),$("#"+e).attr("data-loaded","loaded"),void setDataFetchDate($("#datafetchdate_"+e)[0],CrmDashboard.chartCache[e].chartJson.dataFetchDate)}CrmAnalytics.getApiData(i,crmConstants.requestMethods.GET,(function(n){CrmAnalytics.convertToNewStructure(n);var r=n.component_type,s=n.component_props&&n.component_props.visualization_props.type?n.component_props.visualization_props.type:null;r=s?r+"_"+s:r,CrmAnalytics.setMinMaxDimensions(r,e);var o=s?s.split("_")[0]:void 0;if(CrmAnalytics.isColorSupportedChatType(n.component_type,o)){var l=i+"/describe";CrmAnalytics.getApiData(l,crmConstants.requestMethods.GET,(function(a){var i=a.data.object_relationship;if(i&&i.base_object){var r=i.base_object.moduleName,s=[r];CrmAnalytics.componentIdVsModule[t]=s;var o={};o.response=n,o.layoutId=e,CrmAnalytics.initiateColorCodeRequests(r,o,i).then((function(e){CrmAnalytics.renderComponent(e.response,e.layoutId)}))}else CrmAnalytics.renderComponent(n,e)}))}else CrmAnalytics.renderComponent(n,e);$("#"+e).attr("data-loaded","loaded"),CrmDashboard.chartCache[e]={},CrmDashboard.chartCache[e].dashletId=t,CrmDashboard.chartCache[e].layoutId=e,CrmDashboard.chartCache[e].dashboardId=a,CrmDashboard.chartCache[e].chartJson=objectUtils.cloneObject(n),setDataFetchDate($("#datafetchdate_"+e)[0])}),void 0,{include_report_id:!0})},CrmDashboard.yAxisLabelConfigJson={formatter:function(){var e=objectUtils.getValueFromObj(this,["chart","userOptions","additionalInfo"]),t=objectUtils.getValueFromObj(e,["isBlueprint"]);if(t=t||"Blueprints.Time_taken_for_Transition"===objectUtils.getValueFromObj(e,["yaxis"]))try{return Utils.convertTimeInDoubleToReadableForm(this.value/6e4)}catch(e){}return this.value}},CrmDashboard.isDateField=function(e){return"Blueprints.Time_taken_for_Transition"===objectUtils.getValueFromObj(e,["series","chart","options","additionalInfo","yaxis"])},CrmDashboard.isAllLayoutsImageDisabled=function(e){if(jQuery.isEmptyObject(CrmDashboard.layoutImageMap))return!0;for(var t=!0,a=e.length,i=0;i<a;i++)CrmDashboard.layoutImageMap[e[i]]&&(t=!1);return t},CrmDashboard.hasPermissionToImageField=function(e,t){for(var a=!1,i=e.length,n=0;n<i;n++)for(var r=t[e[n]].sections,s=r.length,o=0;o<s;o++){var l=r[o];if(null!=l.name&&"Record Image"==l.name&&null!=l.fields&&l.fields.length)for(var d=l.fields,c=d.length,m=0;m<c;m++){var u=d[m];"Record_Image"==u.api_name&&u.visible&&(a=!0)}}return a},CrmDashboard.getMoreReportsRecords=function(e,t,a,i,n){var r={status:e,userId:t,stdDateFilter:a,FROM_INDEX:n,action:"getDetails"};Lyte.Router.transitionTo({route:"crm.tab.reports.records",dynamicParams:[i],queryParams:r}).data={isAjax:!0,isFromCall:!0}},CrmDashboard.setCallsNavigationDiv=function(e){$("#showMoreDiv").remove(),$("#showPreviousDiv").remove();var t=$("#reportsPagNation");if(e.requestedObj.totalRowCount>Calls.cvListLimitCount)var a="<div class='fR cP' id='showMoreDiv' onClick=\"CrmDashboard.getMoreReportsRecords('"+e.requestedObj.type.trim()+"', '"+e.requestedObj.ownerId+"', '"+e.requestedObj.stdDateFilter+"','"+e.requestedObj.reportId+"',"+(e.requestedObj.ReqFromIndex+Calls.cvListLimitCount)+")\"><span class='vmiddle mR3'>"+(e.requestedObj.ReqFromIndex+(e.requestedObj.totalRowCount-2))+"</span><span class='dIB next vmiddle'></span></div><span class='dIB mL10 mR10 vmiddle'>to</span> <div class='fL  cP' id='"+showPreviousDivId+"' onClick=\"Crm.getMoreReportsRecords('"+e.requestedObj.type.trim()+"', '"+e.requestedObj.ownerId+"', '"+e.requestedObj.stdDateFilter+"','"+e.requestedObj.reportId+"',"+(e.requestedObj.ReqFromIndex-Calls.cvListLimitCount)+")\"><span class='dIB previous vmiddle'></span><span class='vmiddle mL3'>"+e.requestedObj.ReqFromIndex+"</span></div>";else a="<div class='fR' id='showMoreDiv' ><span class='vmiddle mR3'>"+(e.requestedObj.ReqFromIndex+e.requestedObj.totalRowCount-1)+"</span><span class='dIB nextDisabled vmiddle'></span></div><span class='dIB mL10 mR10 vmiddle'>to</span> <div class='fL  cP' id='"+showPreviousDivId+"' onClick=\"CrmDashboard.getMoreReportsRecords('"+e.requestedObj.type.trim()+"', '"+e.requestedObj.ownerId+"', '"+e.requestedObj.stdDateFilter+"','"+e.requestedObj.reportId+"',"+(e.requestedObj.ReqFromIndex-Calls.cvListLimitCount)+")\"><span class='dIB previous vmiddle'></span><span class='vmiddle mL3'>"+e.requestedObj.ReqFromIndex+"</span></div>";if(t.html(a),1===e.requestedObj.ReqFromIndex){a="<div class='fR cP' id='showMoreDiv' onClick=\"CrmDashboard.getMoreReportsRecords('"+e.requestedObj.type.trim()+"', '"+e.requestedObj.ownerId+"', '"+e.requestedObj.stdDateFilter+"','"+e.requestedObj.reportId+"',"+(e.requestedObj.ReqFromIndex+Calls.cvListLimitCount)+")\"><span class='vmiddle mR3'>"+(e.requestedObj.ReqFromIndex+(e.requestedObj.totalRowCount-2))+"</span><span class='dIB next vmiddle'></span></div><span class='dIB mL10 mR10 vmiddle'>to</span> <div class='fL' id='"+showPreviousDivId+"'><span class='dIB previousDisabled vmiddle'></span><span class='vmiddle mL3'>"+e.requestedObj.ReqFromIndex+"</span></div>";t.html(a)}};var lastWordforAC="",lastDataCountforAC=1,modules={MODULE:""};function callGSearchForAC(e,t){var a=trimBoth(document.getElementById(e).value);if(lastDataCountforAC||!(lastWordforAC.length<=a.length)||0!==a.indexOf(lastWordforAC))if(a.length<2&&!(a=a.replace(/[A-Z a-z 0-9]/,"")))$(".searchLoadingIcon").hide();else{var i=Crm.getCrmBasePath()+"/GSearch.do",n="mode=ac&searchword="+encodeURIComponent(a);httphandle.open("POST",i,!0),httphandle.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),httphandle.onreadystatechange=function(){if(4==httphandle.readyState){$(".searchLoadingIcon").hide();var e=httphandle.responseText;modules={MODULE:""},e=e.substring(0,e.lastIndexOf(","));try{e=JSON.parse("["+e+"]")}catch(e){return}var i=$.map(e,(function(e){return e}));lastDataCountforAC=i.length,i.length||(i=[{IGNORENODATA:"true"}]),t(i),lastWordforAC=a,renderingUtils.scrollPrevent($(".globalSearchList"))}},httphandle.send(n),$(".searchLoadingIcon").show()}}function renderGSearchACUI(e,t){if(t.IGNORENODATA)return $("<li class='ui-no-mhead nodata-search ui-menu-item'><span class='acli-name'>"+I18n.getMsg("crm.template.listview.search.no.results")+"</span></li>").appendTo(e).data("ui-autocomplete-item",""),$();"Leads"!==t.MODULE&&"Contacts"!==t.MODULE||(t.FULLNAME=getFormattedName(t.FIRSTNAME,t.LASTNAME,t.SALUTATION));var a=$("#gsac_"+t.MODULE);if(!a.length){modules.MODULE=t.MODULE;var i=crmTab.getDisplayName(t.MODULE);a=$("<li class='ui-autocomplete-category ui-menu-item' id='gsac_"+t.MODULE+"'><b name='autocompletemodule' class='crm-font-regular'>"+$ESAPI.encoder().encodeForHTML(i)+"</b></li>").appendTo(e).data("ui-autocomplete-item","")}var n=crmHistory.getNewURL(t.URL),r=Lyte.Router.getRoute(n);$("<li class='ui-no-mhead ui-menu-item'></li>").append('<a tabindex="-1" class="ui-menu-item-wrapper"><span onclick=\'Crm.notifySearchCloseCRMPlus()\';><link-to lt-prop-route='+JSON.stringify(r.route)+" lt-prop-dp="+JSON.stringify(r.dynamicParams)+">"+$ESAPI.encoder().encodeForHTML(t.FULLNAME)+"</link-to></span><span class='popoutarrow' onclick='networkUtils.openUrl(\""+t.URL+'","_blank")\'></span></a>').appendTo(a).data("ui-autocomplete-item",t)}function openZohoSearchPage(e){if(1===e.which){var t="",a="https://"+RebrandLinkUtil.getProperty("ZOHO_SEARCH_URL")+"/search?q=";t=Crm.userDetails.ISPAID_USER?$L("crm-menu")[0].component.getData("searchInputValue"):$L(".topbandSearchInpt").val(),networkUtils.openUrl(a+encodeURIComponent(t),"_blank")}}function checkOldGSearchResults(e){e=$(e),trimBoth(e.val())&&$(e).data("ui-autocomplete")&&($(".primarySearchList").show(),e.autocomplete("widget").show(),e.removeClass("ui-corner-all").addClass("ui-corner-top"))}function showRecentMails(e,t,a){var i=csrfParamName+"="+csrfToken;document.getElementById("msgid")&&document.getElementById("msgid").value,e&&hideMenu(e),hidemessage(),Activities.RemainderHideOnly();document.getElementById("rmnIconDiv");if(document.getElementById("recentMailsDiv"))n=document.getElementById("recentMailsDiv");else{var n=document.createElement("DIV");document.body.appendChild(n),n.id="recentMailsDiv",n.className="newPopup p10",n.style.position="absolute",n.onclick=function(e){e&&sE(e),getObj("businessCardDiv")&&hide("businessCardDiv")}}var r=Crm.getCrmBasePath()+"/ZMailConfig.do?action=showRecentMails";"none"!=document.getElementById("newMailCount").style.display&&(r+="&updateMailCount=true"),document.getElementById("newMailCount").style.display="none",crmplusImplTriggerActions("setNotificationCount",["mailbox",0]),$("#recentMailsDiv").addClass("recentMailPopup"),Crm.userDetails.RTL_ENABLED?n.style.left="0px":n.style.right="0px",n.style.top=$("#tabLayer").offset().top+$("#tabLayer").height()+"px",n.style.display="block",$(n).empty(),n.innerHTML=I18n.getMsg("crm.load")+"...",t&&(r=r+"&fromIndex="+t),a&&(r+="&showUnreadMails=true"),new AjaxAPI({id:"recentMailsDiv",callbackfn:function(i){if(""!=document.getElementById("unreadMailIds").value)for(var n=document.getElementById("unreadMailIds").value.split(","),r=0;r<n.length;r++){var s=document.getElementById("mail_"+n[r]);s&&(s.className="tdhover")}if(document.getElementById("allmailslnk")&&(a?(document.getElementById("allmailslnk").className="",document.getElementById("unreadmailslnk").className="topNavAct",document.getElementById("allmailslnk").onclick=function(){showRecentMails(e,t)},document.getElementById("unreadmailslnk").onclick=null):(document.getElementById("allmailslnk").className="topNavAct",document.getElementById("unreadmailslnk").className="",document.getElementById("unreadmailslnk").onclick=function(){showRecentMails(e,t,!0)},document.getElementById("allmailslnk").onclick=null)),Crm.userDetails.RTL_ENABLED)$("#mailArrow").css({left:findPosX(getObj("rmnIconDiv"))+"px"});else{var o=findPosX(getObj("rmnIconDiv"))-findPosX(getObj("recentMailsDiv"))+11;$("#mailArrow").css({left:o+"px"})}},params:i,url:r}).post(),e&&sE(e)}var originaltitle=document.title;function hidemessage(){document.title=originaltitle}function viewRecentMail(e,t,a,i,n,r){document.getElementById("rmListViewDiv").style.display="none",$("#rmDetailViewDiv").empty();var s=document.getElementById("rmDetailViewDiv");s&&(s.innerHTML=I18n.getMsg("crm.load")+"...",s.style.display="block"),$("#mmBackToMsgs").show();var o="ZMAIL";Crm.userDetails.IMAP_STATUS?o="IMAP":getObj("mailType")&&"GMail"==getObj("mailType").value&&(o="GMail"),"GMail"!==o&&(n=!n);var l=Crm.getCrmBasePath()+"/mailer/EntReply.do?action=viewMail",d=csrfParamName+"="+encodeURIComponent(csrfToken);d+="&entId="+t+"&module="+a+"&mailType="+encodeURIComponent(o)+"&sentOrReceived=Received&source=recentMailView&currMailPos="+i+"&entEmailId="+encodeURIComponent(r)+"&flag="+n,""!=e&&(d=d+"&msgid="+e),new mR(l,(function(t){var a=document.getElementById("rmDetailViewDiv");if("MESG_DELETED"==t)return document.getElementById("rmListViewDiv").style.display="block",a.style.display="none",alert(I18n.getMsg("crm.recent.mail.deleted.alert",I18n.getMsg(singularModule))),!1;var i=document.getElementById("totalMailCount")?document.getElementById("totalMailCount").value:0;if(a){$("#rmDetailViewDiv").empty(),a.innerHTML=t;var n=document.getElementById("msgid"),r=n.value,s=$("#maxComposeBtn"),o=s&&!s.hasClass("hide");!r&&o&&(r=e,n.value=e),"null"==$("#rmViewName").text()&&$("#rmViewName").text($("#rmName_"+r).html()),a.style.display="block",0!=i&&(document.getElementById("rmTotMailCnt").value=i),JSEvalScript(document.getElementById("recentMailsDiv"))}}),d,"","false")}function showBusinessCardView(){var e=document.createElement("DIV");e.style.display="none",e.id="businessCardDiv",document.body.appendChild(e),$("#businessCardDiv").html($(".businessPopup").html()),e.className="businessPopup";var t=document.getElementById("contInfo"),a=findPosX(t),i=findPosY(t);$("#businessCardDiv").css({left:a-41,top:i+22,zIndex:31}),$("#businessCardDiv").slideDown("slow",(function(){$("#businessCardDiv").mouseleave((function(){$("#businessCardDiv").slideUp("slow",(function(){$("#businessCardDiv").remove()}))}))}))}function approveFormDetailView(e,t,a,i,n,r,s){var o=!0,l=!1;if(i&&n){l=!0;var d=I18n.getMsg("crm.email.duplicate.approve",I18n.getMsg([moduleRecordMapping[a].plural_label,moduleRecordMapping[a].singular_label]));if(!window.confirm(d))return o=!1,!1;o=!0}if(o){var c=Crm.getCrmBasePath()+"/ConfirmApproval.do";"Contacts"===a?c=Crm.getCrmBasePath()+"/ConfirmContactApproval.do":"Cases"===a?c=Crm.getCrmBasePath()+"/ConfirmCaseApproval.do":-1!==a.indexOf("CustomModule")&&(c=Crm.getCrmBasePath()+"/WebRecordConfirmApproval.do");var m=csrfParamName+"="+encodeURIComponent(csrfToken)+"&idlist="+t+"&approvalModule="+a+"&formdetailView=true";(r||parseInt(r)>=0)&&s&&(m=m+"&startIndex="+r+"&endIndex="+s),l&&(m+="&showDuplicates=1"),doAjaxUpdate("json",c,m,(function(){var t=$("#detailNext"),a=$("#detailPrevious");t.hasClass("disabled")&&!a.hasClass("disabled")?renderingUtils.triggerEvent("click",a):!t.hasClass("disabled")&&a.hasClass("disabled")?renderingUtils.triggerEvent("click",t):$(e).remove()}))}}var rep={showRep:function(e){$(".rep_runbtn").addClass("vh"),$(e).find(".rep_runbtn").removeClass("vh")},hideRep:function(e){var t=$(e).find(".rep_runbtn");$(".rep_runbtn").addClass("vh"),($("#callMoreOption").is(":visible")||$("#appMoreOption").is(":visible"))&&t.hasClass("vVIm")?t.removeClass("vh"):t.addClass("vh")}};function adSearchClose(){$("html").removeClass("oH");var e=document.querySelector("[data-zcqa='adSearchCloseBtn']");e&&e.click(),$("#currentEditionInfo").show(),$(".searchOverlay").fadeOut(200),"global-search"==Lyte.Router.getRouteInstance().routeName&&crmHistory.backOneLevel(),$(".searchOverlay").removeClass("searchOverlayAct"),$(".searchOverlay").removeClass("searchOverlayAct"),$(".searchInner").hide()}function sortHomeCVColsNew(e,t,a,i,n){var r=JSON.parse($(i).closest(".dashBrdContent").attr("data-params")),s=$("#HomePage_Selector").find("a").attr("data-category");"0"==s&&(r[csrfParamName]=encodeURIComponent(csrfToken),r.updateSortColumn=!0),delete r.clickId,delete r.isDefaultLayout,delete r.isNewUserHomePage;var o=r.layoutId,l="sort_asc",d=$("#sortOrderString_"+o);a==t&&"sort_asc"==d.val()?(l="sort_desc",d.val(l)):d.val(l),r.sortOrderString=l,r.sortColumnString=a;var c=Crm.getCrmBasePath()+"/HomePageLayout.do",m="0"===s?"POST":"GET";(new crmRequestPool).initiate({action:c,data:r,type:m,success:function(e){if(e.fromPage="homePage",e.previous_sort_column=a,e.previous_sort_order=l,void 0!==n&&""!==n&&(e.best_time_field_id=a),"0"===s)CrmDashboard.replaceTaskDiv(e,r.module);else{var t=!0;e.body&&e.body[e.currentOption]&&(e.body[e.currentOption]=void 0,t=!1),e.isLast=t,CrmDashboard.renderCV(e,e.layoutId,s,r.module),CrmDashboard.needToLoadContactImage&&CrmDashboard.populateContactsImageMapAndLoadCv(e,e.layoutId,s,r.module)}}})}function showBestTimeSortDiv(e,t,a,i,n){var r=$(e),s=r.offset().left,o=r.outerHeight(),l=document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop,d=document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft;$("#SortByAllDay").attr("onclick","sortHomeCVColsNew('"+a+"', '"+i+"', '"+n+"', this, 'sort_asc')");var c=r.parents(".grid-stack-item");c.find(".SortByToday").attr("onclick","sortHomeCVColsNew('"+a+"', '"+i+"', '"+n+"', this, 'sort_desc')");var m=c.find(".sort_div")[0];if(m.style.top=r.offset().top+o+"px",m.style.position="fixed",d>0&&0===l&&(m.style.left=s+"px"),l<50)m.style.left=s-d+"px";else{var u=$("#cvpadding");0==$("#copyListviewHeaderDiv").is(":visible")&&1==u.hasClass("pFixed")?m.style.top=r.position().top+o+82-(u.outerHeight()+15)-l+"px":m.addClass("fixedTopColumnList"),m.style.position="fixed",m.style.left=s-d+"px",m.style.zIndex=2502}m.style.display="block",t||(t=window.event),t.stopPropagation&&(t.stopPropagation(),t.cancelBubble=!0)}function delAction(e,t,a,i,n){var r="module="+e+"&id="+t+"&fromPage=Home&layoutId="+a+"&dashletId="+i+"&currentOption="+n+"&"+csrfParamName+"="+csrfToken;return(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/MassDelete.do",type:"POST",data:r,success:function(t){if(t){hideAnimatePopup("deletepopup"),CrmDashboard.replaceTaskDiv(t,e);var a=I18n.getMsg("crm.label.deleted.successfully");$("#bulkUpdateSuccess").html(a),mailsetCenter("bulkUpdateSuccess"),setTimeout((function(){hide("bulkUpdateSuccess")}),2e3)}},error:function(){var e=I18n.getMsg("crm.mb.alert.complete.operation.later");renderingUtils.showCustomAlert(e,void 0,!1)}}),!1}function changeHomeOptions(e){var t=$(e),a=$("#HomePage_Selector");$("#HomeSelectorDD").find("a").removeClass("sel"),a.removeClass("hvw-active"),t.find("a").addClass("sel");var i=$(t.html());i.find(".home-green-tick").addClass("hview-menu-arw").removeClass("home-green-tick"),a.html(i);var n=a.find("a")[0];if(n.offsetWidth<n.scrollWidth){var r=t.text();a.on("mouseenter",(function(){crmui.toolTip_show(this,"center",r)})),a.on("mouseleave",(function(){crmui.toolTip_hide()}))}else a.unbind("mouseover mouseout")}function toggleHomeDropDown(){var e=$("#HomeSelectorDD"),t=$("#HomePage_Selector"),a=t.outerWidth(),i=t.offset().left,n=parseInt(t.offset().top)+parseInt(t.outerHeight())-1;if($('[data-close="true"]').hide(),t.hasClass("hvw-active"))return t.removeClass("hvw-active"),void e.slideUp();if(t.addClass("hvw-active"),e.width(parseInt(a)-2),Crm.userDetails.RTL_ENABLED)e.css({left:i,top:n});else{var r=renderingUtils.windowWidth-(i+parseInt(a));e.css({right:r,top:n})}e.slideDown()}Handlebars.registerHelper("getRoleDetails",(function(e,t){var a='<td id="roles" class="cD" width="25%"',i={},n=e.length;if(0===n)return(a+="onmouseover=\"crmui.toolTip_show(this,'left','"+I18n.getMsg("crm.role.deleted.tooltip")+'\')" onmouseout="crmui.toolTip_hide();" data-rolesSelected=",">-</td>')+t.fn(this);for(var r=0;r<n;r++){var s=e[r];if(0===r)var o=s.name,l=s.name;else l+=", "+s.name;i[s.id]=$ESAPI.encoder().encodeForHTMLAttribute(s.name)}if(r>1){a+="onmouseover=\"crmui.toolTip_show(this,'left','"+$ESAPI.encoder().encodeForJavaScript(l)+'\', false)" onmouseout="crmui.toolTip_hide();" data-rolesSelected='+JSON.stringify(i)+">";var d=(parseInt(r)-1).toString();a+=$ESAPI.encoder().encodeForHTML(2!==r?I18n.getMsg("crm.listview.display.role",[o.toString(),d]):I18n.getMsg("crm.listview.display.singular.role",o.toString()))}else a+="data-rolesSelected="+JSON.stringify(i)+">",a+=$ESAPI.encoder().encodeForHTML(o);return(a+="</td>")+t.fn(this)}));