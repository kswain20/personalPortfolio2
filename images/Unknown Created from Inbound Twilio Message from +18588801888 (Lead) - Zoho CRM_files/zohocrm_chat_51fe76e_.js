function slide(){this.freq=1,this.speed=4,this.up=function(e){if(null!==e&&"object"!=typeof e){var t=document.getElementById(e);if(null===t)return;this.hideObj=t}else this.hideObj=e;this.shrinkHeight=this.hideObj.offsetHeight,this.shrink(),-1!==this.expandTimer&&this.showObj.id===this.hideObj.id&&(clearTimeout(this.expandTimer),this.shrinkHeight=this.exHeight-this.speed)},this.down=function(e){if(null!==e&&"object"!=typeof e){var t=document.getElementById(e);if(null===t)return;this.showObj=t}else this.showObj=e;this.exHeight="0",this.showObj.style.display="block",this.showObj.style.height="0px",-1!==this.shrinkTimer&&this.showObj.id===this.hideObj.id&&(clearTimeout(this.shrinkTimer),this.exHeight=this.shrinkHeight-this.speed);this.expand()},this.expand=function(){if(this.exHeight=parseInt(this.exHeight)+this.speed,null===this.showObj)return;if(this.showObj.style.height=this.exHeight+"px",parseInt(this.exHeight)>=this.maxHeight)return clearTimeout(this.expandTimer),this.expandTimer="-1",this.exHeight=this.minHeight,void this.finish("expand");this.expandTimer=setTimeout((function(){this.objName}),this.freq)},this.shrink=shrink,this.finish=finish,this.finishExpandWith=finishExpandWith,this.finishShrinkWith=finishShrinkWith,this.setSpeed=setSpeed,this.setHeightParams=setHeightParams,this.maxHeight="50",this.minHeight="0",this.exHeight=this.minHeight,this.shrinkHeight=this.maxHeight,this.expandTimer=-1,this.shrinkTimer=-1,this.showObj,this.hideObj,this.finishExp="",this.finishShrink="",this.objName,this.setObjName=setObjName}function shrink(){if(this.shrinkHeight=parseInt(this.shrinkHeight)-this.speed,null!==this.hideObj){if(parseInt(this.shrinkHeight)<=this.minHeight)return clearTimeout(this.shrinkTimer),this.shrinkTimer="-1",this.shrinkHeight=this.maxHeight,this.hideObj.style.height=this.minHeight+"px",void this.finish("shrink");this.hideObj.style.height=this.shrinkHeight+"px",this.shrinkTimer=setTimeout((function(){this.objName}),this.freq)}}function setHeightParams(e,t,i,o){void 0!==e&&(this.minHeight=e),void 0!==t&&(this.maxHeight=t),void 0!==i&&(this.exHeight=i),void 0!==o&&(this.shrinkHeight=o)}function finishExpandWith(e){this.finishExp=e}function finishShrinkWith(e){this.finishShrink=""+e}function finish(e){"expand"===e?""!==this.finishExp&&(setTimeout((function(){this.finishExp}),0),this.finishExp=""):""!==this.finishShrink&&(setTimeout((function(){this.finishShrink}),0),this.finishShrink="")}function setSpeed(e){this.speed=e}function setObjName(e){this.objName=e}"undefined"==typeof Collaboration&&(Collaboration=function(){}),Collaboration.handleUserList=function(e,t){},Collaboration.handleMessage=function(e,t,i,o,n){},Collaboration.handlePresence=function(e,t,i,o,n){},Collaboration.join=function(e){WebMessanger.joinCollab(e)},Collaboration.handleServiceMessage=function(e){$("#browser1").removeClass("dN"),$("#br12").html(e.msg)},Collaboration.quit=function(e){WebMessanger.quit(e)},Collaboration.serverup=function(){if(crmConstants.WMS_STATUS=1,document.getElementById("activeChatId")){var e=document.getElementById("activeChatId").value,t=Crm.getCrmBasePath()+"/Chat.do?mode=activateChat&loadChatId="+e;mR(t)}"object"==typeof CrmTracking&&CrmTracking.handleServerUp(),$("#stNotes").is(":visible")&&crmStickies.reInitStickiesContentUpdate()},Collaboration.serverdown=function(){crmConstants.WMS_STATUS=0,"object"==typeof CrmTracking&&CrmTracking.updateNetWorkState()},Collaboration.handleZohoMessage=function(e,t,i,o,n,a,s,r,l,d,c,p){},Collaboration.handleCustomMessage=function(e){if("outlook"!=$("#rightPanelSource").val()&&Crm.isWMSNotifictionForCurrentOrg(e)&&(!Lyte.Router.getRouteInstance().transition.info.route.includes("crm.gamification")||e.hasOwnProperty("gnType")))if(e.tabsUsedInWizards)Crm.userDetails.tabsUsedInWizards=e.tabsUsedInWizards;else{if("storage_limit_reached"===e.type){var t=networkUtils.returnDependencyFiles(["datastorage.js"],crmConstants.jsStaticPathForLyte),i=networkUtils.returnDependencyFiles(["datastorage.css"],crmConstants.cssStaticPathForLyte),o=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("datastorage")]),n=t.concat(i).concat(o);Lyte.injectResources(n,void 0,(function(){var e=Crm.userDetails.data_storage,t="count"===e.calculation_type;Lyte.Component.render("crm-data-storage-wms-msg",{rem_storage:e.total_remaining_space.toString(),allowed_storage:e.total_allowed_space,isCount:t,show:!0,errorType:"wms"},"#mics_tipDiv")}))}else if("refresh_storage"===e.type)Crm.userDetails.isStorageLimitReached=e.isLimitExceed,Crm.userDetails.data_storage=e.storage_details;else if("refresh_storage_rb"===e.type)Crm.userDetails.isStorageLimitReached=e.isLimitExceed,Crm.userDetails.data_storage=e.storage_details,_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.entity.update.success","Data storage")}});else if("storage_limit_reached_for_current_user"===e.type){t=networkUtils.returnDependencyFiles(["datastorage.js"],crmConstants.jsStaticPathForLyte),i=networkUtils.returnDependencyFiles(["datastorage.css"],crmConstants.cssStaticPathForLyte),o=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("datastorage")]),n=t.concat(i).concat(o);Lyte.injectResources(n,void 0,(function(){var e=Crm.userDetails.data_storage,t="count"===e.calculation_type;Lyte.Component.render("crm-data-storage-wms-msg",{rem_storage:e.total_remaining_space.toString(),allowed_storage:e.total_allowed_space,isCount:t,show:!0,errorType:"Sheet"},"#mics_tipDiv")}))}if("ScoreCalculation"===e.type)Le=(Le=(Le=networkUtils.returnDependencyFiles(["scoring_notification.js"],crmConstants.jsStaticPathForLyte)).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("scoringnotification")]))).concat(networkUtils.returnDependencyFiles(["scoring_notification.css"],crmConstants.cssStaticPathForLyte)),Crm.userDetails.RTL_ENABLED&&(Le=Le.concat(networkUtils.returnDependencyFiles(["scoring_notification_rtl.css"],crmConstants.cssStaticPathForLyte))),Lyte.injectResources(Le,void 0,(function(){var t=JSON.parse(e.message),i=I18n.getMsg("score.updated.text",[t.totalCount,moduleRecordMapping[t.moduleLabel].plural_label]);Lyte.Component.render("crm-score-notification",{message:i,showModal:!0},"body")}));if("deactivated"==e.type){var a="object"==typeof e.userids?e.userids:JSON.parse(e.userids);Search.bulkJsonUpdate(a,"DISABLED"),$("[name='ownerNameLookup']").each((function(){$(this),$(this).attr("id");for(var e=$(this).data("fieldname"),t=$(this).find("ul").find('span[name="ownerType"]'),i=$(this).find("ul").find('span[name="ownerType"]').length,o=0;o<a.length;o++){var n=a[o];if(i){var s=document.getElementById(e+"_"+n);$("#"+e+"_"+n).remove(),$(t).eq(1).after(s),Search.assignClick(e,n)}else $("#"+e+"_"+n).remove()}if(i){var r=$(t).eq(1).nextAll("li").sort((function(e,t){return $(e).attr("username").trim().split(",")[0].toLowerCase()>$(t).attr("username").trim().split(",")[0].toLowerCase()?1:-1}));$(t).eq(1).after(r)}}))}else if("Lookupvalue_update"===e.type||"mxnclonescheduler"===e.type){var s=e.seType,r=Crm.moduleInfo[s].singularLabel,l="<li class='m0 p20'><span style='color:#5e6167;'>"+e.msg+"</span></li>",d=$("#ztinotifier").find("#mxnclonewmsmsg");if(d.length>0){var c=d.find("ul"),p=c.find("li");p.length>5&&p[5].remove(),c.prepend(l)}else{var u=(h="<div class='pickListCont dIB whiteBg newPopup bottom_30 r0 mergeduplicaterecord' id='mxnclonewmsmsg' style='width:500px'>")+(f="<div class='f16  proxima pR fontSmooth whiteClr dField-notifier-header'>"+e.msgtitle+"<span class='pA dIB svgIconsImg migCardClose ico-close-white-small2 cP' onclick='$(\"#mxnclonewmsmsg\").remove();'></span></div>")+("<div id='mergecomplete'><div class='mergecomplete-step'><ul class='m0 p0 merge-filed-lists'>"+l+"</ul></div></div></div>");Notifier.construct(u)}var m=105;if($("#ztinotifier").css({width:"475"}),Notifier.slider.setHeightParams(0,m,0,0),Notifier.slider.down("ztinotifier"),detailView&&detailView.entityId&&detailView.entityId===e.entityid)(C={}).id=e.entityid,C.rid=e.relid,C.actModule=e.parentmodule,C.module=e.parentmodule,C.actId=e.entityid,C.pname=crmRelatedList.EachModuleData[e.relid]?crmRelatedList.EachModuleData[e.relid].name:void 0,C.isSortRequest=!1,Lyte.triggerEvent("relatedList",{id:C.rid}),crmRelatedList.ajaxReq(C)}else if("MXN_LEAD_CONVERT_ERROR"===e.type){for(var h="<div class='pickListCont dIB whiteBg newPopup bottom_30 r0 mergeduplicaterecord' id='mxnclonewmsmsg' style='width:500px'>",f="<div class='f16  proxima pR fontSmooth whiteClr dField-notifier-header'>MXNField cannot be converted<span class='pA dIB svgIconsImg migCardClose ico-close-white-small2 cP' onclick='$(\"#mxnclonewmsmsg\").remove();'></span></div>",g="",v=e.error,y=v.length,w=0;w<y;w++)g=g+'<br><div class="w100per p10"><div class="w50per floatL p10" style="text-align: center;color:#5e6167;">'+v[w].module_label+'</div><span class="newSaveBtn" onclick="multiLookupsView.LinkingModuleExport(\''+v[w].module_sysrefname+"','"+v[w].ids+"')\">Export</span></div>";u=h+f+("<div id='mergecomplete'><div class='mergecomplete-step'><ul class='m0 p0 merge-filed-lists'><li class='m0 p20'><span style='color:#5e6167;'>Some of the MXNField records cannot be coverted and the corrosponding records can be exported below</span>"+g+"</li></ul></div></div></div>");Notifier.construct(u)}else if("MXN_LEAD_CONVERT"===e.type&&void 0!==crmRelatedList){var C={},b=e.relid.split(";"),A=b.length,T="";for(w=0;w<A;w++)void 0!==crmRelatedList.EachModuleData[b[w]]&&(T=T+crmRelatedList.EachModuleData[b[w]].name+";");C.pname=T,C.id=crmRelatedList.EntityId,C.module=crmRelatedList.Module,""!==T&&crmRelatedList.ajaxReq(C)}else if("Mass_Transfer_Scheduler"===e.type){s=e.seType,r=Crm.moduleInfo[s].translatedSingularLabel,u=(h="<div class='pickListCont dIB whiteBg newPopup bottom_30 r0 mergeduplicaterecord' id='pickListCont'>")+(f="<div class='f16  crm-font-regular pR fontSmooth whiteClr dField-notifier-header'>"+I18n.getMsg("crm.permission.mass.transfer.headerMsg",r)+"<span class='notifier-minimize-icon cP pA dIB right30 top0 p5' onclick='$(\"#pickListCont\").hide();'></span></div>")+("<div id='mergecomplete'><div class='mergecomplete-step'><ul class='m0 p0 merge-filed-lists'><li class='m0 p20'><span style='color:#5e6167;'>"+I18n.getMsg("crm.permission.mass.transfer.completed.msg")+"</span></li></ul></div></div></div>");Notifier.construct(u);m=105;$("#ztinotifier").css({width:"450"}),Notifier.slider.setHeightParams(0,m,0,0),Notifier.slider.down("ztinotifier")}else if("delete"==e.type){var S=e.id;if(void 0!==InfoForDisplay){var I=JSON.parse(InfoForDisplay);for(w=0;w<I.length;w++)I[w].id==S&&I.splice(w,1);InfoForDisplay=JSON.stringify(I)}if(void 0!==InfoForDisplayWithLiteUsers){var L=(I=JSON.parse(InfoForDisplayWithLiteUsers)).length;for(w=0;w<L;w++)I[w].id===S&&I.splice(w,1);InfoForDisplayWithLiteUsers=JSON.stringify(I)}Crm.userDetailsMap=void 0,$("[name='ownerNameLookup']").each((function(){$(this).attr("id");var e=$(this).data("fieldname");$("#"+e+"_"+S).remove()}))}else if("activated"==e.type){a="object"==typeof e.userids?e.userids:JSON.parse(e.userids);Search.bulkJsonUpdate(a,"ACTIVE"),$("[name='ownerNameLookup']").each((function(){for(var e=$(this),t=($(this).attr("id"),$(this).data("fieldname")),i=$(this).find("ul").find('span[name="ownerType"]'),o=$(this).find("ul").find('span[name="ownerType"]').length,n=0;n<a.length;n++){var s=a[n],r=document.getElementById(t+"_"+s);if(o)$("#"+t+"_"+s).remove(),$(i).eq(1).before(r),Search.assignClick(t,s);else{var l=JSON.parse(InfoForDisplay),d=Search.getJsonObj(l,s),c=d[0].plainName+","+d[0].email,p="<li class='active-result' name='single-select' id="+t+"_"+s+" username='"+$ESAPI.encoder().encodeForHTMLAttribute(c)+"' data-id="+s+" style='vertical-align:bottom;margin-top:7px;'><img src="+d[0].avatar+" class='socialimg mR5'><span class='pL10' style='vertical-align:top;'>"+$ESAPI.encoder().encodeForHTML(d[0].plainName)+"</span> <span class='color2' style='vertical-align:bottom; margin-left: -42px;'>"+$ESAPI.encoder().encodeForHTML(d[0].email)+"</span></li>";$(this).find("ul").append(p)}}if(o){var u=$(i).eq(1).prevAll("li").sort((function(e,t){return $(e).attr("username").trim().split(",")[0].toLowerCase()>$(t).attr("username").trim().split(",")[0].toLowerCase()?1:-1}));$(i).eq(1).before(u)}else{u=$(e).find("ul li").sort((function(e,t){return $(e).attr("username").trim().split(",")[0].toLowerCase()>$(t).attr("username").trim().split(",")[0].toLowerCase()?1:-1}));$(this).find("ul").find("li").remove(),$(this).find("ul").append(u),Search.assignClick(t)}}))}else if("edit"==e.type){S=e.id;var M=Crm.userDetails.NAME_FORMAT,_=e.email;if(M.indexOf("First")<M.indexOf("Last"))var k=(0==e.firstName.length?"":e.firstName+" ")+e.lastName;else k=(0==e.lastName.length?"":e.lastName+" ")+e.firstName;var P=k+","+e.email;if(void 0!==InfoForDisplay){for(I=JSON.parse(InfoForDisplay),w=0;w<I.length;w++)if(I[w].id==S){I[w].plainName=k,I[w].name=k,I[w].firstName=e.firstName,I[w].lastName=e.lastName;break}InfoForDisplay=JSON.stringify(I)}if(void 0!==InfoForDisplayWithLiteUsers){for(L=(I=JSON.parse(InfoForDisplayWithLiteUsers)).length,w=0;w<L;w++)if(I[w].id===S){I[w].plainName=k,I[w].name=k,I[w].firstName=e.firstName,I[w].lastName=e.lastName;break}InfoForDisplayWithLiteUsers=JSON.stringify(I)}Crm.userDetailsMap=void 0,$("[name='ownerNameLookup']").each((function(){$(this).attr("id");var e=$(this).data("fieldname");$("#"+e+"_"+S).attr("username",P),$("#"+e+"_"+S).find("span").eq(0).html($ESAPI.encoder().encodeForHTML(k)),$("#"+e+"_"+S).find("span").eq(1).html($ESAPI.encoder().encodeForHTML(_))})),null!=e.TIME_ZONE&&Crm.userDetails.USER_ID==S&&(Crm.userDetails.TIME_ZONE=e.TIME_ZONE)}else if("massmailStatsReport"==e.type){(pi=window.location.pathname)===Crm.getCrmBasePath()+"/ViewMassMail.do"&&MassMailUnificationUtil.reLoadPageForStatsUpdate()}else if("user"==e.type){var N=e.isLiteUser;if(void 0!==InfoForDisplay&&!N)(I=JSON.parse(InfoForDisplay)).push(e),InfoForDisplay=JSON.stringify(I);if(void 0!==InfoForDisplayWithLiteUsers&&N)(I=JSON.parse(InfoForDisplayWithLiteUsers)).push(e),InfoForDisplayWithLiteUsers=JSON.stringify(I);Crm.userDetailsMap=void 0,$("[name='ownerNameLookup']").each((function(){var t=$(this).attr("id"),i=Crm.userDetails.NAME_FORMAT;if(i.indexOf("First")<i.indexOf("Last"))var o=(0==e.firstName.length?"":e.firstName+" ")+e.lastName;else o=(0==e.lastName.length?"":e.lastName+" ")+e.firstName;var n=o+","+e.email,a=$(this).find("ul").find('span[name="ownerType"]'),s=$("#"+t).find("ul").find('span[name="ownerType"]').length,r=$(this).data("fieldname"),l="<li class='active-result' name='single-select' id="+r+"_"+e.id+" username='"+$ESAPI.encoder().encodeForHTMLAttribute(n)+"' data-id="+e.id+" style='vertical-align:bottom;margin-top:7px;'><img src="+e.avatar+" class='socialimg mR5'><span class='pL10' style='vertical-align:top;'>"+$ESAPI.encoder().encodeForHTML(o)+"</span> <span class='color2' style='vertical-align:bottom; margin-left: -42px;'>"+$ESAPI.encoder().encodeForHTML(e.email)+"</span></li>";e.id;if(s){var d;$(a).eq(1).before("<li class='active-result' name='single-select' id="+r+"_"+e.id+" username='"+$ESAPI.encoder().encodeForHTMLAttribute(n)+"' data-id="+e.id+" style='vertical-align:bottom; margin-top:7px;'><img src="+e.avatar+" class='socialimg mR5'><span class='pL10' style='vertical-align:top;'>"+$ESAPI.encoder().encodeForHTML(o)+"</span> <span class='color2' style='vertical-align:bottom; margin-left:-86px;'>"+$ESAPI.encoder().encodeForHTML(e.email)+"</span></li>");for(var c=$(a).eq(1).prevAll("li").sort((function(e,t){return $(e).attr("username").trim().split(",")[0].toLowerCase()>$(t).attr("username").trim().split(",")[0].toLowerCase()?1:-1})),p=0;p<c.length;p++){var u=r+"_"+e.id;if($(c[p]).attr("id")===u){$("#"+r+"_"+e.id).remove();break}}d=p;var m=$(a).eq(1).prevAll("li").length;$(a).eq(1).prevAll("li").eq(m-d).after("<li class='active-result' name='multi-select' id="+r+"_"+e.id+" username='"+$ESAPI.encoder().encodeForHTMLAttribute(n)+"' data-id="+e.id+" style='vertical-align:bottom; margin-top:7px;'><img src="+e.avatar+" class='socialimg mR5'><span class='pL10' style='vertical-align:top;'>"+$ESAPI.encoder().encodeForHTML(o)+"</span> <span class='color2' style='vertical-align:bottom; margin-left:-86px;'>"+$ESAPI.encoder().encodeForHTML(e.email)+"</span></li>"),Search.assignClick(r,e.id)}else{$(this).find("ul").append(l);var h;for(c=$(this).find("ul li").sort((function(e,t){return $(e).attr("username").trim().split(",")[0].toLowerCase()>$(t).attr("username").trim().split(",")[0].toLowerCase()?1:-1})),p=0;p<c.length;p++){u=r+"_"+e.id;if($(c[p]).attr("id")===u){$("#"+r+"_"+e.id).remove();break}}h=p,$(this).find("ul").find("li").eq(h-1).after(l),Search.assignClick(r,e.id)}}))}else if("ZRFieldUpdated"===e.type||"ZRFieldUpdateFailed"===e.type||"ZRFieldUpdateFailed_MinRecords"===e.type||"ZRFieldUpdateFailed_SingleUser"===e.type){var D=Lyte.Router.getRouteInstance().routeName,F=$L("crm-assignmentrules-zia-reasoning")[0];if("zia-reasoning"===D){if(Lyte.Router.getRouteInstance().getQueryParams().module!==e.module)return;F.setData("showMessageBox",!1);var E="error";u=I18n.getMsg("crm.ziareasoning.fields.update.failure");switch(F.setData("updated_module",void 0),F.setData("isSuccess",!1),e.type){case"ZRFieldUpdated":u=I18n.getMsg("crm.ziareasoning.model.generation.success"),E="success",F.setData("isSuccess",!0),F.setData("updated_module",e.module);break;case"ZRFieldUpdateFailed_MinRecords":u=I18n.getMsg("crm.ziareasoning.min.records.unreached.failure");break;default:u=I18n.getMsg("crm.ziareasoning.fields.update.failure")}F.setData("messageType",E),F.setData("message",u),F.setData("showMessageBox",!0),"ZRFieldUpdated"!==e.type&&setTimeout((function(){F.setData("showMessageBox",!1),Lyte.Router.getRouteInstance().refresh()}),3e3)}}else if("updateChatUserAndChannelList"===e.type)"undefined"!=typeof chatIntegration&&(chatIntegration.userList=e.users,chatIntegration.channelsList=e.channels);else if("dontShowTaskClosePopup"===e.type)Crm.handleDontShowTaskClosePopup();else if("emailParser"===e.type)networkUtils.loadFeatureScripts(["zohocrm_emailParser.js"],(function(){mailparser.loadContentViaEmail(e.Content)}));else if("UserLayout"===e.type){var R=$(".cxUserAddEditModal");R&&R.is(":visible")&&(R.find(".lyteModal").scrollTop(0),$("#cxUserLayoutRefLnk").show())}else if("WorkFlow"===e.type){var U=e.jobId,O=!0,x=e.isPageRefreshingNeeded,V=e.isProcessFlow;e.isBulkWorkFlow?(detailView.isMassupdatePopupLoading||$("#macroFieldUpdate").length>0||$("#changeOwnerForm").length>0||x)&&(detailView.isMassupdatePopupLoading&&(detailView.isMassupdatePopupLoading=!1),refreshPageForBulkWorkFlowScheduler(e),O=!1):detailView.refreshInWms?(O=!1,null!=detailView.prevModule&&detailView.prevModule==detailView.currentModule||!detailView.singleRecordLyteOffloading||detailView.refreshCanvasView||x?detailView.refreshPageForSingleRecordWorkFlow(e):(detailView.refreshInWms=!1,clearTimeout(automationActionsNotificationScheduler.singleRecordOffloadTimeout))):x&&(detailView.singleRecordLyteOffloading||!V?(V||(detailView.isRecordConverted=!0),detailView.callLyteRefresh(),detailView.singleRecordLyteOffloading=!1):V&&$("#pb_processButtonLayerInner").length>0?ProcessFlow.refreshButtonLayer(detailView.currentModule,detailView.entityId,detailView.orchestrationDetailsArray):reloadCurrentEntityView(detailView.entityId,detailView.currentModule)),x&&(O=!0);var B=detailView.currWFOffloadingJobIds.indexOf(U);if(-1!==B&&(detailView.currWFOffloadingJobIds.splice(B,1),0===detailView.currWFOffloadingJobIds.length&&O)){$("#automationSchNotificationPopup").remove();var j=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("automationActionsNotification")]);Lyte.injectResources(j,void 0,(function(){var e={};e.message=I18n.getMsg("crm.automation.workflow.notification.completed.message"),e.status="success",automationActionsNotificationScheduler.addOrUpdateWFPopupStatus(e,I18n.getMsg("crm.automation.workflow.notification.completed.title"))}))}}else if("autoEnrich"===e.type){var H=$L("crm-create-layout")[0];if(H){var z=null;z=e.response&&e.response.auto_enrichment?e.response.auto_enrichment:e.response,Crm.lc_AE_data&&(Crm.lc_AE_data.enrichedData=z),(z&&z.status&&z.status.indexOf("completed")>-1||z.status.indexOf("success")>-1)&&H.component.setEnrichDataAndNotify(z)}else CAEExec&&CAEExec.setEnrichDataAndNotify(e.response)}else if("businessHoursStatus"===e.type&&"Enabled"===e.response){Crm.userDetails.isBusinessHoursCreated=!0;var J=document.getElementById("showBHPopup");J&&J.ltProp("show",!1)}else if("OrgTimeZoneUpdate"===e.type)Crm.userDetails.ORGTIME_ZONE=e.ORGTIME_ZONE;else{if("zsurveyCampaign"===e.type){var W=$('form[name="viewentityform"]').find("#module");return void(W.length>0&&"Campaigns"===W.val()&&returnJson&&returnJson.Campaigns&&5===returnJson.Campaigns.CAMPAIGN_TYPE&&e.surveyId===returnJson.Campaigns.surveyId&&1===returnJson.Campaigns.surveyEnabled&&networkUtils.loadFeatureScripts(["zsurvey_home-min.js"],(function(){ZSurvey.handleSurveyWMSMessage(e)})))}if("crossorgnotification"===e.type)return void(Lyte.Router.getRouteInstance("crm.settings.section.extensions.zoho-extensions.crossorg")&&Lyte.Router.getRouteInstance().refresh());if("Similarity"===e.type){var K=Lyte.Router.getRouteInstance("crm.settings.section.zia.similarity.list"),q=Lyte.Router.getRouteInstance("crm.settings.section.zia.similarity.view");if(K&&"DELETE"===e.method&&store.unloadRecord("similarity",e.config_id),q){var G=q.getDynamicParam();if("DELETE"===e.method){store.unloadRecord("similarity",e.config_id);var Z=$L("crm-similarity-detailedview")[0],Y=!1;Z&&(Y=Z.getData("isDeleteInProgress")),G===e.config_id&&!1===Y&&(Lyte.Router.transitionTo("crm.settings.section.zia.similarity.error",null).data={errorMsg:I18n.getMsg("zia.similarity.error.message")})}"PUT"===e.method&&store.findRecord("similarity",e.config_id).then((function(){commonUtils.showHideLoadingDiv(!1)}))}}else{if("Recommendation"===e.type){var X=Lyte.Router.getRouteInstance("crm.settings.section.zia.recommendation.view"),Q=Lyte.Router.getRouteInstance("crm.settings.section.zia.recommendation.index"),ee=Lyte.Router.getRouteInstance("crm.tab.module.custom-view.list");if(Q&&"delete"===e.method&&store.unloadRecord("recommendations",e.id),X){var te=X.getDynamicParam();"delete"===e.method&&(store.unloadRecord("recommendations",e.id),te===e.id&&(Lyte.Router.transitionTo("crm.settings.section.zia.recommendation.error",null).data={errorMsg:"crm.recommendation.error.module.permissions"}))}if(moduleRecordMapping[e.api_name]&&(moduleRecordMapping[e.api_name].isRecommendationsEnable=e.isRecommendationsEnable,moduleRecordMapping[e.api_name].recommendationsDetailsJson&&(moduleRecordMapping[e.api_name].recommendationsDetailsJson.suggestion_type=e.suggestion_type)),ee&&e.method&&("POST"===e.method||"PUT"===e.method)){var ie=e.api_name;if(moduleRecordMapping&&moduleRecordMapping[ie]){if(ee.currentModel&&moduleApiMapping[ee.currentModel.module]===ie){var oe=$L("#customFilter")[0];!1===e.isRecommendationsEnable&&oe&&oe.setData("special_field",oe.getData("special_field").filter((function(e){return"Recommendation"!==e.api_name})))}moduleRecordMapping[ie].isRecommendationsEnable=e.isRecommendationsEnable,moduleRecordMapping[ie].recommendationsDetailsJson.suggestion_type=e.suggestion_type;var ne=$L("#option_Recommendation")[0];if(ne){var ae=e.suggestion_type,se={};ae.first_buy&&ae.first_buy.enabled?se.FirstTime={system:"FirstTime",display:ae.first_buy.label}:se.FirstTime=void 0,ae.customer_also_bought&&ae.customer_also_bought.enabled?se.Dependent={system:"Dependent",display:ae.customer_also_bought.label}:se.Dependent=void 0,ae.frequently_bought_together&&ae.frequently_bought_together.enabled?se.Bundle={system:"Bundle",display:ae.frequently_bought_together.label}:se.Bundle=void 0,ae.rebuy&&ae.rebuy.enabled?se.Repeat={system:"Repeat",display:ae.rebuy.label}:se.Repeat=void 0,ae.next_buy&&ae.next_buy.enabled?se.Sequence={system:"Sequence",display:ae.next_buy.label}:se.Sequence=void 0,ne.setData("recommendationBasedOnOption",se)}store.findRecord("recommendations",e.config_id).then((function(){commonUtils.showHideLoadingDiv(!1)})),Lyte.Router.getRouteInstance().refresh({refreshTemplate:!0})}}return void(e.config_id&&(Q||X||ee)&&store.findRecord("recommendations",e.config_id).then((function(){commonUtils.showHideLoadingDiv(!1)})))}if("Prediction"===e.type){var re=document.querySelector("crm-prediction-detail-page"),le=document.querySelector("crm-prediction-canvas-detail-page"),de=!1;de=null!==le?le.component.getData("module")===e.module.name&&le.component.getData("record").id===e.id:void 0!==returnJson&&returnJson.tabId===e.module.id&&returnJson[e.module.name].entityid===e.id;var ce=$("#predictionDetails"),pe=$L("#noResultPrediction"),ue=[CrmFieldConstants.DATE1,CrmFieldConstants.DATE2,CrmFieldConstants.DATE3],me=[CrmField.UITYPES.DATE_TIME1,CrmFieldConstants.DATETIME_EVENT_START];if(de&&re){var he=re.component.getData("prediction"),fe=[CrmField.UITYPES.BOOLEAN_DEF,CrmField.UITYPES.BOOLEAN_DEF_NOT],ge=(CrmField.UITYPES.CURRENCY,CrmField.UITYPES.CURRENCY_ROUND_OFF,CrmField.UITYPES.CURRENCY_ROUND_DOWN,CrmField.UITYPES.CURRENCY_ROUND_UP,e.predictions),ve=ge.length,ye=ve;for(w=0;w<ve;w++){if(null!==le?!store.peekAll("field").filterBy({column_name:ge[w].predictFieldColumn}).length||!store.peekAll("field").filterBy({column_name:ge[w].predictionFieldColumn}).length:void 0===returnJson.entityMapJson[ge[w].predictFieldColumn]||void 0===returnJson.entityMapJson[ge[w].predictionFieldColumn])ye--;else{fe.indexOf(parseInt(ge[w].uitype))>-1?!0===ge[w].value?($("#no_"+ge[w].predictionFieldColumn).hide(),$("#yes_"+ge[w].predictionFieldColumn).show()):($("#yes_"+ge[w].predictionFieldColumn).hide(),$("#no_"+ge[w].predictionFieldColumn).show()):$("#subvalue_"+ge[w].predictionFieldColumn).html(ge[w].value),ue.indexOf(ge[w].uitype)>-1||me.indexOf(ge[w].uitype)>-1||delete ge[w].uitype,delete ge[w].predictionFieldColumn;var we=!1;we=null!==le?store.peekAll("field").filterBy({column_name:ge[w].scoreFieldColumn}).length:void 0!==returnJson.entityMapJson[ge[w].scoreFieldColumn],ge[w].score&&we?($("#subvalue_"+ge[w].scoreFieldColumn).html(ge[w].score),delete ge[w].scoreFieldColumn):delete ge[w].score,0===he.length?(Lyte.arrayUtils(he,"push",ge[w]),ce.show()):1===he.length?he[0].id===ge[w].id?Lyte.arrayUtils(he,"replaceAt",0,ge[w]):Lyte.arrayUtils(he,"push",ge[w]):he[0].id===ge[w].id?Lyte.arrayUtils(he,"replaceAt",0,ge[w]):Lyte.arrayUtils(he,"replaceAt",1,ge[w])}}ye&&(0!==pe.length&&(he.length?pe.hide():pe.show()),ce.show())}crmBstTime.setPosition()}else if("prediction_smart_filter"===e.type){var Ce=e.predictionFilterData[0],be=moduleRecordMapping[e.module].prediction_details;if(moduleRecordMapping[e.module].isPredictionEnabled=!0,be){A=be.length;var Ae=!1;for(w=0;w<A;w++)be[w].id===Ce.id&&(Ae=!0);Ae||moduleRecordMapping[e.module].prediction_details.push(Ce)}else moduleRecordMapping[e.module].prediction_details=[],moduleRecordMapping[e.module].prediction_details.push(Ce)}else if("Next_best_action"===e.type){re=document.querySelector("crm-nba-detail-page");var Te=document.querySelector("crm-nba-canvas-detail-page"),Se=null!==Te&&Te.component.getData("record")===e.recordId||void 0!==returnJson&&returnJson.Potentials.entityid===e.recordId,Ie=$("#nbaDetails");if(re&&Se&&Ie){var Le,Me=(Le=["Calls","Events","Emails"]).contains(e.action)?e.action:void 0;if(re.component.setData("is_nba_available",void 0!==Me),void 0!==Me){var $e=e.time,_e=$L.moment($e).toDate()-($L.moment().toDate().getTime()+6e4*CrmDateUtils.getTimeOffsetInMins(Crm.userDetails.ORGTIME_ZONE));if(_e<=0)re.component.setData("is_nba_available",!1);else{re.component.setData("module",Me);var ke=Math.ceil(_e/864e5);re.component.setData("duration",ke)}}Ie.show()}}else if("Competitor_Alert"===e.type)Lyte.triggerEvent("CompetitorAlertCrossTabListener",e);else if("VOC"===e.type){if("computation_complete"===e.operation||"computation_failure"===e.operation){var Pe=e.id,Ne=networkUtils.returnDependencyFiles(["voc-store.js","voc-home.js"],crmConstants.jsStaticPathForLyte),De=networkUtils.returnDependencyFiles(["voc-home.css"],crmConstants.lessStaticPathForLyte),Fe=Ne.concat(De).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("vocnotification")])),Ee=function(){(store.peekRecord("voc_analytic",Pe)?Promise.resolve(store.peekRecord("voc_analytic",Pe)):store.findRecord("voc_analytic",Pe)).then((function(t){moduleRecordMapping["Voice Of Customer"]||store.findAll("module").then((function(){crmTab.reloadTabMenu()}));var i=document.getElementsByTagName("crm-voc-wms-notification")[0],o={id:Pe,name:t.name?t.name:t[0].name},n="computation_complete"===e.operation?"voc.computation.complete.notification.content":"voc.computation.complete.notification.failure.content";if(i){var a=(i=i.component).getData("dashboards"),s=[o].concat(a.filter((function(e){return e.id!==o.id})));i.setData({dashboards:s,msgKey:n})}else Lyte.Component.render("crm-voc-wms-notification",{dashboards:[o],msgKey:n},"#basic");Lyte.triggerEvent("reloadDashboard",Pe,!0)}))};Lyte.injectResources(Fe,void 0,Ee)}}else if("Circuits"===e.type){var Re=JSON.parse(e.message);switch(E=Re.msgType){case"accountStatus":var Ue=Re.status;switch(Crm.userDetails.hasOwnProperty("Circuits")||(Crm.userDetails.Circuits={}),Ue){case"enable":cookieUtils.deleteCookie("circuits_account_disable=true","/"),Crm.userDetails.Circuits.isCurrentPortalActive=!0,Lyte.triggerEvent("cirMain_disableCircuitsDisableAlert"),Lyte.triggerEvent("cirAssoc_setData",{isAccountEnabled:!0}),Lyte.triggerEvent("cirRLBody_setIsAccountEnabled",!0),Lyte.triggerEvent("cirExecLog_setIsAccountEnabled",!0),Lyte.triggerEvent("cirPrev_set_data",{isAccountEnabled:!0});break;case"disable":cookieUtils.deleteCookie("circuits_account_disable=true","/"),Crm.userDetails.Circuits.isCurrentPortalActive=!1;t=networkUtils.returnDependencyFiles(["crm-wms-pop.js"],crmConstants.jsStaticPathForLyte),i=networkUtils.returnDependencyFiles(["crm-wms-pop.css"],crmConstants.cssStaticPathForLyte),o=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("circuits")]),n=t.concat(i).concat(o);Lyte.injectResources(n,void 0,(function(){$L("#crmWmsPopBox").length||Lyte.Component.render("crm-wms-pop",{},"#lookupdiv"),Lyte.triggerEvent("crmWmsPop_setData",{headerContent:I18n.getMsg("crm.circuits.wms.header",Crm.brandName),bodyContent:I18n.getMsg("crm.circuits.wms.body",I18n.getMsg("crm.social.crm")),isCookieHandleNeeded:!0,cookieName:"circuits_account_disable",cookieExpiry:864e5,showCancel:!1,showSuccess:!1}),Lyte.triggerEvent("crmWmsPop_openPop"),Lyte.triggerEvent("cirMain_enableCircuitsDisableAlert"),Lyte.triggerEvent("cirAssoc_setData",{isAccountEnabled:!1}),Lyte.triggerEvent("cirRLBody_setIsAccountEnabled",!1),Lyte.triggerEvent("cirExecLog_setIsAccountEnabled",!1),Lyte.triggerEvent("cirPrev_set_data",{isAccountEnabled:!1})}))}case"CircuitsPermission":Crm.userDetails.permissions||(Crm.userDetails.permissions={}),Crm.userDetails.permissions.Crm_Implied_Circuits_Access=!!Re.status&&Re.status;break;case"initializeCircuitsClient":if(!Re.data)break;if(Crm.userDetails.Circuits||(Crm.userDetails.Circuits={}),Re.data.integration_done_by&&(Crm.userDetails.Circuits.integration_done_by=Re.data.integration_done_by),Re.data.paymentInfo&&(Crm.userDetails.Circuits.paymentInfo=Re.data.paymentInfo),Re.data.isCurrentPortalActive)switch(Crm.userDetails.Circuits.isCurrentPortalActive=Re.data.isCurrentPortalActive,Ue=Crm.userDetails.Circuits.isCurrentPortalActive){case"enable":cookieUtils.deleteCookie("circuits_account_disable=true","/"),Crm.userDetails.Circuits.isCurrentPortalActive=!0,Lyte.triggerEvent("cirMain_disableCircuitsDisableAlert"),Lyte.triggerEvent("cirAssoc_setData",{isAccountEnabled:!0}),Lyte.triggerEvent("cirRLBody_setIsAccountEnabled",!0),Lyte.triggerEvent("cirExecLog_setIsAccountEnabled",!0),Lyte.triggerEvent("cirPrev_set_data",{isAccountEnabled:!0});break;case"disable":cookieUtils.deleteCookie("circuits_account_disable=true","/"),Crm.userDetails.Circuits.isCurrentPortalActive=!1;t=networkUtils.returnDependencyFiles(["crm-wms-pop.js"],crmConstants.jsStaticPathForLyte),i=networkUtils.returnDependencyFiles(["crm-wms-pop.css"],crmConstants.cssStaticPathForLyte),o=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("circuits")]),n=t.concat(i).concat(o);Lyte.injectResources(n,void 0,(function(){$L("#crmWmsPopBox").length||Lyte.Component.render("crm-wms-pop",{},"#lookupdiv"),Lyte.triggerEvent("crmWmsPop_setData",{headerContent:I18n.getMsg("crm.circuits.wms.header",Crm.brandName),bodyContent:I18n.getMsg("crm.circuits.wms.body",I18n.getMsg("crm.social.crm")),isCookieHandleNeeded:!0,cookieName:"circuits_account_disable",cookieExpiry:864e5,showCancel:!1,showSuccess:!1}),Lyte.triggerEvent("crmWmsPop_openPop"),Lyte.triggerEvent("cirMain_enableCircuitsDisableAlert"),Lyte.triggerEvent("cirAssoc_setData",{isAccountEnabled:!1}),Lyte.triggerEvent("cirRLBody_setIsAccountEnabled",!1),Lyte.triggerEvent("cirExecLog_setIsAccountEnabled",!1),Lyte.triggerEvent("cirPrev_set_data",{isAccountEnabled:!1})}))}}}else if("enableCallsNewView"===e.type){var Oe=networkUtils.returnDependencyFiles(["zcrm_callsnew.js"],crmConstants.jsStaticPath);return void Lyte.injectResources(Oe,void 0,(function(){isNewCallView=!0;try{void 0!==Crm.userDetails.VALIDATIONRULEAVAILABLE&&!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&void 0!==Crm.userDetails.LRINVOLVEDMODULES&&Crm.userDetails.LRINVOLVEDMODULES.push("Calls")}catch(e){try{murphy.error(e)}catch(e){}}}))}}}s=e.module;if(e.date=(new Date).getTime(),e.hasOwnProperty("gnType"))"true"===Crm.userDetails.isMotivatorEnabled?"game_status"===e.gnType&&"crm.gamification.game.index"===Lyte.Router.getRouteInstance().transition.info.route&&(Lyte.Router.getRouteInstance().refresh().data=Lyte.Router.getRouteInstance().transition.data):GameLoad.loadMainJsAndExecute((function(){document.hasFocus()&&GameLoad.loadData((function(){Gamification.handleWMSMessage(e)}))}));else if("CustomModuleCreated"!==s&&"LinkingModuleCreated"!==s)if("MPL_MIGRATION"!=s)if("imMessageNotification"===s){var xe="new_message"===e.type&&e.data&&"in"===e.data.direction&&0===$L("#msg_"+e.data.id).length;(xe=xe||"im_push_notification"===e.type)&&e.message_owner===Crm.userDetails.USER_ID&&Lyte.triggerEvent("crmMsgPushNotify",e);var Ve=document.querySelector("crm-msg-detail-view");Ve&&Ve.getMethods("processIMNotification").call([],e)}else if("ZTI"==s)ztiNotifier.ztiCallNotification(e);else if("zia_voice"===s)ziaskills.pushReminder("object"==typeof e?e:JSON.parse(e));else if("DINOTIFICATION"!==s||Crm.userDetails.CLIENT_ACCOUNT)if("CTIAPI"===s)networkUtils.loadFeatureScripts(["zohocrm_phonebridge_notifier.js"],(function(){ctiApiNotifier.ctiApiNotification(e)}));else if("CALLS_PREFERENCES"===s&&Calls.handleWmsMessage)Calls.handleWmsMessage(e);else if("CALLPOPUP_NOTIFICATIONS"===s)ctiApiNotifier.notifyCallPopup(e);else if("eventMeetingOAuthSuccess"===s)Events.eventMeetingOAuthSuccess(e);else if("eventMeetingOAuthFailure"===s)Events.eventMeetingOAuthFailure(e);else if("eventMeetingReAuthorize"===s)Events.eventMeetingReAuthorize(e);else if("showMeetingAuthorizationPopUp"===s)Events.showMeetingAuthorizationPopUp(e.toolName,void 0,!0,e.isCalendarBooking);else if("populateMeetingSiteUrl"==s)Events&&(Events.meetingSiteUrl=e.meetingSiteUrl);else if("eventMeetingAuthorize"===s)null!=Events.startMeetingWindowObject&&Events.startMeetingWindowObject.close(),Events.showMeetingAuthorizationPopUp(e.toolName,null);else if("reinitSetupJSON"===s)globalSetpJson=e.setupjson,"crm.settings.index"==Lyte.Router.getRouteInstance()._objPath&&$("crm-setup")[0].component.init();else if("RELOAD"===s)$("#loginlaterId").hide(),localStorage.setItem("pb_login_later_enabled",!1),$("#phonebridge_popup_container").hide(),$(".freezeLayer").hide(),$("html").css("overflow","auto"),$("#protocol").attr("value",e.protocol),networkUtils.loadFeatureScripts(["zohocrm_phonebridge_notifier.js"]),"undefined"!=typeof ctiApiConfig&&ctiApiConfig.destroyProviderData(),-1!==window.location.search.indexOf("settings/telephony")&&Utils.windowLocationReload();else if("WidgetAction"===s)"install"===e.action?(networkUtils.loadFeatureScripts(["zohocrm_phonebridge_notifier.js"]),"undefined"!=typeof ctiApiConfig&&ctiApiConfig.destroyProviderData(),isTelephonyWidgetInstalled=!0):isTelephonyWidgetInstalled=!1,-1!==window.location.search.indexOf("settings/telephony")&&Utils.windowLocationReload();else if("OauthToken"===s)$("#oauthtable").hide(),$("#oauthresponse").show(),$("#oauthtoken").val(e.token),$("#mainapitable").show(),$("#calltable").show(),$("#apiresponsetable").show(),$("#apicalltable").show();else if("vendorToken"===s)$("#vendorTokenLink").hide();else if("vendorTokenError"===s)ctiApiNotifier.showErrorStatus(e,!1);else if("intermediateprocess"===s)ctiApiNotifier.intermediateCallProcess(e);else if("reminder"===s)createReminder1(e,!0);else if("CallReminder"===s)CallReminder.handleCustomMessage(e);else if("TwilioCallActions"===s)TwilioCalls.handleCustomMessage(e);else if("Twiliodialpad"===s)void 0!==twiOutgoingConn.sendDigits&&"outbound"===e.CALL_TYPE?twiOutgoingConn.sendDigits(e.digit):void 0!==twiIncomingConn.sendDigits&&"inbound"===e.CALL_TYPE&&twiIncomingConn.sendDigits(e.digit);else if("TwilioConfigAction"===s)networkUtils.loadFeatureScripts(["zohocrm_twilio_conf.js"],(function(){TwilioConf.handleCustomMessage(e)}));else if("showRecentMails"!==s||Crm.userDetails.IMAP_STATUS)if("crmEmail"==s){var Be=document.getElementById("newMailCount");void 0!==e.newMailCount&&Be&&("none"==Be.style.display||$(Be).hasClass("dN")?(Be.style.display="block",Be.innerHTML=e.newMailCount,crmplusImplTriggerActions("setNotificationCount",["mailbox",e.newMailCount])):(Be.innerHTML=parseInt(Be.innerHTML)+e.newMailCount,crmplusImplTriggerActions("setNotificationCount",["mailbox",parseInt(Be.innerHTML)+e.newMailCount])))}else if("Tasks"==s||"Events"==s&&"Picklist_Actions"!=e.action||"Appointments"==s)Activities.isRequestSent||Activities.showHideRemainder(),setTimeout((function(){try{e=crmBstTime.populateActivityReminderBestTime(e);var t=Activities.currentDiv(e);if(Activities.reminderList=Activities.reminderList+e.activityId+";",$("li[id="+e.activityId+"]").length>0){var i=$("li[id="+e.activityId+"]").closest("ul");$("li[id="+e.activityId+"]").remove(),i.children().length<3&&i.remove(),Activities.reminderCount--}if(0==$(".remainderList").length&&$("#reminderContent").html(""),$("#currentEvt").length>0){i=$("li[id=currentEvt]").closest("ul");$("li[id=currentEvt]").after(t)}else t='<ul class="remainderList"><li id="currentEvt" class="dayseparation mL15 crm-font-bold"><span class="daytext">'+I18n.getMsg("crm.Now")+'</span><span class="seperator-line"></span></li>'+t+'<li class="menu_sep" style="border: none"></li></ul>',$("#reminderContent").prepend(t);if(""!==Activities.reminderCount&&(Activities.reminderCount++,$("#notificationCount").html().indexOf("+")>-1?$("#notificationCount").html(Activities.reminderCount+"+").show():$("#notificationCount").html(Activities.reminderCount).show(),Activities.notifyCountToCrmPlusFrame(Activities.reminderCount)),Activities.showHideReminderDetail(),$("li[id="+e.activityId+"]").addClass("remainderactive").data("details",e),Activities.showMoreDetails($("li[id="+e.activityId+"]"),"currentReminder"),"Events"===s&&Events.reminderNotificationEnabled&&window.Notification){var o={clickUrl:Crm.getCrmBasePath()+"/EntityInfo.do?module=Events&id="+e.activityId,id:e.activityId+""};CrmReminderNotification.show(Events.reminderNotificationImgUrl,e.TITLEVALFEED,"",o)}}catch(e){try{console.log(e)}catch(e){}}}),10);else if("zccampaign"==s){u=e.message;Notifier.construct(u);m=105;$("#ztinotifier").css({width:"450"}),Notifier.slider.setHeightParams(0,m,0,0),Notifier.slider.down("ztinotifier")}else if("autoNumberCF"==s){u=e.message;Notifier.construct(u);m=105;$("#ztinotifier").css({width:"450"}),Notifier.slider.setHeightParams(0,m,0,0),Notifier.slider.down("ztinotifier")}else if("Encryption"===s)Encryption.showEncryptionPop(e);else if("Record Accessibility"===s)showRecordAccess(e);else if("ExportReport"==s||"DownloadVCard"==s){var je=e.message;je.IsDeleteLink?crmReports.clearAPopupDiv(je.UniqueID):crmReports.showStatusBasedResult(je)}else if("portalChange"==s){var He=e.new_portal,ze=e.old_portal,Je=location.href,We=e.modifiedBy,Ke=Crm&&Crm.userDetails?Crm.userDetails.ZUID:void 0;-1!=Je.indexOf("/"+ze+"/")&&He&&We!=Ke&&(window.crmNewPortal=He,Crm.showURLChangeAlert(!0)),"true"==isSandboxAcc&&$("html,body").removeClass("eventNone")}else if(e.ACTION==="EXPORT_"+e.USERID)crmExportWMSMsg.showMessageBasedResult(e);else if("REPORTS_MIGRATION"===e.ACTION){var qe=e.PROCESS;if(6===e.STATUS){var Ge=document.querySelector("crm-report-wms-pop");Ge&&(Ge=Ge.component).$node.remove()}else{t=networkUtils.returnDependencyFiles(["crm-report-wms-pop.js"],crmConstants.jsStaticPathForLyte),i=networkUtils.returnDependencyFiles(["crm-wms-pop.css"],crmConstants.cssStaticPathForLyte),o=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reports")]),n=t.concat(i).concat(o);Lyte.injectResources(n,void 0,(function(){if(!$L("#crmReportWmsPopBox").length){var e=document.querySelector("crm-report-wms-pop"),t=I18n.getMsg("crm.report.upgrade.report.status"),i="NEW"===qe?I18n.getMsg("crm.report.upgrade.success.new.version"):I18n.getMsg("crm.report.upgrade.success.old.version"),o=I18n.getMsg("crm.button.close"),n=I18n.getMsg("crm.mb.label.try.now");e?(e.setData("headerContent",t),e.setData("bodyContent",i),e.setData("cancelText",o),e.setData("successText",n),e.setData("isCookieHandleNeeded",!1),e.setData("cookieName",void 0),e.setData("cookieExpiry",void 0)):e=Lyte.Component.render("crm-report-wms-pop",{headerContent:t,bodyContent:i,cancelText:o,successText:n,isCookieHandleNeeded:!1,cookieName:void 0,cookieExpiry:void 0},"#reportlookupdiv")}Lyte.triggerEvent("crmReportWmsPop_openPop"),localStorage.setItem("reports_migration",qe);var a=I18n.getMsg("crm.report.upgrade.tooltip.message.success1"),s=I18n.getMsg("crm.report.upgrade.tooltip.message.success2");if("NEW"===qe){crmReports.tooltipMsgHeading=a,crmReports.tooltipMsgContent=s,crmReports.updatedTimeMsg="",crmReports.showMigrateTooltip();var r=document.querySelector("crm-new-reports-popup");r&&(r.setData("tooltipMsgHeading",a),r.setData("tooltipMsgContent",s),r.setData("updatedTimeMsg",""))}else{var l=document.querySelector("crm-reports-container");l&&(l.setData("toolTipMsgHeading",a),l.setData("toolTipMsgContent",s),l.setData("toolTipTimeMsg",""))}}))}}else if("transferAndDelete_Actions"===e.action){var Ze=I18n.getMsg("crm.delete.user.transfer_delete.scheduler.title");transDelUserScheduler.addOrUpdateUserSchedulerStatus(e,Ze)}else if("Picklist_Actions"===e.action){U=e.jobId;if(void 0===getObj("rls-contSharStaLoad-pop")){$("body").append(Handlebars.templates.PicklistReplaceValue(e));var Ye=$("<td>");(mt=$("<div>")).attr({class:"schedularProgress-icon svgIcons cP pR",onclick:"crmExportWMSMsg.showHidePicklistSchedulerDiv();"}),Ye.append(mt),$("#wmsstatusbar .crm-chatBarIcons tbody tr").prepend(Ye),$("#rls-contSharStaLoad-pop").addClass("schedularOpen"),setTimeout((function(){$("#rls-contSharStaLoad-pop").removeClass("schedularOpen")}),5e3)}else if(2===e.status){var Xe=$(Handlebars.templates.PicklistReplaceValue(e)).find(".picklistReplaceList").clone();$("#rls-contSharStaLoad-pop .scheduleListRLS").append(Xe),$("#rls-contSharStaLoad-pop").addClass("schedularOpen"),setTimeout((function(){$("#rls-contSharStaLoad-pop").removeClass("schedularOpen")}),5e3),clearTimeout(crmExportWMSMsg.closeAll)}else 5!==e.status&&4!==e.status||($("#picklist_pop_"+U).find(".picklist_progress").remove(),$("#rls-contSharStaLoad-pop").find("#picklist_pop_"+U).append(Handlebars.templates.picklistReplaceCompletedNotification(e)),$("#rls-contSharStaLoad-pop").addClass("schedularOpen"),setTimeout((function(){$("#rls-contSharStaLoad-pop").removeClass("schedularOpen")}),5e3),0===$("#rls-contSharStaLoad-pop").find("picklist_progress").length&&(clearTimeout(crmExportWMSMsg.closeAll),crmExportWMSMsg.clearAllreplace()))}else if("Mass_Convert"===e.type){var Qe=networkUtils.returnDependencyFiles(["crm-mass-convert-notify.js"],crmConstants.jsStaticPathForLyte),et=document.querySelector("crm-mass-convert-notify");if(et){var tt=et.component;Lyte.registeredMixins["crm-mass-convert-notify"].initilization(e,tt)}else Qe=(Qe=Qe.concat(networkUtils.returnDependencyFiles(["crm-mass-convert-notify.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(networkUtils.getI18nJSUrl("crm_mass_convert_notify"))),Lyte.injectResources(Qe,void 0,(function(){Lyte.registeredMixins["crm-mass-convert-notify"].initilization(e)}))}else if("IMAP"===s)void 0!==e.MAIL_COUNT?($("#newMailCount").html(e.MAIL_COUNT).show(),document.title="("+e.MAIL_COUNT+")"+originaltitle,crmplusImplTriggerActions("setNotificationCount",["mailbox",e.MAIL_COUNT])):"undefined"!=typeof CrmIMAP&&CrmIMAP.handleWmsMessage(e);else if("NotificationCenter"===s)crmNTCWms.handleMessage(e);else if("Social"===s)if(e.settings)if(e.social_tab)if(e.added||e.updated||e.errorCode||e.deleted){var it=$L("crm-social-setup-brand-details")[0].component;void 0!==it&&it.handleAddAccount(e),"undefined"!=typeof zsoTab&&zsoTab.handleAddAccount(e)}else{var ot=e.brid?e.brid:"",nt=e.errorCode?e.errorCode:"",at=e.account_id?e.account_id:"";e.twitter?$(".comm_twitter").hasClass("sel")?crmSocialSetup.triggerSetup("#sub_twitter",nt,"",ot):"none"!==$("#reauth_alert").css("display")&&($("#reauth_"+ot).remove(),crmSocial.reloadFeeds(),0==$("#reauth_accounts").children().length?crmSocial.closeReauthAlert():$("#settings_button").prepend('<span class="flw_dot setFlwDotPos"></span>')):e.facebook?$(".comm_facebook").hasClass("sel")?crmSocialSetup.triggerSetup("#sub_facebook",nt,at,ot):"none"!==$("#reauth_alert").css("display")&&($("#reauth_"+ot).remove(),crmSocial.reloadFeeds(),0==$("#reauth_accounts").children().length?crmSocial.closeReauthAlert():$("#settings_button").prepend('<span class="flw_dot setFlwDotPos"></span>')):e.googleplus&&($(".comm_googleplus").hasClass("sel")?crmSocialSetup.triggerSetup("#sub_googleplus",nt,at,ot):"none"!==$("#reauth_alert").css("display")&&($("#reauth_"+ot).remove(),crmSocial.reloadFeeds(),0==$("#reauth_accounts").children().length?crmSocial.closeReauthAlert():$("#settings_button").prepend('<span class="flw_dot setFlwDotPos"></span>')))}else if(e.social_integ)if($("#entity_search_container").length>0&&"0px"===$("#entity_search_container").css("left"))e.twitter?crmSocialEntity.postAuthenticationHandling("twitter"):e.facebook?crmSocialEntity.postAuthenticationHandling("facebook"):e.googleplus&&crmSocialEntity.postAuthenticationHandling("googleplus");else if("undefined"==typeof crmSocialInteg||$("#userDetailView").is(":visible")){if($("#userDetailView").is(":visible"))if(e.twitter)if(e.reauth)$("#twitter_account").find(".reauth").remove();else{var st=$("#twitter_account");st.removeAttr("onclick").text(e.account_info?e.account_info.info.name:e.info.name).removeClass("col2c7bd0 fs f13"),st.append('<span id="twitter_delete" class="socialDeleteProfile svgIcons ico-delete-red fR vh cP" onclick="crmSocialPersonalAccounts.confirmDeleteAccount(\'twitter\',\''+e.account_id+"')\"></span>")}else if(e.facebook)if(e.reauth)$("#facebook_account").find(".reauth").remove();else{var rt=$("#facebook_account");rt.removeAttr("onclick").text(e.account_info?e.account_info.info.name:e.info.name).removeClass("col2c7bd0 fs f13"),rt.append('<span id="facebook_delete" class="socialDeleteProfile svgIcons ico-delete-red fR vh cP" onclick="crmSocialPersonalAccounts.confirmDeleteAccount(\'facebook\')"></span>')}else if(e.googleplus)if(e.reauth)$("#googleplus_account").find(".reauth").remove();else{var lt=$("#googleplus_account");lt.removeAttr("onclick").text(e.account_info?e.account_info.info.name:e.info.name).removeClass("col2c7bd0 fs f13"),lt.append('<span id="googleplus_delete" class="socialDeleteProfile svgIcons ico-delete-red fR vh cP" onclick="crmSocialPersonalAccounts.confirmDeleteAccount(\'googleplus\')"></span>')}}else crmSocialInteg.getPersonalAccounts();else e.errorCode&&"10001"===e.errorCode&&crmui.showMsgBand("error",I18n.getMsg("crm.social.setup.reauth.error",$ESAPI.encoder().encodeForHTML(e.account_id)),3e3);else $("#social_parent_div").length>0?crmSocialNotification.handleWMSNotification(e):$("#socialDashboard").length>0&&crmSocialNotification.processWMSNotification(e);else if("Sandbox"===s){($L("crm-sandbox-list").length>0||!Crm.isMultiSandboxEnabled)&&("AddDeveloper"===e.fromPage?(sandbox.getSandboxCountSummary(),"true"===e.issuccess&&crmui.showMsgBand("success",I18n.getMsg(e.msgContent),1e4)):sandbox.syncStatusInListPage(e));var dt=$("#sandboxId").val(),ct=e.sandboxId;if(dt&&ct&&dt===ct&&($(".sBoxCtn").length>0||$(".creationAnimation").length>0))if("datapop"===e.fromPage)sandbox.viewSandboxChanges(void 0,e);else{if("false"===e.issuccess){var pt=e.sandboxId;store.deleteRecord("sandbox",pt)}sandbox.viewSandboxChanges((function(){var t;"true"==e.issuccess?crmui.showMsgBand("success",I18n.getMsg(e.msgContent),1e4):($("#sandboxMsgDiv").removeClass("successMsg").addClass("failureMsg"),"Create"===e.fromPage?t=I18n.getMsg(e.msgContent,[e.toAddr,e.supportMail]):"Deployment"===e.fromPage&&(t=I18n.getMsg(e.msgContent,RebrandLinkUtil.getProperty("SUPPORTMAILID"))),crmui.showMsgBand("error",t,1e4))}),e)}}else if("RecycleBin"===s){var ut=networkUtils.returnDependencyFiles(["crm-recyclebin-notification-popup.js"],crmConstants.jsStaticPathForLyte);Lyte.injectResources(ut,void 0,(function(){var t=$L("crm-recyclebin-notification-popup");0==t.length&&t.push(Lyte.Component.render("crm-recyclebin-notification-popup",{},"body")),t[0].component.setData("showNotificationPopup",!0),t[0].component.setData("status",e.status),t[0].component.setData("operation",e.operation)}))}else if("PORTALS"===s){if(!document.querySelector("#portalsWMSIcon")){var mt;Ye=$('<td id="portalsWMSIcon">');(mt=$("<div>")).attr({class:"schedularProgress-icon svgIcons cP pR",onclick:"crmExportWMSMsg.showHideSchedulerNotificationModal();"}),Ye.append(mt),$("#wmsstatusbar .crm-chatBarIcons tbody tr").prepend(Ye)}var ht=e.response?e.response.response:e.response,ft=ht?ht.length:0,gt="In_Progress"===e.status,vt=0;for(w=0;w<ft;w++){var yt=ht[w],wt=Object.keys(yt),Ct=parseInt(yt[wt[0]][1]);200!==Ct&&1005!==Ct||vt++}var bt=vt===ft&&"SUCCESS"===e.status?0:0===vt||"FAILED"===e.status?1:2,At=e.user_type_name,Tt=networkUtils.returnDependencyFiles(["crm-scheduler-notification.js"],crmConstants.jsStaticPathForLyte),St=networkUtils.returnDependencyFiles(["crm-scheduler-notification.css"],crmConstants.cssStaticPathForLyte);Crm.userDetails.RTL_ENABLED&&(St=networkUtils.returnDependencyFiles(["crm-scheduler-notification-rtl.css"],crmConstants.cssStaticPathForLyte));var It=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("portals")]);Tt=Tt.concat(St).concat(It),Lyte.injectResources(Tt,void 0,(function(){var t={},i=document.querySelector("crm-scheduler-notification-modal");Ot={},i&&(Ot=i.component.data,i.remove()),Ot.jobIds&&!Ot.jobIds.contains(e.jobid)?Ot.jobIds.push(e.jobid):Ot.jobIds||(Ot.jobIds=[],Ot.jobIds.push(e.jobid));var o=Ot.modelData;t.showModal=!0,Ot.id="portalsSchedulerNotifier",Ot.removePopUpOnClose=!(Ot.jobIds.length>1),Ot.showModal=!0,Ot.title=I18n.getMsg("custmr.prtl.scheduler.success.msg"),At="ClientPortal"===At?I18n.getMsg(At):At,e.user_type_name=At;var n=!gt&&e.response?e.response.inviteType:"";t.message=gt?I18n.getMsg("custmr.prtl.scheduler.progress.title"):2===bt?I18n.getMsg("custmr.prtl.invite.success.count",[vt,ft,At]):0===bt?"invite"===n?I18n.getMsg("custmr.prtl.success.bulk.invite",[vt,At]):I18n.getMsg("custmr.prtl.success.bulk.reinvite",[vt,At]):"invite"===n?At?I18n.getMsg("custmr.prtl.failure.bulk.invite",[ft,At]):I18n.getMsg("custmr.prtl.failure.bulk.invite.on.usertype.deletion",[ft]):I18n.getMsg("custmr.prtl.failure.bulk.reinvite",[ft,At]),t.message2=gt||1===bt?"":I18n.getMsg("custmr.prtl.scheduler.refresh.message"),t.iconClass=2===bt?"zcrm_svgIcons cpT_warningTick":0===bt?"zcrm_svgIcons cpT_sucessTick":"zcrm_svgIcons cpT_failedTick",t.inProgress=gt,gt||0===bt||"SUCCESS"!==e.status||(t.anchorTag={},t.anchorTag.id="viewFailures",t.anchorTag.datazcqa="viewFailures",t.anchorTag.onClickArguments={},t.anchorTag.onClickArguments.msg=e,t.anchorTag.title=I18n.getMsg("custmr.prtl.invitees.failed"),t.anchorTag.action_name="showFailedInvitees"),o?o[e.jobid]=t:(o={})[e.jobid]=t,Ot.modelData=o,Lyte.Component.render("crm-scheduler-notification-modal",Ot,"body")}))}else if("Subscription"===s&&$("#SubscriptionExpiryDiv").size())Utils.windowLocationReload();else if("ResetBellCount"===e.type)crmNTCWms.resetBellCount();else if("UpdateSignalsCount"===e.type)crmNTCWms.updateSignalsCount(e);else if("UpdateSignalsCountInIFrame"===e.type)SalesSignalsWrapper.isSignalIFrameOpen&&SalesSignalsWrapper.updateSignalsCount();else if("markSignalAsRead"===e.type)crmNTCWms.markAsRead(e);else if("markAllSignalAsRead"===e.type)crmNTCWms.markAllAsRead();else if("AnomalyProgress"===s&&"undefined"!=typeof CrmAnalytics)0!=$("#"+e.id).length&&CrmAnalytics.loadComponentData(e.id,e.dashboard_id);else if("MassOperationProgress"===s){var Lt=e.message;if(!0===(Ot=JSON.parse(Lt)).neglect_storage_criteria&&2===Ot.actionType&&5===Ot.status&&(Crm.userDetails.data_storage.isAnyCleanupProcessRunning=!1),("1"==Ot.actionType||"2"==Ot.actionType||"3"==Ot.actionType)&&Ot.moduleLabel==customViewObject.module)if(5===Ot.status||4===Ot.status){customViewObject.showSelectAll=!0;var Mt=moduleRecordMapping[customViewObject.module].actions;if(Mt&&Mt.length){var $t=Mt.findIndex((function(e){return"hideSelectAllRecords"==e.name}));-1!=$t&&moduleRecordMapping[customViewObject.module].actions.splice($t,1)}}else customViewObject.showSelectAll=!1;massActionNotification.showMassOperationProgress(Ot)}else if("Convert_Lead_Scheduler"===e.type){var _t=networkUtils.returnDependencyFiles(["crm-convert-notify.js"],crmConstants.jsStaticPathForLyte);_t=(_t=_t.concat(networkUtils.returnDependencyFiles(["crm-convert-notify.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("convertNotify")])),Lyte.injectResources(_t,void 0,(function(){var t=e;if(t.module="Leads",t.singular_module=moduleRecordMapping.Leads.singular_label,null===document.getElementById("convertSchedulerNotificationPopup")){var i={module:"Leads"};i.singular_module=moduleRecordMapping.Leads.singular_label,i.status="initial",i.jobId=t.jobId,Lyte.Component.render("crm-convert-notify",i,"body")}var o=document.getElementById("convertSchedulerNotificationPopup"),n=document.getElementById("picklist_pop_"+t.jobId),a=o.getElementsByTagName("ul");if(null===n){var s=document.createElement("li");s.id="picklist_pop_"+t.jobId,s.classList.add("m0","p20","scheduledDataList","picklistReplaceList"),a[0].appendChild(s),n=document.getElementById("picklist_pop_"+t.jobId)}else n.innerHTML="";t.details&&t.details.duplicate_record&&document.querySelector("crm-convert-notify").component.getDuplicateErrorMsg(t,t.details);var r=document.createElement("crm-convert-notify");if(r.setData(Object.assign({},t)),n.append(r),o.getElementsByTagName("li").length>3){var l=renderingUtils.windowHeight/4*3;a.css("max-height",l).classList.add("oA")}}))}else if("financesuite"===s)ZInvoice.pushNotifyCx(e.action);else if("button_notify"===s)CustomButtonJSObjectInit.buttonWMSNotification(e.data);else if("function_limit_reach"===s){Ne=networkUtils.returnDependencyFiles(["custom-function-notification.js"],crmConstants.jsStaticPathForLyte),De=networkUtils.returnDependencyFiles(["custom-function-notification.css"],crmConstants.cssStaticPathForLyte),Ee=function(){Lyte.Component.render("crm-function-limit-notification",{content:e.data},"#basic")};Lyte.injectResources(Ne.concat(De),void 0,Ee)}else if("zanalytics-integration"===s){if("notify"===action){var kt="crm-zanalytics-notify",Pt=(Ne=networkUtils.returnDependencyFiles([kt+".js"],crmConstants.jsStaticPathForLyte),De=networkUtils.returnDependencyFiles([kt+".css"],crmConstants.cssStaticPathForLyte),I18n.getMsg("crm.zanalytics.enable.msg")),Nt=I18n.getMsg("crm.zanalytics.enable.link");Ze=I18n.getMsg("Notification")+" - "+I18n.getMsg("crm.reports.integ.advanced.new",Crm.appName),Ee=function(){Lyte.Component.render(kt,{content:Pt,title:Ze,clickhere:Nt},"#zAdvAnalyticNotify")};Lyte.injectResources(Ne.concat(De),void 0,Ee)}}else if("failure_functions"===s)CustomButtonJSObjectInit.pushNotifyCx(e.action);else if("undefined"==typeof migrate||"migrationUploadComplete"!==s&&"migrationModuleCompleteNotification"!==s&&"migrationFileNotSupported"!==s&&"updateMigrationProgressForFile"!==s&&"migrationUploadVirusCallBack"!==s&&"migrationAborted"!==s&&"migrationAfterCompleteNotification"!==s&&"migrationInitiated"!==s&&("rollback"!==s||"Migration"!==e.type&&"Module"!==e.type)&&"sampleDataMigrationInitiated"!==s)if("migrationUploadComplete"===s||"migrationModuleCompleteNotification"===s||"migrationFileNotSupported"===s||"updateMigrationProgressForFile"===s||"migrationUploadVirusCallBack"===s||"migrationAborted"===s||"migrationAfterCompleteNotification"===s||"migrationInitiated"===s||"rollback"===s&&("Migration"===e.type||"Module"===e.type)||"sampleDataMigrationInitiated"===s){var Dt;pi=window.location.pathname,ui=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/settings/migration");(Dt=e.sourcesystem?e.sourcesystem:e.message?e.message.source_system:"")&&""!==Dt.trim()&&(Dt=Dt.toLowerCase());var Ft={};if(Ft.sourceSystem=Dt,Ft.id=e.message?e.message.id:e.id?e.id:e.migrationId?e.migrationId:null,"sample"===Dt&&globalSetpJson){var Et=JSON.parse(globalSetpJson);if("migrationAfterCompleteNotification"===s){for(Rt in Et)if(void 0!==Et[Rt]["Data Administration"]){Et[Rt]["Data Administration"][0].array[2].array[0].setupShow=!0,Et[Rt]["Data Administration"][0].array[2].array[0].migrationId=e.migrationId;break}globalSetpJson=JSON.stringify(Et)}else if("rollback"===s){var Rt;for(Rt in Et)if(void 0!==Et[Rt]["Data Administration"]){Et[Rt]["Data Administration"][0].array[2].array[0].setupShow=!1;break}globalSetpJson=JSON.stringify(Et)}}if(pi.startsWith(ui)||"sampleDataMigrationInitiated"!==s&&"migrationUploadComplete"!==s&&"migrationAfterCompleteNotification"!==s&&"migrationAborted"!==s&&"rollback"!==s){var Ut=document.querySelector("crm-dm-wizard-steps");Ut?Lyte.registeredMixins["migration-util"].handleWmSMessages.call(Ut.component,s,e,Ft):Lyte.registeredMixins["migration-util"].handleWmSMessages(s,e,Ft)}else{Pt="",Ze=I18n.getMsg("crm.migration.label.DataMigration");switch(s){case"migrationUploadComplete":Pt=I18n.getMsg("crm.migration.extraction.complete");break;case"migrationAfterCompleteNotification":Pt=I18n.getMsg("crm.migration.complete.wms.msg"),"sample"===Dt&&(Pt=I18n.getMsg("cob.sampledata.migration.completed"),Ze=I18n.getMsg("cob.sampledata.population"),Crm.trackSpotLightAction("COB BlankPage - Sample Data Completed"),Crm.client_tracking("COB BlankPage - Sample Data Completed"));break;case"migrationAborted":Pt=I18n.getMsg("crm.migration.aborted.wms.msg");break;case"rollback":if("sample"===Dt)Crm.client_tracking("COB BlankPage - Sample Data InProgress"),Pt=I18n.getMsg("crm.sampledata.rollback.wms.msg"),Ze=I18n.getMsg("crm.sampledata.rollback.wms.title"),crmTab.cacheObj={};else{fi=e.moduleName;moduleRecordMapping[e.moduleName]&&(fi=I18n.getMsg(moduleRecordMapping[e.moduleName].plural_label)),Pt="Module"===e.type?I18n.getMsg("crm.migration.rollback.module.wms.msg",[fi,Dt]):I18n.getMsg("crm.migration.rollback.wms.msg",Dt)}break;case"sampleDataMigrationInitiated":Ze=I18n.getMsg("cob.sampledata.population"),Pt=I18n.getMsg("cob.sample.data.population.progress"),Crm.trackSpotLightAction("COB BlankPage - Sample Data InProgress")}Ft.content=Pt,Ft.title=Ze,$("#IMPORTNOTIFICATIONPOP1").is(":visible")&&importHistory&&importHistory.closeSuccessContainer($("#IMPORTNOTIFICATIONPOP1 .migCardClose")),Lyte.registeredMixins["migration-util"].handleWmSMessages(s,e,Ft)}}else if("importCompleted"===s||"rollback"===s&&"Import"===e.type){var Ot=e;networkUtils.loadFeatureScripts(["zohocrm_import.js",networkUtils.getI18nJSUrl("import")],(function(){"importCompleted"===s&&(customViewObject.module!==Ot.moduleName&&crmTab.deleteFromCache(Ot.moduleName),customViewObject.module==Ot.moduleName&&(customViewObject.clearonImportCompletion=!0)),"CLEARPOPUP"!==Ot.status&&$("#mig_notification").is(":visible")||importHistory.showCommonMsg(Ot)})),"translation"===e.feature&&store.findAll("module").then((function(){crmTab.reloadTabMenu()}))}else if("backupCompleted"===s){Ot=e;void 0===Lyte.registeredMixins["crm-backup-util"]?networkUtils.loadFeatureScripts(["crm-data-backup.js","crm-backup-store.js",networkUtils.getI18nJSUrl("databackup")],(function(){Lyte.registeredMixins["crm-backup-util"].showCommonMsg(Ot)})):Lyte.registeredMixins["crm-backup-util"].showCommonMsg(Ot)}else if("layoutrule"===s){for(var xt=[],Vt=0;Vt<e.lrinvolvedmodules.length;Vt++)xt.push(e.lrinvolvedmodules[Vt]);Crm.userDetails.LRINVOLVEDMODULES=xt}else if("wizardLayoutRule"===s){var Bt=[],jt=e.wlrinvolvedmodules.length;for(Vt=0;Vt<jt;Vt++)Bt.push(e.wlrinvolvedmodules[Vt]);Crm.userDetails.WLRINVOLVEDMODULES=Bt}else if("validation_rule"===s){if(Crm.userDetails.VRINVOLVEDMODULES||(Crm.userDetails.VRINVOLVEDMODULES=[]),e.vr_created_modules){var Ht=e.vr_created_modules.length;for(Vt=0;Vt<Ht;Vt++)Crm.userDetails.VRINVOLVEDMODULES.contains(e.vr_created_modules[Vt])||Crm.userDetails.VRINVOLVEDMODULES.push(e.vr_created_modules[Vt])}}else if("TranslationImportProgress"===s){Lt=e.message,Ot=null;void 0!==Lt&&(Ot=JSON.parse(Lt));var zt=$("<div>");zt.attr({id:"TranslationImportProgressDiv",class:"rItemIconDropDown from-footer p20 f15 color_1 proxima pT30 pB30",Style:"width: 430px;z-index:1001"}),$("body").append(zt),null!==Ot?$("#TranslationImportProgressDiv").html("<div class='mL70'>"+I18n.getMsg("crm.translation.import.status.info",[Ot.email])+"</div>").show():networkUtils.loadFeatureScripts([networkUtils.getI18nJSUrl("translation")],(function(){$("#TranslationImportProgressDiv").html("<div class='mL70'>"+I18n.getMsg("crm.sandbox.translation.import.status.info")+"</div>").show()})),setTimeout((function(){$("#TranslationImportProgressDiv").hide()}),5e3),commonUtils.showHideLoadingDiv(!1)}else if("TranslationImportDeployment"===s){var Jt=$("<div>");Jt.attr({id:"Division",class:"w500 pL25 pR30 pB12 pT25 newPopup",Style:"top:0;left:35%;height:auto;width:500px;z-index:1001"}),$("body").append(Jt),networkUtils.loadFeatureScripts([networkUtils.getI18nJSUrl("translation")],(function(){var e=I18n.getMsg("crm.translation.sandbox.import.popup.header"),t=I18n.getMsg("crm.translation.sandbox.import.popup.new.button"),i='<div class="yellowNotesDeployChanges">'+I18n.getMsg("crm.translation.sandbox.import.popup.translation"),o='<ul class="deploymentSuccessItems"><li class="deploymentSuccessList">'+I18n.getMsg("crm.translation.sandbox.import.popup.content1"),n='</li><li class="deploymentSuccessList">'+I18n.getMsg("crm.translation.sandbox.import.popup.content2")+"</li></ul></div>";!(window.location.href.indexOf("sandbox/deployments-logs")>-1)&&window.location.href.indexOf("sandbox/")>-1&&($("#Division").html(e+i+o+n+t).show(),sandbox.translationFileDeploy=!0)}))}else if("Stickies"===s)crmStickies.handleCustomMessage(e);else if("updateHoldStatus"===e.type)ctiApiNotifier.holdNotify();else if("bestTimeReminder"===s)crmBstTime.showReminderPushNotification(e);else if("dismissBestTimeReminder"===s)crmBstTime.dismissReminderPushNotificaiton(e);else if("MultiCurrency"===s)Crm.userDetails.CURRENCY_DETAILS=e.currencyDetailsJSON,e.baseCurrency&&(Crm.userDetails.BASE_CURRENCY=e.baseCurrency);else if("recordLevelSharing"===s){var Wt=JSON.parse(e.message);$ESAPI.encoder().encodeForHTMLAttribute(Wt.module);"success"===Wt.status&&(Wt.linkMsg="crm.schedules.viewCusInfo",Wt.link=!0),store.findRecord(moduleRecordMapping[Wt.module].id,Wt.id).then((function(e){e[0].$canvas_id&&(Wt.canvasid=e[0].$canvas_id),crmSchedulerNotification.addOrUpdateStatus(Wt,I18n.getMsg("crm.rls.popup.title"))}),(function(){crmSchedulerNotification.addOrUpdateStatus(Wt,I18n.getMsg("crm.rls.popup.title"))}))}else if("Data Sharing rules"===s){var Kt=["sharingRulesRecalculate_"+(Wt=JSON.parse(e.message)).module,"sharingRulesNew_"+Wt.module],qt=Kt.length,Gt=$(".sharingRuleActions_"+Wt.module);if("success"===Wt.status||"error"===Wt.status){var Zt=$(".sharingRuleActions_"+Wt.module+".neweditIcon"),Yt=$(".sharingRuleActions_"+Wt.module+".deleteIcon"),Xt=[];for(A=Zt.length,w=0;w<A;w++)Xt[w]=Zt.eq(w).data("ruleid"),Gt.removeClass("disableSharing").removeAttr("onmouseenter onmouseleave"),crmui.hideTooltip(),Zt.eq(w).attr("href","javascript:editShareRule('"+Xt[w]+"','"+Wt.module+"')"),Yt.eq(w).attr({href:"javascript:delShareRule('"+Xt[w]+"','"+Wt.module+"')",onclick:"return window.confirm('"+I18n.getMsg("crm.label.confirm.message.del.data.sharing.rule",Wt.singular_label)+"')"});for(w=0;w<qt;w++)$("#"+Kt[w]).removeClass("disabled").removeAttr("onmouseenter onmouseleave"),crmui.hideTooltip();$("#"+Kt[0]).attr({onclick:"UserModule.showSharingRulePopUp('"+Wt.id+"','"+Wt.displayModuleName+"')"}),$("#"+Kt[1]).attr("onclick","newSharingRule('"+Wt.module+"')")}$ESAPI.encoder().encodeForHTMLAttribute(Wt.module);dsNotificationScheduler.addOrUpdateSchedulerStatus(Wt,I18n.getMsg("crm.security.sharing.rules.popup.title"),e.rulesDetails)}else if("PFExtInstallTask"===e.type)try{"undefined"==typeof PluginNotification?networkUtils.loadFeatureScripts(["pluginNotification-lib.js"],(function(){PluginNotification.handlePluginDetailPageNotification(e)})):PluginNotification.handlePluginDetailPageNotification(e)}catch(e){try{murphy.error(e)}catch(e){}}else if("relatedRecordChangeOwner"===s){if((Wt=JSON.parse(e.message)).action&&"AutomationProcess"!=Wt.action){$ESAPI.encoder().encodeForHTMLAttribute(Wt.module);$("#picklist_pop_progress").remove(),crmSchedulerNotification.addOrUpdateStatus(Wt,I18n.getMsg("crm.changeOwner.relatedRecord.scheduler.popup.title"))}}else if("UserDatePattern"===s)Crm.userDetails.DATE_PATTERN=e.DatePattern;else if("data-storage"===s){var Qt=Lyte.Router.getRouteInstance();"storage"===Qt.routeName&&"file"!==Qt.getQueryParams().type&&Qt.refresh({refreshTemplate:!0})}else if("profileDeletion"===s){Wt=JSON.parse(e.message);crmSchedulerNotification.addOrUpdateStatus(Wt,I18n.getMsg("crm.profile.transfer.delete.status"))}else if("roleDeletion"===s){Wt=JSON.parse(e.message);crmSchedulerNotification.addOrUpdateStatus(Wt,I18n.getMsg("crm.role.transfer.delete.status"))}else if("FieldUpdateOperationProgress"===s){S=Lyte.Router.getRouteInstance().parent.getDynamicParam();var ei=JSON.parse(e.message);if(S===ei.entityID&&"id"!==S){if("crm.tab.module.entity.canvas"===(ai=Lyte.Router.getRouteInstance().transition.info).route){var ti=(si=$("crm-detailview-canvas")[0])?si.component:void 0,ii=ai.dynamicParams[0],oi=ai.dynamicParams[1];if(((ri=ei.jArray)?ri.length:0)>0)app.store.makeRequest("findRecord",moduleRecordMapping[ii].id,oi,{approved:"both",converted:"both",formatted_currency:!0,home_converted_currency:!0}).then((function(e){ti.setData("record",objectUtils.cloneObject(e[0])),Lyte.registeredMixins["crm-detailcanvas-utils"].executelayoutRuleforCurrentRec(),Lyte.registeredMixins["crm-detailcanvas-utils"].validatingCanvasRule(moduleApiMapping[si.getData("module")],e[0])}))}detailView.mergeJSon(detailView.dateTimeFormat,ei.dateTimeFormat),detailView.mergeJSon(detailView.updateMap,ei.updateJsonObj),detailView.mergeJSon(detailView.currency,ei.updatelookupJsonObj),detailView.mergeJSon(detailView.cfDatefield,ei.cfDatefield),detailView.entityID=ei.entityID,detailView.phoneField=ei.phoneField,detailView.mergeJSon(detailView.hreFJson,ei.hreFJson),detailView.fieldUpdateJson=detailView.fieldUpdateJson.concat(ei.jArray),detailView.FieldUpdateAvailable=!0,detailView.mergeJSon(detailView.currency,ei.currency),detailView.Currmodule=ei.module,detailView.isPopShown=ei.popupShown;var ni=!1;null!=ai&&null!=ai.queryParams&&"Tasks"==ai.queryParams.sub_module&&"Activities"==detailView.Currmodule&&(ni="create"==window.Tasks.currentStatus),ni=document.domain.indexOf("localzoho.com")>0,setTimeout((function(){detailView.updateField(),detailView.body=ei.scoreBody,detailView.layoutId=ei.layOutId,setTimeout((function(){detailView.updateScoreField()}),1e3)}),ni?3e3:2e3)}}else if("DelugeAvilable"===s){ei=JSON.parse(e.message);detailView.isDelugeAvailable=ei.isDeleugeAvailable}else if("delugeFieldUpdate"===s){S=Lyte.Router.getRouteInstance().parent.getDynamicParam(),ei=JSON.parse(e.message);if(S===ei.entityID&&"id"!==S){var ai;if("crm.tab.module.entity.canvas"===(ai=Lyte.Router.getRouteInstance().transition.info).route){var si,ri;ti=(si=$("crm-detailview-canvas")[0])?si.component:void 0,ii=ai.dynamicParams[0],oi=ai.dynamicParams[1];if(((ri=ei.delugefiledUpdateArray)?ri.length:0)>0&&ti)app.store.makeRequest("findRecord",moduleRecordMapping[ii].id,oi,{approved:"both",converted:"both",formatted_currency:!0,home_converted_currency:!0}).then((function(e){ti.setData("record",objectUtils.cloneObject(e[0])),Lyte.registeredMixins["crm-detailcanvas-utils"].executelayoutRuleforCurrentRec(),Lyte.registeredMixins["crm-detailcanvas-utils"].validatingCanvasRule(moduleApiMapping[si.getData("module")],e[0])}))}if(detailView.mergeJSon(detailView.dateTimeFormat,ei.dateTimeFormat),detailView.fieldUpdateJson=detailView.fieldUpdateJson.concat(ei.delugefiledUpdateArray),detailView.mergeJSon(detailView.updateMap,ei.updateJsonObj),detailView.mergeJSon(detailView.cfDatefield,ei.cfDatefield),detailView.phoneField=ei.phoneField,detailView.mergeJSon(detailView.hreFJson,ei.hreFJson),detailView.Currmodule=ei.module,detailView.entityID=ei.entityID,detailView.isPopShown=ei.popupShown,detailView.mergeJSon(detailView.currency,ei.currency),detailView.FieldUpdateAvailable||detailView.updateField(),CFRExec.relatedEntityMap){var li=ei.updateJsonObj;for(var di in li)CFRExec.relatedEntityMap.hasOwnProperty(di)&&returnJson.entityMapJson.hasOwnProperty(di)&&(CFRExec.relatedEntityMap[di].defaultvalue=returnJson.entityMapJson[di].defaultvalue)}}}else if("MasConvert"===s)ei=JSON.parse(e.message);else if("Forecast"===s){var ci=Lyte.Router.getRouteInstance();if("Forecast_Create"===e.type){Ot=e.message.split("::::");"crm.tab.newForecasts.create"!==ci.transition.target&&"crm.tab.newForecasts.clone"!==ci.transition.target||Ot[0]!==ci.currentModel.record.Forecast_Group.Forecast_Group_Name||Ot[1]!==ci.currentModel.record.Period_Name.id?"crm.tab.newForecasts.bread-crum"!==ci.transition.target&&"crm.tab.newForecasts.list"!==ci.transition.target||!$("#"+Ot[2]).length||ci.refresh():Lyte.Router.transitionTo({route:"crm.tab.newForecasts.view",dynamicParams:[Ot[2]]}).data={fromCreate:!0}}else if("Forecast_Refresh"===e.type&&"crm.tab.newForecasts.view"===ci.transition.target&&e.message===ci.getDynamicParam()){Ot={reloadAll:!0};ci.refresh().data=Ot}else"list"===ci.routeName&&ci.getPredictionData({field:{api_name:"Forecast_Name.id"},comparator:"equal",value:e.forecast_id}).then((function(){for(var t=$L("crm-forecast-list-table"),i=t.length,o=0;o<i;o++){t[o].getData("forecasts").filter((function(t){return t.id===e.forecast_id||t.baseId===e.forecast_id})).forEach((function(e){var t=ci.filterPredictedData(e._parent_item_ids?store.peekRecord("forecast_data",e._parent_item_ids[0]):e.forecast_data);t&&Lyte.objectUtils(e.Forecast_result,"add","predicted_data",{amount:null!==t.Amount?t.Amount:t.Quantity,currency:null!==t.Amount?t.Amount.toString():t.Quantity.toString()})}))}}))}else if("widgetDataRefresh"===s){if((Ot=e.data).hasOwnProperty("component")&&(void 0===Crm.refWidAssocComp&&(Crm.refWidAssocComp={}),"custom_button"===Ot.component))Crm.refWidAssocComp={custom_button:!0}}else"liteUserCountUpdate"===s?Crm.userDetails.LITE_USERS_COUNT=e.count:"NewForecastMigration"===s&&Lyte.Router.getRouteInstance().transition.target.includes("crm.tab.forecast")&&location.reload();else{var pi=window.location.pathname,ui=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/settings/migration");if(void 0!==e.sourcesystem&&"sample"==e.sourcesystem.toLowerCase()?($("#mig_notification .titleFromToLogo").removeClass("dIB").addClass("dN"),networkUtils.loadFeatureScripts(["zohocrm_import.js",networkUtils.getI18nJSUrl("import")],(function(){if(globalSetpJson){var t=JSON.parse(globalSetpJson);if("migrationAfterCompleteNotification"===s){for(i in t)if(null!=t[i]["Data Administration"]){t[i]["Data Administration"][0].array[2].array[0].setupShow=!0,t[i]["Data Administration"][0].array[2].array[0].migrationId=e.migrationId;break}globalSetpJson=JSON.stringify(t)}else if("rollback"===s){var i;for(i in t)if(null!=t[i]["Data Administration"]){t[i]["Data Administration"][0].array[2].array[0].setupShow=!1;break}globalSetpJson=JSON.stringify(t)}}$("#mig_notification .titleFromToLogo").removeClass("dIB").addClass("dN")}),"object"==typeof Import)):$("#mig_notification .titleFromToLogo").removeClass("dN").addClass("dIB"),pi.startsWith(ui)||"sampleDataMigrationInitiated"!==s&&"migrationUploadComplete"!==s&&"migrationAfterCompleteNotification"!==s&&"migrationAborted"!==s&&"rollback"!==s)"undefined"!=typeof migrate&&migrate.handleWmSMessages(s,e);else{if(e.migrationId&&"rollback"!=s&&(ui+="/"+e.migrationId),e.migrationID&&"rollback"!=s&&(ui+="/"+e.migrationID),e.sourcesystem){var mi=$("#mig_notification .fromSrc"),hi=$("#migZohoCrmLogo");switch(hi.addClass("dN"),mi.removeClass("dN contactManagerLogo logo-crm logo-sf migOtherZohoLogo highRiseLogo pipeDriveLogo inSightlyLogo hubspotlogo logo-msdynamics maximizerCrmLogo"),e.sourcesystem.toLowerCase()){case"salesforce":mi.addClass("logo-sf");break;case"msdynamics":mi.addClass("logo-msdynamics");break;case"zoho":mi.removeClass("dIB").addClass("dN"),hi.removeClass("dN");break;case"highrise":mi.addClass("highRiselogo");break;case"pipedrive":mi.addClass("pipeDriveLogo");break;case"hubspot":mi.addClass("hubspotlogo");break;case"insightly":mi.addClass("inSightlyLogo");break;case"zcontactmanager":case"zohocontactmanager":mi.addClass("contactManagerLogo");break;case"others":mi.addClass("migOtherZohoLogo");break;case"maximizer":mi.addClass("maximizerCrmLogo")}}var Pt="";if("migrationUploadComplete"===s)Pt=I18n.getMsg("crm.migration.extraction.complete");else if("migrationAfterCompleteNotification"===s)Pt=I18n.getMsg("crm.migration.complete.wms.msg"),"sample"==e.sourcesystem.toLowerCase()&&(Pt=I18n.getMsg("cob.sampledata.migration.completed"),$("#migCardTitleLabel").text(I18n.getMsg("cob.sampledata.population")),Crm.trackSpotLightAction("COB BlankPage - Sample Data Completed"),Crm.client_tracking("COB BlankPage - Sample Data Completed"));else if("migrationAborted"===s)Pt=I18n.getMsg("crm.migration.aborted.wms.msg");else if("sample"!=e.sourcesystem.toLowerCase()||"updateMigrationProgressForFile"!==s&&"sampleDataMigrationInitiated"!==s){if("rollback"===s)if("sample"==e.sourcesystem.toLowerCase())Pt=I18n.getMsg("crm.sampledata.rollback.wms.msg"),$("#migCardTitleLabel").text(I18n.getMsg("crm.sampledata.rollback.wms.title")),crmTab.cacheObj={};else{var fi=e.moduleName;moduleRecordMapping[e.moduleName]&&(fi=I18n.getMsg(moduleRecordMapping[e.moduleName].plural_label)),Pt="Module"===e.type?I18n.getMsg("crm.migration.rollback.module.wms.msg",[fi,e.sourcesystem]):I18n.getMsg("crm.migration.rollback.wms.msg",e.sourcesystem)}}else $("#migCardTitleLabel").text(I18n.getMsg("cob.sampledata.population")),Pt=I18n.getMsg("cob.sample.data.population.progress"),Crm.trackSpotLightAction("COB BlankPage - Sample Data InProgress"),Crm.client_tracking("COB BlankPage - Sample Data InProgress");var gi=$("#mig_notification");if(gi.find("#migShowBtnText, #migShowLinkText").addClass("dN"),"sample"!=e.sourcesystem.toLowerCase()){var vi;if("rollback"!==s)(vi=gi.find("#migShowBtnText")).removeClass("dN"),vi.attr("onclick","$('#mig_notification').css({bottom:'-100%'});window.open('"+ui+"');");else(vi=gi.find("#migShowLinkText")).removeClass("migCardLink dN"),vi.css({cursor:"default"});vi.text(Pt)}else{var yi=gi.find("#migShowLinkText");yi.addClass("col333").removeClass("migCardLink"),yi.closest("div").eq(0).removeClass("cP"),yi.text(Pt).removeClass("dN")}$("#IMPORTNOTIFICATIONPOP1").is(":visible")&&importHistory&&importHistory.closeSuccessContainer($("#IMPORTNOTIFICATIONPOP1 .migCardClose")),gi.css({bottom:"28px",transition:"bottom 1s ease"}).show()}}else document.getElementById("unreadMailIds").value=e.idlist,"none"==document.getElementById("newMailCount").style.display||$("#newMailCount").hasClass("dN")?(document.getElementById("newMailCount").style.display="block",document.getElementById("newMailCount").innerHTML=e.newMailCount):document.getElementById("newMailCount").innerHTML=parseInt(document.getElementById("newMailCount").innerHTML)+e.newMailCount,document.title="("+document.getElementById("newMailCount").innerHTML+")"+originaltitle,document.getElementById("recentMailsDiv")&&"none"!=document.getElementById("rmListViewDiv").style.display&&showRecentMails(),crmplusImplTriggerActions("setNotificationCount",["mailbox",e.newMailCount]);else CrmIntelligence.notifyOnWms(e.notificationJson);else Crm.userDetails.MPL_MIGRATION_COMPLETED=e.isMigrationCompleted;else e.deployedFromSandbox?Crm.updatePermission(e.Moduledata):Crm.moduleInfo="object"==typeof e.Moduledata?e.Moduledata:JSON.parse(e.Moduledata)}},Collaboration.handleCrossProductMessage=function(e,t){if(Crm.isWMSNotifictionForCurrentOrg(t)&&("CA"===e&&t&&t.fromEditorSave&&Lyte.triggerEvent("ZCTemplateSave",t.zcampaignid),t.module&&"LiveDesk"==t.module&&networkUtils.loadFeatureScripts(["zohocrm_visitshome.js"],(function(){CrmTracking.handleVisit(t),crmNTCWms.updateEntityStatus()})),t)){"string"==typeof t&&(t=JSON.parse(t));var i=null;for(var o in t)if(t.hasOwnProperty(o)){var n=t[o];if(n&&"string"==typeof n&&n.startsWith("BATCH_")){i=n;break}}if(i){var a=$("#"+i).data(i);a&&a(t)}}},Collaboration.onConnect=function(){},Collaboration.openURL=function(e,t,i,o){return!0},Collaboration.handleCollabAdd=function(e,t,i,o,n){},Collaboration.handleCollabDelete=function(e,t,i,o,n){},Collaboration.handleUserAdd=function(e,t){},Collaboration.handleUserDeleted=function(e,t){},Collaboration.handleIsOnline=function(e){},Collaboration.goOffline=function(){},Collaboration.wmsOffline=function(){},Collaboration.handleLanguageChange=function(e){"skyDesk"===Crm.brandName&&Utils.windowLocationReload(!0)};var Notifier={slider:new slide,statusQueue:new Array,notifiertimer:null,notify:function(e){var t=document.getElementById("ztinotifier");if(Notifier.slider.setObjName("slider"),"block"!==t.style.display){t.style.display="block";try{t.style.zIndex=WindowHandler.zoom+5}catch(e){}Notifier.construct(e);Notifier.slider.setHeightParams(0,105,0,0),Notifier.slider.down("ztinotifier")}else Notifier.statusQueue.push(e)},close:function(){Notifier.slider.setObjName("slider"),"block"===document.getElementById("ztinotifier").style.display&&(Notifier.slider.finishShrinkWith("Notifier.hide()"),Notifier.slider.up("ztinotifier"))},clear:function(){null!==Notifier.notifiertimer&&void 0!==Notifier.notifiertimer&&(clearTimeout(Notifier.notifiertimer),Notifier.close())},hide:function(){if(document.getElementById("ztinotifier").style.display="none",Notifier.statusQueue.length>0){var e=Notifier.statusQueue.splice(0,1);Notifier.notify(e)}},construct:function(e){var t=document.getElementById("ztinotifier");$(t).empty(),t.innerHTML=e}},ztiNotifier={ztiCallNotification:function(e){var t=e.calltype;Notifier.close();var i='<table width="95%" cellpadding="0" cellspacing="0" style="background-color: #fff7dd;border: 1px solid #f8a300; padding-bottom:5px; padding-left:5px; font-size:1.1rem;"><tr><td style="text-align:right;"><span style="font-weight:bold; cursor:pointer;" onClick="Notifier.close()" title="Close">[X]</span></td></tr><tr><td style="padding-right:5px;"><div  style="margin-right:15px;"><div style="float:left;"><img src="'+networkUtils.getImageUrl("phone_zti_8003949_.gif",ResourceConstants.CRM)+'" align="absbottom" /></div><div style="float:right;"></div>',o=e.opr,n=e.isContact,a=Crm.getCrmBasePath()+"/ShowEntityInfo.do?module="+e.crmmodule+"&id="+e.id+"&isload=true";if(!0===n||"true"===n){var s="",r="";"null"===e.callthru&&null===e.callthru||void 0===e.callthru||(r=t&&"incoming"===t?'<div><label style="text-align:left; margin-left:20px;"> '+e.callthru+" : </label><b>"+e.fromNumber+"</b></div>":'<div><label style="text-align:left; margin-left:20px;"> '+e.callthru+" : </label><b>"+e.toNumber+"</b></div>"),"null"===e.email&&null===e.email||void 0===e.email||""===e.email||(s='<div><label style="text-align:left; margin-left:20px;">Email : </label><b>'+e.email+"</b></div>"),"newcall"===o&&"incoming"===t?i+='<div style="float:left;"><div><label style="text-align:left; margin-left:20px;"> Incoming call from </label><b><a href="'+a+'" target="_blank">'+e.entityName+"</a></b></div>"+s+r:"newcall"===o&&"outgoing"===t?i+='<div style="float:left;"><div><label style="text-align:left; margin-left:20px;"> Calling </label><b><a href="'+a+'" target="_blank">'+e.entityName+"</a></b></div>"+s+r:"handlenewcall"===o?i+='<div style="float:left;"><div><label style="text-align:left; margin-left:20px;"> Incoming call from </label><b><a href="'+a+'" target="_blank">'+e.entityName+"</a></b></div>"+s+r:"callconnected"===o?i+='<div style="float:left;"><div><label style="text-align:left; margin-left:20px;"> Call Connected to </label><b><a href="'+a+'" target="_blank">'+e.entityName+"</a></b></div>"+s+r:"callended"===o&&"outgoing"===t?i+='<div style="float:left;"><div><label style="text-align:left; margin-left:20px;">Call to </label><b><a href="'+a+'" target="_blank">'+e.entityName+"</a> is Ended</b></div>"+s+r:"callended"===o&&"incoming"===t&&(i+='<div style="float:left;"><div><label style="text-align:left; margin-left:20px;">Call from </label><b><a href="'+a+'" target="_blank">'+e.entityName+"</a> is Ended</b></div>"+s+r),i+='<div style="margin-left:20px"><b><a target="_blank" href="'+(Crm.getCrmBasePath()+"/Create.do?module=Calls&id="+e.id+"&relmodule="+e.crmmodule+"&pop=pop&calltype="+t)+'">Log the Call.</a></b></div>',i+="</div>"}else"newcall"===o?i+="outgoing"===t?'<div style="float:left;"><div><label style="text-align:left; margin-left:20px;"> Outgoing call to <b>'+e.toNumber+"</b></div>":'<div style="float:left;"><div><label style="text-align:left; margin-left:20px;"> Incoming call from <b>'+e.fromNumber+"</b></div>":"handlenewcall"===o?i+='<div style="float:left;"><div><label style="text-align:left; margin-left:20px;"> Incoming call from <b>'+e.fromNumber+"</b></div>":"callconnected"===o?i+='<div style="float:left;"><div><label style="text-align:left; margin-left:20px;"> Call Connected to </label><b>'+e.toNumber+"</b></div>":"callended"===o&&"outgoing"===t?i+='<div style="float:left;"><div><label style="text-align:left; margin-left:20px;">Call to </label><b>'+e.toNumber+" is Ended</b></div>":"callended"===o&&"incoming"===t&&(i+='<div style="float:left;"><div><label style="text-align:left; margin-left:20px;">Call from </label><b>'+e.fromNumber+" is Ended</b></div>"),i+="</div>";i+="</td></tr></table>",Notifier.notify(i)}},_acsop=/opera|opera 5|opera\/5/i.test(navigator.userAgent),_acsie=!_acsop&&/msie/i.test(navigator.userAgent),_acsextn=".acs",_acscontext="/crm",AcsApi={NotificationTypes:{ALL:1,ATMENTIONED:2,FLAGGED:3,PROJECTBASED:4}},AcsCallBack={};if(null==AcsResource)var AcsResource={};function Activity(e){this._jobj=e;var t=e.comments;if(this.comments=new Array,null!=t)for(var i=void 0!==window[this._jobj.prd].Comment,o=t.length-1;o>=0;o--)i?this.comments.push(new window[this._jobj.prd].Comment(new Comment(t[o]))):this.comments.push(new Comment(t[o]));this.getAOwner=function(){return this._jobj.aowner},this.getLAOwner=function(){return this._jobj.laowner},this.getASUsers=function(){return this._jobj.asusers},this.getCFUsers=function(){return this._jobj.cfusers},this.getLAType=function(){return this._jobj.latype},this.getLATitle=function(e,t){if(null!=this._jobj.latitle)return AcsApi.localizeI18NString(this._jobj.latitle,this._jobj.prd,e,t)},this.getPrd=function(){return this._jobj.prd},this.getAccFrom=function(){return this._jobj.accFrom},this.isAccFromMobile=function(){return null!=this._jobj.accFrom&&("IOS"==this._jobj.accFrom||"AND"==this._jobj.accFrom)},this.isPrivate=function(){return this._jobj.private},this.getFDK=function(){return this._jobj.fdk},this.getSkey=function(){return this._jobj.skey},this.getTitle=function(e,t){return AcsApi.localizeI18NString(this._jobj.title,this._jobj.prd,e,t)},this.getType=function(){return this._jobj.type},this.getContent=function(){return this._jobj.contents},this.getTime=function(){return this._jobj.time},this.getTotalComments=function(){return this._jobj.tccount},this.getPoll=function(){return this._jobj.poll},this.getPollResult=function(){return this._jobj.pollresult},this.hasLikes=function(){try{return null!=this._jobj.poll.LIKE.like}catch(e){return!1}},this.getLikesCount=function(){try{return this._jobj.pollresult.LIKE.like}catch(e){}return 0},this.getComments=function(){return this.comments},this.getCMore=function(){return this._jobj.cmore},this.getAdditionalProperty=function(e){return this._jobj["ap_"+e]},this.getAdditionalPropertyStartsWith=function(e){var t={};for(var i in this._jobj)0==i.indexOf("ap_"+e)&&(t[i.replace("ap_","")]=this._jobj[i]);return t}}function ACSActivityException(e,t){this._prd=e,this._err=t,this.getErrorTitle=function(){if(null!=this._err.title)return AcsApi.localizeI18NString(this._err.title,this._prd)},this.getErrorMessage=function(){if(null!=this._err.message)return AcsApi.localizeI18NString(this._err.message,this._prd)},this.getAdditionalProperty=function(e){return this._err["ap_"+e]}}function Comment(e){this._cmt=e,this.getType=function(){return this._cmt.type},this.getAccFrom=function(){return this._cmt.accFrom},this.isAccFromMobile=function(){return null!=this._cmt.accFrom&&("IOS"==this._cmt.accFrom||"AND"==this._cmt.accFrom)},this.getCkey=function(){return this._cmt.ckey},this.getCFDK=function(){return this._cmt.cfdk},this.getAt=function(){return this._cmt.at},this.getContent=function(){return this._cmt.contents},this.getPostedBy=function(){return this._cmt.by},this.getAdditionalProperty=function(e){return this._cmt["ap."+e]}}function UnsNotification(e,t){this.prd=t,this._ntfn=e,this.getType=function(){return this._ntfn.type},this.getActionOwner=function(){return this._ntfn.aowner},this.getRepeatCount=function(){return this._ntfn.repCount},this.getRepeatUsers=function(){return this._ntfn.repUsers},this.getTime=function(){return this._ntfn.time},this.getSublist=function(){for(var e=this._ntfn.sublist||[],t=[],i=0,o=e.length;i<o;i++)t.push(new UnsNotification(e[i],this.prd));return t},this.isNew=function(){return null!=this._ntfn.isNew&&this._ntfn.isNew},this.getAccFrom=function(){return this._ntfn.accFrom},this.isAccFromMobile=function(){return null!=this._ntfn.accFrom&&("IOS"==this._ntfn.accFrom||"AND"==this._ntfn.accFrom)},this.getInfo=function(e,t){return AcsApi.localizeI18NString(this._ntfn.info,this.prd,e,t)},this.getAdditionalProperty=function(e){return this._ntfn["ap_"+e]},this.getSkey=function(){return this._ntfn.skey},this.getProperty=function(e){return this._ntfn[this.getType()+"."+e]}}function PollResult(e){this._presult=e,this.getFDK=function(){return this._presult.fdk},this.getType=function(){return this._presult.type},this.getPrd=function(){return this._presult.prd},this.getPollName=function(){return this._presult.poll},this.getVotes=function(){return this._presult.votes}}function AcsConnect(){}AcsApi.isMobile=function(){try{if(navigator&&navigator.userAgent)return navigator.userAgent.match(/iphone|ipod|iphone/i)||navigator.userAgent.match(/Android/i)}catch(e){return!1}},AcsApi.init=function(e,t,i){AcsApi.renderProgressive=!0,AcsApi.viewlist=new Object,AcsResource.init(),AcsApi.prd=e,AcsApi.csrfParam=t,AcsApi.csrfCookieName=i,AcsApi.isMobile()&&(AcsApi.renderProgressive=!1)},AcsApi.getCSRF=function(){return AcsApi.csrfParam+"="+AcsUtil.Cookie.getCustomCookie(AcsApi.csrfCookieName)},AcsApi.getCkey=function(){return null!=AcsApi.ckey||null!=AcsUtil.getPrd()&&(AcsApi.ckey=AcsUtil.getPrd()+"_DNFY"),AcsApi.ckey},AcsApi.handleServerUP=function(){for(viewKey in AcsDesktopNotification.isOwner()&&AcsDesktopNotification.setOwnerCookie(AcsApi.getCkey(),AcsUtil.getRawSid(),1e4),AcsApi.viewlist)AcsApi.autoCorrect(viewKey);try{window[AcsApi.prd].onAcsConnect()}catch(e){}},AcsApi.handleServerDown=function(){try{window[AcsApi.prd].onAcsDisconnect()}catch(e){}},AcsApi.initStream=function(e,t,i){var o="viewkey="+encodeURIComponent(t),n={viewkey:t,prd:e};null!=i&&(o=o+"&count="+i),AcsApi.renderProgressive?(o+="&progressive=true",AcsConnect.httpProgressive("initprogressivestream",_acscontext+"/viewdata"+_acsextn,o,n)):AcsConnect.httpPost("initstream",_acscontext+"/viewdata"+_acsextn,o,n)},AcsApi.getComments=function(e,t,i,o,n,a){var s="viewkey="+encodeURIComponent(e)+"&skey="+encodeURIComponent(t)+"&fdk="+encodeURIComponent(i)+"&cmore="+encodeURIComponent(o),r={viewkey:e,skey:t,fdk:i,cmore:o,satt:a};null!=n&&(s=s+"&count="+n),AcsConnect.httpPost("getcomments",_acscontext+"/getcomment"+_acsextn,s,r)},AcsApi.showMore=function(e,t,i){if(null==AcsApi.viewlist[t])throw new Error("ViewKey not initialized, Call initStream");var o=AcsApi.viewlist[t].morekey;if(null==o)throw new Error("No data available in the server for this view Key");var n="viewkey="+encodeURIComponent(t)+"&morekey="+encodeURIComponent(o);null!=i&&(n=n+"&count="+i);var a={viewkey:t,prd:e};AcsApi.renderProgressive?(n+="&progressive=true",AcsConnect.httpProgressive("showmoreprogressive",_acscontext+"/smdata"+_acsextn,n,a)):AcsConnect.httpPost("showmore",_acscontext+"/smdata"+_acsextn,n,a)},AcsApi.isMoreAvailable=function(e){try{return null!=AcsApi.viewlist[e].morekey}catch(e){return!0}},AcsApi.autoCorrect=function(e){if(null!=e){var t=AcsApi.viewlist[e].skey;if(null!=t){var i="viewkey="+encodeURIComponent(e)+"&skey="+encodeURIComponent(t)+"&count=25",o={viewkey:e,prd:AcsApi.viewlist[e].prd};AcsConnect.httpPost("autocorrect",_acscontext+"/autocorrect"+_acsextn,i,o)}}},AcsApi.timeline=function(e,t,i,o,n,a,s){if(null!=t){var r="viewkey="+encodeURIComponent(t)+"&count="+i,l={viewkey:t,prd:e,name:o};null!=n&&(r=r+"&start="+n,l.start=n),null!=a&&(r=r+"&end="+a,l.end=a),null!=s&&(r=r+"&skey="+encodeURIComponent(s)),AcsConnect.httpPost("timeline",_acscontext+"/timeline"+_acsextn,r,l)}},AcsApi.getBadgeCount=function(e,t){if(null!=e){var i="nfchannel="+encodeURIComponent(e),o={};null!=t&&(o.smsg=t),AcsConnect.httpPost("getbadge",_acscontext+"/getbadge"+_acsextn,i,o)}},AcsApi.getCrossProductBadgeCount=function(e){var t={};null!=e&&(t.smsg=e),AcsConnect.httpPost("getcpnbadge",_acscontext+"/getcpnbadge"+_acsextn,"nfchannel=CPN",t)},AcsApi.getNotificationList=function(e,t,i,o,n,a,s,r){if(null!=e){null==t&&(t="30");var l="nfchannel="+encodeURIComponent(e)+"&count="+t,d=!1,c=!1,p=!1,u={};o&&(u.renderType=o),null!=i&&(u.renderType="more",l=l+"&morekey="+encodeURIComponent(i),null!=n&&(l=l+"&lbrtime="+n)),null!=a&&(l=l+"&sublist="+a),s==AcsApi.NotificationTypes.ATMENTIONED?d=!0:s==AcsApi.NotificationTypes.FLAGGED?c=!0:s==AcsApi.NotificationTypes.PROJECTBASED&&(p=!0),l=l+"&ismentioned="+d+"&isflaged="+c+"&isScoped="+p,null!=r&&(l=l+"&scope="+r),AcsConnect.httpPost("getntfnlist",_acscontext+"/getntfnlist"+_acsextn,l,u)}},AcsApi.getUnReadNotificationList=function(e,t,i,o,n,a,s,r){if(null!=e){null==t&&(t="30");var l="nfchannel="+encodeURIComponent(e)+"&count="+t,d=!1,c=!1,p=!1,u={};o&&(u.renderType=o),null!=i&&(u.renderType="more",l=l+"&morekey="+encodeURIComponent(i),null!=n&&(l=l+"&lbrtime="+n)),null!=a&&(l=l+"&sublist="+a),s==AcsApi.NotificationTypes.ATMENTIONED?d=!0:s==AcsApi.NotificationTypes.FLAGGED?c=!0:s==AcsApi.NotificationTypes.PROJECTBASED&&(p=!0),l=l+"&ismentioned="+d+"&isflaged="+c+"&isScoped="+p+"&isunread="+!0,null!=r&&(l=l+"&scope="+r),AcsConnect.httpPost("getntfnlist",_acscontext+"/getntfnlist"+_acsextn,l,u)}},AcsApi.resetBadgeCount=function(e){if(null!=e){var t="nfchannel="+encodeURIComponent(e);AcsConnect.httpPost("resetbadge",_acscontext+"/resetbadge"+_acsextn,t)}},AcsApi.invoke=function(e,t,i,o,n,a,s){var r={viewkey:t,prd:e,fdk:i,type:o,action:n};if(null!=s){s.action=_acscontext+"/invoke"+_acsextn,s.target="acsif_"+i;var l,d=document.createElement("IFRAME");for(var c in d.name="acsif_"+i,d.style.display="none",d.onload=function(){AcsConnect.handleHttpPost("invoke",this.contentWindow.document.body.innerHTML,r)},r.restype="html",r){var p=document.createElement("INPUT");p.type="hidden",p.name=c,p.value=r[c],s.appendChild(p)}s.appendChild(d),(l=document.createElement("INPUT")).type="hidden",l.name="data",l.value=JSON.stringify(a),s.appendChild(l),(l=document.createElement("INPUT")).type="hidden",l.name=AcsApi.csrfParam,l.value=AcsUtil.Cookie.getCustomCookie(AcsApi.csrfCookieName),s.appendChild(l),s.submit()}else{var u="restype=json&type="+o+"&fdk="+encodeURIComponent(i)+"&action="+n+"&data="+encodeURIComponent(JSON.stringify(a));AcsConnect.httpPost("invoke",_acscontext+"/invoke"+_acsextn,u,r)}},AcsApi.handlePush=function(e,t){var i=t.module,o=t.uns,n=t.cpn;if(null!=o)if(o.ntfn)try{var a=new UnsNotification(o.ntfn,o.prd);AcsCallBack.handleNotification(o.prd,o.badgeCount,a)}catch(e){}else AcsCallBack.handleNotification(o.prd,o.badgeCount);if(null!=n)try{AcsCallBack.handleCrossProductNotification(n.prd,n.origin,n.badgeCount)}catch(e){}if("acs"==i)for(var s in t.viewlist)AcsCallBack.handlePushActivity(s,t.viewlist[s],t.activity);else if("poll"==i)try{for(var s in AcsCallBack.handlePushPollResult(void 0,void 0,t.pollresult),t.viewlist)AcsCallBack.handlePushPollResult(s,t.viewlist[s],t.pollresult)}catch(e){}else if("delete"==i)for(var s in t.viewlist)AcsCallBack.handlePushDelete(s,t.viewlist[s],t.deldetails)},AcsApi.handleCallBack=function(e,t,i){try{switch(e){case"initstream":AcsCallBack.handleInitStream(i.prd,i.viewkey,t.skey,t.morekey,t.sno,t.list);break;case"showmore":AcsCallBack.handleShowMore(i.prd,i.viewkey,t.morekey,t.list);break;case"autocorrect":AcsCallBack.handleAutoCorrect(i.prd,i.viewkey,t.skey,t.sno,t.list,t.reset,t.morekey);break;case"timeline":AcsCallBack.handleTimeline(i.prd,i.viewkey,i.name,i.start,i.end,t.list,t.morekey);break;case"getbadge":AcsCallBack.handleNotification(t.prd,t.uns,void 0,i.smsg);break;case"getcpnbadge":for(c in t.cpn)AcsCallBack.handleCrossProductNotification(t.prd,t.cpn[c].origin,t.cpn[c],i.smsg);break;case"getntfnlist":AcsCallBack.handleNotificationList(t.prd,t.ntfnlist,t.nfchannel,t.ntfnbadge,i.renderType,t.reset,t.morekey,t.lbrtime,t.ntfntype);break;case"resetbadge":AcsCallBack.handleNotification(t.prd,t.uns);break;case"invoke":AcsCallBack.handleInvoke(i.viewkey,i.prd,i.fdk,i.type,i.action,t);break;case"getcomments":AcsCallBack.handleGetComments(i.viewkey,t.fdk,t.cmore,t.prd,t.type,t.comments,t.tccount,i.satt)}}catch(e){throw e}},AcsApi.handleCallBackError=function(e,t,i){try{var o=new ACSActivityException(i.prd,t);if("invoke"===e)AcsCallBack.handleInvokeError(i.viewkey,i.prd,i.fdk,i.type,i.action,o)}catch(e){throw e}},AcsApi.handleProgressiveCallBack=function(e,t,i,o,n){try{switch(i){case"initprogressivestream":if("chunk"==t){var a=o;AcsCallBack.handleInitProgressiveStream(e,n.prd,n.viewkey,a.chunk,a.data)}else if("full"==t)for(var s=0;s<o.length;s++){a=o[s];AcsCallBack.handleInitProgressiveStream(0==s,n.prd,n.viewkey,a.chunk,a.data)}break;case"showmoreprogressive":if("chunk"==t){a=o;AcsCallBack.handleShowMoreProgressive(e,n.prd,n.viewkey,a.chunk,a.data)}else if("full"==t)for(s=0;s<o.length;s++){a=o[s];AcsCallBack.handleShowMoreProgressive(0==s,n.prd,n.viewkey,a.chunk,a.data)}}}catch(e){throw e}},AcsApi.localizeString=function(e,t){return AcsResource.getRealValue(e,t)},AcsApi.localizeI18NString=function(e,t,i,o){try{i=null==i?"":i;var n=!0;null!=o&&1==o&&(n=!1);var a=e;"string"==typeof e&&(a=JSON.parse(e));var s=a.iprops,r=new Array,l=0;for(d in s)if("object"==typeof s[d]){var c=s[d].defaultvalue;if(n){var p=window[t].I18NString.getString(s[d].type,s[d].props);""!=p&&null!=p&&(c=p)}r[l++]=c}return AcsResource.getRealValue(a.istr+i,r)}catch(e){}return e},AcsApi.setLocale=function(e,t){AcsResource.fetchResource(e,t)},AcsCallBack.handleInitProgressiveStream=function(e,t,i,o,n){if(e)try{window[t]._View.init(i)}catch(e){}if(null!=o)if("seq"==o)try{var a=new Activity(n),s=void 0!==window[a.getPrd()].Activity?new(window[a.getPrd()].Activity)(a):a;window[a.getPrd()][a.getType()].render("initstream",i,s,!0)}catch(e){}else if("meta"==o){var r={morekey:n.morekey,skey:n.skey,sno:n.sno,prd:t};if(AcsApi.viewlist[i]=r,"0"==n.size){try{window[t]._View.nodata(i)}catch(e){}return}try{window[t]._View.completed(i,n.size)}catch(e){}}},AcsCallBack.handleInitStream=function(e,t,i,o,n,a){var s={morekey:o,skey:i,sno:n,prd:e};AcsApi.viewlist[t]=s;try{window[e]._View.init(t)}catch(e){}if(0!=a.length){for(var r=0;r<a.length;r++)try{var l=new Activity(a[r]),d=void 0!==window[l.getPrd()].Activity?new(window[l.getPrd()].Activity)(l):l;window[l.getPrd()][l.getType()].render("initstream",t,d,!0)}catch(e){}try{window[e]._View.completed(t,a.length)}catch(e){}}else try{window[e]._View.nodata(t)}catch(e){}},AcsCallBack.handleGetComments=function(e,t,i,o,n,a,s,r){for(var l=new Array,d=void 0!==window[o].Comment,c=a.length-1;c>=0;c--)d?l.push(new window[o].Comment(new Comment(a[c]))):l.push(new Comment(a[c]));window[o][n].renderComments(e,t,i,l,s,r)},AcsCallBack.handleShowMoreProgressive=function(e,t,i,o,n){if(e)try{window[t]._View.initShowMore(i)}catch(e){}if(null!=o)if("seq"==o)try{var a=new Activity(n),s=void 0!==window[a.getPrd()].Activity?new(window[a.getPrd()].Activity)(a):a;window[a.getPrd()][a.getType()].render("showmore",i,s,!0)}catch(e){}else if("meta"==o){AcsApi.viewlist[i].morekey=n.morekey;try{window[t]._View.completedShowMore(i,n.size)}catch(e){}}},AcsCallBack.handleShowMore=function(e,t,i,o){AcsApi.viewlist[t].morekey=i;try{window[e]._View.initShowMore(t)}catch(e){}for(var n=0;n<o.length;n++)try{var a=new Activity(o[n]),s=void 0!==window[a.getPrd()].Activity?new(window[a.getPrd()].Activity)(a):a;window[a.getPrd()][a.getType()].render("showmore",t,s,!0)}catch(e){}try{window[e]._View.completedShowMore(t,o.length)}catch(e){}},AcsCallBack.handleAutoCorrect=function(e,t,i,o,n,a,s){if(AcsApi.viewlist[t].skey!=i||AcsApi.viewlist[t].sno!=o){if("true"==a)try{window[e]._View.init(t)}catch(e){}AcsApi.viewlist[t].skey=i,AcsApi.viewlist[t].sno=o,s&&(AcsApi.viewlist[t].morekey=s);for(var r=n.length-1;r>=0;r--)try{var l=new Activity(n[r]),d=void 0!==window[l.getPrd()].Activity?new(window[l.getPrd()].Activity)(l):l;window[l.getPrd()][l.getType()].render("autocorrect",t,d,!1)}catch(e){}}},AcsCallBack.handleTimeline=function(e,t,i,o,n,a,s){for(var r=new Array,l=0;l<a.length;l++)try{var d=new Activity(a[l]),c=void 0!==window[d.getPrd()].Activity?new(window[d.getPrd()].Activity)(d):d;r.push(c)}catch(e){}try{window[e]._View.renderTimeline(t,i,o,n,r,s)}catch(e){}},AcsCallBack.handleCrossProductNotification=function(e,t,i){try{window[e].Uns.handleCrossProductBadge(t,i)}catch(e){console.log(e)}},AcsCallBack.handleNotification=function(e,t,i,o){try{if(window[e].Uns.handleBadge(t,o,i),null!=i){if(null==AcsUtil.getPrd()||null==AcsUtil.getRawSid())return;var n=AcsUtil.Cookie.get(AcsApi.getCkey());""!=n&&n!=AcsUtil.getRawSid()||(window[e].Uns.handleDesktopNotification(i),AcsDesktopNotification.setOwnerCookie(AcsApi.getCkey(),AcsUtil.getRawSid(),1e4))}}catch(e){}},AcsCallBack.handleNotificationList=function(e,t,i,o,n,a,s,r,l){try{if(a&&1==a)try{window[e]._View.initNotification(i)}catch(e){}for(var d=new Array,c=0;c<t.length;c++)d.push(new UnsNotification(t[c],e));"new"==n&&(d=d.reverse()),window[e].Uns.renderNotificationList(n,d,i,o,s,r,l)}catch(e){}},AcsCallBack.handleInvoke=function(e,t,i,o,n,a){try{window[t][o].handleAction(e,n,i,a)}catch(e){}},AcsCallBack.handleInvokeError=function(e,t,i,o,n,a){try{window[t][o].handleActionError(e,n,i,a)}catch(e){}},AcsCallBack.handlePushActivity=function(e,t,i){try{var o=new Activity(i),n=void 0!==window[o.getPrd()].Activity?new(window[o.getPrd()].Activity)(o):o;if(window[o.getPrd()][o.getType()].renderNotification(e,n,!0),null==AcsApi.viewlist[e])return;if(AcsApi.viewlist[e].sno<t-1)return void AcsApi.autoCorrect(e);AcsApi.viewlist[e].skey=n.skey,AcsApi.viewlist[e].sno=t,window[o.getPrd()][o.getType()].render("push",e,n,!1)}catch(e){}},AcsCallBack.handlePushPollResult=function(e,t,i){if(null==e||null!=AcsApi.viewlist[e]){null!=e&&null!=t&&(AcsApi.viewlist[e].sno=t);var o=new PollResult(i);try{window[o.getPrd()][o.getType()].updatePoll(e,o)}catch(e){}}},AcsCallBack.handlePushDelete=function(e,t,i){if(null!=AcsApi.viewlist[e]){AcsApi.viewlist[e].sno=t;try{window[i.prd][i.type].handleDelete(i.deltype,e,i.fdk,i.cfdk)}catch(e){}}},AcsResource.init=function(){null==AcsResource.resourceobject&&(AcsResource.resourceobject=new Object)},AcsResource.fetchResource=function(e,t){var i="lang="+e;null!=t&&""!=t&&(i+="&rebrand="+t);var o=AcsConnect.syncHttpPost(_acscontext+"/getresource"+_acsextn,i),n=JSON.parse(o);null!=n[0].objString&&null!=n[0].objString?AcsResource.resourceobject=JSON.parse(n[0].objString):AcsResource.resourceobject=n[0].objString},AcsResource.getRealValue=function(e,t){try{var i="";if(null==this.resourceobject[""+e]||null==this.resourceobject[""+e])try{i=null==opener.AcsResource.resourceobject[""+e]||null==opener.AcsResource.resourceobject[""+e]?e:opener.AcsResource.resourceobject[e]}catch(t){i=e}else i=this.resourceobject[e];return i=i.replace(/_/g," "),null==t||0==t.length?i:i=AcsResource.replaceParams(i,t)}catch(e){}try{return e.replace(/_/g," ")}catch(e){return""}},AcsResource.replaceParams=function(e,t){for(var i=0;i<t.length;i++){var o=t[i],n=new RegExp("\\$"+(i+1),"g");e=e.replace(n,o)}return e},AcsConnect.getRequest=function(){var e;try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){e=!1}}return e||"undefined"==typeof XMLHttpRequest||(e=new XMLHttpRequest),e},AcsConnect.httpPost=function(e,t,i,o){var n=AcsConnect.getRequest();n.open("POST",t,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8");var a=AcsApi.getCSRF();i=i?i+"&"+a:a,n.send(i),n.onreadystatechange=function(){4==n.readyState&&AcsConnect.handleHttpPost(e,n.responseText,o)}},AcsConnect.httpProgressive=function(e,t,i,o){(new Date).getTime();var n=AcsConnect.getRequest();n.open("POST",t,!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8");var a=AcsApi.getCSRF();i=i?i+"&"+a:a,n.send(i);var s=0;n.onreadystatechange=function(){if(3==n.readyState){var t="[]";try{for((i=n.responseText).lastIndexOf(",")==i.length-1&&(i=i.substring(0,i.length-1)),t=JSON.parse("["+i+"]");s<t.length;)AcsApi.handleProgressiveCallBack(0==s,"chunk",e,t[s],o),s++}catch(e){}}else if(4==n.readyState)try{var i;(i=n.responseText).lastIndexOf(",")==i.length-1&&(i=i.substring(0,i.length-1)),t=JSON.parse("["+i+"]");try{for(;s<t.length;)AcsApi.handleProgressiveCallBack(0==s,"chunk",e,t[s],o),s++}catch(i){AcsApi.handleProgressiveCallBack(!0,"full",e,t,o)}}catch(e){}}},AcsConnect.syncHttpPost=function(e,t){var i=AcsConnect.getRequest();i.open("POST",e,!1),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),i.setRequestHeader("Content-length",t.length),i.setRequestHeader("Connection","close");var o=AcsApi.getCSRF();if(t=t?t+"&"+o:o,i.send(t),200==i.status)return i.responseText},AcsConnect.handleHttpPost=function(e,t,i){try{var o;"error"==(o=JSON.parse(t))[0].objType?AcsApi.handleCallBackError(e,o[0].objString,i):AcsApi.handleCallBack(e,o[0].objString,i)}catch(e){}},AcsDesktopNotification={},AcsDesktopNotification.hasOwnerAssigned=!1,AcsDesktopNotification.setOwnerCookie=function(e,t,i){AcsDesktopNotification.hasOwnerAssigned=!0,AcsUtil.Cookie.set(e,t,i)},AcsDesktopNotification.init=function(){_acsie?document.attachEvent("onclick",AcsDesktopNotification.reqPerm):document.addEventListener("click",AcsDesktopNotification.reqPerm,!0),AcsDesktopNotification.syncOwner()},AcsDesktopNotification.reqPerm=function(){try{"webkitNotifications"in window?0!=window.webkitNotifications.checkPermission()&&window.webkitNotifications.requestPermission():"Notification"in window&&"granted"!==Notification.permission&&Notification.requestPermission()}catch(e){}},AcsDesktopNotification.show=function(e,t,i,o,n,a){try{try{AcsDesktopNotification.close()}catch(e){}"webkitNotifications"in window?(AcsDesktopNotification.nobj=window.webkitNotifications.createNotification(e,t,i),AcsDesktopNotification.nobj.show()):"Notification"in window&&(AcsDesktopNotification.nobj=new Notification(t,{dir:"auto",body:i,tag:"acs",icon:e})),AcsDesktopNotification.nobj.onclick=function(){try{window.focus(),void 0!==a&&window[n].Uns.handleNotificationClick(a),AcsDesktopNotification.close()}catch(e){}},AcsDesktopNotification.closetimer=setTimeout((function(){AcsDesktopNotification.close()}),1e3*o)}catch(e){}},AcsDesktopNotification.close=function(){try{clearTimeout(AcsDesktopNotification.closetimer),"webkitNotifications"in window?AcsDesktopNotification.nobj.cancel():"Notification"in window&&AcsDesktopNotification.nobj.close()}catch(e){}},AcsDesktopNotification.syncOwner=function(){if(setTimeout((function(){AcsDesktopNotification.syncOwner()}),4e3),this.isOwner()){var e=AcsUtil.Cookie.get(AcsApi.getCkey());AcsDesktopNotification.setOwnerCookie(AcsApi.getCkey(),e,1e4)}},AcsDesktopNotification.isOwner=function(){try{if(!AcsDesktopNotification.hasOwnerAssigned)return!0;if(null==AcsUtil.getPrd()||null==AcsUtil.getRawSid())return!1;var e=AcsUtil.Cookie.get(AcsApi.getCkey());return""!=e&&e==AcsUtil.getRawSid()}catch(e){return!1}},_acsie?window.attachEvent("onbeforeunload",(function(){AcsUtil.Cookie.remove(AcsApi.getCkey())})):window.addEventListener("onbeforeunload",(function(){AcsUtil.Cookie.remove(AcsApi.getCkey())}));var globalparam,AcsUtil={getPrd:function(){return"undefined"!=typeof WebMessanger?WebMessanger.getPrd():WmsLite.prd},getRawSid:function(){return"undefined"!=typeof WebMessanger?WebMessanger.getRawSid():WmsLite.rsid},Cookie:{get:function(e){if(null!=AcsUtil.getPrd()){e=AcsUtil.getPrd()+e;var t=document.cookie.indexOf(e),i=document.cookie.length,o=null;if(-1!=t){var n=t+e.length;-1!=(o=document.cookie.substr(n+1,i)).indexOf(";")&&(o=o.substring(0,o.indexOf(";")))}return o&&decodeURIComponent(o)||""}},set:function(e,t,i){if(void 0!==t&&void 0!==e&&null!=AcsUtil.getPrd()){e=AcsUtil.getPrd()+e;var o=new Date;return null!=i&&""!=i||(i=2592e6),o.setTime(o.getTime()+i),document.cookie=e+"= "+encodeURIComponent(t)+";expires= "+o.toGMTString()+";path= /",!0}},getCustomCookie:function(e){for(var t=document.cookie.split("; "),i=0;i<t.length;i++){var o=t[i].split("=");if(o[0]===e)return o[1]}return""},remove:function(e){var t=AcsUtil.Cookie.get(e);if(t){e=AcsUtil.getPrd()+e;var i=new Date;document.cookie=e+"=;expires= "+i.toGMTString()+"; path= /"}return t}}},CRM={},CrmAcs={},isShowMore=!0,withAttach=!1,attachLimit=20,fileCount=0,viewKey=Crm.userDetails.feedsViewKey;CrmAcs.customTranslationObj={},CrmAcs.fetchResource=function(){if(null==AcsResource.resourceobject){var e=Crm.getCrmBasePath()+"/Pulse.do?action=getAcsResource";(new crmRequestPool).initiate({action:e,type:"GET",success:function(e){AcsResource.resourceobject=e}})}}(),CRM.commonFeedAction=function(){this.render=function(e,t,i,o){displayFeedsAndComments(e,t,i,o),commonUtils.showHideLoadingDiv(),$("#feeds_loading").hide();var n=$("#showOneFeed");$("#feedpopupnew").is(":visible")&&setPerfectScrollBar("feedpopupnew","feedpopupnew_inner"),n.is(":visible")&&setPerfectScrollBar("showOneFeed","showOneFeed_inner")},this.renderComments=function(e,t,i,o,n,a){displayComments(e,t,i,o,n,a);var s=$("#showOneFeed"),r=$("#feedpopupnew");s.is(":visible")&&setPerfectScrollBar("showOneFeed","showOneFeed_inner"),r.is(":visible")&&setPerfectScrollBar("feedpopupnew","feedpopupnew_inner")},this.updatePoll=function(e,t){},this.invokeAction=function(e,t,i,o,n){AcsApi.invoke("CR",e,i,this.moduleName,t,o,n),fileCount=0},this.handleAction=function(e,t,i,o){o&&"Success"==o&&"DeleteComment"==t&&window.getElemById(i)&&window.getElemById(i).remove()},this.handleActionError=function(e,t,i,o){},this.handleDelete=function(e,t,i,o){"activity"===e?$("div[id='"+i+"']").remove():"comment"===e&&$("div[id='"+o+"']").remove()},this.renderNotification=function(e,t,i){$("#showOneFeed").is(":visible")&&(t.isFromNotification="true"),displayFeedsAndComments("push",e,t,!1),commonUtils.showHideLoadingDiv()}},CRM.Leads=new CRM.commonFeedAction,CRM.Leads.moduleName="Leads",CRM.Accounts=new CRM.commonFeedAction,CRM.Accounts.moduleName="Accounts",CRM.Contacts=new CRM.commonFeedAction,CRM.Contacts.moduleName="Contacts",CRM.Potentials=new CRM.commonFeedAction,CRM.Potentials.moduleName="Potentials",CRM.Tasks=new CRM.commonFeedAction,CRM.Tasks.moduleName="Tasks",CRM.Events=new CRM.commonFeedAction,CRM.Events.moduleName="Events",CRM.Calls=new CRM.commonFeedAction,CRM.Calls.moduleName="Calls",CRM.PurchaseOrders=new CRM.commonFeedAction,CRM.PurchaseOrders.moduleName="PurchaseOrders",CRM.Quotes=new CRM.commonFeedAction,CRM.Quotes.moduleName="Quotes",CRM.SalesOrders=new CRM.commonFeedAction,CRM.SalesOrders.moduleName="SalesOrders",CRM.Invoices=new CRM.commonFeedAction,CRM.Invoices.moduleName="Invoices",CRM.PriceBooks=new CRM.commonFeedAction,CRM.PriceBooks.moduleName="PriceBooks",CRM.Products=new CRM.commonFeedAction,CRM.Products.moduleName="Products",CRM.Cases=new CRM.commonFeedAction,CRM.Cases.moduleName="Cases",CRM.Status=new CRM.commonFeedAction,CRM.Status.moduleName="Status",CRM.Info=new CRM.commonFeedAction,CRM.Info.moduleName="Info",CRM.Campaigns=new CRM.commonFeedAction,CRM.Campaigns.moduleName="Campaigns",CRM.Vendors=new CRM.commonFeedAction,CRM.Vendors.moduleName="Vendors",CRM.Solutions=new CRM.commonFeedAction,CRM.Solutions.moduleName="Solutions",CRM.Motivator=new CRM.commonFeedAction,CRM.Motivator.moduleName="Motivator",CRM.Share=new CRM.commonFeedAction,CRM.Share.moduleName="Share",CRM.Services=new CRM.commonFeedAction,CRM.Services.moduleName="Services",CRM.Appointments=new CRM.commonFeedAction,CRM.Appointments.moduleName="Appointments";for(var i=1;i<=500;i++)CRM["CustomModule"+i]=new CRM.commonFeedAction,CRM["CustomModule"+i].moduleName="CustomModule"+i;function fetchMoreNotificationList(){$("#notificationList").scrollTop()+$("#notificationList").outerHeight()>=$("#notificationList")[0].scrollHeight&&AcsApi.getNotificationList("UNS",10,CRM.notificationLastElementKey,void 0,void 0,!0,AcsApi.NotificationTypes.PROJECTBASED,Crm.userDetails.ZGID)}function getUNSNotificationList(){void 0===Handlebars.templates.FeedsEntryTemplate&&loadFeedJS(),commonUtils.showHideLoadingDiv(!0),void 0===InfoForDisplayWithLiteUsers?loadDataForDisplayAndMentions(!1,!0,!1,!0,(function(){AcsApi.getNotificationList("UNS",50,void 0,void 0,void 0,!0,AcsApi.NotificationTypes.PROJECTBASED,Crm.userDetails.ZGID)}),!0):AcsApi.getNotificationList("UNS",50,void 0,void 0,void 0,!0,AcsApi.NotificationTypes.PROJECTBASED,Crm.userDetails.ZGID),$("#notificationList").empty(),hideFreezeLayer()}function getTimelineData(e){$("#feed_loading").show();var t,i,o=new Date;"yesterday"===e?(t=new Date(o.getFullYear(),o.getMonth(),o.getDate()-1),i=new Date(o.getFullYear(),o.getMonth(),o.getDate()-1,24,0,0),$("#timeLineTitle").html("<span class='lightgray feedtitle'> /&nbsp;</span>"+I18n.getMsg("Yesterday"))):"lastweek"===e?(t=new Date(o.getFullYear(),o.getMonth(),o.getDate()-o.getDay()-7),i=new Date(o.getFullYear(),o.getMonth(),o.getDate()-o.getDay()),$("#timeLineTitle").html("<span class='lightgray feedtitle'> /&nbsp;</span>"+I18n.getMsg("Last Week"))):"thismonth"===e?(t=new Date(o.getFullYear(),o.getMonth()),i=new Date(o.getFullYear(),o.getMonth()+1),$("#timeLineTitle").html("<span class='lightgray feedtitle'> /&nbsp;</span>"+I18n.getMsg("Current Month"))):"lastmonth"===e&&(t=new Date(o.getFullYear(),o.getMonth()-1),i=new Date(o.getFullYear(),o.getMonth()),$("#timeLineTitle").html("<span class='lightgray feedtitle'> /&nbsp;</span>"+I18n.getMsg("Last Month"))),$("#feedscontainer_timeline").html(""),viewKey==userFeedsPageKey&&$("#feedTitle").html('<a href="javascript:;" class="gray2 feedtitle" onclick="fetchFeeds(\''+userFeedsPageKey+"','','',this,false,false);\">"+I18n.getMsg("crm.feeds.userwall.title")+"</a> "),$("#moduleTitle").removeClass("black"),$("#moduleTitle").addClass("gray2"),AcsApi.timeline("CRM",viewKey,10,e,t.getTime(),i.getTime())}function displayFeedsAndComments(e,t,i,o){var n=$("#showOneFeed"),a=$("#feedpopupnew");if(($("#feedParentDiv").is(":visible")||n.is(":visible"))&&viewKey===t){$(".feed_blankstate").hide(),$(".feedtitle").show(),$(".feedfiltercontent").show(),$("#noData").hide(),i.viewKey=viewKey,i.isActivitySplitDone=!!Crm.isActivitySplitDone;var s=Handlebars.templates.FeedsEntryTemplate,r=s(i),l=!0,d="",c=$("#feedParentDiv").is(":visible");if(Crm.userDetails.ZUID!==i.laowner||"push"!==e&&"autocorrect"!==e||!c&&!n.is(":visible")){if("push"===e||"autocorrect"===e){var p="Status"==i.ap_EntityModule?i.ap_statusId:ap_EntityId,u=document.getElementById("note_"+p);u&&(d=u.value),""!==d?($("div[id='"+i.fdk+"'].feedbox").replaceWith(r),l=!1,u.value=d):a.is(":hidden")&&n.is(":hidden")&&$("div[id='"+i.fdk+"']").remove()}}else if($("div[id='"+i.fdk+"']").length>0){for(var m=$("div[id='"+i.fdk+"'].feedbox"),h=m.length,f=0;f<h;f++){var g=new DOMParser,v=m[f].parentElement;if("showOneFeed_inner"==v.getAttribute("id")){i.isFromNotification="true";var y=s(i);y=g.parseFromString(y,"text/html"),v.replaceChild(y.body.children[0],m[f])}else delete i.isFromNotification,r=s(i),r=g.parseFromString(r,"text/html"),v.replaceChild(r.body.children[0],m[f])}n.is(":visible")?n.find(".feedMassActionDiv").show():a.is(":visible")&&a.find(".feedMassActionDiv").show(),l=!1}l&&(o?$("#feedscontainer").append(r):$("#feedscontainer").prepend(r)),$("a.imageGallery").colorbox({photo:!0})}}function displayComments(e,t,i,o,n,a){if(viewKey===e){var s=(0,Handlebars.templates.FeedsComment)({comments:o,totalCount:n});$(CRM.feedGetCommentsObject).closest(".cmoreCmt_Container").replaceWith(s),$("a.imageGallery").colorbox({photo:!0})}}function bindMentions(e,t){$(".chatBgWraper").removeClass("openNotes");var i=$(e).closest(".feed_newpost_textarea_bg");if(i.addClass("openNotes"),$(e).closest(".chatBgWraper").addClass("openNotes"),$("feedButtonLayer").show(),i.find(".feed_status").addClass("feed_statusHset"),"CallNotes"===t){void 0===$(e).attr("data-mentions-input")&&($(e).mentionsInput({textareafocus:!0,useCurrentVal:!0,onDataRequest:function(e,t,i){void 0===InfoForMentions&&loadDataForDisplayAndMentions(!1,!0);var o=JSON.parse(InfoForMentions);o=o.filter((function(e){return e.plainName.toLowerCase().indexOf(t.toLowerCase())>-1})),i.call(this,o)}}),setTimeout((function(){var e=$("#noteContentTxt"),t=e.val();e.focus().val("").val(t)}),100))}else{var o=$L("#"+t);o.hasClass("lyteMentionsAdded")||(Notes.idForMentions=t,o.cruxMention({textboxSelector:"#"+t,queryParam:{include_lite_users:!0},cxPropContent:function(e){"transitionNotes"==Notes.idForMentions?Notes.transNoteContent=e:"noteContentTxt"==Notes.idForMentions?Notes.noteContent=e:"feed_status"==Notes.idForMentions?Notes.feedsContent=e:"CallNotes"===Notes.idForMentions?Notes.callNotesContent=e:Notes.feedCommentsContent=e}}),o.addClass("lyteMentionsAdded"),$(".lyteMIWrapper").css("width","100%"),"CallNotes"===t&&$("#CallNotesDiv").find(".lyteMIWrapper").css("width","102%"),"transitionNotes"==t&&$(".lyteMentionsInnerDiv").css("color","transparent"),"noteContentTxt"!=t&&"feed_status"!=t&&Notes.mentionedCommentIds.push(t)),o.focus()}}function showMentionedName(e,t){(t=null!=t&&1==t)&&(e=(e=(e=e.replace("&#x5b;","[")).replace("&#x23;","#")).replace("&#x5d;","]"));var o=new RegExp("crm[[aA-zZ]*#[0-9]*#[0-9]*]crm","gi"),n=e.match(o),a=JSON.parse(InfoForDisplayWithLiteUsers),s=!0;if(n)for(i=0;i<n.length;i++){var r=e.indexOf(n[i])+n[i].length;i!=n.length-1&&","!=e[r]&&","!=e[r+1]||(s=!1);for(var l=n[i].indexOf("#"),d=(r=n[i].lastIndexOf("#"),n[i].slice(l+1,r)),c=d,p=0;p<a.length;p++)if(a[p].id===d){if("user"==a[p].type){var u=a[p].firstName,m=a[p].lastName;c=getFormattedName(u,m,null);break}c=a[p].name,t&&(c=a[p].plainName);break}c=s?$.trim(c)+",":$.trim(c),e=null!=t&&1==t?e.replace(n[i],c):e.replace(n[i],"<a href=javascript:; class='feedbluetxt'>"+$ESAPI.encoder().encodeForHTML(c)+"</a>")}return e}function addFeedStatus(){var e=Notes.feedsContent;if(e&&e.length>65535)return(t=[])[0]="65535",t[1]=I18n.getMsg("Status"),alert(I18n.getMsg("crm.message.limit.exceed",t)),!1;var t="actionType=Status&content="+encodeURIComponent(e),i=$("#direct_msg").prop("checked");if(i&&$("#groupSelect").show(),t=t+"&isDirect="+i,groupStatus&&(t=t+"&groupId="+groupId),""!==e&&!withAttach){var o=t+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);mR(Crm.getCrmBasePath()+"/specific/noteattach.do?",(function(){$("textarea[id='feed_status']").val(""),$("#direct_msg").prop("checked",!1),Notes.destroyMentionsComponent("feed_status")}),o)}globalparam=t}function getNameByZuid(e){for(var t=JSON.parse(InfoForDisplayWithLiteUsers),i=I18n.getMsg("crm.label.deleted.users"),o=0;o<t.length;o++)if(t[o].zuid===e){if("user"==t[o].type){var n=t[o].firstName,a=t[o].lastName;i=getFormattedName(n,a,null);break}i=t[o].name,isFromNotes&&(i=t[o].plainName);break}return i}function getOneFeed(e,t,i,o){o&&($(".eachnotification").removeAttr("clicked"),$(".eachnotification").removeAttr("style"),$(o).attr("clicked",!0),$(o).css({"background-color":"#f1f7ff"}));var n="actionType=getOneFeed&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&fdk="+encodeURIComponent(e)+"&module="+t+"&sKey="+encodeURIComponent(i);mR(Crm.getCrmBasePath()+"/specific/noteattach.do?",(function(e){var i=JSON.parse(e);i.isFromNotification="true",showOneFeedAndComments(e=JSON.stringify(i),t,o)}),n)}function createShowOneFeedDiv(){if($("#showOneFeed").length<=0){var e=document.createElement("div");$(e).attr({id:"showOneFeed",style:"display: none;max-height:500px; overflow-y : auto;",onClick:"sE(event)"});var t=document.createElement("div");$(t).attr({id:"showOneFeed_inner"}),e.append(t),$("#show").append(e)}}function showOneFeedAndComments(e,t,i){if(createShowOneFeedDiv(),"deleted"!==JSON.parse(e).resultstatus&&"unauthorised"!==JSON.parse(e).resultstatus){var o=new Activity(JSON.parse(e));o=new CRM.Activity(o);var n=(0,Handlebars.templates.FeedsEntryTemplate)(o);(r=$("#showOneFeed")).css({width:"570px",padding:"0px"}),$("#showOneFeed_inner").html(n);var a=$("#notificationscontainer").position().left-(r.width()+2),s=$("#tabLayer").outerHeight();$("#showOneFeed_inner").find(".feedMassActionDiv").show(),Crm.userDetails.RTL_ENABLED?r.css({left:$("#notificationscontainer").outerWidth(),top:s,"box-shadow":"4px 0px 15px #bbb","-moz-box-shadow":"4px 0px 15px #bbb","-webkit-box-shadow":"4px 0px 15px #bbb"}):r.css({left:a,top:s}),r.show(),$("a.imageGallery").colorbox({photo:!0}),setPerfectScrollBar("showOneFeed","showOneFeed_inner")}else{if("deleted"===JSON.parse(e).resultstatus)n="<div class='p30'>"+I18n.getMsg("crm.alert.content.cannot.access.record",I18n.getMsg("crm.feed.tab.name"))+"</div>";else n="<div class='p30 wbBreakWord lh20'>"+I18n.getMsg("crm.contact.hierarchy.business_card_permission_error")+"</div>";var r;(r=$("#showOneFeed")).css({width:"570px",padding:"0px"}),$("#showOneFeed_inner").html(n);a=$("#notificationscontainer").position().left-(r.width()+2),s=$("#notificationscontainer").position().top;r.css({left:a,top:s}),r.show(),setPerfectScrollBar("showOneFeed","showOneFeed_inner")}}function attachForComment(e){fileCount=0,$("div[id='addAttachment_"+e+"']").show()}function hideAttach(e){fileCount=0,$("#tkvMoreFiles").html(""),$("#attachcrmKVFiles").removeClass("hide"),$("#attachcrmKVMoreFiles").addClass("hide"),$("div[id='addAttachment_"+e+"']").hide(),$("form[id='form_"+e+"']")[0].reset()}function addNoteFromFeed(e,t,i,o,n){var a=$(o).closest(".feedcontentdiv").find("textarea").prop("id"),s=Notes.feedCommentsContent;if("true"!=(Crm.userDetails.permissions.Crm_Implied_Create_Notes||!1)+""&&"Status"!=t)return renderingUtils.showCustomAlert(I18n.getMsg("crm.security.error","")),!1;if(s&&s.length>32e3){var r=[];return r[0]="32000",r[1]=I18n.getMsg("crm.ln.lable.comment"),alert(I18n.getMsg("crm.message.limit.exceed",r)),!1}var l=s;if((""!==l||$(n).find("div[id='addAttachment_"+i+"']").find("input[name='thefile']").length>1)&&(""!==l||$(n).find("div[id='addAttachment_"+i+"']").find("input[name='thefile']").length>1)){var d=l,c={};c.ASSOCIATEID=e,c.ASSOCIATETYPE=t,c.MESSAGE=d,c.PMODULE=t,c.PPID=e,commonUtils.showHideLoadingDiv(!0),CRM[t].invokeAction(viewKey,"Comment",i,c,n),Notes.destroyMentionsComponent(a),Notes.feedCommentsContent=""}}function deleteComment(e,t,i,o){var n={};if(n.ID=t,n.PARENTMODULE=i,n.BY=o,"true"!=(Crm.userDetails.permissions.Crm_Implied_Delete_Notes||!1)+""&&"Status"!=i)return renderingUtils.showCustomAlert(I18n.getMsg("crm.security.error","")),!1;CRM[i].invokeAction(viewKey,"DeleteComment",e,n),$(".feed_newpost_textarea_bg").removeClass("openNotes")}function deleteStatus(e,t){$("#feedpopupnew").is(":visible")&&(hide("feedpopupnew"),$("#feedpopupnew").css({width:"auto",height:"auto"}),removeFreezeLayer());var i={};i.BY=t,CRM.Status.invokeAction(viewKey,"DeleteStatus",e,i)}function feedGetComments(e,t,i,o,n,a,s){CRM.feedGetCommentsObject=s,AcsApi.getComments(e,t,i,"",n,"")}function showFeedComment(e,t){var i=$(t).closest(".feedcontentdiv");i.find("textarea[id='note_"+e+"']").focus(),i.find(".feedButtonLayer").slideDown(),i.find(".feedButtonLayer").animate({height:"100%"}),$("#showOneFeed").is(":visible")&&setPerfectScrollBar("showOneFeed","showOneFeed_inner")}function showStatus(){var e=$("#save_status_div");$("#feedDropzone").addClass("attachzone"),$("#dropzonePreview").show(),e.height()<265&&(e.animate({height:"40px"}),e.show())}function directMsgSpan(){$("#feed_status").on("change paste keyup",(function(){-1==$("#feed_status").val().indexOf("@")&&($("#direct_msg_span").hide(),$("#direct_msg").prop("checked",!1)),groupStatus||-1===$("#feed_status").val().indexOf("@")||$("#direct_msg_span").show()})),$("#direct_msg").click((function(){$(this).prop("checked")?($("#optionalWall").val("orgwall"),$("#groupSelect").hide(),groupId=null,groupStatus=!1,$("#groupUsers").html("")):0==$(this).prop("checked")&&$("#groupSelect").show()}))}function hideDirect(){$("#direct_msg_span").hide(),$("#direct_msg").prop("checked",!1)}CRM.Uns={handleBadge:function(e,t){var i=void 0!==e.CNS?parseInt(e.CNS):0;0!==i?"prefetch"!==t&&($("#newMailCount").is(":visible")||$("#newMailCount").show(),$("#newMailCount").html(i),document.getElementById("recentMailsDiv")&&"none"!==document.getElementById("rmListViewDiv").style.display&&showRecentMails(),document.title="("+$("#newMailCount").html()+") "+originaltitle):void 0!==e.CNS&&0===i&&(hidemessage(),$("#newMailCount").hide());var o="UNS@"+Crm.userDetails.ZGID;if(void 0!==e[o]&&parseInt(crmNTCGlobal.feeds_count)<parseInt(e[o])){var n=parseInt(e[o])-parseInt(crmNTCGlobal.feeds_count);crmNTCGlobal.feeds_count=e[o],parseInt(crmNTCGlobal.live_global_notifications_count)>0?crmNTCGlobal.live_global_notifications_count=parseInt(crmNTCGlobal.live_global_notifications_count)+parseInt(n):crmNTCGlobal.live_global_notifications_count=crmNTCGlobal.feeds_count}else if(void 0!==e[o]&&parseInt(crmNTCGlobal.feeds_count)>parseInt(e[o])){var a=parseInt(crmNTCGlobal.feeds_count)-parseInt(e[o]);crmNTCGlobal.feeds_count=e[o],parseInt(crmNTCGlobal.live_global_notifications_count)>0?crmNTCGlobal.live_global_notifications_count=parseInt(crmNTCGlobal.live_global_notifications_count)-parseInt(a):crmNTCGlobal.live_global_notifications_count=crmNTCGlobal.feeds_count}crmNTCGlobal.updateNotificationCount()},handleDesktopNotification:function(e){},renderNotificationList:function(e,t,i,o,n){for(var a=Handlebars.templates.FeedsNotificationList,s="",r=0;r<t.length;r++){var l=t[r].getInfo();if(void 0!==l){var d="";void 0!==t[r].getActionOwner()&&(d=t[r].getActionOwner().split(":")[0]);var c=t[r].getTime(),p=t[r].getSkey(),u=t[r].getProperty("fdk"),m=t[r].getProperty("type"),h=t[r].isNew(),f=t[r].getRepeatCount(),g=t[r].getRepeatUsers();s+=a({title:l,laOwnerId:d,time:Number(c),feedFdk:u,feedType:m,repCount:f,repUsers:g,isNew:h,sKey:p})}}var v=$("#tabLayer"),y=parseInt(v.innerHeight())+v.offset().top;$("body").hasClass("zcrmInsideCRMPlus")&&(y=0),$("#notificationscontainer").css({top:y,height:$(window).height()-(y+$("#wmstoolbar").outerHeight())}).addClass("open"),$(".notifiactionIcon").addClass("notifiactionIconH"),$("#notifications").css({height:$(window).height()-(45+$("#wmstoolbar").outerHeight()+$("#notificationscontainer .notificationtitle").outerHeight())}),commonUtils.showHideLoadingDiv(),""===s&&(s='<div class="p30 aligncenter fontsmooth mT30">'+I18n.getMsg("crm.feed.no")+"<div>");var w=$("#notificationList");"more"==e?w.find("#feedsContain").append(s):CRM.notificationLastElementKey!==n?w.append('<div id="feedsContain">'+s+"</div>").addClass("pR oH"):w.html('<div id="feedsContain">'+s+"</div>").addClass("pR oH");var C=$("#notificationscontainer").outerHeight()-$("#nc-tabs-menu").outerHeight();if(w.css("height",C),setPerfScrollBar("notificationList","feedsContain"),void 0!==n){var b=$("#notificationList");CRM.notificationLastElementKey=n,b.on("scroll",$L.debounce((function(){fetchMoreNotificationList()}),100))}else $("#notificationList").off("scroll")}},CRM.onAcsConnect=function(){AcsApi.getBadgeCount("UNS")},CRM.Activity=function(e){var t=$("#showOneFeed");if($("#feedParentDiv").is(":visible")||t.length>0){if(this.prd=e.getPrd(),this.fdk=e.getFDK(),this.latype=e.getLAType(),this.cmore=e.getCMore(),this.skey=e.getSkey(),this.viewKey=viewKey,this.title=e.getTitle(),this.entityName=e.getContent(),this.type=e.getType(),this.aowner=e.getAOwner().split(":")[0],void 0!==e.getLAOwner()?this.laowner=e.getLAOwner().split(":")[0]:this.laowner=this.aowner,this.time=e.getAdditionalProperty("ActivityTime"),this.parentModule=e.getAdditionalProperty("ParentModule"),"Status"===this.type)this.statusContent=findReplaceURLWithinContent(showMentionedName(this.entityName)),this.statusTime=e.getAdditionalProperty("StatusTime"),this.SystemFeed=e.getAdditionalProperty("SystemFeed"),this.time=this.statusTime,Crm.userDetails.ZUID===this.aowner&&(this.canDelete=!0),(e.getAdditionalProperty("AttachmentImages")||e.getAdditionalProperty("AttachmentFiles"))&&(this.attachmentImages=e.getAdditionalProperty("AttachmentImages"),this.attachmentFiles=e.getAdditionalProperty("AttachmentFiles")),this.statusId=e.getAdditionalProperty("statusId");else if("Info"===this.type){this.massUpdatedEntities="",this.massUpdatedParentEntities="",this.massUpdatedChildEntity="",this.massChildEntitiesGroup="",this.entityName="",this.i18NParentModName=e.getAdditionalProperty("I18NParentModName"),this.infoTime=e.getAdditionalProperty("InfoTime"),this.time=this.infoTime,this.updatedEntities=e.getAdditionalProperty("UpdatedEntities");var i=0,o=!1,n={childModules:[]},a={};this.operation=e.getAdditionalProperty("Operation");for(var s=0;s<this.updatedEntities.length;s++)this.updatedEntities[s].ENTITYMODULE===this.parentModule?("delete"===this.operation?this.entityName=this.updatedEntities[s].ENTITYNAME:this.entityName=CRM.I18NString.getString("ENTITY",this.updatedEntities[s]),0===i&&"delete"===this.operation?this.massUpdatedParentEntities+="<div class='f13 bold lightgray'>"+I18n.getMsg("crm.feed.entity.follow.own",I18n.getMsg(this.updatedEntities[s].I8NMODULENAME))+"</div>"+this.entityName:this.massUpdatedParentEntities+=this.entityName,i+=1):(n.childModules.contains(this.updatedEntities[s].ENTITYMODULE)?o=!1:(n.childModules.push(this.updatedEntities[s].ENTITYMODULE),o=!0),this.massUpdatedChildEntity+=o?"<div class='mt15 f13 bold lightgray'>"+I18n.getMsg("crm.feed.entity.follow.own",I18n.getMsg(this.updatedEntities[s].I8NMODULENAME))+"</div>"+this.updatedEntities[s].ENTITYNAME:this.updatedEntities[s].ENTITYNAME,void 0!==a[this.updatedEntities[s].ENTITYMODULE]?a[this.updatedEntities[s].ENTITYMODULE]=a[this.updatedEntities[s].ENTITYMODULE]+this.massUpdatedChildEntity:a[this.updatedEntities[s].ENTITYMODULE]=this.massUpdatedChildEntity,this.massUpdatedChildEntity="");for(var r=0;r<n.childModules.length;r++)this.massChildEntitiesGroup+=a[n.childModules[r]];this.massUpdatedParentEntities.length<1&&(this.massUpdatedParentEntities="<div class='mt15 f13 bold lightgray'>"+I18n.getMsg("crm.feed.entity.follow.own",this.i18NParentModName)+"</div>"+I18n.getMsg("crm.feed.no.parent.involve")),this.statusContent=this.massUpdatedParentEntities+this.massChildEntitiesGroup}else if("Motivator"===this.type){if(this.statusContent=findReplaceURLWithinContent(showMentionedName(this.entityName)),this.statusTime=e.getAdditionalProperty("StatusTime"),this.SystemFeed=e.getAdditionalProperty("SystemFeed"),this.time=this.statusTime,(e.getAdditionalProperty("AttachmentImages")||e.getAdditionalProperty("AttachmentFiles"))&&(this.attachmentImages=e.getAdditionalProperty("AttachmentImages"),this.attachmentFiles=e.getAdditionalProperty("AttachmentFiles")),this.contentKey=e.getAdditionalProperty("contentKey"),this.contentParams=e.getAdditionalProperty("contentParams"),this.contentKey){for(s=0;s<this.contentParams.length;s++)this.contentParams[s]=I18n.getMsg(this.contentParams[s]);this.statusContent=I18n.getMsg(this.contentKey,this.contentParams)}}else"Share"===this.type&&(this.statusContent=findReplaceURLWithinContent(showMentionedName(this.entityName)));this.accessfrom=e.getAccFrom(),this.totalcomments=e.getTotalComments(),this.comments=e.getComments(),this.latitle=e.getLATitle(),this.asusers=e.getASUsers(),this.cfusers=e.getCFUsers(),this.totalcomments&&(this.viewAllCmtLabel=I18n.getMsg("crm.feed.display.all.comment",this.totalcomments.toString())),this.entityId=e.getAdditionalProperty("EntityId"),this.entityModule=e.getAdditionalProperty("EntityModule"),this.parentId=e.getAdditionalProperty("ParentId"),this.isFromNotification=e._jobj.isFromNotification,this.aOwnerZuid=e.getAdditionalProperty("AOwnerZuid"),this.aOwnerName=e.getAdditionalProperty("aOwnerName"),this.fieldLabelVsValue=e.getAdditionalProperty("FieldLabelVsValue");var l=e.getAdditionalProperty("EntityModule");if(!CrmAcs.customTranslationObj[l]&&"Status"!==l&&"Info"!==l){var d="/crm/v2/settings/translations/actions/resource?module="+l,c={"X-ZCSRF-TOKEN":csrfParamName+"="+cookieUtils.getCookie("crmcsr")};(new crmRequestPool).initiate({action:d,headers:c,async:!1,type:"GET",success:function(e){CrmAcs.customTranslationObj[l]=e}})}var p=CrmAcs.customTranslationObj[l];if(void 0!==this.fieldLabelVsValue)for(f in this.fieldLabelVsValue){var u=this.fieldLabelVsValue[f].FieldLabel,m=AcsApi.localizeI18NString(u,"CRM");this.fieldLabelVsValue[f].FieldLabel=m}if(this.fieldList=e.getAdditionalPropertyStartsWith("FieldList"),void 0!==this.fieldList){var h=[];for(var g in this.fieldList)if(0==g.indexOf("FieldList")){u=this.fieldList[g].FieldLabel;var v=this.fieldList[g].FieldId,y=this.fieldList[g].Seq,w=this.fieldList[g].UITYPE;m=p&&v&&p[v]?p[v]:AcsApi.localizeI18NString(u,"CRM");null==this.fieldList[g].FIRSTNAME||this.fieldList[g].NameFormatted||(this.fieldList[g].SALUTATION&&p&&(this.fieldList[g].SALUTATION=p[this.fieldList[g].SALUTATION]?p[this.fieldList[g].SALUTATION]:this.fieldList[g].SALUTATION),this.fieldList[g].Value=getFormattedName(this.fieldList[g].FIRSTNAME,this.fieldList[g].Value,this.fieldList[g].SALUTATION),this.fieldList[g].NameFormatted=!0);var C={FieldLabel:m,Value:this.fieldList[g].Value};if(2!==w&&26!==w||!p)if(200!=w&&786!=w&&14!=w&&30!=w&&24!=w&&202!=w&&333!=w&&(116!=w&&117!=w||null==this.fieldList[g].bigintDTFormula&&null==this.fieldList[g].bigintDateFormula)&&1234!=w||null==this.fieldList[g].DTLong)if(333==w||(116==w||117==w)&&null!=this.fieldList[g].bigintDTFormula){T=this.fieldList[g].Value;T=new Date(T);var b=Utils.convertDateToUserPattern(T);if("Invalid Date"!=T)if(Crm.userDetails.TIME_FORMAT.indexOf(" ")>-1)if(T.toLocaleTimeString().indexOf(" ")>-1){C={FieldLabel:m,Value:b+" "+T.toLocaleTimeString()}}else{I=(S=T.toLocaleTimeString()).substr(0,2);C={FieldLabel:m,Value:b+" "+(S=I>12?I%12+S.slice(2)+" "+I18n.getMsg("PM"):12==I?S+" "+I18n.getMsg("PM"):0==I?"12"+S.slice(2)+" "+I18n.getMsg("AM"):S+" "+I18n.getMsg("AM"))}}else if(T.toLocaleTimeString().indexOf(" ")<=-1)C={FieldLabel:m,Value:b+" "+T.toLocaleTimeString()};else C={FieldLabel:m,Value:b+" "+T.getHours()+":"+T.getMinutes()};else b||(b=""),C={FieldLabel:m,Value:b}}else if(202==w||(116==w||117==w)&&null!=this.fieldList[g].bigintDateFormula){var A=this.fieldList[g].Value;b=Utils.convertDateToUserPattern(A);"Invalid Date"!=(A=new Date(A))||b||(b=""),C={FieldLabel:m,Value:b}}else w==CrmField.UITYPES.SERVICE_DURATION&&(C={FieldLabel:m,Value:Handlebars.helpers.setServiceDuration(this.fieldList[g].Value)});else{var T=this.fieldList[g].DTLong;if(T=new Date(T),b=Utils.convertDateToUserPattern(T),"Invalid Date"!=T)if(24==w||202==w||null!=this.fieldList[g].bigintDateFormula)C={FieldLabel:m,Value:b=Utils.convertDateToUserPattern(T)};else if(T=new Date(T.getTime()-6e4*T.getTimezoneOffset()),b=Utils.convertDateToUserPattern(T),Crm.userDetails.TIME_FORMAT.indexOf(" ")>-1)if(T.toLocaleTimeString().indexOf(" ")>-1){C={FieldLabel:m,Value:b+" "+T.toLocaleTimeString()}}else{var S,I=(S=T.toLocaleTimeString()).substr(0,2);C={FieldLabel:m,Value:b+" "+(S=I>12?I%12+S.slice(2)+" "+I18n.getMsg("PM"):12==I?S+" "+I18n.getMsg("PM"):0==I?"12"+S.slice(2)+" "+I18n.getMsg("AM"):S+" "+I18n.getMsg("AM"))}}else if(T.toLocaleTimeString().indexOf(" ")<=-1)C={FieldLabel:m,Value:b+" "+T.toLocaleTimeString()};else C={FieldLabel:m,Value:b+" "+T.getHours()+":"+T.getMinutes()};else b||(b=""),C={FieldLabel:m,Value:b}}else C={FieldLabel:m,Value:null==(z=p[this.fieldList[g].Value]?p[this.fieldList[g].Value]:this.fieldList[g].Value)?this.fieldList[g].Default_Value:z},this.fieldList[g].Value_Color&&(C.Value_Color=this.fieldList[g].Value_Color);h[y]=C}if(h.length>0){var L=[];L[0]=h[1],void 0!==h[2]&&""!==h[2].Value&&(L[1]=h[2]),this.defaultDisplayFields=L,h[1]="",this.fieldLabelVsValue=h}}if(this.UpdatedFieldList=e.getAdditionalPropertyStartsWith("UpdatedFieldList"),void 0!==this.UpdatedFieldList){var M=[];s=0;for(var g in this.UpdatedFieldList)if(0==g.indexOf("UpdatedFieldList")){u=this.UpdatedFieldList[g].FieldLabel,v=this.UpdatedFieldList[g].FieldId,w=this.UpdatedFieldList[g].UITYPE,C={UpdatedFieldLabel:m=p&&v&&p[v]?p[v]:AcsApi.localizeI18NString(u,"CRM"),Value:this.UpdatedFieldList[g].Value,OldValue:this.UpdatedFieldList[g].Old_Value};if(209==w){switch(this.UpdatedFieldList[g].tagAction){case"addedTags":C.isAddition=!0;break;case"removedTags":C.isRemoval=!0;break;case"overWriteTags":C.isoverwrite=!0}var _=this.UpdatedFieldList[g].Value;_?C.isPlural=-1!=_.indexOf(","):C.isNULL=!0,C.isTagActionFeed=!0}else if(123===w&&"Tasks"===this.type){var k=this.UpdatedFieldList[g].Value,P=this.UpdatedFieldList[g].Old_Value;""!=k&&(k=k.split("*#")[0],k=I18n.getMsg(k.charAt(0).toUpperCase()+k.slice(1))),""!=P&&(P=P.split("*#")[0],P=I18n.getMsg(P.charAt(0).toUpperCase()+P.slice(1))),C={UpdatedFieldLabel:m,Value:k,OldValue:P}}else if(2!==w&&26!==w||!p)if(200!=w&&786!=w&&14!=w&&30!=w&&24!=w&&202!=w&&333!=w&&1234!=w&&(116!=w&&117!=w||null==this.UpdatedFieldList[g].bigintDTFormula&&null==this.UpdatedFieldList[g].bigintDateFormula))if(333==w||(116==w||117==w)&&null!=this.UpdatedFieldList[g].bigintDTFormula){F=this.UpdatedFieldList[g].Value,E=this.UpdatedFieldList[g].Old_Value,R=Utils.convertDateToUserPattern(F),U=Utils.convertDateToUserPattern(E);if(F=new Date(F),E=new Date(E),Crm.userDetails.TIME_FORMAT.indexOf(" ")>-1)if(F.toLocaleTimeString().indexOf(" ")>-1)O=R+" "+F.toLocaleTimeString(),x=U+" "+E.toLocaleTimeString();else{V=F.toLocaleTimeString(),B=E.toLocaleTimeString(),j=V.substr(0,2),H=B.substr(0,2);O=R+" "+(V=j>12?j%12+V.slice(2)+" "+I18n.getMsg("PM"):12==j?V+" "+I18n.getMsg("PM"):0==j?"12"+V.slice(2)+" "+I18n.getMsg("AM"):V+" "+I18n.getMsg("AM")),x=U+" "+(B=H>12?H%12+B.slice(2)+" "+I18n.getMsg("PM"):12==H?B+" "+I18n.getMsg("PM"):0==H?"12"+B.slice(2)+" "+I18n.getMsg("AM"):B+" "+I18n.getMsg("AM"))}else F.toLocaleTimeString().indexOf(" ")<=-1?(O=R+" "+F.toLocaleTimeString(),x=U+" "+E.toLocaleTimeString()):(O=R+" "+F.getHours()+":"+F.getMinutes(),x=U+" "+E.getHours()+":"+E.getMinutes());C=""==this.UpdatedFieldList[g].DTLong_New?{UpdatedFieldLabel:m,Value:"",OldValue:x}:""==this.UpdatedFieldList[g].DTLong_Old?{UpdatedFieldLabel:m,Value:O,OldValue:""}:{UpdatedFieldLabel:m,Value:O,OldValue:x}}else if(202==w||(116==w||117==w)&&null!=this.UpdatedFieldList[g].bigintDateFormula){var N=this.UpdatedFieldList[g].Value,D=this.UpdatedFieldList[g].Old_Value;R=Utils.convertDateToUserPattern(N),U=Utils.convertDateToUserPattern(D);C=""==this.UpdatedFieldList[g].DTLong_New?{UpdatedFieldLabel:m,Value:"",OldValue:U}:""==this.UpdatedFieldList[g].DTLong_Old?{UpdatedFieldLabel:m,Value:R,OldValue:""}:{UpdatedFieldLabel:m,Value:R,OldValue:U}}else w==CrmField.UITYPES.SERVICE_DURATION?C={UpdatedFieldLabel:m,Value:Handlebars.helpers.setServiceDuration(this.UpdatedFieldList[g].Value),OldValue:Handlebars.helpers.setServiceDuration(this.UpdatedFieldList[g].Old_Value)}:w==CrmField.UITYPES.SERVICE_TIMING?C={UpdatedFieldLabel:m,Value:CrmAcs.feedsValueEntryForCustomTiming(this.UpdatedFieldList[g].Value),OldValue:CrmAcs.feedsValueEntryForCustomTiming(this.UpdatedFieldList[g].Old_Value)}:w==CrmField.UITYPES.MULTI_DATE_SELECT?C={UpdatedFieldLabel:m,Value:CrmAcs.feedsValueEntryForSpecificDateRange(this.UpdatedFieldList[g].Value),OldValue:CrmAcs.feedsValueEntryForSpecificDateRange(this.UpdatedFieldList[g].Old_Value)}:w==CrmField.UITYPES.MULTI_MODULE_LOOK_UP_ENTITY&&(C={UpdatedFieldLabel:m,Value:CrmAcs.feedsAppointmentPolyLookupValue(this.UpdatedFieldList[g].Value),OldValue:CrmAcs.feedsAppointmentPolyLookupValue(this.UpdatedFieldList[g].Old_Value)});else{var F=this.UpdatedFieldList[g].DTLong_New,E=this.UpdatedFieldList[g].DTLong_Old;if(F=new Date(F),E=new Date(E),24==w||202==w||null!=this.UpdatedFieldList[g].bigintDateFormula){var R=Utils.convertDateToUserPattern(F),U=Utils.convertDateToUserPattern(E);C=""==this.UpdatedFieldList[g].DTLong_New?{UpdatedFieldLabel:m,Value:"",OldValue:U}:""==this.UpdatedFieldList[g].DTLong_Old?{UpdatedFieldLabel:m,Value:R,OldValue:""}:{UpdatedFieldLabel:m,Value:R,OldValue:U}}else{F=new Date(F.getTime()-6e4*F.getTimezoneOffset()),E=new Date(E.getTime()-6e4*E.getTimezoneOffset());var O,x,R=Utils.convertDateToUserPattern(F),U=Utils.convertDateToUserPattern(E);if(Crm.userDetails.TIME_FORMAT.indexOf(" ")>-1)if(F.toLocaleTimeString().indexOf(" ")>-1)O=R+" "+F.toLocaleTimeString(),x=U+" "+E.toLocaleTimeString();else{var V=F.toLocaleTimeString(),B=E.toLocaleTimeString(),j=V.substr(0,2),H=B.substr(0,2);O=R+" "+(V=j>12?j%12+V.slice(2)+" "+I18n.getMsg("PM"):12==j?V+" "+I18n.getMsg("PM"):0==j?"12"+V.slice(2)+" "+I18n.getMsg("AM"):V+" "+I18n.getMsg("AM")),x=U+" "+(B=H>12?H%12+B.slice(2)+" "+I18n.getMsg("PM"):12==H?B+" "+I18n.getMsg("PM"):0==H?"12"+B.slice(2)+" "+I18n.getMsg("AM"):B+" "+I18n.getMsg("AM"))}else F.toLocaleTimeString().indexOf(" ")<=-1?(O=R+" "+F.toLocaleTimeString(),x=U+" "+E.toLocaleTimeString()):(O=R+" "+F.getHours()+":"+F.getMinutes(),x=U+" "+E.getHours()+":"+E.getMinutes());C=""==this.UpdatedFieldList[g].DTLong_New?{UpdatedFieldLabel:m,Value:"",OldValue:x}:""==this.UpdatedFieldList[g].DTLong_Old?{UpdatedFieldLabel:m,Value:O,OldValue:""}:{UpdatedFieldLabel:m,Value:O,OldValue:x}}}else{var z=p[this.UpdatedFieldList[g].Value]?p[this.UpdatedFieldList[g].Value]:this.UpdatedFieldList[g].Value;P=p[this.UpdatedFieldList[g].Old_Value]?p[this.UpdatedFieldList[g].Old_Value]:this.UpdatedFieldList[g].Old_Value;C={UpdatedFieldLabel:m,Value:void 0===z?this.UpdatedFieldList[g].Default_Value:z,OldValue:void 0===P?this.UpdatedFieldList[g].Default_oldValue:P},this.UpdatedFieldList[g].Value_Color&&(C.Value_Color=this.UpdatedFieldList[g].Value_Color),this.UpdatedFieldList[g].Old_Value_Color&&(C.Old_Value_Color=this.UpdatedFieldList[g].Old_Value_Color)}M[s]=C,s++}this.updatedFieldLabelVsValue=M}}},CRM.Comment=function(e){var t=$("#showOneFeed");if($("#feedParentDiv").is(":visible")||t.length>0){this.ckey=e.getCkey(),this.cfdk=e.getCFDK(),this.type=e.getType(),this.content=e.getContent(),this.content=findReplaceURLWithinContent(showMentionedName(this.content)),this.by=e.getPostedBy().split(":")[0],this.at=e.getAt(),this.accessfrom=e.getAccFrom(),this.time=e.getAdditionalProperty("CommentTime"),this.aOwnerZuid=e.getAdditionalProperty("AOwnerZuid"),this.associateId=e.getAdditionalProperty("AssociateId"),this.notesId=e.getAdditionalProperty("NotesId"),this.associateModule=e.getAdditionalProperty("AssociateModule");var i=e.getAdditionalProperty("USERTYPE");this.aOwnerName="4"===i?e.getAdditionalProperty("AOWNERUSERNAME"):getNameByZuid(this.by).trim(),this.Latitude=e.getAdditionalProperty("Latitude"),this.Longitude=e.getAdditionalProperty("Longitude"),this.Address=e.getAdditionalProperty("Address"),Crm.userDetails.ZUID!==this.by||this.Address||(this.canDelete=!0),(e.getAdditionalProperty("AttachmentImages")||e.getAdditionalProperty("AttachmentFiles"))&&(this.cmt_attachmentImages=e.getAdditionalProperty("AttachmentImages"),this.cmt_attachmentFiles=e.getAdditionalProperty("AttachmentFiles")),this.commentId=e.getAdditionalProperty("commentId")}},CRM.I18NString={getString:function(e,t){switch(e){case"USER":var i=t.AOWNERZUID,o=t.AOWNERUSERID,n="4"===t.USERTYPE?t.USERNAME:getNameByZuid(i);return"<a href="+Crm.getCrmBasePath()+"/settings/users/"+o+' target=_blank class="feedowner">'+$ESAPI.encoder().encodeForHTML(n)+"</a>";case"USER_NOLINK":i=t.AOWNERZUID;return"4"===t.USERTYPE?t.USERNAME:$ESAPI.encoder().encodeForHTML(getNameByZuid(i));case"ENTITY":var a=t.ENTITYID,s=t.ENTITYMODULE,r=t.ENTITYNAME,l="";"Activities"==s?l=t.ENTITYSUBMODULE:Crm.isActivitySplitDone||"Activities"!=Crm.activityGrp[s]||(l=s,s="Activities");var d='<link-to lt-prop-route="crm.tab.module.entity" lt-prop-class="feedslinkClr" lt-prop-dp=\'["'+s+'","'+a+"\"]' ";return""!=l&&(d+='lt-prop-qp=\'{"sub_module":"'+l+"\"}' "),d+="lt-prop-target=_blank>"+r+"</link-to>";case"MODULE":return t.MODULENAME?tabSingLabelVsTranslatedSingLabel[t.MODULENAME]:t.ENTITYMODULE?moduleRecordMapping[t.ENTITYMODULE].plural_label:I18n.getMsg(t.MODULENAME);case"PARAMI18N":return I18n.getMsg(t.PARAM)}}},CRM._View={init:function(e){isShowMore=!0,$(".feed_blankstate").hide(),$(".feedtitle").show(),$(".feedfiltercontent").show()},initNotification:function(e){},initShowMore:function(e){},nodata:function(e){$(".feed_blankstate").hide(),$(".feedtitle").show(),$(".feedfiltercontent").show();var t='<div id ="noData" class="w100per feedsGrayclr aligncenter">'+I18n.getMsg("crm.data.not.available")+"</div>";$("#feedscontainer").append(t),isShowMore=!1,$("#feeds_loading").hide()},completed:function(e,t){isShowMore=!(t<25)},completedShowMore:function(e,t){isShowMore=!(t<25),isShowMoreReqSent=!1},renderTimeline:function(e,t,i,o,n,a){if($("#feeds_loading").hide(),n.length<=0){var s='<div class="w100per feedsGrayclr aligncenter">'+I18n.getMsg("crm.data.not.available")+"</div>";$("#feedscontainer_timeline").append(s),$("#feedscontainer").hide(),$("#feedscontainer_timeline").show()}for(var r=0;r<n.length;r++)try{var l=n[r];s=(0,Handlebars.templates.FeedsEntryTemplate)(l);$("#feedscontainer_timeline").append(s),$("#feedscontainer").hide(),$("#feedscontainer_timeline").show(),$("a.imageGallery").colorbox({photo:!0})}catch(e){}if(void 0!==a){s="<div onclick=\"AcsApi.timeline('CRM','"+e+"',15,'"+t+"','"+i+"','"+o+"','"+a+"'); this.style.display='none';\" id='more_"+t+"' class='aligncenter mT20 cP'>"+I18n.getMsg("crm.nsocial.tab.view.more")+"</div>";$("#feedscontainer_timeline").append(s)}}};var groupStatus,groupId,dateObj=-1;function getDateInUserTZ(e){return new Date(e-new Date(e).getTimezoneOffset())}function getUtcDateObj(e){var t=new Date(e),i=t.getTime(),o=6e4*t.getTimezoneOffset();return new Date(i+o)}function convertToTimeZone(e,t){return utc=e.getTime(),convertedDate=new Date(utc+36e5*t),convertedDate}function getDay(e){dateObj=new Date(Number(e)),curDateObj=new Date,dateObj=getDateInUserTZ(e);var t=getWeekDay(dateObj.getDay()),i=dateObj.getDate(),o=dateObj.getMonth(),n=dateObj.getFullYear(),a=curDateObj.getDate(),s=curDateObj.getMonth(),r=curDateObj.getFullYear(),l=new Array(31,28,31,30,31,30,31,31,30,31,30,31)[o],d=!1,c=!1,p=!1;if(n===r){if(o===s)a<i+7&&(d=!0,i===a?c=!0:i===a-1&&(p=!0));else if(o===s-1){l-i+a<7&&(d=!0,i===l&&1===a&&(p=!0))}}else if(n===r-1){if(11===o)l-i+a<7&&(d=!0,31===i&&1===a&&(p=!0))}return t=!0===d?!0===c?getHoursandMin("",!0):!0===p?I18n.getMsg("Yesterday")+" "+I18n.getMsg("crm.label.lowercase.at")+" "+getHoursandMin("",!0):t+" "+I18n.getMsg("crm.label.lowercase.at")+" "+getHoursandMin("",!0):getMonth(o)+" "+i+" "+(n!==r?", "+n:"")}function feedShowBulkRecords(e){if(!$("#notificationscontainer").hasClass("open")&&$("#feedpopupnew").is(":hidden")){var t,i;i=$(e).offset(),createShowOneFeedDiv(),t="<div class='SocialArrow'></div><div class='feedMassActionInnerDiv'>"+$(e).closest(".whichhappend").next().next().html()+"</div>",$("#showOneFeed_inner").html(t);var o=$("#showOneFeed");o.addClass("newpopup"),o.css({display:"block",width:"300px",padding:"15px",left:i.left,top:i.top+25})}}function fetchFeeds(e,t,i,o,n,a){$("#feedContainerDiv").removeClass("p0").removeAttr("style"),$("#feedParentDiv").css({height:"auto","margin-bottom":"20px"}),$(".feedsViewPage").removeClass("oH"),$("#feedsFollowUpCtn").hide(),$(".feedsHelp").show(),hidePulseInfoDiv(),$("#feeds_loading").show(),$(".feedGroupBg").show(),$(".feedselect").removeClass("feedselect"),$("#feedContainerDiv").removeClass("p0"),$(o).addClass("feedselect"),e==userFeedsPageKey?($("#feedTitle").text(I18n.getMsg("crm.feeds.userwall.title")),$("#feedModuleFilter").children(".svalue").find("#value").html(I18n.getMsg("crm.label.all"))):""!=t&&n?$("#feedTitle").html('<a href="javascript:;" class="gray2 feedtitle" onclick="fetchFeeds(\''+userFeedsPageKey+"','','',this,false,false);\">"+I18n.getMsg("crm.feeds.userwall.title")+'</a><span class="lightgray feedtitle"> /&nbsp;</span><a id="moduleTitle" class="black feedtitle" href="javascript:;" onclick="fetchFeeds(\''+e+"','"+$ESAPI.encoder().encodeForHTML($ESAPI.encoder().encodeForJavaScript(t))+"','',this,true,false);\">"+$ESAPI.encoder().encodeForHTML(t)+"</a>"):""==t||n||($("#feedTitle").html('<a href="javascript:;" class="gray2 feedtitle" onclick="fetchFeeds(\''+userFeedsPageKey+"','','',this,false,false);\">"+I18n.getMsg("crm.feeds.userwall.title")+'</a><span class="lightgray feedtitle"> /&nbsp;</span><a id="moduleTitle" class="black feedtitle" href="javascript:;" onclick="fetchFeeds(\''+e+"','"+escape(unescape(t))+"','',this,false,true);\">"+$ESAPI.encoder().encodeForHTML(unescape(t))+"</a>"),$("#feedModuleFilter").children(".svalue").find("#value").html(I18n.getMsg("crm.label.all"))),$("#timeLineTitle").html(""),""==t||n?$("#feed_status").attr("placeholder",I18n.getMsg("crm.feed.share.something")):$("#feed_status").attr("placeholder",I18n.getMsg("crm.feed.share.something.to")+" '"+unescape(t)+"'"),void 0!==i&&""!=i?($("#direct_msg").prop("checked",!0),$("#direct_msg_span").hide(),groupStatus=!0,groupId=i):($("#direct_msg").prop("checked",!1),groupStatus=!1),viewKey=e,$("#feedscontainer").html(""),void 0===InfoForDisplayWithLiteUsers?loadDataForDisplayAndMentions(!1,!0,!1,!0,(function(){AcsApi.initStream("CRM",viewKey,25)}),!0):AcsApi.initStream("CRM",viewKey,25),showHideModuleFilter(a),$("#feedscontainer_timeline").html(""),$("#feedscontainer_timeline").hide(),$("#feedscontainer").show(),$("#value").html(I18n.getMsg("crm.Now"))}function showFeedHoverDiv(e,t){$(e).width();$(e).find(".feedHoverInfoPopup").css({display:"block"})}function hideFeedHoverDiv(e){setTimeout((function(){$("div[id='"+e+"']").hide()}),300)}function setFeedTextAreaHeight(e){var t=$(e),i=e.scrollHeight,o=i>35?i:"";$("#showOneFeed").is(":visible")&&setPerfectScrollBar("showOneFeed","showOneFeed_inner"),t.css("cssText","height:"+o+"px !important;")}function hidefeedButtonLayer(e){var t=$(e).closest(".feedButtonLayer"),i=t.parent().find("textarea"),o=$L(e).closest("#commentsDiv").find("textarea").prop("id");Notes.destroyMentionsComponent(o),Notes.feedCommentsContent="",i.val(""),t.hide(),$("#feed_status").removeClass("feed_statusHset"),setFeedTextAreaHeight(i)}function showCreateGroupFromFeed(){var e=Crm.getCrmBasePath()+"/Group.do?action=newGroup&isFromFeed=true";mR(e,(function(e){var t=$("#feedsLookupDiv");e="<div class='posabs dbBtnClose newPopupCloseIcon svgIcons ico-close op05 dIB cP tr30 mR10' style='margin-top:8px;' onclick='javascript:$(this).parent().hide();removeFreezeLayer();'></div>"+e,t.empty(),t.attr("class","newPopup ppTop p0 newPopupStyleEle"),t[0].innerHTML=e,Territory.showTerritoryPopup("feedsLookupDiv"),EvalInnerScript(getElemById("feedsLookupDiv"))}))}function callEditGroup(e){var t=Crm.getCrmBasePath()+"/Group.do?action=editGroup&isFromFeed=true&groupId="+e,i=$("#feedsLookupDiv");mR(t,(function(e){i.empty(),i[0].innerHTML=e,Territory.showTerritoryPopup("feedsLookupDiv"),i.addClass("zcrm-show"),EvalInnerScript(getElemById("feedsLookupDiv"))}))}function showHideModuleFilter(e){e?($("#optionalWall").val("orgwall"),$("#groupSelect").hide(),$("#feedModuleFilter").hide()):($("#feedModuleFilter").show(),$("#groupUsers").hide(),$("#groupSelect").show())}function showFeedDeleteActionMenu(e){var t=$(".feedDeleteAction"),i=$(".feedboxDelete"),o=$(e).closest(".feedbox");i.removeClass("feedboxdeleteActive"),t.is(":visible")||i.removeClass("feedboxdeleteActive"),t.css({display:"none"}),o.find(".feedDeleteAction").css({display:""}),$(e).addClass("feedboxdeleteActive"),$(".feed_newpost_textarea_bg").removeClass("openNotes")}function findReplaceURLWithinContent(e){return e=e.replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,"<a href='$1' target='_blank'  rel='noopener noreferrer'  class='feed_post_content_link'>$1</a>")}function hideDropzone(){$(".feedsViewPage .feed_newpost_textarea_bg").removeClass("openNotes"),$("#feedDropzone").removeClass("attachzone"),$("#dropzonediv").hide(),$("#dropzonePreview").hide()}function searchMember(){var e=$("#memSearch").val().trim().toLowerCase(),t=$("#memberName.isactive,.issearch");currSechExtMatCnt=0;for(var i=0;i<t.length;i++){var o=t[i],n=o.innerHTML.toLowerCase();""==e||-1!=n.indexOf(e)?($(o).addClass("isactive").removeClass("issearch").show(),$(o).parent().show(),$(o).parent().siblings().show(),n.trim()===e&&currSechExtMatCnt++):($(o).removeClass("isactive").addClass("issearch").hide(),$(o).parent().hide(),$(o).parent().siblings().hide())}setPerfectScrollBar("feed_member_popup_outer","feed_member_popup_inner")}function groupChange(){var e=$("#optionalWall").val(),t=$("#optionalWall option:selected").text();"orgwall"==e?($("#groupUsers").html(""),groupStatus=!1):(groupStatus=!0,groupId=e,getZuidsForGroupId(e,t))}function setPerfectScrollBar(e,t){var i=$("#"+e);if(1==i.length){i.perfectScrollbar("destroy");var o=i[0].scrollHeight;$("#"+t).css({height:"1px"}),$("#"+t).css({height:"auto"}),$("#"+t).css({height:o}),i.css({overflow:"hidden"}),i.perfectScrollbar()}}function setPerfScrollBar(e,t){var i=$("#"+e);if(1==i.length){i.perfectScrollbar("destroy");var o=i[0].scrollHeight+10;$("#"+t).css({height:o}),i.css({overflow:"hidden"}),i.perfectScrollbar()}}function feedIEAttachment(e){return withAttach=!1,checkAttachFile(null,null,"status",null,e,!0),$("#form_status")[0].setAttribute("action",Crm.getCrmBasePath()+"/feedFileAttach.do?"+globalparam),withAttach&&$("#form_status").submit(),fileCount=0,$("#addAttachment_status").html($("#addAttachment_duplicate").html()),!0}function oneFeedFromMail(e){if("deleted"!==e.resultstatus&&"unauthorised"!==e.resultstatus){var t=new Activity(e);t=new CRM.Activity(t),o="<div class='p30' onclick='sE()'><div class='posAbs dbBtnClose svgIcons ico-close op05 dIB cP' onclick=hide('feedpopupnew');$('#feedpopupnew').css({'width':'auto','height':'auto'});removeFreezeLayer()></div>"+(o=(0,Handlebars.templates.FeedsEntryTemplate)(t))+"</div>",$("#feedpopupnew").html(o),$("#feedpopupnew a.imageGallery").colorbox({photo:!0}),$("#feedpopupnew").show(),$("#feedpopupnew").find(".feedMassActionDiv").show();var i=$(window).height();$("#feedpopupnew").css({width:"700px",height:i-100,overflow:"auto"}),freezeBackground(),mailsetCenter("feedpopupnew"),$("#feedpopupnew").click((function(){sE()})),setPerfectScrollBar("feedpopupnew","feedpopupnew_inner")}else{if("deleted"===e.resultstatus)var o="<div class='p30'>"+I18n.getMsg("crm.alert.content.cannot.access.record",I18n.getMsg("crm.feed.tab.name"))+"</div>";else o="<div class='p30 wbBreakWord lh20'>"+I18n.getMsg("crm.contact.hierarchy.business_card_permission_error")+"</div>";o="<div class='p30' onclick='sE()'><div class='posAbs dbBtnClose svgIcons ico-close op05 dIB cP' onclick=hide('feedpopupnew');removeFreezeLayer()></div>"+o+"</div>",$("#feedpopupnew").html(o),$("#feedpopupnew").show(),freezeBackground(),mailsetCenter("feedpopupnew"),$("#feedpopupnew").click((function(){sE()}))}}function setfFeedsGroupContainerHeight(){$("#feedsGroupContainer").length>0&&setPerfectScrollBar("feedsGroupContainer_inner")}function setFeedFollowUp(){var e=$(window).height()-$("#feedParentDiv").offset().top;$("#feedParentDiv").css({width:$(".topdivcontainer").width()+"px","min-height":"auto","margin-bottom":"0px",overflow:"hidden"}),$("#pulseInfoWrap").css({height:e+"px"}),thirdPartyUtils.unbindPerfectScroll("#pulseInfoWrap"),thirdPartyUtils.bindPerfectScroll("#pulseInfoWrap",{wheelSpeed:1,wheelPropagation:!0,suppressScrollX:!1})}function showPulseInfoDiv(e){$(".feedGroupBg").hide(),$("#groupUsers").hide(),$("#feedsviewKeyId").hide(),$("#pulseInfoWrap").show(),$(".feedLeftMenu").removeClass("feedselect"),$(".feedlItems li").removeClass("feedselect"),$(e).addClass("feedselect")}function hidePulseInfoDiv(){$("#feedsviewKeyId").show(),$("#pulseInfoWrap").hide()}function hideAttachError(){$("#showErrorMsg").html("")}function checkAttachFile(e,t,o,n,a,s){if($(a).find("div[id='addAttachment_"+o+"']").find("#attachcrmKVFiles").is(":visible")&&!s)return addNoteFromFeed(e,t,o,n,a),!0;if($(a).find("div[id='addAttachment_"+o+"']").find("#attachcrmKVFiles").is(":visible")&&s)return addFeedStatus(),!0;var r;"[object Array]"===Object.prototype.toString.call($(a)[0].thefile)?(r=$(a)[0].thefile.length,alert(r)):r=1;var l=0;if(0===(r-=1)){if(""==trimBoth($(a)[0].thefile[0].value))return alert(I18n.getMsg("crm.label.no.attach.alert")),!1;if("application/x-ms-dos-executable"==(d=$(a)[0].thefile[0].files[0].type))return alert(I18n.getMsg("crm.label.invalid.attach.alert")),!1;l+=$(a)[0].thefile[0].files[0].size}for(i=0;i<r;i++){if(""==trimBoth($(a)[0].thefile[i].value))return alert(I18n.getMsg("crm.label.no.attach.alert")),!1;var d;if("application/x-ms-dos-executable"==(d=$(a)[0].thefile[i].files[0].type)||"application/x-msdownload"==d)return alert(I18n.getMsg("crm.label.invalid.attach.alert")),!1;l+=$(a)[0].thefile[i].files[0].size}if(l>1024*attachLimit*1024){var c=[];return c[0]=attachLimit,alert(I18n.getMsg("crm.attach.restriction.relatedlist",c)),!1}return s?(withAttach=!0,addFeedStatus()):addNoteFromFeed(e,t,o,n,a),!0}function addTkvFile(e,t){$(e.form).find("div[id='addAttachment_"+t+"']").find("#addAttachmentCtnNewFeeds").addClass("show");var i=document.createElement("input"),o=$(e.form).find("div[id='addAttachment_"+t+"']").find("#desktop")[0];i.setAttribute("type","file"),i.setAttribute("name","thefile"),i.setAttribute("style","background: none;top: 7px;height: 20px;"),i.setAttribute("class","smFile filekv0"),i.onchange=function(){hideAttachError(),addTkvFile(this,t)},o.appendChild(i);var n=$.trim($(e).val()).replace(/^.*[\\\/]/,""),a=$("<div>",{class:"tkvFileName flexAlignCenter"});if(null!=$(e.form).find("div[id='addAttachment_"+t+"']").find('[name="thefile"]')[fileCount]){null!=$(e.form).find("div[id='addAttachment_"+t+"']").find('[name="thefile"]')[fileCount].files[0]&&(fileSizeEx=$(e.form).find("div[id='addAttachment_"+t+"']").find('[name="thefile"]')[fileCount].files[0].size);var s=1e3,r=["Bytes","KB","MB","GB","TB"];if(0===fileSizeEx)return"0 Bytes";var l=parseInt(Math.floor(Math.log(fileSizeEx)/Math.log(s)),10);(fileSizeEx/Math.pow(s,l)).toPrecision(3);fileSize="- ("+(fileSizeEx/Math.pow(s,l)).toPrecision(3)+" "+r[l]+")";$("<span>",{class:"fL kanbanviewImages tkvAttachmentDoc"});var d=$("<span>",{class:"flNameSize mR10",html:$ESAPI.encoder().encodeForHTML(n)+" "+fileSize}),c=$("<span>",{class:"cP"}),p=$("<crmutil-icon>",{"icon-class":"zcicn-delete-md zcicn12 crmBaseIcon","icon-name":"delete-line"});c.click((function(){closeEl=$(this),closeEl.parent(".tkvFileName").remove(),--fileCount>0?($(e.form).find("div[id='addAttachment_"+t+"']").find(".addAttachmentCtnNewFeeds .popupfooterClass").removeClass("hide"),$(e.form).find("div[id='addAttachment_"+t+"']").find("#attachcrmKVFiles").addClass("hide"),$(e.form).find("div[id='addAttachment_"+t+"']").find("#attachcrmKVMoreFiles").removeClass("hide")):($("div[id='addAttachment_"+t+"']").find(".addAttachmentCtnNewFeeds .popupfooterClass").removeClass("show"),$("div[id='addAttachment_"+t+"']").find("#attachcrmKVMoreFiles").addClass("hide"),$("div[id='addAttachment_"+t+"']").find("#attachcrmKVFiles").removeClass("hide")),fileCount<=4&&$(e.form).find("div[id='addAttachment_"+t+"']").find("#desktop").show(),-1===fileCount&&(fileCount=0),$(e).remove()})),fileCount>0?$(e.form).find("div[id='addAttachment_"+t+"']").find(".addAttachmentCtnNewFeeds .popupfooterClass").removeClass("hide"):$(e.form).find("div[id='addAttachment_"+t+"']").find(".addAttachmentCtnNewFeeds .popupfooterClass").addClass("hide"),fileCount<=4&&$(e.form).find("div[id='addAttachment_"+t+"']").find("#desktop").show(),a.append(d),a.append(c),c.append(p),$(e.form).find("div[id='addAttachment_"+t+"']").find("#tkvMoreFiles").append(a)}if(++fileCount>0&&($(e.form).find("div[id='addAttachment_"+t+"']").find(".addAttachmentCtnNewFeeds .popupfooterClass").removeClass("hide"),$(e.form).find("div[id='addAttachment_"+t+"']").find("#attachcrmKVFiles").addClass("hide"),$(e.form).find("div[id='addAttachment_"+t+"']").find("#attachcrmKVMoreFiles").removeClass("hide")),fileCount>4)return $(e.form).find("div[id='addAttachment_"+t+"']").find("#desktop").hide(),!1}function remove(e){var t=getObj("tb"+e);getObj("contenttab").removeChild(t),getObj("attachMore").style.display="block";for(var i=e+1;i<fileCount;i++)getObj("tb"+i).id="tb"+(i-1),getObj("del"+i).setAttribute("href","javascript:remove("+(i-1)+")"),getObj("del"+i).id="del"+(i-1);fileCount--}function initDropZone(){Dropzone.options.feedDropzone={autoProcessQueue:!1,previewsContainer:".dropzone-previews",uploadMultiple:!0,parallelUploads:5,url:"dummy",maxFiles:5,uploadMultiple:!0,maxFilesize:4,paramName:"file",addRemoveLinks:!0,clickable:"#dropzonePreview",init:function(){var e=this;$("#save_status").click((function(t){t.preventDefault(),t.stopPropagation(),e.processQueue()})),this.on("addedfile",(function(e){withAttach=!0,$("#save_status_div").removeAttr("style"),$("#save_status_div").attr("style","height:40px !important")})),this.on("reset",(function(e){withAttach=!1,$("#save_status_div").removeAttr("style"),$("#save_status_div").attr("style","height:40px")})),this.on("processingmultiple",(function(e){this.options.url=Crm.getCrmBasePath()+"/feedFileAttach.do?"+globalparam,globalparam=""})),this.on("successmultiple",(function(t){document.getElementById("feed_status").value="",e.removeAllFiles(),$("#save_status_div").removeAttr("style"),$("#save_status_div").attr("style","height:0px")})),$("#cancel_status").click((function(){withAttach=!1,e.removeAllFiles(),$("#save_status_div").hide()})),this.on("drop",(function(e){$("#feedDropzone").addClass("attachzone"),$("#dropzonePreview").show()}))}},Dropzone.discover()}function changeModuleFeedAutoFollow(e){var t=Crm.getCrmBasePath()+"/AutoFollowUp.do?action=newFollowUp&module="+e+"&mode=changeMod";mR(t,(function(t){var i=getElemById("critDiv");$(i).empty(),i.innerHTML=t,EvalInnerScript(i);var o=getElemById("module_whom");if(null!=o){var n=I18n.getMsg(moduleRecordMapping[e].plural_label);$(o).empty(),o.innerHTML=I18n.getMsg("crm.feeds.follow.module.whom",n)}}))}function loadFeedJS(){networkUtils.loadFeatureScripts(["zohocrm_feedsTemplate.js"],(function(){}))}function showFeedPreference(){var e=Crm.getCrmBasePath()+"/AutoFollowUp.do";(new crmRequestPool).initiate({action:e,data:{action:"getFeedPreference"},dataType:"json",success:function(e){Crm.isActivitySplitDone&&(e.isActivitySplitDone=!0);var t=(0,Handlebars.templates.FeedsPreference)(e);$("#feedsPreferenceDiv").html(t),crmui.showPopup("feedsPreferenceDiv");var i=document.querySelectorAll(".feed_pref_info")[0].offsetHeight,o=document.querySelectorAll(".feeds_advInfo")[0].offsetHeight,n=document.querySelectorAll(".feedsPreference_pp_content")[0].offsetHeight-o-i;$(".feeds_content").css({"max-height":n+"px"}),applyShadowFeedPreference()}})}function applyShadowFeedPreference(){var e=document.getElementById("feedsModulePreferenceDiv"),t=e.scrollHeight,i=e.offsetHeight,o=e.scrollTop;o>0?$(e).css("box-shadow","inset 0 14px 6px -14px rgba(0, 0, 0, 0.2)"):$(e).css("box-shadow","none"),t<=Math.round(i+o)?$("#automatedFeedsUpdate").css("box-shadow","none"):$("#automatedFeedsUpdate").css("box-shadow","0px -14px 6px -14px rgba(0, 0, 0, 0.2)")}function updateFeedPreference(){var e=new crmRequestPool,t="";$("#feedsModulePreferenceDiv input:checked").each((function(){t=t+this.value+";"}));var i="";$("#feedsModulePreferenceDiv input:checkbox:not(:checked)").each((function(){i=i+this.value+";"}));var o=!0;$("#automatedFeedsUpdate input:checkbox").is(":checked")||(o=!1);var n="&";n=(n=n+csrfParamName+"="+encodeURIComponent(csrfToken)+"&")+"sellist="+encodeURIComponent(t)+"&unsellist="+encodeURIComponent(i)+"&isAutomatedEnabled="+encodeURIComponent(o);var a=Crm.getCrmBasePath()+"/AutoFollowUp.do?action=updateFeedPreference";e.initiate({action:a,data:n,dataType:"json",success:function(e){}}),crmui.hidePopup("feedsPreferenceDiv")}getWeekDay=function(e){return new Array(I18n.getMsg("Sunday"),I18n.getMsg("Monday"),I18n.getMsg("Tuesday"),I18n.getMsg("Wednesday"),I18n.getMsg("Thursday"),I18n.getMsg("Friday"),I18n.getMsg("Saturday"))[e]},getMonth=function(e){return new Array(I18n.getMsg("January"),I18n.getMsg("February"),I18n.getMsg("March"),I18n.getMsg("April"),I18n.getMsg("May"),I18n.getMsg("June"),I18n.getMsg("July"),I18n.getMsg("August"),I18n.getMsg("September"),I18n.getMsg("October"),I18n.getMsg("November"),I18n.getMsg("December"))[e]},getHoursandMin=function(e,t){var i=dateObj;void 0!==e&&""!==e&&(i=new Date(Number(e)));var o=i.getHours(),n=i.getMinutes(),a="";return"hh:mm a"==Crm.userDetails.TIME_FORMAT?(a+=o>12?o-12:0===o?"12":o,a+=(n<10?":0":":")+n,!1!==t&&(a+=o>=12?" "+I18n.getMsg("PM"):" "+I18n.getMsg("AM"))):(o<10&&(o="0"+o),n<10&&(n="0"+n),a=o+":"+n),a},formatTime=function(e,t){var i=dateObj;void 0!==e&&""!==e&&(i=new Date(Number(e)));var o=i.getDate(),n=getMonth(i.getMonth()),a=i.getFullYear(),s=i.getHours(),r=i.getMinutes(),l="";l+=o+" ",l+=n+" ",l+=a+" ",t&&(l+=I18n.getMsg("crm.label.lowercase.at")+" ");var d=s>12?s-12:0===s?"12":s;return l+=(d<10?"0":"")+d,l+=(r<10?":0":":")+r,l+=s>=12?" "+I18n.getMsg("PM"):" "+I18n.getMsg("AM")},CrmAcs.showElem=function(e){var t=$("#"+e);t.length>0&&t.slideToggle();var i=$("#entParamImg");i.hasClass("tw-arwup")?i.removeClass("tw-arwup"):i.addClass("tw-arwup")},CrmAcs.feedsValueEntryForSpecificDateRange=function(e){for(var t=e.length,i="",o=0;o<t;o++)i+=Utils.getDateInUserDatePattern(new Date(e[o])),o<t-1&&(i+=", ");return i},CrmAcs.feedsAppointmentPolyLookupValue=function(e){return' "'+(e=JSON.parse(e)).module+'" - "'+e.value+'" '},CrmAcs.feedsValueEntryForCustomTiming=function(e){if("Same as business time"==e||e==I18n.getMsg("crm.service.servicetiming.business"))return I18n.getMsg("crm.service.servicetiming.business");"string"==typeof e&&(e=JSON.parse(e));for(var t="",i=e.length,o=0;o<i;o++)1==o&&(t+=" , "),t+="HH:mm"==Crm.userDetails.TIME_FORMAT?e[o].From+" - "+e[o].To:CrmDateUtils.convertTimeTo12HourFormat(e[o].From)+" - "+CrmDateUtils.convertTimeTo12HourFormat(e[o].To);return t},$("body").click((function(e){var t=e.target;$(t).parents(".feedDropzonetd").length>0&&!$(t).hasClass("bt-mediumnewgraybtn")?$("#feed_status").closest(".feed_newpost_textarea_bg").addClass("openNotes"):$("#feed_status").closest(".feed_newpost_textarea_bg").removeClass("openNotes")})),org.owasp.esapi.ESAPI.initialize();var Telephony=function(){};Telephony.providerNameList=[],Telephony.usermailList=[],Telephony.currentCtikey="",Telephony.url=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",Telephony.countryData={},Telephony.saveKeyValue=function(){var e=$("#zpbkeyname").val(),t=$("#zpbkeyval").val(),i=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",o="action=saveKeyValue&keyname="+encodeURIComponent(e)+"&keyvalue="+encodeURIComponent(t)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);$.ajax({url:i,type:"POST",data:o,success:function(e){"success"===e?($("#zpbkeyname").val(""),$("#zpbkeyval").val(""),Telephony.showLoading("Keys Added Successfully","success")):Telephony.showLoading("There was an error..","failure"),Telephony.hideLoading()},error:function(e){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","falilure")}}),Telephony.hideLoading()},Telephony.assignActions=function(){$("#tabs").tabs({select:function(e,t){var i=t.index;$(t.tab).text();3==i&&Telephony.showProviderList($("#providerSelectList"))}}),$("#tabs-1 #search").on("keyup",(function(e){$("#showMoreData").hide(),Telephony.searchProviders($(this))})),$("#tabs-4 #provSearchList").on("keyup",(function(e){Telephony.searchProviderNameInProviderOrder($(this))})),$("#tabs-3 #providerNameforCount").on("keyup",(function(e){Telephony.searchProviderNameInPhoneNumberCountTab($(this))})),$("#tab1").on("click",(function(){Telephony.getAllProvidersList()})),$("#tab12").on("click",(function(){Telephony.getAllWidgetsList()})),$("#tab3").on("click",(function(){Telephony.getPhonenumberCountDetails()})),$("#tab8").on("click",(function(){Telephony.configurePBX()}))},Telephony.getPhonenumberCountDetails=function(){$("#tabs-3 tr.dummyclass").remove();var e=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",t="action=showPhonenumbersCount&"+csrfParamName+"="+encodeURIComponent(csrfToken);Telephony.showLoading("Loading..","loading"),$.ajax({url:e,type:"POST",data:t,success:function(e){var t=JSON.parse(e);if("FAILURE"===t.result)Telephony.showLoading("Failure","failure");else{var i=t.numbercount,o=t.accountcount,n=JSON.parse(i),a=JSON.parse(o);$.each(n,(function(e,t){var i="";i+="<tr data-infoKey='"+$ESAPI.encoder().encodeForHTMLAttribute(e)+"' class='dummyclass'><td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(e)+"</td>",i+="<td class='rowSpan'>"+t+"</td>",i+="<td class='rowSpan'>"+a[$ESAPI.encoder().encodeForJavaScript(e)]+"</td>",i+="</tr>",$("#countContent").append(i)}))}},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","failure")}}),Telephony.hideLoading()},Telephony.searchProviderNameInPhoneNumberCountTab=function(e){var t=$.trim($(e).val().toLowerCase());if(t.length>0)$.each($("#tabs-3 tr.dummyclass"),(function(){var e=$(this).data("infokey")+"";-1!=$.trim(e.toLowerCase()).indexOf(t)?$(this).show():$(this).hide(),$("#countRow tr.dummyclass:visible").length>0?$("#countRow #norecord").closest("tr").remove():($("#countRow #norecord").closest("tr").remove(),$("div #countRow").append("<tr><td colspan='10'><div id='norecord' style='text-align:center;width:100%;padding: 50px 0 0 0;font-weight: bold;font-size: large;'> No records present</div></td></tr>"))}));else $("#countRow #norecord").closest("tr").remove(),$("#tabs-3 tr.dummyclass").show()},Telephony.searchProviders=function(e){$("#norecord").text(""),$("#dataRow tr:first").show();var t=$.trim($(e).val().toLowerCase());if(t.length>0){$.each($("#tabs-1 td.bridgeName"),(function(e){var i=$.trim($(this).html().toLowerCase()),o=$.trim($(this).closest("td").next("td").html().toLowerCase());-1!=i.indexOf(t)||-1!=o.indexOf(t)?$(this).closest("tr").show():$(this).closest("tr").hide()}));$("#dataRow tr:visible").length<=1?($("#norecord").text("No records present"),$("#dataRow tr:first").hide()):($("#norecord").text(""),$("#dataRow tr:first").show())}else $("#norecord").text(""),$("#tabs-1 tr").show()},Telephony.searchProviderNameInProviderOrder=function(e){var t=$.trim($(e).val().toLowerCase());if(t.length>0)$.each($("#tabs-4 tr.dummyclass"),(function(){var e=$(this).data("infokey")+"";-1!=$.trim(e.toLowerCase()).indexOf(t)?$(this).show():$(this).hide(),$("#provOrderRow tr.dummyclass:visible").length>0?$("#provOrderRow #norecord").closest("tr").remove():($("#provOrderRow #norecord").closest("tr").remove(),$("#provOrderRow").append("<tr><td colspan='10'><div id='norecord' style='text-align:center;width:100%;padding: 50px 0 0 0;font-weight: bold;font-size: large;'> No records present</div></td></tr>"))}));else $("#provOrderRow #norecord").closest("tr").remove(),$("#tabs-4 tr.dummyclass").show()},Telephony.getCustomerDetails=function(){var e=$("#customervalue").val(),t=$("#customervaluetype").val(),i=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",o="action=getCustomerDetails&customervalue="+encodeURIComponent(e)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&customervaluetype="+encodeURIComponent(t);Telephony.showLoading("Loading..","loading"),$.ajax({url:i,type:"POST",data:o,success:function(t){var i=JSON.parse(t);if($("#revokeBtnSpan, #revokeZTISpan, #topInfo, #zgidDetailsNoRecord, #topzgidcontent, #phonenumberFromRedis, #accountConf, #detailinRedis, #agentTab").hide(),$("#portalDetailsDiv tr.dummyclass,div.dummyclass,#phonenumberFromRedis tr.dummyclass,#accountConf tr.dummyclass,#detailinRedis tr.dummyclass").remove(),$("#zgidofmail").text(""),"SUCCESS"===i.result)if(i.hasOwnProperty("phonedet")){var o=i.phonedet,n="<tr class='rowSpan dummyclass'><td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(o.ctiname)+"</td><td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(""+o.zgid)+"</td></tr>";$("#phonenumberFromRedis table").append(n),$("#phonenumberFromRedis").show(),i.custzgid!=e?($("#zgidofmail").text(i.custzgid),$("#topzgidcontent").show()):$("#topzgidcontent").hide(),"ZTI"===i.comment?(document.getElementById("revokeZTIBtn").setAttribute("onclick","Telephony.revokeZTIDisabledGroup("+i.custzgid+")"),$("#revokeZTISpan").show()):"phonebridge"===i.comment&&(document.getElementById("revokeBtn").setAttribute("onclick","Telephony.revokeTelephony("+i.custzgid+")"),$("#revokeBtnSpan").show())}else if(i.hasOwnProperty("redisval")){var a=i.redisval,s="";$.each(a,(function(e,t){"authtoken"!=e&&(s+="<tr class='dummyclass'>",s+="<td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(e)+"</td><td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(t)+"</td>",s+="</tr>")})),$("#detailinRedis table").append(s),$("#detailinRedis").show()}else{if(i.hasOwnProperty("accountInfo")){var r=i.accountInfo,l="<tr style='background:#eee;' class='dummyclass'>",d="<tr class='dummyclass'>";$.each(r,(function(e,t){"authtoken"!=e&&""!=t&&(l+="<th class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(e)+"</th>",d+="<td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(t)+"</td>")}));var c=(l+="</tr>")+(d+="</tr>");$("#accountConf table").append(c),$("#accountConf").show()}if(i.custzgid!=e?($("#zgidofmail").text(i.custzgid),$("#topzgidcontent").show()):$("#topzgidcontent").hide(),i.hasOwnProperty("providername")&&(i.providername.length<15?$("#zgidProviderName").text($ESAPI.encoder().encodeForHTML(i.providername)):($("#zgidProviderName").text($ESAPI.encoder().encodeForHTML(i.providername.substring(0,12)+"...")),$("#zgidProviderName").attr("title",$ESAPI.encoder().encodeForHTML(i.providername)))),$("#topInfo #totalUsers").text("0"),i.hasOwnProperty("users")){var p="",u=i.users,m=0;"twilio"===i.providername&&($.each(u,(function(e,t){m++,Telephony.usermailList.push(e),p+="<tr class='dummyclass'><td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(t.mailid)+"</td><td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(e)+"</td>",p+="<td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(t.status)+"</td></tr>",Telephony.usermailList[e]=t.mailid})),$("#userRow #twilioProvider").show(),$("#userRow #otherProviders").hide()),$("#userRow").append(p),$("#topInfo #totalUsers").text(m),$("#agentTab").show()}if(i.hasOwnProperty("ctinumber")){$("#phoneDetails").show();var h=i.ctinumber,f=0;$.each(h,(function(e,t){var i=e,o="";f++;var n="<h3 style='text-decoration:underline;width:150px;'>"+$ESAPI.encoder().encodeForHTML(i)+"</h3>",a="<div style='width:95%;'><table id='ivrdetails"+f+"' style='width:95%;border-collapse: collapse;border-spacing: 0;border-color: #808080;font-family: sans-serif;font-size:1.2rem;color: #5c5c5c;margin-left:40px;margin-bottom:10px'>",s="<table style='width:95%;border-collapse: collapse;border-spacing: 0;border-color: #808080;font-family: sans-serif;font-size:1.2rem;color: #5c5c5c;margin-left:40px;padding-bottom:2%'><tbody>";s+="<tr style='background:#eee'><th class='rowHeaderSpan'>Key</th><th class='rowHeaderSpan'>Value</th></tr>";$.each(t,(function(e,t){if("ivrdetails"===e)o=t;else{var i="<td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(e)+"</td><td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(t)+"</td>";s+="<tr>"+i+"</tr>"}})),n+=a+"</table>",n+=s+="</tbody></table></div>",$("#portalDetailsDiv #accordion ").append(n).show(),""!=o&&Telephony.formIVRNextLevelDetail(o,f,0,1,1)})),$("#portalDetailsDiv #accordion").accordion({heightStyle:"content",collapsible:!0,autoHeight:!0,active:!1})}else $("#phoneDetails").hide();"ZTI"===i.comment?(document.getElementById("revokeZTIBtn").setAttribute("onclick","Telephony.revokeZTIDisabledGroup("+i.custzgid+")"),$("#revokeZTISpan").show()):"phonebridge"===i.comment&&(document.getElementById("revokeBtn").setAttribute("onclick","Telephony.revokeTelephony("+i.custzgid+")"),$("#revokeBtnSpan").show()),$("#agentDetails").show(),$("#topInfo, #portalDetailsDiv").show(),$("#zgidDetailsNoRecord").hide()}else $("#revokeBtnSpan, #topInfo, #portalDetailsDiv").hide(),$("#portalDetailsDiv tr.dummyclass, div.dummyclass").remove(),$("#zgidDetailsNoRecord").text("No such Account/Phone Number"),$("#revokeZTISpan, #zgidDetailsNoRecord").show();Telephony.hideLoading()},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","failure")}}),Telephony.hideLoading()},Telephony.formIVRNextLevelDetail=function(e,t,i,o,n){var a="";try{a=JSON.parse(e)}catch(t){a=$(e).attr("details"),a=JSON.parse(a)}t=t||$(e).attr("num"),n=n||$(e).attr("preconfig")||$(e).attr("config");var s="<tr level='"+$ESAPI.encoder().encodeForHTMLAttribute(""+o)+"' config='"+$ESAPI.encoder().encodeForHTMLAttribute(""+n)+"' style='background:#eee;'><th colspan='3' class='rowHeaderSpan'> LEVEL "+$ESAPI.encoder().encodeForHTML(""+o)+"</th></tr>";s+="<tr level='"+$ESAPI.encoder().encodeForHTMLAttribute(""+o)+"' config='"+$ESAPI.encoder().encodeForHTMLAttribute(""+n)+"' style='background:#eee;'><th class='rowHeaderSpan'>IVR Extn</th><th class='rowHeaderSpan'>IVR Msg</th><th class='rowHeaderSpan'>Action</th></tr>";var r=0;$.each(a,(function(e,i){if("0"!=e){if(s+="<tr level='"+$ESAPI.encoder().encodeForHTMLAttribute(""+o)+"' config='"+$ESAPI.encoder().encodeForHTMLAttribute(""+n)+"'><td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(i.presskey)+"</td>",s+="<td class='rowSpan'>"+$ESAPI.encoder().encodeForHTML(i.menu)+"</td>","user"===i.actiontype){var a=i.action.salesReps;s+="<td class='rowSpan'>";for(var l=0;l<a.length;l++)s+=a[l]+"("+Telephony.usermailList[a[l]]+")  ";s+="</td>"}else if("ivr"===i.actiontype){r++;var d=n+""+r,c=o+1;s+="<td class='rowSpan ivrConfLink' config='"+$ESAPI.encoder().encodeForHTMLAttribute(""+d)+"' details='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(i.action))+"' num='"+t+"' onclick='Telephony.formIVRNextLevelDetail(this, "+t+", "+o+", "+c+", "+d+")'>Click for Next Level IVR</td>"}s+="</tr>"}}));var l=(n=""+n).slice(0,-1);s+="<tr level='"+$ESAPI.encoder().encodeForHTMLAttribute(""+o)+"' config='"+$ESAPI.encoder().encodeForHTMLAttribute(""+n)+"' preconfig='"+$ESAPI.encoder().encodeForHTMLAttribute(""+l)+"' class='ivrConfLink'><td colspan='3' class='rowSpan' level='"+$ESAPI.encoder().encodeForHTMLAttribute(""+o)+"' num='"+$ESAPI.encoder().encodeForHTMLAttribute(""+t)+"' onClick='Telephony.displayIVRLevelInfo("+i+", "+l+", "+t+")'>Click for Prev Level</td></tr>",Telephony.displayIVRLevelInfo(o,n,t,s)},Telephony.displayIVRLevelInfo=function(e,t,i,o){$("#ivrdetails"+i+" tr").hide(),0===$("#ivrdetails"+i+" tr[level='"+e+"'][config='"+t+"']").length&&$("#ivrdetails"+i).append(o).show(),$("#ivrdetails"+i+" tr[level='"+e+"'][config='"+t+"']").show()},Telephony.getAllProvidersList=function(){Telephony.showLoading("Loading ...","loading");var e=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",t="action=showProviders&"+csrfParamName+"="+encodeURIComponent(csrfToken);$.ajax({url:e,type:"POST",data:t,success:function(e){$("#norecord").text(""),$("#dataRow .dummyclass").remove();var t=JSON.parse(e),i=0;$.each(t,(function(e,t){var o="";i++;var n=JSON.parse(t),a=n.params,s="<tr data-infoKey='"+$ESAPI.encoder().encodeForHTMLAttribute(e)+"' data-infoData='"+$ESAPI.encoder().encodeForHTMLAttribute(t)+'\' class="dummyclass ">';s+="<td class='rowSpan bridgeName' style='word-wrap:break-word'>"+$ESAPI.encoder().encodeForHTML(e)+"</td>",Telephony.providerNameList.push(e),void 0!==a&&($.each(a,(function(e,t){n[$ESAPI.encoder().encodeForJavaScript(e)]=t})),delete n.params),void 0!==n.displayctiname?(s+="<td class='rowSpan displaybridgename' style='word-wrap:break-word'>"+$ESAPI.encoder().encodeForHTML(n.displayctiname)+"</td>",delete n.displayctiname):s+="<td class='rowSpan'>-</td>";var r="";void 0!==n.ctikey?(r+="<div><span style='float:left;'><input pbName=\""+$ESAPI.encoder().encodeForHTMLAttribute(e)+"\" class='info-btn admintoolbtn' type='button' onclick='Telephony.sendKeytoProvider(this)' id='keyMailButton' value='Send PBKey'/></span></div></td>",delete n.ctikey):r+="</td>",void 0!==n.apitype?(s+="<td class='rowSpan' style='word-wrap:break-word'>"+$ESAPI.encoder().encodeForHTML(n.apitype)+"</td>",n.apitype,delete n.apitype):s+="<td class='rowSpan'>-</td>",void 0!==n.betaaccesszgids?(s+="<td class='rowSpan' style='word-wrap:break-word'>"+$ESAPI.encoder().encodeForHTML(n.betaaccesszgids)+"</td>",o=n.betaaccesszgids,delete n.betaaccesszgids):s+="<td class='rowSpan'>-</td>";s+="<td class='rowSpan' style='word-wrap:break-word' ><div id='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n))+"' style='text-align:center; text-decoration: underline;cursor: pointer;' onclick='Telephony.showMore(this)'>More</div></td>",s+="<td colspan='2' class='rowSpan' style='word-wrap:break-word'><div><span style='float:left;'><input class='info-btn admintoolbtn' style='width:70px' type='button' onclick='Telephony.editProvider(this)' id='editButton' value='Edit'/></span> <span style='float:left; padding-left:4px'><input pbName=\""+$ESAPI.encoder().encodeForHTMLAttribute(e)+"\" style='width:70px' class='delete-btn admintoolbtn' type='button' value='Delete' onclick='Telephony.deleteProvider(this)'/></span></div>",s+=r,s+="</tr>","*"===o?$("#dataRow tbody#content").prepend(s):$("#dataRow tbody#content").append(s)})),$("#totalProviders").text(i),0===i?($("#norecord").append("No records present"),$("#dataRow tr:first").hide()):($("#norecord").text(""),$("#dataRow tr:first").show()),Telephony.hideLoading()},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","failure")}}),Telephony.hideLoading()},Telephony.sendKeytoProvider=function(e){var t=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",i=$(e).attr("pbName");void 0===i&&(i=e);var o="action=sendPbkeytoProvider&sendtoprovider="+i+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);1==confirm("Are you sure want to send the phonebridge key to the provider?")&&$.ajax({url:t,type:"POST",data:o,success:function(e){"SUCCESS"===JSON.parse(e).result?Telephony.showLoading("PhoneBridge key has been sent to the provider!","success"):Telephony.showLoading("Mail sending failed!","failure"),Telephony.hideLoading()}})},Telephony.showMore=function(e,t){$(".someMoreInfo").remove();var i=$(e).attr("id"),o=JSON.parse(i),n="";if($.each(o,(function(e,t){t=$ESAPI.encoder().encodeForHTML(""+t),n+="<tr class='someMoreInfo'><th style='width:20%;background: #eee;border: 1px solid #dbdbdb; color: #333; padding: 6px; font-weight: bold;'>"+$ESAPI.encoder().encodeForHTML(""+e)+"</th><td style='width:30%;word-wrap: break-word;background: white;border: 1px solid #dbdbdb;padding:6px;'><span id='pbName'>"+t+"</span></td></tr>"})),void 0===o.callstate){t?$("#popupWidgetTable tbody").append(n):$("#popupTable tbody").append(n);var a=$(e).position();t?$("#showMoreWidgetData").css({left:a.left-420,top:a.top+20}).show():$("#showMoreData").css({left:a.left-420,top:a.top+20}).show()}else{$("#popupCallTable tbody").append(n);a=$(e).position();$("#showMoreCallData").css({left:a.left-420,top:a.top+20}).show()}},Telephony.closeEditPopup=function(e){e?($("#editWidgetForm").html(""),$("#editWidgetFormDiv").hide()):($("#editForm").html(""),$("#editFormDiv").hide()),$("#addProvidersForm").attr("action","add"),Telephony.updateNewViewEnabled()},Telephony.showProviderList=function(e){$(e).children("option").remove(),$.each(Telephony.providerNameList,(function(t,i){var o=i;$(e).append("<option>"+$ESAPI.encoder().encoderForHTML(o)+"</option>")}))},Telephony.editProvider=function(e,t){$("#addProvidersForm").attr("action","update");var i="#tabs-2",o="#editForm",n="#editFormDiv";t&&(i="#tabs-11",o="#editWidgetForm",n="#editWidgetFormDiv");var a=$(i).html(),s=$(o),r=$(n);s.html(a),r.show(),r.find("#addProviderBand").hide(),r.find("#addProvidersForm span:first").css({width:"48%",height:"460px"}),r.find("#addProvidersForm span:last").css({height:"460px"});var l=$(e).closest("tr").data("infodata"),d=$(e).closest("tr").data("infokey"),c="";if(null!=l.params&&(c=l.params),t)s.find("input#widgetName").val(d),s.find("input#widgetName").prop("disabled",!0),s.find("input#widgetDisplayName").val(d),s.find("input#widgetTitle").val(l.providerTitle),s.find("input#widgetLogoName").val(l.providerLogoName),s.find("input#widgetSubTitle").val(l.providerSubTitle),s.find("input#widgetSubTitleKey").val(l.subTitleKey),s.find("input#widgetShortContent").val(l.shortContent),s.find("input#widgetShortContentKey").val(l.shortContentKey),s.find("input#widgetLongContent").val(l.longContent),s.find("input#widgetLongContentKey").val(l.longContentKey),s.find("input#widgetDescription").val(l.description),s.find("input#widgetDescriptionKey").val(l.descriptionKey),s.find("input#widgetImageDetails").attr("value",l.imageDetails),s.find("input#widgetShortContentEnabled").val(l.shortContentEnabled),s.find("input#widgetShortContentKeyEnabled").val(l.shortContentKeyEnabled),s.find("input#widgetLongContentEnabled").val(l.longContentEnabled),s.find("input#widgetLongContentKeyEnabled").val(l.longContentKeyEnabled),s.find("input#widgetImageDetailsEnabled").attr("value",l.imageDetailsEnabled),s.find("input#widgetLogoClass").val(l.logoClass),s.find("input#widgetIconClass").val(l.iconClass),s.find("input#widgetEnableLink").val(l.enableLink),s.find("input#widgetDisableLink").val(l.enableLink);else{var p=l.apitype;l.apiUrl;if($("#isNewViewEnabled").prop("disabled",!1),"type2"===p)s.find("select#addctiapitype option:first").attr({selected:"selected"}),s.find("#type2_1_parameters").hide(),s.find("#type2_parameters").show(),s.find("#type4_parameters").hide(),s.find("input#type2click2callurl").val(c.click2callurl),s.find("input#type2answerurl").val(c.answerurl),s.find("input#type2hungupurl").val(c.hungupurl),s.find("input#ctiKey").val(l.ctikey),Telephony.currentCtikey=l.ctikey;else if("type2.1"===p)s.find("select#addctiapitype option:eq(1)").prop("selected",!0),s.find("#type2_1_parameters").show(),s.find("#type2_parameters").hide(),s.find("#type4_parameters").hide(),s.find("input[name='zohoservicename']").val(c.zohoservicename),s.find("input[name='zohoauthtoken']").val(c.authtoken),s.find("input[name='tpiauthtoken']").val(c.tpiauthtoken),s.find("input[name='ctinumber']").val(c.ctinumber),s.find("input[name='custnumber']").val(c.custnumber),s.find("input[name='ctiagentref']").val(c.ctiagentref),s.find("input[name='agentlist']").val(c.agents),s.find("input[name='callbackparam']").val(c.callbackparam),s.find("input[name='phonenumber']").val(c.phoneNumber),s.find("input[name='encryptedvalue']").val(c.encryptedvalue),s.find("input[name='validateauthtokenurl']").val(c.validateauthtokenurl),s.find("input[name='validatephonenumberurl']").val(c.validatephonenumberurl),s.find("input[name='addauthtokenurl']").val(c.addauthtokenurl),s.find("input[name='click2callurl']").val(c.click2callurl),s.find("input[name='answerurl']").val(c.answerurl),s.find("input[name='hungupurl']").val(c.hungupurl),s.find("input#ctiKey").val(l.ctikey),Telephony.currentCtikey=l.ctikey;else if(p.startsWith("type3"))s.find("select#addctiapitype option:eq(2)").attr({selected:"selected"}),s.find("input[name='zohoclientid']").val(l.zohoclientid),$("#type2_1_parameters").hide(),$("#type2_parameters").hide(),$("#type4_parameters").hide(),$("#type3_parameters").show(),s.find("input[name='others']").val(l.others);else if("type4"===p){if(s.find("select#addctiapitype option:eq(3)").attr({selected:"selected"}),s.find("#type2_1_parameters").hide(),s.find("#type2_parameters").hide(),s.find("#type4_parameters").show(),s.find("input#type4click2callurl").val(c.click2callurl),s.find("input#type4answerurl").val(c.answerurl),s.find("input#type4hungupurl").val(c.hungupurl),s.find("input#type4muteurl").val(c.muteurl),s.find("input#type4holdurl").val(c.holdurl),s.find("input#type4unmuteurl").val(c.unmuteurl),s.find("input#type4unholdurl").val(c.unholdurl),s.find("input#type4keypressurl").val(c.keypressurl),s.find("input#client_id").val(l.client_id),s.find("input#client_secret").val(l.client_secret),s.find("input#redirect_url").val(l.redirecturl),s.find("input#setuplink").val(l.setuplink),s.find("input#helpdoc").val(l.setupdoc),s.find("input#testapprov").val(l.testaccountapproved),s.find("input#testnotapprov").val(l.testaccountnotapproved),$("#paramtypeselect").val(l.authorizationtype),$("#pbxtype").val(l.pbxtype),void 0!==l.adddevtag){var u="true"===l.adddevtag.trim();s.find("#devTag").prop("checked",u)}var m="true"===l.ispbxavailable.trim();s.find("#pbxavailable").prop("checked",m),s.find("#iscontenttypejson").prop("checked",l.iscontenttypejson),s.find("#isproxyconnection").prop("checked",l.isproxyconnection),"true"==l.protocolsupport&&(s.find("#protocolsupport").prop("checked",!0),$("#protocol").show(),s.find("#protocolname").val(l.protocol)),$("#isNewViewEnabled").prop({checked:!0,disabled:!0}),"1"==l.oauthsupport&&($("#vendoroauthtype").val(l.vendoroauthtype),s.find("#vendoroauth").prop("checked",!0),s.find("#vendor_clientid").show(),s.find("#vendor_clientsecret").show(),s.find("#vendoroauthtyperow").show(),s.find("#oauthcode").show(),s.find("#oauthtoken").show(),s.find("#paramtype").show(),s.find("#paramname").show(),s.find("#scope").show(),s.find("input#oauthcodeurl").val(l.oauthcodeurl),s.find("input#oauthtokenurl").val(l.oauthtokenurl),s.find("input#vendor_client_id").val(l.vendor_client_id),s.find("input#vendor_client_secret").val(l.vendor_client_secret),s.find("input#vendor_scope").val(l.vendor_scope),s.find("input#paramnamevalue").val(l.name))}else"phonebridge"===p&&s.find("select#addctiapitype option:eq(5)").attr({selected:"selected"});if(s.find("select#addctiapitype").prop("disabled",!0),s.find("input#addbetazgids").val(l.betaaccesszgids),s.find("input#providerName").val(d),s.find("input#providerDisplayName").val(l.displayctiname),s.find("input#keygenratedemail").val(l.keygenratedemail),s.find("input#allowedCountries").attr("value",l.allowedCountries),s.find("#ctikeyrow").hide(),s.find("input#providerTitle").val(l.providerTitle),s.find("input#providerLogoName").val(l.providerLogoName),s.find("input#providerSubTitle").val(l.providerSubTitle),s.find("input#subTitleKey").val(l.subTitleKey),s.find("input#shortContent").val(l.shortContent),s.find("input#shortContentKey").val(l.shortContentKey),s.find("input#longContent").val(l.longContent),s.find("input#longContentKey").val(l.longContentKey),s.find("input#description").val(l.description),s.find("input#descriptionKey").val(l.descriptionKey),s.find("input#imageDetails").attr("value",l.imageDetails),s.find("input#shortContentEnabled").val(l.shortContentEnabled),s.find("input#shortContentKeyEnabled").val(l.shortContentKeyEnabled),s.find("input#longContentEnabled").val(l.longContentEnabled),s.find("input#longContentKeyEnabled").val(l.longContentKeyEnabled),s.find("input#imageDetailsEnabled").attr("value",l.imageDetailsEnabled),s.find("input#helpName").val(l.helpName),s.find("input#helpLink").val(l.helpLink),s.find("input#newUserHelp").val(l.newUserHelp),s.find("input#logoClass").val(l.logoClass),s.find("input#iconClass").val(l.iconClass),s.find("input#enableLink").val(l.enableLink),void 0!==l.addbetatag){var h="true"===l.addbetatag.trim();s.find("input#addBetaTag").prop("checked",h)}if(void 0!==l.isNew){var f="true"===l.isNew.trim();s.find("input#isNew").prop("checked",f)}if(void 0!==l.isNewViewEnabled){var g="true"===l.isNewViewEnabled.trim();s.find("input#isNewViewEnabled").prop("checked",g)}}},Telephony.showLoading=function(e,t){"loading"===t?($("#progressmsg").text(e),$("#progressBar").show()):("success"===t?$("#alertdiv span").removeClass("telephonyerrorInfo").addClass("successAlert"):"failure"===t&&$("#alertdiv span").removeClass("successAlert").addClass("telephonyerrorInfo"),$("#alertdiv span").text(e).show())},Telephony.hideLoading=function(){setTimeout((function(){$("#progressBar").hide()}),1500),setTimeout((function(){$("#alertdiv span").hide()}),1e4)},Telephony.selectCtiApiType=function(){var e=$("#addctiapitype option:selected").attr("value");$("#isNewViewEnabled").prop("disabled",!1),"type2.1"===e?($("#type2_1_parameters").show(),$("#type2_parameters").hide(),$("#type4_parameters").hide(),$("#type3_parameters").hide()):"type2"===e?($("#type2_1_parameters").hide(),$("#type2_parameters").show(),$("#type4_parameters").hide(),$("#type3_parameters").hide()):"type4"===e?($("#type2_1_parameters").hide(),$("#type2_parameters").hide(),$("#type4_parameters").show(),$("#type3_parameters").hide(),$("#isNewViewEnabled").prop({checked:!0,disabled:!0})):"type3"===e?($("#type2_1_parameters").hide(),$("#type2_parameters").hide(),$("#type4_parameters").hide(),$("#type3_parameters").show()):$("#type2_1_parameters, #type2_parameters, #type4_parameters, #type3_parameters").hide()},Telephony.addProvider=function(){Telephony.showLoading("In progress..","loading");var e=$("#addProvidersForm").attr("action"),t=$("#addProvidersForm input:visible,select:visible"),i=t.filter("input"),o=t.filter("select"),n="action=addProvider&mode="+e+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);$.each(i,(function(){var e=$(this).attr("name");if("ctiKey"!=e){var t="";"text"==$(this).attr("type")&&(t=$(this).val(),n+="&"+e+"="+encodeURIComponent(t))}})),n+="&ctiKey="+$("input#ctiKey").val();var a="";$("input#addBetaTag").is(":checked")&&(a="on"),n+="&addBetaTag="+a;var s="";$("input#isNew").is(":checked")&&(s="on"),n+="&isNew="+s;var r="";if($("input#isNewViewEnabled").is(":checked")&&(r="on"),n+="&isNewViewEnabled="+r,$.each(o,(function(){var e=$(this).attr("name"),t=$(this).children("option:selected").val();n+="&"+e+"="+t})),"type4"===$("#addctiapitype").val()){if($("#vendoroauth").prop("checked")){var l=$("#oauthcodeurl").val(),d=$("#oauthtokenurl").val(),c=$("#paramnamevalue").val(),p=$("#vendor_client_id").val(),u=$("#vendor_client_secret").val();if($("#headerintokenrequest").prop("checked")&&(n+="&headerintokenrequest=true"),""===l||""===d||""===c||""===p||""===u)return alert("please fill all the values"),!1}$("#protocolsupport").prop("checked")?n+="&protocolsupport=true":n+="&protocolsupport=false",$("#vendoroauth").prop("checked")?n+="&vendoroauth=1":n+="&vendoroauth=0",$("#devTag").prop("checked")?n+="&adddevtag=true":n+="&adddevtag=false",$("#pbxavailable").prop("checked")?n+="&ispbxavailable=true":n+="&ispbxavailable=false",$("#iscontenttypejson").prop("checked")?n+="&iscontenttypejson=true":n+="&iscontenttypejson=false",$("#isproxyconnection").prop("checked")?n+="&isproxyconnection=true":n+="&isproxyconnection=false"}var m=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do";$.ajax({url:m,type:"POST",data:n,success:function(t){var i=JSON.parse(t);"update"===e&&Telephony.closeEditPopup(),"SUCCESS"===i.result?(Telephony.getAllProvidersList(),"add"===i.action?Telephony.showLoading("Data added successfully","success"):Telephony.showLoading("Data updated successfully","success"),Telephony.hideLoading(),$("#addProvidersForm input[type='text']:visible, #ctikeymsg").val(""),$("#addBetaTag").prop("checked",!1),$("#isNew").prop("checked",!1),Telephony.updateNewViewEnabled()):Telephony.showLoading("Failed to add- "+i.result,"failure"),Telephony.hideLoading()},fail:function(){Telephony.showLoading("Cannot add - Please check your inputs!!","failure"),Telephony.hideLoading()},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","failure"),Telephony.hideLoading()}}),Telephony.hideLoading()},Telephony.deleteProvider=function(e,t){var i=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",o=$(e).attr("pbName");void 0===o&&(o=e);var n="action=removeProvider&rmproviderName="+o+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);t&&(n+="&iswidget=true"),1==confirm("Are you sure want to delete this Provider ?")&&($.ajax({url:i,type:"POST",data:n,success:function(t){if("SUCCESS"===JSON.parse(t).result){$(e).closest("tr").remove();var i=parseInt($("#totalProviders").html())-1;$("#totalProviders").text(i),Telephony.showLoading("Data deleted successfully","success"),Telephony.hideLoading()}},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","failure")}}),Telephony.hideLoading())},Telephony.revokeZTIDisabledGroup=function(e){var t="action=revokeZTIDisabledGroup&zgid="+encodeURIComponent(e)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),i=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do";1==confirm("Are you sure want to delete this group ?")&&($.ajax({url:i,type:"POST",data:t,success:function(e){"SUCCESS"===JSON.parse(e).result?($("#revokeBtnSpan, #revokeZTISpan, #topInfo, #portalDetailsDiv, #zgidDetailsNoRecord").hide(),$("#portalDetailsDiv tr.dummyclass, div.dummyclass").remove(),Telephony.showLoading("Data deleted successfully","success")):(Telephony.showLoading("Please check your input","failure"),$("#revokeZTISpan").hide(),$("#zgidDetailsNoRecord").text(""),$("#zgidDetailsNoRecord").text("No such account"))},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","failure")}}),Telephony.hideLoading())},Telephony.revokeTelephony=function(e){var t=$("#customervalue").val(),i=$("#customervaluetype").val(),o="action=revokeTelephony&zgid="+encodeURIComponent(e)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);"phonenumber"===i&&(o+="&phoneNumber="+encodeURIComponent(t));var n=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do";1==confirm("Are you sure want to revoke telephony for this User ?")&&($.ajax({url:n,type:"POST",data:o,success:function(e){"SUCCESS"===e?($("#revokeBtnSpan, #revokeZTISpan, #topInfo, #portalDetailsDiv, #zgidDetailsNoRecord").hide(),$("#portalDetailsDiv tr.dummyclass, div.dummyclass").remove(),$("#tabs-5 #zgidDet").text(""),Telephony.showLoading("Data deleted successfully","success")):Telephony.showLoading("Sorry - action failed","failure"),Telephony.hideLoading()},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","falilure")}}),Telephony.hideLoading())},Telephony.updateNewViewEnabled=function(){"type4"===$("#addctiapitype").val()?$("#isNewViewEnabled").prop({checked:!0,disabled:!0}):$("#isNewViewEnabled").prop("checked",!1)},Telephony.clearAllFields=function(){$("#addProvidersForm input[type='text']").val("")},Telephony.configurePBX=function(){var e=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",t="action=getType2AndType4Providers&"+csrfParamName+"="+encodeURIComponent(csrfToken);$.ajax({url:e,type:"POST",data:t,success:function(e){if("success"===e.status){var t=e.providers,o="<option value=''>-select-</option>";for(i=0;i<t.length;i++)o=o+"<option value='"+$ESAPI.encoder().encodeForHTMLAttribute(t[i])+"'>"+$ESAPI.encoder().encodeForHTML(t[i])+"</option>";$("#pbxnameSelect").html(o),$("#tabs-8").show()}else Telephony.showLoading("Sorry - action failed","failure");Telephony.hideLoading()},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","falilure")}}),Telephony.hideLoading()},Telephony.enablePBXAction=function(){var e=$("#zgidtoenable").val(),t="false";$("#sendemail").prop("checked")&&(t="true");var i=$("#pbxnameSelect option:selected").val(),o=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",n="action=enablePBX&zgid="+encodeURIComponent(e)+"&pbxname="+i+"&sendemail="+t+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);$.ajax({url:o,type:"POST",data:n,success:function(e){"success"===e?($("#zgidtoenable").val(""),$("#pbxnameSelect option:first").attr({selected:"selected"}),Telephony.showLoading("Enabled for the given user(s)","success")):Telephony.showLoading("Sorry - action failed","failure"),Telephony.hideLoading()},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","falilure")}}),Telephony.hideLoading()},Telephony.disablePBXAction=function(){var e=$("#zgidtodisable").val(),t=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",i="action=disablePBX&zgid="+encodeURIComponent(e)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);$.ajax({url:t,type:"POST",data:i,success:function(e){"success"===e?($("#zgidtodisable").val(""),Telephony.showLoading("Disabled for the given user(s)","success")):Telephony.showLoading("Sorry - action failed","failure"),Telephony.hideLoading()},error:function(){f,Telephony.showLoading("There was an error.. Please refresh your page and try again!!","falilure")}}),Telephony.hideLoading()},Telephony.showCount=function(){if(Telephony.countObj)$("#tabs-10").html(Handlebars.templates.admin_provider_count_view(Telephony.countObj)).show();else{$.getJSON(Telephony.url,{action:"showProviderCount"},(function(e){e.countryList=JSON.parse(e.countryList),$("#tabs-10").html(Handlebars.templates.admin_provider_count_view(e)).show(),Telephony.toggleBetaProviders(),Telephony.countObj=e}))}},Telephony.getCountryStats=function(){var e=[],t=($("#countryList").find(":selected").each((function(t,i){e.push($(i).text())})),e.filter((function(e){return!Telephony.countryData[e]}))),i={action:"getCountryDetails",countryList:JSON.stringify(t)};$(".countryVsProvider, .countryCode").remove(),t.length>=1?$.getJSON(Telephony.url,i,(function(t){$.each(t,(function(e,t){Telephony.countryData[e]=t})),Telephony.showCountryStats(e)})):Telephony.showCountryStats(e)},Telephony.showCountryStats=function(e){var t=$(".header");$.each(e,(function(e,i){var o=Telephony.countryData[i];t.append('<th class="rowHeaderSpan countryCode">'+i+"</th>"),$(".providers").each((function(e,t){$elem=$(t);var i=$elem.attr("id");$elem.append('<td align="center" class="rowClass countryVsProvider">'+Telephony.getCount(o[i+"_activeUser"])+" | "+Telephony.getCount(o[i+"_overallUser"])+" | "+Telephony.getCount(o[i+"_activeOrg"])+" | "+Telephony.getCount(o[i+"_overallOrg"])+"</td>")}))})),$("#countNotes").show()},Telephony.getCount=function(e){return e||0},Telephony.toggleBetaProviders=function(){$(".betaAccess").toggle()},Telephony.sendStatsMail=function(){var e={action:"sendStatsMail"};networkUtils.setCsrfParam(e),$.ajax({url:Telephony.url,type:"POST",data:e,success:function(e){"success"===e&&alert("Mail Sent Successfully")},error:function(){alert("An Error has occured. Please Try again")}})},Telephony.addWidget=function(){Telephony.showLoading("In progress..","loading");var e=$("#addProvidersForm").attr("action"),t=$("#addProvidersForm input:visible,select:visible"),i=t.filter("input"),o=(t.filter("select"),"action=addWidget&mode="+e+"&"+csrfParamName+"="+encodeURIComponent(csrfToken));$.each(i,(function(){var e=$(this).attr("name"),t="";"text"==$(this).attr("type")&&(t=$(this).val(),o+="&"+e+"="+encodeURIComponent(t))}));var n=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do";$.ajax({url:n,type:"POST",data:o,success:function(t){var i=JSON.parse(t);"update"===e&&Telephony.closeEditPopup(),"SUCCESS"===i.result?(Telephony.getAllProvidersList(),"add"===i.action?Telephony.showLoading("Data added successfully","success"):Telephony.showLoading("Data updated successfully","success"),Telephony.hideLoading(),$("#addProvidersForm input[type='text']:visible, #ctikeymsg").val(""),$("#addBetaTag").prop("checked",!1),$("#isNew").prop("checked",!1),Telephony.updateNewViewEnabled()):Telephony.showLoading("Failed to add- "+i.result,"failure"),Telephony.hideLoading()},fail:function(){Telephony.showLoading("Cannot add - Please check your inputs!!","failure"),Telephony.hideLoading()},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","failure"),Telephony.hideLoading()}}),Telephony.hideLoading()},Telephony.getAllWidgetsList=function(){Telephony.showLoading("Loading ...","loading");var e=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",t="action=showWidgets&"+csrfParamName+"="+encodeURIComponent(csrfToken);$.ajax({url:e,type:"POST",data:t,success:function(e){$("#noWidgetRecord").text(""),$("#widgetDataRow .dummyclass").remove();var t=JSON.parse(e),i=0;$.each(t,(function(e,t){i++;var o=JSON.parse(t),n=(o.params,"<tr data-infoKey='"+$ESAPI.encoder().encodeForHTMLAttribute(e)+"' data-infoData='"+$ESAPI.encoder().encodeForHTMLAttribute(t)+'\' class="dummyclass ">');n+="<td class='rowSpan bridgeName' style='word-wrap:break-word'>"+$ESAPI.encoder().encodeForHTML(e)+"</td>",Telephony.providerNameList.push(e),void 0!==o.enableLink?(n+="<td class='rowSpan displaybridgename' style='word-wrap:break-word'>"+$ESAPI.encoder().encodeForHTML(o.enableLink)+"</td>",delete o.enableLink):n+="<td class='rowSpan'>https://pbx.com/enablelink</td>",void 0!==o.disableLink?(n+="<td class='rowSpan' style='word-wrap:break-word'>"+$ESAPI.encoder().encodeForHTML(o.disableLink)+"</td>",o.disableLink,delete o.disableLink):n+="<td class='rowSpan'>https://pbx.com/diablelink</td>";n+="<td class='rowSpan' style='word-wrap:break-word' ><div id='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(o))+"' style='text-align:center; text-decoration: underline;cursor: pointer;' onclick='Telephony.showMore(this,true)'>More</div></td>",n+="<td colspan='2' class='rowSpan' style='word-wrap:break-word'><div><span style='float:left;'><input class='info-btn admintoolbtn' style='width:70px' type='button' onclick='Telephony.editProvider(this,true)' id='editButton' value='Edit'/></span> <span style='float:left; padding-left:4px'><input pbName=\""+$ESAPI.encoder().encodeForHTMLAttribute(e)+"\" style='width:70px' class='delete-btn admintoolbtn' type='button' value='Delete' onclick='Telephony.deleteProvider(this,true)'/></span></div>",n+="</tr>",$("#widgetDataRow tbody#widgetContent").append(n)})),$("#totalWidgets").text(i),0===i?($("#noWidgetRecord").append("No records present"),$("#widgetDataRow tr:first").hide()):($("#noWidgetRecord").text(""),$("#widgetDataRow tr:first").show()),Telephony.hideLoading()},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","failure")}}),Telephony.hideLoading()},Telephony.manageDeveloperStatus=function(e,t){if(null==t&&(t=$("#developerzgid").val()),$("#developerdata tr").remove(),validationUtils.isEmpty(t))Telephony.showLoading("Please provide Valid ZGID","failure"),Telephony.hideLoading();else{var i=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",o="action=manageDeveloperStatus&operation="+e+"&developerzgid="+encodeURIComponent(t)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);$.ajax({url:i,type:"POST",data:o,dataType:"json",success:function(e){if("success"===e.status)if($("#developerzgid").val(""),"view"===e.operation){var t="";t+="<tr class='dummyclass'>",t+="<td class='rowSpan'>"+e.developerStatus+"</td>","false"===e.developerStatus?t+="<td class='rowSpan'><input type='button' value='Enable Developer Access' class='greenbtn mL0 pLR10' onclick='Telephony.manageDeveloperStatus(\"add\","+e.developerzgid+");'/></td></tr>":t+="<td class='rowSpan'><input type='button' value='Revoke Developer Access' class='redbtn mL0 pLR10' onclick='Telephony.manageDeveloperStatus(\"delete\",,"+e.developerzgid+");'/></td></tr>",$("#developerdata").append(t)}else"add"===e.operation?Telephony.showLoading("Developer Status given successfully","success"):"delete"===e.operation&&Telephony.showLoading("Developer Status revoked successfully","success");else"invalid_user"===e.errorCode?Telephony.showLoading(e.developerzgid+" does not have a Zoho Account ","failure"):"invalid_crm_user"===e.errorCode?Telephony.showLoading(e.developerzgid+" does not have a Zoho CRM Account ","failure"):Telephony.showLoading("There was an error.. Please refresh your page and try again!!","failure");Telephony.hideLoading()},error:function(e,t,i){Telephony.showLoading(e.status+" There was an error.. Please refresh your page and try again!!","falilure")}}),Telephony.hideLoading()}},Telephony.enablePhonebridgeFeature=function(){var e=$("#zgid_trial").val();if(e){var t=Crm.getCrmBasePath()+"/TelephonyAdminNewTool.do",i="action=enablefeaturetrail&zgid="+encodeURIComponent(e)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);$.ajax({url:t,type:"POST",data:i,success:function(e){"success"===JSON.parse(e).status?(Telephony.showLoading("Telephony feature enabled","success"),Telephony.hideLoading()):(Telephony.showLoading("Invalid ZGID","failure"),Telephony.hideLoading())}})}};