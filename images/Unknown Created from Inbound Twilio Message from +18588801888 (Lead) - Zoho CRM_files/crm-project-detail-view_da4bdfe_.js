Lyte.Component.register("crm-zprojects-rl",{_template:'<template tag-name="crm-zprojects-rl"> <lyte-event-listener event-name="relatedList" on-fire="{{action(\'handleRefresh\')}}"> <span id="subvalue_ACCOUNTNAME" style="display:none;">{{accountName}}</span> <span style="display:none;" id="subvalue_ACCOUNTID" data-params="{&quot;module&quot;:&quot;{{module}}&quot;,&quot;id&quot;:&quot;{{accountID}}&quot;}" value="{{accountID}}">{{accountID}}</span> <span id="subvalue_EMAIL" style="display:none">{{contactEmail}}</span> <input type="hidden" name="ID_PROJECTPERSONALITY" value="{{personalityID}}"> <input type="hidden" id="permission" value="{{permValue}}"> <input type="hidden" id="moduleNameln" value="{{module}}"> <input type="hidden" id="currentEntityId" value="{{entity_id}}"> <input type="hidden" id="contacttabname" value="{{moduleDispVal}}"> <div id="detailViewzdiv"></div> <template is="if" value="{{isCanvasView}}"><template case="true"> <table cellspacing="0" cellpadding="0" class="relCenterBg mB20 w100per"> <tbody> <tr height="25"> <td class="nowrap"></td> <td> <lyte-dropdown id="projGrp" on-option-selected="{{method(\'projectGrpSelected\')}}"> <template is="registerYield" yield-name="yield"> <lyte-drop-box> <lyte-drop-body> <lyte-drop-item data-value="active">{{getI18n(\'Active\')}} {{getI18n(\'Projects\')}}</lyte-drop-item> <lyte-drop-item data-value="archived"> {{getI18n(\'crm.archive\')}} {{getI18n(\'Projects\')}} </lyte-drop-item> </lyte-drop-body> </lyte-drop-box> </template> </lyte-dropdown> </td> <td class="alignright vam"> <div id="ract1_{{related_list_id}}" class="enableRelLinks"> <a class="dummyForLeftPanel createlink crm-rl-write-action" onclick="{{action(\'newProjectSelected\')}}" href="javascript:void(0);" data-zcqa="link_CreateEditprojectbtn1" data-relid="{{related_list_id}}">{{getI18n(\'crm.project.button.newproject\')}}</a> <span class="tb_newsmallbtn crm-rl-write-action" href="javascript:void(0);" onclick="{{action(\'associatedProjectSelected\')}}" data-zcqa="link_CreateEditprojectbtn2" data-relid="{{related_list_id}}">{{getI18n(\'crm.project.button.associateproject\')}}</span> </div> </td> </tr> </tbody> </table> </template></template> <lyte-alert id="projectB2CPopUp" lt-prop-show="{{showB2CPopUp}}" lt-prop-heading="Alert" lt-prop-primary-message="{{getI18n(&quot;crm.projects.b2c.noaccounterror&quot;,getSingularLabel(&quot;Accounts&quot;),getSingularLabel(&quot;Contacts&quot;))}}" lt-prop-wrapper-class="sampleAlert" lt-prop-top="0px" on-accept="{{method(&quot;acceptB2Cfn&quot;)}}" on-reject="{{method(&quot;cancelB2Cfn&quot;)}}" lt-prop-buttons="[{&quot;type&quot;:&quot;accept&quot;,&quot;text&quot;:&quot;{{getI18n(\'crm.yes.proceed\')}}&quot;,&quot;appearance&quot;:&quot;primary&quot;},{&quot;type&quot;:&quot;reject&quot;,&quot;text&quot;:&quot;{{getI18n(\'crm.button.cancel\')}}&quot;,&quot;appearance&quot;:&quot;default&quot;}]" lt-prop="{&quot;showCloseButton&quot;:false}"></lyte-alert> <lyte-alert id="projectDelPrompt" on-accept="{{method(callFunction)}}" lt-prop-yield="false" lt-prop-top="0px" lt-prop-buttons="[{&quot;type&quot;:&quot;reject&quot;,&quot;text&quot;:&quot;Cancel&quot;},{&quot;type&quot;:&quot;accept&quot;,&quot;text&quot;:&quot;Yes&quot;,&quot;appearance&quot;:&quot;failure&quot;}]" lt-prop="{&quot;showCloseButton&quot;:false}"></lyte-alert> <lyte-alert id="permErrorPrompt" lt-prop-button-position="center" lt-prop-yield="false" lt-prop-top="0px" lt-prop-buttons="[{&quot;type&quot;:&quot;accept&quot;,&quot;text&quot;:&quot;Yes,Got it&quot;,&quot;appearance&quot;:&quot;primary&quot;}]" lt-prop="{&quot;showCloseButton&quot;:false}"></lyte-alert> <lyte-messagebox lt-prop-type="error" lt-prop-message="{{errorMessage}}" lt-prop-show="{{showErrorMessage}}" lt-prop-duration="5000" lt-prop-transition="{&quot;animation&quot;:&quot;slideFromTop&quot;}"> </lyte-messagebox> <template is="if" value="{{expHandlers(noPermission,\'===\',&quot;S&quot;)}}"><template case="true"> <div id="{{related_list_id}}"> <table cellspacing="0" cellpadding="0" class="norec aligncenter w100per"> <tbody><tr> <td valign="center"> <div class="pR30 italic fontsmooth"> {{getI18n(\'crm.project.error.nopermission\')}} </div> </td> </tr> </tbody></table> </div> </template><template case="false"> <template is="if" value="{{expHandlers(projects_list.length,\'>\',0)}}"><template case="true"> <lyte-table class="{{if(isCanvasView,\'\',\'zProjDetailTable\')}}" lt-prop-yield="true" lt-prop-width="100%" lt-prop-height="100%" lt-prop-cell-height="20px" lt-prop-id="ProjectRelatedListTable" lt-prop-scroll="{&quot;vertical&quot;:false,&quot;horizontal&quot;:false}"> <template is="registerYield" yield-name="yield"> <lyte-table-structure> <lyte-thead class="tableHeadBg"> <lyte-tr> <template is="if" value="{{ifEquals(sortOrder,&quot;active&quot;)}}"><template case="true"> <lyte-th class="zproject-empty"></lyte-th> </template></template> <lyte-th class="{{if(ifEquals(sortOrder,\'archived\'),\'zproject_rl_name\',\'\')}}">{{getI18n("crm.project.label.projname")}}</lyte-th> <lyte-th class="aligncenter">{{getI18n("crm.project.label.projstatus")}}</lyte-th> <lyte-th class="aligncenter">{{getI18n("crm.project.label.projcomplition")}}</lyte-th> <lyte-th class="aligncenter">{{projectRLMetaData.tab_names.milestone}}</lyte-th> <lyte-th class="aligncenter">{{projectRLMetaData.tab_names.task}}</lyte-th> <lyte-th class="aligncenter">{{projectRLMetaData.tab_names.issue}}</lyte-th> </lyte-tr> </lyte-thead> <lyte-tbody class="project_rl_body"> <template is="for" items="{{projects_list}}" item="projects" index="index"> <lyte-tr class="project_rl_row"> <template is="if" value="{{ifEquals(sortOrder,&quot;active&quot;)}}"><template case="true"> <lyte-td class="zproject-empty"> <div id="rlEditOptions_{{projects.ProjectId}}" class="indIcon crm-rl-write-action"> <a href="javascript:ZProjects.editProject(\'{{entity_id}}\',\'{{projects.ProjectId}}\',\'projectspersonality_{{related_list_id}}\',\'{{module}}\',\'null\')" id="relatedListEdit_{{related_list_id}}" class="link neweditIcon dIB" data-zcqa="editProject"></a> <span class="sep">&nbsp;&nbsp;</span> <template is="if" value="{{isCanvasView}}"><template case="true"> <a id="proj_del_icon_{{projects.ProjectId}}" onclick="{{action(\'projDeletionEvent\',projects.ProjectId)}}" href="javascript:void(0);" class="link deleteIcon dIB mL5" data-zcqa="deleteProject"></a> </template><template case="false"> <span id="proj_del_icon_{{projects.ProjectId}}" onclick="{{action(\'showDelPopFn\',projects.ProjectId,module)}}" data-onclick="javascript:ZProjects.delProject(\'{{entity_id}}\',\'{{projects.ProjectId}}\',\'projectspersonality_{{related_list_id}}\',\'{{module}}\',\'null\')" class="link deleteIcon dIB vam" data-zcqa="deleteProject"></span> </template></template> </div> </lyte-td> </template></template> <template is="if" value="{{expHandlers(projects.ProjectStatus,\'===\',&quot;active&quot;)}}"><template case="true"> <lyte-td> <link-to lt-prop-route="crm.tab.projects" lt-prop-qp="{&quot;projectId&quot;:&quot;{{projects.ProjectId}}&quot;}"><a>{{projects.ProjectName}}</a></link-to> <span id="projError_{{projects.ProjectId}}" class="svgIcons ico-warning-small-red-Filled vam mL10 cP {{if(expHandlers(projects.ProjectId,\'===\',ZProjects.errorProject),\'dIB\',\'dN\')}}" onclick="{{action(\'showUsrErrPopUp\')}}"></span> </lyte-td> </template><template case="false"> <lyte-td class="{{if(ifEquals(sortOrder,\'archived\'),\'zproject_rl_name\',\'\')}}">{{projects.ProjectName}}</lyte-td> </template></template> <lyte-td> <div id="projNameGet" class="w100 mAuto pR"> <span class="colorAppliedPicklist" style="background-color:{{projects.status_color}};color:{{getFontColor(projects.status_color)}}">{{projects.custom_status}}</span> </div> </lyte-td> <lyte-td> <div class="w100 mAuto pR"> <a onclick="{{action(\'loadProgressIframe\',projects.ProjectId,\'progress\',projects.ProjectName)}}" href="javascript:void(0);"> <div class="fl w100" id="completionPlaceHolder"> <div class="w100"> <span class="pA f9 color_3 lh14" style="left: 50%;transform: translateX(-50%);top: 1px;">{{projects.Project_completion}}%</span> <div style="width:{{projects.Project_completion}}px;" class="greenbar fl pointer"></div> <div style="width:{{arithResult(100,projects.Project_completion,&quot;-&quot;)}}px;" class="graybar fl pointer"></div> </div> </div> </a> </div> </lyte-td> <lyte-td> <div class="w170 mAuto"> <div class="alignright fl w30 pr3 txt10 lh14">{{projects.CloseMilestoneCNT}}</div> <a onclick="{{action(\'loadProjIframe\',projects.ProjectId,\'mile\',projects.ProjectName,projectRLMetaData.tab_names)}}" href="javascript:void(0);"> <div class="fl w100" id="milestonePlaceHolder"> <div class="w100"> <div style="width:{{projects.MilestoneCompletionPercentage}}px;" class="greenbar fl pointer"></div> <div style="width:{{arithResult(100,projects.MilestoneCompletionPercentage,&quot;-&quot;)}}px;" class="graybar fl pointer"></div> </div> </div> </a> <div class="fl w30 tal pl3 txt10 lh14">{{projects.OpenMilestoneCNT}}</div> </div> </lyte-td> <lyte-td> <div class="w170 mAuto"> <div class="alignright fl w30 pr3 txt10 lh14">{{projects.CloseTask}}</div> <a href="javascript:void(0);" onclick="{{action(\'loadProjIframe\',projects.ProjectId,\'task\',projects.ProjectName,projectRLMetaData.tab_names)}}"> <div class="fl w100" id="taskPlaceHolder"> <div class="w100"> <div style="width:{{projects.TaskCompletion}}px;" class="greenbar fl pointer"></div> <div style="width:{{arithResult(100,projects.TaskCompletion,&quot;-&quot;)}}px;" class="graybar fl pointer"></div> </div> </div> </a> <div class="fl w30 tal pl3 txt10 lh14">{{projects.OpenTask}}</div> </div> </lyte-td> <lyte-td> <div class="w170 mAuto"> <div class="alignright fl w30 pr3 txt10 lh14">{{projects.CloseBugCNT}}</div> <a href="javascript:void(0);" onclick="{{action(\'loadProjIframe\',projects.ProjectId,\'bug\',projects.ProjectName,projectRLMetaData.tab_names)}}"> <div class="fl w100" id="bugsPlaceHolder"> <div class="w100"> <div style="width:{{projects.BugCompletionPercentage}}px;" class="greenbar fl pointer"></div> <div style="width:{{arithResult(100,projects.BugCompletionPercentage,&quot;-&quot;)}}px;" class="graybar fl pointer"></div> </div> </div> </a> <div class="fl w30 tal pl3 txt10 lh14">{{projects.OpenBugCNT}}</div> </div> </lyte-td> </lyte-tr> </template> </lyte-tbody> </lyte-table-structure> <template is="if" value="{{expHandlers(expHandlers(pageNo,\'!=\',1),\'||\',expHandlers(expHandlers(pageNo,\'===\',1),\'&amp;&amp;\',expHandlers(projects_list.length,\'===\',10)))}}"><template case="true"> <div class="fR pT10"> <lyte-navigator id="projectRelNavigator" on-next="{{method(\'nextRlPage\')}}" on-previous="{{method(\'previousRlPage\')}}" lt-prop-yeild="false" lt-prop-value="{{arithmeticOperation(projectRLMetaData.fromindex,\'-\',1)}}" lt-prop-records="{{getSumList(projectRLMetaData.fromindex,expHandlers(1,\'-\'),projects_list.length)}}" lt-prop-perpage="10" lt-prop-more-records="{{projectRLMetaData.next_page}}" data-zcqa="navigateProjectPersonallity"></lyte-navigator> </div> </template></template> </template> </lyte-table> </template><template case="false"> <div id="{{relation_list_id}}"> <table cellspacing="0" cellpadding="0" class="norec w100per"> <tbody><tr> <td valign="top"> <template is="if" value="{{expHandlers(permValue,\'===\',\'NO_PERMISSION_IN_PORTAL\')}}"><template case="true"> <div class="pL25">&lt;{{getI18n(\'crm.projects.permissions.user.projects.unauthorized\')}}&gt;</div> </template></template> <template is="if" value="{{expHandlers(permValue,\'===\',\'NOT_PORTAL_USER\')}}"><template case="true"> <div class="pL25">&lt;{{getI18n(\'crm.projects.permissions.user.no.portalpermission\')}}&gt;</div> </template></template> <template is="if" value="{{expHandlers(permValue,\'===\',\'6504\')}}"><template case="true"> <div class="pL25">&lt;{{getI18n(\'crm.project.error.portalchanged\')}}&gt;</div> </template></template> <template is="if" value="{{expHandlers(permValue,\'===\',\'6401\')}}"><template case="true"> <div class="pL25">&lt;{{getI18n(\'crm.project.error.portalownerchanged\')}}&gt;</div> </template></template> <template is="if" value="{{expHandlers(permValue,\'===\',\'6000\')}}"><template case="true"> <div class="pL25">{{getI18n(\'crm.project.portal.zsckeyisregenerated.normal\',brand)}}</div> </template></template> <template is="if" value="{{expHandlers(permValue,\'===\',\'6001\')}}"><template case="true"> <div class="zsckeyPatern w100p"> <p class="f13 lh20 color_7 p20 proxima">{{getI18n(\'crm.project.portal.zsckeyisregenerated.admin1\',brand)}}<br>{{getI18n(\'crm.project.portal.toresumeintegration\')}}&nbsp; <a href="javascript:void(0)" onclick="{{action(\'redirectToProjUpdate\')}}" class="link1">{{getI18n(\'crm.project.portal.updatezsckey\')}}</a>&nbsp;{{getI18n(\'crm.project.message.andproceed\')}}</p> </div> </template></template> <template is="if" value="{{expHandlers(expHandlers(expHandlers(expHandlers(expHandlers(expHandlers(permValue,\'!=\',\'NO_PERMISSION_IN_PORTAL\'),\'&amp;&amp;\',expHandlers(permValue,\'!=\',\'NOT_PORTAL_USER\')),\'&amp;&amp;\',expHandlers(permValue,\'!=\',\'6504\')),\'&amp;&amp;\',expHandlers(permValue,\'!=\',\'6401\')),\'&amp;&amp;\',expHandlers(permValue,\'!=\',\'6000\')),\'&amp;&amp;\',expHandlers(permValue,\'!=\',\'6001\'))}}"><template case="true"> <div class="pR30 italic fontsmooth">{{getI18n(\'crm.new.label.no.records\')}}</div> </template></template> </td> </tr> </tbody></table> </div> </template></template> </template></template> </lyte-event-listener></template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0]},{type:"attr",position:[1,3]},{type:"text",position:[1,3,0]},{type:"text",position:[1,5,0]},{type:"attr",position:[1,7]},{type:"attr",position:[1,9]},{type:"attr",position:[1,11]},{type:"attr",position:[1,13]},{type:"attr",position:[1,15]},{type:"attr",position:[1,19]},{type:"if",position:[1,19],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1,1,3,1]},{type:"registerYield",position:[1,1,1,3,1,1],dynamicNodes:[{type:"text",position:[1,1,1,0]},{type:"text",position:[1,1,1,2]},{type:"componentDynamic",position:[1,1,1]},{type:"text",position:[1,1,3,1]},{type:"text",position:[1,1,3,3]},{type:"componentDynamic",position:[1,1,3]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,1,1,3,1]},{type:"attr",position:[1,1,1,5,1]},{type:"attr",position:[1,1,1,5,1,1]},{type:"text",position:[1,1,1,5,1,1,0]},{type:"attr",position:[1,1,1,5,1,3]},{type:"text",position:[1,1,1,5,1,3,0]}]}},default:{}},{type:"attr",position:[1,21]},{type:"componentDynamic",position:[1,21]},{type:"attr",position:[1,23]},{type:"componentDynamic",position:[1,23]},{type:"componentDynamic",position:[1,25]},{type:"attr",position:[1,27]},{type:"componentDynamic",position:[1,27]},{type:"attr",position:[1,29]},{type:"if",position:[1,29],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,1,0,1,1,1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1,1,1]},{type:"if",position:[1,1,1,1],cases:{true:{dynamicNodes:[{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,1,1,3]},{type:"text",position:[1,1,1,3,0]},{type:"componentDynamic",position:[1,1,1,3]},{type:"text",position:[1,1,1,5,0]},{type:"componentDynamic",position:[1,1,1,5]},{type:"text",position:[1,1,1,7,0]},{type:"componentDynamic",position:[1,1,1,7]},{type:"text",position:[1,1,1,9,0]},{type:"componentDynamic",position:[1,1,1,9]},{type:"text",position:[1,1,1,11,0]},{type:"componentDynamic",position:[1,1,1,11]},{type:"text",position:[1,1,1,13,0]},{type:"componentDynamic",position:[1,1,1,13]},{type:"componentDynamic",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3,1]},{type:"for",position:[1,3,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"attr",position:[1,1,5]},{type:"if",position:[1,1,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,0,0]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,5,1,1],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'background-color:'","projects.status_color","';color:'",{type:"helper",value:{name:"getFontColor",args:["projects.status_color"]}}]}}}},{type:"text",position:[1,5,1,1,0]},{type:"componentDynamic",position:[1,5]},{type:"attr",position:[1,7,1,1]},{type:"text",position:[1,7,1,1,1,1,1,0]},{type:"attr",position:[1,7,1,1,1,1,3],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'width:'","projects.Project_completion","'px;'"]}}}},{type:"attr",position:[1,7,1,1,1,1,5],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'width:'",{type:"helper",value:{name:"arithResult",args:[100,"projects.Project_completion","'-'"]}},"'px;'"]}}}},{type:"componentDynamic",position:[1,7]},{type:"text",position:[1,9,1,1,0]},{type:"attr",position:[1,9,1,3]},{type:"attr",position:[1,9,1,3,1,1,1],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'width:'","projects.MilestoneCompletionPercentage","'px;'"]}}}},{type:"attr",position:[1,9,1,3,1,1,3],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'width:'",{type:"helper",value:{name:"arithResult",args:[100,"projects.MilestoneCompletionPercentage","'-'"]}},"'px;'"]}}}},{type:"text",position:[1,9,1,5,0]},{type:"componentDynamic",position:[1,9]},{type:"text",position:[1,11,1,1,0]},{type:"attr",position:[1,11,1,3]},{type:"attr",position:[1,11,1,3,1,1,1],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'width:'","projects.TaskCompletion","'px;'"]}}}},{type:"attr",position:[1,11,1,3,1,1,3],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'width:'",{type:"helper",value:{name:"arithResult",args:[100,"projects.TaskCompletion","'-'"]}},"'px;'"]}}}},{type:"text",position:[1,11,1,5,0]},{type:"componentDynamic",position:[1,11]},{type:"text",position:[1,13,1,1,0]},{type:"attr",position:[1,13,1,3]},{type:"attr",position:[1,13,1,3,1,1,1],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'width:'","projects.BugCompletionPercentage","'px;'"]}}}},{type:"attr",position:[1,13,1,3,1,1,3],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'width:'",{type:"helper",value:{name:"arithResult",args:[100,"projects.BugCompletionPercentage","'-'"]}},"'px;'"]}}}},{type:"text",position:[1,13,1,5,0]},{type:"componentDynamic",position:[1,13]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]}]}},default:{}}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,1,0,1,1]},{type:"if",position:[1,1,1,0,1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]}]}},default:{}},{type:"attr",position:[1,1,1,0,1,3]},{type:"if",position:[1,1,1,0,1,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]}]}},default:{}},{type:"attr",position:[1,1,1,0,1,5]},{type:"if",position:[1,1,1,0,1,5],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]}]}},default:{}},{type:"attr",position:[1,1,1,0,1,7]},{type:"if",position:[1,1,1,0,1,7],cases:{true:{dynamicNodes:[{type:"text",position:[1,1]}]}},default:{}},{type:"attr",position:[1,1,1,0,1,9]},{type:"if",position:[1,1,1,0,1,9],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[1,1,1,0,1,11]},{type:"if",position:[1,1,1,0,1,11],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,0]},{type:"text",position:[1,1,3]},{type:"attr",position:[1,1,5]},{type:"text",position:[1,1,5,0]},{type:"text",position:[1,1,7]}]}},default:{}},{type:"attr",position:[1,1,1,0,1,13]},{type:"if",position:[1,1,1,0,1,13],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"componentDynamic",position:[1]}],_observedAttributes:["metaData","fromIndex","module","related_list_id","pageNo","sortOrder","projects_list","projectId","authMsg","showEditRLOptions","totalRecords","startIndex","entity_id","currentSelectedId","callFunction","loadingProjects","projectRLMetaData","accountName","accountid","contactEmail","personalityID","permValue","errorMessage","showErrorMessage","contactModuleName","showB2CPopUp","currentAction","moduleDispVal","isCanvasView"],init:function(){var t=this.getData("module"),e=moduleRecordMapping[t],o=$("#canvasPopupDiv");this.setData("isCanvasView",o.length>0),this.setData("moduleRecord",store.peekRecord(e.id,o.length>0?this.getData("entity_id"):$("#id").val())),this.setData("moduleDispVal",e.singular_label);var a=this.getData("moduleRecord");"Accounts"===t&&a&&(this.setData("accountName",a.Account_Name),this.setData("accountID",a.id)),"Contacts"===t&&(this.setData("contactModuleName",t),a&&(a.Email&&this.setData("contactEmail",a.Email),a.Account_Name&&(this.setData("accountID",a.Account_Name.id),this.setData("accountName",a.Account_Name.name)))),"Potentials"===t&&a&&a.Account_Name&&(this.setData("accountID",a.Account_Name.id),this.setData("accountName",a.Account_Name.name))},setPromptWarning:function(t,e){if("alert"===t){var o=document.getElementById("permErrorPrompt");o.ltProp("secondaryMessage",e),o.ltProp("show",!0)}else if("prompt"===t){var a=document.getElementById("projectDelPrompt");a.ltProp("secondaryMessage",e),a.ltProp("show",!0)}},deleteProjectRl:function(){var t=this,e=this.getData("currentSelectedId");e&&store.delete("zproject_rl",e,{moduleName:this.getData("module"),entityId:this.getData("entity_id")},{ids:e}).then((function(){var e=store.peekAll("zproject_rl").length;store.unloadAll("zproject_rl"),store.unloadAll("projmod_rl"),1!==t.getData("pageNo")&&e%10==0&&t.setData("pageNo",t.getData("pageNo")-1),t.encryptProjIdApi(),renderingUtils.showMsgBox(I18n.getMsg("crm.custom.module.delete.success",I18n.getMsg("Project")),"success"),t.setData("loadingProjects",!1),t.setData("currentSelectedId","")}),(function(){t.setData("loadingProjects",!1),t.setData("errorMessage",I18n.getMsg("crm.label.widgets.error.internal")),t.setData("showErrorMessage",!0)}))},data:function(){return{metaData:Lyte.attr("object"),fromIndex:Lyte.attr("number",{default:1}),module:Lyte.attr("string"),related_list_id:Lyte.attr("string"),pageNo:Lyte.attr("number",{default:1}),sortOrder:Lyte.attr("string",{default:"active"}),projects_list:Lyte.attr("array",{default:[]}),projectId:Lyte.attr("string"),authMsg:Lyte.attr("string"),showEditRLOptions:Lyte.attr("boolean",{default:!1}),totalRecords:Lyte.attr("number",{default:0}),startIndex:Lyte.attr("number",{default:0}),entity_id:Lyte.attr("string"),currentSelectedId:Lyte.attr("string"),callFunction:Lyte.attr("string"),loadingProjects:Lyte.attr("boolean",{default:!0}),projectRLMetaData:Lyte.attr("object"),accountName:Lyte.attr("string",{default:""}),accountid:Lyte.attr("string",{default:""}),contactEmail:Lyte.attr("string",{default:""}),personalityID:Lyte.attr("string",{default:""}),permValue:Lyte.attr("string",{default:""}),errorMessage:Lyte.attr("string",{default:""}),showErrorMessage:Lyte.attr("boolean",{default:!1}),contactModuleName:Lyte.attr("string"),showB2CPopUp:Lyte.attr("boolean",{default:!1}),currentAction:Lyte.attr("string"),moduleDispVal:Lyte.attr("string"),isCanvasView:Lyte.attr("boolean",{default:!1})}},projectRelApi:function(t){var e=this,o=e.getData("related_list_id");e.setData("loadingProjects",!0),app.store.makeRequest("findAll","zproject_rl",t,!1).then((function(t){e.setData("loadingProjects",!1);var a=$('[name="ID_PROJECTSPERSONALITY"]').val();if(t.hasOwnProperty("nopermission"))e.setData("noPermission",t.nopermission);else{var r=t.$.meta;e.setData("projects_list",t),e.setData("permValue",r.authenticatemsg),e.setData("projectRLMetaData",r);var s=$L("#RL_dataCount_"+r.listrelationid);if(r.totalCount){var i=0;if(s.css({cursor:"auto",padding:"2px 5px ",color:"#14161D",display:"inline-block","text-align":"center","font-size":"1. 2rem","margin-left":"8px",background:"#D2E2FE","border-radius":"7px","min-width":"12px","line-height":"normal",height:"auto"}),r.next_page)i=10*r.pageno,$(s).text(i+"+");else i=store.peekAll("zproject_rl").filter((function(t){if(t.ProjectStatus===e.getData("sortOrder"))return t})).length,0===t.length&&(i=0),$(s).text(i);$("#newleft_"+a).find("span.numCountn").addClass("numCountVal").text(r.next_page?i+"+":i),s.show()}}$L("#fetch_"+o).removeClass("ref_loading pointerEveNone").addClass("ref_complete")}),(function(){e.setData("loadingProjects",!1),$L("#fetch_"+o).removeClass("ref_loading pointerEveNone").addClass("ref_complete"),e.setData("errorMessage",I18n.getMsg("crm.label.widgets.error.internal")),e.setData("showErrorMessage",!0)}))},encryptProjIdApi:function(){var t=this,e={action:"getData",pname:"PROJECTPERSONALITY",module:this.getData("module"),id:this.getData("entity_id"),rid:this.getData("related_list_id"),isSortRequest:!1,fromIndex:this.getData("fromIndex")};t.setData("loadingProjects",!0),app.store.makeRequest("findAll","projmod_rl",e,!1).then((function(e){var o=e.ProjectObj;t.setData("projectId",o.projectIdList),t.setData("authMsg",o.authMsg);var a=t.setProjRLQueryParams(t.getData("sortOrder"));t.projectRelApi(a)}),(function(){t.setData("loadingProjects",!1),t.setData("errorMessage",I18n.getMsg("crm.label.widgets.error.internal")),t.setData("showErrorMessage",!0)}))},setProjRLQueryParams:function(t){var e={projectlistrelid:this.getData("related_list_id"),module:this.getData("module"),reqid:this.getData("entity_id"),returnAnchor:"projectspersonality_"+this.getData("related_list_id"),cvid:"",portalName:"",msg:this.getData("authMsg"),pageno:this.getData("pageNo"),projId:this.getData("projectId"),event:"projectlist"};return e.sortorder=void 0!==t?t:"active",e},didConnect:function(){this.encryptProjIdApi()},actions:{showDelPopFn:function(t,e){ZProjects.showDeleteProjPopup(t,e)},showUsrErrPopUp:function(){ZProjects.showUsrErrPopUp()},handleRefresh:function(t){t.id===this.getData("related_list_id")&&this.encryptProjIdApi()},projDeletionEvent:function(t){if(this.setData("currentSelectedId",t),!(Crm&&Crm.userDetails&&Crm.userDetails.permissions)||Crm.userDetails.permissions.Crm_Implied_Delete_Projects){var e=moduleRecordMapping[this.getData("module")].singular_label,o=I18n.getMsg("crm.project.remove.warning",[I18n.getMsg(e),Crm.brandName]);this.setData("callFunction","deletePromptAcceptfn"),this.setPromptWarning("prompt",o)}else{var a=I18n.getMsg("crm.projects.permissions.user.no.crmpermission");this.setPromptWarning("alert",a,void 0)}},newProjectSelected:function(){ZProjects.handleProjectsQCreate("Create",this.getData("entity_id"),this.getData("module")),this.setData("currentAction","Create")},associatedProjectSelected:function(){ZProjects.handleProjectsQCreate("Associate",this.getData("entity_id"),this.getData("module")),this.setData("currentAction","Associate")},changeIFrame:function(t,e){ZProjects.changeUrl(t,e)},closeIframe:function(){ZProjects.closeIframePopUp()},redirectToProjUpdate:function(){ZProjects.redirectToProjUpd()},loadProgressIframe:function(t,e){ZProjects.loadProgressFrame(t,e)},loadProjIframe:function(t,e,o,a){var r;switch(ZProjects.loadIframe(t,e,o,a),e){case"mile":r="milestonediv";break;case"task":r="taskdiv";break;case"bug":r="bugsdiv"}ZProjects.showIframe(r)}},methods:{projectGrpSelected:function(t,e){this.setData("sortOrder",e),this.setData("pageNo",1);var o=this.setProjRLQueryParams(e);this.projectRelApi(o)},deletePromptAcceptfn:function(){this.deleteProjectRl()},nextRlPage:function(){this.setData("pageNo",this.getData("pageNo")+1);var t=this.setProjRLQueryParams();this.projectRelApi(t)},previousRlPage:function(){this.setData("pageNo",this.getData("pageNo")-1);var t=this.setProjRLQueryParams();this.projectRelApi(t)},acceptB2Cfn:function(){this.setData("showB2CPopUp",!1),ZProjects.handleB2C(this.getData("currentAction"))},cancelB2Cfn:function(){this.setData("showB2CPopUp",!1)}}}),Lyte.Component.registerHelper("getSumList",(function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=parseInt(arguments[e]);return t})),Lyte.Component.registerHelper("arithmeticOperation",(function(t,e,o){switch(t=parseFloat(t),o=parseFloat(o),e){case"+":return t+o;case"-":return t-o;case"*":return t*o;case"/":return t/o;case"%":return t%o}})),Lyte.Component.registerHelper("getFontColor",(function(t){return getPickListFontColor(t)})),Lyte.Component.register("crm-zprojects-rl-loading",{_template:'<template tag-name="crm-zprojects-rl-loading"> <lyte-table class="zProjectsLoadTable" lt-prop-yield="true" lt-prop-width="100%"> <template is="registerYield" yield-name="yield"> <lyte-table-structure> <lyte-thead> <lyte-tr> <lyte-th><span class="zProjectLoading"></span></lyte-th> <lyte-th><span class="zProjectLoading"></span></lyte-th> <lyte-th><span class="zProjectLoading"></span></lyte-th> <lyte-th><span class="zProjectLoading"></span></lyte-th> <lyte-th><span class="zProjectLoading"></span></lyte-th> </lyte-tr> </lyte-thead> <lyte-tbody> <lyte-tr> <lyte-td><span class="zProjectLoading"></span></lyte-td> <lyte-td><span class="zProjectLoading"></span></lyte-td> <lyte-td><span class="zProjectLoading"></span></lyte-td> <lyte-td><span class="zProjectLoading"></span></lyte-td> <lyte-td><span class="zProjectLoading"></span></lyte-td> </lyte-tr> <lyte-tr> <lyte-td><span class="zProjectLoading"></span></lyte-td> <lyte-td><span class="zProjectLoading"></span></lyte-td> <lyte-td><span class="zProjectLoading"></span></lyte-td> <lyte-td><span class="zProjectLoading"></span></lyte-td> <lyte-td><span class="zProjectLoading"></span></lyte-td> </lyte-tr> <lyte-tr> <lyte-td><span class="zProjectLoading"></span></lyte-td> <lyte-td><span class="zProjectLoading"></span></lyte-td> <lyte-td><span class="zProjectLoading"></span></lyte-td> <lyte-td><span class="zProjectLoading"></span></lyte-td> <lyte-td><span class="zProjectLoading"></span></lyte-td> </lyte-tr> <lyte-tr> <lyte-td><span class="zProjectLoading"></span></lyte-td> <lyte-td><span class="zProjectLoading"></span></lyte-td> <lyte-td><span class="zProjectLoading"></span></lyte-td> <lyte-td><span class="zProjectLoading"></span></lyte-td> <lyte-td><span class="zProjectLoading"></span></lyte-td> </lyte-tr> </lyte-tbody> </lyte-table-structure> </template> </lyte-table> </template>',_dynamicNodes:[{type:"registerYield",position:[1,1],dynamicNodes:[{type:"componentDynamic",position:[1,1,1,1]},{type:"componentDynamic",position:[1,1,1,3]},{type:"componentDynamic",position:[1,1,1,5]},{type:"componentDynamic",position:[1,1,1,7]},{type:"componentDynamic",position:[1,1,1,9]},{type:"componentDynamic",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1,3,1,1]},{type:"componentDynamic",position:[1,3,1,3]},{type:"componentDynamic",position:[1,3,1,5]},{type:"componentDynamic",position:[1,3,1,7]},{type:"componentDynamic",position:[1,3,1,9]},{type:"componentDynamic",position:[1,3,1]},{type:"componentDynamic",position:[1,3,3,1]},{type:"componentDynamic",position:[1,3,3,3]},{type:"componentDynamic",position:[1,3,3,5]},{type:"componentDynamic",position:[1,3,3,7]},{type:"componentDynamic",position:[1,3,3,9]},{type:"componentDynamic",position:[1,3,3]},{type:"componentDynamic",position:[1,3,5,1]},{type:"componentDynamic",position:[1,3,5,3]},{type:"componentDynamic",position:[1,3,5,5]},{type:"componentDynamic",position:[1,3,5,7]},{type:"componentDynamic",position:[1,3,5,9]},{type:"componentDynamic",position:[1,3,5]},{type:"componentDynamic",position:[1,3,7,1]},{type:"componentDynamic",position:[1,3,7,3]},{type:"componentDynamic",position:[1,3,7,5]},{type:"componentDynamic",position:[1,3,7,7]},{type:"componentDynamic",position:[1,3,7,9]},{type:"componentDynamic",position:[1,3,7]},{type:"componentDynamic",position:[1,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}],data:function(){return{}}}),Lyte.Component.register("crm-zprojects-iframe",{_template:'<template tag-name="crm-zprojects-iframe"> <template is="if" value="{{completion}}"><template case="true"> <div id="zProjFreezeLayer" class="zProjFreezeLayer"></div> <div id="progressIframe"> <span class="zProjCloseframeOuter dN" onclick="{{action(\'closeProgressframe\')}}"> <span class="zProjCloseIcon svgIcons ico-close-small2"></span> </span> <iframe id="iframeprogress" frameborder="0" src="{{iframeurl}}" width="100%" height="100%"></iframe> </div> </template><template case="false"> <div id="freezeIframe" class="zProjTabFreeze"> <table cellpadding="0" cellspacing="0" width="100%"> <tbody><tr> <td> <div class="tasklistTitle1 pT15 pB15 pL35 lightGreyBg" style="height: 15px; border-radius: 10px 10px 0px 0px;border-bottom:1px solid #e4e4e4;"> <span onclick="{{action(\'closeProjIframe\')}}"><span class="fl projname_pop col2c7bd0 cP" id="projNameSet" title="{{getI18n(\'crm.project.backtolist\')}}"></span></span> <div class="fl pL35"> <a class="qulbl2 fl pLR15 pB5 color_9" id="taskdiv" href="javascript:ZProjects.changeUrl(\'task\', \'taskdiv\');">{{getI18n(\'Tasks\')}}</a> <a class="qulbl2 fl pLR15 pB5 color_9" id="bugsdiv" href="javascript:ZProjects.changeUrl(\'bug\', \'bugsdiv\'); ">{{getI18n(\'crm.project.list.bugs\')}}</a> <a class="qulbl2 fl pLR15 pB5 color_9" id="milestonediv" href="javascript:ZProjects.changeUrl(\'mile\', \'milestonediv\'); ">{{getI18n(\'crm.project.list.milestone\')}}</a> </div> <div id="proj_close" class="fR pR15 f15 color_7 pointer" title="Close" onclick="{{action(\'closeIframePopUp\')}}">X</div> </div> </td> </tr> <tr> <td> <iframe id="Iframe" frameborder="0" src="{{iframeurl}}" width="100%" height="{{iframeheight}}"></iframe> </td> </tr> </tbody></table> </div> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[3,1]},{type:"attr",position:[3,3]}]},false:{dynamicNodes:[{type:"attr",position:[1,1,1,0,1,1,1]},{type:"attr",position:[1,1,1,0,1,1,1,0]},{type:"text",position:[1,1,1,0,1,1,3,1,0]},{type:"text",position:[1,1,1,0,1,1,3,3,0]},{type:"text",position:[1,1,1,0,1,1,3,5,0]},{type:"attr",position:[1,1,1,0,1,1,5]},{type:"attr",position:[1,1,1,2,1,1]}]}},default:{}}],_observedAttributes:["iframeurl","iframeheight","completion","tabName"],data:function(){return{iframeurl:Lyte.attr("string",{default:""}),iframeheight:Lyte.attr("string"),completion:Lyte.attr("boolean",{default:!1}),tabName:Lyte.attr("object",{default:{}})}},didConnect:function(){this.getData("completion")&&(ZProjects.showProgressFrame(),$("#iframeprogress").load((function(){commonUtils.showHideLoadingDiv(!1),"about:blank"!==$("#iframeprogress")[0].src&&$(".zProjCloseframeOuter").removeClass("dN")})))},actions:{closeProjIframe:function(){ZProjects.closeIframePopUp()},closeProgressframe:function(){ZProjects.closeProgressframe()},closeIframePopUp:function(){ZProjects.closeIframePopUp()}}}),store.registerModel("projmod_rl",{listRelationId:Lyte.attr("string",{primaryKey:!0}),ProjectObj:Lyte.attr("object")}),store.registerAdapter("projmod_rl",{namespace:"crm",buildURL:function(t,e,o,a,r){return r.replace("projmod_rl","NewRelatedList.do")}}),store.registerSerializer("projmod_rl",{normalizeResponse:function(t,e,o){var a=document.getElementsByTagName("crm-zprojects-rl")[0].component,r=a.getData("related_list_id"),s=a.getData("module"),i={};return i.projmod_rl=o[s][r],i},payloadKey:function(t){return t}}),store.registerModel("zproject_rl",{OpenBugCNT:Lyte.attr("number",{default:0}),OpenMilestoneCNT:Lyte.attr("number",{default:0}),ProjectName:Lyte.attr("string"),ProjGroupName:Lyte.attr("string"),status_color:Lyte.attr("string"),custom_status:Lyte.attr("string"),ProjectId:Lyte.attr("string",{primaryKey:!0}),OpenTask:Lyte.attr("number",{default:0}),Index:Lyte.attr("number"),ProjectStatus:Lyte.attr("string",{default:"active"}),CloseBugCNT:Lyte.attr("number",{default:0}),CloseTask:Lyte.attr("number",{default:0}),BugCompletionPercentage:Lyte.attr("number",{default:0}),CloseMilestoneCNT:Lyte.attr("number",{default:0}),TaskCompletion:Lyte.attr("number",{default:0}),MilestoneCompletionPercentage:Lyte.attr("number",{default:0}),Project_completion:Lyte.attr("number",{default:0})}),store.registerAdapter("zproject_rl",{namespace:"crm",buildURL:function(t,e,o,a,r,s,i){if("delete"===e){var n=i.moduleName,p=i.entityId;return r.replace("zproject_rl","v2/"+n+"/"+p+"/Zoho_Projects")}return r.replace("zproject_rl","ProjectConfig.do")}}),store.registerSerializer("zproject_rl",{normalizeResponse:function(t,e,o){if("delete"===e)return o={};var a={};return o?o.hasOwnProperty("nopermission")?(a.projectList=o,a.projectList.ProjectId="",o=a):(a.projectList=o.projectList.slice(0),delete o.projectList,a.info=o,o=a):void 0},payloadKey:function(t,e){return"delete"===e?t:"projectList"}}),store.registerModel("zprojects_rl",{OpenBugCNT:Lyte.attr("number",{default:0}),OpenMilestoneCNT:Lyte.attr("number",{default:0}),ProjectName:Lyte.attr("string"),ProjectId:Lyte.attr("string",{primaryKey:!0}),OpenTask:Lyte.attr("number",{default:0}),Index:Lyte.attr("number"),ProjectStatus:Lyte.attr("string",{default:"active"}),CloseBugCNT:Lyte.attr("number",{default:0}),CloseTask:Lyte.attr("number",{default:0}),BugCompletionPercentage:Lyte.attr("number",{default:0}),CloseMilestoneCNT:Lyte.attr("number",{default:0}),TaskCompletion:Lyte.attr("number",{default:0}),MilestoneCompletionPercentage:Lyte.attr("number",{default:0}),ProjectUsersList:Lyte.attr("array",{default:[]}),ClientUsersList:Lyte.attr("array",{default:[]})}),store.registerAdapter("zprojects_rl",{namespace:"crm",buildURL:function(t,e,o,a,r,s,i){var n=i.moduleName,p=i.entity_id,l=a.ProjectId;switch(r=r.split(t)[0],e){case"deleteRecord":r=r.concat("v2/"+n+"/"+p+"/Zoho_Projects");break;case"updateRecord":r=r.concat("v2/"+n+"/"+p+"/Zoho_Projects/"+l+"/users")}return r},methodForRequest:function(t){return"PATCH"===t?"PUT":t}}),store.registerSerializer("zprojects_rl",{serialize:function(t,e,o,a,r){switch(t){case"updateRecord":var s={};s.action=a.action,s.client_name=a.client_name,s.project_id=o.ProjectId,s.project_name=o.ProjectName,s.crm_account_id=a.crm_account_id;for(var i=a.projectUserMap,n=a.existingProjectUsers,p=[],l=0,c=i.length;l<c;l++){var d={},m=i[l],y=m.email;d.email=y,m.is_user_selected&&n.includes(y)||!m.is_user_selected&&!n.includes(y)||(m.is_user_selected&&!n.includes(y)&&(d.profile_id=m.project_profile_id,d.role_id=m.project_role_id),!m.is_user_selected&&n.includes(y)&&(d.zuid=m.id,d._delete="null"),p.push(d))}s.project_users=p;var u=a.existingClientUsers,g=a.clientUserMap,j=[],f=store.peekAll("project_profiles").filter((function(t){return"client"===t.type&&t.default}));for(l=0,c=g.length;l<c;l++){var h={},v=g[l];y=v.email;if(h.email=y,!(v.is_user_selected&&!v.portal_access_enabled&&u.includes(y)||!v.is_user_selected&&v.portal_access_enabled&&!u.includes(y))){if(v.is_user_selected){h.crm_contactId=v.contact_id,h.zpuser_id=v.zpuserid,h.portal_access_enabled=v.portal_access_enabled;var P=v.profile_id;h.profile_id=P||f[0].id}!v.is_user_selected&&u.includes(y)&&(h._delete="null",h.portal_access_enabled=v.portal_access_enabled,h.zpuser_id=v.zpuserid,h.crm_contactId=v.contact_id),h&&Object.keys(h).length>1&&j.push(h)}}s.client_users=j;var _=[];_.push(s),delete e[r],e.data=_;break;case"deleteRecord":e={}}return e}});
