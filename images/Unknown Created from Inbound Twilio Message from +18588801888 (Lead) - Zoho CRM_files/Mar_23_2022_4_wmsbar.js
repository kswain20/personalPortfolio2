($WC=($WC=function(e){"use strict";var y,r,t,s,o,_={},W=[],i=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord/i;function S(e,t){for(var s in t)e[s]=t[s];return e}function v(e){var t=e.parentNode;t&&t.removeChild(e)}function k(e,t,s){var i,n=arguments,a={};for(i in t)"key"!==i&&"ref"!==i&&(a[i]=t[i]);if(3<arguments.length)for(s=[s],i=3;i<arguments.length;i++)s.push(n[i]);if(null!=s&&(a.children=s),"function"==typeof e&&null!=e.defaultProps)for(i in e.defaultProps)void 0===a[i]&&(a[i]=e.defaultProps[i]);return l(e,a,t&&t.key,t&&t.ref)}function l(e,t,s,i){var n={type:e,props:t,key:s,ref:i,__k:null,__:null,__b:0,__e:null,__d:null,__c:null,constructor:void 0};return y.vnode&&y.vnode(n),n}function w(e){return e.children}function M(e,t){this.props=e,this.context=t}function b(e,t){if(null==t)return e.__?b(e.__,e.__.__k.indexOf(e)+1):null;for(var s;t<e.__k.length;t++)if(null!=(s=e.__k[t])&&null!=s.__e)return s.__e;return"function"==typeof e.type?b(e):null}function d(e){var t,s;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(s=e.__k[t])&&null!=s.__e){e.__e=e.__c.base=s.__e;break}return d(e)}}function n(e){(!e.__d&&(e.__d=!0)&&1===r.push(e)||s!==y.debounceRendering)&&((s=y.debounceRendering)||t)(a)}function a(){var e,t,s,i,n,a,o;for(r.sort(function(e,t){return t.__v.__b-e.__v.__b});e=r.pop();)e.__d&&(i=s=void 0,a=(n=(t=e).__v).__e,(o=t.__P)&&(s=[],i=E(o,n,S({},n),t.__n,void 0!==o.ownerSVGElement,null,s,null==a?b(n):a),u(s,n),i!=a&&d(n)))}function I(t,s,e,i,n,a,o,r,l){var d,c,m,u,p,h,g,f=e&&e.__k||W,C=f.length;if(r==_&&(r=null!=a?a[0]:C?b(e,0):null),d=0,s.__k=T(s.__k,function(e){if(null!=e){if(e.__=s,e.__b=s.__b+1,null===(m=f[d])||m&&e.key==m.key&&e.type===m.type)f[d]=void 0;else for(c=0;c<C;c++){if((m=f[c])&&e.key==m.key&&e.type===m.type){f[c]=void 0;break}m=null}if(u=E(t,e,m=m||_,i,n,a,o,r,l),(c=e.ref)&&m.ref!=c&&(g=g||[],m.ref&&g.push(m.ref,null,e),g.push(c,e.__c||u,e)),null!=u){if(null==h&&(h=u),null!=e.__d)u=e.__d,e.__d=null;else if(a==m||u!=r||null==u.parentNode){e:if(null==r||r.parentNode!==t)t.appendChild(u);else{for(p=r,c=0;(p=p.nextSibling)&&c<C;c+=2)if(p==u)break e;t.insertBefore(u,r)}"option"==s.type&&(t.value="")}r=u.nextSibling,"function"==typeof s.type&&(s.__d=u)}}return d++,e}),s.__e=h,null!=a&&"function"!=typeof s.type)for(d=a.length;d--;)null!=a[d]&&v(a[d]);for(d=C;d--;)null!=f[d]&&x(f[d],f[d]);if(g)for(d=0;d<g.length;d++)U(g[d],g[++d],g[++d])}function T(e,t,s){if(null==s&&(s=[]),null==e||"boolean"==typeof e)t&&s.push(t(null));else if(Array.isArray(e))for(var i=0;i<e.length;i++)T(e[i],t,s);else s.push(t?t("string"==typeof e||"number"==typeof e?l(null,e,null,null):null!=e.__e||null!=e.__c?l(e.type,e.props,e.key,null):e):e);return s}function c(e,t,s){"-"===t[0]?e.setProperty(t,s):e[t]="number"==typeof s&&!1===i.test(t)?s+"px":null==s?"":s}function A(e,t,s,i,n){var a,o,r,l,d;if(n?"className"===t&&(t="class"):"class"===t&&(t="className"),"key"!==t&&"children"!==t)if("style"===t)if(a=e.style,"string"==typeof s)a.cssText=s;else{if("string"==typeof i&&(a.cssText="",i=null),i)for(o in i)s&&o in s||c(a,o,"");if(s)for(r in s)i&&s[r]===i[r]||c(a,r,s[r])}else"o"===t[0]&&"n"===t[1]?(l=t!==(t=t.replace(/Capture$/,"")),t=((d=t.toLowerCase())in e?d:t).slice(2),s?(i||e.addEventListener(t,m,l),(e.l||(e.l={}))[t]=s):e.removeEventListener(t,m,l)):"list"!==t&&"tagName"!==t&&"form"!==t&&"type"!==t&&!n&&t in e?e[t]=null==s?"":s:"function"!=typeof s&&"dangerouslySetInnerHTML"!==t&&(t!==(t=t.replace(/^xlink:?/,""))?null==s||!1===s?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),s):null==s||!1===s?e.removeAttribute(t):e.setAttribute(t,s))}function m(e){this.l[e.type](y.event?y.event(e):e)}function E(e,t,s,i,n,a,o,r,l){var d,c,m,u,p,h,g,f,C,v,b=t.type;if(void 0!==t.constructor)return null;(d=y.__b)&&d(t);try{e:if("function"==typeof b){if(f=t.props,C=(d=b.contextType)&&i[d.__c],v=d?C?C.props.value:d.__:i,s.__c?g=(c=t.__c=s.__c).__=c.__E:("prototype"in b&&b.prototype.render?t.__c=c=new b(f,v):(t.__c=c=new M(f,v),c.constructor=b,c.render=N),C&&C.sub(c),c.props=f,c.state||(c.state={}),c.context=v,c.__n=i,m=c.__d=!0,c.__h=[]),null==c.__s&&(c.__s=c.state),null!=b.getDerivedStateFromProps&&(c.__s==c.state&&(c.__s=S({},c.__s)),S(c.__s,b.getDerivedStateFromProps(f,c.__s))),u=c.props,p=c.state,m)null==b.getDerivedStateFromProps&&null!=c.componentWillMount&&c.componentWillMount(),null!=c.componentDidMount&&c.__h.push(c.componentDidMount);else{if(null==b.getDerivedStateFromProps&&f!==u&&null!=c.componentWillReceiveProps&&c.componentWillReceiveProps(f,v),!c.__e&&null!=c.shouldComponentUpdate&&!1===c.shouldComponentUpdate(f,c.__s,v)){for(c.props=f,c.state=c.__s,c.__d=!1,(c.__v=t).__e=s.__e,t.__k=s.__k,c.__h.length&&o.push(c),d=0;d<t.__k.length;d++)t.__k[d]&&(t.__k[d].__=t);break e}null!=c.componentWillUpdate&&c.componentWillUpdate(f,c.__s,v),null!=c.componentDidUpdate&&c.__h.push(function(){c.componentDidUpdate(u,p,h)})}c.context=v,c.props=f,c.state=c.__s,(d=y.__r)&&d(t),c.__d=!1,c.__v=t,c.__P=e,d=c.render(c.props,c.state,c.context),t.__k=T(null!=d&&d.type==w&&null==d.key?d.props.children:d),null!=c.getChildContext&&(i=S(S({},i),c.getChildContext())),m||null==c.getSnapshotBeforeUpdate||(h=c.getSnapshotBeforeUpdate(u,p)),I(e,t,s,i,n,a,o,r,l),c.base=t.__e,c.__h.length&&o.push(c),g&&(c.__E=c.__=null),c.__e=null}else t.__e=function(e,t,s,i,n,a,o,r){var l,d,c,m,u,p=s.props,h=t.props;if(n="svg"===t.type||n,null==e&&null!=a)for(l=0;l<a.length;l++)if(null!=(d=a[l])&&(null===t.type?3===d.nodeType:d.localName===t.type)){e=d,a[l]=null;break}if(null==e){if(null===t.type)return document.createTextNode(h);e=n?document.createElementNS("http://www.w3.org/2000/svg",t.type):document.createElement(t.type),a=null}if(null===t.type)null!=a&&(a[a.indexOf(e)]=null),p!==h&&e.data!=h&&(e.data=h);else if(t!==s){if(null!=a&&(a=W.slice.call(e.childNodes)),c=(p=s.props||_).dangerouslySetInnerHTML,m=h.dangerouslySetInnerHTML,!r){if(p===_)for(p={},u=0;u<e.attributes.length;u++)p[e.attributes[u].name]=e.attributes[u].value;(m||c)&&(m&&c&&m.__html==c.__html||(e.innerHTML=m&&m.__html||""))}(function(e,t,s,i,n){var a;for(a in s)a in t||A(e,a,null,s[a],i);for(a in t)n&&"function"!=typeof t[a]||"value"===a||"checked"===a||s[a]===t[a]||A(e,a,t[a],s[a],i)})(e,h,p,n,r),t.__k=t.props.children,m||I(e,t,s,i,"foreignObject"!==t.type&&n,a,o,_,r),r||("value"in h&&void 0!==h.value&&h.value!==e.value&&(e.value=null==h.value?"":h.value),"checked"in h&&void 0!==h.checked&&h.checked!==e.checked&&(e.checked=h.checked))}return e}(s.__e,t,s,i,n,a,o,l);(d=y.diffed)&&d(t)}catch(e){y.__e(e,t,s)}return t.__e}function u(e,t){y.__c&&y.__c(t,e),e.some(function(t){try{e=t.__h,t.__h=[],e.some(function(e){e.call(t)})}catch(e){y.__e(e,t.__v)}})}function U(e,t,s){try{"function"==typeof e?e(t):e.current=t}catch(e){y.__e(e,s)}}function x(e,t,s){var i,n,a;if(y.unmount&&y.unmount(e),(i=e.ref)&&(i.current&&i.current!==e.__e||U(i,null,t)),s||"function"==typeof e.type||(s=null!=(n=e.__e)),e.__e=e.__d=null,null!=(i=e.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(e){y.__e(e,t)}i.base=i.__P=null}if(i=e.__k)for(a=0;a<i.length;a++)i[a]&&x(i[a],t,s);null!=n&&v(n)}function N(e,t,s){return this.constructor(e,s)}function O(e,t,s){var i,n,a;y.__&&y.__(e,t),n=(i=s===o)?null:s&&s.__k||t.__k,e=k(w,null,[e]),a=[],E(t,(!i&&s||t).__k=e,n||_,_,void 0!==t.ownerSVGElement,s&&!i?[s]:n?null:W.slice.call(t.childNodes),a,s||_,i),u(a,e)}y={__e:function(e,t){for(var s,i;t=t.__;)if((s=t.__c)&&!s.__)try{if(s.constructor&&null!=s.constructor.getDerivedStateFromError&&(i=!0,s.setState(s.constructor.getDerivedStateFromError(e))),null!=s.componentDidCatch&&(i=!0,s.componentDidCatch(e)),i)return n(s.__E=s)}catch(t){e=t}throw e}},M.prototype.setState=function(e,t){var s;s=this.__s!==this.state?this.__s:this.__s=S({},this.state),"function"==typeof e&&(e=e(s,this.props)),e&&S(s,e),null!=e&&this.__v&&(this.__e=!1,t&&this.__h.push(t),n(this))},M.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),n(this))},M.prototype.render=w,r=[],t="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,o=_;var p={focusoff:"mc4b6e3fc0_focusoff",focuson:"mc4b6e3fc0_focuson",button:"mc4b6e3fc0_button",icon:"mc4b6e3fc0_icon",negative:"mc4b6e3fc0_negative",positive:"mc4b6e3fc0_positive",zmNightMode:"zmNightMode"},R=function(e){function t(){e.call(this),this.state={clicked:!1},this.onButtonPress=this.onButtonPress.bind(this),this.setClickedState=this.setClickedState.bind(this),this.onBlur=this.onBlur.bind(this)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.setClickedState=function(){this.focusclass=p.focusoff,this.setState({clicked:!0})},t.prototype.onBlur=function(){this.focusclass=p.focuson,this.setState({clicked:!1})},t.prototype.onButtonPress=function(e){var t,s=this.props.onclick;"object"==typeof this.props.onclick&&(t=this.props.onclick.link,s=this.props.onclick.callback),"click"===e.type&&s&&(t&&window.open(t,"_blank","noopener,noreferrer"),s(e));"keydown"!==e.type||13!==e.keyCode&&32!==e.keyCode||(t&&window.open(t,"_blank","noopener,noreferrer"),s(e))},t.prototype.render=function(e){var t=e.classname+" "||"",s=e.tabindex||"0",i="",n="",a=(this.state.clicked?p.focusoff:p.focuson)+" ",o=e.children,r="";"button"===e.type&&(i=p.button+" ",o=e.content),"icon"===e.type&&(i=p.icon+" ",n=String.fromCharCode(parseInt(e.content,16))),1<=e.size&&(r=p[e.type+"size"+e.size]);var l="";return 1<=e.theme&&(l=p["theme"+e.theme]+" "),"negative"==e.theme&&(l=p.negative),"positive"==e.theme&&(l=p.positive),k("div",{"data-content":n,title:e.title,class:i+t+a+l+r,tabindex:s,style:e.style,onblur:this.onBlur,onclick:this.onButtonPress,onmouseover:this.props.onmouseover,onmousedown:this.setClickedState,onmouseout:this.props.onmouseout,onkeydown:this.onButtonPress},o)},t}(M),h={mountComponent:function(e,t,s,i,n,a,o,r){O(k(R,{type:t,size:s,content:i,theme:n,title:o,classname:a,onclick:r}),e)}},g={calendarcontainer:"mc266c4d21_calendarcontainer",mountedtop:"mc266c4d21_mountedtop",mountedbottom:"mc266c4d21_mountedbottom",month:"mc266c4d21_month",monthcnt:"mc266c4d21_monthcnt",yearpadding:"mc266c4d21_yearpadding",arrowright:"mc266c4d21_arrowright",arrowleft:"mc266c4d21_arrowleft",weekheader:"mc266c4d21_weekheader",dayscontainer:"mc266c4d21_dayscontainer",weekscontainer:"mc266c4d21_weekscontainer",weekheadercnt:"mc266c4d21_weekheadercnt",days:"mc266c4d21_days",daysprev:"mc266c4d21_daysprev",slideanimation:"mc266c4d21_slideanimation",slidein:"mc266c4d21_slidein",slideout:"mc266c4d21_slideout",selecteddate:"mc266c4d21_selecteddate",zmNightMode:"zmNightMode",dayscrnt:"mc266c4d21_dayscrnt"},f={},H={get:function(e){return f[e]},set:function(e){if("object"==typeof e)for(var t in e)f[t]=e[t]}};function $(e,t){var s;if("string"==typeof e||"boolean"==typeof e||"number"==typeof e?s=e:e&&(s=e.id,t=e.params),H.get("Resource"))return H.get("Resource").getRealValue(s,t);WmsResource.getRealValue(s,t)}function C(){return k("div",null,k("div",{class:g.weekheader},["common.days.su","common.days.mo","common.days.tu","common.days.we","common.days.th","common.days.fr","common.days.sa"].map(function(e,t){return k("div",{key:t,class:g.weekheadercnt},k($,{id:e}))})))}function D(e){return k($,{id:["common.month.january","common.month.february","common.month.march","common.month.april","common.month.may","common.month.june","common.month.july","common.month.august","common.month.september","common.month.october","common.month.november","common.month.december"][e.month_number]})}var L=function(s){function e(e){s.call(this,e),this.calnode=null,this.starting_date=null,this.selected_element=null,this.setfocusafterswitch=!1;var t=new Date;e.selecteddate&&(t=new Date(e.selecteddate)),t.setHours(0,0,0,0),this.state={selected_date:t,initial_date:t},this.onDateSelection=this.props.onDateSelection,this.moveBackward=this.moveBackward.bind(this),this.moveForward=this.moveForward.bind(this),this.setCalendarDomNode=this.setCalendarDomNode.bind(this),this.updateSelectedDate=this.updateSelectedDate.bind(this),this.getWeeks=this.getWeeks.bind(this),this.setSelectedDateNode=this.setSelectedDateNode.bind(this),this.setStartingDate(this.state.initial_date)}return s&&(e.__proto__=s),((e.prototype=Object.create(s&&s.prototype)).constructor=e).prototype.setCalendarDomNode=function(e){this.calnode=e},e.prototype.setSelectedDateNode=function(e){e&&e.classList.contains(g.selecteddate)&&(this.selected_element=e)},e.prototype.componentWillUnmount=function(){this.calnode.classList.contains(g.slidein)&&this.calnode.classList.remove(g.slidein),this.calnode.classList.contains(g.slideout)&&this.calnode.classList.remove(g.slideout)},e.prototype.componentDidUpdate=function(e,t){var s="",i=t.initial_date.getMonth(),n=this.state.initial_date.getMonth(),a=t.initial_date.getFullYear(),o=this.state.initial_date.getFullYear();i<n?s=o<a?"slidein":"slideout":n<i&&(s=a<o?"slideout":"slidein"),this.selected_element&&(this.setfocusafterswitch?this.selected_element.focus():this.selected_element.blur()),this.setTransition(s)},e.prototype.setTransition=function(e){""!=e&&(this.calnode.classList.remove(g.slideout),this.calnode.classList.remove(g.slidein),this.calnode.getBoundingClientRect(),this.calnode.classList.add(g[e]))},e.prototype.setStartingDate=function(e){this.starting_date=new Date(e.getTime()),this.starting_date.setDate(1),this.starting_date.setDate(this.starting_date.getDate()-this.starting_date.getDay())},e.prototype.switchMonth=function(e){return this.state.initial_date.getTime()<e.getTime()?this.getNextInitialDate():this.state.initial_date.getTime()>e.getTime()?this.getPreviousInitialDate():void 0},e.prototype.updateSelectedDate=function(e){if(this.setfocusafterswitch=!1,"keydown"===e.type&&(13===e.keyCode||32===e.keyCode)||"click"==e.type){var t=new Date(this.starting_date.getTime()),s=this.state.initial_date,i=e.target.getAttribute("data-id");t.setDate(this.starting_date.getDate()+parseInt(i)),t.getMonth()!=this.state.initial_date.getMonth()&&(s=this.switchMonth(t),this.setfocusafterswitch=!0),this.setState({selected_date:t,initial_date:s}),this.onDateSelection(t)}},e.prototype.getNextInitialDate=function(){var e=new Date(this.state.initial_date.getTime());return e.setMonth(e.getMonth()+1),e.setDate(1),this.setStartingDate(e),e},e.prototype.getPreviousInitialDate=function(){var e=new Date(this.state.initial_date.getTime());return e.setMonth(e.getMonth()-1),e.setDate(1),this.setStartingDate(e),e},e.prototype.moveForward=function(){this.setState({initial_date:this.getNextInitialDate()})},e.prototype.moveBackward=function(){this.setState({initial_date:this.getPreviousInitialDate()})},e.prototype.getWeeks=function(){var e=new Date(this.starting_date),t=this.state.initial_date.getMonth(),s=[],i=0,n=this.state.selected_date,a=new Date(e.getTime());a.setHours(0,0,0,0);for(var o=0;o<6;o++){for(var r=[],l=0;l<7;l++){var d=" "+g.dayscrnt;a.getMonth()!=t&&(d=" "+g.daysprev);var c="";n.getTime()===a.getTime()&&(c=" "+g.selecteddate),r.push(k("div",{key:a.getMonth()+""+a.getDate(),tabindex:"0","data-id":i++,class:g.days+d+c,ref:this.setSelectedDateNode,onclick:this.updateSelectedDate,onkeydown:this.updateSelectedDate},a.getDate())),a.setDate(a.getDate()+1)}s.push(k("div",{class:g.dayscontainer}," ",r," "))}return k("div",{class:g.weekscontainer},s)},e.prototype.render=function(e){var t=e.mounttop?g.mountedtop:g.mountedbottom,s=e.customclass&&e.customclass.calendarcontainer?e.customclass.calendarcontainer:"";return k("div",{class:g.calendarcontainer+" "+s+" "+t},k("div",{class:g.month},k("button",{class:g.arrowleft,onclick:this.moveBackward}),k("div",{class:g.monthcnt},k(D,{month_number:this.state.initial_date.getMonth()}),", ",k("span",{class:g.yearpadding},this.state.initial_date.getFullYear())),k("button",{class:g.arrowright,onclick:this.moveForward})),k(C,null),k("div",{ref:this.setCalendarDomNode},this.getWeeks()))},e}(M),P={mountComponent:function(e,t){O(k(L,{onDateSelection:t}),e)}},B={notifications:{},close:function(e){void 0!==this.notifications[e]&&(this.notifications[e].notifyobj.close(),clearTimeout(this.notifications[e].timer),delete this.notifications[e])},requestPermission:function(){"undefined"!=typeof Notification&&"default"===Notification.permission&&Notification.requestPermission()},show:function(t){if("undefined"!=typeof Notification&&"granted"===Notification.permission){if(t.checkownership&&!1===t.checkownership.isOwner())return;t.tag=t.id,this.close(t.id),void 0===this.notifications[t.id]&&(this.notifications[t.id]={});var s=new Notification(t.title,t);return this.notifications[t.id].notifyobj=s,t.duration&&(this.notifications[t.id].timer=setTimeout(function(){this.close(t.id)}.bind(this),t.duration)),s.onclick=function(e){window.focus(),"function"==typeof t.onclick&&t.onclick.call(s,e),this.close(t.id)}.bind(this),s}}},j="mcd44f5b7f_parentcomponent",F="mcd44f5b7f_datepickercontainer",z="mcd44f5b7f_mountedbottom",G="mcd44f5b7f_mountedtop",q="mcd44f5b7f_calendarposition",Y="mcd44f5b7f_datecnt",V="mcd44f5b7f_placeholder",Z="mcd44f5b7f_calendaricon",K="mcd44f5b7f_calendarviaforms",X="mcd44f5b7f_calendarwidth",J="mcd44f5b7f_closeicon",Q=function(t){function e(e){t.call(this,e),this.setContainerNode=this.setContainerNode.bind(this),this.clickOutsideListener=this.clickOutsideListener.bind(this),this.onClickOutside=this.props.onClickOutside}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.setContainerNode=function(e){this.containernode=e},e.prototype.clickOutsideListener=function(e){this.containernode&&!this.containernode.contains(e.target)&&this.onClickOutside(e)},e.prototype.componentDidMount=function(){window.addEventListener("click",this.clickOutsideListener)},e.prototype.componentWillUnmount=function(){window.removeEventListener("click",this.clickOutsideListener)},e.prototype.render=function(e){return k("div",{ref:this.setContainerNode},e.children)},e}(M);function ee(e){var t=new Date(Number(e)),s=t.getHours(),i=t.getMinutes(),n="",a=12<s?s-12:0==s?"12":s;return n+=a<10?"0"+a:a,n+=(i<10?":0":":")+i,n+=12<=s?" "+$("PM"):" "+$("AM")}function te(e){var t=new Date(Number(e)),s=t.getHours(),i=t.getMinutes(),n="";n+=ne(e)+" ";var a=12<s?s-12:0==s?"12":s;return n+=a<10?"0"+a:a,n+=(i<10?":0":":")+i,n+=12<=s?" "+$("PM"):" "+$("AM")}function se(e,t){var s,i=new Date(Number(e)),n="";if(null==(t=H.get("dateformat")?H.get("dateformat"):t))return n+=i.getDate(),n+=" "+(s=i.getMonth(),$(new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec")[s])),(new Date).getFullYear()!==i.getFullYear()&&(n+=" "+i.getFullYear()),n;var a=i.getDate(),o=i.getMonth()+1,r=i.getFullYear();t=(t=(t=t.replace(/dd/,a<10?"0"+a:a)).replace(/MM/,o<10?"0"+o:o)).replace(/yyyy/,r);var l=(""+r).substr(2,4);return n=(t=t.replace(/yy/,l<10?"0"+l:l))+" "}function ie(e,t){return se(e)===se(t)}function ne(e){var t=new Date(Number(e)),s=new Date;return ie(t,s)?$("chat.today"):(s.setDate(s.getDate()-1),ie(t,s)?$("chat.yesterday"):(s.setDate(s.getDate()+2),ie(t,s)?$("chat.tomorrow"):se(e)))}function ae(e,t){var s=new Date;return ee(s.getTime()+6e4*s.getTimezoneOffset()+parseInt(t))+" ( "+e+" )"}function oe(e){var t=new Date(e),s=t.getHours(),i=t.getMinutes();return(s<10?"0"+s:s)+":"+(i<10?"0"+i:i)+":00"}function re(e){var t=new Date(e),s=e.split("-"),i=s[0],n=s[1],a=s[2].split("T")[0];return!(!t||t.getFullYear()!=i||n!=t.getMonth()+1||t.getDate()!=a)}function le(e,t){function s(e,t,s){var i=s?"":n.suffixago;return e.replace(/%d/i,t)+" "+i}var i={seconds:$("common.reltime.seconds"),minute:$("common.reltime.minute","%d"),minutes:$("common.reltime.minutes","%d"),hour:$("chat.hour","%d"),hours:$("chat.hours","%d"),day:$("chat.yesterday"),days:$("common.reltime.days","%d"),month:$("common.reltime.month","%d"),months:$("common.reltime.months","%d"),year:$("common.reltime.year"),years:$("common.reltime.years","%d"),suffixago:$("common.reltime.suffixago")},n=$WC.Util.cloneObject(i),a=new Date-parseInt(e),o=6e4<a,r=Math.abs(a)/1e3,l=r/60,d=l/60,c=d/24,m=c/365;return r<60&&s(n.seconds,parseInt(r),!o)||r<120&&s(n.minute,1,!o)||l<60&&s(n.minutes,parseInt(l),!o)||l<120&&s(n.hour,1,!o)||d<24&&s(n.hours,parseInt(d),!o)||d<48&&s(n.day,1,!t.shorten||!o)||c<30&&s(n.days,parseInt(c),!o)||c<60&&s(n.month,1,!o)||c<365&&s(n.months,parseInt(c/30),!o)||m<2&&s(n.year,1,!o)||s(n.years,parseInt(m),!o)}var de=Object.freeze({__proto__:null,formatTime:ee,formatDTTime:te,formatDate:se,isSameDay:ie,formatDateWithWords:ne,getOtherZoneTime:ae,relativeTimeLeft:function(e){var t,s=[],i=parseInt(e)-Date.now();return(i/=1e3)<=60?$("chat.mute.seconds"):(86400<i&&(t=parseInt(i/86400),s.push(t),s.push($(1===t?"chat.mute.day":"chat.mute.days")),i%=86400),3600<i&&(t=parseInt(i/3600),s.push(t),s.push($(1===t?"chat.mute.hour":"chat.mute.hours")),i%=3600),60<i&&(t=parseInt(i/60),s.push(t),s.push($(1===t?"chat.mute.minute":"chat.mute.minutes")),i%=60),s.join(" "))},formatTime24hr:oe,isValidPresetDate:re,getRelativeTimeString:le});function ce(e,t,s,i){var n="";i=i||"",s&&((n=new Date).setTime(n.getTime()+s),n=n.toUTCString()),document.cookie=e+"="+encodeURIComponent(t)+";expires="+n+";domain="+i+";path=/;SameSite=Strict;Secure;"}function me(e){for(var t=document.cookie.split("; "),s=0;s<t.length;s++){var i=t[s].split("=");if(i[0]===e)return decodeURIComponent(i[1])}return""}function ue(e,t){t=t||"",document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;domain="+t+";path=/"}function pe(e){try{"session"===e&&sessionStorage?this.storage=sessionStorage:"local"===e&&localStorage&&(this.storage=localStorage)}catch(e){this.storage=new fe}}var he=Object.freeze({__proto__:null,set:ce,get:me,remove:ue}),ge={regexes:{gmail:/^[A-Za-z0-9](\.?[A-Za-z0-9]){5,}@gmail\.com$/,facebook:/^[A-Za-z0-9\.]+$/,yahoo:/^[A-Za-z0-9]((\.|_)?[A-Za-z0-9]){5,}@(yahoo|ymail|rocketmail)\.com$/,msn:/^[A-Za-z0-9-_](\.?[A-Za-z0-9-_]){5,}@(outlook|hotmail|live)\.com$/,edge_useragent_lowercase:/edge\/(\d+)/,chrome_useragent_lowercase:/(?:chrome|crios)\/(\d+)/,firefox_useragent_lowercase:/(?:firefox|fxios)\/(\d+)/,opera_useragent_lowercase:/(?:^opera.+?version|opr)\/(\d+)/,ie_useragent_lowercase:/(?:msie |trident.+?; rv:)(\d+)/,safari_useragent_lowercase:/version\/(\d+).+?safari/,qq:/^[0-9]+$/,icq:/^[0-9]+$/,emailid:/^[A-Za-z0-9]([A-Za-z0-9-._%+']*)@[A-Za-z0-9-.]+\.[a-zA-Z]{2,30}$/,empty:/^\s*$/,hexcolourcode:/^([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,customdate:/^(0?[1-9]|1[012])\/(0?[1-9]|[12][0-9]|3[01])\/([0-9]{1,4})$/,time:/^(0?[1-9]|1[012])(:[0-5]\d)[APap][mM]$|^([01]?[0-9]|2[0-3]):[0-5]\d$/,escaperegexp:/[-[\]{}()*+?.,\\^$|#\s]/g,escapeReplacementString:/\$/g,removespaces:/ /g,removehtmltag:/<([a-z0-9]+)(?:.*?)(?:>(?:([\s\S]*?)<\/\1>)?)/g,containerid:/[^a-zA-Z0-9-]/g,mail:/([a-z0-9]([a-z0-9_\-.+]*)@([a-z0-9_\-.]*)(\.[a-z]{2,30}(\.[a-z]{2}){0,2}))/,link:/(?:(href|src)=["']?)?((https?:\/\/(?:www\.)?|www\.)[a-z0-9][^@]*?)(?=[\s"'<]|$)/gi,markdown_image:/(^|\s)!\[(.+?)\]\(((?:https?:\/\/(?:www\.)?|www\.)[a-z0-9][^@ ]*?)\)(?=$|\s)/gi,markdown_link:/(^.*|\s|<br>)\[((?:(?!\]\(.+?\)).)+?)\]\(((https?:\/\/(?:www\.)?|www\.).*?)\)(?=$|\s|\.|\,|\n|<br>|<span)/gi,markdown_quote:/(?:^|\n)!(.+?)(?:\n|$)/gm,markdown_heading:/(?:^|\n)(\#{1,6}) (.*?\S *)(?:\n|$)/gm,markdown_line:/(^|[\n])(\*{3,}|\-{3,})(?=$|[\n])(.*)/g,markdown_codeblock:/(^|\s)`{3}((?:(?:.*?$)\n)?(?:[\s\S]*?))`{3}(?=$|\s)/g,markdown_code:/(^|\s)\`(.*?\S *)?\`(?=$|\s|[\.,\?:;\-}\]](?:$|\s))/g,markdown_bold:/(|^|\s|[{\[])\*(.*?\S *)?\*(?=$|\s|<br>|[\.,\?:;\-}\]](?:$|\s))/g,markdown_italic:/(^|\s|[{\[])\_(.*?\S *)?\_(?=$|\s|[\.,\?:;\-}\]](?:$|\s))/g,markdown_strike:/(^|\s|[{\[])\~(.*?\S *)?\~(?=$|\s|[\.,\?:;\-}\]](?:$|\s))/g,markdown_underscore:/(^|\s|[{[])__(.*?\S *)?__(?=$|\s|[.,?:;\-}\]](?:$|\s))/g,atmention:/{mention:(.+?):([0-9]):(.+?):mention}/g,zcatmention:/{mention:(.*?):mention}/,atmention_for_transcript:/<div prop="mention"(.*?)>(.*?)<\/div><span prop="dname">(.*?)<\/span>/g,addmember:/{addchatmember:(.+?):([0-9]):(.+?):addchatmember}/g,addmember_for_transcript:/<div prop="addchatmember"(.*?)>(.*?)<\/div><span prop="dname">(.*?)<\/span>/g,deletemember:/{deletechatmember:(.+?):([0-9]):(.+?):deletechatmember}/g,deletemember_for_transcript:/<div prop="deletechatmember"(.*?)>(.*?)<\/div><span prop="dname">(.*?)<\/span>/g,text_doublequoted:/(^|\s|[{\[])\"(.*?\S *)?\"(?=$|\s|[\.,\?:;\-}\]](?:$|\s))/g,text_singlequoted:/(^|\s|[{\[])\'(.*?\S *)?\'(?=$|\s|[\.,\?:;\-}\]](?:$|\s))/g,addchatmember:/{addchatmember:(.*?):addchatmember}/g,deletechatmember:/{deletechatmember:(.*?):deletechatmember}/g,atmentiontemplate:/<div.*?prop="(mention|addchatmember|deletechatmember)"(.*?)>(.*?)<\/div><span prop="dname">(.*?)<\/span>/,imagemimetype:/^image\/.+$/,audiomimetype:/^audio\/.+$/,videomimetype:/^video\/.+$/,ipaddress:/^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$/,invalidfilenamechars:/[`~!\$%\^&\|\\\"<>\?\/]/g,chrome_useragent:/Chrome[\/\s]/g,domainurl:/((?:https?:\/\/)(?:www\.)?((?:[^\/]+)))(?:.*)/g,textpattern:/^[0-9a-zA-Z_\-#\&\,\.';\$@\?\,\:\+\%\^\*\(\)\`\|\\\=\/\!\[\]~\{\}\u0080-\u9fff\s]+$/,linkRegExp:/(((http(s){0,1}:\/\/))([^ <\n\"]*))/,invalidlink:/((href|src)=["']((http(s){0,1}:\/\/)|(www\.))([^ <\n]*))/,WWWlinkRegExp:/([^(href|src|\/\/)"'=])?((www\.)([^ <\n\"]*))/,zcWWWlinkRegExp:/((www\.)[a-z0-9][^@]*?)(?=&quot;|&#x27;|&lt;|[\s"')<]|$)/,threeletterendinglink:/(^|\ )(([\w\d-]+\.)+(com|org|net|int|edu|gov|mil|biz|info))(?=( |$))/,twoletterendinglink:/(^|\ )(([\w\d\-]+\.)+((?!js|cp|do)[a-z]){2})(?=( |$))/,escaperegexpinid:/([:\.\[\],\!\"\#\$@%\&\'\(\)\*\+\/\;\?\^\`\{\}\|\~])/g,commandpattern:/^([a-zA-Z])*$/,functionname:/^([a-zA-Z])*$/,removespecialchars:/(\s+)?[-~!@%&[\]{}<>()*+?.,_\/\\^$|:;'`"#\s](\s+)?/g,imagesize:/^(stamp|thumb|medium|original)$/,horizontal_rule_tag:/<hr>/,markdown_blockquote_html:/<blockquote>(.*?)<\/blockquote>/,markdown_codeblock_html:/<pre>(.*?)<\/pre>/,channelpermalink:/^\/channel\/((ext:)?[a-zA-Z])*$/,usersilentmention:/\[((?:(?!\]\(.+?\)).)+?)\](?:\(zohoid:([0-9]+?)\)|\(mail:([a-z0-9][a-z0-9_\-.+]*@[a-z0-9_\-.]*\.[a-z]{2,30}(?:\.[a-z]{2}){0,2})\))/g,phonenumber:/^[+]*[(]{0,1}[0-9]{1,4}[)]{0,1}[-\s\./0-9]*$/,pincode:/^([A-Z0-9\-\. ])+$/,zcatmention_v2:/{[\+|\-]?[@#](.*?)}/g,markdown_instantbutton:/\[(\+|\-)?((?:(?!\]\(.+?\)).)+?)\]\(\$(\d+)\)/g,messagelinkregex:/\/chats\/([a-zA-Z0-9\-_]+)\/messages\/([a-zA-Z0-9_%\-]+)/,channelspermalink:/\/channels\/([a-zA-Z0-9_%\-]+)/,invalid_textpattern_chars:/[\"<>]/,customemoji:/:[a-zA-Z_\-0-9]*\$:|:[a-zA-Z_\-0-9]*!\$:/g,channelsuniquename:/\/channels\/([a-zA-Z0-9_%\-:]+)/},regexReplaceStr:{escapeReplacementString:"$$$",escaperegexp:"\\$&",escaperegexpinid:"\\$1",removespaces:"",trimBRtag:"",containerid:"",mail:"<a href='mailto:$1'>$1</a>"},check:function(e,t,s){return s&&t&&(t=t.trim()),this.regexes[e].lastIndex=0,this.regexes[e].test(t)},checkWithFlag:function(e,t,s,i){return i&&t&&(t=t.trim()),this.regexes[e].lastIndex=0,new RegExp(this.regexes[e].source,s).test(t)},match:function(e,t,s){s=void 0!==s?s:"g";var i=new RegExp(this.regexes[e].source,s);return t.match(i)},replacer:function(e,t,s,i){return void 0===i&&(i=this.regexReplaceStr[t]),s.replace(e,i)},replace:function(e,t,s){return this.replacer(this.regexes[e],e,t,s)},replaceWithFlag:function(e,t,s,i){var n=new RegExp(this.regexes[e].source,s);return this.replacer(n,e,t,i)},getRegexToGetAttrValueInHtmlTag:function(e,t){return new RegExp("(<("+e+")[^>]*?\\s"+t+"=(\"|'|\\\\\"|\\\\'))(\\S+)((\\3)([^>]*?(?:>(?:[^<]*?<\\/\\2>)?)))")},getRegexToAddAttrToHtmlTag:function(e){return new RegExp("(<("+e+"))([^>]*?(\\s\\S+=\\S+)?>(?:(?:[^<]*?)<\\/\\2>)?)")}};pe.prototype.setItem=function(e,t){try{return this.storage.setItem(e,JSON.stringify(t))}catch(e){setTimeout(function(){throw e},1)}},pe.prototype.removeItem=function(e){return this.storage.removeItem(e)},pe.prototype.getItem=function(e){var t=this.storage.getItem(e);return t=""!=t?t:null,JSON.parse(t)},pe.prototype.setChatInfo=function(e){var t=""+e.chid,s=this.getItem("wms_openchats"),i=!1;if(null===s)this.setItem("wms_openchats",[e]);else{for(var n=0;n<s.length;n++)if(s[n].chid===t){for(var a in e)s[n][a]=e[a];i=!0}!1===i&&s.push(e),this.setItem("wms_openchats",s)}},pe.prototype.getChatInfo=function(e,t){e=""+e;var s=this.getItem("wms_openchats");if(null===s)return null;for(var i=0;i<s.length;i++)if(s[i].chid===e&&s[i][t])return s[i][t];return null},pe.prototype.removeChatState=function(e){e=""+e;for(var t=this.getItem("wms_openchats"),s=0;s<t.length;s++)if(t[s].chid===e){t.splice(s,1);break}0===t.length?this.removeItem("wms_openchats"):this.setItem("wms_openchats",t)};var fe=function(){this.items={}};fe.prototype.getItem=function(e){return this.items[e]?this.items[e]:""},fe.prototype.setItem=function(e,t){this.items[e]=t},fe.prototype.removeItem=function(e){delete this.items[e]};var Ce=new pe("session"),ve=new pe("local"),be=function(){this.tableToRowList={},this.tableArray=[]};function ye(e){var t,s=e.type?e.type:"GET",i="boolean"!=typeof e.async||e.async,n=e.callback,a=e.url;if(window.XMLHttpRequest?t=new XMLHttpRequest:window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLHTTP")),t.opts=e.opts,t.onreadystatechange=n,t.open(s,a,i),t.setRequestHeader("Accept","*/*"),e.usedefaultcontenttype||(e.reqheaders&&e.reqheaders["Content-Type"]?t.setRequestHeader("Content-Type","application/json"):t.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8")),"function"==typeof getZAID&&getZAID()&&t.setRequestHeader("X-Client-ZAID",getZAID()),e.uploadlisteners)for(var o in e.uploadlisteners)t.upload.addEventListener(o,e.uploadlisteners[o]);if(e.reqheaders)for(var r in e.reqheaders)t.setRequestHeader(r,e.reqheaders[r]);t.send(e.params)}function _e(e,t,s,i,n,a,o,r,l,d){e&&(t="/"+e+"/"+t),ye(l={callback:ke,opts:{onsuccess:i,onfailure:n,callbackargs:a},url:t+=s?"?"+s+fi(!0):"?nocache="+(new Date).getTime(),async:o,reqheaders:r,usedefaultcontenttype:l&&l.usedefaultcontenttype||"",uploadlisteners:d})}function We(e,t,s,i,n,a,o,r,l,d){e&&(t="/"+e+"/"+t),(r=r||{})["X-ZCSRF-TOKEN"]=ci(),r&&"application/json"===r["Content-Type"]?s=JSON.stringify(s):!s instanceof FormData&&(s=s?s+fi(!0):""),ye(l={type:"POST",callback:ke,url:t,params:s,opts:{onsuccess:i,onfailure:n,callbackargs:a},async:o,reqheaders:r,usedefaultcontenttype:l&&l.usedefaultcontenttype||"",uploadlisteners:d})}function Se(e,t,s,i,n,a,o,r,l,d){if(e&&(t="/"+e+"/"+t),r&&"application/json"===r["Content-Type"])s=JSON.stringify(s);else{var c=ci();s=s?s+"&"+c:c,s+=fi(!0)}ye(l={type:"PUT",callback:ke,url:t,params:s,opts:{onsuccess:i,onfailure:n,callbackargs:a},async:o,reqheaders:r,usedefaultcontenttype:l&&l.usedefaultcontenttype||"",uploadlisteners:d})}function we(e,t,s,i,n,a,o,r,l,d){if(e&&(t="/"+e+"/"+t),r&&"application/json"===r["Content-Type"])s=JSON.stringify(s);else{var c=ci();s=s?s+"&"+c:c,s+=fi(!0)}ye(l={type:"DELETE",callback:ke,url:t,params:s,opts:{onsuccess:i,onfailure:n,callbackargs:a},async:o,reqheaders:r,usedefaultcontenttype:l&&l.usedefaultcontenttype||"",uploadlisteners:d})}function Me(e,t,s,i,n,a,o){We(H.get("WMSCONT"),e,t,s,i,n,a,o)}function Ie(e,t,s,i,n,a,o){if(void 0!==WebMessanger&&"function"==typeof WebMessanger.isRTCChat&&WebMessanger.isRTCChat())Ue(e,t,s,i,n,a,o);else{if(void 0!==WebMessanger&&"function"==typeof WebMessanger.isNetworkUser&&WebMessanger.isNetworkUser())e=("string"==typeof WebMessanger.network_info.url&&"/"===WebMessanger.network_info.url[0]?WebMessanger.network_info.url.slice(1):WebMessanger.network_info.url)+"/"+e;_e(H.get("CHATCONT"),e,t,s,i,n,a,o)}}function Te(e,t,s,i,n,a,o,r,l){if(void 0!==WebMessanger&&"function"==typeof WebMessanger.isRTCChat&&WebMessanger.isRTCChat())Ne(e,t,s,i,n,a,o,r,l);else{if(void 0!==WebMessanger&&"function"==typeof WebMessanger.isNetworkUser&&WebMessanger.isNetworkUser())e=("string"==typeof WebMessanger.network_info.url&&"/"===WebMessanger.network_info.url[0]?WebMessanger.network_info.url.slice(1):WebMessanger.network_info.url)+"/"+e;We(H.get("CHATCONT"),e,t,s,i,n,a,o,r,l)}}function Ae(e,t,s,i,n,a,o){void 0!==WebMessanger&&"function"==typeof WebMessanger.isNetworkUser&&WebMessanger.isNetworkUser()&&(e=("string"==typeof WebMessanger.network_info.url&&"/"===WebMessanger.network_info.url[0]?WebMessanger.network_info.url.slice(1):WebMessanger.network_info.url)+"/"+e);Se(H.get("CHATCONT"),e,t,s,i,n,a,o)}function Ee(e,t,s,i,n,a,o){if(void 0!==WebMessanger&&"function"==typeof WebMessanger.isRTCChat&&WebMessanger.isRTCChat())xe(e,t,s,i,n,a,o);else{if(void 0!==WebMessanger&&"function"==typeof WebMessanger.isNetworkUser&&WebMessanger.isNetworkUser())e=("string"==typeof WebMessanger.network_info.url&&"/"===WebMessanger.network_info.url[0]?WebMessanger.network_info.url.slice(1):WebMessanger.network_info.url)+"/"+e;we(H.get("CHATCONT"),e,t,s,i,n,a,o)}}function Ue(e,t,s,i,n,a,o){_e(H.get("RTCCONT"),e,t,s,i,n,a,o)}function xe(e,t,s,i,n,a,o){we(H.get("RTCCONT"),e,t,s,i,n,a,o)}function Ne(e,t,s,i,n,a,o,r,l){We(H.get("RTCCONT"),e,t,s,i,n,a,o,r,l)}function ke(){if(4===this.readyState)if(200===this.status||204===this.status){var t=this.responseText;if(""!==t){var s;try{s=JSON.parse(t)}catch(e){try{t="[["+(t=t.slice(0,-1))+"]]",s=JSON.parse(t)}catch(e){"function"==typeof this.opts.onsuccess&&this.opts.onsuccess.call(this)}}if(null==s)return;var e=s.length,i=0;if(e)for(i=0;i<e;i++){var n=s[i],a=n.objString;if(n.objType&&"do"===n.objType&&(a=Oe(n.objType,n.objString)),"function"==typeof this.opts.onsuccess)this.opts.onsuccess.call(this,a);else if(H.get("AjaxDispatcher")){H.get("AjaxDispatcher")(n.module,n.objType,a)}}else"function"==typeof this.opts.onsuccess&&this.opts.onsuccess.call(this,t)}else"function"==typeof this.opts.onsuccess&&this.opts.onsuccess.call(this)}else{var o="";if("string"==typeof this.response&&!$WC.Util.isEmpty(this.response))try{o=JSON.parse(this.response)}catch(e){}o&&$WC.SecurityManager.isSecurityError(o)&&$WC.SecurityManager.handleError(o),"function"==typeof this.opts.onfailure&&this.opts.onfailure.call(this)}}function Oe(e,t){if("do"!==e)return t;for(var s=new be,i=0;i<t.length;i++)for(var n=t[i],a=n.tname,o=n.cols,r=n.rows,l=0;l<r.length;l++){for(var d=r[l],c=[],m=0;m<d.length;m++)c[m]=[o[m],d[m]];s.addRowsForTable(a,c)}return s}be.prototype.containsTable=function(e){for(var t=this.tableArray.length,s=0;s<t;s++)if(this.tableArray[s]==e)return!0;return!1},be.prototype.getRowsForTable=function(e){return this.tableToRowList[e]},be.prototype.addNewTable=function(e){this.tableArray.push(e),this.tableToRowList[e]=[]},be.prototype.addRowsForTable=function(e,t){this.containsTable(e)||this.addNewTable(e);var s=this.tableToRowList[e];return s[s.length]=this.createRow(t),!0},be.prototype.createRow=function(e){for(var t={},s=0;s<e.length;s++)t[e[s][0]]=e[s][1];return t};var Re=Object.freeze({__proto__:null,_makeRequest:ye,_getRequest:_e,_postRequest:We,_putRequest:Se,_deleteRequest:we,request:function(e,t,s,i,n,a,o){_e(H.get("WMSCONT"),e,t,s,i,n,a,o)},postRequest:Me,putRequest:function(e,t,s,i,n,a,o){Se(H.get("WMSCONT"),e,t,s,i,n,a,o)},deleteRequest:function(e,t,s,i,n,a,o){we(H.get("WMSCONT"),e,t,s,i,n,a,o)},requestToChat:Ie,postRequestToChat:Te,putRequestToChat:Ae,deleteRequestToChat:Ee,postRequestToChatWithLocation:function(s,i,n,a,o,r,l){if(void 0!==WebMessanger&&"function"==typeof WebMessanger.isNetworkUser&&WebMessanger.isNetworkUser()){var e="string"==typeof WebMessanger.network_info.url&&"/"===WebMessanger.network_info.url[0]?WebMessanger.network_info.url.slice(1):WebMessanger.network_info.url;s=e+"/"+s}var t=H.get("LOCATION_INFO").PERMISSIONSTATE;if("granted"===t){var d=function(){var e=wi(H.get("LOCATION_INFO").CACHED.coords);e.status="granted",(l=l||{})["X-Geo-Location"]=JSON.stringify(e),Te(s,i,n,a,o,r,l)};if(void 0!==H.get("LOCATION_INFO").CACHED)d();else{void 0!==H.get("LOCATION_INFO").WATCH_ID&&navigator.geolocation.clearWatch(H.get("LOCATION_INFO").WATCH_ID);H.get("LOCATION_INFO").WATCH_ID=navigator.geolocation.watchPosition(function(e){var t=void 0===H.get("LOCATION_INFO").CACHED;H.get("LOCATION_INFO").CACHED=e,H.get("LOCATION_INFO").PERMISSIONSTATE="granted",t&&d()},function(e){var t;1===e.code?(t="denied",H.get("LOCATION_INFO").PERMISSIONSTATE=t):t="failure",void 0===H.get("LOCATION_INFO").CACHED&&((l=l||{})["X-Geo-Location"]=JSON.stringify({status:t}),Te(s,i,n,a,o,r,l)),delete H.get("LOCATION_INFO").CACHED})}}else(l=l||{})["X-Geo-Location"]=JSON.stringify({status:t}),Te(s,i,n,a,o,r,l)},requestToRTC:Ue,deleteRequestToRTC:xe,postRequestToRTC:Ne,callbackDispatcher:ke,getObject:Oe}),He={CHATCFPARAMNAME:"zchat_csrparam",WMSCFPARAMNAME:"wms_csrparam",CHATCFCOOKIENAME:"CT_CSRF_TOKEN",WMSCFCOOKIENAME:"WMS_CSRF_TOKEN",WMSCONT:"_wms",WMSCHATURL:window.location.protocol+"//cliq.zoho.com/",REQSTATUS:{LOADING:1,SUCCESS:2,FAILED:3,NORESULTS:4,INITIALSTATE:5},KEYCODES:{BACKSPACE:8,TAB:9,LEFT:37,UP:38,RIGHT:39,DOWN:40,ESCAPE:27,ENTER:13,SPACE:32},TRIGGERS:{ADDMEM:"+",DELMEM:"-",ATMENTION:"@",SMILEY:":",SLASH:"/"},CONTACTSTATUS:{UNAPRD:-1,REJECT:-2,REQACC:-3,DELETE:-4,REMOVE:-5,NOCHAT:-6,ACCEPT:10},USERPERMISSIONS:{ADD_MEMBER:6,REMOVE_MEMBER:7,SEND_MESSAGE:8,MENTION_USERS:9,STICKY_MESSAGE:20,LEAVE_ALLOWED:11,THREAD_REPLY:22},USERROLES:{SUPER_ADMIN:0,ADMIN:1,CREATOR:2,MODERATOR:3,PARTICIPANT:4,ALLOWED_USER:5,NONE:-1,BOT:6},BOTCONFIG:{LISTENMSG:"LISTEN_MESSAGE",SENDMSG:"SEND_MESSAGE"},CHANNELS:{ORG:"1",TEAM:"2",PRIVATE:"3",SHARED:"4"},TEMPUSERSTATUS:{OFFLINE:"5",ORGCONTACT:"6"},CHATTYPES:{CHANNEL:1,DEFAULT_BOT:"B1",CUSTOM_BOT:"B2",THREAD:2},HYBRIDSEARCH:{CHANNEL:1,CHAT:2,CONTACT:3,DEFAULTRESULT:4,EMPTY:5,FREQCONTACTS:6,GENERICLIST:7,GROUP:8,MESSAGEHINT:9,ORGCONTACT:10,TITLEHINT:11,USERLIST:12,EMPTYUSERHINT:13,EMPTYTITLEHINT:14,EMPTYMSGHINT:15,ADDCONTACT:16,USER_CHANNELLIST:17,CHANNELLIST:18,BOT:19,CUSTOMCONTACTLIST:20,JOINEDCHANNEL:21,THREAD:22,modules:{CONTACTMENU:1,GROUPMENU:2,CHATMENU:3,SMARTCHAT:4,FILEFWD:5,CUSTOMCONTACTMENU:6}},CTYPES:{CHAT:"1",CUSTOMCHAT:"5",CHANNEL:"8",BOT:"9",CHATLET:"10",THREAD:"11"}},$e={},De={result:[],noresult:[]},Le=!1;function Pe(e){return e?$e[e]:$e}function Be(e,t){e?$e[e]=t:$e=t}function je(e){var t={};if(this.opts.callbackargs&&this.opts.callbackargs.new_request||!1){e="string"==typeof e?JSON.parse(e).data:[];for(var s=0;s<e.length;s++)Ai(e[s].zuid)||(t={USERID:e[s].zuid,DNAME:e[s].display_name,EMAILID:e[s].email_id,UC:e[s].usage_count||0},Be(e[s].zuid,t))}else for(var i in e)Ai(i)||Be(i,t={USERID:i,DNAME:e[i][0],EMAILID:e[i][1],UC:e[i][3]});if(this.opts.callbackargs&&this.opts.callbackargs.params){var n=this.opts.callbackargs.params.split("=")[2];(this.opts.callbackargs.searchtext=n)&&(e=$WC.HybridSearch.filter("display_name",n,e,null,null,"email_id")),e.length?De.result.push(this.opts.callbackargs.params):De.noresult.push(this.opts.callbackargs.params)}var a=this.opts.callbackargs&&this.opts.callbackargs.reqid,o=this.opts.callbackargs&&this.opts.callbackargs.topicname;"suggestionui"===o&&(Le=!0),o?(Ve(),Si.publish("/orgcontacts/"+o,{callbackargs:this.opts.callbackargs,stat:e.length?"":He.REQSTATUS.NORESULTS})):Si.publish("/orgcontacts/updateui",{callbackargs:this.opts.callbackargs,reqid:a})}function Fe(){var e="updateui",t=this.opts.callbackargs&&this.opts.callbackargs.reqid,s=this.opts.callbackargs&&this.opts.callbackargs.chid;this.opts.callbackargs&&this.opts.callbackargs.topicname&&(e=this.opts.callbackargs.topicname);var i=this.opts&&this.opts.callbackargs;Si.publish("/orgcontacts/"+e,{stat:He.REQSTATUS.FAILED,chid:s,reqid:t,callbackargs:i})}function ze(e){var t="limit=50";return t+="&search="+encodeURIComponent(e),H.get("isCliqUser")()&&(t+="&fields=all"),t}function Ge(e,t){if(!1!==$WC.Config.get("isOrgUser")()){var s=e.chid,i=e.searchtext,n=ze(i),a=e.silentload,o=(e.inpresultset,e.topicname);e.reqid=t,!1===qe(i)?H.get("isCliqUser")()?Ie("v2/users",n,je,Fe,{reqid:t,params:n,topicname:o,chid:s,silentload:a,new_request:!0}):Ie("getorgusers.do",n,je,Fe,{reqid:t,params:n,topicname:o,chid:s,silentload:a,new_request:!1}):o?Si.publish("/orgcontacts/"+o,{reqid:t,callbackargs:e}):Si.publish("/orgcontacts/updateui",{reqid:t,callbackargs:e})}}function qe(e){for(var t=e&&e.searchtext||e,s=ze(t),i=0;i<De.result.length;i++){if(-1!==De.result[i].indexOf(s))return!0}return Ke(t)}function Ye(){var e=ve.getItem($WC.Config.get("zuid")+"_wms_orgcontacts");$e=e.contacts}function Ve(){var e={};e.contacts=$e,e.reqtime=(new Date).getTime(),ve.setItem($WC.Config.get("zuid")+"_wms_orgcontacts",e)}function Ze(){ve.removeItem($WC.Config.get("zuid")+"_wms_orgcontacts")}function Ke(e){for(var t=ze(e),s=0;s<De.noresult.length;s++){var i=De.noresult[s];if(t.startsWith(i))return!0}return!1}function Xe(e,t){void 0!==Pe(e)&&(Pe(e).DNAME=t)}var Je=Object.freeze({__proto__:null,isSuggestionsRequested:function(){return Le},getOrgContactsList:Pe,setOrgContactsList:Be,updateList:je,handleFailure:Fe,_constructParams:ze,getContacts:function(e,t){Ge({searchtext:e,topicname:"getapi"});var s=Si.subscribe("/orgcontacts/getapi",function(){t(),Si.unsubscribe(s)})},fetchFromServer:Ge,isCachedRequest:qe,checkAndUpdateContactsList:function(){var e=(new Date).getTime(),t=ve.getItem($WC.Config.get("zuid")+"_wms_orgcontacts");if(null!=t&&864e5<e-t.reqtime)return De.result=[],De.noresult=[],Ze(),void Ge({searchtext:"",topicname:"suggestionui"},"");0==bi($e)&&(null!=t?0<bi(t.contacts)&&Ye():Ge({searchtext:"",topicname:"suggestionui"},""))},pullContactsListFromLocalStorage:Ye,putContactsListInLocalStorage:Ve,removeContactsListFromLocalStorage:Ze,isEmptyResultReq:Ke,updateDisplayName:Xe}),Qe={overlay:"mcf1ee8b17_overlay",container:"mcf1ee8b17_container",wms_dialog_container:"mcf1ee8b17_wms_dialog_container",close:"mcf1ee8b17_close",header:"mcf1ee8b17_header",wms_dialog_header:"mcf1ee8b17_wms_dialog_header",heading:"mcf1ee8b17_heading",footer:"mcf1ee8b17_footer",wms_dialog_footer:"mcf1ee8b17_wms_dialog_footer",button:"mcf1ee8b17_button",aligncenter:"mcf1ee8b17_aligncenter",alignend:"mcf1ee8b17_alignend",destructive_button:"mcf1ee8b17_destructive_button",confirmation_button:"mcf1ee8b17_confirmation_button",confirmation_button_small:"mcf1ee8b17_confirmation_button_small",cancel_button:"mcf1ee8b17_cancel_button",wms_dialogtext:"mcf1ee8b17_wms_dialogtext",wms_dialog_imginner:"mcf1ee8b17_wms_dialog_imginner",wms_dialog_img:"mcf1ee8b17_wms_dialog_img",wms_dialog_txtcont:"mcf1ee8b17_wms_dialog_txtcont",wms_dialog_contentwrapper:"mcf1ee8b17_wms_dialog_contentwrapper",wms_dialog_txttitle:"mcf1ee8b17_wms_dialog_txttitle",wms_dialog_content:"mcf1ee8b17_wms_dialog_content",buttonwrapper:"mcf1ee8b17_buttonwrapper",showmandatoryerror:"mcf1ee8b17_showmandatoryerror",inputcontentwrapper:"mcf1ee8b17_inputcontentwrapper",zmNightMode:"zmNightMode"},et=function(e){function t(){e.call(this),this.destroy=this.destroy.bind(this),this.setContainerNode=this.setContainerNode.bind(this),this.container=null,this.escapeListener=function(e){var t=document.querySelectorAll("."+Qe.overlay);t[t.length-1]===this.container&&27===e.keyCode&&(this.props.callbackOnClose&&this.props.callbackOnClose(),this.destroy(),e.stopImmediatePropagation(),e.stopPropagation())}.bind(this),document.addEventListener("keydown",this.escapeListener,!1)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.destroy=function(){this.props.nodeToBeFocusedOnClose&&this.props.nodeToBeFocusedOnClose.focus(),document.removeEventListener("keydown",this.escapeListener,!1)},t.prototype.setContainerNode=function(e){this.container=e},t.prototype.componentDidMount=function(){this.props.ignoreFocusOnMount||this.container.focus()},t.prototype.componentWillUnmount=function(){this.destroy()},t.prototype.render=function(e,t){if(null===t.dialogcontent)return null;var s=e.customDialogStyles&&e.customDialogStyles.customContainerStyle?e.customDialogStyles.customContainerStyle:Qe.container,i=e.customDialogStyles?e.customDialogStyles.customHeaderStyle:Qe.header,n=e.customDialogStyles&&e.customDialogStyles.customButtonStyle?e.customDialogStyles.customButtonStyle:Qe.close,a=e.customDialogStyles?e.customDialogStyles.customWrapperStyle:"",o=e.customDialogStyles&&e.customDialogStyles.customFooterStyle?e.customDialogStyles.customFooterStyle:Qe.footer,r=e.customDialogStyles&&e.customDialogStyles.customButtonWrapperStyle?e.customDialogStyles.customButtonWrapperStyle:"",l=k("div",{"data-dialogwrapper":"true",class:a},e.children),d=e.actions&&e.actions.map(function(e,t){e.buttonstyle=Qe[e.buttonstyle]?Qe[e.buttonstyle]:e.buttonstyle;var s=e.buttonstyle?e.buttonstyle:Qe.aligncenter;return k(R,{key:t,type:"button",content:e.text,classname:s,onclick:e.onclick,onkeydown:e.onclick})});r&&(d=k("div",{class:r},d));var c=Qe.overlay,m=e.customDialogStyles&&e.customDialogStyles.customoverlaystyle||"";return void 0!==WebMessanger&&(WebMessanger.isDarkModeEnabled&&(c+=" zmNightMode"),"function"==typeof WebMessanger.isDNDBackupIconEnabled&&WebMessanger.isDNDBackupIconEnabled()&&(c+=" wms_dnd_backup_icon")),k("div",{tabindex:"0",ref:this.setContainerNode,class:c+" "+m,style:{zIndex:H.get("zindex")}},k("div",{class:s},k("div",{class:i},e.heading,k(R,{onclick:this.props.callbackOnClose,type:"icon",content:"e634",classname:n})),this.props.headerinfosuffix,l,k("div",{class:o},e.footerinfoprefix,d,e.footerinfosuffix)))},t}(M);function tt(e){this.module=e.type,this.id=e.id,this.name=e.name,this.photo_id=e.photo_id||e.store_app_photoid,e.store_appid&&(this.store_appid=e.store_appid,this.store_appname=e.store_appname)}function st(e){var t=[];return e=pt(e=_t(e=nt(e=it(e=ut(e=""+e,t)))),t),e=ge.replace("markdown_codeblock",e,mt)}function it(e){return e=ge.replace("markdown_image",e,at),e=ge.replace("markdown_quote",e,lt),e=ge.replace("markdown_heading",e,dt),e=ge.replace("markdown_code",e,gt)}function nt(e){return e=ge.replace("markdown_bold",e,ft),e=ge.replace("markdown_italic",e,Ct),e=ge.replace("markdown_strike",e,vt),e=ge.replace("markdown_underscore",e,bt),e=ge.replace("markdown_line",e,ct),e=ge.replace("markdown_link",e,rt)}function at(e,t,s,i,n){return t+'<img src="'+("www."===n?"http://"+i:i)+'" alt="'+yt(s)+'" />'}function ot(e){var n=Object.keys(e["btnindexvsdetails.msg"]);return function(e,t,s,i){return-1<n.indexOf(i)?'<a zc-quickbutton="'+(void 0!==t?t:"")+'" btnindex="'+i+'">'+s+"</a>":e}}function rt(e,t,s,i,n){var a="www."===n?"http://"+i:i;return nt(t)+'<a markdown="linkhtml" href="'+a+'" target="_blank">'+yt(s)+"</a>"}function lt(e,t){return 0===(t=t.trim()).length?e:"<blockquote>"+nt(t)+"</blockquote>"}function dt(e,t,s){var i=t.length;return"<h"+i+">"+yt(s)+"</h"+i+">"}function ct(e,t,s,i){return"<hr>"+nt(i)}function mt(e,t,s){return 0===(s=s.trim()).length?e:t+"<pre>"+yt(s)+"</pre>"}function ut(e,i){var t=new RegExp(/(^|\s)(`{3}((?:(?:.*?$)\n)?(?:[\s\S]*?))`{3})(?=$|\s)/,"g");return e=e.replace(t,function(e,t,s){return 0===(s=s.trim()).length?e:(i.push(s),t+"<CODEBLOCK>")})}function pt(e,t){for(var s=0;s<t.length;s++)e=e.replace(/<CODEBLOCK>/,t[s]);return e}function ht(e){return ge.replace("markdown_instantbutton",e,function(e,t,s){return s})}function gt(e,t,s){return!s||!s.match(/[^_*`~]/)||"`"===s[0]||"`"===s[s.length-1]||" "===s[0]&&" "===s[s.length-1]?e:t+"<code>"+yt(s)+"</code>"}function ft(e,t,s){return!s||!s.match(/[^_*`~]/)||"*"===s[0]||"*"===s[s.length-1]||" "===s[0]&&" "===s[s.length-1]?e:t+"<strong>"+nt(s)+"</strong>"}function Ct(e,t,s){return!s||!s.match(/[^_*`~]/)||"_"===s[0]||"_"===s[s.length-1]||" "===s[0]&&" "===s[s.length-1]?e:t+"<i>"+nt(s)+"</i>"}function vt(e,t,s){return!s||!s.match(/[^_*`~]/)||"~"===s[0]||"~"===s[s.length-1]||" "===s[0]&&" "===s[s.length-1]?e:t+"<strike>"+nt(s)+"</strike>"}function bt(e,t,s){return!s||!s.match(/[^_*`~]/)||"__"===s[0]||"__"===s[s.length-1]||" "===s[0]&&" "===s[s.length-1]?e:t+"<u>"+nt(s)+"</u>"}function yt(e){return e.replace(/\*/g,"&ast;").replace(/\_/g,"&#95;").replace(/\~/g,"&#126;")}function _t(e){return e.replace(/&ast;/g,"*").replace(/&#95;/g,"_").replace(/&#126;/g,"~")}tt.prototype.getModule=function(){return this.module},tt.prototype.getID=function(){return this.id},tt.prototype.getObject=function(){switch(this.module){case"command":return Commands.getObject(this.id)}},tt.prototype.getName=function(){var e=this.getObject(),t=this.name;return void 0!==e&&(t=e.name),"command"!==this.module||t.startsWith("/")||(t="/"+t),t},tt.prototype.getImageURL=function(){switch(this.module){case"command":return Commands.getImgUrl(this.id,this.photo_id);case"bot":return Ft(this.id,this.photo_id);case"application":case"messageaction":return _WMSCHATURL+"appimg/"+this.photo_id+"/photo.do"}},tt.prototype.getCreatorName=function(){var e=this.getObject();if(void 0!==e)return hi(e.creator,e.creator_name)},tt.prototype.getStoreAppId=function(){var e=this.getObject();return e&&e.appid?e.appid:this.store_appid},tt.prototype.getStoreAppName=function(){var e=this.getObject();return e&&e.appdetails?e.appdetails.name:this.store_appname};var Wt=Object.freeze({__proto__:null,apply:st,applyOnce:it,applyRecursive:nt,getImageHTML:at,getInstantButtonHTML:ot,getLinkHTML:rt,getQuoteHTML:lt,getHeadingHTML:dt,getLineHTML:ct,getCodeblockHTML:mt,putDummyCodeBlock:ut,replaceDummyCodeBlock:pt,replaceInstantButton:function(e,t){return t&&t["btnindexvsdetails.msg"]&&(e=ge.replace("markdown_instantbutton",e,ot(t))),e},replaceInstantButtonWithLabel:ht,getCodeHTML:gt,getBoldHTML:ft,getItalicHTML:Ct,getStrikeHTML:vt,getUnderscoreHTML:bt,encodeChars:yt,decodeChars:_t}),St={description:"mc772a21ad_description",item:"mc772a21ad_item",detailsicon:"mc772a21ad_detailsicon",embedimg:"mc772a21ad_embedimg",delugeicon:"mc772a21ad_delugeicon",slideup:"mc772a21ad_slideup",slidedown:"mc772a21ad_slidedown",consentlist:"mc772a21ad_consentlist",dashedbox:"mc772a21ad_dashedbox",detailsfield:"mc772a21ad_detailsfield",botdialog_title:"mc772a21ad_botdialog_title",relative_container:"mc772a21ad_relative_container",consent_view_link:"mc772a21ad_consent_view_link",consent_hide_link:"mc772a21ad_consent_hide_link",consent_name:"mc772a21ad_consent_name",consent_desc:"mc772a21ad_consent_desc",remember_note:"mc772a21ad_remember_note",consent_headerimg:"mc772a21ad_consent_headerimg",consent_headertitle:"mc772a21ad_consent_headertitle",consent_header:"mc772a21ad_consent_header",consent_content:"mc772a21ad_consent_content",bullets:"mc772a21ad_bullets",extensionwrapper:"mc772a21ad_extensionwrapper",allowextn_text:"mc772a21ad_allowextn_text",customcheckbox:"mc772a21ad_customcheckbox",customcheckboxsel:"mc772a21ad_customcheckboxsel",extension_consents:"mc772a21ad_extension_consents",extn_container:"mc772a21ad_extn_container",consents_container:"mc772a21ad_consents_container",consentscontainer:"mc772a21ad_consentscontainer",loading:"mc772a21ad_loading",loadingicon:"mc772a21ad_loadingicon",grantedconsents:"mc772a21ad_grantedconsents",scopeheader:"mc772a21ad_scopeheader",scopepermissions:"mc772a21ad_scopepermissions",scopeinfo_wrapper:"mc772a21ad_scopeinfo_wrapper",scopeinfo:"mc772a21ad_scopeinfo",scopeinfoheader:"mc772a21ad_scopeinfoheader",scopeinfocontent:"mc772a21ad_scopeinfocontent",authenticationContainer:"mc772a21ad_authenticationContainer",header_wrapper:"mc772a21ad_header_wrapper"},wt=function(t){function e(e){t.call(this,e),this.toggleConsentsVerboseDetails=this.toggleConsentsVerboseDetails.bind(this),this.setConsentsVerboseDetailsNode=this.setConsentsVerboseDetailsNode.bind(this),this.setConsentsDetailsNode=this.setConsentsDetailsNode.bind(this),this.consentsVerboseDetails=this.consentsVerboseDetails.bind(this),this.consentsComponentDetails=this.consentsComponentDetails.bind(this),this.consentsVerboseDetailsNode=null,this.consentsDetailsNode=null,this.state={expanded_view:!1}}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.setConsentsVerboseDetailsNode=function(e){this.consentsVerboseDetailsNode=e},e.prototype.setConsentsDetailsNode=function(e){this.consentsDetailsNode=e},e.prototype.toggleConsentsVerboseDetails=function(){this.state.expanded_view?this.setState({expanded_view:!1}):this.setState({expanded_view:!0})},e.prototype.componentDidUpdate=function(){var e=this.consentsVerboseDetailsNode;if(this.state.expanded_view){e.style="",e.style.display="block";var t=this.consentsDetailsNode,s=e.getBoundingClientRect().height;xi(e,"height",0,s,function(){setTimeout(function(){Hi(t,{block:"start",behavior:"smooth"})},100)})}else{var i=e.getBoundingClientRect().height;xi(e,"height",i,0)}},e.prototype.consentsVerboseDetails=function(e){for(var t=[],s=0;s<e.length;s++){var i=Mt(e[s].text);t.push(k("div",{class:St.description},k("span",{class:St.bullets,dangerouslySetInnerHTML:{__html:i}}),this.consentsComponentDetails(e[s].components)))}return t},e.prototype.consentsComponentDetails=function(e){var t=[];if(!Ti(e))for(var s=0;s<e.length;s++)t.push(k("span",{class:St.bullets},e[s]));return t},e.prototype.render=function(){var e=this.props.classname,t=this.props.consentsInfo.details,s=Mt(this.props.consentsInfo.title),i=Mt(this.props.consentsInfo.description),n=this.state.expanded_view?St.slideup:St.slidedown;return k("div",{onclick:this.toggleConsentsVerboseDetails.bind(this),ref:this.setConsentsDetailsNode,class:St.item},k("span",{class:e}),k("div",{class:St.consent_content},k("div",{class:St.consent_name,dangerouslySetInnerHTML:{__html:s}}),k("div",{class:St.consent_desc,dangerouslySetInnerHTML:{__html:i}}),k("div",{ref:this.setConsentsVerboseDetailsNode,class:St.consentlist},k("div",{class:St.dashedbox},this.consentsVerboseDetails(t)))),k("span",{class:n}))},e}(M);function Mt(e){return gi(st(mi(e)))}function It(){}var Tt=function(t){function e(e){t.call(this,e),this.extensionConsentsNode=null,this.grantedConsentsNode=null,this.allowExtensionNode=null,this.toggleExtensionConsents=this.toggleExtensionConsents.bind(this),this.setExtensionConsentsNode=this.setExtensionConsentsNode.bind(this),this.setGrantedConsentsNode=this.setGrantedConsentsNode.bind(this),this.setAllowExtensionNode=this.setAllowExtensionNode.bind(this),this.integrationsdata=new tt(e.response.message_source||e.response.data.extension),this.state={allow_extension:!1,view_extension:!1,extension_resp:{},view_dialog:!0,loading_consents:!1,granted_consents:!1}}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.setExtensionConsentsNode=function(e){this.extensionConsentsNode=e},e.prototype.setGrantedConsentsNode=function(e){this.grantedConsentsNode=e},e.prototype.setAllowExtensionNode=function(e){this.allowExtensionNode=e},e.prototype.getConsentsWindow=function(e,t,s){var i=[],n=[],a=[];if(e.resumeUrl){var o=[];if(void 0!==e.connectionDetails.scope)for(var r in e.connectionDetails.scope){var l=e.connectionDetails.scope[r],d=l["Scope Name"];l["Scope Value"]&&d&&0<d.indexOf("/")&&(0==d.indexOf("Zoho")||0==d.indexOf("DRE/"))&&o.push(k("div",{class:St.scopeinfocontent},Mt(l["Scope Value"])))}if(!o.length)return null;var c=$("app.req.scopes",[Mt(e.connectionDetails.name)]);n.push(k("div",{class:St.scopeinfo_wrapper},k("div",{class:St.scopeinfo},k("div",{class:St.scopeinfoheader,dangerouslySetInnerHTML:{__html:c}}),o)))}else if(!1===this.state.granted_consents){var m=$("platformconsents.brief","<b>"+Mt([this.integrationsdata.name])+"</b>");a.push(k("div",null,k("div",{class:St.botdialog_title,dangerouslySetInnerHTML:{__html:m}}),k("div",{class:St.consents_container},k("div",null,this.getConsents(e.consents)))))}else ri(e.granted_consents)||this.integrationsdata.store_appid||i.push(k("div",{class:St.granted_consents},k("div",{class:St.botdialog_title},$("platformconsents.granted.brief")),k("div",{consents_container:!0,class:St.relative_container},k("div",null,this.getConsents(e.granted_consents)))));var u=this.integrationsdata.store_appid?this.integrationsdata.store_appid:"";return k("div",{class:St.consentscontainer,"data-consentkey":t,"data-chid":s,"data-store_appid":u,"data-loadingstate":this.state.loading_consents},k("div",{class:St.loading},k("div",{class:St.loadingicon})),a,i,n)},e.prototype.getConsents=function(e){var t=[];return e.variables&&!ri(e.variables)&&t.push(k(wt,{classname:St.detailsicon,consentsInfo:e.variables})),e.deluge_tasks&&!ri(e.deluge_tasks)&&t.push(k(wt,{classname:St.delugeicon,consentsInfo:e.deluge_tasks})),e.api_calls&&!ri(e.api_calls)&&t.push(k(wt,{classname:St.embedimg,consentsInfo:e.api_calls})),t},e.prototype.getConsentsHeader=function(e){if(e.resumeUrl){var t=$("app.req.permission",["<b>"+Mt(e.connectionDetails.name)+"</b>","<b>"+Mt(e.connectionDetails.serviceName)+"</b>"]);return k("div",{class:St.scopeheader},k("img",{src:e.connectionDetails.imageUrl}),k("div",{class:St.scopepermissions,dangerouslySetInnerHTML:{__html:t}}))}return k("div",{class:St.consent_header},k("span",{class:St.consent_headerimg},k("img",{src:this.integrationsdata.getImageURL()})),k("span",{class:St.consent_headertitle},this.integrationsdata.getName()))},e.prototype.getConsentsActions=function(e,s,i){var t={key:e,allow_for_extension:this.state.allow_extension},n={"Content-Type":"application/json","x-consents-version":"1","X-XHR-exception":!0,"X-ZCSRF-TOKEN":ci()},a=function(e){var t=JSON.parse(e);ri(t)||"function"!=typeof i||i(s,t)}.bind(this);return[{text:$("platformconsents.proceed"),onclick:function(){Te("v1/executions/1/confirmconsent",t,a,null,null,null,n),this.setState({view_dialog:!1,extension_resp:{}}),this.props.callbackOnClose()}.bind(this)}]},e.prototype.toggleExtensionConsents=function(e,t,s){var i=Ei(s);i===this.extensionConsentsNode?this.state.view_extension?this.setState({view_extension:!1}):ri(this.state.extension_resp)?(this.setState({loading_consents:!0}),this.viewExtensionConsents(e,t)):this.setState({view_extension:!0}):i===this.allowExtensionNode?this.state.allow_extension?this.setState({allow_extension:!1}):this.setState({allow_extension:!0}):i===this.grantedConsentsNode&&(this.state.granted_consents?this.setState({granted_consents:!1}):this.setState({granted_consents:!0}))},e.prototype.viewExtensionConsents=function(e,t){var s="key="+t,i={"Content-Type":"application/json","x-consents-version":"1","X-XHR-exception":!0,"X-ZCSRF-TOKEN":ci()};Ie("v1/applications/"+e+"/impacts",s,function(e){var t=JSON.parse(e);this.setState({view_extension:!0,extension_resp:t,loading_consents:!1})}.bind(this),null,null,null,i)},e.prototype.getExtensionConsents=function(e,t){var s=$("platformconsents.extension.title","<b>"+Mt([t])+"</b>");return k("div",{id:"extension-consents",class:St.extension_container},k("div",{class:St.botdialog_title,dangerouslySetInnerHTML:{__html:s}}),k("div",{class:St.extn_container},k("div",null,this.getConsents(e))))},e.prototype.render=function(e,t){var s=e.response,i=e.response.consent_key,n=e.chid,a=e.response.resumeUrl,o=e.callback,r=e.response.message_source.store_appid,l=k("span",{class:St.remember_note},k("strong",null," * "),$("platformconsents.remembernote")," "),d=null,c=null,m=null,u=this.getConsentsActions(i,n,o);if(this.integrationsdata.store_appid){var p=$("common.view"),h=t.allow_extension?St.customcheckboxsel:St.customcheckbox,g=$("platformconsents.extension.brief",Mt([this.integrationsdata.store_appname]));t.view_extension&&(p=$("common.hide")),d=k("div",{class:St.extensionwrapper,onclick:this.toggleExtensionConsents.bind(this,r,i)},k("span",null,k("span",{class:h}),k("input",{id:"allowextension",type:"checkbox",ref:this.setAllowExtensionNode}),k("label",{for:"allowextension",class:St.allowextn_text,dangerouslySetInnerHTML:{__html:g}})),k("span",{class:St.consent_view_link,ref:this.setExtensionConsentsNode},p))}else if(!ri(e.response.granted_consents)){var f=$("common.view");t.granted_consents&&(f=$("common.hide")),d=k("div",{class:St.extensionwrapper},k("span",{class:St.grantedconsents},$("platformconsents.grantednote")),k("span",{class:St.consent_view_link,ref:this.setGrantedConsentsNode,onclick:this.toggleExtensionConsents.bind(this,r,i)},f))}if(t.view_extension&&!ri(t.extension_resp)){var C=t.extension_resp.data.extension.store_appname,v=t.extension_resp.data.consents;c=this.getExtensionConsents(v,C)}else a?(l=d=null,c=this.getConsentsWindow(s,i,n),u=[{text:$("common.authenticate"),onclick:function(){window.open(a),this.setState({view_dialog:!1})}.bind(this)}],null===c&&(m={customContainerStyle:St.authenticationContainer,customHeaderStyle:St.header_wrapper})):c=this.getConsentsWindow(s,i,n);var b=null;return t.view_dialog&&(b=k(et,{nodeToBeFocusedOnClose:this.props.nodeToBeFocusedOnClose,heading:this.getConsentsHeader(s),actions:u,footerinfoprefix:d,footerinfosuffix:l,customDialogStyles:m,callbackOnClose:this.props.callbackOnClose},c)),b},e}(M);It.prototype.mountComponent=function(e,t,s,i){document.querySelector("[data-consentkey]")||(this.node=document.createElement("div"),document.body.appendChild(this.node),O(k(Tt,{chid:e,response:t,callback:s,nodeToBeFocusedOnClose:i,callbackOnClose:this.removeParentNode.bind(this)}),this.node))},It.prototype.removeParentNode=function(){this.node.parentElement.removeChild(this.node)};var At={},Et={};function Ut(e,t){var s=!0;if(At[e]){var i=At[e];s=i.status?"enabled"===i.status:s,s=!Ti(t)&&i.actions&&i.actions[t]?s&&"enabled"==i.actions[t]:s}return s}var xt=Object.freeze({__proto__:null,errorcodes:{CS_DISABLED_BY_ADMIN:"module_disabled_by_admin",CS_ACTION_DISABLED_BY_ADMIN:"action_disabled_by_admin"},hasPermission:Ut,isRegistered:function(e){return"function"==typeof Et[e]},register:function(e,t){Et[e]=t},init:function(e){for(var t in e){var s={};s.status=e[t].status,e[t].actions&&(s.actions=e[t].actions),At[t]=s}return!0},update:function(e){for(var t in e)At[t]=e[t];this.handleModulesStatusChange(e)},handleModulesStatusChange:function(e){for(var t in e)this.isRegistered(t)&&Et[t]()},isSecurityError:function(e){return!Ti(e)&&!Ti(e.code)&&"string"==typeof e.code&&(e.code.startsWith(this.errorcodes.CS_DISABLED_BY_ADMIN)||e.code.startsWith(this.errorcodes.CS_ACTION_DISABLED_BY_ADMIN))},handleError:function(e,t){if($WC.$Win.isExist("actionforbidden")&&$WC.$Win.destroy("actionforbidden"),null===document.getElementById("zcwindows")){var s=document.createElement("div");s.id="zcwindows",s.className="zcoverlay",void 0!==WebMessanger&&(s.style.zIndex=WebMessanger.setzindex),document.body.appendChild(s)}$WC.$Dlg.create({id:"actionforbidden",version:2,class:"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="zcrestrict_icon"></div>',header:$("module.access.restricted")}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[Ti(e)||Ti(e.message)?$("module.disabled.common"):e.message]}),buttons:[{text:$(t?"common.reload":"Ok"),colour:$WC.$Dlg.RED_BUTTON,action:t?function(){location.reload()}:""}]})},registerCallbacks:function(e){for(var t in e)this.register(t,e[t])}}),Nt={},kt={},Ot=!1,Rt=null,Ht=!1;function $t(e){if(H.get("isCliqUser")()&&Ut("bots")&&(null==Rt||e)){var t=ve.getItem(H.get("zuid")+"_wms_bots");if(t)for(var s in Nt=t.botslist)Nt[s].ISSUBSCRIBED&&(kt[s]=Nt[s]);Dt(t&&t.sync_token)}}function Dt(e){Rt=(new Date).getTime(),Ht=Ot=!1;var t="limit=1000";e&&(t+="&sync_token="+e),Ie("v2/bots",t,function(e){var t,s,i=e&&JSON.parse(e);Lt(i.data),jt(i.deleted),t=i.sync_token,s={botslist:Nt,sync_token:t},ve.setItem(H.get("zuid")+"_wms_bots",s),Si.publish("/bots/updateui")},function(){Ht=!(Rt=null)})}function Lt(e){if("object"==typeof e&&!Ki(e)){var t=[];for(var s in e)t.push(e[s]);e=t}e.forEach(function(e){var t=function(e){var t=Bt(e.id),s=t&&t.original_info&&t.original_info.type;e.type=e.type||s;var i={ISBOT:!0,EMAILID:$("chatbot.smsg"),STATUSMSG:$("chatbot.smsg"),TYPE:"",PROTOCOL:"zoho",SCODE:1,UC:e.usage_count||e.info&&e.info.uc||0,ZUID:""};i.DNAME=e.name,i.UNIQUENAME=e.unique_name||e.info&&e.info.uniquename||e.uniquename,i.PHOTO=e.photo||e.photo_id||e.photoid,i.CHID=e.chat_id||e.chid||"",i.USERID=e.id,i.PERMISSION=e.permission||e.info&&e.info.permission,i.DESC=e.description||e.info&&e.info.desc||e.desc,i.ISSUBSCRIBED=!!e.active,i.PHOTO?i.PHOTO="/_chat/botimg/"+i.PHOTO+"/photo.do":i.CHID.endsWith("B1")?"0"==e.type||"1"==e.type?i.PHOTO="https://img.zohocdn.com/ichat/images/9d792ace_bot-custom.png":"2"==e.type?i.PHOTO="https://img.zohocdn.com/ichat/images/00f9c20a_zoho-projects.png":i.PHOTO="https://img.zohocdn.com/ichat/images/b7091bfa_bot-default.png":i.PHOTO="https://img.zohocdn.com/ichat/images/b7091bfa_bot-default.png";var n=e.status||e.statusmsg;if(n){var a=Math.round(Math.random()*(n.length-1));i.STATUSMSG=n[a],i.EMAILID=n[a]}else"2"==e.type&&e.description&&(i.STATUSMSG=$(e.description),i.EMAILID=$(e.description));return i.original_info=e,i}(e);e.active&&(kt[e.id]=t),Nt[e.id]=t})}function Pt(e){return e?kt:Nt}function Bt(e){return e=-1!=(""+e).indexOf("b-")?e.split("-")[1]:""+e,Nt[e]}function jt(e){e&&0!=e.length&&e.forEach(function(e){delete Nt[e]})}function Ft(e,t,s){return s&&(e=zt(s)),e=-1!=(""+e).indexOf("b-")?e.split("-")[1]:""+e,Nt[e]&&Nt[e].original_info&&(t=t||Nt[e].original_info.photo_id||Nt[e].original_info.photo||Nt[e].original_info.photoid||""),t?"/"+H.get("CHATCONT")+"/botimg/"+t+"/photo.do":Nt[e]&&Nt[e].CHID.endsWith("B1")?"0"==Nt[e].original_info.type||"1"==Nt[e].original_info.type?"https://img.zohocdn.com/ichat/images/9d792ace_bot-custom.png":"2"==Nt[e].original_info.type?"https://img.zohocdn.com/ichat/images/00f9c20a_zoho-projects.png":"https://img.zohocdn.com/ichat/images/b7091bfa_bot-default.png":"https://img.zohocdn.com/ichat/images/b7091bfa_bot-default.png"}function zt(e){for(var t in Nt)if(Nt[t].CHID==e)return t}function Gt(e){if(e){var t=Bt(e);return t&&t.DNAME}}function qt(e){return!(-1==(e=""+e).indexOf("b-")&&!Nt[e])}var Yt=Object.freeze({__proto__:null,updateBotActions:function(e,t){e=-1!=e.indexOf("b-")?e.split("-")[1]:e,Nt[e]&&(Nt[e].actionhandles=t)},getFromServerAfterFocus:function(){Ot=!0},syncFromServerAfterFocus:function(){Ht=!0},getFromServerIfFocussed:function(){(Ot||Ht)&&$t(Ht)},initBots:$t,fetchBots:Dt,updateBotContacts:Lt,getList:Pt,get:Bt,removeFromBotsList:jt,removeFromSubscribedList:function(e){e&&(delete kt[e],Nt[e].ISSUBSCRIBED=!1,Nt[e].original_info.active=!1)},getPhoto:Ft,subscribe:function(e){Te("v1/bots/b-"+e+"/subscribe","consent_validation=true",function(){var e=JSON.parse(this.response);"Consent"===e.data.status&&(new It).mountComponent("",e.data)},null,null,null,{"x-consents-version":"1","X-XHR-exception":!0,"X-ZCSRF-TOKEN":ci()})},getBotId:zt,getBotName:Gt,isBotId:qt}),Vt={ONLINE:1,OFFLINE:0,FEEDINFO:2,BUSY:3,IDLE:4,DONOTDISTURB:5,AWAY:7,WEB_LOGIN:1,MOB_LOGIN:3,CLIQ_CALLS:101,MEETING:102,CALENDAR_EVENT:103,SHOWTIME_TRAINING:104,ASSIST_SESSION:105,TELEPHONY:106},Zt=[],Kt=[],Xt={},Jt=0,Qt=!1;function es(e){return e?Zt[e]:Zt}function ts(e){return e?Kt[e]:Kt}function ss(e){return e?Xt[e]:Xt}function is(e,t){e&&(Xt[e]=t)}function ns(e,t){e&&(Xt[e].OPERATION_LOADER=t)}function as(e){if(ss(e))return ss(e).OPERATION_LOADER}function os(e){delete Xt[e]}function rs(e){null===e?Zt=[]:Zt.push(e)}function ls(e){null===e?Kt=[]:Kt.push(e)}function ds(e){Jt=e}function cs(e){Qt=e}function ms(){return Qt}function us(e,t){var s=!1;void 0!==ss(e)&&(s=ss(e).DNAME!==t,ss(e).DNAME=t),s&&WmsHybridSearch.populateContactListInMainUI(!0)}function ps(e){var t=[];try{for(var s in e){var i=e[s];-3==i.STATUS&&t.push(s),hs(i)}ds((new Date).getTime())}catch(e){}0<t.length&&(WmsImplHandler.invoke(WmsContactImpl.handleInvitations,t),WMSUI.updateInvitations(t))}function hs(e){is(e.USERID,{STATUS:e.STATUS,STYPE:e.st,STATUSMSG:e.STATUSMSG,OWNERID:H.get("zuid"),USERID:e.USERID,DNAME:e.DNAME,EMAILID:e.EMAILID});var t="";""!=e.PHOTO&&null!=e.PHOTO&&(t=e.PHOTO),ss(e.USERID).PHOTO=t}function gs(e){is(e.zuid,{STATUS:e.scode,STYPE:e.st,STATUSMSG:e.smsg,OWNERID:H.get("zuid"),USERID:e.zuid,DNAME:e.dname,EMAILID:e.email,PHOTO:"",UC:e.uc}),ds((new Date).getTime())}function fs(e){var t=vs(e);return"inactive"===t?$("user.status.inactive"):t==He.CONTACTSTATUS.UNAPRD?$("Invited"):t==He.CONTACTSTATUS.REMOVE||t==He.CONTACTSTATUS.DELETE?"+"+$("chat.contact.add"):t==He.CONTACTSTATUS.REQACC||t==He.CONTACTSTATUS.NOCHAT?$("contact.profileinfo.accept"):ss(e)?ss(e).STATUSMSG:"+ "+$("chat.contact.add")}function Cs(e){if(ss(e))return ss(e).STYPE}function vs(e){return ss(e)?ss(e).STATUS:!!Bt(e)&&Bt(e).STATUS}function bs(e,t,s){t=t||vs(e),s=s||Cs(e);var i="";return t?(i={0:"offline",1:"available",3:"busy",4:"idle",5:"dnd",7:"away"}[t]||"",s==Vt.MOB_LOGIN&&(i+="_mobile"),s==Vt.CLIQ_CALLS&&(i="busy_cliqcall"),s!=Vt.MEETING&&s!=Vt.SHOWTIME_TRAINING||(i="busy_meeting"),s==Vt.CALENDAR_EVENT&&(i="busy_calendarevent"),s!=Vt.ASSIST_SESSION&&s!=Vt.TELEPHONY||(i="busy_assistsession")):Li(e)?i+="threads":e&&qt(e)&&(i+="bot"),i}function ys(e,t){return ss()&&ss(e)?ss(e):t&&Pe()&&Pe(e)?Pe(e):void 0}function _s(e){try{return ss(e)?ss(e).DNAME:Pe(e)?Pe(e).DNAME:Bt(e)?Bt(e).DNAME:null}catch(e){return null}}function Ws(e,t,s){var i,n;if(0!=t.trim()){n="zoho"==e?(i="approvecontact.do","status=accept&userid="+t):(i="mpcontact.do","zohoid="+WebMessanger.getUserName()+"&mploginid="+s+"&contactid="+t+"&opr=acceptcon");Te(i,n,null,function(){void 0!==WmsMainUI&&(ns(zuid,!1),WmsHybridSearch.populateContactListInMainUI(!0))})}}function Ss(e){Te("approvecontact.do","status=remindmelater&userid="+e)}function ws(e){return ss(e)?ss(e).EMAILID:Pe(e)?Pe(e).EMAILID:null}function Ms(e,t){var s="";if(di(e)||"null"==e?s="https://img.zohocdn.com/ichat/images/bar/8ff234a1_contactphoto.gif":Ts(e)?s=WebMessanger.getGuestPhotoUrl(e.slice(1)):Bt(e)?s=Ft(e):(H.get("customContacts")||void 0!==WebMessanger&&"function"==typeof WebMessanger.isRTCChat&&WebMessanger.isRTCChat())&&(s=WmsImplHandler.invokeSynchronously(WmsUIImpl.getUserPhoto,e,t)),!s){var i=t||"50";s=H.get("photoserver")+"/file?ID="+e+"&t=user&height="+i+"&width="+i+"&exp=6000"}return s}function Is(e){var t=ys(e);return!(!t||t.STATUS!=He.CONTACTSTATUS.REQACC)}function Ts(e){return e&&"$"===e.charAt(0)}function As(){var e={};for(var t in ss())ss(t).ISBOT||(e[t]=ss(t));return e}var Es=Object.freeze({__proto__:null,userstatus:Vt,defaultstatusmsg:["Offline","Available","","Busy","Idle","Do not disturb","","Away"],getInvitedContactsList:es,getPendingInvitedContactsList:ts,getContactsList:ss,setContactsList:is,setOperationLoadingState:ns,getOperationLoadingState:as,removeFromContactsList:os,setInvitedContactsList:rs,setPendingInvitedContactsList:ls,setLastUpdatedTime:ds,getLastUpdatedTime:function(){return Jt},initialize:cs,getInitializedValue:ms,updateStatus:function(e){var t=e.zuid;null==ss(t)&&is(t,{OWNERID:H.get("zuid"),USERID:t,DNAME:e.dname,EMAILID:e.email?e.email:""}),ss(t).STATUS=e.scode,ss(t).STYPE=e.st,ss(t).STATUSMSG=e.smsg},updateDisplayName:us,updateFromMDParent:function(e){var t=[];try{for(var s in e){-3==e[s].STATUS&&t.push(s)}}catch(e){}0<t.length&&(WmsImplHandler.invoke(WmsContactImpl.handleInvitations,t),WMSUI.updateInvitations(t))},updateContacts:function(e){try{for(var t in e){var s={};if(e[t].ua){var i=JSON.parse(e[t].ua);s.zuid=t,s.email=i[0],s.dname=i[1]||s.email,s.uc=i[2],s.scode=i[5],s.smsg=i[6]||WmsContacts.defaultstatusmsg[s.scode],s.st=i[7]}else{var n=li(e[t].s,6,!0);s.zuid=t,s.scode=n[0],s.email=n[1],s.st=n[2],s.uc=n[3],s.dname=n[5][1]||s.email,s.smsg=n[5][0]||WmsContacts.defaultstatusmsg[s.scode]}s.scode==He.CONTACTSTATUS.REQACC&&-1===es().indexOf(t)&&-1===ts().indexOf(t)?(rs(t),ls(t)):s.scode==He.CONTACTSTATUS.NOCHAT&&-1===ts().indexOf(t)&&ls(t),gs(s)}ds((new Date).getTime())}catch(e){}es().length&&"undefined"!=typeof WmsContactImpl&&WmsImplHandler.invoke(WmsContactImpl.handleInvitations,es())},copyContacts:ps,copyZohoContacts:hs,updateContact:gs,deletecontact:function(e){os(e)},isInitialised:function(){return Qt},init:function(e){ds(0),cs(!(Xt={})),null!=e&&(ps(e),cs(!0))},getcontacts:function(){return ss()},isonline:function(e){return!!ss(e)&&"0"!==ss(e).status},getZohoContacts:function(){return ss()},getStatusMsg:fs,getStatusType:Cs,status:vs,getStatusClassName:bs,add:function(e,t,s){var i,n;0!=t.trim()&&(n="zoho"==e?(i="addcontact.do","ulist="+encodeURIComponent(t)):(i="mpcontact.do","zohoid="+WebMessanger.getUserName()+"&mploginid="+s+"&contactid="+t+"&opr=addcon"),Te(i,n))},reinvite:function(e,t,s){0!=t.trim()&&(Me("reinvitebyemailid.sas","emailid="+t),is(s,{STATUS:"0",STATUSMSG:null,OWNERID:null,USERID:s}),ds((new Date).getTime()))},remove:function(e,t,s){var i,n;n="zoho"==e?(i="deletecontact.do","emailid="+encodeURIComponent(ws(t))+"&userid="+t):(i="mpcontact.do","zohoid="+WebMessanger.getUserName()+"&mploginid="+s+"&contactid="+t+"&opr=removecon"),Te(i,n),is(t,null),ds((new Date).getTime())},get:ys,getDisplayName:_s,updateUserStatus:function(e,t,s,i){ss(e)&&0<=ss(e).STATUS&&ss(e).STATUS<=4?ss(e).STATUS===t&&ss(e).STYPE===s&&ss(e).STATUSMSG===i||(ss(e).STATUS=t,ss(e).STYPE=s,ss(e).STATUSMSG=i,WmsHybridSearch.updatePresence(e),WmsMainUI.updateChatHTML(e)):Pe(e)&&(Pe(e).STATUS===t&&Pe(e).STYPE===s&&Pe(e).STATUSMSG===i||(Pe(e).STATUS=t,Pe(e).STYPE=s,Pe(e).STATUSMSG=i,WmsMainUI.updateChatHTML(e)))},handleInviteOperation:function(e){var t=e.getAttribute("data-operation"),s=e.getAttribute("data-id"),i=e.getAttribute("data-dname");if(null===s&&null===i&&(s=e.parentNode.getAttribute("data-id"),i=e.parentNode.getAttribute("data-dname")),"accept"===t?(Ws("zoho",s,H.get("zuid")),ns(s,!0)):"reject"===t?(Ss(s),ns(s,!0)):"addcontact"===t&&(s?WMSUI.inviteMember(s,i):(WMSUI.inviteMember(i,i),WmsMainUI.resetToDefaultUI())),document.getElementById("wms-hysearch")&&WmsHybridSearch.populateFrequentContactsInSmartChat(),void 0!==WmsMainUI&&!H.get("customContacts")){var n={suggestions:"show_suggestions"};WmsHybridSearch.populateContactListInMainUI(!0,n)}},accept:Ws,reject:function(e,t,s){var i,n;if(0!=t.trim()){n="zoho"==e?(i="approvecontact.do","status=reject&userid="+t):(i="mpcontact.do","zohoid="+WebMessanger.getUserName()+"&mploginid="+s+"&contactid="+t+"&opr=rejectcon");Te(i,n,null,function(){void 0!==WmsMainUI&&(ns(zuid,!1),WmsHybridSearch.populateContactListInMainUI(!0))})}},remindMeLater:Ss,getEmailId:ws,getZuid:function(e){var t="",s=ss();for(var i in s)s[i].EMAILID===e&&(t=i);if(!t){var n=Pe();for(var i in n)n[i].EMAILDID===e&&(t=i)}return t},verifyUserStatus:function(e){for(var t=0;t<e.length;t++){var s=e[t],i=s.uname,n=s.scode;if(0!=s.zuid.trim().length)try{var a=vs(i);!1!==a&&n!=a&&0<=a&&WebMessanger.verifyUserStatus(s.zuid,ss(i).STATUS)}catch(e){}}},getUserPhoto:Ms,getSortedContacts:function(e,t,s,i){var n=[];for(var a in s=s||ss())s[a][e]&&n.push(s[a]);return"UC"===e?n.sort(Ci(e,t,function(e){return parseInt(e,10)})):n.sort(Ci(e,t,function(e){return e.toLowerCase()})),n.slice(0,i)},isInvitedContact:Is,isInvitationPending:function(e){var t=ys(e);return!(!t||t.STATUS!=He.CONTACTSTATUS.NOCHAT)},removeInvitations:function(){rs(null),ls(null)},isAnnonUser:Ts,getContactsListWithoutBots:As}),Us={};var xs,Ns=Object.freeze({__proto__:null,getInfo:function(e){if(Us[e])return Us[e]},storeInfo:function(e,t){void 0===this.getInfo(e)&&(us(e,(Us[e]=t).dname),Xe(e,t.dname))}});function ks(e){e=(""+e).replace(/&#39;|&#x27;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&");var t={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"};return e.replace(/[&><"']/g,function(e){return t[e]})}function Os(e){return"[object Array]"===Object.prototype.toString.call(e)}function Rs(e){var t=e;if(Os(t)){var s=t[1];return s=(s=Os(s)?s:[s]).map(function(e){return ks(e)}),t[1]=s,xs.getRealValue.apply(xs,t)}return xs.getRealValue(t)}function Hs(e,t,s){var i={};for(var n in t){if(/^\$/.test(n)){var a=Rs(t[n]);n=n.substring(1),i[n]=a}else i[n]="InSecureHTML"===s?t[n]:ks(t[n])}var o=Object.keys(i).join("|"),r=new RegExp("{{("+o+")}}","g");return e.replace(r,function(e){return e=e.substring(2).slice(0,-2),i[e]})}var $s=Object.freeze({__proto__:null,setResource:function(e){xs=e},replace:Hs}),Ds={emoji:"",sticker:""},Ls=!1,Ps=null,Bs=null,js=!1,Fs={emoji:!0,sticker:!0};function zs(e,o){if(!Ls){var t=function(e){var t=JSON.parse(e),s=t.custom_emojis;o&&o({status:"Success",custom_emojis:t.custom_emojis});var i=H.get("customemojis")||{},n=H.get("stickers")||{};for(var a in s)ge.check("customemoji",a)?i[a]=s[a]:n[a]=s[a];Ps=i,Bs=n,H.set({customemojis:i,stickers:n}),t.next_token&&t.criteria_type&&(Ds[t.criteria_type]=t.next_token),ri(t.custom_emojis)&&t.criteria_type&&!this.search_text&&(Fs[t.criteria_type]=!1),Ls=!1,js||Js(!0)}.bind(e),s={"X-XHR-exception":"true","X-ZCSRF-TOKEN":ci()},i="",n=e&&e.criteriatype||"";n&&(i+=Gs(i)+"type="+n),e&&e.includenexttoken&&Ds[n]&&(i+=Gs(i)+"next_token="+Ds[n]),e&&e.search_text&&(i+=Gs(i)+"search_text="+e.search_text);Ls=!0,Ie("v2/customemojis",i,t,function(){Ls=!1,o&&o({status:"Failure",custom_emojis:{}})},null,null,s)}}function Gs(e){return 0<e.length?"&":""}function qs(){return Ps}function Ys(){return Bs}function Vs(e,t){var s="sticker"==t?Bs:Ps,i=[];if(e){var n=[],a=[];for(var o in s)if(1==s[o].status){var r=o.replace(/[:$!]/g,"");r.startsWith(e)&&n.push(o),-1<r.indexOf(e)&&!r.startsWith(e)&&a.push(o)}i=n.concat(a)}else{i=Object.keys(s).sort().filter(function(e){if(1==s[e].status)return s[e]})}return i}function Zs(e){var t=Ps[e];if(t){var s=_WMSCHATURL+"v2/customemojis/"+t.emoji_id+"/download";return k("em",{class:"wms_comp_customemojimsg",title:e.replace(/[:$!]/g,""),"data-smileycode":e,style:{"background-image":"url("+s+")"}})}return null}function Ks(e){var t=Bs[e];if(t){var s=_WMSCHATURL+"v2/customemojis/"+t.emoji_id+"/download";return k("em",{class:"wms_componentstickermsg",title:e.replace(/[:$!]/g,""),"data-smileycode":e,style:{"background-image":"url("+s+")"}})}return null}function Xs(e){return Ps[e]||Bs[e]}function Js(e){js=e}function Qs(){return js}function ei(e){return Fs[e]}var ti=Object.freeze({__proto__:null,fetchStickers:zs,getCustomEmoji:qs,getStickers:Ys,getSortedCustomEmojis:Vs,getCustomEmojiElement:Zs,getStickerElemet:Ks,getCustomEmojiMeta:Xs,constructCustomEmojiMeta:function(e){var t=ge.match("customemoji",e,"gi")||[];t=t.concat(ge.match("sticker",e,"gi")||[]);for(var s={},i=0;i<t.length;i++)s[t[i]]=Xs(t[i]);return s},setInitialFetchStatus:Js,getInitialFetchStatus:Qs,canFetchMore:ei}),si=function(e){var t=e&&e.type||"workplace";this.type="workplace"===t?"w":"f",this.default_size=e&&e.default_size||72,this.along_text_size=e&&e.along_text_size||24;var s=e&&e.animation;for(var i in this.animation_disabled="disabled"===s,this.animation_default_size=s&&s.default_size||72,this.animation_along_text_size=s&&s.along_text_size||24,this.customemoji_size=e&&e.customemoji_size||"default",this.emoji_lookup={":grinning:":["#x1f600"],":grin:":["#x1f601"],":joy:":["#x1f602"],":smiley:":["#x1f603"],":smile:":["#x1f604"],":sweat-smile:":["#x1f605"],":laughing:":["#x1f606"],":wink:":["#x1f609"],":blush:":["#x1f60a"],":yum:":["#x1f60b"],":sunglasses:":["#x1f60e"],":heart-eyes:":["#x1f60d"],":kissing-heart:":["#x1f618"],":kissing:":["#x1f617"],":kissing-smiling-eyes:":["#x1f619"],":kissing-closed-eyes:":["#x1f61a"],":slight-smile:":["#x1f642"],":hug:":["#x1f917"],":thinking:":["#x1f914"],":neutral-face:":["#x1f610"],":expressionless:":["#x1f611"],":no-mouth:":["#x1f636"],":rolling-eyes:":["#x1f644"],":smirk:":["#x1f60f"],":persevere:":["#x1f623"],":cry:":["#x1f622"],":open-mouth:":["#x1f62e"],":zipper-mouth:":["#x1f910"],":hushed:":["#x1f62f"],":sleepy:":["#x1f62a"],":tired-face:":["#x1f62b"],":sleeping:":["#x1f634"],":relieved:":["#x1f60c"],":stuck-out-tongue:":["#x1f61b"],":stuck-out-tongue-winking-eye:":["#x1f61c"],":stuck-out-tongue-closed-eyes:":["#x1f61d"],":unamused:":["#x1f612"],":sweat:":["#x1f613"],":pensive:":["#x1f614"],":confused:":["#x1f615"],":upside-down:":["#x1f643"],":money-mouth:":["#x1f911"],":astonished:":["#x1f632"],":slight-frowning:":["#x1f641"],":confounded:":["#x1f616"],":disappointed:":["#x1f61e"],":worried:":["#x1f61f"],":triumph:":["#x1f624"],":disappointed-relieved:":["#x1f625"],":sob:":["#x1f62d"],":frowning-with-open-mouth:":["#x1f626"],":anguished:":["#x1f627"],":fearful:":["#x1f628"],":weary:":["#x1f629"],":grimacing:":["#x1f62c"],":cold-sweat:":["#x1f630"],":scream:":["#x1f631"],":flushed:":["#x1f633"],":dizzy-face:":["#x1f635"],":rage:":["#x1f621"],":angry:":["#x1f620"],":mask:":["#x1f637"],":sick:":["#x1f912"],":head-bandaged:":["#x1f915"],":halo-smiling:":["#x1f607"],":nerd:":["#x1f913"],":smiling-with-horns:":["#x1f608"],":imp:":["#x1f47f"],":japanese-ogre:":["#x1f479"],":japanese-goblin:":["#x1f47a"],":skull:":["#x1f480"],":ghost:":["#x1f47b"],":alien:":["#x1f47d"],":robot:":["#x1f916"],":hankey:":["#x1f4a9"],":smiley-cat:":["#x1f63a"],":smile-cat:":["#x1f638"],":joy-cat:":["#x1f639"],":heart-eyes-cat:":["#x1f63b"],":smirk-cat:":["#x1f63c"],":kissing-cat:":["#x1f63d"],":scream-cat:":["#x1f640"],":crying-cat-face:":["#x1f63f"],":pouting-cat:":["#x1f63e"],":baby:":["#x1f476"],":girl:":["#x1f467"],":boy:":["#x1f466"],":woman:":["#x1f469"],":man:":["#x1f468"],":older-woman:":["#x1f475"],":older-man:":["#x1f474"],":man-with-gua-pi-mao:":["#x1f472"],":man-with-turban:":["#x1f473"],":person-with-blond-hair:":["#x1f471"],":cop:":["#x1f46e"],":construction-worker:":["#x1f477"],":guardsman:":["#x1f482"],":detective:":["#x1f575"],":bride-in-veil:":["#x1f470"],":princess:":["#x1f478"],":santa:":["#x1f385"],":angel:":["#x1f47c"],":bow:":["#x1f647"],":information-desk-person:":["#x1f481"],":no-good:":["#x1f645"],":ok-woman:":["#x1f646"],":raising-hand:":["#x1f64b"],":person-with-pouting-face:":["#x1f64e"],":person-frowning:":["#x1f64d"],":haircut:":["#x1f487"],":massage:":["#x1f486"],":nail-care:":["#x1f485"],":dancer:":["#x1f483"],":dancers:":["#x1f46f"],":levitating-man:":["#x1f574"],":walking:":["#x1f6b6"],":runner:":["#x1f3c3"],":couple:":["#x1f46b"],":boys:":["#x1f46c"],":girls:":["#x1f46d"],":couplekiss:":["#x1f48f"],":couple-with-heart:":["#x1f491"],":boyskiss:":["#x1f468","#x200d","#x2764","#xfe0f","#x200d","#x1f48b","#x200d","#x1f468"],":boys-with-heart:":["#x1f468","#x200d","#x2764","#xfe0f","#x200d","#x1f468"],":girlskiss:":["#x1f469","#x200d","#x2764","#xfe0f","#x200d","#x1f48b","#x200d","#x1f469"],":girls-with-heart:":["#x1f469","#x200d","#x2764","#xfe0f","#x200d","#x1f469"],":family:":["#x1f46a"],":family-man-woman-girl:":["#x1f468","#x200d","#x1f469","#x200d","#x1f467"],":family-man-woman-girl-boy:":["#x1f468","#x200d","#x1f469","#x200d","#x1f467","#x200d","#x1f466"],":family-man-woman-boy-boy:":["#x1f468","#x200d","#x1f469","#x200d","#x1f466","#x200d","#x1f466"],":family-man-woman-girl-girl:":["#x1f468","#x200d","#x1f469","#x200d","#x1f467","#x200d","#x1f467"],":family-man-man-boy:":["#x1f468","#x200d","#x1f468","#x200d","#x1f466"],":family-man-man-girl:":["#x1f468","#x200d","#x1f468","#x200d","#x1f467"],":family-man-man-girl-boy:":["#x1f468","#x200d","#x1f468","#x200d","#x1f467","#x200d","#x1f466"],":family-man-man-boy-boy:":["#x1f468","#x200d","#x1f468","#x200d","#x1f466","#x200d","#x1f466"],":family-man-man-girl-girl:":["#x1f468","#x200d","#x1f468","#x200d","#x1f467","#x200d","#x1f467"],":family-woman-woman-girl-boy:":["#x1f469","#x200d","#x1f469","#x200d","#x1f467","#x200d","#x1f466"],":family-woman-woman-boy-boy:":["#x1f469","#x200d","#x1f469","#x200d","#x1f466","#x200d","#x1f466"],":family-woman-woman-girl-girl:":["#x1f469","#x200d","#x1f469","#x200d","#x1f467","#x200d","#x1f467"],":family-woman-woman-boy:":["#x1f469","#x200d","#x1f469","#x200d","#x1f466"],":family-woman-woman-girl:":["#x1f469","#x200d","#x1f469","#x200d","#x1f467"],":see-no-evil:":["#x1f648"],":hear-no-evil:":["#x1f649"],":speak-no-evil:":["#x1f64a"],":fire:":["#x1f525"],":sparkles:":["#x2728"],":star2:":["#x1f31f"],":droplet:":["#x1f4a7"],":tophat:":["#x1f3a9"],":crown:":["#x1f451"],":womans-hat:":["#x1f452"],":athletic-shoe:":["#x1f45f"],":mans-shoe:":["#x1f45e"],":sandal:":["#x1f461"],":high-heel:":["#x1f460"],":boot:":["#x1f462"],":shirt:":["#x1f455"],":necktie:":["#x1f454"],":womans-clothes:":["#x1f45a"],":dress:":["#x1f457"],":running-shirt-with-sash:":["#x1f3bd"],":jeans:":["#x1f456"],":kimono:":["#x1f458"],":bikini:":["#x1f459"],":briefcase:":["#x1f4bc"],":handbag:":["#x1f45c"],":pouch:":["#x1f45d"],":purse:":["#x1f45b"],":eyeglasses:":["#x1f453"],":ribbon:":["#x1f380"],":closed-umbrella:":["#x1f302"],":gem:":["#x1f48e"],":speech-balloon:":["#x1f4ac"],":open-hands:":["#x1f450"],":raised-hands:":["#x1f64c"],":clap:":["#x1f44f"],":thumbs-up:":["#x1f44d"],":thumbs-down:":["#x1f44e"],":oncoming-fist:":["#x1f44A"],":fist:":["#x270A"],":sign-of-horns:":["#x1f918"],":ok-hand:":["#x1f44c"],":point-left:":["#x1f448"],":point-right:":["#x1f449"],":point-up-2:":["#x1f446"],":point-down:":["#x1f447"],":raised-hand:":["#x270B"],":spayed-fingers:":["#x1f590"],":vulcan-salute:":["#x1f596"],":wave:":["#x1f44b"],":muscle:":["#x1f4aa"],":middle-finger:":["#x1f595"],":pray:":["#x1f64f"],":ring:":["#x1f48d"],":lipstick:":["#x1f484"],":kiss:":["#x1f48b"],":lips:":["#x1f444"],":tongue:":["#x1f445"],":ear:":["#x1f442"],":nose:":["#x1f443"],":footprints:":["#x1f463"],":eye:":["#x1f441"],":eyes:":["#x1f440"],":speaking-head:":["#x1f5e3"],":bust-in-silhouette:":["#x1f464"],":busts-in-silhouette:":["#x1f465"],":dog:":["#x1f436"],":wolf:":["#x1f43a"],":cat:":["#x1f431"],":mouse:":["#x1f42d"],":hamster:":["#x1f439"],":rabbit:":["#x1f430"],":frog:":["#x1f438"],":tiger:":["#x1f42f"],":koala:":["#x1f428"],":bear:":["#x1f43b"],":pig:":["#x1f437"],":pig-nose:":["#x1f43d"],":cow:":["#x1f42e"],":boar:":["#x1f417"],":monkey-face:":["#x1f435"],":monkey:":["#x1f412"],":horse:":["#x1f434"],":sheep:":["#x1f411"],":elephant:":["#x1f418"],":panda-face:":["#x1f43c"],":penguin:":["#x1f427"],":bird:":["#x1f426"],":baby-chick:":["#x1f424"],":hatched-chick:":["#x1f425"],":hatching-chick:":["#x1f423"],":chicken:":["#x1f414"],":snake:":["#x1f40d"],":turtle:":["#x1f422"],":bug:":["#x1f41b"],":bee:":["#x1f41d"],":ant:":["#x1f41c"],":beetle:":["#x1f41e"],":snail:":["#x1f40c"],":octopus:":["#x1f419"],":shell:":["#x1f41a"],":tropical-fish:":["#x1f420"],":fish:":["#x1f41f"],":dolphin:":["#x1f42c"],":whale:":["#x1f433"],":racehorse:":["#x1f40e"],":dragon-face:":["#x1f432"],":blowfish:":["#x1f421"],":camel:":["#x1f42b"],":poodle:":["#x1f429"],":feet:":["#x1f43e"],":bouquet:":["#x1f490"],":cherry-blossom:":["#x1f338"],":tulip:":["#x1f337"],":four-leaf-clover:":["#x1f340"],":rose:":["#x1f339"],":sunflower:":["#x1f33b"],":hibiscus:":["#x1f33a"],":maple-leaf:":["#x1f341"],":leaves:":["#x1f343"],":fallen-leaf:":["#x1f342"],":herb:":["#x1f33f"],":ear-of-rice:":["#x1f33e"],":mushroom:":["#x1f344"],":cactus:":["#x1f335"],":palm-tree:":["#x1f334"],":chestnut:":["#x1f330"],":seedling:":["#x1f331"],":blossom:":["#x1f33c"],":new-moon:":["#x1f311"],":first-quarter-moon:":["#x1f313"],":moon:":["#x1f314"],":full-moon:":["#x1f315"],":first-quarter-moon-with-face:":["#x1f31b"],":crescent-moon:":["#x1f319"],":earth-asia:":["#x1f30f"],":volcano:":["#x1f30b"],":milky-way:":["#x1f30c"],":stars:":["#x1f320"],":partly-sunny:":["#x26C5"],":snowman:":["#x26C4"],":cyclone:":["#x1f300"],":foggy:":["#x1f301"],":rainbow:":["#x1f308"],":ocean:":["#x1f30a"],":house:":["#x1f3e0"],":house-with-garden:":["#x1f3e1"],":school:":["#x1f3eb"],":office:":["#x1f3e2"],":post-office:":["#x1f3e3"],":hospital:":["#x1f3e5"],":bank:":["#x1f3e6"],":convenience-store:":["#x1f3ea"],":love-hotel:":["#x1f3e9"],":hotel:":["#x1f3e8"],":wedding:":["#x1f492"],":church:":["#x26EA"],":department-store:":["#x1f3ec"],":city-sunrise:":["#x1f307"],":city-sunset:":["#x1f306"],":japanese-castle:":["#x1f3ef"],":european-castle:":["#x1f3f0"],":tent:":["#x26FA"],":factory:":["#x1f3ed"],":tokyo-tower:":["#x1f5fc"],":japan:":["#x1f5fe"],":mount-fuji:":["#x1f5fb"],":sunrise-over-mountains:":["#x1f304"],":sunrise:":["#x1f305"],":night-with-stars:":["#x1f303"],":statue-of-liberty:":["#x1f5fd"],":bridge-at-night:":["#x1f309"],":carousel-horse:":["#x1f3a0"],":ferris-wheel:":["#x1f3a1"],":fountain:":["#x26F2"],":roller-coaster:":["#x1f3a2"],":ship:":["#x1f6a2"],":boat:":["#x26F5"],":speedboat:":["#x1f6a4"],":rocket:":["#x1f680"],":seat:":["#x1f4ba"],":station:":["#x1f689"],":high-speed-train:":["#x1f684"],":bullet-train:":["#x1f685"],":metro:":["#x1f687"],":railway-car:":["#x1f683"],":bus:":["#x1f68c"],":blue-car:":["#x1f699"],":car:":["#x1f697"],":taxi:":["#x1f695"],":truck:":["#x1f69a"],":rotating-light:":["#x1f6a8"],":police-car:":["#x1f693"],":fire-engine:":["#x1f692"],":ambulance:":["#x1f691"],":bike:":["#x1f6b2"],":barber-pole:":["#x1f488"],":busstop:":["#x1f68f"],":ticket:":["#x1f3ab"],":traffic-light:":["#x1f6a5"],":construction:":["#x1f6a7"],":beginner:":["#x1f530"],":fuelpump:":["#x26FD"],":izakaya-lantern:":["#x1f3ee"],":slot-machine:":["#x1f3b0"],":moyai:":["#x1f5ff"],":circus-tent:":["#x1f3aa"],":performing-arts:":["#x1f3ad"],":round-pushpin:":["#x1f4cd"],":triangular-flag-on-post:":["#x1f6a9"],":red-heart:":["#x2764","#xfe0f"],":yellow-heart:":["#x1f49b"],":blue-heart:":["#x1f499"],":purple-heart:":["#x1f49c"],":green-heart:":["#x1f49a"],":broken-heart:":["#x1f494"],":heart-exclamation:":["#x2763","#xfe0f"],":two-hearts:":["#x1f495"],":revolving-hearts:":["#x1f49e"],":heartbeat:":["#x1f493"],":heartpulse:":["#x1f497"],":sparkling-heart:":["#x1f496"],":cupid:":["#x1f498"],":gift-heart:":["#x1f49d"],":heart-decoration:":["#x1f49f"],":love-letter:":["#x1f48c"],":dizzy:":["#x1f4ab"],":boom:":["#x1f4a5"],":anger:":["#x1f4a2"],":sweat-drops:":["#x1f4a6"],":zzz:":["#x1f4a4"],":dash:":["#x1f4a8"],":hole:":["#x1f573","#xfe0f"],":peace-symbol:":["#x262e","#xfe0f"],":latin-cross:":["#x271d","#xfe0f"],":crescent-and-star:":["#x262a","#xfe0f"],":om:":["#x1f549","#xfe0f"],":wheel-of-dharma:":["#x2638","#xfe0f"],":star-of-david:":["#x2721","#xfe0f"],":star-with-middle-point:":["#x1f52f"],":menorah:":["#x1f54e"],":yin-yang:":["#x262f","#xfe0f"],":orthodox-cross:":["#x2626","#xfe0f"],":place-of-workship:":["#x1f6d0"],":ophiuchus:":["#x26ce"],":aries:":["#x2648"],":taurus:":["#x2649"],":gemini:":["#x264a"],":cancer:":["#x264b"],":leo:":["#x264c"],":virgo:":["#x264d"],":libra:":["#x264e"],":scorpius:":["#x264f"],":sagittarius:":["#x2650"],":capricorn:":["#x2651"],":aquarius:":["#x2652"],":pisces:":["#x2653"],":squared-id:":["#x1f194"],":atom:":["#x269b","#xfe0f"],":japanese-vacancy-button:":["#x1f233"],":japanese-discount-button:":["#x1f239"],":radioactive:":["#x2622","#xfe0f"],":biohazard:":["#x2623","#xfe0f"],":japanese-not-free-of-charge-button:":["#x1f236"],":japanese-free-of-charge-button:":["#x1f21a"],":japanese-application-button:":["#x1f238"],":japanese-open-for-business-button:":["#x1f23a"],":japanese-monthly-amount:":["#x1f237","#xfe0f"],":eight-pointed-star:":["#x2734","#xfe0f"],":vs-button:":["#x1f19a"],":japanese-acceptable-button:":["#x1f251"],":white-flower:":["#x1f4ae"],":japanese-bargain-button:":["#x1f250"],":japanese-secret-button:":["#x3299","#xfe0f"],":japanese-congratulations-button:":["#x3297","#xfe0f"],":japanese-passing-grade-button:":["#x1f234"],":japanese-no-vacancy-button:":["#x1f235"],":japanese-prohibited-button:":["#x1f232"],":baby-symbol:":["#x1f6bc"],":a-group-blood":["#x1f170","#xfe0f"],":b-group-blood:":["#x1f171","#xfe0f"],":o-group-blood:":["#x1f17e","#xfe0f"],":cl-button:":["#x1f191"],":sos-button:":["#x1f198"],":no-entry:":["#x26d4"],":name-badge:":["#x1f4db"],":heavy-circle:":["#x2b55"],":prohibited:":["#x1f6ab"],":muted:":["#x1f507"],":bell-with-slash:":["#x1f515"],":no-smoking:":["#x1f6ad"],":no-pedestrains:":["#x1f6b7"],":no-littering:":["#x1f6af"],":no-bicycle:":["#x1f6b3"],":non-potable-water:":["#x1f6b1"],":no-one-under-18:":["#x1f51e"],":no-mobile-phones:":["#x1f4f5"],":exclamation-mark:":["#x2757"],":white-exclamation-mark:":["#x2755"],":question-mark:":["#x2753"],":white-question-mark:":["#x2754"],":hundred-points:":["#x1f4af"],":dim-button:":["#x1f505"],":bright-button:":["#x1f506"],":trident:":["#x1f531"],":fleur-de-lis:":["#x269c","#xfe0f"],":part-alternation-mark:":["#x303d","#xfe0f"],":warning:":["#x26a0","#xfe0f"],":children-crossing:":["#x1f6b8"],":japanese-beginner-button:":["#x1f530"],":recycling:":["#x267b","#xfe0f"],":japanese-reserved-button:":["#x1f22f"],":chart-increasing-with-yen:":["#x1f4b9"],":sparkle:":["#x2747","#xfe0f"],":eight-spoked-asterisk:":["#x2733","#xfe0f"],":white-heavy-check-mark:":["#x2705"],":cross-mark:":["#x274c"],":diamond-with-dot:":["#x1f4a0"],":globe-with-meridians:":["#x1f310"],":circled-m:":["#x24c2","#xfe0f"],":japanese-service-charge-button:":["#x1f202","#xfe0f"],":double-curly-loop:":["#x27bf"],":passport-control:":["#x1f6c2"],":customs:":["#x1f6c3"],":baggage-claim:":["#x1f6c4"],":left-luggage:":["#x1f6c5"],":wheel-chair:":["#x267f"],":water-closet:":["#x1f6be"],":p-button:":["#x1f17f","#xfe0f"],":potable-water:":["#x1f6b0"],":men-room:":["#x1f6b9"],":women-room:":["#x1f6ba"],":restroom:":["#x1f6bb"],":litter-in-bin:":["#x1f6ae"],":antenna-bars:":["#x1f4f6"],":japanese-here-button:":["#x1f201"],":ng-button:":["#x1f196"],":ok-button:":["#x1f197"],":up-button:":["#x1f199"],":cool-button:":["#x1f192"],":new-button:":["#x1f195"],":free-button:":["#x1f193"],":input-number:":["#x1f522"],":pause-button:":["#x23f8","#xfe0f"],":pause-or-play-button:":["#x23ef","#xfe0f"],":stop-button:":["#x23f9","#xfe0f"],":record-button:":["#x23fa"],":next-track-button:":["#x23ed","#xfe0f"],":last-track-button:":["#x23ee","#xfe0f"],":fast-forward:":["#x23e9"],":fast-reverse:":["#x23ea"],":shuffle-tracks-button:":["#x1f500"],":repeat-button:":["#x1f501"],":repeat-once-button:":["#x1f502"],":reverse-button:":["#x25c0","#xfe0f"],":fast-up-button:":["#x23eb"],":fast-down-button:":["#x23ec"],":right-arrow:":["#x27a1","#xfe0f"],":left-arrow:":["#x2b05","#xfe0f"],":up-arrow:":["#x2b06","#xfe0f"],":down-arrow:":["#x2b07","#xfe0f"],":up-right-arrow:":["#x2197","#xfe0f"],":down-left-arrow:":["#x2199","#xfe0f"],":counter-clockwise-arrows:":["#x1f504"],":left-arrow-curving-right:":["#x21aa","#xfe0f"],":right-arrow-curving-left:":["#x21a9","#xfe0f"],":right-arrow-curving-up:":["#x2934","#xfe0f"],":right-arrow-curving-down:":["#x2935","#xfe0f"],":info-button:":["#x2139","#xfe0f"],":input-latin-letters:":["#x1f524"],":input-latin-lowercase:":["#x1f521"],":input-latin-uppercase:":["#x1f520"],":input-symbols:":["#x1f523"],":play-button:":["#x25b6","#xfe0f"],":eject-button:":["#x23cf","#xfe0f"],":down-right-arrow:":["#x2198","#xfe0f"],":up-left-arrow:":["#x2196","#xfe0f"],":clockwise-vertical-arrows:":["#x1f503"],":on-arrow:":["#x1f51b"],":top-arrow:":["#x1f51d"],":soon-arrow:":["#x1f51c"],":ballot-box-with-check:":["#x2611","#xfe0f"],":end-arrow:":["#x1f51a"],":back-arrow:":["#x1f519"],":wavy-dash:":["#x3030","#xfe0f"],":curly-loop:":["#x27b0"],":heavy-check-mark:":["#x2714","#xfe0f"],":heavy-dollar-sign:":["#x1f4b2"],":currency-exchange:":["#x1f4b1"],":heavy-plus-sign:":["#x2795"],":heavy-minus-sign:":["#x2796"],":heavy-multiplication-sign:":["#x2716","#xfe0f"],":heavy-division-sign:":["#x2797"],":copyright:":["#xa9","#xfe0f"],":registered:":["#xae","#xfe0f"],":trade-mark:":["#x2122","#xfe0f"],":radio-button:":["#x1f518"],":white-circle:":["#x26aa"],":black-circle:":["#x26ab"],":red-circle:":["#x1f534"],":blue-circle:":["#x1f535"],":small-orange-diamond:":["#x1f538"],":small-blue-diamond:":["#x1f539"],":large-orange-diamond:":["#x1f536"],":large-blue-diamond:":["#x1f537"],":red-triangle-pointed-up:":["#x1f53a"],":red-triangle-pointed-down:":["#x1f53b"],":upwards-button:":["#x1f53c"],":downwards-button:":["#x1f53d"],":black-medium-small-square:":["#x25fe"],":white-medium-small-square:":["#x25fd"],":black-large-square:":["#x2b1b"],":white-large-square:":["#x2b1c"],":black-medium-square:":["#x25fc","#xfe0f"],":white-medium-square:":["#x25fb","#xfe0f"],":black-small-square:":["#x25aa","#xfe0f"],":white-small-square:":["#x25ab","#xfe0f"],":black-square-button:":["#x1f533"],":white-square-button:":["#x1f532"],":twelve-o-clock:":["#x1f55b"],":twelve-thirty:":["#x1f567"],":one-o-clock:":["#x1f550"],":one-thirty:":["#x1f55c"],":two-o-clock:":["#x1f551"],":two-thirty:":["#x1f55d"],":three-o-clock:":["#x1f552"],":three-thirty:":["#x1f55e"],":four-o-clock:":["#x1f553"],":four-thirty:":["#x1f55f"],":five-o-clock:":["#x1f554"],":five-thirty:":["#x1f560"],":six-o-clock:":["#x1f555"],":six-thirty:":["#x1f561"],":seven-o-clock:":["#x1f556"],":seven-thirty:":["#x1f562"],":eight-o-clock:":["#x1f557"],":eight-thirty:":["#x1f563"],":nine-o-clock:":["#x1f558"],":nine-thirty:":["#x1f564"],":ten-o-clock:":["#x1f559"],":ten-thirty:":["#x1f565"],":eleven-o-clock:":["#x1f55a"],":eleven-thirty:":["#x1f566"]},this.symbol_lookup={":)":":smile:",":-)":":smile:",":^)":":smile:",":]":":smile:",":(":":sad:",":-(":":sad:",":[":":sad:",":D":":happy:",":d":":happy:",":-D":":happy:",":))":":happy:",":-))":":happy:","X-(":":angry:",":-@":":angry:",":@":":angry:",":P":":razz:",":-p":":razz:",":p":":razz:",";)":":wink:",";-)":":wink:",":/":":smirk:",":-/":":smirk:",":o":":surprise:",":-o":":surprise:",":O":":surprise:",":-O":":surprise:",":-s":":worry:",":s":":worry:",":-S":":worry:",":S":":worry:","I-)":":sleepy:","|-)":":sleepy:",":-X":":keep-quiet:",":-x":":keep-quiet:",":-#":":keep-quiet:","(a)":":peace:","(A)":":peace:","O-)":":peace:","O:)":":peace:","O:-)":":peace:",":+1:":":thumbsup:","(y)":":thumbsup:","(Y)":":thumbsup:",":x-":":thumbsup:",":yes:":":thumbsup:",":agree:":":thumbsup:",":like:":":thumbsup:",":yes!:":":thumbsup!:",":agree!:":":thumbsup!:",":like!:":":thumbsup!:",":-1:":":thumbsdown:","(N)":":thumbsdown:","(n)":":thumbsdown:",":no:":":thumbsdown:",":disagree:":":thumbsdown:",":dislike:":":thumbsdown:",":no!:":":thumbsdown!:",":disagree!:":":thumbsdown!:",":dislike!:":":thumbsdown!:","B-)":":cool:",":xs":":love:",":-?":":thinking:","*-:)":":idea:","-_-":":relaxed:","D:":":anxious:","-.-":":stressed-out:","(=_=)":":tired:","?D":":doubt:","(6.6)":":faint:","(({..}))":":headache:","+o(":":sick:",":-{}":":feeling-cold:",":v:":":victory:","C(_)":":coffee-cup:",":down-arrow:":["disagree","-1","no","dislike"],":up-arrow:":["agree","+1","yes","like"],":white-heavy-check-mark:":["agree","+1","yes","like"],":cross-mark:":["disagree","-1","no","dislike"],":heavy-plus-sign:":["agree","+1","yes","like"],":heavy-minus-sign:":["disagree","-1","no","dislike"]},this.textcodes=["smile!","happy!","joy!","grinning!","cool!","love!","curious!","awe!","thinking!","search!","idea!","wink!","razz!","relaxed!","peace!","blush!","yummy!","yuck!","sad!","upset!","anxious!","worry!","stressed-out!","angry!","tensed!","tired!","bored!","sleepy!","jealous!","evil!","facepalm!","doubt!","surprise!","faint!","headache!","sick!","injured!","neutral!","smirk!","keep-quiet!","feeling-warm!","feeling-cold!","hi!","thumbsup!","thumbsdown!","namaste!","super!","victory!","yoyo!","raising-hand!","clap!","bye-bye!","fist!","biceps!","thumbsup-tone1","thumbsdown-tone1","namaste-tone1","super-tone1","victory-tone1","yoyo-tone1","raising-hand-tone1","clap-tone1","hi-tone1","bye-bye-tone1","fist-tone1","biceps-tone1","thumbsup-tone2","thumbsdown-tone2","namaste-tone2","super-tone2","victory-tone2","yoyo-tone2","raising-hand-tone2","clap-tone2","hi-tone2","bye-bye-tone2","fist-tone2","biceps-tone2","thumbsup-tone3","thumbsdown-tone3","namaste-tone3","super-tone3","victory-tone3","yoyo-tone3","raising-hand-tone3","clap-tone3","hi-tone3","bye-bye-tone3","fist-tone3","biceps-tone3","thumbsup-tone4","thumbsdown-tone4","namaste-tone4","super-tone4","victory-tone4","yoyo-tone4","raising-hand-tone4","clap-tone4","hi-tone4","bye-bye-tone4","fist-tone4","biceps-tone4","thumbsup-tone5","thumbsdown-tone5","namaste-tone5","super-tone5","victory-tone5","yoyo-tone5","raising-hand-tone5","clap-tone5","hi-tone5","bye-bye-tone5","fist-tone5","biceps-tone5","birthday!","champagne","chicken","chicken!","christmas-tree!","coffee-cup!","eid-mubarak!","fireworks!","food!","gift-box!","kaaba!","new-year!","party!","peanuts!","santa-hat!","fire!","fire-extinguisher","first-aid-box","medicine!","poop!","gold-medal","silver-medal","bronze-medal","archer","archer!","refugee-olympic-team","badminton!","baseball!","basketball!","boxer!","canoeing!","chess!","cricket!","discus-throw!","diver!","equestrian!","fencer!","flag!","foosball!","football!","golf","golf!","hammer-throw","high-jump!","hockey!","hurdler!","javelin-throw!","judo!","long-jump!","pole-vault!","athlete!","rhythmic-gymnastics!","shooter","shooter!","shotput-throw!","snooker!","table-tennis!","target","target!","tennis","tennis!","volleyball","volleyball!","weightlifting","weightlifting!","wrestling","wrestling!","badminton-player","badminton-player!","basketball-player","basketball-player!","batsman","batsman!","batter","batter!","bowler","break-boy","break-boy!","break-girl","break-girl!","chess-player","chess-player!","football-player","football-player!","female-tennis-player","female-tabletennis-player","female-volleyball-player","female-tennis-player!","female-tabletennis-player!","female-volleyball-player!","golfer","golfer!","gymnast","gymnast!","hockey-player","hockey-player!","karate","karate!","man-dancing","man-dancing!","man-cycling","man-cycling!","man-running","man-running!","man-swimming","man-swimming!","male-tabletennis-player","male-volleyball-player","male-tennis-player","male-tabletennis-player!","male-volleyball-player!","male-tennis-player!","pitcher","pitcher!","singing","singing!","snooker-player","snooker-player!","woman-dancing","woman-cycling","woman-running","woman-swimming","woman-dancing!","woman-cycling!","woman-running!","woman-swimming!","yoga","yoga!","bicycle","bicycle!","sports-bike","sports-bike!","cruiser-bike","cruiser-bike!","motor-scooter","motor-scooter!","car","car!","taxi","taxi!","bus","bus!","train","train!","police-car","police-car!","ambulance","ambulance!","fire-engine","fire-engine!","aeroplane","aeroplane!","passenger-ship","passenger-ship!","parking","cafeteria","bug","milestone","calendar","security","processor","laptop","server","garden","playground","home","office","library","auditorium","store","mail-room","pharmacy","task","report","gym","americas","europe-africa","asia-pacific","afghanistan","aland-islands","albania","algeria","american-samoa","andorra","angola","anguilla","antarctica","antigua-and-barbuda","argentina","armenia","aruba","australia","austria","azerbaijan","bahamas","bahrain","bangladesh","barbados","belarus","belgium","belize","benin","bermuda","bhutan","bolivia","bonaire","bosnia-and-herzegovina","botswana","brazil","british-antarctic","british-indian-ocean-territory","british-virgin","brunei-darussalam","bulgaria","burkina-faso","burundi","cambodia","cameroon","canada","cape-verde","cascadia","cayman-islands","central-african-republic","chad","chile","china","christmas-island","cocos","colombia","comoros","congo-kinshasa","congo","cook-islands","costa-rica","croatian","cuba","curacao","cyprus","czech-republic","denmark","djibouti","dominican-republic","east-timor","ecuador","egypt","el-salvador","england","equatorial-guinea","eritrea","estonia","ethiopia","european-union","yugoslavia","falkland-islands","faroe-islands","fiji","finland","france","french-polynesia","french-southern","gabon","gambia","georgia","germany","ghana","gibraltar","greece","greenland","grenada","guadeloupe","guam","guatemala","guernsey","guinea-bissau","guinea","guyana","haiti","honduras","hong-kong","hungary","iceland","india","indonesia","iran","iraq","ireland","isle-of-man","israel","italy","ivory-coast","jamaica","japan","jersey","jordan","kazakhstan","kenya","kiribati","kosovo","kuwait","kyrgyzstan","laos","latvia","lebanon","lesotho","liberia","libya","liechtenstein","lithuania","luxembourg","macau","macedonia","madagascar","malawi","malaysia","maldives","mali","malta","marshall-islands","martinique","mauritania","mauritius","mayotte","mexico","micronesia","moldova","monaco","mongolia","montenegro","montserrat","morocco","mozambique","myanmar","namibia","nauru","nepal","netherlands-antilles","netherlands","new-caledonia","new-zealand","nicaragua","niger","nigeria","niue","norfolk-island","north-korea","northern-ireland","northern-mariana","norway","oman","pakistan","palau","palestinian-territory","panama","papua-new-guinea","paraguay","peru","philippines","pitcairn","poland","portugal","puerto-rico","qatar","reunion","romania","russia","rwanda","saint-barthelemy","saint-helena","saint-kitts-and-nevis","saint-lucia","saint-pierre-and-miquelon","saint-vincent-and-the-grenadines","samoa","san-marino","sao-tome-and-principe","saudi-arabia","scotland","senegal","serbia","seychelles","sierra-leone","singapore","sint-eustatius","sint-maarten","slovakia","slovenia","solomon-islands","somalia","south-africa","south-georgia","south-korea","south-sudan","spain","sri-lanka","sudan","suriname","svalbard","swaziland","sweden","switzerland","syria","tahiti","taiwan","tajikistan","tanzania","thailand","timor-leste","togo","tokelau","tonga","trinidad-and-tobago","tunisia","turkey","turkmenistan","turks-and-caicos","tuvalu","uganda","ukraine","united-arab-emirates","united-kingdom","united-states-minor-outlying-islands","united-states","uruguay","uzbekistan","vanuatu","vatican-city","venezuela","vietnam","wales","wallis-and-futuna","yemen","zambia","zimbabwe"],"f"===this.type&&(this.textcodes=["smile!","happy!","joy!","grinning!","cool!","love!","curious!","awe!","thinking!","search!","idea!","wink!","razz!","relaxed!","peace!","blush!","yummy!","yuck!","sad!","upset!","anxious!","worry!","stressed-out!","angry!","tensed!","tired!","bored!","sleepy!","jealous!","evil!","facepalm!","doubt!","surprise!","faint!","headache!","sick!","injured!","neutral!","smirk!","keep-quiet!","feeling-warm!","feeling-cold!","hi!","thumbsup!","thumbsdown!","namaste!","super!","victory!","yoyo!","raising-hand!","clap!","bye-bye!","fist!","biceps!","birthday!","champagne","christmas-tree!","coffee-cup!","eid-mubarak!","fireworks!","food!","gift-box!","kaaba!","new-year!","party!","peanuts!","santa-hat!","fire!","medicine!","poop!","target!","badminton!","baseball!","basketball!","boxer!","canoeing!","chess!","cricket!","discus-throw!","diver!","equestrian!","fencer!","flag!","foosball!","football!","high-jump!","hockey!","hurdler!","javelin-throw!","judo!","long-jump!","pole-vault!","athlete!","rhythmic-gymnastics!","shooter","shotput-throw!","snooker!","table-tennis!"]),this.frequentsmileys={work:[":smile:",":happy:",":joy:",":love:",":thinking:",":surprise:",":thumbsup:",":thumbsdown:",":namaste:",":tensed:",":biceps:",":doubt:",":super:",":clap:",":fireworks:",":food:",":gift-box:"],emoji:[":grinning:",":blush:",":wink:",":stuck-out-tongue-winking-eye:",":flushed:",":sob:",":sweat-smile:",":scream:",":sunglasses:",":raised-hands:",":wave:",":house-with-garden:",":point-up-2:",":dancer:",":bouquet:",":round-pushpin:",":heavy-plus-sign:"],animated:[":smile!:",":happy!:",":joy!:",":love!:",":thinking!:",":surprise!:",":thumbsup!:",":thumbsdown!:",":namaste!:",":tensed!:",":biceps!:",":doubt!:",":super!:",":clap!:",":fireworks!:",":food!:",":gift-box!:"],customemoji:[],sticker:[]},this.textcodes_lookup={},this.textcodes.forEach(function(e){if(this.textcodes_lookup[":"+e.replace("!","")+":"]=$("smiley."+e.replace("!",""))?$("smiley."+e.replace("!","")).trim():$("smiley."+e.replace("!","")),"!"===e.charAt(e.length-1)&&!1===this.animation_disabled){var t=e.replace("!","");this.textcodes_lookup[":"+e+":"]=$("smiley."+t)?$("smiley."+t).trim():$("smiley."+t)}},this),this.smiley_lookup={},this.symbol_lookup)i in this.emoji_lookup||(this.smiley_lookup[i]=$("smiley."+this.symbol_lookup[i])?$("smiley."+this.symbol_lookup[i]).trim():$("smiley."+this.symbol_lookup[i]));for(var n in this.textcodes_lookup)this.smiley_lookup[n]=this.textcodes_lookup[n];var a="";for(var o in this.smiley_lookup)""!==a?a+="|"+o:a=o;a="("+(a=(a=a.replace(/\|-\)/g,"\\|-)")).replace(/[[\]()*+.?^]/g,function(e){return"\\"+e}))+")",this.smiley_regex=new RegExp("([ >\n]|^)"+a+"(?=[ <\n]|$)","g"),this.checkAndRemoveSkinToneCodes(),this.skintone_for_emoji={0:"",1:"#x1F3FB",2:"#x1F3FC",3:"#x1F3FD",4:"#x1F3FE",5:"#x1F3FF"},this.skintone_supported_unicode_emojis=[":baby:",":girl:",":boy:",":woman:",":man:",":older-woman:",":older-man:",":man-with-gua-pi-mao:",":man-with-turban:",":person-with-blond-hair:",":man-with-turban:",":person-shrug:",":cop:",":construction-worker:",":guardsman:",":detective:",":bride-in-veil:",":princess:",":santa:",":angel:",":bow:",":information-desk-person:",":no-good:",":ok-woman:",":raising-hand:",":person-with-pouting-face:",":person-frowning:",":haircut:",":massage:",":nail-care:",":dancer:",":levitating-man:",":walking:",":runner:",":couple:",":boys:",":girls:",":couplekiss:",":couple-with-heart:",":open-hands:",":raised-hands:",":clap:",":thumbs-up:",":thumbs-down:",":oncoming-fist:",":fist:",":sign-of-horns:",":ok-hand:",":point-left:",":point-right:",":point-up-2:",":point-down:",":middle-finger:",":raised-hand:",":splayed-fingers:",":crossed-fingers:",":vulcan-salute:",":wave:",":muscle:",":pray:",":ear:",":nose:"],this.skintone_supported_zomojis=[":thumbsup:",":thumbsdown:",":namaste:",":super:",":victory:",":yoyo:",":raising-hand:",":clap:",":hi:",":bye-bye:",":fist:",":biceps:"],this.initRecentSmileys()};si.prototype.checkAndRemoveSkinToneCodes=function(){for(var e in this.textcodes_lookup)e.match(/tone[1-5]/)&&null!=this.textcodes_lookup[e]&&(delete this.textcodes_lookup[e],delete this.smiley_lookup[e])},si.prototype.updateSmiley=function(e,t){if(null!=e){var s=e.selectionStart,i=e.value;i=i.substring(0,s);var n=this.smiley_lookup[t];-1<t.indexOf("!")&&(n=this.smiley_lookup[t]+"!"),ge.check("customemoji",t)&&(n=t.replace(/:/g,"")),""===i||i.endsWith(" ")||i.endsWith("\n")?-1==t.indexOf(":")?(n=t,e.value=i+n+" "+e.value.substring(s)):e.value=i+":"+n+": "+e.value.substring(s):-1==t.indexOf(":")?(n=t,e.value=i+" "+n+" "+e.value.substring(s)):e.value=i+" :"+n+": "+e.value.substring(s),oi(e,s+t.length+2,s+t.length+2)}},si.prototype._isAnimationCode=function(e){return-1!==e.indexOf("!:")},si.prototype._replacer=function(e,t,s,i){(s=s.replace(i,""))in this.symbol_lookup&&(s=this.symbol_lookup[s]);var n=this.smiley_lookup[this.removeTonePrefFromCode(s)];for(var a in this.textcodes_lookup)a==this.removeTonePrefFromCode(s)&&(n=a.replace(/:/g,""));var o=arguments[arguments.length-1],r=0!==(o=o&&o.trim()).replace(s,"").length,l=this.default_size;if(this._isAnimationCode(s)&&"f"===this.type){n=n.replace("!",""),l=this.animation_default_size,r&&(l=this.animation_along_text_size);var d=" title="+$("smiley."+n).trim();return e&&(d=""),e=!1,i+"<em"+d+" data-reaction="+s+" class='zomojianim-"+l+"-"+this.replaceSmileyNameForClass(s)+"'></em>"}var c=this.type;this._isAnimationCode(s)&&(c="f",n=n.replace("!",""));d=" title="+$("smiley."+n).trim();return e&&(d=""),r?l=this.along_text_size:t&&"w"!==c&&(l=48),e=!1,i+"<em"+d+" data-reaction="+s+" class='zomoji-"+c+"-"+l+"-"+this.replaceSmileyNameForClass(s)+"'></em>"},si.prototype.getSmileyLookup=function(e){var t={};if(e){for(var s in e=e.toLowerCase(),this.smiley_lookup)if((this.smiley_lookup[s].startsWith(":"+e)||-1<this.smiley_lookup[s].indexOf(e))&&s in this.symbol_lookup==!1)t[this.checkAndReplaceTonePrefCode(s)]=this.smiley_lookup[s];else if(s.startsWith(":"+e)&&s in this.symbol_lookup&&s in this.emoji_lookup==0){var i=this.symbol_lookup[s],n=$("smiley."+i.replace(/:/g,"")).trim();t[this.checkAndReplaceTonePrefCode(i)]=n}}else for(var a in this.textcodes_lookup)t[a=this.checkAndReplaceTonePrefCode(a)]=this.textcodes_lookup[a];return t},si.prototype.replace=function(e,t,s){return this.animation_disabled&&(e=e.replace(/:(.*?):/g,function(e){for(var t in this.smiley_lookup)if(t==e.replace(/!/g,""))return t;return e}.bind(this))),"string"==typeof e?e.replace(this.smiley_regex,this._replacer.bind(this,t,s)):e},si.prototype.getSmiley=function(e){var t=this.smiley_lookup[this.removeTonePrefFromCode(e)],s=this.default_size,i=this.type,n=e.replace("!","");return n=n.replace(/:/g,""),this._isAnimationCode(e)?k("em",{title:t=t.replace("!",""),"data-smileycode":e,class:"zomoji-"+(i="f")+"-"+(s=this.animation_default_size)+"-"+n}):k("em",{title:t,"data-smileycode":e,class:"zomoji-"+i+"-"+s+"-"+n})},si.prototype.replaceSmileyForHtml=function(e){var t=ge.replacer(/<em (?:.*?) data-reaction="(.*?)" (?:.*?)><\/em>/g,null,e,function(e,t){if(t.match(/tone[1-5]/))return t;for(var s in this.textcodes_lookup)if(t===s)return this.replaceCodeToText(s)}.bind(this));return t=ge.replacer(/<em (?:.*?) data-customemojicode="(.*?)" (?:.*?)><\/em>/g,null,t,function(e,t){return t}.bind(this))},si.prototype.replaceCodeToText=function(e){return e=-1<(e=e.replace(/:/g,"")).indexOf("!")?":"+$("smiley."+e.replace("!","")).trim()+"!:":":"+$("smiley."+(e=e.replace(/:/g,""))).trim()+":"},si.prototype.replaceTextToEnglishCodes=function(e){if(!this.smileycode_regex){var t="";for(var s in this.textcodes_lookup)""!==t?t+="|:"+this.textcodes_lookup[s]+":":t=":"+this.textcodes_lookup[s]+":",this.animation_disabled||(t+="|:"+this.textcodes_lookup[s]+"!:");this.smileycode_regex=new RegExp("("+t+")","g")}var i=function(e){for(var t in this.textcodes_lookup)if(!this.animation_disabled&&-1<e.indexOf("!")){if(this.textcodes_lookup[t]==e.replace(/:/g,"").replace("!","")&&-1<t.indexOf("!"))return this.checkAndReplaceTonePrefCode(t)}else if(this.textcodes_lookup[t]==e.replace(/:/g,"")&&-1===t.indexOf("!"))return this.checkAndReplaceTonePrefCode(t)}.bind(this);return e.replace(this.smileycode_regex,i)},si.prototype.getSmileyName=function(e){return e=this.removeTonePrefFromCode(e),this.smiley_lookup[e]},si.prototype.sortSmileys=function(e,t,s){var i=[];if(t){if(s)for(var n in this.symbol_lookup)if(n.startsWith(":"+t)&&n in this.emoji_lookup==0){var a=this.symbol_lookup[n];i.push(a)}for(var o in e)e[o].startsWith(t)&&-1===i.indexOf(o)&&i.push(o);for(var r in e)e[r].startsWith(t)||-1!==i.indexOf(r)||i.push(r)}else for(var l in e)i.push(l);return i},si.prototype.getEmojiLookup=function(e){var t={};if(e){for(var s in this.emoji_lookup)-1<s.indexOf(e)&&(t[s]=this.emoji_lookup[s]);for(var i in this.symbol_lookup)if(i in this.emoji_lookup)for(var n=this.symbol_lookup[i],a=0;a<n.length;a++)-1<n[a].indexOf(e)&&i in t==0&&(t[i]=this.emoji_lookup[i])}else t=this.emoji_lookup;return t},si.prototype.sortEmojis=function(e,t){var s=[];if(t){for(var i in e)if(i.startsWith(":"+t)&&s.push(i),i in this.symbol_lookup)for(var n=this.symbol_lookup[i],a=0;a<n.length;a++)n[a].startsWith(t)&&-1==s.indexOf(i)&&s.push(i);for(var o in e)o.startsWith(t)||-1!==s.indexOf(o)||s.push(o)}else for(var r in e)s.push(r);return s},si.prototype.getUnicode=function(e,t){for(var s="",i=0;i<this.emoji_lookup[e].length;i++)s+=Ui(parseInt(this.emoji_lookup[e][i].replace("#x",""),16));return this.checkAndReplaceEmojiToneCode(s,e,t)},si.prototype.getEmoji=function(e,t){var s=this.getUnicode(e,t);return k("span",{title:$("smiley."+e.replace(/:/g,"")).trim(),"data-smileycode":s},s)},si.prototype.initRecentSmileys=function(){H.get("zuid")&&(ve.getItem(H.get("zuid")+"_frequent_smileys")||ve.setItem(H.get("zuid")+"_frequent_smileys",this.replaceFrequentSmileySkinTone(this.frequentsmileys)))},si.prototype.getFrequentSmileys=function(){return this.initRecentSmileys(),ve.getItem(H.get("zuid")+"_frequent_smileys")||this.frequentsmileys},si.prototype.updateFrequentSmileysList=function(e,t){e=this.removeTonePrefFromCode(e);var s=this.getFrequentSmileys(),i=e,n=null;s[n=this.textcodes_lookup[e]?this._isAnimationCode(e)?"animated":"work":ge.check("customemoji",e)?(i=e,"customemoji"):(i=(i=this.getTextCodeFromUniCode(e))||":"+t+":","emoji")]||(s[n]=[]),-1<s[n].indexOf(i)?s[n].splice(s[n].indexOf(i),1):("sticker"==n&&5==s[n].length||"customemoji"==n&&10==s[n].length||"sticker"!=n&&"customemoji"!=n)&&s[n].pop(),s[n].unshift(i),ve.setItem(H.get("zuid")+"_frequent_smileys",s)},si.prototype.getTextCodeFromUniCode=function(e){var t=this.getEmojiLookup("");for(var s in t)if(this.getUnicode(s)==e)return s;return!1},si.prototype.checkAndReplaceTonePrefCode=function(e){e=e.trim();var t=H.get("emojiskintone");return 0<t&&-1<this.skintone_supported_zomojis.indexOf(e)&&(e=e.slice(0,-1)+"-tone"+t+":"),e},si.prototype.replaceSmileyNameForClass=function(e){return e.match(/tone[1-5]/)&&(e=this.checkAndReplaceTonePrefCode(e)),e.replace(/[:!]/g,"")},si.prototype.removeTonePrefFromCode=function(e){return e.replace(/-tone[1-5]/g,"")},si.prototype.replaceFrequentSmileySkinTone=function(e){var t={work:[],emoji:[],animated:[],customemoji:[],sticker:[]};for(var s in e)for(var i=e[s],n=0;n<i.length;n++)t[s].push(this.checkAndReplaceTonePrefCode(i[n]));return t},si.prototype.checkAndReplaceEmojiToneCode=function(e,t,s){var i=s||H.get("emojiskintone");return-1<this.skintone_supported_unicode_emojis.indexOf(t)&&0<parseInt(i)&&(e+=this.getSkinToneCodeForEmoji(parseInt(i))),e},si.prototype.getSkinToneCodeForEmoji=function(e){return Ui(parseInt(this.skintone_for_emoji[e].replace("#x",""),16))},si.prototype.getTextForSkinToneCode=function(e){return ge.replacer(this.smiley_regex,null,e,function(e,t){return e=e.replace(t,""),e=this.removeTonePrefFromCode(e),-1<this.skintone_supported_zomojis.indexOf(e)?t+this.replaceCodeToText(e):t+e}.bind(this))},si.prototype.isSkinToneSupported=function(){var e=!0;if("windows"===fn()){var t=window.navigator.userAgent;e=-1!==t.indexOf("Windows NT 10.0")||-1!==t.indexOf("Windows 10.0")}return e},si.prototype.replaceCustomEmoji=function(e){if(ge.check("customemoji",e))return ge.replacer(ge.regexes.customemoji,null,e,this.getCustomEmojiHTML.bind(this))},si.prototype.getCustomEmojiHTML=function(e){var t=e.replaceAll(/[:$!]/g,"").split("_"),s=t[0],i=t[1],n=t[2],a=t[3],o=t[4],r=!!e.endsWith("!$:");if(!(s&&i&&n&&null!=a&&""!=a&&o))return e;if(0==a)return":"+o+":";if(i!=_WMSAPPACCOUNTID)return'<em class="'+(r?"wms_stickermsg wms_crossorgsticker":"wms_customemojimsg wms_crossorgemoji")+'" title="'+$("customemoji.crossorgdesc")+'" ></em>';var l="v2/customemojisbykey/"+s+"/download";return r&&(l="v2/stickersbykey/"+s+"/download"),void 0!==WebMessanger&&WebMessanger.isUDSDownloadEnabled()&&(l=_DOWNLOADSERVERURL+"/webdownload?x-service=cliq_resources&event-id="+s+"&x-cli-msg="+encodeURI('{"x-cliq-resource-module":"custom_emojis"}')),Hs("<em class='{{emojiclass}}{{sizeclass}}' data-customemojicode='{{code}}' data-emojiname='{{name}}' title='{{name}}' data-originalemojisrc='{{orginalsrc}}'></em>",{orginalsrc:l,code:e,emojiclass:r?"wms_stickermsg":"wms_customemojimsg",name:o,sizeclass:"small"==this.customemoji_size?" wms_customemoji_small":""})},si.prototype.replaceCustomEmojiWithName=function(e){return ge.replacer(ge.regexes.customemoji,null,e,function(e){return":"+e.replaceAll(/[:$]/g,"").split("_")[-1]+":"})};var ii=null;function ni(e){var t=Math.floor(e/3600),s=Math.floor(e%3600/60),i=Math.floor(e%60),n=(s=s<10?"0"+s:s)+":"+(i=i<10?"0"+i:i);return 0<t&&(n=t+":"+s+":"+i),n}function ai(s,i,n,a){var o,r,l,d,c=0;a=a||{};function m(){c=!1===a.leading?0:(new Date).getTime(),o=null,d=s.apply(r,l),o||(r=l=null)}function e(){var e=(new Date).getTime();c||!1!==a.leading||(c=e);var t=n-(e-c);return r=i||this,l=arguments,t<=0||n<t?(o&&(clearTimeout(o),o=null),c=e,d=s.apply(r,l),o||(r=l=null)):o||!1===a.trailing||(o=setTimeout(m,t)),d}return e.cancel=function(){clearTimeout(o),c=0,o=r=l=null},e}function oi(e,t,s){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,s);else if(e.createTextRange){var i=e.createTextRange();i.collapse(!0),i.moveEnd("character",s),i.moveStart("character",t),i.select()}}function ri(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return JSON.stringify(e)===JSON.stringify({})}function li(e,t,s){var i=0,n=0;--t;for(var a=0;a<e.length;a++)if(":"==e.charAt(a)&&++i==t){n=a;break}var o=e.substring(0,n).split(":"),r=e.substring(n+1);return s?o.push(JSON.parse(r)):o.push(r),o}function di(e){return!(e&&0<e.trim().length)}function ci(){var e=WebMessanger.isGuestUser&&WebMessanger.isGuestUser()?H.get("GUEST_CHATCFCOOKIENAME"):H.get("CHATCFCOOKIENAME");return H.get("CHATCFPARAMNAME")+"="+me(e)}function mi(e){var t={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"};return(""+e).replace(/[&><"']/g,function(e){return t[e]})}function ui(e){if(e)return e.replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&amp;/g,"&").replace(/&#x2F;/g,"/").replace(/&#x27;/g,"'")}function pi(e){return!isNaN(e)}function hi(e,t,s){var i=t;return null!=e&&null!=e&&""!=e||(i=t),pi(e)||(i=t),t||H.get("zuid")!=e||(i=$("chat.you")),e&&null!=ss(e)&&!ri(ss(e))?i=ss(e).DNAME||ss(e).EMAILID:e&&Pe(e)&&!ri(Pe(e))?i=Pe(e).DNAME:e&&Bt(e)&&!ri(Bt(e))&&(i=Bt(e).DNAME),!1===s?i:i?mi(i):void 0}function gi(o,l,e){if(!(!o.meta||!o.meta.mentions)){var r=o.meta;o=e?o.translation:o.msg||o.comment;var t=function(e){var t=r.mentions[e],s="";if(3===t.type)s=new RegExp("{#"+t.id+"}"),o=o.replace(s,t.name);else if(2===t.type)s=new RegExp("{@G"+t.id+"}"),o=o.replace(s,t.name);else if(1===t.type||4===t.type){var i=t.action?"{\\"+t.action+"@"+t.id+"}":"{@"+t.id+"}",n=H.get("zuid")==t.id?mi(ui(H.get("dname"))):hi(t.id,t.name,!0);s=new RegExp(i,"g");var a=t.action?t.action:"@";o=o.replace(s,function(){return l?a+n:'<span class="wms-atmtnlink" '+("1"==t.type||"4"==t.type?'data-zcprofileid="'+t.id+'"':"")+">"+a+n+"</span>"})}else t.type!==$WC.CMsgUtil.SpecialMention.participants&&t.type!==$WC.CMsgUtil.SpecialMention.available&&t.type!==$WC.CMsgUtil.OldMention||(s=new RegExp("{@"+t.id+"}"),o=o.replace(s,function(){return l?"@"+t.name:"<span data-mentiontype="+t.type+' class="wms-atmtnlink">@'+t.name+"</span>"}))};for(var s in r.mentions)t(s)}function i(e,r){o="silentmention"===e?H.get("getSilentUserMention")(o):ge.replace(e,o,function(e,t,s){var i=s.split(":")[1],n=s.split(":")[3],a=s.split(":")[2],o=H.get("zuid")==i?mi(ui(H.get("dname"))):hi(i,n,!0);return l?r+o:'<span class="wms-atmtnlink" '+("1"==a||"4"==a?'data-zcprofileid="'+i+'"':"")+">"+r+o+"</span>"})}return i("atmention_for_transcript","@"),i("addmember_for_transcript","+"),i("silentmention"),o}function fi(e){if(e)return"&nocache="+(new Date).getTime();var t="";return null!=H.get("WMSCFPARAMNAME")&&(t="&"+H.get("WMSCFPARAMNAME")+"="+me(H.get("_WMSCFCOOKIENAME"))),t+="&nocache="+(new Date).getTime()}function Ci(t,s,i,n){var a=i?function(e){return e[n]?i(e[n]):i(e[t])}:function(e){return!e[n]||e[t]>e[n]?e[t]:e[n]};return s=s?-1:1,function(e,t){return e=a(e),t=a(t),s*((t<e)-(e<t))}}function vi(){var n=Array.prototype.slice.call(arguments);return function(e,t){for(var s=0;s<n.length;s++){var i=n[s](e,t);if(0!=i)return i}return 0}}function bi(e){if("object"==typeof e){if(Object&&Object.keys)return Object.keys(e).length;var t=0;for(var s in e)t++;return t}}var yi,_i,Wi,Si={};function wi(e,t){return t?Mi(!0,{},e):Mi({},e)}function Mi(){var e,t,s,i,n,a,o,r=arguments,l=arguments[0]||{},d=1,c=arguments.length,m=!1;function u(e){return e instanceof Array}function p(e){return"object"==typeof e&&e.constructor==Object}for("boolean"==typeof l&&(m=l,l=arguments[d]||{},d++),"object"!=typeof l&&("function"!=typeof(o=l)||o.constructor!==Function)&&(l={}),d===c&&(l=this,d--);d<c;d++)if(null!=(n=r[d]))for(i in n)e=l[i],l!==(s=n[i])&&(m&&s&&(p(s)||(t=u(s)))?(a=t?(t=!1,e&&u(e)?e:[]):e&&p(e)?e:{},l[i]=Mi(m,a,s)):null!=s&&(l[i]=s));return l}function Ii(e,t,s){var i=t.getBoundingClientRect().top,n=t.getBoundingClientRect().bottom,a=e.getBoundingClientRect().top,o=e.getBoundingClientRect().bottom;return!(0===i&&0===n||0===a&&0===o)&&(s?i<=o&&a<=n:i<=a&&o<=n)}function Ti(e){return null==e||""===e}function Ai(e){return e==H.get("zuid")}function Ei(e){return e?e.target:window.event.srcElement}_i={},Wi=-1,(yi=Si).subscribe=function(e,t){_i[e]||(_i[e]=[]);var s=(++Wi).toString();return _i[e].push({token:s,func:t}),s},yi.publish=function(){var s=arguments,i=s[0];return!!_i[i]&&(setTimeout(function(){for(var e=_i[i],t=e?e.length:0;t--;)e[t].func.apply(null,s)},0),!0)},yi.unsubscribe=function(e){for(var t in _i)if(_i[t])for(var s=0,i=_i[t].length;s<i;s++)if(_i[t][s].token===e)return _i[t].splice(s,1),e;return!1};var Ui=String.fromCodePoint?String.fromCodePoint:function(e){for(var t=arguments,s=String.fromCharCode,i=[],n="",a=0,o=arguments.length;a!==o;++a){var r=+t[a];if(!(r<1114111&&r>>>0===r))throw RangeError("Invalid code point: "+r);16383<=(r<=65535?i.push(r):(r-=65536,i.push(55296+(r>>10),r%1024+56320)))&&(n+=s.apply(null,i),i.length=0)}return n+s.apply(null,i)};function xi(e,t,s,i,n){var a;"height"===t&&(a=s<i?function(){(s+=20)<=i?(e.style[t]=s+"px",window.requestAnimationFrame(a)):(e.style[t]=i+"px","function"==typeof n&&n())}:function(){i<=(s-=20)?(e.style[t]=s+"px",window.requestAnimationFrame(a)):(e.style[t]=i+"px","function"==typeof n&&n())}),a()}function Ni(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;").replace(/&amp;quot;/g,"&quot;").replace(/&amp;gt;/g,"&gt;").replace(/&amp;lt;/g,"&lt;").replace(/&amp;#x27;/g,"&#x27;").replace(/&amp;#x2F;/g,"&#x2F;").replace(/&amp;amp;/g,"&amp;"):e}function ki(e,t,s){var i,n,a,o,r=e.getBoundingClientRect();a=window.innerWidth-(r.left+e.offsetWidth),o=window.innerHeight-t.offsetHeight-21,n=a>t.offsetWidth?r.left+e.offsetWidth:r.left-t.offsetWidth,n=s?n+parseInt(s):n,i=r.top+e.offsetHeight/2-t.offsetHeight/2,i=Math.min(o,i),i=Math.max(45,i),t.style.top=i+"px",t.style.left=n+"px"}function Oi(e,t,s,i,n){var a=document.createElement(e);if(s&&(a.className=s),t&&(a.id=t),n&&(a.innerHTML=n),i)for(var o in i)a.setAttribute(o,i[o]);return a}function Ri(e,t,s,i,n){i="boolean"!=typeof i||i;function a(e){s.call(this,e,n)}return e.addEventListener?e.addEventListener(t,a,i):e.attachEvent?e.attachEvent("on"+t,a):e["on"+t]=a,a}function Hi(t,e,s){var i=null,n=(e=e||{})&&e.block;(s=s||t.parentnode)&&(i="center"===n?t.offsetTop-s.offsetHeight/2+t.clientHeight/2:"end"===n?t.offsetTop-(s.offsetHeight-t.offsetHeight):t.offsetTop,e.top=i,e.left=0,setTimeout(function(){try{s.scrollTo(e)}catch(e){tn(t,null,!1,s,n)}},30))}function $i(e){var t=e.split("_",3);if(3==t.length){var s=t[2],i=s.split("-",2);if(-1!=s.indexOf("-T-"))return He.CHATTYPES.THREAD;if(2==i.length)return"C4"==i[1]?He.CHATTYPES.CHANNEL:i[1];if(1==i.length)return He.CHATTYPES.CHANNEL}}function Di(e){return e&&$i(e)===He.CHATTYPES.CHANNEL}function Li(e){return e&&$i(e)===He.CHATTYPES.THREAD}function Pi(e){var t=$i(e);return t===He.CHATTYPES.DEFAULT_BOT||t===He.CHATTYPES.CUSTOM_BOT}function Bi(s,i,n,a){var o,r=0;return function(){var e=arguments,t=i||this;!0===a?(Date.now()-r>n&&s.apply(t,e),r=Date.now()):(clearTimeout(o),o=setTimeout(function(){s.apply(t,e)},n))}}function ji(e){return Array.prototype.slice.call(e,0)}function Fi(e){if(e)return e.parentNode.removeChild(e)}function zi(e,t){e.classList?e.classList.add(t):-1===e.className.split(" ").indexOf(t)&&(e.className+=" "+t)}function Gi(e,t){if(e.classList)e.classList.remove(t);else{var s=new RegExp("(?:^|\\s)"+t+"(?!\\S)");e.className=e.className.replace(s,"")}}function qi(e,t,s){if(e&&"function"==typeof e.getAttribute)return e.setAttribute(t,s)}function Yi(e,s,t){var i=e&&e.querySelectorAll("div[data-originalsrc]");function n(){if(this.existingnode&&this.existingnode.parentNode&&(!s||this.existingnode.getAttribute("data-imgid")===this.getAttribute("data-zcprofileid"))){s?this.existingnode.parentNode.insertBefore(this,this.existingnode.parentNode.firstChild):this.existingnode.parentNode.querySelector("[data-cutouticon]")?this.existingnode.parentNode.insertBefore(this,this.existingnode.parentNode.querySelector("[data-cutouticon]")):this.existingnode.parentNode.appendChild(this);var e=this;setTimeout(function(){e.style.opacity="1",e.existingnode.removeAttribute("data-originalsrc"),s&&Fi(e.existingnode)},20)}var t;t=this.existingnode.getAttribute("data-imgid")||this.existingnode.getAttribute("data-channelimgid"),Vi[t]=!0}for(var a in i)if(i.hasOwnProperty(a)&&(t||Ii(i[a],e,!0))){var o=i[a],r=new Image;o.getAttribute("data-imgid")&&r.setAttribute("data-zcprofileid",o.getAttribute("data-imgid")),r.className="wms_userphoto_trans",r.existingnode=o,r.onload=n,r.src=o.getAttribute("data-originalsrc")}"function"==typeof WMSUI&&WMSUI.checkAndLoadCustomEmojis(e)}var Vi={};function Zi(e){return Vi[e]}function Ki(e){return"[object Array]"===Object.prototype.toString.call(e)}function Xi(e){if(e)return document.getElementsByTagName("body")[0].textContent?e.textContent:e.innerText}function Ji(e,t){var s=e.closest(t);return s||!1}function Qi(e,t){var s=[];if(t)for(var i=e.split(new RegExp("("+ge.replace("escaperegexp",t)+"+)","i")),n=0;n<i.length;n++)s.push(-1<i[n].toLowerCase().indexOf(t.toLowerCase())?k("b",null,i[n]):i[n]);return 0<s.length?s:e}function en(e,t,s){if(s=s||e.parentNode,t){var i=s.scrollLeft,n=s.scrollLeft+s.offsetWidth,a=e.offsetLeft+e.offsetWidth;if(e.offsetLeft>=i&&a<n)return!0}else{var o=s.scrollTop,r=s.scrollTop+s.offsetHeight,l=e.offsetTop+e.offsetHeight;if(e.offsetTop>=o&&l<r)return!0}return!1}function tn(e,t,s,i,n){var a,o,r;i=i||e.parentNode,t=t||(a=i,o=e.getBoundingClientRect(),r=a.getBoundingClientRect(),o.y-r.y+o.height>r.height?He.KEYCODES.DOWN:o.y<r.y?He.KEYCODES.UP:void 0),s?!1===en(e,!0,i)&&(t===$WC.WmsConstants.KEYCODES.LEFT?i.scrollLeft=e.offsetLeft:t===$WC.WmsConstants.KEYCODES.RIGHT&&(i.scrollLeft=e.offsetLeft+e.offsetWidth-i.offsetWidth)):!1===en(e,null,i)&&(t===He.KEYCODES.UP?i.scrollTop="center"===n?e.offsetTop-i.clientHeight/2+e.clientHeight/2:"end"===n?e.offsetTop-i.clientHeight+e.clientHeight:e.offsetTop:t!==He.KEYCODES.DOWN&&t!==He.KEYCODES.LEFT&&t!==He.KEYCODES.RIGHT||(i.scrollTop="center"===n?e.offsetTop-i.clientHeight/2+e.clientHeight/2:"end"===n?e.offsetTop-i.clientHeight+e.clientHeight:e.offsetTop+e.offsetHeight-i.offsetHeight))}function sn(e){var t=e;return(e=Math.round(t/1024))?e<1024?e+" KB":Math.round(e/1024)+" MB":t+" bytes"}function nn(e,t){if(e){for(var s=0,i=0;i<e.length;i++)s+=e[i].size;return t<s?(WmsUIImpl.showFilesizeExceedAlert(s)||alert($("upload.maxsize.exceed")),!0):!1}}function an(e){return e instanceof File}var on=null;function rn(e,t){var s=Oi("DIV","wms-errormsg","wms-errormsg",null,("info"==t?'<span class="wms_infomsgicon"><em class="wms_hintanim"></em></span>':'<span class="wms_errormsgicon"></span>')+"<span>"+(ii=ii||new si({default_size:"24",animation:{default_size:"24"}})).replace(mi(ui(e)))+"</span><span class='wms-errorclosecnt'><span class='wms-errorcloseicon' data-errorcloseicon='true'></span></span>");s.style.zIndex=WebMessanger.setzindex<=9999?9999:WebMessanger.setzindex,ln(!0),document.body.appendChild(s),s.querySelector("[data-errorcloseicon]").onclick=ln,on=setTimeout(function(){ln()},5e3)}function ln(e){if(dn("wms-errormsg")){clearTimeout(on);var t=document.getElementById("wms-errormsg");e?t.parentNode.removeChild(t):(t.className+=" wms_errormsg_slideup",setTimeout(function(e){e.parentNode.removeChild(e)}.bind(this,t),1e3))}}function dn(e){return null!=document.getElementById(e)}function cn(e,t,s){for(var i=[],n=[],a=0;a<e.length;a++)e[a][s].toLowerCase().startsWith(t)?i.push(e[a]):-1<e[a][s].toLowerCase().indexOf(t)&&n.push(e[a]);return i.concat(n)}function mn(){return WmsSettings.adminsettings.hidden_chatlets_product&&"0"!=WmsSettings.adminsettings.hidden_chatlets_product?WmsSettings.adminsettings.hidden_chatlets_product:null}function un(e){var t=mn();if(t&&e)for(var s=t.split(","),i=0;i<s.length;i++)if("-1"!=e.indexOf(s[i]))return!0;return!1}function pn(){return"undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||(!("undefined"==typeof process||"object"!=typeof process.versions||!process.versions.electron)||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&0<=navigator.userAgent.indexOf("Electron"))}function hn(e){return 0!=e.indexOf("http")&&(e=window.location.origin+e),!("undefined"==typeof electron||!electron.remote||!electron.remote.getCurrentWebContents())&&(electron.remote.getCurrentWebContents().downloadURL(e),!0)}function gn(s){return s.filter(function(e,t){return s.indexOf(e)===t})}function fn(){var e=window.navigator.userAgent,t=window.navigator.platform,s=null;return-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(t)?s="Mac":-1!==["iPhone","iPad","iPod"].indexOf(t)?s="iOS":-1!==["Win32","Win64","Windows","WinCE"].indexOf(t)?s="Windows":/Android/.test(e)?s="Android":!s&&/Linux/.test(t)&&(s="Linux"),s.toLowerCase()}function Cn(e,t){for(var s=0;s<e.length;s++)for(var i in e[s])if(e[s][i]==t)return s;return-1}function vn(e,t){var s=Cn(e,t);return-1<s&&e.splice(s,1),e}function bn(e,t,s){var i=Cn(e,s);return-1<i?e[i]=t:e.push(t),e}function yn(){return void 0!==WebMessanger&&"456089"==WebMessanger.orgid&&void 0!==WmsSettings&&"us"==WmsSettings.adminsettings.service_configurations.dc}function _n(){this.instance=null}var Wn=Object.freeze({__proto__:null,formatSecondsToHHMM:ni,throttle:ai,moveCaretPosition:oi,isEmptyObject:ri,splitWmsFormattedString:li,isEmptyString:di,getCSRF:ci,safeHTML:mi,unescapeHTML:ui,isZuid:pi,getContactName:hi,formatMentions:gi,constructTranscriptLoadButton:function(e,t){return t=t||!0,'<div class="wms-loadmorebutton-wrapper" data-loadmorebutton="true"><div class="wms-loadmorebutton" data-prev-msgtime="'+(e=e||!0)+'">'+$WC.I18N("chat.messages.loadbelow")+'</div><div class="wms-loadmorebutton-line"></div><div class="wms-loadmorebutton" data-next-msgtime="'+t+'">'+$WC.I18N("chat.messages.loadabove")+"</div></div>"},nocachefix:fi,removeElementFromArray:function(e,t){var s=e.indexOf(t);-1!==s&&e.splice(s,1)},sortBy:Ci,compositeComparator:vi,getObjectLength:bi,pubsub:Si,cloneObject:wi,extend:Mi,isScrolledIntoView:Ii,isEmpty:Ti,isLocalUser:Ai,getEventTarget:Ei,fromCodePoint:Ui,animate:xi,toggle:function(e){"block"==e.style.display?e.style.display="none":e.style.display="block"},checkSessionConfig:function(e){return(_WMSCONFIG&WMSSessionConfig[e])===WMSSessionConfig[e]},escapeHTML:Ni,getCssAnimEndListener:function(){var e="Webkit Moz O ms".split(" "),t={noprefix:"animationend",Moz:"animationend",Webkit:"webkitAnimationEnd",O:"oAnimationEnd",ms:"MSAnimationEnd"};if(void 0!==document.body.style.animationName)return t.noprefix;for(var s=0;s<e.length;s++)if(void 0!==document.body.style[e[s]+"AnimationName"])return t[e[s]]},addMultipleListeners:function(e,t,s,i,n){for(var a=function(e){s.call(this,e,n)},o=0;o<t.length;o++)Ri(e,t[o],a,i)},indexOf:function(e,t){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(e,t);for(var s=0;s<e.length;s++)if(t===e[s])return s;return-1},positionElement:ki,createElement:Oi,consoleWarn:function(e){yn()&&"undefined"!=typeof console&&console.warn&&console.warn(e)},getUnfurlableLink:function(e){for(var t=this.decodeHTMLEntities(e).split(/\s+/g),s=[],i=0;i<t.length;i++){var n=t[i].trim();if(ge.checkWithFlag("linkRegExp",n,"gi")){if($WC.Matcher.match("linkRegExp",n,"gi")[0]!=n)continue;s.push(n)}}return s},decodeHTMLEntities:function(e){return e.replace(/&#x2F;/g,"/").replace(/&#39;|&#x27;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")},addEvent:Ri,scrollIntoView:function(t,e){var s=!(!e||"end"==e.block);setTimeout(function(){try{t.scrollIntoView(e)}catch(e){t.scrollIntoView(s)}},30)},scrollTo:Hi,getChatType:$i,isChannelChid:Di,isThreadChid:Li,isBotChid:Pi,isCustomBot:function(e){return $i(e)===He.CHATTYPES.CUSTOM_BOT},debounce:Bi,convertToArray:ji,removeElement:Fi,addClass:zi,removeClass:Gi,setAttribute:qi,loadOriginalImage:Yi,isImageLazyLoaded:Zi,loadImageWithDebounce:function(e){return Bi(function(){Yi(e)},null,100)},isArray:Ki,getInnerText:Xi,findParent:Ji,boldMatchedString:Qi,isViewableInScroll:en,bringElemToView:tn,getFileSize:sn,isFilesizeExceeded:nn,isFile:an,showErrorMsg:rn,hideErrorMsg:ln,isBannerShown:dn,filterList:cn,hexToRGB:function(e){return((e=e.replace("#","0x"))>>16&255)+","+(e>>8&255)+","+(255&e)},getAdjacentNode:function(e,t,s){for(;(e=e&&(t?e.previousSibling:e.nextSibling))&&!e.getAttribute(s););return e},isMacOS:function(){return-1!=navigator.appVersion.indexOf("Mac")},isMacOSMojaveOrOlder:function(){var e=navigator.userAgent.match(/Mac\sOS\sX\s10(.|_)(7|8|9|10|11|12|13|14)/);return!Ti(e)&&e.length},isWindowsOS:function(){return-1!==["Win32","Win64","Windows","WinCE"].indexOf(navigator.platform)},getChatletHiddenPrd:mn,checkIfChatletHidden:un,isElectron:pn,triggerDownloadInDesktopApp:hn,copyTextToClipboard:function(e,t){var s='<textarea id="wms_copyhidden" style="display:block;">'+e+"</textarea>";t.insertAdjacentHTML("afterend",s),document.getElementById("wms_copyhidden").select(),document.execCommand("copy"),t.parentElement.removeChild(document.getElementById("wms_copyhidden"))},removeDuplicatesFromArray:gn,getOS:fn,findIndexByObjectValue:Cn,removeItemFromListByValue:vn,updateItemInListByValue:bn,isBetaOrg:yn}),Sn=function(s){function e(e){s.call(this,e);var t=e.placeholder||new Date;this.datepicickernode=null,e.presetdate&&re(e.presetdate)&&(t=new Date(e.presetdate)),this.state={calendarvisible:!1,selecteddate:t,mountedtop:null},this.mountCalendar=this.mountCalendar.bind(this),this.onDateSelection=this.onDateSelection.bind(this),this.onDateSelectionCallBack=this.props.onDateSelection.bind(this),this.setDatepickerNode=this.setDatepickerNode.bind(this),this.onClickOutside=this.onClickOutside.bind(this),this.clearValue=this.clearValue.bind(this)}return s&&(e.__proto__=s),((e.prototype=Object.create(s&&s.prototype)).constructor=e).prototype.updateDate=function(e){this.setState({selecteddate:new Date(e)})},e.prototype.setDatepickerNode=function(e){this.datepickernode=e},e.prototype.mountCalendar=function(e){if("keydown"==e.type&&13==e.keyCode||"click"==e.type){var t=!1;if(this.datepickernode.getBoundingClientRect().bottom+250>window.innerHeight)t=!0;else if(this.props.mountedviaforms&&this.datepickernode){var s=Ji(this.datepickernode,"[data-dialogwrapper=true]");this.datepickernode.offsetParent.offsetParent.offsetTop-s.scrollTop+s.offsetTop+this.datepickernode.offsetParent.offsetParent.offsetHeight+200>s.offsetHeight&&(t=!0)}this.setState({calendarvisible:!this.state.calendarvisible,mountedtop:t})}},e.prototype.onDateSelection=function(e){this.onDateSelectionCallBack(e),this.setState({selecteddate:e,calendarvisible:!this.state.calendarvisible})},e.prototype.onClickOutside=function(){this.setState({calendarvisible:!1})},e.prototype.clearValue=function(e){this.setState({selecteddate:this.props.placeholder}),this.onDateSelectionCallBack(null),e.stopPropagation(),e.preventDefault()},e.prototype.render=function(e,t){var s="",i=ne(t.selecteddate),n=Y,a=t.selecteddate,o="disable"==this.props.status?"-1":"0",r=k(R,{tabindex:o,classname:J,type:"icon",content:"e9ee",onclick:this.clearValue});e.placeholder==t.selecteddate&&(i=t.selecteddate,n=V,a=new Date,r=null),t.mountedtop&&t.calendarvisible?s=G:!1===t.mountedtop&&t.calendarvisible&&(s=z);var l=e.mountedviaforms?X:"",d=e.mountedviaforms?K:Z,c=k("div",{class:q+" "+l,key:"calendarview"},k(L,{onDateSelection:this.onDateSelection,selecteddate:a,mounttop:t.mountedtop}));return k(Q,{onClickOutside:this.onClickOutside},k("div",{tabindex:o,onkeydown:this.mountCalendar,class:j},t.mountedtop&&t.calendarvisible&&c,k("div",{ref:this.setDatepickerNode,key:"datepickerview",class:F+" "+s,onclick:this.mountCalendar},k("span",{class:n},i),r,k("span",{class:d})),!1===t.mountedtop&&t.calendarvisible&&c))},e}(M);_n.prototype.mountComponent=function(e,t,s){this.node=e,O(k(Sn,{ref:function(e){this.instance=e}.bind(this),onDateSelection:s,presetdate:t}),e)},_n.prototype.unmountComponent=function(){O("",this.node)},_n.prototype.updateDate=function(e){this.instance.updateDate(e)};function wn(){this.unmountComponent=this.unmountComponent.bind(this),this.handleCustomNavigation=this.handleCustomNavigation.bind(this)}var Mn={zomojiContainer:"mc854d52f3_zomojiContainer",searchcontainer:"mc854d52f3_searchcontainer",searchBox:"mc854d52f3_searchBox",smileycnt:"mc854d52f3_smileycnt",smileycntlive:"mc854d52f3_smileycntlive",stickercnt:"mc854d52f3_stickercnt",smileywithtext:"mc854d52f3_smileywithtext",smileyContainer:"mc854d52f3_smileyContainer",toggler:"mc854d52f3_toggler",zmNightMode:"zmNightMode",zomoji:"mc854d52f3_zomoji",livezomoji:"mc854d52f3_livezomoji",frequentzomoji:"mc854d52f3_frequentzomoji",customemoji:"mc854d52f3_customemoji",sticker:"mc854d52f3_sticker",emptysearchcontainer:"mc854d52f3_emptysearchcontainer",emojitonedisplay:"mc854d52f3_emojitonedisplay",toneitem:"mc854d52f3_toneitem",unsupported:"mc854d52f3_unsupported",loadinggif_cont:"mc854d52f3_loadinggif_cont",header:"mc854d52f3_header",togglertop:"mc854d52f3_togglertop",livezomojiicon:"mc854d52f3_livezomojiicon",row:"mc854d52f3_row",rowlast:"mc854d52f3_rowlast",selectedsmiley:"mc854d52f3_selectedsmiley",emoji:"mc854d52f3_emoji",emojiwithouttext:"mc854d52f3_emojiwithouttext",emptysearchemoji:"mc854d52f3_emptysearchemoji",emptysearchtext:"mc854d52f3_emptysearchtext",elementstitle:"mc854d52f3_elementstitle",containerspacing:"mc854d52f3_containerspacing",autocompleteheight:"mc854d52f3_autocompleteheight","wms-rtl":"wms-rtl",tonepickercontainer:"mc854d52f3_tonepickercontainer",tones:"mc854d52f3_tones",tonelabel:"mc854d52f3_tonelabel",selectedtone:"mc854d52f3_selectedtone",loadinggif:"mc854d52f3_loadinggif"},In={},Tn=function(n){function e(e){n.call(this,e),this.autocompleteenabled=e.config&&e.config.autocomplete;var t={default_size:"24",animation:{default_size:e.config&&e.config.showEmojiWithText?"24":"48"}};this.getSmileyCode=this.getSmileyCode.bind(this),this.searchSmiley=this.searchSmiley.bind(this),this.setZomojiNode=this.setZomojiNode.bind(this),this.displayZomoji=this.displayZomoji.bind(this),this.closeZomojiComponent=this.closeZomojiComponent.bind(this),this.displayLiveZomoji=this.displayLiveZomoji.bind(this),this.selectSmiley=this.selectSmiley.bind(this),this.setSmileyPosition=this.setSmileyPosition.bind(this),this.displayEmoji=this.displayEmoji.bind(this),this.storeSearchNode=this.storeSearchNode.bind(this),this.storeSmileysContainer=this.storeSmileysContainer.bind(this),this.displayFrequentEmojis=this.displayFrequentEmojis.bind(this),this.addAnimationClass=this.addAnimationClass.bind(this),this.removeAnimationClass=this.removeAnimationClass.bind(this),this.updateSkinTone=this.updateSkinTone.bind(this),this.displayCustomEmoji=this.displayCustomEmoji.bind(this),this.displaySticker=this.displaySticker.bind(this),this.fetchStickers=Bi(zs,this,300),this.rearrangeSmileysOnResize=Bi(this.rearrangeSmileysOnResize,this,300),this.getNextPageForCustomEmojis=Bi(this.getNextPageForCustomEmojis,this,50),this.zm=new si(t);var s=this.props.config&&this.props.config.searchterm?this.props.config.searchterm:"",i=this.getSmileysForSelectedPane(s,this.getFrequentSmileyTab());this.state={smileyvalue:s,smileycodes:i,currentpane:this.getFrequentSmileyTab(),emojiloading:!1,containerwidth:300,currentsmileyposition:{row:0,column:0}}}return n&&(e.__proto__=n),((e.prototype=Object.create(n&&n.prototype)).constructor=e).prototype.componentDidUpdate=function(){var e=this.zomojinode.querySelector("div[data-selected=true]");e&&!Ii(e,this.smileycontainernode,!1)&&(this.avoidscroll?setTimeout(function(){this.avoidscroll=!1}.bind(this)):Hi(e,null,this.smileycontainernode))},e.prototype.componentDidMount=function(){if(this.autocompleteenabled&&this.checkEmptyResultSet(this.state.smileycodes,this.state.currentpane))return void this.props.closeComponent();this.setSmileyPosition(),this.searchnode&&this.searchnode.focus(),window.addEventListener("resize",this.rearrangeSmileysOnResize)},e.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.rearrangeSmileysOnResize)},e.prototype.rearrangeSmileysOnResize=function(){this.setState({containerwidth:this.zomojinode.offsetWidth-7})},e.prototype.switchTabs=function(e){var t=["frequentemoji","livezomoji","zomoji","emoji"].indexOf(this.state.currentpane);switch(e.shiftKey?t--:t++,3<t&&(t=0),t<0&&(t=3),t){case 0:this.displayFrequentEmojis(e);break;case 1:this.displayLiveZomoji(e);break;case 2:this.displayZomoji(e);break;case 3:this.displayEmoji(e)}e.stopPropagation(),e.preventDefault()},e.prototype.updateSearchTermFromComposer=function(e){this.searchSmiley(null,e)},e.prototype.storeSearchNode=function(e){this.searchnode=e},e.prototype.storeSmileysContainer=function(e){this.smileycontainernode=e},e.prototype.getFrequentSmileyTab=function(){if(this.autocompleteenabled)return"frequentemoji";ve.getItem(H.get("zuid")+"_frequentsmileytab")||this.setFrequentSmileyTab("frequentemoji");var e=ve.getItem(H.get("zuid")+"_frequentsmileytab")||"frequentemoji";return("sticker"==e&&this.props.config.hidestickers||"customemoji"==e&&this.props.config.hidecustomemoji)&&(e="frequentemoji"),e},e.prototype.setFrequentSmileyTab=function(e){ve.setItem(H.get("zuid")+"_frequentsmileytab",e)},e.prototype.getDefaultSmileyCodePositions=function(e){var t=0;return"frequentemoji"==(e=e||this.state.currentpane)&&(t=1),{row:t,column:0}},e.prototype.setSmileyPosition=function(){this.setState({currentsmileyposition:this.getDefaultSmileyCodePositions(),containerwidth:this.zomojinode.offsetWidth-7})},e.prototype.selectSmiley=function(e){var t=this.state.currentsmileyposition.row,s=this.state.currentsmileyposition.column,i=this.populateSmiley();switch(e.keyCode){case 39:s++,e.preventDefault();break;case 37:s--,e.preventDefault();break;case 38:t--;break;case 40:t++;break;case 13:if(this.smileycodepositions[t][s]){var n=this.zm.removeTonePrefFromCode(this.smileycodepositions[t][s]),a=i[t].props.children[s].props.children[0].props.title;this.zm.updateFrequentSmileysList(n,a),this.props.getSmileyCode(n,e,this.state.currentpane)}e.preventDefault();break;case He.KEYCODES.TAB:return void this.switchTabs(e);default:s=t=0}s>(this.smileycodepositions[t]&&this.smileycodepositions[t].length-1)&&(39==e.keyCode&&t++,s=0),s<0&&(37==e.keyCode&&t--,s=this.smileycodepositions[t]&&this.smileycodepositions[t].length-1),i[t]&&1==i[t].props["data-zomojiheader"]&&(39==e.keyCode||40==e.keyCode?t++:37!=e.keyCode&&38!=e.keyCode||t--),t>this.totalrows||t<0||s>(i[t]&&i[t].props.children.length-1)||("frequentemoji"==this.state.currentpane&&0==t&&(t=1),this.setState({currentsmileyposition:{row:t,column:s}}))},e.prototype.addAnimationClass=function(e){var t=e.target.firstChild||e.target,s="https://static.zohocdn.com/chat/source/officechat/images/default/sm-animation/48/"+t.getAttribute("data-smileycode").replace(/:/g,"").replace("!","")+".png";H.get("builddomain")&&(s=H.get("builddomain")+s);var i="livezomoji"==this.state.currentpane?"48":"24";if(In[s])t.className=t.className.replace("zomoji-f-"+i,"zomojianim-"+i);else{var n=new Image;n.src=s,n.onload=function(){In[s]=!0,t.className=t.className.replace("zomoji-f-"+i,"zomojianim-"+i)}}},e.prototype.removeAnimationClass=function(e){var t=e.target.firstChild||e.target,s="livezomoji"==this.state.currentpane?"48":"24";t.className=t.className.replace("zomojianim-"+s,"zomoji-f-"+s)},e.prototype.displayLiveZomoji=function(e){this.setFrequentSmileyTab("livezomoji"),this.setState({currentpane:"livezomoji",currentsmileyposition:this.getDefaultSmileyCodePositions("livezomoji")},function(){this.searchnode&&this.searchnode.focus()}),e.stopPropagation()},e.prototype.displayFrequentEmojis=function(e){this.setFrequentSmileyTab("frequentemoji"),this.setState({currentpane:"frequentemoji",currentsmileyposition:this.getDefaultSmileyCodePositions("frequentemoji")},function(){this.searchnode&&this.searchnode.focus()}),e.stopPropagation()},e.prototype.displayZomoji=function(e){this.setFrequentSmileyTab("zomoji"),this.setState({currentpane:"zomoji",currentsmileyposition:this.getDefaultSmileyCodePositions("zomoji")},function(){this.searchnode&&this.searchnode.focus()}),e.stopPropagation()},e.prototype.displayEmoji=function(e){this.setFrequentSmileyTab("emoji"),this.setState({currentpane:"emoji",currentsmileyposition:this.getDefaultSmileyCodePositions("emoji")},function(){this.searchnode&&this.searchnode.focus()}),e.stopPropagation()},e.prototype.displayCustomEmoji=function(e){this.setFrequentSmileyTab("customemoji"),this.setState({currentpane:"customemoji",currentsmileyposition:this.getDefaultSmileyCodePositions("customemoji")},function(){this.searchnode&&this.searchnode.focus()}),e.stopPropagation()},e.prototype.displaySticker=function(e){this.setFrequentSmileyTab("sticker"),this.setState({currentpane:"sticker",currentsmileyposition:this.getDefaultSmileyCodePositions("sticker")},function(){this.searchnode&&this.searchnode.focus()}),e.stopPropagation()},e.prototype.closeZomojiComponent=function(e){27===e.keyCode&&this.props.closeComponent()},e.prototype.setZomojiNode=function(e){this.zomojinode=e},e.prototype.getSmileyCode=function(e){var t=e.target.getAttribute("data-smileycode")?e.target:e.target.querySelector("[data-smileycode]"),s=this.zm.removeTonePrefFromCode(t.getAttribute("data-smileycode"));this.zm.updateFrequentSmileysList(s,t.getAttribute("title")),this.props.getSmileyCode(s,e,this.state.currentpane),e.preventDefault()},e.prototype.getSortedZomojis=function(e){return this.zm.sortSmileys(this.zm.getSmileyLookup(e),e)},e.prototype.getSortedEmojis=function(e){return this.zm.sortEmojis(this.zm.getEmojiLookup(e),e)},e.prototype.getNextPageForCustomEmojis=function(e){!this.state.emojiloading&&e.target.scrollHeight==e.target.offsetHeight+e.target.scrollTop&&ei(this.getCriteriaType(this.state.currentpane))&&(this.getCustomEmojisFromServer(),this.setState({emojiloading:!0}))},e.prototype.getCriteriaType=function(e){return"customemoji"==e?"emoji":"sticker"},e.prototype.getCustomEmojisFromServer=function(e,i){i=i||this.state.currentpane;var t=function(t){var e=Object.keys(t.custom_emojis).filter(function(e){return 1==t.custom_emojis[e].status}),s=Vs(this.state.smileyvalue,i);this.emojis_from_server="Success"==t.status?gn(s.concat(e)):this.state.smileycodes,this.setState({emojiloading:!1})}.bind(this),s=!e;this.fetchStickers({search_text:e,criteriatype:this.getCriteriaType(i),includenexttoken:s},t)},e.prototype.getSmileysForSelectedPane=function(e,t){var s=[];if("emoji"===t)s=this.getSortedEmojis(e);else if("frequentemoji"==t)if(e){for(var i=this.getSortedZomojis(e),n={animated:[]},a={work:[]},o={emoji:this.getSortedEmojis(e)},r={customemoji:Vs(e,"customemoji")},l={sticker:Vs(e,"sticker")},d=0;d<i.length;d++)this.zm._isAnimationCode(i[d])?n.animated.push(i[d]):a.work.push(i[d]);s.push(a,o,n,r,l)}else{var c=this.zm.replaceFrequentSmileySkinTone(this.zm.getFrequentSmileys());for(var m in c){var u={};u[m]=c[m],s.push(u)}}else s="customemoji"==t||"sticker"==t?Vs(e,t):this.getSortedZomojis(e);return s},e.prototype.checkEmptyResultSet=function(e,t){var s=!0;if(this.autocompleteenabled){if("frequentemoji"==t)for(var i=0;i<e.length;i++){var n=Object.keys(e[i])[0];if(0<e[i][n].length){if("sticker"==n&&this.props.config.hidestickers)continue;s=!1;break}}else 0<e.length&&(s=!1);return s}},e.prototype.filterAndGetSmileys=function(e){var t=this.getSmileysForSelectedPane(e,this.state.currentpane);return this.checkEmptyResultSet(t,this.state.currentpane)&&this.autocompleteenabled&&this.props.closeComponent(),t},e.prototype.searchSmiley=function(e,t){var s=e&&e.target.value.toLowerCase().trim()||t,i=this.state.emojiloading;"customemoji"!=this.state.currentpane&&"sticker"!=this.state.currentpane||!(!s&&ei(this.getCriteriaType(this.state.currentpane))||s)||((!s&&ei(this.getCriteriaType(this.state.currentpane))||s)&&this.getCustomEmojisFromServer(s,this.state.currentpane),i=!0),this.setState({smileyvalue:s,smileycodes:this.filterAndGetSmileys(s),emojiloading:i,currentsmileyposition:this.getDefaultSmileyCodePositions()})},e.prototype.getFrequentSmileys=function(e,t,s,i){var n=null;"animated"==i&&(n=new si({default_size:"24",animation:{default_size:"24"}}));for(var a=0,o=[],r=[],l=[],d=[],c=null,m=null,u=this.getElementSpacingValue(),p=0;p<e.length;p++){var h=Mn.smileycnt,g=null;if("animated"==i&&(g=n.getSmiley(e[p]),m=this.removeAnimationClass,c=this.addAnimationClass),"emoji"==i&&(h+=" "+Mn.emoji,this.props.config&&!this.props.config.showEmojiWithText&&(h+=" "+Mn.emojiwithouttext),g=this.zm.getEmoji(e[p])),"work"==i&&(g=this.zm.getSmiley(e[p])),"sticker"==i&&(g=Ks(e[p])),"customemoji"==i&&(g=Zs(e[p])),null!=g){var f=!1;this.state.currentsmileyposition.row===s&&this.state.currentsmileyposition.column===a&&(h+=" "+Mn.selectedsmiley,f=!0);var C=this.props.config.showEmojiWithText?k("span",{class:Mn.elementstitle},g.props.title):null;this.props.config.showEmojiWithText&&(h+=" "+Mn.smileywithtext),o.push(k("div",{class:h,tabindex:"-1",onmouseover:c,onmouseout:m,title:g.props.title,"data-selected":f,style:{"margin-right":u+"px"},onclick:this.getSmileyCode},g,C)),l.push(g.props["data-smileycode"]),++a==t&&(r.push(k("div",{class:Mn.row},o)),s++,a=0,o=[],d.push(l),l=[])}}return 0<o.length&&(r.push(k("div",{class:Mn.rowlast},o)),d.push(l),s++),{smileys_array:r,smileycodepositions:d,row:s}},e.prototype.getLoadingElement=function(){return k("div",{class:Mn.loadinggif_cont},k("div",{class:Mn.loadinggif}))},e.prototype.getEmptySearchResult=function(){var e=this.zm.getEmoji(":disappointed-relieved:");return k("div",{class:Mn.emptysearchcontainer},k("div",{class:Mn.emptysearchemoji},e),k("div",{class:Mn.emptysearchtext},$("zomojicomponent.noresult",['"'+this.state.smileyvalue+'"'])))},e.prototype.getCurrentElementWidth=function(){return this.props.config.showEmojiWithText?135:"livezomoji"==this.state.currentpane||"sticker"==this.state.currentpane?58:32},e.prototype.getElementSpacingValue=function(){var e=this.getTotalColumns(),t=(this.state.containerwidth-e*this.getCurrentElementWidth())/e;return t<0?0:t},e.prototype.getTotalColumns=function(){return(this.state.containerwidth-this.state.containerwidth%this.getCurrentElementWidth())/this.getCurrentElementWidth()},e.prototype.populateSmiley=function(){var e=[],t=[],s=[],i=[],n=this.filterAndGetSmileys(this.state.smileyvalue);this.emojis_from_server&&!this.state.emojiloading&&(n=this.emojis_from_server,this.emojis_from_server=null);for(var a=0,o=0,r=(this.getCurrentElementWidth(),this.getTotalColumns()),l=this.getElementSpacingValue(),d=0;d<n.length;d++){var c=n[d],m=!1;if("frequentemoji"!=this.state.currentpane){var u=Mn.smileycnt;if("emoji"==this.state.currentpane)c=this.zm.getEmoji(n[d]),u+=" "+Mn.emoji,this.props.config&&!this.props.config.showEmojiWithText&&(u+=" "+Mn.emojiwithouttext);else if("customemoji"==this.state.currentpane)c=Zs(c);else if("sticker"==this.state.currentpane)c=Ks(c);else{if("zomoji"===this.state.currentpane&&this.zm._isAnimationCode(c)||"livezomoji"===this.state.currentpane&&!this.zm._isAnimationCode(c))continue;c=this.zm.getSmiley(c)}var p=this.props.showEmojiWithText?k("span",{class:Mn.elementstitle},c.props.title):null;this.state.currentsmileyposition.row===o&&this.state.currentsmileyposition.column===a&&(u+=" "+Mn.selectedsmiley,m=!0);var h=null,g=null;"livezomoji"==this.state.currentpane&&(h=this.addAnimationClass,g=this.removeAnimationClass,u+=" "+Mn.smileycntlive),"sticker"==this.state.currentpane&&(u+=" "+Mn.stickercnt),this.props.config.showEmojiWithText&&(u+=" "+Mn.smileywithtext),t.push(k("div",{class:u,tabindex:"-1",title:c.props.title,"data-selected":m,onmouseover:h,onmouseout:g,style:{"margin-right":l+"px"},onclick:this.getSmileyCode},c,p)),s.push(c.props["data-smileycode"]),a++}else if("frequentemoji"==this.state.currentpane){var f=Object.keys(c)[0];if(this.props.config.hidecustomemoji&&"customemoji"==f||this.props.config.hidestickers&&"sticker"==f)continue;var C=$("work"==f?"zomojicomponent.zomoji":"emoji"==f?"zomojicomponent.emoji":"zomojicomponent.livezomoji");if("sticker"==f&&(C=$("zomojicomponent.sticker")),"customemoji"==f&&(C=$("zomojicomponent.customemoji")),0==c[f].length)continue;e.push(k("div",{class:Mn.header,"data-zomojiheader":!0},C)),o++,i.push(["heading"]);var v=this.getFrequentSmileys(c[f],r,o,f);0<v.smileys_array.length?e=e.concat(v.smileys_array):e.splice(-1),0<v.smileycodepositions.length?i=i.concat(v.smileycodepositions):i.splice(-1),o=v.row;continue}a===r&&(e.push(k("div",{class:Mn.row},t)),t=[],a=0,i.push(s),s=[],o++)}return 0<t.length&&(e.push(k("div",{class:Mn.rowlast},t)),i.push(s),s=[],o++),this.totalrows=o-1,0!=e.length||this.state.emojiloading||this.autocompleteenabled||(e=this.getEmptySearchResult()),this.state.emojiloading&&e.push(this.getLoadingElement()),this.smileycodepositions=i,e},e.prototype.updateCliqSetting=function(e){Te("updbsettings.do","emojiskintone="+e,null,function(){rn($("zomoji.skinupdate.error"))})},e.prototype.updateSkinTone=function(e){H.set({emojiskintone:e}),this.updateCliqSetting(e),this.avoidscroll=!0,this.searchSmiley(null,this.state.smileyvalue)},e.prototype.render=function(e,t){var s=Mn.togglertop,i="",n="",a="",o=Mn.containerspacing,r=this.autocompleteenabled?Mn.autocompleteheight:"",l="",d="";"livezomoji"===t.currentpane&&(i=Mn.togglertop,s=""),"emoji"===t.currentpane&&(n=Mn.togglertop,s=""),"sticker"===t.currentpane&&(l=Mn.togglertop,s=""),"customemoji"===t.currentpane&&(d=Mn.togglertop,s=""),"frequentemoji"===t.currentpane&&(a=Mn.togglertop,o=s="");var c="",m=k(R,{classname:Mn.sticker+" "+l,onclick:this.displaySticker},k(R,{classname:Mn.zomojiicon,content:"e914",type:"icon",tabindex:"-1"})),u=k(R,{classname:Mn.customemoji+" "+d,onclick:this.displayCustomEmoji},k(R,{classname:Mn.zomojiicon,content:"e912",type:"icon",tabindex:"-1"}));e.config.hidestickers&&(m=null),e.config.hidecustomemoji&&(u=null),e.animation&&!this.autocompleteenabled&&(c=k("div",{class:Mn.toggler},k(R,{classname:Mn.frequentzomoji+" "+a,onclick:this.displayFrequentEmojis},k(R,{classname:Mn.zomojiicon,content:"ea24",type:"icon",tabindex:"-1"})),k(R,{classname:Mn.livezomoji+" "+i,onclick:this.displayLiveZomoji},k(R,{content:"e987",type:"icon",tabindex:"-1"})),k(R,{classname:Mn.zomoji+" "+s,onclick:this.displayZomoji},k(R,{classname:Mn.zomojiicon,content:"e958",type:"icon",tabindex:"-1"})),k(R,{classname:Mn.zomoji+" "+n,onclick:this.displayEmoji},k(R,{classname:Mn.zomojiicon,content:"e952",type:"icon",tabindex:"-1"})),u,m));var p="frequentemoji"!=t.currentpane&&"emoji"!=t.currentpane&&"zomoji"!=t.currentpane||!e.config.skintonepicker?null:k(An,{zm:this.zm,updateSkinTone:this.updateSkinTone}),h=k("div",{class:Mn.searchcontainer},k("div",{class:Mn.searchBox},k("input",{ref:this.storeSearchNode,"data-purpose":"search",type:"text",placeholder:$("Search"),oninput:this.searchSmiley,onkeydown:this.selectSmiley})),p);e.config&&e.config.hidesearch&&(h=null);var g="customemoji"==this.state.currentpane||"sticker"==this.state.currentpane?this.getNextPageForCustomEmojis:null;return k("div",{class:Mn.zomojiContainer+" "+r,ref:this.setZomojiNode,onkeydown:this.closeZomojiComponent},h,k("div",{onscroll:g,key:t.currentpane,class:Mn.smileyContainer+" "+o,ref:this.storeSmileysContainer},this.populateSmiley()),c)},e}(M),An=function(e){function t(){this.state={showdropbox:!1,currenttone:H.get("emojiskintone")},this.toggleDropBox=this.toggleDropBox.bind(this)}return t.__proto__=e,((t.prototype=Object.create(e.prototype)).constructor=t).prototype.getDisplayEmojiCode=function(){return":raised-hand:"},t.prototype.onSelectSkinTone=function(e,t){this.props.updateSkinTone(e),this.setState({currenttone:e,showdropbox:!1}),t.stopPropagation(),t.preventDefault()},t.prototype.getDropBox=function(){for(var e=[],t=this.props.zm.isSkinToneSupported(),s=0;s<6;s++){var i=this.props.zm.getEmoji(this.getDisplayEmojiCode(),s+""),n="";H.get("emojiskintone")==s&&(n=" "+Mn.selectedtone),e.push(k("div",{tabindex:"0",onclick:this.onSelectSkinTone.bind(this,s),class:Mn.toneitem+n},i))}t||e.push(k("div",{class:Mn.unsupported},$("zomoji.skintone.unsupported")));var a=$("zomoji.skintone.label");return k("div",{class:Mn.tonepickercontainer},k("div",{class:Mn.tones},e.reverse()),k("div",{class:Mn.tonelabel},a))},t.prototype.toggleDropBox=function(e){this.setState({showdropbox:!this.state.showdropbox}),e.stopPropagation(),e.preventDefault()},t.prototype.render=function(e,t){var s=e.zm.getEmoji(this.getDisplayEmojiCode(),t.currenttone),i=null;return t.showdropbox&&(i=this.getDropBox()),k("div",{class:Mn.emojitonedisplay,onclick:this.toggleDropBox},s,i)},t}(M);wn.prototype.updateSearchTerm=function(e){this.instance.updateSearchTermFromComposer(e)},wn.prototype.handleCustomNavigation=function(e){var t=e.keyCode;t===He.KEYCODES.LEFT||t===He.KEYCODES.RIGHT||t===He.KEYCODES.DOWN||t===He.KEYCODES.UP||t===He.KEYCODES.ENTER?(this.instance.selectSmiley(e),e.preventDefault(),e.stopPropagation()):t===He.KEYCODES.ESCAPE&&(this.closeComponent(),e.preventDefault(),e.stopPropagation())},wn.prototype.mountComponent=function(e,t,s,i,n){this.node=e,this.closeComponent=i,O(k(Tn,{ref:function(e){this.instance=e}.bind(this),animation:t,getSmileyCode:s,closeComponent:i,config:n}),e)},wn.prototype.unmountComponent=function(){O("",this.node)};function En(){this.instance=null}var Un="mc6f7529c1_hours",xn="mc6f7529c1_minutes",Nn="mc6f7529c1_timeperiod",kn="mc6f7529c1_timecontainer",On="mc6f7529c1_timeicon",Rn="mc6f7529c1_timecnt",Hn="mc6f7529c1_invalidcnt",$n="mc6f7529c1_colon",Dn=function(t){function e(e){t.call(this,e),e.time?this.state=this.constructStateFromTime(e.time):this.state=this.constructStateFromTime(),this.handleTimeInput=this.handleTimeInput.bind(this),this.handleUpDownArrows=this.handleUpDownArrows.bind(this),this.handleTimePeriod=this.handleTimePeriod.bind(this),this.onTimeChange=this.props.onTimeChange}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.constructStateFromTime=function(e){var t="--",s="--",i="--";return e&&(t=0===(t=(e=new Date(e)).getHours()%12)?12:t,t=1===(t+="").length?"0"+t:t,s=e.getMinutes(),s=1===(s+="").length?"0"+s:s,i=e.getHours()<12?"AM":"PM"),{hours:t,minutes:s,timeperiod:i,invalid_hours:!1,invalid_minutes:!1,invalid_timeperiod:!1}},e.prototype.updateTime=function(e){this.setState(this.constructStateFromTime(e))},e.prototype.componentDidUpdate=function(e,t){if(t.hours!=this.state.hours||t.minutes!=this.state.minutes||t.timeperiod!=this.state.timeperiod){var s=this.state.hours+":"+this.state.minutes,i=s+" "+this.state.timeperiod,n=s,a=!1,o=!1;if("AM"==this.state.timeperiod){var r=parseInt(this.state.hours);12==this.state.hours&&(r="00"),n=r+":"+this.state.minutes}if("PM"===this.state.timeperiod){var l=parseInt(this.state.hours)+12;24==l&&(l="12"),n=l+":"+this.state.minutes}!this.state.invalid_hours&&"--"!==this.state.hours||(a=!0),!this.state.invalid_minutes&&"--"!==this.state.minutes||(o=!0),this.onTimeChange(i,n,a,o)}},e.prototype.handleTimePeriod=function(e){9!=e.keyCode&&e.preventDefault();var t=this.state.timeperiod;"click"===e.type&&"--"===t&&(t="AM"),38!==e.keyCode&&40!==e.keyCode||(t="AM"===this.state.timeperiod?"PM":"AM"),65==e.keyCode?t="AM":80==e.keyCode?t="PM":"AM"!=t&&"PM"!=t&&(t="AM"),this.setState({timeperiod:t})},e.prototype.handleUpDownArrows=function(e,t){var s="--"!=e.target.value?parseInt(e.target.value):0;38!==e.keyCode&&40!==e.keyCode||(38===e.keyCode&&s++,40===e.keyCode&&s--,"hours"===t&&(12<s?s=1:s<1&&(s=12)),"minutes"===t&&(59<s?s=0:s<0&&(s=59)),this.handleTimeInput(s+"",t))},e.prototype.handleTimeInput=function(e,t){var s=!1;isNaN(parseInt(e))&&(s=!(e="")),!isNaN(e)&&e.length<=2?(1==e.length&&(e="0"+e),"hours"==t?(12<e||e<=0)&&(s=!0):59<e&&(s=!0)):s=!(e=""),"hours"==t?this.setState({hours:e,invalid_hours:s}):this.setState({minutes:e,invalid_minutes:s})},e.prototype.render=function(){var t=this,e=this.state.invalid_hours?Hn:"",s=this.state.invalid_minutes?Hn:"",i=this.state.invalid_timeperiod?Hn:"",n=this.props.customclass&&this.props.customclass.timecontainer?this.props.customclass.timecontainer:"",a=this.props.customclass&&this.props.customclass.timecnt?this.props.customclass.timecnt:"";return k("div",{class:kn+" "+n},k("span",{class:Rn+" "+a},k("input",{type:"text",maxlength:"2",value:this.state.hours,onchange:function(e){t.handleTimeInput(e.target.value,"hours")},onkeydown:function(e){t.handleUpDownArrows(e,"hours")},class:Un+" "+e}),k("span",{class:$n},":"),k("input",{type:"text",maxlength:"2",value:this.state.minutes,onchange:function(e){t.handleTimeInput(e.target.value,"minutes")},onkeydown:function(e){t.handleUpDownArrows(e,"minutes")},class:xn+" "+s}),k("input",{type:"text",maxlength:"2",value:$(this.state.timeperiod),onclick:this.handleTimePeriod,onkeydown:this.handleTimePeriod,class:Nn+""+i})),k("span",{class:On}," "))},e}(M);En.prototype.mountComponent=function(e,t,s){O(k(Dn,{ref:function(e){this.instance=e}.bind(this),onTimeChange:s,time:t}),e)},En.prototype.updateTime=function(e){this.instance.updateTime(e)},void 0===Object.keys&&(Object.keys=function(e){var t=[];for(var s in e)t.push(s);return t}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){return(void 0===t||t>this.length)&&(t=this.length),this.substring(t-e.length,t)===e}),Array.prototype.filter||(Array.prototype.filter=function(e){if(null==this)throw new TypeError;var t=Object(this),s=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var i=[],n=2<=arguments.length?arguments[1]:void 0,a=0;a<s;a++)if(a in t){var o=t[a];e.call(n,o,a,t)&&i.push(o)}return i}),Array.prototype.map||(Array.prototype.map=function(e,t){var s,i,n;if(null==this)throw new TypeError(" this is null or not defined");var a=Object(this),o=a.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(1<arguments.length&&(s=t),i=new Array(o),n=0;n<o;){var r,l;n in a&&(r=a[n],l=e.call(s,r,n,a),i[n]=l),n++}return i}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var s,i;if(null==this)throw new TypeError(" this is null or not defined");var n=Object(this),a=n.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(1<arguments.length&&(s=t),i=0;i<a;){var o;i in n&&(o=n[i],e.call(s,o,i,n)),i++}}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError("'this' is null or not defined");var t=Object(this),s=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var i=arguments[1],n=0;n<s;){var a=t[n];if(e.call(i,a,n,t))return a;n++}}}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),s=t.length;0<=--s&&t.item(s)!==this;);return-1<s}),Element.prototype.closest||(Element.prototype.closest=function(e){for(var t=this;t.matches;){if(t.matches(e))return t;t=t.parentNode}return null}),Array.prototype.some||(Array.prototype.some=function(e){if(null==this)throw new TypeError("Array.prototype.some called on null");if("function"!=typeof e)throw new TypeError;for(var t=Object(this),s=t.length>>>0,i=2<=arguments.length?arguments[1]:void 0,n=0;n<s;n++)if(n in t&&e.call(i,t[n],n,t))return!0;return!1}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){var s=arguments;if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),n=1;n<arguments.length;n++){var a=s[n];if(null!=a)for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(i[o]=a[o])}return i},writable:!0,configurable:!0});var Ln={theatremode_overlay:"mc183cf01f_theatremode_overlay",playerfwdcontainer:"mc183cf01f_playerfwdcontainer",playerforwardicon:"mc183cf01f_playerforwardicon",videoplayer:"videoplayer",posterimage:"mc183cf01f_posterimage",playeroverlay:"mc183cf01f_playeroverlay",playerparent_container:"mc183cf01f_playerparent_container",playerpopout:"mc183cf01f_playerpopout",displayminiplayer:"mc183cf01f_displayminiplayer",theatremode:"mc183cf01f_theatremode",videoplayer_container:"mc183cf01f_videoplayer_container",video_content:"mc183cf01f_video_content",playpausecontainer:"mc183cf01f_playpausecontainer",fullscreenplaypause:"mc183cf01f_fullscreenplaypause",playpauseinitial:"mc183cf01f_playpauseinitial",audioplayerplaypause:"mc183cf01f_audioplayerplaypause",forwardiconcontainer:"mc183cf01f_forwardiconcontainer",downloadiconcontainer:"mc183cf01f_downloadiconcontainer",playicon:"mc183cf01f_playicon",forwardicon:"mc183cf01f_forwardicon",overlaydownloadicon:"mc183cf01f_overlaydownloadicon",videodesc:"mc183cf01f_videodesc",videodesc_theatremode:"mc183cf01f_videodesc_theatremode",closeicon:"mc183cf01f_closeicon",controller_bgclass:"mc183cf01f_controller_bgclass",controls_container:"mc183cf01f_controls_container",controls_container_theatremode:"mc183cf01f_controls_container_theatremode",seekbar:"mc183cf01f_seekbar",seekbar_theatremode:"mc183cf01f_seekbar_theatremode",leftpane:"mc183cf01f_leftpane",rightpane:"mc183cf01f_rightpane",duration_content:"mc183cf01f_duration_content",duration_theatremode:"mc183cf01f_duration_theatremode",tooltip:"mc183cf01f_tooltip",tooltip_theatremode:"mc183cf01f_tooltip_theatremode",buffer:"mc183cf01f_buffer",seekguide:"mc183cf01f_seekguide",progressbar:"mc183cf01f_progressbar",sliderthumb:"mc183cf01f_sliderthumb",seekbar_hoverspace:"mc183cf01f_seekbar_hoverspace",popedin:"mc183cf01f_popedin",seekbarfocus:"mc183cf01f_seekbarfocus",volume_slider_container:"mc183cf01f_volume_slider_container",volumesliderparent:"mc183cf01f_volumesliderparent",volumeslider_theatremode:"mc183cf01f_volumeslider_theatremode",hidevolumeslider:"mc183cf01f_hidevolumeslider",volfocuson:"mc183cf01f_volfocuson",volumeslider_background:"mc183cf01f_volumeslider_background",volume_lowerfill:"mc183cf01f_volume_lowerfill",volume_thumb:"mc183cf01f_volume_thumb",iconsmall:"mc183cf01f_iconsmall",iconmed:"mc183cf01f_iconmed",iconlarge:"mc183cf01f_iconlarge",videomodeplayicon:"mc183cf01f_videomodeplayicon",display:"mc183cf01f_display",details:"mc183cf01f_details",displaydetails:"mc183cf01f_displaydetails",header:"mc183cf01f_header",topgradiant:"mc183cf01f_topgradiant",videoend_details:"mc183cf01f_videoend_details",downloadicon:"mc183cf01f_downloadicon",actionscontainer:"mc183cf01f_actionscontainer",videomodefwdicon:"mc183cf01f_videomodefwdicon",ffbuttoncontainer:"mc183cf01f_ffbuttoncontainer",basic_controlscontainer:"mc183cf01f_basic_controlscontainer",ffbutton:"mc183cf01f_ffbutton",rewbutton:"mc183cf01f_rewbutton",revbutton:"mc183cf01f_revbutton",loadingdiv:"mc183cf01f_loadingdiv",progressbar_parent:"mc183cf01f_progressbar_parent",seekbar_thumb:"mc183cf01f_seekbar_thumb",replayicon:"mc183cf01f_replayicon",expander:"mc183cf01f_expander",disable:"mc183cf01f_disable",errorcontainer:"mc183cf01f_errorcontainer",errorcontainerdata:"mc183cf01f_errorcontainerdata",errormessage:"mc183cf01f_errormessage",errorposterimg:"mc183cf01f_errorposterimg",retry:"mc183cf01f_retry",errordownload:"mc183cf01f_errordownload",dot:"mc183cf01f_dot",erroractions:"mc183cf01f_erroractions",playbackrate:"mc183cf01f_playbackrate",controllerbgerror:"mc183cf01f_controllerbgerror",erroricon:"mc183cf01f_erroricon",errorcontainerbig:"mc183cf01f_errorcontainerbig",audioplayerbg:"mc183cf01f_audioplayerbg",basiccontrolsposition:"mc183cf01f_basiccontrolsposition",zmNightMode:"zmNightMode","wms-rtl":"wms-rtl",voicerecordertrack:"mc183cf01f_voicerecordertrack",seperator:"mc183cf01f_seperator",optionscontainer:"mc183cf01f_optionscontainer",optionitem:"mc183cf01f_optionitem",itemlabel:"mc183cf01f_itemlabel",optionselected:"mc183cf01f_optionselected",moreoptions:"mc183cf01f_moreoptions",labelwithicon:"mc183cf01f_labelwithicon",moreoptionscontainer:"mc183cf01f_moreoptionscontainer"},Pn=function(t){function e(e){t.call(this),this.progressbarwidth=e.current_time/e.duration||0,this.tooltip_time="00:00",this.setSeekBarNode=this.setSeekBarNode.bind(this),this.setProgressBarWidth=this.setProgressBarWidth.bind(this),this.setSeekGuideWidth=this.setSeekGuideWidth.bind(this),this.seekVideo=this.seekVideo.bind(this),this.setClickedState=this.setClickedState.bind(this),this.dragThumb=this.dragThumb.bind(this),this.removeThumbEventListener=this.removeThumbEventListener.bind(this),this.state={seekguidewidth:0,clicked:!1}}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.componentWillUnmount=function(){document.removeEventListener("mouseup",this.removeThumbEventListener,!0)},e.prototype.componentDidMount=function(){document.addEventListener("mouseup",this.removeThumbEventListener,!0)},e.prototype.removeThumbEventListener=function(){document.removeEventListener("mousemove",this.seekVideo)},e.prototype.componentWillUpdate=function(e){0===e.current_time&&(this.progressbarwidth=0),this.props.videostate==e.videostate||"paused"!=e.videostate&&"ended"!=e.videostate||this.setProgressBarWidth()},e.prototype.componentDidUpdate=function(e){e.current_time!=this.props.current_time&&this.setProgressBarWidth(),0===this.props.current_time&&(this.progressbarwidth=0)},e.prototype.setSeekBarNode=function(e){this.seekbarnode=e},e.prototype.setClickedState=function(){this.setState({clicked:!1})},e.prototype.setProgressBarWidth=function(e){var t=this.props.duration,s=e||this.props.current_time,i=this.seekbarnode.getBoundingClientRect().width;(this.progressbarwidth=0)!=t&&(this.progressbarwidth=i*s/t),this.progressbarwidth>i&&(this.progressbarwidth=i)},e.prototype.getWidthPerSecond=function(){return this.getSeekBarWidth()/this.props.duration},e.prototype.setToolTip=function(e){this.tooltippos=e-20;var t=this.getSeekBarWidth();t<e+20&&(this.tooltippos=t-40),e-20<0&&(this.tooltippos=0),this.tooltip_time=isFinite(Math.ceil(e/this.getWidthPerSecond()))?ni(Math.ceil(e/this.getWidthPerSecond())):""},e.prototype.setSeekGuideWidth=function(e){var t=e.clientX-e.target.getBoundingClientRect().left,s=t/this.getSeekBarWidth();1<s&&(s=1),this.setToolTip(t),this.setState({seekguidewidth:s})},e.prototype.seekVideo=function(e){if("keydown"===e.type){var t=this.props.current_time;39===e.keyCode&&(t=this.props.current_time+10)>this.props.duration&&(t=this.props.duration),37===e.keyCode&&(t=this.props.current_time-10)<0&&(t=0),this.props.updateCurrentTime(t)}if("mousedown"===e.type||"mousemove"==e.type){var s=(e.clientX-this.seekbarnode.getBoundingClientRect().left)/this.getWidthPerSecond();s<0&&(s=0),this.setProgressBarWidth(s),this.props.updateCurrentTime(s),this.setState({clicked:!0})}e.stopPropagation(),e.preventDefault()},e.prototype.dragThumb=function(e){document.addEventListener("mousemove",this.seekVideo),this.seekVideo(e)},e.prototype.getProgressBarWidth=function(){return this.seekbarnode&&this.setProgressBarWidth(),this.progressbarwidth},e.prototype.getSeekBarWidth=function(){return this.seekbarnode&&this.seekbarnode.getBoundingClientRect().width||0},e.prototype.render=function(e,t){var s=t.clicked?"":Ln.seekbarfocus,i=Ln.seekbar,n=this.tooltip_time.length?Ln.tooltip:"",a=this.getSeekBarWidth();(e.fullscreen||e.theatremode)&&(i=Ln.seekbar_theatremode,n=this.tooltip_time.length?Ln.tooltip_theatremode:"");var o="error"==e.videostate?Ln.disable:"",r="clamp(0px,100%,calc(100% - "+(e.fullscreen||e.theatremode?15:12)+"px))";i+=e.isvoicerecorder?" "+Ln.voicerecordertrack:"";var l=0,d=this.getProgressBarWidth();return 0<d&&0<a&&(l=d/a*100),k("div",{class:i+" "+s+" "+o,ref:this.setSeekBarNode,tabindex:"0",onkeydown:this.seekVideo,onblur:this.setClickedState,onmousedown:this.dragThumb,onmousemove:this.setSeekGuideWidth},k("div",{class:Ln.buffer,style:{transform:"scaleX("+e.bufferpercentage+")"}}),k("div",{class:Ln.seekguide,style:{transform:"scaleX("+t.seekguidewidth+")"}}),k("div",{class:Ln.progressbar_parent,onmousedown:this.dragThumb,style:{width:l+"%"}},k("div",{class:Ln.progressbar}),k("div",{class:Ln.seekbar_thumb,style:{left:r}})),k("div",{class:Ln.seekbar_hoverspace,onmousedown:this.dragThumb}),k("div",{class:n,style:{left:this.tooltippos+"px"}},this.tooltip_time))},e}(M),Bn=function(t){function e(e){t.call(this),this.slidernode=null,this.volume=null!=e.volume?e.volume:1,this.state={position:64*this.volume,clicked:!1},this.setEventListener=this.setEventListener.bind(this),this.setThumbPosition=this.setThumbPosition.bind(this),this.setSliderNode=this.setSliderNode.bind(this),this.setVolume=this.setVolume.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.volumeBlur=this.volumeBlur.bind(this)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.componentDidMount=function(){window.addEventListener("mouseup",this.removeEventListener,!0)},e.prototype.setSliderNode=function(e){this.slidernode=e},e.prototype.setVolume=function(e){if(!e.type||"click"!==e.type&&"keydown"!==e.type)this.volume=e;else{var t=0;0<this.volume?this.volume=0:(this.volume=1,t=64),this.setState({position:t})}this.props.setVolume(this.volume)},e.prototype.volumeBlur=function(){this.setState({clicked:!1})},e.prototype.setEventListener=function(e){window.addEventListener("mousemove",this.setThumbPosition),this.slidernode.addEventListener("mouseup",this.setThumbPosition),this.setState({clicked:!0}),e.stopPropagation()},e.prototype.setThumbPosition=function(e){var t=this.state.position;if("keydown"===e.type){38===e.keyCode&&(t+=5.2),40===e.keyCode&&(t-=5.2),e.preventDefault(),e.stopPropagation()}"mouseup"!==e.type&&"mousemove"!==e.type||(t=70-(t=e.clientY-this.slidernode.getBoundingClientRect().top),e.preventDefault(),e.stopPropagation()),t<0&&(t=0),64<t&&(t=64),this.setVolume(t/64),this.setState({position:t})},e.prototype.removeEventListener=function(){window.removeEventListener("mousemove",this.setThumbPosition),window.removeEventListener("mouseup",this.setThumbPosition)},e.prototype.render=function(e,t){var s=Ln.iconsmall,i="ea16";0===this.volume&&(i="ea11");var n=t.clicked?"":Ln.volfocuson,a=Ln.volumesliderparent;(e.theatremode||e.fullscreen)&&(s=Ln.iconmed,a=a+" "+Ln.volumeslider_theatremode);var o="audio"==e.playertype?" "+Ln.hidevolumeslider:"";return k("div",{class:Ln.volume_slider_container+o},k(R,{classname:s,type:"icon",title:$("videoplayer.volume"),content:i,onclick:this.setVolume}),k("div",{class:a+" "+n,ref:this.setSliderNode,onmousedown:this.setEventListener,onmouseup:this.removeEventListener,onkeydown:this.setThumbPosition,onblur:this.volumeBlur,tabindex:"0"},k("div",{class:Ln.volumeslider_background},k("span",{class:Ln.volume_lowerfill,style:{height:t.position+"px"}}),k("span",{class:Ln.volume_thumb,style:{bottom:t.position+"px"}}))))},e}(M);function jn(e){var t=null,s=null;e.icon&&(t=k(R,{classname:e.icon.classname,content:e.icon.content,type:"icon"}),s=Ln.labelwithicon);var i=e.selected?" "+Ln.optionselected:"";return k("div",{onclick:function(e){this.props.onClickItem&&this.props.onClickItem(e,this.props.keyname)}.bind(this),class:Ln.optionitem+i},t,k("div",{class:Ln.itemlabel+" "+s,title:e.content},e.content))}function Fn(e){var t=Ln.videomodefwdicon+" "+Ln.iconsmall,s=Ln.duration_content,i=Ln.controls_container,n=null,a=Ln.iconsmall,o=null,r=Ln.downloadicon+" "+Ln.iconsmall,l=isFinite(Math.round(e.current_time))?ni(Math.round(e.current_time)):"00",d=isFinite(Math.round(e.duration))?"/"+ni(Math.round(e.duration)):"",c="error"==e.videostate?Ln.disable:"",m=k(R,{classname:Ln.iconsmall,type:"icon",content:"ea15",title:$("videoplayer.theatremode"),onclick:e.toggleTheatreMode}),u="error"!=e.videostate||e.theatremode||e.fullscreen||e.popout?"":Ln.controllerbgerror;if(e.theatremode||e.fullscreen||e.popout&&e.config.supportFullscreenFromMiniplayer){var p=Ln.iconsmall;(!e.config.supportFullscreenFromMiniplayer||e.config.supportFullscreenFromMiniplayer&&e.fullscreen)&&(t=Ln.iconmed,s=Ln.duration_theatremode,r=Ln.downloadicon+" "+Ln.iconmed,i=Ln.controls_container_theatremode,p=Ln.iconmed),n=k(R,{classname:p,type:"icon",title:$("mediacall.fullscreen"),content:"ea0e",onclick:e.toggleFullScreen}),m=null}e.theatremode&&(a=Ln.iconmed);var h=k(R,{classname:a,content:"ea10",type:"icon",title:$("videoplayer.miniplayer"),onclick:e.toggleMiniPlayer}),g=k(R,{classname:t,type:"icon",title:$("chat.forward"),content:"ea0d",onclick:e.forwardAttachment});(e.popout||e.fullscreen)&&(h=null),(e.fullscreen||e.config&&1==e.config.hideforwardicon)&&(g=null),e.popout&&(t=Ln.iconsmall);var f=e.config&&e.config.handleDownload?e.config.handleDownload:null,C=k("a",{download:!0,target:"_blank",href:e.videosrc,onclick:f},k("span",{class:r,title:$("chat.download")}));f&&(C=k("a",{onclick:f},k("span",{class:r,title:$("chat.download")}))),pn()&&(C=k("a",f?{onclick:f}:{onclick:e.downloadVideo,documentclick:"attdownload",download:!0,target:"_blank",href:e.videosrc},k("span",{class:r,title:$("chat.download")}))),e.config&&e.config.hidedownloadicon&&(C=null);var v="video"==e.playertype?Ln.controller_bgclass:"";if("audio"==e.playertype&&(m=h=null),e.config&&e.config.hidetheatremodeicon&&(m=null),e.config&&e.config.hideminiplayericon&&(h=null),this.props.videoplayernode&&this.props.videoplayernode.offsetWidth<300&&"audio"!=e.playertype){var b=!C;this.props.videoplayernode.offsetWidth<250&&(h=null),o=k(zn,{hidedownload:b,videoplayerprops:e,handledownloadcallback:f,moreoptionsvisible:e.moreoptionsvisible,toggleMoreOptions:e.toggleMoreOptions}),g=C=null}return k("div",{class:v+" "+u},k(Pn,{duration:e.duration,current_time:e.current_time,updateCurrentTime:e.updateCurrentTime,bufferpercentage:e.bufferpercentage,theatremode:e.theatremode,popout:e.popout,fullscreen:e.fullscreen,videostate:e.videostate}),k("div",{class:i},k("div",{class:Ln.leftpane+" "+c},k(Bn,{setVolume:e.setVolume,volume:e.volume,videoplayernode:e.videoplayernode,theatremode:e.theatremode,fullscreen:e.fullscreen,playertype:e.playertype}),k("div",{class:s},l+d),k("div",{class:Ln.seperator}),k(Gn,{playbackratevisible:e.playbackratevisible,playbackrate:e.playbackrate,togglePlayBackOptions:e.togglePlayBackOptions,playbackrateCallback:e.playbackrateCallback})),k("div",{class:Ln.rightpane},o,C,g,h,m,n)))}function zn(n){var a=this,e=n.moreoptionsvisible?function(){var e=[k(jn,{icon:{classname:Ln.iconsmall,content:"ea0d"},content:$("chat.forward"),onClickItem:n.videoplayerprops.forwardAttachment})];if(!n.hidedownload){var t=k("div",{class:Ln.itemlabel+" "+Ln.labelwithicon,title:$("chat.download")},$("chat.download")),s=k("div",{class:Ln.downloadicon+" "+Ln.iconsmall,title:$("chat.download")});if(pn()){var i=a.props.handledownloadcallback?a.props.handledownloadcallback:a.props.videoplayerprops.downloadVideo;e.push(k("a",{onclick:i,documentclick:"attdownload",download:!0,target:"_blank",href:a.props.videoplayerprops.videosrc},s,t))}else e.push(k("div",{class:Ln.optionitem},k("a",{download:!0,target:"_blank",href:a.props.videoplayerprops.videosrc,onclick:a.props.handledownloadcallback},s,t)))}return a.props.videoplayerprops.videoplayernode.offsetWidth<250&&e.push(k(jn,{icon:{classname:Ln.iconsmall,content:"ea10"},content:$("videoplayer.miniplayer"),onClickItem:n.videoplayerprops.toggleMiniPlayer})),k(Q,{onClickOutside:n.toggleMoreOptions},k("div",{class:Ln.optionscontainer+" "+Ln.moreoptionscontainer},e))}():null;return k(R,{type:"icon",content:"e950",title:$("common.more"),classname:Ln.iconsmall+" "+Ln.moreoptions,onclick:n.toggleMoreOptions},e)}function Gn(a){var o=this;function r(e,t){this.props.playbackrateCallback&&this.props.playbackrateCallback(t)}var e=a.playbackratevisible?function(){for(var e=[],t=[.5,.75,1,1.25,1.5],s=0;s<t.length;s++){var i=2==s?$("Normal"):t[s]+" X",n=a.playbackrate==t[s];e.push(k(jn,{selected:n,keyname:t[s],content:i,onClickItem:r.bind(o)}))}return k(Q,{onClickOutside:a.togglePlayBackOptions},k("div",{class:Ln.optionscontainer},e," "))}():null;return k("div",{class:Ln.playbackrate,onClick:a.togglePlayBackOptions},a.playbackrate+" X",e)}for(var qn={},Yn=[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenElement"],["webkitRequestFullScreen","webkitExitFullscreen","webkitfullscreenchange","webkitFullscreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullscreenElement"],["msRequestFullscreen","msExitFullscreen","msfullscreenchange","msFullscreenElement"]],Vn=0;Vn<Yn.length;Vn++){var Zn=Yn[Vn];if(Zn&&Zn[1]in document)for(var Kn=0;Kn<Zn.length;Kn++)qn[Yn[0][Kn]]=Zn[Kn]}function Xn(e,t){this.node=e,this.onFullScreenChangeCallBack=t,this.onFullScreenChange=this.onFullScreenChange.bind(this),document.addEventListener(qn.fullscreenchange,this.onFullScreenChange,!1)}Xn.prototype.onFullScreenChange=function(){this.onFullScreenChangeCallBack()},Xn.prototype.requestFullScreen=function(){this.node[qn.requestFullscreen]()},Xn.prototype.exitFullScreen=function(){document[qn.exitFullscreen]()},Xn.prototype.toggleFullScreen=function(){document[qn.fullscreenElement]?this.exitFullScreen():this.requestFullScreen()},Xn.prototype.removeEventListener=function(){document.removeEventListener(qn.onscreenchange,this.onFullScreenChange,!1)};function Jn(e,t,s){this.node=e,this.dragStart=this.dragStart.bind(this),this.dragOver=this.dragOver.bind(this),this.dragEnd=this.dragEnd.bind(this),this.dragStartCallBack=t,this.dragEndCallBack=s,this.node.onmousedown=this.dragStart,this.node.onmouseup=this.dragEnd}Jn.prototype.dragStart=function(e){this.mouse_xposition=this.node.getBoundingClientRect().width-(e.clientX-this.node.getBoundingClientRect().x),this.mouse_yposition=this.node.getBoundingClientRect().height-(e.clientY-this.node.getBoundingClientRect().y),document.addEventListener("mousemove",this.dragOver),this.dragStartCallBack&&this.dragStartCallBack()},Jn.prototype.dragOver=function(e){var t=0,s=0;this.node.setAttribute("data-drag","true"),t=document.documentElement.clientWidth-(e.clientX+this.mouse_xposition),(s=document.documentElement.clientHeight-(e.clientY+this.mouse_yposition))<0&&(s=0),s+this.node.offsetHeight>document.documentElement.clientHeight&&(s=document.documentElement.clientHeight-this.node.offsetHeight),t+this.node.offsetWidth>document.documentElement.clientWidth&&(t=document.documentElement.clientWidth-this.node.offsetWidth),t<0&&(t=0),this.node.style.right=t+"px",this.node.style.bottom=s+"px"},Jn.prototype.dragEnd=function(e){this.dragEndCallBack&&this.dragEndCallBack(),document.removeEventListener("mousemove",this.dragOver),e.preventDefault(),e.stopPropagation()};function Qn(){this.forwardAttachment=null,this.toggleMiniPlayer=this.toggleMiniPlayer.bind(this),this.toggleTheatreView=this.toggleTheatreView.bind(this),this.forwardAttachmentCallBack=this.forwardAttachmentCallBack.bind(this),this.pauseRemainingInstances=this.pauseRemainingInstances.bind(this),this.pauseVideoPlayer=this.pauseVideoPlayer.bind(this),this.closePopupOptions=this.closePopupOptions.bind(this),this.closeCurrentPopupOption=this.closeCurrentPopupOption.bind(this)}var ea=function(n){function e(e){n.call(this,e),this.videoplayernode=null,this.videosourcenode=null,this.timeout=null,this.playertype=this.getPlayerType();var t="error"==e.videostate?"playing":e.videostate;"audio"!=this.playertype||e.videostate||(t="paused");var s="audio"==this.playertype?"100px":"330px",i="audio"==this.playertype?"350px":"500px";this.state={fullscreen:!1,videostate:t||"playing",volume:null!=e.volume?e.volume:1,current_time:e.current_time||0,duration:e.duration||0,bufferpercentage:0,displayopacity:Ln.displaydetails,playbackrate:e.playbackrate?e.playbackrate:1,display:"block",displayminiplayer:!1,miniplayerinlinestyle:{height:s,width:i},moreoptionsvisible:!1,playbackratevisible:!1},this.toggleFullScreen=this.toggleFullScreen.bind(this),this.setVideoPlayerNode=this.setVideoPlayerNode.bind(this),this.onFullScreenChange=this.onFullScreenChange.bind(this),this.toggleVideoPlay=this.toggleVideoPlay.bind(this),this.setVideoSourceNode=this.setVideoSourceNode.bind(this),this.setVolume=this.setVolume.bind(this),this.onVideoEnd=this.onVideoEnd.bind(this),this.updateTime=this.updateTime.bind(this),this.updateCurrentTime=this.updateCurrentTime.bind(this),this.handleDragEnd=this.handleDragEnd.bind(this),this.toggleMiniPlayer=this.toggleMiniPlayer.bind(this),this.toggleTheatreMode=this.toggleTheatreMode.bind(this),this.escEventListener=this.escEventListener.bind(this),this.displayPlayerDetails=this.displayPlayerDetails.bind(this),this.detailsTransitionEnd=this.detailsTransitionEnd.bind(this),this.playerMouseOut=this.playerMouseOut.bind(this),this.throttle=ai(this.displayPlayerDetails,this,300),this.calcBufferPercentage=this.calcBufferPercentage.bind(this),this.ffVideo=this.ffVideo.bind(this),this.rewVideo=this.rewVideo.bind(this),this.setLoadingState=this.setLoadingState.bind(this),this.handleResizeDrag=this.handleResizeDrag.bind(this),this.resizeMiniPlayer=ai(this.resizeMiniPlayer,this,50),this.throwVideoError=this.throwVideoError.bind(this),this.retryPlayingVideo=this.retryPlayingVideo.bind(this),this.downloadVideo=this.downloadVideo.bind(this),this.storeVideoTagParent=this.storeVideoTagParent.bind(this),this.onClickCloseIcon=this.onClickCloseIcon.bind(this),this.setPlaybackrate=this.setPlaybackrate.bind(this),this.toggleMoreOptions=this.toggleMoreOptions.bind(this),this.togglePlayBackOptions=this.togglePlayBackOptions.bind(this),this.hidePopupOptions=this.hidePopupOptions.bind(this)}return n&&(e.__proto__=n),((e.prototype=Object.create(n&&n.prototype)).constructor=e).prototype.componentWillUnmount=function(){window.removeEventListener("keydown",this.escEventListener),window.removeEventListener("keydown",this.toggleVideoPlay),this.props.popout&&document.removeEventListener("mouseup",this.handleResizeDrag),"paused"!=this.state.videostate&&this.videosourcenode.pause(),this.props.config.handleVideoNode||(this.videosourcenode.srcObject=null,this.videosourcenode.src=null,this.videosourcenode.removeAttribute("src"),this.videosourcenode.load()),this.fullscreen.removeEventListener(),this.activeelement.focus()},e.prototype.getPlayerType=function(){return-1<this.props.videotype.indexOf("audio")?"audio":"video"},e.prototype.storeVideoTagParent=function(e){this.videotagcontainer=e},e.prototype.hidePopupOptions=function(){this.setState({moreoptionsvisible:!1,playbackratevisible:!1})},e.prototype.calcBufferPercentage=function(){if(this.videosourcenode){var e=0,t=0,s=this.videosourcenode.buffered,i=this.videosourcenode.currentTime;if(2<=this.videosourcenode.readyState){for(var n=0;n<s.length;n++)if(i>=s.start(n)&&i<=s.end(n)){t=n;break}e=s.end(t)/(this.props.duration||this.videosourcenode.duration)}this.setState({bufferpercentage:e})}},e.prototype.componentDidMount=function(){var e,t;!this.props.videosrc&&this.props.config.handleVideoNode&&(this.videosourcenode=(e=this.props.videoid,t=this.playertype,ta[e]||function(e,t){return ta[e]=Oi("audio"==t?"audio":"video"),ta[e]}(e,t))),this.fullscreen=new Xn(this.videoplayernode,this.onFullScreenChange),this.activeelement=document.activeElement,window.addEventListener("keydown",this.escEventListener),!this.props.current_time&&0!==this.props.current_time||(this.videoplayernode.focus(),this.videosourcenode.currentTime=this.props.current_time,"paused"===this.props.videostate?this.videosourcenode.pause():"playing"===this.props.videostate&&this.videosourcenode.play()),this.props.theatremode&&window.addEventListener("keydown",this.toggleVideoPlay),this.props.popout&&(new Jn(this.videoplayernode,null,this.handleDragEnd),document.addEventListener("mouseup",this.handleResizeDrag,!0),this.setState({displayminiplayer:!0})),1!=this.props.config.theatremode?(null!=this.props.volume&&this.setVolume(this.props.volume),1!=this.props.config.miniplayer?(!this.props.videosrc&&this.props.config.handleVideoNode&&(this.videotagcontainer.appendChild(this.videosourcenode),this.setVideoTagEvents(),this.videosourcenode.src||this.props.config.handleVideoNode(this.videosourcenode)),this.props.playbackrate&&(this.videosourcenode.playbackRate=this.props.playbackrate)):this.toggleMiniPlayer(null,!0)):this.toggleTheatreMode(null,!1)},e.prototype.setVideoTagEvents=function(){if(this.videosourcenode.autoplay=!0,this.getPosterUrl()&&(this.videosourcenode.poster=this.getPosterUrl()),this.videosourcenode.onloadstart=this.setLoadingState,this.videosourcenode.onwaiting=this.setLoadingState,this.videosourcenode.onprogress=this.calcBufferPercentage,this.videosourcenode.className=Ln.video_content,this.videosourcenode.onended=this.onVideoEnd,this.videosourcenode.ontimeupdate=this.updateTime,this.videosourcenode.onerror=this.throwVideoError,"audio"==this.playertype){var e=this.props.videostate?this.props.videostate:"playing";this.setState({videostate:e})}},e.prototype.playerMouseOut=function(e){e.relatedTarget.closest("div[data-playerparent=true]")||this.setState({displayopacity:""})},e.prototype.detailsTransitionEnd=function(e){"playerdetails"===e.srcElement.getAttribute("data-id")&&""==this.state.displayopacity&&this.setState({display:"none"})},e.prototype.displayPlayerDetails=function(){this.videoplayernode&&(this.setState({displayopacity:Ln.displaydetails,display:"block"}),clearTimeout(this.timeout),this.timeout=setTimeout(function(){this.setState({displayopacity:""})}.bind(this),2500))},e.prototype.escEventListener=function(e){var t=0;27===e.keyCode&&this.props.theatremode&&(this.toggleTheatreMode(e),this.props.config.onComponentClose&&this.props.config.onComponentClose()),39==e.keyCode&&this.props.theatremode?((t=this.state.current_time+5)>this.state.duration&&(t=this.state.duration),this.updateCurrentTime(t)):37==e.keyCode&&this.props.theatremode&&((t=this.state.current_time-5)<0&&(t=0),this.updateCurrentTime(t))},e.prototype.resizeMiniPlayer=function(e){var t=this.videoplayernode.getBoundingClientRect().y;t=0<t?t:0;var s=(0<e.clientY?e.clientY:0)-t,i=1.7*(s=300<(s=0<s?this.videoplayernode.offsetHeight-s:this.videoplayernode.offsetHeight+Math.abs(s))?s:300);i=500<i?i:500,this.setState({miniplayerinlinestyle:{height:s+"px",width:i+"px"}}),e.stopPropagation(),e.preventDefault()},e.prototype.handleResizeDrag=function(e){"mousedown"==e.type&&(document.addEventListener("mousemove",this.resizeMiniPlayer),e.stopPropagation(),e.preventDefault()),"mouseup"==e.type&&document.removeEventListener("mousemove",this.resizeMiniPlayer)},e.prototype.handleDragEnd=function(){"playing"===this.state.videostate&&this.videosourcenode.play()},e.prototype.toggleMiniPlayer=function(e){if(!e||"click"==e.type||"ended"!==this.state.videostate){var t=!0;this.videosourcenode.currentTime=0,this.videosourcenode.pause(),this.props.popout&&(t=!1),this.props.theatremode&&this.toggleTheatreMode(e,"pausepreviousplayer"),this.props.toggleMiniPlayer(this.props.videosrc,this.state.current_time,t,this.state.videostate,this.state.volume,this.state.duration,this.props.videoname,this.props.videotype,this.props.uploadername,this.props.zindex,this.props.videoid,this.state.playbackrate,this.props.config),this.setState({videostate:"paused"}),e&&(e.preventDefault(),e.stopPropagation())}},e.prototype.toggleTheatreMode=function(e,t){var s=!0;this.videosourcenode.currentTime=0,this.videosourcenode.pause(),this.props.theatremode&&(s=!1),this.props.toggleTheatreView(this.props.videosrc,this.state.current_time,s,this.videoplayernode,this.state.videostate,this.state.volume,this.state.duration,this.props.videoname,this.props.videotype,this.props.uploadername,this.props.zindex,this.props.videoid,this.state.playbackrate,this.props.config),t||this.setState({videostate:"paused"}),e&&(e.preventDefault(),e.stopPropagation())},e.prototype.updateTime=function(){if(this.videosourcenode&&2<this.videosourcenode.readyState){0===this.state.bufferpercentage&&this.calcBufferPercentage();var e=this.state.videostate;"ended"==this.state.videostate?e="paused":"loading"==this.state.videostate&&(e="playing");var t="";t=this.props.duration?this.props.duration:isFinite(this.videosourcenode.duration)?this.videosourcenode.duration:0,this.setState({current_time:this.videosourcenode.currentTime,duration:t,videostate:e})}},e.prototype.setVideoSourceNode=function(e){this.videosourcenode=e},e.prototype.setVolume=function(e){e=Math.round(100*parseFloat(e))/100,this.setState({volume:e}),this.videosourcenode.volume=e},e.prototype.setVideoPlayerNode=function(e){this.videoplayernode=e},e.prototype.updateCurrentTime=function(e){this.setState({current_time:e}),this.videosourcenode.currentTime=e},e.prototype.onFullScreenChange=function(){this.videoplayernode&&this.videoplayernode.focus(),this.setState({fullscreen:!this.state.fullscreen})},e.prototype.toggleFullScreen=function(){this.fullscreen.toggleFullScreen()},e.prototype.toggleVideoPlay=function(e){if("error"!=this.state.videostate)if("true"!==this.videoplayernode.getAttribute("data-drag")){if("loading"!=this.state.videostate||"audio"==this.playertype)if("click"===e.type||"keydown"===e.type&&32===e.keyCode){var t=null;if(this.videosourcenode.paused)this.videosourcenode.play(),t="playing",this.props.pauseRemainingInstances&&this.props.pauseRemainingInstances(e);else if(this.videosourcenode.play){if(0==this.videosourcenode.readyState&&"audio"!=this.playertype)return;this.videosourcenode.pause(),t="paused"}this.setState({videostate:t})}else"keydown"==e.type&&82==e.keyCode&&this.retryPlayingVideo()}else this.videoplayernode.setAttribute("data-drag","false")},e.prototype.onVideoEnd=function(){this.videosourcenode.ended&&this.setState({videostate:"ended",current_time:this.props.duration||this.videosourcenode.duration})},e.prototype.ffVideo=function(e){("click"==e.type||"keydown"==e.type&&13==e.keyCode)&&(this.updateCurrentTime(this.state.current_time+5),e.stopPropagation(),e.preventDefault())},e.prototype.rewVideo=function(e){("click"==e.type||"keydown"==e.type&&13==e.keyCode)&&(this.updateCurrentTime(this.state.current_time-5),e.stopPropagation(),e.preventDefault())},e.prototype.setLoadingState=function(e){"playing"==this.state.videostate&&this.setState({videostate:"loading"}),e.stopPropagation(),e.preventDefault()},e.prototype.throwVideoError=function(e){e.target&&e.target.error&&(this.videosourcenode.pause(),this.setState({videostate:"error"}))},e.prototype.retryPlayingVideo=function(){this.videosourcenode&&this.videosourcenode.load(),this.setState({videostate:"playing"})},e.prototype.downloadVideo=function(e){hn(this.props.videosrc||this.videosourcenode.src)&&(e.stopPropagation(),e.stopPropagation())},e.prototype.onClickCloseIcon=function(e){var t;this.props.theatremode?this.toggleTheatreMode(e):this.props.popout&&this.toggleMiniPlayer(e),this.props.config&&this.props.config.onComponentClose&&this.props.config.onComponentClose(),this.props.config.handleVideoNode&&(t=this.props.videoid,ta[t]&&(ta[t].srcObject=null,ta[t].src=null,ta[t].removeAttribute("src"),delete ta[t]))},e.prototype.getPosterUrl=function(){return this.props.poster&&!this.props.config.isguestuser&&(-1<this.props.poster.indexOf(encodeURIComponent("{thumbnail:true}"))||-1<this.props.poster.indexOf(encodeURIComponent('{"thumbnail":true}')))?this.props.poster:""},e.prototype.setPlaybackrate=function(e){this.videosourcenode.playbackRate=e,this.setState({playbackrate:e})},e.prototype.toggleMoreOptions=function(e){this.setState({moreoptionsvisible:!this.state.moreoptionsvisible,playbackratevisible:!1}),this.props.closePopupOptions&&this.props.closePopupOptions(),"A"!=e.target.tagName&&(e.stopPropagation(),e.preventDefault())},e.prototype.togglePlayBackOptions=function(e){this.setState({moreoptionsvisible:!1,playbackratevisible:!this.state.playbackratevisible}),this.props.closePopupOptions&&this.props.closePopupOptions(),e.stopPropagation(),e.preventDefault()},e.prototype.render=function(e,t){var s="vidplayer",i="",n="",a="ea1b",o=Ln.videodesc,r=Ln.playpausecontainer,l=null,d=null,c=Ln.iconsmall,m=Ln.popedin,u="",p="",h="",g=$("videoplayer.pause"),f="",C="",v="",b="",y="",_=null,W=null;"playing"===t.videostate&&(a="ea12"),"ended"===t.videostate&&(a="ea17",h=Ln.videoend_details,g=$("videoplayer.replay"),y=Ln.replayicon),"paused"===t.videostate&&(h=Ln.videoend_details,g=$("videoplayer.play")),"error"===t.videostate&&(h=Ln.videoend_details),this.props.popout&&(d=k(R,{classname:Ln.closeicon+" "+Ln.iconsmall,type:"icon",title:$("Close"),content:"e9ee",onclick:this.onClickCloseIcon}),i=Ln.playerpopout,n={"z-index":e.zindex,height:t.miniplayerinlinestyle.height,width:t.miniplayerinlinestyle.width}),(!t.fullscreen&&e.theatremode||t.fullscreen)&&(r=r+" "+Ln.fullscreenplaypause,o=o+" "+Ln.videodesc_theatremode,c=Ln.iconlarge,f=k("div",{class:Ln.ffbuttoncontainer,onclick:this.ffVideo,onkeydown:this.ffVideo,tabindex:"0"},k(R,{type:"icon",classname:Ln.iconlarge+" "+Ln.ffbutton,content:"ea14",tabindex:"-1"})),C=k("div",{class:Ln.ffbuttoncontainer,onclick:this.rewVideo,onkeydown:this.rewVideo,tabindex:"0"},k(R,{type:"icon",classname:Ln.iconlarge+" "+Ln.rewbutton,content:"ea0c",tabindex:"-1"}))),!t.fullscreen&&e.theatremode&&(l=k(R,{classname:Ln.closeicon+" "+Ln.iconmed,type:"icon",title:$("Close"),content:"e9ee",onclick:this.onClickCloseIcon}),s="wms_theatremode",i=Ln.theatremode,m="",n={"z-index":e.zindex});var S=k("video",{autoplay:!0,onloadstart:this.setLoadingState,onwaiting:this.setLoadingState,preload:"none",onprogress:this.calcBufferPercentage,poster:this.getPosterUrl(),class:Ln.video_content,ref:this.setVideoSourceNode,onended:this.onVideoEnd,src:e.videosrc,ontimeupdate:this.updateTime,onerror:this.throwVideoError}),w="",M="";if("audio"==this.playertype&&(S=k("audio",{onloadstart:this.setLoadingState,onwaiting:this.setLoadingState,preload:"none",onprogress:this.calcBufferPercentage,poster:this.getPosterUrl(),class:Ln.video_content,ref:this.setVideoSourceNode,onended:this.onVideoEnd,src:e.videosrc,ontimeupdate:this.updateTime,onerror:this.throwVideoError}),w=" "+Ln.audioplayerbg,r+=" "+Ln.audioplayerplaypause,M+=" "+Ln.basiccontrolsposition,h=" "+Ln.videoend_details),e.config.handleVideoNode&&(S=null),e.popout&&(s="wms_playerpopout",m="",_="audio"!=this.playertype?k("div",{class:Ln.expander,onmousedown:this.handleResizeDrag}):null),t.displayminiplayer&&(p=Ln.displayminiplayer),"none"===t.display&&(u=Ln.display),"loading"==this.state.videostate?b="audio"==this.playertype?k("div",{key:"loader",class:Ln.basic_controlscontainer+M},k("div",{class:r,title:$("videoplayer.pause"),onclick:this.toggleVideoPlay},k("div",{class:Ln.loadingdiv}),k(R,{classname:c+" "+Ln.videomodeplayicon+" "+y,type:"icon",tabindex:"-1",content:"ea12"}))):k("div",{key:"loader",class:Ln.basic_controlscontainer+M},k("div",{class:r},k("div",{class:Ln.loadingdiv}))):"error"!=t.videostate&&(v=k("div",{key:"controls",class:Ln.basic_controlscontainer+M},C,k("div",{class:r,title:g,onclick:this.toggleVideoPlay},k(R,{classname:c+" "+Ln.videomodeplayicon+" "+y,type:"icon",tabindex:"-1",content:a})),f)),"error"==t.videostate){var I=e.theatremode||e.fullscreen||e.popout?Ln.errorcontainerbig:"";W=k("div",{class:Ln.basic_controlscontainer+" "+Ln.errorcontainer+" "+I},k("div",{class:Ln.errorcontainerdata},k(R,{classname:Ln.erroricon,type:"icon",content:"e675"}),k("div",{class:Ln.errormessage},$("videoplayer.error")),k("div",{class:Ln.erroractions},k(R,{classname:Ln.retry,type:"button",content:$("videoplayer.tryagain"),onclick:this.retryPlayingVideo}),k("span",{class:Ln.dot}),k("a",{style:{"text-decoration":"none"},download:"true",target:"_blank",href:e.videosrc},k(R,{classname:Ln.errordownload,type:"button",content:$("chat.download")})))))}return k("div",{tabindex:"0",ref:this.setVideoPlayerNode,id:s,class:Ln.playerparent_container+" "+m+" "+t.displayopacity+" "+i+" "+p+" "+h,"data-playerparent":"true","data-playertype":"audio"==this.playertype?"audio":"video",style:n,onmousemove:this.throttle,mouseout:this.playerMouseOut,onclick:this.displayPlayerDetails},k("div",{dangerouslySetInnerHTML:S?null:e.videoid,ref:this.storeVideoTagParent,"data-id":"videoplayer",class:Ln.videoplayer_container+w,onclick:this.toggleVideoPlay},S),b,W,k("div",{key:"playerdetails","data-id":"playerdetails",class:u+" "+Ln.details,ontransitionend:this.detailsTransitionEnd},k("div",{class:Ln.header},k("div",{class:Ln.topgradiant}),k("div",{class:o},k("span",{title:e.videoname},e.videoname)),d,l),v,k(Fn,{fullscreen:t.fullscreen,toggleFullScreen:this.toggleFullScreen,setVolume:this.setVolume,volume:t.volume,current_time:t.current_time,duration:t.duration,updateCurrentTime:this.updateCurrentTime,renderSettings:this.renderSettings,bufferpercentage:t.bufferpercentage,popout:this.props.popout,toggleMiniPlayer:this.toggleMiniPlayer,theatremode:e.theatremode,toggleTheatreMode:this.toggleTheatreMode,videoplayernode:this.videoplayernode,forwardAttachment:e.forwardAttachment,videosrc:e.videosrc,config:e.config,videostate:t.videostate,downloadVideo:this.downloadVideo,playertype:this.playertype,playbackrate:this.state.playbackrate,playbackrateCallback:this.setPlaybackrate,moreoptionsvisible:this.state.moreoptionsvisible,playbackratevisible:this.state.playbackratevisible,toggleMoreOptions:this.toggleMoreOptions,togglePlayBackOptions:this.togglePlayBackOptions})),_)},e}(M);Qn.prototype.forwardAttachmentCallBack=function(){this.forwardAttachment()},Qn.prototype.invokeToggleMiniPlayer=function(e){this.instance&&"playing"===this.instance.state.videostate&&"audio"!=this.instance.playertype&&this.instance.toggleMiniPlayer(e)},Qn.prototype.toggleTheatreModeOverlay=function(e,t){if(e){var s=Oi("div","wms_theatremode_overlay",Ln.theatremode_overlay);s.style.zIndex=t,document.body.appendChild(s)}else Fi(document.getElementById("wms_theatremode_overlay"))},Qn.prototype.toggleTheatreView=function(e,t,s,i,n,a,o,r,l,d,c,m,u,p){this.toggleTheatreModeOverlay(s,c);var h=document.getElementById("wms_theatre_mountpoint");if(h||(h=Oi("div","wms_theatre_mountpoint"),document.body.appendChild(h)),s){1==p.theatremode&&(p.theatremode=!1,this.unmountComponent());var g=k(ea,{ref:function(e){this.storeTheatremodeInstance(e)}.bind(this),videosrc:e,current_time:t,videostate:n,volume:a,duration:o,videoname:r,videotype:l,uploadername:d,theatremode:s,zindex:c,videoid:m,toggleTheatreView:this.toggleTheatreView,toggleMiniPlayer:this.toggleMiniPlayer,forwardAttachment:this.forwardAttachmentCallBack,playbackrate:u,config:p});if(this.unmountComponent(),document.getElementById("wms_popout_mountpoint")){var f=document.getElementById("wms_popout_mountpoint");O("",f),Fi(f)}O(g,h)}else O(null,h),Fi(h)},Qn.prototype.toggleMiniPlayer=function(e,t,s,i,n,a,o,r,l,d,c,m,u){var p=document.getElementById("wms_popout_mountpoint");if(p||(p=Oi("div","wms_popout_mountpoint"),document.body.appendChild(p)),1==u.miniplayer&&(u.miniplayer=!1,this.unmountComponent()),s){var h=k(ea,{ref:function(e){this.storeMiniPlayerInstance(e)}.bind(this),class:Ln.name,key:e,videosrc:e,current_time:t,videostate:i,volume:n,duration:a,videoname:o,videotype:r,uploadername:l,popout:s,zindex:d,videoid:c,toggleMiniPlayer:this.toggleMiniPlayer,toggleTheatreView:this.toggleTheatreView,forwardAttachment:this.forwardAttachmentCallBack,playbackrate:m,config:u});this.unmountComponent(),document.getElementById("wms_popout_mountpoint")&&O("",document.getElementById("wms_popout_mountpoint")),O(h,p)}else O(null,p),Fi(p),this.storeMiniPlayerInstance(null)},Qn.prototype.createOverlay=function(){this.poster=this.poster||"";var e=this.createInitialState(this.poster,this.config);this.node.innerHTML=e},Qn.prototype.createInitialState=function(e,t){var s="<img class='{{posterclass}}' src='{{posterurl}}'>";-1===e.indexOf(encodeURIComponent("{thumbnail:true}"))&&-1===e.indexOf(encodeURIComponent('{"thumbnail":true}'))&&-1===e.indexOf("/thumbnail")&&(t&&!t.isguestuser||t&&!t.customposter||!t)&&(s="");var i=e.replace("&x-cli-msg="+encodeURIComponent("{thumbnail:true}"),"");i=(i=i.replace("&x-cli-msg="+encodeURIComponent('{"thumbnail":true}'),"")).replace("/thumbnail",""),t&&t.isguestuser&&(i=t.videourl);var n="<div class='{{forwardiconcontainer}}' title='{{forwardtitle}}' data-filefrwrd=true><div class='{{forwardicon}}' data-id=fwdicon></div></div>";t&&1==t.hideforwardicon&&(n="");var a="<a download target='_blank' href='{{videourl}}'><span class='{{downloadicon}}'></span></a>";return pn()&&(a='<a documentclick="attdownload" data-documentclick="attdownload" href="{{videourl}}" target="_blank" src="{{videourl}}"><span class="{{downloadicon}}"></span></a>'),Hs("<div class='{{overlayclass}}' data-id=initialovrlay>"+s+"<div class='{{playpauseclass}}' data-id=playbtncontainer title='{{playicontitle}}'><div class='{{playicon}}' data-id=playicon></div></div> <div class='{{actionscontainer}}'>"+n+"<div class='{{downloadiconcontainer}}' data-filedownload=true title='{{downloadtitle}}'> "+a+"</div></div></div>",{overlayclass:Ln.playeroverlay,posterclass:Ln.posterimage,posterurl:e,playpauseclass:Ln.playpauseinitial,playicon:Ln.playicon,forwardiconcontainer:Ln.forwardiconcontainer,forwardicon:Ln.forwardicon,videourl:i,downloadiconcontainer:Ln.downloadiconcontainer,downloadicon:Ln.overlaydownloadicon,actionscontainer:Ln.actionscontainer,$forwardtitle:"chat.forward",$downloadtitle:"chat.download",$playicontitle:"videoplayer.play"})},Qn.prototype.pauseRemainingInstances=function(e){this.pauseVideosCallback&&this.pauseVideosCallback(this.instance,e)},Qn.prototype.pauseVideoPlayer=function(e){this.instance&&"playing"==this.instance.state.videostate&&this.instance.toggleVideoPlay(e)},Qn.prototype.closePopupOptions=function(){this.closeOtherPopupOptions&&this.closeOtherPopupOptions(this.videoid)},Qn.prototype.closeCurrentPopupOption=function(){this.instance&&(this.instance.state.moreoptionsvisible||this.instance.state.playbackratevisible)&&this.instance.hidePopupOptions()},Qn.prototype.mountComponent=function(e,t,s,i,n,a,o,r,l,d,c,m,u,p,h){this.node=e,this.poster=a,this.node.removeChild(this.node.childNodes[0]),this.forwardAttachment=l,this.onComponentUnmount=d,this.pauseVideosCallback=c,this.storeMiniPlayerInstance=m,this.storeTheatremodeInstance=u,this.closeOtherPopupOptions=p,this.videoid=r,this.config=h,O(k(ea,{ref:function(e){this.instance=e}.bind(this),videosrc:t,videotype:s,videoname:i,videostate:h.videostate,uploadername:n,poster:a,zindex:o,videoid:r,duration:this.config.duration,toggleMiniPlayer:this.toggleMiniPlayer,toggleTheatreView:this.toggleTheatreView,forwardAttachment:this.forwardAttachmentCallBack,pauseRemainingInstances:this.pauseRemainingInstances,closePopupOptions:this.closePopupOptions,config:this.config}),this.node)},Qn.prototype.unmountComponent=function(){this.onComponentUnmount(this.videoid),O("",this.node),this.createOverlay()},Qn.prototype.removeComponent=function(){this.onComponentUnmount(this.videoid),O("",this.node)};var ta={};var sa={},ia=null,na=null;function aa(e){for(var t in sa)if(sa[t][e]){delete sa[t][e];break}}var oa={create:function(e,t,s,i,n,a,o,r,l,d,c,m,u){if(!(u&&u.handleVideoNode&&ia&&ia.props.videoid==m)){var p=new $WC.VideoPlayer;sa[e]||(sa[e]={},Ri(t,"scroll",Bi(ra,e,70))),la(sa[e][m]=p,c),p.mountComponent(s,i,n,a,o,r,l,m,d,aa,la,ca,ma,da,u)}},removeSpecificComponent:function(e,t){sa[e]&&sa[e][t]&&(sa[e][t].removeComponent(),delete sa[e][t],sa[e]&&!Object.keys(sa[e]).length&&delete sa[e])},removeAllComponents:function(e){if(sa[e]){for(var t in sa[e])sa[e][t].unmountComponent();delete sa[e]}},removeExternalVideoPlayers:function(e){ia&&ia.props.videoid==e&&ia.props.toggleMiniPlayer(null,null,!1),na&&na.props.videoid==e&&na.props.toggleTheatreView(null,null,!1)}};function ra(e){for(var t in sa[this]){var s=sa[this][t];Ii(s.node,e.target,!0)||s.invokeToggleMiniPlayer(e)}}function la(e,t){for(var s in sa)for(var i in sa[s])e!=sa[s][i]&&sa[s][i].pauseVideoPlayer(t);ia&&"playing"==ia.state.videostate&&ia.toggleVideoPlay(t)}function da(e){for(var t in sa)for(var s in sa[t])e!=s&&sa[t][s].closeCurrentPopupOption()}function ca(e){ia=e}function ma(e){na=e}var ua={},pa=[];function ha(e){return e?ua[e]:ua}function ga(e){var t=JSON.parse(e).data,s=t&&t.chats;if(s&&s.length)for(var i=0;i<s.length;){if("11"!=s[i].chat_type){"8"==s[i].chat_type&&Gr(s[i]);var n={};n.ADDINFO=s[i].addinfo,n.CHATID=s[i].chatid,n.LASTMSGINFO=s[i].lastmsginfo&&JSON.parse(s[i].lastmsginfo),n.PARTICIPANTS=s[i].recipants&&JSON.parse(s[i].recipants)||[],n.PARTICIPANTSCOUNT=s[i].pcount,n.LMTIME=s[i].lmtime,n.TITLE=s[i].title,n.CTYPE=s[i].chat_type,n.MUTEDINTERVAL=s[i].mutedinterval,ua[s[i].chatid]=n}i++}this.opts.callbackargs&&this.opts.callbackargs.params&&pa.push(this.opts.callbackargs.params);var a=this.opts.callbackargs&&this.opts.callbackargs.reqid,o=this.opts.callbackargs&&this.opts.callbackargs.topicname;o?Si.publish("/chatlist/"+o,{callbackargs:this.opts.callbackargs}):Si.publish("/chatlist/updateui",{reqid:a,callbackargs:this.opts.callbackargs})}function fa(){var e=this.opts.callbackargs&&this.opts.callbackargs.reqid;Si.publish("/chatlist/updateui",{reqid:e,stat:He.REQSTATUS.FAILED})}function Ca(e){return-1!==pa.indexOf(va(e))}function va(e){var t="limit=10";return t+=e?"&title="+e:""}function ba(e,t){var s=e.searchtext,i=va(s),n=e.topicname,a=e.silentload,o=e.chid;-1===pa.indexOf(i)?Ie("v1/chats",i,ga,fa,{reqid:t,params:i,topicname:n,chid:o,silentload:a,searchtext:s},null,{"X-XHR-exception":"true","X-ZCSRF-TOKEN":ci()}):n?Si.publish("/chatlist/"+n,{reqid:t,callbackargs:e}):Si.publish("/chatlist/updateui",{reqid:t})}var ya=Object.freeze({__proto__:null,get:ha,updateList:ga,handleFailure:fa,getList:function(e){return e?bo("TITLE",e,ua):ua},isCachedRequest:Ca,_constructParams:va,fetchFromServer:ba,updateTitle:function(e,t){var s=ha(e);s&&(s.TITLE=t)},updateAddinfoData:function(e,t){var s=ha(e);s&&(s.ADDINFO=s.ADDINFO?s.ADDINFO+":"+t:t)},updatePartCount:function(e,t,s){var i=ha(e);if(i){var n=parseInt(i.PARTICIPANTSCOUNT);i.PARTICIPANTSCOUNT=s?n+t:n-t}}}),_a={listItems:"mc118439ee_listItems",listimgcontainer:"mc118439ee_listimgcontainer",default_img:"mc118439ee_default_img",wms_channelimg_badge:"wms_channelimg_badge",virtuallist:"mc118439ee_virtuallist",listimgstatus:"mc118439ee_listimgstatus",listinfocontainer:"mc118439ee_listinfocontainer",listinfotitle:"mc118439ee_listinfotitle",listinfoheader:"mc118439ee_listinfoheader",header:"mc118439ee_header",listinfodesc:"mc118439ee_listinfodesc",listContainer:"mc118439ee_listContainer",listContainerHeader:"mc118439ee_listContainerHeader",listContainerWrapper:"mc118439ee_listContainerWrapper",listwrapper:"mc118439ee_listwrapper",searchBox:"mc118439ee_searchBox",searchIcon:"mc118439ee_searchIcon",searchinputwrapper:"mc118439ee_searchinputwrapper",searchBoxInput:"mc118439ee_searchBoxInput",titlewrapper:"mc118439ee_titlewrapper",listContainerClose:"mc118439ee_listContainerClose",listContainerFooter:"mc118439ee_listContainerFooter",container:"mc118439ee_container",infotext:"mc118439ee_infotext",loading:"mc118439ee_loading",optionscontainer:"mc118439ee_optionscontainer",optionswrapper:"mc118439ee_optionswrapper",optionsitem:"mc118439ee_optionsitem",valign_mid_block:"mc118439ee_valign_mid_block",listselected:"mc118439ee_listselected",zmNightMode:"zmNightMode",badgeimg:"mc118439ee_badgeimg",loading_container:"mc118439ee_loading_container",hvalign:"mc118439ee_hvalign",error_info:"mc118439ee_error_info",error_img:"mc118439ee_error_img",infotxt:"mc118439ee_infotxt",infotext_1:"mc118439ee_infotext_1",infotext_2:"mc118439ee_infotext_2",hv_align:"mc118439ee_hv_align",descloading:"mc118439ee_descloading",wrapperminheight:"mc118439ee_wrapperminheight"},Wa=function(t){function e(e){t.call(this,e),this.setListNode=this.setListNode.bind(this),this.toggleOptionsContainer=this.toggleOptionsContainer.bind(this),this.hoverOff=this.hoverOff.bind(this),this.listnode=null,this.state={image_loaded:!1,show_options:!1}}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.setListNode=function(e){this.listnode=e},e.prototype.selectListItem=function(e,t){if(this.props.onListItemClicked){var s=Ei(t);this.props.onListItemClicked(e,s,t)}},e.prototype.toggleOptionsContainer=function(){this.setState({show_options:!this.state.show_options})},e.prototype.hoverOff=function(){this.state.show_options&&this.setState({show_options:!1})},e.prototype.componentDidUpdate=function(){this.props.setFocussedNode&&this.props.setFocussedNode(this.props.item,this.listnode)},e.prototype.render=function(e){var t=e.item;if("loading"===t.id)return k("div",{class:_a.listItems+" "+_a.hvalign},k("div",{class:_a.loading_container},k("div",null),k("div",null),k("div",null)));var s=k("div",{class:_a.default_img});if(t.empty_img?s="":t.badge_img?s=k("div",{class:_a.badgeimg},t.badge_letter):this.state.image_loaded&&(s=k("img",{"data-zcprofileid":t.id,src:t.imgsrc})),!this.state.image_loaded&&t.imgsrc){var i=new Image;i.src=t.imgsrc,i.onload=function(){this.setState({image_loaded:!0})}.bind(this)}var n=t.classname?t.classname:"",a=t.classname&&bs(t.id)?k("span",{class:"wms_badge_img_cutout wms_badge_statusicon_"+bs(t.id)+"_cutout"}):null;a=t.threadicon?k("span",{class:"wms_badge_img_cutout wms_badge_statusicon_"+t.threadicon+"_cutout"}):a;var o=t.empty_img&&!t.fonticon_class?"":_a.listimgcontainer+" "+n,r=t.desc||t.htmldesc?"":_a.valign_mid_block,l=_a.listinfocontainer+" "+r+" ";e.customlistitemstyles&&e.customlistitemstyles.listinfoContainerStyle&&(l+=e.customlistitemstyles.listinfoContainerStyle);var d=null;this.state.show_options&&(d=t.options.map(function(e){return k("div",{key:e.name,"data-operation":e.operation,class:_a.optionsitem},e.name)}),d=k("div",{class:_a.optionswrapper}," ",d," "));var c=t.options?k("div",{class:_a.optionscontainer,onclick:this.toggleOptionsContainer},d):null,m="loading"==t.desc?_a.descloading:"",u=k("div",{class:_a.listinfodesc+" "+m},t.desc);t.htmldesc&&(u=k("div",{class:_a.listinfodesc,dangerouslySetInnerHTML:{__html:t.htmldesc}}));var p=e.customlistitemstyles&&e.customlistitemstyles.customContainerStyles?e.customlistitemstyles.customContainerStyles:_a.listItems;p+=t.listheader?" "+_a.listinfoheader:"",p+=e.isfocussed?" "+_a.listselected:"";var h=null;return e.customlistitemprops&&e.customlistitemprops.listitemhoverdetails&&e.customlistitemprops.gethoverdetailscontainer&&(h=k("div",{class:_a.hoverdetails},e.customlistitemprops.gethoverdetailscontainer(t))),k("div",{ref:this.setListNode,class:p,onclick:this.selectListItem.bind(this,t),onMouseLeave:this.hoverOff},k("div",{class:o},s,a),k("div",{class:l},k("div",{"data-zcprofileid":t.id,class:_a.listinfotitle},t.title),u),c,h)},e}(M);var Sa=function(e){function t(){e.call(this),this.resize=this.resize.bind(this),this.handleScroll=this.handleScroll.bind(this)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.resize=function(){this.state.height!==this.base.offsetHeight&&this.setState({height:this.base.offsetHeight})},t.prototype.handleScroll=function(){this.setState({offset:this.base.scrollTop}),this.props.sync&&this.forceUpdate()},t.prototype.componentDidUpdate=function(){this.resize()},t.prototype.componentDidMount=function(){this.resize(),addEventListener("resize",this.resize)},t.prototype.componentWillUnmount=function(){removeEventListener("resize",this.resize)},t.prototype.render=function(e,t){var s=e.data,i=e.rowHeight,n=e.renderRow,a=e.overscanCount;void 0===a&&(a=10);e.sync;var o=e.headerItemsCount,r=e.headerItemHeight,l=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&-1===t.indexOf(i)&&(s[i]=e[i]);return s}(e,["data","rowHeight","renderRow","overscanCount","sync","headerItemsCount","headerItemHeight"]),d=t.offset;void 0===d&&(d=0);var c=t.height;void 0===c&&(c=0);var m=d/i|0,u=c/i|0;a&&(m=Math.max(0,m-m%a),u+=a);var p=m+1+u,h=s.slice(m,p);o=o||0;var g=(s.length-o)*i+o*r;return k("div",Object.assign({},{onScroll:this.handleScroll},l),k("div",{style:"position:relative; overflow:hidden; width:100%; min-height:100%; height:"+g+"px;"},k("div",{style:"position:absolute; top:0; left:0; height:100%; width:100%; overflow:visible; top:"+m*i+"px;"},h.map(n))))},t}(M),wa=function(t){function e(e){t.call(this,e),this.navigateListItems=this.navigateListItems.bind(this),this.setFocussedNode=this.setFocussedNode.bind(this),this.isListItemFocussed=this.isListItemFocussed.bind(this),this.setListContainer=this.setListContainer.bind(this),this.curr_index_onfocus=0,this.isKeyPressed=!1,this.focussednode=null,this.containernode=null}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.setListContainer=function(e){this.containernode=e},e.prototype.setFocussedNode=function(e,t){this.props.list[this.curr_index_onfocus]===e&&(this.focussednode=t)},e.prototype.componentDidUpdate=function(){this.isKeyPressed&&(this.props.navigation_keycode===He.KEYCODES.ENTER&&this.props.onListItemClicked(this.props.list[this.curr_index_onfocus],this.focussednode),this.focussednode&&!en(this.focussednode,null,this.containernode.firstChild)&&tn(this.focussednode,null,null,this.containernode.firstChild),this.isKeyPressed=!1)},e.prototype.isListItemFocussed=function(e){return this.props.list[this.curr_index_onfocus]===e},e.prototype.renderRow=function(e){return k(Wa,{setFocussedNode:this.setFocussedNode,isfocussed:this.isListItemFocussed(e),key:e.id,item:e,onListItemClicked:this.props.onListItemClicked,customlistitemstyles:this.props.customlistitemstyles,customlistitemprops:this.props.customlistitemprops})},e.prototype.navigateListItems=function(){var e=this.props.list.length;this.props.navigation_keycode===He.KEYCODES.DOWN||this.props.navigation_keycode===He.KEYCODES.UP||this.props.navigation_keycode===He.KEYCODES.ENTER?(this.props.navigation_keycode===He.KEYCODES.DOWN&&this.curr_index_onfocus!=e-1?(this.curr_index_onfocus++,this.props.list[this.curr_index_onfocus].listheader&&this.curr_index_onfocus++):this.props.navigation_keycode===He.KEYCODES.UP&&0<this.curr_index_onfocus&&(this.curr_index_onfocus--,this.props.list[this.curr_index_onfocus].listheader&&this.curr_index_onfocus--),this.isKeyPressed=!0):(this.curr_index_onfocus=this.props.defaultselect?0:-1,this.props.list[this.curr_index_onfocus]&&this.props.list[this.curr_index_onfocus].listheader&&this.curr_index_onfocus++)},e.prototype.render=function(){var e=this.props.list.slice(),t=null,s=(this.props.customlistitemstyles&&this.props.customlistitemstyles.customListWrapper)+" "+_a.listwrapper;if(e.length<10&&!this.props.iscompletelist&&!this.props.isinitiallist&&e.push({id:"loading"}),e.length){this.navigateListItems();var i=this.props.customlistitemstyles&&this.props.customlistitemstyles.rowHeight||60,n=this.props.customlistitemstyles&&this.props.customlistitemstyles.headerItemHeight||53;t=k(Sa,{data:e,rowHeight:i,renderRow:this.renderRow.bind(this),overscanCount:20,class:_a.virtuallist,headerItemsCount:this.props.headerItemsCount,headerItemHeight:n})}else this.props.loadingstate?(s+=" "+_a.wrapperminheight,t=k("div",{class:_a.loading+" "+_a.hv_align})):this.props.selectedall?(s+=" "+_a.wrapperminheight,t=k("div",{class:_a.error_info+" "+_a.hv_align},k("div",{class:_a.infotxt},k("div",{class:_a.infotext_1},$("items.selection.none"))))):this.props.iscompletelist&&(s+=" "+_a.wrapperminheight,t=Ma());return k("div",{class:s,ref:this.setListContainer},t)},e}(M);function Ma(e){var t="https://img.zohocdn.com/ichat/images/bar/a9c2d1f2_search_empty.svg",s=e&&e.customstyles&&e.customstyles.infotext?e.customstyles.infotext:_a.infotxt,i=e&&e.customstyles&&e.customstyles.errorimg?e.customstyles.errorimg:_a.error_img;return k("div",{class:_a.error_info+" "+_a.hv_align},k("img",{class:i,src:t}),k("div",{class:s},k("div",{class:_a.infotext_1},$("search.noresult")),k("div",{class:_a.infotext_2},$("search.again"))))}function Ia(){}Ia.prototype.mountComponent=function(e,t,s,i,n){this.listContainerNode=n,O(k(wa,{list:e,onListItemClicked:t,loadingstate:s,customlistitemstyles:i}),this.listContainerNode)},Ia.prototype.unmountComponent=function(){O("",this.listContainerNode)};function Ta(){}var Aa=function(t){function e(e){t.call(this,e),this.setSearchTextInputNode=this.setSearchTextInputNode.bind(this),this.searchTextInputNode=null}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.setSearchTextInputNode=function(e){this.searchTextInputNode=e},e.prototype.componentDidMount=function(){this.searchTextInputNode.focus(),this.searchTextInputNode.value=""},e.prototype.componentDidUpdate=function(){this.searchTextInputNode.value=this.props.searchvalue?this.searchTextInputNode.value:this.props.searchvalue,this.searchTextInputNode.focus()},e.prototype.render=function(e){return k("div",{class:_a.searchBox+" "+(e.customsearchstyle&&e.customsearchstyle.searchcontainerstyle||"")},k("span",{class:_a.searchIcon}),k("div",{class:_a.searchinputwrapper},k("input",{class:_a.searchBoxInput+" "+(e.customsearchstyle&&e.customsearchstyle.searchinputstyle||""),ref:this.setSearchTextInputNode,"data-purpose":"search",type:"text",placeholder:this.props.searchplaceholder,oninput:this.props.componentid?this.props.handleChange.bind(this,this.props.componentid):this.props.handleChange,onkeydown:this.props.handleKeyPress})))},e}(M);Ta.prototype.mountComponent=function(e,t,s,i){this.searchContainerNode=i,O(k(Aa,{componentid:e,searchplaceholder:t,handleChange:s}),this.searchContainerNode)},Ta.prototype.unmountComponent=function(){O("",this.searchContainerNode)};function Ea(){this.instance=null}var Ua={zmNightMode:"zmNightMode",deletenode:"mc31303ae8_deletenode",alignend:"mc31303ae8_alignend",containerwrapper:"mc31303ae8_containerwrapper",imgwrapper:"mc31303ae8_imgwrapper",img:"mc31303ae8_img",container:"mc31303ae8_container",wms_badgeimg:"mc31303ae8_wms_badgeimg",destructive_button:"mc31303ae8_destructive_button",confirmation_button:"mc31303ae8_confirmation_button"},xa=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.render=function(){var e=this.props.selectedItems,i=this.props.fetchImageSource,t=e.map(function(e){var t=null,s=i(e);return t=s.imgsrc?k("img",{class:Ua.img,src:s.imgsrc}):s.fonticon_class?k("div",{class:s.fonticon_class}):k("div",{class:Ua.wms_badgeimg},s.badge_letter),k("div",{key:e,class:Ua.imgwrapper,onclick:this.props.removeSelectedItem.bind(this,e)},t,k("div",{class:Ua.deletenode}))}.bind(this));if(this.props.selectedItems.length){var s=this.props.actionCallback&&this.props.actionCallback.map(function(e,t){var s=e.buttonstyle?Ua[e.buttonstyle]:Ua.aligncenter,i=function(){e.onclick(this.props.selectedItems)}.bind(this);return k(R,{key:t,type:"button",content:e.text,classname:s,onclick:i})}.bind(this));return k("div",{class:Ua.containerwrapper},k("div",{class:Ua.container},t),s)}return null},t}(M),Na=function(s){function e(e){s.call(this,e),this.storeListInstance=this.props.storeListInstance,this.removeSelectedItem=this.removeSelectedItem.bind(this),this.handleMultipleItemsSelection=this.handleMultipleItemsSelection.bind(this),this.handleItemSelection=this.handleItemSelection.bind(this),this.initial_list=this.props.list,this.bulk_list=Mi({},this.props.list);var t=(this.headerItemsCount=0)!=e.sortonsearch;this.state={excluded_list:{},filtered_list:this.convertToArrayList(this.initial_list),sort_on_search:t,loading_state:this.props.loadingstate,iscompletelist:this.props.iscompletelist,searchtext:this.props.searchtext||"",navigation_keycode:""}}return s&&(e.__proto__=s),((e.prototype=Object.create(s&&s.prototype)).constructor=e).prototype.componentDidUpdate=function(e,t){e.loadingstate===this.props.loadingstate&&e.listid==this.props.listid&&e.forceupdateinitiallist==this.props.forceupdateinitiallist||this.updateList(this.props.list,null,this.props.iscompletelist),this.props.customsearch&&t.searchtext!==this.props.searchtext&&this.onSearch(null,this.props.searchtext)},e.prototype.componentWillUpdate=function(e){this.props.updateinitiallist&&(this.initial_list=Mi(this.initial_list,e.list),this.bulk_list=Mi(this.bulk_list,e.list)),e.searchtext&&this.props.searchtext!==e.searchtext&&(this.initial_list=Mi(this.initial_list,e.list),this.bulk_list=Mi(this.bulk_list,e.list),this.onSearch(null,e.searchtext))},e.prototype.componentDidMount=function(){this.props.searchtext&&this.onSearch(null,this.props.searchtext)},e.prototype.updateList=function(t,e,s,i){var n=Object.keys(t);if(i)if(e&&n.length&&this.state.searchtext===i){var a=this.state.filtered_list.slice(0),o=a.length;n.forEach(function(e){this.bulk_list[e]||(t[e].counter=o++,a.push(t[e]))}.bind(this)),this.setState({filtered_list:a,sort_on_search:this.props.sortonsearch,iscompletelist:s,loading_state:this.props.loadingstate})}else this.setState({iscompletelist:s});else s?this.setState({filtered_list:this.convertToArrayList(t),loading_state:!1}):null!=this.props.loadingstate&&this.setState({loading_state:this.props.loadingstate});this.bulk_list=Mi(this.bulk_list,t)},e.prototype.convertToArrayList=function(t){var s=[];return Object.keys(t).forEach(function(e){s.push(t[e])}),s},e.prototype.defaultSearch=function(e,t,s,i){var n=wo(e,null,!1,s);n.length<10&&Ho("fetch",null,null,!0,"searchlist",{topicname:"searchlist",searchtext:e},s,i);var a,o={},r=0;return n.forEach(function(e){(a=lo(e)).counter=r++,s==He.HYBRIDSEARCH.CHAT&&2==e.PARTICIPANTS.length&&(a.classname=co(e.CHATID).classname),o[a.id]=a}.bind(this)),i(o=(o=Object.keys(o).map(function(e){return o[e]})).sort(Ci("counter"),!1),null,!1),Object.keys(o)},e.prototype.handleKeyPress=function(e){e.keyCode!==He.KEYCODES.DOWN&&e.keyCode!==He.KEYCODES.UP&&e.keyCode!==He.KEYCODES.ENTER||this.setState({navigation_keycode:e.keyCode}),e.keyCode!==He.KEYCODES.DOWN&&e.keyCode!==He.KEYCODES.UP||e.preventDefault()},e.prototype.onSearch=function(e,t){var s=e?Ei(e).value:t;if(""!==s||this.props.handlecustomemptysearch){var i=this.bulk_list,n=this.props.defaultsearch?this.defaultSearch(s,i,this.props.searchsequence,this.updateList.bind(this)):this.props.onSearch&&this.props.onSearch(s,i,e);if(n.length){var a=0,o=n.map(function(e){if(i.hasOwnProperty(e))return i[e].counter=a++,i[e]});this.setState({filtered_list:o,sort_on_search:this.props.sortonsearch,searchtext:s,loading_state:this.props.loadingstate})}else this.setState({filtered_list:[],searchtext:s,iscompletelist:this.state.iscompletelist,loading_state:!1})}else{var r=ri(this.initial_list)?this.bulk_list:this.initial_list;this.setState({filtered_list:this.convertToArrayList(r),sort_on_search:!0,searchtext:s})}},e.prototype.excludeSelectedItemsFromList=function(e){var t=Mi({},this.props.excluded_list?this.props.excluded_list:this.state.excluded_list);return Object.assign(t,this.props.invisible_excluded_list),e.filter(function(e){if(!1===t.hasOwnProperty(e.id))return!0})},e.prototype.removeSelectedItem=function(e){delete this.state.excluded_list[e],this.onSearch(null,this.state.searchtext)},e.prototype.handleMultipleItemsSelection=function(e,t,s){var i=e.id,n=this.state.excluded_list;void 0===this.props.selection_limit||bi(n)<this.props.selection_limit?(n[i]=this.bulk_list[i],this.setState({excluded_list:n,iscompletelist:!0,searchtext:"",filtered_list:this.convertToArrayList(this.initial_list),navigation_keycode:""}),this.props.onListItemClicked&&this.props.onListItemClicked(e,t,s)):this.props.onSelectionLimitExceed()},e.prototype.handleItemSelection=function(e,t,s){this.setState({navigation_keycode:""}),this.props.onListItemClicked(e,t,s)},e.prototype.groupListItems=function(e){var s="",i=[],n=0;return e.forEach(function(e){if(e.groupheader&&s!==e.groupheader){s=e.groupheader;var t={};t.title=e.groupheader,t.classname=_a.listheader,t.empty_img=!0,t.listheader=!0,i.push(t),n++}i.push(e)}),this.headerItemsCount=n,i},e.prototype.render=function(){var t=this.excludeSelectedItemsFromList(this.state.filtered_list);this.props.updateinitiallist&&""===this.state.searchtext&&(t=this.excludeSelectedItemsFromList(this.convertToArrayList(this.initial_list)));var e=this.props.multiselect?this.handleMultipleItemsSelection:this.handleItemSelection;if(this.state.sort_on_search){var s=this.props.defaultsearch?Ci("counter",!1):this.props.sortComparator||Ci("title");t=(t=Object.keys(t).map(function(e){return t[e]})).sort(s)}t=this.groupListItems(t);var i={customContainerStyle:_a.listContainer,customHeaderStyle:_a.listContainerHeader,customButtonStyle:_a.listContainerClose,customWrapperStyle:_a.listContainerWrapper};this.props.multiselect&&bi(this.state.excluded_list)&&(i.customFooterStyle=_a.listContainerFooter),this.props.customDialogStyles&&this.props.customDialogStyles.footerWrapper&&(i.customFooterStyle=this.props.customDialogStyles.footerWrapper);var n=k("div",{class:_a.titlewrapper},k("div",{class:_a.header},this.props.title)),a=[];this.props.footerprefix&&a.push(this.props.footerprefix),this.props.multiselect&&a.push(k(xa,{selectedItems:Object.keys(this.state.excluded_list),fetchImageSource:this.props.fetchImageSource,actionCallback:this.props.actions,removeSelectedItem:this.removeSelectedItem}));var o=this.props.multiselect?[]:this.props.actions,r=!!this.state.searchtext,l=!(bi(this.props.excluded_list)!==bi(this.props.list)||!this.props.iscompletelist||!this.props.multiselect);if(this.props.dialogview)return k(et,{heading:n,actions:o,customDialogStyles:i,callbackOnClose:this.props.callbackOnClose,footerinfoprefix:a,ignoreFocusOnMount:!0},k(Aa,{searchplaceholder:this.props.searchplaceholder,handleChange:this.onSearch.bind(this),searchvalue:this.state.searchtext,handleKeyPress:this.handleKeyPress.bind(this)}),this.props.listlabel,k(wa,{list:t,onListItemClicked:e,loadingstate:this.state.loading_state,iscompletelist:this.state.iscompletelist,customlistitemstyles:this.props.customlistitemstyles,isinitiallist:!this.state.searchtext,navigation_keycode:this.state.navigation_keycode,headerItemsCount:this.headerItemsCount,customlistitemprops:this.props.customlistitemprops,defaultselect:r,selectedall:l}));if(this.props.searchnode||this.props.customsearch)return k(wa,{list:t,onListItemClicked:e,loadingstate:this.state.loading_state,iscompletelist:this.state.iscompletelist,customlistitemstyles:this.props.customlistitemstyles,isinitiallist:!this.state.searchtext,navigation_keycode:this.props.navigation_keycode,headerItemsCount:this.headerItemsCount,customlistitemprops:this.props.customlistitemprops,defaultselect:r,selectedall:l});var d=this.props.customlistitemstyles&&this.props.customlistitemstyles.containerWrapperStyle,c=this.props.disablesearchcontainer?null:k(Aa,{customsearchstyle:this.props.customlistitemstyles&&this.props.customlistitemstyles.customsearchstyle,searchplaceholder:this.props.searchplaceholder,handleChange:this.onSearch.bind(this),searchvalue:this.state.searchtext,handleKeyPress:this.handleKeyPress.bind(this)});return k("div",{class:d},c,k(wa,{list:t,onListItemClicked:e,loadingstate:this.state.loading_state,iscompletelist:this.state.iscompletelist,customlistitemstyles:this.props.customlistitemstyles,navigation_keycode:this.state.navigation_keycode,headerItemsCount:this.headerItemsCount,customlistitemprops:this.props.customlistitemprops,defaultselect:r,selectedall:l}))},e}(M);Ea.prototype.mountComponent=function(t,e,s,i,n,a,o,r,l,d,c,m,u,p,h,g,f,C,v,b,y,_,W,S){this.listid=t,this.removeComponent=v,p?(this.node=document.getElementById("wms_listviewdialog"),null==this.node&&(this.node=document.createElement("div"),this.node.id="wms_listviewdialog",document.body.appendChild(this.node))):(this.storeListInstance=C,this.node=f),O(k(Na,{ref:function(e){this.instance=e,this.storeListInstance&&this.storeListInstance(e,t)}.bind(this),list:e,title:s,searchplaceholder:i,onSearch:n,sortComparator:a,onListItemClicked:o,sortonsearch:r,loadingstate:l,actions:d,multiselect:c,fetchImageSource:m,iscompletelist:u,dialogview:p,customlistitemstyles:h,searchnode:g,callbackOnClose:v&&v.bind(this,t),defaultsearch:b,searchsequence:y,updateinitiallist:_,selection_limit:W,onSelectionLimitExceed:S}),this.node)},Ea.prototype.updateList=function(e,t,s,i){this.instance.updateList(e,t,s,i)},Ea.prototype.removeParentNode=function(){this.node.parentElement.removeChild(this.node)},Ea.prototype.unmountComponent=function(){O("",this.node),this.removeParentNode()};var ka=[],Oa=null,Ra=[],Ha=null,$a={},Da=0;function La(){return Da}function Pa(){var e=[],t={FEEDSID:"wms_menu_feedsnotify",PARTICIPANTS:[],LMTIME:""};return t.TITLE=1===Da?$("chat.feed.you"):$("chat.feeds.you",[Da]),t.desc=$("view.click.here"),e.push(t),e}function Ba(){var t=yr;return Ra.filter(function(e){if(Di(e.CHATID)){if(!Sr(e.CHATID)||Sr(e.CHATID)&&Ut(t[Sr(e.CHATID).sc]))return e}else{if(Li(e.CHATID))return e;if(!Di(e.CHATID)&&(Pi(e.CHATID)&&zt(e.CHATID)||2<e.PARTICIPANTSCOUNT||e.CUSTOMGROUP&&"false"!=e.CUSTOMGROUP||"2"==e.PARTICIPANTSCOUNT&&(!e.CUSTOMGROUP||"false"==e.CUSTOMGROUP)&&Ut("direct_message")))return e}})}function ja(t){return t?ka.filter(function(e){if(e.CHATID===t)return!0})[0]:ka.filter(function(e){if(!(11==e.CTYPE||10==e.CTYPE&&un(e.ENTITYID)&&-1==e.ENTITYID.indexOf(WebMessanger.prd)))return!0})}function Fa(e,t){var s=ja(e);s&&(s.LASTSEEN=t||0)}function za(t){return Ra.find(function(e){if(e.CHATID===t)return!0})}function Ga(e){var t=yr,s=to();return s.sort(Ci("LMTIME",!0)),s=s.filter(function(e){if(Di(e.CHATID)){if(!Sr(e.CHATID)||Sr(e.CHATID)&&Ut(t[Sr(e.CHATID).sc]))return e}else{if(11==e.CTYPE)return;if(10==e.CTYPE){if(un(e.ENTITYID)&&-1==e.ENTITYID.indexOf(WebMessanger.prd))return;return e}if(!Di(e.CHATID)&&(Pi(e.CHATID)&&zt(e.CHATID)||2<e.PARTICIPANTSCOUNT||"2"==e.PARTICIPANTSCOUNT&&Ut("direct_message")))return e}}),e?s.slice(0,e):s.slice(0)}function qa(e){return e.map(function(e){return e.CHATID})}function Ya(e,t){var s="limit="+(e=e||4);t&&(s="totime="+t+"&limit="+e);var i={"X-XHR-exception":"true","X-ZCSRF-TOKEN":ci()};Ie(H.get("isCliqUser")()?"v1/history":"v1/chats",s,function(e){Oa=(new Date).getTime();var t=JSON.parse(e).data,s=t&&t.chats,i=He.REQSTATUS.NORESULTS;i=s&&s.length?(s.forEach(function(e){"8"==e.chat_type&&Gr(e);var t={};t.ADDINFO=e.addinfo,t.CHATID=e.chatid,t.LASTMSGINFO=e.lastmsginfo&&JSON.parse(e.lastmsginfo),t.PARTICIPANTS=e.recipants&&JSON.parse(e.recipants)||[],t.PARTICIPANTSCOUNT=e.pcount,t.LMTIME=e.lmtime,t.TITLE=e.title,t.CUSTOMGROUP=e.customgroup,Pi(t.CHATID)&&(t.PHOTO=Ft(null,null,t.CHATID),t.TITLE=Gt(zt(t.CHATID))||t.TITLE),t.CTYPE=e.chat_type,t.MUTEDINTERVAL=e.muted_interval,e.entity_id&&(t.ENTITYID=e.entity_id);var s=ja(t.CHATID);if(s){var i=ka.indexOf(s);ka[i].FETCHEDFROMWMS&&(ka[i].FETCHEDFROMWMS=!1)}else ka.push(t);if("function"==typeof WebMessanger){var n={};n.chid=t.CHATID,n.pcount=t.PARTICIPANTSCOUNT,n.users=t.PARTICIPANTS,WebMessanger.mapChat(n)}}.bind(this)),He.REQSTATUS.SUCCESS):He.REQSTATUS.INITIALSTATE,Si.publish("/recentchats/updateui",i)}.bind(this),function(){Si.publish("/recentchats/updateui",He.REQSTATUS.FAILED)},null,null,i)}function Va(e,t,s,i){if(t){var n=ja(e);if(za(e))return;if(n)n=JSON.stringify(n),(n=JSON.parse(n)).LMTIME="",n.LMSGTIME=n.LASTMSGINFO.time,n.order_position=Ra.length+1,Ra.push(n);else if(Li(e)){var a=WindowHandler.getWinObjById(e)&&WindowHandler.getWinObjById(e).recipant,o={};o.CHATID=e,o.CTYPE=$WC.WmsConstants.CTYPES.THREAD,o.ADDINFO="PARENT_MESSAGE_SENDER:"+a,o.order_position=Ra.length+1,o.TITLE=WindowHandler.getWinObjById(e)&&WindowHandler.getWinObjById(e).title,Ra.push(o),ir()}else if(-1==e.indexOf("CT")||Pi(e))if(i.title&&i.type){var r={};r.CHATID=e,r.CUSTOMGROUP="group"===i.type,r.order_position=Ra.length+1,r.TITLE=i.title,Ra.push(r),ir()}else void 0!==WebMessanger&&WebMessanger.getChatDataForPinnedChats(e);else{var l=Sr(e);if(l){var d={};d.ADDINFO=l.addinfo,d.CHATID=e,d.LASTMSGINFO=l.lminfo&&JSON.parse(l.lminfo),d.PARTICIPANTS=[],d.TITLE=l.cn,d.LMSGTIME=l.lminfo&&JSON.parse(l.lminfo).time,d.CUSTOMGROUP=l.customgroup,d.CTYPE=l.chat_type,d.MUTEDINTERVAL=l.muted_interval,d.order_position=Ra.length+1,Ra.push(d),ir()}}}else{var c=za(e);c&&(s||so(e,null,!0),Ra.splice(Ra.indexOf(c),1))}}function Za(e){for(var t in e){var s=Ka(e[t],t),i=Xa(s.CHATID,ka);if(i?ka[ka.indexOf(i)]=s:ka.push(s),void 0!==WmsMainUI)if("11"!=s.CTYPE&&(e[t].mute&&e[t].mute>(new Date).getTime()?WmsMainUI.setMuteStatus(t,!0):WmsMainUI.setMuteStatus(t,!1)),"11"==s.CTYPE){if(e[t].parentchatid&&!Xa(e[t].parentchatid,ka)&&!ja(e[t].parentchatid)&&Sr(e[t].parentchatid)){var n=Ka(Sr(e[t].parentchatid),e[t].parentchatid);ka.push(n)}e[t].parentchatid&&Xa(e[t].parentchatid,ka)&&(WmsMainUI.setUnreadCount(e[t].parentchatid,s.UNREADMSGS,null,null,t),delete WebMessanger.unreadthreadmap[e[t].parentchatid])}else{var a=10==s.CTYPE?s.ENTITYID:null;WmsMainUI.setUnreadCount(t,s.UNREADMSGS,null,a)}if(Fa(s.CHATID,e[t].unreadtime),void 0!==WindowHandler&&WindowHandler.checkAndHighlightChat(s.CHATID),"false"==e[t].customgroup){var o=Ai(s.PARTICIPANTS[0].zuid)?s.PARTICIPANTS[1].zuid:s.PARTICIPANTS[0].zuid;$a[o]=s.CHATID}}void 0!==WmsMainUI&&WmsMainUI.updateUnreadChatsCount()}function Ka(e,t){var s={};s.ADDINFO=e.addinfo,s.CHATID=t||e.chid,s.LASTMSGINFO=e.lastmsginfo&&JSON.parse(e.lastmsginfo)||e.lminfo&&JSON.parse(e.lminfo)||e.lmhash&&JSON.parse(e.lmhash);var i=e.recipantssummary&&JSON.parse(e.recipantssummary),n=[];for(var a in i)n.push({dname:i[a],zuid:a});return s.PARTICIPANTS=n||Xa(s.CHATID,ka).PARTICIPANTS,s.PARTICIPANTSCOUNT=e.pcount||e.pc,s.LMTIME=e.lmtime||e.unreadtime,s.LASTSEEN=e.unreadtime,s.TITLE=e.title||e.cn,s.FETCHEDFROMWMS=!0,s.UNREADMSGS=e.unreadmsgcount?e.unreadmsgcount:"1",e.ctype&&(s.CTYPE=e.ctype),e.entityid&&(s.ENTITYID=e.entityid),Pi(s.CHATID)&&(s.PHOTO=Ft(null,null,s.CHATID),s.TITLE=Gt(zt(s.CHATID))||s.TITLE),e.ctype==$WC.WmsConstants.CTYPES.THREAD&&(s.PARENTMSGUID=e.parentmsguid),s}function Xa(e,t){for(var s in t)if(t[s].CHATID===e)return t[s];return!1}function Ja(e){return bo("TITLE",e,Ga())}function Qa(){var e=(new Date).getTime();if(ka.length){var t=ka.filter(function(e){if(1!=e.FETCHEDFROMWMS)return e});t&&0<t.length&&(e=t[t.length-1].LMTIME)}Ya(15,e)}function eo(t){return ja().filter(function(e){if(void 0!==WmsMainUI&&WmsMainUI.getUnreadCount(e.CHATID))return"muted"===t?!!WmsMainUI.getMuteStatus(e.CHATID):"unmuted"!==t||!1===WmsMainUI.getMuteStatus(e.CHATID)})}function to(){var e=ja(),t=qa(eo());e=e.filter(function(e){return-1===t.indexOf(e.CHATID)});var s=eo().sort(Ci("LMTIME",!0));return s=99<s.length?s.slice(0,99):s,e.concat(s)}function so(e,t,s){for(var i=za(e),n=i.order_position,a=t&&za(t).order_position,o=a&&n<a?a-1:a,r=Ra,l=s||n<o?n+1:o,d=s?r.length:n<o?o:n-1,c=0;c<r.length;c++){var m=r[c].order_position;l<=m&&m<=d&&(s||n<o?--m:m+=1,r[c].order_position=m)}i.order_position=!s&&o,ir()}Si.subscribe("/channels/updateui",function(){Si.publish("/recentchats/updateui",He.REQSTATUS.SUCCESS)});var io=Object.freeze({__proto__:null,getUnreadFeedsCount:La,setUnreadFeedsCount:function(e){Da=e},incrementUnreadFeedsCount:function(){Da++},wrapUnreadFeedsObj:Pa,getPinnedChatsLastFetchedTime:function(){return Ha},setPinnedChatsLastFetchedTime:function(e){Ha=e},getPinnedChats:Ba,initRecentChats:function(){null===Oa&&Qa()},get:ja,updateLastSeenTime:Fa,updateLastThreadMsgTime:function(e,t){var s=ja(e);s&&(s.LASTTHREADMSGTIME=t||0)},updateAddinfoData:function(e,t){var s=ja(e);s&&(s.ADDINFO=s.ADDINFO?s.ADDINFO+":"+t:t);var i=za(e);i&&(i.ADDINFO=i.ADDINFO?i.ADDINFO+":"+t:t)},updateThreadParentMsgId:function(e,t){var s=ja(e);if(s)s.PARENTMSGUID=t;else{var i={};i.PARENTMSGUID=t,i.CTYPE=He.CTYPES.THREAD,i.CHATID=e,ka.push(i)}},updatePartCount:function(e,t,s){var i=ja(e);if(i){var n=parseInt(i.PARTICIPANTSCOUNT);i.PARTICIPANTSCOUNT=s?n+t:n-t}var a=za(e);if(a){var o=parseInt(a.PARTICIPANTSCOUNT);a.PARTICIPANTSCOUNT=s?o+t:o-t}},updatePartInfo:function(e,t,s){var i=ja(e)||za(e);if(i)if(s)i.PARTICIPANTS.push(t);else for(var n=0;n<i.PARTICIPANTS.length;n++){i.PARTICIPANTS[n].zuid===t.zuid&&i.PARTICIPANTS.splice(n,1)}},getLastSeenTime:function(e){var t=ja(e);return t&&t.LASTSEEN?t.LASTSEEN:0},updateTitle:function(e,t){var s=ja(e);if(s){s.TITLE=t,Si.publish("/recentchats/updateui",He.REQSTATUS.SUCCESS);var i=za(e);i&&(i.TITLE=t)}},updatePinnedChatList:function(e,t,s,i){if(Ha=(new Date).getTime(),t){var n=[];if(e.data&&e.data.length)for(var a=0;a<e.data.length;a++)e.data[a].chats&&(n=n.concat(e.data[a].chats));if(n)for(var o=0;o<n.length;o++){var r=n[o];if(!za(r.id)){var l={};if(l.CHATID=r.id,l.TITLE=r.title,l.chat_type=r.type,l.CUSTOMGROUP="group"===r.type,l.PARTICIPANTSCOUNT=r.pcount,l.PARTICIPANTS=r.recipants,i&&(l.order_position=o+1),Ra.push(l),void 0!==WindowHandler){var d=WindowHandler.getWinObjById(r.id);d&&d.updatePinnedInfo(!0)}}}ir()}else{var c=e.data.chats;if(c)for(var m=0;m<c.length;m++){var u=c[m],p=za(u.chatid);if(!p||s){var h={};if(h.ADDINFO=u.addinfo,h.CHATID=u.chatid,h.LASTMSGINFO=u.lastmsginfo&&JSON.parse(u.lastmsginfo),h.PARTICIPANTS=u.recipants&&JSON.parse(u.recipants),h.PARTICIPANTSCOUNT=u.pcount,h.TITLE=u.title,h.LMSGTIME=u.lastmsginfo&&JSON.parse(u.lastmsginfo).time,h.CUSTOMGROUP=u.customgroup,h.CTYPE=u.chat_type,h.MUTEDINTERVAL=u.muted_interval,h.order_position=p&&p.order_position||Ra.length+1,Va(u.chatid,!1,!0),Ra.push(h),void 0!==WindowHandler){var g=WindowHandler.getWinObjById(u.chatid);g&&g.updatePinnedInfo(!0)}}}ir()}},getFromPinnedChatList:za,updateLastMsgInfo:function(s){var e=za(s.chid);e&&(e.LMSGTIME=s.lmtime,i(e));var t=ja(s.chid);function i(e){if(e.LASTMSGINFO||(e.LASTMSGINFO={}),e.LASTMSGINFO.addinfo=s.addinfo||{},e.LASTMSGINFO.sender=s.sender,e.LASTMSGINFO.dname=hi(s.sender,s.dname),e.LASTMSGINFO.msguid=s.msguid,Ki(s.msg.msg)){var t=s.msg.msg;"object"==typeof t[t.length-1].msg&&(e.LASTMSGINFO.msg=t[t.length-1].msg.msg,e.LASTMSGINFO.mtype=t[t.length-1].msg.mtype,e.LASTMSGINFO.meta=t[t.length-1].msg.meta)}else s.msg.msg?(e.LASTMSGINFO.msg=s.msg.msg,e.LASTMSGINFO.meta=s.msg.meta):(e.LASTMSGINFO.msg=s.msg,e.LASTMSGINFO.meta=s.meta);e.LMTIME&&(e.LMTIME=s.lmtime),s.mtype&&(e.LASTMSGINFO.mtype=s.mtype),"63"===s.mtype&&(e.LASTMSGINFO.mtype=s.mtype,e.LASTMSGINFO.info_visiblity=s.info_visiblity),s.module?e.LASTMSGINFO.__module=s.module:delete e.LASTMSGINFO.__module}t&&i(t),void 0!==WmsMainUI&&(WmsMainUI.menu&&"block"!==WmsMainUI.menu.style.display&&"flex"!==WmsMainUI.menu.style.display?(WmsMainUI.updateUnreadChatsCount(),WmsMainUI.updateCountDependentUI()):Si.publish("/recentchats/updateui",He.REQSTATUS.SUCCESS))},removeFromRecentChats:function(e){var t=ja(e);t&&(ka.splice(ka.indexOf(t),1),Si.publish("/recentchats/updateui",He.REQSTATUS.SUCCESS))},getChats:Ga,getChatIdList:qa,getRecentChatsFromChatServer:Ya,updateFromActiveChats:function(e){for(var t in e){var s={};(s={}).CHATID=t,s.LASTMSGINFO=JSON.parse(e[t].lmhash),s.PARTICIPANTS=[];var i=JSON.parse(e[t].recipantssummary);for(var n in i)s.PARTICIPANTS.push({zuid:n,dname:i[n]});s.PARTICIPANTSCOUNT=e[t].pcount,s.TITLE=e[t].title,s.ADDINFO=e[t].addinfo,s.LMTIME=+e[t].lmtime,s.CUSTOMGROUP=e[t].customgroup,s.CTYPE=e[t].ctype,s.MUTEDINTERVAL=e[t].mute,s.FETCHEDFROMWMS=!0,e[t].entityid&&(s.ENTITYID=e[t].entityid),Pi(s.CHATID)&&(s.PHOTO=Ft(null,null,s.CHATID),s.TITLE=Gt(zt(s.CHATID))||s.TITLE);var a=ja(t),o=za(t);o&&(Ra[Ra.indexOf(o)]=s),a?(s.LASTSEEN=a.LASTSEEN,ka[ka.indexOf(a)]=s):ka.push(s)}void 0!==WmsMainUI&&Si.publish("/recentchats/updateui",He.REQSTATUS.SUCCESS)},updatePinnedChat:Va,updateUnReadChats:Za,wrapUnreadObj:Ka,checkPresence:Xa,getList:Ja,loadPreviousChatList:Qa,getRecentChatTime:function(){var e=ka[0]&&ka[0].LMTIME;if(e)return+e},getUnreadChatList:eo,getRecentChatsWithLimitedUnreadChats:to,getChidFor121UnreadChat:function(e){return $a[e]},resetUnreadCount:function(e){ja(e).UNREADMSGS=0},reorderPinnedChats:so});function no(e,t,s){for(var i={},n=Sr(e),a=n&&n.currole,o=0;o<t.length;o++){var r=t[o],l={};if(r.botId){l.id=r.botId,l.title=r.dname;var d=r.current_config;d[0]===He.BOTCONFIG.LISTENMSG&&d[1]===He.BOTCONFIG.SENDMSG||d[0]===He.BOTCONFIG.SENDMSG&&d[1]===He.BOTCONFIG.LISTENMSG?l.desc=$("botconfig.listenmsg.sendmsg"):d[0]===He.BOTCONFIG.LISTENMSG?l.desc=$("botconfig.listenmsg"):d[0]===He.BOTCONFIG.SENDMSG&&(l.desc=$("botconfig.sendmsg")),l.imgsrc=Ft(r.botId,r.photo_id),l.groupheader=$("channels.userroles.bot"),l.sortidentifier=He.USERROLES.BOT,i[r.botId]=l}else if(r.zuid){l.title=hi(r.zuid,r.dname),l.desc=r.email||r.emailid,l.id=r.zuid,l.statuscode=oo(vs(r.zuid)),l.imgsrc=WmsUIImpl&&WmsUIImpl.getUserPhoto(r.zuid)||H.get("photoserver")+"/file?ID="+r.zuid+"&t=user&height=30&width=30",l.classname="wms_badge_imgwrapper",r.hasOwnProperty("role")&&(l.groupheader=ao(r.role,e),l.sortidentifier=r.role),r.zuid===H.get("zuid")||!s||void 0!==r.role&&r.role===a||(l.options=s(e)),r.email||r.emailid||r.zoid===H.get("orgid")||(l.desc=$WC.I18N("chat.participant.nonorg")),null!=ss(r.zuid)&&(l.dname=ss(r.zuid).DNAME,l.classname="wms_badge_imgwrapper wms_badge_statusicon_"+bs(r.zuid)),i[r.zuid]=l}}return i}function ao(e,t){var s=Sr(t);return e===He.USERROLES.SUPER_ADMIN?s&&s.sc===He.CHANNELS.ORG?$("channels.userroles.orgadmin"):s&&s.sc===He.CHANNELS.TEAM?$("channels.userroles.teamadmin"):$("channels.userroles.superadmin"):e===He.USERROLES.ADMIN?$("channels.userroles.admin"):e===He.USERROLES.MODERATOR?$("channels.userroles.moderator"):e===He.USERROLES.PARTICIPANT?$("channels.userroles.participant"):void 0}function oo(e){return!1===e?He.TEMPUSERSTATUS.ORGCONTACT:+e===Vt.ONLINE||+e===Vt.BUSY||+e===Vt.IDLE?e:+e===Vt.OFFLINE?He.TEMPUSERSTATUS.OFFLINE:He.TEMPUSERSTATUS.ORGCONTACT}function ro(e,t){var s,i=e&&e.sc;return"1"===i?s="orgchannel":"2"===i?s="orggroup":"3"===i?s="privatechannel":"4"===i&&(s="shared-channel"),e?e.photoid?(t.imgsrc="/_chat/channel/"+e.photoid+"/photo.do",t.classname="wms_badge_imgwrapper wms_channelimg_badge wms-"+s+"-small"):(t.empty_img=!0,t.classname="wms_badge_imgwrapper wms_channelimg wms-"+s+"-small",t.fonticon_class="wms_badge_imgwrapper wms_channelimg wms-"+s+"-small"):(t.badge_img=!0,t.badge_letter="#"),t}function lo(e){var t=Di(e.CHATID),s={};if(e._filtertype===He.HYBRIDSEARCH.CHANNEL)s.title=e.dn,s.desc=e.cd,s.id=e.chid,ro(e,s),s.filtertype=e._filtertype;else if(e._filtertype===He.HYBRIDSEARCH.CHAT){var i=Sr(e.CHATID);if(t&&i)ro(i,s),s.title=i.dn,s.htmldesc=So(e),s.id=i.chid;else{if(s.title=e.TITLE,s.htmldesc=So(e),s.id=e.CHATID,e.CHATID&&Pi(e.CHATID)){var n=zt(e.CHATID);s.imgsrc=Ft(n)}else _o(e,!0)?s.imgsrc=_o(e,!0):(s.badge_img=!0,s.badge_letter=yo(e.TITLE));s.classname="wms_badge_imgwrapper wms_badge_statusicon_"+bs(_o(e))}s.filtertype=e._filtertype}else if(e._filtertype===He.HYBRIDSEARCH.CONTACT||e._filtertype===He.HYBRIDSEARCH.BOT||e._filtertype===He.HYBRIDSEARCH.ORGCONTACT){s.title=hi(e.USERID,e.DNAME),s.desc=e.EMAILID,s.id=e.USERID,e._filtertype===He.HYBRIDSEARCH.CONTACT||e._filtertype===He.HYBRIDSEARCH.ORGCONTACT?s.imgsrc=WmsUIImpl.getUserPhoto(e.USERID)||_WMSPHOTOSERVER+"/file?ID="+e.USERID+"&t=user&height=30&width=30":s.imgsrc=Ft(e.USERID),s.classname="wms_badge_imgwrapper",null!=ss(e.USERID)&&(s.classname="wms_badge_imgwrapper wms_badge_statusicon_"+bs(e.USERID)),s.filtertype=e._filtertype}else if(s.title=e.TITLE,s.htmldesc=So(e),s.id=e.CHATID,t){var a=Sr(e.CHATID);ro(a,s),s.title=a?a.dn:e.TITLE,s.filtertype=e._filtertype}else{if(e.CHATID&&Pi(e.CHATID)){var o=zt(e.CHATID);s.imgsrc=Ft(o)}else _o(e,!0)?s.imgsrc=_o(e,!0):(s.badge_img=!0,s.badge_letter=yo(e.TITLE));s.classname="wms_badge_imgwrapper wms_badge_statusicon_"+bs(_o(e))}return s}function co(e){var t="",s="";if(Di(e))return ro(Sr(e),{badge_letter:s});if(Pi(e))t=Ft(zt(e));else if(ss(e)||Pe(e))t=Ms(e);else if(ja(e)||ha(e)){var i=ja(e)||ha(e);i.PARTICIPANTS&&2===i.PARTICIPANTS.length?t=_o(i,!0):s=yo(i.TITLE)}return{imgsrc:t,classname:"",badge_letter:s}}function mo(){var s={},i=0,e=ja();return e.length<10&&(e=e.concat(bo("DNAME","",As(),10,"","EMAILID"))),e.forEach(function(e){var t=lo(e);t.counter=i++,s[e.CHATID||e.USERID]=t}),s}Si.subscribe("/orgcontacts/searchlist",function(e,t){Ho("update",null,t.callbackargs.reqid,null,t.callbackargs.topicname,t.callbackargs)}),Si.subscribe("/channels/searchlist",function(e,t){Ho("update",null,t.callbackargs.reqid,null,t.callbackargs.topicname,t.callbackargs)}),Si.subscribe("/chatlist/searchlist",function(e,t){Ho("update",null,t.callbackargs.reqid,null,t.callbackargs.topicname,t.callbackargs)});var uo=Object.freeze({__proto__:null,getRefinedParticipantsList:no,getGroupHeader:ao,getTempParticipantStatus:oo,constructChannelImage:ro,getRefinedChatslist:lo,fetchImageSource:co,getRefinedInitialChatsList:mo,showChatsList:function(n,a,o,r,l,d,c){function e(e){var t=mo(),s=new Ea,i=r[0].onclick;r[0]={text:r[0].text||$("message.forward.send"),buttonstyle:"alignend",onclick:function(e){i(e),s.unmountComponent()}},s.mountComponent(n,t,a,o,null,null,null,!0,!1,r,!0,co,!1,!0,null,null,null,null,s.unmountComponent,!0,l,e,d,c)}e(),ja().length||Si.subscribe("/recentchats/updatechatslistui",function(){document.getElementById("wms_listviewdialog")&&e(!0)})}});function po(e,t){var s=go(e,t),i="";return s&&(i='<div class="wms-img-badge '+s+'"></div>'),i}function ho(e,t){var s='<div class="wms-img-cont">';return s+=t?'<img class="wms-hysearch-result-img" src="'+t+'">':'<img class="wms-hysearch-result-img" src="'+Ms(e)+'">',s+=po(e,!1)+"</div>"}function go(e,t){var s=vs(e),i="";if(!1!==s)if((s=+s)===Vt.ONLINE?i=t?"wms-status-online":"wms-pos-online":s===Vt.BUSY?i=t?"wms-status-busy":"wms-pos-busy":s===Vt.IDLE?i=t?"wms-status-idle":"wms-pos-idle":s===Vt.AWAY?i=t?"wms-status-away":"wms-pos-away":s===Vt.DONOTDISTURB?i=t?" wms-status-dnd":"wms-pos-dnd":s===Vt.OFFLINE&&(i=t?"wms-status-offline":"wms-pos-offline"),i){var n=parseInt(Cs(e),10);n===Vt.MOB_LOGIN&&(i+="-mobile"),n==Vt.CLIQ_CALLS&&(i+="-cliqcall"),n!=Vt.MEETING&&n!=Vt.SHOWTIME_TRAINING||(i+="-meeting"),n!=Vt.ASSIST_SESSION&&n!=Vt.TELEPHONY||(i+="-assistsession"),n==Vt.CALENDAR_EVENT&&(i+="-calendarevent")}else Bt(e)&&(i="wms-pos-bot");return i}var fo=Object.freeze({__proto__:null,getStatusHtml:po,createUserImageHtml:ho,getStatusClass:go}),Co={msgactions_container:"mc2f762162_msgactions_container",actioncontainer:"mc2f762162_actioncontainer",quickreactionscontainer:"mc2f762162_quickreactionscontainer",msgactionicon:"mc2f762162_msgactionicon",reacticon:"mc2f762162_reacticon",deleteaction:"mc2f762162_deleteaction",actionname:"mc2f762162_actionname",moreactionname:"mc2f762162_moreactionname",itemselected:"mc2f762162_itemselected",iconreply:"mc2f762162_iconreply",newglitter:"mc2f762162_newglitter",defaultmsgactions_container:"mc2f762162_defaultmsgactions_container",searchcontainer:"mc2f762162_searchcontainer",actionimg:"mc2f762162_actionimg",moreactionicon:"mc2f762162_moreactionicon",loader:"mc2f762162_loader",loadermargin:"mc2f762162_loadermargin",moreactionslabel:"mc2f762162_moreactionslabel",emptyresult:"mc2f762162_emptyresult",errorimg:"mc2f762162_errorimg",errorinfotext:"mc2f762162_errorinfotext",popupcontainerstyle:"mc2f762162_popupcontainerstyle",defaultpopupcontainer:"mc2f762162_defaultpopupcontainer",quickreaction:"mc2f762162_quickreaction",zmNightMode:"zmNightMode","wms-rtl":"wms-rtl"},vo={heading:"mc0ede5230_heading",header_wrapper:"mc0ede5230_header_wrapper",close_button:"mc0ede5230_close_button",msg_wrapper:"mc0ede5230_msg_wrapper",msg:"mc0ede5230_msg",msg_details:"mc0ede5230_msg_details",msgdetails_sender:"mc0ede5230_msgdetails_sender",msgdetails_time:"mc0ede5230_msgdetails_time",msg_content:"mc0ede5230_msg_content",zmNightMode:"zmNightMode",contact_operation_loader:"mc0ede5230_contact_operation_loader"};function bo(i,n,e,t,a,o,s,r){n=n.toLowerCase();var l=[];if(Ki(e))l=e;else for(var d in e)l.push(e[d]);if(a){var c=function(s){var i=a[s];l=l.filter(function(e){var t;return t=e[s]?e[s]:Wo(e),-1==i.indexOf(t)})};for(var m in a)c(m)}var u=l.slice(0);function p(e){var t=u.filter(e);return"UC"===(s=s||"UC")||"lmtime"===s?t.sort(Ci(s,!0,Number)):t.sort(Ci(s,!1,function(e){return e.toLowerCase()})),t.forEach(function(e){u.splice(u.indexOf(e),1)}),t}var h,g=p(function(e){var t=e[i];if(t&&t.startsWith("#")&&(t=t.substring(1)),t&&t.toLowerCase().startsWith(n))return!0}),f=p(function(e){if(e[o]&&e[o].toLowerCase()===n)return!0}),C=p(function(e){if(e[o]&&e[o].toLowerCase().startsWith(n))return!0}),v=p(function(e){if(e[i]&&-1!==e[i].toLowerCase().indexOf(" "+n))return!0}),b=p(function(e){if(e[o]&&-1!==e[o].toLowerCase().indexOf(" "+n))return!0}),y=p(function(e){if(e[i]&&e[i].toLowerCase()===n)return!0}),_=p(function(e){var t=e[i];if(t){t=t.toLowerCase();var s=n.toLowerCase().split(/[-~!@%&[\]/{}<>()*+?.,^$|:;'"#\s]/g).join(".*");if(-1!==t.search(new RegExp(s)))return!0}}),W=p(function(e){var t=e[o];if(t){t=t.toLowerCase();var s=n.toLowerCase().split(/[-~!@%&[\]/{}<>()*+?.,^$|:;'"#\s]/g).join(".*");if(-1!==t.search(new RegExp(s)))return!0}});function S(e,t){return e.map(function(e){e._filterweight=t})}return S(g,1),S(f,2),S(v,3),S(y,4),S(_,5),S(C,6),S(b,7),S(W,8),h=r?g.concat(C):g.concat(y,C,f,v,b,_,W),t?h.slice(0,t):h.slice(0)}function yo(e){e.startsWith("#")&&(e=e.slice(1));var t=e.split(" "),s="";return t&&(s=1<t.length?t[0].charAt(0)+t[1].charAt(0):e.charAt(0)),mi(s.toUpperCase())}function _o(e,t){var s="",i=[];if(e.PARTICIPANTS)for(var n=0;n<e.PARTICIPANTS.length;n++)e.PARTICIPANTS[n].zuid!==H.get("zuid")&&i.push(e.PARTICIPANTS[n].zuid);if(1===i.length)return s=e.PHOTO?e.PHOTO:Ms(i[0]),t?s:i[0]}function Wo(e){var t;return e.PARTICIPANTS&&2==e.PARTICIPANTS.length?t=e.PARTICIPANTS[0].zuid==H.get("zuid")?e.PARTICIPANTS[1].zuid:e.PARTICIPANTS[0].zuid:Pi(e.CHATID)&&(t=zt(e.CHATID)),t||""}function So(t){if(t.LASTMSGINFO&&t.LASTMSGINFO.msg){var s="";if(t.LASTMSGINFO.msg.__module&&(t.LASTMSGINFO.__module=t.LASTMSGINFO.msg.__module),t.LASTMSGINFO.__module){var e=Ai(t.LASTMSGINFO.sender);return"att"===t.LASTMSGINFO.__module?s=e?$("chat.file.shared.you"):$("chat.file.shared",hi(t.LASTMSGINFO.sender,t.LASTMSGINFO.dname,!0)):"contact"===t.LASTMSGINFO.__module?s=e?$("chat.contact.shared.you"):$("chat.contact.shared",hi(t.LASTMSGINFO.sender,t.LASTMSGINFO.dname,!0)):"location"===t.LASTMSGINFO.__module?s=e?$("chat.location.shared.you"):$("chat.location.shared",hi(t.LASTMSGINFO.sender,t.LASTMSGINFO.dname,!0)):"event"===t.LASTMSGINFO.__module&&(s=e?$("chat.event.shared.you"):$("chat.event.shared",hi(t.LASTMSGINFO.sender,t.LASTMSGINFO.dname,!0))),s}if("string"==typeof t.LASTMSGINFO.msg||"object"==typeof t.LASTMSGINFO.msg&&t.LASTMSGINFO.msg.isedited)if(-1!==t.LASTMSGINFO.msg.indexOf("<img"))s=$("chat.img");else if(-1!==t.LASTMSGINFO.msg.indexOf("<hr>"))s=mi(ui(s=t.LASTMSGINFO.msg.replace(/<hr>/g,"---")));else{var i=t.LASTMSGINFO.msg.lastIndexOf("<br>"),n=t.LASTMSGINFO.msg.lastIndexOf("\n");s=st(s=mi(ui(s=t.LASTMSGINFO.msg.substring(-1!==i?i+4:-1!==n?n+1:0))));var a=wi(t.LASTMSGINFO,!0);a.msg=s,s=ht(s=a.meta&&a.meta.mentions?gi(a,!0):gi(s)),s=Smiley.replace(s,!0),ge.check("customemoji",s)&&(s=ge.replacer(ge.regexes.customemoji,null,s,function(e){return e.endsWith("!$:")?Ai(t.LASTMSGINFO.sender)?$("chat.sticker.shared.you"):$("chat.sticker.shared",hi(t.LASTMSGINFO.sender,t.LASTMSGINFO.dname,!0)):"<span class='wms_menu_custom_emoji'>"+Smiley.replaceCustomEmoji(s)+"</span>"}))}else{if("object"==typeof t.LASTMSGINFO.msg&&("16"===t.LASTMSGINFO.mtype||"65"===t.LASTMSGINFO.mtype))return t.LASTMSGINFO.msg.chid=t.LASTMSGINFO.msg.chid||t.CHATID||t.chatid||"",Kr(t.LASTMSGINFO.msg);if(t.LASTMSGINFO.isdeleted)return 1==t.LASTMSGINFO.msg.info_visiblity?'<span class="wms-delmsg">'+$("chat.info.deletemsg")+"</span>":""}return t.LASTMSGINFO.addinfo&&t.LASTMSGINFO.addinfo.sender?'<span class="wmsgrey">'+mi(ui(t.LASTMSGINFO.addinfo.sender.name))+": </span>"+s:"2"===t.PARTICIPANTSCOUNT&&t.LASTMSGINFO.sender!==H.get("zuid")?s:t.LASTMSGINFO.sender===H.get("zuid")?'<span class="wmsgrey">'+$("chat.you")+": </span>"+s:'<span class="wmsgrey">'+hi(t.LASTMSGINFO.sender,t.LASTMSGINFO.dname,!0)+": </span>"+s}return t.LASTMSGINFO&&"63"===t.LASTMSGINFO.mtype?1==t.LASTMSGINFO.info_visiblity?'<span class="wms-delmsg">'+$("chat.info.deletemsg")+"</span>":"":t.desc?t.desc:""}function wo(e,t,s,i,n){var a=t;if(s=s,!a){a=[];var o=[],r=Mo(e),l=r.map(function(e){var t=Wo(e);return t&&o.push(t),e.CHATID}),d=Io(e,s,l={CHATID:l}),c=d.map(function(e){var t=Wo(e);return t&&o.push(t),e.CHATID});o={USERID:o},i&&-1===i.indexOf(He.HYBRIDSEARCH.CHAT)&&(o={});var m=Eo(e,!1,o,i),u=m.map(function(e){return e.USERID});u={USERID:u.concat(o.USERID)},l={chid:l.CHATID.concat(c)};var p=[],h=!!(document.getElementById("wms-fileupldwin")||i&&-1!==i.indexOf($WC.WmsConstants.HYBRIDSEARCH.JOINEDCHANNEL));if(i){if(-1!==i.indexOf(He.HYBRIDSEARCH.CONTACT)&&(a=a.concat(m)),-1!==i.indexOf(He.HYBRIDSEARCH.ORGCONTACT)&&(a=m.concat(xo(e,!1,u),a)),-1!==i.indexOf($WC.WmsConstants.HYBRIDSEARCH.CHAT)&&(a=a.concat(r,d)),-1!==i.indexOf($WC.WmsConstants.HYBRIDSEARCH.CHANNEL)||-1!==i.indexOf($WC.WmsConstants.HYBRIDSEARCH.JOINEDCHANNEL)){var g=-1!==i.indexOf($WC.WmsConstants.HYBRIDSEARCH.CHAT);a=a.concat(No(e,null,h,g?l:""))}-1!==i.indexOf($WC.WmsConstants.HYBRIDSEARCH.BOT)&&(a=a.concat(p))}else a=m.concat(xo(e,!1,u),p,r,d,No(e,null,h,l))}var f=a.filter(function(e){return 1===e._filterweight}),C=a.filter(function(e){return 2===e._filterweight}),v=a.filter(function(e){return 3===e._filterweight}),b=a.filter(function(e){return 4===e._filterweight}),y=(a.filter(function(e){return 5===e._filterweight}),a.filter(function(e){return 6===e._filterweight})),_=a.filter(function(e){return 7===e._filterweight}),W=(a.filter(function(e){return 8===e._filterweight}),[He.HYBRIDSEARCH.CHAT,He.HYBRIDSEARCH.CONTACT,He.HYBRIDSEARCH.BOT,He.HYBRIDSEARCH.ORGCONTACT,He.HYBRIDSEARCH.CHANNEL]),S={};function w(e,t){if(e._filtertype!==t._filtertype)return W.indexOf(e._filtertype)-W.indexOf(t._filtertype);if(!(e._filtertype!==He.HYBRIDSEARCH.CONTACT&&e._filtertype!==He.HYBRIDSEARCH.ORGCONTACT||t._filtertype!==He.HYBRIDSEARCH.CONTACT&&t._filtertype!==He.HYBRIDSEARCH.ORGCONTACT))return t.UC-e.UC;if(e._filtertype===He.HYBRIDSEARCH.CHAT&&t._filtertype===He.HYBRIDSEARCH.CHAT)return t.LMTIME-e.LMTIME;var s=e[S[e._filtertype]].toLowerCase(),i=t[S[t._filtertype]].toLowerCase();return s<i?-1:i<s?1:0}return S[He.HYBRIDSEARCH.ORGCONTACT]="DNAME",S[He.HYBRIDSEARCH.BOT]="DNAME",S[He.HYBRIDSEARCH.GROUP]="NAME",S[He.HYBRIDSEARCH.CHANNEL]="cn",n?f.sort(w).concat(y.sort(w)):f.sort(w).concat(b.sort(w),y.sort(w),C.sort(w),v.sort(w),_.sort(w))}function Mo(e){var t=bo("TITLE",e,Ja(e),10);return t.sort(Ci("LMTIME",!0)),t.map(function(e){return e._filtertype=He.HYBRIDSEARCH.CHAT,e})}function Io(e,t,s){if(s=s||{},t){var i=ji(To("searchresultdiv").querySelectorAll("[data-type='"+He.HYBRIDSEARCH.CHAT+"'],[data-type='"+He.HYBRIDSEARCH.CONTACT+"'],[data-type='"+He.HYBRIDSEARCH.ORGCONTACT+"'],[data-type='"+He.HYBRIDSEARCH.BOT+"']")),n=0,a="";if(i.length)for(n=0;n<i.length;n++)s[a=i[n].getAttribute("data-type")==He.HYBRIDSEARCH.CHAT?"CHATID":"USERID"]=s[a]||[],s[a].push(i[n].getAttribute("data-id"))}var o=bo("TITLE",e,ha(),10,s);return o.sort(Ci("LMTIME",!0)),o.map(function(e){return e._filtertype=He.HYBRIDSEARCH.CHAT,e})}function To(e,t){var s,i={mainUI:"wms-hysearch",inputcontainer:"wms-hysearch-inpcontainer",inputdiv:"wms-hysearch-actualinp",defaultresultdiv:"wms-hysearch-defrescont",freqcontactsdiv:"wms-hysearch-fcontacts",infomsgdiv:"wms-hysearch-infomsg",loadingstatus:"wms-hysearch-loadstatus",recentchatsdiv:"wms-hysearch-rchats",resultcontainer:"wms-hysearch-rescont",searchresultdiv:"wms-hysearch-searchres",thirdcolumn:"wms-hysearch-thirdcol",thirdcolumnheading:"wms-hysearch-thirdcolheading",fakeinput:"wms-fakeinput"};return s=(t=t||Ao())===He.HYBRIDSEARCH.modules.SMARTCHAT?i:t===He.HYBRIDSEARCH.modules.CONTACTMENU?{inputdiv:"wms_menu_search",resultcontainer:"wms_menu_contactlist",defaultresultdiv:"wms_menu_contactlist_def",searchresultdiv:"wms_menu_contactlist_searchres",inputcontainer:"wms_menu_search",loadingstatus:"wms-contact-loadstatus"}:t===He.HYBRIDSEARCH.modules.GROUPMENU?{inputdiv:"wms_menu_search",resultcontainer:"wms_menu_grouplist",defaultresultdiv:"wms_menu_grouplist_def",searchresultdiv:"wms_menu_grouplist_searchres",inputcontainer:"wms_menu_search",loadingstatus:"wms-channel-loadstatus"}:t===He.HYBRIDSEARCH.modules.CHATMENU?{inputdiv:"wms_menu_search",resultcontainer:"wms_menu_chatlist",defaultresultdiv:"wms_menu_chatlist_def",searchresultdiv:"wms_menu_chatlist_searchres",recentchatdiv:"wms_menu_chatlist_def",recentchatsdiv:"wms_menu_chatlist_recentchats",inputcontainer:"wms_menu_search",loadingstatus:"wms-chat-loadstatus",recentchatswelcomemsg:"wms_welcome_recentchatsmsg"}:t===He.HYBRIDSEARCH.modules.CUSTOMCONTACTMENU?{inputdiv:"wms_menu_search",resultcontainer:"wms_menu_customcontactlist",defaultresultdiv:"wms_menu_customcontactlist_def",searchresultdiv:"wms_menu_customcontactlist_searchres",inputcontainer:"wms_menu_search",loadingstatus:"wms-customcontact-loadstatus"}:t===He.HYBRIDSEARCH.modules.FILEFWD?{searchresultdiv:"wms-filefrwrdautocomplete",inputcontainer:"wms-filefrwrdrecipant",inputdiv:"wms-filefrwrdrecipant",loadingstatus:"wms-filefwd-loadstatus"}:i,document.getElementById(s[e])}function Ao(){var e=document.getElementById("wms-hysearch"),t=document.getElementById("wms-filefrwrdautocomplete");if(e)return He.HYBRIDSEARCH.modules.SMARTCHAT;if(t)return He.HYBRIDSEARCH.modules.FILEFWD;var s=document.getElementById("wms_menu_listcontainer");if(s){var i=s.querySelector("[data-selected=true]");if(i){var n=i.getAttribute("data-menuname");if("contact"===n)return He.HYBRIDSEARCH.modules.CONTACTMENU;if("channel"===n)return He.HYBRIDSEARCH.modules.GROUPMENU;if("chat"===n)return He.HYBRIDSEARCH.modules.CHATMENU;if("customcontact"===n)return He.HYBRIDSEARCH.modules.CUSTOMCONTACTMENU}}}function Eo(e,t,s,i){var n,a,o=[];s=s||{USERID:[]};var r=0;if(t){var l=es();for(r=0;r<l.length;r++){s.USERID.push(l[r]);var d=ss(l[r]);d&&o.push(d)}n=bo("DNAME","",ss(),null,s,"EMAILID"),a=bo("DNAME","",kt,null,s,"EMAILID")}else{var c=To("inputcontainer")&&To("inputcontainer").querySelectorAll("[data-type='user']");if(c&&c.length)for(r=0;r<c.length;r++)s.USERID.push(c[r].getAttribute("data-id"));n=bo("DNAME",e,ss(),10,s,"EMAILID"),a=bo("DNAME",e,kt,10,s,"EMAILID")}return n=o.concat(n),i&&-1===i.indexOf(He.HYBRIDSEARCH.BOT)||(n=n.concat(a)),n.map(function(e){return e.ISBOT?e._filtertype=He.HYBRIDSEARCH.BOT:e._filtertype=He.HYBRIDSEARCH.CONTACT,e})}function Uo(e,t){return[]}function xo(e,t,s,i){if(!e&&!i)return[];if((s=s||{USERID:[]}).USERID.push(H.get("zuid")),t){var n=ji(To("inputcontainer").querySelectorAll("[data-type='user']")),a=0;if((n=n.concat(ji(To("searchresultdiv").querySelectorAll("[data-type='"+He.HYBRIDSEARCH.CONTACT+"'],[data-type='"+He.HYBRIDSEARCH.ORGCONTACT+"'],[data-userid]")))).length)for(a=0;a<n.length;a++)n[a].getAttribute("data-userid")?s.USERID.push(n[a].getAttribute("data-userid")):s.USERID.push(n[a].getAttribute("data-id"))}return bo("DNAME",e,Pe(),10,s,"EMAILID").map(function(e){return e._filtertype=He.HYBRIDSEARCH.ORGCONTACT,e})}function No(e,t,s,i){i=i||{chid:[]};var n,a=[],o=s?null:10,r=Lo();if(r&&(r.startsWith("@")?n="@":r.startsWith("#")&&(n="#"),-1<r.indexOf("@")&&-1<r.indexOf("#")&&(n="@#")),t){var l=ji(To("searchresultdiv").querySelectorAll("[data-type='"+He.HYBRIDSEARCH.CHANNEL+"'],[data-type='"+He.HYBRIDSEARCH.CHAT+"']")),d=0;if(l.length)for(d=0;d<l.length;d++)i.chid.push(l[d].getAttribute("data-id"))}if(s)a=xr(e,!0);else if("@"===n)a=Nr(e);else if("#"===n)a=kr(e);else if("@#"===n){var c,m,u=e.split(/@|#/);r.startsWith("@")?(c=u[0],m=u[1]):r.startsWith("#")&&(c=u[1],m=u[0]),a=Or(c,m),e=void 0!==m?m:""}else a=xr(e);return bo("cn",e,a,o,i,"_teamname","lmtime").map(function(e){return e._filtertype=He.HYBRIDSEARCH.CHANNEL,e})}var ko,Oo,Ro,Ho=(ko=[He.HYBRIDSEARCH.ORGCONTACT,He.HYBRIDSEARCH.CHANNEL,He.HYBRIDSEARCH.CHAT],Oo=[He.HYBRIDSEARCH.ORGCONTACT,He.HYBRIDSEARCH.CHAT],Ro={},function(e,t,s,i,n,a,o,r){s=s||(new Date).getTime(),n=n||"updateui";var l=ko;if(H.get("isOrgUser")()&&"disable"!=H.get("channels")&&Ut("channels")||(l=Oo),H.get("isOrgUser")()||-1==l.indexOf(He.HYBRIDSEARCH.ORGCONTACT)||l.splice(l.indexOf(He.HYBRIDSEARCH.ORGCONTACT),1),Ro[s])void 0!==Ro[s].sequence&&(l=Ro[s].sequence),void 0!==Ro[s].seqno?(t=l[Ro[s].seqno],"update"===e&&$o(s,l)&&Ro[s].seqno++):t=Ro[s].type;else if(Ro[s]={},Ro[s].sequence=o||l,Ro[s].updateCallback=r,l=Ro[s].sequence,i&&(t?Ro[s].seqno=l.indexOf(t):t=l[Ro[s].seqno=0]),Ro[s].type=t,50<Object.keys(Ro).length){var d=(new Date).getTime()-18e5;Object.keys(Ro).forEach(function(e){e<d&&delete Ro[e]})}if("fetch"===e)t===He.HYBRIDSEARCH.JOINEDCHANNEL?Ho("update",t,s,i,n,a,o,r):!1===Yo(t,s,a)&&"updateui"==n&&(t!==He.HYBRIDSEARCH.ORGCONTACT||H.get("isOrgUser")()?Vo(To("searchresultdiv"),He.REQSTATUS.LOADING,"search"):Fo()?Vo(To("searchresultdiv"),He.REQSTATUS.SUCCESS,"search"):To("searchresultdiv")&&0===To("searchresultdiv").children.length&&Lo()&&Vo(To("searchresultdiv"),He.REQSTATUS.NORESULTS,"search"));else if("update"===e)if("updateui"==n){var c,m=Bo(t);m&&m.length?(Vo(To("searchresultdiv"),He.REQSTATUS.SUCCESS,"search"),c=Zo(m),To("searchresultdiv").insertAdjacentHTML("beforeend",c),void 0!==WmsMainUI&&Yi(To("searchresultdiv",Ao())),!To("searchresultdiv").getElementsByClassName("wms-hysearch-result-select").length&&To("searchresultdiv").querySelector("[data-type]")&&Go(To("searchresultdiv").querySelector("[data-type]"))):Fo(),Do(s,l)&&(Vo(To("searchresultdiv"),He.REQSTATUS.SUCCESS,"search"),To("searchresultdiv")&&0===To("searchresultdiv").children.length&&Lo()&&Vo(To("searchresultdiv"),He.REQSTATUS.NORESULTS,"search")),$o(s,l)&&To("searchresultdiv")&&To("searchresultdiv").children.length<10&&Ho("fetch",null,s)}else"searchlist"==n&&sr(a,Do(s,l),Ro[s].updateCallback,Ro[s].sequence)&&$o(s,l)&&Ho("fetch",null,s,!0,n,a);else"failureupdate"===e&&Lo()&&(Fo()?Vo(To("searchresultdiv"),He.REQSTATUS.SUCCESS,"search"):(Vo(To("searchresultdiv"),He.REQSTATUS.FAILED,"search",zo),To("loadingstatus").setAttribute("data-reqid",s)))});function $o(e,t){return!!(Ro[e]&&void 0!==Ro[e].seqno&&Ro[e].seqno<t.length)}function Do(e,t){return!Ro[e]||void 0===Ro[e].seqno||Ro[e].seqno>=t.length}function Lo(){var e=To("inputdiv");return e&&(e.value&&e.value.trim()||e.textContent.trim())||""}var Po,Bo=((Po={})[He.HYBRIDSEARCH.ORGCONTACT]=xo,Po[He.HYBRIDSEARCH.CHAT]=Io,Po[He.HYBRIDSEARCH.CHANNEL]=No,function(e){var t,s=jo();if(1==e&&document.getElementById("wms-fileupldwin")&&(t=!0),""!==s&&e)return Po[e](s,!0,t)});function jo(){var e=Lo();return e=e&&(e.startsWith("@")||e.startsWith("#"))?e.slice(1):e}function Fo(){var e=Lo(),t=Ao(),s="";if(ge.check("emailid",e,!0)&&(t===He.HYBRIDSEARCH.modules.CONTACTMENU||t===He.HYBRIDSEARCH.modules.SMARTCHAT)&&"disable"!=H.get("other_orguser_chat"))return Fi(To("searchresultdiv").querySelector('[data-operation="addcontact"]')),s=Hs(s=t===He.HYBRIDSEARCH.modules.CONTACTMENU?'<div class="wms_menu_item wms_menu_addcontact" data-operation="addcontact" data-dname="{{searchtext}}" data-type="3">'+Ko("",He.HYBRIDSEARCH.CONTACT)+'<div class="wms_menu_item_name wms-truncate-ellipsis" title="{{searchtext}}">{{searchtext}}</div><div class="wms_menu_item_msg wms-truncate-ellipsis">'+$("contact.invite")+'</div><span data-addcontact="true" class="wms_menu_addicon wms-valign-mid-block"></span></div>':'<div class="wms_hysearch_invite" data-operation="addcontact" data-email="{{searchtext}}">'+Xo("",e,$("contact.invite"),null,null,He.HYBRIDSEARCH.ADDCONTACT,null,null,null,He.HYBRIDSEARCH.modules.SMARTCHAT)+'<div class="wms_hysearch_addicon wms-valign-mid-block" data-addcontact="true" data-type="'+He.HYBRIDSEARCH.ADDCONTACT+'"></div></div>',{searchtext:e}),To("searchresultdiv").insertAdjacentHTML("beforeend",s),!0}function zo(){Ho("fetch",null,To("loadingstatus").getAttribute("data-reqid"))}function Go(e){e.getAttribute("data-type")&&(qo(),qi(e,"data-select",!0),zi(e,"wms-hysearch-result-select"))}function qo(){var e,t=To("resultcontainer");(e=To("searchresultdiv")&&"block"===getComputedStyle(To("searchresultdiv")).display?To("searchresultdiv").getElementsByClassName("wms-hysearch-result-select")[0]:t&&t.getElementsByClassName("wms-hysearch-result-select")[0])&&(Gi(e,"wms-hysearch-result-select"),e.removeAttribute("data-select"))}var Yo=function(){var i=Bi(function(e,t,s){s=s||jo(),e===He.HYBRIDSEARCH.ORGCONTACT?Ge(s,t):e===He.HYBRIDSEARCH.CHAT?ba(s,t):e===He.HYBRIDSEARCH.CHANNEL&&$r(s,t)},this,300);return function(e,t,s){return s=s||{searchtext:jo()},i(e,t,s),e===He.HYBRIDSEARCH.ORGCONTACT?qe(s):e===He.HYBRIDSEARCH.CHAT?Ca(s):e===He.HYBRIDSEARCH.CHANNEL?Rr(s):void 0}}();function Vo(e,t,s,i,n){var a={chat:{},search:{}};a.search[He.REQSTATUS.NORESULTS]=$("search.noresult"),a.search[He.REQSTATUS.FAILED]=$("search.failed"),a.chat[He.REQSTATUS.NORESULTS]=$("chat.noresult"),a.chat[He.REQSTATUS.FAILED]=$("chat.retrievefailed");var o=e?e.getElementsByClassName("wms-hysearch-loadstatus")[0]:"";o&&(o.onclick=null);var r="",l="",d="wms-hysearch-loadstatus";if((n=n||Ao())===He.HYBRIDSEARCH.modules.FILEFWD?d="wms-filefwd-loadstatus":n===He.HYBRIDSEARCH.modules.CHATMENU?d="wms-chat-loadstatus":n===He.HYBRIDSEARCH.modules.CONTACTMENU?d="wms-contact-loadstatus":n===He.HYBRIDSEARCH.modules.GROUPMENU?d="wms-channel-loadstatus":n===He.HYBRIDSEARCH.modules.CUSTOMCONTACTMENU&&(d="wms-customcontact-loadstatus"),t!==He.REQSTATUS.SUCCESS){if(t===He.REQSTATUS.NORESULTS)"chat"===s&&n===He.HYBRIDSEARCH.modules.CHATMENU?ja()&&ja().length||Da?r='<div class="wms-hysearch-infotxt wms-hvalign">'+a[s][He.REQSTATUS.NORESULTS]+"</div>":(Fi(To("recentchatswelcomemsg",n)),l='<div id="wms_welcome_recentchatsmsg"><div class="wms-welcome-img wms-welcome-recentchatsimg wms-halign"></div><div class="wms-welcome-msg wms-halign">'+$("recentchats.welcomemessage",['<span data-menuredirect="contact">'+$("chat.contact")+"</span>",'<span data-menuredirect="channel">'+$("chat.channel")+"</span>"])+"</div></div></div>"):!o&&e&&"wms-hysearch-rchats"===e.id&&n===He.HYBRIDSEARCH.modules.SMARTCHAT&&"chat"===s?(e.getElementsByClassName("wms-hysearch-infotxt")[0]&&Fi(e.getElementsByClassName("wms-hysearch-infotxt")[0]),l='<span id="'+d+'" class="wms-hysearch-infotxt">'+a[s][He.REQSTATUS.NORESULTS]+"</span>"):r='<div class="wms-hysearch-error-info wms-hvalign"><img class="wms-hysearch-error-img" src="https://img.zohocdn.com/ichat/images/bar/a9c2d1f2_search_empty.svg"><div class="wms-hysearch-infotxt"><div class="wms-hysearch-infotext-1">'+$("search.noresult")+'</div><div class="wms-hysearch-infotext-2">'+$("search.again")+"</div></div>";else if(t===He.REQSTATUS.LOADING)r='<div class="wms_loading_container wms-hvalign"><div></div><div></div><div></div></div>';else if(t===He.REQSTATUS.FAILED){if("chat"==s&&!Ja().length&&n===He.HYBRIDSEARCH.modules.CHATMENU)Fi(To("recentchatswelcomemsg",n));l='<div id="'+d+'" class="wms-hysearch-loadstatus" data-retry="true" data-type="'+He.REQSTATUS.FAILED+'"><div class="wms-hysearch-infotxt wms-hvalign">'+a[s][He.REQSTATUS.FAILED]+'<span class="wms-hysearch-retry-text"> '+$("suggestions.retry")+"</span></div></div>"}l=l||'<div id="'+d+'" class="wms-hysearch-loadstatus wms-nonselectable" data-type="'+t+'">'+r+"</div>",o?o.outerHTML=l:e&&(n!==He.HYBRIDSEARCH.modules.CHATMENU||ja()&&ja().length||Da||e.children.length?e.insertAdjacentHTML("beforeend",l):e.innerHTML=l),t===He.REQSTATUS.FAILED&&(To("loadingstatus").onclick=i)}else Fi(o)}function Zo(e,t){for(var s,i,n="",a=To("inputcontainer")&&To("inputcontainer").querySelector("[data-type='topic']"),o=0;o<e.length;o++)if(i=Qo((s=e[o])._filtertype,a),s._filtertype===He.HYBRIDSEARCH.BOT)n+=Xo(s.USERID,s.DNAME,mi(ui(s.STATUSMSG)),Ft(s.USERID),i,He.HYBRIDSEARCH.BOT,null,null,s,t);else if(s._filtertype===He.HYBRIDSEARCH.CONTACT)s.id?n+=Xo(s.id,s.name,mi(ui(s.statusMsg)),s.photo,null,He.HYBRIDSEARCH.CONTACT,null,null,s,t):n+=Xo(s.USERID,s.DNAME,mi(ui(er(s))),null,i,He.HYBRIDSEARCH.CONTACT,null,null,null,t);else if(s._filtertype===He.HYBRIDSEARCH.ORGCONTACT)n+=Xo(s.USERID,s.DNAME,s.EMAILID,null,i,He.HYBRIDSEARCH.ORGCONTACT,null,null,null,t);else if(s._filtertype===He.HYBRIDSEARCH.GROUP)n+=Xo(s.ID,s.NAME,s.DESC,null,i,He.HYBRIDSEARCH.GROUP,null,null,null,t);else if(s._filtertype===He.HYBRIDSEARCH.CHANNEL)i=Lr(s.chid)?Qo(He.HYBRIDSEARCH.CHAT,a):i,n+=Xo(s.chid,Pr(s.chid),mi(s.cd),Dr(s.chid),i,He.HYBRIDSEARCH.CHANNEL,null,null,null,t,s.oc_id);else if(s._filtertype===He.HYBRIDSEARCH.CHAT){var r=s.TITLE;Di(s.CHATID)&&(r=Pr(s.CHATID)||r),n+=Xo(s.CHATID,r,So(s),tr(s),i,He.HYBRIDSEARCH.CHAT,s.LMTIME,"",s,t)}return n}function Ko(e,t,s,i){var n,a=t,o="",r="none";if(s&&(s.CUSTOMGROUP||"true"==s.CUSTOMGROUP)&&"false"!=s.CUSTOMGROUP&&(i=!0),a===He.HYBRIDSEARCH.CHAT&&!s.SALESIQCHAT)if(!Di(e)||Pi(e)||s.FEEDSID)if(Pi(e)){var l=zt(s.CHATID);a=He.HYBRIDSEARCH.BOT,o='<img data-zcprofileid="b-'+(e=l)+'" src="'+Ft(l)+'">'}else Li(e)?a=He.HYBRIDSEARCH.THREAD:!i&&s&&s.PARTICIPANTS&&2==s.PARTICIPANTS.length&&(e=s.PARTICIPANTS[0].zuid===H.get("zuid")?s.PARTICIPANTS[1].zuid:s.PARTICIPANTS[0].zuid,a=He.HYBRIDSEARCH.ORGCONTACT,void 0!==WmsMainUI&&WmsMainUI.setZuidForPrivateChat(s.CHATID,e));else a=He.HYBRIDSEARCH.CHANNEL;if(a===He.HYBRIDSEARCH.CONTACT||a===He.HYBRIDSEARCH.ORGCONTACT||a===He.HYBRIDSEARCH.BOT)n=a===He.HYBRIDSEARCH.BOT?e?Ft(e):"":e?Ms(e):"",o=Zi(e)?'<img data-zcprofileid="'+e+'" src="'+n+'">':'<div class="wms_menu_item_img wms_contacticon" data-imgid="'+e+'" data-originalsrc="'+n+'"></div>',r=bs(e);else{if(a===He.HYBRIDSEARCH.CHANNEL)return Dr(e);a===He.HYBRIDSEARCH.THREAD?(o='<span class="wms_badge_letter">'+yo(s.TITLE)+"</span>",r=bs(e)):s&&s.FEEDSID?o='<span class="wms_badge_letter"><span class="wms_notifyicon"></span></span>':"string"==typeof s.TITLE&&s.TITLE.length&&(o='<span class="wms_badge_letter">'+yo(s.TITLE)+"</span>")}return'<span class="wms_badge_imgwrapper wms_badge_statusicon_'+r+'">'+o+'<span class="wms_badge_statusicon_'+r+'_cutout wms_badge_img_cutout" data-cutouticon="true"></span></span>'}function Xo(e,t,s,i,n,a,o,r,l,d,c){d=d||Ao(),i=a===He.HYBRIDSEARCH.CHAT&&Di(e)&&!Pi(e)?Dr(e):(a===He.HYBRIDSEARCH.BOT&&l&&(i=ho(e,Ft(l.USERID))),i||ho(e)),a===He.HYBRIDSEARCH.CHANNEL&&(s=s||$("channel.nodescription")),t=ui(t);var m=n?'<span class="wms-hysearch-deschint">'+mi(n)+"</span>":"",u=e?"data-id={{id}} ":"";if(u+=c?"data-oc_id={{oc_id}}":"",a===He.HYBRIDSEARCH.TITLEHINT)return Hs('<div class="wms-hysearch-result" data-type="{{type}}"'+u+">"+i+'<div class="wms-hysearch-result-hint wms-truncate-ellipsis">'+mr(t)+"</div></div>",{id:e,type:a});if(a===He.HYBRIDSEARCH.MESSAGEHINT)return Hs('<div class="wms-hysearch-result"  data-type="{{type}}"'+u+">"+i+'<div class="wms-hysearch-result-hint wms-truncate-ellipsis">'+$("hint.openchatandsendmessage","<span>"+mi(t)+"</span>")+"</div></div>",{id:e,type:a,name:t});if(d!==He.HYBRIDSEARCH.modules.SMARTCHAT)return Jo(e,t,s,0,a,o,0,l);var p="";if(a===He.HYBRIDSEARCH.CHAT&&void 0!==WmsMainUI){var h=WmsMainUI.getUnreadCount(e);if(h)p='<span style="display:flex" class="wms_menu_item_count" data-unreadcount=true title="'+h+'">'+(99<h?"99+":h)+"</span>";else p='<span class="wms_menu_item_count" data-unreadcount=true></span>';WmsMainUI.getMuteStatus(e)&&(u+=' data-muted="true" ')}return Hs('<div class="wms-hysearch-result"  data-type="{{type}}"'+u+">"+i+'<div class="wms-hysearch-result-name wms-truncate-ellipsis">{{name}}</div><div class="wms-hysearch-result-desc wms-truncate-ellipsis">'+s+"</div>"+p+m+"</div>",{id:e,name:ui(t||hi(e,t)),type:a,oc_id:c})}function Jo(e,t,s,i,n,a,o,r){var l,d,c,m="wms_menu_item",u="",p="",h="",g="",f="",C="",v="",b="";if(a){var y=(ie(a,(new Date).getTime())?ee:ne)(a);u='<span class="wms_menu_item_time" title="'+te(a)+'">'+y+"</span>"}if(b='<div class="wms_menu_item_name wms-truncate-ellipsis" title="{{dname}}">{{dname}}</div>',!e&&r&&r.FEEDSID&&(e=r.FEEDSID,b='<div class="wms_menu_item_name" title="{{dname}}">{{dname}}</div>'),l=Ko(e,n,r),n===He.HYBRIDSEARCH.CHAT&&void 0!==WmsMainUI){var _=WmsMainUI.getUnreadCount(e);if(_)p='<span style="display:flex" class="wms_menu_item_count" data-unreadcount=true title="'+_+'">'+(99<_?"99+":_)+"</span>";else p='<span class="wms_menu_item_count" data-unreadcount=true></span>'}void 0!==WmsMainUI&&(c=WmsMainUI.getMuteStatus(e)),c&&(h=' data-muted="true" '),n===He.HYBRIDSEARCH.CHAT&&void 0!==WmsMainUI&&WmsMainUI.getZuidForPrivateChat(e)&&(g=WmsMainUI.getZuidForPrivateChat(e)),f=n===He.HYBRIDSEARCH.CHAT?'<div class="wms_menu_item_msg wms-truncate-ellipsis">'+s+"</div>":n===He.HYBRIDSEARCH.CONTACT?(Is(e)&&(s=ws(e),m=as(e)?"wms_menu_item":"wms_menu_item_invitations"),'<div class="wms_menu_item_msg wms-truncate-ellipsis" data-smsg="true" title="'+s+'">'+s+"</div>"):'<div class="wms_menu_item_msg wms-truncate-ellipsis" title="'+s+'">'+s+"</div>",(n!==He.HYBRIDSEARCH.CONTACT||Is(e)&&as(e))&&n!==He.HYBRIDSEARCH.ORGCONTACT||(C='<div class="wms_menu_item_profile_icon wms-valign-mid-block" data-zcprofileid="'+e+'"></div>'),n===He.HYBRIDSEARCH.CONTACT&&Is(e)&&(as(e)?v+='<div class="'+(vo.contact_operation_loader+" wms-valign-mid-block "+Co.loader)+'"></div>':v+='<div class="wms_menu_inv" data-id="{{id}}" data-dname="{{dname}}"><span data-operation="accept" title="'+$("Accept")+'" class="wms_menu_invaccept">'+$("Accept")+'</span><span>  |  </span><span title="'+$("remind.later")+'" data-operation="reject" class="wms_menu_invreject">'+$("remind.later")+"</span></div>");return d='<div class="'+m+'" data-id="{{id}}" {{useridforprivatechat}} data-dname="{{dname}}" '+h+' data-type="{{type}}">'+l+b+u+f+v+p+C+"</div>",n===He.HYBRIDSEARCH.CHAT&&(g=g&&"data-userid="+g),Hs(d,{id:e,type:n,dname:ui(hi(e,t)),useridforprivatechat:g})}function Qo(e,t){return e===He.HYBRIDSEARCH.CONTACT||e===He.HYBRIDSEARCH.ORGCONTACT?t?$("topic.adduser"):Lo().startsWith("@")?$("topic.addusertocreate"):$("chat.user"):e===He.HYBRIDSEARCH.GROUP?$("chat.group"):e===He.HYBRIDSEARCH.CHANNEL?$("channel.join"):e===He.HYBRIDSEARCH.CHAT?$("chat.continue"):void 0}function er(e){if(e.USERID){var t=ys(e.USERID);return t&&"-2"!=t.STATUS&&"-3"!=t.STATUS&&"-4"!=t.STATUS&&"-5"!=t.STATUS&&"-6"!=t.STATUS?fs(e.USERID):e.EMAILID}return""}function tr(e){for(var t,s="",i=[],n=0;n<e.PARTICIPANTS.length;n++)e.PARTICIPANTS[n].zuid!==H.get("zuid")&&i.push(e.PARTICIPANTS[n].zuid);e.CHATID&&Pi(e.CHATID)?s='<img class="wms-imgcollbot" src="'+Ft(zt(e.CHATID))+'"><div class="wms-img-badge wms-pos-bot"></div>':1!==i.length||e.CUSTOMGROUP&&"false"!=e.CUSTOMGROUP?5<e.PARTICIPANTSCOUNT?s='<img class="wms-imgcoll1" src="'+Ms(i[0])+'"><img class="wms-imgcoll2" src="'+Ms(i[1])+'"><img class="wms-imgcoll3" src="'+Ms(i[2])+'"><span class="wms-numcoll">+'+(e.PARTICIPANTSCOUNT-4)+"</span>":2===i.length?s='<img class="wms-imgcoll1" src="'+Ms(i[0])+'"><img class="wms-imgcoll4" src="'+Ms(i[1])+'">':3===i.length?s='<img class="wms-imgcoll1" src="'+Ms(i[0])+'"><img class="wms-imgcoll3" src="'+Ms(i[1])+'"><img class="wms-imgcoll4" src="'+Ms(i[2])+'">':4===i.length?s='<img class="wms-imgcoll1" src="'+Ms(i[0])+'"><img class="wms-imgcoll2" src="'+Ms(i[1])+'"><img class="wms-imgcoll3" src="'+Ms(i[2])+'"><img class="wms-imgcoll4" src="'+Ms(i[3])+'">':"string"==typeof e.TITLE&&e.TITLE.length&&(s='<div class="wms-lettercoll"><span>'+yo(e.TITLE)+"</span></div>"):e.PHOTO?s='<img class="wms-imgcoll1" src="'+e.PHOTO+'">':t=ho(i[0]);return t||'<div class="wms-imgcollage">'+s+"</div>"}function sr(e,t,s,i){var n,a=e.searchtext,o=(e.chid,wo(unescape(a),null,!1,i)),r={},l=0;o.forEach(function(e){(n=lo(e)).counter=l++,r[n.id]=n});var d=o.length<10;return"function"==typeof s&&s(r,!0,t,a,i),d}function ir(e,t){var s="",i=!0,n=(t=t||He.HYBRIDSEARCH.modules.CHATMENU)===He.HYBRIDSEARCH.modules.CHATMENU?"defaultresultdiv":"recentchatsdiv",a=to(),o=To("recentchatsdiv",t)||To("defaultresultdiv",t);if(e===He.REQSTATUS.FAILED||e===He.REQSTATUS.NORESULTS)Vo(o,e,"chat",Qa,t);else if(a&&a.length){if(t===He.HYBRIDSEARCH.modules.CHATMENU)s+=nr(Ba(),"pinnedchats")+nr(a,"recentchats"),void 0!==WmsMainUI&&WmsMainUI.bindRecentChatEvents();else a.sort(Ci("LMTIME",!0)),s+=lr(a,t)}else Vo(o,He.REQSTATUS.NORESULTS,"chat",null,t);t!==He.HYBRIDSEARCH.modules.SMARTCHAT&&parseInt(Da)&&(i=!!s,s=lr(Pa())+s);var r,l=To(n,t);if(l&&s){var d=l.querySelector("[data-select]");r=ar(),l.innerHTML=s,Yi(l);var c=d?l.querySelector('[data-id="'+d.getAttribute("data-id")+'"]'):"";c&&Go(c)}""!=s&&i&&6<a.length&&Vo(To("recentchatsdiv",t),He.REQSTATUS.LOADING,"chat",null,t),r&&void 0!==WmsMainUI&&WmsMainUI.filterUnreadChats(),void 0!==WmsMainUI&&WmsMainUI.updateUnreadChatsCount(),void 0!==WmsMainUI&&WmsMainUI.updateCountDependentUI()}function nr(e,t){var s="";if(0<e.length){var i,n="",a="",o="";if(e.sort(Ci("LMTIME",!0,null,"LASTTHREADMSGTIME")),"pinnedchats"==t)if(o=or(),Ba().length<=6)i="";else if(rr())i=" data-expanded=true",n='style="'+("height: "+50*Math.ceil(Ba().length/6)+"px")+'"',a=".expanded.filtertitle";else i=" data-expanded=false",a=".shrinked.filtertitle";else o=lr(e,He.HYBRIDSEARCH.modules.CHATMENU),a=".filtertitle";s='<div id="wms_menu_'+t+'" class="wms_menu_'+t+'" data-menu="'+t+'"'+i+'><div id="wms_menu_heading_'+t+'" class="wms_menu_subheading" data-heading="'+t+'"><span>'+$(t+".title")+'</span><div class="wms_menu_filter_icon" title="'+$(t+a)+'"></div></div><div id="wms_menu_chatlist_'+t+'" class="wms_menu_chatlist_'+t+'" '+n+">"+o+"</div></div>"}return s}function ar(){return void 0!==WmsMainUI&&!!WmsMainUI.defaultchatlist.querySelector('[data-heading="unreadchats"]')}function or(){var o="";return Ba().sort(Ci("order_position",!1)).forEach(function(e){var t=Ko(e.CHATID,He.HYBRIDSEARCH.CHAT,e),s="";void 0!==WmsMainUI&&WmsMainUI.getZuidForPrivateChat(e.CHATID)&&(s=" data-userid="+WmsMainUI.getZuidForPrivateChat(e.CHATID));var i='<div data-pc="true" data-type="{{chattype}}" data-id='+e.CHATID+s+' class="wms_menu_pinnedchats_fragment" title="{{title}}">'+t+"</div>",n=e.TITLE;Di(e.CHATID)&&(n=Pr(e.CHATID)||n);var a=He.HYBRIDSEARCH.CHAT;Li(e.CHATID)&&(a=He.HYBRIDSEARCH.THREAD),o+=Hs(i,{title:ui(n),chattype:a})}),o}function rr(){return void 0!==WmsMainUI&&!!WmsMainUI.defaultchatlist.querySelector('#wms_menu_pinnedchats[data-expanded="true"]')}function lr(e,t){var s,i="",n="";s=e&&e.length?e:Mo();for(var a=0;a<s.length;a++){var o=s[a].TITLE;Di(s[a].CHATID)&&(o=Pr(s[a].CHATID)||o),i+=Xo(s[a].CHATID,o,So(s[a]),tr(s[a]),null,He.HYBRIDSEARCH.CHAT,s[a].LMTIME,n,s[a],t),n=s[a].LMTIME}return i}function dr(){return To("inputcontainer").querySelectorAll("[data-type='user']")}function cr(){return ji(dr()).map(function(e){return Xi(e).slice(1)})}function mr(e){e=mi(e);var t=cr().map(function(e){return mi(e)}),s=t.pop(),i=t.join(", ");return s?0===t.length?$("chat.topic.singlemember",["<span>"+e+"</span>","<span>"+s+"</span>"]):$("chat.topic.multiplemember",["<span>"+e+"</span>","<span>"+i+"</span>","<span>"+s+"</span>"]):0===t.length?$("chat.topic.set","<span>"+e+"</span>"):void 0}var ur=Object.freeze({__proto__:null,filter:bo,getBadgeLetters:yo,getPrivateChatDetails:_o,getZuidForPrivateChat:Wo,createLastMsgInfoHtml:So,generateSearchResults:wo,generateRecentChatResults:Mo,generateChatResults:Io,getNode:To,getCurrentModule:Ao,generateContactResults:Eo,generateUnsubscribedBotResults:Uo,generateOrgContactResults:xo,generateChannelResults:No,updateManager:Ho,getSearchText:Lo,getResultSet:Bo,getPlainSearchText:jo,showContactInvite:Fo,invokeRetry:zo,changeHover:Go,resetHover:qo,fetchFromServer:Yo,updateLoadingStatus:Vo,generateHtml:Zo,generateImageHtml:Ko,createResultFragment:Xo,generateContactHtml:Jo,getResultInfo:Qo,getDescription:er,createImageCollageHtml:tr,updateListAndCheckIfIncomplete:sr,populateRecentChats:ir,generateChatMenuHtml:nr,isUnreadFilterOpen:ar,generatePinnedChatMenuHtml:or,isPinnedChatsExpanded:rr,generateRecentChatResultsHTML:lr,getChosenUsers:dr,getChosenUsersName:cr,getTitleHint:mr}),pr={},hr=[],gr=null,fr={},Cr=!1,vr=!1,br=null,yr={1:"org_channels",2:"team_channels",3:"private_channels",4:"external_channels"};function _r(e){br=e}function Wr(){return br}function Sr(e){return e?pr[e]:pr}function wr(){return yr}function Mr(e){var t=Sr(e);return!(!t||t.sc!==He.CHANNELS.TEAM)}function Ir(){if(null===gr||br){void 0!==WmsMainUI&&WmsMainUI.updateLoadingForPinnedChats(!0);var e="pageload=true&mode=joined&limit=50";br&&(e+="&next_token="+br),Ie("getchannels.do",e,qr,Ur)}else(Cr||gr+216e5<(new Date).getTime())&&jr()}var Tr=Bi(function(){bi(pr)&&null!==gr&&!Cr||Ir()},null,1e3,!0);function Ar(e,t,s){void 0===pr[e]&&(pr[e]={}),pr[e][t]=s}function Er(e){vr=!1;var t=e.data;t&&t.allowed&&t.allowed.forEach(function(e){"1"===e.st&&1==(pr[e.chid]=e).scid.length&&(pr[e.chid]._teamname=e.scid_name[e.scid[0]])}),(t&&t.joined||t&&!t.allowed)&&(t.joined&&t.joined.length?t.joined:[t]).forEach(function(e){if("1"===e.st&&(1==(pr[e.chid]=e).scid.length&&(pr[e.chid]._teamname=e.scid_name[e.scid[0]]),pr[e.chid].read&&pr[e.chid].totmsg&&"-1"!=pr[e.chid].read&&(pr[e.chid].unreadmsgs=pr[e.chid].totmsg-pr[e.chid].read),void 0!==WindowHandler)){var t=WindowHandler.getWinObjById(e.chid);t&&(t.setTitle(Pr(e.chid)),"-1"!==e.muted_interval&&t.updateMuteInfo(e.muted_interval))}});void 0!==WindowHandler&&WindowHandler.updateChannelProperties(),setTimeout(function(){Si.publish("/channels/updatelist",wi(e.data))}.bind(this),1),void 0!==WmsMainUI&&WmsMainUI.joinScheduledChannels(),void 0!==WebMessanger&&Za(WebMessanger.unreadthreadmap)}function Ur(){var e=this.opts.callbackargs&&this.opts.callbackargs.reqid;Si.publish("/channels/updateui",{reqid:e,stat:He.REQSTATUS.FAILED})}function xr(e,t,s){var i=bo(s||"cn",e,pr,null,null,"_teamname");return i=i.filter(function(e){if(Ut(yr[e.sc])&&(t&&e.joined||!t))return!0})}function Nr(e){return xr(e,!1,"_teamname")}function kr(e){return xr(e,!1,"cn")}function Or(e,t){return bo("cn",t,Nr(e))}function Rr(e){return-1!==hr.indexOf(Hr(e))}function Hr(e){return"limit=20&search="+encodeURIComponent(e)}function $r(e,t){var s=e.searchtext,i=Hr(s),n=e.topicname,a=e.silentload,o=e.chid;s&&-1===hr.indexOf(i)?Ie("getchannels.do",i,qr,Ur,{reqid:t,params:i,topicname:n,chid:o,silentload:a,searchtext:s}):n?Si.publish("/channels/"+n,{callbackargs:e}):Si.publish("/channels/updateui",{reqid:t})}function Dr(e,t){var s="object"==typeof e?e:Sr(e);if(s){var i="";s.photoid&&(i=Zi(e)||t?'<img data-channelid="'+e+'" src="/'+H.get("CHATCONT")+"/channel/"+s.photoid+'/photo.do"></img>':'<div data-channelimgid="'+e+'" data-originalsrc="/'+H.get("CHATCONT")+"/channel/"+s.photoid+'/photo.do"></div>');var n,a=s.sc;"1"===a?n="orgchannel":"2"===a?n="orggroup":"3"===a?n="privatechannel":"4"===a&&(n="shared-channel");var o=t?'-large">':'-small">';return i?'<span class="wms_badge_imgwrapper wms_channelimg_badge wms-'+n+o+i+"</span>":'<span class="wms_badge_imgwrapper wms_channelimg wms-'+n+o+i+"</span>"}var r="";return(s=ja(e))&&s.TITLE&&(r=s.TITLE),'<span class="wms_badge_imgwrapper"><span class="wms_badge_letter">'+yo(r)+"</span></span>"}function Lr(e){var t=Sr(e);return!(!t||!t.joined||1!=t.joined)}function Pr(e){var t=Sr(e);if(t){var s=t.dn;return s||(s=t.cn,t._teamname&&(s=s+"@"+t._teamname)),s}}function Br(){gr=(new Date).getTime(),Cr=vr=!1;var e=JSON.parse(this.response)[0].objString;if("clearchanneldb"===this.getResponseHeader("x-zcoperation"))gr=null,Ir();else if(this.getResponseHeader("x-zcoperation"))gr=this.getResponseHeader("x-zcoperation");else if(e.leftchanneluids||e.deletedchanneluids){var t=e.leftchanneluids||e.deletedchanneluids;for(var s in t){var i=Fr(s)[0],n=i&&i.chid;delete pr[n]}}else{if(e.newjoinedchannels){var a=e.newjoinedchannels;for(var o in a){var r=a[o].chid;pr[r]=a[o]}}if(e.groupsnamemodified){var l=e.groupsnamemodified,d=bo("sc",He.CHANNELS.TEAM,pr),c=function(s){d.forEach(function(e){if(-1!==e.scid.indexOf(s)){var t=l[s];e._teamname&&(e._teamname=t),e.scid_name[s]=t}})};for(var m in l)c(m)}if(e.channelidvsdatamodified){var u=e.channelidvsdatamodified;for(var p in u){var h=Fr(p)[0];if(h){var g=u[p];for(var f in g)h[f]=g[f]}}}}Si.publish("/channels/updateui",{})}function jr(){Ie("synchannels.do","lastsynctime="+gr,Br)}function Fr(e){return bo("oc_id",e,pr)}function zr(e){var t;return!WmsSettings.adminsettings.features||("true"==WmsSettings.adminsettings.features.thread_allowed_teams?t=!0:(t=!0,Mr(e)?Sr(e).scid.forEach(function(e){-1==WmsSettings.adminsettings.features.thread_allowed_teams.split(",").indexOf(e)&&(t=!1)}):t=!1),WmsSettings.adminsettings.features.chat_thread_feature&&t)}function Gr(e){if(!pr[e.chid]&&e.channelData){var t="object"==typeof e.channelData?e.channelData:JSON.parse(e.channelData);t.pc=e.pcount,pr[t.chid]=t,void 0!==WmsMainUI&&(WmsMainUI.menu&&"block"!==WmsMainUI.menu.style.display?(WmsMainUI.updateUnreadChatsCount(),WmsMainUI.updateCountDependentUI()):Si.publish("/channels/updateui",{}))}}function qr(e){if(gr=(new Date).getTime(),Er(e),this.opts){this.opts.callbackargs&&this.opts.callbackargs.params&&hr.push(this.opts.callbackargs.params);var t=this.opts.callbackargs&&this.opts.callbackargs.reqid,s=this.opts.callbackargs&&this.opts.callbackargs.topicname;_r(e.meta&&e.meta.next_token?e.meta.next_token:null),s?Si.publish("/channels/"+s,{callbackargs:this.opts.callbackargs,reqid:t}):Si.publish("/channels/updateui",{callbackargs:this.opts&&this.opts.callbackargs,reqid:t})}}var Yr=Object.freeze({__proto__:null,setNextToken:_r,getNextToken:Wr,get:Sr,getLastFetchedTime:function(){return gr},getChannelsSync:function(){return Cr},setChannelsSync:function(){Cr=!0},getChannelsIfFocussed:function(){return vr},setChannelsFocussed:function(){vr=!0},getChannelTypes:wr,getTeamMembersList:function(e){return e?fr[e]:fr},insertTeamMemberslist:function(e,t){fr[e]||(fr[e]=t)},getTeamChannelMembers:function(e){var t=Sr(e),i={};return t.scid.forEach(function(e){if(fr[e]){var t=fr[e];for(var s in t)i[s]=t[s]}}),i},isSharedChannel:function(e){var t=Sr(e);return!(!t||t.sc!==He.CHANNELS.SHARED)},isTeamChannel:Mr,isDefaultChannel:function(e){var t=Sr(e);return!(!t||!t.is_default)},isUserHasPermission:function(e,t){var s=Sr(e);if(s&&!ri(s)&&s.permissions){var i=s.currole,n=s.permissions;return i==He.USERROLES.SUPER_ADMIN?!0:i==He.USERROLES.ADMIN&&0!=(n.adminp&1<<t)||(i==He.USERROLES.CREATOR&&0!=(n.crp&1<<t)||(i==He.USERROLES.MODERATOR&&0!=(n.modp&1<<t)||1==s.joined&&0!=(n.partp&1<<t)))}return!0},initChannels:Ir,getChannels:Tr,getJoinedChannels:function(e){var t=[];for(var s in pr){var i=pr[s];i.joined&&Ut(yr[i.sc])&&t.push(pr[s])}return t.sort(Ci("lmtime",!0)),t.slice(0,e)},updateChannel:Ar,updateList:Er,updateAddinfoData:function(e,t){var s=Sr(e);s&&(s.addinfo=s.addinfo?s.addinfo+":"+t:t)},updateTitle:function(e,t){var s=Sr(e);s&&(Mr(e)?s.dn=t+": @"+s.scid_name[s.scid]:s.dn=t),Si.publish("/recentchats/updateui",He.REQSTATUS.SUCCESS)},handleFailure:Ur,getList:xr,getListByTeamName:Nr,getListByChannelName:kr,getListByUniqueName:function(e){return xr(e,!1,"un")},getListByTeam_ChannelName:Or,isCachedRequest:Rr,_constructParams:Hr,fetchFromServer:$r,getChannelImageHTML:Dr,isJoinedChannel:Lr,getChannelName:Pr,updateModifiedData:Br,syncChannels:jr,getChannelByOC_id:Fr,isReplyActionAllowed:function(e){var t=Sr(e);return t&&WmsSettings.getAdminSetting("moduleconfig")&&"false"===WmsSettings.getAdminSetting("moduleconfig")[yr[t.sc]].configs.allow_override?"threads"!==WmsSettings.getAdminSetting("moduleconfig")[yr[t.sc]].configs.reply_mode:!t||!t.config||"threads"!==t.config.reply_mode},isThreadFeatureEnabled:zr,isThreadReplyAllowed:function(e){if(zr(e)){var t=Sr(e);return t&&WmsSettings.getAdminSetting("moduleconfig")&&"false"===WmsSettings.getAdminSetting("moduleconfig")[yr[t.sc]].configs.allow_override?"normal_reply"!==WmsSettings.getAdminSetting("moduleconfig")[yr[t.sc]].configs.reply_mode:!t||!t.config||"normal_reply"!==t.config.reply_mode}return!1},updateConfig:function(e,t){var s=Fr(e);s.length&&(s[0].config=t)},updateChannelMetaData:Gr,fetchNextResultSet:function(){Ir()},updateListWithLastFetchedTime:qr}),Vr={wms_callbutton_wrapper:"mc00c08e4a_wms_callbutton_wrapper",wms_audiocall:"mc00c08e4a_wms_audiocall",wms_videocall:"mc00c08e4a_wms_videocall",wms_screenshare:"mc00c08e4a_wms_screenshare",wms_callinfo:"mc00c08e4a_wms_callinfo",inftxt:"mc00c08e4a_inftxt",wms_infotext:"mc00c08e4a_wms_infotext",wms_callduration:"mc00c08e4a_wms_callduration","wms-msgsenderhl":"wms-msgsenderhl",wms_profileinfo_text:"mc00c08e4a_wms_profileinfo_text","wms-msgsender":"wms-msgsender","wms-msginfo":"wms-msginfo"};function Zr(e,t){var s=e.msg.type;s=-1!=s.indexOf("screen")?"screen":s;function i(e,t,s){var i="audio"===s?Vr.wms_audiocall:"video"===s?Vr.wms_videocall:Vr.wms_screenshare,n="audio"===s?"triggerAudioCall":"video"===s?"triggerVideoCall":"triggerScreenShare",a=-1!=s.indexOf("screen")?"chat.screen.share":t?"info.call.again":"info.call.back";return'<div class="'+Vr.wms_callbutton_wrapper+'"><span data-infocallbtn="'+n+'" class="'+i+'" data-calleezuid="'+e+'"></span> <span data-infocallbtn="'+n+'" class="'+Vr.wms_callinfo+'" data-calleezuid="'+e+'">'+$(a)+"</span></div>"}var n=e.msg.caller||e.opruser,a=Ai(n.zuid),o=e.msg.calleduser||e.msg.callee,r="",l="";switch(e.msg.event||e.msg.status){case"completed":case"CALL_END":var d,c=0,m=0,u=0;"string"==typeof e.msg.duration&&-1!=e.msg.duration.indexOf(":")?(d=e.msg.duration.split(":"),c=parseInt(d[0]),m=parseInt(d[1]),u=parseInt(d[2])):(3600<=(d=parseInt(e.msg.duration/1e3))&&(c=parseInt(d/3600),d%=3600),60<=d&&(m=parseInt(d/60),d%=60),d<60&&(u=d));var p=0!==c?" "+c+" "+(1<c?"hrs":"hr"):"",h=0!==m?" "+m+" "+(1<m?"mins":"min"):"",g=0!==u?" "+u+" "+(1<u?"secs":"sec"):"";l="audio"===s?"videochat.audiocall":"video"===s?"videochat.videocall":"media.screenshare.session",r=t?$("info.call.completed",[$(l)]):'<span class="'+Vr.inftxt+'"><span class="'+Vr.wms_infotext+'">'+$("info.call.completed",[$(l)])+'</span> <span class="'+Vr.wms_callduration+'">'+p+h+g+"</span>"+i(a?o.zuid:n.zuid,!0,s)+"</span>";break;case"cancelled":case"CALL_CANCELED":r=t?a?$("info.call.cancelled.caller",[$("info.call."+s)]):$("info.call.cancelled.callee",[hi(n.zuid,e.opruser.nname,!0),$("info.call."+s)]):a?'<span class="'+Vr.inftxt+'"><span class="'+Vr.wms_infotext+'">'+$("info.call.cancelled.caller",[$("info.call."+s)])+"</span>"+i(o.zuid,a,s)+"</span>":'<span class="'+Vr.inftxt+'"><span class="'+Vr.wms_infotext+'">'+$("info.call.cancelled.callee",['<span class="'+Vr.wms_profileinfo_text+'" data-zcprofileid='+n.zuid+">"+hi(n.zuid,e.opruser.nname,!0)+"</span>",$("info.call."+s)])+"</span>"+i(n.zuid,a,s)+"</span>";break;case"noresponse":case"CALL_MISSED":l=a?"info.call."+s+"call":"info.call."+s,r=t?a?$("info.call.noresponse.caller",[hi(o.zuid,o.nname,!0),$(l)]):$("info.call.noresponse.callee",[$(l)]):a?'<span class="'+Vr.inftxt+'"><span class="'+Vr.wms_infotext+'">'+$("info.call.noresponse.caller",['<span class="'+Vr.wms_profileinfo_text+'" data-zcprofileid='+o.zuid+">"+hi(o.zuid,o.nname,!0)+"</span>",$(l)])+"</span>"+i(o.zuid,a,s)+"</span>":'<span class="'+Vr.inftxt+'"><span class="'+Vr.wms_infotext+'">'+$("info.call.noresponse.callee",[$(l)])+"</span>"+i(n.zuid,a,s)+"</span>";break;case"busy_on_another_call":case"CALL_MISSED_ON_BUSY":var f="";f=Ai(e.opruser.zuid)?"screen"===s?"info.call.busy.callee.screen":"info.call.busy.callee.av":"screen"===s?"info.call.busy.caller.screen":"info.call.busy.caller.av";var C=Ai(e.opruser.zuid)?e.msg.caller.zuid:e.opruser.zuid,v=Ai(e.opruser.zuid)?e.msg.caller.nname:e.opruser.nname,b=$(f,['<span class="'+Vr.wms_profileinfo_text+'" data-zcprofileid='+C+">"+hi(C,v,!0)+"</span>"]);r=t?$(f,[hi(C,v,!0)]):'<span class="'+Vr.inftxt+'"><span class="'+Vr.wms_infotext+'">'+b+"</span>"+i(C,a,s)+"</span>";break;case"rejected":case"CALL_DECLINED":r=t?a?$("info.call.rejected.caller",[hi(o.zuid,o.nname,!0),$("info.call."+s+"call")]):$("info.call.rejected.callee",[$("info.call."+s)]):a?'<span class="'+Vr.inftxt+'"><span class="'+Vr.wms_infotext+'">'+$("info.call.rejected.caller",['<span class="'+Vr.wms_profileinfo_text+'" data-zcprofileid='+o.zuid+">"+hi(o.zuid,o.nname,!0)+"</span>",$("info.call."+s+"call")])+"</span>"+i(o.zuid,a,s)+"</span>":'<span class="'+Vr.inftxt+'"><span class="'+Vr.wms_infotext+'">'+$("info.call.rejected.callee",[$("info.call."+s)])+"</span>"+i(n.zuid,a,s)+"</span>"}return r}function Kr(e,t){var s,i=e.mode,n=e.msg;switch(i){case"THREAD_CLOSED":var a=n.closed_by,o=Ai(a.zuid)?$("You"):a.display_name;n=$("thread.state.closed",[o]);break;case"THREAD_REOPENED":o=Ai(e.opruser.zuid)?$("You"):e.opruser.nname,n=$("thread.state.reopened",[o]);break;case"GUEST ENTERED":n=$("Guest")+" "+e.nname+" "+$("entered_the_chat");break;case"USER ADDED":var r=new Array,l=e.userslist;if(l[(o=e.opruser).zuid]){n=$("chat.member.joined",'<span class="'+Vr.wms_profileinfo_text+'" data-zcprofileid='+o.zuid+">"+hi(o.zuid,o.nname,!0)+"</span>");break}for(var d in l)r.push('<span class="'+Vr.wms_profileinfo_text+'"  data-zcprofileid='+d+">"+hi(d,l[d],!0)+"</span>");n=$(s="chat.member.add",['<span class="'+Vr.wms_profileinfo_text+'" data-zcprofileid='+o.zuid+">"+hi(o.zuid,o.nname,!0)+"</span>",r.join(", ")]);break;case"GUEST LEFT":n=$("Guest")+" "+e.nname+" "+$("left_the_chat");break;case"USER DELETED":if(r=new Array,l=e.userslist,o=e.opruser){if(l[o.zuid]){n=$("chat.member.left",'<span class="'+Vr.wms_profileinfo_text+'" data-zcprofileid='+o.zuid+">"+hi(o.zuid,o.nname,!0)+"</span>");break}for(d in l)r.push('<span class="'+Vr.wms_profileinfo_text+'"  data-zcprofileid='+d+">"+hi(d,l[d],!0)+"</span>");n=$(s="chat.member.delete",['<span class="'+Vr.wms_profileinfo_text+'" data-zcprofileid='+o.zuid+">"+hi(o.zuid,o.nname,!0)+"</span>",r.join(", ")])}else n=$("chat.participant.remove");break;case"GUEST ACCESS":n=hi((o=e.opruser).zuid,o.nname,!0)+" "+$("turned")+" "+("on"==e.access?$("on"):$("off"))+" "+$("guest_access");break;case"TITLE CHANGE":o=e.opruser,s="chat.rename",n=e.title?$(s,['<span class="'+Vr.wms_profileinfo_text+'" data-zcprofileid='+o.zuid+">"+hi(o.zuid,o.nname,!0)+"</span>",mi(e.title)]):$("chat.title.clear",['<span class="'+Vr.wms_profileinfo_text+'" data-zcprofileid='+o.zuid+">"+hi(o.zuid,o.nname,!0)+"</span>"]);break;case"CALL STARTED":n=$("chat.call.start");break;case"CALL ENDED":n=$("chat.call.end");break;case"BROADCAST STARTED":n=$("chat.broadcast.live",[hi((o=e.opruser).zuid,o.nname,!0)]);break;case"BROADCAST STOPPED":n=$("chat.broadcast.stop");break;case"CALLNOTIFICATION":case"CALL_INFO":n=Zr(e);break;case"MESSAGE EDITED":o=e.opruser;var c=t&&!Ts(o.zuid)?'<span class="'+Vr.wms_profileinfo_text+'" data-zcprofileid='+o.zuid+">"+hi(o.zuid,o.dname,!0)+"</span>":hi(o.zuid,o.dname,!0),m=Ai(o.zuid)?$("You"):c;n=$("chat.edit.infomsg",[m,'<span data-replymsgtime="'+e.info.ref_msg_time+'">'+$("chat.edit.message")+"</span>"]);break;case"CHANNEL_MENTION":m=Ai((o=e.opruser).zuid)?$("common.you.have"):'<span class="'+Vr.wms_profileinfo_text+'" data-zcprofileid='+o.zuid+">"+hi(o.zuid,o.nname,!0)+"</span>";n=$("channel.mention.infomsg",[m,e.msg.channelname]);break;case"CHANNEL_VISIBILITY_CHANGE":m=Ai((o=e.opruser).zuid)?$("common.you.have"):'<span class="'+Vr.wms_profileinfo_text+'" data-zcprofileid='+o.zuid+">"+hi(o.zuid,o.nname,!0)+"</span>";if("1"===e.msg.level)"true"===e.msg.open_to_all?n=$("channel.org.opentoall.infomsg",[m]):"false"===e.msg.open_to_all&&(n=$("channel.org.inviteonly.infomsg",[m]));else if("2"===e.msg.level){var u=Sr(e.chid),p=u?u.scid_name[u.scid[0]]:"";"true"===e.msg.open_to_all?n=$("channel.team.opentoall.infomsg",[m,p]):"false"===e.msg.open_to_all&&(n=$("channel.team.inviteonly.infomsg",[m,p]))}break;case"MESSAGE_PINNED":var h=e.msg.msguid.split("%")[0],g=e.opruser.zuid,f=hi(e.opruser.zuid,e.opruser.nname,!0),C='<span data-pinned-msgtime="'+h+'" data-pinned-user="'+g+'" class="wms_pinmsg_infomsg">'+$("chat.edit.message")+"</span>";n=Ai(g)?$("pinmsg.infomsg.you",[C]):$("pinmsg.infomsg",[f,C]);break;case"EVENTNOTIFICATION":n=function(e){var t=e.msg.type;{if("EVENT_EDITED"==t){var s=e.msg.event_details.old_data,i=e.msg.event_details.new_data,n=mi(ui(i.title)),a=mi(ui(s.title)),o=i.startdate,r=i.location?mi(ui(i.location)):null,l=s.location?mi(ui(s.location)):null,d=!1,c=void 0,m=hi(e.opruser.zuid,e.opruser.nname,!0),u="",p=[];if(n!==a){var h=se(o);u=Ti(r)?"event.edit.title.location":"event.edit.title",p=[m,n,h,r],d=!0}if(Ti(l)){if(!Ti(r))if(c="add",d)u="event.edit.title.location.add",p=[n,r];else{h=se(o);u="event.edit.location.add",p=[r,h]}}else Ti(r)?(c="remove",p=d?(u="event.edit.title.location.remove",[n,m,l]):(u="event.edit.location.remove",[m,l])):r!==l&&(c="change",p=d?(u="event.edit.title.location.change",[n,r,l]):(u="event.edit.location.change",[r,l]));var g=s.startdate;if(o!=g){var f=se(o),C=se(g);if(d)if(void 0!==c)switch(u="event.edit.title.location."+c+".reschedule",c){case"add":p=[n,r,f];break;case"remove":p=[n,f,m,l];break;case"change":p=[n,f,r]}else u="event.edit.title.reschedule",p=[n,f,C];else if(void 0!==c)switch(u="event.edit.location."+c+".reschedule",c){case"add":p=[r,f,C];break;case"remove":p=[f,C,m,l];break;case"change":p=[r,f]}else u="event.edit.reschedule",p=[f,C]}return void 0!==u?$(u,p):$("event.edited.infomsg",[n])}if("EVENT_REMINDER"==t){var v=e.msg,b=v.reminder_value,y=mi(ui(v.title)),_=v.location?mi(ui(v.location)):null,W="";return $(W=-1===b?"event.end.infomsg":(W="event.reminder",W=5===b?W+".five.minutes":W+".one.hour",_?W+".venue":W),[y,_])}if("EVENT_DELETED"==t)return $("event.info.deleted",[hi(e.opruser.zuid,e.opruser.nname,!0)]);if("START"==t)return $("event.start.infomsg",[mi(ui(e.msg.title))]);if("EVENTS_CONFERENCE"==t){var S=0===e.msg.reminder_value,w=mi(ui(e.msg.title));return S?$("conference.quick.desc",[w]):$("conference.desc",[w,15])}}}(e);break;case"SHOWTIMENOTIFICATION":n=$("event.showtime.infomsg",[m=hi(e.opruser.zuid,e.opruser.nname,!0),e.msg.presenterurl]);break;case"CHANNEL_CONFIG_CHANGE":"reply_mode"===e.msg.name&&("normal_reply"===e.msg.value?n=$("threads.replymode.normal"):"threads"===e.msg.value?n=$("threads.replymode.thread"):"both"===e.msg.value&&(n=$("threads.replymode.both")))}return"string"==typeof n?n:""}var Xr=Object.freeze({__proto__:null,getCallNotificationMessage:Zr,getInfoMsgString:Kr}),Jr="mcfb690f8a_urlpreviewparent",Qr="mcfb690f8a_imagecontainer",el="mcfb690f8a_previewcontent",tl="mcfb690f8a_image",sl="mcfb690f8a_title",il="mcfb690f8a_url",nl="mcfb690f8a_providername",al="mcfb690f8a_preview",ol="mcfb690f8a_dynamicclass",rl="mcfb690f8a_description",ll="mcfb690f8a_closeicon",dl="mcfb690f8a_previewfooter",cl="mcfb690f8a_previewheader",ml="mcfb690f8a_favicon",ul="mcfb690f8a_domaindetails",pl="mcfb690f8a_fieldscontainer",hl="mcfb690f8a_field",gl="mcfb690f8a_label",fl="mcfb690f8a_value",Cl="mcfb690f8a_actionscontainer",vl="mcfb690f8a_circle",bl="mcfb690f8a_notification_settings_icon",yl=window.location.protocol+"//workdrive.zoho.com";function _l(e){return e=ge.replacer(ge.getRegexToGetAttrValueInHtmlTag("iframe","src"),null,e,function(e,t,s,i,n,a){var o=t+(n+(-1===n.indexOf("?")?"?":"&")+"autoplay=true")+a;return-1==o.indexOf("sandbox")&&(o=o.replace(s,s+" sandbox='allow-scripts allow-same-origin'")),o})}function Wl(e){for(var t=["width","height"],s=0;s<t.length;s++)e=ge.replacer(ge.getRegexToGetAttrValueInHtmlTag("iframe",t[s]),null,e,function(e,t,s,i,n,a){var o=t+"100%"+a;return-1==o.indexOf("sandbox")&&(o=o.replace(s,s+" sandbox='allow-scripts allow-same-origin'")),o});return e}function Sl(e,t){return-1!=["application/msword","application/vnd.oasis.opendocument.text","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/rtf","application/ooxml","application/vnd.ms-excel","application/vnd.oasis.opendocument.spreadsheet","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.sun.xml.calc","text/csv"].indexOf(e)||"application/zip"===e&&-1!=["docx","sxc"].indexOf(t)||"text/plain"===e&&-1!=["csv","tsv"].indexOf(t)}function wl(e){return Ml(yl).test(e)}function Ml(e){return new RegExp("(https?://)?(www.)?"+e+"/(file|folder)/([a-z0-9]{37})","g")}function Il(e,t){var s=t,i=new URL(t).search,n=new URLSearchParams(i);if(n.has("authId")){var a=n.get("authId"),o=JSON.parse(a);o.entity_id!=e.chid&&(o.entity_id=e.chid,n.set("authId",encodeURIComponent(JSON.stringify(o))),s=t.split("?")[0]+"?"+n.toString())}else{var r={entity_id:e.chid,module:"Chats"};s=t+(-1!=t.indexOf("?")?"&":"?")+"authId="+encodeURIComponent(JSON.stringify(r))}return s}var Tl=Object.freeze({__proto__:null,workdrivedomain:yl,populate:function(e,t,s,i,n){var a=e.providername,o=e.providerurl||"www."+a+".com",r="",l="",d="",c=e.title||"",m="",u="",p="",h="",g="",f="",C="",v=dl;s&&(u=s.date,p=s.time,h=s.sender,g=s.dname),i&&(m=ll);var b='<div class="{{descriptionclass}}" title="{{description}}">{{description}}</div>';if(e.cliq_message&&e.description){var y=st(e.description);e.cliq_message.meta&&e.cliq_message.meta.mentions&&(e.cliq_message.msg=y,y=gi(e.cliq_message)),b=Hs('<div class="{{descriptionclass}}">'+y+"</div>",{descriptionclass:rl})}else b=Hs(b,{description:e.description||e.url,descriptionclass:rl});if(!a){o="//"+(a=e.url.match(/:\/\/(.[^/]+)/)[1])}if(e.thumbnailurl||-1<e.mimetype.indexOf("image/")){var _=!1,W=e.thumbnailurl,S=!1;n&&(_=!0),-1<e.mimetype.indexOf("image/")&&(W=e.url),"svg"==W.split(".")[W.split(".").length-1]&&(S=!0),d=Hs(d='<div class="{{imagecontainerclass}}">'+(i?'<img data-urlpreviewimg="true" class="{{imageclass}}" src="{{imageurl}}" data-svgthumb="{{svgthumb}}" data-previewable="true" data-src="{{imageurl}}" data-fdate="{{date}}" data-ftime="{{time}}" data-fname="{{name}}" data-fsize data-fcontent data-fsender="{{sender}}" data-dname="{{dname}}" data-rich="{{richformat}}"/>':'<img data-urlpreviewimg="true" class="{{imageclass}}" data-originalsrc="{{imageurl}}" data-svgthumb="{{svgthumb}}" data-previewable="true" data-src="{{imageurl}}" data-fdate="{{date}}" data-ftime="{{time}}" data-fname="{{name}}" data-fsize data-fcontent data-fsender="{{sender}}" data-dname="{{dname}}" data-rich="{{richformat}}"></img>')+"</div>",{imagecontainerclass:Qr,imageclass:tl,imageurl:W,name:a,date:u,time:p,sender:h,dname:g,richformat:_,svgthumb:S})}if(n&&(r=Hs(r='<div data-previewable="true" data-ftime="{{time}}" data-fsender="{{sender}}" data-fdate="{{date}}" data-dname="{{dname}}" data-fname="{{name}}" data-unfurl="true" src="{{src}}" class="{{previewclass}}">{{preview}}</div>',{previewclass:al,src:e.html||e.iframe_url,name:a,date:u,time:p,sender:h,dname:g,$preview:"chat.preview"})),e.btnindexvsdetails){var w=e.btnindexvsdetails;for(var M in w)e.notification_configs&&Ki(e.notification_configs)&&-1<e.notification_configs.indexOf(w[M].index)||(C+=Hs('<div class="{{circle}}"></div><div class="{{dynamicclass}}" data-fname={{fname}} data-urlactions="true" btnindex={{btnindex}} data-url="{{url}}" title="{{label}}">{{label}}</div>',{dynamicclass:ol,url:e.url,circle:vl,label:w[M].label,fname:w[M].action.data.name,btnindex:w[M].index}));e.notification_configs&&0<e.notification_configs.length&&(C+=Hs('<div class="{{settingsicon}}" data-urlnotification="true"></div>',{settingsicon:bl}))}if(n&&e.dynamic_actions){var I="";e.dynamic_action_params&&0<e.dynamic_action_params.length&&(I=e.dynamic_action_params[0]),l=Hs('<div class="{{circle}}"></div><div class="{{dynamicclass}}" data-dynamicactions="true" data-url="{{url}}" title="{{more}}" data-dactionsparam={{dynamicactionsparam}}>{{more}}</div>',{dynamicclass:ol,url:e.url,dynamicactionsparam:I||"false",circle:vl,$more:"more"})}e.faviconlink&&(f=Hs(f='<img class="{{faviconclass}}" data-urlfavicon="true" src="{{faviconlink}}"/>',{faviconclass:ml,faviconlink:e.faviconlink}));var T="";if(e.fields&&!e.unfurldata_cache_id){for(var A=e.fields.data,E="",U=0;U<A.length;U++)E+=Hs("<div class={{field}}><div class={{labelclass}} title='{{label}}'>{{label}}</div><div class={{valueclass}} title='{{value}}'>{{value}} </div></div>",{label:A[U].label,value:A[U].value,valueclass:fl,labelclass:gl,field:hl});T=Hs("<div class={{fieldscontainer}}>"+E+"</div>",{fieldscontainer:pl})}var x=e.url;wl(x)&&!i&&yn()&&(x=Il(e,x));var N='<div class={{previewheader}}><a target="_blank" rel="noopener" href="{{url}}" class="{{titleclass}}" tabindex="-1" title="{{title}}"> {{title}} </a><div class="{{closeicon}}" data-urlpreviewclose="true"/></div></div><div class="{{previewcontent}}">'+d+b+"</div>"+T+'<div class="{{previewfooter}}"><div class="{{domaindetails}}">'+f+"<div class=\"{{providernameclass}}\" title={{providername}}>{{providername}}</div></div><div class='{{actionscontainer}}'>"+r+C+l+"</div></div>";return N=Hs(N,{previewheader:cl,url:x,titleclass:sl,title:c,closeicon:m,previewcontent:el,urlclass:il,previewfooter:v,domainname:o,domaindetails:ul,providernameclass:nl,providername:a,winindex:t,actionscontainer:Cl}),Hs('<div class="{{urlpreviewparent}}" data-urlpreview="true">'+N+"</div>",{urlpreviewparent:Jr})},showLoadingPreview:function(){return'<div class=wms-previewcardloader><span id="wms_contactdetails_loadingdiv" class="wms-hvalign wms_loading_div wms-fadeOut"></span></div>'},constructVideoLinkFragment:function(e){var t=e.meta.linkdetails;if(t.html)var s=Hs('<p class="wms-videowrapper">{{iframehtml}}</p>',{iframehtml:_l(t.html)});else if(t.iframe_url)s='<p class="wms-videowrapper">'+_l('<iframe sandbox="allow-scripts allow-same-origin"  width="480" height="270" src='+t.iframe_url+' frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>')+"</p>";var i="<div id='wms-urlvideo-play' class='wms-urlvideo-play wms-hvalign'></div><div class='wms_default_thumbnail'></div>";t.thumbnailurl&&(i="<div id='wms-urlvideo-play' class='wms-urlvideo-play wms-hvalign'></div><div class='wms_default_thumbnail'><img data-urlfavicon='true' src='"+t.thumbnailurl+"' /></div>");var n='<img src="'+t.thumbnailurl+'" />',a=t.providername;if(!a){a=t.url.match(/:\/\/(.[^/]+)/)[1].replace("www.","")}return Hs("<div class='wms-urlinfoouterdiv'><div class='wms-urlinfo'><img src=\"{{urlproviderurl}}\"><a href='{{urlproviderurl}}' target='_blank'>{{urlprovider}}</a></div><div class='wms-urlinfolink'><a href='{{urllink}}' target='_blank'>{{urltitlelink}}</a></div></div><div class='wms-media'  data-playable='true' thumbnailimg='{{videoimg}}' iframe='{{iframe}}'>{{thumbnailimg}}</div>",{thumbnailimg:i,videoimg:n,thumbnailurl:t.thumbnailurl,iframe:s,urllink:t.url,urltitlelink:t.title,urlauthorurl:t.authorurl,urlproviderurl:t.faviconlink||t.providerurl+"/favicon.ico",urlauthor:t.authorname,urlprovider:a},"InSecureHTML")},constructAudioLinkFragment:function(e){var t=e.meta.linkdetails;if(t.html){t.html;var s=Wl(t.html)}else if(t.iframe_url){var i='<iframe sandbox="allow-scripts allow-same-origin" width="480" height="270" src='+t.iframe_url+' frameborder="0" allow="accelerometer; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>';s=Wl(i)}return Hs("<div class='wms-urlinfoouterdiv'><div class='wms-urlinfo'><img src=\"{{urlproviderurl}}\"><a href='{{urlproviderurl}}' target='_blank'>{{urlprovider}}</a></div><div class='wms-urlinfolink'><a href='{{urllink}}' target='_blank'>{{urltitlelink}}</a></div></div><div class='wms-media' data-playable='true' iframe='{{iframe}}'>{{audioframe}}</div>",{thumbnailurl:t.thumbnailurl,iframe:i,audioframe:s,urllink:t.url,urltitlelink:t.title,urlauthorurl:t.authorurl,urlproviderurl:t.faviconlink||t.providerurl+"/favicon.ico",urlauthor:t.authorname,urlprovider:t.providername},"InSecureHTML")},constructImageLinkFragment:function(e){return Hs('<div class="wms-imgmetamsgcontainer"><img data-previewable="true" data-dname="{{dname}}" data-fsender="{{sender}}" data-fdate="{{date}}" data-ftime="{{time}}" data-src="{{url}}" src="{{url}}"></img></div>',{url:e.meta.linkdetails.imgurl||e.meta.linkdetails.url,dname:e.dname,sender:e.sender,date:se(e.time),time:ee(e.time)})},constructFileFragment:function(e){var t="";e.thumb&&(t='<div class="wms-filethumb wms-imgmsgcontainer" data-filethumbnail="true" data-previewable="true" > <img style="width:'+e.dim.width+"px;height:"+e.dim.height+'px;max-height:100%;pointer-events:none;" src="'+e.thumbnailurl+'" > </div>');var s,i,n,a="",o="false",r=e.content,l=e.fName.split(".")[1],d="",c="";if(n=l,((-1!==(i=r).indexOf("text/")||-1!==i.indexOf("application/pdf")&&!pn()||-1!==i.indexOf("application/xml"))&&"svg"!=n||Sl(i,n))&&(s=e.size,!(200<parseFloat(s)&&s.match("MB")||s.match("GB")))){if(e.isv1local)a='<div data-localattachment="true" class="wms-attachmentpreviewloading">{{previewloading}}</div>';else d='<iframe src="'+e.previewurl+'"></iframe>',a='<div class="wms-attachmentpreview" data-attachment="true" data-previewable="{{previewable}}" src="{{iframehtml}}" data-fname="{{filename}}" data-furl="{{url}}" data-fsize="{{filesize}}" data-fcomment="{{comment}}" data-fsrc="{{url}}" data-fcontent="{{type}}" data-dname="{{dname}}" data-fsender="{{sender}}" data-fdate="{{date}}" data-isv1="{{isv1}}"  data-ftime="{{time}}" data-filefwd="{{forward}}" >{{preview}}</div>';o="true"}e.isFileForwardSupported&&(c='<div class="wms-fileforward" data-isv1="{{isv1}}" data-filefrwrd="{{forward}}" data-furl="{{url}}" data-fcontent="{{type}}" src="{{src}}" data-fname="{{filename}}" data-fsize="{{filesize}}" data-fcomment="{{comment}}" data-fsrc="{{url}}" href={{src}} title="{{forwardtitle}}"></div>');var m='<div class="wms-filefragcontainer">'+t+'<div class="wms-filemsgcontainer" data-previewable="{{previewable}}" data-filedesc="true"><div class="wms-filemsgimg"></div><div class="wms-filedesc wms-truncate-ellipsis"><div class="wms-filetitle wms-truncate-ellipsis" title="{{filename}}">{{filename}}</div><div class="wms-filesize">{{filesize}}'+a+'</div></div><div class="wms-attachmenticon-container"><a class="wms-filedownloadicon-container" href="{{src}}" download="{{filename}}" data-documentclick="attdownload"><span class="wms-filedownload" title="{{filesize}}" data-documentclick="attdownload"></span></a>'+c;return Hs(m+="</div></div></div>",{previewable:o,iframehtml:d,src:e.constructeddownloadurl||e.url,filename:e.fName,type:e.content||e.contenttype,filesize:e.size||"",url:e.url||e.fileurl,comment:e.commentmsg,isv1:!!e.isv1,$preview:"chat.clickpreview",dname:e.dname,sender:e.sender,date:se(e.time),time:ee(e.time),$forwardtitle:"chat.forward",forward:!!e.isFileForwardSupported,$previewloading:"chat.previewloading"})},isFileSupportedByCliq:Sl,isWorkDriveURL:wl,getWDPermalinkRegex:Ml,getWorkDriveRedirectURL:Il}),Al={},El=!0,Ul=!1,xl=!1,Nl=!1;function kl(e){ve.setItem("wms_draft_lmtime",e)}function Ol(e){return Al[e]}function Rl(){return ve.getItem($WC.Config.get("zuid")+"_wms_drafts")}function Hl(){var e=Rl();if(!El&&ri(Al)&&e&&(Al=e),Ul&&!Nl&&(El||!e)){Ie("v1/chats","drafts=true&joined=true",function(e){for(var t=JSON.parse(e).data,s=t&&t.chats,i={},n=0;n<s.length;n++){var a=s[n].draftmsginfo&&JSON.parse(s[n].draftmsginfo);i[s[n].chatid]=a,$l(s[n].chatid,a)}Dl(i,!0),Nl=El=xl=!1,Si.publish("drafts/updateui")},function(){Nl=!1}),Nl=!0}}function $l(e,t){Al[e]={msg:t.msg,meta:t.meta,mtype:t.mtype,time:t.time},t.replied_to&&(Al[e].replied_to=t.replied_to)}function Dl(e,t){var s={};if(t)s=e;else{var i=Rl();if(i){if(i[e.chid]&&i[e.chid].time==e.time)return;i[e.chid]=e,s=i}else s[e.chid]=e;kl(e.time)}ve.setItem($WC.Config.get("zuid")+"_wms_drafts",s)}function Ll(e){var t,s;delete Al[e],t=e,(s=Rl())&&s[t]&&(delete s[t],Dl(s,!0))}function Pl(){}var Bl=Object.freeze({__proto__:null,getFromServerAfterFocus:function(){xl=!0},getFromServerIfFocussed:function(){xl&&Hl()},checkAndUpdateLMTime:function(e){Ul=!0;var t=ve.getItem("wms_draft_lmtime");El="-1"!=e&&e!=t,kl(e)},get:Ol,getFromServer:Hl,update:$l,updateInLocalStorage:Dl,updateInServer:function(e,t){if(Ul){var s="message="+encodeURIComponent(t.msg);t.replied_to&&(s+="&replied_to="+t.replied_to);Te("v2/chats/"+e+"/draft",s,function(){var e=this.opts.callbackargs;$l(e.chid,e)},null,t)}},deleteDraft:Ll,deleteDraftInServer:function(e){if(Ol(e)){var t={"Content-Type":"application/json","X-XHR-exception":"true","X-ZCSRF-TOKEN":ci()};Ee("v2/chats/"+e+"/draft",null,function(){Ll(e)},null,null,null,t)}},updateBeforeUnload:function(e){var t=Ol(e.objId);if(!t||t.msg!==e.composer.value){var s=new FormData,i={message:e.composer.value,nocache:(new Date).getTime()},n=e.getReplyMessageId();n&&(i.replied_to=n);var a=ci();i[(a=a.split("="))[0]]=a[1];var o="/"+H.get("CHATCONT")+"/v2/chats/"+e.objId+"/draft";for(var r in i)s.append(r,i[r]);navigator.sendBeacon(o,s)}}}),jl=function(t){function e(e){t.call(this,e),this.state={showvalidationerror:!1},this.validateError=this.validateError.bind(this),this.getActions=this.getActions.bind(this)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.validateError=function(e){e.target.value.match(ge.regexes.emailid)?this.setState({showvalidationerror:!1}):this.setState({showvalidationerror:!0})},e.prototype.getActions=function(){return this.state.showvalidationerror?this.props.dialogoptions.errorCallbackActions:this.props.dialogoptions.actions},e.prototype.render=function(){var e=this.props.dialogoptions,t=e.customimgiconclass?e.customimgiconclass:Qe.wms_dialog_img,s=k("div",{class:Qe.wms_dialog_imgouter},k("div",{class:Qe.wms_dialog_imginner},k("div",{class:t}))),i=e.headerimgsrc?k("img",{key:e.headerimgsrc,src:e.headerimgsrc}):s,n=e.customimg?k("div",{class:e.customimg},k("div",null,Qi(e.customheadercontent[0],e.customheadercontent[1]))):i,a=k("div",null,k("div",{class:Qe.wms_dialogtext},n,k("div",{class:Qe.wms_dialog_txtcont},Qi(e.heading[0],e.heading[1])),e.headercontent)),o=e.content?e.content.map(function(e){return k("div",{class:Qe.wms_dialog_content}," ",e," ")}):null,r=e.bodytitle?k("div",{class:Qe.wms_dialog_txttitle},e.bodytitle):null,l=this.getActions(),d=e.customStyles&&e.customStyles.containerWrapperStyle?e.customStyles.containerWrapperStyle:Qe.wms_dialog_container,c=e.customStyles&&e.customStyles.customButtonWrapperStyle?e.customStyles.customButtonWrapperStyle:Qe.buttonwrapper,m={customContainerStyle:d,customHeaderStyle:Qe.wms_dialog_header,customFooterStyle:Qe.wms_dialog_footer,customButtonWrapperStyle:c};e.customStyles&&e.customStyles.customFooterStyle&&(m.customFooterStyle=e.customStyles.customFooterStyle),(r||o)&&(m.customWrapperStyle=Qe.wms_dialog_contentwrapper);var u="";if(e.inputcontent){var p=$("contact.invite.mailid",['"'+e.inputcontent+'"']),h=null;this.state.showvalidationerror&&(h=k("div",{class:Qe.showmandatoryerror},$("forms.invalidemail"))),u=k("div",{class:Qe.inputcontentwrapper},k("div",null,Qi(p,e.inputcontent)),k("input",{id:"wms_contact_mailid",type:"text",placeholder:$("placeholder.contact.mailid"),onchange:this.validateError}),h)}return k(et,{heading:a,actions:l,customDialogStyles:m,callbackOnClose:this.props.removeComponent,footerinfoprefix:u},r,o)},e}(M);Pl.prototype.mountComponent=function(e){this.node=document.createElement("div"),document.body.appendChild(this.node),O(k(jl,{removeComponent:this.removeParentNode.bind(this),dialogoptions:e}),this.node)},Pl.prototype.removeParentNode=function(){this.node.parentElement.removeChild(this.node)},Pl.prototype.unmountComponent=function(){O("",this.node)};var Fl=function(t){function e(e){t.call(this,e),this.closeComponent=this.closeComponent.bind(this),this.onClickMoreActions=this.onClickMoreActions.bind(this),this.searchMessageAction=this.searchMessageAction.bind(this),this.storeMoreActionSearchNode=this.storeMoreActionSearchNode.bind(this),this.storeMoreActionsList=this.storeMoreActionsList.bind(this),this.storeSelectedItemNode=this.storeSelectedItemNode.bind(this),this.state={moreactionslist:Yl.data.length?this.getAllowedActions(Yl.data):[],defaultactionslist:this.getDefaultAllowedActions(),searchactionsval:"",selectedactionindex:-1,defaultheightofcontainer:this.getDefaultHeightOfMsgActions()}}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.componentDidMount=function(){if(this.searchnode&&this.searchnode.focus(),!Yl.isinitialized&&H.get("isCliqUser")()){if(this.props.actionsconfig&&this.props.actionsconfig.hide_more_msg_actions)return;t=this.storeMoreActionsList,Ie("v2/messageactions","limit=100",function(e){Yl.data=JSON.parse(e).data,Yl.isinitialized=!0,t()})}var t},e.prototype.componentDidUpdate=function(e,t){t.selectedactionindex!=this.state.selectedactionindex&&this.selecteditemnode&&tn(this.selecteditemnode)},e.prototype.storeSelectedItemNode=function(e){e&&(this.selecteditemnode=e.base)},e.prototype.storeMoreActionSearchNode=function(e){this.searchnode=e},e.prototype.getDefaultHeightOfMsgActions=function(){var e=this.getDefaultAllowedActions().length;return Yl.isinitialized&&(e+=this.getAllowedActions(Yl.data).length),e<=9?{height:40*e+"px"}:{height:"380px"}},e.prototype.closeComponent=function(e){27===e.keyCode&&this.props.closeComponent&&this.props.closeComponent()},e.prototype.getDefaultAllowedActions=function(){var e=this.props.allowedactions,t=[{name:"react",label:$("message.actions.react")},{name:"reply",label:$("message.actions.reply")},{name:"thread_reply",label:$("message.actions.thread_reply")},{name:"copy",label:$("message.actions.copy")},{name:"edit",label:$("message.actions.edit")},{name:"forward",label:$("message.actions.forward")},{name:"private_reply",label:$("message.actions.private_reply")},{name:"markasunread",label:$("message.actions.markasunread")},{name:"setreminder",label:$("message.actions.setreminder")},{name:"pinmsg",label:$("message.actions.pinmsg")},{name:"unpinmsg",label:$("message.actions.unpinmsg")},{name:"fork",label:$("message.actions.fork")},{name:"messagelink",label:$("message.actions.messagelink")},{name:"viewreaction",label:$("message.actions.viewreaction")},{name:"delete",label:$("message.actions.delete")}],s=[];if(e.include_all)s=t;else for(var i=0;i<t.length;i++)e[t[i].name]&&s.push(t[i]);return s},e.prototype.getAllowedActions=function(e){for(var t=[],s={TEXTMSG:"text",IMGATT:"attachment",FILEATT:"attachment",AUDIOATT:"attachment",VIDEOATT:"attachment",LOCATT:"attachment",CONTACTATT:"attachment",EVENTATT:"attachment",CUSTOMMSG:"text",VIDEOLINK:"link",AUDIOLINK:"link",IMGLINK:"link",BOTMSG:"text",REPLYMSG:"text",EDITEDMSG:"text"}[this.props.datatype],i=0;i<e.length;i++)-1!=e[i].allowed_message_types.indexOf(s)&&t.push(e[i]);return t.sort(Ci("name"))},e.prototype.storeMoreActionsList=function(){var e=Yl.data;this.setState({moreactionslist:this.getAllowedActions(e)})},e.prototype.handleKeyNavigation=function(e){var t=this.state.moreactionslist.length+this.state.defaultactionslist.length-1,s=this.state.selectedactionindex;e.keyCode==He.KEYCODES.UP&&s--,e.keyCode==He.KEYCODES.DOWN&&s++,s=t<(s=s<0?0:s)?t:s,this.setState({selectedactionindex:s})},e.prototype.searchMessageAction=function(e){if("click"==e.type)return e.stopPropagation(),void e.preventDefault();if("keydown"==e.type)if(e.keyCode==He.KEYCODES.UP||e.keyCode==He.KEYCODES.DOWN)this.handleKeyNavigation(e);else if(e.keyCode==He.KEYCODES.ENTER){var t=this.state.defaultactionslist.concat(this.state.moreactionslist)[this.state.selectedactionindex];t.label?this.props.messageActionsCallBack(this.props.msgnode,t.name):this.onClickMoreActions(t),e.stopPropagation(),e.preventDefault()}if("input"==e.type){var s=Yl.data;s=this.getAllowedActions(s);var i=this.getDefaultAllowedActions(),n=e.target.value;this.setState({moreactionslist:cn(s,n,"name"),defaultactionslist:cn(i,n,"label"),searchactionsval:n,selectedactionindex:0})}},e.prototype.toggleMessageActionLoader=function(e,t){for(var s=this.state.moreactionslist,i=0;i<s.length;i++)e.id==s[i].id&&(s[i].loading="add"==t);this.setState({moreactionslist:s})},e.prototype.onClickMoreActions=function(t){var s=this.props.chid,e={chid:s,ids:[this.props.msgnode.dataset.msguid]},i={"Content-Type":"application/json","x-consents-version":"1","X-XHR-exception":!0,"X-ZCSRF-TOKEN":ci()},n=this;Te("v1/messageactions/"+t.id+"/executeaction",e,function(e){n.props.dreFunctionCallBack(s,t.name,JSON.parse(e).data.dreResponse),n.toggleMessageActionLoader(t,"remove"),n.props.closeComponent()},function(){n.toggleMessageActionLoader(t,"remove"),rn($("event.status.update.error"))},null,null,i),this.toggleMessageActionLoader(t,"add")},e.prototype.getMoreMessageActionsList=function(){for(var e=this.state.moreactionslist,t=e.length?[k("div",{class:Co.moreactionslabel},$("message.actions.moremsgactions"))]:[],s=this.state.defaultactionslist.length,i=0;i<e.length;i++){var n=this.state.selectedactionindex==s+i;t.push(k(Gl,{itemselected:n,storeSelectedItemNode:this.storeSelectedItemNode,item:e[i],searchterm:this.state.searchactionsval,messageActionCallBack:this.onClickMoreActions}))}return t},e.prototype.getMessageActionsList=function(){for(var e={reply:"e659",copy:"e921",react:"e9f8",fork:"e922",setreminder:"e9a2",markasunread:"e9b3",messagelink:"e991",edit:"e620",delete:"e633",forward:"e659",pinmsg:"ea1a",unpinmsg:"ea1a",viewreaction:"e61d",thread_reply:"e9d9",private_reply:"e659"},t=this.state.defaultactionslist,s=[],i=0;i<t.length;i++){var n=this.state.selectedactionindex==i;t[i]&&("react"!=t[i].name||this.props.actionsconfig.show_as_popup?s.push(k(zl,{itemselected:n,storeSelectedItemNode:this.storeSelectedItemNode,actionname:t[i].name,actionvalue:e[t[i].name],msgnode:this.props.msgnode,label:t[i].label,searchterm:this.state.searchactionsval,messageActionCallBack:this.props.messageActionsCallBack})):s.push(k(ql,{itemselected:n,actionvalue:e[t[i].name],storeSelectedItemNode:this.storeSelectedItemNode,actionname:t[i].name,msgnode:this.props.msgnode,quickReact:this.props.quickReact,messageActionCallBack:this.props.messageActionsCallBack})))}return s.concat(this.getMoreMessageActionsList())},e.prototype.render=function(e){var t=this.getMessageActionsList(),s=t.length?"":Co.emptyresult,i=!0;e.actionsconfig&&"disable"==e.actionsconfig.search&&(i=!1);var n=e.actionsconfig.show_as_popup?Co.msgactions_container+" "+Co.popupcontainerstyle:Co.msgactions_container,a=e.actionsconfig.show_as_popup?Co.defaultpopupcontainer:"";t=t.length?t:Ma({customstyles:{errorimg:Co.errorimg,infotext:Co.errorinfotext}});var o=i?k("div",{class:Co.searchcontainer},k("input",{ref:this.storeMoreActionSearchNode,onclick:this.searchMessageAction,onkeydown:this.searchMessageAction,oninput:this.searchMessageAction,type:"text","data-purpose":"messageaction_search",placeholder:$("Search")})):null,r=e.actionsconfig.rtlmode?"rtl":"ltr";return k("div",{tabindex:"0",class:n,onkeydown:this.closeComponent,dir:r,"data-msgoperations":!0},o,k("div",{style:this.state.defaultheightofcontainer,class:Co.defaultmsgactions_container+" "+s+" "+a},t))},e}(M),zl=function(e){function t(){e.call(this),this.messageActionsCallBack=this.messageActionsCallBack.bind(this)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.messageActionsCallBack=function(e){this.props.messageActionCallBack(this.props.msgnode,this.props.actionname),e.preventDefault(),e.stopPropagation()},t.prototype.render=function(e){var t=e.actionname,s=Co.actioncontainer;"delete"==t&&(s=Co.actioncontainer+" "+Co.deleteaction);var i=Co.msgactionicon;"reply"!=t&&"private_reply"!=t||(i=Co.msgactionicon+" "+Co.iconreply);var n=e.itemselected?Co.itemselected:"",a=e.itemselected?e.storeSelectedItemNode:null,o=e.actionvalue?k(R,{classname:i,type:"icon",tabindex:"-1",content:e.actionvalue}):null,r=e.loading?k("div",{class:Co.loader+" "+Co.loadermargin}):null;return k(R,{ref:a,classname:s+" "+n,onclick:this.messageActionsCallBack},o,k("span",{class:Co.actionname},Qi(e.label,e.searchterm)),r)},t}(M),Gl=function(e){function t(){e.call(this),this.messageActionsCallBack=this.messageActionsCallBack.bind(this)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.messageActionsCallBack=function(e){this.props.messageActionCallBack(this.props.item),e.stopPropagation(),e.preventDefault()},t.prototype.render=function(e){var t=e.item,s=k(R,{classname:Co.moreactionicon,type:"icon",content:"e960",tabindex:"-1"});if(t.extension){var i="/_chat/appimg/"+t.extension.photo_id+"/photo.do";s=k("img",{class:Co.actionimg,src:i})}var n=t.loading?k("div",{class:Co.loader}):null,a=e.itemselected?Co.itemselected:"",o=e.itemselected?e.storeSelectedItemNode:null;return k(R,{ref:o,classname:Co.actioncontainer+" "+a,title:t.hint,onclick:this.messageActionsCallBack},s,k("span",{class:Co.moreactionname,title:!0},Qi(t.name,e.searchterm)),n)},t}(M),ql=function(e){function t(){e.call(this);this.zm=new si({default_size:"24",animation:{default_size:"24"}}),this.messageActionsCallBack=this.messageActionsCallBack.bind(this)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.updateQuickReaction=function(e,t){var s=t.target.getAttribute("title")||t.target.firstChild&&t.target.firstChild.getAttribute("title");this.zm.updateFrequentSmileysList(this.zm.removeTonePrefFromCode(e),s),this.props.quickReact(this.props.msgnode,e)},t.prototype.messageActionsCallBack=function(e){this.props.messageActionCallBack(this.props.msgnode,this.props.actionname),e.preventDefault(),e.stopPropagation()},t.prototype.getQuickReactions=function(){for(var e=[k("div",{class:Co.quickreaction,onclick:this.messageActionsCallBack},k(R,{classname:Co.reacticon,type:"icon",tabindex:"0",content:this.props.actionvalue}))],t=this.zm.replaceFrequentSmileySkinTone(this.zm.getFrequentSmileys()),s=0;s<5;s++){var i=t.work[s];e.push(k("div",{class:Co.quickreaction,onclick:this.updateQuickReaction.bind(this,i)},this.zm.getSmiley(i)))}return e},t.prototype.render=function(e){var t=this.getQuickReactions(),s=e.itemselected?" "+Co.itemselected:"";return k(R,{classname:Co.quickreactionscontainer+s},t)},t}(M),Yl={data:[],isinitialized:!1};function Vl(){this.unmountComponent=this.unmountComponent.bind(this)}Vl.prototype.mountComponent=function(e){this.node=e.node,O(k(Fl,{msgnode:e.msgnode,allowedactions:e.allowed_actions,messageActionsCallBack:e.messageactionscallback,closeComponent:e.closeComponent,dreFunctionCallBack:e.dreFunctionCallBack,chid:e.chid,datatype:e.datatype,actionsconfig:e.actionsconfig,quickReact:e.quickReact}),e.node)},Vl.prototype.unmountComponent=function(){O("",this.node)};var Zl="mc9fea9169_formparent",Kl="mc9fea9169_footer",Xl="mc9fea9169_cancelbutton",Jl="mc9fea9169_submitbutton",Ql="mc9fea9169_hideclose",ed="mc9fea9169_header",td="mc9fea9169_formcontent",sd="mc9fea9169_footerprefix",id="mc9fea9169_hint",nd="mc9fea9169_singleselectvalue",ad="mc9fea9169_placeholderstyle",od="mc9fea9169_options",rd="mc9fea9169_formitem",ld="mc9fea9169_inputfield",dd="mc9fea9169_singleselect",cd="mc9fea9169_inputtextarea",md="mc9fea9169_multiselectparent",ud="mc9fea9169_multiselectparentfocus",pd="mc9fea9169_groupedinput",hd="mc9fea9169_searchstyle",gd="mc9fea9169_closeicon",fd="mc9fea9169_singleselectclose",Cd="mc9fea9169_labelcontainer",vd="mc9fea9169_label",bd="mc9fea9169_mandatory",yd="mc9fea9169_formhint",_d="mc9fea9169_botimage",Wd="mc9fea9169_botname",Sd="mc9fea9169_selectedelements_container",wd="mc9fea9169_selectedoption",Md="mc9fea9169_closeiconcontainer",Id="mc9fea9169_form_error",Td="mc9fea9169_opendropdown",Ad="mc9fea9169_badge_letter",Ed="mc9fea9169_textfieldicon",Ud="mc9fea9169_hv_align",xd="mc9fea9169_selectedtext",Nd="mc9fea9169_textellipse",kd="mc9fea9169_dropdowncontainer",Od="mc9fea9169_dropdownmin",Rd="mc9fea9169_listwrapperstyle",Hd="mc9fea9169_wrapperwithsearch",$d="mc9fea9169_listwrappernative1",Dd="mc9fea9169_dropdownitemstyle",Ld="mc9fea9169_groupeditem",Pd="mc9fea9169_customitem",Bd="mc9fea9169_grouped_item_sel",jd="mc9fea9169_dropdownnoimg",Fd="mc9fea9169_nativeitem",zd="mc9fea9169_showmandatoryerror",Gd="mc9fea9169_errorcontainer",qd="mc9fea9169_itemloading",Yd="mc9fea9169_dotone",Vd="mc9fea9169_dottwo",Zd="mc9fea9169_dotthree",Kd="mc9fea9169_disable",Xd="mc9fea9169_mountedfixed",Jd="mc9fea9169_containerwrapperstyle",Qd="mc9fea9169_form_errordescription",ec="mc9fea9169_multiselectlist_search",tc="mc9fea9169_emptysearch",sc="mc9fea9169_removescroll",ic="mc9fea9169_mountedtop",nc="mc9fea9169_searchcontainerstyle",ac="mc9fea9169_groupeditemtitle",oc="mc9fea9169_textoverflowstyle",rc="mc9fea9169_groupeditemcontainer",lc="mc9fea9169_emptysearchcontainer",dc="mc9fea9169_contactimg",cc="mc9fea9169_icontext",mc="mc9fea9169_groupeditemslistcontainer",uc="mc9fea9169_loader",pc=function(e){function t(){e.call(this),this.storeDropDownNode=this.storeDropDownNode.bind(this),this.addValueToSelectedList=this.addValueToSelectedList.bind(this),this.removeDataFromSelectedList=this.removeDataFromSelectedList.bind(this),this.selected_options=[],this.toggleDropDown=this.toggleDropDown.bind(this),this.hideDropDown=this.hideDropDown.bind(this),this.onMultiSelectSearch=this.onMultiSelectSearch.bind(this),this.storeSearchNode=this.storeSearchNode.bind(this),this.focusInputContainer=this.focusInputContainer.bind(this),this.getGroupedDropDown=this.getGroupedDropDown.bind(this),this.storeGroupedSearchInputNode=this.storeGroupedSearchInputNode.bind(this),this.storeSelectedItemNode=this.storeSelectedItemNode.bind(this),this.storeSingleselectNode=this.storeSingleselectNode.bind(this),this.handleSingleSelectKeyNav=this.handleSingleSelectKeyNav.bind(this),this.onSearch=this.onSearch.bind(this),this.state={dropdownvisible:!1,searchterm:"",focusinputcontainer:!1,groupeditem_selectedindex:-1,navigation_keycode:""}}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.componentDidUpdate=function(){this.groupedsearchnode&&this.groupedsearchnode.focus(),this.selecteditemnode&&!Ii(this.selecteditemnode,this.selecteditemnode.parentElement)&&(167<this.selecteditemnode.offsetTop?this.selecteditemnode.parentElement.scrollTop+=2*this.selecteditemnode.scrollHeight:this.selecteditemnode.parentElement.scrollTop-=2*this.selecteditemnode.scrollHeight)},t.prototype.componentDidMount=function(){this.props.setfocus&&this.searchnode&&"disable"!=this.props.list.status&&this.searchnode.focus()},t.prototype.storeSingleselectNode=function(e){this.singleselectnode=e},t.prototype.focusInputContainer=function(e){"focus"!=e.type||this.state.dropdownvisible?this.setState({focusinputcontainer:!1}):("dynamic_select"!=this.props.list.type||this.props.list.options||this.props.onTriggerInput(this.props.list.name),this.setState({focusinputcontainer:!0}))},t.prototype.storeSearchNode=function(e){this.searchnode=e},t.prototype.storeDropDownNode=function(e){this.dropdownnode=e},t.prototype.storeGroupedSearchInputNode=function(e){this.groupedsearchnode=e},t.prototype.storeSelectedItemNode=function(e){this.selecteditemnode=e},t.prototype.onMultiSelectSearch=function(e){if(this.props.list.options.length<2&&(e.preventDefault(),e.stopPropagation()),"keydown"==e.type){if(e.keyCode==He.KEYCODES.BACKSPACE&&""==e.target.value)return void this.removeDataFromSelectedList(this.selected_options[this.selected_options.length-1],e);if(e.keyCode==He.KEYCODES.ESCAPE&&this.state.dropdownvisible)return e.stopPropagation(),e.preventDefault(),void this.hideDropDown();if(e.keyCode==He.KEYCODES.TAB)return void this.hideDropDown();if(e.keyCode==He.KEYCODES.ENTER){if(this.isgroupeddropdown&&this.state.dropdownvisible)return this.addValueToSelectedList(this.getItemBasedOnIndex(this.state.groupeditem_selectedindex)),void(this.props.multiple||this.hideDropDown());if(this.searchnode)return void this.setState({navigation_keycode:e.keyCode})}else if(e.keyCode==He.KEYCODES.DOWN||e.keyCode==He.KEYCODES.UP){if(this.isgroupeddropdown)return void this.navigateGroupedItems(e);if(this.searchnode)return void this.setState({navigation_keycode:e.keyCode})}}"dynamic_select"==this.props.list.type&&this.props.onTriggerInput(this.props.list.name,e.target.value.toLowerCase(),this.props.list.multiple),this.setState({searchterm:e.target.value.toLowerCase(),dropdownvisible:!0,navigation_keycode:"",groupeditem_selectedindex:0})},t.prototype.getItemBasedOnIndex=function(e){var t=this.props.multiple?this.removeSelectedItemFromGroupedList(this.props.list.options):this.props.list.options;t=this.state.searchterm?this.filterGroupedList(t):t;for(var s=0,i=0;i<t.length;i++)if(t[i].options)for(var n=0;n<t[i].options.length;n++){if(s==e)return t[i].options[n];s++}else{if(s==e)return t[i];s++}},t.prototype.countTotalGroupedItems=function(){for(var e=this.state.searchterm?this.filterGroupedList(this.props.list.options):this.props.list.options,t=e.length,s=0;s<e.length;s++)e[s].options&&(t+=e[s].options.length-1);return t-1},t.prototype.navigateGroupedItems=function(e){var t=e.keyCode,s=this.state.groupeditem_selectedindex,i=this.countTotalGroupedItems();t==He.KEYCODES.DOWN&&s++,t==He.KEYCODES.UP&&s--,s<0&&(s=0),i<s&&(s=i),this.setState({groupeditem_selectedindex:s})},t.prototype.toggleDropDown=function(e){if("groupedsearch"!=e.target.getAttribute("data-purpose")&&("search"!=e.target.getAttribute("data-purpose")&&!e.target.getAttribute("data-groupedtitle")||("keydown"!=e.type||e.keyCode==He.KEYCODES.ENTER)&&"click"!=e.type)&&!(this.searchnode&&"keydown"==e.type&&e.keyCode===He.KEYCODES.ENTER&&this.state.dropdownvisible||("keydown"!==e.type||e.keyCode!==He.KEYCODES.ENTER&&(e.keyCode!=He.KEYCODES.SPACE||this.props.multiple))&&"click"!=e.type)){this.handleDynamicDropDownClose(),this.searchnode&&this.searchnode.focus();var t="keydown"==e.type?0:-1;this.setState({dropdownvisible:!this.state.dropdownvisible,groupeditem_selectedindex:t,navigation_keycode:e.keyCode,searchterm:""})}},t.prototype.handleDynamicDropDownClose=function(){"dynamic_select"==this.props.list.type&&(this.state.dropdownvisible||this.props.list.options||this.props.onTriggerInput(this.props.list.name))},t.prototype.hideDropDown=function(){this.state.dropdownvisible&&(this.handleDynamicDropDownClose(),this.setState({dropdownvisible:!1,searchterm:""}))},t.prototype.handleSingleSelectKeyNav=function(e){e.keyCode==He.KEYCODES.DOWN||e.keyCode==He.KEYCODES.UP?(this.setState({navigation_keycode:e.keyCode}),e.preventDefault(),e.stopPropagation()):e.keyCode==He.KEYCODES.ENTER&&this.state.dropdownvisible?this.setState({navigation_keycode:e.keyCode}):this.toggleDropDown(e)},t.prototype.onSearch=function(e,t){return"dynamic_select"==this.props.list.type&&(this.props.onTriggerInput(this.props.list.name,e),this.setState({searchterm:e.toLowerCase()})),bo("title",e,t,null,null,"desc").map(function(e){return e.id})},t.prototype.addValueToSelectedList=function(e,t,s){if(this.props.multiple&&this.props.list.value&&"native_select"==this.props.list.type){var i=this.props.list.value;if(this.props.list.max_selections&&i.length==this.props.list.max_selections)return}this.props.onItemSelection(this.props.list.name,e),this.props.list.trigger_on_change&&this.props.triggerOnChange(this.props.list.name),this.props.multiple&&s&&(s.stopPropagation(),s.preventDefault()),this.searchnode&&this.searchnode.focus(),!this.singleselectnode||(this.singleselectnode.focus(),this.props.searchable||s)?this.setState({searchterm:"",navigation_keycode:""}):this.setState({searchterm:"",navigation_keycode:"",dropdownvisible:!1})},t.prototype.removeDataFromSelectedList=function(e,t){t.stopPropagation(),t.preventDefault(),this.singleselectnode&&this.singleselectnode.focus(),e&&this.props.removeDataFromList(this.props.list.name,e)},t.prototype.removeSelectedItemFromGroupedList=function(e){if(!this.props.list.value)return e;for(var t=[],s=this.props.list.value.split(","),i=0;i<e.length;i++)if(e[i].options){for(var n=e[i].options,a=[],o=0;o<n.length;o++)-1==s.indexOf(n[o].value)&&a.push(n[o]);t.push({label:e[i].label,options:a})}else-1==s.indexOf(e[i].value)&&t.push(e[i]);return t},t.prototype.filterGroupedList=function(e){for(var t=[],s=[],i=[],n=this.state.searchterm.trim(),a=0;a<e.length;a++)if(e[a].options){for(var o=e[a].options,r=[],l=[],d=0;d<o.length;d++)o[d].label.toLowerCase().startsWith(n)?r.push(o[d]):-1<o[d].label.toLowerCase().indexOf(n)&&l.push(o[d]);t.push({options:r.concat(l),label:e[a].label})}else e[a].label.toLowerCase().startsWith(n)?s.push(e[a]):-1<e[a].label.toLowerCase().indexOf(n)&&i.push(e[a]);return s.concat(i).concat(t)},t.prototype.getGroupedDropDown=function(e){this.isgroupeddropdown=!0;var t=[];e=this.props.multiple?this.removeSelectedItemFromGroupedList(e):e,this.state.searchterm.trim()&&(e=this.filterGroupedList(e));for(var s=0,i=0;i<e.length;i++)if(e[i].options){var n=e[i].options;if(!n.length)continue;t.push(k("div",{class:ac,"data-groupedtitle":!0,title:e[i].label},e[i].label));for(var a=0;a<n.length;a++){var o="",r=null;this.state.groupeditem_selectedindex==s&&(o=Bd,r=this.storeSelectedItemNode),s++,t.push(k("div",{ref:r,class:Ld+" "+o,onclick:this.addValueToSelectedList.bind(this,n[a]),title:n[a].label},k("div",{class:oc},Qi(n[a].label,this.state.searchterm.trim()))))}}else{var l="",d=null;this.state.groupeditem_selectedindex==s&&(l=Bd,d=this.storeSelectedItemNode),t.push(k("div",{ref:d,onclick:this.addValueToSelectedList.bind(this,e[i]),class:Pd+" "+l,title:e[i].label},k("div",{class:oc},Qi(e[i].label,this.state.searchterm)))),s++}t=t.length?t:k("div",{class:lc},Ma());var c=this.props.multiple?null:k("input",{ref:this.storeGroupedSearchInputNode,onkeydown:this.onMultiSelectSearch,placeholder:$("Search"),oninput:this.onMultiSelectSearch,class:pd,"data-purpose":"groupedsearch"}),m=!t.length||this.props.list.isloading?Od:"";return t=this.props.list.isloading?k("div",{class:uc+" "+Ud}):t,k("div",{class:rc+" "+m},c,k("div",{class:mc},t))},t.prototype.getDropDownContainer=function(e){for(var t={},s={},i=[],n=0;n<e.length;n++){if(e[n].options)return this.getGroupedDropDown(ji(e));i[n]=wi(e[n]),i[n].title=i[n].label,0!=i[n].empty_img&&(i[n].empty_img=!0,i[n].classname||(i[n].classname=jd));var a=i[n].id||i[n].value;if(s[i[n].id=a]=i[n],this.props.multiple)for(var o=0;o<this.selected_options.length;o++)"native_select"==this.props.list.type?this.selected_options[o].id==s[a].id&&(t[a]=s[a]):this.selected_options[o].value==s[a].value&&(t[a]=s[a])}if(0==Object.keys(s).length&&"dynamic_select"!=this.props.list.type)return this.hideDropDown(),null;var r=!1,l=!1,d=Ci("counter",!1),c=30,m="",u=Rd,p=!1;return"native_select"==this.props.list.type&&(r=!0,d=Ci("UC"),c=55,m=Fd,u+=" "+$d),"dynamic_select"==this.props.list.type&&(p=!0,this.props.list.isloading&&(l=!0)),this.props.searchable?("select"!=this.props.list.type&&"dynamic_select"!=this.props.list.type||this.props.multiple||(u+=" "+Hd),k(Na,{listid:"1",list:s,searchplaceholder:$("Search"),container:this.dropdownnode,fetchImageSource:!1,iscompletelist:!l,multiselect:this.props.multiple,onSearch:this.onSearch,sortComparator:d,excluded_list:t,customlistitemstyles:{customContainerStyles:Dd+" "+m,containerWrapperStyle:Jd,customListWrapper:u,rowHeight:c,customsearchstyle:{searchinputstyle:hd,searchcontainerstyle:nc}},handlecustomemptysearch:p,onListItemClicked:this.addValueToSelectedList,searchsequence:this.props.searchsequence,defaultsearch:r,loadingstate:l,searchtext:this.state.searchterm,customsearch:this.props.multiple,sortonsearch:!0,navigation_keycode:this.state.navigation_keycode})):k(wa,{completelist:!0,list:i,container:this.dropdownnode,customlistitemstyles:{customContainerStyles:Dd+" "+m,containerWrapperStyle:Jd,rowHeight:c,customListWrapper:u},onListItemClicked:this.addValueToSelectedList,iscompletelist:!0,loadingstate:l,navigation_keycode:this.state.navigation_keycode})},t.prototype.populateDropDown=function(){var e=this.props.list;this.selected_options=[];var t="",s="",i="native_select"!=e.type&&e.options&&0!=e.options.length?"":Od;if(this.dropdownnode){var n=Ji(this.dropdownnode,"[data-dialogwrapper=true]");this.dropdownnode.offsetParent.offsetTop-n.scrollTop+n.offsetTop+this.dropdownnode.offsetParent.offsetHeight+200>n.offsetHeight&&(t=this.dropdownnode.offsetHeight,0==n.scrollTop&&this.dropdownnode.offsetParent.offsetTop<200&&(t=""),n.scrollHeight<490&&""==t&&(s=Xd,t=""))}var a=t?ic:"";if(this.props.multiple){if(e.value)if("string"!=typeof e.value)this.selected_options=e.value;else if(e.value.split)for(var o=""!=e.value.split(",")?e.value.split(","):[],r=0;r<o.length;r++)for(var l=0;l<e.options.length;l++)if(e.options[l].value==o[r])this.selected_options.push(e.options[l]);else if(e.options[l].options)for(var d=e.options[l].options,c=0;c<d.length;c++)d[c].value==o[r]&&this.selected_options.push(d[c]);var m=[],u=null,p="disable"==this.props.list.status?"-1":"0";if(this.selected_options.length)for(var h=0;h<this.selected_options.length;h++){var g=this.selected_options[h].label||this.selected_options[h].title||this.selected_options[h];if("native_select"==e.type){this.selected_options[h].id=this.selected_options[h].id?this.selected_options[h].id:this.selected_options[h].value;var f=co(this.selected_options[h].id),C=f.imgsrc?f.imgsrc:"";u=k("img",{class:dc+" "+f.classname,src:C}),f.badge_letter&&(u=k("div",{class:dc+" "+Ad},f.badge_letter))}m.push(k("div",{class:wd},k("div",{class:Md},u,k(R,{classname:gd,type:"icon",content:"e9ee",tabindex:p,onclick:this.removeDataFromSelectedList.bind(this,this.selected_options[h])})),k("span",{class:xd},g)))}var v=e.options?e.options:[];"dynamic_select"==this.props.list.type&&this.state.searchterm&&(v=this.filterGroupedList(v));var b=m.length?"":tc,y=m.length?" ":e.placeholder||$("forms.select"),_=this.state.dropdownvisible?k("div",{style:{bottom:t},class:kd+" "+s+" "+i+" "+a,key:"dropdowncontainer"},this.getDropDownContainer(v)):null,W=this.state.focusinputcontainer?ud:"";return k("div",{class:md+" "+W,onclick:this.toggleDropDown,onkeydown:this.toggleDropDown},k("div",{class:Sd},m,k("input",{tabindex:p,placeholder:y,onfocus:this.focusInputContainer,onblur:this.focusInputContainer,ref:this.storeSearchNode,value:this.state.searchterm,class:ec+" "+b,onkeydown:this.onMultiSelectSearch,oninput:this.onMultiSelectSearch})),k(R,{classname:Td,type:"icon",content:"e632",tabindex:"-1"}),_)}var S=e.options?e.options:[];"dynamic_select"==this.props.list.type&&this.state.searchterm&&(S=this.filterGroupedList(S));var w=null,M=this.state.dropdownvisible?k("div",{style:{bottom:t},class:kd+" "+s+" "+i+" "+a},this.getDropDownContainer(S)):null,I=e.placeholder||$("forms.select"),T=ad,A="disable"==this.props.list.status?"-1":"0";if(e.value&&""!=e.value){for(var E=0;E<e.options.length;E++)if(e.options[E].options)for(var U=e.options[E].options,x=0;x<U.length;x++)U[x].value==e.value&&(I=U[x].label);else e.options[E].value==e.value&&(I=e.options[E].label);"native_select"==e.type&&(I=e.value.length?e.value[0].title||e.value[0].label:e.value.title||e.value.label),I!=e.placeholder&&(w=k(R,{onclick:this.removeDataFromSelectedList.bind(this,e),tabindex:A,classname:fd,type:"icon",content:"e634"}),T=nd),"native_select"==e.type&&0==e.value.length&&(w=null)}var N=this.props.searchable?this.toggleDropDown:this.handleSingleSelectKeyNav;return k("div",{ref:this.storeSingleselectNode,class:dd,tabindex:A,"data-field":"singleselect",onkeydown:N,onclick:this.toggleDropDown},k("div",{class:T},k("span",{class:Nd},I)),w,k(R,{classname:Td,type:"icon",content:"e632",tabindex:"-1"}),M)},t.prototype.render=function(e){var t=null;return e.list.isloading&&(t=k(hc,null)),k("div",{class:od,ref:this.storeDropDownNode},k(Q,{onClickOutside:this.hideDropDown},this.populateDropDown()),t)},t}(M);function hc(){return k("div",{class:qd},k("span",{class:Yd}),k("span",{class:Vd}),k("span",{class:Zd}))}var gc="mc070469d7_pickerparent",fc="mc070469d7_pickerdropdown",Cc="mc070469d7_calendarparent",vc="mc070469d7_calendarcontainer",bc="mc070469d7_timeinput",yc="mc070469d7_pickertoggler",_c="mc070469d7_timezonecontainer",Wc="mc070469d7_cancelbutton",Sc="mc070469d7_setdate",wc="mc070469d7_actionscontainer",Mc="mc070469d7_selectedval",Ic="mc070469d7_calendaricon",Tc="mc070469d7_placeholder",Ac="mc070469d7_value",Ec="mc070469d7_closeicon",Uc="mc070469d7_zonepicker",xc="mc070469d7_timeinputparent",Nc="mc070469d7_timetxt",kc="mc070469d7_itemfontsize",Oc="mc070469d7_mountedtop",Rc="mc070469d7_mountedbottom",Hc="mc070469d7_labelcontainerbottom",$c="mc070469d7_labelcontainertop",Dc="mc070469d7_listwrapperstyle",Lc="mc070469d7_searchstyle",Pc="mc070469d7_searchcontainerstyle",Bc="mc070469d7_listinfocontainer",jc=null,Fc=function(n){function e(e){if(n.call(this,e),jc||Ie("v2/timezones","version=0",function(e){var t=JSON.parse(e).data;jc={};for(var s=0;s<t.length;s++){var i=t[s].id;jc[i]={title:"("+t[s].offset+") "+t[s].label,empty_img:!0,label:t[s].label,offset:t[s].offset,id:t[s].id,index:s}}}),this.togglePicker=this.togglePicker.bind(this),this.storePickerNode=this.storePickerNode.bind(this),this.onTimeChange=this.onTimeChange.bind(this),this.hidePicker=this.hidePicker.bind(this),this.submitDateTime=this.submitDateTime.bind(this),this.onSelectTimeZone=this.onSelectTimeZone.bind(this),this.onDateSelection=this.onDateSelection.bind(this),this.clearValues=this.clearValues.bind(this),this.toggleZonePicker=this.toggleZonePicker.bind(this),this.selecteddate=new Date,e.presetdate)if(e.mountedviaforms){var t=e.presetdate.split("T")[0],s=e.presetdate.split("T")[1];this.selecteddate=new Date(t),this.selecteddate=new Date(this.selecteddate.setHours(s.split(":")[0])),this.selecteddate=new Date(this.selecteddate.setMinutes(s.split(":")[1]))}else this.selecteddate=new Date(e.presetdate);var i=e.placeholder;this.time=[ee(this.selecteddate.getTime()),oe(this.selecteddate.getTime())],this.timezone=e.disable_time_zone_picker?null:Intl.DateTimeFormat().resolvedOptions().timeZone,e.value&&e.value.time_zone_id&&(this.timezone=e.value.time_zone_id),(e.presetdate&&e.mountedviaforms&&re(e.presetdate.split("T")[0])||e.presetdate)&&(i=ne(this.selecteddate)+", "+ee(this.selecteddate.getTime()),this.timezone&&(i+=", "+this.timezone),this.props.onDateSelection(this.selecteddate,this.time[1],this.timezone)),this.state={pickervisible:!1,value:i,zonepickervisible:!1}}return n&&(e.__proto__=n),((e.prototype=Object.create(n&&n.prototype)).constructor=e).prototype.clearValues=function(e){this.setState({value:this.props.placeholder}),this.props.onDateSelection(null,null,null),e.stopPropagation(),e.preventDefault()},e.prototype.onSelectTimeZone=function(e,t,s){this.timezone=e,this.toggleZonePicker(s)},e.prototype.submitDateTime=function(){if("Invalid"!=this.time){this.props.onDateSelection(this.selecteddate,this.time[1],this.timezone&&this.timezone.id?this.timezone.id:this.timezone);var e=ne(this.selecteddate)+", "+this.time[0];this.timezone&&(e+=", "+(this.timezone.id?this.timezone.id:this.timezone)),this.setState({value:e}),this.hidePicker()}},e.prototype.onDateSelection=function(e){this.selecteddate=e},e.prototype.onTimeChange=function(e,t,s){if(s||s)this.time="Invalid";else{var i=parseInt(t.split(":")[0]);this.time=[e,i<10&&0!=i?"0"+t+":00":t+":00"]}},e.prototype.storePickerNode=function(e){this.pickernode=e},e.prototype.hidePicker=function(e){e&&e.target.getAttribute("data-id")||this.setState({pickervisible:!1})},e.prototype.onSearchTimeZone=function(e,t){return bo("title",e,t,null,null,"desc").map(function(e){return e.id})},e.prototype.togglePicker=function(e){if("keydown"==e.type&&13==e.keyCode||"click"==e.type){var t=!1;if(this.pickernode.getBoundingClientRect().bottom+340>window.innerHeight)t=!0;else if(this.props.mountedviaforms&&this.pickernode){var s=Ji(this.pickernode,"[data-dialogwrapper=true]"),i=this.pickernode.offsetParent.offsetParent.offsetTop,n=i-s.scrollTop+s.offsetTop+this.pickernode.offsetParent.offsetParent.offsetHeight;n+200>s.offsetHeight&&n+200<i&&0!=s.scrollTop&&(t=!0)}this.setState({pickervisible:!this.state.pickervisible,mountedtop:t,zonepickervisible:!1})}},e.prototype.toggleZonePicker=function(e){"click"!=e.type&&("keydown"!=e.type||e.keyCode!=He.KEYCODES.ENTER&&e.keyCode!=He.KEYCODES.SPACE)||(e.stopPropagation(),e.preventDefault(),this.setState({zonepickervisible:!this.state.zonepickervisible}))},e.prototype.getDateTimePickerContainer=function(){var e=null;this.timezone&&this.timezone.offset?e=this.timezone.offset:jc[this.timezone]?(e=jc[this.timezone].offset,this.timezone=jc[this.timezone]):e=this.selecteddate.toTimeString().split(" ")[1].replace("+"," +");var t=this.time[1].split(":");t=new Date(this.selecteddate).setHours(t[0],t[1]);var s=this.state.zonepickervisible?k(Q,{onClickOutside:this.toggleZonePicker},k("div",{class:Uc},k(Na,{listid:"1",list:wi(jc),searchplaceholder:$("Search"),iscompletelist:!0,onSearch:this.onSearchTimeZone,excluded_list:this.timezone,onListItemClicked:this.onSelectTimeZone,searchsequence:this.props.searchsequence,sortComparator:Ci("index"),sortonsearch:!0,customlistitemstyles:{customContainerStyles:Dd+" "+kc,containerWrapperStyle:Jd,customListWrapper:Dc,listinfoContainerStyle:Bc,rowHeight:30,customsearchstyle:{searchinputstyle:Lc,searchcontainerstyle:Pc}}}))):"",i=this.state.mountedtop?Oc:Rc,n=this.props.disable_time_zone_picker?null:k("div",{class:_c},k("div",{tabindex:"0",class:Mc,onkeydown:this.toggleZonePicker,onclick:this.toggleZonePicker},e),s);return k("div",{class:fc+" "+i},k("div",{class:Cc},k(L,{onDateSelection:this.onDateSelection,selecteddate:this.selecteddate,customclass:{calendarcontainer:vc}})),k("div",{class:xc},k("div",{class:bc},k("span",{class:Nc},$("pinmsg.time.heading")),k(Dn,{onTimeChange:this.onTimeChange,time:t})),n),k("div",{class:wc},k(R,{classname:Wc,type:"button",content:$("Cancel"),onclick:this.hidePicker}),k(R,{classname:Sc,type:"button",content:$("datetime.setdatetime"),onclick:this.submitDateTime})))},e.prototype.render=function(e,t){var s=null,i="disable"==this.props.status?"-1":"0",n=e.value&&e.value.date_time?Ac:Tc,a=e.value&&e.value.date_time&&!e.ignoreclose?k(R,{tabindex:i,classname:Ec,type:"icon",content:"e9ee",onclick:this.clearValues}):null,o="";return t.pickervisible&&(o=t.mountedtop?$c:Hc,s=this.getDateTimePickerContainer()),k(Q,{onClickOutside:this.hidePicker},k("div",{ref:this.storePickerNode,class:gc},k("div",{tabindex:i,class:yc+" "+o,onclick:this.togglePicker,onkeydown:this.togglePicker},k("div",{class:n},t.value),a,k(R,{classname:Ic,type:"icon",content:"e9e6",tabindex:"-1"})),s))},e}(M);var zc="mcfceb2bb4_filesharecontainer",Gc="mcfceb2bb4_fileinput",qc="mcfceb2bb4_descriptioncontainer",Yc="mcfceb2bb4_fileiconcontainer",Vc="mcfceb2bb4_addiconcontainer",Zc="mcfceb2bb4_uploadicon",Kc="mcfceb2bb4_fileshareinputfocus",Xc="mcfceb2bb4_fileitem",Jc="mcfceb2bb4_fileitemcontainer",Qc="mcfceb2bb4_filedetails",em="mcfceb2bb4_filename",tm="mcfceb2bb4_itemclose",sm="mcfceb2bb4_filesize",im="mcfceb2bb4_addicon",nm="mcfceb2bb4_fileicon",am="mcfceb2bb4_progressbarcontainer",om="mcfceb2bb4_progressbar",rm="mcfceb2bb4_progressbarinvisible",lm="mcfceb2bb4_imgthumb",dm="mcfceb2bb4_placeholdertext",cm=function(t){function e(e){t.call(this,e),this.state={filelist:{},inputfocused:!1},this.onUploadFile=this.onUploadFile.bind(this),this.constructFileItem=this.constructFileItem.bind(this),this.clearFileItem=this.clearFileItem.bind(this),this.uploadToCliq=this.uploadToCliq.bind(this),this.storeInputNode=this.storeInputNode.bind(this),this.toggleInputBgColor=this.toggleInputBgColor.bind(this),this.handleInputClick=this.handleInputClick.bind(this)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.componentDidMount=function(){this.props.setfocus&&this.inputnode&&this.inputnode.focus()},e.prototype.componentDidUpdate=function(){null!=this.props.item.value&&this.props.item.value.length!=Object.keys(this.state.filelist).length&&""==this.props.item.value&&this.setState({filelist:{}})},e.prototype.storeInputNode=function(e){this.inputnode=e},e.prototype.toggleInputBgColor=function(){this.setState({inputfocused:!this.state.inputfocused})},e.prototype.convertToFilesArray=function(e){var t=[];for(var s in e)t.push(e[s]);return 0==t.length&&(t=""),t},e.prototype.uploadToCliq=function(e){var t="v2/forms/"+this.props.formid+"/files",s=function(e,t){var s=JSON.parse(t),i=this.state.filelist;i[e.name]&&"inprogress"==i[e.name].status&&(i[e.name].status="completed",i[e.name].id=s.id),this.props.addFilesToList(this.props.item.name,this.convertToFilesArray(i)),this.setState({fileslist:i})}.bind(this,e),i=function(e,t){var s=this.state.filelist;s[e.name]&&(s[e.name].loaded=t.loaded,s[e.name].total=t.total,this.setState({fileslist:s}))}.bind(this,e),n=new FormData;n.append("zchat_csrparam",me(H.get("CHATCFCOOKIENAME"))),n.append("files",e),Te(t,n,s,null,null,null,null,{usedefaultcontenttype:!0},{progress:i})},e.prototype.onUploadFile=function(e){for(var t=e.target.files,s=this.state.filelist?this.state.filelist:{},i=this.props.item.max_selections?this.props.item.max_selections:this.props.item.multiple?10:1,n=0;n<t.length;n++)if(!s[t[n].name]){if(Object.keys(s).length==i)break;if(an(t[n])&&!nn([t[n]],52428800)){if(t[n].status="inprogress",s[t[n].name]=t[n],-1<t[n].type.indexOf("image")){var a=new FileReader;a.readAsDataURL(t[n]),a.onloadend=function(e,t){var s=this.state.filelist;s[e.name].imgsrc=t.target.result,this.setState({filelist:s})}.bind(this,t[n])}this.uploadToCliq(t[n])}}e.target.value=null,this.props.addFilesToList(this.props.item.name,this.convertToFilesArray(s)),this.setState({filelist:s})},e.prototype.clearFileItem=function(e,t){var s=this.state.filelist;delete s[e.name],this.props.addFilesToList(this.props.item.name,this.convertToFilesArray(s)),t.stopPropagation(),t.preventDefault(),this.setState({filelist:s})},e.prototype.constructFileItem=function(){var e=[],t=this.state.filelist;for(var s in t){var i="";"completed"!=t[s].status&&t[s].status||(i=rm);var n=t[s].loaded/t[s].total||0,a=k("div",{class:am+" "+i},k("div",{class:om,style:{transform:"scaleX( "+n+" ) "}})),o=k(R,{classname:nm,type:"icon",tabindex:"-1",content:"e9b1"});-1<t[s].type.indexOf("image")&&t[s].imgsrc&&(o=k("img",{class:lm,src:t[s].imgsrc})),e.push(k("div",{class:Xc,key:t[s].name},k("div",{class:Yc},o),k("div",{class:Qc},k("div",{class:em},t[s].name),k("div",{class:sm},sn(t[s].size))),k("div",{class:tm,onclick:this.clearFileItem.bind(this,t[s])},k(R,{type:"icon",tabindex:"-1",content:"e634"})),a))}var r=this.props.item.max_selections?this.props.item.max_selections:this.props.item.multiple?10:1;return e.length&&r!=Object.keys(this.state.filelist).length&&e.push(k("div",{class:Vc},k(R,{classname:im,type:"icon",tabindex:"-1",content:"e636"}))),k("div",{class:Jc}," ",e," ")},e.prototype.handleInputClick=function(){this.inputnode&&this.inputnode.click()},e.prototype.render=function(e,t){var s=e.item.max_selections?e.item.max_selections:e.item.multiple?10:1,i=e.item.placeholder||$("forms.filesharedescription1"),n=$(1==s?"forms.filesharedescription3":"forms.filesharedescription2",[s]),a=k("div",{class:qc},k(R,{type:"icon",tabindex:"-1",content:"e911",classname:Zc}),k("div",{class:dm},i),k("div",{class:dm},n)),o=ri(t.filelist)?a:this.constructFileItem(),r=k("input",{ref:this.storeInputNode,onfocus:this.toggleInputBgColor,onblur:this.toggleInputBgColor,class:Gc,onchange:this.onUploadFile,type:"file",multiple:!0});s==Object.keys(t.filelist).length&&(r=null);var l=this.state.inputfocused?Kc:"";return k("div",{class:zc+" "+l,onclick:this.handleInputClick},r,o)},e}(M),mm=!1;function um(){mm=!0}var pm=Object.freeze({__proto__:null,default:cm,setLastUploadStatus:um,resetLastUploadStatus:function(){mm=!1},getLastUploadStatus:function(){return mm}}),hm="mcdd4a006e_locinpcontainer",gm="mcdd4a006e_descriptioncontainer",fm="mcdd4a006e_mapdialogcontainer",Cm="mcdd4a006e_overlay",vm="mcdd4a006e_topbar",bm="mcdd4a006e_closeicon",ym="mcdd4a006e_dropdowncontainer",_m="mcdd4a006e_selectloc",Wm="mcdd4a006e_dropdownborder",Sm="mcdd4a006e_listwrapperstyle",wm="mcdd4a006e_searchstyle",Mm="mcdd4a006e_searchcontainerstyle",Im="mcdd4a006e_itemfontsize",Tm="mcdd4a006e_addresslist",Am="mcdd4a006e_zohomapcontainer",Em="mcdd4a006e_markericon",Um="mcdd4a006e_addressval",xm="mcdd4a006e_description",Nm=function(o){function e(e){o.call(this,e),this.showMap=this.showMap.bind(this),this.hideMap=this.hideMap.bind(this),this.getMapDialog=this.getMapDialog.bind(this),this.toggleAddressSelector=this.toggleAddressSelector.bind(this),this.storeMapElemNode=this.storeMapElemNode.bind(this),this.hideAddressSelector=this.hideAddressSelector.bind(this),this.handleMapClickEvent=this.handleMapClickEvent.bind(this),this.handleCurrentLocationClick=this.handleCurrentLocationClick.bind(this),this.getLocationListFromCliq=Bi(this.getLocationListFromCliq.bind(this),this,500),this.onSearch=this.onSearch.bind(this),this.selectLocation=this.selectLocation.bind(this),this.onSelectAddress=this.onSelectAddress.bind(this),this.storeDropDownContainer=this.storeDropDownContainer.bind(this),this.mountMapData=this.mountMapData.bind(this);var t="",s="",i="",n={},a={};e.item.boundary&&(t=e.item.boundary.latitude,s=e.item.boundary.longitude,i=e.item.boundary.radius||""),this.config={navigationControl:e.navigationControl||!0,currentLocation:e.currentLocation||!0,marker:e.marker||!0,radius:1e3*i,latitude:t,longitude:s},e.item.value&&e.item.value.latitude&&e.item.value.longitude&&e.item.value.full_address&&(t=e.item.value.latitude,s=e.item.value.longitude,n={full_address:e.item.value.full_address,lat:t,lon:s},a={latitude:t,longitude:s}),ri(a)&&e.item.boundary&&(a=e.item.boundary),this.state={mapvisible:!1,locationdetail:a,address_details:n,addresslist:{},address_selector_visible:!1,searchterm:"",listloading:!1,isselectloading:!1}}return o&&(e.__proto__=o),((e.prototype=Object.create(o&&o.prototype)).constructor=e).prototype.storeDropDownContainer=function(e){this.dropdowncontainer=e},e.prototype.componentDidMount=function(){Rm()},e.prototype.componentDidUpdate=function(e,t){t.mapvisible!=this.state.mapvisible&&this.state.mapvisible&&(this.dropdowncontainer&&this.dropdowncontainer.focus(),km&&km?this.mountMapData():Rm(this.mountMapData))},e.prototype.handleMapClickEvent=function(e){var t=e.lngLat.lat,s=e.lngLat.lng;if(this.config.radius&&this.isOutOfRadius(t,s))rn($("location.boundary"));else{if(this.state.isselectloading)return e.preventDefault(),void e.stopPropagation();this.getCurrentAddressFromCliq(t,s),this.mapmarker.setLngLat({lat:t,lng:s}),this.setState({locationdetail:{latitude:t,longitude:s}})}},e.prototype.setMarker=function(e,t){var s={anchor:"center",draggable:!0,element:Oi("span","wms_markelem",Em),offset:[-0,-12]},i=e||this.state.locationdetail.latitude||0,n=t||this.state.locationdetail.longitude||0;this.mapmarker=new mapboxgl.Marker(s).setLngLat({lat:i,lng:n}).addTo(this.mapobj)},e.prototype.isOutOfRadius=function(e,t){function s(e){return e*Math.PI/180}var i=parseFloat(this.config.latitude),n=parseFloat(this.config.longitude),a=s(i),o=s(e),r=s(e-i),l=s(t-n),d=Math.sin(r/2)*Math.sin(r/2)+Math.cos(a)*Math.cos(o)*Math.sin(l/2)*Math.sin(l/2);return 6378137*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))>this.config.radius},e.prototype.setRadiusCircle=function(){var e=this.props.item.boundary.latitude,t=this.props.item.boundary.longitude;this.mapobj.addSource("radius_source",{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[parseFloat(t),parseFloat(e)]}}]}}),this.mapobj.addLayer({type:"circle",id:"radius",source:"radius_source",layout:{visibility:"visible"},paint:{"circle-radius":{stops:[[0,0],[20,this.config.radius/.075/Math.cos(parseFloat(e)*Math.PI/180)]],base:2},"circle-color":"rgba(0, 102, 204, 0.2)","circle-opacity":1}})},e.prototype.mountMapData=function(){var e=H.get("photoserver").split(".");e=e[1]+"."+e[2];var t={container:this.mapelemnode,zoom:12,center:[this.state.locationdetail.longitude||0,this.state.locationdetail.latitude||0],style:"https://maps."+e+"/vector/styles/bright.json"};if(this.mapobj=new mapboxgl.Map(t),this.config.marker&&this.setMarker(),this.config.navigationControl&&this.mapobj.addControl(new mapboxgl.NavigationControl,"bottom-right"),this.config.currentLocation){var s=new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0}});this.mapobj.addControl(s),s._geolocateButton&&(s._geolocateButton.onclick=this.handleCurrentLocationClick)}this.config.radius&&this.mapobj.on("style.load",function(){this.setRadiusCircle()}.bind(this)),this.mapobj.on("mousedown",this.handleMapClickEvent)},e.prototype.handleCurrentLocationClick=function(e){var t=function(e){var t=e.coords.latitude,s=e.coords.longitude;this.config.radius&&this.isOutOfRadius(t,s)?rn($("location.boundary")):(this.mapmarker.setLngLat({lat:t,lng:s}),this.getCurrentAddressFromCliq(t,s),this.setState({locationdetail:{latitude:t,longitude:s}}))}.bind(this);if(this.state.isselectloading)return e.preventDefault(),void e.stopPropagation();navigator.geolocation.getCurrentPosition(t,function(){rn($("location.current.notfound"))}),e.stopPropagation(),e.preventDefault()},e.prototype.storeMapElemNode=function(e){this.mapelemnode=e},e.prototype.toggleAddressSelector=function(e){if("keydown"==e.type&&e.keyCode==He.KEYCODES.ENTER||"click"==e.type){if("search"==e.target.getAttribute("data-purpose"))return;this.setState({address_selector_visible:!this.state.address_selector_visible,searchterm:""}),e.stopPropagation(),e.preventDefault()}},e.prototype.hideAddressSelector=function(e){this.setState({address_selector_visible:!1,searchterm:""}),e.stopPropagation(),e.preventDefault()},e.prototype.getCurrentAddressFromCliq=function(a,o,e){Ie("v2/geolocations/"+a+","+o,null,function(e,t){var s=JSON.parse(t).data,i=this.state.isselectloading;if(this.config.radius&&this.isOutOfRadius(a,o))return rn($("location.boundary")),void this.setState({isselectloading:!e&&i});var n=!e;e&&(this.props.onLocationSelect(this.props.item.name,s),i=!1),this.setState({address_details:s,mapvisible:n,isselectloading:i})}.bind(this,e),function(e){rn($("location.invalid")),e&&this.setState({isselectloading:!1})}.bind(this,e))},e.prototype.populateMap=function(){var e=H.get("LOCATION_INFO").CACHED.coords.latitude,t=H.get("LOCATION_INFO").CACHED.coords.longitude;this.getCurrentAddressFromCliq(e,t),this.setState({mapvisible:!0,locationdetail:{latitude:e,longitude:t}})},e.prototype.populateEmptyMap=function(){this.config.latitude=.1,this.config.longitude=.1,this.setState({mapvisible:!0})},e.prototype.getLocation=function(){var e={enableHighAccuracy:!0,timeout:5e3},t=function(e){navigator.permissions&&navigator.permissions.query({name:"geolocation"}).then(function(e){H.get("LOCATION_INFO").PERMISSIONSTATE=e.state}.bind(this)),H.get("LOCATION_INFO").CACHED=e,this.populateMap()}.bind(this),s=function(){H.get("LOCATION_INFO").PERMISSIONSTATE="denied",rn($("location.current.notfound")),this.populateEmptyMap()}.bind(this);"granted"==H.get("LOCATION_INFO").PERMISSIONSTATE?H.get("LOCATION_INFO").CACHED?this.populateMap():navigator.geolocation.getCurrentPosition(t,s,e):this.config.latitude||this.config.longitude?this.populateEmptyMap():navigator.geolocation.getCurrentPosition(t,s,e)},e.prototype.showMap=function(e){("keydown"==e.type&&e.keyCode==He.KEYCODES.ENTER||"click"==e.type)&&(ri(this.state.locationdetail)?this.getLocation():this.setState({mapvisible:!0}))},e.prototype.hideMap=function(e){("keydown"==e.type&&e.keyCode==He.KEYCODES.ENTER||"click"==e.type)&&(this.setState({mapvisible:!1,addresslist:{},searchterm:""}),e.stopPropagation(),e.preventDefault())},e.prototype.getLocationListFromCliq=function(e){var n=this;Ie("v2/geolocations","query="+e.toLowerCase()+"&limit=10&lat="+this.state.locationdetail.latitude+"&lon="+this.state.locationdetail.longitude,function(e){var t=JSON.parse(e).data,s={};if(t.length){t=cn(t,n.state.searchterm.toLowerCase(),"full_address");for(var i=0;i<t.length;i++)s[i]=t[i],s[i].title=s[i].full_address,s[i].empty_img=!0,s[i].id=i;n.setState({addresslist:s,listloading:!1})}else n.setState({listloading:!1})})},e.prototype.onSearch=function(e,t){return e.trim()!=this.state.searchterm.trim()&&(this.getLocationListFromCliq(e,t),this.setState({searchterm:e.trim(),listloading:!0})),bo("title",e,t,null,null,"desc").map(function(e){return e.id})},e.prototype.onSelectAddress=function(e,t,s){this.config.radius&&this.isOutOfRadius(e.lat,e.lon)?rn($("location.boundary")):(this.mapmarker.setLngLat({lat:e.lat,lng:e.lon}),this.mapobj.flyTo({center:[e.lon,e.lat],zoom:12}),s.stopPropagation(),s.preventDefault(),this.setState({address_details:e,locationdetail:{latitude:e.lat,longitude:e.lon},address_selector_visible:!1}))},e.prototype.selectLocation=function(e){("keydown"==e.type&&e.keyCode==He.KEYCODES.ENTER||"click"==e.type)&&(this.getCurrentAddressFromCliq(this.state.locationdetail.latitude,this.state.locationdetail.longitude,!0),this.setState({isselectloading:!0}))},e.prototype.getDropDownContainer=function(){var e=this.state.addresslist||{},t=ri(this.state.address)?"":this.state.address_details.full_address,s=this.state.address_selector_visible?k("div",{class:Tm},k(Na,{listid:"1",list:e,searchplaceholder:$("Search"),iscompletelist:!this.state.listloading,loadingstate:this.state.listloading,onSearch:this.onSearch,sortonsearch:!0,sortComparator:Ci("id"),onListItemClicked:this.onSelectAddress,customlistitemstyles:{customContainerStyles:Dd+" "+Im,containerWrapperStyle:Jd,customListWrapper:Sm,rowHeight:30,customsearchstyle:{searchinputstyle:wm,searchcontainerstyle:Mm}}})):"",i=this.state.address_selector_visible?Wm:"",n=this.state.listloading?k(hc,null):null;return k("div",{ref:this.storeDropDownContainer,class:ym+" "+i,tabindex:"0",onkeydown:this.toggleAddressSelector,onclick:this.toggleAddressSelector},k("div",{class:Um},t||$WC.I18N("Search")),k(Q,{onClickOutside:this.hideAddressSelector},k(R,{classname:Td,type:"icon",content:"e632",tabindex:"-1"}),s),n)},e.prototype.getMapDialog=function(){var e=this.state.isselectloading?" "+uc:"",t=this.state.isselectloading?"":$("location.selectlocation");return k("div",{class:fm},k("div",{class:vm},this.getDropDownContainer(),k(R,{type:"button",tabindex:"0",content:t,onclick:this.selectLocation,classname:_m+e}),k(R,{tabindex:"0",type:"icon",classname:bm,content:"e9ee",onclick:this.hideMap})),k("div",{class:Am,ref:this.storeMapElemNode}))},e.prototype.render=function(){var e=this.state.address_details.full_address;ri(this.state.address_details)&&(e=this.props.item.placeholder||$("location.description"));var t="",s="";return this.state.mapvisible&&(t=this.getMapDialog(),s=k("div",{class:Cm})),k("div",{class:hm,tabindex:"0",onkeydown:this.showMap,onclick:this.showMap},k("div",{class:gm},k(R,{tabindex:"-1",type:"icon",content:"e90e"}),k("div",{class:xm},e)),s,t)},e}(M),km=!1,Om=!1;function Rm(e){if(!km){var t=Oi("script",null,null,{src:"https://js.zohocdn.com/ichat/js/ad528ebf_zohomaps.js"});document.head.appendChild(t),t.onload=function(){km=!0,Om&&e&&e()}}if(!Om){var s=Oi("link",null,null,{rel:"stylesheet",href:"https://css.zohocdn.com/ichat/css/d88fa1ab_zohomaps.css"});document.head.appendChild(s),s.onload=function(){Om=!0,km&&e&&e()}}}var Hm="mc313f4674_radioitem",$m="mc313f4674_radioitemscontainer",Dm="mc313f4674_customradiobtncontainer",Lm="mc313f4674_checkboxcontainer",Pm="mc313f4674_radioinput",Bm="mc313f4674_checkboxinput",jm="mc313f4674_label",Fm="mc313f4674_selected",zm="mc313f4674_checkbox",Gm="mc313f4674_checkboxsel",qm=function(t){function e(e){t.call(this,e),this.storeSelectParentNode=this.storeSelectParentNode.bind(this),this.getRadioField=this.getRadioField.bind(this),this.handleRadioButtonSelection=this.handleRadioButtonSelection.bind(this),this.handleCheckBoxSelection=this.handleCheckBoxSelection.bind(this),this.state={values:this.constructValuesObj()}}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.constructValuesObj=function(){for(var e={},t=this.props.item.value?this.props.item.value.split(","):"",s=this.props.item.options,i=0;i<s.length;i++)e[s[i].value]=!1,-1<t.indexOf(s[i].value)&&(e[s[i].value]=!0);return e},e.prototype.componentDidUpdate=function(e){JSON.stringify(e.item.options)!=JSON.stringify(this.props.item.options)&&this.setState({values:this.constructValuesObj()})},e.prototype.storeSelectParentNode=function(e){this.selectparentnode=e},e.prototype.handleRadioButtonSelection=function(e){var t=e.target,s=this.state.values;for(var i in s)s[i]=!1,t.value==i&&(s[i]=!0);s[t.value]=!0,this.props.onItemSelection(this.props.item.name,t.value),this.props.item.trigger_on_change&&this.props.triggerOnChange(this.props.item.name,t.value),this.setState({values:s})},e.prototype.handleCheckBoxSelection=function(e){var t=this.state.values,s=e.target;t[s.value]=s.checked;var i="";for(var n in t)t[n]&&(i=0<i.length?i+","+n:n);this.props.onItemSelection(this.props.item.name,i),this.props.item.trigger_on_change&&this.props.triggerOnChange(this.props.item.name,i),this.setState({values:t})},e.prototype.getRadioField=function(){for(var e=[],t=this.props.item.options,s=this.props.item.name,i="disable"==this.props.item.status?"-1":"0",n=0;n<t.length;n++){var a=this.state.values[t[n].value]?Fm:"";e.push(k("div",{class:Hm},k("div",{class:Dm},k("div",{class:a})),k("input",{tabindex:i,class:Pm,type:"radio",name:"formradio"+s,value:t[n].value,onchange:this.handleRadioButtonSelection,id:"formradio"+s+n}),k("label",{class:jm,title:t[n].label,for:"formradio"+s+n},t[n].label)))}return k("div",{ref:this.storeSelectParentNode,class:$m},e)},e.prototype.getCheckBoxField=function(){for(var e=[],t=this.props.item.options,s=this.props.item.name,i="disable"==this.props.item.status?"-1":"0",n=0;n<t.length;n++){var a=this.state.values[t[n].value]?Gm:zm;e.push(k("div",{class:Lm},k("div",{class:a}," "),k("input",{tabindex:i,class:Bm,onChange:this.handleCheckBoxSelection,type:"checkbox",checked:this.state.values[t[n].value],name:"formchkbx"+s+n,id:"formchkbx"+s+n,value:t[n].value}),k("label",{class:jm,title:t[n].label,for:"formchkbx"+s+n},t[n].label)))}return k("div",{ref:this.storeSelectParentNode},e," ")},e.prototype.render=function(e){return k("div",null,"radio"==e.type?this.getRadioField():this.getCheckBoxField()," ")},e}(M),Ym=function(t){function e(e){t.call(this,e),this.setLabelInputValue=this.setLabelInputValue.bind(this),this.setDateInputValue=this.setDateInputValue.bind(this),this.setDateTimeValue=this.setDateTimeValue.bind(this),this.storeFormItemNode=this.storeFormItemNode.bind(this),this.storeItemNode=this.storeItemNode.bind(this),this.storeErrorContainerNode=this.storeErrorContainerNode.bind(this)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.componentWillReceiveProps=function(e){((e.inputfield.showmandatoryerror||e.inputfield.max_length_error||e.inputfield.max_selection_error||e.inputfield.validationerror)&&e.scroll_to_error||e.inputfield.form_error_msg)&&this.scrollIntoView()},e.prototype.componentDidMount=function(){this.props.setfocus&&this.itemnode&&"disable"!=this.props.inputfield.status&&this.itemnode.focus(),"location"==this.props.inputfield.type&&this.props.addDataToList(this.props.inputfield.name,this.props.inputfield.value||{})},e.prototype.storeItemNode=function(e){this.itemnode=e},e.prototype.storeFormItemNode=function(e){this.formitemnode=e},e.prototype.storeErrorContainerNode=function(e){this.errorContainerNode=e},e.prototype.setLabelInputValue=function(e){var t=this.props.inputfield;t.showmandatoryerror&&(t.showmandatoryerror=!1),this.props.updateValidationError(t.name,e.target.value),this.props.addDataToList(t.name,e.target.value)},e.prototype.setDateInputValue=function(e){var t="";if(e){var s=e.getDate()<10?"0"+e.getDate():e.getDate(),i=e.getMonth()+1;i=i<10?"0"+i:i,"date"==this.props.inputfield.type&&(t=e.getFullYear()+"-"+i+"-"+s)}this.props.addDataToList(this.props.inputfield.name,t)},e.prototype.setDateTimeValue=function(e,t,s){var i="";if(e&&t&&s){var n=e.getDate()<10?"0"+e.getDate():e.getDate(),a=e.getMonth()+1;a=a<10?"0"+a:a,i={date_time:e.getFullYear()+"-"+a+"-"+n+"T"+t,time_zone_id:s}}this.props.addDataToList(this.props.inputfield.name,i)},e.prototype.scrollIntoView=function(){var e=this.formitemnode;this.formitemnode.offsetHeight+20>this.formitemnode.parentElement.offsetHeight&&(e=this.errorContainerNode),Hi(e)},e.prototype.constructOptionsDetails=function(e){var t={},s=[];if("contacts"==e&&(t=Eo("",!0).concat(xo(""))).length)for(var i=0;i<t.length;i++)if(!t[i].ISBOT){var n=lo(t[i]);s.push({label:t[i].DNAME,value:t[i].DNAME,desc:t[i].EMAILID,imgsrc:n.imgsrc,classname:n.classname,empty_img:!1,id:t[i].USERID,UC:t[i].UC,counter:i})}if("conversations"==e&&(t=Mo("")).length)for(var a=0;a<t.length;a++){var o=lo(t[a]),r=!!o.badge_img,l=!!o.badge_letter&&o.badge_letter,d=!o.imgsrc&&!r,c=2==t[a].PARTICIPANTS.length?co(t[a].CHATID).classname:o.classname;s.push({label:t[a].TITLE,value:t[a].TITLE,imgsrc:o.imgsrc,classname:c,empty_img:d,id:t[a].CHATID,UC:t[a].UC,badge_img:r,badge_letter:l,fonticon_class:o.fonticon_class})}if("channels"==e&&(t=No("",null,!0)).length)for(var m=0;m<t.length;m++){var u=lo(t[m]),p=!u.imgsrc;s.push({label:t[m].dn,value:t[m].dn,imgsrc:u.imgsrc,classname:u.classname,empty_img:p,id:t[m].chid,UC:t[m].unreadmsgs,fonticon_class:u.fonticon_class,oc_id:t[m].oc_id})}return s},e.prototype.constructFormItem=function(){var e=[],t=wi(this.props.inputfield),s=vd,i=null,n="disable"==t.status?"-1":"0";t.mandatory&&(s=s+" "+bd),t.hint&&(i=k("span",{class:id,title:t.hint},"- ",t.hint)),e.push(k("div",{class:Cd},k("div",{class:s},t.label),i));var a=null;if(t.isloading&&(a=k("div",{class:qd},k("span",{class:Yd}),k("span",{class:Vd}),k("span",{class:Zd}))),"text"==t.type||"number"==t.type){var o=null,r="text";"number"==t.type&&(o=k(R,{classname:Ed+" "+cc,type:"icon",tabindex:"-1"},123)),t.format&&"password"==t.format&&(r="password",o=k(R,{classname:Ed,type:"icon",content:"e65c",tabindex:"-1"})),t.format&&"tel"==t.format&&(o=k(R,{classname:Ed,type:"icon",content:"e9fe",tabindex:"-1"})),t.format&&"email"==t.format&&(o=k(R,{classname:Ed,type:"icon",content:"e669",tabindex:"-1"})),t.format&&"url"==t.format&&(o=k(R,{classname:Ed,type:"icon",content:"e991",tabindex:"-1"})),e.push(k("div",{class:od},a,k("input",{ref:this.storeItemNode,tabindex:n,class:ld,type:r,maxlength:t.max_length,placeholder:t.placeholder,onchange:this.setLabelInputValue,value:t.value}),o))}if("textarea"==t.type&&e.push(k("div",{class:od},a,k("textarea",{ref:this.storeItemNode,tabindex:n,class:cd,type:"text",maxlength:t.max_length,placeholder:t.placeholder,onchange:this.setLabelInputValue,value:t.value}))),"date"==t.type){var l=t.value?t.value:"";e.push(k("div",{class:od},a,k(Sn,{key:l,placeholder:t.placeholder,mountedviaforms:!0,presetdate:l,status:t.status,onDateSelection:this.setDateInputValue})))}if("datetime"==t.type){var d=t.value?t.value.date_time:"";e.push(k("div",{class:od},a,k(Fc,{key:d,onDateSelection:this.setDateTimeValue,placeholder:t.placeholder,value:t.value,presetdate:d,mountedviaforms:!0,status:t.status})))}if("native_select"==t.type){var c=!!t.multiple,m=[];"contacts"==t.data_source?(t.options=this.constructOptionsDetails(t.data_source),m=(t.filter&&t.filter[0],[He.HYBRIDSEARCH.ORGCONTACT])):"channels"==t.data_source?(t.options=this.constructOptionsDetails(t.data_source),m=[He.HYBRIDSEARCH.JOINEDCHANNEL],t.filter&&"organization"==t.filter&&(m=[He.HYBRIDSEARCH.CHANNEL])):"conversations"==t.data_source&&(t.options=this.constructOptionsDetails(t.data_source),m=[He.HYBRIDSEARCH.CHAT]),e.push(k(pc,{setfocus:this.props.setfocus,list:t,searchable:!0,multiple:c,searchsequence:m,triggerOnChange:this.props.triggerOnChange,onTriggerInput:this.props.onTriggerInput,onItemSelection:this.props.addDataToList,removeDataFromList:this.props.removeDataFromList}))}if("select"==t.type||"dynamic_select"==t.type){var u=!!t.multiple,p=!!(u||t.options&&4<t.options.length);"dynamic_select"==t.type&&(p=!0),t=t||[],e.push(k(pc,{setfocus:this.props.setfocus,list:t,searchable:p,multiple:u,triggerOnChange:this.props.triggerOnChange,onTriggerInput:this.props.onTriggerInput,onItemSelection:this.props.addDataToList,removeDataFromList:this.props.removeDataFromList}))}return"file"==t.type&&e.push(k(cm,{item:t,formid:this.props.formid,addFilesToList:this.props.addFilesToList,setfocus:this.props.setfocus})),"radio"!=t.type&&"checkbox"!=t.type||e.push(k(qm,{key:t.value,type:t.type,item:t,triggerOnChange:this.props.triggerOnChange,onItemSelection:this.props.addDataToList})),"location"==t.type&&e.push(k(Nm,{key:t.value,item:t,formid:this.props.formid,setfocus:this.props.setfocus,onLocationSelect:this.props.addDataToList})),e},e.prototype.render=function(e){var t=null,s=null,i=null,n=null;if(e.inputfield.form_error_msg&&(i=k("div",{class:zd,title:e.inputfield.form_error_msg},e.inputfield.form_error_msg)),e.inputfield.showmandatoryerror&&e.inputfield.mandatory&&(t=k("div",{class:zd},$("forms.mandatory"))),e.inputfield.max_length_error){var a="number"!=e.inputfield.type?"forms.maxlengtherror":"forms.maxvalueerror";n=k("div",{class:zd},$(a,[e.inputfield.max_length||e.inputfield.max]))}if(e.inputfield.min_length_error){var o="number"!=e.inputfield.type?"forms.minlengtherror":"forms.minvaluerror";n=k("div",{class:zd},$(o,[e.inputfield.min_length||e.inputfield.min]))}e.inputfield.max_selection_error&&(n=k("div",{class:zd},$("forms.maxselectionerror",[e.inputfield.max_selections]))),e.inputfield.min_selection_error&&(n=k("div",{class:zd},$("forms.minselectionerror",[e.inputfield.min_selections]))),"invalidemail"==e.inputfield.validationerror&&(s=k("div",{class:zd},$("forms.invalidemail"))),"invalidurl"==e.inputfield.validationerror&&(s=k("div",{class:zd},$("forms.invalidurl"))),"invalidtel"==e.inputfield.validationerror&&(s=k("div",{class:zd},$("forms.invalidtel"))),e.inputfield.uploadprogresserror&&(s=k("div",{class:zd},$("forms.uploadprogresserror"))),"invalidnum"==e.inputfield.validationerror&&(s=k("div",{class:zd},$("forms.invalidnum")));var r="";return"disable"==e.inputfield.status&&(r=Kd),s&&(n=i=null),t&&(s=n=i=null),k("div",{class:rd+" "+r,ref:this.storeFormItemNode},this.constructFormItem(),k("div",{class:Gd,ref:this.storeErrorContainerNode},t,s,i,n))},e}(M),Vm=function(t){function e(e){t.call(this,e),this.state={list:wi(e.params.output,!0).inputs,global_form_error:null,removescroll:!1,submitloader:!1},this.scroll_to_error=!1,this.submitForm=this.submitForm.bind(this),this.cancelForm=this.cancelForm.bind(this),this.triggerOnChange=this.triggerOnChange.bind(this),this.handleTriggerOnChange=this.handleTriggerOnChange.bind(this),this.handleFormInput=this.handleFormInput.bind(this),this.changeLoadingStatus=this.changeLoadingStatus.bind(this),this.onTriggerInput=this.onTriggerInput.bind(this),this.addDataToList=this.addDataToList.bind(this),this.updateValidationError=this.updateValidationError.bind(this),this.removeDataFromList=this.removeDataFromList.bind(this),this.disableScrollToMandatory=this.disableScrollToMandatory.bind(this),this.handleFormSubmit=this.handleFormSubmit.bind(this),this.removeFormError=this.removeFormError.bind(this),this.addFilesToList=this.addFilesToList.bind(this),this.handleEscapeListener=this.handleEscapeListener.bind(this),document.addEventListener("keydown",this.handleEscapeListener)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.componentDidMount=function(){this.updateScroll()},e.prototype.checkScrollStatus=function(){var e=this.props.parentnode.querySelector("[data-dialogwrapper=true]");return e&&e.scrollHeight<490},e.prototype.updateScroll=function(){this.setState({removescroll:this.checkScrollStatus()})},e.prototype.componentDidUpdate=function(e,t){t.removescroll!=this.checkScrollStatus()&&this.updateScroll()},e.prototype.handleEscapeListener=function(e){e&&27==e.keyCode&&this.cancelForm(e)},e.prototype.disableScrollToMandatory=function(){this.scroll_to_error=!1},e.prototype.removeFormError=function(){this.setState({global_form_error:null})},e.prototype.addFilesToList=function(e,t){for(var s=this.state.list,i=0;i<s.length;i++)s[i].name==e&&(s[i].value=t,s[i].form_error_msg&&(s[i].form_error_msg=null),s[i].showmandatoryerror&&(s[i].showmandatoryerror=!1));this.setState({list:s})},e.prototype.validateTextInput=function(e,t){var s=!1;return""==t&&!e.mandatory||("email"!=e.format||t.match(ge.regexes.emailid)||(s="invalidemail"),"url"!=e.format||t.match(ge.regexes.link)||(s="invalidurl"),"tel"!=e.format||t.match(ge.regexes.phonenumber)||(s="invalidtel"),"number"==e.type&&isNaN(t)&&(s="invalidnum")),s},e.prototype.updateValidationError=function(e,t){for(var s=this.state.list,i=0;i<s.length;i++)if(s[i].name==e){var n=this.validateTextInput(s[i],t);s[i].validationerror=n}this.setState({list:s})},e.prototype.addDataToList=function(e,t){for(var s=this.state.list,i="",n=this.state.global_form_error,a=0;a<s.length;a++)if(s[a].name==e){i=s[a].value,n=n&&null,s[a].form_error_msg&&(s[a].form_error_msg=null),s[a].multiple?"native_select"==s[a].type?i?i.push(t):i=[t]:i=i?i+","+t.value:t.value:i="native_select"==s[a].type?(i=i||{},[t]):"location"==s[a].type?{latitude:t.lat||t.latitude,longitude:t.lon||t.longitude,full_address:t.full_address}:t.value||t,(""==(s[a].value=i)&&!s[a].mandatory||s[a].showmandatoryerror)&&(s[a].max_selection_error?s[a].max_selection_error=!1:s[a].min_selection_error?s[a].min_selection_error=!1:s[a].min_length_error?s[a].min_length_error=!1:s[a].max_length_error&&(s[a].max_length_error=!1)),s[a].showmandatoryerror&&i&&(s[a].showmandatoryerror=!1);break}this.setState({list:s,global_form_error:n})},e.prototype.removeDataFromList=function(e,t){for(var s=this.state.list,i="",n=0;n<s.length;n++)if(s[n].name==e){var a=s[n];if(i=a.value,"native_select"==a.type)if(a.multiple){for(var o=0;o<i.length;o++)if(t.id==i[o].id){i.splice(o,1);break}}else i="";else if(a.multiple){i=i.split(",");s[n].options;i.splice(i.indexOf(t.value),1),i=i.toString()}else i="";""!=i||s[n].mandatory||(s[n].max_selection_error?s[n].max_selection_error=!1:s[n].min_selection_error&&(s[n].min_selection_error=!1)),s[n].value=i}this.setState({list:s})},e.prototype.onTriggerInput=function(e,t){var s={};s.values=this.constructFormData(),s.target={name:e,query:t||""},this.current_input_query=t,Km(s,this.props.params.output.id,this.handleFormInput.bind(this,t,e)),this.changeLoadingStatus(e,!0)},e.prototype.getConcatenatedList=function(e,t){for(var s=0;s<t.length;s++){for(var i=!0,n=0;n<e.length;n++)t[s].value==e[n].value&&(i=!1);i&&(e=e.concat(t[s]))}return e},e.prototype.handleFormInput=function(e,t,s){var i="";i=s?JSON.parse(s):{output:{target:t,options:[]}};var n=this.state.list;if("Consent"==i.status){(new It).mountComponent(i.chid,i,function(e,t){this.handleFormInput(JSON.stringify(t.data.dreResponse))}.bind(this))}else{for(var a=0;a<n.length;a++)n[a].name==i.output.target&&this.current_input_query==e&&(this.changeLoadingStatus(n[a].name,!1),i.output.options.length&&(n[a].options=this.getConcatenatedList(n[a].options||[],i.output.options)));this.setState({list:n})}},e.prototype.checkAndAssignErrors=function(e,t,s,i){for(var n=0;n<s.length;n++){var a=s[n],o=i[n];-1<a.indexOf("max")&&t>e[a]||-1<a.indexOf("min")&&t<e[a]?e[o]=!0:e[o]&&(e[o]=!1)}return e},e.prototype.checkFormValuesLength=function(e){for(var t=0;t<e.length;t++)if((e[t].max_length||e[t].max_selections||e[t].min_selections||e[t].min_length||e[t].max||e[t].min)&&e[t].value){var s=["max_selection_error","min_selection_error"],i=["max_length_error","min_length_error"];if(e[t].multiple){var n=null;(n="native_select"==e[t].type?e[t].value.length:e[t].value.split&&e[t].value.split(",").length)&&(e[t]=this.checkAndAssignErrors(e[t],n,["max_selections","min_selections"],s))}else if("checkbox"==e[t].type){var a=e[t].value.split(",");e[t]=this.checkAndAssignErrors(e[t],a.length,["max_selections","min_selections"],s)}else if("number"!=e[t].type||e[t].validationerror)e[t]=this.checkAndAssignErrors(e[t],e[t].value.length,["max_length","min_length"],i);else{var o=parseInt(e[t].value);this.checkAndAssignErrors(e[t],o,["max","min"],i)}}return e},e.prototype.setScrollError=function(e){this.scroll_to_error=!1;for(var t=0;t<e.length;t++)if(e[t].max_selection_error||e[t].min_selection_error||e[t].max_length_error||e[t].min_length_error||e[t].showmandatoryerror||e[t].uploadprogresserror||e[t].validationerror){this.scroll_to_error=!0;break}},e.prototype.checkMandatoryFields=function(){for(var e=this.state.list,t=0;t<e.length;t++){if("file"==e[t].type)if(e[t].value&&e[t].value.length){for(var s=e[t].value,i=0;i<s.length;i++)if(e[t].showmandatoryerror=!1,e[t].uploadprogresserror=!1,"inprogress"==s[i].status){if(1!=s.length||!e[t].mandatory){e[t].uploadprogresserror=!0;break}e[t].showmandatoryerror=!0}}else e[t].uploadprogresserror&&(e[t].uploadprogresserror=!1),e[t].mandatory&&(e[t].showmandatoryerror=!0);else!e[t].mandatory||("location"!=e[t].type||e[t].value.latitude&&e[t].value.longitude)&&e[t].value&&""!=e[t].value||(e[t].showmandatoryerror=!0);"disable"==e[t].status&&e[t].showmandatoryerror&&(e[t].showmandatoryerror=!1)}e=this.checkFormValuesLength(e),e=this.validateAllInputs(e),this.setScrollError(e),this.setState({list:e})},e.prototype.validateAllInputs=function(e){for(var t=0;t<e.length;t++)"text"!=e[t].type&&"number"!=e[t].type||!e[t].value||(e[t].validationerror=this.validateTextInput(e[t],e[t].value));return e},e.prototype.submitForm=function(){var e=this.constructFormData();if(this.checkMandatoryFields(e),!this.scroll_to_error){for(var t,s,i,n,a,o=this.state.list,r=0;r<o.length;r++)"file"==o[r].type&&um();t={values:e},s=this.props.params.output.id,i=this.props.submitCallBack,n=this.handleFormSubmit,a={"Content-Type":"application/json","X-New-Date-API":!0,"x-consents-version":"1","X-XHR-exception":!0,"X-ZCSRF-TOKEN":ci()},Te("v2/forms/"+s+"/actions/submit",t,function(e){var t=JSON.parse(e);("Success"==t.status&&"form_error"!=t.output.type||"Failure"==t.status&&!t.data)&&(t.output.isTempResponse=!0,i(t.chid,t.output.meta.message_source.id,t)),n(t)},null,null,null,a),this.setState({submitloader:!0})}},e.prototype.cancelForm=function(e){var t,s;this.props.params.output.trigger_on_cancel&&(t=this.props.params.output.id,s=this.props.submitCallBack,Te("v2/forms/"+t+"/actions/cancel",null,function(e){var t=JSON.parse(e);"Success"==t.status&&(t.output.isTempResponse=!0,s(t.chid,t.output.meta.message_source.id,t))},null,null,null)),this.props.closeCallBack(),e.stopPropagation(),e.preventDefault(),document.removeEventListener("keydown",this.handleEscapeListener),this.props.unmountComponent()},e.prototype.handleFormClose=function(){this.props.closeCallBack(),document.removeEventListener("keydown",this.handleEscapeListener),this.props.unmountComponent()},e.prototype.handleFormSubmit=function(e){if(e.output&&"form_error"==e.output.type)if(e.output.text||e.output.inputs){var t=this.state.list;if(e.output.inputs)for(var s=e.output.inputs,i=0;i<t.length;i++)for(var n in s)n==t[i].name&&(t[i].form_error_msg=s[n]);this.setState({list:t,global_form_error:e.output.text,submitloader:!1})}else rn($("event.status.update.error")),this.handleFormClose();else if("Consent"==e.status){(new It).mountComponent(e.chid,e,function(e,t){var s=t.data.dreResponse.message_source?t.data.dreResponse.message_source.id:t.data.dreResponse.output.meta.message_source.id;this.props.submitCallBack(e,s,t.data.dreResponse),this.handleFormClose()}.bind(this))}else{if("Failure"==e.status&&e.data)(new It).mountComponent(e.chid,e);this.handleFormClose()}},e.prototype.triggerOnChange=function(e){var t,s,i,n,a,o={};o.values=this.constructFormData(),o.target={name:e},this.changeLoadingStatus(e,!0),t=o,s=this.props.params.output.id,i=this.handleTriggerOnChange,n=this.changeLoadingStatus,a={"Content-Type":"application/json","X-New-Date-API":!0,"x-consents-version":"1","X-XHR-exception":!0,"X-ZCSRF-TOKEN":ci()},Te("v2/forms/"+s+"/actions/change",t,function(e){var t=JSON.parse(e);if("Success"==t.status)i(t);else if("Consent"==t.status){(new It).mountComponent(t.chid,t,function(e,t){i(t.data.dreResponse)})}},function(){n(null,!1)},null,null,a)},e.prototype.handleTriggerOnChange=function(e){for(var t=e.output.actions,s=[].concat(this.state.list),i=0;i<t.length;i++)for(var n=0;n<s.length;n++)if(s[n].name==t[i].name){if("remove"==t[i].type){s.splice(n,1);break}if("add_after"==t[i].type){s.splice(n+1,0,t[i].input);break}if("add_before"==t[i].type){s.splice(n,0,t[i].input);break}if("update"==t[i].type){s=this.updateFormItem(t[i].input,s,t[i].name);break}if("disable"==t[i].type){this.changeFormItemStatus(t[i].type,t[i].name,s);break}if("enable"==t[i].type){s=this.changeFormItemStatus(t[i].type,t[i].name,s);break}"clear"==t[i].type&&(s[n].value="")}this.changeLoadingStatus(null,!1),this.setState({list:s})},e.prototype.changeFormItemStatus=function(e,t,s){for(var i=0;i<s.length;i++)s[i].name==t&&(s[i].status=e);return s},e.prototype.updateFormItem=function(e,t,s){for(var i=0;i<t.length;i++)t[i].name==s&&(t[i]=e);return t},e.prototype.constructFormData=function(){for(var e=this.state.list||{},t={},s=0;s<e.length;s++){var i=e[s].name;if("native_select"==e[s].type){var n=e[s].data_source;if(t[i]={},t[i][n]=[],e[s].value&&0<e[s].value.length)for(var a=e[s].value,o=0;o<a.length;o++){var r=a[o].id;"channels"==n&&(r=a[o].oc_id?a[o].oc_id:Sr(a[o].id).oc_id),t[i][n].push(r)}}else if("file"==e[s].type&&e[s].value&&e[s].value.length){for(var l=[],d=0;d<e[s].value.length;d++)e[s].value[d].id&&l.push(e[s].value[d].id);t[i]=l.join(",")}else"location"==e[s].type?t[i]={latitude:e[s].value.latitude,longitude:e[s].value.longitude}:e[s].value&&(t[i]=e[s].value)}return t},e.prototype.changeLoadingStatus=function(e,t){for(var s=this.state.list,i=0;i<s.length;i++){if(s[i].name==e){s[i].isloading=t;break}if(!t&&!e&&s[i].isloading){s[i].isloading=t;break}}this.setState({list:s})},e.prototype.getFormDialog=function(){var e=this.props.params.output,t=e.title,s=[];this.state.global_form_error||s.push({text:$("Cancel"),buttonstyle:Xl,onclick:this.cancelForm}),(e.actions&&e.actions.submit||e.action)&&!this.state.global_form_error&&(this.state.submitloader?s.push({buttonstyle:Jl+" "+uc}):s.push({text:e.button_label||$("forms.submit"),buttonstyle:Jl,onclick:this.submitForm}));var i=this.state.removescroll?sc:"",n={customFooterStyle:Kl,customContainerStyle:Zl,customHeaderStyle:ed,customWrapperStyle:td+" "+i,customButtonStyle:Ql},a=this.state.list,o=[],r=null;e.hint&&(r=k("div",{class:yd,title:e.hint},e.hint));for(var l=0;l<a.length;l++){a[l].value||"native_select"!=a[l].type||(a[l].value=[]);var d=!1;0==l&&(d=!0),o.push(k(Ym,{key:a[l].name,inputfield:a[l],triggerOnChange:this.triggerOnChange,onTriggerInput:this.onTriggerInput,addDataToList:this.addDataToList,removeDataFromList:this.removeDataFromList,scroll_to_error:this.scroll_to_error,setfocus:d,formid:this.props.params.output.id,addFilesToList:this.addFilesToList,updateValidationError:this.updateValidationError})),this.scroll_to_error&&(a[l].showmandatoryerror||a[l].max_length_error||a[l].validationerror)&&this.disableScrollToMandatory()}var c=[];if(this.props.params.message_source){var m=this.props.params.message_source,u=null,p=null;if(m.name){var h=m.store_appname?m.store_appname:"/"+m.name;u=k("div",{class:Wd},h)}if(m.photo_id||m.store_app_photoid){var g=m.photo_id||m.store_app_photoid,f="/_chat/botimg/"+g+"/photo.do";"command"==m.type&&(f="/_chat/commandimg/"+g+"/photo.do"),"messageaction"==m.type&&(f="/_chat/appimg/"+g+"/photo.do"),p=k("img",{class:_d,src:f})}c=[k("div",{class:sd},p,u)]}return this.state.global_form_error&&(c=[k("div",{class:Id},k("div",{class:Qd},this.state.global_form_error),k(R,{classname:gd,type:"icon",content:"e9ee",onclick:this.removeFormError}))]),k(et,{heading:t,headerinfosuffix:r,actions:s,footerinfoprefix:c,customDialogStyles:n,ignoreFocusOnMount:!0},o)},e.prototype.render=function(){return k("div",null,this.getFormDialog()," ")},e}(M);function Zm(){this.unmountComponent=this.unmountComponent.bind(this)}var Km=Bi(function(e,t,s){Te("v2/forms/"+t+"/actions/input",e,s,s,null,null,{"Content-Type":"application/json","x-consents-version":"1","X-XHR-exception":!0,"X-ZCSRF-TOKEN":ci()})}.bind(void 0),void 0,500);Zm.prototype.mountComponent=function(e,t,s){this.node=document.createElement("div"),document.body.appendChild(this.node),O(k(Vm,{params:e,unmountComponent:this.unmountComponent,submitCallBack:t,parentnode:this.node,closeCallBack:s}),this.node)},Zm.prototype.unmountComponent=function(){O("",this.node),this.node.parentElement&&this.node.parentElement.removeChild(this.node)};function Xm(){this.unmountComponent=this.unmountComponent.bind(this)}var Jm="mc1e6ad615_consentparent",Qm="mc1e6ad615_linkicon",eu="mc1e6ad615_headercontainer",tu="mc1e6ad615_headercontent",su="mc1e6ad615_footer",iu="mc1e6ad615_footerprefix",nu="mc1e6ad615_texthint",au="mc1e6ad615_hideclose",ou="mc1e6ad615_headerdescription",ru="mc1e6ad615_bodycontainer",lu="mc1e6ad615_text",du="mc1e6ad615_restrict",cu="mc1e6ad615_allow",mu=function(t){function e(e){t.call(this,e),this.state={remember:!1},this.rememberTheChoice=this.rememberTheChoice.bind(this),this.allowPermission=this.allowPermission.bind(this),this.restrictPermission=this.restrictPermission.bind(this),this.dialogCloseCallBack=this.dialogCloseCallBack.bind(this)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.dialogCloseCallBack=function(){this.props.onResponse(!0,!1)},e.prototype.updateLinkPreviewSettings=function(e){uu(e,function(e){1==e.authentication_consent?(this.props.onResponse(!0,!0),this.props.unmountComponent()):-1==e.authentication_consent&&(this.props.onResponse(!1,!0),this.props.unmountComponent())}.bind(this))},e.prototype.rememberTheChoice=function(){this.setState({remember:!this.state.remember})},e.prototype.allowPermission=function(){this.state.remember?this.updateLinkPreviewSettings(1):(this.props.onResponse(!0,!0),this.props.unmountComponent())},e.prototype.restrictPermission=function(){this.state.remember?this.updateLinkPreviewSettings(-1):(this.props.onResponse(!1,!0),this.props.unmountComponent())},e.prototype.render=function(){var e=k("div",{class:tu},k(R,{classname:Qm,type:"icon",content:"e991"}),k("div",{class:ou},$("urlconsent.zoholinkpreview"))),t=k("div",null,k("div",{class:lu},$("urlconsent.description1")),k("div",{class:lu},$("urlconsent.description2")),k("div",{class:lu}," ",$("urlconsent.description3")),k("div",{class:lu+" "+nu},k("span",null,$("urlconsent.description4",$("urlconsent.zoholinkprivacy"))))),s={customFooterStyle:su,customContainerStyle:Jm,customHeaderStyle:eu,customWrapperStyle:ru,customButtonStyle:au},i=[{text:$("urlconsent.restrict"),buttonstyle:du,onclick:this.restrictPermission},{text:$("urlconsent.allow"),buttonstyle:cu,onclick:this.allowPermission}],n=[k("div",{class:iu},k("input",{id:"rememberme",type:"checkbox",oninput:this.rememberTheChoice}),k("label",{for:"rememberme"},$("urlconsent.remember")))];return k("div",{class:Jm},k(et,{customDialogStyles:s,actions:i,callbackOnClose:this.dialogCloseCallBack,footerinfoprefix:n,heading:e},t))},e}(M);function uu(e,t,s){Te("updatelinkpreviewsettings.do","authentication_consent="+e,t,s)}Xm.prototype.mountComponent=function(e){this.node=document.createElement("div"),document.body.appendChild(this.node),O(k(mu,{onResponse:e,unmountComponent:this.unmountComponent}),this.node)},Xm.prototype.unmountComponent=function(){O("",this.node),this.node.parentElement.removeChild(this.node)};function pu(){}var hu="mc2e590262_calendar_wrapper",gu="mc2e590262_calendarcontainer_custom",fu="mc2e590262_timecontainer_custom",Cu="mc2e590262_duration_item_style",vu="mc2e590262_custom_listinfocontainer",bu="mc2e590262_duration_list_wrapper",yu="mc2e590262_custom_duration_listwrapper",_u="mc2e590262_duration_selector_wrapper",Wu="mc2e590262_duration_wrapper_expanded",Su="mc2e590262_duration_footer_wrapper",wu="mc2e590262_duration_text",Mu="mc2e590262_duration_text_invalid",Iu="mc2e590262_duration_apply_button",Tu="mc2e590262_duration_apply_invalid",Au="mc2e590262_time_space",Eu="mc2e590262_timecnt_custom",Uu=function(t){function e(e){t.call(this,e),this.state={display_customcalendar:!1,display_duration_selector:!0,selected_date:Date.now(),selected_time:(new Date).getHours()+":"+((new Date).getMinutes()+1),duration_list:[{id:"3600000",title:$("chat.hour",[1]),empty_img:!0},{id:"28800000",title:$("chat.hours",[8]),empty_img:!0},{id:"86400000",title:$("chat.day",[1]),empty_img:!0},{id:"604800000",title:$("chat.week",[1]),empty_img:!0},{id:"-1",title:$("chat.forever"),empty_img:!0},{id:"custom",title:$("pinmsg.duration.custom"),empty_img:!0}]},this.onListItemClicked=this.onListItemClicked.bind(this),this.onDateChange=this.onDateChange.bind(this),this.onTimeChange=this.onTimeChange.bind(this),this.onDurationSelect=this.onDurationSelect.bind(this)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.onDurationSelect=function(e,t,s){t=t||this.combineDateAndTimeAsEpoch(),s=s||$("pinmsg.duration.customtime",te(t)),this.setState({display_duration_selector:!1}),this.props.onDurationSelect(t,s)},e.prototype.onListItemClicked=function(e,t,s){var i="-1"===e.id?"-1":(new Date).getTime()+parseInt(e.id);"custom"===e.id?this.setState({display_customcalendar:!this.state.display_customcalendar}):this.onDurationSelect(null,i,e.title),s.stopPropagation()},e.prototype.constructDurationList=function(){var e={customContainerStyles:Cu,rowHeight:30,customListWrapper:yu,listinfoContainerStyle:vu};return k("div",{class:bu},k(wa,{list:this.state.duration_list,onListItemClicked:this.onListItemClicked,iscompletelist:!0,customlistitemstyles:e}))},e.prototype.onDateChange=function(e){e=new Date(e).getTime(),this.setState({selected_date:e})},e.prototype.onTimeChange=function(e,t){this.setState({selected_time:t})},e.prototype.combineDateAndTimeAsEpoch=function(){var e=se(this.state.selected_date),t=new Date(this.state.selected_date).getFullYear();-1===e.indexOf(t)&&(e+=" "+t);var s=e+" "+this.state.selected_time;return new Date(s).getTime()},e.prototype.constructCalendarAndTimeComp=function(){var e=wu,t=Iu,s=$("pinmsg.duration.till")+" "+te(this.combineDateAndTimeAsEpoch());Date.now()>this.combineDateAndTimeAsEpoch()&&(e+=" "+Mu,t+=" "+Tu,s=$("pinmsg.duration.invalid"));var i={calendarcontainer:gu},n={timecontainer:fu,timecnt:Eu};return k("div",{class:hu},k("div",null,k(L,{onDateSelection:this.onDateChange,selecteddate:this.state.selected_date,customclass:i}),k("div",{class:Au},$("pinmsg.time.heading"),k(Dn,{time:this.combineDateAndTimeAsEpoch(),onTimeChange:this.onTimeChange,customclass:n})),k("div",{class:Su},k("span",{class:e},s),k(R,{type:"button",key:"apply",content:$("pinmsg.custom.apply"),classname:t,onclick:this.onDurationSelect}))))},e.prototype.render=function(){if(!this.state.display_duration_selector)return null;var e=null,t=_u+" ";t+=this.props.selectorWrapperCustomStyle&&this.props.selectorWrapperCustomStyle.selector_wrapper||"";var s=this.props.selectorWrapperCustomStyle&&this.props.selectorWrapperCustomStyle.selector_wrapper_expanded||Wu;return this.state.display_customcalendar&&(e=this.constructCalendarAndTimeComp(),t+=" "+s),k("div",{class:t},this.constructDurationList(),e)},e}(M);pu.prototype.mountComponent=function(e,t,s){this.node=e,O(k(Uu,{node:e,onDurationSelect:t,selectorWrapperCustomStyle:s}),e)},pu.prototype.unmountComponent=function(){O("",this.node)};function xu(){}var Nu={allownotification_checkbox:"mc541d7947_allownotification_checkbox",allownotification_checkboxsel:"mc541d7947_allownotification_checkboxsel",allownotification_text:"mc541d7947_allownotification_text",pinheader:"mc541d7947_pinheader",pinheader_wrapper:"mc541d7947_pinheader_wrapper",pinmsg_wrapper:"mc541d7947_pinmsg_wrapper",pinicon:"mc541d7947_pinicon",pinmsg:"mc541d7947_pinmsg",content_wrapper:"mc541d7947_content_wrapper",duration_label:"mc541d7947_duration_label",duration_dropdown_wrapper:"mc541d7947_duration_dropdown_wrapper",duration_selector_wrapper:"mc541d7947_duration_selector_wrapper",duration_selector_text:"mc541d7947_duration_selector_text",pinnote:"mc541d7947_pinnote",button_style:"mc541d7947_button_style",container:"mc541d7947_container",header:"mc541d7947_header",notificationwrapper:"mc541d7947_notificationwrapper",footer:"mc541d7947_footer",button_pin:"mc541d7947_button_pin",button_cancel:"mc541d7947_button_cancel",duration_selector_position:"mc541d7947_duration_selector_position",duration_wrapper_expanded:"mc541d7947_duration_wrapper_expanded",zmNightMode:"zmNightMode"},ku=function(t){function e(e){t.call(this,e),this.state={allow_notification:!1,show_duration_dropdown:!1,duration_text:$("chat.forever")},this.duration_time="-1",this.setDurationSelectorNode=this.setDurationSelectorNode.bind(this),this.duration_selector_node=null,this.onPinAction=this.onPinAction.bind(this),this.onDurationSelect=this.onDurationSelect.bind(this),this.onDurationWrapperClick=this.onDurationWrapperClick.bind(this),this.onClickOutsideList=this.onClickOutsideList.bind(this),this.toggleNotificationConsents=this.toggleNotificationConsents.bind(this)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.setDurationSelectorNode=function(e){this.duration_selector_node=e},e.prototype.getHeader=function(){return k("div",{class:Nu.pinheader_wrapper},k("div",{class:Nu.pinheader},$("pin.this.msg")),k("div",{class:Nu.header_highlighter}),k("div",{class:Nu.pinmsg_wrapper},k("div",{class:Nu.pinicon}),k("div",{class:Nu.pinmsg,dangerouslySetInnerHTML:{__html:this.props.msgtopin}})))},e.prototype.toggleNotificationConsents=function(e){this.setState({allow_notification:!this.state.allow_notification}),e.stopPropagation()},e.prototype.onPinAction=function(){this.props.pinactionCallback(this.duration_time,this.state.allow_notification),this.props.removeComponent()},e.prototype.onDurationSelect=function(e,t){this.setState({duration_text:t,show_duration_dropdown:!1}),this.duration_time=e},e.prototype.onDurationWrapperClick=function(e){e.target===this.duration_selector_node&&(this.setState({show_duration_dropdown:!this.state.show_duration_dropdown}),e.stopPropagation())},e.prototype.onClickOutsideList=function(){this.setState({show_duration_dropdown:!1})},e.prototype.render=function(){var e=this.state.allow_notification?Nu.allownotification_checkboxsel:Nu.allownotification_checkbox,t=[{text:$("Cancel"),onclick:this.props.removeComponent,buttonstyle:Nu.button_cancel},{text:$("pinmsg.pin"),onclick:this.onPinAction,buttonstyle:Nu.button_pin}],s=$("channel.deluge.note"),i=this.props.show_pin_note?k("div",{class:Nu.pinnote},k("strong",null,s)," "+$("pinmsg.existing.note")):"",n={selector_wrapper:Nu.duration_selector_position,selector_wrapper_expanded:Nu.duration_wrapper_expanded},a=this.state.show_duration_dropdown?k(Q,{onClickOutside:this.onClickOutsideList},k(Uu,{onDurationSelect:this.onDurationSelect,selectorWrapperCustomStyle:n})):"",o=k("div",{class:Nu.content_wrapper},k("div",{class:Nu.duration_dropdown_wrapper},k("div",{class:Nu.duration_label},$("pinmsg.duration.label")),k("div",{class:Nu.duration_selector_wrapper,"data-pin-dropdown":!0,ref:this.setDurationSelectorNode,onclick:this.onDurationWrapperClick},this.state.duration_text,a)),i),r=k("div",{class:Nu.notificationwrapper,onclick:this.toggleNotificationConsents},k("span",{class:e}),k("input",{type:"checkbox"}),k("label",{class:Nu.allownotification_text},$("pinmsg.notify"))),l={customButtonStyle:Nu.button_style,customContainerStyle:Nu.container,customHeaderStyle:Nu.header,customFooterStyle:Nu.footer};return k(et,{heading:this.getHeader(),actions:t,footerinfoprefix:r,customDialogStyles:l,callbackOnClose:this.props.removeComponent},o)},e}(M);xu.prototype.mountComponent=function(e,t,s){this.node=document.createElement("div"),document.body.appendChild(this.node),O(k(ku,{pinactionCallback:e,msgtopin:t,removeComponent:this.unmountComponent.bind(this),show_pin_note:s}),this.node)},xu.prototype.unmountComponent=function(){O("",this.node),Fi(this.node)};function Ou(){this.unmountComponent=this.unmountComponent.bind(this)}var Ru={fork_title_wrapper:"mc8f31fab0_fork_title_wrapper",fork_chattitle:"mc8f31fab0_fork_chattitle",fork_includeall:"mc8f31fab0_fork_includeall",participants_checkboxsel:"mc8f31fab0_participants_checkboxsel",participants_checkbox:"mc8f31fab0_participants_checkbox",fork_dialog_footer:"mc8f31fab0_fork_dialog_footer",zmNightMode:"zmNightMode",listlabel:"mc8f31fab0_listlabel",labelbutton:"mc8f31fab0_labelbutton",faded:"mc8f31fab0_faded",dialogtitle:"mc8f31fab0_dialogtitle"},Hu=function(t){function e(e){t.call(this,e),this.state={include_all_participants:!Di(this.props.listid),chat_title:this.props.chattitle},this.toggleParticipantsInclusion=this.toggleParticipantsInclusion.bind(this),this.handleTitleChange=this.handleTitleChange.bind(this)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.toggleParticipantsInclusion=function(){this.setState({include_all_participants:!this.state.include_all_participants})},e.prototype.handleTitleChange=function(e){var t=Ei(e);this.setState({chat_title:t.value})},e.prototype.getHeader=function(){return k("div",{class:vo.header_wrapper},k("div",{class:vo.heading},$("fork.chat.heading")),k("div",{class:vo.msg_wrapper},k("div",{class:vo.msg},k("div",{class:vo.msg_details},k("div",{class:vo.msgdetails_sender},this.props.msgdetails.sender),k("div",{class:vo.msgdetails_time},this.props.msgdetails.time)),k("div",{class:vo.msg_content,dangerouslySetInnerHTML:{__html:this.props.msgdetails.msg}}))))},e.prototype.render=function(){var e=this.getHeader(),t=[{text:$("Create"),buttonstyle:"confirmation_button",onclick:function(e){if(di(this.state.chat_title))this.props.failureCallback($("fork.title.empty"));else{var t={includeparticipants:this.state.include_all_participants,msguid:this.props.msgid,sid:H.get("sid"),title:this.state.chat_title,userids:e.toString()},s={"Content-Type":"application/json","X-XHR-exception":"true","X-ZCSRF-TOKEN":ci()},i=function(){this.props.failureCallback($("fork.chat.failed"))}.bind(this);Te("v1/chats/"+this.props.listid+"/fork",t,null,i,null,null,s),this.props.unmountComponent()}}.bind(this)}],s=this.state.include_all_participants?Ru.participants_checkboxsel:Ru.participants_checkbox,i=k("div",{class:Ru.fork_header_wrapper},k("div",{class:Ru.fork_title_wrapper},k("div",{class:Ru.fork_chattitle},$("fork.chat.title")),k("input",{type:"text",class:Ru.fork_chattitle_input,onChange:this.handleTitleChange,placeholder:$("fork.title.enter"),value:this.state.chat_title})),k("div",{class:Ru.fork_includeall,onclick:this.toggleParticipantsInclusion},k("span",{class:s}),k("input",{type:"checkbox"}),k("label",{class:Ru.checkbox_label},$("fork.chat.includeall")))),n=this.state.include_all_participants&&this.props.participantslist?{USERID:this.props.participantslist}:"",a=[He.HYBRIDSEARCH.ORGCONTACT],o=bo("DNAME","",As(),10,n,"EMAILID"),r={},l=0;o.forEach(function(e){var t=lo(e);t.counter=l++,r[e.USERID]=t});var d={};n.USERID&&n.USERID.forEach(function(e){var t={id:e};d[e]=t});var c={footerWrapper:Ru.fork_dialog_footer};return k(Na,{listid:this.props.listid,title:e,list:r,searchplaceholder:$("users.name.search"),fetchImageSource:co,multiselect:!0,dialogview:!0,searchsequence:a,defaultsearch:!0,actions:t,callbackOnClose:this.props.unmountComponent,footerprefix:i,customDialogStyles:c,invisible_excluded_list:d,updateinitiallist:!0,sortonsearch:!0,sortComparator:Ci("UC")})},e}(M);Ou.prototype.mountComponent=function(e,t,s,i,n,a){this.node=document.createElement("div"),document.body.appendChild(this.node),O(k(Hu,{listid:e,chattitle:t,msgid:s,msgdetails:i,participantslist:n,failureCallback:a,unmountComponent:this.unmountComponent}),this.node)},Ou.prototype.unmountComponent=function(){O("",this.node),Fi(this.node)};function $u(){this.unmountComponent=this.unmountComponent.bind(this)}var Du=function(t){function e(e){t.call(this,e),this.state={forward_info:this.props.forwardinfo},this.toggleForwardInfo=this.toggleForwardInfo.bind(this)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.toggleForwardInfo=function(){this.setState({forward_info:!this.state.forward_info})},e.prototype.render=function(){var e=this.state.forward_info?Ru.participants_checkboxsel:Ru.participants_checkbox,t=[He.HYBRIDSEARCH.ORGCONTACT,He.HYBRIDSEARCH.JOINEDCHANNEL,He.HYBRIDSEARCH.CHAT],s=k("div",{class:Ru.fork_includeall,onclick:this.toggleForwardInfo},k("span",{class:e}),k("input",{type:"checkbox"}),k("label",{class:Ru.participants_label},$("forward.show.info"))),i=mo(),n=this.props.actions[0].onclick,a=this.state.forward_info,o=this.props.unmountComponent,r=[{text:$("message.forward.send"),buttonstyle:"confirmation_button",onclick:function(e){n(e,a),o()}}],l={footerWrapper:Ru.fork_dialog_footer};return k(Na,{listid:this.props.listid,list:i,title:this.props.listtitle,searchplaceholder:this.props.placeholder,sortonsearch:!0,actions:r,multiselect:!0,fetchImageSource:co,dialogview:!0,defaultsearch:!0,searchsequence:t,footerprefix:s,callbackOnClose:this.props.unmountComponent,customDialogStyles:l})},e}(M);$u.prototype.mountComponent=function(e,t,s,i,n){this.node=document.createElement("div"),document.body.appendChild(this.node),O(k(Du,{listid:e,listtitle:t,placeholder:s,actions:i,forwardinfo:n,unmountComponent:this.unmountComponent}),this.node)},$u.prototype.unmountComponent=function(){O("",this.node),Fi(this.node)};function Lu(){this.unmountComponent=this.unmountComponent.bind(this),this.updateParticipantsData=this.updateParticipantsData.bind(this)}var Pu="mcb7ff3862_container",Bu="mcb7ff3862_wrapper",ju="mcb7ff3862_headerlist",Fu="mcb7ff3862_allitem",zu="mcb7ff3862_otherreactionitem",Gu="mcb7ff3862_listcontainer",qu="mcb7ff3862_emojicount",Yu="mcb7ff3862_selected",Vu="mcb7ff3862_reactedusercontainer",Zu="mcb7ff3862_hoverdetailscontainer",Ku="mcb7ff3862_hovertime",Xu="mcb7ff3862_remainingreactions",Ju="mcb7ff3862_reactioncount",Qu="mcb7ff3862_textemoji",ep="mcb7ff3862_containerWrapperStyle",tp=function(s){function e(e){s.call(this,e),this.zm=new si({default_size:"24",animation:{default_size:"24"}}),this.default_list={data:e.params.reactionlist.data,list:e.params.reactionlist.list},this.partinfo=wi(e.params.partinfo),this.onHeaderElemClick=this.onHeaderElemClick.bind(this),this.checkAndReturnSmileyElem=this.checkAndReturnSmileyElem.bind(this),this.handleSearch=this.handleSearch.bind(this),this.updateParticipantsData=this.updateParticipantsData.bind(this),this.getHoverDetailsContainer=this.getHoverDetailsContainer.bind(this),this.participantinfoupdated=!1;var t=this.filterList("all");this.state={selectedheader:"all",currentlist:t,totalcount:Object.keys(t).length}}return s&&(e.__proto__=s),((e.prototype=Object.create(s&&s.prototype)).constructor=e).prototype.updateParticipantsData=function(e){for(var t in this.participantinfoupdated=!0,e)e[t].email||ws(t)||(e[t].notinorg=!0);this.partinfo=e,this.setState({currentlist:this.filterList(this.state.selectedheader)})},e.prototype.checkAndReturnSmileyElem=function(e){return e.match(this.zm.smiley_regex)?this.zm.getSmiley(e):e},e.prototype.constructReactionData=function(e,t){var s=e.split(":"),i=s[1],n=ws(i)||this.partinfo[i]&&this.partinfo[i].email||"loading";this.partinfo[i]&&this.partinfo[i].notinorg&&(n=$("chat.participant.nonorg"));var a=_s(s[1])||s[2];return H.get("zuid")==i&&(H.get("email")&&(n=H.get("email")),a=$("chat.you")),("loading"==n&&this.participantinfoupdated||"disable"==this.props.params.config.userdescinfo)&&(n=""),{reactedtime:s[0],zuid:i,dname:a,email:n,reactionname:t,numberofreactions:[t],title:a,desc:n,imgsrc:H.get("photoserver")+"/file?ID="+i+"&t=user&width=38&height=38",id:i}},e.prototype.getAllReactorsObj=function(){var e={},t=this.default_list.data;for(var s in t)for(var i=t[s],n=0;n<i.length;n++){var a=i[n].split(":")[1];e[a]?e[a].numberofreactions.push(s):e[a]=this.constructReactionData(i[n],s)}return e},e.prototype.filterList=function(e){var t={};if("all"==e)t=this.getAllReactorsObj();else for(var s=this.default_list.data[e],i=0;i<s.length;i++){t[s[i].split(":")[1]]=this.constructReactionData(s[i],e)}return t},e.prototype.onHeaderElemClick=function(e){this.setState({selectedheader:e,currentlist:this.filterList(e)})},e.prototype.handleSearch=function(e){var t=this.filterList(this.state.selectedheader);return""!=e&&(t=bo("dname",e,t,null,null,"email")),t.map(function(e){return e.id})},e.prototype.getHoverDetailsContainer=function(e){var t=te(e.reactedtime),s=[];if("all"==this.state.selectedheader){for(var i=4<e.numberofreactions.length?e.numberofreactions.length-3:null,n=0;n<e.numberofreactions.length&&3!=n;n++){var a=this.checkAndReturnSmileyElem(e.numberofreactions[n]);"string"==typeof a&&(a=k("div",{class:Qu},a)),s.push(a)}i&&s.push(k("div",{class:Ju},"+"+i))}return k("div",{class:Zu},k("div",{class:Ku},t),k("div",{class:Xu},s))},e.prototype.getReactorList=function(){var e=this.state.currentlist;return k("div",{class:Vu},k(Na,{key:this.state.selectedheader,listid:this.state.selectedheader,list:e,searchplaceholder:$("users.name.search"),iscompletelist:!0,onSearch:this.handleSearch,onListItemClicked:this.props.params.onListItemClick,customlistitemstyles:{containerWrapperStyle:ep},customlistitemprops:{listitemhoverdetails:!0,gethoverdetailscontainer:this.getHoverDetailsContainer},loadingstate:!this.participantinfoupdated,sortonsearch:!0,sortComparator:Ci("reactedtime",!0),updateinitiallist:!0}))},e.prototype.getHeaderList=function(){for(var e=this.default_list.data,t=[],s=0;s<this.default_list.list.length;s++){var i=this.default_list.list[s],n=this.state.selectedheader==i;t.push(k(sp,{name:i,item:e,onHeaderElemClick:this.onHeaderElemClick,selectedheader:n,checkAndReturnSmileyElem:this.checkAndReturnSmileyElem}))}var a="all"==this.state.selectedheader?Yu:"";return k("div",{class:ju},k("div",{class:Fu+" "+a,onclick:this.onHeaderElemClick.bind(this,"all")},$("All")+" "+this.state.totalcount),k("div",{class:Gu},t," "))},e.prototype.render=function(e){var t=this.getHeaderList(),s=this.getReactorList(),i={customContainerStyle:Pu,customWrapperStyle:Bu},n=[t,s];return k(et,{callbackOnClose:e.unmountComponent,customDialogStyles:i},n)},e}(M),sp=function(e){function t(){e.call(this),this.onHeaderElemClick=this.onHeaderElemClick.bind(this)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.onHeaderElemClick=function(){this.props.onHeaderElemClick(this.props.name)},t.prototype.render=function(e){var t=k("div",{class:qu},e.item[e.name].length),s=k("div",{class:qu},e.checkAndReturnSmileyElem(e.name)),i=e.selectedheader?Yu:"";return k("div",{class:zu+" "+i,onclick:this.onHeaderElemClick},s," ",t)},t}(M);Lu.prototype.updateParticipantsData=function(e){this.instance.updateParticipantsData(e)},Lu.prototype.mountComponent=function(e){this.node=document.createElement("div"),document.body.appendChild(this.node),O(k(tp,{ref:function(e){this.instance=e}.bind(this),params:e,unmountComponent:this.unmountComponent}),this.node)},Lu.prototype.unmountComponent=function(){O("",this.node),this.node.parentElement&&this.node.parentElement.removeChild(this.node)};function ip(){this.unmountComponent=this.unmountComponent.bind(this)}var np=function(t){function e(e){t.call(this,e),this.toggleAddParticipantsList=this.toggleAddParticipantsList.bind(this),this.updateParticipantsList=this.updateParticipantsList.bind(this),this.onSearch=this.onSearch.bind(this),this.state={participantslist:no(this.props.listid,this.props.participantslist,this.props.memberOptions),showAddParticipantList:!1,forceupdateinitiallist:!1,searchtext:"",participantsToAdd:{},listid:null},this.next_token="",this.searchtoken="",this.reqcache={result:[],noresult:[],token_mapping:{}},this.addparticipant_reqcache={result:[],noresult:[],token_mapping:{}}}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.isCachedRequest=function(e){for(var t=0;t<this.reqcache.result.length;t++)if(-1!==e.indexOf(this.reqcache.result[t])&&!this.reqcache.token_mapping[this.reqcache.result[t].split("=")[2]])return!0;return!1},e.prototype.isCachedParticipantRequest=function(e){for(var t=0;t<this.addparticipant_reqcache.result.length;t++)if(-1!==e.indexOf(this.addparticipant_reqcache.result[t])&&!this.addparticipant_reqcache.token_mapping[this.addparticipant_reqcache.result[t].split("=")[2]])return!0;return!1},e.prototype.isEmptyResultParticipantCachedRequest=function(e){for(var t=0;t<this.addparticipant_reqcache.noresult.length;t++)if(-1!==e.indexOf(this.addparticipant_reqcache.noresult[t]))return!0;return!1},e.prototype.toggleAddParticipantsList=function(){this.setState({showAddParticipantList:!this.state.showAddParticipantList,searchtext:""})},e.prototype.updateParticipantsList=function(t,e){if("remove"===e.getAttribute("data-operation")){var s=function(){var e=this.state.participantslist;delete e[t.id],this.setState({participantslist:e,forceupdateinitiallist:!0})}.bind(this,t);this.props.onListItemClicked(t,e,s)}else this.props.onListItemClicked(t,e)},e.prototype.fetchParticipants=function(o){var r=this.props.listid,l=this.props.memberOptions,e=function(e){var t=JSON.parse(e),s=t.data.users,i=t.data,n=e?s||i:"";if(s?(o?this.reqcache.token_mapping[o]=i.next_token:this.next_token=i.next_token?i.next_token:"",this.props.fetchAndStoreParticipantsList(r,n)):this.props.threaddetails.fetchAndStoreFollowersList(r,n),this.props.threaddetails&&this.props.threaddetails.parentid&&!s||!this.props.threaddetails.parentid&&s){var a=no(r,n,l);o&&bi(a)?this.reqcache.result.push("&search="+o):o&&!bi(a)&&this.reqcache.noresult.push("&search="+o),a=Object.assign({},this.state.participantslist,a),this.setState({participantslist:a,searchtext:o,forceupdateinitiallist:!0})}}.bind(this),t={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.Util.getCSRF()};this.props.threaddetails&&this.props.threaddetails.parentid&&Ie("v2/threads/"+this.props.listid+"/followers",null,e,null,null,null,t);var s=this.props.threaddetails&&this.props.threaddetails.parentid?this.props.threaddetails.parentid:this.props.listid,i=null;o&&(i=o?"&search="+o:null),this.isCachedRequest(i)||o&&!this.next_token||Ie("v1/chats/"+s+"/participants",i,e)},e.prototype.addMemberToChat=function(e){function t(){2005==JSON.parse(this.response)[0].objString.ERRCODE&&rn($("useradd.not.groupadmin"))}if(Di(this.props.listid)){Te("v1/channels/"+Sr(this.props.listid).oc_id+"/invite","ulist="+encodeURIComponent(e),null,t)}else{var s=this.props.threaddetails&&this.props.threaddetails.parentid?{user_ids:e}:"chid="+this.props.listid+"&ulist="+encodeURIComponent(e),i={"X-XHR-exception":"true"};this.props.threaddetails&&this.props.threaddetails.parentid&&(i["Content-Type"]="application/json");var n=function(){this.props.threaddetails&&this.props.threaddetails.showInfoMsg&&this.props.threaddetails.showInfoMsg($("thread.followers.add"))}.bind(this);Te(this.props.threaddetails&&this.props.threaddetails.parentid?"v2/threads/"+this.props.listid+"/followers":"addmember.do",s,n,t,null,null,i)}},e.prototype.getParticipantsListToAdd=function(i){var n=this.props.threaddetails&&this.props.threaddetails.parentid?this.props.threaddetails.parentid:this.props.listid,a=this,e="mode=allowed";if(i&&(e+="&search="+i),this.isEmptyResultParticipantCachedRequest(e))this.setState({participantsToAdd:{},searchtext:i});else if(this.props.threaddetails.parentid){var t={},s=no(this.props.threaddetails.parentid,this.props.threaddetails.fetchParentParticipants()),o=this.state.participantslist;for(var r in s)o[r]||(t[r]=s[r]);this.setState({participantsToAdd:t,searchtext:i})}else if(!this.isCachedParticipantRequest(e)&&Di(n))Ie("v1/chats/"+n+"/participants",e,function(){var e=JSON.parse(this.response).data,t=e.users,s=no(n,t);i?a.addparticipant_reqcache.token_mapping[i]=e.next_token:a.searchtoken=e.next_token?e.next_token:"",i&&bi(s)?a.addparticipant_reqcache.result.push("mode=allowed&search="+i):i&&!bi(s)&&a.addparticipant_reqcache.noresult.push("mode=allowed&search="+i),s=Object.assign({},a.state.participantsToAdd,s),a.setState({participantsToAdd:s,searchtext:i})});else{var l={USERID:Object.keys(this.state.participantslist)},d=bo("DNAME","",As(),10,l,"EMAILID"),c={},m=0;d.forEach(function(e){var t=lo(e);t.counter=m++,c[e.USERID]=t}),this.setState({participantsToAdd:c,searchtext:i})}},e.prototype.getListLabel=function(){var e=this.props.threaddetails&&this.props.threaddetails.allowfollowersaddition?$("thread.action.addfollower"):$("chat.action.addparticipant");return this.props.allowparticipantsaddition||this.props.threaddetails&&this.props.threaddetails.allowfollowersaddition?k("div",{onclick:this.toggleAddParticipantsList,class:Ru.listlabel},k("span",{class:Ru.labelbutton}),k("span",null,e)):null},e.prototype.onSearch=function(e,t){var s=bo("title",e,t,null,null,"desc");return this.state.showAddParticipantList?s.length<10&&(Li(this.props.listid)||this.searchtoken)&&this.getParticipantsListToAdd(e,!0):s.length<10&&this.fetchParticipants(e,!0),s.map(function(e){return e.id})},e.prototype.componentDidMount=function(){ri(this.state.participantslist)&&this.fetchParticipants()},e.prototype.getSortComparator=function(){return Di(this.props.listid)?vi(Ci("sortidentifier"),Ci("counter",!1)):vi(Ci("statuscode"),Ci("title",!1,function(e){return e.toLowerCase()}))},e.prototype.render=function(){var e=this.getSortComparator(),t=this.props.listtitle,s=this.state.participantslist,i=null,n=null,a=!1,o=!1,r=this.getListLabel(),l=!!ri(s),d=this.updateParticipantsList,c=null;if(this.state.showAddParticipantList){i=[He.HYBRIDSEARCH.ORGCONTACT];var m=this.props.threaddetails&&this.props.threaddetails.allowfollowersaddition?$("thread.action.addfollower"):$("chat.action.addparticipant");t=k("div",{class:Ru.dialogtitle},k("span",{onclick:this.toggleAddParticipantsList},this.props.listtitle),k("span",{class:Ru.faded},">"),k("span",null,m)),ri(this.state.participantsToAdd)&&!this.isEmptyResultParticipantCachedRequest("mode=allowed&search="+this.state.searchtext)&&this.getParticipantsListToAdd(this.state.searchtext),l=!this.state.searchtext,s=this.state.participantsToAdd,n=[{text:$("Add"),buttonstyle:"alignend",onclick:function(e){this.addMemberToChat(e),this.props.unmountComponent()}.bind(this)}],a=!0,d=r=null,o=!Di(this.props.listid)&&!Li(this.props.listid),c=ri(this.state.participantsToAdd)?"":this.state.listid?this.state.listid:this.props.listid}return k(Na,{key:c,listid:this.props.listid,title:t,list:s,searchplaceholder:$("users.name.search"),dialogview:!0,iscompletelist:!0,multiselect:a,defaultsearch:o,onSearch:this.onSearch,fetchImageSource:co,sortonsearch:!0,sortComparator:e,listlabel:r,loadingstate:l,onListItemClicked:d,searchsequence:i,actions:n,forceupdateinitiallist:this.state.forceupdateinitiallist,callbackOnClose:this.props.unmountComponent,searchtext:this.state.searchtext})},e}(M);ip.prototype.mountComponent=function(e,t,s,i,n,a,o,r){this.node=document.createElement("div"),document.body.appendChild(this.node),O(k(np,{listid:e,listtitle:t,participantslist:s,onListItemClicked:i,memberOptions:n,allowparticipantsaddition:a,fetchAndStoreParticipantsList:o,threaddetails:r,unmountComponent:this.unmountComponent}),this.node)},ip.prototype.unmountComponent=function(){O("",this.node),Fi(this.node)};function ap(){this.updateReminderTime=this.updateReminderTime.bind(this)}var op="mc1f3b7abb_container",rp="mc1f3b7abb_msgref_wrapper",lp="mc1f3b7abb_headercontainer",dp="mc1f3b7abb_header",cp="mc1f3b7abb_closebutton",mp="mc1f3b7abb_content",up="mc1f3b7abb_listItems",pp="mc1f3b7abb_titlewrapper",hp="mc1f3b7abb_title",gp="mc1f3b7abb_typewrapper",fp="mc1f3b7abb_radio_label",Cp="mc1f3b7abb_calendarwrapper",vp="mc1f3b7abb_dialogfooter",bp="mc1f3b7abb_addlist",yp="mc1f3b7abb_footerwrapper",_p="mc1f3b7abb_containerWrapperStyle",Wp="mc1f3b7abb_customListWrapper",Sp="mc1f3b7abb_customSearchStyle",wp="mc1f3b7abb_contentwrapper",Mp="mc1f3b7abb_dialogcontent",Ip=function(s){function e(e){s.call(this,e);var t=0<this.props.parsedtime?this.props.parsedtime:(new Date).getTime();this.contentnode=null,this.state={remindertype:"conversation",selected_list:{},display_userslist:!1,remindertime:t},this.onDurationSelect=this.onDurationSelect.bind(this),this.toggleReminderType=this.toggleReminderType.bind(this),this.showUsersList=this.showUsersList.bind(this),this.toggleUsersList=this.toggleUsersList.bind(this),this.addAssigneeList=this.addAssigneeList.bind(this),this.removeSelectedItem=this.removeSelectedItem.bind(this),this.setContentNode=this.setContentNode.bind(this),this.escEventListener=this.escEventListener.bind(this)}return s&&(e.__proto__=s),((e.prototype=Object.create(s&&s.prototype)).constructor=e).prototype.componentDidMount=function(){this.contentnode.focus(),window.addEventListener("keydown",this.escEventListener,!0)},e.prototype.componentWillUnmount=function(){window.removeEventListener("keydown",this.escEventListener,!0)},e.prototype.setContentNode=function(e){this.contentnode=e},e.prototype.updateReminderTime=function(e){this.setState({remindertime:e})},e.prototype.escEventListener=function(e){e.keyCode===He.KEYCODES.ESCAPE&&this.state.display_userslist&&(this.toggleUsersList(),this.contentnode.focus(),e.stopPropagation())},e.prototype.showUsersList=function(e){Ei(e);10<=bi(this.state.selected_list)?rn($("reminders.members.limit",[10])):!bi(this.state.selected_list)||!Di(Object.keys(this.state.selected_list)[0])&&ys(Object.keys(this.state.selected_list)[0])||rn($("reminders.chatremlimit.error")),this.setState({display_userslist:!1})},e.prototype.toggleUsersList=function(){this.setState({display_userslist:!this.state.display_userslist})},e.prototype.addAssigneeList=function(e,t,s){var i=this.state.selected_list;Di(e.id)||!ys(e.id)?(i[e.id]=e,this.setState({selected_list:i,display_userslist:!1})):bi(i)<10?(i[e.id]=e,this.setState({selected_list:i})):(rn($("reminders.members.limit",[10])),this.setState({display_userslist:!1})),s.stopPropagation()},e.prototype.removeSelectedItem=function(e){var t=this.state.selected_list;delete t[e],this.setState({selected_list:t})},e.prototype.toggleReminderType=function(e){var t=Ei(e);this.setState({remindertype:t.value})},e.prototype.onDurationSelect=function(e,t){var s=new Date(e.toDateString()+" "+t).getTime();this.setState({remindertime:s})},e.prototype.fetchAssigneeList=function(){var e=5;(ri(Sr())||!ri(this.state.selected_list)&&ys(Object.keys(this.state.selected_list)[0]))&&(e=10);var t=bo("DNAME","",As(),e,"","EMAILID"),s={},i=0;if(t.forEach(function(e){var t=lo(e);t.groupheader=$("Contacts"),t.sortidentifier=0,t.counter=i++,s[e.USERID]=t}),e<10){var n=Sr();for(var a in n){var o=n[a],r={};r.title=o.dn,r.desc=o.cd,r.id=o.chid,ro(o,r),r.groupheader=$("menuname.channelsandgroups"),r.sortidentifier=1,r.counter=i++,s[o.chid]=r}}var l={containerWrapperStyle:_p,customListWrapper:Wp,customsearchstyle:{searchcontainerstyle:Sp},customContainerStyles:up},d=null;ri(this.state.selected_list)||Di(Object.keys(this.state.selected_list)[0])&&ys(Object.keys(this.state.selected_list)[0])||(d=[He.HYBRIDSEARCH.ORGCONTACT]);var c=ri(this.state.selected_list)?this.props.msgid:Object.keys(this.state.selected_list)[Object.keys(this.state.selected_list).length-1];return k(Na,{key:c,listid:this.props.msgid,list:s,searchplaceholder:$("users.name.search"),fetchImageSource:co,multiselect:!0,dialogview:!1,defaultsearch:!0,actions:this.addAssigneeList,sortonsearch:!0,customlistitemstyles:l,onListItemClicked:this.addAssigneeList,invisible_excluded_list:this.state.selected_list,searchsequence:d})},e.prototype.render=function(){var e=null;this.state.display_userslist&&(e=this.fetchAssigneeList());var t=[],s={customContainerStyle:op,customButtonStyle:cp,customHeaderStyle:lp,customFooterStyle:vp,customWrapperStyle:wp},i=k("div",{class:dp},$("message.actions.setreminder")),n=[{text:$("Create"),buttonstyle:"confirmation_button_small",onclick:function(){var e={time:this.state.remindertime};e.message={chat_id:this.props.chatid,time:this.props.msgid},this.contentnode.value&&(e.content=this.contentnode.value),"conversation"===this.state.remindertype&&(e.chat_ids=[this.props.chatid]),"assignee"===this.state.remindertype&&(e.user_ids=Object.keys(this.state.selected_list));var t={"Content-Type":"application/json","X-XHR-exception":"true","X-ZCSRF-TOKEN":ci()};Te("v2/reminders",e,this.props.successCallback,this.props.failureCallback,null,null,t),this.props.removeComponent()}.bind(this)}],a=$("event.content"),o=k("div",{class:Mp},k("div",{class:rp},k("div",{class:vo.msg_wrapper},k("div",{class:vo.msg},k("div",{class:vo.msg_details},k("div",{class:vo.msgdetails_sender},this.props.msgdetails.sender),k("div",{class:vo.msgdetails_time},this.props.msgdetails.time)),k("div",{class:vo.msg_content,dangerouslySetInnerHTML:{__html:this.props.msgdetails.msg}})))),k("div",{class:mp},k("span",null,a),k("textarea",{ref:this.setContentNode})),k("div",{class:pp},k("div",{class:hp},$("message.reminder.time")),k("div",{class:Cp},k(Fc,{key:this.state.remindertime,disable_time_zone_picker:!0,value:{date_time:this.state.remindertime},presetdate:this.state.remindertime,ignoreclose:!0,onDateSelection:this.onDurationSelect}))),k("div",{class:pp},k("div",{class:hp},$("message.reminder.type")),k("div",{class:gp},k("div",null,k("input",{id:"selfreminder",name:"remtype",checked:"self"===this.state.remindertype,type:"radio",onclick:this.toggleReminderType,value:"self"}),k("span",null),k("label",{for:"selfreminder",class:fp},$("message.reminder.self"))),k("div",null,k("input",{id:"assigneereminder",name:"remtype",checked:"assignee"===this.state.remindertype,type:"radio",onclick:this.toggleReminderType,value:"assignee"}),k("span",null),k("label",{for:"assigneereminder",class:fp},$("message.reminder.others"))),k("div",null,k("input",{id:"conversationreminder",name:"remtype",checked:"conversation"===this.state.remindertype,type:"radio",onclick:this.toggleReminderType,value:"conversation"}),k("span",null),k("label",{for:"conversationreminder",class:fp},$("reminders.type.thisconvo"))))));return"assignee"===this.state.remindertype&&t.push(k("div",{class:yp},k(xa,{selectedItems:Object.keys(this.state.selected_list),fetchImageSource:co,removeSelectedItem:this.removeSelectedItem}),k(Q,{onClickOutside:this.showUsersList},k(R,{classname:bp,type:"button",content:e,onclick:this.toggleUsersList})))),k(et,{heading:i,actions:n,customDialogStyles:s,callbackOnClose:this.props.removeComponent,footerinfoprefix:t},o)},e}(M);ap.prototype.updateReminderTime=function(e){this.instance.updateReminderTime(e)},ap.prototype.mountComponent=function(e,t,s,i,n,a){this.node=document.createElement("div"),document.body.appendChild(this.node),O(k(Ip,{ref:function(e){this.instance=e}.bind(this),chatid:e,msgid:t,msgdetails:s,parsedtime:i,successCallback:n,failureCallback:a,removeComponent:this.unmountComponent.bind(this)}),this.node)},ap.prototype.unmountComponent=function(){O("",this.node),Fi(this.node)};function Tp(){}var Ap="mcefac68b2_container",Ep="mcefac68b2_header",Up="mcefac68b2_closeicon",xp="mcefac68b2_content",Np="mcefac68b2_contentright",kp="mcefac68b2_actions",Op="mcefac68b2_snooze",Rp="mcefac68b2_title",Hp="mcefac68b2_clockimgcontainer",$p="mcefac68b2_clockimg",Dp="mcefac68b2_heading",Lp="mcefac68b2_description",Pp="mcefac68b2_value",Bp="mcefac68b2_dismiss",jp="mcefac68b2_openicon",Fp="mcefac68b2_snoozedesc",zp="mcefac68b2_snoozeitem",Gp="mcefac68b2_snoozeoptioncontainer",qp=function(t){function e(e){t.call(this,e),this.state={snoozetime:5,snoozeoptions:!1},this.setSnoozeOptions=this.setSnoozeOptions.bind(this),this.toggleSnoozeOptions=this.toggleSnoozeOptions.bind(this),this.snoozePopUp=this.snoozePopUp.bind(this),this.onClickDismiss=this.onClickDismiss.bind(this)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.onClickDismiss=function(){this.props.unmountComponent(),this.props.onComponentClose(this.props.data.ALRM)},e.prototype.toggleSnoozeOptions=function(e){this.setState({snoozeoptions:!this.state.snoozeoptions}),e.preventDefault(),e.stopPropagation()},e.prototype.setSnoozeOptions=function(e){this.setState({snoozetime:e,snoozeoptions:!1})},e.prototype.getSnoozeTime=function(){var e=new Date((new Date).getTime()+6e4*this.state.snoozetime),t=new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString();return(t=t.split("T")[0].replace(/-/gi,""))+"T"+oe(e.getTime()).replace(/:/gi,"")},e.prototype.snoozePopUp=function(){var e="v2/calendars/"+this.props.data.CALUID+"/events/"+this.props.data.EUID+"/snooze",t={type:5,action:3,datetime:this.getSnoozeTime()},s={"Content-Type":"application/json","x-consents-version":"1","X-XHR-exception":!0,"X-ZCSRF-TOKEN":ci()},i=function(e){"Success"==JSON.parse(e).status?(rn($("event.snooze.success",[this.state.snoozetime]),"info"),this.props.unmountComponent(),this.props.onComponentClose(this.props.data.ALRM)):n()}.bind(this),n=function(){rn($("event.status.update.error"),"error")}.bind(this);Te(e,t,i,n,null,null,s)},e.prototype.getSnoozeOptions=function(){for(var e=[5,10,15,20],t=[],s=0;s<e.length;s++)this.state.snoozetime!=e[s]&&t.push(k(Yp,{time:e[s],onclick:this.setSnoozeOptions}));return k(Q,{onClickOutside:this.toggleSnoozeOptions},k("div",{class:Gp},t))},e.prototype.render=function(e,t){var s=e.data.LOC?k("div",{class:Dp},k("b",null,$("Location"),k("span",null,":")),k("span",{class:Pp,title:e.data.LOC},e.data.LOC)):null,i=null!=e.data.SD&&""!=e.data.SD?e.data.SD:te(e.data.ST),n=this.state.snoozeoptions?this.getSnoozeOptions():null,a="https://img.zohocdn.com/ichat/images/bar/67992398_clock-min.png";return k("div",{class:Ap},k("div",{class:Ep},k("div",{class:Rp,title:e.data.SUM},e.data.SUM),k(R,{type:"icon",onclick:this.onClickDismiss,content:"e634",classname:Up})),k("div",{class:xp},k("div",{class:Np},k("div",{class:Hp},k("img",{src:a,class:$p})),k("div",{class:Lp},s,k("div",null,k("b",null,$("Time")),k("span",null,":"),k("span",{class:Pp},i)))),k("div",{class:kp},k(R,{type:"button",classname:Bp,theme:"negative",content:$("event.snooze.dismiss"),onclick:this.onClickDismiss}),k("div",{class:Op,onclick:this.snoozePopUp},k("span",{class:Fp},$("event.snooze.snoozefor")+" "+t.snoozetime+$("min")),k(R,{classname:jp,type:"icon",content:"e622",onclick:this.toggleSnoozeOptions}),n))))},e}(M),Yp=function(e){function t(){e.call(this),this.onClickItem=this.onClickItem.bind(this)}return e&&(t.__proto__=e),((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.onClickItem=function(e){this.props.onclick(this.props.time),e.preventDefault(),e.stopPropagation()},t.prototype.render=function(e){return k(R,{classname:zp,onclick:this.onClickItem},$("for")+" "+e.time+$("min"))},t}(M);Tp.prototype.mountComponent=function(e,t,s){this.node=e,new Jn(this.node),O(k(qp,{data:t,unmountComponent:this.unmountComponent.bind(this),onComponentClose:s}),this.node)},Tp.prototype.unmountComponent=function(){O("",this.node),Fi(this.node)};function Vp(){}var Zp={container:"mc2c3bb351_container",header:"mc2c3bb351_header",readuserlist_container:"mc2c3bb351_readuserlist_container",msg_readtime_container:"mc2c3bb351_msg_readtime_container",error_info:"mc2c3bb351_error_info",zmNightMode:"zmNightMode"},Kp=function(e){function t(){this.handleSearch=this.handleSearch.bind(this),this.getHoverDetailsContainer=this.getHoverDetailsContainer.bind(this),this.state={read_userslist:[],show_error_info:!1}}return t.__proto__=e,((t.prototype=Object.create(e.prototype)).constructor=t).prototype.handleSearch=function(e){var t=this.state.read_userslist;return""!=e&&(t=bo("name",e,t,null,null,"email_id")),t.map(function(e){return e.id})},t.prototype.constructUserListObj=function(e){for(var t=e||this.state.read_userslist,s={},i=0,n=0,a=0;a<t.length;a++)t[a].is_read?i+=1:n+=1;for(var o=0;o<t.length;o++){var r=t[o].id,l=!!t[o].is_read;this.props.params.is_121_chat&&t[o].time&&t[o].time;s[r]={read_time:t[o].time||null,zuid:r,dname:_s(r)||t[o].name,email:t[o].email_id||"",is_read:l,groupheader:l?$("msg.read.by",""+i):$("msg.yet.to.read",""+n),title:_s(r)||t[o].name,desc:t[o].email_id||"",id:r,imgsrc:H.get("photoserver")+"/file?ID="+r+"&t=user&width=38&height=38"}}return s},t.prototype.fetchReadReceiptList=function(){Ie("v2/chats/"+this.props.params.chid+"/messages/"+this.props.params.msguid,"fields=read_status",function(e){if(e){var t="string"==typeof e&&""!=e?JSON.parse(e):{};(t=t.read_status).length?this.setState({read_userslist:t}):this.setState({show_error_info:!0})}}.bind(this),function(){this.setState({show_error_info:!0})}.bind(this))},t.prototype.componentDidMount=function(){0!=this.state.read_userslist.length||this.state.show_error_info||this.fetchReadReceiptList()},t.prototype.getHeader=function(){return k("div",{class:Zp.header_wrapper},k("div",{class:vo.heading},$("msg.read.info")),k("div",{class:vo.msg_wrapper},k("div",{class:vo.msg},k("div",{class:vo.msg_details},k("div",{class:vo.msgdetails_sender},$("chat.you")),k("div",{class:vo.msgdetails_time},this.props.params.msg_time)),k("div",{class:vo.msg_content,dangerouslySetInnerHTML:{__html:this.props.params.msg}}))))},t.prototype.getHoverDetailsContainer=function(e){var t=this.props.params.is_121_chat&&e.read_time?te(+e.read_time):"";return k("div",{class:Zp.msg_readtime_container},t)},t.prototype.getUserList=function(){var e=this.constructUserListObj(),t=0==this.state.read_userslist.length&&!this.state.show_error_info,s=!!this.props.params.is_121_chat;return k(Na,{list:e,searchplaceholder:$("users.name.search"),iscompletelist:!0,customlistitemstyles:{containerWrapperStyle:Zp.readuserlist_container},onSearch:this.handleSearch,onListItemClicked:this.props.params.onListItemClick,loadingstate:t,sortonsearch:!0,disablesearchcontainer:s,sortComparator:vi(Ci("is_read",!0),Ci("dname")),customlistitemprops:{listitemhoverdetails:!0,gethoverdetailscontainer:this.getHoverDetailsContainer}})},t.prototype.render=function(){var e=this.getHeader(),t=this.state.show_error_info?k("div",{class:Zp.error_info},$("readreceipt.error.info")):this.getUserList(),s={customHeaderStyle:Zp.header,customContainerStyle:Zp.container,customButtonStyle:vo.close_button,customWrapperStyle:Zp.readuserlist_container};return k(et,{heading:e,callbackOnClose:this.props.removeComponent,customDialogStyles:s},t)},t}(M);Vp.prototype.mountComponent=function(e){this.node=document.createElement("div"),document.body.appendChild(this.node),O(k(Kp,{removeComponent:this.unmountComponent.bind(this),params:e}),this.node)},Vp.prototype.unmountComponent=function(){O("",this.node),Fi(this.node)};function Xp(){this.unmountComponent=this.unmountComponent.bind(this),this.storeDynamicActionInstance=this.storeDynamicActionInstance.bind(this)}var Jp="mcc7848208_actionscontainer",Qp="mcc7848208_loader",eh=function(s){function e(e){s.call(this,e),this.onClickActionItem=this.onClickActionItem.bind(this),this.data=this.props.data?this.props.data:{};var t=this.data&&this.data.buttons?wi(this.props.data.buttons):null;this.state={buttons:t,loading:this.props.loading}}return s&&(e.__proto__=s),((e.prototype=Object.create(s&&s.prototype)).constructor=e).prototype.updateParamDetails=function(e){this.data=e,this.setState({buttons:wi(this.data.buttons),loading:!1})},e.prototype.closeComponent=function(e){var t=this.state.buttons;t[e.index].loading=!1,this.setState({buttons:t}),this.props.closeCallBack()},e.prototype.onClickActionItem=function(e,t){var s=this.state.buttons[t],i=this.props.msgnode.getAttribute("data-msgtime");s.loading=!0;var n=this;this.setState({buttons:this.state.buttons});var a="chid="+this.props.chid+"&msgid="+i+"&isTempResponse=false&btnindex="+s.index+"&event=click";this.data.actions_id&&(a+="&actions_id="+this.data.actions_id),Te("executefunction.do",a,function(e){n.props.handleExecuteFuncCallback(n.props.chid,s.action.type,e),n.closeComponent(s)},function(){"error"==JSON.parse(this.response).module&&rn($("chat.settitle.error")),n.closeComponent(s)},null,null,{"x-consents-version":"1","X-XHR-exception":"true","X-ZCSRF-TOKEN":ci()})},e.prototype.getActionItems=function(){var e=this.state.buttons,t=[];for(var s in e){var i=!!e[s].loading;t.push(k(zl,{actionname:s,label:e[s].label,messageActionCallBack:this.onClickActionItem,loading:i}))}return t},e.prototype.render=function(){var e=this.state.loading?k("div",{class:Qp}):this.getActionItems();return k("div",{style:this.state.buttons&&Object.keys(this.state.buttons).length<2?{"min-height":"40px"}:null,class:Jp},e)},e}(M);Xp.prototype.storeDynamicActionInstance=function(e){this.instance=e},Xp.prototype.updateDynamicActions=function(e){this.instance.updateParamDetails(e)},Xp.prototype.mountComponent=function(e){this.node=e.node,O(k(eh,{ref:this.storeDynamicActionInstance,data:e.data,msgnode:e.msgnode,chid:e.chid,loading:e.loading,closeCallBack:e.closeCallBack,handleExecuteFuncCallback:e.handleExecuteFuncCallback}),e.node)},Xp.prototype.unmountComponent=function(){O("",this.node)};var th="mc953d340a_container",sh="mc953d340a_closeicon",ih="mc953d340a_stopbutton",nh="mc953d340a_sendbutton",ah="mc953d340a_track",oh="mc953d340a_progresstime",rh="mc953d340a_recordingprocessicon",lh="mc953d340a_recordingtrack",dh="mc953d340a_audioplayicon",ch="mc953d340a_audiopauseicon",mh="mc953d340a_trackwidth",uh="mc953d340a_loader";function ph(e,a){if(s="audio",!((t=e)&&t.getTracks?t.getTracks().filter(function(e){return e.kind===(s||"audio")}):[]).length)throw"Your stream has no audio tracks.";var t,s,o,r=this,l=[],d=[],c=!1,m=0,u=2,i=(a=a||{}).desiredSampRate;function p(){if(!1===a.checkForInactiveTracks)return!0;if("active"in e){if(!e.active)return!1}else if("ended"in e&&e.ended)return!1;return!0}function n(e,t){function s(e,t){var s,i=e.numberOfAudioChannels,n=e.leftBuffers.slice(0),a=e.rightBuffers.slice(0),o=e.sampleRate,r=e.internalInterleavedLength,l=e.desiredSampRate;function d(e,t,s){var i,n,a=Math.round(e.length*(t/s)),o=[],r=Number((e.length-1)/(a-1));o[0]=e[0];for(var l=1;l<a-1;l++){var d=l*r,c=Number(Math.floor(d)).toFixed(),m=Number(Math.ceil(d)).toFixed(),u=d-c;o[l]=(i=e[c],n=e[m],i+(n-i)*u)}return o[a-1]=e[e.length-1],o}function c(e,t){for(var s=new Float64Array(t),i=0,n=e.length,a=0;a<n;a++){var o=e[a];s.set(o,i),i+=o.length}return s}function m(e,t,s){for(var i=s.length,n=0;n<i;n++)e.setUint8(t+n,s.charCodeAt(n))}2===i&&(n=c(n,r),a=c(a,r),l&&(n=d(n,l,o),a=d(a,l,o))),1===i&&(n=c(n,r),l&&(n=d(n,l,o))),l&&(o=l),2===i&&(s=function(e,t){for(var s=e.length+t.length,i=new Float64Array(s),n=0,a=0;a<s;)i[a++]=e[n],i[a++]=t[n],n++;return i}(n,a)),1===i&&(s=n);var u=s.length,p=new ArrayBuffer(44+2*u),h=new DataView(p);m(h,0,"RIFF"),h.setUint32(4,36+2*u,!0),m(h,8,"WAVE"),m(h,12,"fmt "),h.setUint32(16,16,!0),h.setUint16(20,1,!0),h.setUint16(22,i,!0),h.setUint32(24,o,!0),h.setUint32(28,o*i*2,!0),h.setUint16(32,2*i,!0),h.setUint16(34,16,!0),m(h,36,"data"),h.setUint32(40,2*u,!0);for(var g=u,f=44,C=0;C<g;C++)h.setInt16(f,32767*s[C],!0),f+=2;if(t)return t({buffer:p,view:h});postMessage({buffer:p,view:h})}if(e.noWorker)s(e,function(e){t(e.buffer,e.view)});else{var i,n,a,o=(i=s,n=URL.createObjectURL(new Blob([i.toString(),";this.onmessage =  function (eee) {"+i.name+"(eee.data);}"],{type:"application/javascript"})),(a=new Worker(n)).workerURL=n,a);o.onmessage=function(e){t(e.data.buffer,e.data.view),URL.revokeObjectURL(o.workerURL),o.terminate()},o.postMessage(e)}}if(!0===a.leftChannel&&(u=1),1===a.numberOfAudioChannels&&(u=1),(!u||u<1)&&(u=2),a.disableLogs||console.log("StereoAudioRecorder is set to record number of channels: "+u),void 0===a.checkForInactiveTracks&&(a.checkForInactiveTracks=!0),this.record=function(){if(!1===p())throw"Please make sure MediaStream is active.";_(),S=y=!1,c=!0,void 0!==a.timeSlice&&M()},this.stop=function(s){s=s||function(){},c=!1,n({desiredSampRate:i,sampleRate:b,numberOfAudioChannels:u,internalInterleavedLength:m,leftBuffers:l,rightBuffers:1===u?[]:d,noWorker:a.noWorker},function(e,t){r.blob=new Blob([t],{type:"audio/wav"}),r.buffer=new ArrayBuffer(t.buffer.byteLength),r.view=t,r.sampleRate=i||b,r.bufferSize=v,r.length=m,S=!1,s&&s(r.blob)})},void 0===h)var h={};void 0===h.Storage&&(h.Storage={AudioContextConstructor:null,AudioContext:window.AudioContext||window.webkitAudioContext}),h.Storage.AudioContextConstructor&&"closed"!==h.Storage.AudioContextConstructor.state||(h.Storage.AudioContextConstructor=new h.Storage.AudioContext);var g=h.Storage.AudioContextConstructor,f=g.createMediaStreamSource(e),C=[0,256,512,1024,2048,4096,8192,16384],v=void 0===a.bufferSize?4096:a.bufferSize;if(-1===C.indexOf(v)&&(a.disableLogs||console.log("Legal values for buffer-size are "+JSON.stringify(C,null,"\t"))),g.createJavaScriptNode)o=g.createJavaScriptNode(v,u,u);else{if(!g.createScriptProcessor)throw"WebAudio API has no support on this browser.";o=g.createScriptProcessor(v,u,u)}f.connect(o),a.bufferSize||(v=o.bufferSize);var b=void 0!==a.sampleRate?a.sampleRate:g.sampleRate||44100;(b<22050||96e3<b)&&(a.disableLogs||console.log("sample-rate must be under range 22050 and 96000.")),a.disableLogs||a.desiredSampRate&&console.log("Desired sample-rate: "+a.desiredSampRate);var y=!1;function _(){l=[],m=0,y=c=S=!(d=[]),g=null,r.leftchannel=l,r.rightchannel=d,r.numberOfAudioChannels=u,r.desiredSampRate=i,r.sampleRate=b,r.recordingLength=m,w={left:[],right:[],recordingLength:0}}function W(){o&&(o.onaudioprocess=null,o.disconnect(),o=null),f&&(f.disconnect(),f=null),_()}this.pause=function(){y=!0},this.resume=function(){if(!1===p())throw"Please make sure MediaStream is active.";if(!c)return a.disableLogs||console.log("Seems recording has been restarted."),void this.record();y=!1},this.clearRecordedData=function(){a.checkForInactiveTracks=!1,c&&this.stop(W),W()},this.name="StereoAudioRecorder";var S=!(this.toString=function(){return this.name});o.onaudioprocess=function(e){if(!y)if(!1===p()&&(a.disableLogs||console.log("MediaStream seems stopped."),o.disconnect(),c=!1),c){S||(S=!0,a.onAudioProcessStarted&&a.onAudioProcessStarted(),a.initCallback&&a.initCallback());var t=e.inputBuffer.getChannelData(0),s=new Float32Array(t);if(l.push(s),2===u){var i=e.inputBuffer.getChannelData(1),n=new Float32Array(i);d.push(n)}m+=v,r.recordingLength=m,void 0!==a.timeSlice&&(w.recordingLength+=v,w.left.push(s),2===u&&w.right.push(n))}else f&&(f.disconnect(),f=null)},g.createMediaStreamDestination?o.connect(g.createMediaStreamDestination()):o.connect(g.destination),this.leftchannel=l,this.rightchannel=d,this.numberOfAudioChannels=u,this.desiredSampRate=i,this.sampleRate=b,r.recordingLength=m;var w={left:[],right:[],recordingLength:0};function M(){c&&"function"==typeof a.ondataavailable&&void 0!==a.timeSlice&&(w.left.length?(n({desiredSampRate:i,sampleRate:b,numberOfAudioChannels:u,internalInterleavedLength:w.recordingLength,leftBuffers:w.left,rightBuffers:1===u?[]:w.right},function(e,t){var s=new Blob([t],{type:"audio/wav"});a.ondataavailable(s),setTimeout(M,a.timeSlice)}),w={left:[],right:[],recordingLength:0}):setTimeout(M,a.timeSlice))}}var hh={AUDIO_ONLY:1,VIDEO_ONLY:2,AUDIO_VIDEO:3,SCREEN:4};function gh(i){return new Promise(function(t,s){navigator.mediaDevices?navigator.mediaDevices.getUserMedia(function(e){var t=!0,s=!0;e==hh.AUDIO_ONLY&&(s=!1);e==hh.VIDEO_ONLY&&(t=!1);return{audio:t,video:s}}(i)).then(function(e){e[i]=e,t(e)}).catch(function(e){s(e)}):s({})})}var fh="NotAllowedError",Ch="NotFoundError",vh="NotReadableError",bh=function(e){function t(){this.recordedchunks=[],this.handledRecordingProgress=this.handledRecordingProgress.bind(this),this.onRecordingEnd=this.onRecordingEnd.bind(this),this.stopRecording=this.stopRecording.bind(this),this.toggleAudioPlay=this.toggleAudioPlay.bind(this),this.updateAudioTime=this.updateAudioTime.bind(this),this.onAudioPlayBackEnd=this.onAudioPlayBackEnd.bind(this),this.seekRecordedAudio=this.seekRecordedAudio.bind(this),this.sendRecording=this.sendRecording.bind(this),this.maxduration=9e5,this.state={recordingstate:"recording",recordedtime:0,audiostate:"paused",audiocurrenttime:0,uploadprogress:!1}}return t.__proto__=e,((t.prototype=Object.create(e.prototype)).constructor=t).prototype.componentDidMount=function(){this.checkAndInitVoiceRecording()},t.prototype.componentWillUnmount=function(){this.safelyUnmountComponent()},t.prototype.bindAudioEvents=function(){this.audionode.ontimeupdate=this.updateAudioTime,this.audionode.onended=this.onAudioPlayBackEnd},t.prototype.startRecording=function(){this.mediarecorder.record()},t.prototype.stopRecording=function(){this.mediarecorder.stop(this.onRecordingEnd)},t.prototype.getConfig=function(){return{type:"",mimeType:"audio/wav",disableLogs:!0,numberOfAudioChannels:2,timeSlice:1e3,ondataavailable:this.handledRecordingProgress,checkForInactiveTracks:!0}},t.prototype.checkAndInitVoiceRecording=function(){gh(hh.AUDIO_ONLY).then(function(e){this.mediarecorder=new ph(e,this.getConfig()),this.startRecording(),this.recordingstarttime=new Date,this.current_voice_stream=e,this.autoendrecordingtimer=setTimeout(this.stopRecording.bind(this),this.maxduration)}.bind(this)).catch(function(e){var t="";if("string"==typeof e)rn($WC.I18N("voicerecorder.common.error"));else if(e.name==fh)t=".permission.notallowed";else{if(e.name!=Ch&&e.name!==vh)return void 0!==e.code&&void 0!==e.message&&rn(e.message),void this.props.unmountComponent();t=".notfound"}this.props.params.errorCallBack(e,t),this.props.unmountComponent()}.bind(this))},t.prototype.handledRecordingProgress=function(){var e=new Date-this.recordingstarttime;this.updateProgessTime(e)},t.prototype.updateProgessTime=function(e){this.setState({recordedtime:e/1e3})},t.prototype.updateBlobData=function(e){this.audioblob=e},t.prototype.onRecordingEnd=function(e){this.updateBlobData(e),this.createAudioNode(),this.bindAudioEvents(),this.closeStream(),Sh==this&&Mh(),clearTimeout(this.autoendrecordingtimer),this.setState({recordingstate:"ended"})},t.prototype.createAudioNode=function(){this.audionode=new Audio,this.audionode.src=this.getBlobUrl()},t.prototype.getBlobUrl=function(){return window.URL.createObjectURL(this.audioblob)},t.prototype.closeStream=function(){this.current_voice_stream.getTracks().forEach(function(e){e.stop()})},t.prototype.updateAudioTime=function(){this.setState({audiocurrenttime:this.audionode.currentTime})},t.prototype.playRecordedAudio=function(){this.audionode.play(),this.setState({audiostate:"playing"})},t.prototype.pauseRecordedAudio=function(){this.audionode.pause(),this.setState({audiostate:"paused"})},t.prototype.toggleAudioPlay=function(){"playing"==this.state.audiostate?this.pauseRecordedAudio():this.playRecordedAudio()},t.prototype.seekRecordedAudio=function(e){this.audionode.currentTime=e,this.setState({audiocurrenttime:e})},t.prototype.onAudioPlayBackEnd=function(){this.audiocurrenttime=0,this.setState({audiostate:"paused",audiocurrenttime:0})},t.prototype.getUploadCallBackObj=function(){return{successCallBack:this.successCallBack.bind(this),errorCallBack:this.errorCallBack.bind(this),uploadCancelCallBack:this.errorCallBack.bind(this)}},t.prototype.sendRecording=function(){var e=this.getRecordingAsAFile(this.generateFileName());e.duration=Math.round(this.state.recordedtime),this.props.params.fileuploadCallBack(e,this.getUploadCallBackObj()),this.setUploadProgressStatus(!0)},t.prototype.successCallBack=function(){this.setUploadProgressStatus(!1),this.props.unmountComponent()},t.prototype.errorCallBack=function(){this.setUploadProgressStatus(!1)},t.prototype.setUploadProgressStatus=function(e){this.setState({uploadprogress:e})},t.prototype.getRecordingAsAFile=function(e){return new File([this.audioblob],e+".wav",{type:"audio/wav"})},t.prototype.generateFileName=function(){return"voice-message-"+se(new Date,"dd-MM-yyyy").trim()+"-"+oe(new Date)},t.prototype.safelyUnmountComponent=function(){"recording"==this.state.recordingstate&&this.mediarecorder&&this.stopRecording(),"playing"==this.state.audiostate&&this.pauseRecordedAudio(),this.audionode&&(this.audionode.srcObject=null,this.audionode.src=null,this.audionode.removeAttribute("src")),Mh()},t.prototype.render=function(e,t){var s=null,i=null,n=null,a=null,o=null,r=null,l=null;if("recording"==t.recordingstate&&(a=k("div",{class:rh}),n=k("div",{class:oh},ni(Math.floor(t.recordedtime))),s=k(R,{classname:ih,type:"button",content:$("voicerecorder.stop"),onclick:this.stopRecording}),i=k(yh,{type:t.recordingstate,recordedtime:t.recordedtime,totaltime:this.maxduration})),"ended"==t.recordingstate){var d="",c=$("voicerecorder.send");t.uploadprogress&&(d=uh,c=""),s=k(R,{classname:nh+" "+d,type:"button",content:c,onclick:this.sendRecording}),o=k(R,{onclick:e.params.closeCallBack,classname:sh,type:"icon",content:"e9ee"}),r=k("div",{class:oh},ni(Math.floor(t.audiocurrenttime)));var m=isFinite(this.audionode.duration)?this.audionode.duration:t.recordedtime;i=k("div",{class:mh},k(Pn,{videostate:t.recordingstate,duration:m,current_time:t.audiocurrenttime,bufferpercentage:1,updateCurrentTime:this.seekRecordedAudio,isvoicerecorder:!0}));var u="playing"==t.audiostate?"ea12":"ea1b",p="playing"==t.audiostate?ch:dh;l=k(R,{onclick:this.toggleAudioPlay,type:"icon",content:u,classname:p})}return k("div",{class:th},a,n,l,i,r,o,s)},t}(M);function yh(e){var t="recording"==e.type?k("div",{class:lh,style:"transform : scaleX("+e.recordedtime/(e.totaltime/1e3)+")"}):null;return k("div",{class:ah},t)}function _h(){this.unmountComponent=this.unmountComponent.bind(this)}_h.prototype.mountComponent=function(e,t){var s;this.node=e,s=t.sessionid,Wh=!0,function(e){wh=e}(s),this.unmountCallBack=t.unmountCallBack,O(k(bh,{ref:Ih,params:t,unmountComponent:this.unmountComponent}),e)};var Wh=!(_h.prototype.unmountComponent=function(){this.unmountCallBack(),O("",this.node),Fi(this.node),this.node=null}),Sh=null,wh="";function Mh(){Wh=!1,wh=""}function Ih(e){Sh=e}function Th(){}var Ah=Object.freeze({__proto__:null,VoiceRecorderView:bh,VoiceRecorder:_h,isVoiceRecordingActive:function(){return Wh},closeAndRemoveRecordingSession:function(){Sh&&Sh.props.unmountComponent(),Mh()},getActiveSessionId:function(){return wh}}),Eh={listContainer:"mcada69762_listContainer",listContainerHeader:"mcada69762_listContainerHeader",listContainerWrapper:"mcada69762_listContainerWrapper",listContainerClose:"mcada69762_listContainerClose",listContainerHeaderTitle:"mcada69762_listContainerHeaderTitle",imgwrapper:"mcada69762_imgwrapper",flexcontainer:"mcada69762_flexcontainer",recent_convo:"mcada69762_recent_convo",infowrapper:"mcada69762_infowrapper",infoheaderwrapper:"mcada69762_infoheaderwrapper",wms_profileinfo_text:"mcada69762_wms_profileinfo_text",transcriptwrapper:"mcada69762_transcriptwrapper",transcriptcontainer:"mcada69762_transcriptcontainer",infotextwrapper:"mcada69762_infotextwrapper",permalink:"mcada69762_permalink",joinchannel:"mcada69762_joinchannel","wms-msgfrag":"wms-msgfrag","wms-msg":"wms-msg","wms-replymsgwrapper":"wms-replymsgwrapper",wms_forwardmsgwrapper:"wms_forwardmsgwrapper",wms_channelimg_badge:"wms_channelimg_badge",wms_badge_imgwrapper:"wms_badge_imgwrapper",listheaderwrapper:"mcada69762_listheaderwrapper",timeseparatorwrapper:"mcada69762_timeseparatorwrapper",timeseparator:"mcada69762_timeseparator",wms_channelimg:"wms_channelimg","wms-imgmsgcontainer":"wms-imgmsgcontainer",zmNightMode:"zmNightMode"},Uh=function(t){function e(e){t.call(this,e),this.handleJoinChannel=this.handleJoinChannel.bind(this),this.setContentNode=this.setContentNode.bind(this),this.contentNode=null}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.setContentNode=function(e){this.contentNode=e},e.prototype.handleJoinChannel=function(){this.props.actionCallbacks.handleJoinChannel(this.props.channeldata.chid),this.props.removeComponent()},e.prototype.handleScroll=function(){this.props.actionCallbacks.handleLoadImages(this.contentNode)},e.prototype.componentDidMount=function(){this.contentNode.scrollTop=this.contentNode.scrollHeight-this.contentNode.clientHeight,this.props.actionCallbacks.handleLoadImages(this.contentNode)},e.prototype.render=function(){var e=Dr(this.props.channeldata,!0),t="";if(bi(this.props.channeldata.scid_name)){var s=[];for(var i in this.props.channeldata.scid_name)s.push(this.props.channeldata.scid_name[i]);t=s.join(", ")}var n=k("span",null,k("span",{dangerouslySetInnerHTML:{__html:$(t?"channel.preview.creatorteam":"channel.preview.creator",['<span data-zcprofileid="'+this.props.channeldata.cr+'" class="'+Eh.wms_profileinfo_text+'">'+mi(this.props.channeldata.cr_n)+"</span>",mi(t)])}}),k("span",{class:Eh.timeseparatorwrapper},k("span",{class:Eh.timeseparator}),k("span",null,le(this.props.channeldata.ctime,{shorten:!1})))),a=this.props.channeldata.cd?"":"wms-valign-mid-block",o=k("div",{class:Eh.listheaderwrapper},k("div",null,k("div",{class:Eh.listContainerHeaderTitle},$("channel.preview.details")),k("div",{class:Eh.flexcontainer},k("div",{class:Eh.imgwrapper,dangerouslySetInnerHTML:{__html:e}}),k("div",{class:Eh.infowrapper},k("div",{class:Eh.infoheaderwrapper},k("div",{onclick:this.props.actionCallbacks.handleCopyLink.bind(this,this.props.channeldata.un),class:Eh.permalink}),k("div",{class:a},this.props.channeldata.dn),k("div",null,this.props.channeldata.cd)),k("div",{class:Eh.infotextwrapper},k("div",{"data-zcprofileid":this.props.channeldata.cr,onclick:this.props.actionCallbacks.handleProfileInfo.bind(this),class:Eh.infotext},n),k(R,{type:"button",tabindex:"0",content:$("channel.preview.join"),onclick:this.handleJoinChannel,classname:Eh.joinchannel})))),k("div",{class:Eh.recent_convo},$("channel.recent.convo"))),k("div",{class:Eh.transcriptwrapper},k("div",{onScroll:this.handleScroll.bind(this),ref:this.setContentNode,class:Eh.transcriptcontainer,dangerouslySetInnerHTML:{__html:this.props.transcript}}))),r={customButtonStyle:Eh.listContainerClose,customContainerStyle:Eh.listContainer,customHeaderStyle:Eh.listContainerHeader,customWrapperStyle:Eh.listContainerWrapper};return k(et,{heading:o,callbackOnClose:this.props.removeComponent,customDialogStyles:r})},e}(M);Th.prototype.mountComponent=function(e,t,s){this.node=document.createElement("div"),document.body.appendChild(this.node),O(k(Uh,{removeComponent:this.unmountComponent.bind(this),channeldata:e,transcript:t,actionCallbacks:s}),this.node)},Th.prototype.unmountComponent=function(){O("",this.node),Fi(this.node)};function xh(){this.unmountComponent=this.unmountComponent.bind(this),this.isCachedRequest=this.isCachedRequest.bind(this),this.storeDetails=this.storeDetails.bind(this),this.retrieveDetails=this.retrieveDetails.bind(this),this.handleDocumentClick=this.handleDocumentClick.bind(this),this.profileinfo={}}var Nh="mc5ef447f3_profileinfowrapper",kh="mc5ef447f3_profileinfocontainer",Oh="mc5ef447f3_hv_align",Rh="mc5ef447f3_loading",Hh="mc5ef447f3_imgcontainer",$h="mc5ef447f3_infocontainer",Dh="mc5ef447f3_basicinfowrapper",Lh="mc5ef447f3_boldinfo",Ph="mc5ef447f3_basicinfo",Bh="mc5ef447f3_checkinstatusin",jh="mc5ef447f3_checkinstatusout",Fh="mc5ef447f3_addinfo",zh="mc5ef447f3_workinfo",Gh="mc5ef447f3_workinfo_item",qh="mc5ef447f3_contactinfo_item",Yh="mc5ef447f3_infolabel",Vh="mc5ef447f3_contactinfo",Zh="mc5ef447f3_contactinfo_header",Kh="mc5ef447f3_timezone",Xh="mc5ef447f3_options",Jh="mc5ef447f3_optionsicon",Qh="mc5ef447f3_startchat",eg="mc5ef447f3_audiocall",tg="mc5ef447f3_videocall",sg="mc5ef447f3_deletecontact",ig="mc5ef447f3_profileinfo_blur",ng="mc5ef447f3_ellipsis",ag="mc5ef447f3_badge_img_cutout",og="mc5ef447f3_halign",rg="mc5ef447f3_custombot_info",lg="mc5ef447f3_boticon",dg="mc5ef447f3_inviteopr",cg=function(t){function e(e){t.call(this,e),this.state={details:{},errorstate:!1},this.profileid=this.props.profileid||this.props.targetnode.getAttribute("data-zcprofileid"),this.profilecontainer=null,this.canvasnode=null,this.imgsrcnode=null,this.imgloadernode=null,this.setProfileContainer=this.setProfileContainer.bind(this),this.initiateProfileActions=this.initiateProfileActions.bind(this),this.setCanvasNode=this.setCanvasNode.bind(this),this.setImgNode=this.setImgNode.bind(this),this.setImgLoader=this.setImgLoader.bind(this),this.hideComponent=this.hideComponent.bind(this),this.CONTAINER_WIDTH=350,this.CONTAINER_HEIGHT=180}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.setProfileContainer=function(e){this.profilecontainer=e},e.prototype.setCanvasNode=function(e){this.canvasnode=e},e.prototype.setImgNode=function(e){this.imgsrcnode=e},e.prototype.setImgLoader=function(e){this.imgloadernode=e},e.prototype.componentDidMount=function(){ki(this.props.targetnode,this.profilecontainer.parentNode)},e.prototype.componentDidUpdate=function(){ki(this.props.targetnode,this.profilecontainer.parentNode),this.profilecontainer.parentNode.focus(),this.setImageAspectRatio(this.imgsrcnode,this.imgsrcnode.width,this.imgsrcnode.height)},e.prototype.componentWillMount=function(){ri(this.state.details)&&this.fetchUserDetails()},e.prototype.defaultImgLoad=function(){this.imgsrcnode&&(this.setImageAspectRatio(this.imgsrcnode,this.imgsrcnode.width,this.imgsrcnode.height),this.imgloadernode.style.display="none")},e.prototype.hideComponent=function(e){var t=Ei(e);(t=t.closest('[id="profileinfo_wrapper"]'))!==(e.relatedTarget&&e.relatedTarget.closest('[id="profileinfo_wrapper"]'))&&this.props.removeComponent()},e.prototype.initiateProfileActions=function(e){var t=Ei(e),s=t.getAttribute("data-operation");"startchat"===s?this.props.startChatCallback(t,this.profileid):"audiocall"===s?this.props.startAudioCallCallback(this.profileid):"videocall"===s?this.props.startVideoCallCallback(this.profileid):"deletecontact"!==s&&"invite"!==s||this.props.handleProfileActionsCallback(t,this.profileid)},e.prototype.fetchUserDetails=function(){if(qt(this.profileid)){var e=Bt(this.profileid),t={name:e.DNAME,email_id:e.STATUSMSG,unique_name:e.UNIQUENAME};this.setState({details:t})}else if(this.props.isCachedRequest&&this.props.isCachedRequest(this.profileid))this.setState({details:this.props.retrieveDetails(this.profileid)});else{var i=this,s=function(e){var t="object"==typeof e?e:JSON.parse(e).data;this.setState({details:t,errorstate:!1}),this.props.storeDetails&&this.props.storeDetails(this.profileid,t)}.bind(this),n=H.get("profileinfo");"function"==typeof n?WmsImplHandler.invokeSynchronously(n,this.profileid,s):Ie("v2/users/"+this.profileid,"fields="+encodeURIComponent("all,checkin_status"),s,function(){if(this.response){var e=JSON.parse(this.response).code,t="";"operation_failed"===e?t="contact.profileinfo.notfound":"operation_not_allowed"===e&&(t="contact.profileinfo.notallowed");var s={email_id:$(t)};i.setState({details:s,errorstate:!0})}})}},e.prototype.isPeopleInfoAvailable=function(){return!(!this.state.details||null==this.state.details.checkin_status)},e.prototype.getClonedImgsrc=function(){var e=H.get("photoserver")+"/file?ID="+this.profileid+"&t=user&height=50&width=50&exp=6000",t=H.get("photoserver")+"/file?ID="+this.profileid+"&t=user&exp=6000&fs=original";qt(this.profileid)&&(e=Ft(this.profileid),t=Ft(this.profileid));var s=new Image;return s.onload=function(){this.imgsrcnode&&(this.imgsrcnode.setAttribute("src",t),this.setImageAspectRatio(this.imgsrcnode,this.imgsrcnode.width,this.imgsrcnode.height))}.bind(this),s.src=t,e},e.prototype.setImageAspectRatio=function(e,t,s){e.style.width="auto",e.style.height="auto",this.setImagePosition(e,t,s)},e.prototype.setImagePosition=function(e,t,s){var i=this.CONTAINER_WIDTH,n=this.CONTAINER_HEIGHT,a=this.getAspectRatioFit(e.width,e.height,i,n,!0);i<t&&n-40<s&&(e.style.height="100%"),t<i&&s<n-40&&(e.style=""),i<t&&s<n-40&&(e.style.height="100%"),t<i&&n-40<s&&(e.style="",e.style.height="100%"),this.populateBlurBgImage(e,"",a)},e.prototype.getAspectRatioFit=function(e,t,s,i,n){var a=[s/e,i/t];return a=Math.min(a[0],a[1]),!n&&1<a?{width:e,height:t}:{width:e*a,height:t*a,ratio:a}},e.prototype.populateBlurBgImage=function(e,t,s){var i=this.CONTAINER_WIDTH-s.width,n=this.CONTAINER_HEIGHT-s.height;if(0!=i||0!=n){var a=this.canvasnode,o=s.width/s.ratio,r=s.height/s.ratio;if(0<i&&a){var l=i/10;a.getContext("2d").drawImage(e,0,0,l,r,0,0,i/2,this.CONTAINER_WIDTH),a.getContext("2d").drawImage(e,i/2,0,s.width,this.CONTAINER_HEIGHT),a.getContext("2d").drawImage(e,o-l,0,l,r,s.width+i/2,0,i/2,this.CONTAINER_HEIGHT)}else if(0<n&&a){var d=n/10;a.getContext("2d").drawImage(e,0,0,o,d,0,0,this.CONTAINER_WIDTH,n/2),a.getContext("2d").drawImage(e,0,n/2,this.CONTAINER_WIDTH,s.height),a.getContext("2d").drawImage(e,0,r-d,o,d,0,s.height+n/2,this.CONTAINER_WIDTH,n/2)}}},e.prototype.render=function(){var e=k("div",{class:Rh+" "+Oh});if(!ri(this.state.details)){var t="",s="";this.isPeopleInfoAvailable()&&(t=!0===this.state.details.checkin_status?(s=this.state.details.checkin_status_text?mi(this.state.details.checkin_status_text):$("status.in"),k("span",{class:Bh},s)):(s=this.state.details.checkin_status_text?mi(this.state.details.checkin_status_text):$("status.out"),k("span",{class:jh},s)));var i="",n="",a="",o="",r="",l="",d="",c="",m="";if(Ai(this.profileid)||qt(this.profileid)||vs(this.profileid)!=He.CONTACTSTATUS.REMOVE&&ys(this.profileid)||(m=k("div",{onclick:this.initiateProfileActions,"data-operation":"invite",class:og+" "+dg},$("contact.profileinfo.invite"))),qt(this.profileid)){var u="/api/v1/bots/"+Ni(this.state.details.unique_name)+"/message";c=k("div",{class:og},k("div",{class:rg},$("bot.custom.info")),k("span",null,u))}this.state.details.department&&this.state.details.department.name&&(o=k("span",{class:Gh},this.state.details.department.name)),this.state.details.designation&&this.state.details.designation.name&&(r=k("span",{class:Gh},this.state.details.designation.name));var p=vs(this.profileid)!=He.CONTACTSTATUS.REQACC&&vs(this.profileid)!=He.CONTACTSTATUS.UNAPRD&&vs(this.profileid)!=He.CONTACTSTATUS.REMOVE&&ys(this.profileid)?k("div",{class:Jh+" "+sg,"data-operation":"deletecontact"}):"";if("inactive"===this.state.details.status)l=k("div",{class:qh},k("span",{class:Yh},$("contact.info.country")+" : "),k("span",{class:Vh},this.state.details.country)),d=k("div",{class:Xh,onclick:this.initiateProfileActions},k("div",{class:Jh+" "+Qh,"data-type":He.HYBRIDSEARCH.CONTACT,"data-id":this.profileid,"data-operation":"startchat"}),p);else if(!Ai(this.profileid)&&!1===this.state.errorstate){var h=qt(this.profileid)||H.get("_WMSDISABLEAVCHAT")?"":k("div",null,k("div",{class:Jh+" "+eg,"data-operation":"audiocall"}),k("div",{class:Jh+" "+tg,"data-operation":"videocall"}));d=k("div",{class:Xh,onclick:this.initiateProfileActions},k("div",{class:Jh+" "+Qh,"data-type":He.HYBRIDSEARCH.CONTACT,"data-id":this.profileid,"data-operation":"startchat"}),h,p)}this.state.details.mobile&&(i=k("div",{class:qh},k("span",{class:Yh},$("contact.info.mobile")+" : "),k("span",{class:Vh},this.state.details.mobile))),this.state.details.extension&&(n=k("div",{class:qh},k("span",{class:Yh},$("contact.info.extension")+" : "),k("span",{class:Vh},this.state.details.extension))),this.state.details.phone&&(a=k("div",{class:qh},k("span",{class:Yh},$("contact.info.workphone")+" : "),k("span",{class:Vh},this.state.details.phone)));var g=ys(this.profileid)?"wms_badge_statusicon_"+bs(this.profileid,null,Cs(this.profileid))+" "+ag:"",f=qt(this.profileid)||this.state.errorstate||!this.state.details.timeoffset?"":k("span",{class:Kh},ae(this.state.details.timezone,this.state.details.timeoffset)),C=qt(this.profileid)?Dh+" "+og:Dh,v=qt(this.profileid)?Ph+" "+og+" "+lg:this.state.errorstate?Ph+" "+og:Ph,b=Ai(this.profileid)?$("chat.you"):this.state.details.name,y=qt(this.profileid)?this.state.details.email_id:k("a",{href:"mailto:"+this.state.details.email_id},this.state.details.email_id);e=k("div",{id:"wms_contactdetails"},k("div",{class:Hh},k("canvas",{ref:this.setCanvasNode,imgsrc:this.getClonedImgsrc(),class:ig}),k("img",{onLoad:this.defaultImgLoad.bind(this),src:this.getClonedImgsrc(),ref:this.setImgNode,class:Oh}),k("div",{ref:this.setImgLoader,class:Rh+" "+Oh}),f),k("div",{class:$h},k("div",{class:C},k("span",{class:g}),k("span",{class:Lh},k("span",{title:b,class:ng}," ",b," ")),t),k("div",{class:v},k("div",{title:this.state.details.email_id,class:ng},y)),k("div",{class:Fh},k("div",{class:zh},o,r,c),k("div",{class:Zh},i,n,a,l)),d),m)}return k("div",{onMouseOut:this.hideComponent,ref:this.setProfileContainer,class:kh},e)},e}(M);xh.prototype.isCachedRequest=function(e){if(this.profileinfo[e])return this.profileinfo[e]},xh.prototype.storeDetails=function(e,t){this.profileinfo[e]=t},xh.prototype.retrieveDetails=function(e){return this.profileinfo[e]},xh.prototype.handleDocumentClick=function(e){if(document.getElementById("profileinfo_wrapper")){var t=Ei(e),s=t.getAttribute("data-zcprofileid");if(t.closest('[id="profileinfo_wrapper"]')||s===document.getElementById("profileinfo_wrapper").getAttribute("data-zcprofileid"))return;this.unmountComponent()}},xh.prototype.mountComponent=function(e,t,s,i,n,a){t=t||e.getAttribute("data-zcprofileid"),this.unmountComponent(document.getElementById("profileinfo_wrapper")),this.node=document.createElement("div"),this.node.id="profileinfo_wrapper",this.node.className=Nh,void 0!==WebMessanger&&(WebMessanger.isDarkModeEnabled&&(this.node.className+=" zmNightMode"),"function"==typeof WebMessanger.isDNDBackupIconEnabled&&WebMessanger.isDNDBackupIconEnabled()&&(this.node.className+=" wms_dnd_backup_icon")),this.node.style.zIndex=H.get("zindex"),this.node.setAttribute("tabIndex","0"),this.node.setAttribute("data-zcprofileid",t),document.body.appendChild(this.node),O(k(cg,{removeComponent:this.unmountComponent,targetnode:e,profileid:t,startChatCallback:s,startAudioCallCallback:i,startVideoCallCallback:n,handleProfileActionsCallback:a,isCachedRequest:this.isCachedRequest,storeDetails:this.storeDetails,retrieveDetails:this.retrieveDetails}),this.node)},xh.prototype.unmountComponent=function(){document.getElementById("profileinfo_wrapper")&&(O("",this.node),Fi(this.node))};var mg,ug={PERCENTAGECHART:"percentage_chart",GRAPH:"graph",PIE:"pie",DOUGHNUT:"doughnut",SEMIDOUGHNUT:"semi_doughnut",SLIDERHEIGHT:38,SLIDERWIDTH:200,BARCHART_SLIDERWIDTH:198,TRENDS_SLIDERWIDTH:196,LEGENDCOLORS:["#DD1B51","#FEB935","#722A99","#C8D74F","#2A98F0","#FF5C00","#2064B6","#4CB271","#FF4F99","#72DDFF","#137FA0","#FCA9DE","#2EC246","#AF60FF","#FF8A00","#9B1D43","#28CBC3","#F86C84","#394666","#D0A6A3"],CENTERVAL:50,CIRCLEVALUE:360,SEMICIRCLE:180,CIRCLERADIUS:40,GRAPHSPACINGTOP:.05,GRAPHSPACINGBOTTOM:.2,GRAPHSPACINGLEFT:.25,GRAPHSPACINGRIGHT:.05,GRAPHPREVIEWSPACINGBOTTOM:.25,GRAPHPREVIEWSPACINGLEFT:.25},pg={previewSlider:'<div class="zcq-slider-cont zcq-flexC fjustifyE"><div class="charts-navi-label zcq-font14 zcq-mR10 ">Navigator</div><div id="zcc-charts-navigator" class="zcq-charts-navigator"><div class="zcq-charts-slider" id="zcc-preview-slider"><div class="zcq-slider-dragpoints zcq-dragleft" id="zcc-left-dragpoint" data-purpose="resizing"></div><div class="zcq-slider-dragpoints zcq-dragright" id="zcc-right-dragpoint" data-purpose="resizing"></div></div><div id="zcc-slider-wrapper" class="zcq-chart-preview-wrapper"></div><div id="zcc-slider-wrapper1" class="zcq-chart-preview-wrapper"></div><div id="zcc-sliderpreviewcont"><svg class="zcq-charts-slider-preview">{{SILDER_HTML}}</svg></div></div></div>',barChartHtml:'<rect class="zcq-curP" data-action="{{ACTION}}" x={{xVal}} y={{yVal}} width={{barWidth}} height={{barHeight}} style="fill:{{color}};" data-value="{{currentVal}}" data-label="{{currentLabel}}" data-category="{{category}}"></rect>',trendsChartDotHtml:'<circle data-action="{{ACTION}}" cx={{x}} cy={{y}} r={{trendsCircleVal}} style="fill:{{color}};" data-value="{{currentVal}}" data-label="{{currentLabel}}" data-category="{{category}}"></circle>',trendsChartPathHtml:'<path d="{{distStr}}" style="stroke:{{color}};fill:none;"></path>',legendHtml:'<div class="zcq-legend-card" status="on" data-category="{{category}}" data-action = "chartLegendclick"><span class="zcq-legend-card-fill" style="background-color:{{legendColor}};"></span><span class="zcq-legend-card-text">{{category}}</span></div>',legendParentHtml:'<div class="zcq-legend-cont zcq-p10  zcq-trends" id="zcc-legends">{{legendHtml}}</div>',pieChartsLegendHtml:'<div class="zcq-legend-card" data-label="{{label}}" legendId={{legengId}} legendValue={{legendVal}} status="on" data-action="legendclick"><span class="zcq-legend-card-fill" style="background-color:{{legendColor}};"></span><span class="">{{label}}</span></div>',graphChartContHtml:"<div>{{GRAPHBODYHTML}}{{LEGENDHTML}}</div>{{PREVIEWBTN_HTML}}",previewBtnHtml:'<div class="zcq-textR zcq-chart-preview-btn" > <div class="zcq-zcl-btn-sm  zcq-zcl-btn--secondary">Preview</div>',graphBodyHtml:'<div class="zcq-curP" id="zcc-graphChartCont">{{SLIDER_PREVIEW}}<div class="zcq-trends-cont {{PREVIEW_CLASS}}" id="zcc-svg-cont"><svg  height="100%" width="100%" {{VIEWBOX_ATTRIBUTE}}>{{GRAPH_AXIS}}{{GRAPH_POINTS}}</svg></div></div>',chartsToolTipContHtml:'<div class="zcq-svgtooltip" id="zcc-charttooltip"></div>',graphSvgHtml:'<svg  height="100%" width="100%" {{VIEWBOX_ATTRIBUTE}} class="{{VISIBILITY_CLASS}}">{{GRAPH_AXIS}}{{GRAPH_POINTS}}</svg>',axisTitleHtml:'<text class="zcq-axistitle {{visiblityCls}}" x={{xVal}} y={{yVal}} transform="{{trasnformVal}}">{{axisTitle}}</text>',pieChartContHtml:'<div class="zcq-flexC"><div class="zcq-preview zcq-svgchart-cont" id="zcc-svg-cont">{{CHARTBODY_HTML}}</div>{{LEGEND_HTML}}</div>{{PREVIEWBTN_HTML}}',pieChartBodyHtml:'<svg viewBox="{{viewBoxSize}}" id="{{ID}}" style="transform: rotate({{rotationDeg}}deg);position: relative;" height="100%" width="100%">{{CHART_HTML}}{{CENTER_CIRCLE_HTML}}</svg>',pieChartsLegendContHtml:'<div class="zcq-legend-cont zcq-p10 " id="zcc-legends">{{LEGEND_HTML}}</div>',pieChartCenterCircleHtml:"<circle cx="+ug.CENTERVAL+" cy="+ug.CENTERVAL+' r="2" style="fill:var(--default-bg-color, #15202B);"></circle>',doughnutCenterCircleHtml:"<circle cx="+ug.CENTERVAL+" cy="+ug.CENTERVAL+' r="20" style="fill:var(--default-bg-color, #15202B);" clip-path="{{CLIPPATH}}"></circle><circle cx='+ug.CENTERVAL+" cy="+ug.CENTERVAL+' r="10" style="fill:var(--color-hover2, #F1F4F7);" clip-path="{{CLIPPATH}}"></circle>',semiDoughnutDefinitionHtml:'<defs> <clipPath id="zcc-cut-off-bottom"> <rect x="0" y="49" width="100" height="50"> </rect> </clipPath> </defs>',percentageChartPathHtml:'<path data-action="{{ACTION}}" class="zcq-chart-path" d="M {{CENTERVAL}} {{CENTERVAL}} L {{FROMCOORDX}} , {{FROMCOORDY}} A {{RADIUS}} ,{{RADIUS}} {{ARCVAL}} {{TOCOORDX}}, {{TOCOORDY}} z" data-label="{{LABEL}}" data-value={{VALUE}} normal-val={{NORMALVAL}} style="fill:{{LEGENDCOLOR}}" legendId={{LEGENDID}}></path>',percentageChartPathCircleHtml:'<circle data-action="{{ACTION}}" cx={{CENTERVAL}} cy={{CENTERVAL}} r={{RADIUS}} style="fill:{{LEGENDCOLOR}}" data-label="{{LABEL}}" data-value={{VALUE}}></circle>',percentageChartCustomTooltip:'<div class="zcq-font14"><div class="zcq-mT2">{{LABELTITLE}} : {{LABEL}}</div><div class="zcq-mT2">{{VALUETITLE}} : {{VALUE}}</div><div class="zcq-mT2">{{PERCENTAGE_TXT}} : {{PERCENTAGEVAL}}</div></div>',graphCustomTooltip:'<div class="zcq-font14"><div class="zcq-mT2">{{LABELTITLE}} : {{LABEL}}</div><div class="zcq-mT2">{{VALUETITLE}} : {{VALUE}}</div><div class="zcq-mT2">{{CATEGORY_TXT}} : {{CATEGORY}}</div>{{PERCENTAGE_HTML}}</div>',trendMultiPointsTooltip:'<div class="zcq-flexC zcq-mT2"><span class="zcq-graphtooltip" style="background-color:{{COLOR}};"></span><span class="zcq-mL5">{{CATEGORY}} - </span><span class="zcq-mL5 zcq-fontB">{{VALUE}} </span></div>',graphAxisLine:'<line class="zcq-outer-axis" x1={{FIRST_X}} y1={{FIRST_Y}} x2={{SECOND_X}} y2={{SECOND_Y}}></line>',grpahAxisCont:'<g class="" id="{{ID}}">{{AXISLINE}}{{AXISTITLE}}{{AXISVALUES}}</g>',graphYAxisValueLine:'<line class="zcq-axisvalueline" x1={{XPOSITION}} y1={{YPOSITION}} x2={{XSTARTPOINT}} y2={{YPOSITION}}></line><line class="zcq-inner-axis" x1={{XSTARTPOINT}} y1={{YPOSITION}} x2={{XENDPOINT}} y2={{YPOSITION}}></line><text class="zcq-axisvalue" x={{XPOSITION}} y={{YPOSITION}} dx={{TEXTXPOSITION}} title={{TOOLTIPVALUE}}>{{XAXISVALUE}}</text>',graphXAxisValueLine:'<line class="zcq-axisvalueline" x1={{XPOSITION}} y1={{YPOSITION}} x2={{XPOSITION}} y2={{YENDPOINT}} data-label="{{LABEL}}" data-xaxisline></line><text class="zcq-axisvalue" x={{XPOSITION}} y={{TEXTYPOSITION}}  transform="{{TRASNFORMVAL}}" xaxislabel>{{AXIS_LABEL}}</text>'};function hg(e,t,s){return function(e,t,s){var i,n;Mg=e,Eg=t,Rg=s.isWidgetChart,xg=s.widgetChartId,n=Rg?document.querySelector('[element_id="'+xg+'"]'):document.getElementById("zcc-previewchart");i=n.querySelector("#zcc-charts-navigator"),wg=n.querySelector("#zcc-preview-slider").offsetWidth,Ag=wg,Ug=t/e*Og,i.addEventListener("mousemove",function(e){!function(e){var t=e.pageX-Wg;e.preventDefault(),Hg(e.target),Ng?function(e){var t,s,i=mg.parentElement,n=i.style.marginLeft;switch(n=""===n?0:parseInt(n),mg.getAttribute("id")){case"zcc-right-dragpoint":t=Ag+e,s=n;break;case"zcc-left-dragpoint":t=Ag-e,s=n+e}var a=i.parentElement.offsetWidth;if(t<=Ug)return;s<0&&(t+=s,s=0);t<0&&(t=0,s=i.style.marginLeft);a<s+t&&(t=a-s);var o,r=t+s,l=wg-r;i.style.cssText="margin-left: "+s+"px; width: "+t+"px",o=Rg?document.querySelector('[element_id="'+xg+'"]'):document.getElementById("zcc-previewchart");o.querySelector("#zcc-slider-wrapper").style.width=s+"px",o.querySelector("#zcc-slider-wrapper1").style.cssText="margin-left: "+r+"px; width: "+l+"px",Ig=Math.floor(s/Eg*Mg),(Tg=Math.floor(r/Eg*Mg))>Mg&&(Tg=Mg-1);Ag=t,af(Ig,Tg)}(t):kg&&function(e){var t=Sg.offsetWidth,s=Sg.parentElement.offsetWidth,i=Sg.style.marginLeft,n=(i=""===i?0:parseInt(i))+e;n<0&&(n=0);s<n+t&&(n=s-t);var a,o=t+n,r=wg-o;Sg.style.marginLeft=n+"px",a=Rg?document.querySelector('[element_id="'+xg+'"]'):document.getElementById("zcc-previewchart");a.querySelector("#zcc-slider-wrapper").style.width=n+"px",a.querySelector("#zcc-slider-wrapper1").style.cssText="margin-left: "+o+"px; width: "+r+"px",Ig=Math.floor(n/Eg*Mg),Tg=Math.floor(o/Eg*Mg),af(Ig,Tg)}(t);Wg=e.pageX}(e)}),i.addEventListener("mouseup",function(e){Ng=kg=!1}),i.addEventListener("mouseleave",function(e){Ng=kg=!1}),i.querySelector("#zcc-preview-slider").addEventListener("mousedown",function(e){Ng||Dg(e)}),i.querySelector("#zcc-preview-slider").addEventListener("dblclick",function(e){Ng||Dg(e)});for(var a=i.querySelectorAll("[data-purpose=resizing]"),o=a.length,r=0;r<o;r++){var l=a[r];l.addEventListener("mousedown",function(e){$g(e)}),l.addEventListener("dblclick",function(e){$g(e)})}}(e,t,s)}function gg(e){return t=e,Object.values(t).reduce(function(e,t){return e+t},0);var t}function fg(e){return function(e){var t=e.getAttribute("normal-val");if(void 0===t||!t)return;var s=4*Math.cos(t),i=-4*Math.sin(t);e.style.transform="translate("+i+"px, "+s+"px )";for(var n=e.parentElement.children,a=n.length,o=0;o<a;o++){var r=n[o];"path"===r.tagName&&(r.style.opacity="0.5")}e.style.opacity="1"}(e)}function Cg(e){return function(e){var t=(""+e).length-1,s=t%3,i=t-s;if(18<i){var n=i%18;s+=n,i-=n}return(""+e).substring(0,s+1)+{3:"K",6:"M",9:"B",12:"T",15:"P",18:"E"}[i]}(e)}function vg(e){return Lg(e)}function bg(e){return function(e){var t;Rg=e.isWidgetChart,xg=e.widgetChartId,t=Rg?document.querySelector('[element_id="'+xg+'"]'):document.getElementById("zcc-previewchart");for(var s=t.querySelector("#zcc-svg-cont").offsetHeight,i=t.querySelector("#zcc-xaxiscont"),n=s*ug.GRAPHPREVIEWSPACINGBOTTOM-40,a=i.querySelectorAll("text[xaxislabel]"),o=a.length,r=0;r<o;r++){var l=a[r],d=l.getBoundingClientRect().width;if(n<=d){var c=l.textContent.substring(0,5)+"...";l.textContent=c}}}(e)}function yg(e,t,s){return n=t,a=s,(i=e).getAttribute(n)===a||i.parentElement.getAttribute(n)===a;var i,n,a}function _g(e){return e.reduce(function(e,t){return Math.max(e,t)})}var Wg,Sg,wg,Mg,Ig,Tg,Ag,Eg,Ug,xg,Ng=!1,kg=!1,Og=4,Rg=!1;function Hg(e){var t=e.closest("div[chart-type]");Rg=t?(xg=t.getAttribute("element_id"),!0):(xg=null,!1)}function $g(e){Hg(mg=e.target),Ng=!0,Wg=e.pageX}function Dg(e){Hg(Sg=e.target),kg=!0,Wg=e.pageX}var Lg=function(e){var t=(""+e).length-2,s=e/Math.pow(10,t);return Math.ceil(s/5)*Math.pow(10,t)};var Pg=Object.freeze({__proto__:null,bindEventsForSlider:hg,sumAllValuesOfKeys:gg,addTransitionEffect:fg,getFriendlyFormat:Cg,getOptimalSplitValue:vg,allignYAxisText:bg,allowEventExecution:yg,getMaxValFromArray:_g});function Bg(e,t,s){return function(e,t,s){var i=e.target,n=i.getAttribute("data-label"),a=i.getAttribute("data-value"),o=i.getAttribute("data-category"),r=void 0!==t.styles.y_axis&&void 0!==t.styles.y_axis.title?t.styles.y_axis.title:"Value",l={LABELTITLE:void 0!==t.styles.x_axis&&void 0!==t.styles.x_axis.title?t.styles.x_axis.title:"Label",LABEL:n,VALUETITLE:r,VALUE:a,CATEGORY_TXT:"Category",CATEGORY:o},d=Hs(pg.graphCustomTooltip,l);if("vertical_stacked_bar"===t.styles.preview){var c=(a/s[n]*100).toFixed(1);d=Hs(d,{PERCENTAGE_HTML:'<div class="zcq-mT2">Percentage : '+c+"</div>"},"InSecureHTML")}else d=Hs(d,{PERCENTAGE_HTML:""});if("trend"===t.styles.preview){var m,u=i.getAttribute("cx"),p=i.getAttribute("cy");if(1<(m=(m=t.isWidgetChart?document.querySelector('[element_id="'+t.widgetChartId+'"]'):document.getElementById("zcc-previewchart")).querySelector("#zcc-svg-cont").querySelectorAll("[cx='"+u+"'][cy='"+p+"']")).length){var h='<div class="zcq-fontB">'+n+" :</div>",g=Zg(m);d=h+=g}!function(e){var t=parseInt(e.getAttribute("r"))+2,s=e.style.fill;e.style.cssText+="stroke: "+s+"; stroke-width: "+t+"px; stroke-opacity: 0.5"}(i)}var f=document.getElementById("zcc-charttooltip");f.innerHTML=d,f.classList.remove("dN"),Kg(f,e)}(e,t,s)}function jg(e,t){return s=e,i=t,document.getElementById("zcc-charttooltip").classList.add("dN"),void("trend"!==i||s.target.hasAttribute("data-xaxisline")||(s.target.style.stroke="none"));var s,i}function Fg(e){return t=e,void Kg(document.getElementById("zcc-charttooltip"),t);var t}function zg(e){return fg((t=e).event.target),void function(e){var t=e.event,s=e.totalChartVal,i=e.chartObj,n=document.getElementById("zcc-charttooltip");n.classList.remove("dN");var a=t.target,o=a.getAttribute("data-value"),r=a.getAttribute("data-label"),l=(o/s*100).toFixed(1),d=void 0!==i.styles.x_axis&&void 0!==i.styles.x_axis.title?i.styles.x_axis.title:"Value",c={LABELTITLE:void 0!==i.styles.y_axis&&void 0!==i.styles.y_axis.title?i.styles.y_axis.title:"Label",LABEL:r,VALUETITLE:d,VALUE:o,PERCENTAGE_TXT:"Percentage",PERCENTAGEVAL:l},m=Hs(pg.percentageChartCustomTooltip,c);n.innerHTML=m,Kg(n,t)}(t);var t}function Gg(e,t){return Xg(e,t)}function qg(e){return function(e){var t=e.target;t.style.transform="none";for(var s=t.parentElement.children,i=s.length,n=0;n<i;n++){var a=s[n];"path"===a.tagName&&(a.style.opacity="1")}document.getElementById("zcc-charttooltip").classList.add("dN")}(e)}function Yg(e){return function(e){e.style.transform="none";for(var t=e.parentElement.children,s=t.length,i=0;i<s;i++){"path"===(e=t[i]).tagName&&(e.style.opacity="1")}}(e)}function Vg(e,t){return function(e,t){var s,i=e.target.getAttribute("data-label");s=t.isWidgetChart?document.querySelector('[element_id="'+t.widgetChartId+'"]'):document.getElementById("zcc-previewchart");s=s.querySelector("#zcc-svg-cont").querySelectorAll("[data-label='"+i+"'][data-category]");var n='<div class="zcq-fontB">'+i+" :</div>",a=Zg(s);n+=a;var o=document.getElementById("zcc-charttooltip");o.innerHTML=n,o.classList.remove("dN"),Kg(o,e)}(e,t)}function Zg(e){for(var t="",s=e.length,i=0;i<s;i++){var n=e[i],a={COLOR:n.style.fill,CATEGORY:n.getAttribute("data-category"),VALUE:n.getAttribute("data-value")};t+=Hs(pg.trendMultiPointsTooltip,a)}return t}function Kg(e,t){var s=t.pageX-e.offsetWidth/2,i=t.pageY-(e.offsetHeight+20);e.style.cssText+="left: "+s+"px; top: "+i+"px"}var Xg=function(e,t){Kg(e,t)};var Jg,Qg,ef,tf,sf=Object.freeze({__proto__:null,mouseOverForGraph:Bg,mouseOutForGraph:jg,mouseMoveForGraph:Fg,mouseOverForChart:zg,mouseMoveForChart:Gg,mouseOutForChart:qg,mouseOutForLegend:Yg,mouseOverAxisLine:Vg});function nf(e){return gf(e)}function af(e,t){return Mf(e,t)}var of,rf,lf,df={},cf={},mf="",uf="",pf={},hf={};function gf(e){return ff(e),Cf[Jg.type]()}function ff(e){Qg=[],ef=[],df={},cf={},(Jg=e.chartObjInfo).isPreview=!!e.isPreview&&e.isPreview,Jg.showLegends=!!e.showLegends&&e.showLegends,Jg.sliderView=!!e.sliderView&&e.sliderView,Jg.isLegendClick=!!e.isLegendClick&&e.isLegendClick,Jg.isSliderInActiveState=!!e.isSliderInActiveState&&e.isSliderInActiveState,tf=void 0!==e.onLegendsCount?e.onLegendsCount:Jg.data.length,null!==e.widgetChartId&&void 0!==e.widgetChartId?(Jg.widgetChartId=e.widgetChartId,Jg.isWidgetChart=!0):(Jg.widgetChartId=null,Jg.isWidgetChart=!1)}var Cf={percentage_chart:function(){return vf(),function(){var e="",t=-90,s="0 0 100 100";Jg.styles.preview===ug.SEMIDOUGHNUT&&(t=-ug.SEMICIRCLE,s="0 14 100 100");var i=function(){for(var e=0,t=0,s=.5*-Math.PI,i=ug.SEMICIRCLE,n=ug.CIRCLEVALUE,a=Jg.styles.preview===ug.SEMIDOUGHNUT?i:n,o=ug.CIRCLERADIUS,r="",l="",d=Jg.isPreview?"addeffects":"",c=0;c<Qg.length;c++){var m=Qg[c];if(0!==m){var u,p=(t+=m/of*a)-e,h=" 0,0,1 ",g=m/of*2*Math.PI;Jg.styles.preview===ug.SEMIDOUGHNUT&&(g=m/of*Math.PI);var f=s+.5*g;if(s+=g,i<=p&&(h=" 0,1,1 "),p===n){var C={ACTION:d,CENTERVAL:ug.CENTERVAL,LABEL:ef[c],VALUE:m,LEGENDCOLOR:ug.LEGENDCOLORS[c],RADIUS:o};u=Hs(pg.percentageChartPathCircleHtml,C)}else{var v=ug.CENTERVAL+o*Math.cos(e*Math.PI/i),b=ug.CENTERVAL+o*Math.sin(e*Math.PI/i),y=ug.CENTERVAL+o*Math.cos(t*Math.PI/i),_=ug.CENTERVAL+o*Math.sin(t*Math.PI/i);C={ACTION:d,CENTERVAL:ug.CENTERVAL,FROMCOORDX:v,FROMCOORDY:b,RADIUS:o,ARCVAL:h,TOCOORDX:y,TOCOORDY:_,LABEL:ef[c],VALUE:m,NORMALVAL:f,LEGENDCOLOR:ug.LEGENDCOLORS[c],LEGENDID:c},u=Hs(pg.percentageChartPathHtml,C)}if(r+=u,Jg.showLegends){C={label:Jg.data[c].label,legengId:c,legendVal:m,legendColor:ug.LEGENDCOLORS[c],value:Jg.data[c].value};var W=Hs(pg.pieChartsLegendHtml,C);l+=W}e=t}}return{percentageChartHtml:r,legendHtml:l}}(),n=i.percentageChartHtml,a=function(){var e,t=Jg.styles.preview;return t===ug.PIE?e=pg.pieChartCenterCircleHtml:t===ug.DOUGHNUT?e=Hs(pg.doughnutCenterCircleHtml,{CLIPPATH:""},"InSecureHTML"):t===ug.SEMIDOUGHNUT&&(e=pg.semiDoughnutDefinitionHtml+Hs(pg.doughnutCenterCircleHtml,{CLIPPATH:"url(#zcc-cut-off-bottom)"},"InSecureHTML")),e}(),o={viewBoxSize:s,ID:ug.PIE,rotationDeg:t,CHART_HTML:n,CENTER_CIRCLE_HTML:a},r=Hs(pg.pieChartBodyHtml,o,"InSecureHTML");if(Jg.isLegendClick)return r;if(Jg.showLegends){var l=i.legendHtml;e=Hs(pg.pieChartsLegendContHtml,{LEGEND_HTML:l},"InSecureHTML")}return o={CHARTBODY_HTML:r,LEGEND_HTML:e,PREVIEWBTN_HTML:Jg.isPreview?"":pg.previewBtnHtml},Hs(pg.pieChartContHtml,o,"InSecureHTML")}()},graph:function(){return function(){var e="",t=function(){var e,t,s,i,n,a,o,r;e=200,t=350,s=ug.GRAPHSPACINGTOP,i=ug.GRAPHSPACINGBOTTOM,n=ug.GRAPHSPACINGLEFT,a=ug.GRAPHSPACINGRIGHT,_f(),o=o||0,r=r||ef.length,Jg.isPreview&&(e=400,t=900,i=ug.GRAPHPREVIEWSPACINGBOTTOM,n=ug.GRAPHPREVIEWSPACINGLEFT);var l=e*n,d=e*s,c=t-t*a,m=e-e*i,u={xStartPoint:l,xEndPoint:c,yStartPoint:d,yEndPoint:m,totalXaxis:5,startValue:o,endValue:r,height:e,width:t,spacingBottom:i},p="",h="";if(void 0!==Jg.styles.x_axis&&void 0!==Jg.styles.y_axis){var g,f,C,v,b,y=Jg.styles.x_axis.title,_=Jg.styles.y_axis.title;b=Jg.isPreview?(g=30,f=e-10,C=(m-d)/2+d,v=(c-l)/2+l,""):(g=10,f=e-5,C=(e-e*ug.GRAPHSPACINGBOTTOM)/2,v=(c-l)/2+l,"zcq-chart-inline-title");var W="rotate(-90 "+g+" "+C+")";p=Hs(pg.axisTitleHtml,{visiblityCls:b,xVal:g,yVal:C,trasnformVal:W,axisTitle:_}),h=Hs(pg.axisTitleHtml,{visiblityCls:b,xVal:v,yVal:f,trasnformVal:"",axisTitle:y})}var S=Hs(pg.graphAxisLine,{FIRST_X:l,FIRST_Y:m,SECOND_X:c,SECOND_Y:m}),w=Hs(pg.graphAxisLine,{FIRST_X:l,FIRST_Y:d,SECOND_X:l,SECOND_Y:m}),M=function(e){var t,s,i,n,a,o=e.xStartPoint,r=e.xEndPoint,l=e.yStartPoint,d=e.yEndPoint,c=e.totalXaxis,m=20<ef.length&&Jg.isPreview&&!Jg.sliderView;t="vertical_stacked_bar"===Jg.styles.preview?_g(Object.values(cf)):_g(Qg);if(i=(r-o)/(ef.length+1),n=(d-(l+10))/c,s=vg(t),a=n/s,m)var u=d-l,p=r-o,h=ug.SLIDERHEIGHT,g=a/u*ug.SLIDERHEIGHT,f=i/p*ug.SLIDERWIDTH,C=0;return{spaceBtwnYaxisVal:i,spaceBtwnXaxisVal:n,yAxisStartValue:s,singleAxisValue:a,sliderYEndingPoint:void 0!==h?h:void 0,sliderSingleAxisValue:void 0!==g?g:void 0,sliderSpaceBtwnYaxisVal:void 0!==f?f:void 0,sliderXStartPoint:void 0!==C?C:void 0}}(u),I=function(e,t){var o="",r="",l=e.totalXaxis,d=e.xStartPoint,c=e.xEndPoint,m=e.yEndPoint,u=t.spaceBtwnXaxisVal,p=t.spaceBtwnYaxisVal,h=t.yAxisStartValue,g=e.startValue,f=e.endValue,C=-5;(function(){for(var e=m,t=0;t<l;t++){e-=u;var s=d;Jg.isPreview&&(s=d-10);var i=(t+1)*h,n="";1e3<=i&&(i=Cg(n=i));var a={XPOSITION:s,YPOSITION:e,XSTARTPOINT:d,XENDPOINT:c,XAXISVALUE:i,TEXTXPOSITION:C,TOOLTIPVALUE:n};o+=Hs(pg.graphYAxisValueLine,a)}})(),Jg.isPreview&&(C=-10,function(){for(var e=d,t=ef.length,s=0;s<t;s++)if(g<=s&&s<=f){var i=m+12,n=i+5,a={XPOSITION:e+=p,YPOSITION:i,YENDPOINT:m,TEXTYPOSITION:n,TRASNFORMVAL:"rotate(-45 "+e+" "+n+")",LABEL:ef[s],AXIS_LABEL:20<f-g&&s%2!=0?"":ef[s]};r+=Hs(pg.graphXAxisValueLine,a)}}());return{xAxisValsHtml:r,yAxisValsHtml:o}}(u,M),T=function(e,v){var b="<g>",y={};hf={};var _=v.spaceBtwnYaxisVal,W=(e.height,e.spacingBottom,v.singleAxisValue),S=(e.startValue,e.xStartPoint),w=(e.xEndPoint,e.yStartPoint,e.yEndPoint),t=Jg.styles.preview;uf=mf="";var M=20<ef.length&&Jg.isPreview&&!Jg.sliderView;if("vertical_stacked_bar"==t){hf=Wf(Object.keys(df));var s=ef.length+(ef.length-1);Jg.data.forEach(function(e){e.status&&"off"===e.status||function(e,t,s,i){var n,a=_/3*2,o=(ug.SLIDERWIDTH-2)/i,r=e.length;Jg.showLegends&&(n={category:t,legendColor:s},uf+=Hs(pg.legendHtml,n));for(var l=0;l<r;l++)if(!Jg.sliderView||!(l<rf||lf<l)){var d=e[l].value,c=e[l].label;hf[c]+=d;var m=hf[c],u=w-m*W;if(n={xVal:p=(ef.indexOf(c)+1)*_+S-a/2,yVal:u,barWidth:a,barHeight:d*W,color:s,currentVal:d,currentLabel:c,category:t,ACTION:Jg.isPreview?"viewtooltip":""},b+=Hs(pg.barChartHtml,n),M){var p;u=v.sliderYEndingPoint-m*v.sliderSingleAxisValue,ef.indexOf(c),v.sliderSpaceBtwnYaxisVal,v.sliderXStartPoint;n={xVal:p=0===(p=2*ef.indexOf(c)*o)?1:p,yVal:u,barWidth:o,barHeight:d*v.sliderSingleAxisValue,color:s,currentVal:d,currentLabel:c,category:t,ACTION:""},mf+=Hs(pg.barChartHtml,n)}}}(e.values,e.category,e.color,s)})}else if("vertical_bar"===t){y=Wf(Object.keys(df));s=gg(df)+(Object.keys(df).length-1);pf={},Jg.data.forEach(function(e){e.status&&"off"===e.status||function(e,t,s,i){var n,a=_-2*(.15*_),o=.05*_,r=(ug.SLIDERWIDTH-2)/i,l=e.length;Jg.showLegends&&(n={category:t,legendColor:s},uf+=Hs(pg.legendHtml,n));for(var d=0;d<l;d++)if(!Jg.sliderView||!(d<rf||lf<d)){var c=e[d].value,m=e[d].label,u=w-(C=c*W),p=S+(ef.indexOf(m)+1)*_;p-=a/2;var h=(a-(df[m]-1)*o)/df[m],g=p+y[m]*(h+o);if(y[m]+=1,n={xVal:g,yVal:u,barWidth:h,barHeight:C,color:s,currentVal:c,currentLabel:m,category:t,ACTION:Jg.isPreview?"viewtooltip":""},b+=Hs(pg.barChartHtml,n),M){if(void 0===pf[m])if(0==ef.indexOf(m))pf[m]=0;else{var f=e[d-1].label;pf[m]=pf[f]+df[f]+1}else pf[m]+=1;var C=c*v.sliderSingleAxisValue;u=v.sliderYEndingPoint-C;n={xVal:g=0===(g=pf[m]*r)?1:g,yVal:u,barWidth:r,barHeight:C,color:s,currentVal:c,currentLabel:m,category:t,ACTION:""},mf+=Hs(pg.barChartHtml,n)}}}(e.values,e.category,e.color,s)})}else if("trend"===t){s=ef.length;Jg.data.forEach(function(e){e.status&&"off"===e.status||function(e,t,s,i){var n,a,o="",r=!0,l=Jg.isPreview?4:2,d=e.length;if(M)var c,m=(ug.SLIDERWIDTH-4)/(i-1);Jg.showLegends&&(a={category:t,legendColor:s},uf+=Hs(pg.legendHtml,a)),b+='<g data-id="'+t+'">';for(var u=0;u<d;u++)if(!Jg.sliderView||!(u<rf||lf<u)){var p=e[u].value,h=e[u].label,g=w-p*W,f=(ef.indexOf(h)+1)*_+S;a={x:f,y:g,trendsCircleVal:l,color:s,currentVal:p,currentLabel:h,category:t,ACTION:Jg.isPreview?"viewtooltip":""},o+=Hs(pg.trendsChartDotHtml,a),r?n="M "+f+" "+g+" ":n+="L "+f+" "+g+" ",M&&(g=v.sliderYEndingPoint-p*v.sliderSingleAxisValue,f=0===(f=ef.indexOf(h)*m)?2:f,r?c="M "+f+" "+g+" ":c+="L "+f+" "+g+" "),r=!1}M&&(a={distStr:c,color:s},mf+=Hs(pg.trendsChartPathHtml,a)),a={distStr:n,color:s},b+=Hs(pg.trendsChartPathHtml,a),b+=o,b+="</g>"}(e.values,e.category,e.color,s)})}return b+="</g>"}(u,M),A=Hs(pg.grpahAxisCont,{ID:"zcc-xaxiscont",AXISLINE:S,AXISTITLE:h,AXISVALUES:I.xAxisValsHtml},"InSecureHTML"),E=Hs(pg.grpahAxisCont,{ID:"zcc-yaxiscont",AXISLINE:w,AXISTITLE:p,AXISVALUES:I.yAxisValsHtml},"InSecureHTML");return{graphAxisHtml:A+E,graphPointsHtml:T,height:e,width:t}}(),s=t.height,i=t.width,n=t.graphAxisHtml,a=t.graphPointsHtml;Jg.isPreview&&20<ef.length&&(e=Hs(pg.previewSlider,{SILDER_HTML:mf},"InSecureHTML"));Jg.showLegends&&(uf=Hs(pg.legendParentHtml,{legendHtml:uf},"InSecureHTML"));if(Jg.isLegendClick&&Jg.isSliderInActiveState){var o={VISIBILITY_CLASS:"dN",VIEWBOX_ATTRIBUTE:Jg.isPreview?"":"viewBox='0 0 "+i+" "+s+" '",GRAPH_AXIS:n,GRAPH_POINTS:a},r=Hs(pg.graphSvgHtml,o,"InSecureHTML"),l=Hs('<svg class="zcq-charts-slider-preview">{{SILDER_HTML}}</svg>',{SILDER_HTML:mf},"InSecureHTML");return{previewGrpahHtml:r,sliderPerviewGrpahHtml:l}}o={SLIDER_PREVIEW:e,PREVIEW_CLASS:Jg.isPreview?"zcq-preview mT40":"",VIEWBOX_ATTRIBUTE:Jg.isPreview?"":"viewBox='0 0 "+i+" "+s+" '",GRAPH_AXIS:n,GRAPH_POINTS:a};var d=Hs(pg.graphBodyHtml,o,"InSecureHTML");if(Jg.isLegendClick)return d;if(Jg.sliderView)return o={VISIBILITY_CLASS:"",VIEWBOX_ATTRIBUTE:Jg.isPreview?"":"viewBox='0 0 "+i+" "+s+" '",GRAPH_AXIS:n,GRAPH_POINTS:a},Hs(pg.graphSvgHtml,o,"InSecureHTML");return o={GRAPHBODYHTML:d,LEGENDHTML:uf,PREVIEWBTN_HTML:Jg.isPreview?"":pg.previewBtnHtml},Hs(pg.graphChartContHtml,o,"InSecureHTML")}()}};function vf(){of=0;for(var e=Jg.data.length,t=0;t<e;t++)Qg[t]=Jg.data[t].value,ef[t]=Jg.data[t].label,of+=Qg[t]}function bf(){yf({mouseevents:!0,legendcardevents:!0})}function yf(e){e.mouseevents&&function(){var e;e=Jg.isWidgetChart?document.querySelector('[element_id="'+Jg.widgetChartId+'"]'):document.getElementById("zcc-previewchart");(e=e.querySelector("#zcc-svg-cont").querySelector("svg")).addEventListener("mouseover",function(e){yg(e.target,"data-action","addeffects")&&zg({event:e,totalChartVal:of,chartObj:Jg})}),e.addEventListener("mousemove",function(e){yg(e.target,"data-action","addeffects")&&Gg(document.getElementById("zcc-charttooltip"),e)}),e.addEventListener("mouseout",function(e){yg(e.target,"data-action","addeffects")&&qg(e)})}(),e.legendcardevents&&function(){var e;e=Jg.isWidgetChart?document.querySelector('[element_id="'+Jg.widgetChartId+'"]'):document.getElementById("zcc-previewchart");(e=e.querySelector("#zcc-legends")).addEventListener("click",function(e){if(yg(e.target,"data-action","legendclick")){var t=function(e){var t=e.getAttribute("status"),s=e.getAttribute("legendId"),i={chartObjInfo:Jg,isPreview:!0,showLegends:!1,onLegendsCount:tf,isLegendClick:!0,widgetChartId:Jg.widgetChartId};if(1===tf&&"on"===t)return i.onLegendsCount=tf,gf(i);if("on"===t)tf--,Jg.data[s].value=0,e.setAttribute("status","off"),e.classList.add("zcq-statusoff");else{tf++;var n=parseInt(e.getAttribute("legendValue"));Jg.data[s].value=n,e.setAttribute("status","on"),e.classList.remove("zcq-statusoff")}return i.onLegendsCount=tf,gf(i)}(e.target.hasAttribute("data-action")?e.target:e.target.parentElement);(Jg.isWidgetChart?document.querySelector('[element_id="'+Jg.widgetChartId+'"]'):document.getElementById("zcc-previewchart")).querySelector("#zcc-svg-cont").innerHTML=t,yf({mouseevents:!0})}}),e.addEventListener("mouseover",function(e){if(yg(e.target,"data-action","legendclick")){var t,s=(e.target.hasAttribute("data-label")?e.target:e.target.parentElement).getAttribute("data-label");(t=(t=Jg.isWidgetChart?document.querySelector('[element_id="'+Jg.widgetChartId+'"]'):document.getElementById("zcc-previewchart")).querySelector("#zcc-svg-cont").querySelector("[data-label='"+s+"']"))&&fg(t)}}),e.addEventListener("mouseout",function(e){if(yg(e.target,"data-action","legendclick")){var t,s=(e.target.hasAttribute("data-label")?e.target:e.target.parentElement).getAttribute("data-label");(t=(t=Jg.isWidgetChart?document.querySelector('[element_id="'+Jg.widgetChartId+'"]'):document.getElementById("zcc-previewchart")).querySelector("#zcc-svg-cont").querySelector("[data-label='"+s+"']"))&&Yg(t)}})}()}function _f(){var t=0;Jg.data.forEach(function(e){e.status&&"off"===e.status||(e.color||(e.color=ug.LEGENDCOLORS[t],t++),function(e){for(var t,s,i=e.length,n=0;n<i;n++)Jg.sliderView&&(n<rf||lf<n)||(t=e[n].value,s=e[n].label,df[s]=df[s]?df[s]+1:1,cf[s]=cf[s]?cf[s]+t:t,Qg.includes(e[n].value)||Qg.push(e[n].value),ef.includes(e[n].label)||ef.push(e[n].label))}(e.values))})}function Wf(e){for(var t={},s=e.length,i=0;i<s;i++)t[e[i]]=0;return t}function Sf(){If({mouseevents:!0,sliderevents:!0,legendcardevents:!0})}function wf(e){var t=e.getAttribute("status"),s=e.getAttribute("data-category");if(1===tf&&"on"===t)return gf(Jg);e.getAttribute("legendId");"on"===t?(tf--,e.setAttribute("status","off"),e.classList.add("zcq-statusoff")):(tf++,e.setAttribute("status","on"),e.classList.remove("zcq-statusoff")),Jg.data.forEach(function(e){e.category===s&&(e.status&&"off"===e.status?delete e.status:e.status="off")});var i={chartObjInfo:Jg,isPreview:!0,showLegends:!1,onLegendsCount:tf,isLegendClick:!0,widgetChartId:Jg.widgetChartId,isSliderInActiveState:function(){var e;e=Jg.isWidgetChart?document.querySelector('[element_id="'+Jg.widgetChartId+'"]'):document.getElementById("zcc-previewchart");if(!(e=e.querySelector("#zcc-preview-slider")))return!1;var t=e.offsetWidth,s=Jg.styles.preview;{if("vertical_bar"===s||"vertical_stacked_bar"===s)return t<=ug.BARCHART_SLIDERWIDTH;if("trend"===s)return t<=ug.TRENDS_SLIDERWIDTH}}()};return i.isSliderInActiveState?(function(e){var t;t=Jg.isWidgetChart?document.querySelector('[element_id="'+Jg.widgetChartId+'"]'):document.getElementById("zcc-previewchart");var s=t.querySelector("#zcc-sliderpreviewcont"),i=t.querySelector("#zcc-svg-cont");s.innerHTML=e.sliderPerviewGrpahHtml,i.innerHTML=e.previewGrpahHtml,If({mouseevents:!0}),bg(Jg)}(gf(i)),Mf(rf,lf),!1):gf(i)}function Mf(e,t){rf=e,lf=t;var s,i=gf({chartObjInfo:Jg,isPreview:!0,sliderView:!0,onLegendsCount:tf,widgetChartId:Jg.widgetChartId});(s=(s=Jg.isWidgetChart?document.querySelector('[element_id="'+Jg.widgetChartId+'"]'):document.getElementById("zcc-previewchart")).querySelector("#zcc-svg-cont")).querySelector("svg").remove(),s.innerHTML=i;If({mouseevents:!0}),bg(Jg)}function If(e){e.mouseevents&&function(){var e;e=Jg.isWidgetChart?document.querySelector('[element_id="'+Jg.widgetChartId+'"]'):document.getElementById("zcc-previewchart");(e=e.querySelector("#zcc-svg-cont").querySelector("svg")).addEventListener("mouseover",function(e){yg(e.target,"data-action","viewtooltip")?Bg(e,Jg,cf):e.target.hasAttribute("data-xaxisline")&&Vg(e,Jg)}),e.addEventListener("mouseout",function(e){(yg(e.target,"data-action","viewtooltip")||e.target.hasAttribute("data-xaxisline"))&&jg(e,Jg.styles.preview)}),e.addEventListener("mousemove",function(e){yg(e.target,"data-action","viewtooltip")&&Fg(e)})}(),e.sliderevents&&function(){if(20<ef.length){var e,t=Jg.styles.preview;"vertical_bar"===t||"vertical_stacked_bar"===t?e=ug.BARCHART_SLIDERWIDTH:"trend"===t&&(e=ug.TRENDS_SLIDERWIDTH),hg(ef.length,e,Jg)}}(),e.legendcardevents&&function(){var e;e=Jg.isWidgetChart?document.querySelector('[element_id="'+Jg.widgetChartId+'"]'):document.getElementById("zcc-previewchart");(e=e.querySelector("#zcc-legends")).addEventListener("click",function(e){if(yg(e.target,"data-action","chartLegendclick")){var t=e.target.hasAttribute("status")?e.target:e.target.parentElement;1===tf&&"on"===t.getAttribute("status")||function(e){var t=wf(e.target.hasAttribute("data-action")?e.target:e.target.parentElement);if(t){var s;(s=Jg.isWidgetChart?document.querySelector('[element_id="'+Jg.widgetChartId+'"]'):document.getElementById("zcc-previewchart").querySelector("#winhead").nextSibling).querySelector("#zcc-graphChartCont").remove(),s.insertAdjacentHTML("afterbegin",t);If({mouseevents:!0,sliderevents:!0}),bg(Jg)}}(e)}})}()}function Tf(){document.body.insertAdjacentHTML("beforeend",pg.chartsToolTipContHtml)}var Af=Object.freeze({__proto__:null,getChartsHtml:nf,openChartsPreview:function(e){return t=e.currentTarget,s=t.getAttribute("chid"),i=t.getAttribute("time"),n=$WC.CustomMsg.getMsgObj(t,s,i),a=t.getAttribute("data-chartindex"),o=JSON.parse(JSON.stringify(n["long.msg"][a])),r=nf({chartObjInfo:o,isPreview:!0,showLegends:!0}),void $WC.$Win.create({id:"zcc-previewchart",class:"zcq-chartpreviewheader",header:$WC.$CUtil.processXSS(n.msg),html:r,openfn:function(){Tf(),o.type===ug.PERCENTAGECHART?bf():(Sf(),bg(o))},closefn:function(){document.getElementById("zcc-charttooltip").remove()}});var t,s,i,n,a,o,r},handleSliderView:af,handleChartsPreviewForWidgets:function(e,t,s){return function(e,t,s){ff({chartObjInfo:t,isPreview:!0,showLegends:!0,widgetChartId:e,onLegendsCount:document.querySelector('[element_id="'+e+'"]').querySelector(".zcq-legend-cont").querySelectorAll('[status="on"]').length}),(t.type===ug.PERCENTAGECHART?vf:_f)();s&&(t.type===ug.PERCENTAGECHART?bf():(Sf(),bg(t)))}(e,t,s)},addCustomTooltipCont:function(){return Tf()}}),Ef={container:"mc378179c8_container",staritem:"mc378179c8_staritem",label:"mc378179c8_label",staricon:"mc378179c8_staricon",staricon_sel:"mc378179c8_staricon_sel",staricon_solid:"mc378179c8_staricon_solid",labelhighlight:"mc378179c8_labelhighlight",type1:"mc378179c8_type1",type2:"mc378179c8_type2",type3:"mc378179c8_type3",type4:"mc378179c8_type4",type5:"mc378179c8_type5",zmNightMode:"zmNightMode"},Uf={},xf={1:"important",2:"todo",3:"note",4:"boss",5:"followup"};function Nf(i){function n(e){var t=i.msgid,s={"X-XHR-exception":!0,"X-ZCSRF-TOKEN":ci()};i.onChangeCallBack(i.clickednode,i.chid),"true"==i.starselected&&i.startype==parseInt(e)?Ee("v1/stars/"+t+"_"+e+"_"+i.chid,null,i.successCallBack,i.failureCallBack,null,null,s):Te("v1/stars","chid="+i.chid+"&msguid="+t+"&type="+e,i.successCallBack,i.failureCallBack,null,null,s)}return k(Q,{onClickOutside:i.unmountComponent},k("div",{class:Ef.container},function(){var e=[],t=-1;for(var s in Uf[i.msguid]&&(t=Uf[i.msguid],e.append(k(kf,{itemtype:xf[t],selected:!0}))),xf)s!=t&&e.push(k(kf,{itemtype:s,selectedstartype:i.startype,onClickStarItem:n.bind(this),useunstar:!0}));return e}()))}function kf(t){var e=t.selectedstartype==t.itemtype?"_sel":"",s=t.customstyles&&t.customstyles.customstaritemstyle?t.customstyles.customstaritemstyle:Ef.staritem,i=t.customstyles&&t.customstyles.customlabelclass||"",n=$("star."+xf[t.itemtype]);return t.icontype&&"solid"==t.icontype&&(e="_solid"),t.useunstar&&t.selectedstartype==t.itemtype&&(n=$("chat.message.unstar"),s+=" "+Ef.labelhighlight),k("div",{class:s,onclick:function(e){t.onClickStarItem(t.itemtype)}},k("div",{class:Ef["staricon"+e]+" "+Ef["type"+t.itemtype]}),k("div",{class:Ef.label+" "+i},n))}function Of(){this.unmountComponent=this.unmountComponent.bind(this)}Of.prototype.mountComponent=function(e){this.mountpoint=e.mountpoint,this.currentmsgid=e.msgid,this.clickednode=e.clickednode,O(k(Nf,{msgid:e.msgid,chid:e.chid,successCallBack:e.successCallBack,failureCallBack:e.failureCallBack,onChangeCallBack:e.onChangeCallBack,unmountComponent:e.unmountComponent,unmountWithoutClearing:this.unmountComponent,starselected:e.starselected,startype:e.startype,clickednode:e.clickednode}),this.mountpoint)},Of.prototype.unmountComponent=function(){O("",this.mountpoint),Fi(this.mountpoint)},Of.prototype.getCurrentMsgId=function(){return this.currentmsgid};var Rf={TEXTMSG:"TEXTMSG",INFOMSG:"INFOMSG",IMGATT:"IMGATT",FILEATT:"FILEATT",LOADMORE:"LOADMORE",LOADMOREBUTTON:"LOADMOREBUTTON",TRANSERR:"TRANSERR",AUDIOATT:"AUDIOATT",VIDEOATT:"VIDEOATT",LOCATT:"LOCATT",CONTACTATT:"CONTACTATT",EVENTATT:"EVENTATT",CUSTOMMSG:"CUSTOMMSG",VIDEOLINK:"VIDEOLINK",AUDIOLINK:"AUDIOLINK",IMGLINK:"IMGLINK",BOTMSG:"BOTMSG",REPLYMSG:"REPLYMSG",TEMPMSG:"TEMPMSG",HRMSG:"HRMSG",DELETEDMSG:"DELETEDMSG",EDITEDMSG:"EDITEDMSG",FORWARDEDMSG:"FORWARDEDMSG",THREADMSG:"THREADMSG",THREADLINKMSG:"THREADLINKMSG"};function Hf(e){var t;if(e.isv1local)t=e.url;else if(WebMessanger.isGuestUser())t="/"+_CHATCONT+"/guestapi/v1/attachments/"+(e.url||e.fileurl),t+=e.thumb?"/thumbnail?guest_id="+WebMessanger.guest_info.encrypt_id:"?guest_id="+WebMessanger.guest_info.encrypt_id;else if(WebMessanger.isUDSDownloadEnabled()&&e.isv1){var s=WebMessanger.isRTCChat()?"rtcplatform":"CLIQ";t=_DOWNLOADSERVERURL+"/webdownload?x-service="+s+"&event-id="+(e.url||e.fileurl)}else t=e.isv1?"/"+_CHATCONT+"/v1/attachments/"+(e.url||e.fileurl):_WMSCHATURL+"download.sas?mime="+(e.content||e.contenttype)+"&url="+(e.url||e.fileurl)+"&fName="+e.fName;return t}var $f=Object.freeze({__proto__:null,types:Rf,getDownloadUrl:Hf}),Df={messageitemcontainer:"mc35699546_messageitemcontainer",zmNightMode:"zmNightMode",titlecontainer:"mc35699546_titlecontainer","wms-txtmsg":"wms-txtmsg",seperator:"mc35699546_seperator",photocontainer:"mc35699546_photocontainer",profileimg:"mc35699546_profileimg",rowcontainer:"mc35699546_rowcontainer",title:"mc35699546_title",datelabel:"mc35699546_datelabel",staricon:"mc35699546_staricon",type1:"mc35699546_type1",type2:"mc35699546_type2",type3:"mc35699546_type3",type4:"mc35699546_type4",type5:"mc35699546_type5",messagehtml:"mc35699546_messagehtml","wms-imgmsgcontainer":"wms-imgmsgcontainer",threadtitle:"mc35699546_threadtitle",threadicon:"mc35699546_threadicon"};function Lf(t){var e="starredmsg"==t.type?function(e){var t=e.item,s=t.mtype?t.mtype:"12",i=1===t.status,n=e.getMessageType(t),a=t;{if(i)return e.getDeletedMsgInfo(t.time);"20"==s&&(t.msg="string"==typeof t.msg?JSON.parse(t.msg):t.msg,t.mod=t.msg.__module||t.mode,n=e.getMessageType(t),t.msg.constructeddownloadurl=Hf(t.msg),n===Rf.IMGATT&&t.thumb&&(t.constructeddownloadurl+=e.getThumbnailImageUrl(t.msg.constructeddownloadurl)),t.meta&&(t.msg.meta=t.meta),a=t.msg)}"12"==s&&2!=t.revision&&(a.rawstarmsg=!0);return e.constructMessageFragment(t.sender,t.dname,t.time,a,n,t.sender,t.time,t.sender+"_"+t.time,null,null,null,null,t.time+"%"+t.chid,null,null,null,null,null,null,!0)}(t):null,s=function(e){var t=Pf(e),s="";Li(e.chid)&&(s=k("span",{class:Df.threadtitle},k(R,{type:"icon",content:"e9d8",tabindex:"-1",classname:Df.threadicon}),e.title));return k("div",{class:Df.titlecontainer},function(e){var t=e.sendername;-1<t.indexOf("b-")&&(t=e.title);Ai(e.sender)&&(t=$("chat.you"));return k("span",{class:Df.title},t)}(e),k("span",{class:Df.seperator}," ","❭❭"," "),k("span",{class:Df.title},t),k("span",{class:Df.datelabel},se(e.time)+", "+ee(e.time)),s)}(t.item),i=null;return"starredmsg"==t.type&&(i=k("div",{class:Df.staricon+" "+Df["type"+t.item.startype]})),k("div",{class:Df.messageitemcontainer,onclick:function(e){t.onClickListItem(t.item),e.stopPropagation(),e.preventDefault()}},k(Bf,{item:t.item}),k("div",{class:Df.rowcontainer},s,i,k("div",{class:Df.messagehtml,dangerouslySetInnerHTML:{__html:e}})))}function Pf(e){var t=e.title,s=Li(e.chid)?e.parent_chat_id:e.chid;return Di(s)&&(t=Pr(s)||t),e.receiver&&(t=Ai(e.receiver)?$("chat.you"):_s(e.receiver)),t}function Bf(e){var t=Ms(e.item.sender);return k("div",{key:e.item.sender,class:Df.photocontainer},k("img",{class:Df.profileimg,"data-zcprofileid":e.sender,src:t}))}var jf="mc07a5d35a_container",Ff="mc07a5d35a_loader",zf="mc07a5d35a_hv_align",Gf="mc07a5d35a_header",qf="mc07a5d35a_content",Yf="mc07a5d35a_wrapper",Vf="mc07a5d35a_filtercontainer",Zf="mc07a5d35a_filteritemstyle",Kf="mc07a5d35a_filteritemsel",Xf="mc07a5d35a_labelcolor",Jf="mc07a5d35a_listview",Qf="mc07a5d35a_itemloader",eC="mc07a5d35a_loadergif",tC="mc07a5d35a_emptylistcontainer",sC="mc07a5d35a_nostarimg",iC="mc07a5d35a_emptylistmsg",nC="mc07a5d35a_backdrop",aC="mc07a5d35a_closeiconstyle",oC="mc511a2e7a_loader",rC="mc511a2e7a_hv_align",lC="mc511a2e7a_container",dC="mc511a2e7a_showtranscript",cC="mc511a2e7a_close",mC="mc511a2e7a_chattitlecontainer",uC="mc511a2e7a_title",pC="mc511a2e7a_transcriptarea",hC="mc511a2e7a_threadtitle",gC="mc511a2e7a_threadicon",fC="mc511a2e7a_continuechat",CC=function(t){function e(e){t.call(this,e),this.escListener=this.escListener.bind(this),this.storeTranscriptNode=this.storeTranscriptNode.bind(this),this.openCurrentChat=this.openCurrentChat.bind(this),this.state={transcripthtml:null}}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.componentDidMount=function(){window.addEventListener("keydown",this.escListener,!0)},e.prototype.componentDidUpdate=function(e){e.item&&this.props.item&&e.item.starmessageid!=this.props.item.starmessageid?this.checkAndGetTranscript(e.item,this.props.item):!e.item&&this.props.item?this.getTranscriptFromServer(this.props.item):e.item&&this.props.item&&e.item.starmessageid==this.props.item.starmessageid&&this.props.glowBubble(this.props.item.time,this.transcriptnode,this.props.item.chid)},e.prototype.checkAndGetTranscript=function(e,t){if(e.chid==t.chid&&this.checkIfMessageExist(t))return;this.getTranscriptFromServer(t),this.setState({transcripthtml:null})},e.prototype.checkIfMessageExist=function(e){var t=encodeURI(e.message_id.replace("_"," "));return!!this.transcriptnode.querySelector('[data-msguid="'+t+'"]')&&(this.props.glowBubble(e.time,this.transcriptnode,e.chid),!0)},e.prototype.getTranscriptFromServer=function(e){var s=e.time,i=e.chid,t=i+"|"+s,n="chid="+i+"&tzoffset=330&mentionmsgid="+encodeURIComponent(t)+"&lineslimit=30",a={"X-XHR-exception":"true","X-ZCSRF-TOKEN":ci()},o=this;Ie("gettranscriptasjsonforweb.do",n,function(e){var t=o.props.constructChatContent(JSON.parse("["+this.responseText.slice(0,-1)+"]"));o.setState({transcripthtml:t},function(){this.props.glowBubble(s,this.transcriptnode,i),this.props.addEventListenersForTranscript(this.transcriptnode,i)})},function(){var e=o.props.constructChatContent([{messagetype:Rf.TRANSERR,msg:{mentionmsgid:t,latestchunk:!0}}]);o.setState({transcripthtml:e},function(){this.props.addEventListenersForTranscript(this.transcriptnode,i)})},null,null,a)},e.prototype.componentWillUnmount=function(){window.removeEventListener("keydown",this.escListener,!0)},e.prototype.storeTranscriptNode=function(e){this.transcriptnode=e},e.prototype.escListener=function(e){e.keyCode==He.KEYCODES.ESCAPE&&this.props.showtranscript&&(this.setState({transcripthtml:null}),this.props.callbackOnClose(),e.stopPropagation(),e.preventDefault())},e.prototype.getTitleElement=function(){var e=null;return Li(this.props.item.chid)&&(e=[">"]).push(k("span",{class:hC,title:this.props.item.title},k(R,{type:"icon",content:"e9d8",tabindex:"-1",classname:gC}),this.props.item.title)),k("div",{class:mC},k("span",{class:uC,title:Pf(this.props.item)},Pf(this.props.item)),e)},e.prototype.openCurrentChat=function(){this.props.openCurrentChat(this.props.item)},e.prototype.render=function(e,t){var s=null,i=null;e.loading&&!t.transcripthtml&&(s=k("div",{class:oC+" "+rC})),e.item&&(i=this.getTitleElement());var n=e.showtranscript?dC:"",a=e.item&&e.item.chid,o=e.item&&e.item.starmessageid;return k("div",{class:lC+" "+n},i,s,k("div",{id:"wmstranscriptcomponent","data-scrolldown":"true","data-chid":a,key:o,class:pC,dangerouslySetInnerHTML:{__html:t.transcripthtml},ref:this.storeTranscriptNode}),k(R,{onclick:e.callbackOnClose,type:"icon",content:"e634",classname:cC}),k(R,{onclick:this.openCurrentChat,type:"button",content:$("thread.msglink"),classname:fC}))},e}(M),vC={0:"all",1:"important",2:"todo",3:"note",4:"boss",5:"followup"},bC=[],yC=function(t){function e(e){t.call(this,e),this.filterStarMsg=this.filterStarMsg.bind(this),this.performScrollOperations=Bi(this.performScrollOperations,this,300),this.onClickListItem=this.onClickListItem.bind(this),this.hideTranscriptView=this.hideTranscriptView.bind(this),this.openCurrentChat=this.openCurrentChat.bind(this),this.storeListContainer=this.storeListContainer.bind(this),this.starmsgstorage={0:{},1:{},2:{},3:{},4:{},5:{}},this.searchmore={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0},this.last_fetched_starmsg_time={0:0,1:0,2:0,3:0,4:0,5:0},this.state={list:{},selectedstarfilter:0,selecteditem:null,showtranscript:!1}}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.componentDidMount=function(){this.getMessageList()},e.prototype.componentWillUnmount=function(){bC=[]},e.prototype.storeListContainer=function(e){e&&(this.listcontainer=e,this.props.config.loadOriginalImages(this.listcontainer))},e.prototype.updateListItem=function(e,t){var s=this.state.list;"starredmsg"==this.getListType()&&("STAR"==t?(0!=this.state.selectedstarfilter&&this.state.selectedstarfilter!=e.startype?(delete this.starmsgstorage[this.state.selectedstarfilter][e.starmessageid],s=vn(s,e.time),bC=bn(bC,e,"starmessageid")):s=bn(s,e,e.starmessageid),s=this.sortStarMsgWithKey(s,"time",!0),this.starmsgstorage[0][e.starmessageid]=e,this.starmsgstorage[e.startype][e.starmessageid]=e):(e.time=e.msgtime,s=vn(s,e.time)),this.updateCompleteList(s)),this.setState({list:s})},e.prototype.performScrollOperations=function(e){"starredmsg"==this.getListType()&&(this.props.config.loadOriginalImages(e.target),this.checkAndLoadNextPage(e))},e.prototype.checkAndLoadNextPage=function(e){var t=e.target;t.scrollHeight-t.scrollTop<3*t.offsetHeight&&this.getStarMessageList(this.state.selectedstarfilter)},e.prototype.sortStarMsgWithKey=function(e,t,s){return e.sort(Ci(t,s))},e.prototype.getLastMsgTotime=function(e){return this.last_fetched_starmsg_time[e]},e.prototype.updateStorage=function(e,t){for(var s=0;s<e.length;s++)this.starmsgstorage[t][e[s].starmessageid]=e[s]},e.prototype.updateCompleteList=function(s){for(var e=function(t){var e=bC.findIndex(function(e){return e.starmessageid==s[t].starmessageid});-1<e?bC[e]=s[t]:bC.push(s[t])},t=0;t<s.length;t++)e(t);bC=this.sortStarMsgWithKey(bC,"time",!0)},e.prototype.updateStarMessageList=function(e,t){this.updateCompleteList(e),this.updateStorage(e,t),e.length<50&&(this.searchmore[t]=!1),0<e.length&&(this.last_fetched_starmsg_time[t]=e[e.length-1].time),this.filterStarMsg(t)},e.prototype.getStarMessageList=function(e){if(this.searchmore[e]){var t="limit=50",s=this.getLastMsgTotime(e);0<bC.length&&0<s&&(t+="&totime="+s),0<e&&(t+="&type="+e),Ie("v1/stars",t,function(e,t){var s=JSON.parse(t).data.starmessages;this.updateStarMessageList(s,e)}.bind(this,e),function(){rn($("event.status.update.error")),this.setState({showtranscript:!1})}.bind(this),null,null,{"x-xhr-exception":"true"})}},e.prototype.getMessageList=function(){"starredmsg"==this.getListType()&&this.getStarMessageList(this.state.selectedstarfilter)},e.prototype.getListType=function(){return this.props.config.type},e.prototype.getHeadingContent=function(){if("starredmsg"==this.getListType())return $("chat.message.star")},e.prototype.filterStarMsg=function(t){var s=this,e=bC.filter(function(e){return 0==t&&s.starmsgstorage[t][e.starmessageid]?e:e.startype==t});(0<t||bC.length<50)&&this.getStarMessageList(t),this.setState({selectedstarfilter:t,list:e,showtranscript:!1,selecteditem:null})},e.prototype.openCurrentChat=function(e){var t=e.chid,s=e.message_id;s?this.props.config.showMessageFragmentInView(t,s):this.props.config.attachSession(t),this.props.unmountComponent()},e.prototype.getStarMsgFilters=function(){return k(_C,{onclick:this.filterStarMsg,selectedfilter:this.state.selectedstarfilter,filterStarMsg:this.filterStarMsg})},e.prototype.onClickListItem=function(e){this.setState({selecteditem:e,showtranscript:!0})},e.prototype.hideTranscriptView=function(){this.setState({showtranscript:!1,selecteditem:null})},e.prototype.getListItemsForCurrentType=function(e,t){var s=[];if(e.length)for(var i=0;i<e.length;i++)s.push(k(Lf,{item:e[i],type:t,onClickListItem:this.onClickListItem,constructMessageFragment:this.props.config.constructMessageFragment,getMessageType:this.props.config.getMessageType,getThumbnailImageUrl:this.props.config.getThumbnailImageUrl,getDeletedMsgInfo:this.props.config.getDeletedMsgInfo}));return this.searchmore[this.state.selectedstarfilter]&&s.push(k("div",{class:Qf},k("span",{class:eC}))),k("div",{class:Jf,ref:this.storeListContainer,key:this.state.selectedstarfilter,onscroll:this.performScrollOperations},s)},e.prototype.getTranscriptContainer=function(){var e=!!this.state.selecteditem;return k(CC,{loading:e,item:this.state.selecteditem,glowBubble:this.props.config.glowBubble,constructChatContent:this.props.config.constructChatContent,addEventListenersForTranscript:this.props.config.addEventListenersForTranscript,showtranscript:this.state.showtranscript,callbackOnClose:this.hideTranscriptView,openCurrentChat:this.openCurrentChat})},e.prototype.getEmptyList=function(){var e=null;if(0==this.state.selectedstarfilter)e=k("div",{class:iC,dangerouslySetInnerHTML:{__html:$("star.emptylist.empty")}});else{var t=$("star."+vC[this.state.selectedstarfilter]);e=k("div",{class:iC},k("span",{dangerouslySetInnerHTML:{__html:$("star.emptylist.empty1")}}),k("b",null,t))}return k("div",{class:tC},k("div",{class:sC}),e)},e.prototype.getStarMessagesContent=function(){var e=this.getStarMsgFilters(),t=this.state.list,s=this.getListItemsForCurrentType(t,this.getListType());if(0==t.length){if(0==this.state.selectedstarfilter)return this.getEmptyList();s=this.getEmptyList()}var i=this.getTranscriptContainer();return k("div",{class:qf},e,s,i)},e.prototype.getCustomDialogStyles=function(){return{customContainerStyle:jf,customHeaderStyle:Gf,customWrapperStyle:Yf,customoverlaystyle:nC,customButtonStyle:aC}},e.prototype.render=function(e,t){t.list;var s=null;return"starredmsg"==this.getListType()&&(s=this.getStarMessagesContent()),ri(t.list)&&(s=k("div",{class:Ff+" "+zf})),k(et,{heading:this.getHeadingContent(),callbackOnClose:this.props.unmountComponent,customDialogStyles:this.getCustomDialogStyles(),ignoreFocusOnMount:!0},s)},e}(M);function _C(i){return k("div",{class:Vf},function(){var e=[];for(var t in vC){var s=i.selectedfilter==t?Zf+" "+Kf:Zf;0==t?e.push(k("div",{class:s,onclick:function(){i.filterStarMsg(0)}.bind(this)},$("All"))):e.push(k(kf,{itemtype:t,icontype:"solid",customstyles:{customstaritemstyle:s,customlabelclass:Xf},iconselected:i.selectedfilter==t,onClickStarItem:i.filterStarMsg}))}return e}())}function WC(){this.unmountComponent=this.unmountComponent.bind(this),this.storeListViewInstance=this.storeListViewInstance.bind(this)}WC.prototype.updateListItem=function(e,t){this.instance&&this.instance.updateListItem(e,t)},WC.prototype.storeListViewInstance=function(e){this.instance=e},WC.prototype.mountComponent=function(e){this.clickednode=e.clickednode,this.closeCallBack=e.closeCallBack,this.node=document.createElement("div"),document.body.appendChild(this.node),O(k(yC,{ref:this.storeListViewInstance,config:e,unmountComponent:this.unmountComponent}),this.node)},WC.prototype.unmountComponent=function(){O("",this.node),this.node.parentElement&&this.node.parentElement.removeChild(this.node),"function"==typeof this.closeCallBack&&this.closeCallBack()};function SC(){this.unmountComponent=this.unmountComponent.bind(this)}var wC="mccdc6e71c_toggle_switch",MC="mccdc6e71c_checkbox",IC="mccdc6e71c_label",TC="mccdc6e71c_inner",AC="mccdc6e71c_switch",EC="mccdc6e71c_loading_container",UC="mccdc6e71c_loader",xC=function(t){function e(e){t.call(this,e),this.state={button_state:this.props.button_state,loader:!1},this.handleChange=this.handleChange.bind(this)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.handleChange=function(){var t=this.state.button_state,e=function(){this.setState(function(e){return{button_state:!t,loader:!1}})}.bind(this);this.props.handleChange(t,e),this.setState(function(e){return{button_state:!1,loader:!0}})},e.prototype.render=function(){var e=AC;return this.state.loader&&(e+=" "+UC),k("div",{class:wC},k("input",{type:"checkbox",class:MC,name:"toggleswitch",id:"toggleswitch",checked:this.state.button_state,onChange:this.handleChange}),k("label",{for:"toggleswitch",class:IC},k("span",{class:TC}),k("span",{class:e}),k("div",{class:EC},k("span",null),k("span",null),k("span",null))))},e}(M),NC="mcecbec3c1_header",kC="mcecbec3c1_titleheader",OC="mcecbec3c1_thread_follow",RC="mcecbec3c1_headerwrapper",HC="mcecbec3c1_threads_classifier",$C="mcecbec3c1_loading",DC="mcecbec3c1_hv_align",LC="mcecbec3c1_error_info",PC="mcecbec3c1_error_img",BC="mcecbec3c1_infotxt",jC="mcecbec3c1_infotext_1",FC="mcecbec3c1_threads_highlighter",zC="mcecbec3c1_closed_threads",GC="mcecbec3c1_checkbox",qC="mcecbec3c1_checkboxsel",YC="mcecbec3c1_closedthread_icon",VC="mcecbec3c1_threads_listwrapper",ZC="mcecbec3c1_classifier_wrapper",KC="mcecbec3c1_close",XC="not_followed",JC="followed",QC=function(t){function e(e){t.call(this,e),this.state={selectedthreadfilter:1,follow_loading_state:!0,unfollow_loading_state:!0,list:[],include_closed_threads:this.props.include_closedthreads,searchtext:""},this.followed_list=[],this.unfollowed_list=[],this.followed_nexttoken,this.unfollowed_nexttoken,this.chatslist=[],this.msglist=[],this.search_pno=1,this.search_token=null,this.setThreadsFilter=this.setThreadsFilter.bind(this),this.toggleThreadsInclusion=this.toggleThreadsInclusion.bind(this),this.fetchNextSet=Bi(this.fetchNextSet,this,300),this.handleAutoFollowThreads=this.handleAutoFollowThreads.bind(this),this.onListItemClicked=this.onListItemClicked.bind(this)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.componentDidMount=function(){this.fetchThreadsList()},e.prototype.componentDidUpdate=function(e,t){if(t.searchtext!==this.state.searchtext&&(this.search_pno=1),t.selectedthreadfilter!==this.state.selectedthreadfilter||t.include_closed_threads!==this.state.include_closed_threads)if(this.state.searchtext){var s=t.searchtext!==this.state.searchtext;this.filterThreadsList(null,this.state.searchtext,s)}else this.fetchThreadsList(!0)},e.prototype.fetchNextSet=function(e){var t=e.target;t.scrollHeight-t.scrollTop<3*t.offsetHeight&&(this.state.searchtext?this.filterThreadsList(null,this.state.searchtext):this.fetchThreadsList())},e.prototype.getThreadsListType=function(){return"1"===this.state.include_closed_threads?"":"open"},e.prototype.getSelectedThreadsFilter=function(){return this.state.selectedthreadfilter},e.prototype.filterUniqueItems=function(e,s){return e.reduce(function(e,t){return e.some(function(e){return e[s]===t[s]})||e.push(t),e},[])},e.prototype.fetchThreadsList=function(s){var e=function(e){var t=JSON.parse(e);1===this.getSelectedThreadsFilter()?(s?this.followed_list=t.data:(this.followed_list=this.followed_list.concat(t.data),this.followed_list=this.filterUniqueItems(this.followed_list,"chat_id")),this.setState({follow_loading_state:!1,searchtext:""}),this.followed_nexttoken=t.next_token):(s?this.unfollowed_list=t.data:(this.unfollowed_list=this.unfollowed_list.concat(t.data),this.unfollowed_list=this.filterUniqueItems(this.unfollowed_list,"chat_id")),this.setState({unfollow_loading_state:!1,searchtext:""}),this.unfollowed_nexttoken=t.next_token)}.bind(this),t={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.Util.getCSRF()},i=1===this.getSelectedThreadsFilter()?JC:XC,n="parent_chat_id="+this.props.chatid+"&state="+i+"&limit=15";this.getThreadsListType()&&(n+="&type="+this.getThreadsListType()),this.followed_nexttoken&&1==this.state.selectedthreadfilter&&!s&&(n+="&next_token="+this.followed_nexttoken),this.unfollowed_nexttoken&&0==this.state.selectedthreadfilter&&!s&&(n+="&next_token="+this.unfollowed_nexttoken),(1==this.state.selectedthreadfilter&&(!this.followed_list.length||this.followed_nexttoken||s)||0==this.state.selectedthreadfilter&&(!this.unfollowed_list.length||this.unfollowed_nexttoken||s))&&Ie("v2/threads",n,e,null,null,null,t)},e.prototype.handleAutoFollowThreads=function(e,t){var s=e?"disable":"enable",i={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.Util.getCSRF()},n=Sr(this.props.chatid).oc_id,a="?auto_follow_threads="+s,o=this.props.chattitle;Ae("v1/channels/"+n+a,null,function(){t(),e?(WMSUI.showInfoMsg($("threadchat.autofollow.disable",[o])),Ar(this.props.chatid,"auto_follow_threads",!1)):(WMSUI.showInfoMsg($("threadchat.autofollow.enable",[o])),Ar(this.props.chatid,"auto_follow_threads",!0))}.bind(this),null,null,null,i)},e.prototype.onListItemClicked=function(e){var t=e.chat_id||e.chid||e.chid;this.props.handleListItemClick(t),this.props.unmountComponent()},e.prototype.getThreadsListHTML=function(){var e;this.state.searchtext&&(e=1===this.getSelectedThreadsFilter()?this.chatslist:this.msglist);var t=e||(1===this.getSelectedThreadsFilter()?this.followed_list:this.unfollowed_list),s=[];if(t.length)t.forEach(function(e){e.LASTMSGINFO=e.last_message_information?JSON.parse(e.last_message_information):e.lastmsginfo?JSON.parse(e.lastmsginfo):"",e.desc=e.message||e.fname,e.htmldesc=So(e),e.imgsrc=_WMSPHOTOSERVER+"/file?ID="+e.parent_message_sender+"&t=user&height=30&width=30",e.threadicon="open"===e.thread_state?"thread":"closedthread",e.title=e.title||e.ctitle;var t=e.chat_id||e.chatid||e.chid;s.push(k(Wa,{id:t,item:e,onListItemClicked:this.onListItemClicked}))}.bind(this));else{var i="https://img.zohocdn.com/ichat/images/bar/3b3dce50_followed.svg",n=$("threads.follow.empty");0===this.getSelectedThreadsFilter()&&(i="https://img.zohocdn.com/ichat/images/bar/981cba22_unfollowed.svg",n=$("threads.unfollow.empty")),s.push(k("div",{class:LC+" "+DC},k("img",{class:PC,src:i}),k("div",{class:BC},k("div",{class:jC},n))))}return k("div",{class:VC,onscroll:this.fetchNextSet},s)},e.prototype.setThreadsFilter=function(e){"follow_section"===Ei(e).getAttribute("data-id")?(this.setState({selectedthreadfilter:1}),this.state.searchtext&&(this.search_pno=1)):(this.setState({selectedthreadfilter:0}),this.state.searchtext&&(this.search_token=null))},e.prototype.toggleThreadsInclusion=function(){var e="0"==this.state.include_closed_threads?"1":"0",t=function(){this.setState({include_closed_threads:e}),this.props.updateClosedThreadsInclusion(e)}.bind(this);Te("updbsettings.do","include_closed_threads="+e,t)},e.prototype.filterThreadsList=function(e,t,s){var i=e&&Ei(e).value?Ei(e).value:t;if(i){var n=this;if(this.state.selectedthreadfilter){this.search_token=null===this.search_token||""==this.search_token&&e&&i?(new Date).getTime():this.search_token;var a="parent_chid="+this.props.chatid+"&title="+i+"&limit=10&totime="+this.search_token;""===this.search_token&&!s||Ie("v1/chats",a,function(){var e=JSON.parse(this.response).data;i&&e.matched_search_value===i&&e.chats?(10<=e.chats.length?n.search_token=e.chats[e.chats.length-2].lmtime-1:n.search_token="",n.chatslist=n.search_token||t?n.chatslist.concat(e.chats):e.chats):n.chatslist=[],n.chatslist=n.filterUniqueItems(n.chatslist,"chatid"),n.setState({searchtext:i,follow_loading_state:!1})})}else{var o="parent_chid="+this.props.chatid+"&message="+i+"&lim=10&pno="+this.search_pno;0===n.search_pno&&!s||Ie("v1/messagesearch",o,function(){var e=JSON.parse(this.response).data;i&&e.matched_search_value===i&&e.messages?(n.msglist=1<n.search_pno?n.msglist.concat(e.messages):e.messages,10<=e.messages.length?n.search_pno++:n.search_pno=0):n.msglist=[],n.msglist=n.filterUniqueItems(n.msglist,"msguid"),n.setState({searchtext:i,unfollow_loading_state:!1})})}t||n.setState({searchtext:i,follow_loading_state:!0,unfollow_loading_state:!0})}else this.setState({searchtext:"",selectedthreadfilter:1,follow_loading_state:!1,unfollow_loading_state:!1})},e.prototype.render=function(e){var t="",s="",i=this.state.searchtext?$("threads.header.title"):$("threads.list.follow"),n=this.state.searchtext?$("messages.header.title"):$("threads.list.unfollow"),a="1"==this.state.include_closed_threads?qC:GC,o=k("div",{class:VC},k("div",{class:$C+" "+DC}));(1===this.getSelectedThreadsFilter()&&!this.state.follow_loading_state||0===this.getSelectedThreadsFilter()&&!this.state.unfollow_loading_state)&&(o=this.getThreadsListHTML()),1===this.getSelectedThreadsFilter()?t=FC:s=FC;var r=k("div",{class:HC,onclick:this.setThreadsFilter},k("div",{"data-id":"follow_section",class:t},i),k("div",{class:s},n)),l=k("div",null,k("div",{class:ZC},k(Aa,{searchplaceholder:$("threads.search.msg"),handleChange:this.filterThreadsList.bind(this),searchvalue:this.state.searchtext}),k("div",{class:zC,onclick:this.toggleThreadsInclusion},k("span",{class:a}),k("input",{type:"checkbox"}),k("label",null,k("span",{class:YC}),$("threads.include.closed"))),r),o),d=e.chattitle+" - "+$("threads.header.title"),c=Sr(this.props.chatid).auto_follow_threads,m=k("div",{class:RC},k("div",{class:kC},d),k("div",{class:OC},$("thread.follow.auto"),k(xC,{button_state:c,handleChange:this.handleAutoFollowThreads}))),u={customHeaderStyle:NC,customButtonStyle:KC};return k(et,{callbackOnClose:e.unmountComponent,heading:m,customDialogStyles:u},l)},e}(M);return SC.prototype.mountComponent=function(e,t,s,i,n){this.node=document.createElement("div"),document.body.appendChild(this.node),O(k(QC,{ref:function(e){this.instance=e}.bind(this),chatid:e,chattitle:t,include_closedthreads:s,updateClosedThreadsInclusion:i,handleListItemClick:n,unmountComponent:this.unmountComponent}),this.node)},SC.prototype.unmountComponent=function(){O("",this.node),this.node.parentElement&&this.node.parentElement.removeChild(this.node)},e.Ajax=Re,e.BadgeImage=fo,e.Bots=Yt,e.Button=h,e.Calendar=P,e.ChannelPreview=Th,e.Channels=Yr,e.ChartEventHandler=sf,e.Charts=Af,e.ChartsConstants=ug,e.ChartsTemplates=pg,e.ChartsUtility=Pg,e.Chats=ya,e.Config=H,e.ConfirmationDialog=Pl,e.Consents=It,e.Cookie=he,e.CustomEmoji=ti,e.DataObject=be,e.DatePicker=_n,e.DateUtil=de,e.DesktopNotification=B,e.Dialog=function(e){O(k(et,{nodeToBeFocusedOnClose:e.nodeToBeFocusedOnClose,headerhtml:e.headerhtml,heading:e.heading,actions:e.actions,footerinfoprefix:e.footerinfoprefix,footerinfosuffix:e.footerinfosuffix,customDialogStyles:e.customDialogStyles,callbackOnClose:e.callbackOnClose,ignoreFocusOnMount:e.ignoreFocusOnMount},e.content),document.body)},e.DialogView=et,e.Drafts=Bl,e.DurationSelector=pu,e.DynamicActions=Xp,e.ForkChat=Ou,e.FormFileShare=pm,e.Forms=Zm,e.ForwardMsg=$u,e.HybridSearch=ur,e.I18N=$,e.IntegrationsData=tt,e.ListViewComponent=Ia,e.Markdown=Wt,e.Matcher=ge,e.Message=$f,e.MessageActions=Vl,e.MessageList=WC,e.Moveable=Jn,e.MsgUtil=Xr,e.MultiSelectList=xa,e.MultiSelectorListDialogComponent=Ea,e.NotificationOwner=function(e,t,i){var n,s=1,a=2,o=3,r="com_"+e+"_owner",l=""+(new Date).getTime(),d=t&&document.location.hostname.split(".").splice(1).join(".");function c(e){if(clearTimeout(n),n=setTimeout(c,4e3),i||e||u()||m()===o){var t=me(r);if(t&&-1!==t.indexOf("_f")&&!0!==i)return;var s=l;i&&(s+="_f"),ce(r,s,1e4,d)}}function m(){var e=me(r);return""===e?o:e===l||e===l+"_f"?s:a}function u(){return m()===s}return i=i||!1,c(),window.addEventListener("focus",c),{isOwner:u,clearOwnerSync:function(){clearTimeout(n),ue(r,d)}}},e.Participants=uo,e.PinMsgDialog=xu,e.ProfileInfo=xh,e.ReadReceiptList=Vp,e.RecentChats=io,e.ReminderPopup=Tp,e.RemindersDialog=ap,e.SearchContainer=Aa,e.SearchContainerComponent=Ta,e.SecurityManager=xt,e.StarOptions=Of,e.ThreadsList=SC,e.Time=En,e.ToggleButton=xC,e.UrlConsent=Xm,e.UrlPreview=Tl,e.Users=Ns,e.Util=Wn,e.VideoPlayer=Qn,e.VideoPlayerFactory=oa,e.ViewParticipants=ip,e.ViewReactions=Lu,e.VoiceRecorderApi=Ah,e.WmsConstants=He,e.WmsContacts=Es,e.WmsLocalStorage=ve,e.WmsOrgContacts=Je,e.WmsSessionStorage=Ce,e.Zomoji=si,e.ZomojiComponent=wn,e.addMessageActionToList=function(e){Yl.isinitialized&&Yl.data.push(e)},e.removeMessageActionFromList=function(e){if(Yl.data.length)for(var t=0;t<Yl.data.length;t++)e.id==Yl.data[t].id&&Yl.data.splice(t,1)},e.template=$s,e.updateLinkPreviewSettings=uu,e}({}))||{}).VirtualList=function(e){var t=e&&e.w+"px"||"100%",s=e&&e.h+"px"||"100%",a=this.itemHeight=e.itemHeight;this.excessHeightObj={},this.items=e.items,this.generatorFn=e.generatorFn,this.hoverFunction=e.hoverFunction,this.totalRows=e.totalRows||e.items&&e.items.length;var i=$WC.VirtualList.createScroller(a*this.totalRows);this.container=e.container?e.container:$WC.VirtualList.createContainer(t,s),this.container.appendChild(i);var o=Math.ceil(e.h/a);if(this.cachedItemsLen=4*o,0!=this.container.scrollTop){var n=parseInt(this.container.scrollTop/a)-o;n=n<0?Math.ceil(this.container.scrollTop/a):n,this.container.scrollTop=n*a,this._renderChunk(this.container,n)}else this._renderChunk(this.container,0);var r,l=this,d=o*a,c=0;this.onScroll=function(e){var t=e.target.scrollTop,s=l.container.querySelector("[data-id]");if(!r||s.getAttribute("data-select")&&0!=s.getAttribute("data-rc")||Math.abs(t-r)>d){var i=l.container.querySelector("[data-select]"),n=parseInt(t/a)-o;l._renderChunk(l.container,n<0?0:n),(i=i?l.container.querySelector('[data-rc="'+i.getAttribute("data-rc")+'"]:not([data-rm])'):"")&&l.hoverFunction(i),r=t}c=Date.now(),e.preventDefault&&e.preventDefault(),null==l.rmNodeInterval&&(l.rmNodeInterval=setInterval(function(){if(100<Date.now()-c)for(var e=this.container.querySelectorAll('[data-rm="1"]'),t=0,s=e.length;t<s;t++)this.container.removeChild(e[t])}.bind(l),300)),$WC.Util.debounce(function(){clearInterval(l.rmNodeInterval),l.rmNodeInterval=null},l,1e3)},this.clearRmNodeInterval=$WC.Util.debounce(function(){clearInterval(this.rmNodeInterval),this.rmNodeInterval=null},this,1e3),this.remove_event_listeners=function(){this.container.removeEventListener("scroll",this.onScroll),this.container.removeEventListener("scroll",this.clearRmNodeInterval)},this.container.addEventListener("scroll",this.onScroll),this.container.addEventListener("scroll",this.clearRmNodeInterval)},$WC.VirtualList.prototype.createRow=function(e){var t;if(this.generatorFn)t=this.generatorFn(e);else if(this.items)if("string"==typeof this.items[e]){var s=document.createTextNode(this.items[e]);(t=document.createElement("div")).style.height=this.itemHeight+"px",t.appendChild(s)}else t=this.items[e];$WC.Util.isArray(t)&&(this.excessHeightObj[e]=t[1],t=t[0]);var i=0;for(var n in this.excessHeightObj)n<e&&(i+=this.excessHeightObj[n]);return t.style.position="absolute",t.style.top=e*this.itemHeight+i+"px",$WC.Util.setAttribute(t,"data-rc",e),t},$WC.VirtualList.prototype._renderChunk=function(e,t){var s=t+this.cachedItemsLen;s>this.totalRows&&(s=this.totalRows);for(var i=document.createDocumentFragment(),n=t;n<s;n++)i.appendChild(this.createRow(n));for(var a=1,o=e.childNodes.length;a<o;a++)e.childNodes[a].style.display="none",e.childNodes[a].setAttribute("data-rm","1");e.appendChild(i)},$WC.VirtualList.createContainer=function(e,t){var s=document.createElement("div");return s.style.width=e,s.style.height=t,s.style.overflow="auto",s.style.position="relative",s.style.padding=0,s.style.border="1px solid black",s},$WC.VirtualList.createScroller=function(e){var t=document.createElement("div");return t.style.opacity=0,t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.width="1px",t.style.height=e+"px",t};var $WC=$WC||{},ie=!(op=/opera|opera 5|opera\/5/i.test(navigator.userAgent))&&/msie/i.test(navigator.userAgent);$WC.$CUtil={processXSS:function(e,t){return e?(t||(e=$WC.Util.decodeHTMLEntities(e)),e.replace(/&/g,"&amp;").replace(/\"/g,"&quot;").replace(/\'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")):e},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},getNextRotationalNode:function(e,t){return 39===t||40===t?e.nextSibling||e.parentNode.firstChild:37===t||38===t?e.previousSibling||e.parentNode.lastChild:void 0},center:function(e){if(e){var t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,s=e.offsetHeight,i=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n=e.offsetWidth,a=e.style,o=t<s?0:(t-s)/2,r=i<n?0:(i-n)/2;a.top=o+"px",a.left=r+"px"}},removeAllClass:function(e,t){if(e){var s=e.querySelectorAll("."+t),i=s.length;if(i)for(var n=0;n<i;n++)$WC.Util.removeClass(s[n],t)}},cloneArray:function(e){return e.slice(0)},setInnerTextById:function(e,t){return $WC.$CUtil.setInnerText(document.getElementById(e),t)},setInnerText:function(e,t){e&&(document.getElementsByTagName("body")[0].textContent?e.textContent=t:e.innerText=t)},getConditionalNextNode:function(n,e,t){function s(e,t){if(n[t]){if(n[t].getAttribute(e))return n[t];for(var s=n[t];s;){if(s.getAttribute(e))return s;s=s[t]}}var i=n.parentNode.querySelectorAll("["+e+"]");if(i&&1<i.length){if("nextSibling"===t)return i[0];if("previousSibling"===t)return i[i.length-1]}return n}return 39===e||40===e||9===e?s(t,"nextSibling"):37===e||38===e?s(t,"previousSibling"):void 0},removeEvent:function(e,t,s){e.detachEvent?e.detachEvent("on"+t,s):e.removeEventListener?e.removeEventListener(t,s,!0):e["on"+t]=null},isScrolledIntoView:function(e,t,s){var i=t.getBoundingClientRect().top,n=t.getBoundingClientRect().bottom,a=e.getBoundingClientRect().top,o=e.getBoundingClientRect().bottom;return!(0===i&&0===n||0===a&&0===o)&&(s?i<=o&&a<=n:i<=a&&o<=n)},preventHandlingTabUpDownEnter:function(e){e.keyCode!==$WC.WmsConstants.KEYCODES.DOWN&&e.keyCode!==$WC.WmsConstants.KEYCODES.UP&&e.keyCode!==$WC.WmsConstants.KEYCODES.ENTER&&e.keyCode!==$WC.WmsConstants.KEYCODES.TAB||e.preventDefault()},hasClass:function(e,t){return new RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className)},hasFocus:function(e){if(e)return e===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},getAttribute:function(e,t){if(e&&"function"==typeof e.getAttribute)return e.getAttribute(t)},getDirectText:function(e){for(var t=e.firstChild,s=[];t;)3==t.nodeType&&s.push(t.data),t=t.nextSibling;return s.join("")},getDirectTextFromHtmlString:function(e){var t=document.createElement("div");t.innerHTML=e;for(var s=t.firstChild,i=[];s;)3==s.nodeType?i.push(s.data):i.push(s.textContent),s=s.nextSibling;return i.join("")},createOverlay:function(e){if(null==document.getElementById("wms-overlay")){var t=document.createElement("div");t.id="wms-overlay",t.className="wms-overlay",t.onclick=e,t.style.zIndex=$WC.Config.get("zindex");var s=document.getElementById("wmstoolbar");s?document.body.insertBefore(t,s.nextSibling):document.body.appendChild(t)}},removeOverlay:function(){var e=document.getElementById("wms-overlay");e&&e.parentNode.removeChild(e)},getAspectRatioFit:function(e,t,s,i,n){var a=[s/e,i/t];return a=Math.min(a[0],a[1]),!n&&1<a?{width:e,height:t}:{width:e*a,height:t*a,ratio:a}},getBrowserName:function(){var e=navigator.userAgent.toLowerCase();return $WC.Matcher.check("firefox_useragent_lowercase",e)?"firefox":$WC.Matcher.check("opera_useragent_lowercase",e)?"opera":$WC.Matcher.check("chrome_useragent_lowercase",e)?"chrome":$WC.Matcher.check("safari_useragent_lowercase",e)?"safari":$WC.Matcher.check("ie_useragent_lowercase",e)?"ie":void 0},isChrome:function(){return"chrome"===this.getBrowserName()},isFirefox:function(){return"firefox"===this.getBrowserName()},isSafari:function(){return"safari"===this.getBrowserName()},isIEVersion11:function(){var e=navigator.userAgent.toLowerCase();if(0<e.indexOf("trident/")){var t=e.indexOf("rv:");return"11"==e.substring(t+3,e.indexOf(".",t))}},checkAndUpdateLocationPermissionStatus:function(){"undefined"!=typeof navigator&&void 0!==navigator.permissions&&navigator.permissions.query({name:"geolocation"}).then(function(e){$WC.Config.get("LOCATION_INFO").PERMISSIONSTATE=e.state,e.onchange=function(){$WC.Config.get("LOCATION_INFO").PERMISSIONSTATE=e.state}})},chatTypes:{CHANNEL:1,DEFAULT_BOT:"B1",CUSTOM_BOT:"B2"}},($WC=$WC||{}).Functions={},$WC.Functions.init=function(){Gator(document).on("click","[custombuttonclick_onmsg],[zc-quickbutton]",function(l){$WC.CMsgUtil.handleButtons(this,l,function(e,t,s,i){if(l.target.getAttribute("data-cmsgbtn")){var n=l.target,a=$WC.Util.createElement("span","wms_cmsg_loader","wms_cmsg_loader");n.className+=" wms_cmsg_loadingon",n.parentElement.style.pointerEvents="none",n.appendChild(a);var o=function(){$WC.Util.removeElement(a),n.className="cmsg-btn",n.parentElement.style.pointerEvents=""}}var r=$WC.Functions.isTempResponse(l.target,t,s);$WC.Functions.execute(e,t,s,i,r,l.type,o)})})},$WC.Functions.execute=function(t,s,e,i,n,a,o){var r="chid="+s+"&msgid="+e+"&fname="+t+"&btnindex="+i+"&isTempResponse="+n+"&event="+a,l=document.getElementById("buttonconfirminput");l&&(r+="&input="+l.value);var d={"x-consents-version":"1","X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.Util.getCSRF()};$WC.Ajax.postRequestToChat("executefunction.do",r,function(){var e=JSON.parse(this.response)[0].objString;$WC.Functions.handleExecuteFuncCallback(s,t,e),o&&o()},null,null,null,d)},$WC.Functions.handleExecuteFuncCallback=function(t,s,e){if("Consent"===e.status)(new $WC.Consents).mountComponent(t,e,function(e,t){$WC.Functions.handleExecuteFuncCallback(e,s,t.data.dreResponse)});else if("Success"===e.status){var i=e.output;if(i)if(i.widget){var n=JSON.parse(i.widget);$WC.Widgets.construct(n)}else if((i.text||i.msg)&&"function"==typeof $WC.Functions.showResponse)$WC.Functions.showResponse(e.output,t);else if(i.actions){$WC.Channels.initChannels(),(new $WC.Forms).mountComponent(e,Commands.showResponse,function(){var e=WindowHandler.getWinObjById(t);e&&e.composer.focus()})}}else if("Failure"===e.status&&"function"==typeof $WC.Functions.showErrorResponse)if($WC.Util.isEmpty(e.resumeUrl))$WC.Functions.showErrorResponse(e,t);else{if(null===document.getElementById("zcwindows")){var a=document.createElement("div");a.id="zcwindows",a.className="zcoverlay",a.style.zIndex=WebMessanger.setzindex,document.body.appendChild(a)}var o="<b>"+e.connectionDetails.serviceName+"</b>",r="<b>"+s+"</b>";$WC.$Dlg.confirm({id:"wms_oauthprompt",bodyhtml:$WC.I18N("common.access.permission",[r,o]),imagehtml:"<img src="+e.connectionDetails.imageUrl+">",buttons:[{text:$WC.I18N("common.authenticate"),action:function(){window.open(e.resumeUrl)}}]})}};var WmsImplHandler={};function WmsResource(){this.MessageObject}WmsImplHandler.invoke=function(){var t=arguments;setTimeout(function(){var e=Array.prototype.slice.call(t,1);"function"==typeof t[0]&&t[0].apply(null,e)},1)},WmsImplHandler.invokeSynchronously=function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);if("function"==typeof e)try{return e.apply(null,t)}catch(e){setTimeout(function(){throw e},1)}},WmsResource.init=function(){this.MessageObject={},this.MessageObject["connectionerror.chatfail"]="Chat not reachable.",this.MessageObject["connectionerror.netfail"]="Internet not reachable.",this.MessageObject["connectionerror.reconnect"]="Reconnecting",this.MessageObject["connectionerror.reconnecttime"]="Reconnecting in $1",void 0!==$WC&&$WC.template&&$WC.template.setResource(WmsResource)},WmsResource.getRealValue=function(e,t){try{var s="";return((s=null==this.MessageObject[""+e]||null==this.MessageObject[""+e]?e:this.MessageObject[e])&&s.length&&(s=s.replace(/_/g," ")),null==t)?s||"":s=WmsResource.replaceParams(s,t)}catch(e){setTimeout(function(){throw e},1)}try{return e.replace(/_/g," ")}catch(e){return""}},WmsResource.getRealData=function(t,e){try{var s=t.trim();return s=(s=s.replace(/ /g,"_")).replace(/\.$/,""),WmsResource.getRealValue(s,e)}catch(e){return t}},WmsResource.getTrimmedValue=function(e,t){var s=WmsResource.getRealValue(e,t);return s=s.replace(/\s/g,"&nbsp;")},WmsResource.replaceParams=function(e,t){t instanceof Array||(t=t.split(","));for(var s=0;s<t.length;s++){var i=t[s],n=new RegExp("\\$"+(s+1),"g");e=e.replace(n,i)}return e},WmsResource.init();var _WMSCFPARAMNAME,wmsnotifyowner,_WMSAPPACCOUNTID,_UPLOADSERVERURL,_DOWNLOADSERVERURL,_WMSRTCATOKEN,_WMSAUTHTOKEN,_WMSAUTHSCOPE,_WMSZAID,_WMSPOTYPE,_WMSOAUTHTOKEN,_WMSOAUTHORGSCOPE,_WMSOAUTHUSERSCOPE,_WMSOAUTHOPRSCOPE,op,dext=".sas",lfromstatic=!1,wmsjsversion="v265",silent=!1,WMSIAMURL=window.location.protocol+"//accounts.zoho.com",wmsmeetingurl=window.location.protocol+"//meeting.zoho.com",_WMSIAMTICKETNAME="IAMAGENTTICKET",_WMSMAILURL=window.location.protocol+"//zmail.zoho.com/",_WMSCHATURL=window.location.protocol+"//chat.zoho.com/",_WMSPHOTOSERVER=window.location.protocol+"//contacts.zoho.com",_WMSSALESIQSERVER=window.location.protocol+"//salesiq.zoho.com",_WMSCONFIG="15",_WMSCALENDARSERVER=window.location.protocol+"//calendar.zoho.com",_WMSCONT="_wms",_CHATCONT="_chat",_RTCCONT="_wmsrtc",_WMSDOMAIN="zoho.com",_WMS_SAMEDOMAIN=!1,_WMS_FORCEDOMAIN=!1,_WMS_NODOMAINCHANGE=!1,_CHATCFPARAMNAME="zchat_csrparam",_CHATCFTOKEN="CT_CSRF_TOKEN",_WMSDRAGDROP=!0,_WMSSST=!1,_RETRYREGINTERVAL=1e4,iswmsframemonitorrunning=!1,iswmsframeloaded=!1,retryregistertimer=null,wmsdebuginfo=[],_WMSWINFOCUS=!0,_WMSEMPTYBAR=!1,_PRIMETIMEHELPLINK="https://www.zoho.com/cliq/help/primetime/",_UDS_CLIQ_SERVICE="CLIQ",_UDS_RTC_SERVICE="rtcplatform",_NEWCLIENTPORTAL_AUTHENTICATION=!1,_WMS_LAZYLOAD_SCRIPT=!1,_isGSearchAppended=!1,_isVideoJSAppended=!1,_isCliqAVLibLoaded=!1,_WMSDISABLEAVCHAT=!1,_WMSOPENINCLIQ=!0,_WMS_RETRY_COUNT=0,_WMSORIGINALIMG_LOAD_TIMEOUT=250,_WMS_LP="false",_WMS_REQLOG=[],_TZOFFSET=-1*(new Date).getTimezoneOffset(),_WMSCHATHIDDEN=!1,_WMS_FETCHCHANNELSINITIATED=!1,opera_browser=op=-1!=navigator.userAgent.indexOf("Opera"),mz=(ie=!op&&/msie/i.test(navigator.userAgent),!op&&!ie&&/mozilla\/5/i.test(navigator.userAgent)),wms_sf=-1!=navigator.userAgent.indexOf("Safari"),WM_ACK_CONNECT=0,WM_INFO=1,WM_CUSTOM=2,WM_CROSSPRODUCT=4,WM_PRESENCE=6,WM_RECONNECT=-1,WM_SERVER_UP=-3,WM_NFY_LOGOUT=-2,WM_AUTH_FAILED=-5,WM_INVALID_AUTH_PARAMS=-12,PS_REG_ACK=-16,WM_INVALID_TOKEN=-17,WM_NFY_ATTACH=-8,WM_NFY_DETACH=-9,SHOW_INFO=-10,CT_JOIN=10,CT_TXT_MSG=12,CT_NFY_USERSTATUS=13,CT_NFY_USERADD=14,CT_NFY_USERDELETE=15,CT_INF_MSG=16,CT_NFY_APPROVAL=102,CT_ATT_MSG=20,WM_NFY_COLLABADD=21,WM_NFY_COLLABDELETE=22,CT_NFY_SETTITLE=19,WM_NFY_STATUS=23,WM_NFY_CSTATUSCHANGE=24,WM_NFY_USERIMGCHANGE=25,CONTACT_INFO=27,CT_CLOSE_WIN=28,WM_AV_MSG=29,WM_CLEAR_NOTI=32,CT_NFY_ACTCHATADD=50,CT_NFY_ACTCHATDELETE=34,WM_SKIPTRANS=36,WM_USER_LANG_CHANGE=37,WM_SYSTEM_MSG=38,ACS_MSG=43,WM_TICKET_MSG=46,CT_MSG_STORAGE=47,CT_ATTACH=49,WM_DEF_STATUS=54,CT_NFY_MUTECHAT=58,CT_BOT_LIST=60,CT_BOT_OPR=61,WM_ZTI_CROSSPRODUCT=62,CT_DELETED_MSG=63,CT_EDITED_MSG=64,CT_MSG_ADDL=70,CT_MSG_REACT=72,CT_MSG_REACT_CURR=73,CT_MSG_READRECEIPT=71,CT_NFY_MSG=112,NFY_USER_TYPING=104,NFY_USER_IDLE=105,NFY_USER_ENTERED=110,WM_ZTI_FAIL_MSG=601,WMS_ONLINE=1,WMS_INVISIBLE=2,CT_NFY_LIVESUPPORT=4,CT_NFY_ZOHOGROUP=5,NFY_REQ_CSUPPORT=106,NFY_ACC_CSUPPORT=108,NFY_QIT_CSUPPORT=109,NFY_ENDLIVESUPPORT=113,CT_GUEST_REQ=100,WM_PUB_SUB=800,PR_MSG=700,WM_WEBRTC_MSG=59,RTC_CUSTOMCHAT_CLOSE=80,CLIQ_AV_MSG=5e3,RTC_EVENT_MSG=901;function push(e){if(e.msg&&e.msg.msglist)for(var t=e.msg.msglist,s=Object.assign({},e),i=0;i<t.length;i++)delete s.msg.meta,delete s.msg.mod,s.msg=Object.assign(s.msg,t[i]),s.mtype=t[i].mtype,s.msg.meta&&0==$WC.Util.getObjectLength(s.msg.meta)&&delete s.msg.meta,WebMessanger.push(s);else WebMessanger.push(e);setTimeout(function(){WebMessanger.updateClientDebugStore(e)},1),WebMessanger.lastmessage=e,WebMessanger.lastmessagetime=new Date}function getPrd(){return WebMessanger.getPrd()}function getWmsConfig(){return _WMSCONFIG}function getUserName(){return WebMessanger.getUserName()}function getNickName(){return WebMessanger.getNickName()}function getZuid(){return WebMessanger.getZuid()}function getUserId(){return WebMessanger.getUserId()}function getSid(){return WebMessanger.getSid()}function getWmsXA(){return WebMessanger.XA}function _getAuthType(){return WebMessanger.authtype}function getAuthToken(){return _WMSAUTHTOKEN}function getAuthScope(){return _WMSAUTHSCOPE}function getZAID(){return _WMSZAID}function getRawSid(){return WebMessanger.getRawSid()}function getWmsContacts(){return WmsContacts.getcontacts()}function updateWmsContacts(e){WmsContacts.init(e)}function isReconnecting(){return WebMessanger.isReconnecting()}function disablewms(){WebMessanger.disable()}function isdisablewms(){return WebMessanger.isdisablewms()}function getWMSOAuthCredentials(){return{token:_WMSOAUTHTOKEN,orgscope:_WMSOAUTHORGSCOPE,userscope:_WMSOAUTHUSERSCOPE,oprscope:_WMSOAUTHOPRSCOPE}}function WebMessanger(){}function EventsUtil(){}function getNewClientPortalAuthentication(){return _NEWCLIENTPORTAL_AUTHENTICATION}WebMessanger.chatdeactivated=!1,WebMessanger.allprdchatdeactivated=!1,WebMessanger.chatdisabled=!1,WebMessanger.jsstaticdomain="js.zohocdn.com",WebMessanger.cssstaticdomain="css.zohocdn.com",WebMessanger.isIdle=!1,WebMessanger.smartchatshortcutdisabled=!1,WebMessanger.userslist,WebMessanger.forkedlist,WebMessanger.sync_adminsettings_onfocus=!1,WebMessanger.get_pinmsg_onfocus=!1,WebMessanger.is_create_channel_link_disabled=!1,WebMessanger.is_copy_message_link_disabled=!1,WebMessanger.is_set_reminder_option_disabled=!1,WebMessanger.prefetch_channels=!1,WebMessanger.is_zoho_links_settings_disabled=!1,WebMessanger.is_msgpin_option_disabled=!1,WebMessanger.resourceloaded=!1,WebMessanger.is_exclusive_chat=!1,WebMessanger.rtlmode=!1,WebMessanger.exclusive_chat_info={entity_id:"",chat_id:"",failure_callback:null},WebMessanger.guest_info={id:"",encrypt_id:"",chat_id:"",verification_url:"",chat_info:{},chat_info_fetched:!1},WebMessanger.rtc_chat_details={chat_id:""},WebMessanger.isNotebookFrameLoaded=!1,WebMessanger.methodsInCallbackQueue=[],WebMessanger.server_sync_time_diff,WebMessanger.is_screen_grabber_enabled=!1,WebMessanger.is_screengrabber_js_loaded=!1,WebMessanger.isDarkModeEnabled=!1,WebMessanger.network_info={},WebMessanger.is_custom_menu_opted=!1,WebMessanger.external_sound_notification_config_state=!0,WebMessanger.isTitleBlinkDisabled=!1,$WC.Util.addEvent(window,"beforeunload",function(e){if(_WMS_REQLOG.length){var t="Your message is being sent. Do you still want to leave this page?";return e.returnValue=t}}),$WC.Util.addEvent(window,"unload",function(){var e=WindowHandler.openedChats;for(var t in e){var s=WindowHandler.getWinObjById(t);!s||""==s.composer.value||WebMessanger.isExclusiveChat()||WebMessanger.isRTCChat()||$WC.Drafts.updateBeforeUnload(s)}}),Smiley=new $WC.Zomoji({default_size:"24",animation:{default_size:"24"}}),Smiley.init=function(){},Smiley.extrasmiley_lookup=Smiley.symbol_lookup,Smiley.defaultsmiley_lookup=Smiley.symbol_lookup,WmsContacts=Object.assign({},$WC.WmsContacts),WmsOrgContacts=$WC.WmsOrgContacts,WmsProfileInfo=new $WC.ProfileInfo,WebMessanger.checkNetworkAndUpdateBanner=function(){var e,t="https://img.zohocdn.com/ichat/images/a29a4f41_spacer.gif";return function(){void 0===e&&((e=$WC.Util.createElement("img")).style.display="none",document.body.appendChild(e),EventsUtil.attachonload.call(e,function(){document.getElementById("wmsbannertext")&&setTimeout(function(){document.getElementById("wmsbannertext").innerHTML=$WC.I18N("connectionerror.chatfail")},1)})),e.src=t+"?nocache="+(new Date).getTime()}}(),function(){var e=(new Date).getTime()+"_"+Math.floor(1e4*Math.random());window.getWmsTabId=function(){return WebMessanger.zuid+"_"+WebMessanger.prd+"_"+e}}(),WebMessanger.getDebugInfo=function(){return wmsdebuginfo},WebMessanger.updateDebugInfo=function(e){"string"==typeof e?(e+=";;"+(new Date).getTime(),300<=wmsdebuginfo.length&&wmsdebuginfo.splice(0,1),wmsdebuginfo.push(e)):wmsdebuginfo=e},WebMessanger.setOAuthCredentials=function(e,t,s,i){_WMSOAUTHTOKEN=e,_WMSOAUTHORGSCOPE=t||_WMSOAUTHORGSCOPE,_WMSOAUTHUSERSCOPE=s||_WMSOAUTHUSERSCOPE,_WMSOAUTHOPRSCOPE=i||_WMSOAUTHOPRSCOPE,"function"==typeof WebMessanger.updateOAuthCredInBridge&&WebMessanger.updateOAuthCredInBridge()},function(){var t=[];WebMessanger.updateClientDebugStore=function(e){1e3<=t.length&&t.shift(),e.timestamp=(new Date).getTime(),e.mtype&&"12"===e.mtype&&e.msg&&(e.msg.msg="******"),t.push(e)},WebMessanger.getClientDebugStore=function(){return t}}(),function(){var s=[];WebMessanger.updateReminderInfo=function(e){var t=Object.keys(e)[0];100<=s.length&&s.shift(),!1===s.some(function(e){if(e.hasOwnProperty(t))return!0})&&s.push(e)},WebMessanger.getReminderInfo=function(t){var e=s.find(function(e){if(e.hasOwnProperty(t))return e});return e&&e[t]}}(),WebMessanger.postDebugInfoToServer=function(e,t){var s="zuid="+WebMessanger.zuid+"&wmsdebuginfo="+JSON.stringify(WebMessanger.getDebugInfo())+"&sid="+WebMessanger.sid+"&rawsid="+WebMessanger.rawsid;t&&(s+="&source="+t),-1===document.location.hostname.indexOf(".manageengine.com")&&$WC.Ajax.postRequestToChat("printlog.do",s,function(){e&&WMSUI.showInfoMsg("Debug info sent successfully!")})},WebMessanger.disableTitleBlink=function(){WebMessanger.isTitleBlinkDisabled=!0},WebMessanger.showBanner=$WC.Util.throttle(function(e,t){WebMessanger.offline=!0,WebMessanger.checkNetworkAndUpdateBanner();var s=!(WMSUI.isBannerShown("wms-netdownbanner")&&!WebMessanger.initcountdown);(WebMessanger.initcountdown=!1)===iswmsframeloaded?(WMSUI.showBanner(WebMessanger.forceRegister),WebMessanger.reconnectTimer(s,WebMessanger.retryRegister,e,t)):(WMSUI.showBanner(WebMessanger.forceReconnect),WebMessanger.reconnectTimer(s,WebMessanger.triggerbind,e,t))},null,4e3),WebMessanger.hideBanner=function(){WebMessanger.offline=!1,WMSUI.hideBanner()},WebMessanger.init=function(e){if(_WMS_NODOMAINCHANGE||_WMS_SAMEDOMAIN||opera_browser||!(!ie||ie&&_WMS_FORCEDOMAIN)||(document.domain=_WMSDOMAIN),void 0!==document.querySelector){var t=document.querySelector('script[src*="ichat"][src*="wmsbar"]');t&&(WebMessanger.jsstaticdomain=t.src.split("/")[2]);var s=document.querySelector("link[href*=wmsbar]");s&&(WebMessanger.cssstaticdomain=s.href.split("/")[2])}silent=e,void 0===this.countrycode&&(this.countrycode="US"),void 0===this.language&&(this.language="en"),"ar"==this.language&&WebMessanger.enableRTLMode(),void 0===this.rebrand&&(this.rebrand=""),void 0===this.meeting&&(this.meeting=!0),void 0===this.theme&&(this.theme="grey"),void 0===this.setzindex&&(this.setzindex=999),void 0===this.disablenetworkdownbanner&&(this.disablenetworkdownbanner=!1),WebMessanger.statusarr=new Array("Offline","Available","Invisible","Busy","Idle","dnd","Away"),WebMessanger.scodearr=new Array(0,1,3,4,5,7),WebMessanger.wmsservicestatus=!0,WebMessanger.offline=!0,WebMessanger.locationurl=window.location.href,WebMessanger.disablewms=!1,WebMessanger.showbannertime=0,WebMessanger.showchatbannertime=0,WebMessanger.lastmessage="",WebMessanger.lastmessagetime="",WebMessanger.reconnectPrevlimit=30,WebMessanger.isPresenceEnabled()&&(setTimeout(function(){WMSUI.runIdleTimer()},10),setTimeout(function(){WMSUI.checkDocumentActive()},20)),WMSUI.init(),WebMessanger.systemdown=!1,WebMessanger.ucmap={},WebMessanger.waitchats={},WebMessanger.liveChats=new Array,WebMessanger.chatmap={},WebMessanger.threadmap={},WebMessanger.unreadthreadmap={}},WebMessanger.forceRegister=function(){WebMessanger.initcountdown=!0,document.getElementById("recntime").innerHTML=$WC.I18N("connectionerror.reconnect"),WebMessanger.retryRegister()},WebMessanger.forceReconnect=function(){WebMessanger.initcountdown=!0,document.getElementById("recntime").innerHTML=$WC.I18N("connectionerror.reconnect"),WebMessanger.triggerbind()},WebMessanger.reconnectTimer=function(){var a=[30,60,90,120,300],o=0;function r(e,t){return e=+e,t=+t,Math.floor(Math.random()*(t-e+1)+e)}return window.addEventListener("online",function(){o=-1}),function(e,t,s,i){e?a[o=0]=r(5,30):o<a.length-1&&o++;var n=a[o];s&&(n=r(s,i=i||s)),WMSUI.showCountDownInBanner(n,t)}}(),WebMessanger.reconnect=function(e,t,s){null!=s&&1==s&&(this.reconnecting=!1),1!=this.reconnecting&&(this.reconnecting=!0,null==this.retry&&(this.retry=0),this.retry++,setTimeout(function(){WebMessanger.registerWms(WebMessanger.prd,WebMessanger.zuid,WebMessanger.uname,WebMessanger.nname,silent,!0)},e),WebMessanger.serverdown(),WMSUI.RestartTimers())},WebMessanger.isReconnecting=function(){return this.reconnecting},WebMessanger.registerZuid=function(e,t,s,i){WebMessanger.registerWms(e,t,s,null,i)},WebMessanger.registerAnnon=function(e,t,s,i){WebMessanger.disableContacts(),WebMessanger.disableGroups(),WebMessanger.disableActiveChat(),WebMessanger.disableProfile(),WebMessanger.disableMeeting(),WebMessanger.disableNotification(),WebMessanger.disableCWActions(),WebMessanger.disableSmartChat(),this.registerAnnonUser=!0,WebMessanger.authtype=4,WebMessanger.registerWms(e,t,t,s,i)},WebMessanger.register=function(e,t,s,i,n,a,o,r,l){if("undefined"==typeof JSON){var d=$WC.Util.createElement("script"),c=window.location.protocol,m="https:"===c?wmsjsversion+"_https":wmsjsversion;d.type="text/javascript",d.src=c+"//"+this.jsstaticdomain+"/ichat/"+m+"/js/0ea6dc8b_json2.min.js",document.body.appendChild(d),EventsUtil.attachonload.call(d,u)}else u();function u(){_WMSAUTHSCOPE=n,_WMSZAID=a,_WMSPOTYPE=o,(_WMSAUTHTOKEN=i)&&_WMSAUTHSCOPE&&(s=!0,WebMessanger.authtype=1),_WMSAUTHTOKEN&&_WMSZAID&&(s=!0,WebMessanger.authtype=8),_WMSZAID&&WebMessanger.tokenpairauth&&(s=!0,WebMessanger.authtype=10),_WMSOAUTHTOKEN&&(s=!0,WebMessanger.authtype=9),_WMSRTCATOKEN&&(WebMessanger.authtype=13),$WC.Util.isZuid(t)?WebMessanger.registerWms(e,t,null,null,s,null,l):WebMessanger.isRTCChat()?WebMessanger.registerWms(e,t,null,r,s,null,l):WebMessanger.registerWms(e,null,t,null,s,null,l)}},WebMessanger.showEmptyBar=function(){_WMSEMPTYBAR=!0},WebMessanger.disableToggleUI=function(){},WebMessanger.disableDragDrop=function(){_WMSDRAGDROP=!1},WebMessanger.setIamTicketName=function(e){_WMSIAMTICKETNAME=e},WebMessanger.setPhotoServer=function(e){_WMSPHOTOSERVER=window.location.protocol+"//"+e,$WC.Config.set({photoserver:_WMSPHOTOSERVER})},WebMessanger.setIamServer=function(e){WMSIAMURL=e},WebMessanger.setChatServer=function(e){_WMSCHATURL=window.location.protocol+"//"+e+"/"},WebMessanger.setMailServer=function(e){_WMSMAILURL=window.location.protocol+"//"+e+"/"},WebMessanger.setCalendarServer=function(e){_WMSCALENDARSERVER=window.location.protocol+"//"+e},WebMessanger.setTheme=function(e){},WebMessanger.setDomain=function(e){_WMSDOMAIN=e},WebMessanger.isChatPaused=function(){return WebMessanger.chatdeactivated||WebMessanger.allprdchatdeactivated||WebMessanger.chatdisabled},WebMessanger.disableAudioVideoChat=function(){_WMSDISABLEAVCHAT=!0,$WC.Config.set({_WMSDISABLEAVCHAT:!0})},WebMessanger.disableOpenInCliq=function(){_WMSOPENINCLIQ=!1},WebMessanger.getDomain=function(){return _WMSDOMAIN},WebMessanger.getServiceName=function(){return this.servicename},WebMessanger.setConfig=function(e){_WMSCONFIG=e},WebMessanger.setChatBarPrimaryColor=function(e){document.documentElement.style.setProperty("--wms-primary-color",e)},WebMessanger.loadSalesIQJS=function(){if(wmsUserConfig.salesiqjsurl&&"1"===WmsSettings.salesiq_chatbar&&wmsUserConfig.salesiq_enabled_prdlist&&-1!==wmsUserConfig.salesiq_enabled_prdlist.split(",").indexOf(WebMessanger.prd)&&!silent){var e=document.getElementsByTagName("head");e&&0!=e.length||((e=[])[0]=$WC.Util.createElement("head"),document.insertBefore(doc.body,e[0]));var t=$WC.Util.createElement("script");t.defer=!0,t.src=wmsUserConfig.salesiqjsurl,t.onload=function(){WmsMainUI.applyChatBarOptions()},e[0].appendChild(t)}},WebMessanger.setSalesIQServerURL=function(e){_WMSSALESIQSERVER=window.location.protocol+"//"+e},WebMessanger.getSalesIQServerURL=function(){return _WMSSALESIQSERVER},WebMessanger.initCliqAVManager=function(){var e=wmsUserConfig.cliq_avlibrary_jsurl.substring(0,wmsUserConfig.cliq_avlibrary_jsurl.indexOf("/chat")),t={constants:{ZUID:$WC.Config.get("zuid"),_AV_BETA_TESTERS:"-1",MEDIADEFAULTSTATICURL:e+"/chat/source/officechat/sound/default",IMGDEFAULTSTATICURL:e+"/chat/source/officechat/images/default",PHOTOSERVER:_WMSPHOTOSERVER,tp_static_url:e+"/chat/tpv3",_CONNECTED:!0,IS_GUEST_USER:WebMessanger.isGuestUser(),IS_CUSTOM_DOMAIN:_WMS_SAMEDOMAIN},wms_status_api:function(){return!WebMessanger.systemdown},user_status_api:{isBusy:function(){return"3"==WebMessanger.scode}},settings_api:{get:function(e){return"globalsoundnotify"===e||"1"==WmsSettings.adminsettings[e]?1:0}},sound_manager:{play:function(e,t,s){var i=s&&s.loop||!1,n=s&&s.mildTone?.1:null;WmsSound.checkAndPlayTune(null,e,t,i,n,!0)},stop:function(e){WmsSound.stop()},preLoadFiles:function(e){WmsSound.preloadFiles(e)}},notification_api:{notify:function(e){WmsNotification.notifyNewCall(e.title,null,null,!1,e.icon,e.body)},notifyInTitle:function(){},revertTitle:function(){ChatBlink.stopRepeat(),$WC.DesktopNotification.close("call")}},users_api:{getName:function(e,t){return WmsContacts.getDisplayName(e)||t||""},getImgUrlById:function(e,t){return t=$WC.Matcher.check("imagesize",t)?t:"thumb",MediaCall.BRIDGE.Constants.PHOTOSERVER+"/file?ID="+e+"&exp=6000&t=user&fs="+t}},resource_api:{getRealValue:function(e,t){return $WC.I18N(e,t)}},handleCallInOldFlow:function(e,t,s,i){},get_z_index:function(){return $WC.Config.get("zindex")},get_sid:function(){return WebMessanger.getSid()},get_raw_sid:function(){return WebMessanger.getRawSid()},is_wms_owner:function(){return"WP"===WebMessanger.prd||"ZN"===WebMessanger.prd||wmsnotifyowner&&wmsnotifyowner.isOwner()},get_synced_current_time:function(){return Date.now()-WebMessanger.server_sync_time_diff},get_wms_rtt:function(e){WebMessanger.getWMSRTT(e)},server_config:WmsSettings.adminsettings&&WmsSettings.adminsettings.features&&WmsSettings.adminsettings.features.av_features,isDesktopApp:WmsImplHandler.invokeSynchronously(WmsUIImpl.isDesktopApp),desktopScreenCapturer:WmsImplHandler.invokeSynchronously(WmsUIImpl.isDesktopApp)&&WmsImplHandler.invokeSynchronously(WmsUIImpl.getScreenCapturerForAVCall),handleChatOpen:function(e,t){e?(WmsMainUI.scheduleAutoFocus(e),WmsHybridSearch.checkAndOpenChat($WC.WmsConstants.HYBRIDSEARCH.CHAT,null,null,null,null,null,e)):t&&(WmsMainUI.scheduleAutoFocus(t),WmsHybridSearch.checkAndOpenChat($WC.WmsConstants.HYBRIDSEARCH.CONTACT,t))}};window.MediacallManager=new ZCAVCallManager(t);window.$ZCAjx={ajax:function(s){var e=s.url;e="0"==e.indexOf("/")?e.substring(1):e;var t=s.type,i=s.data||{},n=s.contentType,a=s.headers||{};a["X-XHR-exception"]="true",a["X-ZCSRF-TOKEN"]=$WC.Util.getCSRF();var o="";if("application/json"==n)a["Content-Type"]="application/json",o=i;else{if(0==n)return void(ZCJQuery&&ZCJQuery.ajax&&ZCJQuery.ajax({url:"/"+_CHATCONT+"/"+e,type:"POST",data:i,headers:a,contentType:!1,processData:!1}));for(var r in i)o+=r+"="+i[r]+"&"}function l(e){var t="string"==typeof e&&""!=e?JSON.parse(e):e;this.getResponseHeader("x-cliq-av")?s.success(null,null,null,null,{"x-cliq-av":this.getResponseHeader("x-cliq-av")}):"function"==typeof s.success&&s.success(t)}function d(){var e="string"==typeof this.response&&""!=this.response?JSON.parse(this.response):this.response;"function"==typeof s.error&&s.error(e)}"PUT"===t?$WC.Ajax.putRequestToChat(e,o,l,d,null,null,a):"POST"===t?$WC.Ajax.postRequestToChat(e,o,l,d,null,null,a):"GET"===t?$WC.Ajax.requestToChat(e,o,l,d,null,null,a):"-1"!=e.indexOf("avversion")&&"function"==typeof s.success&&s.success(null,null,null,null,{"x-cliq-av":"upgrade"})}},MediacallManager.initialize(),MediaCall.setClientBridge(MediacallManager)},WebMessanger.loadAVLibrary=function(){if(!_WMSDISABLEAVCHAT&&!_isCliqAVLibLoaded){var i=document.getElementsByTagName("head");i&&0!=i.length||((i=[])[0]=$WC.Util.createElement("head"),document.insertBefore(doc.body,i[0]));var n=0;!function t(){var s=$WC.Util.createElement("link");s.rel="stylesheet";var e=wmsUserConfig.cliq_avlibrary_cssurl;WebMessanger.getZuid();void 0!==WmsSettings&&WmsSettings.adminsettings.av_library&&(e=window.location.protocol+WmsSettings.adminsettings.av_library.css_url),s.href=e,s.onload=function(){!function t(){var s=$WC.Util.createElement("script"),e=wmsUserConfig.cliq_avlibrary_jsurl;WebMessanger.getZuid(),void 0!==WmsSettings&&WmsSettings.adminsettings.av_library&&(e=window.location.protocol+WmsSettings.adminsettings.av_library.js_url),s.defer=!0,s.src=e,s.onload=function(){_isCliqAVLibLoaded=!0,WebMessanger.initCliqAVManager()},s.onerror=function(e){n<5&&setTimeout(function(){n+=1,$WC.Util.removeElement(s),t()},2*n*60*1e3)},i[0].appendChild(s)}()},s.onerror=function(e){n<5&&setTimeout(function(){n+=1,$WC.Util.removeElement(s),t()},2*n*60*1e3)},i[0].appendChild(s)}()}},EventsUtil.attachonload=function(e){void 0!==this.readyState?this.onreadystatechange=function(){"loaded"!=this.readyState&&"complete"!=this.readyState||e.call(this)}:this.onload=function(){e.call(this)}},WebMessanger.registerWms=$WC.Util.throttle(function(e,t,s,i,n,a,o){WebMessanger.prd=e,WebMessanger.uname=null!=s&&null!=s?s:"",WebMessanger.zuid=null!=t&&null!=t?t:"",WebMessanger.zuid=WebMessanger.zuid&&o?WebMessanger.setNetworkDetails(o):WebMessanger.zuid,_WMS_RETRY_COUNT++,WebMessanger.updateDebugInfo("onRegister. Tab ID: "+window.getWmsTabId()+" count: "+_WMS_RETRY_COUNT),void 0===WebMessanger.authtype&&WebMessanger.enableTokenPairAuth(),void 0===WebMessanger.nname&&(WebMessanger.nname=null!=i&&null!=i?i:""),null==a&&null==WebMessanger.settings&&(_WMSEMPTYBAR&&(n=!0),WebMessanger.init(null!=n&&n));var r=document.getElementById("pconnect");if(!r){var l=$WC.Util.createElement("iframe","pconnect");l.name="wmspconnect",l.style.display="none",document.body.appendChild(l),r=document.getElementById("pconnect")}var d=""!=WebMessanger.zuid?WebMessanger.zuid:WebMessanger.uname,c=!1;n&&!WebMessanger.silentOverriddenForAnnouncement||(c=!0);var m=WebMessanger.prd,u="/"+_WMSCONT+"/pconnect"+dext+"?prd="+m+"&uname="+d+"&samedomain="+_WMS_SAMEDOMAIN+$WC.Util.nocachefix(!0)+"&config="+_WMSCONFIG+"&settings="+c+"&wmscont="+_WMSCONT+"&nodomainchange="+_WMS_NODOMAINCHANGE+"&retrycount="+_WMS_RETRY_COUNT;lfromstatic&&(u+="&staticdomain="+WebMessanger.jsstaticdomain+"&staticversion="+wmsjsversion),_WMSSST&&(u+="&sst=true"),WebMessanger.tokenpairauth&&(u+="&tokenpair=true"),WebMessanger.frameorigin&&(u+="&frameorigin="+WebMessanger.frameorigin),WebMessanger.fp_hash&&(u+="&hash="+WebMessanger.fp_hash["wmsbridge.js"].split("_")[0]),_WMSZAID&&(u+="&zaid="+_WMSZAID),_WMSPOTYPE&&(u+="&potype="+_WMSPOTYPE),r.src=u,iswmsframeloaded=!1,WebMessanger.scheduleWMSFrameMonitor()},null,_RETRYREGINTERVAL),WebMessanger.scheduleWMSFrameMonitor=function(){iswmsframemonitorrunning||(iswmsframemonitorrunning=!0,clearTimeout(retryregistertimer),retryregistertimer=setTimeout(function(){WebMessanger.registerMonitor()},6*_RETRYREGINTERVAL))},WebMessanger.registerMonitor=function(){WebMessanger.offline=!0,WebMessanger.isReuseSession()?WebMessanger.retryRegister():WebMessanger.showBanner()},WebMessanger.clearWMSFrameMonitor=function(e){clearTimeout(retryregistertimer),iswmsframemonitorrunning=!1,e&&(WebMessanger.offline=!1,WebMessanger.isReuseSession()||WebMessanger.hideBanner())},WebMessanger.retryRegister=function(){WebMessanger.isReuseSession()&&!op&&top.WebMessanger.offline||WebMessanger.reconnect(0,"Retry Register",!0),clearTimeout(retryregistertimer),retryregistertimer=setTimeout(function(){WebMessanger.registerMonitor()},_RETRYREGINTERVAL)},WebMessanger.isReuseSession=function(){return(_WMSCONFIG&WMSSessionConfig.REUSE_SESSION)==WMSSessionConfig.REUSE_SESSION},WebMessanger.getZuid=function(){return this.zuid},WebMessanger.uisettingsconst={contacts:1,groups:2,activechats:4,notifications:8,settings:16,smartchat:32},WebMessanger.disableContacts=function(){WMSUI.contactsenabled=!1,WebMessanger.disabledmenus|=WebMessanger.uisettingsconst.contacts},WebMessanger.disableGroups=function(){WMSUI.groupsenabled=!1,WebMessanger.disabledmenus|=WebMessanger.uisettingsconst.groups},WebMessanger.disableActiveChat=function(){WMSUI.activechatenabled=!1,WebMessanger.disabledmenus|=WebMessanger.uisettingsconst.activechats},WebMessanger.disableProfile=function(){WMSUI.profileenabled=!1,WebMessanger.disabledmenus|=WebMessanger.uisettingsconst.settings},WebMessanger.disableNotification=function(){WMSUI.notificationenabled=!1,WebMessanger.disabledmenus|=WebMessanger.uisettingsconst.notifications},WebMessanger.disableSmartChat=function(){WMSUI.smartchatenabled=!1,WebMessanger.disabledmenus|=WebMessanger.uisettingsconst.smartchat},WebMessanger.disableCWActions=function(){this.disableCWAction=!0},WebMessanger.hideChatBar=function(){document.getElementById("wmstoolbar")&&(_WMSCHATHIDDEN=!0,document.getElementById("wmstoolbar").style.display="none")},WebMessanger.showChatBar=function(){document.getElementById("wmstoolbar")&&_WMSCHATHIDDEN&&(document.getElementById("wmstoolbar").style.display="block",_WMSCHATHIDDEN=!1)},WebMessanger.enableGlobalSearch=function(e){WMSUI.globalsearchenabled=!0,null!=e&&(WMSUI.hidegsicon=e)},WebMessanger.enablePhoneBridge=function(e){WMSUI.phonebridgeenabled=!0,WMSUI.phonebridgeconfig=e},WebMessanger.getPhoneBridgeConfig=function(){return WMSUI.phonebridgeconfig},WebMessanger.getPhoneBridgeContainer=function(){return document.getElementById("wmsphonebridge")},WebMessanger.disableNotebookWidget=function(){WMSUI.notebook_widget_disabled=!0},WebMessanger.setDateFormat=function(e){/^((dd|MM|y{2,4})( {0,1})\/( {0,1})(dd|MM)( {0,1})\/( {0,1})(dd|MM|y{2,4}))$/.test(e)&&$WC.Config.set({dateformat:e})},WebMessanger.getUserName=function(){return this.uname},WebMessanger.getNickName=function(){return this.nname},WebMessanger.setNickName=function(e){this.nname=e},WebMessanger.getUserId=function(){return this.uid},WebMessanger.getPrd=function(){return this.prd},WebMessanger.getSid=function(){return this.sid},WebMessanger.setSid=function(e){this.sid=e},WebMessanger.getRawSid=function(){return this.rawsid},WebMessanger.getRebrand=function(){return this.rebrand},WebMessanger.getUnreadFeeds=function(){$WC.Ajax.requestToChat("unreadzmsg.do")},WebMessanger.getPinnedChats=function(){if(!silent){var e={"x-consents-version":"1","X-XHR-exception":!0,"X-ZCSRF-TOKEN":$WC.Util.getCSRF()};$WC.Ajax.requestToChat("v2/pincategories","include_chats=true",function(){var e=this.response&&JSON.parse(this.response),t=[];if(e.data&&e.data.length)for(var s=0;s<e.data.length;s++)e.data[s].chats&&(t=t.concat(e.data[s].chats));var i=[];t&&t.forEach(function(e){if("onetoone"===e.type){var t=e.recipients_summary&&e.recipients_summary.split(",");t?e.recipants=[{zuid:t[0]},{zuid:t[1]}]:i.push(e.id),e.pcount=2}else"thread"===e.type&&i.push(e.id)}),i.length&&WebMessanger.getChatDataForPinnedChats(i.join(",")),$WC.RecentChats.updatePinnedChatList(e,!0,null,!0),$WC.RecentChats.setPinnedChatsLastFetchedTime(Date.now())},null,null,null,e)}},WebMessanger.getChatDataForPinnedChats=function(e){var t="chat_ids="+e,s={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.Util.getCSRF()};$WC.Ajax.requestToChat("v1/chats",t,function(){var e=this.response&&JSON.parse(this.response);$WC.RecentChats.updatePinnedChatList(e,null,!0),$WC.HybridSearch.populateRecentChats()},null,null,null,s)},WebMessanger.sendMailTranscript=function(e,t){var s="chid="+e+"&mailid="+encodeURIComponent(t);$WC.Ajax.postRequestToChat("sendtranscriptasmail.do",s)},WebMessanger.setStatus=function(e,t){if(!(4<e&&e<0)){$WC.I18N("Available")==t?t="Available":$WC.I18N("Busy")==t?t="Busy":2==e?t="Invisible":$WC.I18N("userstatus.away")==t?t="Away":$WC.I18N("userstatus.dnd")==t&&(status=t);var s="smsg="+encodeURIComponent(t)+"&scode="+e;$WC.Ajax.postRequestToChat("setstatus.do",s)}},WebMessanger.getStatusMessage=function(){$WC.Ajax.requestToChat("getdefaultstatus.do")},WebMessanger.syncStatusMessage=function(){var e=null;return $WC.Ajax.requestToChat("getdefaultstatus.do",null,function(){""!==this.responseText&&(e=JSON.parse(this.responseText)[0].objString)},null,null,!1),e},WebMessanger.getAllStatusMessage=function(){$WC.Ajax.requestToChat("getcstatus.do",null,null,function(){9005==JSON.parse(this.response)[0].objString.ERRCODE&&WMSUI.showErrorMsg($WC.I18N("status.change.notallowed"))},null,null,{"X-XHR-exception":"true"})},WebMessanger.getBarChatSettings=function(e){$WC.Ajax.requestToChat("getwmssettings.do","property="+encodeURIComponent(e))},WebMessanger.UpdateWmsSettings=function(e,t,s,i,n,a,o){var r="property="+encodeURIComponent(e)+"&key="+t+"&value="+s;r+=i?"&prd="+i:"",r+=n?"&opr="+n:"",$WC.Ajax.postRequestToChat("updwmssettings.do",r,a,o)},WebMessanger.updateSettings=function(e,t,s){$WC.Ajax.postRequestToChat("updbsettings.do",e,t,s,null,null,{"X-XHR-exception":"true"})},WebMessanger.clearCustomStatus=function(){$WC.Ajax.postRequestToChat("clearcstatus.do")},WebMessanger.clearReminder=function(e){var t="calid="+encodeURIComponent(e);$WC.Ajax.postRequest("clearreminder"+dext,t)},WebMessanger.getEditMsgHistory=function(e,t){var s={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.Util.getCSRF()},i="";i=WebMessanger.isGuestUser()?(s["x-cliq-guid"]=WebMessanger.guest_info.encrypt_id,"guestapi/v2/chats/"+e+"/transcript/"+t):"v2/chats/"+e+"/transcript/"+t,$WC.Ajax.requestToChat(i,null,function(){var e=JSON.parse(this.response).transcript;Message.updateEditMsgHistory(e)},null,null,null,s)},WebMessanger.getChatTranscript=function(e){var t=e||(new Date).getTime(),s="limit="+ZMSG_CHATCOUNT+"&totime="+t;ZMSG_USERID?(s=ZMSG_SEARCHVALUE&&"title="+ZMSG_SEARCHVALUE+"&",s+="recipient="+ZMSG_USERID+"&totime="+t):s+=ZMSG_SEARCHVALUE&&"&content="+ZMSG_SEARCHVALUE;function i(){if(!silent){var e=JSON.parse(this.response).data;e.chats&&0==e.chats.length&&(ZMSG_CHATPGNO="End");var t=document.getElementById("chathistorywin");ZMSG_transContent.querySelector("[errormsg=true]")&&$WC.Util.removeElement(ZMSG_transContent.querySelector("[errormsg=true]")),e.chats[0]&&t.querySelector('[cid="'+e.chats[0].chatid+'"]')&&1!=ZMSG_CHATPGNO&&e.chats.shift(),ZMSG_CHATS=e.chats,ZMSGUI.populate(e.chats)}}function n(){ZMSG_transmoreloader&&ZMSG_transmoreloader.parentNode&&$WC.Util.removeElement(ZMSG_transmoreloader),ZMSGUI.showErrorMessage()}var a={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.Util.getCSRF()};WebMessanger.isCliqUser()&&!ZMSG_USERID?$WC.Ajax.requestToChat("v1/history",s,i,n,null,null,a):$WC.Ajax.requestToChat("v1/chats",s,i,n,null,null,a)},WebMessanger.deleteSelectedChats=function(e){$WC.Ajax.postRequestToChat("deleteselectedchat.do","chid="+e)},WebMessanger.deleteChat=function(e){$WC.Ajax.postRequestToChat("deletechat.do","chid="+e)},WebMessanger.continueChat=function(e,t){if(WebMessanger.isChatPaused()||silent)WebMessanger.checkAndEnableChatBar("",e,!0);else if(Chat.isExists(e)){WMSUI.handleChatExist(e);var s=WindowHandler.getWinObjById(e);if(t&&s)if(s.msgdisp.querySelector('.wms-msgfrag[data-msgtime="'+t+'"]'))Message.glowBubble(t,s.ctrlcomp,e);else{var i=Message.getMarkerElement(e+"|"+t,t,s.msgdisp);Message.loadSpecificTranscript(e,s.msgdisp,i)}}else{if(WmsMainUI.scheduleAutoFocus(e),WebMessanger.prefetch_channels&&$WC.Util.isChannelChid(e)&&null===$WC.Channels.getLastFetchedTime())return $WC.Channels.initChannels(),void WmsMainUI.scheduleAutoJoin(e);var n="chid="+e+"&btf="+!0+"&autojoin="+!1+"&sid="+encodeURIComponent(WebMessanger.getSid());t&&(Message.mentionMsgInfo[e]=e+"|"+t,WmsMainUI.scheduleAutoFocus(e)),$WC.Ajax.postRequestToChat("continuechat.do",n)}},WebMessanger.disable=function(){this.disablewms=!0,this.abortBind(),this.clearWMSFrameMonitor()},WebMessanger.isOnline=function(e){$WC.Ajax.postRequest("isonline"+dext,"ulist="+encodeURIComponent(e))},WebMessanger.isdisablewms=function(){return this.disablewms},WebMessanger.setRebrand=function(e){"baihui"!==e&&(this.rebrand=e)},WebMessanger.setJsStaticDomain=function(e){this.jsstaticdomain=e},WebMessanger.setCssStaticDomain=function(e){this.cssstaticdomain=e},WebMessanger.useSameDomain=WebMessanger.enableCustomDomain=function(){_WMS_SAMEDOMAIN=!0},WebMessanger.setWmsContext=function(e){_WMSCONT=e,$WC.Config.set({WMSCONT:_WMSCONT})},WebMessanger.forceDomainChange=function(){_WMS_FORCEDOMAIN=!0},WebMessanger.setNoDomainChange=function(){_WMS_NODOMAINCHANGE=!0},WebMessanger.setNewClientPortalAuthentication=function(){_NEWCLIENTPORTAL_AUTHENTICATION=!0},WebMessanger.silentOverriddenForAnnouncement=!1,WebMessanger.overrideSilentForAnnouncement=function(){WebMessanger.silentOverriddenForAnnouncement=!0},WebMessanger.setLocale=function(e,t){for(var s=new Array("en","zh","ta","ja","de","ca","cs","da","el","es","et","fi","fr","hr","hu","it","ko","lt","nb","nl","pl","pt","ro","ru","sk","sv","th","tr","uk","vi","ar"),i=-1,n=0;n<s.length;n++)if(s[n]==e){i=n;break}-1<i?(this.language=e,this.countrycode=t):(this.language="en",this.countrycode="US")},WebMessanger.disableMeeting=function(){this.meeting=!1},WebMessanger.setMeetingUrl=function(e){wmsmeetingurl=window.location.protocol+"//"+e},WebMessanger.setAppAccountId=function(e){_WMSAPPACCOUNTID=e},WebMessanger.isCliqUser=function(){return!!_WMSAPPACCOUNTID},WebMessanger.reload=function(){try{-1<(newurl=window.location.href).indexOf("#")&&(newurl=window.location.href.substring(0,window.location.href.indexOf("#"))),setTimeout(function(){return window.location.href=newurl,!0},3e3)}catch(e){setTimeout(function(){return window.location.href=WebMessanger.locationurl,!0},3e3)}},WebMessanger.setMaxChatWindow=function(e){WebMessanger.forceMaxWin=e},WebMessanger.isAutoJoinAllowed=function(e,t){var s=WindowHandler.exist.filter(function(e){if("empty"!=e)return!0}).length;return!WebMessanger.is_custom_menu_opted&&(!(s>=WindowHandler.getMaxWin())&&(3!=WebMessanger.scode&&5!=WebMessanger.scode&&("456089"!=WebMessanger.orgid||"Estancia Bot"!=e&&"Jeeves Bot"!=e&&"CT_2243174094947259583_64396901"!==t)))},WebMessanger.push=function(e){if(e.mtype==WM_RECONNECT){var t;if((s=e.msg||{})&&s.instruction)t=s.instruction.split("-")[0];void 0===t&&WebMessanger.reconnect(CT_JOIN,"psdown",!0),silent||WmsMainUI.resetAllUnreadCount()}else if(e.mtype==WM_NFY_LOGOUT||e.mtype==WM_AUTH_FAILED){WebMessanger.disable();var s=e.msg;setTimeout(function(){e.mtype==WM_NFY_LOGOUT?(WebMessanger.clearTicket(s.ticket),!0!==WmsImplHandler.invokeSynchronously(Collaboration.handleLogout,s&&s.reason)&&WebMessanger.reload()):(WmsImplHandler.invoke(Collaboration.handleWmsDisable,s&&s.reason),WmsImplHandler.invoke(Collaboration.handleAuthFailure),WebMessanger.postDebugInfoToServer(null,"AuthFailed"))},1),$WC.WmsSessionStorage.removeItem("wms_openchats")}else if(e.mtype==PS_REG_ACK)iswmsframeloaded=!0,WebMessanger.clearWMSFrameMonitor();else if(e.mtype==WM_INVALID_AUTH_PARAMS||e.mtype==WM_INVALID_TOKEN){iswmsframeloaded=!1,WebMessanger.scheduleWMSFrameMonitor();var i=e.mtype==WM_INVALID_AUTH_PARAMS?"InvalidAuthParam":"InvalidToken";WmsImplHandler.invoke(Collaboration.handleAuthFailure),WebMessanger.postDebugInfoToServer(null,i)}else if(e.mtype==WM_SERVER_UP)silent||(WmsMainUI.resetAllUnreadCount(),$WC.HybridSearch.populateRecentChats(),Commands.sync=!0,$WC.Channels.sync=!0,$WC.RecentChats.setPinnedChatsLastFetchedTime(null),WindowHandler.syncChatWindowTranscripts(),WindowHandler.restoreChats(),WebMessanger.registerAnnonUser||WebMessanger.isCliqUser()||WebMessanger.isRTCChat()||WebMessanger.getUnreadFeeds(),_WMSWINFOCUS?(WebMessanger.syncAdminSettings(),WindowHandler.getPinMsgForOpenedChats(),$WC.Bots.initBots(!0)):(WebMessanger.sync_adminsettings_onfocus=!0,WebMessanger.get_pinmsg_onfocus=!0,$WC.Bots.syncFromServerAfterFocus())),WmsChatCache.removeAll(),Message.deletedMessages.removeAll(),"undefined"!=typeof AcsApi&&WmsImplHandler.invoke(AcsApi.handleServerUP),WebMessanger.updateDebugInfo("Called serverup"),WmsImplHandler.invoke(Collaboration.serverup),_WMS_RETRY_COUNT=0;else if(e.mtype==WM_NFY_ATTACH){var n=e.msg;this.uid=n.uid,""!=n.nname&&(this.nname=n.nname),this.sid=n.sid,this.rawsid=n.rsid,myMsgObj.sender=n.uname,myMsgObj.zuid=n.zuid,this.zuid=n.zuid,WebMessanger.clearWMSFrameMonitor(!0),iswmsframeloaded=!0,silent||WmsContacts.updateFromMDParent(WmsContacts.getZohoContacts()),setTimeout(function(){WebMessanger.serverup(e.msg)},100),WmsImplHandler.invoke(WmsContactImpl.handleGetContacts)}else if(e.mtype==WM_NFY_DETACH)setTimeout(function(){WebMessanger.serverdown()},100);else if(-7==e.mtype)WmsImplHandler.invoke(Collaboration.handleServiceMessage,e.msg);else if(e.mtype==NFY_USER_IDLE){s=e.msg;var a=$WC.Util.splitWmsFormattedString(s.oc,4);s.chid=a[0],s.zuid=a[2],s.sender=s.zuid,s.dname=$WC.Util.getContactName(s.zuid,a[3]);var o=s.chid;(B=WindowHandler.getWinObjById(o))&&!$WC.Util.isLocalUser(s.zuid)&&B.clearTypingStatus(),s.msg="",silent||Self.status.update(s),WmsImplHandler.invoke(WmsChatUIImpl.handleUserIdle,s.dname,o)}else if(e.mtype==NFY_USER_ENTERED){s=e.msg,a=$WC.Util.splitWmsFormattedString(s.oc,4);s.chid=a[0],s.zuid=a[2],s.sender=s.zuid,s.dname=$WC.Util.getContactName(s.zuid,a[3]);o=s.chid;(B=WindowHandler.getWinObjById(o))&&!$WC.Util.isLocalUser(s.zuid)&&B.clearTypingStatus(),s.msg="",silent||Self.status.update(s),WmsImplHandler.invoke(WmsChatUIImpl.handleUserEnteredText,s.dname,o)}else if(e.mtype==NFY_USER_TYPING){s=e.msg,a=$WC.Util.splitWmsFormattedString(s.oc,4);s.chid=a[0],s.zuid=a[2],s.sender=s.zuid,s.dname=$WC.Util.getContactName(s.zuid,a[3],!0),s.mtype=NFY_USER_TYPING;var r;o=s.chid;if((B=WindowHandler.getWinObjById(o))&&!$WC.Util.isLocalUser(s.zuid)&&((r=B.typingstatusnode).innerHTML="",$WC.Util.removeClass(r,"wms_cw_typingstatus_animate"),$WC.Util.isImageLazyLoaded(s.zuid)?r.innerHTML='<img class="wms_cw_userphoto" data-zcprofileid="'+s.zuid+'" src="'+WmsContacts.getUserPhoto(s.zuid)+'" title="'+$WC.Util.getContactName(s.zuid,s.dname,!0)+'">':r.innerHTML='<div class="wms_menu_item_img wms_typingstatus_img" data-imgid="'+s.zuid+'" data-originalsrc="'+WmsContacts.getUserPhoto(s.zuid)+'" title="'+$WC.Util.getContactName(s.zuid,s.dname,!0)+'"></div>',r.innerHTML+='<div class="wms_usertyping_status"><span></span><span></span><span></span></div>',r.setAttribute("data-typingstatus",!0),$WC.Util.isImageLazyLoaded(s.zuid)||$WC.Util.loadOriginalImage(r,!0,!0)),!silent){Self.status.update(s);var l=s.chid+"."+s.sender,d=s.sender;Self.Timer[l]=setTimeout(function(){Self.status.clear(o,d);var e=WindowHandler.getWinObjById(o);e&&!$WC.Util.isLocalUser(s.zuid)&&e.clearTypingStatus()},15e3)}WmsImplHandler.invoke(WmsChatUIImpl.handleUserTyping,s.dname,o)}else if(e.mtype==WM_ACK_CONNECT){n=e.msg;this.uid=n.uid,""!=n.nname&&(this.nname=n.nname),this.sid=n.sid,this.XA=n.xa,this.rawsid=n.rsid,this.uname=n.uname,this.orgid=n.orgid,myMsgObj.sender=n.uname,myMsgObj.zuid=n.zuid,this.zuid=n.zuid,this.retry=0,this.reconnecting=!1,this.registered=!0,silent||WebMessanger.isOrgUser()||WmsMainUI.removeChannelMenu(),WmsImplHandler.invoke(Collaboration.onConnect),WebMessanger.clearWMSFrameMonitor(!0),iswmsframeloaded=!0,WebMessanger.serverup(e.msg),WindowHandler.restoreChats(!0),WebMessanger.registerAnnonUser||WebMessanger.isCliqUser()||WebMessanger.isRTCChat()||WebMessanger.getUnreadFeeds(),$WC.Config.set({orgid:WebMessanger.orgid,dname:WebMessanger.nname,sid:WebMessanger.sid}),null==$WC.WmsLocalStorage.getItem("wms_firstloaded")&&$WC.WmsLocalStorage.setItem("wms_firstloaded",(new Date).getTime()),WebMessanger.isRTCChat()||this.registerAnnonUser&&!WebMessanger.isExclusiveChat()||this.loadAVLibrary(),WebMessanger.isExclusiveChat()&&(WebMessanger.isGuestUser()?WebMessanger.verifyGuestAndGetChatDetails():WebMessanger.exclusive_chat_info.entity_id&&WebMessanger.joinChatlet(WebMessanger.exclusive_chat_info.entity_id)),WebMessanger.loadScreenGrabberLib(),WmsSound.loadNotificationTunes(),WebMessanger.is_custom_menu_opted&&null===$WC.RecentChats.getPinnedChatsLastFetchedTime()&&WebMessanger.getPinnedChats(),ChatTour.checkAndScheduleNotifier($WC.WmsLocalStorage.getItem("wms_firstloaded"))}else if(e.mtype==WM_CLEAR_NOTI){if("clearunreadcount"==(n=e.msg).opr)silent||ZMSGUI.clearAllUnreadChats();else if("clearallnotifications"==n.opr){if(!silent)try{ZMSG_CLKUNREAD=!1,$WC.RecentChats.setUnreadFeedsCount(0),WmsMainUI.updateUnreadChatsCount(),$WC.HybridSearch.populateRecentChats()}catch(e){}}else if("clearreminder"==n.opr){null!=(c=n.data).reminder&&(silent||WMSUI.removeNotificationHolder("reminder"+c.reminder,!1))}else if("notifyunreadcount"==n.opr){var c;if((c=n.data).chid){if(silent)return;for(var m=c.chid.split(","),u=0;u<m.length;u++)WmsMainUI.resetUnreadCount(m[u]),WmsMainUI.updateUnreadCountInUI(m[u]),$WC.RecentChats.updateLastSeenTime(m[u]),WindowHandler.getWinObjById(m[u])&&WindowHandler.getWinObjById(m[u]).makeNormal();$WC.HybridSearch.isUnreadFilterOpen()&&WmsMainUI.filterUnreadChats(),ChatBlink.stopRepeat(),WmsMainUI.updateUnreadChatsCount()}}}else if(e.mtype==CT_NFY_ACTCHATADD){function p(e,t){var s={};s.chid=e,s.pcount=t.pcount,s.recipients=t.recipants,WebMessanger.mapChat(s)}n=e.msg.ac;var h=e.msg.uc||e.msg.ac;for(var g in h)10==h[g].ctype&&h[g].addinfo&&-1<h[g].addinfo.indexOf("ENTITYID")&&(h[g].entityid=h[g].addinfo.split(":")[1]),p(g,h[g]);if(e.msg.uc){for(var f in e.msg.uc)$WC.Util.isThreadChid(f)&&(WebMessanger.unreadthreadmap[f]=e.msg.uc[f]);$WC.RecentChats.updateUnReadChats(e.msg.uc),$WC.Util.pubsub.publish("/chats/unreadchatdetails")}for(var g in n){(B=WindowHandler.getWinObjById(g))&&B.title!=n[g].title&&B.updateChatTitle(n[g].title),p(g,n[g])}$WC.RecentChats.updateFromActiveChats(n),$WC.Util.pubsub.publish("/recentchats/updatechatslistui"),WebMessanger.methodsInCallbackQueue.forEach(function(e){e()}),WebMessanger.methodsInCallbackQueue=[]}else if(e.mtype==CT_NFY_ACTCHATDELETE)n=e.msg;else if(e.mtype==CT_NFY_MSG){n=e.msg;WmsImplHandler.invoke(Collaboration.handleChatNotifyMessage,n.chid,n.sender,n.msg)}else if(e.mtype==CT_INF_MSG){var C=(n=e.msg).salesiqchat||!1;if(n.h&&"CALL_INFO"!==n.msg.mode)return;o=n.chid;if((B=WindowHandler.getWinObjById(o))&&"8"==B.ctype&&("USER ADDED"===n.msg.mode||"USER DELETED"===n.msg.mode)){var v=[],b=n.msg.userslist;for(var y in b)v.push({zuid:y,uname:y,dname:b[y]});WindowHandler.addParticipantsByID(o,v),$WC.RecentChats.updatePartCount(o,v.length,"USER ADDED"===n.msg.mode),$WC.Chats.updatePartCount(o,v.length,"USER ADDED"===n.msg.mode)}n.sender="CT_INF_MSG",n.msg.chid=o||"";var _=$WC.MsgUtil.getInfoMsgString(n.msg);if(B&&B.updateInfoMessage(_,n.time),!$WC.Util.isLocalUser(n.msg.opruser.zuid)&&"CALL_INFO"===n.msg.mode&&("CALL_CANCELED"===n.msg.msg.status||"CALL_MISSED"===n.msg.msg.status)){if(10==n.ctype&&"MT"!=WebMessanger.prd&&$WC.Util.checkIfChatletHidden(n.entityid)||WmsMainUI.incrementUnreadCount(n.chid),B&&(!B.mutedinterval||B.mutedinterval<(new Date).getTime())||!WmsMainUI.getMuteStatus(o)){var W="1"===n.a;WmsNotification.notifyNewMessage(n,"chatmsg",W)}1==WmsMainUI.getUnreadCount(n.chid)&&($WC.RecentChats.updateLastSeenTime(n.chid,n.time),B&&B.showUnreadMsgs())}if("11"==n.ctype&&"THREAD_REOPENED"===n.msg.mode)if(B.closethreadnode.style.display="block",B.avatarnode.querySelector("[data-cutouticon]").className="wms_badge_statusicon_thread_cutout wms_badge_img_cutout",H=WindowHandler.getWinObjById(B.thread_parentid)){var S=H.ctrlcomp.querySelector('[data-thread_chid="'+o+'"]');S&&S.setAttribute("data-thread_state","open")}!1===C&&$WC.RecentChats.updateLastMsgInfo({chid:o,sender:n.sender,dname:n.dname,msg:n,lmtime:n.time,msguid:n.msguid,addinfo:n.lmsgaddinfo,mtype:e.mtype})}else if(e.mtype==WM_INFO)try{n=e.msg;silent||WebMessanger.isCliqUser()&&$WC.SecurityManager.hasPermission("taz")||($WC.RecentChats.incrementUnreadFeedsCount(),ZMSG_MSGOBJ.push(n),WmsMainUI.updateUnreadChatsCount(),$WC.HybridSearch.populateRecentChats()),WmsImplHandler.invoke(Collaboration.handleZohoMessage,e.prd,n.MSG,n.URL,n.URLSTRING,n.CATEGORY,n.SENDER,n.ATTACHMENTS,n.PARAMS,n.ID,n.DNAME,n.ORGS,n.GROUPS)}catch(e){}else if(e.mtype==WM_CUSTOM)"COMMAND_CREATED"===e.msg.ACTION?Commands.updateList(e.msg.data):"COMMAND_DELETED"===e.msg.ACTION&&Commands.deleteObj(e.msg.data),WmsImplHandler.invoke(Collaboration.handleCustomMessage,e.msg);else if(e.mtype==WM_CROSSPRODUCT){if("CL"==e.prd)"EVENT REMINDER"==(n=e.msg).operation&&(silent||WMSUI.showRemainder(n.data));WmsImplHandler.invoke(Collaboration.handleCrossProductMessage,e.prd,e.msg)}else if(e.mtype==ACS_MSG){var w=e.msg;"undefined"!=typeof AcsApi&&WmsImplHandler.invoke(AcsApi.handlePush,w.type,w.data)}else if(e.mtype==WM_PRESENCE)n=e.msg;else if(e.mtype==WM_ZTI_FAIL_MSG){n=e.msg;ZTI.handleFailure(n.reason,n)}else if(e.mtype==CT_JOIN){var M=(n=e.msg).title,I=(o=n.chid,n.ctype);C=n.salesiqchat||!1;if(WebMessanger.isGuestUser()||"MT"!=WebMessanger.prd&&$WC.Util.checkIfChatletHidden(n.entityid))return;if(WebMessanger.isExclusiveChat()&&n.entityid&&-1!=n.entityid.indexOf(WebMessanger.exclusive_chat_info.entity_id)&&(WebMessanger.exclusive_chat_info.chat_id=o),n.users)for(u=0;u<n.users.length;u++){a=$WC.Util.splitWmsFormattedString(n.users[u].s,3);n.users[u].zuid=a[0],n.users[u].uname=a[0],n.users[u].dname=a[2],WmsContacts.updateUserStatus(n.users[u].zuid,n.users[u].scode,n.users[u].st,n.users[u].smsg)}if(WebMessanger.liveChats.push(o),1==I&&WmsImplHandler.invoke(WmsChatUIImpl.handleNewChat,n),10==I){var T=n.cbdata&&JSON.parse(n.cbdata);try{ChatletImpl.handleUserList(n.entityid,n.users,T)}catch(e){}n.autojoin&&WmsMainUI.scheduleAutoFocus(o)}if((1==I||5==I||8==I||9==I||10==I||11==I||4==I&&C)&&(!silent||WebMessanger.isExclusiveChat()&&o===WebMessanger.exclusive_chat_info.chat_id||WMSUI.getServiceChatContainer(o,n))){if(5!=I||!CustomChat.isActive(o,n.addinfo)){if(WmsChatUIImpl.isActive(o))return;try{if("true"==n.silent)return}catch(e){}setTimeout(function(){WmsContacts.verifyUserStatus(n.users)},1),8==I||11==I?(8==I&&($WC.Channels.get(n.chid)&&$WC.Channels.get(n.chid).oc_id?$WC.Channels.updateChannel(n.chid,"joined",1):$WC.Channels.setChannelsSync(!0)),_WMSWINFOCUS?$WC.Channels.getChannels():$WC.Channels.setChannelsFocussed()):9==I&&(_WMSWINFOCUS?$WC.Bots.initBots():$WC.Bots.getFromServerAfterFocus()),"5"===I&&(n.prd=e.prd),n.pcount=+n.pcount,WebMessanger.mapChat(n),Chat.isExistsInCliqbar(o)&&!WMSUI.getServiceChatContainer(o)?WmsMainUI.isAutoFocusScheduled(n.chid)?WmsMainUI.removeAutoFocusSchedule(n.chid):2===n.pcount&&n.users[0]&&WmsMainUI.isAutoFocusScheduled(n.users[0].zuid)&&WmsMainUI.removeAutoFocusSchedule(n.users[0].zuid):(Chat.isExistsInCliqbar(o)&&WMSUI.getServiceChatContainer(o)&&WindowHandler.getWinObjById(o).close(),Chat.isExists(o)||("11"==n.ctype&&WebMessanger.wrapThreadsDataFromJoin(n),WMSUI.createNewChatWindow(n)));var A=WindowHandler.getWinObjById(o);if(2==n.pcount&&(!n.customgroup||"false"==n.customgroup)){var E=WebMessanger.getSenderFromMsgobj(n)||n.users[0].uname;WebMessanger.storeUserInfoAndUpdateTitle(E,n.chid),Message.handlePrivateReply(A.recipant)}if(n.mutedinterval&&n.mutedinterval>(new Date).getTime()&&(A.updateMuteInfo(n.mutedinterval),WmsMainUI.setMuteStatus(n.chid,!0)),8!=I&&9!=I&&11!=I&&A.updateParticipantsFromJoin(n.users),8==I&&(A.updatePartCount(n.pcount),A.updateChannelImage()),10==I&&(A.updateWebUrl(n.context),A.updateInfoMsgTemplate(n.cbdata)),9==I){var U=n.bots&&n.bots[0];A.updateBotImage(U),A.getActions(U)}"1"===n.attached&&A.updateAttachInfo(!0)}}else 2==I&&WmsImplHandler.invoke(Collaboration.handleUserList,o,n.users);4!=I&&5!=I||CustomChat.handleUserList(o,n),"6"===I&&WmsImplHandler.invoke(Presence.handleUserList,o,n),WMSUI.chatUsersObj[o]&&(A.updateRecipientInfo(v),A.restrictFileSharingForExternalUser(),WMSUI.removeChatUserObj(o)),WindowHandler.checkAndHighlightChat(o)}else if(e.mtype==WM_PUB_SUB){var x=e.msg;"pubsub.ulist"==(ge=x.opr)?(WmsImplHandler.invoke(PubSubApi.addUsers,x.pskey,x.psid,x.ulist),WmsImplHandler.invoke(PubSubImpl.handleUserList,x.pskey,x.ulist)):"pubsub.usersubscribed"==ge?(WmsImplHandler.invoke(PubSubApi.addUsers,x.pskey,x.psid,x.ulist),WmsImplHandler.invoke(PubSubImpl.handleUserIn,x.pskey,x.ulist)):"pubsub.userunsubscribed"==ge?(WmsImplHandler.invoke(PubSubApi.removeUsers,x.pskey,x.psid,x.ulist),WmsImplHandler.invoke(PubSubImpl.handleUserOut,x.pskey,x.ulist)):"pubsub.message"==ge?WmsImplHandler.invoke(PubSubImpl.handleMessage,x.pskey,x.msg):"pubsub.authfailure"==ge&&WmsImplHandler.invoke(PubSubApi.handleAuthFailure,x.msg)}else if(e.mtype==CT_ATT_MSG){I=(s=e.msg).ctype,o=s.threadchatid||s.chid,C=s.salesiqchat||!1;if((1==I||5==I||8==I||9==I||10==I||11==I||4==I&&C)&&(!silent||WebMessanger.isExclusiveChat()&&o===WebMessanger.exclusive_chat_id||WMSUI.getServiceChatContainer(o,n))&&(C||Message.isSameBrowser(s.sid)||!s.sid&&(WebMessanger.isGuestUser()||$WC.FormFileShare.getLastUploadStatus())||$WC.Util.isLocalUser(s.uname)||!$WC.Util.isLocalUser(s.uname))&&("att"===s.mod||"contact"===s.mod||"location"===s.mod||"event"===s.mod)&&($WC.FormFileShare.getLastUploadStatus()&&$WC.FormFileShare.resetLastUploadStatus(),5!=I||!CustomChat.isActive(o,s.addinfo))){if(WmsChatUIImpl.isActive(o))return;var N=s.entityid;if(10==I&&(N=N||(N=(N=s.addinfo.split(":"))[N.indexOf("ENTITYID")+1]).split(",")[0],"MT"!=WebMessanger.prd&&$WC.Util.checkIfChatletHidden(N)))return;if(s.isfirstthreadmessage||!s.threadmsg||s.ht||!1!==$WC.Util.isLocalUser(s.uname)?!1!==$WC.Util.isLocalUser(s.uname)||s.threadmsg||WmsMainUI.incrementUnreadCount(s.chid):WmsMainUI.incrementUnreadCount(s.chid,s.threadchatid),s.m?WmsMainUI.setMuteStatus(o,!0):WmsMainUI.setMuteStatus(o,!1),8==I&&$WC.Channels.updateChannelMetaData(s),Chat.isExists(o)||s.m||s.h||11==I){if(B=WindowHandler.getWinObjById(o)){e.msg.msgackid=e.msg.msgid,WmsFileUploadHandler.handleAckReceived(o,e.msg.msgackid);var k=e.msg.meta&&e.msg.meta.post_in_parent_information;if(e.msg.msgid&&B.msgdisp.querySelector('[data-msgackid="'+e.msg.msgid+'"],[data-msgtime="'+e.msg.time+'"]')?B.updateMessageFragment(e.msg):B.updateMessage(e.msg),!s.m){W="1"===s.a;Self.Idle=!0,WmsNotification.notifyNewMessage(s,"chatmsg",W)}}}else{if(s.pcount=+s.pcount,"5"===I&&(s.prd=e.prd),"undefined"!=typeof WmsUIImpl&&WmsUIImpl.preventChatWindowOpen)var O=WmsImplHandler.invokeSynchronously(WmsUIImpl.preventChatWindowOpen,I,o);if(WebMessanger.isAutoJoinAllowed(s.title,s.chid)&&!O){if($WC.Util.isLocalUser(s.sender)&&2===s.pcount){var R=JSON.parse(s.t121t);delete R[s.sender];y=Object.keys(R)[0];s.title=WmsContacts.getDisplayName(y)||R[y]}WebMessanger.prefetch_channels&&$WC.Util.isChannelChid(o)&&null===$WC.Channels.getLastFetchedTime()?($WC.Channels.initChannels(),WmsMainUI.scheduleAutoJoin(o)):"10"==I?WebMessanger.join(o):("8"===I&&(_WMSWINFOCUS?$WC.Channels.getChannels():$WC.Channels.setChannelsFocussed()),WMSUI.createNewChatWindow(s),WindowHandler.getWinObjById(o).updateMessage(s),WindowHandler.getWinObjById(o).showPinnedMsg(s))}Self.Idle=!0;var W="1"===s.a;WmsNotification.notifyNewMessage(s,"newchat",W)}var H=WindowHandler.getWinObjById(s.chid);if(s.isfirstthreadmessage&&H){var $=!(!$WC.Util.isLocalUser(s.parentmessagesenderid)&&!$WC.Util.isLocalUser(s.sender)),D=s.parentmessagesenderid===s.sender?1:2,L={chat_id:s.threadchatid,follower_count:D,message_count:1,title:s.title,thread_message_id:s.threadmsguid,is_follower:$};if(s.thread_information=L,k||H.updateMessageFragment(s,null,s.parentmsguid),$WC.Util.isLocalUser(s.sender)){var P=H.ctrlcomp.querySelector('[data-msgid="'+s.sender+"_"+s.time+'"]');k&&P?((P=P.querySelector('[data-msgid="'+s.sender+"_"+s.time+'"]')).className="",P.nextSibling&&$WC.Util.removeElement(P.nextSibling)):WebMessanger.openThreadWindowFromCache(H.ctrlcomp.querySelector("[data-thread_chid="+s.threadchatid+"]"),s.threadchatid)}}!1===C&&$WC.RecentChats.updateLastMsgInfo({chid:o,sender:s.sender,dname:s.dname,msg:s.msg,msguid:s.msguid,lmtime:s.time,module:s.mod,mtype:e.mtype});var B=B||WindowHandler.getWinObjById(o);if(s.threadmsg&&!s.ht&&(s.isfirstthreadmessage||WindowHandler.updateThreadCount(s),$WC.RecentChats.updateLastThreadMsgTime(s.chid,s.time),$WC.RecentChats.updateThreadParentMsgId(s.threadchatid,s.parentmsguid)),(s.threadmsg&&1==WmsMainUI.getUnreadCount(s.chid,null,s.threadchatid)||WmsMainUI.getUnreadCount(s.chid))&&($WC.RecentChats.updateLastSeenTime(o,s.time),B&&B.showUnreadMsgs()),B&&(B.lastmsg_uid=s.msguid),s.threadmsg&&B&&WebMessanger.threadmap[s.threadchatid]&&(B.updateThreadFollowerInfo(!0,null,null,!0),delete WebMessanger.threadmap[s.threadchatid]),s.threadmsg&&!s.ht){W="1"===s.a;WmsNotification.notifyNewMessage(s,"chatmsg",W)}}4!=I&&5!=I||s.h||CustomChat.handleAttachmentMessage(s),!1===$WC.Util.isLocalUser(s.uname)&&!1===C&&$WC.Util.pubsub.publish("/chats/unreadchatdetails")}else if(e.mtype==CT_TXT_MSG){I=(n=e.msg).ctype,o=n.threadchatid||n.chid,B=WindowHandler.getWinObjById(o),C=n.salesiqchat||!1;if(1!=I&&10!=I&&12!=I||WmsImplHandler.invoke(WmsChatUIImpl.handleChatMessage,n),Message.isAddMsg(n)){var j=Object.keys(n.meta.mentions),F=n.msg,z="";if(j.forEach(function(e){z=new RegExp("{\\"+e+"}","g"),F=F.replace(z,"")}),$WC.Util.isEmptyString(F))return}N=n.entityid;if(10==I){if(N=N||(N=(N=n.addinfo.split(":"))[N.indexOf("ENTITYID")+1]).split(",")[0],WebMessanger.isExclusiveChat()){var G=$WC.Util.isLocalUser(n.uname);o===WebMessanger.exclusive_chat_info.chat_id&&WmsImplHandler.invoke(WmsUIImpl.handleMsgForMeetingChat,n,G)}if("MT"!=WebMessanger.prd&&$WC.Util.checkIfChatletHidden(N))return}if((1==I||5==I||8==I||9==I||10==I||11==I||4==I&&C)&&(!silent||WebMessanger.isExclusiveChat()&&o===WebMessanger.exclusive_chat_info.chat_id||WMSUI.getServiceChatContainer(o,n))){if(5!=I||!CustomChat.isActive(o,n.addinfo)){if(WmsChatUIImpl.isActive(o))return;if(C||Message.isSameBrowser(n.sid)&&Message.isSentFromApi(n.temp_info)||!1===$WC.Util.isLocalUser(n.uname)||10==I||9==I||Message.isBotMsg(n)||Message.isCustomMsg(n)){if(B&&!B.isMsgAlreadyUpdated(n,B.ctrlcomp)||!B){var q=WebMessanger.getSenderFromMsgobj(n)||n.uname;n.isfirstthreadmessage&&n.ht||!n.threadmsg||n.ht||!1!==$WC.Util.isLocalUser(q)?!1!==$WC.Util.isLocalUser(q)||!1!==C||n.threadmsg||WmsMainUI.incrementUnreadCount(n.chid):WmsMainUI.incrementUnreadCount(n.chid,n.threadchatid)}if(n.m?WmsMainUI.setMuteStatus(o,!0):WmsMainUI.setMuteStatus(o,!1),8==I&&$WC.Channels.updateChannelMetaData(n),Chat.isExists(o)||n.m||n.h||11==I)if(Self.Idle=!0,B&&!B.isMsgAlreadyUpdated(n,B.ctrlcomp)){if(B.updateMessage(n),Message.isBotMsg(n)&&n.temp_info&&B.showBotSuggestions(n),Self.status.clear(o,n.sender),!n.m&&!1===$WC.Util.isLocalUser(n.uname)){W="1"===n.a;WmsNotification.notifyNewMessage(n,"chatmsg",W)}}else B&&B.updateMessageFragment(n);else if("CT_INF_MSG"!==n.sender){if(n.pcount=+n.pcount,"5"===I&&(n.prd=e.prd),"undefined"!=typeof WmsUIImpl&&WmsUIImpl.preventChatWindowOpen)O=WmsImplHandler.invokeSynchronously(WmsUIImpl.preventChatWindowOpen,I,o);WebMessanger.isAutoJoinAllowed(n.title,n.chid)&&!O&&(WebMessanger.prefetch_channels&&$WC.Util.isChannelChid(o)&&null===$WC.Channels.getLastFetchedTime()?($WC.Channels.initChannels(),WmsMainUI.scheduleAutoJoin(o)):"10"==I?WebMessanger.join(o):("8"===I&&(_WMSWINFOCUS?$WC.Channels.getChannels():$WC.Channels.setChannelsFocussed()),WMSUI.createNewChatWindow(n),WindowHandler.getWinObjById(o).updateMessage(n),WindowHandler.getWinObjById(o).showPinnedMsg(n))),Self.Idle=!0;W="1"===n.a;WmsNotification.notifyNewMessage(n,"newchat",W);B=WindowHandler.getWinObjById(o);if("1"===I&&B&&2===B.partcount){E=WebMessanger.getSenderFromMsgobj(n)||n.sender;WebMessanger.storeUserInfoAndUpdateTitle(E,o)}}}else{if(WmsMainUI.resetUnreadCount(o),WmsMainUI.updateUnreadCountInUI(o),WmsMainUI.updateUnreadChatsCount(),B){k=n.meta&&n.meta.post_in_parent_information;(n.msgid&&!1===$WC.Util.isLocalUser(n.uname)||!B.isMsgAlreadyUpdated(n,B.ctrlcomp))&&B.updateMessage(n),B.updateMessageFragment(n)}!n.sid||!C&&Message.isSameBrowser(n.sid)||(WebMessanger.removeLiveChat(o),WindowHandler.removeWinById(o),ChatBlink.stopRepeat())}H=WindowHandler.getWinObjById(n.chid);if(n.isfirstthreadmessage&&H){$=!(!$WC.Util.isLocalUser(n.sender)&&!$WC.Util.isLocalUser(n.parentmessagesenderid)),D=n.parentmessagesenderid===n.sender?1:2,L={chat_id:n.threadchatid,follower_count:D,message_count:1,title:n.title,thread_message_id:n.threadmsguid,is_follower:$};if(n.thread_information=L,H.updateMessageFragment(n,null,n.parentmsguid),$WC.Util.isLocalUser(n.sender)){P=H.ctrlcomp.querySelector('[data-msgid="'+n.sender+"_"+n.time+'"]');k&&P&&((P=P.querySelector('[data-msgid="'+n.sender+"_"+n.time+'"]')).className="",P.nextSibling&&$WC.Util.removeElement(P.nextSibling)),WebMessanger.openThreadWindowFromCache(H.ctrlcomp.querySelector("[data-thread_chid="+n.threadchatid+"]"),n.threadchatid)}}if(!1===C&&$WC.RecentChats.updateLastMsgInfo({chid:o,sender:n.sender,dname:n.dname,msg:n,lmtime:n.time,msguid:n.msguid,addinfo:n.lmsgaddinfo,mtype:e.mtype}),B=B||WindowHandler.getWinObjById(o),n.threadmsg&&!n.ht&&(n.isfirstthreadmessage||WindowHandler.updateThreadCount(n),$WC.RecentChats.updateLastThreadMsgTime(n.chid,n.time),$WC.RecentChats.updateThreadParentMsgId(n.threadchatid,n.parentmsguid)),(n.threadmsg&&1==WmsMainUI.getUnreadCount(n.chid,null,n.threadchatid)||1==WmsMainUI.getUnreadCount(n.chid))&&($WC.RecentChats.updateLastSeenTime(o,n.time),B&&B.showUnreadMsgs()),B&&(B.lastmsg_uid=n.msguid),n.threadmsg&&B&&WebMessanger.threadmap[n.threadchatid]&&(B.updateThreadFollowerInfo(!0,null,null,!0),delete WebMessanger.threadmap[n.threadchatid]),n.threadmsg&&!n.ht){W="1"===n.a;WmsNotification.notifyNewMessage(n,"chatmsg",W),H&&H.updateUnreadThreadCount(n.chid,n.threadchatid)}}}else 2==I&&WmsImplHandler.invoke(Collaboration.handleMessage,o,n.sender,n.zuid,n.dname,n.msg);4!=I&&5!=I||n.h||CustomChat.handleMessage(n),!1===$WC.Util.isLocalUser(n.uname)&&!1===C&&$WC.Util.pubsub.publish("/chats/unreadchatdetails")}else if(e.mtype==CT_CLOSE_WIN){if(1==(I=(n=e.msg).ctype)||4==I||5==I||8==I||9==I||10==I||11==I){o=n.chid;11==I?WmsMainUI.resetUnreadCount(n.parentchatid,o):WmsMainUI.resetUnreadCount(o),WmsMainUI.updateUnreadCountInUI(o),WmsMainUI.updateUnreadChatsCount(),$WC.RecentChats.updateLastSeenTime(o),WebMessanger.removeLiveChat(o),WindowHandler.removeWinById(o),ChatBlink.stopRepeat(),WmsChatCache.remove(o),Message.deletedMessages.remove(o),4!=I&&5!=I||CustomChat.handleCloseWin(o)}}else if(e.mtype!=WM_AV_MSG)if(e.mtype==CLIQ_AV_MSG)silent&&("CALL_REQUESTED"==e.msg.action||"CALL_INITIATED"==e.msg.action)||MediacallManager.handleWmsMessage(e.msg);else if(e.mtype==CT_NFY_USERSTATUS){I=(n=e.msg).ctype,o=n.chid;if(1!=I&&5!=I||silent)2==I&&WmsImplHandler.invoke(Collaboration.handlePresence,o,n.uname,n.zuid,n.dname,n.status);else if((5!=I||!CustomChat.isActive(o,n.addinfo))&&0==n.status)if($WC.Util.isLocalUser(n.uname)){WebMessanger.removeLiveChat(o);try{null!=n.close&&"true"==n.close&&(WindowHandler.removeWinById(o),ChatBlink.stopRepeat())}catch(e){}}else if(WindowHandler.getWinObjById(o)){var Y=(B=WindowHandler.getWinObjById(o)).partcount;B.clearTypingStatus(),B.typingindicatornode.style.display="none",n.msg="&nbsp;",silent||1==Y&&Self.status.update(n)}4!=I&&5!=I||WmsImplHandler.invoke(CustomChat.handlePresence,o,n.uname,n.zuid,n.dname,n.status),"6"===I&&WmsImplHandler.invoke(Presence.handlePresence,o,n.uname,n.zuid,n.dname,n.status)}else if(e.mtype==CT_NFY_USERADD){for(I=(n=e.msg).ctype,o=n.chid,u=0;u<n.users.length;u++){a=$WC.Util.splitWmsFormattedString(n.users[u].s,3);n.users[u].uname=a[0],n.users[u].cstatus=a[1],n.users[u].dname=a[2]}B=WindowHandler.getWinObjById(n.threadchatid);if(11==I&&B){var V=0;n.users.forEach(function(e){B.followersinfo[e.zuid]||(B.followersinfo[e.zuid]=e,$WC.Util.isLocalUser(e.zuid)?B.thread_follower="true":V++)}),B.updateThreadFollowerInfo(!0,V)}else 1!=I&&5!=I&&10!=I||silent?2==I&&WmsImplHandler.invoke(Collaboration.handleUserAdd,o,n.users):5==I&&CustomChat.isActive(o,n.addinfo)||(WindowHandler.addParticipantsByID(o,n.users),$WC.RecentChats.updatePartCount(o,n.users.length,!0),n.users.forEach(function(e){$WC.RecentChats.updatePartInfo(o,e,!0)}));4!=I&&5!=I||WmsImplHandler.invoke(CustomChat.handleUserAdded,o,n.users,n.pcount),"6"===I&&WmsImplHandler.invoke(Presence.handleUserAdded,o,n.users)}else if(e.mtype==CT_NFY_USERDELETE){for(I=(n=e.msg).ctype,o=n.chid,u=0;u<n.users.length;u++){a=$WC.Util.splitWmsFormattedString(n.users[u].s,3);n.users[u].uname=a[0],n.users[u].cstatus=a[1],n.users[u].dname=a[2]}B=WindowHandler.getWinObjById(n.threadchatid);if(11==I&&B){V=0;for(var u in n.msg.userslist)delete B.followersinfo[u],$WC.Util.isLocalUser(u)?B.thread_follower="false":V++;B.updateThreadFollowerInfo(!0,null,V)}else 1!=I&&5!=I&&10!=I||silent?2==I&&WmsImplHandler.invoke(Collaboration.handleUserDeleted,o,n.users):5==I&&CustomChat.isActive(o,n.addinfo)||(WindowHandler.deleteParticipantsByID(o,n.users),$WC.RecentChats.updatePartCount(o,n.users.length),n.users.forEach(function(e){$WC.RecentChats.updatePartInfo(o,e)}));4!=I&&5!=I||WmsImplHandler.invoke(CustomChat.handleUserDeleted,o,n.users,n.pcount),"6"===I&&WmsImplHandler.invoke(Presence.handleUserDeleted,o,n.users)}else if(e.mtype==WM_NFY_COLLABADD){n=e.msg,a=$WC.Util.splitWmsFormattedString(n.s,5);if(n.uname=a[0],n.zuid=a[0],n.chid=a[1],n.ctype=a[2],n.time=a[3],n.dname=a[4],s=WindowHandler.getWinObjById(n.chid)){!function(e){var t=e.composer;if(t.removeAttribute("placeholder"),t.style.cursor="",t.removeAttribute("disabled"),e.attachmentnode){var s=e.attachmentnode.querySelector('[id="wms-file"]');s.style.cursor="",s.removeAttribute("disabled")}var i=e.smileyinvoker;if(i.style.cursor="",i.removeAttribute("disabled"),i.className="wms-smileyinvoker wms-valign-mid-block",e.actionbutton){var n=e.actionbutton;n.style.cursor="",n.removeAttribute("disabled")}}(s),s.permdenied=!1,s.clearChatContent();var Z=$WC.Util.createElement("div");Z.style="display:none",Z.setAttribute("data-latestchunk","true"),s.msgdisp.appendChild(Z),Message.loadSpecificTranscript(o,s.msgdisp,Z)}if(WmsImplHandler.invoke(Collaboration.handleCollabAdd,n.uname,n.dname,n.zuid,n.time,n.chid),"6"===n.ctype&&WmsImplHandler.invoke(Presence.handleUserAdd,e.msg),"8"===n.ctype&&!$WC.Channels.get(n.chid)){var K="chid="+n.chid;$WC.Ajax.requestToChat("v1/channels",K,function(e){$WC.Channels.updateList(JSON.parse(e))})}$WC.Util.isLocalUser(n.zuid)||"1"!==n.ctype&&"8"!==n.ctype&&"9"!==n.ctype&&"10"!==n.ctype||silent||WebMessanger.isExclusiveChat()||(WmsChatCache.remove(n.chid),Message.deletedMessages.remove(n.chid),WebMessanger.join(n.chid))}else if(e.mtype==WM_NFY_COLLABDELETE){n=e.msg,a=$WC.Util.splitWmsFormattedString(n.s,5);n.uname=a[0],n.zuid=a[0],n.chid=a[1],n.ctype=a[2],n.time=a[3],n.dname=a[4],WmsImplHandler.invoke(Collaboration.handleCollabDelete,n.uname,n.dname,n.zuid,n.time,n.chid);B=WindowHandler.getWinObjById(n.chid);if("6"===n.ctype&&WmsImplHandler.invoke(Presence.handleUserDelete,e.msg),"8"===n.ctype&&($WC.Channels.updateChannel(n.chid,"joined",0),B&&B.close(),$WC.RecentChats.removeFromRecentChats(n.chid)),B){B.permdenied=!0,B.disableActions();var X=$WC.Util.isLocalUser(n.zuid)?"chat.userleft":"chat.notamember";B.disableComposerOptions($WC.I18N(X))}}else if(e.mtype==CT_NFY_SETTITLE){if(null!=(s=e.msg)){var J=s.msg;o=J.chid,M=J.title,B=WindowHandler.getWinObjById(o);if(!M){var Q,ee;if(B){var te=B.partinfo;for(var se in te)2==B.partcount&&(Q=te[se].zuid,ee=te[se].dname)}else $WC.RecentChats.get().forEach(function(e){e.CHATID==o&&2==e.PARTICIPANTSCOUNT&&e.PARTICIPANTS.forEach(function(e){e.zuid!==WebMessanger.zuid&&(Q=e.zuid,ee=e.dname)})});M=$WC.Util.getContactName(Q,ee)}B&&WindowHandler.setTitle(o,M),$WC.RecentChats.updateTitle(o,M),$WC.Chats.updateTitle(o,M),$WC.Channels.updateTitle(o,M)}}else if(e.mtype==WM_NFY_CSTATUSCHANGE){n=e.msg,WebMessanger.scode;var ie=n.scode,ne=n.smsg,ae=n.st;-1!=[$WC.WmsContacts.userstatus.CLIQ_CALLS,$WC.WmsContacts.userstatus.MEETING,$WC.WmsContacts.userstatus.ASSIST_SESSION,$WC.WmsContacts.userstatus.CALENDAR_EVENT,$WC.WmsContacts.userstatus.SHOWTIME_TRAINING,$WC.WmsContacts.userstatus.TELEPHONY].indexOf(parseInt(ae))&&(ie="3"),WebMessanger.scode=ie,WebMessanger.smsg=ne,WebMessanger.stype=ae,silent||(setTimeout(function(){WmsMainUI.updateUserStatusIcon(),WmsMainUI.updateUserStatusMsg()},1),WMSUI.changedsmsg=ne,WMSUI.changedscode=ie,WmsChatCache.removeAll(),Message.deletedMessages.removeAll()),WmsImplHandler.invoke(WmsContactImpl.handleStatusMessage,ie,ne,ae)}else if(e.mtype==WM_NFY_STATUS){if($WC.Util.checkSessionConfig("PRESENCE_PERSONAL")){if((n=e.msg).ua){var oe=JSON.parse(n.ua);n.zuid=oe[0],n.scode=oe[1],n.dname=$WC.Util.getContactName(n.zuid),n.st=oe[3],n.smsg=oe[2]||WmsContacts.defaultstatusmsg[n.scode]}else{oe=$WC.Util.splitWmsFormattedString(n.s,5);n.zuid=oe[0],n.scode=oe[1],n.dname=$WC.Util.getContactName(n.zuid),n.email=oe[2],n.st=oe[3],n.smsg=oe[4]||WmsContacts.defaultstatusmsg[n.scode]}if(WmsImplHandler.invoke(WmsContactImpl.handlePresence,n.zuid,n.zuid,n.dname,n.scode,n.smsg),WmsContacts.get(n.zuid)){var re=!1!==WmsContacts.status(n.zuid)&&+WmsContacts.status(n.zuid);WmsContacts.updateStatus(n),WmsHybridSearch.updatePresence(n.zuid),WindowHandler.updateUserStatus(n.zuid,n.scode,n.smsg,n.st),silent||n.m||WMSUI.checkAndNotifyStatus(n,re)}}}else if(e.mtype==CONTACT_INFO){n=e.msg;var le=e.meta&&e.meta.count;if(WmsContacts.updateContacts(n),!_WMSEMPTYBAR&&!silent){WmsMainUI.updateChatInvitationCount();WmsContacts.getInitializedValue();WmsContacts.initialize(!0);var de=$WC.Util.getObjectLength(WmsContacts.getContactsList());for(u=0;u<WindowHandler.exist.length;u++){if("empty"!=(B=WindowHandler.exist[u])&&null!=B&&2==B.partcount&&!B.isZohoGroupChat()){var ce=B.recipant;if(WmsContacts.get(ce)){var me=WmsContacts.get(ce);B.updateUserStatus(me.STATUS,me.STATUSMSG,me.STYPE)}}}$WC.Config.get("customContacts")||setTimeout(function(){if(WmsHybridSearch.populateContactListInMainUI(!0),le<10&&le==de){var e={suggestions:"show_suggestions"};_WMSEMPTYBAR||silent||$WC.Config.get("customContacts")||WmsHybridSearch.populateContactListInMainUI(!0,e)}},1)}WmsImplHandler.invoke(WmsContactImpl.handleGetContacts)}else if(e.mtype!=WM_NFY_USERIMGCHANGE)if(e.mtype==CT_NFY_APPROVAL){var ue=(n=e.msg).zuid;WmsContacts.updateContact(n),n.status==$WC.WmsConstants.CONTACTSTATUS.ACCEPT?(n.status=n.scode,WmsImplHandler.invoke(WmsContactImpl.handleAccept,n.zuid,n.uname,n.dname,n.scode,n.smsg),WindowHandler.updateUserStatus(n.zuid,n.scode,WmsContacts.getStatusMsg(n.zuid),n.st),silent||setTimeout(function(){var e={suggestions:"show_suggestions"};WmsHybridSearch.populateContactListInMainUI(!0,e)},1)):n.status==WMS_ONLINE?($WC.Util.removeElementFromArray(WmsContacts.getInvitedContactsList(),n.zuid),WmsImplHandler.invoke(WmsContactImpl.notifyAccept,n.zuid,n.uname,n.dname,n.scode,n.smsg),n.status=n.scode,WindowHandler.updateUserStatus(n.zuid,n.scode,WmsContacts.getStatusMsg(n.zuid),n.st),silent||setTimeout(function(){-1!==ue.indexOf($WC.WmsContacts.getInvitedContactsList())&&WMSUI.showInfoMsg($WC.I18N("contact.invite.accept")),WmsHybridSearch.clearInvite(n)},1)):n.status==$WC.WmsConstants.CONTACTSTATUS.REQACC?(WmsImplHandler.invoke(WmsContactImpl.handleInvite,n.zuid,n.uname,n.dname,n.scode,n.smsg),WindowHandler.updateUserStatus(n.zuid,n.scode,WmsContacts.getStatusMsg(n.zuid),n.st),silent||setTimeout(function(){WmsHybridSearch.showInvite(n)},1),0):n.status==$WC.WmsConstants.CONTACTSTATUS.UNAPRD?(WmsImplHandler.invoke(WmsContactImpl.notifyInvite,n.zuid,n.uname,n.dname,n.scode,n.smsg),WindowHandler.updateUserStatus(n.zuid,n.scode,WmsContacts.getStatusMsg(n.zuid),n.st),silent||setTimeout(function(){WmsHybridSearch.clearInvite(n)},1)):n.status==$WC.WmsConstants.CONTACTSTATUS.REJECT?(WmsImplHandler.invoke(WmsContactImpl.handleReject,n.zuid,n.uname,n.dname,n.scode,n.smsg),WindowHandler.updateUserStatus(n.zuid,n.scode,WmsContacts.getStatusMsg(n.zuid),n.st),0):n.status==$WC.WmsConstants.CONTACTSTATUS.NOCHAT?($WC.Util.removeElementFromArray(WmsContacts.getInvitedContactsList(),n.zuid),n.status=n.scode,WindowHandler.updateUserStatus(n.zuid,n.scode,WmsContacts.getStatusMsg(n.zuid),n.st),silent||setTimeout(function(){WmsHybridSearch.clearInvite(n)},1)):n.status==$WC.WmsConstants.CONTACTSTATUS.REMOVE?(WmsContacts.deletecontact(n.zuid),WmsImplHandler.invoke(WmsContactImpl.notifyRemove,n.zuid,n.uname,n.dname,n.scode,n.smsg),WindowHandler.updateUserStatus(n.zuid,n.scode,WmsContacts.getStatusMsg(n.zuid),n.st),silent||setTimeout(function(){WmsHybridSearch.clearInvite(n)},1)):n.status==$WC.WmsConstants.CONTACTSTATUS.DELETE&&(WmsImplHandler.invoke(WmsContactImpl.handleDelete,n.zuid,n.uname,n.dname,n.scode,n.smsg),WindowHandler.updateUserStatus(n.zuid,n.scode,WmsContacts.getStatusMsg(n.zuid),n.st),silent||(WmsMainUI.removeFromContactList(n.zuid),$WC.Util.removeElementFromArray(WmsContacts.getInvitedContactsList(),n.zuid),WmsMainUI.updateChatInvitationCount(),WmsContacts.deletecontact(n.zuid))),n.scode=n.status,n.dname=$WC.Util.getContactName(n.zuid,n.dname),WmsMainUI.updateChatInvitationCount(),WmsImplHandler.invoke(WmsContactImpl.handlePresence,n.zuid,n.uname,n.dname,n.status,n.smsg)}else if(e.mtype==CT_GUEST_REQ){if(!silent){n=e.msg;var pe="creator="+myMsgObj.sender+"&ulist="+n.guid+"&title="+n.title+"&type=guestim";pe=pe+"&sid="+encodeURIComponent(WebMessanger.getSid()),$WC.Ajax.postRequest("createchat"+dext,pe)}}else if(e.mtype==WM_USER_LANG_CHANGE){n=e.msg;setTimeout(function(){WebMessanger.clearTicket(),WmsImplHandler.invoke(Collaboration.handleLanguageChange,n)},1)}else if(e.mtype==WM_SYSTEM_MSG){if("feeddelete"==(n=e.msg).module)ZohoFeedImpl.handleFeedDelete(n),ZMSGUI.deleteFeed();else if("updatewmssettings"==n.module)silent||WmsSettings.handleUpdateWmsSettings(n.data);else if("MYPINS"===n.module){var he=n.data;"PIN_CHAT"===he.action?WebMessanger.makeChatPinned(he.chat_id,he):"UNPIN_CHAT"===he.action?WebMessanger.makeChatUnPinned(he.chat_id):"ENTITY_REORDER"===he.action&&$WC.RecentChats.reorderPinnedChats(he.chat_id,he.pin_above)}else if("cw_opr"===n.module){if(!silent){o=n.data.chid;var ge=n.data.action;B=WindowHandler.getWinObjById(o);if("pin"===ge?WebMessanger.makeChatPinned(o):"unpin"===ge&&WebMessanger.makeChatUnPinned(o),B)if("min"===ge)B.minimize(),ChatBlink.stopRepeat();else if("seen"===ge){if(B.makeNormal(),ChatBlink.stopRepeat(),"11"==B.ctype)(H=WindowHandler.getWinObjById(B.thread_parentid))&&H.updateUnreadThreadCount(B.thread_parentid,B.objId),$WC.RecentChats.resetUnreadCount(o),WmsMainUI.decrementUnreadCount(B.thread_parentid)}else"close"===ge&&B.close();else WmsMainUI.getParentThreadId(o)?WmsMainUI.resetUnreadCount(WmsMainUI.getParentThreadId(o),null,o):WmsMainUI.resetUnreadCount(o),WmsMainUI.updateUnreadChatsCount(),WmsMainUI.getParentThreadId(o)?WmsMainUI.updateUnreadCountInUI(WmsMainUI.getParentThreadId(o)):WmsMainUI.updateUnreadCountInUI(o);"seen"!=ge&&"close"!=ge||(WmsMainUI.getParentThreadId(o)?$WC.RecentChats.updateLastSeenTime(WmsMainUI.getParentThreadId(o)):$WC.RecentChats.updateLastSeenTime(o),$WC.HybridSearch.isUnreadFilterOpen()&&WmsMainUI.filterUnreadChats())}(WebMessanger.isExclusiveChat()||WebMessanger.isRTCChat())&&"seen"==ge&&(B.makeNormal(),ChatBlink.stopRepeat(),$WC.RecentChats.updateLastSeenTime(o))}else if("system_msg"===n.module)"closeticketann"!==n.data.key||silent||WMSUI.closeTicketAnnouncement();else if("toursettings"===n.module)WmsSettings.handleTourSettings(n.data.settings);else if(n.data&&"MODULE_STATUS_CHANGE"===n.data.ACTION)$WC.SecurityManager.update(n.data.data),WmsSettings.adminsettings.moduleconfig=n.data.data;else if("custom_info"===n.module){if("add_chatdraft"===(e=n.data).opr){var fe={msg:e.msg,meta:e.meta,mtype:e.mtype,time:e.time,replied_to:e.replied_to,chid:e.chid};$WC.Drafts.update(e.chid,fe),$WC.Drafts.updateInLocalStorage(fe,!1)}else if("delete_chatdraft"===e.opr){var Ce=e.chatids;for(u=0;u<Ce.length;u++)$WC.Drafts.deleteDraft(Ce[u])}}else if("user_deactivated"===n.module)WebMessanger.chatdisabled=!0,WmsSettings.adminsettings.cliqaccess=!1,WebMessanger.turnOffChat(),WMSUI.populateDeactivatedChatUI();else if("bot"===n.module){var ve=(e=n.data).data.data;if("BOT_SUBSCRIBED"===e.ACTION)ve.active=!0,$WC.Bots.updateBotContacts([ve]);else if("BOT_UNSUBSCRIBED"===e.ACTION)$WC.Bots.removeFromSubscribedList(ve.id);else if("BOT_UPDATED"===e.ACTION){var be=$WC.Bots.get(ve.id),ye=be&&be.original_info,_e=$WC.Util.extend(!0,{},ye,ve);$WC.Bots.updateBotContacts([_e]),be&&be.ISSUBSCRIBED&&$WC.Util.pubsub.publish("/bots/updateui")}}else if("COMMAND"===n.module||"command"===n.module){var We=(e=n.data).data.data;"COMMAND_CREATED"===e.ACTION||"COMMAND_EDITED"===e.ACTION?Commands.updateList([We]):"COMMAND_DELETED"===e.ACTION&&Commands.deleteObj([We.id])}else if("linkpreview_status_update"===n.module)$WC.Config.set({zoholinks_auth:n.data.authentication_consent}),WmsMainUI.setLinkPreviewSettings();else if("ADD_STICKY"===n.module||"DELETE_STICKY"===n.module){var Se=n.data.chat_id,we=WindowHandler.getWinObjById(Se);if(we&&("DELETE_STICKY"===n.module?we.clearPinnedMsg():we.showPinnedMsg(n)),"ADD_STICKY"===n.module){var Me="STICKY:"+n.data.created_time;$WC.RecentChats.updateAddinfoData(Se,Me),$WC.Channels.updateAddinfoData(Se,Me),$WC.Chats.updateAddinfoData(Se,Me)}}else if("messageaction"===n.module){"MESSAGEACTION_CREATED"===(e=n.data).ACTION?$WC.addMessageActionToList(e.data.data):"MESSAGEACTION_DELETED"===e.ACTION&&$WC.removeMessageActionFromList(e.data.data)}else if("INTEGRATION_RESPONSE"===n.module){o=(e=n.data).data.chid,B=WindowHandler.getWinObjById(o);var Ie=e.data.dreResponse;if(B&&Ie&&"Success"===Ie.status&&"form"===Ie.output.type)(new $WC.Forms).mountComponent(Ie,Commands.showResponse,function(){B.composer.focus()})}else if("CHANNEL_EDIT"===n.module){e=n.data;$WC.Channels.updateConfig(e.oc_id,e.config)}}else if(e.mtype==SHOW_INFO)wmsUserConfig.infomsgid=e.msg.id,wmsUserConfig.infomsgprd=e.prd,e.msg.msg_spl?(wmsUserConfig.infomsg=e.msg.msg_spl,wmsUserConfig.infomsgtype=e.msg.type,WebMessanger.processSpecialAnnouncement(JSON.parse(wmsUserConfig.infomsg))):WMSUI.processAnnMsg(e.msg.msg,e.msg.type);else if(+e.mtype===CT_MSG_STORAGE){var Te=e.msg.opruser;B=WindowHandler.getWinObjById(e.msg.chid);Te.dname=Te.zuid===myMsgObj.zuid?$WC.I18N("chat.you"):$WC.Util.escapeHTML(Te.dname),key="0"===e.msg.history?"history.notsaved.user":"history.saved.user",B.updateInfoMessage($WC.I18N(key,Te.dname),e.msg.time),B.updateSaveHistory(e.msg.history),B.updateSaveHistoryInUI()}else if(+e.mtype===CT_ATTACH){o=e.msg.chid;(B=WindowHandler.getWinObjById(o))&&B.updateAttachInfo(!0)}else if(+e.mtype===WM_TICKET_MSG)WMSUI.showTicketAnnouncement(e.msg);else if(+e.mtype===PR_MSG)WmsImplHandler.invoke(Presence.handleMessage,e.msg);else if(+e.mtype===WM_DEF_STATUS){if(0==e.msg.scode&&(e.msg.scode=2,e.msg.smsg="Invisible"),WebMessanger.smsg=e.msg.smsg,WebMessanger.scode=e.msg.scode,WebMessanger.stype=e.msg.st,!_WMSEMPTYBAR&&!silent)try{WmsMainUI.updateUserStatusIcon(),WmsMainUI.updateUserStatusMsg()}catch(e){}WmsImplHandler.invoke(WmsContactImpl.handleStatusMessage,e.msg.scode,e.msg.smsg)}else if(+e.mtype===CT_NFY_MUTECHAT){if((B=WindowHandler.getWinObjById(e.msg.chid))&&B.updateMuteInfo(e.msg.muteinterval),e.msg.muteinterval&&e.msg.muteinterval>(new Date).getTime()?WmsMainUI.setMuteStatus(e.msg.chid,!0):WmsMainUI.setMuteStatus(e.msg.chid,!1),$WC.Util.isChannelChid(e.msg.chid)&&$WC.Channels.get(e.msg.chid))$WC.Channels.get(e.msg.chid).muted_interval=e.msg.muteinterval;else if($WC.RecentChats.get(e.msg.chid)||$WC.RecentChats.getFromPinnedChatList(e.msg.chid)||$WC.Chats.get(e.msg.chid)){($WC.RecentChats.get(e.msg.chid)||$WC.RecentChats.getFromPinnedChatList(e.msg.chid)||$WC.Chats.get(e.msg.chid)).MUTEDINTERVAL=e.msg.muteinterval}}else if(+e.mtype===CT_BOT_LIST)n=e.msg;else if(+e.mtype===CT_BOT_OPR){var Ae=(n=e.msg).data;U=-1!=Ae.id.indexOf("b-")?Ae.id.split("-")[1]:Ae.id;if("add"===n.operation)Ae.active=!0,Ae.id=U,$WC.Bots.updateBotContacts([Ae]);else if("remove"===n.operation){o=$WC.Bots.get(U)&&$WC.Bots.get(U).CHID;WebMessanger.makeChatUnPinned(o),$WC.Bots.removeFromSubscribedList(U)}if(!_WMSEMPTYBAR&&!silent&&!$WC.Config.get("customContacts")){var Ee={suggestions:"show_suggestions"};WmsHybridSearch.populateContactListInMainUI(!0,Ee),$WC.HybridSearch.populateRecentChats(),$WC.HybridSearch.getCurrentModule()===$WC.WmsConstants.HYBRIDSEARCH.modules.SMARTCHAT&&WmsHybridSearch.populateFrequentContactsInSmartChat()}}else if(+e.mtype===WM_ZTI_CROSSPRODUCT)WmsImplHandler.invoke(ZTI.handleCrossProductMessage,e.msg);else if(+e.mtype===CT_DELETED_MSG){var Ue=(n=e.msg).origin_time,xe=n.sender+"_"+Ue,Ne=(o=n.threadchatid||n.chid,Message.getDeletedMsgInfo(n.time));if(B=WindowHandler.getWinObjById(o)){var ke=B.ctrlcomp.querySelector('[data-msgid="'+xe+'"]');n.meta&&n.meta.prev_msg_info.attpath&&$WC.VideoPlayerFactory.removeExternalVideoPlayers(n.msguid),ke&&(1==n.info_visiblity?(ke.innerHTML=Ne,ke.setAttribute("data-type",Message.types.DELETEDMSG),ke.nextSibling&&"wms-msgtime"===ke.nextSibling.className&&(ke.nextSibling.querySelector("[data-edited]").setAttribute("data-edited","false"),$WC.Util.removeElement(ke.nextSibling.querySelector("[data-read-receipt]")))):B.checkAndRemoveMsg(ke)),Message.deletedMessages.insert(o,Ue),B.clearPinnedMsg(o)}else WmsChatCache.remove(o),Message.deletedMessages.remove(o);if(0==n.info_visiblity){$WC.DesktopNotification.close(xe);var Oe=$WC.RecentChats.getLastSeenTime(o);0!=WmsMainUI.getUnreadCount(o)&&0!=Oe&&Oe<=n.origin_time&&(WmsMainUI.decrementUnreadCount(o),B?B.updateBarMsgcount():WmsMainUI.updateUnreadCountInUI(o),0==WmsMainUI.getUnreadCount(o)&&B&&B.makeNormal())}$WC.RecentChats.get(o)&&$WC.RecentChats.get(o).LMTIME==n.origin_time&&$WC.RecentChats.updateLastMsgInfo({chid:o,sender:n.sender,dname:n.dname,msguid:n.msguid,msg:"",lmtime:n.origin_time,info_visiblity:n.info_visiblity,mtype:e.mtype})}else if(+e.mtype===CT_EDITED_MSG){Ue=(n=e.msg).msg[0].msg.origin_time,xe=n.msg[0].msg.sender+"_"+Ue,o=n.threadchatid||n.chid;if(B=WindowHandler.getWinObjById(o)){if(B.updateMessageFragment(n.msg[0],xe),B.pinmsgdetails.info.msgtime===Ue&&B.updatePinnedMsg(n.msg[0]),n.msg[1]){n.msg[1].msg.mtype=n.msg[1].mtype;var Re=B.ctrlcomp.scrollHeight-B.ctrlcomp.clientHeight<=B.ctrlcomp.scrollTop+20;Message.constructAndAppendChatContent([n.msg[1].msg],B.msgdisp,o),Re&&B.scrollDisplay()}}else WmsChatCache.remove(o),Message.deletedMessages.remove(o);n.msg[0].islastmsgid&&$WC.RecentChats.updateLastMsgInfo({chid:o,sender:n.sender,dname:n.dname,msguid:n.msguid,msg:n,lmtime:Ue})}else if(+e.mtype===CT_MSG_ADDL){if("302"===(n=e.msg).addldatatype)(B=WindowHandler.getWinObjById(n.chid))&&B.updatePlatformMsg(n);if("301"===n.addldatatype)if(B=WindowHandler.getWinObjById(n.chid)){var He=n.msg,$e=JSON.parse(He.addldata);B.updateReactionData(He.msguid,$e),B.updateReactionFragment(He.msguid),$WC.CustomMsg.msgobj[n.chid]&&$WC.CustomMsg.msgobj[n.chid][n.msguid.split("%")[0]]&&($WC.CustomMsg.msgobj[n.chid][n.msguid.split("%")[0]].reactions=JSON.parse(n.msg.addldata))}}else if(+e.mtype===CT_MSG_REACT){if("301"===(n=e.msg).addldatatype)if(B=WindowHandler.getWinObjById(n.chid)){He=n.msg,$e=JSON.parse(He.addldata);B.updateReactionData(He.msguid,$WC.Util.cloneObject($e,!0)),B.updateReactionFragment(He.msguid),B.checkAndUpdateThreadReaction(He.msguid,$WC.Util.cloneObject($e,!0),CT_MSG_REACT),$WC.CustomMsg.msgobj[n.chid]&&$WC.CustomMsg.msgobj[n.chid][n.msguid.split("%")[0]]&&($WC.CustomMsg.msgobj[n.chid][n.msguid.split("%")[0]].reactions=JSON.parse(n.msg.addldata))}}else if(+e.mtype===CT_MSG_REACT_CURR){if("301"===(n=e.msg).addldatatype)if(B=WindowHandler.getWinObjById(n.chid)){He=n.msg;($e=JSON.parse(He.addldata))[301]&&"true"==$e.current_user&&(B.updateCurrentUserReactionData(He.msguid,$WC.Util.cloneObject($e,!0)),B.checkAndUpdateThreadReaction(He.msguid,$WC.Util.cloneObject($e,!0),CT_MSG_REACT_CURR))}}else if(+e.mtype===WM_WEBRTC_MSG){n=e.msg;WmsImplHandler.invoke(Collaboration.handleWebRTCMessage,n)}else if(+e.mtype===CT_MSG_READRECEIPT){o=(n=e.msg).chid,B=WindowHandler.getWinObjById(o);n.msguid&&B&&WebMessanger.isReadReceiptEnabled()&&!WebMessanger.isExclusiveChat()&&!WebMessanger.isRTCChat()&&B.markMsgsRead(n.msguid)}else if("_"===e)"function"==typeof WebMessanger.RTT_callback&&WebMessanger.RTT_callback(Date.now()-WebMessanger.RTT_senttime);else if(+e.mtype===RTC_CUSTOMCHAT_CLOSE){if("CHAT_CLOSED"===e.msg.changedconfig)(B=WindowHandler.getWinObjById(e.msg.chid))&&B.disableComposerOptions($WC.I18N("rtc.chatclose.info"))}else+e.mtype===RTC_EVENT_MSG&&12==e.msg.ctype&&WmsImplHandler.invoke(WmsChatUIImpl.handleRTCEventMsg,e)},WebMessanger.mapChat=function(e){try{if("5"===e.ctype)return;var t,s=e.users,i=e.chid,n=e.recipients&&e.recipients.split(",");if(t=2==e.pcount?s?$WC.Util.isLocalUser(s[0].zuid)?s[1].zuid:s[0].zuid:$WC.Util.isLocalUser(n[0])?n[1]:n[0]:e.addinfo.split(":")[3],null!=WebMessanger.chatmap[i]&&!t&&t!=WebMessanger.chatmap[i])return delete WebMessanger.ucmap[WebMessanger.chatmap[i]],void delete WebMessanger.chatmap[i];t&&i&&(WebMessanger.ucmap[t]=i,WebMessanger.chatmap[i]=t,WebMessanger.waitchats[t]="JOIN")}catch(e){}},WebMessanger.callClearNotification=function(){$WC.Ajax.postRequestToChat("clearnotifications.do")},WebMessanger.ClearNotificationById=function(e){var t="nid="+encodeURIComponent(e);$WC.Ajax.postRequest("clearlivenotifications"+dext,t)},WebMessanger.getChatForUser=function(e){return WebMessanger.ucmap[e]},WebMessanger.loadTranscript=function(e,t,s,i,n,a,o){Message.constructAndInsertChatContent(e,i,t,n,a,o),Message.toggleLiveZomoji(Message.getScrollableParent(i)),Message.checkAndRemoveUrlImage(Message.getScrollableParent(i)),Message.checkAndLoadAudioPlayer(Message.getScrollableParent(i)),Message.loadUrlThumbnail(Message.getScrollableParent(i)),WMSUI.checkAndLoadCustomEmojis(Message.getScrollableParent(i)),i.clientHeight<i.parentElement.clientHeight&&WMSUI.loadImages(Message.getScrollableParent(i))},WebMessanger.wmsAjaxDispatcher=function(e,t,s){if("unreadmessage"==e){if(!WebMessanger.isCliqUser()&&"NODATA"!==s){var i=s.tableToRowList&&s.tableToRowList.ZohoMessages;$WC.RecentChats.setUnreadFeedsCount(i?i.length:0),$WC.HybridSearch.populateRecentChats(),WmsMainUI.updateUnreadChatsCount()}}else if("zohomessage"==e)ZMSGUI.fillHistory(s.tableToRowList);else if("zohomsgcount"==e){var n="NODATA"===s?$WC.RecentChats.getUnreadFeedsCount():JSON.parse(s);ZMSGUI.fillNavigation(n)}else if("zohomessageapi"==e)ZohoFeedImpl.handleFeedHistory(s.tableToRowList);else if("zohomsgcountapi"==e)ZohoFeedImpl.handleFeedHistoryCount(JSON.parse(s));else if("zohofeedsinrange"==e)ZohoFeedImpl.handleFeedsInRange(s.tableToRowList);else if("unreadmessageapi"==e)ZohoFeedImpl.handleUnreadFeeds(s.tableToRowList);else if("onlinestatus"==e)WmsImplHandler.invoke(Collaboration.handleIsOnline,s);else if("getdefaultstatus"==e)WebMessanger.smsg=s.smsg,WebMessanger.scode=s.scode,WmsImplHandler.invoke(WmsContactImpl.handleStatusMessage,s.scode,s.smsg);else if("getcustomstatus"==e)silent||WMSUI.populateCustomStatus(s.getRowsForTable("UserStatus")),WmsImplHandler.invoke(WmsContactImpl.handeAllStatusMessages,s.getRowsForTable("UserStatus"));else if("clearcustomstatus"!=e)if("addcontact"==e){if(!silent){if("errorList"==t){var a="",o="",r="",l="",d="",c=new $WC.ConfirmationDialog,m=[{text:$WC.I18N("common.ok"),onclick:function(){c.unmountComponent()},buttonstyle:"confirmation_button"}],u=[{text:$WC.I18N("chat.member.invite"),onclick:function(){},buttonstyle:"confirmation_button"},{text:$WC.I18N("common.cancel"),onclick:function(){c.unmountComponent()},buttonstyle:"cancel_button"}];for(var p in s)o=s[a=p];var h=WmsContacts.getDisplayName(a);h||"undefined"==typeof WmsProfileInfo||(h=WmsProfileInfo.profileinfo[a]&&WmsProfileInfo.profileinfo[a].dname),!h&&WebMessanger.ucmap[a]&&(h=WindowHandler.getWinObjById(WebMessanger.ucmap[a]).title),"Same user"==o?r=[$WC.I18N("contact.invite.sameuser",a),a]:"Contact already exists"==o?r=h?[$WC.I18N("contact.invite.exists",h),h]:[$WC.I18N("contact.invite.userexists")]:h&&(r=[$WC.I18N("invite.invalid.id",'"'+h+'"'),h],l=$WC.Util.safeHTML(h),m=[{text:$WC.I18N("chat.member.invite"),onclick:function(){var e=document.querySelector('[id="wms_contact_mailid"]').value;WmsContacts.add("zoho",e),c.unmountComponent()},buttonstyle:"confirmation_button"},{text:$WC.I18N("common.cancel"),onclick:function(){c.unmountComponent()},buttonstyle:"cancel_button"}],d=$WC.WmsContacts.getUserPhoto(a,"38"));var g={actions:m,heading:r,headerimgsrc:d,inputcontent:l,errorCallbackActions:u};c.mountComponent(g)}else WMSUI.showInfoMsg($WC.I18N("contact.invite.sent"));if(!_WMSEMPTYBAR&&!silent&&!$WC.Config.get("customContacts")){var f={suggestions:"show_suggestions"};WmsHybridSearch.populateContactListInMainUI(!0,f)}}}else if("reinvitecontactbyemailid"==e)silent||s&&(WMSUI.statusbar.innerHTML=$WC.I18N("Contact_successfully_reinvited"));else if("gettranscript"==e)silent||ZMSGUI.populate(s);else if("deletechat"==e)silent||ZMSGUI.handleDeleteChat();else if("deleteselectedchat"==e)silent||ZMSGUI.handleDeleteChat();else if("addmember"==e)silent||"Error adding member"==s.errorMessage&&alert($WC.I18N("The_email_address_you_entered_is_invaild"));else if("createim"===e||"joinchat"===e||"attachsession"===e)b(s);else if("wmsupdsettings"===e||"updsettings"===e)silent||WmsSettings.handleUpdateWmsSettings(s);else if("joinchannel"===e&&!silent){if($WC.Channels.get(s.CHAT.chid))$WC.Channels.updateChannel(s.CHAT.chid,"joined",1);else{var C={joined:[s.CHANNEL]};$WC.Channels.updateList({data:C})}b(s.CHAT);var v=WindowHandler.getWinObjById(s.CHAT.chid);v.updateChannelInfo(s.CHANNEL),v.updateParticipantsFromJoin(s.CHAT.users),v.updateMuteInfo(s.CHANNEL.mutedinterval)}function b(e){var t=e.ctype,s=e.chid;if(("1"===t||"5"===t||"8"===t||"9"===t||"11"===t||"10"===t&&e.entityid)&&(!silent||WebMessanger.isExclusiveChat()||WMSUI.getServiceChatContainer(s,msgObj))&&("5"!==t||!CustomChat.isActive(s,e.addinfo))){if(WmsChatUIImpl.isActive(s)||"true"===e.silent)return;if(e.pcount=+e.pcount,2===e.pcount){WindowHandler.updateInactiveUserStatus(s,e);var i=e.recipants.split(",");if(i.splice(i.indexOf(myMsgObj.zuid),1),e.sender=i[0],!WmsContacts.getDisplayName(e.sender))return}Chat.isExists(s)||("11"==e.ctype&&WebMessanger.wrapThreadsDataFromJoin(e),WMSUI.createNewChatWindow(e));var n=WindowHandler.getWinObjById(s);if(WindowHandler.updateInactiveUserStatus(s,e),n&&(n.showPinnedMsg(e),e.users&&(n.updateRecipientInfo(JSON.parse(e.users)),n.restrictFileSharingForExternalUser()),"1"==t&&"true"!=e.customgroup||!e.recipants||(n.recipant=e.recipants),(e.restricted_message||e.restricted_attachments)&&n.handleChatRestrictions(e),"1"==t&&2===e.pcount&&Message.handlePrivateReply(n.recipant)),"8"===t&&e.users){var a="string"==typeof e.users?JSON.parse(e.users):e.users;n.updateParticipantsFromJoin(a)}}}},WebMessanger.wrapThreadsDataFromJoin=function(e){e.recipants=e.creator,e.thread_msgid=e.threadmsguid,e.thread_parentid=e.parentchatid,e.thread_follower=e.is_follower||""+e.isfollower;var t={msguid:e.threadmsguid,thread_chid:e.chid,msgcount:e.totalmsgs,is_follower:"true"==e.thread_follower?$WC.I18N("thread.unfollow"):$WC.I18N("thread.follow"),chid:e.parentchatid};WebMessanger.getParentThreadMsg(null,null,t)},WebMessanger.presenceDispatcher=function(e,t,s){},WebMessanger.clearWaitChat=function(e){try{"WAIT"==WebMessanger.waitchats[e]&&(WebMessanger.waitchats[e]="CLEARED")}catch(e){}},WebMessanger.openUserChat=function(e,t,s,i,n){WebMessanger.createChat(e,t,s,i,n)},WebMessanger.createChat=function(e,t,s,i,n){var a="autojoin=true&attach=true";a=t?a+"&type=nim":a+"&type=im",a+="&userList="+e,s&&(a+="&title="+encodeURIComponent(s)),i&&(a+="&msg="+encodeURIComponent(i)),silent||(a+="&sid="+encodeURIComponent(WebMessanger.getSid())),n&&(a+="&src="+n),$WC.Ajax.postRequestToChat("createim.do",a)},WebMessanger.chat=function(e,t,s){var i=WebMessanger.ucmap[e];if(WebMessanger.isChatPaused()||silent){var n="function"==typeof s;WebMessanger.checkAndEnableChatBar(e,"",!0,s,n)}else{i&&Chat.isExists(i)&&WMSUI.handleChatExist(i),WmsMainUI.scheduleAutoFocus(e);try{if("WAIT"==WebMessanger.waitchats[e])return}catch(e){}WebMessanger.waitchats[e]="WAIT",setTimeout(WebMessanger.clearWaitChat.bind(this,e),5e3),ChatBlink.stopRepeat();var a="type=im&autojoin=true&userList="+e;silent||(a=a+"&sid="+encodeURIComponent(WebMessanger.getSid())),t&&(a+="&src="+t),$WC.Ajax.postRequestToChat("createim.do",a)}},WebMessanger.joinCollab=function(t){isNaN(t)||""==t.trim()||setTimeout(function(){var e="uname="+myMsgObj.sender+"&chid="+t;e=e+"&sid="+encodeURIComponent(WebMessanger.getSid()),$WC.Ajax.postRequest("joinchat"+dext,e)},100)},WebMessanger.createChatWindowFromCache=function(e,t,s){var i=WindowHandler.getWinObjById(e);if(!(silent||i&&i.attached))if(Chat.isExists(e))WmsMainUI.isAutoFocusScheduled(e)&&WmsMainUI.removeAutoFocusSchedule(e);else{var n,a=$WC.RecentChats.get(e),o=$WC.RecentChats.getFromPinnedChatList(e),r=$WC.Chats.get(e),l={};if($WC.Util.isChannelChid(e)&&(n=$WC.Channels.get(e)),s)l=s;else if(n){if(l.pcount=n.pc,l.title=n.dn,l.ctype=$WC.WmsConstants.CTYPES.CHANNEL,l.addinfo=n.addinfo,a||o||r){var d=a||o||r;l.addinfo=d.ADDINFO}}else if(a||r){(d=a||r).CTYPE!=$WC.WmsConstants.CTYPES.CHATLET&&(l.pcount=""+d.PARTICIPANTSCOUNT,l.title=d.TITLE,l.ctype=""+d.CTYPE,l.addinfo=d.ADDINFO,l.mutedinterval=d.MUTEDINTERVAL?""+d.MUTEDINTERVAL:d.MUTEDINTERVAL,l.customgroup=d.CUSTOMGROUP?""+d.CUSTOMGROUP:d.CUSTOMGROUP,l.users=d.PARTICIPANTS,!l.customgroup&&2<d.PARTICIPANTSCOUNT&&d.CTYPE==$WC.WmsConstants.CTYPES.CHAT&&(l.customgroup="true"))}if(!$WC.Util.isEmptyObject(l)&&!$WC.Util.isBotChid(e))l.chid=e,WMSUI.createNewChatWindow(l),(i=WindowHandler.getWinObjById(e))&&(i.showPinnedMsg(l),8!=i.ctype&&9!=i.ctype&&11!=i.ctype&&i.updateParticipantsFromJoin(l.users,!0));WebMessanger.attachSession(e)}},WebMessanger.closeThread=function(i){var e={"Content-Type":"application/json","x-consents-version":"1","X-XHR-exception":!0,"X-ZCSRF-TOKEN":$WC.Util.getCSRF()};$WC.Ajax.putRequestToChat("v2/threads/"+i,{action:"close"},function(){WMSUI.showInfoMsg($WC.I18N("thread.closed.info"));var e=WindowHandler.getWinObjById(i);e.thread_state="closed",e.closethreadnode.style.display="none",e.avatarnode.querySelector("[data-cutouticon]").className="wms_badge_statusicon_closedthread_cutout wms_badge_img_cutout";var t=document.getElementById(e.thread_parentid),s=t&&t.querySelector('[data-thread_msgid="'+e.thread_msgid+'"]');s&&s.setAttribute("data-thread_state",e.thread_state),WebMessanger.makeChatUnPinned(i)},null,null,null,e)},WebMessanger.attachSession=function(s,e,i){var n=void 0!==e?e:2,t="&sid="+encodeURIComponent(WebMessanger.getSid()),a="chid="+s+t,o=function(){WMSUI.showErrorMsg($WC.I18N("message.error.openchatwindow"))};$WC.Ajax.postRequestToChat("attachsession.do",a,function(){var e=JSON.parse(this.response)[0].objString;if("false"==e.chatavailable&&0<n)WebMessanger.attachSession(s,n-1);else{if(!Chat.isExists(s)){if("false"==e.chatavailable&&$WC.Util.isThreadChid(s)&&"false"==e.parent_participant)return void o();$WC.Util.isThreadChid(s)&&WebMessanger.wrapThreadsDataFromJoin(e),WMSUI.createNewChatWindow(e)}$WC.Util.isChannelChid(s)&&(WebMessanger.isRTCChat()||($WC.Channels.updateChannelMetaData(e),$WC.Channels.updateAddinfoData(e.chid,e.addinfo)),WindowHandler.getWinObjById(e.chid)&&WindowHandler.getWinObjById(e.chid).showPinnedMsg(e));var t=WindowHandler.getWinObjById(e.chid);t&&(t.updateCWInfoFromAttachSession(e),t.restrictFileSharingForExternalUser()),i&&i()}},o)},WebMessanger.join=function(e,t){var s,i="";silent||(i="&sid="+encodeURIComponent(WebMessanger.getSid())),s="uname="+myMsgObj.sender+"&chid="+e+i,$WC.Ajax.postRequest("joinchat"+dext,s,t,t)},WebMessanger.joinChannel=function(e){var t="",s="";silent||(t="&sid="+encodeURIComponent(WebMessanger.getSid()));s="chid="+e+t;s+="&attach=true",$WC.Ajax.postRequestToChat("joinchannel.do",s)},WebMessanger.approveChannel=function(e){$WC.Ajax.postRequestToChat("v1/channels/"+e+"/approve",null,function(){WMSUI.showInfoMsg($WC.I18N("channel.approved",[this.response.data.cn]))},function(){WMSUI.showErrorMSg($WC.I18N("event.status.update.error"))})},WebMessanger.rejectChannel=function(e){$WC.Ajax.postRequestToChat("v1/channels/"+e+"/reject",null,function(){WMSUI.showInfoMsg($WC.I18N("channel.rejected",[this.response.data.cn]))},function(){WMSUI.showErrorMSg($WC.I18N("event.status.update.error"))})},WebMessanger.handleCalendarEvents=function(e){var t="api="+e;$WC.Ajax.postRequestToChat("executesystemfunction.do",t,function(){var e=this.response?JSON.parse(this.response)[0].objString:"";e.message?WMSUI.showInfoMsg(e.message):e.errorMessage&&WMSUI.showErrorMsg(e.errorMessage)},function(){WMSUI.showErrorMsg($WC.I18N("event.status.update.error"))})},WebMessanger.fetchTeamChannelMembers=function(i){var e=$WC.Channels.get(i),t=[];if(e.scid.forEach(function(e){$WC.Channels.getTeamMembersList(e)||t.push(e)}),t.length){var s="groupid="+t.join(",");$WC.Ajax.requestToChat("getgroupmembers.do",s,function(){var e=JSON.parse(this.response)[0].objString;for(var t in e)$WC.Channels.insertTeamMemberslist(t,e[t]);var s=WindowHandler.getWinObjById(i);s&&(Commands.hideLoadingIcon(i),WMSUI.atMentions.init(i,s.composer))})}},WebMessanger.fetchChannelMembers=$WC.Util.debounce(function(a,e,o,t){$WC.Channels.get(a);var r=WindowHandler.getWinObjById(a);function s(e,t){for(var s in t)if(0===e.indexOf(s)&&null===t[s])return!0;return!1}function i(e,t){return-1!==t.indexOf(e)}function n(){var e=JSON.parse(this.response).data;if(r){var t=o===$WC.WmsConstants.TRIGGERS.ADDMEM?r.allowedmembers:r.allowedmentions,s=t.members.length?t.members:[];e.users.length?e.users.forEach(function(e){if(!$WC.Util.isLocalUser(e.zuid)){var t={};t.DNAME=e.dname,t.EMAILID=e.email,t.USERID=e.uname,WmsContacts.get(e.zuid)?(t.STATUS=WmsContacts.get(e.zuid).STATUS,t.STYPE=WmsContacts.get(e.zuid).STYPE,t.UC=WmsContacts.get(e.zuid).UC):t.UC="0",s.push(t)}}):this.opts.callbackargs.result_mapping.push(this.opts.callbackargs.searchterm);var i={};t.members=s.filter(function(e){return!i[e.USERID]&&(i[e.USERID]=!0)});var n=this.opts.callbackargs.token_mapping;e.next_token?n[this.opts.callbackargs.search_term]=e.next_token:n[this.opts.callbackargs.search_term]=null,Commands.hideLoadingIcon(a),WMSUI.atMentions.init(a,r.composer)}}var l="",d={};if(o===$WC.WmsConstants.TRIGGERS.ADDMEM){if(!1===s(e,r.allowedmembers.token_mapping)&&!i(e,r.allowedmembers.result_mapping)){var c=a;l=$WC.Util.isThreadChid(a)?(c=r.thread_parentid,"search="+e):"search="+e+"&mode=allowed",d.token_mapping=r.allowedmembers.token_mapping,d.search_term=e,d.result_mapping=r.allowedmembers.result_mapping,$WC.Ajax.requestToChat("v1/chats/"+c+"/participants",l,n,null,d)}}else if(o===$WC.WmsConstants.TRIGGERS.ATMENTION){var m,u=!1,p=!1,h=!1;!1!==s(e,r.allowedmentions.token_mapping.participants)||i(e,r.allowedmentions.result_mapping.participants)||(u=!0,m="participants"),!1===u&&$WC.Channels.isTeamChannel(a)&&!1===s(e,r.allowedmentions.token_mapping.team)&&!i(e,r.allowedmentions.result_mapping.team)&&(p=!0,l="mode=mention&category=team",m="team"),!1!==u||!1!==p||!1!==s(e,r.allowedmentions.token_mapping.org)||i(e,r.allowedmentions.result_mapping.org)||(h=!0,l="mode=mention&category=organization",m="org"),d.token_mapping=r.allowedmentions.token_mapping[m],d.search_term=e,d.result_mapping=r.allowedmentions.result_mapping[m],(u||p||h)&&(e&&(l+="&search="+e),$WC.Ajax.requestToChat("v1/chats/"+a+"/participants",l,n,null,d))}else{$WC.Ajax.requestToChat("v1/chats/"+a+"/participants",null,function(){var e=this.response?JSON.parse(this.response).data.users:"";WindowHandler.getWinObjById(a)&&(r.updateParticipantsFromJoin(e),t&&t())})}},null,500,!0),WebMessanger.joinChannelWithUID=function(e,t){WebMessanger.prefetch_channels&&null===$WC.Channels.getLastFetchedTime()&&$WC.Channels.initChannels();var s,i="v1/channels/"+e+"/join";t&&(s="attach=true&sid="+encodeURIComponent(WebMessanger.getSid()));$WC.Ajax.postRequestToChat(i,s,function(){var e=JSON.parse(this.response);WebMessanger.wmsAjaxDispatcher("joinchannel","object",e.data)})},WebMessanger.quit=function(e){isNaN(e)||""==e.trim()||$WC.Ajax.postRequest("quitchat"+dext,"close=true&uname="+myMsgObj.sender+"&sid="+encodeURIComponent(WebMessanger.getSid())+"&chid="+e)},WebMessanger.verifyUserStatus=function(e,t){var s="czuid="+e+"&ccode="+t;$WC.Ajax.postRequest("verifystatus"+dext,s)},WebMessanger.setIdle=function(){WmsImplHandler.invoke(WmsUIImpl.handleDocumentIdle);var s=0,i="useridle"+dext,n="sid="+encodeURIComponent(WebMessanger.getSid());function a(){if(null==WebMessanger.scode&&null==WebMessanger.smsg){var e=WebMessanger.syncStatusMessage();null!=e?(WebMessanger.scode=e.scode,WebMessanger.smsg=e.smsg):(WebMessanger.scode=1,WebMessanger.smsg=WebMessanger.statusarr[WebMessanger.scode])}else null==WebMessanger.smsg&&null!=WebMessanger.scode&&(WebMessanger.smsg=WebMessanger.statusarr[WebMessanger.scode]);if(WMSUI.changedscode=WebMessanger.scode,WMSUI.changedsmsg=WebMessanger.smsg,WebMessanger.scode=4,"Available"==WebMessanger.smsg||"Busy"==WebMessanger.smsg){WebMessanger.smsg="Idle"}WebMessanger.isIdle=!0,WebMessanger.setIdleStatusInClient(WebMessanger.isIdle)}$WC.Ajax.postRequest(i,n,a,function e(){var t=setTimeout(function(){$WC.Ajax.postRequest(i,n,a,e)},5e3);3==++s&&clearTimeout(t)})},WebMessanger.setActive=function(){var s=0,i="useractive"+dext,n="sid="+encodeURIComponent(WebMessanger.getSid());function a(){null!=WMSUI.changedscode&&null!=WMSUI.changedsmsg?(WebMessanger.scode=WMSUI.changedscode,WebMessanger.smsg=WMSUI.changedsmsg):(WMSUI.changedscode=1,WebMessanger.scode=1),null==WebMessanger.smsg&&(WebMessanger.smsg=WebMessanger.statusarr[WebMessanger.scode]),WebMessanger.isIdle=!1,WebMessanger.setIdleStatusInClient(WebMessanger.isIdle)}$WC.Ajax.postRequest(i,n,a,function e(){var t=setTimeout(function(){$WC.Ajax.postRequest(i,n,a,e)},5e3);3==++s&&clearTimeout(t)})},WebMessanger.setTimeZoneOffset=function(e){_TZOFFSET=e},WebMessanger.getTranscript=function(e,W,t,s){var S=e.chid,i=e.partial,w=e.fromtime,M=e.totime,I=e.mentionmsgid,n=e.salesiqchat,a=e.unreadchat,T=e.type,A=e.msgarr,o=e.lineslimit||50;if(I)var E=W.querySelector('[data-marker="'+I+'"]');else w?E=W.querySelector('[data-marker="'+w+'"]'):M?E=W.querySelector('[data-marker="'+M+'"]'):W.querySelector('[data-marker="latestchunk"]')&&(E=W.querySelector('[data-marker="latestchunk"]'));var r="gettranscriptfromrsasjson.do",l={"X-Reader-Version":1};function d(e){var t=Message.getScrollHeight(W),s=Message.getScrollTop(W);if(Message.restoreScrollPosition(W,t,s),e=WebMessanger.isGuestUser()?this.responseText&&this.responseText.slice(1,-2):e||this.responseText&&this.responseText.slice(0,-1),0<(e=JSON.parse("["+e+"]")).length){if(I||"insert"==T){if(I){if(w||M){var i=w,n=M,a=e.some(function(e){return(CT_DELETED_MSG===+e.mtype||CT_EDITED_MSG===+e.mtype?e.origin_time:e.time)==i}),o=e.some(function(e){return(CT_DELETED_MSG===+e.mtype||CT_EDITED_MSG===+e.mtype?e.origin_time:e.time)==n});if(a){var r=[];"more"===e[0].mode&&e.shift(),e.forEach(function(e){var t=CT_DELETED_MSG===+e.mtype||CT_EDITED_MSG===+e.mtype?e.origin_time:e.time;("more"===e.mode||w<t)&&r.push(e)}),e=r}o&&(e=e.filter(function(e){return(CT_DELETED_MSG===+e.mtype||CT_EDITED_MSG===+e.mtype?e.origin_time:e.time)<M}))}"insert"===T&&E!==E.parentNode.firstChild&&"more"===e[0].mode&&e.shift()}var l=e[e.length-1];"more"===l.mode&&(l=e[e.length-2]);var d="more"===e[0].mode?e[1]:e[0];if(M===+l.time||(CT_DELETED_MSG===+l.mtype||CT_EDITED_MSG===+l.mtype)&&M===+l.origin_time){var c=e.indexOf(l),m=W.querySelector('[data-msgid][data-msgtime="'+M+'"]');if(e[c-1]&&e[c-1].sender==l.sender||m&&m.previousSibling.getAttribute("data-senderzuid")||I&&2!==I.split("|").length||"16"===l.mtype)"more"===e.pop().mode&&e.pop()}if(w===+d.time||(CT_DELETED_MSG===+d.mtype||CT_EDITED_MSG===+d.mtype)&&w===+d.origin_time)"more"===e.shift().mode&&e.shift();if(M&&E!==E.parentNode.lastChild&&E!==E.parentNode.firstChild&&"wms_threadsheaderwrapper"!==E.parentNode.firstChild.id){var u=$WC.Util.getAdjacentNode(E,!0,"data-msgid").getAttribute("data-msgtime")||"";e.some(function(e){return(CT_DELETED_MSG===+e.mtype||CT_EDITED_MSG===+e.mtype?e.origin_time:e.time)==u})&&(e=e.filter(function(e){var t=CT_DELETED_MSG===+e.mtype||CT_EDITED_MSG===+e.mtype?e.origin_time:e.time;return u<t}))}1!=e.length&&(e[e.length-1]&&"more"===e[e.length-1].mode&&E!==E.parentNode.lastChild&&(e[e.length-1].mode="morebutton"),e[0]&&"more"===e[0].mode&&E!==E.parentNode.firstChild&&"wms_threadsheaderwrapper"!==E.parentNode.firstChild.id&&(e[0].mode="morebutton"))}if(WebMessanger.loadTranscript(e,S,T,W,E,w,M),f=WindowHandler.getWinObjById(S)){if(!WebMessanger.isGuestUser()){f.restoreDraftedMsg();var p=$WC.Drafts.get(S);if(p&&p.replied_to){var h=p.replied_to.split("_")[1];if(S+"|"+h===I)var g=!0}}f.lastmsg_uid=e.length&&e[e.length-1]&&e[e.length-1].msguid||""}var f,C=$WC.RecentChats.getLastSeenTime(S);if(C)if(f=WindowHandler.getWinObjById(S)){var v=f.win.querySelector('[data-msgtime="'+C+'"]'),b=f.win.querySelector("[data-unread]");if(v&&!b){var y=!M;f.showUnreadMsgs(y)}I&&C===I.split("|")[1]&&$WC.RecentChats.get(S)&&$WC.RecentChats.get(S).uc_useropened&&(f.makeNormal(!0,!0),$WC.RecentChats.get(S).uc_useropened=!1)}if(I&&!C&&!g||I&&"wmschshtransmsg"===W.id&&""!=ZMSG_SEARCHVALUE){var _=decodeURIComponent(I).split("|")[2];2===I.split("|").length&&(_=decodeURIComponent(I).split("|")[1],Message.getScrollableParent(W).scrollTop=0,W.setAttribute("data-glowtime",_)),Message.glowBubble(_,Message.getScrollableParent(W),S)}f&&f.toggleUnreadThreadBanner()}E&&$WC.Util.removeElement(E),A&&Message.sendmsg(S,A)}function c(){if(A)Message.sendmsg(S,A);else{if(!I&&!w&&!M)var e="true";var t=[{messagetype:Message.types.TRANSERR,msg:{prevtime:w,nexttime:M,mentionmsgid:I,latestchunk:e}}];WebMessanger.loadTranscript(t,S,T,W,E),E&&$WC.Util.removeElement(E)}}if(e="chid="+S+"&tzoffset="+_TZOFFSET+"&lang="+WebMessanger.language+"&ccode="+WebMessanger.countrycode,t||WebMessanger.isRTCChat()?(r="gettranscriptasjsonforweb.do",e="chid="+S+"&tzoffset="+_TZOFFSET,I&&(e+="&mentionmsgid="+encodeURIComponent(I)),a&&(e+="&makeread=true")):"boolean"==typeof i&&(e+="&partial="+i),void 0!==$WC.Config.get("dateformat")&&(e+="&dateformat="+encodeURIComponent($WC.Config.get("dateformat"))),!0!==s&&(e+="&lineslimit="+o),w&&(e+="&fromtime="+w),M&&(e+="&totime="+M),!n)return WebMessanger.isGuestUser()?(e="guest_id="+WebMessanger.guest_info.encrypt_id+"&lineslimit="+o+"&",w&&(e+="&fromtime="+w),M&&(e+="&totime="+M),l={"x-consents-version":"1","X-XHR-exception":!0,"X-ZCSRF-TOKEN":$WC.Util.getCSRF(),"x-cliq-guid":WebMessanger.guest_info.encrypt_id},$WC.Ajax.requestToChat("guestapi/v2/chats/"+S+"/transcript",e,d,c,null,null,l)):$WC.Ajax.requestToChat(r,e,d,c,null,null,l);"undefined"!=typeof WmsUIImpl&&(e={chatid:S,fromtime:w,totime:M},WmsImplHandler.invoke(WmsUIImpl.getTranscript,e,d,c))},WebMessanger.renderTranscript=function(e,t,s){ZMSGUI.viewChatTranscript(t,e,null,s)},WebMessanger.clearTranscript=function(e,t){e.innerHTML="",$WC.VideoPlayerFactory.removeAllComponents(t)},WebMessanger.sendMessage=function(e,t,s){var i="chid="+e+"&sender="+myMsgObj.sender+"&msg="+encodeURIComponent(t)+"&dname="+encodeURIComponent(WebMessanger.getNickName())+"&sid="+encodeURIComponent(WebMessanger.getSid());try{null!=s&&""!=s&&(i+="&style="+encodeURIComponent(s))}catch(e){}$WC.Ajax.postRequest("sendmessage"+dext,i),$WC.Util.consoleWarn("WebMessanger.sendMessage javascript method is deprecated and it will be removed in upcoming release. Use WebMessanger.sendMessage java api instead")},WebMessanger.sendFormattedMessage=function(l,e,d,n,t,s,i,a,o,r,c,m,u){var p,h=WindowHandler.getWinObjById(l),g="chid="+l+"&msg="+encodeURIComponent(e)+"&dname="+encodeURIComponent(WebMessanger.getNickName())+"&sid="+encodeURIComponent(WebMessanger.getSid())+"&msgid="+d+"&unfurl="+h.unfurlmsg,f={"x-consents-version":"1","X-XHR-exception":!0,"X-ZCSRF-TOKEN":$WC.Util.getCSRF()};function C(e){-1!==_WMS_REQLOG.indexOf(e)&&_WMS_REQLOG.splice(_WMS_REQLOG.indexOf(e),1)}a&&(g+="&reply_to="+encodeURIComponent(a)),u&&(g+="&reply_from="+encodeURIComponent(u)),o&&(g+="&msguid="+encodeURIComponent(o)+"&notifyedit="+r),c&&(g+="&post_in_parent="+c),m&&(g+="&thread_message_id="+encodeURIComponent(m),c||(g+="&post_in_parent=false")),h.unfurldata_cache_id&&(g+="&unfurl_cache_id="+h.unfurldata_cache_id,h.unfurldata_cache_id=""),_WMS_REQLOG.push(d),WMSUI.atMentions.isLocationAllowedForMentionedBots(l)&&(p=!0),Commands.getCommandId(e)&&Commands.isCommandMsg(e)&&(t=Commands.getCommandId(e),s=s||"&commandid="+t,i=!0,Commands.isLocationAllowedForExecution(t)&&(p=!0));var v=function(){if(C(d),this.response){var e=JSON.parse(this.response)[0].objString;if(e.dreResponse){var t=WindowHandler.getWinObjById(l);if(e.dreResponse.output&&e.dreResponse.output.msg)t.updateMessage(e.dreResponse.output);else if("Consent"===e.dreResponse.status||"Failure"===e.dreResponse.status&&!$WC.Util.isEmpty(e.dreResponse.resumeUrl)){(new $WC.Consents).mountComponent(l,e.dreResponse,null,t.composer)}else if("Success"===e.dreResponse.status&&e.dreResponse.output&&e.dreResponse.output.actions){(new $WC.Forms).mountComponent(e.dreResponse,Commands.showResponse,function(){var e=WindowHandler.getWinObjById(l);e&&e.composer.focus()})}}if(e.mtype==CT_TXT_MSG&&(t=WindowHandler.getWinObjById(e.chid))){var s=t.ctrlcomp.querySelector('[data-msgid="'+e.sender+"_"+e.msgid+'"]');if(s&&s.nextSibling&&s.nextSibling.getAttribute("data-timefrag")){var i=!(!t||"1"!==t.ctype||t.isZohoGroupChat()),n={senderzuid:e.sender,startype:0,star:!1};s.nextSibling.outerHTML=Message.constructTimeFragment(e.msgid,null,!1,i,null,null,n)}var a=JSON.parse(this.response)[0];if(a.objString.meta&&a.objString.meta.mentions){var o=[];for(var r in a.objString.meta.mentions)a.objString.meta.mentions[r].isparticipant||o.push(a.objString.meta.mentions[r]);t.showAddUserPrompt(o)}}}};if(n&&n.length)v=function(){C(d),Message.sendmsg(l,n)};var b=function(){C(d);var e=WebMessanger.zuid+"_"+d,t=WindowHandler.getWinObjById(l),s=t.ctrlcomp;WMSUI.handleMessageFailure(s,e),t.scrollDisplay(!0,s),n&&n.length&&Message.sendmsg(l,n);var i="string"==typeof this.response&&""!=this.response?JSON.parse(this.response):this.response;i[0]&&i[0].objString&&t&&t.handleChatRestrictions(i[0].objString)};if(i)v=function(){if(C(d),this.response){var e=JSON.parse(this.response)[0].objString;if("Consent"===e.dreResponse.status)Commands.removeProgressBar(l),(new $WC.Consents).mountComponent(l,e.dreResponse,Commands.consentsCallback,h.composer);else e.dreResponse.output&&(e.dreResponse.output.isTempResponse=!0),Commands.showResponse(l,t,e.dreResponse)}},b=function(){C(d),Commands.removeProgressBar(l)};if(s&&(g+=s),WebMessanger.isGuestUser()){var y={sid:WebMessanger.sid,id:d,text:e},_="guestapi/v2/chats/"+l+"/message";o&&(_="guestapi/v2/chats/"+l+"/messages/"+o,y.notify_edit=r),a&&(y.reply_to=a),f["Content-Type"]="application/json",f["x-cliq-guid"]=WebMessanger.guest_info.encrypt_id,o?$WC.Ajax.putRequestToChat(_,y,v,b,null,null,f):$WC.Ajax.postRequestToChat(_,y,v,b,null,null,f)}else p?$WC.Ajax.postRequestToChatWithLocation("sendofficechatmessage.do",g,v,b,null,null,f):$WC.Ajax.postRequestToChat("sendofficechatmessage.do",g,v,b,null,null,f)},WebMessanger.muteChat=function(t,e,s){var i="chatid="+t+"&mute="+s;null!==e&&(i+="&time="+e);$WC.Ajax.postRequestToChat("mutechat.do",i,"",function(){var e=WindowHandler.getWinObjById(t);e&&(e.showErrorMsg($WC.I18N("chat.mute.failed")),e.updateMuteInfo(!s))})},WebMessanger.leaveChat=function(e){$WC.Ajax.postRequestToChat("v2/chats/"+e+"/leave")},WebMessanger.followThread=function(e,t){var s=WindowHandler.getWinObjById(e),i="true"==t?"false":"true",n=function(){WMSUI.showInfoMsg($WC.I18N("thread.follow.success")),$WC.$CUtil.setInnerText(s.followernode,$WC.I18N("thread.unfollow")),s.thread_follower=i,s.updateThreadFollowerInfo(!0,1)};"false"===t?$WC.Ajax.postRequestToChat("v2/threads/"+e+"/follow",null,n):(n=function(){WMSUI.showInfoMsg($WC.I18N("thread.unfollow.success")),$WC.$CUtil.setInnerText(s.followernode,$WC.I18N("thread.follow")),s.thread_follower=i,s.updateThreadFollowerInfo(!0,null,1)},$WC.Ajax.postRequestToChat("v2/threads/"+e+"/unfollow",null,n))},WebMessanger.serverup=function(e){WebMessanger.hideBanner(),"undefined"!=typeof AcsApi&&WmsImplHandler.invoke(AcsApi.handleServerUP),WebMessanger.updateDebugInfo("Called serverup"),WmsImplHandler.invoke(Collaboration.serverup,e),_WMS_RETRY_COUNT=0,WebMessanger.systemdown=!1,e&&e.t&&WebMessanger.set_server_sync_timediff(e.t),_WMSEMPTYBAR||silent||(WmsChatCache.removeAll(),Message.deletedMessages.removeAll(),WmsMainUI.updateUserName(),Commands.sync=!0,WmsMainUI.updateChatInvitationCount())},WebMessanger.serverdown=function(e,t){WebMessanger.systemdown=!0,WebMessanger.updateDebugInfo("Called serverdown"),WmsImplHandler.invoke(Collaboration.serverdown),e?(clearTimeout(retryregistertimer),WebMessanger.showBanner(e,t)):iswmsframemonitorrunning||WebMessanger.showBanner(),WindowHandler.resetAllTypingStatus(),WmsContacts.removeInvitations()},WebMessanger.feedhistory=function(){ZMSGUI.launchHistory()},WebMessanger.enableSST=function(){},WebMessanger.enableTokenPairAuth=function(){this.tokenpairauth=!0,this.authtype=10},WebMessanger.documentready=function(){WmsContacts.init(),WindowHandler.init()},WebMessanger.setCSRFParamName=function(e){_WMSCFPARAMNAME=e,$WC.WmsConstants.WMSCFPARAMNAME=e,$WC.Config.set({WMSCFPARAMNAME:_WMSCFPARAMNAME})},WebMessanger.setCSRFTokenCookieName=function(e){_WMSCFCOOKIENAME=e,$WC.WmsConstants.WMSCFCOOKIENAME=e,$WC.Config.set({WMSCFCOOKIENAME:_WMSCFCOOKIENAME})},WebMessanger.setChatCSRFCookieName=function(e){_CHATCFTOKEN=e,$WC.WmsConstants.CHATCFCOOKIENAME=e,$WC.Config.set({CHATCFCOOKIENAME:_CHATCFTOKEN})},WebMessanger.setChatCSRFParamName=function(e){_CHATCFPARAMNAME=e,$WC.Config.set({CHATCFPARAMNAME:_CHATCFPARAMNAME})},WebMessanger.setBarSettingsValue=function(e){for(var t in e)if(null!=t||null!=e[t])for(var s in WmsSettings.bsettings)t==s&&e[t]&&(WmsSettings.bsettings[s]=e[t]);var i=$WC.Util.createElement("script");i.type="text/javascript";var n=this.rebrand?this.rebrand+"_":"";if(this.loadlocalfiles){var a="",o=document.querySelector('script[src*="wms.js"]');if(o){var r=o.src.split("/");a=r[0]+"//"+r[2]}$WC.Config.set({builddomain:a}),i.src=a+"/"+_WMSCONT+"/javascript/resource/"+n+WebMessanger.language+".js"}else{var l=window.location.protocol,d="https:"===l?wmsjsversion+"_https":wmsjsversion,c=this.jsstaticdomain+"/ichat/"+d+"/js/resource/"+n+WebMessanger.language+".js";WebMessanger.fp_hash&&(c=this.jsstaticdomain+"/ichat/js/"+WebMessanger.fp_hash["resource/"+n+WebMessanger.language+".js"]),i.src=l+"//"+c}EventsUtil.attachonload.call(i,function(){WebMessanger.resourceloaded=!0,WebMessanger.updateDebugInfo("Resource loaded"),WebMessanger.initializeConnectivity(),Smiley=new $WC.Zomoji({default_size:"24",animation:{default_size:"24"}}),Smiley.init=function(){},Smiley.extrasmiley_lookup=Smiley.symbol_lookup,Smiley.defaultsmiley_lookup=Smiley.symbol_lookup,Message.reactions=new $WC.Zomoji({default_size:"24",animation:{default_size:"24"},customemoji_size:"small"}),WmsSettings.populate(),WMSUI.updateResourceInAnnouncementBanner()}),document.body.appendChild(i)},WebMessanger.isResourceLoaded=function(){return WebMessanger.resourceloaded};var wmsUserConfig={};function getWMSRTCAccessToken(){return _WMSRTCATOKEN}function isLongPollingForced(){return _WMS_LP}function populateSpecialWMSAnnouncement(e){WebMessanger.populateSpecialWMSAnnouncement(e)}WebMessanger.setUserConfig=function(e){wmsUserConfig=e},WebMessanger.appendGlobalSearch=function(t){if(!_isGSearchAppended&&WMSUI.globalsearchenabled){var e=$WC.Util.createElement("script");e.defer=!0,e.type="text/javascript",EventsUtil.attachonload.call(e,function(){var e={onZSReady:function(){0==WMSUI.hidegsicon&&(document.getElementById("wmsglobalsearch").style.display="block"),_isGSearchAppended=!0,t&&t()}};zgssearch.initZGSHandler(e)}),e.src=window.location.protocol+"//"+WebMessanger.jsstaticdomain+"/zohosearch/h1/js/gshandler.js?_T="+(new Date).getTime();var s=document.getElementsByTagName("head");s&&0!=s.length||(s=[$WC.Util.createElement("head")],document.insertBefore(document.body,s[0])),s[0].appendChild(e)}},WebMessanger.appendPhoneBridge=function(){var e=WMSUI.phonebridgeconfig;if(WMSUI.phonebridgeenabled){var t={};t.parts=location.hostname.split("."),t.subdomain=t.parts.shift(),t.uplvldom=t.parts.join("."),t.server="https://phonebridge."+t.uplvldom,null!=e.pbDomain&&""!=e.pbDomain&&(t.server=e.pbDomain);var s=document.createElement("script"),i=new XMLHttpRequest;i.open("GET",t.server+"/phonebridge/users/loadJS",!0),i.withCredentials=!0,i.onreadystatechange=function(){4===i.readyState&&(s.src="https:"+i.response,s.onload=function(){PB.jsurl=s.src.substring(0,s.src.lastIndexOf("/")),PB.init(e)},document.head.appendChild(s))},i.send(null)}},WebMessanger.lazyLoadGlobalSearchFiles=function(e){return _WMS_LAZYLOAD_SCRIPT=!0,WebMessanger.appendGlobalSearch.bind(this,e)},WebMessanger.setReminder=function(e){var t=WindowHandler.getWinObjById(e.chat_id),s={"Content-Type":"application/json","X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.Util.getCSRF()};$WC.Ajax.postRequestToChat("v2/reminders",e,function(){t.showInfoMsg($WC.I18N("reminders.add.success"))},function(){t.showErrorMsg($WC.I18N("reminders.add.failed"))},null,null,s)},WebMessanger.markReminderAsComplete=function(e,t){var s=WindowHandler.getWinObjById(t.chid),i={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.Util.getCSRF()};$WC.Ajax.putRequestToChat("v2/reminders/"+e+"/complete",null,function(){s.showInfoMsg($WC.I18N("reminders.complete.success"))},null,null,null,i)},WebMessanger.snoozeReminder=function(e,t,s){var i=WindowHandler.getWinObjById(s.chid),n={"Content-Type":"application/json","X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.Util.getCSRF()},a={time:t};$WC.Ajax.putRequestToChat("v2/reminders/"+e+"/snooze",a,function(){i.showInfoMsg($WC.I18N("reminders.snooze.success"))},null,null,null,n)},WebMessanger.parseReminderTime=function(e,i){if(!WebMessanger.isGuestUser()&&!WebMessanger.isRTCChat()){var t=e.closest("[data-msgtime]").getAttribute("data-msgtime");if(!WebMessanger.getReminderInfo(t)){var s="time="+t,n={time:t},a={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.Util.getCSRF()};$WC.Ajax.requestToChat("v1/chats/"+i+"/parsetime",s,function(){var e=JSON.parse(this.response).data.time,t={};t[this.opts.callbackargs.time]=e,WebMessanger.updateReminderInfo(t);var s=WindowHandler.getWinObjById(i);0<e&&s.remindercomponent&&s.remindercomponent.updateReminderTime(e)},null,n,null,a)}}},WebMessanger.fork=function(e,t){var s={"Content-Type":"application/json","X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.Util.getCSRF()};$WC.Ajax.postRequestToChat("v1/chats/"+e+"/fork",t,null,function(){WMSUI.showErrorMsg($WC.I18N("fork.chat.failed"))},null,null,s)},WebMessanger.setChatTitle=function(i,e,s){var t="chid="+i+"&uname="+WebMessanger.zuid;e&&(t+="&title="+encodeURIComponent(e));$WC.Ajax.postRequestToChat("settitle.do",t,function(){var e=JSON.parse(this.response)[0].objString,t=e.cntid,s=e.title;"contact_rename"===e.module?WmsContacts.getContactsList(t).DNAME=s:"user_rename"===e.module&&(WmsOrgContacts.getOrgContactsList(t).DNAME=s),WindowHandler.getWinObjById(i).setTitle(s),$WC.RecentChats.updateTitle(i,s)},function(){var e=WindowHandler.getWinObjById(i),t=2<e.partcount?"chat.settitle.error":"contact.rename.errormsg";e.showErrorMsg($WC.I18N(t)),e.setTitle(s)})},WebMessanger.inviteToChannel=function(e,t){var s=$WC.Channels.get(e).oc_id,i="ulist="+encodeURIComponent(t);$WC.Ajax.postRequestToChat("v1/channels/"+s+"/invite",i)},WebMessanger.addMember=function(e,t,s){for(var i=s,n=(t.split(","),0),a=s.length-1;n<a;n++)-1==t.indexOf(WmsContacts.getEmailId(i[n]))&&s.splice(n,1);for(var o=[],r=(n=0,s.length-1);n<=r;n++)o.push(s[n]);if(0!=o.length){var l="chid="+e+"&ulist="+encodeURIComponent(o);$WC.Ajax.postRequestToChat("addmember.do",l,null,function(){2005==JSON.parse(this.response)[0].objString.ERRCODE&&WMSUI.showErrorMsg($WC.I18N("useradd.not.groupadmin"))},null,null,{"X-XHR-exception":"true"})}},WebMessanger.deleteMember=function(e,t,s){var i="chid="+e+"&ulist="+encodeURIComponent(t),n={"X-XHR-exception":"true"};if(s){i={user_ids:[t]},n={"Content-Type":"application/json","X-ZCSRF-TOKEN":$WC.Util.getCSRF()};$WC.Ajax.deleteRequestToChat("v2/threads/"+e+"/followers",i,function(){WMSUI.showInfoMsg($WC.I18N("thread.followers.remove"))},null,null,null,n)}else if($WC.Util.isChannelChid(e)){var a=$WC.Channels.get(e).oc_id;i="ulist="+encodeURIComponent(t),n={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.Util.getCSRF()},$WC.Ajax.postRequestToChat("v1/channels/"+a+"/deletemember",i,null,null,null,null,n)}else $WC.Ajax.postRequestToChat("deletemember.do",i,null,function(){2005==JSON.parse(this.response)[0].objString.ERRCODE&&WMSUI.showErrorMsg($WC.I18N("userdelete.not.groupadmin"))},null,null,n)},WebMessanger.setZIndex=function(e){var t=Math.pow(2,31)-2;t<e&&(e=t),this.setzindex=e;var s=isNaN(e)?e:+e+1;$WC.Config.set({zindex:s})},WebMessanger.getZIndex=function(){return this.setzindex},WebMessanger.disableWMSStatus=function(){this.wmsservicestatus=!1},WebMessanger.isServiceStatus=function(){return this.wmsservicestatus},WebMessanger.setServiceStatus=function(e){WMSUI.setServiceStatus(e)},WebMessanger.disableNetworkDownBanner=function(){this.disablenetworkdownbanner=!0},WebMessanger.clearTicket=function(e){var t;null!=e&&(t="lgtticket="+e),$WC.Ajax.request("cleariamcache"+dext,t)},WebMessanger.isPresenceEnabled=function(){return!!(!0&getWmsConfig()||!0&getWmsConfig())},WebMessanger.makeChatPinned=function(e,t){var s=WindowHandler.getWinObjById(e);s&&(s.updatePinnedInfo(!0),$WC.Util.isThreadChid(e)&&"true"!==s.thread_follower&&s.updateThreadFollowerInfo(!0,null,null,!0)),$WC.RecentChats.updatePinnedChat(e,!0,null,t),$WC.HybridSearch.populateRecentChats()},WebMessanger.makeChatUnPinned=function(e){var t=WindowHandler.getWinObjById(e);t&&t.updatePinnedInfo(!1),$WC.RecentChats.updatePinnedChat(e,!1),$WC.HybridSearch.populateRecentChats()},WebMessanger.removeLiveChat=function(e){var t=$WC.Util.indexOf(WebMessanger.liveChats,e);-1!=t&&WebMessanger.liveChats.splice(t,1)},WebMessanger.setHistoryStorage=function(e,t){var s="option="+e+"&chid="+t;$WC.Ajax.postRequest("sethistorystorage.do",s)},WebMessanger.pinChat=function(e,t){t?$WC.Ajax.postRequestToChat("v2/chats/"+e+"/pin"):$WC.Ajax.postRequestToChat("v2/chats/"+e+"/unpin")},WebMessanger.leaveChannel=function(e){var t=$WC.Channels.get(e).oc_id;$WC.Ajax.postRequestToChat("v1/channels/"+t+"/leave")},WebMessanger.makeChannelRead=function(e){var t="chid="+e;$WC.Ajax.postRequestToChat("makechannelread.do",t)},WebMessanger.closeTicketAnnouncement=function(){$WC.Ajax.request("sendsystemmsg.do?key=closeann"),WMSUI.closeTicketAnnouncement()},WebMessanger.turnOffChat=function(){$WC.Util.checkSessionConfig("CHAT")&&("undefined"!=typeof WmsUIImpl&&WmsImplHandler.invokeSynchronously(WmsUIImpl.handleTurnOffChat),_WMSCONFIG&=~WMSSessionConfig.CHAT,_isGSearchAppended=!1,WmsChatCache.removeAll(),Message.deletedMessages.removeAll(),$WC.WmsSessionStorage.removeItem("wms_openchats"),WindowHandler.exist=[],WebMessanger.sid=null,!1===WebMessanger.chatdisabled&&!1===WebMessanger.allprdchatdeactivated&&!1===WebMessanger.chatdeactivated&&WmsSettings.updateWmsSettings("bchatsettings","deact",null,"add"),WebMessanger.clearAndRegister())},WebMessanger.turnOnChat=function(e,t){$WC.Util.checkSessionConfig("CHAT")||("undefined"!=typeof WmsUIImpl&&WmsImplHandler.invokeSynchronously(WmsUIImpl.handleTurnOnChat),_WMSCONFIG|=WMSSessionConfig.CHAT,_isGSearchAppended=!1,!(WebMessanger.sid=null)===WebMessanger.allprdchatdeactivated?WmsSettings.updateWmsSettings("bchatsettings","deact","ALL","rem",e,t):!0===WebMessanger.chatdeactivated&&WmsSettings.updateWmsSettings("bchatsettings","deact",null,"rem",e,t),WebMessanger.clearAndRegister())},WebMessanger.unPauseChat=function(t,e){var s=function(){WmsImplHandler.invoke(e)};WebMessanger.turnOnChat(function(){var e=JSON.parse(this.responseText)[0].objString;if(WmsSettings.handleUpdateWmsSettings(e),!0===WebMessanger.chatdeactivated){WebMessanger.turnOnChat(function(){var e=JSON.parse(this.responseText)[0].objString;WmsSettings.handleUpdateWmsSettings(e),WmsImplHandler.invoke(t)},s)}else WmsImplHandler.invoke(t)},s)},WebMessanger.isOrgUser=function(){return!(!WebMessanger.orgid||"-1"===WebMessanger.orgid)},WebMessanger.isMediaCallEnabled=function(e){var t="voice"===e?"audio_call":"video"===e?"video_call":"screen_sharing";return!_WMSDISABLEAVCHAT&&$WC.SecurityManager.hasPermission(t)||!1},WebMessanger.isMessageDeletionEnabled=function(){return WebMessanger.isCliqUser()?WebMessanger.isRTCChat()||WmsSettings.adminsettings.moduleconfig&&WmsSettings.adminsettings.moduleconfig.messaging&&WmsSettings.adminsettings.moduleconfig.messaging.configs&&"true"===WmsSettings.adminsettings.moduleconfig.messaging.configs.delete_messages:WebMessanger.isRTCChat()||WmsSettings.adminsettings.features&&WmsSettings.adminsettings.features.DeleteMessage&&WmsSettings.adminsettings.features.DeleteMessage.enabled},WebMessanger.getDeleteMessageTimeFrame=function(){return WebMessanger.isCliqUser()?WmsSettings.adminsettings.moduleconfig&&WmsSettings.adminsettings.moduleconfig.messaging&&WmsSettings.adminsettings.moduleconfig.messaging.configs&&WmsSettings.adminsettings.moduleconfig.messaging.configs.delete_messages_time_frame:WmsSettings.adminsettings.features&&WmsSettings.adminsettings.features.DeleteMessage&&WmsSettings.adminsettings.features.DeleteMessage.properties&&WmsSettings.adminsettings.features.DeleteMessage.properties.timeframe},WebMessanger.isMessageEditingEnabled=function(){return WebMessanger.isCliqUser()?WebMessanger.isRTCChat()||WmsSettings.adminsettings.moduleconfig&&WmsSettings.adminsettings.moduleconfig.messaging&&WmsSettings.adminsettings.moduleconfig.messaging.configs&&"true"===WmsSettings.adminsettings.moduleconfig.messaging.configs.edit_messages:WebMessanger.isRTCChat()||WmsSettings.adminsettings.features&&WmsSettings.adminsettings.features.EditMessage&&WmsSettings.adminsettings.features.EditMessage.enabled},WebMessanger.getEditMessageTimeFrame=function(){return WebMessanger.isCliqUser()?WmsSettings.adminsettings.moduleconfig&&WmsSettings.adminsettings.moduleconfig.messaging&&WmsSettings.adminsettings.moduleconfig.messaging.configs&&WmsSettings.adminsettings.moduleconfig.messaging.configs.edit_messages_time_frame:WmsSettings.adminsettings.features&&WmsSettings.adminsettings.features.EditMessage&&WmsSettings.adminsettings.features.EditMessage.properties&&WmsSettings.adminsettings.features.EditMessage.properties.timeframe},WebMessanger.isSpecialMentionEnabled=function(){return WmsSettings.adminsettings.features&&WmsSettings.adminsettings.features.specialmention&&WmsSettings.adminsettings.features.specialmention.enabled},WebMessanger.isReactionsEnabled=function(){return WebMessanger.isRTCChat()||WmsSettings.adminsettings.features&&WmsSettings.adminsettings.features.reactions&&WmsSettings.adminsettings.features.reactions.enabled},WebMessanger.isUDSUploadEnabled=function(){return!(!_UPLOADSERVERURL||WebMessanger.isGuestUser())},WebMessanger.isUDSDownloadEnabled=function(){return!(!_DOWNLOADSERVERURL||WebMessanger.isGuestUser())},WebMessanger.getFileUploadLimit=function(){return WmsSettings.adminsettings.moduleconfig&&WmsSettings.adminsettings.moduleconfig.messaging&&WmsSettings.adminsettings.moduleconfig.messaging.configs&&WmsSettings.adminsettings.moduleconfig.messaging.configs.upload_limit},WebMessanger.isPaginationEnabledForParticipantsSearch=function(){return WmsSettings.adminsettings.features.channel_participants_search},WebMessanger.isRegistered=function(){return WebMessanger.registered},WebMessanger.systemApiHandler=function(e,s){var t=e.split("/"),i=t[0],n=t.slice(1);switch(i){case"joinchannel":var a=n[0];!1===$WC.Channels.isJoinedChannel(a)&&WebMessanger.joinChannel(a);break;case"startchat":var o=n[0],r=WindowHandler.getWinObjById(o);r?r.highlight():WebMessanger.openUserChat(o,null,null,null,"systemapi");break;case"audiocall":o=n[0];WMSUI.makeMediaCall(WMSUI.avCall.CALL_TYPE_VOICE,o);break;case"videocall":o=n[0];WMSUI.makeMediaCall(WMSUI.avCall.CALL_TYPE_VIDEO,o);break;case"videobroadcast":var l=n[0];s.sender!==WebMessanger.zuid&&window.open(_WMSCHATURL+"joinprimetime.do?key="+encodeURIComponent(l));break;case"invite":o=n[0];WMSUI.inviteMember(o);break;case"approvechannel":a=n[0];WebMessanger.approveChannel(a);break;case"rejectchannel":a=n[0];WebMessanger.rejectChannel(a);break;case"acceptevent":case"declineevent":WebMessanger.handleCalendarEvents(e);break;case"locationpermission":var d=$WC.Config.get("LOCATION_INFO").PERMISSIONSTATE;if("granted"===d)WMSUI.showInfoMsg($WC.I18N("functions.location.granted"));else{if("undefined"!=typeof navigator&&void 0!==navigator.geolocation){var c=function(e){navigator.permissions.query({name:"geolocation"}).then(function(e){$WC.Config.get("LOCATION_INFO").PERMISSIONSTATE=e.state,"granted"===e.state?WMSUI.showInfoMsg($WC.I18N("functions.location.allowed")):WMSUI.showInfoMsg($WC.I18N("functions.location.allowed.once"))})};navigator.geolocation.getCurrentPosition(c,function(e){WMSUI.showErrorMsg($WC.I18N("functions.location.denied.now")),void 0===d&&($WC.Config.get("LOCATION_INFO").PERMISSIONSTATE="denied")})}"denied"===d&&WMSUI.showErrorMsg($WC.I18N("functions.location.denied"))}break;case"markreminderascomplete":WebMessanger.markReminderAsComplete(n[0],s);break;case"snoozereminder":WebMessanger.snoozeReminder(n[0],n[1],s);break;default:var m="api="+e+"&chid="+s.chid;c=function(){var e=this.response?JSON.parse(this.response)[0].objString:"",t=WindowHandler.getWinObjById(s.chid);"message"===e.type&&e.info&&(e.info.isTempMsg=!0,Message.constructAndAppendChatContent([e.info],t.msgdisp,s.chid))};$WC.Ajax.postRequestToChat("executesystemaction.do",m,c)}},WebMessanger.executeButtonResponseHandler=function(){var i={renderResponse:function(e,t){if(e.info)if(e.info.widget){var s=JSON.parse(e.info.widget);$WC.Widgets.construct(s)}else if("message"===e.type){var i=WindowHandler.getWinObjById(t.chid);e.info.isTempMsg=!0,Message.constructAndAppendChatContent([e.info],i.msgdisp,t.chid),i.scrollDisplay()}},handleSystemResponse:function(e,t){if("banner"===e.type){var s="failure"===e.info.type?"error":"info";WMSUI.showErrorMsg(e.info.text,s)}}};return function(e,t,s){"function"==typeof i[e]&&i[e](t,s)}}(),WebMessanger.disableSmartChatKeyboardShortcut=function(){WebMessanger.smartchatshortcutdisabled=!0},WebMessanger.enableSmartChatKeyboardShortcut=function(){WebMessanger.smartchatshortcutdisabled=!1},WebMessanger.replaceChatWindowHeaderHTML=function(e,t){var s=WindowHandler.getWinObjById(e);s&&(s.headernode.innerHTML=t)},WebMessanger.closeAnnBanner=function(){WMSUI.clearBannerAndUpdate()},WebMessanger.setFrameOrigin=function(e){WebMessanger.frameorigin=e||window.location.origin},WebMessanger.updateTourSettings=function(e,t){var s="settings="+e+"&exitdetails="+t;$WC.Ajax.postRequestToChat("updatetoursettings.do",s)},WebMessanger.useLongPolling=function(){_WMS_LP="true"},WebMessanger.startAudioCall=function(e){WMSUI.makeMediaCall(WMSUI.avCall.CALL_TYPE_VOICE,e)},WebMessanger.startVideoCall=function(e){WMSUI.makeMediaCall(WMSUI.avCall.CALL_TYPE_VIDEO,e)},WebMessanger.startScreenShare=function(e){WMSUI.makeMediaCall(WMSUI.avCall.CALL_TYPE_SCREENSHARE,e)},WebMessanger.rePopulateCustomContacts=function(){WmsHybridSearch.populateCustomContactListInMainUI()},WebMessanger.localPush=push,WebMessanger.updateContactMenuCount=function(e){WmsMainUI.updateChatInvitationCount(e)},WebMessanger.deleteMessage=function(e,t){var s=e.getAttribute("data-msguid"),i={msgack_key:e.getAttribute("data-msgtime"),sid:WebMessanger.sid},n={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.Util.getCSRF(),"Content-Type":"application/json"};$WC.Ajax.deleteRequestToChat("v2/chats/"+t+"/messages/"+s,i,null,null,null,null,n)},WebMessanger.updateReaction=function(s,i,n,a,e){var t={"Content-Type":"application/json","X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.Util.getCSRF()};function o(){var e=WindowHandler.getWinObjById(s);e.showErrorMsg($WC.I18N("reactions.failureinfo")),e.updateMyReactionData(i,n,!a);var t="string"==typeof this.response&&""!=this.response?JSON.parse(this.response):this.response;t&&e.handleChatRestrictions(t)}var r="v2/chats/"+s+"/messages/"+i+"/reactions";WebMessanger.isGuestUser()&&(t["x-cliq-guid"]=WebMessanger.guest_info.encrypt_id,r="guestapi/"+r);var l=!!e;a?$WC.Ajax.deleteRequestToChat(r,{emoji_code:n,is_linked_message:l},null,o,null,null,t):$WC.Ajax.postRequestToChat(r,{emoji_code:n,is_linked_message:l},null,o,null,null,t)},WebMessanger.syncAdminSettings=function(){$WC.Ajax.requestToChat("chatbarsync.do",null,function(e){var t=e&&e.features;t.chatdraft_lmtime&&WmsSettings.adminsettings.features.chatdrafts&&$WC.Drafts.checkAndUpdateLMTime(t.chatdraft_lmtime),WebMessanger.sync_adminsettings_onfocus=!1,$WC.Drafts.getFromServer()})},WebMessanger.markAsUnread=function(e,t,s){var i={"Content-Type":"application/json","X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.Util.getCSRF()};$WC.Ajax.putRequestToChat("v2/chats/"+e+"/unread",{message_id:t,time:s},null,function(){WMSUI.showErrorMsg($WC.I18N("message.error.markasunread"))},null,null,i)},WebMessanger.getPinnedMsg=function(t,e){$WC.Ajax.requestToChat("v2/chats/"+t+"/stickymessage",null,function(){var e=WindowHandler.getWinObjById(t);e&&e.showPinnedMsg(JSON.parse(this.response))})},WebMessanger.pinMsg=function(e,t,s,i){var n=WindowHandler.getWinObjById(e);i=i||!1,s=s||"-1",s=parseInt(s);var a={"Content-Type":"application/json","X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.Util.getCSRF(),"x-consents-version":1},o={id:t,expiry_time:s,notify:i};$WC.Ajax.postRequestToChat("v2/chats/"+e+"/stickymessage",o,null,function(){n.showErrorMsg($WC.I18N("msg.pin.error"))},null,null,a)},WebMessanger.unpinMsg=function(e){var t=WindowHandler.getWinObjById(e),s={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.Util.getCSRF()};$WC.Ajax.deleteRequestToChat("v2/chats/"+e+"/stickymessage",null,function(){t.showInfoMsg($WC.I18N("msg.unpin.success"))},function(){t.showErrorMsg($WC.I18N("msg.unpin.error"))},null,null,s)},WebMessanger.disableCreateChannelLink=function(){WebMessanger.is_create_channel_link_disabled=!0},WebMessanger.disableCopyMessageLink=function(){WebMessanger.is_copy_message_link_disabled=!0},WebMessanger.disableSetReminderOption=function(){WebMessanger.is_set_reminder_option_disabled=!0},WebMessanger.preFetchChannels=function(){WebMessanger.prefetch_channels=!0},WebMessanger.disableZohoLinksSettings=function(){WebMessanger.is_zoho_links_settings_disabled=!0},WebMessanger.disableCliqFeatures=function(){WebMessanger.disableCreateChannelLink(),WebMessanger.disableCopyMessageLink(),WebMessanger.disableZohoLinksSettings()},WebMessanger.disableMsgPinOption=function(){WebMessanger.is_msgpin_option_disabled=!0},WebMessanger.storeUserInfoAndUpdateTitle=function(e,t){var s=WindowHandler.getWinObjById(t);s&&$WC.Users.getInfo(e)&&$WC.Users.getInfo(e).dname!==s.title&&WindowHandler.updateChatTitle(t,$WC.Users.getInfo(e).dname)},WebMessanger.checkAndEnableChatBar=function(e,t,s,i,n){var a;if(e?a=_WMSCHATURL+"users/"+e:t&&(a=_WMSCHATURL+"chats/"+t),s&&silent)n?i(a):window.open(a,"_blank","toolbar=1,menubar=1,location=1,status=1,scrollbars=1,noopener");else{var o=new $WC.ConfirmationDialog,r=[{text:$WC.I18N("chat.enable.click"),onclick:function(){WebMessanger.turnOnChat(),WebMessanger.methodsInCallbackQueue.push(i),o.unmountComponent()},buttonstyle:"confirmation_button"},{text:$WC.I18N("common.cancel"),onclick:function(){o.unmountComponent()},buttonstyle:"cancel_button"}],l=[$WC.I18N("chat.disabled.info")];s&&_WMSOPENINCLIQ&&(WebMessanger.isCliqUser()||WebMessanger.isOrgUser())&&(l=[$WC.I18N("chat.disabled.info2")],r=[{text:$WC.I18N("chats.cliq.open"),onclick:{callback:function(){i(a),o.unmountComponent()}},buttonstyle:"confirmation_button"},{text:$WC.I18N("chat.enable.click"),onclick:function(){WebMessanger.turnOnChat(),o.unmountComponent()},buttonstyle:"confirmation_button"}],n||(r[0].onclick={link:a,callback:function(){o.unmountComponent()}}));var d={actions:r,heading:l};o.mountComponent(d)}},WebMessanger.showChatsListDialog=function(e,t,s,i,n,a){if(WebMessanger.isChatPaused())WebMessanger.checkAndEnableChatBar(null,null,null,WebMessanger.showChatsListDialog.bind(this,e,t,s,i,n,a));else{$WC.Util.isEmptyObject($WC.Channels.get())&&$WC.Channels.initChannels();var o=[{text:s,onclick:function(e){var s=[];e.forEach(function(e){var t={id:e};WmsMainUI.scheduleAutoFocus(e),WmsContacts.getContactsList(e)||WmsOrgContacts.getOrgContactsList(e)?(t.type="userid",l(n)&&WebMessanger.openUserChat(e)):(t.type="chatid",l(n)&&WebMessanger.createChatWindowFromCache(e)),s.push(t)}),i(s)}}],r=[$WC.WmsConstants.HYBRIDSEARCH.ORGCONTACT,$WC.WmsConstants.HYBRIDSEARCH.JOINEDCHANNEL,$WC.WmsConstants.HYBRIDSEARCH.CHAT];$WC.Participants.showChatsList(null,e,t,o,r,a,function(){WMSUI.showErrorMsg($WC.I18N("chats.selection.limit"))})}function l(e,t){return e&&(silent?void WebMessanger.checkAndEnableChatBar("",t,!0):!Chat.isExists(t)||void WMSUI.handleChatExist(t))}},WebMessanger.subscribeToUnreadChatDetails=function(e,t){$WC.Util.pubsub.subscribe("/chats/unreadchatdetails",function(){e(WebMessanger.getUnreadChatDetails(t))})},WebMessanger.getUnreadChatDetails=function(e){for(var t=$WC.RecentChats.getUnreadChatList(),s=[],i=0;i<t.length;i++){var n=t[i],a=n.CTYPE;e&&"chatlets"==e&&"10"!=a||(s.push({title:n.TITLE,chid:n.CHATID,last_msg:{msg:$WC.Util.createElement("div",null,null,null,$WC.HybridSearch.createLastMsgInfoHtml(n)).innerText,sender_zuid:n.LASTMSGINFO.sender,sender_dname:n.LASTMSGINFO.dname,msg_time:n.LMTIME},unread_count:WmsMainUI.getUnreadCount(n.CHATID)}),10==a&&n.ENTITYID&&(s[s.length-1].entityid=n.ENTITYID))}return s},WebMessanger.isGuestUser=function(){return!!WebMessanger.guest_info.verification_url},WebMessanger.setGuestURL=function(e){WebMessanger.guest_info.verification_url=e},WebMessanger.verifyGuestAndGetChatDetails=function(){if(!WebMessanger.guest_info.chat_info_fetched){var e=WebMessanger.guest_info.verification_url;$WC.Ajax.requestToChat(e,null,function(){var e="string"==typeof this.response&&""!==this.response?JSON.parse(this.response):this.response;e&&(WebMessanger.guest_info.chat_info=e,WebMessanger.guest_info.encrypt_id=e.data.id,WebMessanger.guest_info.id=WebMessanger.zuid,WebMessanger.exclusive_chat_info.chat_id=e.data.chat_id,WebMessanger.guest_info.chat_info_fetched=!0,e.data._CHATCSRFCOOKIENAME&&$WC.Config.set({GUEST_CHATCFCOOKIENAME:e.data._CHATCSRFCOOKIENAME}),WebMessanger.openGuestChat())},function(){WebMessanger.guest_info.chat_info_fetched=!1,"function"==typeof WebMessanger.exclusive_chat_info.failure_callback&&WebMessanger.exclusive_chat_info.failure_callback()})}},WebMessanger.openGuestChat=function(){WebMessanger.guest_info.chat_info_fetched?WebMessanger.guest_info.chat_info.data&&WebMessanger.guest_info.chat_info.data.CHAT&&WMSUI.createNewChatWindow(WebMessanger.guest_info.chat_info.data.CHAT):WebMessanger.verifyGuestAndGetChatDetails()},WebMessanger.enableExclusiveChatMode=function(){WebMessanger.is_exclusive_chat=!0},WebMessanger.isExclusiveChat=function(){return WebMessanger.is_exclusive_chat},WebMessanger.getGuestPhotoUrl=function(e){if(e=e||WebMessanger.guest_info.id&&WebMessanger.guest_info.id.split("$")[1]){var t="/"+_CHATCONT+"/guestimg/"+e+"/photo.do";return WebMessanger.isGuestUser()&&(t+="?guest_id="+WebMessanger.guest_info.encrypt_id),t}},WebMessanger.joinChatlet=function(e){if(e){var t={session_id:WebMessanger.sid,product_id:WebMessanger.prd},s="function"==typeof WebMessanger.exclusive_chat_info.failure_callback?WebMessanger.exclusive_chat_info.failure_callback:null;$WC.Ajax.postRequestToChat("v2/chatlets/"+e+"/join",t,null,s,null,null,{"Content-Type":"application/json"})}},WebMessanger.setExclusiveEntityId=function(e){e&&(WebMessanger.exclusive_chat_info.entity_id=e)},WebMessanger.setExclusiveChatDetails=function(e,t,s){WebMessanger.enableExclusiveChatMode(),t&&WebMessanger.setGuestURL(t),WebMessanger.setExclusiveEntityId(e),s&&(WebMessanger.exclusive_chat_info.failure_callback=s)},WebMessanger.setColors=function(e){e&&!$WC.Util.isEmptyObject(e)&&(e.primary_color&&document.documentElement.style.setProperty("--wms-primary-colorcode",$WC.Util.hexToRGB(e.primary_color)),e.chat_bg&&document.documentElement.style.setProperty("--wms-chat-bg-colorcode",$WC.Util.hexToRGB(e.chat_bg)),e.chat_bubble&&document.documentElement.style.setProperty("--wms-bubble-colorcode",$WC.Util.hexToRGB(e.chat_bubble)),e.otheruser_chat_bubble&&document.documentElement.style.setProperty("--wms-otheruser-bubble-colorcode",$WC.Util.hexToRGB(e.otheruser_chat_bubble)),e.border_color&&document.documentElement.style.setProperty("--wms-border-colorcode",$WC.Util.hexToRGB(e.border_color)),e.primary_text_color&&document.documentElement.style.setProperty("--wms-primary-text-colorcode",$WC.Util.hexToRGB(e.primary_text_color)),e.secondary_text_color&&document.documentElement.style.setProperty("--wms-secondary-text-colorcode",$WC.Util.hexToRGB(e.secondary_text_color)),e.chatwindow_strip_color&&document.documentElement.style.setProperty("--wms-chatwin-strip-colorcode",$WC.Util.hexToRGB(e.chatwindow_strip_color)))},WebMessanger.editAttachmentComments=function(e,t,s,i,n){var a={id:e,msguid:t,comment:encodeURIComponent(i),notifyedit:s};-1!==n.indexOf("&x-cli-msg=%7Bthumbnail%3Atrue%7D")?n=n.replace("&x-cli-msg=%7Bthumbnail%3Atrue%7D",""):-1!==n.indexOf("/thumbnail")&&(n=n.replace("/thumbnail",""));var o={"Content-Type":"application/json","x-consents-version":"1","X-XHR-exception":!0,"X-ZCSRF-TOKEN":$WC.Util.getCSRF()};return $WC.Ajax.putRequestToChat("v1/attachments/"+n,a,null,null,null,null,o),!0},WebMessanger.getSenderFromMsgobj=function(e){if(e.temp_info&&e.t121t){var t=JSON.parse(e.t121t);for(var s in t)if(s!==$WC.Config.get("zuid"))return s}},WebMessanger.isReadReceiptSettingEnabled=function(){var e=WmsSettings.adminsettings.user_read_receipt&&WmsSettings.adminsettings.user_read_receipt.split(":");return e&&2===e.length?e[0]>e[1]:"1"==WmsSettings.adminsettings.user_read_receipt},WebMessanger.isReadReceiptEnabled=function(){var e=WebMessanger.isReadReceiptSettingEnabled(),t=WmsSettings.adminsettings.moduleconfig&&WmsSettings.adminsettings.moduleconfig.messaging&&WmsSettings.adminsettings.moduleconfig.messaging.configs,s=!(!t||"true"!=t.read_receipt),i=!(!t||"true"!=t.custom_read_receipt);return s&&(!i||e)},WebMessanger.showReadReceipt=function(e,t){var s=WindowHandler.getWinObjById(e),i=!(!s||"1"!==s.ctype||s.isZohoGroupChat()),n={msg_time:t.time,msg:t.msg,chid:e,msguid:t.msguid,is_121_chat:i,onListItemClick:function(e,t,s){var i=t.getAttribute("data-zcprofileid")?t:t.querySelector("[data-zcprofileid]");i&&WebMessanger.showProfileInfo(i),s&&(s.stopPropagation(),s.preventDefault())}};(new $WC.ReadReceiptList).mountComponent(n)},WebMessanger.markUserOpenedChat=function(e,t){var s;if(t)s=$WC.RecentChats.get(t);else if(e)for(var i=$WC.RecentChats.getList(""),n=0;n<i.length;n++)"string"!=typeof i[n].ADDINFO||-1==i[n].ADDINFO.indexOf("ENTITYID")||-1==i[n].ADDINFO.indexOf(e)||(s=i[n]);s&&s.LASTSEEN&&(s.uc_useropened=!0)},WebMessanger.openNotebookWidget=function(){var e=document.getElementById("wms_notebook_container");if(!WebMessanger.isNotebookFrameLoaded||!document.getElementById("wms_notebook_iframe")){var t=wmsUserConfig.notebook_iframe_url+"?serviceOrigin="+window.location.origin+"&frameorigin="+window.location.origin,s=$WC.Util.createElement("iframe","wms_notebook_iframe","wms_notebook_iframe",{src:t});s.onload=function(){WebMessanger.isNotebookFrameLoaded=!0,document.getElementById("wms_notebook_loader").style.display="none"},e.appendChild(s)}var i=e.parentNode;e&&i&&("false"===i.getAttribute("data-shown")?i.setAttribute("data-shown","true"):i.setAttribute("data-shown","false"))},WebMessanger.getParentThreadMsg=function(e,a,o){if(!o){o={},e.parentNode.previousSibling||e.parentNode;o.msguid=e.getAttribute("data-thread_msgid"),o.thread_chid=e.getAttribute("data-thread_chid"),o.msgcount=e.getAttribute("data-thread_msgcnt"),o.is_follower="true"==e.getAttribute("data-thread_follower")?$WC.I18N("thread.unfollow"):$WC.I18N("thread.follow"),o.chid=e.getAttribute("data-thread_parentid")||a}var t={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.Util.getCSRF()},s="chid="+o.chid+"&msguid="+encodeURIComponent(o.msguid)+"&lineslimit=1&tzoffset="+_TZOFFSET;$WC.Ajax.requestToChat("gettranscriptasjsonforweb.do",s,function(){if(!s||!s.followernode){var e=this.responseText&&this.responseText.slice(0,-1);if(0<(e=JSON.parse("["+e+"]")).length){var t="more"===e[0].mode?e[1]:e[0];msgcount=o.msgcount||t.thread_information&&t.thread_information.message_count||"",delete t.thread_information;var s=WindowHandler.getWinObjById(o.thread_chid),i='<div data-thread_parentmsg="true" class="wms_threadparentmsg" data-chid="'+o.chid+'">'+Message.constructChatContent([t],null,a)+"</div>";s.ctrlcomp.insertAdjacentHTML("afterbegin",i);var n='<div id="wms_threadsheaderwrapper" class="wms_threadheaderwrapper"><div id="wms_threadsheader" class="wms_threadsheader">'+(1<msgcount?$WC.I18N("message.threads.count",[msgcount]):$WC.I18N("message.thread.count",[msgcount]))+'</div><div id="wms_threadfollower_button" class="wms_threadfollow">'+o.is_follower+"</div></div>";s.msgdisp.insertAdjacentHTML("afterbegin",n),s.parentmsg_container=s.ctrlcomp.querySelector("[data-thread_parentmsg]"),s.followernode=s.msgdisp.querySelector('[id="wms_threadfollower_button"]'),s.followernode.onclick=function(){WebMessanger.followThread(s.objId,s.thread_follower)},t.reactions&&s.updateReactionData(t.msguid,$WC.Util.extend(!0,{},t.reactions))}}},null,null,null,t)},WebMessanger.overrideSilentForGlobalSearch=function(){WMSUI.hidegsicon=!0,WMSUI.globalsearchenabled=!0,WebMessanger.appendGlobalSearch()},WebMessanger.enableMessageActionsAsPopUp=function(){WebMessanger.show_message_actions_as_popup=!0},WebMessanger.openThreadWindowFromCache=function(e,t){WebMessanger.getParentThreadMsg(e,t);var s=e.getAttribute("data-thread_parentid")||t,i=e.getAttribute("data-thread_title"),n=e.getAttribute("data-thread_followercnt"),a=e.getAttribute("data-thread_creator"),o=e.getAttribute("data-thread_msgid"),r=e.getAttribute("data-thread_follower"),l=e.getAttribute("data-thread_chid"),d=e.getAttribute("data-thread_state"),c={chid:l,title:i,ctype:$WC.WmsConstants.CTYPES.THREAD,pcount:n,recipants:a,thread_msgid:o,thread_parentid:s,thread_follower:r,thread_state:d};WmsMainUI.isAutoFocusScheduled(c.chid)||WmsMainUI.scheduleAutoFocus(c.chid),WebMessanger.createChatWindowFromCache(l,"threads",c),$WC.RecentChats.get(l)&&$WC.RecentChats.get(l).LASTSEEN&&($WC.RecentChats.get(l).uc_useropened=!0)},WebMessanger.fetchThreadDetails=function(i){var e={"X-XHR-exception":"true","Content-Type":"application/json","X-ZCSRF-TOKEN":$WC.Util.getCSRF()};$WC.Ajax.requestToChat("v2/threads/"+i,null,function(){var e=JSON.parse(this.response).data,t=WindowHandler.getWinObjById(e.parent_chat_id),s=t&&t.win.querySelector('[data-threadmsg_post="'+i+'"]');s&&(s.setAttribute("data-parent_chat_id",e.parent_chat_id),s.setAttribute("data-thread_followercnt",e.follower_count),s.setAttribute("data-thread_follower",e.is_follower),s.setAttribute("data-thread_creator",e.parent_message_sender))},null,null,null,e)},WebMessanger.getIAMServiceName=function(e){return WebMessanger.servicelist[e]},WebMessanger.populateSpecialWMSAnnouncement=function(e){if("success"==e.result){var t=e.response,s=JSON.parse(wmsUserConfig.infomsg);if(0==t.banner_status)return;WMSUI.processAnnMsg(s[t.banner_status],wmsUserConfig.infomsgtype)}},WebMessanger.processSpecialAnnouncement=function(e){if(e.apiurl){if(!1===WebMessanger.silentOverriddenForAnnouncement&&silent)return;if(WMSUI.isAnnBlocked())return;var t=e.apiurl+"?zuid="+WebMessanger.zuid+"&iam_service="+WebMessanger.getIAMServiceName(WebMessanger.prd)+"&callback=populateSpecialWMSAnnouncement",s=$WC.Util.createElement("script");s.src=t,document.body.appendChild(s)}},WebMessanger.enableRTLMode=function(){WebMessanger.rtlmode=!0},WebMessanger.set_server_sync_timediff=function(e){e&&(e=parseInt(e),WebMessanger.server_sync_time_diff=Date.now()-e)},WebMessanger.getWMSRTT=function(e){WebMessanger.RTT_callback=e,WebMessanger.RTT_senttime=Date.now(),WebMessanger.triggerRTTPing()},WebMessanger.isPortalUser=function(){return!!_WMSZAID},WebMessanger.setRTCChatDetails=function(e){WebMessanger.rtc_chat_details.chat_id=e},WebMessanger.isRTCChat=function(){return!!WebMessanger.rtc_chat_details.chat_id},WebMessanger.focusChatComposer=function(e){WebMessanger.isRTCChat()&&(e=WebMessanger.rtc_chat_details.chat_id);var t=WindowHandler.getWinObjById(e);t&&(t.unread&&t.scrollToUnread(),t.focus())},WebMessanger.setRTCAccessToken=function(e){_WMSRTCATOKEN=e},WebMessanger.setAdminSettingsForRTCChat=function(e){WmsSettings.bsettings.adminsettings=e},WebMessanger.enableScreenGrabber=function(){WebMessanger.is_screen_grabber_enabled=!0,$WC.Util.addEvent(window,"message",function(e){function t(e){var t=e.split(".");return(t=t.slice(t.length-2)).join(".")}t(e.origin)===t(document.location.host)&&e.data&&e.data.load_screen_grabber&&WebMessanger.loadScreenGrabberLib()})},WebMessanger.loadScreenGrabberLib=function(){if(WebMessanger.is_screen_grabber_enabled&&!WebMessanger.is_screengrabber_js_loaded&&wmsUserConfig.screengrabber_library_url){var e=document.getElementsByTagName("head");e&&0!=e.length||((e=[])[0]=$WC.Util.createElement("head"),document.insertBefore(doc.body,e[0]));var t=$WC.Util.createElement("script");t.defer=!0,t.src=wmsUserConfig.screengrabber_library_url,t.onload=function(){WebMessanger.is_screengrabber_js_loaded=!0},e[0].appendChild(t)}},WebMessanger.isScreenGrabberLibLoaded=function(){return WebMessanger.is_screengrabber_js_loaded},WebMessanger.showProfileInfo=function(e,t){e="click"===e.type?$WC.Util.getEventTarget(e):e,!WebMessanger.isProfileInfoAllowed(null,e)||e.closest('[data-pc="true"]')||e.closest('[data-baravatar="true"]')||e.closest('[class~="wms_menu_item_msg"]')||$WC.Config.get("customContacts")||WmsProfileInfo.mountComponent(e,t,function(e,t){if($WC.Bots.isBotId(t)){var s=$WC.Bots.get(t).CHID;if(Chat.isExists(s))return void WMSUI.handleChatExist(s);WebMessanger.createChatWindowFromCache(s)}else WmsMainUI.scheduleAutoFocus(t),WmsHybridSearch.parseAndOpenChat(e)},WebMessanger.startAudioCall,WebMessanger.startVideoCall,WmsMainUI.handleProfileActions)},WebMessanger.isProfileInfoAllowed=function(e,t){e=e||t&&t.closest("[data-chid]")&&t.closest("[data-chid]").getAttribute("data-chid");var s=WindowHandler.getWinObjById(e);return!s||!s.disable_profileinfo},WebMessanger.fetchChannelDetails=function(e){$WC.Ajax.requestToChat("v1/channelsbyname/"+e,"tzoffset=330&getrecentconv=true",function(e){var t=JSON.parse(e);WmsHybridSearch.showJoinChannelDialog(t)},null,null,{"Content-Type":"application/json"})},WebMessanger.enableDarkTheme=function(){document.getElementById("wmstoolbar")&&$WC.Util.addClass(document.getElementById("wmstoolbar"),"zmNightMode"),WebMessanger.isDarkModeEnabled=!0},WebMessanger.disableDarkTheme=function(){document.getElementById("wmstoolbar")&&$WC.Util.removeClass(document.getElementById("wmstoolbar"),"zmNightMode"),WebMessanger.isDarkModeEnabled=!1},WebMessanger.setNetworkDetails=function(e){return WebMessanger.network_info.id=e.id,WebMessanger.network_info.user_id="o-"+WebMessanger.prd+"-"+e.id+"-"+WebMessanger.zuid,WebMessanger.network_info.url=e.url,WebMessanger.network_info.details=e,WebMessanger.network_info.user_id},WebMessanger.isNetworkUser=function(){return WebMessanger.network_info&&WebMessanger.network_info.user_id},WebMessanger.isDNDBackupIconEnabled=function(){return WmsSettings.adminsettings.dnd_backupicon_enabled||!1},WebMessanger.toggleMenuInCustomContainer=function(e,t){e&&WmsMainUI.toggleMenu(e,t)},WebMessanger.enableCustomMenuOption=function(){WebMessanger.is_custom_menu_opted=!0},WebMessanger.disableSoundNotification=function(){WebMessanger.external_sound_notification_config_state=!1},WebMessanger.isNotificationAllowedExternally=function(){return WebMessanger.external_sound_notification_config_state},WebMessanger.listenLinkClicks=function(){window.addEventListener("message",function(e){if(e.origin==document.location.origin)try{var t=JSON.parse(e.data);1==t.event_from_wms_iframe&&Message.handleMessageLinkClick(null,t.link)}catch(e){}})},WebMessanger.getChatType=function(e){var t=$WC.RecentChats.get(e);return $WC.Util.isChannelChid(e)?"channel":"2"==t.PARTICIPANTSCOUNT&&($WC.Util.isLocalUser(t.PARTICIPANTS[0].zuid)||$WC.Util.isLocalUser(t.PARTICIPANTS[1].zuid))?"onetoone":"adhoc"},WebMessanger.joinChat=function(i,n){var e="chid="+i+"&sid="+encodeURIComponent(WebMessanger.getSid());$WC.Ajax.postRequestToChat("joinchat.do",e,function(){var e=JSON.parse(this.response),t=WindowHandler.getWinObjById(i),s=e[0].objString.users?JSON.parse(e[0].objString.users):null;t?s&&s.length&&(t.updateRecipientInfo(s),t.restrictFileSharingForExternalUser()):s&&WMSUI.storeChatUsersObj(i,s),"function"==typeof n&&n()},function(){"function"==typeof n&&n()})},setTimeout(function(){if(void 0!==document.querySelector){var e=document.querySelector('script[src*="ichat"][src*="wmsbar"]');e&&(WebMessanger.jsstaticdomain=e.src.split("/")[2]);var t,s=document.createElement("link"),i=WebMessanger.fp_hash?WebMessanger.fp_hash["wmsbridge.js"]:"wmsbridge.js";t=WebMessanger.fp_hash?"https://"+WebMessanger.jsstaticdomain+"/ichat/js/"+i:"https://"+WebMessanger.jsstaticdomain+"/ichat/"+wmsjsversion+"_https/js/"+i,s.href=t,s.rel="preload",s.as="script",document.head.appendChild(s)}},1);wmsjsversion="Mar_23_2022_4";!function(){var n,u=0,i=0,p={},h={};function g(e,t,s){return"_root"==t?s:e!==s?(i=e,(n=n||(i.matches?i.matches:i.webkitMatchesSelector?i.webkitMatchesSelector:i.mozMatchesSelector?i.mozMatchesSelector:i.msMatchesSelector?i.msMatchesSelector:i.oMatchesSelector?i.oMatchesSelector:C.matchesSelector)).call(e,t)?e:e.parentNode?(u++,g(e.parentNode,t,s)):void 0):void 0;var i}function f(e,t,s,i){if(p[e.id])if(t){if(!i&&!s)return p[e.id][t]={},void h[e.id].element.removeEventListener(t,p[e.id][a].globalcallback);if(i){if(p[e.id][t][s])for(var n=0;n<p[e.id][t][s].length;n++)if(p[e.id][t][s][n]===i){p[e.id][t][s].splice(n,1);break}}else delete p[e.id][t][s]}else{for(var a in p[e.id])p[e.id].hasOwnProperty(a)&&(h[e.id].element.removeEventListener(a,p[e.id][a].globalcallback),p[e.id][a]={});delete h[e.id]}}function a(e,t,s,i){if(this.element){e instanceof Array||(e=[e]),s||"function"!=typeof t||(s=t,t="_root");var n,a,o,r,l,d,c=this.id;for(n=0;n<e.length;n++)i?f(this,e[n],t,s):(p[c]&&p[c][e[n]]||C.addEvent(this,e[n],m(e[n])),a=this,o=e[n],r=t,l=s,d=void 0,p[a.id]||(p[a.id]={}),p[a.id][o]||(p[a.id][o]={}),p[a.id][o][r]||(p[a.id][o][r]=[]),p[a.id][o].globalcallback||(p[a.id][o].globalcallback=d),p[a.id][o][r].push(l));return this}function m(t){return function(e){!function(e,t,s){if(p[e][s]){var i,n,a=t.target||t.srcElement,o={},r=0,l=0;for(i in u=0,p[e][s])p[e][s].hasOwnProperty(i)&&(n=g(a,i,h[e].element))&&C.matchesEvent(s,h[e].element,n,"_root"==i,t)&&(u++,p[e][s][i].match=n,o[u]=p[e][s][i]);for(t.stopPropagation=function(){t.cancelBubble=!0},r=0;r<=u;r++)if(o[r])for(l=0;l<o[r].length;l++){if(!1===o[r][l].call(o[r].match,t))return C.cancel(t);if(t.cancelBubble)return}}}(c,e,t)}}}function C(e,t){if(!(this instanceof C)){for(var s in h)if(h[s].element===e)return h[s];return h[++i]=new C(e,i),h[i]}this.element=e,this.id=t}C.prototype.on=function(e,t,s){return a.call(this,e,t,s)},C.prototype.off=function(e,t,s){return a.call(this,e,t,s,!0)},C.matchesSelector=function(){},C.cancel=function(e){e.preventDefault(),e.stopPropagation()},C.addEvent=function(e,t,s){var i="blur"==t||"focus"==t;e.element.addEventListener(t,s,i)},C.matchesEvent=function(){return!0},"undefined"!=typeof module&&module.exports&&(module.exports=C),window.Gator=C}();var WmsMainUI={_populatestatus:{contactlist:!0,grouplist:!0,chatlist:!0},starmessagelistinstance:null,populate:function(){document.getElementById("wmstoolbar")&&$WC.Util.removeElement(document.getElementById("wmstoolbar"));var e='<div id="wms_menubar" class="wms_menubar"><span data-menuname="chat" class="wms-menubutton wms_chatsicon" data-title="'+$WC.I18N("menuname.chats")+'" title="'+$WC.I18N("menuname.chats")+'"><span id="wms_menu_unreadchats_cnt" class="wms_menu_chat_unreadcnt"></span></span><span data-menuname="channel" class="wms-menubutton wms_groupicon" data-title="'+$WC.I18N("menuname.channelsandgroups")+'" title="'+$WC.I18N("menuname.channelsandgroups")+'"></span><span data-menuname="contact" class="wms-menubutton wms_contacticon" data-title="'+$WC.I18N("Contacts")+'" title="'+$WC.I18N("Contacts")+'"><span id="wms_menu_invitations_cnt" class="wms_menu_chat_unreadcnt"></span></span></div>',t='<div class="wms-chatwindowcontainer" id="wms-chatwindowcontainer">'+('<span class="wms_bar_movablehint" id="wmsbarmovablehint">'+$WC.I18N("hint.smartchat")+"</span>")+"</div>",s='<div id="wms_menu_header" class="wms_menuheader"><span id="wms_menu_userstatusiconwrapper" class="wms_menu_userstatusiconwrapper"><img src="'+_WMSPHOTOSERVER+"/file?fs=thumb"+$WC.Util.nocachefix(!0)+'"/></span><div id="wms_menu_username" class="wms_menu_username wms-truncate-ellipsis"></div><span data-minimize=true class="wms_minimizeicon wms_menu_minimize"></span><div id="wms_menu_userstatus" data-statuseditor="false" class="wms_menu_userstatus wms-truncate-ellipsis"></div><span id="wms_settings_dropdownicon" class="wms_settings" data-settings="true"></span></div>',i='<div id="wms_menu_searchcontainer" class="wms_menu_searchcontainer"><span class="wms_menu_searchicon wms_searchicon"></span><input id="wms_menu_search" type="text" class="wms_menu_searchinput" autocomplete="off" placeholder="'+$WC.I18N("search.commontitle")+'"></div>',n='<div id="zoho_links_privacy" class="wms_settings_general"><span class="wms_settings_header">'+$WC.I18N("urlconsent.zoholinkprivacy")+'</span><div id="wms_zoholinks_settings" class="wms_zoholinks_settings"><div id="zoholinks_loading_div" class="wms_loading_div"></div></div></div>';WebMessanger.is_zoho_links_settings_disabled&&(n="");var a="0"!=WmsSettings.message_translation_source?'<div class="wms_settings_chckbx"><label class="wms_settings_label" for="wms_settings_showtranslation">'+$WC.I18N("chat.translationsetting")+'</label><label class="wms_toggle_switch"><input {{TRANSLATIONCHECK}} id="wms_settings_showtranslation" data-setting="messagetranslation" type="checkbox"><span data-type="custom" class="{{TRANSLATION}}"></span></label></div>':"",o='<div id="wms_settingscontainer" style="display:none" data-showsettings="false"><div id="wms_settings_header" class="wms_settings_header"><span id="wms_settingsnavigator" data-navigator="settings" class="wms_settingsnavigator wms_menu_floatl"></span><span class="wms_settings_menu">'+$WC.I18N("Settings")+'</span></div><div id="wms_settings_general" class="wms_settings_general"><span class="wms_settings_header">'+$WC.I18N("settings.general")+'</span><div class="wms_settings_chckbx"><label class="wms_settings_label" for="wms_settings_pausechat">'+$WC.I18N("chat.pause")+'</label><label class="wms_toggle_switch"><input id="wms_settings_pausechat" type="checkbox"><span data-type="custom" class="wms_settings_togglebutton"></span></label></div>'+a+'</div><div id="wms_settings_soundnotification" class="wms_settings_general" data-global-sound="enabled"><div class="wms_settings_header"><span>'+$WC.I18N("notification.sound")+'</span><label class="wms_toggle_switch"><input {{SOUND_GLOBAL_CHECK}} id="wms_settings_sound_global" data-setting="globalsoundnotify" type="checkbox"><span data-type="custom" class="{{SOUND_GLOBAL}}"></span></label></div><div class="wms_settings_list" data-expanded="{{SOUND_SETTING_ENABLED}}"><div class="wms_settings_chckbx wms_sound_setting"><label class="wms_settings_label" for="wms_settings_sound_mymsg">'+$WC.I18N("notification.mymsg")+'</label><label class="wms_toggle_switch"><input {{SOUND_MYMESSAGE_CHECK}} id="wms_settings_sound_mymsg" data-setting="mymsgsoundnotify" type="checkbox"><span data-type="custom" class="{{SOUND_MYMESSAGE}}"></span></label></div><div class="wms_settings_chckbx wms_sound_setting"><label class="wms_settings_label" for="wms_settings_sound_mention">'+$WC.I18N("notification.mentionmsg")+'</label><label class="wms_toggle_switch"><input {{SOUND_MENTION_CHECK}} id="wms_settings_sound_mention" data-setting="mentionsoundnotify" type="checkbox"><span data-type="custom" class="{{SOUND_MENTION}}"></span></label></div><div class="wms_settings_chckbx wms_sound_setting"><label class="wms_settings_label" for="wms_settings_sound_groupmsg">'+$WC.I18N("notification.groupmsg")+'</label><label class="wms_toggle_switch"><input {{SOUND_GROUPMESSAGE_CHECK}} id="wms_settings_sound_groupmsg" data-setting="groupmessage_sound_notify" type="checkbox"><span data-type="custom" class="{{SOUND_GROUPMESSAGE}}"></span></label></div><div class="wms_settings_chckbx wms_sound_setting"><label class="wms_settings_label" for="wms_settings_sound_botmsg">'+$WC.I18N("notification.botmsg")+'</label><label class="wms_toggle_switch"><input {{SOUND_BOTMESSAGE_CHECK}} id="wms_settings_sound_botmsg" data-setting="botmessage_sound_notify" type="checkbox"><span data-type="custom" class="{{SOUND_BOTMESSAGE}}"></span></label></div><div class="wms_settings_chckbx wms_sound_setting"><label class="wms_settings_label" for="wms_settings_sound_avcalls">'+$WC.I18N("notification.avcalls")+'</label><label class="wms_toggle_switch"><input {{SOUND_AVCALLS_CHECK}} id="wms_settings_sound_avcalls" data-setting="av_call_sound_notify" type="checkbox"><span data-type="custom" class="{{SOUND_AVCALLS}}"></span></label></div><div class="wms_settings_chckbx wms_sound_setting"><label class="wms_settings_label" for="wms_settings_sound_screenshare">'+$WC.I18N("notification.screenshare")+'</label><label class="wms_toggle_switch"><input {{SOUND_SCREENSHARE_CHECK}} id="wms_settings_sound_screenshare" data-setting="screen_call_sound_notify" type="checkbox"><span data-type="custom" class="{{SOUND_SCREENSHARE}}"></span></label></div></div></div><div id="wms_settings_visualnotification" class="wms_settings_general" ><span class="wms_settings_header">'+$WC.I18N("notification.desktop")+'</span><div class="wms_settings_chckbx"><label class="wms_settings_label" for="wms_settings_visual_mymsg">'+$WC.I18N("notification.mymsg")+'</label><label class="wms_toggle_switch"><input {{VMYMESSAGECHECK}} id="wms_settings_visual_mymsg" data-setting="vmymessage" type="checkbox"><span data-type="custom" class="{{VMYMESSAGE}}"></span></label></div><div class="wms_settings_chckbx"><label class="wms_settings_label" for="wms_settings_visual_mentionmsg">'+$WC.I18N("notification.mentionmsg")+'</label><label class="wms_toggle_switch"><input {{VMENTIONCHECK}} id="wms_settings_visual_mentionmsg" data-setting="vmention" type="checkbox"><span data-type="custom" class="{{VMENTION}}"></span></label></div><div class="wms_settings_chckbx"><label class="wms_settings_label" for="wms_settings_visual_groupmsg">'+$WC.I18N("notification.groupmsg")+'</label><label class="wms_toggle_switch"><input {{GROUPMSGCHECK}} id="wms_settings_visual_groupmsg" data-setting="groupmessage_visual_notify" type="checkbox"><span data-type="custom" class="{{GROUPMESSAGE}}"></span></label></div><div class="wms_settings_chckbx"><label class="wms_settings_label" for="wms_settings_visual_botmsg">'+$WC.I18N("notification.botmsg")+'</label><label class="wms_toggle_switch"><input {{BOTMSGCHECK}} id="wms_settings_visual_botmsg" data-setting="botmessage_visual_notify" type="checkbox"><span data-type="custom" class="{{BOTMESSAGE}}"></span></label></div><div class="wms_settings_chckbx"><label class="wms_settings_label" for="wms_settings_visual_statuschange">'+$WC.I18N("notification.status.change")+'</label><label class="wms_toggle_switch"><input {{VUSTATUSCHECK}} id="wms_settings_visual_statuschange" data-setting="vustatus" type="checkbox"><span data-type="custom" class="{{VUSTATUS}}"></span></label></div></div><div id="wms_settings_readreceipt" class="wms_settings_general"><span class="wms_settings_header">'+$WC.I18N("readreceipt.title")+'</span><div class="wms_settings_chckbx"><label class="wms_settings_label" for="wms_settings_read_receipt">'+$WC.I18N("readreceipt.setting")+'</label><label class="wms_toggle_switch"><input {{READRECEIPTCHECK}} id="wms_settings_read_receipt" data-setting="read_receipt" type="checkbox"><span data-type="custom" class="{{READRECEIPT}}"></span></label></div></div>'+n+"</div>";o=$WC.template.replace(o,{SOUNDSETTING:"1"===WmsSettings.sound?"wms_settings_togglebuttonsel":"wms_settings_togglebutton",VMYMESSAGE:"1"===WmsSettings.vmymessage?"wms_settings_togglebuttonsel":"wms_settings_togglebutton",VMENTION:"1"===WmsSettings.vmention?"wms_settings_togglebuttonsel":"wms_settings_togglebutton",GROUPMESSAGE:"1"===WmsSettings.groupmessage_visual_notify?"wms_settings_togglebuttonsel":"wms_settings_togglebutton",BOTMESSAGE:"1"===WmsSettings.botmessage_visual_notify?"wms_settings_togglebuttonsel":"wms_settings_togglebutton",VUSTATUS:"1"===WmsSettings.vustatus?"wms_settings_togglebuttonsel":"wms_settings_togglebutton",READRECEIPT:WebMessanger.isReadReceiptSettingEnabled()?"wms_settings_togglebuttonsel":"wms_settings_togglebutton",TRANSLATION:"1"==WmsSettings.show_translate?"wms_settings_togglebuttonsel":"wms_settings_togglebutton",SOUND_MYMESSAGE:"1"==WmsSettings.adminsettings.mymsgsoundnotify?"wms_settings_togglebuttonsel":"wms_settings_togglebutton",SOUND_MENTION:"1"==WmsSettings.adminsettings.mentionsoundnotify?"wms_settings_togglebuttonsel":"wms_settings_togglebutton",SOUND_GROUPMESSAGE:"1"==WmsSettings.adminsettings.groupmessage_sound_notify?"wms_settings_togglebuttonsel":"wms_settings_togglebutton",SOUND_BOTMESSAGE:"1"==WmsSettings.adminsettings.botmessage_sound_notify?"wms_settings_togglebuttonsel":"wms_settings_togglebutton",SOUND_AVCALLS:"1"==WmsSettings.adminsettings.av_call_sound_notify?"wms_settings_togglebuttonsel":"wms_settings_togglebutton",SOUND_SCREENSHARE:"1"==WmsSettings.adminsettings.screen_call_sound_notify?"wms_settings_togglebuttonsel":"wms_settings_togglebutton",SOUND_GLOBAL:"1"==WmsSettings.adminsettings.globalsoundnotify?"wms_settings_togglebuttonsel":"wms_settings_togglebutton",SOUNDCHECK:"1"===WmsSettings.sound?"checked":"",VMYMESSAGECHECK:"1"===WmsSettings.vmymessage?"checked":"",VMENTIONCHECK:"1"===WmsSettings.vmention?"checked":"",GROUPMSGCHECK:"1"===WmsSettings.groupmessage_visual_notify?"checked":"",BOTMSGCHECK:"1"===WmsSettings.botmessage_visual_notify?"checked":"",VUSTATUSCHECK:"1"===WmsSettings.vustatus?"checked":"",READRECEIPTCHECK:WebMessanger.isReadReceiptSettingEnabled()?"checked":"",TRANSLATIONCHECK:"1"==WmsSettings.show_translate?"checked":"",SOUND_MYMESSAGE_CHECK:"1"===WmsSettings.adminsettings.mymsgsoundnotify?"checked":"",SOUND_MENTION_CHECK:"1"===WmsSettings.adminsettings.mentionsoundnotify?"checked":"",SOUND_GROUPMESSAGE_CHECK:"1"===WmsSettings.adminsettings.groupmessage_sound_notify?"checked":"",SOUND_BOTMESSAGE_CHECK:"1"===WmsSettings.adminsettings.botmessage_sound_notify?"checked":"",SOUND_AVCALLS_CHECK:"1"===WmsSettings.adminsettings.av_call_sound_notify?"checked":"",SOUND_SCREENSHARE_CHECK:"1"===WmsSettings.adminsettings.screen_call_sound_notify?"checked":"",SOUND_GLOBAL_CHECK:"1"==WmsSettings.adminsettings.globalsoundnotify?"checked":"",SOUND_SETTING_ENABLED:"1"==WmsSettings.adminsettings.globalsoundnotify?"true":"false"});var r='<div id="wms-pasteCapture" class="wms-pastediv" contenteditable="true"></div>',l=$WC.Config.get("customContacts")&&$WC.Config.get("customContacts").welcomemsg?$WC.Config.get("customContacts").welcomemsg:$WC.I18N("contacts.welcomemessage"),d=WebMessanger.is_create_channel_link_disabled?$WC.I18N("channel.create.new"):'<a class="wms_welcome_msg_href" target="blank" href="'+_WMSCHATURL+'officechat/index.do#createchannel">'+$WC.I18N("channel.create.new")+"</a>",c='<div id="wms_menu_listcontainer" class="wms_menu_listcontainer"><div data-menuname="chat" id="wms_menu_chatlist"><div id="wms_menu_chatlist_def" class="wms_menu_chatlist_def"><div id="wms_welcome_recentchatsmsg"><div class="wms-welcome-img wms-welcome-recentchatsimg wms-halign"></div><div class="wms-welcome-msg wms-halign">'+$WC.I18N("recentchats.welcomemessage",['<span data-menuredirect="contact">'+$WC.I18N("chat.contact")+"</span>",'<span data-menuredirect="channel">'+$WC.I18N("chat.channel")+"</span>"])+'</div></div></div><div id="wms_menu_chatlist_searchres" class="wms_menu_chatlist_searchres"></div></div><div data-menuname="channel" id="wms_menu_grouplist"><div id="wms_menu_grouplist_def" class="wms_menu_grouplist_def"><div class="wms-welcome-img wms-welcome-channelsimg wms-halign"></div><div class="wms-welcome-msg wms-halign">'+$WC.I18N("channels.welcomemessage",d)+'</div></div><div id="wms_menu_grouplist_searchres" class="wms_menu_grouplist_searchres"></div></div><div data-menuname="contact" id="wms_menu_contactlist"><div id="wms_menu_contactlist_def" class="wms_menu_contactlist_def"><div class="wms-welcome-img wms-welcome-contactsimg wms-halign"></div><div class="wms-welcome-msg wms-halign">'+$WC.I18N("contacts.welcomemessage")+'</div></div><div id="wms_menu_contactlist_searchres" class="wms_menu_contactlist_searchres"></div></div><div data-menuname="customcontact" id="wms_menu_customcontactlist"><div id="wms_menu_customcontactlist_def" class="wms_menu_customcontactlist_def"><div class="wms-welcome-img wms-welcome-contactsimg wms-halign"></div><div class="wms-welcome-msg wms-halign">'+l+'</div></div><div id="wms_menu_customcontactlist_searchres" class="wms_menu_customcontactlist_searchres"></div></div></div>',m="";m=WebMessanger.is_custom_menu_opted?'<div id="wms_menu" class="wms-menu wms_custom_menu">'+i+c+"</div>":'<div id="wms_menu" class="wms-menu">'+s+'<div id="wms_menu_settingsdropdown" data-settingsdropdown="true" class="wms_menu_settingsdropdown"></div><div id="wms_cstatus" data-showstatus="false" class="wmspd1" style="display:none; overflow-x: hidden;"></div>'+i+o+c+"</div>";var u='<div class="wms-turnoffinfo" id="chatturnoffinfo" style="display: none;">'+$WC.I18N("chat.paused")+' <a style="cursor: pointer;" data-unpausechat="true" >'+$WC.I18N("chat.unpause")+"</a></div>",p='<div id="wms_incomingcall"class="wms_incomingcall"><div id="wms_caller_container" class="wms_caller_container"><img id="wms_callerimg" class="wms_caller_img"></img><span id="wms_calltype" class="wms_calltype wms-halign"></span><span id="wms_callername" class="wms_callername wms-halign"></span><div class="wms_videocall_buttons_list wms_incomingcall_buttons"><div id="wms_answercall_button"class="wms_videocall_button wms_answercall_button" call-action="acceptcall" title="'+$WC.I18N("mediacall.incoming.accept")+'"></div><div class="wms_videocall_button wms_replymsg_button" call-action="replycall" style="display: none;"></div><div id="wms_rejectcall_button" class="wms_videocall_button wms_rejectcall_button" call-action="rejectcall" title="'+$WC.I18N("mediacall.incoming.reject")+'"></div></div></div></div>',h='<div id="wmsglobalsearch" title="'+$WC.I18N("GS_Search_across_zoho")+'" class="wms-gssearch"><span class="wms_searchicon"></span></div>',g='<div id="wms_notebook_icon" class="wms_notebook_icon" data-notebook-icon="true" data-shown="false"><div id="wms_notebook_container" class="wms_notebook_container" style="z-index: '+(isNaN($WC.Config.get("zindex"))?"1":$WC.Config.get("zindex"))+'"><div class="wms_notebook_header"><span class="wms_notebook_widget_heading">'+$WC.I18N("notebook.widget.name")+'</span><div class="wms_notebook_widget_button" data-action="close"></div></div><div class="wms_notebook_loader wms-hvalign" id="wms_notebook_loader"></div></div></div>',f=r+'<div id="wms-menucontainer" class="wms-menucontainer">'+m+e+"</div>";_WMSEMPTYBAR&&(f=r+'<div id="wms-menucontainer" class="wms-menucontainer" style="width:0px;"></div>',t='<div class="wms-chatwindowcontainer" id="wms-chatwindowcontainer"></div>'),WebMessanger.is_custom_menu_opted&&(f=m),f+='<div id="wmsnotificationholder" class="wms-nh"></div>',WMSUI.globalsearchenabled&&(f+=h),WMSUI.notebook_widget_disabled||WebMessanger.isPortalUser()||(f+=g),WMSUI.phonebridgeenabled&&(f+='<div id="wmsphonebridge" class="wms_phonebridgecontainer"></div>'),f+='<div id="wmsstatusbar" class="wmsstatusbar"></div>',f+=u,f+=p,f+=t;var C=$WC.Util.createElement("div","wmstoolbar","wms-mainui");if(WmsImplHandler.invokeSynchronously(WmsUIImpl.getCustomMenuListContainer)&&(f=m,C=WmsImplHandler.invokeSynchronously(WmsUIImpl.getCustomMenuListContainer)),C.style.zIndex=WebMessanger.setzindex,C.innerHTML=$WC.template.replace(f),WebMessanger.rtlmode&&(C.className+=" wms-rtl"),WebMessanger.isDNDBackupIconEnabled()&&(C.className+=" wms_dnd_backup_icon"),WmsImplHandler.invokeSynchronously(WmsUIImpl.getCustomMenuListContainer)||document.body.appendChild(C),WmsMainUI.applyChatBarOptions(),WindowHandler.chatbar=document.getElementById("wms-chatwindowcontainer"),WmsMainUI.maincontainer=document.getElementById("wmstoolbar"),WmsMainUI.menucontainer=document.getElementById("wms-menucontainer"),WmsMainUI.menubar=document.getElementById("wms_menubar"),WmsMainUI.menusearchcontainer=document.getElementById("wms_menu_searchcontainer"),WmsMainUI.statuscontainer=document.getElementById("wms_cstatus"),WmsMainUI.settingsdropdown=document.getElementById("wms_menu_settingsdropdown"),WmsMainUI.settingsdropdownicon=document.getElementById("wms_settings_dropdownicon"),WmsMainUI.settingscontainer=document.getElementById("wms_settingscontainer"),WmsMainUI.menulistcontainer=document.getElementById("wms_menu_listcontainer"),WmsMainUI.settingsnavigator=document.getElementById("wms_settingsnavigator"),WmsMainUI.menu=document.getElementById("wms_menu"),WmsMainUI.menuheader=document.getElementById("wms_menu_header"),WmsMainUI.searchdiv=document.getElementById("wms_menu_search"),WmsMainUI.usernamediv=document.getElementById("wms_menu_username"),WmsMainUI.statusmsgdiv=document.getElementById("wms_menu_userstatus"),WmsMainUI.statusiconwrapper=document.getElementById("wms_menu_userstatusiconwrapper"),WmsMainUI.chatlist=document.getElementById("wms_menu_chatlist"),WmsMainUI.defaultcontactlist=document.getElementById("wms_menu_contactlist_def"),WmsMainUI.searchrescontactlist=document.getElementById("wms_menu_contactlist_searchres"),WmsMainUI.defaultchatlist=document.getElementById("wms_menu_chatlist_def"),WmsMainUI.searchreschatlist=document.getElementById("wms_menu_chatlist_searchres"),WmsMainUI.defaultgrouplist=document.getElementById("wms_menu_grouplist_def"),WmsMainUI.searchresgrouplist=document.getElementById("wms_menu_grouplist_searchres"),WmsMainUI.unreadchatcntdiv=document.getElementById("wms_menu_unreadchats_cnt"),WmsMainUI.invitationscntdiv=document.getElementById("wms_menu_invitations_cnt"),WmsMainUI.customcontactscntdiv=document.getElementById("wms_menu_customcontacts_cnt"),WmsMainUI.servicestatusdiv=document.getElementById("wmsstatusbar"),WmsMainUI.contactdetailsdiv=document.getElementById("wms_contactdetails"),WmsMainUI.notificationholder=document.getElementById("wmsnotificationholder"),Gator(WmsMainUI.menubar).on("click","[data-menuname]",function(e){if("chat"==this.getAttribute("data-menuname")&&ChatTour.isTourNotificationShown()){var t,s={welcome:{title:"",elemid:'id="wms_menubar"',align:"horizontal",content:"tourinfo.intro",position:"fixed",icon:"wms_chattour_icon"},contacts:{title:"Contacts",elemid:'data-title="'+$WC.I18N("Contacts")+'"',align:"horizontal",content:"contacts.welcomemessage",position:"fixed",icon:"wms_contacts_icon"},channels:{title:"menuname.channelsandgroups",elemid:'data-title="'+$WC.I18N("menuname.channelsandgroups")+'"',align:"horizontal",content:"tourinfo.channels",position:"fixed",icon:"wms_channels_icon"},chats:{title:"menuname.chats",elemid:'data-title="'+$WC.I18N("menuname.chats")+'"',align:"horizontal",content:"tourinfo.chats",icon:"wms_chats_icon"},cliq:{pointer:"none",align:"center",sethtml:'<div class="wms-hysearch wms-hvalign wms_chattour_container"><div data-operation="close" class="wms_chattour_close"></div><img src="https://img.zohocdn.com/ichat/images/bar/2caf0f0d_chatbar_onboard.png" class="wms_chattour_img"><div class="wms_chattour_info">{{CONTENT}}</div><div><button class="wms_chattour_button" data-operation="visitcliq">{{TEXT}}</button></div></div>',replacetext:{CONTENT:"tourinfo.onboarding",TEXT:"visit.cliq"}}},i=$WC.RecentChats.getRecentChatTime(),n=!1,a=WebMessanger.isCliqUser();if(i){(new Date).getTime()-432e6<i&&(n=!0)}if(!1===a&&!1===n&&(!(t=[s.welcome,s.contacts,s.channels,s.chats,s.cliq])!==WebMessanger.isOrgUser()&&"disable"!=$WC.Config.get("channels")||(t=[s.welcome,s.contacts,s.chats,s.cliq])),!0===a&&!1===n&&(t=[s.welcome,s.contacts,s.channels,s.chats]),!1===a&&!0===n&&(t=[s.cliq]),t)return void ChatTour.init(t,document.getElementById("wmstoolbar"))}WmsMainUI.toggleMenu(this.getAttribute("data-menuname")),WmsMainUI.updateUnreadChatsCount()}),WmsMainUI.bindRecentChatEvents(),Gator(WmsMainUI.menubar).on("mouseenter",function(){null===$WC.RecentChats.getPinnedChatsLastFetchedTime()&&WebMessanger.getPinnedChats()}),Gator(WmsMainUI.settingscontainer).on("click","[data-navigator]",function(){WmsMainUI.settingsdropdownicon.setAttribute("data-settings","false"),WmsMainUI.settingsdropdown.style.display="block",WmsMainUI.settingsdropdownicon.setAttribute("class","wms_settings_close"),WmsMainUI.toggleSettings()}),Gator(WmsMainUI.settingsdropdown).on("click","[data-operation]",function(){var e=this.getAttribute("data-operation");"wms_menu_settings"===e?(WmsMainUI.settingsdropdown.style.display="none",WmsMainUI.settingsdropdownicon.setAttribute("class","wms_settings_close"),WmsMainUI.toggleSettings(),WebMessanger.is_zoho_links_settings_disabled||WmsMainUI.setLinkPreviewSettings()):"wms_menu_status"===e?(WmsMainUI.settingsdropdown.style.display="none",WmsMainUI.settingsdropdownicon.setAttribute("class","wms_settings_close"),WmsMainUI.toggleStatus()):"wms_menu_chathistory"===e?(WmsMainUI.settingsdropdown.style.display="none",WmsMainUI.settingsdropdownicon.setAttribute("class","wms_settings"),WmsMainUI.settingsdropdownicon.setAttribute("data-settings","true"),$WC.Channels.initChannels(),ZMSGUI.showChatHistory()):"wms_menu_feedhistory"===e?(WmsMainUI.settingsdropdown.style.display="none",WmsMainUI.settingsdropdownicon.setAttribute("class","wms_settings"),WmsMainUI.settingsdropdownicon.setAttribute("data-settings","true"),ZMSGUI.launchHistory()):"wms_menu_pendinginvitations"===e?(WmsMainUI.settingsdropdown.style.display="none",WmsMainUI.settingsdropdownicon.setAttribute("class","wms_settings"),WmsMainUI.settingsdropdownicon.setAttribute("data-settings","true"),WmsMainUI.showPendingInvitations()):"wms_menu_starredmsg"===e&&(WmsMainUI.settingsdropdown.style.display="none",WmsMainUI.settingsdropdownicon.setAttribute("class","wms_settings"),WmsMainUI.settingsdropdownicon.setAttribute("data-settings","true"),WmsMainUI.showStarredMessages())}),Gator(WmsMainUI.searchdiv).on("keydown",function(e){if(e.keyCode===$WC.WmsConstants.KEYCODES.ESCAPE)WmsMainUI.hideMenu();else{if(e.keyCode===$WC.WmsConstants.KEYCODES.TAB&&e.shiftKey)return WindowHandler.moveFocus("",!0),!1;if(e.keyCode===$WC.WmsConstants.KEYCODES.TAB)return WindowHandler.moveFocus(),!1;WmsHybridSearch.handleEvent(e)}}),Gator(WmsMainUI.searchdiv).on("keyup",function(e){WmsHybridSearch.handleKeyUp(e),$WC.Util.loadOriginalImage($WC.HybridSearch.getNode("searchresultdiv",$WC.HybridSearch.getCurrentModule()))}),Gator(WmsMainUI.searchdiv).on("focus",function(){WindowHandler.lastViewed=-1}),Gator(WmsMainUI.menu).on("click","[data-zcprofileid]",function(e){WebMessanger.showProfileInfo(this)}),Gator(WmsMainUI.maincontainer).on("click","[data-zcprofileid]",function(e){WebMessanger.showProfileInfo(this)}),Gator(WindowHandler.chatbar).on("click","[data-zcprofileid]",function(e){WebMessanger.showProfileInfo(this)}),Gator(document).on("click","[custom_message]",function(e){$WC.CustomMsgUI.handleMoreMessage(e)}),Gator(WmsMainUI.menuheader).on("click","[data-minimize]",function(){WmsMainUI.hideMenu()}),Gator(WmsMainUI.menuheader).on("click","[data-settings]",function(){if("true"===this.getAttribute("data-settings")){this.setAttribute("data-settings","false");var e='<div id="wms_menu_chathistory" data-operation="wms_menu_chathistory" class="wms_menu_settingsdropdown_item"><span class="wms_menu_userstatusiconwrapper"><div class="wms_chathistory_icon"></div></span><div class="wms_menu_settingsname wms-hvalign">'+$WC.I18N("Chat_History")+"</div></div>";WebMessanger.isCliqUser()&&(e='<div id="wms_menu_chathistory" data-operation="wms_menu_chathistory" class="wms_menu_settingsdropdown_item"><span class="wms_menu_userstatusiconwrapper"><div class="wms_chathistory_icon"></div></span><div class="wms_menu_settingsname wms-hvalign">'+$WC.I18N("chat.message.search")+"</div></div>");var t=e+'<div id="wms_menu_status" data-operation="wms_menu_status" class="wms_menu_settingsdropdown_item"><span class="wms_menu_userstatusiconwrapper"><div class="wms_statuschange_icon"></div></span><div class="wms_menu_settingsname wms-hvalign">'+$WC.I18N("user.status.change")+'</div></div><div id="wms_menu_starredmsg" data-operation="wms_menu_starredmsg" class="wms_menu_settingsdropdown_item"><span class="wms_menu_userstatusiconwrapper"><div class="wms_menu_staricon"></div></span><div class="wms_menu_settingsname wms-hvalign">'+$WC.I18N("chat.message.star")+'</div></div><div id="wms_menu_settings" data-operation="wms_menu_settings" class="wms_menu_settingsdropdown_item"><span class="wms_menu_userstatusiconwrapper"><div class="wms_settings_icon"></div></span><div class="wms_menu_settingsname wms-hvalign">'+$WC.I18N("Settings")+"</div></div>";WebMessanger.isCliqUser()&&$WC.SecurityManager.hasPermission("taz")||(t+='<div id="wms_menu_feedhistory" data-operation="wms_menu_feedhistory" class="wms_menu_settingsdropdown_item"><span class="wms_menu_userstatusiconwrapper"><div class="wms_feedhistory_icon"></div></span><div class="wms_menu_settingsname wms-hvalign">'+$WC.I18N("Feed_History")+"</div></div>"),WmsContacts.getPendingInvitedContactsList().length&&(t+='<div id="wms_menu_pendinginvitations" data-operation="wms_menu_pendinginvitations" class="wms_menu_settingsdropdown_item"><span class="wms_menu_userstatusiconwrapper"><div class="wms_pendinginv_icon"></div></span><div class="wms_menu_settingsname wms-hvalign">'+$WC.I18N("chat.pending.invitations")+"</div></div>"),WmsMainUI.settingsdropdown.innerHTML=t,WmsMainUI.settingsdropdown.style.display="block",this.setAttribute("class","wms_settings_close")}else this.setAttribute("data-settings","true"),WmsMainUI.settingsdropdown.style.display="none",this.setAttribute("class","wms_settings"),WmsMainUI.hideStatus();WmsMainUI.hideSettings()}),Gator(WmsMainUI.menuheader).on("click","[data-statuseditor='false']",function(){WmsMainUI.showStatusEditor()}),Gator(WmsMainUI.menuheader).on("blur","[data-statuseditor]",function(){WmsMainUI.statusmsgdiv.setAttribute("data-statuseditor","false"),$WC.$CUtil.setInnerText(WmsMainUI.statusmsgdiv,$WC.Util.unescapeHTML(WebMessanger.smsg))}),Gator(WmsMainUI.settingscontainer).on("change","input[type=checkbox]",function(e){WmsMainUI.updateSettings(e)}),Gator(WmsMainUI.settingscontainer).on("change","select[data-select]",function(e){WmsMainUI.updateSettings(e)}),document.getElementById("wmsglobalsearch")&&Gator(document.getElementById("wmsglobalsearch")).on("click",function(){zgssearch.toggleGlobalsearch()}),document.getElementById("wms_notebook_icon")&&Gator(document.getElementById("wms_notebook_icon")).on("click",function(e){"wms_notebook_icon"!==e.target.id&&"close"!==e.target.getAttribute("data-action")||WebMessanger.openNotebookWidget()}),_WMSEMPTYBAR||($WC.Util.addEvent(WmsMainUI.defaultchatlist,"scroll",$WC.Util.debounce(WmsHybridSearch.checkScrollAndloadMoreChatlist,null,300)),$WC.Util.addEvent(WmsMainUI.defaultcontactlist,"scroll",$WC.Util.loadImageWithDebounce(WmsMainUI.defaultcontactlist)),$WC.Util.addEvent(WmsMainUI.searchrescontactlist,"scroll",$WC.Util.loadImageWithDebounce(WmsMainUI.searchrescontactlist)),$WC.Util.addEvent(WmsMainUI.defaultgrouplist,"scroll",$WC.Util.debounce(function(e){$WC.Util.loadImageWithDebounce(WmsMainUI.defaultgrouplist),WmsHybridSearch.checkScrollAndloadMoreChannels(e)},null,300)),$WC.Util.addEvent(WmsMainUI.searchresgrouplist,"scroll",$WC.Util.loadImageWithDebounce(WmsMainUI.searchresgrouplist)),$WC.Util.addEvent(WmsMainUI.defaultchatlist,"scroll",$WC.Util.loadImageWithDebounce(WmsMainUI.defaultchatlist)),$WC.Util.addEvent(WmsMainUI.searchreschatlist,"scroll",$WC.Util.loadImageWithDebounce(WmsMainUI.searchreschatlist))),"disable"!=$WC.Config.get("channels")&&!WebMessanger.isPortalUser()||WmsMainUI.removeChannelMenu(),$WC.Config.get("customContacts")&&!$WC.Config.get("customContacts").separatePane){var v=$WC.Config.get("customContacts"),b=WmsMainUI.menubar.querySelector('[data-menuname="contact"]');v.title&&b.setAttribute("data-title",v.title)}_WMSEMPTYBAR||WebMessanger.registerAnnonUser||WebMessanger.is_custom_menu_opted||setTimeout(function(){WebMessanger.appendGlobalSearch()},1),$WC.Util.isEmpty(WmsSettings.adminsettings.moduleconfig)&&WmsSettings.initModulesPermissions(),WmsMainUI.updateUserName(),"undefined"!=typeof WmsUIImpl&&WmsUIImpl.UIReady()},applyChatBarOptions:function(){var e=WmsImplHandler.invokeSynchronously(WmsUIImpl.getChatBarOptions),t={};if(t.customContacts=WmsImplHandler.invokeSynchronously(WmsUIImpl.customContactsConfig),$WC.Config.set(e),$WC.Config.set(t),$WC.Config.get("customContacts")&&$WC.Config.get("customContacts").separatePane&&null===WmsMainUI.menubar.querySelector('[data-menuname="customcontact"]')){var s=$WC.Config.get("customContacts").title?$WC.Config.get("customContacts").title:$WC.I18N("Contacts");WmsMainUI.menubar.insertAdjacentHTML("beforeend",'<span data-menuname="customcontact" class="wms-menubutton wms_contacticon '+$WC.Config.get("customContacts").customContactsIconClassName+'" data-title="'+s+'" title="'+s+'"><span id="wms_menu_customcontacts_cnt" class="wms_menu_chat_unreadcnt"></span></span>')}},handleSettings:function(e,t){var s=t.parentNode.querySelector('[data-type="custom"]');t&&"1"==e?s.setAttribute("class","wms_settings_togglebuttonsel"):s.setAttribute("class","wms_settings_togglebutton")},showStatusEditor:function(){var e=$WC.Util.getInnerText(WmsMainUI.statusmsgdiv);WmsMainUI.statusmsgdiv.innerHTML='<textarea data-editor="true" id="wms_menu_statuseditor" class="wms_menu_userstatus_textarea"></textarea>',document.getElementById("wms_menu_statuseditor").value=e,document.getElementById("wms_menu_statuseditor").focus(),Gator(WmsMainUI.menuheader).on("keydown","[data-editor='true']",function(e){if(e.keyCode===$WC.WmsConstants.KEYCODES.ENTER||e.keyCode===$WC.WmsConstants.KEYCODES.ESCAPE){WmsMainUI.statusmsgdiv.setAttribute("data-statuseditor","false");var t=e.target.value;e.keyCode!==$WC.WmsConstants.KEYCODES.ESCAPE&&t?WebMessanger.smsg!==t?WMSUI.handleStatusChange(t,e):$WC.$CUtil.setInnerText(WmsMainUI.statusmsgdiv,$WC.Util.unescapeHTML(t)):$WC.$CUtil.setInnerText(WmsMainUI.statusmsgdiv,$WC.Util.unescapeHTML(WebMessanger.smsg))}}),WmsMainUI.statusmsgdiv.setAttribute("data-statuseditor","true")},updateSettings:function(e){var t=$WC.Util.getEventTarget(e),s=t.getAttribute("id");if("wms_settings_pausechat"===s)WebMessanger.chatdeactivated?WebMessanger.turnOnChat():WebMessanger.turnOffChat();else if(-1!==s.indexOf("wms_settings_sound")){var i=t.getAttribute("data-setting");WMSUI.toggleSoundSetting(i)}else if(-1!==s.indexOf("wms_settings_visual")){i=t.getAttribute("data-setting");WMSUI.reqNotificationPermAndToggle(i)}else if("zoholinkspermission"===s)$WC.updateLinkPreviewSettings(t.selectedOptions[0].value);else if(-1!==s.indexOf("wms_settings_read_receipt")){var n=WmsSettings.adminsettings.moduleconfig&&WmsSettings.adminsettings.moduleconfig.messaging&&WmsSettings.adminsettings.moduleconfig.messaging.configs;if(n&&"true"==n.read_receipt&&"true"==n.custom_read_receipt){var a=WebMessanger.isReadReceiptSettingEnabled()?"0":"1";$WC.Ajax.postRequestToChat("updbsettings.do","read_reciept="+a)}else WMSUI.showErrorMsg($WC.I18N("settings.disabled.admin"))}else if("wms_settings_showtranslation"==s){var o="show_translate_option="+("1"==WmsSettings.show_translate?"0":"1");$WC.Ajax.postRequestToChat("updbsettings.do",o)}},updateUserName:function(){WmsMainUI.usernamediv&&WebMessanger.nname&&(WmsMainUI.usernamediv.setAttribute("title",WebMessanger.nname),$WC.$CUtil.setInnerText(WmsMainUI.usernamediv,WebMessanger.nname))},updateUserStatusIcon:function(){var e=WebMessanger.scode;if(e){var t=WmsContacts.getStatusClassName(WebMessanger.zuid,WebMessanger.scode,WebMessanger.stype)||{0:"offline",1:"available",2:"offline",3:"busy",4:"idle",5:"dnd",7:"away"}[e],s="";100<parseInt(WebMessanger.stype)&&(s=" wms_badge_statusicon_"+t+"_cutout"),WmsMainUI.statusiconwrapper.className="wms_menu_userstatusiconwrapper wms_badge_statusicon_"+t+s}WmsMainUI.checkAndToggleDNDMode()},updateUserStatusMsg:function(){WmsMainUI.statusmsgdiv.setAttribute("title",$WC.Util.unescapeHTML(WebMessanger.smsg)),$WC.$CUtil.setInnerText(WmsMainUI.statusmsgdiv,$WC.Util.unescapeHTML(WebMessanger.smsg))},updateContactHTML:function(e,t){var s=e.USERID,i=WmsMainUI.defaultcontactlist.querySelector('[data-id="'+s+'"]')||WmsMainUI.searchrescontactlist.querySelector('[data-id="'+s+'"]');if(i){var n=i.previousSibling,a=i.parentNode;$WC.Util.removeElement(i);var o=$WC.HybridSearch.generateContactHtml(e.USERID,e.DNAME,e.STATUSMSG,"",t);n?n.insertAdjacentHTML("afterend",o):a.insertAdjacentHTML("afterbegin",o)}},updateChatHTML:function(e){var t=WmsMainUI.chatlist.querySelector('[data-userid="'+e+'"]')||WmsMainUI.searchreschatlist.querySelector('[data-userid="'+e+'"]');if(t){var s=t.getAttribute("data-id"),i=$WC.RecentChats.get(s),n=$WC.HybridSearch.generateImageHtml(s,$WC.WmsConstants.HYBRIDSEARCH.CHAT,i);$WC.Util.removeElement(t.firstChild),t.insertAdjacentHTML("afterbegin",n)}},toggleMenu:function(e,t){var s=WmsMainUI.menubar&&WmsMainUI.menubar.querySelector("[data-menuname="+e+"]");t||s&&"true"===s.getAttribute("data-selected")?WmsMainUI.hideMenu():WmsMainUI.showMenu(e)},hideMenu:function(){if(WmsMainUI.menubar){var e=WmsMainUI.menubar.querySelector("[data-selected=true]");e&&e.setAttribute("data-selected","false")}WmsMainUI.menu.style.display="none",WebMessanger.is_custom_menu_opted||(WmsMainUI.settingsdropdown.style.display="none",WmsMainUI.updateUnreadChatsCount())},toggleSmartChatButton:function(e){var t=document.getElementById("wmsbarmovablehint");t&&(t.style.display=e?"none":"inline")},removeChannelMenu:function(){if(WmsMainUI.menubar){var e=WmsMainUI.menubar.querySelector('[data-menuname="channel"]');e&&WmsMainUI.menubar.removeChild(e)}},toggleSettings:function(){"true"===WmsMainUI.settingscontainer.getAttribute("data-showsettings")?WmsMainUI.hideSettings():(WmsMainUI.menusearchcontainer.style.display="none",WmsMainUI.menulistcontainer.style.display="none",WmsMainUI.settingscontainer.style.display="block",WmsMainUI.settingscontainer.setAttribute("data-showsettings","true"))},toggleStatus:function(){"true"===WmsMainUI.statuscontainer.getAttribute("data-showstatus")?WmsMainUI.hideStatus():(WebMessanger.getAllStatusMessage(),WmsMainUI.statuscontainer.style.display="block",WmsMainUI.statuscontainer.setAttribute("data-showstatus","true"))},hideSettings:function(){WmsMainUI.menusearchcontainer.style.display="block",WmsMainUI.menulistcontainer.style.display="block",WmsMainUI.settingscontainer.style.display="none",WmsMainUI.settingscontainer.setAttribute("data-showsettings","false")},hideStatus:function(){WmsMainUI.statuscontainer.style.display="none",WmsMainUI.statuscontainer.setAttribute("data-showstatus","false"),WmsMainUI.settingsdropdownicon.setAttribute("class","wms_settings"),WmsMainUI.settingsdropdownicon.setAttribute("data-settings","true")},filterUnreadChats:function(e,i){var n=document.getElementById("wms_menu_chatlist_recentchats"),t=$WC.RecentChats.getUnreadChatList("unmuted");t.sort($WC.Util.sortBy("LMTIME",!0));var s=$WC.RecentChats.getUnreadChatList("muted");s.sort($WC.Util.sortBy("LMTIME",!0));var a=t.concat(s);a=99<a.length?a.slice(0,99):a;var o="unreadchats";!e&&0!==a.length||(a=$WC.RecentChats.getChats(),o="recentchats"),-1===n.className.indexOf("wms_menu_dynamic_pos")&&($WC.Util.convertToArray(n.childNodes).forEach(function(e,t){e.style.transition="initial",e.style.transform="translateY("+54*t+"px)"}),n.offsetTop,$WC.Util.addClass(n,"wms_menu_dynamic_pos")),$WC.Util.convertToArray(n.childNodes).forEach(function(e){e.style.transition="initial";var t=a.length?54*(a.length-1):0;e.style.transform="translateY("+t+"px)",e.style.opacity="0",e.style.zIndex="-1"}),a.map(function(e){return e.CHATID}).forEach(function(e,t){var s=n.querySelector('[data-id="'+e+'"]');s&&(i&&(s.style.transition="transform 300ms, opacity 300ms"),s.style.transform="translateY("+54*t+"px)",s.style.opacity="1",s.style.zIndex="")});var r=document.getElementById("wms_menu_heading_recentchats");r.setAttribute("data-heading",o),r.querySelector(".wms_menu_filter_icon").title=$WC.I18N(o+".filtertitle"),$WC.$CUtil.setInnerText(r.firstChild,$WC.I18N(o+".title"));var l=n.querySelector("#wms-chat-loadstatus");l&&(e?(l.style.display="block",l.style.opacity=1,l.style.transform="translateY("+54*a.length+"px)"):l.style.display="none"),setTimeout(function(){$WC.Util.loadOriginalImage(WmsMainUI.defaultchatlist)},300),WmsMainUI.updateCountDependentUI()},showMenu:function(e){function t(e,t){if(e){var s=e.querySelector("[data-menuname="+t+"]");s.setAttribute("data-selected","true"),$WC.Util.convertToArray(e.children).forEach(function(e){e!==s&&e.setAttribute("data-selected","false")})}}WebMessanger.is_custom_menu_opted||(WmsMainUI.hideSettings(),WmsMainUI.settingsdropdownicon.setAttribute("class","wms_settings"),WmsMainUI.settingsdropdownicon.setAttribute("data-settings","true"),WmsMainUI.settingsdropdown.style.display="none",WmsMainUI.resetToDefaultUI()),WmsMainUI.menu.style.display=WebMessanger.is_custom_menu_opted?"flex":"block",t(WmsMainUI.menubar,e),t(WmsMainUI.menulistcontainer,e),void 0!==WmsMainUI&&(WmsMainUI.menu&&"block"!==WmsMainUI.menu.style.display?(WebMessanger.is_custom_menu_opted||WmsMainUI.updateUnreadChatsCount(),WmsMainUI.updateCountDependentUI()):($WC.Util.pubsub.publish("/recentchats/updateui",$WC.WmsConstants.REQSTATUS.SUCCESS),$WC.Util.pubsub.publish("/channels/updateui",{}))),"contact"===e?($WC.Bots.initBots(),$WC.Config.get("customContacts")?WmsMainUI.searchdiv.setAttribute("placeholder",$WC.Config.get("customContacts").searchTitle?$WC.Config.get("customContacts").searchTitle:$WC.I18N("Search_Contacts")):WmsMainUI.searchdiv.setAttribute("placeholder",$WC.I18N("Search_Contacts")),setTimeout(function(){$WC.Config.get("customContacts")&&!$WC.Config.get("customContacts").separatePane?WmsHybridSearch.populateCustomContactListInMainUI():WmsHybridSearch.populateContactListInMainUI(),$WC.Util.loadOriginalImage(WmsMainUI.defaultcontactlist)},1)):"channel"===e?(WmsMainUI.searchdiv.setAttribute("placeholder",$WC.I18N("search.channelsandgroups")),setTimeout(function(){$WC.Config.get("isOrgUser")()&&"disable"!=$WC.Config.get("channels")&&null===$WC.Channels.getLastFetchedTime()&&$WC.Channels.initChannels(),WmsHybridSearch.populateGroupResultInMainUI(),$WC.Util.loadOriginalImage(WmsMainUI.defaultgrouplist)},1)):"chat"===e?(WmsMainUI.getUnreadChatsCount()&&WmsMainUI.filterUnreadChats(),$WC.RecentChats.initRecentChats(),$WC.Config.get("isOrgUser")()&&"disable"!=$WC.Config.get("channels")&&null===$WC.Channels.getLastFetchedTime()&&$WC.Channels.initChannels(),$WC.Bots.initBots(),$WC.Config.get("isOrgUser")()&&"disable"!=$WC.Config.get("channels")?WmsMainUI.searchdiv.setAttribute("placeholder",$WC.I18N("search.commontitle")):WmsMainUI.searchdiv.setAttribute("placeholder",$WC.I18N("search.contactsandchats")),$WC.Util.loadOriginalImage(WmsMainUI.defaultchatlist)):"customcontact"===e&&($WC.Config.get("customContacts")&&WmsMainUI.searchdiv.setAttribute("placeholder",$WC.Config.get("customContacts").searchTitle?$WC.Config.get("customContacts").searchTitle:$WC.I18N("Search_Contacts")),WmsHybridSearch.populateCustomContactListInMainUI()),WmsMainUI.searchdiv.value="",WmsMainUI.searchdiv.focus()},updateLoadingForPinnedChats:function(e){if(!silent){var t=document.getElementById("wms_menu_chatlist_def"),s=document.getElementById("wms_menu_chatlist_searchres"),i=!(!s||"block"!=s.style.display),n=document.getElementById("wms_menu_chatlist_loading");if(e)n||i||(t.insertAdjacentHTML("afterend",'<div id="wms_menu_chatlist_loading" class="wms_menu_chatlist_def" style="display: block;"></div>'),t.style.display="none",$WC.HybridSearch.updateLoadingStatus(document.getElementById("wms_menu_chatlist_loading"),$WC.WmsConstants.REQSTATUS.SUCCESS,"chat"),$WC.HybridSearch.updateLoadingStatus(document.getElementById("wms_menu_chatlist_loading"),$WC.WmsConstants.REQSTATUS.LOADING,"chat"));else if(n)$WC.Util.removeElement(n),i||(t.style.display="block"),t.scrollHeight>t.clientHeight&&$WC.HybridSearch.updateLoadingStatus($WC.HybridSearch.getNode("defaultresultdiv",3),$WC.WmsConstants.REQSTATUS.LOADING,"chat")}},resetToDefaultUI:function(){WmsMainUI.searchdiv.value="",WmsMainUI.searchrescontactlist.style.display="none",WmsMainUI.searchreschatlist.style.display="none",WmsMainUI.searchresgrouplist.style.display="none",WmsMainUI.defaultcontactlist.style.display="block",WmsMainUI.defaultchatlist.style.display="block",WmsMainUI.defaultgrouplist.style.display="block",$WC.HybridSearch.resetHover()},setRePopulateStatus:function(e,t){WmsMainUI._populatestatus[e]=t},decideRepopulate:function(e){return WmsMainUI._populatestatus[e]}};(function(){var l={},d={},c={};WmsMainUI.getParentThreadId=function(e){for(var t in c)if(-1!=c[t].indexOf(e))return t},WmsMainUI.incrementUnreadCount=function(e,t){l[e]||(l[e]={count:0}),t?(c[e]&&-1==c[e].indexOf(t)?c[e].push(t):c[e]||(c[e]=[t]),l[e][t]||(l[e][t]=0),l[e][t]++):(l[e].count||(l[e].count=0),l[e].count++)},WmsMainUI.decrementUnreadCount=function(e,t){t&&l[e]&&0!=l[e][t]?(l[e][t]--,c[e]&&-1!=c[e].indexOf(t)&&c[e].splice(c[e].indexOf(t),1)):l[e]&&0!=l[e].count&&l[e].count--},WmsMainUI.resetUnreadCount=function(e,t,s){var i=t?d:l;i[e]?s?(i[e][s]&&0!=i[e][s]&&$WC.Util.pubsub.publish("/chats/unreadchatdetails"),i[e][s]=0,c[e]&&-1!=c[e].indexOf(s)&&c[e].splice(c[e].indexOf(s),1),delete WebMessanger.unreadthreadmap[s]):(i[e].count&&0!=i[e].count&&$WC.Util.pubsub.publish("/chats/unreadchatdetails"),i[e].count=0):i[e]={count:0}},WmsMainUI.getUnreadCount=function(e,t,s,i){var n=t?d:l;if(n[e]){if(s)return parseInt(n[e][s])||0;if(i)return n[e].count||0;var a=n[e].count||0;for(var s in n[e])$WC.Util.isThreadChid(s)&&(a+=parseInt(n[e][s]));return a}},WmsMainUI.getUnreadChatsCount=function(e){var t=0,s=e?d:l;for(var i in s)!(s[i].count||c[i]&&c[i].length)||!0===WmsMainUI.getMuteStatus(i)||s[i].entity_id&&$WC.Util.checkIfChatletHidden(s[i].entity_id)||t++;return t},WmsMainUI.getUnreadThreads=function(e){if(c[e])return c[e]},WmsMainUI.setUnreadCount=function(e,t,s,i,n){var a=s?d:l;if(n){c[e]&&-1==c[e].indexOf(n)?c[e].push(n):c[e]||(c[e]=[n]);var o={};o[n]=t,a[e]?a[e][n]=t:a[e]=o}else if(a[e]){var r=a[e].count||0;a[e].count=parseInt(r)+parseInt(t)}else a[e]={count:t};i&&(a[e].entity_id=i)},WmsMainUI.resetAllUnreadCount=function(){l={}},WmsMainUI.setMuteStatus=function(e,t){l[e]?l[e].mutestatus=t:l[e]={mutestatus:t}},WmsMainUI.getMuteStatus=function(e){return!(!l[e]||!l[e].mutestatus)},WmsMainUI.setZuidForPrivateChat=function(e,t){l[e]?l[e].privatechatzuid=t:l[e]={privatechatzuid:t}},WmsMainUI.getZuidForPrivateChat=function(e){if(l[e]&&l[e].privatechatzuid)return l[e].privatechatzuid}})(),WmsMainUI.updateUnreadCountInUI=function(e){for(var t=WmsMainUI.getUnreadCount(e)||"",s=WmsMainUI.getMuteStatus(e),i=[WmsMainUI.defaultchatlist,WmsMainUI.searchreschatlist,document.getElementById("wms-hysearch-rchats"),document.getElementById("wms-hysearch-searchres")],n=0;n<i.length;n++)if(i[n]){var a=i[n].querySelector('[data-id="'+e+'"]>[data-unreadcount]');if(a)if(t=99<(a.title=t)?"99+":t,$WC.$CUtil.setInnerText(a,t),a.style.display=t?"flex":"none",s)i[n].querySelector('[data-id="'+e+'"]').setAttribute("data-muted","true")}},WmsMainUI.updateUnreadChatsCount=function(){if(!_WMSEMPTYBAR&&!silent){if(WmsMainUI.updateCountDependentUI(),WebMessanger.is_custom_menu_opted)return;var e=$WC.RecentChats.getUnreadFeedsCount()+WmsMainUI.getUnreadChatsCount();e?(ChatTour.removeTourNotifier(),e=99<(WmsMainUI.unreadchatcntdiv.title=e)?"99+":e,$WC.$CUtil.setInnerText(WmsMainUI.unreadchatcntdiv,e),WmsMainUI.unreadchatcntdiv.style.display="flex"):($WC.$CUtil.setInnerText(WmsMainUI.unreadchatcntdiv,""),WmsMainUI.unreadchatcntdiv.style.display="none")}},WmsMainUI.updateCountDependentUI=function(){var e="",t=WmsMainUI.getUnreadChatsCount();t?$WC.RecentChats.getUnreadChatList("unmuted").length&&(e="unmuted"):$WC.RecentChats.getUnreadChatList("muted").length&&(e="muted");var s=WmsMainUI.defaultchatlist.querySelector('[data-heading="recentchats"]'),i=WmsMainUI.defaultchatlist.querySelector('[data-heading="unreadchats"]');if(e?($WC.Util.setAttribute(s,"data-uctype",e),$WC.Util.setAttribute(i,"data-uctype",e)):(s&&s.removeAttribute("data-uctype"),i&&i.removeAttribute("data-uctype")),!WebMessanger.is_custom_menu_opted){var n,a=WmsMainUI.menubar.querySelector('[data-menuname="chat"]'),o=!1;t?(n=$WC.I18N("unreadchats.title"),o=!0):n=$WC.I18N("menuname.chats"),$WC.Util.setAttribute(a,"title",n),$WC.Util.setAttribute(a,"data-title",n),$WC.Util.setAttribute(a,"data-uc",o)}},WmsMainUI.getUnreadCountForMenu=function(e,t){var s=0;return e.forEach(function(e){WmsMainUI.getUnreadCount(e.CHATID)&&!WmsMainUI.getMuteStatus(e.CHATID)&&-1==t.indexOf(e.CHATID)&&(s+=1)}),s},WmsMainUI.updateChatInvitationCount=function(e){var t=$WC.Config.get("customContacts"),s=t?document.getElementById("wms_menu_customcontacts_cnt"):WmsMainUI.invitationscntdiv;t||(e=$WC.Util.getObjectLength(WmsContacts.getInvitedContactsList())),s&&($WC.$CUtil.setInnerText(s,e||""),s.style.display=e?"flex":"none")},WmsMainUI.showPendingInvitations=function(){ZMSGUI.createOverlay();var e='<div class="wms_pendinginv_header">'+$WC.I18N("chat.pending.invitations")+'<span data-operation="close" class="wms_invitations_close"></span></div><div class="wms_pendinginv_container">';if(WmsContacts.getPendingInvitedContactsList().length)for(var t=0;t<WmsContacts.getPendingInvitedContactsList().length;t++){var i=WmsContacts.getPendingInvitedContactsList()[t];e+='<div data-id="'+i+'" class="wms_pendinginv_content"><input data-operation="reject" type="button" value="Reject" class="wms_pendinginv_rejctbtn"><input data-operation="accept" type="button" value="Accept" class="wms_pendinginv_acptbtn"><span class="wms_pendinginv_img wms-valign-mid-block"><img src="'+WmsContacts.getUserPhoto(i)+'"></span><div class="wms_pendinginv_name wms-truncate-ellipsis wms-valign-mid-block">'+$WC.Util.getContactName(i,"",!0)+"</div></div>"}else e+='<div class="wms_pendinginv_infocontent"><div class="wms_pendinginv_infotxt">'+$WC.I18N("chat.pendinginv.infotxt")+"</div></div>";e+="</div>";var s=WebMessanger.isDarkModeEnabled?"wms-hvalign zmNightMode":"wms-hvalign";s+=WebMessanger.isDNDBackupIconEnabled()?" wms_dnd_backup_icon":"";var n=$WC.Util.createElement("div","wms_pendinginv_container",s,null,e);n.style.zIndex=$WC.Config.get("zindex"),n.style.display="block",document.body.appendChild(n),Gator(n).on("click","[data-operation]",function(e){var t=$WC.Util.getEventTarget(e),s=t.getAttribute("data-operation");"close"===s?ZMSGUI.hidependinginv():"reject"===s?(WMSUI.rejectContact(i,i,"inv"),WmsMainUI.hidePendingInvitations(t.parentNode),$WC.Util.removeElementFromArray(WmsContacts.getPendingInvitedContactsList(),i)):"accept"===s&&(WmsContacts.accept("zoho",i,$WC.Config.get("zuid")),WmsMainUI.hidePendingInvitations(t.parentNode),$WC.Util.removeElementFromArray(WmsContacts.getPendingInvitedContactsList(),i))})},WmsMainUI.hidePendingInvitations=function(e){1===WmsContacts.getPendingInvitedContactsList().length?ZMSGUI.hidependinginv():$WC.Util.removeElement(e)},WmsMainUI.removeFromContactList=function(e){var t=WmsMainUI.defaultcontactlist.querySelector('[data-id="'+e+'"]'),s=WmsMainUI.searchrescontactlist.querySelector('[data-id="'+e+'"]');$WC.Util.removeElement(t),$WC.Util.removeElement(s)},WmsMainUI.handleProfileActions=function(e,t){var s=e.getAttribute("data-operation"),i=WmsContacts.getDisplayName(t)||WmsProfileInfo.profileinfo[t]&&WmsProfileInfo.profileinfo[t].dname;if("deletecontact"==s){var n=[$WC.I18N("chat.contact.deleteinfo",i)],a=new $WC.ConfirmationDialog,o={actions:[{text:$WC.I18N("Delete"),onclick:function(){WmsContacts.remove("zoho",t),a.unmountComponent()},buttonstyle:"destructive_button"},{text:$WC.I18N("common.cancel"),onclick:function(){a.unmountComponent()},buttonstyle:"cancel_button"}],heading:n,bodytitle:$WC.I18N("dialogue.info.header"),headerimgsrc:$WC.WmsContacts.getUserPhoto(t,"38"),content:[$WC.I18N("info.contact.delete.info1"),$WC.I18N("info.contact.delete.info2.external")]};a.mountComponent(o)}else"invite"==s&&(t?WMSUI.inviteMember(t,i):WMSUI.inviteMember(i,i));WmsProfileInfo.unmountComponent()},$WC.Util.pubsub.subscribe("/orgcontacts/listview",function(e,t){var s;if(t.stat!==$WC.WmsConstants.REQSTATUS.FAILED||t.callbackargs.silentload){if(t&&t.callbackargs){var i=t.callbackargs.params;if(s=t.callbackargs.chid,i&&WmsOrgContacts.isEmptyResultReq(i.split("=")[2])&&!t.callbackargs.silentload)Commands.hideLoadingIcon(t.callbackargs.chid);else if(s&&WindowHandler.getWinObjById(s)){t.callbackargs.silentload||Commands.hideLoadingIcon(s);var n=document.getElementById("wms-fileupldcmt")||WindowHandler.getWinObjById(s).composer;WMSUI.atMentions.init(s,n,t,WMSUI.atMentions.invisiblediv,WMSUI.atMentions.autocompletediv)}}}else s=t&&t.chid,Commands.hideLoadingIcon(s)}),$WC.Util.pubsub.subscribe("/orgcontacts/userslistview",function(e,t){(WebMessanger.userslist||WebMessanger.forkedlist).showList(t)}),function(){var t={};WmsMainUI.scheduleAutoFocus=function(e){t[e]=!0},WmsMainUI.isAutoFocusScheduled=function(e){return!!t[e]},WmsMainUI.removeAutoFocusSchedule=function(e){delete t[e]}}(),function(){var t={};WmsMainUI.scheduleAutoJoin=function(e){t[e]=!0},WmsMainUI.joinScheduledChannels=function(){for(var e in t)WebMessanger.attachSession(e),delete t[e]}}(),ie?(document.onfocusout=function(){_WMSWINFOCUS=!1},document.onfocusin=function(){_WMSWINFOCUS=!0}):(window.addEventListener("blur",function(){_WMSWINFOCUS=!1}),window.addEventListener("focus",function(){_WMSWINFOCUS=!0,$WC.Channels.getChannelsIfFocussed()&&$WC.Channels.getChannels(),WebMessanger.sync_adminsettings_onfocus&&WebMessanger.syncAdminSettings(),WebMessanger.get_pinmsg_onfocus&&WindowHandler.getPinMsgForOpenedChats(),$WC.Drafts.getFromServerIfFocussed(),$WC.Bots.getFromServerIfFocussed()})),WmsMainUI.bindRecentChatEvents=function(){Gator(WmsMainUI.menulistcontainer).off(),Gator(WmsMainUI.menulistcontainer).on("click","[data-id],[data-operation],[data-menuredirect],[data-retry],[data-heading]",function(e){var t=$WC.Util.getEventTarget(e);if(t.getAttribute("data-customoperation")&&$WC.Config.get("customContacts")&&$WC.Config.get("customContacts").invitationActions){var s=t.getAttribute("data-customoperation"),i=t.getAttribute("title"),n=$WC.Config.get("customContacts").invitationActions,a=this;n.forEach(function(e){e.label!==s&&e.label!==i||e.action(a)})}else if(this.getAttribute("data-operation"))WmsContacts.handleInviteOperation(this);else if(this.getAttribute("data-retry"))WmsOrgContacts.fetchFromServer({searchtext:"",topicname:"suggestionui"},"");else if(this.getAttribute("data-menuredirect")){var o=this.getAttribute("data-menuredirect");"channel"==o&&!WebMessanger.isOrgUser()||WmsMainUI.showMenu(o)}else if("recentchats"===this.getAttribute("data-heading")||"unreadchats"===this.getAttribute("data-heading")){if(this.getAttribute("data-uctype")){if("unreadchats"===this.getAttribute("data-heading"))var r=!0;WmsMainUI.filterUnreadChats(r,!0)}}else if("pinnedchats"===this.getAttribute("data-heading")){var l=WmsMainUI.defaultchatlist.querySelector('[data-menu="pinnedchats"]');if(6<$WC.RecentChats.getPinnedChats().length)if("true"===l.getAttribute("data-expanded"))l.lastChild.style.height="50px",l.setAttribute("data-expanded","false"),l.querySelector(".wms_menu_filter_icon").title=$WC.I18N("pinnedchats.shrinked.filtertitle");else{var d=Math.ceil($WC.RecentChats.getPinnedChats().length/6);l.lastChild.style.height=50*d+"px",l.setAttribute("data-expanded","true"),l.querySelector(".wms_menu_filter_icon").title=$WC.I18N("pinnedchats.expanded.filtertitle")}}else if("suggestions"!==this.getAttribute("data-heading")){var c=$WC.Util.getEventTarget(e);if(c.getAttribute("data-zcprofileid")&&!this.getAttribute("data-pc")&&!c.closest('[class~="wms_menu_item_msg"]'))return;WmsHybridSearch.handleSelection(this),$WC.Util.removeElement(this.querySelector("[data-unreadcnt]"))}WmsProfileInfo.unmountComponent()})},WmsMainUI.updateStatusInCustomContactMenu=function(e,t){var s=$WC.HybridSearch.getNode("defaultresultdiv",$WC.WmsConstants.HYBRIDSEARCH.modules.CUSTOMCONTACTMENU).querySelector('[data-id="'+e+'"]');$WC.$CUtil.setInnerText(s.querySelector("[data-smsg]"),t)},WmsMainUI.removeListComponent=function(){var e=WindowHandler.openedChats;for(var t in e){var s=WindowHandler.getWinObjById(t);s&&s.participantsdialog&&s.participantsdialog.unmountComponent()}},WmsMainUI.setLinkPreviewSettings=function(){function s(){t.removeChild(t.childNodes[0]),t.innerHTML=e,t.querySelector("#zoholinkspermission").value=$WC.Config.get("zoholinks_auth")}var e='<div class="wms_urlconsent_parent"><select class="wms_settings_select" id="zoholinkspermission" data-select="zoholinkspermission" ><option  id="wms_settings_allowlinks" value="1" data-value="1"  name="zoholinks" data-setting="allow_links">'+$WC.I18N("urlconsent.always")+'</option><option id="wms_settings_askeverytime"  name="zoholinks" data-setting="ask_askeverytime" value="0" data-value="0">'+$WC.I18N("urlconsent.askeverytime")+'</options><option id="wms_settings_restrictlinks" value="-1" data-value="-1" name="zoholinks" data-setting="restrict_links" class="wms_settings_label" >'+$WC.I18N("urlconsent.restrict")+'</option> </select><span class="wms_settings_openicon"></span></div>',t=WmsMainUI.settingscontainer.querySelector("#wms_zoholinks_settings");if(isNaN($WC.Config.get("zoholinks_auth"))){$WC.Ajax.requestToChat("getlinkpreviewsettings.do",null,function(e){var t=e.authentication_consent||0;$WC.Config.set({zoholinks_auth:t}),s()})}else s()},WmsMainUI.showStarredMessages=function(){WmsMainUI.StarMessageListInstance=new $WC.MessageList;WmsMainUI.StarMessageListInstance.mountComponent({type:"starredmsg",constructMessageFragment:Message.constructMessageFragment,getMessageType:Message.getMessageType,getDeletedMsgInfo:Message.getDeletedMsgInfo,getThumbnailImageUrl:Message.getThumbnailImageUrl,loadOriginalImages:WMSUI.loadImages,closeCallBack:function(){WmsMainUI.StarMessageListInstance=null},constructChatContent:Message.constructChatContent,glowBubble:Message.glowBubble,attachSession:WMSUI.attachSession,addEventListenersForTranscript:Message.addEventListenersForTranscript,showMessageFragmentInView:Message.showMessageFragmentInView})},WmsMainUI.updateStarMsgList=function(e,t){WmsMainUI.StarMessageListInstance&&WmsMainUI.StarMessageListInstance.updateListItem(e,t)},WmsMainUI.checkAndToggleDNDMode=function(){WmsMainUI.maincontainer&&("5"===WebMessanger.scode?$WC.Util.setAttribute(WmsMainUI.maincontainer,"data-dnd-enabled","true"):WmsMainUI.maincontainer.removeAttribute("data-dnd-enabled"))};var myMsgObj={};function WMSUI(){}myMsgObj.sender="",WMSUI.triggers=["@",":","+","-","/"],WMSUI.curtrigger="",WMSUI.hidegsicon=!1,WMSUI.errormsgtimer=null,WMSUI.loadedimg={},WMSUI.eventreminderinstance={},WMSUI.notebook_widget_disabled=!1,WMSUI.isLoadedImg=function(e){return!0===WMSUI.loadedimg[e]},WMSUI.staroption_instancestore={},WMSUI.chatUsersObj={},WMSUI.avCall={CALL_TYPE_VOICE:"voice",CALL_TYPE_VIDEO:"video",CALL_TYPE_SCREENSHARE:"screen",notification_close_timer:3e4},WMSUI.loadImages=function(e){for(var t=e.getBoundingClientRect().top,s=e.querySelectorAll("img[originalsrc]"),i=0;i<s.length;i++){var n=s[i],a=n.parentNode.getBoundingClientRect().top,o=a+n.parentNode.offsetHeight;(t<a||t<o)&&WMSUI.loadOriginalImgSrc(n)}},WMSUI.loadOriginalImgSrc=function(e){var t=e.getAttribute("originalsrc");e.removeAttribute("originalsrc"),null!==e.nextSibling&&$WC.Util.removeElement(e.nextSibling);var s=e.cloneNode();s.removeAttribute("src"),s.src=t,s.className="",e.parentNode.insertBefore(s,e.nextSibling),s.onload=function(){this.style.display="",$WC.Util.removeElement(e),WMSUI.loadedimg[t]=!0},s.onerror=function(){e.setAttribute("originalsrc",t),this.style.display="none"}},WMSUI.handleMessageFailure=function(e,t){var s=e.querySelector('[data-msgid="'+t+'"]');s.setAttribute("data-msgfailure","true"),s.nextSibling&&s.nextSibling.getAttribute("data-timefrag")&&(s.nextSibling.innerText=$WC.I18N("message.status.failed"))},WMSUI.getStype=function(e){if(e)return parseInt(e)},WMSUI.generateUI=function(){var e='<span id="wms_cw_videoinfo" class="wms_cw_videoinfo" data-videoinfo=true ><div id="wms_videoinfo_dropdown" class="wms_videoinfo_dropdown" data-videodropdown=true><div class="wms_cw_toolbar_actionitem" data-audioicon=true  style="display: none;">'+$WC.I18N("chat.audio.call")+'</div><div class="wms_cw_toolbar_actionitem" data-videoicon=true  style="display: none;">'+$WC.I18N("chat.video.call")+'</div><div class="wms_cw_toolbar_actionitem" data-shareicon=true  style="display: none;">'+$WC.I18N("chat.screen.share")+'</div></div></span><span class="wms_cw_threadmsglink" data-threadmsglink="true" title="'+$WC.I18N("thread.msglink")+'"></span><span class="wms_cw_threadslist" data-threadslist="true" title="'+$WC.I18N("threads.all")+'"></span><span class="wms_cw_minimizeicon" data-minimizeicon="true" title="'+$WC.I18N("chat.minimize")+'"></span><span class="wms_cw_enlargeicon" data-enlargeicon="true" title="'+$WC.I18N("chat.enlarge")+'"></span><span class="wms_cw_closeicon" data-closeicon="true" title="'+$WC.I18N("Close")+'"></span>',t='<div id="{{chid}}" class="wms_cw_cont wms_chatwindow wms_bubbletheme"><div data-main=true class="wms_cw" >'+('<div class="wms_cw_header" data-header="true"><div class="wms_cw_header_avatar" data-avatar="true"></div><div class="wms_cw_header_main wms-truncate-ellipsis" data-titlecontainer="true"  data-main="true"><div><div data-title="true" class="wms_cw_header_name"></div><span data-edittitleicon="true" class="wms_cw_settitle"></span><span data-channelrestricted=false class="wms_cw_channellock" title="'+$WC.I18N("channel.inviteonly")+'"></span></span></div><div class="wms_cw_statusmsg" data-statusmsg="true" title="Offline">Offline</div></div><div class="wms_cw_header_actions" data-actions="true">'+e+"</div></div>")+'<div class="wms_mediacall_space" data-videospace=true media-action="maximize"><span class="wms_callstatus_text wms-halign"></span><div class="wms_mediacall_container"><div class="wms_outgoing_call_text wms-halign"></div><div class="wms_screenshare_container"><video class="wms_sharedscreen" media-action="switchvideo"></video></div><div class="wms_remotevideo_container"><video class="wms_remotestream" media-action="switchvideo"></video><div class="wms_remoteuserimg wms-hvalign"><img></img></div><div class="wms_mediaoff_notify"></div></div><div class="wms_localvideo_container" media-action="switchvideo" title="'+$WC.I18N("mediacall.switchvideo")+'"><video class="wms_localstream" autoplay="autoplay"></video><div class="wms_localuserimg"><img></img></div></div></div><div class="wms_videocall_button wms_options_button" media-action="options" title="'+$WC.I18N("mediacall.options")+'"><div class="wms_options_container"></div></div><div class="wms_videocall_button wms_minimize_button" media-action="minimize" title="'+$WC.I18N("minimize")+'"></div><div class="wms_videocall_button wms_fullscreen_button" media-action="togglefullscreen" title="'+$WC.I18N("mediacall.fullscreen")+'"></div><div class="wms_mediacall_timer"></div><div class="wms_videocall_buttons_list"><div class="wms_videocall_button wms_togglemic_button" media-action="togglemic" title="'+$WC.I18N("mediacall.mic.off")+'"></div><div class="wms_videocall_button wms_endcall_button" media-action="endcall" title="'+$WC.I18N("mediacall.end")+'"></div><div class="wms_videocall_button wms_togglevideo_button" media-action="togglecam" title="'+$WC.I18N("mediacall.cam.off")+'"></div></div></div><div data-ctrlcomp="true" class="wms_cw_main_parent"><div class="wms_cw_main" id="ctrlcomp" data-msgdisp="true"></div></div><div data-floating_containers="true" class="wms_cw_floating_containers"><div data-errormsg=true class="wms_cw_errormsg wms-halign"></div><div data-pinmsg=true class="wms_pinmsg_column" data-show-options="true"><div class="wms_pinmsg_icon"></div><div class="wms_pinmsg_content"></div><div class="wms_pinmsg_options" data-pinmsg-options="false"><div id="wms_pinmsg_dropdown" class="wms_pinmsg_dropdown" data-pindropdown="false"><div class="wms_cw_toolbar_actionitem" data-msg-unpin="true">'+$WC.I18N("pinmsg.unpin")+'</div><div class="wms_cw_toolbar_actionitem" data-pinoption-duration="true">'+$WC.I18N("pinmsg.timeleft",[$WC.I18N("chat.forever")])+'</div></div></div></div><div data-progressbar=true class="wms-loadingmn"><div class="wms_cw_progressbar_basic" data-progressbar-basic=false></div><div class="wms_cw_progressbar_advanced"><div class="wms_cw_progressholder" data-progressholder="true"><div class="wms-loading-sub" data-progressindicator="true"></div></div><div class="wms_fileuploaddetails" data-purpose="filecontainer"><div class="wms_fileuploadcnt"><span id="wmsloadingtxt" class="wms-loading-text" data-progresstext="true">'+$WC.I18N("Sharing_$1_of_$2")+'</span><span class="wms_file_errorinfo"></span><span class="wms_file_failurecount" id="wms_failcountbar"></span></div><div class="wms_fileuploadopts"><span id="retryall" data-purpose="retryall" class="wms_fileupld_resend"></span><span id="wms_fileexpandicon" data-purpose="expand" class="wms_fileupld_expand"></span><span data-purpose="uploadcancel" class="wms_fileupld_close"></span></div></div></div><div id="wms_expandfilescontainer" class="wms_filescontainer"></div></div><div data-newmsgbanner="false" class="wms_unread_banner wms-halign"><span class="wms_unread_banner_text">'+$WC.I18N("chat.newmessages")+'</span></div><div data-threadbanner="false" class="wms_unread_thread_banner wms-halign"><span class="wms_unread_banner_text">'+$WC.I18N("thread.msg.banner")+'</span><span class="wms_unread_thread_count"></span></div><div data-datecomp="true" class="wms_datehint wms-halign"></div></div><div data-dragcomp="true" class="wms_cw_drag" style="display:none"><span>'+$WC.I18N("chat.file.drop")+'</span></div><div class="wms_cw_toolbar" data-toolbar=true><span class="wms_cw_typingstatus wms-truncate-ellipsis" data-typingstatusnode=true data-typingstatus=false></span><button class="wms_cw_toolbar_actionbutton" data-action=true >'+$WC.I18N("Actions")+'</button><div data-scrolldown="true" class="wms_scrolldown_button" title="'+$WC.I18N("chat.scroll.bottom")+'"></div><div class="wms_cw_toolbar_actionlist" data-actionlist=true></div></div><div class="wms-smileycontainer" data-smileycontainer=true></div><div class="wms-urlpreviewcontainer" data-urlpreviewcontainer=true></div><div class="wms_cw_footer" data-footer=true><div class="wms_editorreply" data-editorreply=true></div><div id="wms-autocomplete" class="wms-autocomplete" data-autocomplete=true style="display:none"></div><div data-footercont=true class="wms_cw_footer_cont"><div class="wms_composer_restriction_info"><span class="wms_composer_restriction_text" data-restriction-text=true></span></div><div data-attachment=true class="wms_cw_footer_att">';return t+='<form type="html5" name="uploads{{chid}}" enctype="multipart/form-data" class="wms_cw_actualfile" chid="{{chid}}" id="formsend" title="'+$WC.I18N("share.file")+'"><input name="file1" id="wms-file" type="file" multiple size="30"/></form>',t+='</div><div id="wms-wrapperdiv" class="wms-wrapperdiv"><div id="wms-editorscrolldiv" class="wms-invisiblediv wms_cw_footer_editor"></div><div id="wms-invisiblediv" class="wms-invisiblediv wms_cw_footer_editor" data-invisiblediv=true></div><textarea  class="wms_cw_footer_editor" data-composer=true chid={{chid}} ></textarea></div><div id="wms-smileyinvoker" class="wms-smileyinvoker wms-valign-mid-block"></div><div id="wms-voicemsginvoker" class="wms-voicemsginvoker wms-valign-mid-block" data-voicemsg="true"></div></div>',t+='<div class="wms_cw_footer_cont wms_cw_msgopr" data-msgoperation="true"><div data-fwdclose="true" class="wms_msgopr_close"></div><div class="wms-valign-mid-block wms_fwdmsg"><span data-msgselectcnt="true">'+$WC.I18N("msg.select.fwdcnt",[1])+'</span></div><div data-fwdmsg="true" class="wms_msgforward wms-valign-mid-block"></div></div></div>',t+='<div class="wms-resendoverlay" data-resendoverlay="true"><div class="wms-resendmsgoptsdiv wms-hvalign"><div data-operation="wms-resend" class="wms-resendmsgopts"><span>'+$WC.I18N("chat.msg.resend")+'</span></div><div data-operation="wms-resendall" class="wms-resendmsgopts"><span></span></div><div data-operation="wms-resenddel" class="wms-resendmsgopts"><span>'+$WC.I18N("Delete")+'</span></div><span data-operation="wms-resendcancel" class="wms_cw_overlay_close"></span></div></div></div><div class="wms_cw_bar " data-bar="true"><div class="wms_cw_bar_photo" data-baravatar=true /></div><span class="wms_cw_bar_msgcount" data-barmsgcount=true></span><span class="wms_cw_bar_typing_indicator wms_cw_bar_typing_online" data-typingsymbol="true"></span><span class="wms_cw_bar_name wms-truncate-ellipsis" data-bartitle=true>{{title}}</span><span class="wms_minimized_close wms_cw_opr_close" data-barclose="true"></span></div></div>'},WMSUI.handleSync=function(e){e.parentNode.querySelector('[id="wms-invisiblediv"]').scrollTop=e.scrollTop},WMSUI.isBarVisible=function(){return"block"==getComputedStyle(WmsMainUI.maincontainer).display},WMSUI.handleKeyMovement=function(e,t,s){var i=e.getElementsByClassName(s),n=null;40===t?n=i[0].nextSibling||e.firstChild:38===t&&(n=i[0].previousSibling||e.lastChild),i[0]&&$WC.Util.removeClass(i[0],s),$WC.Util.addClass(n,s)},WMSUI.createNewChatWindow=function(n){function a(){var t;return($WC.Util.isArray(n.users)?n.users:JSON.parse(n.users)).forEach(function(e){e.zuid!==WebMessanger.zuid&&(t=e.zuid)}),t}function e(e,t){if(t<=2){if("string"==typeof e)return(e=e.split(","))[0]===WebMessanger.zuid?e[1]:e[0];if(e&&e[0]&&e[0].uname)return e[0].uname;if(n.sender!==WebMessanger.zuid||!n.t121t)return n.sender!==WebMessanger.zuid?n.sender:a();var s=JSON.parse(n.t121t);for(var i in s)if(i!==$WC.Config.get("zuid"))return i}else if(2<t&&"string"==typeof e)return-1!=(e=e.split(",")).indexOf(WebMessanger.zuid)&&e.splice(e.indexOf(WebMessanger.zuid),1),e}!n.sender&&n.users&&n.users.length&&(n.sender=n.users[0].uname||a(n.users));var t,s,i,o=(n.sender,t=n.pcount,s=n.title,i=n.chid,$WC.Util.isChannelChid(i)?$WC.Channels.getChannelName(i)||s:$WC.Util.isBotChid(i)?$WC.Bots.getBotName($WC.Bots.getBotId(i))||s:s||(2===t?function(e){if(e.temp_info&&e.t121t){var t=WebMessanger.getSenderFromMsgobj(e);return WmsContacts.getDisplayName(t)||senderobj[t]}return WmsContacts.getDisplayName(e.sender)||e.dname}(n):2<t?$WC.I18N("Group_Chat"):void 0)),r=n.chid,l=n.pcount,d=n.sender,c=n.recipants?e(n.recipants,l):e(n.users,l),m="open";if(11==n.ctype)if(n.addinfo){var u=n.addinfo.split(":"),p=u.indexOf("PARENT_MESSAGE_SENDER");c=u[p+1],m=-1!==u.indexOf("THREAD_CLOSED")?"closed":"open"}else c=n.recipants;var h,g,f,C=(h=d,l<=2?WmsContacts.status(h):""),v=(g=d,l<=2?WmsContacts.getStatusType(g):""),b=(f=d,l<=2?WmsContacts.getStatusMsg(f):""),y=n.ctype,_=n.salesiqchat||!1,W=$WC.WmsSessionStorage.getChatInfo(r,"state");W=null===W?"min":W,(WmsMainUI.isAutoFocusScheduled(n.chid)||2==l&&WmsMainUI.isAutoFocusScheduled(c)||_&&n.usertriggered||11==y)&&(W="max");var S=$WC.WmsSessionStorage.getChatInfo(r,"text"),w="1"===n.a,M=n.prd,I=n.addinfo,T=n.context?JSON.parse(n.context).weburl||JSON.parse(n.context).openurl:"",A=n.entityid,E={addinfo:I,recipant:c,divId:r,title:o,scode:C,stype:v,smsg:b,ctype:y,winstate:W,composertext:S,historystorage:n.history,entityweburl:T,entityid:A,lastmsgtime:+n.time,attached:w,pcount:l,prdcode:M,mutedinterval:n.mutedinterval,salesiqchat:_,stickymessage:n.stickymessage,customgroup:n.customgroup,thread_msgid:n.thread_msgid,thread_parentid:n.thread_parentid,thread_follower:n.thread_follower,thread_state:n.thread_state||m};Factory.createDialog(WMSUI.generateUI(),E)},WMSUI.rejectContact=function(e,t){try{WmsContacts.reject("zoho",t,WebMessanger.uname)}catch(e){}},WMSUI.setServiceStatus=function(e){!1===WebMessanger.isServiceStatus()&&(WmsMainUI.servicestatusdiv.innerHTML=e)},WMSUI.populateMainBar=function(){void 0!==WMSUI.smartchatenabled||WebMessanger.is_custom_menu_opted||(WMSUI.smartchatenabled=!0),WebMessanger.registerAnnonUser||(wmsnotifyowner=new $WC.NotificationOwner("chat",!0)),"CP"==WebMessanger.prd&&WebMessanger.listenLinkClicks(),WmsMainUI.populate(),WebMessanger.is_custom_menu_opted||(document.getElementById("wmsbarmovablehint").onclick=WmsHybridSearch.toggleUI)},WMSUI.populate=function(){var e=document.createDocumentFragment(),t=$WC.Util.createElement("DIV","annmsgstrip","zread_strip");t.onclick=function(){WMSUI.annShowAnimate("wmsannmsg")};var s=$WC.Util.createElement("DIV","wmsannmsg","zread_olymn",null,'<span id="annmsg"></span><div id="hideinfo" class="zchdr_arw"></div><a id="clearannmsg" style="text-decoration:underline; float:right; font-size: 11px; margin: 2px 25px 0px 0px">Do not show again</a>');s.style.display="none",s.onclick=function(e){var t=$WC.Util.getEventTarget(e);t&&"A"!==t.tagName?WMSUI.hideAnnMsg(e):"function"==typeof e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},s.style.zIndex=WebMessanger.setzindex,t.style.zIndex=WebMessanger.setzindex,t.appendChild(s),e.appendChild(t),document.body.appendChild(e),$WC.Util.addEvent(document.getElementById("hideinfo"),"click",WMSUI.hideAnnMsg),$WC.Util.addEvent(document.getElementById("clearannmsg"),"click",WMSUI.clearBannerAndUpdate)},WMSUI.updateResourceInAnnouncementBanner=function(){var e=document.getElementById("clearannmsg");$WC.$CUtil.setInnerText(e,$WC.I18N("announcement.close"))},WMSUI.clearBannerAndUpdate=function(){WMSUI.clearAnnBanner(),WmsSettings.updateWmsSettings("bchatsettings","disann");var e=document.location.hostname.split("."),t=e[e.length-2]+"."+e[e.length-1];$WC.Cookie.set(wmsUserConfig.infomsgid,"true",2592e6,t)},WMSUI.clearAnnBanner=function(){var e=document.getElementById("annmsgstrip");e&&(e.style.display="none")},WMSUI.addIndocClickcallbackQue=function(e,t,s,i){ie&&(WMSUI.handleDocumentClick(i),WMSKeyHandler.skipeventlistener=!0);var n={};n.htmlObj=t,n.cbfunction=s,WMSUI.docClickcallbackQue[e]=n},WMSUI.handleDocumentClick=function(e){try{var t=WMSUI.getEventSrc(e),s=WMSUI.docClickcallbackQue;for(var i in s){s[i].cbfunction(t.id)||delete WMSUI.docClickcallbackQue[i]}}catch(e){}},WMSUI.deleteParticipant=function(e,t,s,i,n){if(!WMSUI.showErrorIfPermDenied(e)){var a=[$WC.I18N("info.chat.participant.remove",s),s],o=new $WC.ConfirmationDialog,r={actions:[{text:$WC.I18N("chat.member.remove"),onclick:function(){WebMessanger.deleteMember(e,t,n),i(),o.unmountComponent()},buttonstyle:"destructive_button"},{text:$WC.I18N("common.cancel"),onclick:function(){o.unmountComponent()},buttonstyle:"cancel_button"}],heading:a,bodytitle:$WC.I18N("dialogue.info.header"),headerimgsrc:$WC.WmsContacts.getUserPhoto(t,"38"),content:[$WC.I18N("info.participant.remove.info1"),$WC.I18N("info.participant.remove.info2"),$WC.I18N("info.participant.remove.info3")]};o.mountComponent(r)}},WMSUI.leaveChat=function(e,t){if(!WMSUI.showErrorIfPermDenied(e)){var s=[$WC.I18N("chat.leave.subheader")],i=new $WC.ConfirmationDialog,n={actions:[{text:$WC.I18N("chat.action.leave"),onclick:function(){WebMessanger.leaveChat(e),i.unmountComponent()},buttonstyle:"destructive_button"},{text:$WC.I18N("chat.action.mute"),onclick:function(){WebMessanger.muteChat(e,"-1",!0),i.unmountComponent()},buttonstyle:"cancel_button"}],heading:s,bodytitle:$WC.I18N("dialogue.info.header"),customimg:"wms_customimg_leavechat",customheadercontent:[$WC.I18N("chat.leave.chattitle",t),t],content:[$WC.I18N("chat.leave.info1"),$WC.I18N("chat.leave.info2")],customStyles:{customButtonWrapperStyle:"wms_buttonwrapper",containerWrapperStyle:"wms_confirmation_dialog",customFooterStyle:"wms_dialog_footer"}};i.mountComponent(n)}},WMSUI.makeMediaCall=function(e,t,s){if(WebMessanger.isMediaCallEnabled(e)&&WmsSettings.getAdminSetting("isMediacallAllowed")){if($WC.Util.isEmpty(t))return;if($WC.VoiceRecorderApi.isVoiceRecordingActive())return void WMSUI.showMediaSessionErrorDialog({content:$WC.I18N("voicerecorder.endrecording")},function(){$WC.VoiceRecorderApi.closeAndRemoveRecordingSession(),WMSUI.makeMediaCall(e,t,s)}.bind(this));"voice"===e?MediacallManager.startCall(MediaCallConstants.types.AUDIO,t):"video"===e?MediacallManager.startCall(MediaCallConstants.types.VIDEO,t):"screen"===e&&MediacallManager.startCall(MediaCallConstants.types.SCREEN_SHARE_WITH_AUDIO,t)}},WMSUI.regenerateStatus=function(){WebMessanger.getAllStatusMessage()},WMSUI.clearCustomStatus=function(){WmsMainUI.statuscontainer.style.display="none",WebMessanger.clearCustomStatus(),WebMessanger.scode="1",WebMessanger.smsg="Available",$WC.Util.removeClass(WmsMainUI.settingsdropdownicon,"wms_settings_close"),$WC.Util.addClass(WmsMainUI.settingsdropdownicon,"wms_settings"),WmsMainUI.settingsdropdownicon.setAttribute("data-settings","true")},WMSUI.updateStatus=function(e,t){WebMessanger.scode=e,WebMessanger.smsg=t,WebMessanger.registerAnnonUser||setTimeout(function(){WMSUI.regenerateStatus()},500)},WMSUI.initI18NUserStatus=function(){WMSUI.i18Nuserstatus={Available:$WC.I18N("Available"),Invisible:$WC.I18N("Invisible"),Busy:$WC.I18N("Busy"),Away:$WC.I18N("userstatus.away"),DoNotDisturb:$WC.I18N("userstatus.dnd"),Idle:$WC.I18N("Idle")}},WMSUI.geti18NUserStatus=function(e,t){var s={};return t=t.trim(),null==WMSUI.i18Nuserstatus&&WMSUI.initI18NUserStatus(),t==WMSUI.i18Nuserstatus.Available||0==t.length?(t="Available",e=1):t==WMSUI.i18Nuserstatus.Busy?(t="Busy",e=3):t==WMSUI.i18Nuserstatus.Away?(t="Away",e=7):t==WMSUI.i18Nuserstatus.Idle?(t="Idle",e=4):t==WMSUI.i18Nuserstatus.Invisible?(t="Invisible",e=2):t==WMSUI.i18Nuserstatus.DoNotDisturb&&(t=WMSUI.i18Nuserstatus.DoNotDisturb,e=5),s.scode=e,s.smsg=t,s},WMSUI.setStatus=function(e,t,s){try{t=WMSUI.geti18NUserStatus(e,t).smsg,s&&(t=unescape(t),t=$WC.Util.unescapeHTML(t)),WebMessanger.smsg==t&&WebMessanger.scode==e||(WebMessanger.scode=e,WebMessanger.smsg=t,WmsMainUI.statuscontainer.style.display="none",WmsMainUI.statuscontainer.setAttribute("data-showstatus","false"),WebMessanger.setStatus(e,t)),$WC.Util.removeClass(WmsMainUI.settingsdropdownicon,"wms_settings_close"),$WC.Util.addClass(WmsMainUI.settingsdropdownicon,"wms_settings"),WmsMainUI.settingsdropdownicon.setAttribute("data-settings","true")}catch(e){}return!1},WMSUI.inviteMember=function(e,t){var s=$WC.Config.get("inviteaction");if("function"==typeof s)WmsImplHandler.invoke(s,e);else{var i=new $WC.ConfirmationDialog,n={actions:[{text:$WC.I18N("chat.contact.add"),onclick:function(){WmsContacts.add("zoho",e,WebMessanger.uname),i.unmountComponent()},buttonstyle:"confirmation_button"},{text:$WC.I18N("common.cancel"),onclick:function(){i.unmountComponent()},buttonstyle:"cancel_button"}],heading:t?[$WC.I18N("chat.contact.addinfo",t),t]:[$WC.I18N("chat.contact.inviteinfo")]};t&&e!==t&&(n.headerimgsrc=$WC.WmsContacts.getUserPhoto(e,"38")),i.mountComponent(n)}},WMSUI.getEventSrc=function(e){var t;return(e=e||window.event).target?t=e.target:e.srcElement&&(t=e.srcElement),3==t.nodeType&&(t=t.parentNode),t},WMSUI.handleStatusChange=function(e,t){t=t||window.event;var s=window.event?t.keyCode:t.which;if(13==s){mz&&t.preventDefault(),ie&&(t.cancelBubble=!0,t.returnValue=!1);var i=e.trim();WebMessanger.smsg!=i&&WMSUI.setStatus(WebMessanger.scode,i,!1)}else 27==s&&(mz&&t.preventDefault(),ie&&(t.cancelBubble=!0,t.returnValue=!1))},WMSUI.populateCustomStatus=function(e){if(null!=e){var t=e.length;if(!(t<=0)){function s(e,t,s){s="Available"===s||"Busy"===s||"Invisible"===s?WMSUI.i18Nuserstatus[s]:s;var i='<span data-staticon class="wms_cstatusicon wms-valign-mid-block wms-statusicon-'+(1==t?"available":3==t?"busy":7==t?"away":"offline")+'"></span><span data-statmsg class="wms-stat wms-truncate-ellipsis" title="'+$WC.Util.escapeHTML(s)+'"></span>',n=$WC.Util.createElement("p",null,"wms-stp",{"data-smsg":s},i);$WC.Util.addEvent(n,"click",function(){WMSUI.setStatus(t,this.getAttribute("data-smsg"))}),e.appendChild(n),$WC.$CUtil.setInnerText(n.querySelector("[data-statmsg]"),s)}for(var i=document.createDocumentFragment(),n=document.createDocumentFragment(),a=document.createDocumentFragment(),o=document.createDocumentFragment(),r=0;r<t;r++){var l=$WC.Util.unescapeHTML(e[r].ENC_STATUSMSG||e[r].STATUSMSG);null!=WMSUI.i18Nuserstatus&&null!=WMSUI.i18Nuserstatus||WMSUI.initI18NUserStatus(),1==e[r].SYSTEM&&"Available"!=l||s(i,1,l),1==e[r].SYSTEM&&"Busy"!=l||s(n,3,l),1==e[r].SYSTEM&&"Away"!=l||s(a,7,l),1==e[r].SYSTEM&&"Invisible"==l&&s(o,2,l)}var d=$WC.Util.createElement("p",null,null,null,'<p class="wms-stp" ><img src="https://img.zohocdn.com/ichat/images/a29a4f41_spacer.gif"/><span class="wms-stat">'+$WC.I18N("Clear_status_message")+"</span></p>");d.onclick=WMSUI.clearCustomStatus;var c=WmsMainUI.statuscontainer;c.innerHTML="",c.appendChild(i),c.appendChild(a),c.appendChild(n),c.appendChild(o),c.appendChild(d)}}},WMSUI.updateInvitations=function(e){for(var t=0;t<e.length;t++){var s=e[t],i=WmsContacts.get(s);if(null!=i){var n={};n.zuid=i.USERID,n.dname=i.DNAME,n.uname=i.USERID,n.email=i.EMAILID,WmsHybridSearch.showInvite(n)}}};var wmsCountDownTimer,naKeyCodes=new Array("33","34","36","37","39","45","144","145","16","17","18","91");WMSUI.handleStatus=function(e,t,s,n){var a=WindowHandler.getWinObjById(s);if(a.salesiqchat)return!0;if(27!==e.keyCode&&$WC.WmsSessionStorage.setChatInfo({chid:s,text:t.value}),27!=e.keyCode&&37!=e.keyCode&&39!=e.keyCode&&38!=e.keyCode&&40!=e.keyCode&&13!=e.keyCode){var o=t.selectionStart,r=t.value,l=a.invisiblediv,d=a.autocompletediv;""==r?(l.innerHTML="",t.removeAttribute("data-command"),d.style.display="none",a.footernode.style.borderRadius="5px",a.showVoiceMsgInvoker()):a.hideVoiceMsgInvoker(),r=r.substring(0,o);var c=l.innerHTML,m=Message.getMsgCategory(c),u="command"===m?Commands.getAllowedTriggers(t):Message.getCurtriggers(m),p=WindowHandler.getWinObjById(s);if(WMSUI.curtrigger=WMSUI.getCurtriggers(r,u),56<p.composer.scrollHeight&&p.changeFooterHeight(),"-"===WMSUI.curtrigger&&-1!=r.indexOf("/"))return Commands.show(s,!0),!0;if(!WebMessanger.isGuestUser()&&(WMSUI.curtrigger===$WC.WmsConstants.TRIGGERS.ATMENTION&&"5"!==p.ctype||WMSUI.curtrigger===$WC.WmsConstants.TRIGGERS.ADDMEM&&("10"!==p.ctype||"10"==p.ctype&&p.allowAddMemberForEntityChat())&&("1"!==p.ctype||2!=p.partcount)))WMSUI.atMentions.init(s,t);else if(WMSUI.curtrigger===$WC.WmsConstants.TRIGGERS.SMILEY)WMSUI.autoComplete.init(s,t);else{if(!WebMessanger.isGuestUser()&&!0!==p.salesiqchat&&WMSUI.curtrigger===$WC.WmsConstants.TRIGGERS.SLASH&&r.startsWith($WC.WmsConstants.TRIGGERS.SLASH))return Commands.show(s),!0;"input"===e.type&&"deleteContentBackward"===e.inputType&&(clearTimeout(this.timeout),this.timeout=setTimeout(function(){p.hideUrlPreview()},500))}if("11"==p.ctype&&(""===r?p.closeReplyPreview():"block"!==p.editorreplydiv.style.display&&p.showReplyPreview(null,null,!0)),p.checkAndDeleteDraft(),(-1<t.value.indexOf("https://")||-1<t.value.indexOf("http://"))&&(p.mainwin.querySelector("[data-editmsg]")||p.showUrlPreview()),112<=e.keyCode&&e.keyCode<=123)return!0;for(i=0;i<naKeyCodes.length;i++)if(e.keyCode==naKeyCodes[i])return!0;void 0!==n||null!=t.getAttribute("data-command")||$WC.Util.isChannelChid(s)&&(!$WC.Channels.get(s)||$WC.Channels.get(s).is_default)||Self.status.active(s)}},WMSUI.getCurtriggers=function(e,t){for(var s=0,i=null,n=0;n<t.length;n++){var a=e.lastIndexOf(" "+t[n])+1;0==a&&(a=e.lastIndexOf("\n"+t[n])+1),0===a&&0!==e.indexOf(t[n])&&(a=-1),-1!==a&&s<=a&&(s=a,i=t[n])}return i||WMSUI.curtrigger},WMSUI.showErrorIfPermDenied=function(e){var t=WindowHandler.getWinObjById(e);return!(!t||!t.permdenied)&&(alert($WC.I18N("Permission_Denied_You_are_no_longer_member_of_this_chat")),!0)},WMSUI.handleEvent=function(d,c,m){var e=WindowHandler.getWinObjById(m);if(e.salesiqchat)return!0;var t=!(!e.editorreplydiv||"true"!==e.editorreplydiv.getAttribute("data-editmsg"));try{try{if(13==d.keyCode&&d.shiftKey)return!0}catch(e){}if(112<=d.keyCode&&d.keyCode<=123)return!0;if(27==d.keyCode)try{return ChatBlink.stopRepeat(),WMSUI.handleChatWindowEscape(d,m)||(WindowHandler.closeWinById(m),WMSKeyHandler.cancelEvent(d)),!1}catch(e){}if(9==d.keyCode&&!d.ctrlKey&&!d.shiftKey)return WindowHandler.moveFocus(m),!1;if(9==d.keyCode&&d.shiftKey)return WindowHandler.moveFocus(m,!0),!1;var s=document.getElementById(m);if(86==d.keyCode&&(d.ctrlKey||d.metaKey)&&"5"!=e.ctype&&"true"!==e.editorreplydiv.getAttribute("data-editmsg")&&-1!=navigator.userAgent.indexOf("Firefox")){var u=d.target,p=u.value.substring(0,u.selectionStart),h=u.value.substring(u.selectionEnd),g=document.getElementById("wms-pasteCapture");g.focus(),g.innerHTML="",setTimeout(function(){var e;if(g.childNodes[0]&&"IMG"==g.childNodes[0].nodeName){var t=g.childNodes[0].getAttribute("src");if(t.match(/^data:image/)){var s=atob(t.split(",")[1]),i=t.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(s.length),a=new Uint8Array(n);for(e=0;e<s.length;e++)a[e]=s.charCodeAt(e);var o=new Blob([a],{type:i});o.name=i.replace("/","."),WmsFileUploadUI.handlePreview(u.getAttribute("chid"),[o]),document.getElementById("wms-fileupldcmt").focus()}}else if(g.childNodes){var r=g.querySelectorAll("br");for(e=0;e<r.length;e++)r[e].parentNode.replaceChild(document.createTextNode("\n"),r[e]);var l=g.querySelectorAll("A");for(e=0;e<l.length;e++)l[e].parentNode.replaceChild(document.createTextNode(l[e].href),l[e]);p+=$WC.Util.getInnerText(g),u.value=p+h,$WC.Util.moveCaretPosition(u,p.length,p.length),WMSUI.handleStatus(d,c,m)}},10),d.stopPropagation()}var i=e.autocompletediv,n=e.invisiblediv,a=e.atmentions;if(""==Message.trim(c.value)&&(n.innerHTML="",WMSUI.curtrigger=""),38==d.keyCode&&""==Message.trim(c.value)&&!WebMessanger.isGuestUser()){for(var o=e.msgdisp.querySelectorAll(".wms-msgfrag[data-msguid]"),r=Array.prototype.slice.call(o),l=o[o.length-1];l&&!1===Message.isEditable(l);)r.pop(),l=r[r.length-1];return e.showReplyPreview(l,!0),!1}if(13==d.keyCode){var f=!0;if("block"==i.style.display&&-1!==WMSUI.triggers.indexOf(WMSUI.curtrigger))return void d.preventDefault();mz&&d.preventDefault();var C=c.value;if(e.isDoubleEnter()&&!e.isEnterKeyOnhold)e.isEnterKeyOnhold=!0,e.setLastEnterKeyPressTime(-1),C="---";else{if(""==Message.trim(c.value)){if(e.setLastEnterKeyPressTime((new Date).getTime()),c.value="",t){var v=(w=e.editorreplydiv.querySelector("[data-msguid]"))&&w.getAttribute("data-msguid"),b=e.editorreplydiv.querySelector("[data-fileurl]"),y=e.editorreplydiv.querySelector("#wms_notifyeditmsg").checked;if(b){var _=b.getAttribute("data-fileurl");WebMessanger.editAttachmentComments(e.objId,v,y,"",_)}else{var W=s.querySelector('[data-msguid="'+v+'"]');WMSUI.showDeleteConfirmationDialog(W,m)}e.closeReplyPreview()}return!1}e.setLastEnterKeyPressTime(-1)}if(a&&(C=$WC.Util.unescapeHTML(WMSUI.atMentions.formatAtMentions(C,a,m,!0))),"addmem"===Message.getMsgCategory(n.innerHTML))f=WMSUI.confirmAndAddMember(m,C);else if("command"===Message.getMsgCategory(n.innerHTML)){var S=c.value.substring(0,c.value.indexOf(" "));f=Commands.handle(S,c,m)}else if("11"!=e.ctype||e.editorreplydiv.getAttribute("data-editmsg")){var w;v=(w=e.editorreplydiv.querySelector("[data-msguid]"))&&w.getAttribute("data-msguid");if("block"==e.editorreplydiv.style.display&&v)if(e.editorreplydiv.getAttribute("data-originalmsg")===C)e.showInfoMsg($WC.I18N("message.editprompt.nochange")),f=!1;else if(e.editorreplydiv.querySelector("[data-fileurl]")){_=e.editorreplydiv.querySelector("[data-fileurl]").getAttribute("data-fileurl"),y=e.editorreplydiv.querySelector("#wms_notifyeditmsg").checked;var M=e.atmentions?$WC.Util.unescapeHTML(WMSUI.atMentions.formatAtMentions(e.composer.value,e.atmentions,m,!0)):e.composer.value;M=Smiley.replaceTextToEnglishCodes(M),f=WebMessanger.editAttachmentComments(m,v,y,M,_),e.closeReplyPreview()}else{y=e.editorreplydiv.querySelector("#wms_notifyeditmsg").checked;f=Message.send(m,C,null,null,null,null,null,v,!0,y)}else if("block"==e.editorreplydiv.style.display&&e.editorreplydiv.getAttribute("data-threadmsgid")){A=e.editorreplydiv.querySelector("#wms_notifyeditmsg")&&e.editorreplydiv.querySelector("#wms_notifyeditmsg").checked;f=Message.send(m,C,null,null,null,null,null,null,!0,null,A,e.editorreplydiv.getAttribute("data-threadmsgid"))}else{T=e.getReplyMessageId();var I="undefined"!==e.getReplyMessageId(!0)?e.getReplyMessageId(!0):null;f=Message.send(m,C,null,null,null,null,T,null,!0,null,null,null,I)}"block"==i.style.display&&(i.style.display="none")}else{var T=e.getReplyMessageId(),A=e.editorreplydiv.querySelector("#wms_notifyeditmsg")&&e.editorreplydiv.querySelector("#wms_notifyeditmsg").checked;f=Message.send(m,C,null,null,null,null,T,null,!0,null,A),e.closeReplyPreview()}if((e=WindowHandler.getWinObjById(m)).atmentions="",$WC.WmsSessionStorage.setChatInfo({chid:m,atmentions:e.atmentions}),!t){var E=WindowHandler.getWinObjById(m).ctrlcomp;E.scrollTop=E.scrollHeight-E.clientHeight}return f&&(c.value="",n.innerHTML="",e.showVoiceMsgInvoker(),e.changeFooterHeight(),c.removeAttribute("data-command"),e.checkAndDeleteDraft()),WMSUI.handleStatus(d,c,m),!1}}catch(e){}},WMSUI.confirmAndAddMember=function(i,n,e){var t,s=WindowHandler.getWinObjById(i),a=e,o=[],r=[],l=s.atmentions.slice(0,-1)||e;if(s.atmentions&&(a=s.atmentions.slice(0,-1).split(",")),t=(1===a.length?o.push(WmsContacts.get(a[0],!0).DNAME):(a.forEach(function(e){o.push(WmsContacts.get(e,!0).DNAME)}),o=o.join(", ")),$WC.I18N("chat.contact.adduserinfo",[o])),"8"==s.ctype)WMSUI.inviteToChannel(i,a),WMSUI.handleMemberModificationCommand(i,l,n,!1);else{var d=new $WC.ConfirmationDialog,c={actions:[{text:$WC.I18N("chat.contact.adduser"),onclick:function(){WMSUI.addMem(i,a),WMSUI.handleMemberModificationCommand(i,l,n,!1),d.unmountComponent()},buttonstyle:"confirmation_button"},{text:$WC.I18N("chat.contact.createchat"),onclick:function(){var e=WindowHandler.getWinObjById(i).partinfo;for(var t in e)a.push(t),r.push({zuid:t,dname:$WC.Util.getContactName(t)||e[t].dname});var s=WmsHybridSearch.createChatTitle(r);WmsMainUI.scheduleAutoFocus(i),WMSUI.handleMemberModificationCommand(i,l,n,!0,a,s),d.unmountComponent()},buttonstyle:"cancel_button"}],heading:[t],bodytitle:$WC.I18N("dialogue.info.header"),content:[$WC.I18N("info.contact.add.info1"),$WC.I18N("info.contact.add.info2.external")]};1===o.length&&(c.headerimgsrc=$WC.WmsContacts.getUserPhoto(l,"38")),d.mountComponent(c)}return!0},WMSUI.handleMemberModificationCommand=function(e,t,s,i,n,a){$WC.Util.isArray(t)||(t=t.split(","));for(var o="",r=0;r<t.length-1;r++){var l=$WC.Util.getContactName(t[r]);"+"===WMSUI.curtrigger&&(o+="{addchatmember:"+t[r]+":1:"+l+":addchatmember} ")}return o=o.trim(),i?s&&s.trim()===o?WebMessanger.openUserChat(n.join(","),"true",a):WebMessanger.openUserChat(n.join(","),"true",a,s):s&&s.trim()!==o&&Message.send(e,s),!0},WMSUI.inviteToChannel=function(e,t){WebMessanger.inviteToChannel(e,t)},WMSUI.addMem=function(e,t){var s="";t.forEach(function(e){if(e){var t=WmsContacts.get(e,!0).EMAILID;s+=t.concat(",")}}),WebMessanger.addMember(e,s,t)},WMSUI.init=function(){void 0===WMSUI.hidden&&(WMSUI.hidden=!1),WMSUI.docClickcallbackQue={},WMSUI.i18Nuserstatus=null,WMSUI.scode=1;try{WmsSound.init(),WmsMediaPlayer.initSupportedAudioFormats(),WmsMediaPlayer.initSupportedVideoFormats(),WMSUI.openChatWindowDropUp=function(e,t,s){var i=WindowHandler.getWinObjById(t),n=i.autocompletediv;s=s||{},i.listcommon.showUI(e,s.defaultselect,s.sethtml,null,!0),n.style.display="block"},WMSUI.closeChatWindowDropUp=function(e){var t=WindowHandler.getWinObjById(e),s=t.autocompletediv;t.listcommon.showUI(""),s.style.display="none"},WMSUI.disableComposerOptions=function(e,t){var s=WindowHandler.getWinObjById(e);s.permdenied=!0,s.disableComposerOptions(t)},WMSUI.closeChatWindow=function(e){WindowHandler.getWinObjById(e).closeAndPropagate()},WMSUI.closeEntityChatWindow=function(e){for(chid in e=WebMessanger.getPrd()+"."+e,WindowHandler.openedChats){var t=WindowHandler.getWinObjById(chid);t&&t.entityid==e&&WMSUI.closeChatWindow(t.objId)}},WMSUI.updateMessageInComposer=function(e,t){var s=WindowHandler.getWinObjById(e);s.composer.value+=t,s.focus()},$WC.Functions.isTempResponse=function(e,t,s){var i=document.getElementById(t),n=i&&i.querySelector('[data-msgtime="'+s+'"]'),a=e.closest('[class^="wms-msg"]')||n&&n.querySelector('[class^="wms-msg"]');return!!a&&0<a.querySelectorAll('[class="wms-cmdvisiblediv"]').length},$WC.Functions.init(),$WC.Functions.showResponse=function(e,t){if("banner"===e.type)"success"===e.status?WMSUI.showInfoMsg(e.text):"failure"===e.status&&WMSUI.showErrorMsg(e.text);else{var s=WindowHandler.getWinObjById(t),i=[];if(e.sender=WebMessanger.zuid,e.meta||(e.meta={}),e.meta.isTempResponse=!0,!e.msg)return;i.push(e),s.updateMessage(i)}},$WC.Functions.showErrorResponse=function(e,t){if("banner"===e.type)"success"===e.status?WMSUI.showInfoMsg(e.text):"failure"===e.status&&WMSUI.showErrorMsg(e.text);else{var s=WindowHandler.getWinObjById(t),i=[];e.meta&&e.meta.message_source&&e.meta.message_source.type?e.sender=e.meta.message_source.id:(e.sender=WebMessanger.zuid,e.meta={}),e.time=(new Date).getTime(),e.meta.shareIntegrationResponse=!0,i.push(e),s.updateMessage(i)}}}catch(e){}WMSUI.populate(),WMSUI.inviteObj=[],$WC.template.setResource(WmsResource);var e=isNaN(WebMessanger.setzindex)?WebMessanger.setzindex:+WebMessanger.setzindex+1;$WC.Config.set({WMSCONT:_WMSCONT,CHATCONT:_CHATCONT,RTCCONT:_RTCCONT,PUREJS:!0,Resource:WmsResource,AjaxDispatcher:WebMessanger.wmsAjaxDispatcher,zuid:WebMessanger.zuid,zindex:e,photoserver:_WMSPHOTOSERVER,isOrgUser:WebMessanger.isOrgUser,isCliqUser:WebMessanger.isCliqUser,isGuestUser:WebMessanger.isGuestUser,isRegistered:WebMessanger.isRegistered,SystemApiHandler:WebMessanger.systemApiHandler,ExecuteButtonResponseHandler:WebMessanger.executeButtonResponseHandler,LOCATION_INFO:{},getSilentUserMention:WMSUI.atMentions.getSilentMentionHtml}),$WC.$CUtil.checkAndUpdateLocationPermissionStatus();var t=$WC.Util.createElement("style");t.type="text/css",t.innerHTML="#wmstoolbar *::-webkit-scrollbar, #zchhis *::-webkit-scrollbar, #wms_fork_container *::-webkit-scrollbar{ height:8px; width:8px } #wmstoolbar *::-webkit-scrollbar-thumb, #zchhis *::-webkit-scrollbar-thumb, #wms_fork_container *::-webkit-scrollbar-thumb{ background-color: #dcdcdc }",-1!==navigator.userAgent.indexOf("Mac")&&(t.innerHTML="#wmstoolbar *::-webkit-scrollbar, #zchhis *::-webkit-scrollbar, #wms_fork_container *::-webkit-scrollbar{ height:5px; width: 5px } #wmstoolbar *::-webkit-scrollbar-thumb, #zchhis *::-webkit-scrollbar-thumb, #wms_fork_container *::-webkit-scrollbar-thumb{ background-color: #dcdcdc }"),document.body.appendChild(t)},WMSUI.removeNotificationHolder=function(e){WmsSound.stop(),ChatBlink.stopRepeat(),WMSUI.eventreminderinstance[e]&&(WMSUI.eventreminderinstance[e].unmountComponent(),delete WMSUI.eventreminderinstance[e])},WMSUI.showRemainder=function(e){if(""!=_WMSCALENDARSERVER){var t=$WC.Util.createElement("div",null,"wms-eventcontainer");WmsMainUI.notificationholder.appendChild(t),WMSUI.eventreminderinstance["reminder"+e.ALRM]=new $WC.ReminderPopup,WmsSound.playTune("newchat"),WMSUI.eventreminderinstance["reminder"+e.ALRM].mountComponent(t,e,function(e){WebMessanger.clearReminder(e),delete WMSUI.eventreminderinstance["reminder"+e]})}},WMSUI.attachSession=function(e,t){if(WMSUI.handleChatExist(e)){var s=WindowHandler.getWinObjById(e);if(t&&s)if(s.msgdisp.querySelector('.wms-msgfrag[data-msgtime="'+t+'"]'))Message.glowBubble(t,s.ctrlcomp,e);else{var i=Message.getMarkerElement(e+"|"+t,t,s.msgdisp);Message.loadSpecificTranscript(e,s.msgdisp,i)}}else t&&(Message.mentionMsgInfo[e]=e+"|"+t),WmsMainUI.scheduleAutoFocus(e),WebMessanger.createChatWindowFromCache(e);ZMSGUI.hidechathis()},WMSUI.handleChatExist=function(e){if(!Chat.isExists(e)||WMSUI.getServiceChatContainer(e))return!1;var t=WindowHandler.getWinObjById(e);return t.isMinimized()?t.maximize():t.unread&&t.scrollToUnread(!0),t.titleGlow(),!0},WMSUI.handleChatWindowEscape=function(e,t){var s=WindowHandler.getWinObjById(t),i=s.autocompletediv;s.invisiblediv;return WmsMainUI.contactdetailsdiv&&WmsMainUI.contactdetailsdiv.firstChild?(WmsProfileInfo.handleEscape(e),!0):"none"!=i.style.display?(s.listcommon.showUI(""),i.style.display="none",s.footernode.style.borderRadius="5px",e.stopPropagation(),!0):!(!s.editorreplydiv.style.display||"none"==s.editorreplydiv.style.display)&&(s.closeReplyPreview(),e.stopPropagation(),!0)},WMSUI.handleDocumentEscape=function(e){if(WmsProfileInfo.unmountComponent(),WebMessanger.userslist)return ZMSGUI.removeReminderDialog();ZMSGUI.removeOverlay();var t=document.getElementById("zfdshis"),s=document.getElementById("zchhis"),i=document.getElementById("wms-hysearch"),n=document.getElementById("wms-custmmsgcontainer"),a=document.getElementById("wms-dialog"),o=document.getElementById("wms_fork_container"),r=document.getElementById("wms_pendinginv_container"),l=document.getElementById("wms_msghistdiv"),d=$WC.Util.getEventTarget(e).getAttribute("chid"),c=document.getElementById(d);if(!$WC.$Win.handleEscape()){if(null!=t&&"block"==t.style.display){try{ZMSGUI.hidehis()}catch(e){}return!0}if(null!=s)return ZMSGUI.hidechathis(),!0;if(null!=r&&"block"==r.style.display)return ZMSGUI.hidependinginv(),!0;if(null!=n)return ZMSGUI.hidecustmmsg(),!0;if(null!==i)return WmsHybridSearch.hideUI(),!0;if(null!==a)return WmsDialog.removeModal(),!0;if(null!==l)return $WC.Util.removeElement(l),!0;null!=c?WMSUI.handleChatWindowEscape(e,d):null!=o&&ZMSGUI.removeForkDialog()}},WMSUI.submitFile=function(e,t){var s=document.getElementsByName("uploads"+e)[0];t=t||WindowHandler.getObjectInObject(s,"wms-file","input").files;WmsFileUploadUI.handlePreview(e,t)},WMSUI.iframeUpload=function(e){var t=WindowHandler.getWinObjById(e).getInnerObject("formsend","form");if(isNaN(e)){var s=$WC.Util.createElement("input");s.name="type",s.value=8,s.type="hidden",t.appendChild(s)}var i=t.sid,n=t.sender;i.value=WebMessanger.getSid(),n.value=WebMessanger.getUserName();var a=$WC.Util.createElement("input");a.name=_CHATCFPARAMNAME,a.value=$WC.Cookie.get(_CHATCFTOKEN),a.type="hidden",t.appendChild(a),t.submit(),document.getElementById("actiondiv").style.display="none",document.getElementById("formsend").className="wms-rigp",t.reset(),WMSUI.imgPreview.removeOverlay()},WMSUI.reinviteContByEmail=function(e){var t=WmsContacts.get(e),s=t.DNAME,i=t.EMAILID;WmsContacts.reinvite("zoho",i,s,WebMessanger.uname)},WMSUI.showBanner=function(e){if(!WebMessanger.disablenetworkdownbanner&&!WebMessanger.isReuseSession()){var t='<span id="wmsbannertext" class="wmsbannertext">'+$WC.I18N("connectionerror.netfail")+'</span><span id="recntime"></span><span id="wms-retrybtn" class="wms-retrybutton"  title="'+$WC.I18N("Try_Now")+'"></span>',s=$WC.Util.createElement("DIV","wms-netdownbanner","wms-statesmsg",null,t);if(s.style.zIndex=WebMessanger.setzindex<=9999?9999:WebMessanger.setzindex,this.isBannerShown("wms-netdownbanner")){var i=document.getElementById("wms-netdownbanner");i.parentNode.removeChild(i)}document.body.appendChild(s),document.getElementById("wms-retrybtn").onclick=e}},WMSUI.showInfoMsg=function(e){WMSUI.showErrorMsg(e,"info")},WMSUI.showErrorMsg=function(e,t){_WMSCHATHIDDEN||$WC.Util.showErrorMsg(e,t)},WMSUI.updateTextInBanner=function(e){var t,s;60<e?((t=e%60)<10&&(t="0"+t),s=Math.floor(e/60)+":"+t):s=t=e<10?"0"+e:e;this.isBannerShown("wms-netdownbanner")&&(document.getElementById("recntime").innerHTML=0===e?$WC.I18N("connectionerror.reconnect"):$WC.I18N("connectionerror.reconnecttime",""+s))},WMSUI.showCountDownInBanner=function(t,s){clearTimeout(wmsCountDownTimer),function e(){WMSUI.updateTextInBanner(t);if(0===t)return clearTimeout(wmsCountDownTimer),void s();t--;wmsCountDownTimer=setTimeout(e,1e3)}()},WMSUI.isBannerShown=function(e){return null!=document.getElementById(e)},WMSUI.hideBanner=function(){if(clearTimeout(wmsCountDownTimer),this.isBannerShown("wms-netdownbanner")){var e=document.getElementById("wms-netdownbanner");e.parentNode.removeChild(e)}},WMSUI.runIdleTimer=function(){WebMessanger.registerAnnonUser||(clearTimeout(WMSUI.idletimer),WMSUI.idletimer=setTimeout(function(){WMSUI.handleDocumentIdle()},9e5))},WMSUI.handleDocumentIdle=function(){WebMessanger.registerAnnonUser||WebMessanger.isRTCChat()||2!=WebMessanger.scode&&(WebMessanger.isIdle||WebMessanger.offline||WebMessanger.setIdle())},WMSUI.checkDocumentActive=function(){ie?(document.attachEvent("onkeydown",WMSUI.handleDocumentActive),document.attachEvent("onclick",WMSUI.handleDocumentActive),document.attachEvent("onkeypress",WMSUI.handleDocumentActive),document.attachEvent("onmouseout",WMSUI.handleDocumentActive),document.attachEvent("onmouseenter",WMSUI.handleDocumentActive)):(document.addEventListener("keydown",WMSUI.handleDocumentActive,!0),document.addEventListener("keypress",WMSUI.handleDocumentActive,!0),document.addEventListener("mouseout",WMSUI.handleDocumentActive,!0),document.addEventListener("mouseenter",WMSUI.handleDocumentActive,!0),document.addEventListener("click",WMSUI.handleDocumentActive,!0))},WMSUI.handleDocumentActive=$WC.Util.throttle(function(){WebMessanger.registerAnnonUser||(clearTimeout(WMSUI.idletimer),WMSUI.idletimer=setTimeout(function(){WMSUI.handleDocumentIdle()},9e5),WebMessanger.isIdle&&!WebMessanger.offline&&WebMessanger.setActive())},null,1e4),WMSUI.toggleSoundSetting=function(e){var t=e+(1==WmsSettings.adminsettings[e]?"=0":"=1");$WC.Ajax.postRequestToChat("updbsettings.do",t)},WMSUI.reqNotificationPermAndToggle=function(e){$WC.DesktopNotification.requestPermission(),1==WmsSettings[e]?$WC.Ajax.postRequestToChat("updbsettings.do",e+"=0"):$WC.Ajax.postRequestToChat("updbsettings.do",e+"=1")},WMSUI.checkAndNotifyStatus=function(e,t){if(!_WMSWINFOCUS&&0!=WmsSettings.vustatus&&!$WC.Util.isLocalUser(e.zuid)){var s=+e.scode;if(2===s&&(s=0),0===s&&0<t||0<s&&0===t){var i=s?$WC.I18N("Available"):$WC.I18N("Offline");WMSUI.desktopNotify(i,"status",e)}}},WMSUI.checkAndNotifyMsg=function(t){if(!_WMSWINFOCUS&&!$WC.Util.isLocalUser(t.zuid)){var e=t.ctype;if("1"==WmsSettings.vmention&&WMSUI.atMentions.isLocalUserMentioned(t)||"11"===e||"1"===e&&"2"==t.pcount&&"1"==WmsSettings.vmymessage||"2"<t.pcount&&"1"==WmsSettings.groupmessage_visual_notify||"8"===e&&"1"==WmsSettings.groupmessage_visual_notify||"9"===e&&"1"==WmsSettings.botmessage_visual_notify){var s=t.meta&&t.meta.mentions?WMSUI.atMentions.format(t,!0):t.msg;"att"==t.mod?s=$WC.I18N("chat.file.share"):"contact"==t.mod?s=$WC.I18N("chat.contact.share"):"location"==t.mod?s=$WC.I18N("chat.location.share"):"event"==t.mod?s=$WC.I18N("chat.event.share"):"CALL_INFO"==t.mode&&(s=$WC.MsgUtil.getCallNotificationMessage(t.msg,!0));var i=t.sender+"_"+t.time;WMSUI.desktopNotify(s,i,t,function(){var e=t.threadchatid||t.chid;Chat.isExists(e)?WMSUI.handleChatExist(e):($WC.Util.isThreadChid(e)?WebMessanger.attachSession(e):WebMessanger.createChatWindowFromCache(e),WmsMainUI.scheduleAutoFocus(e))})}}},WMSUI.desktopNotify=function(e,t,s,i){if("3"!==WebMessanger.scode&&"5"!==WebMessanger.scode){var a;e=Message.isMentionMsg(e)||Message.isAddMsg(e)?(a=e,r("atmention_for_transcript","@"),r("addmember_for_transcript","+"),r("silentmention"),a):e,e=$WC.Matcher.replace("removehtmltag",e,function e(t,s,i){return void 0===i?"":$WC.Matcher.replace("removehtmltag",i,e)}),notifiymsg=Message.isCustomEmoji(e)?Smiley.replaceCustomEmojiWithName(e):e;var n=s.sender||s.zuid,o="";o=$WC.Bots.isBotId(n)?$WC.Bots.getPhoto(n):s.meta&&s.meta.usermessagedetails&&s.meta.usermessagedetails.custom_sender_name?s.meta.usermessagedetails.custom_sender_imageurl?s.meta.usermessagedetails.custom_sender_imageurl:s.meta.usermessagedetails.custom_sender_imageid?_WMSCHATURL+"v1/images/"+s.meta.usermessagedetails.custom_sender_imageid:"https://img.zohocdn.com/ichat/images/bar/ac31da36_customimg-default.png":_WMSPHOTOSERVER+"/file?ID="+n+"&t=user&height=50&width=50",$WC.DesktopNotification.show({title:$WC.Util.unescapeHTML(WMSUI.getNotificationTitle(s)),body:$WC.Util.unescapeHTML(e),icon:o,checkownership:!s.a&&wmsnotifyowner,duration:"5000",id:t,onclick:i||null})}function r(e,n){a="silentmention"===e?$WC.Config.get("getSilentUserMention")(a):$WC.Matcher.replace(e,a,function(e,t,s){var i=Message.getDnameFromMetaDataFormat(s);return n+""+i})}},WMSUI.getNotificationTitle=function(e){var t="";if(t=e.meta&&e.meta.usermessagedetails&&e.meta.usermessagedetails.custom_sender_name?e.meta.usermessagedetails.custom_sender_name:$WC.Util.getContactName(e.zuid,e.dname),e.chid){var s=WindowHandler.getWinObjById(e.chid),i=s?s.partcount:e.pcount,n=s?s.getTitle():e.title;if(2<i||n&&n!==t)return t+(n.startsWith("@")?" ":" @")+n}return t},WMSUI.RestartTimers=function(){WMSUI.runIdleTimer()},WMSUI.processAnnMsg=function(e,t){if(!1!==WebMessanger.silentOverriddenForAnnouncement||!silent){var s=document.getElementById("wmsannmsg"),i=document.getElementById("annmsgstrip");t=t||"info",s.style.display="none",i.style.display="none",s.className="zread_olymn",i.className="zread_strip",""===e||WMSUI.isAnnBlocked()||"undefined"!=typeof WmsUIImpl&&WmsUIImpl.handleAnnouncement&&WmsUIImpl.handleAnnouncement(e,t)||($WC.Util.addClass(i,"wmsann"+t+"_strip"),$WC.Util.addClass(s,"wmsann"+t+"_bg"),i.style.display="block",document.getElementById("annmsg").innerHTML=e,WMSUI.annShowAnimate("wmsannmsg"))}},WMSUI.isAnnBlocked=function(){var e=WmsSettings.disann,t=wmsUserConfig.infomsgid;return!!$WC.Cookie.get(t)||!(!e||!e[WebMessanger.prd]&&!e.All||!t)&&(e[WebMessanger.prd]===t||e.All===t)},WMSUI.showAnnMsg=function(){document.getElementById("showinfo").setAttribute("class","zread_olymn1"),WMSUI.annHideAnimate("showinfo")},WMSUI.annHideAnimate=function(t){t=document.getElementById(t);var s=setInterval(function(){var e=t.offsetTop;t.style.top=e-1+"px",-e>=t.offsetHeight&&(clearInterval(s),t.style.display="none",t.style.top="0px")},8)},WMSUI.annShowAnimate=function(e){(e=document.getElementById(e)).style.display="block";var t=-e.offsetHeight;e.style.top=t+"px";var s=setInterval(function(){e.style.top=(t+=1)+"px",3<=t&&clearInterval(s)},8)},WMSUI.hideAnnMsg=function(e){"function"==typeof e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,WMSUI.annHideAnimate("wmsannmsg")},WMSUI.showTicketAnnouncement=function(e){var t=document.getElementById("wmsiamann");t||(t=$WC.Util.createElement("div","wmsiamann","wmsiamann"),WmsMainUI.maincontainer.appendChild(t)),t.innerHTML=e},WMSUI.closeTicketAnnouncement=function(){var e=document.getElementById("wmsiamann");e&&e.parentNode.removeChild(e)},WMSUI.selectGS=function(){},WMSUI.unselectGS=function(){},WMSUI.populateDeactivatedChatUI=function(){WmsMainUI.maincontainer&&WmsMainUI.maincontainer.parentNode.removeChild(WmsMainUI.maincontainer),WmsChatCache.removeAll(),Message.deletedMessages.removeAll(),WmsMainUI.populate(),WmsMainUI.hideMenu(),WmsMainUI.menucontainer.style.display="none",WmsMainUI.toggleSmartChatButton(!0),wmsnotifyowner=wmsnotifyowner||new $WC.NotificationOwner("chat",!0);var e=document.getElementById("chatturnoffinfo");if(e.style.display="block",!0===WebMessanger.chatdisabled){var t=!1===WmsSettings.adminsettings.licenseduser?"unlicensed":!1===WmsSettings.adminsettings.activeappaccountuser?"nonappaccount":"";if(t)e.innerHTML=$WC.I18N("chat.disabled."+t)+"</div>";else{e.style.display="none";var s=document.getElementById("wmsbarmovablehint");s&&(s.style.display="none")}}else!0===WebMessanger.allprdchatdeactivated&&(e.innerHTML=$WC.I18N("chat.disabled.all")+' <a style="cursor:pointer;" data-unpausechat="true"> '+$WC.I18N("chat.enable.click")+"</a></div>");e.querySelector("[data-unpausechat]")&&(e.querySelector("[data-unpausechat]").onclick=WebMessanger.turnOnChat)},WMSUI.populateEmptyBar=function(){document.getElementById("wmstoolbar")&&_WMSCHATHIDDEN||(WmsMainUI.maincontainer&&WmsMainUI.maincontainer.parentNode.removeChild(WmsMainUI.maincontainer),WMSUI.smartchatenabled=!1,WmsChatCache.removeAll(),WMSUI.populateMainBar())},WMSUI.showLoadingIcon=function(e,t,s){var i='<div class="wms_loading_container"><div></div><div></div><div></div></div>';s&&(i=$WC.I18N("Loading")+" "+i);var n=e.getAttribute("data-same-height")&&e.clientHeight?e.clientHeight+"px":"auto",a=$WC.Util.createElement("div",null,"wms-loadingicon",{"data-loading":"true",style:"height:"+n},i);return"append"===t?e.appendChild(a):"prepend"===t?e.insertBefore(a,e.firstChild):"insert"===t?(e.parentNode.replaceChild(a,e),a):e.appendChild(a)},WMSUI.fetchParticipantsOptions=function(e){var t=WindowHandler.getWinObjById(e);if(t&&(t.isZohoGroupChat()||"8"===t.ctype&&$WC.Channels.isUserHasPermission(e,$WC.WmsConstants.USERPERMISSIONS.REMOVE_MEMBER)||"11"===t.ctype&&"true"===t.thread_follower||"10"===t.ctype&&t.allowAddMemberForEntityChat()))return[{operation:"remove",name:$WC.I18N("chat.participants.remove")}]},WMSUI.showParticipantsList=function(i,e){var t=[],s={allowfollowersaddition:!1,fetchthreadfollowers:!1},n=WindowHandler.getWinObjById(i),a=null==n||n.fetchparticipants,o=null==n||n.fetchfollowers;if("11"==n.ctype&&(s.fetchParentParticipants=function(){return Object.keys(n.partinfo).map(function(e){return n.partinfo[e]})}),a||o){o&&"11"==n.ctype&&(s.fetchAndStoreFollowersList=function(t,e){WindowHandler.getWinObjById(t);e.forEach(function(e){WindowHandler.getWinObjById(t).followersinfo[e.uname]=e})});var r=function(t,e){var s=WindowHandler.getWinObjById(t);e.forEach(function(e){WindowHandler.getWinObjById(t).partinfo[e.uname]=e}),s.fetchparticipants=!1}}else t="11"==n.ctype?Object.keys(n.followersinfo).map(function(e){return n.followersinfo[e]}):Object.keys(n.partinfo).map(function(e){return n.partinfo[e]});var l=!1;n&&(n.isZohoGroupChat()||"8"===n.ctype&&$WC.Channels.isUserHasPermission(n.objId,$WC.WmsConstants.USERPERMISSIONS.ADD_MEMBER)||n.allowAddMemberForEntityChat())?l=!0:"11"===n.ctype&&(s.fetchthreadfollowers=!0,s.parentid=n.thread_parentid,"true"===n.thread_follower&&(s.allowfollowersaddition=!0,s.showInfoMsg=WMSUI.showInfoMsg)),n.participantsdialog=new $WC.ViewParticipants,n.participantsdialog.mountComponent(i,e,t,function(e,t,s){s?"11"===n.ctype&&"true"===n.thread_follower?WMSUI.deleteParticipant(i,e.id,e.title,s,!0):WMSUI.deleteParticipant(i,e.id,e.title,s):(t.getAttribute("data-zcprofileid")||t.querySelector("[data-zcprofileid]"))&&(t=null===t.getAttribute("data-zcprofileid")?t.querySelector("[data-zcprofileid]"):t,WebMessanger.showProfileInfo(t))},WMSUI.fetchParticipantsOptions,l,r,s)},WMSUI.getServiceChatContainer=function(e,t){var s=WindowHandler.getWinObjById(e);if(s&&"undefined"!=typeof WmsUIImpl)return WmsImplHandler.invokeSynchronously(WmsUIImpl.getChatWindowContainer,s.objId,s.ctype,s.getChannelUID(),s.getChannelServiceCode(),s.getChannelSOID(),s.entityid);if(t&&"undefined"!=typeof WmsUIImpl){var i=$WC.Channels.get(e)&&$WC.Channels.get(e).oc_id,n=$WC.Channels.get(e)&&$WC.Channels.get(e).service,a=$WC.Channels.get(e)&&$WC.Channels.get(e).servicespecid;return WmsImplHandler.invokeSynchronously(WmsUIImpl.getChatWindowContainer,t.chid,t.ctype,i,n,a,t.entityid)}},WMSUI.showDeleteConfirmationDialog=function(e,t){var s={imghtml:'<div class="wms-dialog-imginner"><div class="wms-dialog-deleteimg"></div></div>',bodyhtml:'<div class="wms-dialog-txtcont">'+$WC.I18N("dialog.delete.msg")+"<p>"+$WC.I18N("dialog.delete.info")+"</p></div>",focusbutton:1,operations:[{name:$WC.I18N("dialog.delete.confirm"),classname:"wms-dialog-rejectbtn",action:function(){WebMessanger.deleteMessage(e,t)}}]};WmsDialog.showModal(s)},WMSUI.handleDownloadLinkClickOnDesktop=function(e){if($WC.Util.isElectron()){var t=e.target;if("attdownload"==t.getAttribute("data-documentclick")){var s=t.href||t.closest("[href]")&&t.closest("[href]").href;if(s)$WC.Util.triggerDownloadInDesktopApp(s)&&(e.stopPropagation(),e.preventDefault())}}},WMSUI.showMediaSessionErrorDialog=function(e,t){$WC.$Dlg.confirm({id:"handlemediasessionsdialog",version:2,class:"zcdalogbx zcbg_mask alert_dialog",headerhtml:$WC.$Dlg.frameHeaderHTML({imagehtml:'<div class="mheader_icn msi-alrt clr-green"></div>'}),bodyhtml:$WC.$Dlg.frameBodyInfoHTML({info:[e.content]}),buttons:[{text:e.buttontext,colour:$WC.$Dlg.GREEN_BUTTON,action:t}]})},WMSUI.checkAndSortReactions=function(s){var e=Object.keys(s)[0],t=Object.keys(s);return t=$WC.Util.isArray(s[e])?t.sort(function(e,t){return s[t].length-s[e].length}):t.sort(function(e,t){return s[t].count-s[e].count})},WMSUI.showStarOptions=function(e,t){var s=$WC.Util.createElement("div","wms-staroptions","wms_staroptions"),i=e.parentElement.previousElementSibling.getAttribute("data-msgid");if(e.className+=" wms_stariconshow",WMSUI.getStarOptionInstance(t)){var n=WMSUI.getStarOptionInstance(t).getCurrentMsgId();if(this.hideStarOptions(t),n==i)return}var a=function(e,t){e.className+=" wms_zoom_anim",WMSUI.hideStarOptions(t)}.bind(t),o=function(e,t){var s=JSON.parse(t).data;$WC.Util.removeClass(e,"wms_zoom_anim"),$WC.Util.removeClass(e,"wms_stariconshow");var i=e.getAttribute("data-startype"),n=e.parentElement.previousElementSibling;0<i&&$WC.Util.removeClass(e,"wms_starbg"+i),s.starredmessage?($WC.Util.addClass(e,"wms_starbg"+s.starredmessage.startype),$WC.Util.addClass(e,"wms_starsel"),$WC.Util.removeClass(e,"wms_staricon"),e.setAttribute("data-startype",s.starredmessage.startype),e.setAttribute("data-starselected","true"),n.setAttribute("data-starselected",!0),n.setAttribute("data-startype",s.starredmessage.startype),WmsMainUI.updateStarMsgList(s.starredmessage,"STAR")):($WC.Util.removeClass(e,"wms_starsel"),$WC.Util.addClass(e,"wms_staricon"),e.setAttribute("data-starselected","false"),e.setAttribute("data-startype","0"),n.setAttribute("data-starselected",!1),n.setAttribute("data-startype",0),WmsMainUI.updateStarMsgList(s,"UNSTAR"))}.bind(this,e),r=function(e,t){e.className+=e.className.replace("wms_zoom_anim","")}.bind(this,e),l=function(e,t){t&&(t.stopPropagation(),t.preventDefault()),this.hideStarOptions(e)}.bind(this,t);e.parentElement.appendChild(s);var d=new $WC.StarOptions;WMSUI.checkAndStoreStarOptionIntance(d,t),d.mountComponent({mountpoint:s,msgid:i,chid:t,clickednode:e,onChangeCallBack:a,unmountComponent:l,successCallBack:o,failureCallBack:r,starselected:e.getAttribute("data-starselected"),startype:parseInt(e.getAttribute("data-startype"))})},WMSUI.getStarOptionInstance=function(e){return WMSUI.staroption_instancestore[e]},WMSUI.checkAndStoreStarOptionIntance=function(e,t){WMSUI.staroption_instancestore[t]&&delete WMSUI.staroption_instancestore[t],WMSUI.staroption_instancestore[t]=e},WMSUI.hideStarOptions=function(e){var t=WMSUI.getStarOptionInstance(e);$WC.Util.removeClass(t.clickednode,"wms_stariconshow"),t.unmountComponent(),delete WMSUI.staroption_instancestore[e]},WMSUI.checkAndLoadCustomEmojis=function(e){for(var t=e.querySelectorAll("[data-customemojicode]"),s=t.length-1;0<=s;s--)if($WC.Util.isScrolledIntoView(t[s],e)&&t[s].getAttribute("data-originalemojisrc")){var i=t[s].getAttribute("data-originalemojisrc");!0===WMSUI.loadedimg[i]?(t[s].style.backgroundImage="url("+i+")",t[s].removeAttribute("data-originalemojisrc")):!1===WMSUI.loadedimg[i]?WMSUI.handleDeletedEmoji(t[s]):WMSUI.loadCustomEmojis(t[s])}},WMSUI.loadCustomEmojis=function(e){var t=e.getAttribute("data-originalemojisrc"),s=function(e,t){var s=this.getAttribute("data-originalemojisrc");s&&(WMSUI.loadedimg[s]=!0,this.style.backgroundImage="url("+s+")",this.removeAttribute("data-originalemojisrc"))}.bind(e),i=function(e,t){this.getAttribute("data-originalemojisrc")&&WMSUI.handleDeletedEmoji(this)}.bind(e),n=new Image;n.onload=s,n.onerror=i,n.src=t},WMSUI.handleDeletedEmoji=function(e){e.removeAttribute("data-originalemojisrc"),e.getAttribute("data-customemojicode").endsWith("!$:")?e.className+=" wms_deletedsticker":(e.className+=" wms_deleted",e.innerText=e.getAttribute("data-emojiname"))},WMSUI.storeChatUsersObj=function(e,t){WMSUI.chatUsersObj[e]=t},WMSUI.removeChatUserObj=function(e){delete WMSUI.chatUsersObj[e]};var ZMSG_translistloader,ZMSG_transmoreloader,ZMSG_CURRPAGE=1,ZMSG_MSGPERPAGE=10,ZMSG_HIS=!1,ZMSG_SEARCH=!1,ZMSG_SEARCHURL="",ZMSG_MSGCNT=0,ZMSG_DATAOBJ={},ZMSG_CHATCOUNT=15,ZMSG_SEARCHVALUE="",ZMSG_CHATPGNO=1,ZMSG_CHATS=[],ZMSG_CHATTOTALOBJ=0,ZMSG_chhis=null,ZMSG_USERID="",ZMSG_NO_MORE_CHATS=!1,ZMSG_MSGOBJ=[];function ZMSGUI(){}function ChatWindow(){this.atmentions="",this.selectedoptions="",this.win=null,this.partinfo={},this.followersinfo={},this.allowedmembers={members:[],token_mapping:{},result_mapping:[]},this.allowedmentions={members:[],token_mapping:{participants:{},team:{},org:{}},result_mapping:{participants:[],team:[],org:[]}},this.partcount=0,this.top=20,this.width=WindowHandler.cwsize,this.height=200,this.scrollTop=0,this.msgdisp,this.ftools,this.composer,this.headernode,this.scode,this.smsg,this.stype,this.recipant,this.objId,this.maximized,this.winIndex=-1,this.prevIndex=-1,this.imgurl="https://img.zohocdn.com/ichat/images/bar/8ff234a1_contactphoto.gif",this.addinfo={},this.prechattime=null,this.offlinemessage=!1,this.ctype=-1,this.attached=!1,this.channelphotoid,this.channeldesc="",this.channeltype,this.channelid,this.channelsoid,this.channelservicecode,this.mutedinterval=null,this.ispinned=!1,this.msgdelaytimer=null,this.msghidetimer=null,this.scrolltimer=null,this.addinfotemplate,this.deleteinfotemplate,this.titleinfotemplate,this.clickedfailurenode,this.lastEnterKeyTime=-1,this.reactions={},this.pinmsgdetails={action_enabled:!0,msg_pinned:!1,info:{}},this.unfurlmsg=!0,this.lastmsg_uid="",this.recipientinfo={}}function Factory(){}function WindowHandler(){}function Message(){}function Chat(){}ZMSGUI.showFeedSearchCategory=function(e){var t=e.querySelector('[id="zmsgsearch"]');"none"===t.style.display||""===t.style.display?(e.style.borderBottomRightRadius="0px",e.style.borderBottomLeftRadius="0px",t.style.display="block"):(e.style.borderRadius="5px",t.style.display="none")},ZMSGUI.selectFeedSearchCategory=function(e){var t=$WC.Util.getEventTarget(e),s=t.parentNode.previousSibling;if("wms-selfeedcat"===s.id){var i=$WC.Util.getInnerText(t);$WC.$CUtil.setInnerText(s,i)}},ZMSGUI.generateHistoryUI=function(){return'<div id="wms-feedsheader" class="wms-feedsheader"><span class="wms-feedhiscontent wms-valign-mid-block">'+$WC.I18N("Feed_History")+'</span><span class="wms-feedsclose"></span></div><div class="wms-feedsearch"><form data-feedhisform="true"><div class="wms-feedsearchcat"><span id="wms-selfeedcat">'+$WC.I18N("All")+'</span><ul class="wms-feedhisselct" id="zmsgsearch"><li value="all">'+$WC.I18N("All")+'</li><li value="searchstr">'+$WC.I18N("Message")+'</li><li value="sender">'+$WC.I18N("Sender")+'</li></ul></div><input id="zmsgsearchtxt" type="text" placeholder="'+$WC.I18N("feeds.search")+'"  class="wmsoptiontext wms-feedsearchtxt"><input type="button" value="'+$WC.I18N("Go")+'" class="wmsbtn wms-feedsearchbtn" data-gobtn="true"></form></div><div  id="zfdshis_cont" class="wms-feedhiscont"></div><div class="wms-feedhisnav" id="zmsghisnav"></div></div>'},ZMSGUI.fillNavigation=function(e){var t="",s=(ZMSG_CURRPAGE=parseInt(ZMSG_CURRPAGE))-1,i=ZMSG_CURRPAGE+1,n=e%ZMSG_MSGPERPAGE!=0?(e-e%ZMSG_MSGPERPAGE)/ZMSG_MSGPERPAGE+1:(e-e%ZMSG_MSGPERPAGE)/ZMSG_MSGPERPAGE,a=e<ZMSG_CURRPAGE*ZMSG_MSGPERPAGE?e:ZMSG_CURRPAGE*ZMSG_MSGPERPAGE;t=ZMSG_CURRPAGE<=1?'<input class="wmsleftashtext" type="button" value="'+$WC.I18N("First")+'">':'<input class="wmsleftashtext" type="button" data-pgno="1" value="'+$WC.I18N("First")+'"><input type="button" data-pgno='+s+' value="'+$WC.I18N("Previous")+'" class="wmsleftashtext">',t+=e<=ZMSG_CURRPAGE*ZMSG_MSGPERPAGE?'<input type="button" value="'+$WC.I18N("Last")+'" class="wmsrightashtext" style="margin-right: 10px;">':'<input type="button" value="'+$WC.I18N("Last")+'" class="wmsrightashtext" data-pgno="'+n+'" style="margin-right: 10px;"><input type="button" value="'+$WC.I18N("Next")+'" class="wmsrightashtext" data-pgno='+i+" >",t+='<span class="wms-hvalign">'+$WC.I18N("feeds.count.show",[(ZMSG_CURRPAGE-1)*ZMSG_MSGPERPAGE+1,a,e])+"</span>",document.getElementById("zmsghisnav").innerHTML=t},ZMSGUI.getHisNav=function(){if(ZMSG_SEARCH)var e=ZMSG_SEARCHURL;$WC.Ajax.requestToChat("zmsgcount.do",e)},ZMSGUI.HisMsgUIobj=function(t,e){if(null!=t){try{t.ATTACHMENTS=JSON.parse(t.ATTACHMENTS)}catch(e){t.ATTACHMENTS=null}ZMSG_DATAOBJ[e]=t;var s='<div class="wms-feedhiswrapper"><div class="wms-feedhisrow"><div class="wms-feedmsgwrapper"><span class="wms-feedmsgtime">'+(t=ZMSGUI.formatMSG(t)).TIME+"</span>";return e<$WC.RecentChats.getUnreadFeedsCount()?s+='<span class="wms-feedmsg" style="font-weight:bold">'+t.MSG+"</span>":s+='<span class="wms-feedmsg">'+t.MSG+"</span>",s+="</div>",""!=ZMSGUI.trim(t.URL)&&""!=ZMSGUI.trim(t.URLSTRING)?s+='<div class="wms-feedurl"><a data-msgno="'+e+'" href="'+t.URL+'" target="_blank" data-feedlink="true">'+t.URLSTRING+"</a></div>":""!=ZMSGUI.trim(t.URL)?s+='<div class="wms-feedurl"><a data-msgno="'+e+'" href="'+t.URL+'" target="_blank" data-feedlink="true">'+t.URL+"</a></div>":""!=ZMSGUI.trim(t.URLSTRING)&&(s+='<div class="wms-feedurl">'+t.URLSTRING+"</div>"),s+="</div></div>"}},ZMSGUI.openfeed=function(e,t){var s=ZMSG_DATAOBJ[e];try{"push"==t&&1==ZMSG_MSGCNT&&ZMSGUI.hidenew()}catch(e){}try{return Collaboration.openURL(s.URL,s.URLSTRING,s.ATTACHMENTS,s.PRODID)}catch(e){return!0}},ZMSGUI.formatMSG=function(e){var t,s="";try{if(null!=(s=e.SENDER)&&""!=s){try{t=e.DNAME}catch(e){}t=isNaN(s)?null!=t&&""!=t?t:s:$WC.Util.getContactName(s,t)}}catch(e){}if(""!=e.PARAMS)e.MSG=null!=t&&""!=t?WmsResource.getRealData(e.MSG,e.PARAMS)+"<span id='wmsfeedsender' class='wmsfeedsender'><span> - </span><a href='javascript:;' data-feedsender=\""+s+'">'+$WC.Util.safeHTML(t)+"</a></span>":WmsResource.getRealData(e.MSG,e.PARAMS);else{var i=new RegExp(s+" ","i");e.MSG=0==e.MSG.search(i)?e.MSG.replace(i,""):e.MSG,e.MSG=null!=t&&""!=t?WmsResource.getRealData(e.MSG)+"<span id='wmsfeedsender' class='wmsfeedsender'><span> - </span><a href='javascript:;' data-feedsender=\""+s+'" >'+$WC.Util.safeHTML(t)+"</a></span>":WmsResource.getRealData(e.MSG)}return e.TIME=$WC.DateUtil.formatDTTime(e.TIME),e},ZMSGUI.launchHistory=function(){try{if(ZohoFeedImpl.handleFeedHistoryUI())return}catch(e){}null!=document.getElementById("zchhis")&&ZMSGUI.hidechathis();try{ZMSGUI.hidenew()}catch(e){}ZMSG_CURRPAGE=1,ZMSG_HIS||(ozfdshis=$WC.Util.createElement("div","zfdshis","wms-feedshis wms-hvalign"),ozfdshis.style.display="none",document.body.appendChild(ozfdshis)),ozfdshis.innerHTML=ZMSGUI.generateHistoryUI(),ZMSGUI.createOverlay(),ZMSG_SEARCH=!(ZMSG_HIS=!0),ZMSG_SEARCHURL="",document.getElementById("zmsgsearch").selectedIndex=0,document.getElementById("zmsgsearchtxt").value="",ZMSGUI.bindFeedEvents(),ZMSGUI.refreshHis()},ZMSGUI.fillHistory=function(e){var t=document.getElementById("zfdshis_cont");if(t.innerHTML="",ZMSG_SEARCH&&(t.innerHTML="",document.getElementById("zmsghisnav").innerHTML=""),null!=e){var s=e.ZohoMessages;if(void 0===s)return t.innerHTML='<div class="wmsfdsempty">'+$WC.I18N("No_feeds_found")+"</div>",ZMSG_SEARCH&&(a=document.getElementById("zmsgsearchtxt").value,t.innerHTML='<div class="wmsfdsempty">'+$WC.I18N("No_results_match_for_your_search")+' "'+$WC.Util.safeHTML(a)+'"</div>'),void ZMSGUI.showhis();var i=s.length;if(i<=0)return t.innerHTML='<div class="wmsfdsempty">'+$WC.I18N("No_feeds_found")+"</div>",ZMSG_SEARCH&&(a=document.getElementById("zmsgsearchtxt").value,t.innerHTML='<div class="wmsfdsempty">'+$WC.I18N("No_results_match_for_your_search")+' "'+$WC.Util.safeHTML(a)+'"</div>'),void ZMSGUI.showhis();ZMSGUI.getHisNav();for(var n=0;n<i;n++)t.insertAdjacentHTML("beforeend",ZMSGUI.HisMsgUIobj(s[n],n));ZMSGUI.showhis()}else{if(t.innerHTML='<div class="wmsfdsempty">'+$WC.I18N("No_feeds_found")+"</div>",ZMSG_SEARCH){var a=document.getElementById("zmsgsearchtxt").value;t.innerHTML='<div class="wmsfdsempty">'+$WC.I18N("No_results_match_for_your_search")+' "'+$WC.Util.safeHTML(a)+'"</div>'}ZMSGUI.showhis()}},ZMSGUI.refreshHis=function(){var e="pageno="+ZMSG_CURRPAGE+"&limit="+ZMSG_MSGPERPAGE;ZMSG_SEARCH&&(e+="&"+ZMSG_SEARCHURL);$WC.Ajax.requestToChat("zmsg.do",e,function(e){if(WebMessanger.callClearNotification(),$WC.RecentChats.getUnreadFeedsCount()&&"NODATA"===e){var t={ZohoMessages:ZMSG_MSGOBJ};ZMSGUI.fillHistory(t),ZMSG_MSGOBJ=[]}else ZMSGUI.fillHistory(e.tableToRowList)})},ZMSGUI.clearSearch=function(){ZMSG_SEARCH=!1,ZMSG_SEARCHURL="",ZMSG_CURRPAGE=1,document.getElementById("zmsgsearch").selectedIndex=0,document.getElementById("zmsgsearchtxt").value="",ZMSGUI.refreshHis()},ZMSGUI.searchHis=function(){var e="pageno="+(ZMSG_CURRPAGE=1)+"&limit="+ZMSG_MSGPERPAGE,t=document.getElementById("wms-selfeedcat").innerHTML,s=document.getElementById("zmsgsearchtxt").value;if(""==ZMSGUI.trim(s))return ZMSG_SEARCH=!1,ZMSG_SEARCHURL="",$WC.Ajax.requestToChat("zmsg.do",e),!1;var i=encodeURIComponent(s),n="";switch(t){case"Message":n=n+"searchstr="+i;break;case"category":n=n+"category="+i;break;case"Sender":n=n+"sender="+i;break;case"All":n=(n=(n=n+"searchstr="+i)+"&category="+i)+"&sender="+i}return ZMSG_SEARCH=!0,ZMSG_SEARCHURL=n,$WC.Ajax.requestToChat("zmsg.do",ZMSG_SEARCHURL),!1},ZMSGUI.gotoPage=function(e){ZMSG_CURRPAGE=e,ZMSGUI.refreshHis()},ZMSGUI.hidenew=function(){ZMSGUI.removeOverlay(),ozfdsnewcont.innerHTML="",document.getElementById("zfdscnt").innerHTML=0,ZMSG_MSGCNT=0,ozfdsnew.style.display="none"},ZMSGUI.showhis=function(){WmsImplHandler.invoke(WmsUIImpl.handleFeedHistory);var e=document.getElementById("zfdshis");try{e.style.zIndex=$WC.Config.get("zindex")}catch(e){}e.style.display="block"},ZMSGUI.hidehis=function(){ZMSGUI.removeOverlay(),document.getElementById("zfdshis").style.display="none"},ZMSGUI.trim=function(e){for(;" "==e.substring(0,1)||"\n"==e.substring(0,1);)e=e.substring(1,e.length);for(;" "==e.substring(e.length-1,e.length)||"\n"==e.substring(e.length-1,e.length);)e=e.substring(0,e.length-1);return e},ZMSGUI.markAllRead=function(){try{for(var e=ozfdsunreadcont.getElementsByTagName("LI"),t=0;t<e.length;t++)e[t].getElementsByTagName("A")[0].className="sel"}catch(e){}},ZMSGUI.showChatHistory=function(e){if(null==document.getElementById("zchhis")){null!=document.getElementById("zfdshis")&&ZMSGUI.hidehis(),e&&(ZMSG_USERID=e),ZMSGUI.createOverlay();var t=WebMessanger.isDarkModeEnabled?"wms-hvalign zmNightMode":"wms-hvalign";WebMessanger.isDNDBackupIconEnabled()&&(t+=" wms_dnd_backup_icon"),ZMSG_chhis=$WC.Util.createElement("div","zchhis",t),WebMessanger.rtlmode&&(ZMSG_chhis.className+=" wms-rtl"),ZMSG_chhis.style.width="780px",ZMSG_chhis.style.zIndex=$WC.Config.get("zindex"),ZMSG_NO_MORE_CHATS=!(ZMSG_CHATPGNO=1),document.body.appendChild(ZMSG_chhis),$WC.Util.removeElement(WmsMainUI.contactdetailsdiv),WmsMainUI.contactdetailsdiv=$WC.Util.createElement("div","wms_contactdetails","wms_contactdetails"),document.body.appendChild(WmsMainUI.contactdetailsdiv),WmsMainUI.contactdetailsdiv.style.zIndex=isNaN(WebMessanger.setzindex)?"1":+WebMessanger.setzindex+3,Gator(WmsMainUI.contactdetailsdiv).on("click","[data-operation]",function(){WmsMainUI.handleProfileActions(this)}),Gator(WmsMainUI.contactdetailsdiv).on("mouseout",function(e){WmsMainUI.handleProfileMouseOut(this,e)});var s='<div class="wmsouterdiv wmscomstl"><table cellpadding="0" cellspacing="0" width="100%" class="wmsoutertbl"><thead><th>';ZMSG_USERID?s+='<div id="wms-recentchattitle" class="wms-recentchattitle"><span class="wmscloseicon" data-historyclose="true" title="'+$WC.I18N("Close")+'"></span><span class="wmsheading wmscomstl">{{RECENTCHATTITLE}}':WebMessanger.isCliqUser()?s+='<div id="wms-histitle" class="wms-histitle"><span class="wmscloseicon" data-historyclose="true" title="'+$WC.I18N("Close")+'" ></span><span class="wmsheading wmscomstl">'+$WC.I18N("chat.message.search"):s+='<div id="wms-histitle" class="wms-histitle"><span class="wmscloseicon" data-historyclose="true" title="'+$WC.I18N("Close")+'" ></span><span class="wmsheading wmscomstl">'+$WC.I18N("Chat_History"),s+='</span></div><div id="wms-hismultisel" class="wms-hisdel"><input type="checkbox"  id="wmschhisselectcheckbox" style="margin: 7px 0 0px 6px;"><button  class="wms-chdel">'+$WC.I18N("Delete")+'</button><button class="wms-chcan">'+$WC.I18N("Cancel")+'</button></div></th></thead><tbody><tr><td ><div style="width:100%;height:39px; position:relative; display:inline-block;"><div class="wms-histrymn"><input id="zchathistorytxt" type="text" class="wms-bdrrhtn" placeholder="'+$WC.I18N("Search")+'" autocomplete="off"/><img src="https://img.zohocdn.com/ichat/images/a29a4f41_spacer.gif" class="wms-zmsgsearchico"></div><div class="wms-toprhtprt"  id="wmschatcontinue" ><div><a class="wmscontinuechatlink" href="javascript:;">'+$WC.I18N("Continue_Chat")+'</a></div></td></tr><tr><td><div class="wmsoffflowingdiv wmscomstl"  style="height:540px; overflow: hidden; padding-top:0" id="zchhis_cont"><div id="chathistorywin" class="wmsoffflowingdiv wmscomstl wmschatwin" style="height:537px" ><div id="translist" style="clear:both"></div></div><div id="wmschtranscontainer" style="width: 439px;overflow: auto;height: 100%;"><div style="margin-top:55%;text-align:center;color: #BCBCBC;font-size: 14px;">'+$WC.I18N("chat.trans.select")+"</div></div></div></div></td></tr></tbody></table></div>",s=$WC.template.replace(s,{RECENTCHATTITLE:$WC.Util.unescapeHTML($WC.I18N("recent.chats.user",[WmsContacts.getDisplayName(ZMSG_USERID)]))}),ZMSG_chhis.innerHTML=s,WebMessanger.getChatTranscript(),ZMSGUI.bindHistoryEvents(),document.getElementById("zchathistorytxt").focus(),$WC.Util.addEvent(document.getElementById("chathistorywin"),"scroll",$WC.Util.debounce(function(){if(!0!==ZMSG_NO_MORE_CHATS){var e=document.getElementById("chathistorywin");e.scrollTop+e.clientHeight>Math.floor(.75*e.scrollHeight)&&ZMSGUI.getNextPage()}},null,250)),ZMSG_transContent=document.getElementById("translist"),ZMSG_translistloader=ZMSGUI.showLoadingPage(ZMSG_transContent,!0),$WC.Util.addEvent(document.getElementById("wmschatcontinue"),"click",function(){var e=ZMSG_transContent.getElementsByClassName("wms-readdiv-select");if(e&&1===e.length){var t=e[0].getAttribute("cid"),s=""!=ZMSG_SEARCHVALUE&&WebMessanger.isCliqUser()?e[0].getAttribute("lmtime"):null;WMSUI.attachSession(t,s)}})}},ZMSGUI.showLoadingPage=function(e,t){var s=$WC.I18N("chat.loading")+'<div class="wms_loading_container"><div></div><div></div><div></div></div>',i=$WC.Util.createElement("div",null,"wms-transloading wms-zmsginfo",null,s);if(t)for($WC.Util.addClass(i,"wms-zmsg-lmiddle");e.lastChild;)e.removeChild(e.lastChild);return e.appendChild(i)},ZMSGUI.createOverlay=function(){if(null==document.getElementById("wms-overlay")){var e=$WC.Util.createElement("div","wms-overlay","wms-overlay");e.onclick=WMSUI.handleDocumentEscape,e.style.zIndex=$WC.Config.get("zindex"),document.getElementById("wmstoolbar")?document.body.insertBefore(e,document.getElementById("wmstoolbar").nextSibling):document.body.appendChild(e)}},ZMSGUI.removeOverlay=function(){var e=document.getElementById("wms-overlay");e&&e.parentNode.removeChild(e)},ZMSGUI.handleEvent=function(e){e=e||window.event;var t=window.event?e.keyCode:e.which;40==t||38==t?ZMSGUI.checkChatHistory()&&(mz&&(e.preventDefault(),e.stopPropagation()),ie&&(e.cancelBubble=!0,e.returnValue=!1),ZMSGUI.handleKeyEvent(t)):27==t&&ZMSG_chhis&&(ZMSGUI.hidechathis(),WMSKeyHandler.cancelEvent(e))},ZMSGUI.checkCheckBox=function(e){e.className="wmsselecthstryinput",e.checked?ZMSGUI.selectChatDelete("all"):ZMSGUI.selectChatDelete("none")},ZMSGUI.hidechathis=function(){ZMSG_chhis&&(document.body.removeChild(ZMSG_chhis),ZMSGUI.removeOverlay(),ZMSG_chhis=null,ZMSG_USERID=ZMSG_SEARCHVALUE="",ZMSG_CHATS=[])},ZMSGUI.hidecustmmsg=function(){var e=document.getElementById("wms-custmmsgcontainer");e&&(document.body.removeChild(e),ZMSGUI.removeOverlay())},ZMSGUI.hidependinginv=function(){var e=document.getElementById("wms_pendinginv_container");e&&(document.body.removeChild(e),ZMSGUI.removeOverlay())},ZMSGUI.removeReminderDialog=function(e){var t=document.getElementById("wms_reminderdiv"),s=document.getElementById("wms_remmemberslist");return s&&"block"===s.style.display&&!e?s.style.display="none":t&&(delete WebMessanger.userslist,t.datepicker.unmountComponent(),$WC.Util.removeElement(t),ZMSGUI.removeOverlay()),!0},ZMSGUI.removeForkDialog=function(){var e=document.getElementById("wms_fork_container");e&&(delete WebMessanger.forkedlist,$WC.Util.removeElement(e),ZMSGUI.removeOverlay())},ZMSGUI.populate=function(e){var t=e,s=0;if(t)for(;s<t.length;)t[s]&&t[s].lastmsginfo&&(t[s].LASTMSGINFO=JSON.parse(t[s].lastmsginfo),t[s].LASTMSGINFO.msg=void 0!==Message?Message.formatLastMsgInfo(t[s].LASTMSGINFO.msg):t[s].LASTMSGINFO.msg),t[s]&&t[s].recipants&&(t[s].PARTICIPANTS=JSON.parse(t[s].recipants)),s++;var i,n=ZMSG_CHATCOUNT,a=ZMSG_SEARCHVALUE,o="";ZMSG_transContent.querySelector("[data-historyend]")||(o="<div valign='middle' style='margin-top: 223px;margin-left: 30px;margin-right: 30px;' data-historyend='true' class='wms-zmsginfo wms-zmsg-lmiddle' >"+$WC.I18N("Chat_History_archives_all_your_chat_transcripts.You_can_search_history_for_past_chats")+"</div>"),""==a||ZMSG_transContent.querySelector("[data-noresult]")||(o='<div valign="middle" data-noresult="true" class="wms-zmsginfo wms-zmsg-lmiddle">'+$WC.I18N("No_results_match_for_your_search")+"</div>");var r=ZMSG_chhis.getElementsByTagName("INPUT");for(var l in r)if(null!=r[l]&&"wmschhisselectcheckbox"==r[l].id){i=r[l];break}if(i&&i.checked&&(i.checked=!1),ZMSG_translistloader&&(ZMSG_translistloader.parentNode.removeChild(ZMSG_translistloader),ZMSG_translistloader=null),t){for(l=0;l<t.length;l++)if(l!=n&&("2"!=t[l].pcount||$WC.SecurityManager.hasPermission("direct_message"))){var d=t[l];ZMSG_CHATTOTALOBJ=l+1;var c="",m="trans_"+d.chatid;c=void 0!==d.isunread&&-1!==d.isunread?"wms-unreaddiv":"wms-readdiv",d.CUSTOMGROUP=d.customgroup,d.TITLE=$WC.Util.unescapeHTML(d.title),d.ADDINFO=d.addinfo,d.PARTICIPANTSCOUNT=d.pcount,d.PARTICIPANTS=d.PARTICIPANTS||[];var u='<div id="'+m+'" lmtime="'+d.lmtime+'" tid="'+d.ctime+'" cid="'+d.chatid+'" class="'+c+'" purpose="chattrans"><input type="checkbox" id="input_'+d.chatid+'" data-checkbox="true" />IMAGES<div id="namedivCID" class="wms-namediv">'+$WC.Util.escapeHTML(d.title)+'</div><span class="wms-chhis-date">TRANSTIME</span><div class="wms-lastmsginfo">LASTMSGINFO</div></div>';u=u.replace(/LASTMSGINFO/g,$WC.HybridSearch.createLastMsgInfoHtml(d)),u="8"==d.chat_type||"8"==d.ctype?u.replace(/IMAGES/g,$WC.Channels.getChannelImageHTML(d.chatid)):u.replace(/IMAGES/g,$WC.HybridSearch.createImageCollageHtml(d));try{u=u.replace(/TRANSTIME/g,$WC.DateUtil.formatDateWithWords(d.lmtime))}catch(e){}0<l?o+=u:o=u}}else ZMSG_transContent.hasChildNodes()&&(ZMSG_NO_MORE_CHATS=!0,null===document.getElementById("wms-chtransnomore")&&(o='<div id="wms-chtransnomore" style="text-align: center;margin: 21px;">'+$WC.I18N("No more chats")+"</div>"));ZMSG_transmoreloader&&ZMSG_transmoreloader.parentNode&&ZMSG_transmoreloader.parentNode.removeChild(ZMSG_transmoreloader),1===ZMSG_CHATPGNO?ZMSG_transContent.innerHTML=o:ZMSG_transContent.innerHTML+=o,t&&15<=t.length&&(ZMSG_transmoreloader=ZMSGUI.showLoadingPage(ZMSG_transContent,!1)),$WC.Util.loadOriginalImage(ZMSG_transContent)},ZMSGUI.selectMainChkbox=function(){var e,t=0,s=ZMSG_transContent.getElementsByTagName("INPUT");for(var i in s)null!=s[i]&&"checkbox"==s[i].type&&s[i].checked&&t++;var n=ZMSG_chhis.getElementsByTagName("INPUT");for(i=0;i<n.length;i++)if(null!=n[i]&&"wmschhisselectcheckbox"==n[i].id){e=n[i];break}1<=t?(e.checked=!0,e.className=t==ZMSG_CHATTOTALOBJ?"wmschhischeckboxopacityhigh":"wmschhischeckboxopacitylow",document.getElementById("wms-histitle")&&(document.getElementById("wms-histitle").style.opacity="0"),document.getElementById("wms-recentchattitle")&&(document.getElementById("wms-recentchattitle").style.opacity="0"),document.getElementById("wms-hismultisel").style.opacity="1",document.getElementById("wms-hismultisel").style.visibility="visible"):(e.checked=!1,ZMSGUI.hideDeleteMenu())},ZMSGUI.resetTranscriptUI=function(){document.getElementById("wmschtranscontainer").innerHTML='<div style="margin-top:55%;text-align:center;color: #BCBCBC;font-size: 14px;">'+$WC.I18N("chat.trans.select")+"</div>",document.getElementById("wmschatcontinue").style.display="none"},ZMSGUI.handleDelCancel=function(){ZMSGUI.hideDeleteMenu(),ZMSGUI.selectChatDelete("none")},ZMSGUI.hideDeleteMenu=function(){document.getElementById("wms-histitle")&&(document.getElementById("wms-histitle").style.opacity="1"),document.getElementById("wms-recentchattitle")&&(document.getElementById("wms-recentchattitle").style.opacity="1"),document.getElementById("wms-hismultisel").style.opacity="0",document.getElementById("wms-hismultisel").style.visibility="hidden"},ZMSGUI.showchhisDelete=function(e){var t=e.getAttribute("cid");$WC.Util.isChannelChid(t)||$WC.Util.isThreadChid(t)||(e.getElementsByTagName("input")[0].style.visibility="visible")},ZMSGUI.hidechhisDelete=function(e){var t=e.getElementsByTagName("input")[0];t.checked||(t.style.visibility="hidden")},ZMSGUI.handleEvents=function(e,t,s,i){var n=$WC.Util.getEventTarget(e);"transdel"!=n.id&&"checkbox"!=n.type&&ZMSGUI.selectChat(t,s,i)},ZMSGUI.selectChat=function(e,t,s){try{document.getElementById("wmschatcontinue").style.display="block";var i=t.parentNode.getElementsByClassName("wms-readdiv-select");if(i[0]&&$WC.VideoPlayerFactory.removeAllComponents(i[0].getAttribute("cid")),i[0]&&i[0]==t&&""!=ZMSG_SEARCHVALUE)return void Message.glowBubble(t.getAttribute("lmtime"),document.getElementById("wmschtranscontainer"),e);if(0!==i.length&&(i[0].className="wms-readdiv"),t.className="wms-readdiv-select",""!=ZMSG_SEARCHVALUE&&WebMessanger.isCliqUser())var n=t.getAttribute("lmtime");ZMSGUI.viewChatTranscript(e,document.getElementById("wmschtranscontainer"),s,n)}catch(e){}},ZMSGUI.viewChatTranscript=function(e,t,s,i){t.innerHTML="";var n=$WC.Util.createElement("div","wmschshtransmsg","wmsoffflowingdiv wmscomstl",{"data-chid":e,"data-fromchat":!0,"data-unread":s});t.appendChild(n);var a=$WC.Util.createElement("div",null,null,{"data-latestchunk":"true"});i&&(a=$WC.Util.createElement("div",null,null,{"data-mentionmsgid":e+"|"+i}),t.setAttribute("data-scrolldown",!0)),a.style="display:none",n.appendChild(a),Message.loadSpecificTranscript(e,n,a),Message.addEventListenersForTranscript(n,e),Gator(n).on("click","[data-zcprofileid]",function(){WebMessanger.showProfileInfo(this)})},ZMSGUI.deleteChat=function(e){confirm($WC.I18N("Are_you_sure_you_wish_to_delete_this_chat"))&&WebMessanger.deleteChat(e)},ZMSGUI.handleDeleteChat=function(){WebMessanger.getChatTranscript()},ZMSGUI.searchChatHistory=$WC.Util.debounce(function(e){var t=document.getElementById("zchathistorytxt");if(t.value&&ZMSG_SEARCHVALUE!==t.value||""==t.value&&8==e.keyCode)return ZMSG_SEARCHVALUE=t.value,ZMSG_APPEND_CONTENT=ZMSG_NO_MORE_CHATS=!(ZMSG_CHATPGNO=1),ZMSG_translistloader=ZMSGUI.showLoadingPage(ZMSG_transContent,!0),ZMSGUI.resetTranscriptUI(),""!=t.value&&WebMessanger.isCliqUser()&&!ZMSG_USERID?ZMSGUI.searchMessage():WebMessanger.getChatTranscript(),document.getElementById("zchathistorytxt").focus(),!1},null,300),ZMSGUI.getNextPage=function(){if("End"!=ZMSG_CHATPGNO){ZMSG_CHATPGNO+=1;var e=ZMSG_transContent.lastChild&&ZMSG_transContent.lastChild.previousSibling,t=e&&parseInt(e.getAttribute("lmtime"))-1;ZMSG_transmoreloader&&!ZMSG_chhis.querySelector("[class^=wms-transloading]")&&ZMSG_transContent.appendChild(ZMSG_transmoreloader),""==ZMSG_SEARCHVALUE&&t?WebMessanger.getChatTranscript(t):WebMessanger.isCliqUser()&&!ZMSG_USERID?ZMSGUI.searchMessage():t&&WebMessanger.getChatTranscript(t)}},ZMSGUI.selectChatDelete=function(e){var t=ZMSG_transContent,s=t.getElementsByTagName("input");for(i in s)s[i].checked=!1,s[i].style&&(s[i].style.visibility="hidden");if(0!=s.length){if("all"==e)for(var i in s)s[i].checked="true",s[i].style&&(s[i].style.visibility="visible");else if("read"==e){var n,a=!1,o=0,r=ZMSG_chhis.getElementsByTagName("INPUT");for(i in s){var l=s[i].parentNode;null!=l&&null!=l&&("wms-readdiv"!=l.className&&"wms-readdiv-select"!=l.className||(a=s[i].checked=!0,o+=1))}for(i in r)if("wmschhisselectcheckbox"==r[i].id){n=r[i];break}1==a&&(n.checked=!0,n.className=o==ZMSG_CHATTOTALOBJ?"wmschhischeckboxopacityhigh":"wmschhischeckboxopacitylow"),0==a&&n.checked&&(n.checked=!1)}else if("unread"==e){a=!1;var d=0;for(i in r=ZMSG_chhis.getElementsByTagName("INPUT"),s){var c=s[i].parentNode;null!=c&&null!=c&&"wms-unreaddiv"==c.className&&(a=s[i].checked=!0,d+=1)}for(i in r)if("wmschhisselectcheckbox"==r[i].id){n=r[i];break}1==a&&(n.checked=!0,n.style.opacity=d==ZMSG_CHATTOTALOBJ?1:.5),0==a&&n.checked&&(n.checked=!1)}}else{var m="<div valign='middle' class='cntemptymsg' style='margin-top:50%' >"+Resource.getRealValue("No_Chat_History_available")+"</div>";t.innerHTML(m)}},ZMSGUI.selectedChatIds=function(){var e={};ZMSG_selectedids=new Array;for(var t=ZMSG_transContent.getElementsByTagName("input"),s=0;s<t.length;s++)if(t[s].checked){if(e[s]=t[s].id,null==e[s]||null==e[s])continue;e[s]=e[s].replace(/input_/g,""),ZMSG_selectedids.push(e[s])}if(1==ZMSG_selectedids.length){confirm($WC.I18N("Are_you_sure_want_to_delete_a_chat"))&&WebMessanger.deleteSelectedChats(ZMSG_selectedids);var i=document.getElementById("trans_"+ZMSG_selectedids);i.parentNode.removeChild(i)}else{if(!(1<ZMSG_selectedids.length))return void alert($WC.I18N("please_select_a_chat"));for(var n in confirm($WC.I18N("Are_you_sure_want_to_delete_the_chats"))&&WebMessanger.deleteSelectedChats(ZMSG_selectedids),ZMSG_selectedids)(i=document.getElementById("trans_"+ZMSG_selectedids[n])).parentNode.removeChild(i)}ZMSGUI.resetTranscriptUI(),ZMSGUI.hideDeleteMenu()},ZMSGUI.clearAllUnreadChats=function(){"block"==zfdsunread.style.display?ZMSGUI.markAllRead():"block"==ZMSG_chhis.style.display&&ZMSGUI.UpdateAllUnreadChatsInHistory()},ZMSGUI.UpdateAllUnreadChatsInHistory=function(){try{for(var e=ZMSG_chhis.getElementsByTagName("DIV"),t=0;t<e.length;t++)-1!=e[t].id.indexOf("trans_")&&(e[t].className="wms-readdiv")}catch(e){}},ZMSGUI.deleteFeed=function(){try{"block"==document.getElementById("zfdshis").style.display&&ZMSGUI.refreshHis()}catch(e){}},ZMSGUI.handleKeyEvent=$WC.Util.throttle(function(e){var t=ZMSG_transContent.getElementsByClassName("wms-readdiv-select");if(1===t.length){if(t=Array.prototype.slice.call(t)[0],40==e){if(!t.nextSibling||!t.nextSibling.getAttribute("cid"))return void s(t,!1);s(t.nextSibling,!0)}else if(38==e){if(!t.previousSibling)return void s(t,!1);s(t.previousSibling,!0)}t.className="wms-readdiv"}else s(ZMSG_transContent.firstChild,!0);function s(e,t){var s=e.getAttribute("cid"),i=!1;"wms-unreaddiv"===e.className&&(i=!0),e.className="wms-readdiv-select",t&&ZMSGUI.selectChat(s,e,i)}},null,200),ZMSGUI.checkChatHistory=function(){return null!=ZMSG_chhis},ZMSGUI.bindHistoryEvents=function(){var e=document.getElementById("zchhis");Gator(e).on("click","[data-historyclose=true]",ZMSGUI.hidechathis),Gator(e).on("click","[data-checkbox=true]",ZMSGUI.selectMainChkbox),Gator(e).on("click","[class^=wms-readdiv]",function(e){ZMSGUI.handleEvents(e,this.getAttribute("cid"),this)}),Gator(e).on("click","#wmschhisselectcheckbox",function(e){ZMSGUI.checkCheckBox(this)}),Gator(e).on("click","[class=wms-unreaddiv]",function(e){ZMSGUI.handleEvents(e,this.getAttribute("cid"),this,!0)}),Gator(e).on("mouseover","[purpose=chattrans]",function(e){ZMSGUI.showchhisDelete(this)}),Gator(e).on("mouseout","[purpose=chattrans]",function(e){ZMSGUI.hidechhisDelete(this)}),Gator(e).on("keyup","#zchathistorytxt",ZMSGUI.searchChatHistory),Gator(e).on("click","[class=wms-chdel]",ZMSGUI.selectedChatIds),Gator(e).on("click","[class=wms-chcan]",ZMSGUI.handleDelCancel)},ZMSGUI.bindFeedEvents=function(){var e=document.getElementById("zfdshis");Gator(e).on("click","[class=wms-feedsclose]",ZMSGUI.hidehis),Gator(e).on("click","#zfdshis_cont",ZMSGUI.showhis),Gator(e).on("click","#zmsgsearch",ZMSGUI.selectFeedSearchCategory),Gator(e).on("click","[class=wms-feedsearchcat]",function(){ZMSGUI.showFeedSearchCategory(this)}),Gator(e).on("click","[data-feedsender]",function(){WebMessanger.chat(this.getAttribute("data-feedsender"))}),Gator(e).on("click","[data-pgno]",function(){ZMSGUI.gotoPage(this.getAttribute("data-pgno"))}),Gator(e).on("submit","[data-feedhisform=true]",ZMSGUI.searchHis),Gator(e).on("submit","[data-gobtn=true]",ZMSGUI.searchHis),Gator(e).on("click","[data-feedlink]",function(){return ZMSGUI.openfeed(this.getAttribute("data-msgno"),"history")})},ZMSGUI.searchMessage=function(){var e="message="+ZMSG_SEARCHVALUE+"&lim="+ZMSG_CHATCOUNT+"&pno="+ZMSG_CHATPGNO+"&raw_search_input="+ZMSG_SEARCHVALUE;$WC.Ajax.requestToChat("v1/messagesearch",e,function(e){var t=[];if(!(e=JSON.parse(e)).data.messages&&e.data.message_tokens[0])return ZMSG_CHATS=[],ZMSGUI.populate([]),void(ZMSG_CHATPGNO="End");for(var s=e.data.messages,i=0;i<s.length;i++){var n=s[i];n.lastmsginfo=JSON.stringify({msg:n.message||n.fcomment||n.fname,sender:n.sender,dname:n.sendername}),n.recipants=n.recipientssumm,n.lmtime=n.time,n.chatid=n.chid,n.title=n.ctitle,t.push(n)}ZMSG_CHATS=t,ZMSGUI.populate(t)},function(){ZMSG_CHATS=[],ZMSG_transmoreloader&&ZMSG_transmoreloader.parentNode&&$WC.Util.removeElement(ZMSG_transmoreloader),ZMSGUI.showErrorMessage()})},ZMSGUI.showErrorMessage=function(){var e='<div valign="middle" class="wms-zmsginfo wms-zmsg-lmiddle" errormsg="true">'+$WC.I18N("message.search.error")+"</div>";if(1==ZMSG_CHATPGNO)ZMSG_transContent.innerHTML=e;else if(!ZMSG_transContent.querySelector("[errormsg=true]")){var t=$WC.Util.createElement("div",null,"wms-zmsginfo wms-search-errormsg",{valign:"middle",errormsg:"true"});t.innerText=$WC.I18N("message.search.error"),ZMSG_transContent.appendChild(t)}},$WC.Util.pubsub.subscribe("/channels/updateui",function(){ZMSG_chhis&&ZMSGUI.populate(ZMSG_CHATS)}),ChatWindow.prototype.create=function(e,t){var s,i;s=t.divId,this.recipant=t.recipant,this.title=t.title,this.scode=t.scode,this.stype=t.stype,this.smsg=$WC.Util.unescapeHTML(t.smsg),this.ctype=t.ctype,this.savehistory=t.historystorage,this.attached=t.attached,this.partcount=t.pcount,this.prdcode=t.prdcode,this.mutedinterval=t.mutedinterval,this.entityweburl=t.entityweburl,this.entityid=t.entityid,this.salesiqchat=t.salesiqchat,this.smileyinstance=new $WC.ZomojiComponent,this.voicerecorderinstance=new $WC.VoiceRecorderApi.VoiceRecorder,this.smileyvisible=!1,this.urlpreviewvisible=!1;var n,a=t.winstate||"max",o=t.composertext,r=t.lastmsgtime;if(this.updateAddInfo(t.addinfo),this.fetchparticipants=!0,this.fetchfollowers=!0,this.messageactionsinstance=new $WC.MessageActions,this.customgroup=t.customgroup,this.pinmsg_duration_selector_instance=new $WC.DurationSelector,this.file_forward_restricted=!1,this.thread_msgid=t.thread_msgid,this.thread_parentid=t.thread_parentid,this.thread_follower=t.thread_follower,this.thread_state=t.thread_state,!(null==document.getElementById(s)||Chat.isExistsInCliqbar(s)&&WMSUI.getServiceChatContainer(s))){document.getElementById(s).style.display="block";var l=WindowHandler.getWinObjById(s);return(WmsMainUI.isAutoFocusScheduled(this.objId)||2===this.partcount&&WmsMainUI.isAutoFocusScheduled(this.recipant))&&l.getMeFront(),void(WmsMainUI.isAutoFocusScheduled(this.objId)?WmsMainUI.removeAutoFocusSchedule(this.objId):2===this.partcount&&WmsMainUI.isAutoFocusScheduled(this.recipant)&&WmsMainUI.removeAutoFocusSchedule(this.recipant))}if(i=$WC.Util.createElement("DIV",s),this.setObjId(s),$WC.Util.addEvent(i,"click",function(){this.makeNormalAndPropagate()}.bind(this)),"undefined"!=typeof WmsUIImpl&&(n=WMSUI.getServiceChatContainer(s)),n?(this.maximized=!0,this.detached=!0,n.appendChild(i),Gator(n).on("click","[data-zcprofileid]",function(e){WebMessanger.showProfileInfo(this)})):WindowHandler.chatbar.insertBefore(i,document.getElementById("wmsbarmovablehint")),$WC.Util.isBotChid(this.objId))var d=$WC.Bots.getBotId(this.objId);i.outerHTML=$WC.template.replace(e,{chid:this.objId,title:this.title,photo:this.imgurl,statusmsg:this.smsg||"",winindex:this.winIndex,style:this.recipant||d?"style=cursor:pointer":""});var c=$WC.RecentChats.getFromPinnedChatList(this.objId);if(this.ispinned=!!c,i.className="wms-cw",this.win=document.getElementById(this.objId),this.mainwin=this.win.querySelector("[data-main]"),this.barwin=this.win.querySelector("[data-bar]"),this.msgdisp=this.win.querySelector("[data-msgdisp]"),this.statusmsgnode=this.win.querySelector("[data-statusmsg]"),this.avatarnode=this.win.querySelector("[data-avatar]"),this.composer=this.win.querySelector("[data-composer]"),this.listcommon=new ListCommon(this.composer,this.getInnerObject("wms-autocomplete","div")),this.ctrlcomp=this.win.querySelector("[data-ctrlcomp]"),this.floating_containers=this.win.querySelector("[data-floating_containers]"),this.datehintnode=this.win.querySelector("[data-datecomp]"),this.threadunreadbanner=this.win.querySelector("[data-threadbanner]"),this.newmsgbanner=this.win.querySelector("[data-newmsgbanner]"),this.scrolldownbutton=this.win.querySelector("[data-scrolldown]"),this.errormsgnode=this.win.querySelector("[data-errormsg]"),this.dragcomp=this.win.querySelector("[data-dragcomp]"),this.photo=this.win.querySelector("[data-photo]"),this.baravatarnode=this.win.querySelector("[data-baravatar]"),this.headernode=this.win.querySelector("[data-header]"),this.titlenode=this.win.querySelector("[data-titlecontainer]"),this.bartitlenode=this.win.querySelector("[data-bartitle]"),this.smileycontainer=this.win.querySelector("[data-smileycontainer]"),this.urlpreviewcontainer=this.win.querySelector("[data-urlpreviewcontainer]"),this.smileyinvoker=this.getInnerObject("wms-smileyinvoker","DIV"),this.voicemsginvoker=this.win.querySelector("[data-voicemsg]"),this.msgdisp.setAttribute("data-chid",this.objId),this.progressbarnode=this.win.querySelector("[data-progressbar]"),this.pinmsgnode=this.win.querySelector("[data-pinmsg]"),this.pinmsgduration=this.win.querySelector("[data-pinoption-duration]"),this.actionlistnode=this.win.querySelector("[data-actionlist]"),this.actionbutton=this.win.querySelector("[data-action]"),this.typingstatusnode=this.win.querySelector("[data-typingstatusnode]"),this.typingindicatornode=this.win.querySelector("[data-typingsymbol]"),this.barmsgcountnode=this.win.querySelector("[data-barmsgcount]"),this.videoinfonode=this.win.querySelector("[data-videoinfo]"),this.videoiconnode=this.win.querySelector("[data-videoicon]"),this.videodropdownnode=this.win.querySelector("[data-videodropdown]"),this.audioiconnode=this.win.querySelector("[data-audioicon]"),this.shareiconnode=this.win.querySelector("[data-shareicon]"),this.attachmentnode=this.win.querySelector("[data-attachment]"),this.footernode=this.win.querySelector("[data-footercont]"),this.edittitleiconnode=this.win.querySelector("[data-edittitleicon]"),this.addmemberhiddeninputnode=this.win.querySelector("[data-addmemberhiddeninput]"),this.populateActionList(),this.recentchatsnode=this.win.querySelector("[data-recentchats]"),this.redirectnode=this.win.querySelector("[data-redirect]"),this.pinactionnode=this.win.querySelector("[data-pinchat]"),this.addmembernode=this.win.querySelector("[data-addparticipant]"),this.historyoffnode=this.win.querySelector("[data-historyoff]"),this.leavechannelnode=this.win.querySelector("[data-leavechannel]"),this.permalinknode=this.win.querySelector("[data-permalink]"),this.closethreadnode=this.win.querySelector("[data-closeThread]"),this.mutechatnode=this.win.querySelector('[data-mute="true"]'),this.minimizeiconnode=this.win.querySelector("[data-minimizeicon]"),this.closeiconnode=this.win.querySelector("[data-closeicon]"),this.resendoverlay=this.win.querySelector("[data-resendoverlay]"),this.resendallnode=this.win.querySelector('[data-operation="wms-resendall"]'),this.editorreplydiv=this.win.querySelector("[data-editorreply]"),this.autocompletediv=this.win.querySelector("[data-autocomplete]"),this.invisiblediv=this.win.querySelector("[data-invisiblediv]"),this.showmembersnode=this.win.querySelector("[data-showmembers]"),this.enlargeicon=this.win.querySelector("[data-enlargeicon]"),this.unsubscribebotnode=this.win.querySelector("[data-unsubscribe]"),this.msgoprnode=this.win.querySelector("[data-msgoperation]"),this.msgselectcntnode=this.win.querySelector("[data-msgselectcnt]"),this.leavechatnode=this.win.querySelector("[data-leavechat]"),this.threadmsglinknode=this.win.querySelector("[data-threadmsglink]"),this.threadslistnode=this.win.querySelector("[data-threadslist]"),this.updatePinnedInfo(this.ispinned),this.updateMuteInfo(this.mutedinterval),this.setTitle(this.title),this.avatarnode.innerHTML=$WC.HybridSearch.generateImageHtml("",$WC.WmsConstants.HYBRIDSEARCH.CONTACT),this.baravatarnode.innerHTML=$WC.HybridSearch.generateImageHtml("",$WC.WmsConstants.HYBRIDSEARCH.CONTACT),this.updateAvatar(),"11"===this.ctype&&this.updateUserStatus(this.scode,this.smsg,this.stype),"8"===this.ctype||"11"===this.ctype||"1"===this.ctype&&"true"===this.customgroup?this.updatePartCount(this.partcount):this.updateUserStatus(this.scode,this.smsg,this.stype),-1==navigator.userAgent.indexOf("Firefox")&&(this.composer.onpaste=function(e){var t=this.getAttribute("chid"),s=WindowHandler.getWinObjById(t);"5"==s.ctype||"true"===s.editorreplydiv.getAttribute("data-editmsg")||s.permdenied||WmsFileUploadUI.handlePaste(e),e.stopPropagation()}),o){if(this.composer.focus(),this.atmentions=$WC.WmsSessionStorage.getChatInfo(this.objId,"atmentions"),this.composer.value=o,this.atmentions){var m=WMSUI.atMentions.formatAtMentions(o,this.atmentions,this.objId);this.invisiblediv.innerHTML=m}this.hideVoiceMsgInvoker()}if("4"===this.ctype&&this.salesiqchat&&(this.edittitleiconnode.style.display="none",this.videoinfonode.style.display="none"),"8"===this.ctype&&($WC.Channels.get(this.objId)&&this.updateMuteInfo($WC.Channels.get(this.objId).muted_interval),!1===$WC.Channels.isUserHasPermission(this.objId,$WC.WmsConstants.USERPERMISSIONS.ADD_MEMBER)&&(this.addmembernode.style.display="none"),0==$WC.Channels.isUserHasPermission(this.objId,$WC.WmsConstants.USERPERMISSIONS.STICKY_MESSAGE)&&(this.pinmsgdetails.action_enabled=!1),1==$WC.Channels.isUserHasPermission(this.objId,$WC.WmsConstants.USERPERMISSIONS.LEAVE_ALLOWED)&&(this.leavechannelnode.style.display="block"),this.permalinknode.style.display="block",this.historyoffnode.style.display="none",this.edittitleiconnode.style.display="none",this.titlenode.style.cursor="default",$WC.Channels.get(this.objId)&&$WC.Channels.get(this.objId).is_default?this.statusmsgnode.style.cursor="default":this.statusmsgnode.style.cursor="pointer",this.threadslistnode.style.display="inline-flex"),"9"===this.ctype&&(this.edittitleiconnode.style.display="none",this.titlenode.style.cursor="default",this.actionbutton.style.display="block",this.recentchatsnode.style.display="none",this.addmembernode.style.display="none",this.historyoffnode.style.display="none",this.leavechannelnode.style.display="none",$WC.Util.isCustomBot(this.objId)&&(this.unsubscribebotnode.style.display="block")),"5"===this.ctype&&(WebMessanger.isRTCChat()||this.removeSendFile(),this.historyoffnode.style.display="none",this.addmembernode.style.display="none",this.edittitleiconnode.style.display="none",this.titlenode.style.cursor="default"),"10"===this.ctype&&(this.addmembernode.style.display="none",this.edittitleiconnode.style.display="none",this.recentchatsnode.style.display="none",this.titlenode.style.cursor="default",this.statusmsgnode.style.cursor="pointer",this.showmembersnode.style.display="block"),"1"===this.ctype&&(WmsSettings.getAdminSetting("isDisableHistoryAllowed")||(this.historyoffnode.style.display="none"),2==this.partcount&&(this.edittitleiconnode.style.display="none",this.addmembernode.style.display="none",this.recentchatsnode.style.display="block")),"1"===this.ctype&&2<this.partcount&&this.customgroup&&(this.leavechatnode.style.display="block"),"11"===this.ctype&&(this.videoinfonode.style.display="none",this.addmembernode.style.display="none",this.titlenode.style.cursor="default",this.mutechatnode.style.display="none",this.threadmsglinknode.style.display="inline-flex",this.threadmsglinknode.setAttribute("data-thread_msgid",this.thread_msgid),this.threadmsglinknode.setAttribute("data-thread_parentid",this.thread_parentid),this.updateThreadFollowerInfo(),"0"===this.partcount&&(this.statusmsgnode.style.cursor="default"),"open"===this.thread_state&&(this.closethreadnode.style.display="block")),_WMSOPENINCLIQ&&(WebMessanger.isCliqUser()||WebMessanger.isOrgUser())&&(this.redirectnode.style.display="block"),"undefined"!=typeof WmsUIImpl){var u=WmsImplHandler.invokeSynchronously(WmsUIImpl.getHeaderHTML,this.objId,this.ctype,this.getChannelUID(),this.getChannelServiceCode(),this.getChannelSOID(),this.entityid);u&&(this.headernode.innerHTML=u);var p=WmsImplHandler.invokeSynchronously(WmsUIImpl.getStatusHTML,this.objId,this.ctype,this.getChannelUID(),this.getChannelServiceCode(),this.getChannelSOID());p&&(this.statuslinenode.innerHTML=p)}if("undefined"!=typeof WmsUIImpl){var h=WmsImplHandler.invokeSynchronously(WmsUIImpl.getChatWindowOptions,this.objId,this.ctype,this.getChannelUID(),this.getChannelServiceCode(),this.getChannelSOID(),this.entityid);h&&this.applyCustomCWOptions(h)}if(WindowHandler.count++,(WmsMainUI.isAutoFocusScheduled(this.objId)||2===this.partcount&&WmsMainUI.isAutoFocusScheduled(this.recipant))&&(this.getMeFront(),this.focus()),0==WmsMainUI.isAutoFocusScheduled(this.objId)&&"min"===a?(WindowHandler.openedChats[this.objId]="min",this.minimize()):(this.maximized=!0,WindowHandler.openedChats[this.objId]="max"),this.storeWindowState(a),WebMessanger.isGuestUser()||(_WMSWINFOCUS?($WC.Drafts.getFromServer(),$WC.Bots.initBots()):($WC.Drafts.getFromServerAfterFocus(),$WC.Bots.getFromServerAfterFocus())),WmsMainUI.isAutoFocusScheduled(this.objId)?WmsMainUI.removeAutoFocusSchedule(this.objId):2===this.partcount&&WmsMainUI.isAutoFocusScheduled(this.recipant)&&WmsMainUI.removeAutoFocusSchedule(this.recipant),WmsChatCache.isAvailable(this.objId))this.msgdisp.innerHTML=WmsChatCache.get(this.objId),this.scrollDisplay();else{var g=$WC.Util.createElement("div"),f=$WC.RecentChats.get(this.objId);r?g.setAttribute("data-nexttime",r):f&&f.LASTSEEN?(g.setAttribute("data-mentionmsgid",this.objId+"|"+f.LASTSEEN),this.ctrlcomp.setAttribute("data-scrolldown",!0)):Message.mentionMsgInfo[this.objId]&&(g.setAttribute("data-mentionmsgid",Message.mentionMsgInfo[this.objId]),this.ctrlcomp.setAttribute("data-scrolldown",!0),delete Message.mentionMsgInfo[this.objId]),g.setAttribute("data-latestchunk","true"),g.style="display:none",this.msgdisp.appendChild(g),this.partcount<=100&&_WMSWINFOCUS||this.maximized?Message.loadSpecificTranscript(this.objId,this.msgdisp,g):this.lazyload_transcript=g}(11==this.ctype&&WmsMainUI.getUnreadCount(this.thread_parentid,null,this.objId)||WmsMainUI.getUnreadCount(this.objId,null,null,!0))&&this.highlight(),this.updateSaveHistoryInUI();var C={chid:this.objId,removed:"false"};this.salesiqchat&&(C.salesiqchat="true"),WebMessanger.isExclusiveChat()||WebMessanger.isRTCChat()||$WC.WmsSessionStorage.setChatInfo(C);var v=$WC.Util.indexOf(WindowHandler.removed,this.getObjId());return-1!==v&&WindowHandler.removed.splice(v,1),silent||WebMessanger.is_custom_menu_opted||WindowHandler.removeExcessChat(this.getObjId()),this.registerEvent(),this.showVideoDropdown(),this.showRestrictedChannelIcon(),$WC.Channels.get(this.objId)&&0==$WC.Channels.isUserHasPermission(this.objId,$WC.WmsConstants.USERPERMISSIONS.SEND_MESSAGE)?(this.permdenied=!0,this.disableComposerOptions($WC.I18N("channels.announcementonly"))):"11"==this.ctype&&$WC.Channels.get(this.thread_parentid)&&0==$WC.Channels.isUserHasPermission(this.thread_parentid,$WC.WmsConstants.USERPERMISSIONS.THREAD_REPLY)&&(this.permdenied=!0,this.disableComposerOptions($WC.I18N("threads.disable.reply"))),$WC.Util.addEvent(this.statusmsgnode,"click",function(e){if(this.salesiqchat)window.open(this.smsg,"_blank");else{if("wms-muteinfoicon"===e.target.id||e.target.closest("[data-mute]")||"wms_cw_videoinfo"===e.target.id||e.target.closest("[data-videodropdown]"))return;if(this.isZohoGroupChat()||2<this.partcount&&"1"===this.ctype||"5"===this.ctype||"8"===this.ctype&&(!$WC.Channels.get(this.objId)||!$WC.Channels.get(this.objId).is_default)||"11"===this.ctype&&"0"!==this.partcount)this.disablemembercontrol||this.permdenied||(this.populateGroupMembers(),e.stopPropagation());else if("10"===this.ctype){if(this.entityweburl)ChatletImpl.handleURLInvocation(this.entityid,this.smsg)||window.open(this.smsg,"_blank");else this.populateGroupMembers(),e.stopPropagation()}else"1"===this.ctype&&(2==this.partcount&&"-5"==this.scode||!WmsContacts.get(this.recipant)?WMSUI.inviteMember(this.recipant,this.title):2!=this.partcount||"-3"!=this.scode&&"-6"!=this.scode||WmsContacts.accept("zoho",this.recipant,$WC.Config.get("zuid")))}}.bind(this)),$WC.Util.addEvent(this.ctrlcomp,"scroll",$WC.Util.throttle(function(){this.ctype==$WC.WmsConstants.CTYPES.THREAD&&this.parentmsg_container&&(this.floating_containers.style.top=this.parentmsg_container.clientHeight<=this.ctrlcomp.scrollTop?"80px":"47px"),this.showDateHint(),this.toggleUnreadBanner();var e=this.ctrlcomp.scrollHeight-this.ctrlcomp.clientHeight<=this.ctrlcomp.scrollTop+20;this.scrolldownbutton.style.display=e?"none":"inline-block"},this,50,{leading:!0,trailing:!0})),$WC.Util.addEvent(this.threadunreadbanner,"click",this.scrollToUnreadThreads.bind(this,!0)),$WC.Util.addEvent(this.newmsgbanner,"click",function(){this.scrollToUnread(!0),this.makeNormal(!0)}.bind(this)),$WC.Util.addEvent(this.scrolldownbutton,"click",this.scrollToLastMsg.bind(this)),$WC.Util.addEvent(this.pinmsgnode,"click",function(e){if(e.target.getAttribute("data-pinmsg-options"))WindowHandler.checkAndHidePinmsgOptions(this.objId),this.togglePinMsgOptions();else if(e.target.getAttribute("data-msg-unpin"))WebMessanger.unpinMsg(this.objId),this.togglePinMsgOptions();else if(e.target===this.pinmsgduration)if(this.pinmsgdetails.info.duration_shown)this.pinmsgdetails.info.duration_shown&&(this.pinmsgdetails.info.duration_shown=!1,this.pinmsg_duration_selector_instance.unmountComponent());else{this.pinmsgdetails.info.duration_shown=!0;var t=function(e){var t=this.pinmsgdetails.info.msgid;WebMessanger.pinMsg(this.objId,t,e,!1),this.togglePinMsgOptions()}.bind(this),s=this.pinmsgnode.getBoundingClientRect().left+this.pinmsgnode.clientWidth+380+10,i=window.innerWidth>=s?"wms_pinmsg_duration_position_right":"wms_pinmsg_duration_position_left";this.pinmsg_duration_selector_instance.mountComponent(this.pinmsgduration,t,i)}else e.target.closest("[data-pindropdown]")||this.highlightPinnedMsg()}.bind(this)),this.initializeZomojiFiles(),!$WC.CustomEmoji.getInitialFetchStatus()&&WmsSettings.showCustomEmojiOptions()&&$WC.CustomEmoji.fetchStickers(),s},ChatWindow.prototype.initializeZomojiFiles=function(){function e(e){WMSUI.loadedimg[e.target.getAttribute("data-url")]=!1}for(var t=["https://img.zohocdn.com/ichat/images/zomoji/fun/c17eb701_zomoji48.png","https://img.zohocdn.com/ichat/images/zomoji/workplace/11bf5e99_zomoji48.png"],s=0;s<t.length;s++)if(!WMSUI.isLoadedImg(t[s])){var i=$WC.Util.createElement("img",null,null,{"data-url":t[s]});i.onerror=e,i.src=t[s],WMSUI.loadedimg[t[s]]=!0}},ChatWindow.prototype.showBotSuggestions=function(e){if(e.temp_info&&e.temp_info.suggestions){var t=e.temp_info.suggestions,s='<div data-list=true class="wms-autocompleteheader wms-truncate-ellipsis wms-commandlist" title="'+e.msg+'">'+e.msg+"</div>";t.forEach(function(e){var t=$WC.Util.safeHTML(e.text);s+='<div class="wms-commandlist" data-list=true data-botsuggestion=true data-suggestiontext="'+t+'"><span class="wms-botsuggestion  wms-truncate-ellipsis" title="'+t+'">'+t+"</span></div>"}),this.listcommon.showUI(s,!0,!0),this.autocompletediv.style.display="block",this.footernode.style.borderRadius="0px 0px 5px 5px"}},ChatWindow.prototype.showAddUserPrompt=function(e){var t=[],s=[];if(!("8"===this.ctype&&!1===$WC.Channels.isUserHasPermission(this.objId,$WC.WmsConstants.USERPERMISSIONS.ADD_MEMBER)||"1"===this.ctype&&2==this.partcount||$WC.Util.getObjectLength(this.partinfo)+1!==this.partcount&&"10"!==this.ctype&&"8"!==this.ctype||"9"===this.ctype)){if(0==WebMessanger.isPaginationEnabledForParticipantsSearch()&&this.atmentions&&WMSUI.curtrigger===$WC.WmsConstants.TRIGGERS.ATMENTION){var i=this.atmentions.slice(0,-1).split(","),n=this.partinfo;i.forEach(function(e){void 0===n[e]&&-1===WMSUI.atMentions.specialmentions.keys.indexOf(e)&&(t.push(e),s.push('<span data-zcprofileid="'+e+'">'+$WC.Util.safeHTML($WC.Util.getContactName(e)||selected_members[0].DNAME)+"</span>"))})}else e&&e.forEach(function(e){-1===WMSUI.atMentions.specialmentions.keys.indexOf(e.id)&&(t.push(e.id),s.push('<span data-zcprofileid="'+e.id+'">'+$WC.Util.safeHTML($WC.Util.getContactName(e.id)||e.dname)+"</span>"))});if(t.length){var a=$WC.I18N("chat.infomsg.adduser",[s.join(", "),'<div class="wms_addusertext">'+$WC.I18N("chat.infomsg.addtext")+"</div>"]);a+='<div class="wms_adduser"><span data-id="'+t.join(",")+'" data-operation="addmem">'+$WC.I18N("Add")+'</span> <span data-operation="removepromptmsg">'+$WC.I18N("common.cancel")+"</span></div>",this.updateInfoMessage(a,null,"promptinfo")}}},ChatWindow.prototype.removePromptMsg=function(){var e=this.msgdisp.querySelector('[data-infotype="promptinfo"]');e&&e.parentNode&&$WC.Util.removeElement(e.parentNode)},ChatWindow.prototype.setLastEnterKeyPressTime=function(e){this.lastEnterKeyTime=e},ChatWindow.prototype.isDoubleEnter=function(){return(new Date).getTime()-this.lastEnterKeyTime<500},ChatWindow.prototype.createChatwindowOverlay=function(){if(this.resendoverlay.style.display="block",this.permdenied)this.resendoverlay.querySelector("[data-operation='wms-resend']").style.display="none";else{var e=""+this.msgdisp.querySelectorAll("[data-msgfailure]").length;1<e&&(this.resendallnode.style.display="block",$WC.$CUtil.setInnerText(this.resendallnode,$WC.I18N("chat.msg.resendall",[e])))}},ChatWindow.prototype.showDateHint=function(){var e=this.ctrlcomp.getBoundingClientRect().top,t=this.ctrlcomp.getElementsByClassName("wms-msgdate");this.datehintnode.style.display="block";for(var s=0;s<t.length;s++){var i=t[s],n=i.getBoundingClientRect().top-20-i.firstChild.offsetHeight,a=new Date(parseInt(i.getAttribute("data-msgtime"))).setHours(0,0,0,0);if(e<n)if(t[s-1]){var o=t[s-1].textContent;a=new Date(parseInt(t[s-1].getAttribute("data-msgtime"))).setHours(0,0,0,0),this.datehintnode.textContent!=o&&(this.datehintnode.textContent=o,this.datehintnode.setAttribute("data-starttime",a)),s=t.length}else this.datehintnode.textContent=i.textContent,this.datehintnode.setAttribute("data-starttime",a);else null==t[s+1]&&this.datehintnode.textContent!=i.textContent&&(this.datehintnode.textContent=i.textContent,this.datehintnode.setAttribute("data-starttime",a))}this.ctrlcomp.scrollHeight-this.ctrlcomp.clientHeight<=this.ctrlcomp.scrollTop+20||(this.datehintnode.style.display="block"),clearTimeout(this.datehint_timer_hide),this.datehint_timer_hide=setTimeout(function(e){clearTimeout(e.datehint_display_timer),e.datehint_display_timer=setTimeout(function(e){e.datehintnode.style.display=""},800,e)},1e3,this)},ChatWindow.prototype.scrollToDateStart=function(e){for(var t=$WC.Util.getEventTarget(e),s=parseInt(t.getAttribute("data-starttime")),i=this.ctrlcomp.getElementsByClassName("wms-msgdate"),n=!1,a=null,o=0;o<i.length;o++)if(i[o].getAttribute("data-msgtime")<s)n=!0;else if(n){s=i[o].getAttribute("data-msgtime"),a=this.ctrlcomp.querySelector('[data-msgtime="'+s+'"]');break}if(n){a=a.previousSibling||a;var r=Message.getScrollableParent(a.parentNode);$WC.Util.scrollTo(a,{behavior:"smooth"},r)}else{var l=$WC.Util.createElement("div",null,null,{"data-prevtime":s,"data-scrollbehaviour":"top"});this.msgdisp.insertBefore(l,this.msgdisp.firstChild),Message.loadSpecificTranscript(this.objId,this.msgdisp,l)}},ChatWindow.prototype.applyCustomCWOptions=function(e){if(e.customClassName&&($WC.Util.addClass(this.mainwin,e.customClassName),$WC.Util.addClass(this.barwin,e.customClassName)),e.customActions&&0<e.customActions.length&&this.generateCustomActionList(e.customActions),"disable"===e.permalink_option&&(this.permalinknode&&(this.permalinknode.style.display="none"),this.disablepermalinkoption=!0),"disable"===e.redirecttocliq&&(this.redirectnode&&(this.redirectnode.style.display="none"),this.disableredirecttocliq=!0),"disable"===e.membercontrol&&(this.addmembernode&&(this.addmembernode.style.display="none"),this.disablemembercontrol=!0),"disable"===e.atmention&&(this.disablemention=!0),"disable"===e.recentchats_option&&(this.recentchatsnode&&(this.recentchatsnode.style.display="none"),this.disablerecentchatsoption=!0),"disable"===e.store_chathistory&&(this.historyoffnode&&(this.historyoffnode.style.display="none"),this.disablehistory=!0),"disable"===e.pinaction&&(this.pinactionnode&&(this.pinactionnode.style.display="none"),this.disablepinaction=!0),"disable"===e.minimize&&(this.minimizeiconnode&&(this.minimizeiconnode.style.display="none"),this.disableminimize=!0),"disable"===e.enlarge&&this.enlargeicon&&(this.enlargeicon.style.display="none"),"disable"===e.mutechat&&(this.mutechatnode&&(this.mutechatnode.style.display="none"),this.disablemuteaction=!0),e.transcript_view_height&&(this.ctrlcomp.style.height=e.transcript_view_height),e.chatwindow_width&&(this.mainwin.style.width=e.chatwindow_width),"disable"===e.file_upload&&(this.attachmentnode&&(this.attachmentnode.style.display="none",this.attachmentnode.setAttribute("data-attachment","false")),this.restrict_file_upload=!0),"disable"===e.actions&&this.actionbutton&&(this.actionbutton.style.display="none"),"disable"===e.edit_chat_title&&this.edittitleiconnode&&this.titlenode&&(this.edittitleiconnode.style.display="none",this.titlenode.style.cursor="default"),e.remove_header&&this.headernode&&this.mainwin.setAttribute("data-hide-header",!0),"disable"===e.file_forward&&(this.file_forward_restricted=!0),"disable"===e.profile_info&&(this.disable_profileinfo=!0),e.primary_font_size){var t=$WC.Util.createElement("style");t.type="text/css",t.innerHTML=".wms-msg,.zcdesc,.wms-msg .wms-audioinfo,.wms_editorreply{font-size:"+e.primary_font_size+"}",this.win.insertAdjacentElement("beforeend",t)}"disable"===e.close&&this.closeiconnode&&(this.closeiconnode.style.display="none"),"disable"===e.voicemsg&&(this.disablevoicemsginvoker=!0,this.hideVoiceMsgInvoker())},ChatWindow.prototype.populateActionList=function(){[{label:"chats.cliq.open",dataAttr:"redirect",dataVal:"true",style:"display: none;"},{label:"chats.common",dataAttr:"recentchats",dataVal:"true",actionCallback:this.getRecentChats},{label:"chat.action.addparticipant",dataAttr:"addparticipant",dataVal:"true",actionCallback:this.insertAddParticipant},{label:"history.off",dataAttr:"historyoff",dataVal:"true",actionCallback:this.setHistoryStorage},{label:"common.shortcut.description.leave",dataAttr:"leaveChannel",dataVal:"true",actionCallback:this.leaveChannel},{label:"common.shortcut.description.permalink",dataAttr:"permaLink",dataVal:"true",actionCallback:this.handleCopyPermaLink},{label:"common.shortcut.description.pin",className:"wms_cw_pinchat",dataAttr:"pinchat",dataVal:"true",actionCallback:this.pinChat,style:"display: block;"},{label:"chat.members.show",className:"wms_cw_showmem",dataAttr:"showmembers",dataVal:"true",actionCallback:this.populateGroupMembers,style:"display:none;"},{label:"common.shortcut.description.mute",className:"wms_cw_muteaction",dataAttr:"mute",dataVal:"true",actionCallback:this.muteChat},{label:"bot.action.unsubscribe",className:"wms_cw_unsubscribe",dataAttr:"unsubscribe",dataVal:"true",actionCallback:this.unsubscribeBot,style:"display:none;"},{label:"chat.action.leave",className:"wms_cw_leavechat",dataAttr:"leavechat",dataVal:"true",actionCallback:this.leaveChat,style:"display:none;"},{label:"thread.action.close",className:"wms_cw_closethread",dataAttr:"closethread",dataVal:"true",actionCallback:this.closeThread,style:"display:none;"}].forEach(function(e){e.label&&(e.className=e.className?"wms_cw_toolbar_actionitem "+e.className:"wms_cw_toolbar_actionitem",e.style=e.style?e.style:"",this.actionlistnode.insertAdjacentHTML("beforeend",this.generateCWActionHtml(e)),e.actionCallback&&this.actionlistnode.querySelector("[data-"+e.dataAttr+"]").addEventListener("click",e.actionCallback.bind(this)))}.bind(this))},ChatWindow.prototype.generateCWActionHtml=function(e){var t="";return"mute"==e.dataAttr&&-1<e.className.indexOf("wms_cw_muteaction")?t='<div class="{{className}}" data-{{dataAttr}}="{{dataVal}}" style="{{style}}"><span data-mutetitle>'+$WC.I18N(e.label)+'</span><ul class="wms-muteinterval" ><li data-duration="3600">'+$WC.I18N("chat.hour","1")+'</li><li data-duration="28800">'+$WC.I18N("chat.hours","8")+'</li><li data-duration="86400">'+$WC.I18N("chat.day","1")+'</li><li data-duration="604800">'+$WC.I18N("chat.week","1")+'</li><li data-duration="-1">'+$WC.I18N("chat.forever")+"</li></ul></div>":"redirect"==e.dataAttr?t='<a href="'+_WMSCHATURL+"chats/"+this.objId+'" target="_blank" rel="noopener"><div class="{{className}}" data-{{dataAttr}}="{{dataVal}}" style="{{style}}">'+$WC.I18N(e.label)+"</div></a>":e.dataAttr&&e.dataVal?t='<div class="{{className}}" data-{{dataAttr}}="{{dataVal}}"  style="{{style}}">'+$WC.I18N(e.label)+"</div>":e.data_customAction&&(t='<div class="{{className}}" data-customAction="{{data_customAction}}"> {{label}} </div>'),$WC.template.replace(t,{className:e.className,dataAttr:e.dataAttr,dataVal:e.dataVal,actionCallback:e.actionCallback,label:e.label,style:e.style,data_customAction:e.data_customAction})},ChatWindow.prototype.generateCustomActionList=function(e,t){t=t||this.actionlistnode,e.forEach(function(e){null===t.querySelector('[data-customAction="'+e.data_customAction+'"]')&&(e.label&&e.actionCallback&&e.data_customAction&&(e.className=e.className?"wms_cw_toolbar_actionitem "+e.className:"wms_cw_toolbar_actionitem",t.insertAdjacentHTML("beforeend",this.generateCWActionHtml(e)),t.querySelector('[data-customAction="'+e.data_customAction+'"]').addEventListener("click",function(){e.actionCallback(this.objId),this.hideActions()}.bind(this))),e.submenu&&(t.querySelector('[data-customAction="'+e.data_customAction+'"]').insertAdjacentHTML("beforeend",'<div class="wms_cw_toolbar_actionwrapper"></div>'),this.generateCustomActionList(e.submenu,t.querySelector('[class="wms_cw_toolbar_actionwrapper"]'))))}.bind(this))},ChatWindow.prototype.registerEvent=function(){var c=this,s=this.objId;if(_WMSDRAGDROP&&!c.permdenied&&!c.restrict_file_upload){var t=!1,i=null;this.win.addEventListener("dragstart",function(e){c.file_forward_restricted||WebMessanger.isGuestUser()||(WmsDragDrop.dragged_file=e.target,e.dataTransfer.setData("isdragfromcwin","true"))},!0),this.win.addEventListener("dragover",function(e){e.preventDefault()},!0),this.win.addEventListener("drop",function(e){if(e.preventDefault(),!c.permdenied&&!c.restrict_file_upload)if(e.dataTransfer.getData("isdragfromcwin"))WmsDragDrop.onDropEvent(s,e,!0,!0),WmsDragDrop.dragged_file="";else if("undefined"!=typeof zmUtil&&"function"==typeof zmUtil.processDroppedFile&&e.dataTransfer.getData("dragAttrs"))try{zmUtil.processDroppedFile(e.dataTransfer.getData("dragAttrs"),s)}catch(e){}else WmsDragDrop.onDropEvent(s,e,!0);c.ctrlcomp.style.display="block",c.dragcomp.style.display="none",t=!1,e.stopPropagation()},!0),this.win.addEventListener("dragenter",function(e){e.preventDefault(),i=e.target,t||!WmsDragDrop.isFileSharable()||"true"===c.editorreplydiv.getAttribute("data-editmsg")||c.permdenied||c.restrict_file_upload||(c.ctrlcomp.style.display="none",c.dragcomp.style.display="flex",t=!0)},!0),this.win.addEventListener("dragleave",function(e){e.preventDefault(),i==e.target&&(c.ctrlcomp.style.display="block",c.dragcomp.style.display="none",t=!1)},!0)}var e=$WC.Util.getCssAnimEndListener();$WC.Util.addEvent(this.headernode,e,function(){this.classList.remove("wms-titleglow")},!0),$WC.Util.addEvent(this.barwin,e,function(){this.classList.remove("wms-titleglow")},!0),Message.addEventListenersForTranscript(this.msgdisp,s),Gator(c.resendoverlay).on("click","[data-operation]",function(){var e=this.getAttribute("data-operation");"wms-resend"===e?Message.resend(c.msgdisp,c.clickedfailurenode,!1):"wms-resendall"===e?Message.resend(c.msgdisp,c.clickedfailurenode,!0):"wms-resenddel"===e&&Message.removeFailedMessages(c.clickedfailurenode),c.resendoverlay.style.display="none",c.resendallnode.style.display="none"}),Gator(this.actionlistnode).on("click",'[data-purpose="wms_botactions"]',function(){var s,e;c.hideActions(),Commands.showLoadingIcon(c.autocompletediv,c.objId);var t={};t.exec_id=this.getAttribute("data-exec_id");var a=$WC.Bots.getBotId(c.objId),i=$WC.Bots.get(a);if(i.actionhandles)for(var n=0;n<i.actionhandles.length;n++)if(i.actionhandles[n].id===t.exec_id){e=i.actionhandles[n].location,s=i.actionhandles[n].display_props.name;break}function o(){Commands.hideLoadingIcon(c.objId);var e=JSON.parse(this.response),i=e.data.dreResponse,n=[];function t(e,t,s){if("Consent"===(i=t.data.dreResponse).status||"Failure"===i.status&&!$WC.Util.isEmpty(i.resumeUrl))(new $WC.Consents).mountComponent(e,i,s);else if("Success"===i.status&&i.output){if(i.output.msg)n.push(i.output);else if(i.output.actions){$WC.Channels.initChannels(),(new $WC.Forms).mountComponent(i,Commands.showResponse,function(){c&&c.composer.focus()})}n.length&&c.updateMessage(n)}}i.output||(i.output={}),i.output.sender=a,i.output.isTempResponse=!0,i.output.meta||(i.output.meta={},i.output.meta.usermessagedetails={},i.output.meta.usermessagedetails.msg_title=s),t(c.objId,e,t)}function r(){Commands.hideLoadingIcon(c.objId)}var l="v1/bots/"+a+"/executeaction",d={"x-consents-version":"1","Content-Type":"application/json","X-ZCSRF-TOKEN":$WC.Util.getCSRF()};e?$WC.Ajax.postRequestToChatWithLocation(l,t,o,r,null,null,d):$WC.Ajax.postRequestToChat(l,t,o,r,null,null,d)}),Gator(this.editorreplydiv).on("click",".wms_cw_replyclose, [data-replymsgtime], #wms_notifyeditmsg",function(e){var t=$WC.Util.getEventTarget(e);if("wms_notifyeditlabel"!==t.id)if("wms_notifyeditmsg"===this.id){var s=t.parentNode.querySelector('[data-type="custom"]');s.className="wms_settings_customcheckbox"===s.className?"wms_settings_customcheckboxsel":"wms_settings_customcheckbox",e.stopPropagation()}else this.getAttribute("data-replymsgtime")?(Message.glowBubble(this.getAttribute("data-replymsgtime"),c.ctrlcomp),e.stopPropagation()):c.closeReplyPreview()}),Gator(this.progressbarnode).on("click","[data-purpose]",function(){var e=this.getAttribute("data-purpose"),t=this.getAttribute("data-filename");"uploadcancel"===e?(WmsFileUploadUI.cleanUpFileUpload(s,null,null,!0),WmsFileUploadUI.customCallBackObj&&"function"==typeof WmsFileUploadUI.customCallBackObj.successCallBack&&(WmsFileUploadUI.customCallBackObj.uploadCancelCallBack(),WmsFileUploadUI.clearCustomCallBackObj())):"expand"===e||"collapse"===e?WmsFileUploadUI.expandFilesContainer(s,e):"retryall"===e&&WmsFileUploadUI.resendAllFiles(s),"resend"===e?WmsFileUploadUI.resendFile(s,t):"close"===e&&WmsFileUploadUI.cleanUpFileUpload(s,null,t,!0,!0)}),Gator(this.mainwin).on("click","[data-fwdclose=true]",this.toggleMessageSelection.bind(this)),Gator(this.mainwin).on("click","[data-fwdmsg=true]",this.forwardSelectedMessages.bind(this)),Gator(this.mainwin).on("click","[data-minimizeicon=true]",this.minimizeAndPropagate.bind(this)),Gator(this.mainwin).on("click","[data-header=true]",this.focus.bind(this)),Gator(this.mainwin).on("click","[data-enlargeicon=true]",this.toggleEnlargeWindow.bind(this)),Gator(this.mainwin).on("click","[data-closeicon=true]",this.closeAndPropagate.bind(this)),Gator(this.mainwin).on("click","#wms-smileyinvoker",this.toggleSmiley.bind(this)),Gator(this.mainwin).on("click","#wms-voicemsginvoker",this.invokeVoiceMsg.bind(this)),Gator(this.mainwin).on("click","[data-action=true]",this.toggleActions.bind(this)),Gator(this.mainwin).on("click","[data-titlecontainer=true]",this.editChatTitle.bind(this)),Gator(this.mainwin).on("click","[data-edittitleicon=true]",this.editChatTitle.bind(this)),Gator(this.mainwin).on("click","[data-urlpreviewclose=true]",this.hideUrlPreview.bind(this,!0)),Gator(this.mainwin).on("dblclick","[data-composer=true]",this.textAreaMinimize.bind(this)),Gator(this.mainwin).on("click","[data-videoinfo=true]",this.toggleVideoDropdown.bind(this)),Gator(this.mainwin).on("click","[data-audioicon=true]",this.handleMediaCall.bind(this)),Gator(this.mainwin).on("click","[data-videoicon=true]",this.handleMediaCall.bind(this)),Gator(this.mainwin).on("click","[data-shareicon=true]",this.handleMediaCall.bind(this)),Gator(this.mainwin).on("click","[data-composer=true]",this.focus.bind(this)),Gator(this.mainwin).on("blur","[data-composer=true]",this.blurChat.bind(this)),Gator(this.mainwin).on("blur","[data-titleform=true]",function(e){this.checkChatTitle(e.target.value)}.bind(this)),Gator(this.mainwin).on("submit","[data-titleform=true]",function(e){return this.saveChatTitle(e.target.querySelector("#wmseditchattitletxt").value),!1}.bind(this)),Gator(this.mainwin).on("keydown","[data-titleform=true]",this.checkkey.bind(this)),Gator(this.mainwin).on("keydown","[data-composer=true]",function(s){return this.salesiqchat&&"undefined"!=typeof WmsUIImpl?WmsImplHandler.invoke(WmsUIImpl.handleKeyDown,s,this.objId):"13"==s.keyCode&&this.urlpreviewvisible&&this.unfurldata_cache_id&&this.unfurlmsg&&0==$WC.Config.get("zoholinks_auth")?void(new $WC.UrlConsent).mountComponent(function(e,t){if(this.unfurlmsg=e,t)return WMSUI.handleEvent(s,this.composer,this.objId)}.bind(this)):WMSUI.handleEvent(s,this.composer,this.objId)}.bind(this)),Gator(this.mainwin).on("keydown",function(e){if(this.permdenied&&"27"==e.keyCode)return WMSUI.handleEvent(e,this.composer,this.objId)}.bind(this)),Gator(this.mainwin).on("input","[data-composer=true]",function(e){WMSUI.handleStatus(e,this.composer,this.objId),WindowHandler.makeNormalWinById(this.objId)}.bind(this)),Gator(this.mainwin).on("keyup","[data-composer=true]",function(e){if(this.salesiqchat)return"undefined"!=typeof WmsUIImpl&&(WmsImplHandler.invoke(WmsUIImpl.handleKeyMovement,e,this.objId),WmsImplHandler.invoke(WmsUIImpl.handleKeyUp,e,this.objId)),!0;13===e.keyCode&&(this.isEnterKeyOnhold=!1)}.bind(this)),Gator(this.mainwin).on("click","[data-memdel=true]",function(){WMSUI.deleteParticipant(this.objId,event.target.getAttribute("data-zcprofileid"),event.target.getAttribute("data-dname"))}.bind(this)),Gator(this.mainwin).on("change","#wms-file",function(){WMSUI.submitFile(this.objId)}.bind(this)),Gator(this.mainwin).on("click","[data-attachment]",function(){this.hideActions()}.bind(this)),this.composer.onscroll=function(){WMSUI.handleSync(this.composer)}.bind(this),this.barwin.onclick=this.maximize.bind(this),this.barwin.querySelector("[data-barclose=true]").onclick=this.closeAndPropagate.bind(this),this.ctrlcomp.addEventListener("mouseup",this.checkSelectionAndFocus.bind(this)),this.datehintnode.onclick=this.scrollToDateStart.bind(this)},ChatWindow.prototype.blurChat=function(){Self.status.idle(this.objId)},ChatWindow.prototype.updatePinnedInfo=function(e){(this.ispinned=e)?(this.pinactionnode.className="wms_cw_toolbar_actionitem wms_cw_unpinchat",$WC.Util.isBotChid(this.objId)?$WC.$CUtil.setInnerText(this.pinactionnode,$WC.I18N("chat.unpinbot")):$WC.Util.isThreadChid(this.objId)?$WC.$CUtil.setInnerText(this.pinactionnode,$WC.I18N("chat.unpinthread")):$WC.$CUtil.setInnerText(this.pinactionnode,$WC.I18N("common.shortcut.description.unpin"))):(this.pinactionnode.className="wms_cw_toolbar_actionitem wms_cw_pinchat",$WC.Util.isBotChid(this.objId)?$WC.$CUtil.setInnerText(this.pinactionnode,$WC.I18N("chat.pinbot")):$WC.Util.isThreadChid(this.objId)?$WC.$CUtil.setInnerText(this.pinactionnode,$WC.I18N("chat.pinthread")):$WC.$CUtil.setInnerText(this.pinactionnode,$WC.I18N("common.shortcut.description.pin")))},ChatWindow.prototype.updateMuteInfo=function(e){this.mutedinterval=e;var t=this.mutechatnode;e&&"-1"!==e&&e>(new Date).getTime()?(t.setAttribute("data-mute","true"),$WC.Util.removeClass(t,"wms_cw_muteaction"),$WC.Util.addClass(t,"wms_cw_unmuteaction")):(t.setAttribute("data-mute","false"),$WC.Util.removeClass(t,"wms_cw_unmuteaction"),$WC.Util.addClass(t,"wms_cw_muteaction")),this.updateMuteTitle()},ChatWindow.prototype.updateMuteTitle=function(){var e=this.mutedinterval,t=this.mutechatnode.querySelector("[data-mutetitle]");if(e&&"-1"!==e&&e>(new Date).getTime()){var s=$WC.I18N("chat.mute.onmute");if("9223372036854775807"==e)s+=" "+$WC.I18N("chat.forever");else if(1!=e){var i=(new Date).getTime(),n=new Date(e-i),a=n.getUTCDate()-1,o=n.getUTCHours(),r=n.getUTCMinutes(),l="";a&&(l+=" "+a+" ",l+=1==a?$WC.I18N("chat.mute.day"):$WC.I18N("chat.mute.days")),o&&(l+=" "+o+" ",l+=1==o?$WC.I18N("chat.mute.hour"):$WC.I18N("chat.mute.hours")),r&&(l+=" "+r+" ",l+=1==r?$WC.I18N("chat.mute.minute"):$WC.I18N("chat.mute.minutes")),""==l&&(l=" "+$WC.I18N("chat.mute.seconds")),s+=l+" "+$WC.I18N("chat.mute.timeleft")}this.mutechatnode.title=s,$WC.$CUtil.setInnerText(t,$WC.I18N("common.shortcut.description.unmute"))}else this.mutechatnode.title=$WC.I18N("common.shortcut.description.mute"),$WC.$CUtil.setInnerText(t,$WC.I18N("common.shortcut.description.mute"))},ChatWindow.prototype.updateUserStatus=function(e,t,s){if("9"===this.ctype&&(t="chatbot.smsg",e="chatbot",$WC.Util.isBotChid(this.objId))){var i=$WC.Bots.getBotId(this.objId);$WC.Bots.get(i)&&$WC.Bots.get(i).STATUSMSG&&(t=$WC.Bots.get(i).STATUSMSG)}null==t&&(t=""),this.salesiqchat&&(t=WmsUIImpl.getChatWindowStatusText(this.objId)),t=$WC.Util.unescapeHTML(t),this.smsg=t,t=$WC.I18N(t),"1"===this.ctype&&2<this.partcount||(this.statusmsgnode.title=t),$WC.$CUtil.setInnerText(this.statusmsgnode,t),this.stype=WMSUI.getStype(s),this.scode=e;var n=this.avatarnode&&this.avatarnode.firstChild,a=this.baravatarnode&&this.baravatarnode.firstChild,o="";if("11"==this.ctype)r="wms_badge_imgwrapper wms_badge_statusicon_thread",o="open"===this.thread_state?"wms_badge_statusicon_thread_cutout wms_badge_img_cutout":"wms_badge_statusicon_closedthread_cutout wms_badge_img_cutout";else if("-1"!=e&&"-3"!=e&&"-4"!=e&&"-5"!=e&&"-6"!=e&&WmsContacts.get(this.recipant))r="wms_badge_imgwrapper wms_badge_statusicon_"+WmsContacts.getStatusClassName(null,this.scode,this.stype),o="wms_badge_statusicon_"+WmsContacts.getStatusClassName(null,this.scode,this.stype)+"_cutout wms_badge_img_cutout";else var r="wms_badge_imgwrapper";if(n){n.className=r;var l=n.querySelector("[data-cutouticon]");l&&(l.className=o),this.recipant&&WmsContacts.get(this.recipant)&&(n.title=$WC.I18N(WebMessanger.statusarr[e]))}if(a){a.className=r;var d=a.querySelector("[data-cutouticon]");d&&(d.className=o)}var c="wms_cw_bar_typing_indicator ";"0"==e?c+="wms_cw_bar_typing_offline":"1"==e?c+="wms_cw_bar_typing_online":"3"==e?c+="wms_cw_bar_typing_busy":"4"==e?c+="wms_cw_bar_typing_idle":"5"==e?c+="wms_cw_bar_typing_dnd":"7"==e&&(c+="wms_cw_bar_typing_away"),$WC.Util.removeClass(this.statusmsgnode,"wms_cw_contactstatus"),$WC.Util.removeClass(this.statusmsgnode,"wms_cw_status_accepticon"),$WC.Util.removeClass(this.statusmsgnode,"wms_cw_status_invited"),"-1"!=e&&"-3"!=e&&"-4"!=e&&"-5"!=e&&"-6"!=e&&WmsContacts.get(this.recipant)||($WC.Util.addClass(this.statusmsgnode,"wms_cw_contactstatus"),"-3"!=e&&"-6"!=e||$WC.Util.addClass(this.statusmsgnode,"wms_cw_status_accepticon"),"-1"==e&&$WC.Util.addClass(this.statusmsgnode,"wms_cw_status_invited")),""!=e&&"10"!=e&&(this.typingindicatornode.className=c)},ChatWindow.prototype.updateChannelInfo=function(e){this.channeldesc=e.cd,this.channelphotoid=e.photoid,this.channeltype=e.sc,this.channelid=e.oc_id,this.channelservicecode=e.service,this.channelsoid=e.servicespecid},ChatWindow.prototype.updatePartCount=function(e){var t=e,s=2<=t?$WC.I18N("chat.participants"):$WC.I18N("chat.participant");11==this.ctype&&(s=2<=t?$WC.I18N("thread.followers"):$WC.I18N("thread.follower"));var i=t+" "+s;0==t&&(i=11==this.ctype?$WC.I18N("thread.followers.none"):$WC.I18N("chat.participants.none")),this.statusmsgnode.title="",$WC.$CUtil.setInnerText(this.statusmsgnode,i),$WC.Util.addClass(this.statusmsgnode,"wms_cw_activeusers")},ChatWindow.prototype.updatePartinfo=function(e,t,s,i){for(var n in this.partinfo){if(this.partinfo[n].uname==e){this.partinfo[n].scode=t,this.partinfo[n].smsg=s,this.partinfo[n].stype=i;break}}},ChatWindow.prototype.updateOfflineMessage=function(){2===this.partcount&&(this.composer.placeholder=$WC.I18N("chat.userofflineinfo"),this.offlinemessage=!0)},ChatWindow.prototype.updateOnlineMessage=function(){2===this.partcount&&(this.composer.placeholder="",this.offlinemessage=!1)},ChatWindow.prototype.updateUserInfoStatus=function(e){this.typingstatusnode.innerHTML=e,this.typingstatusnode.setAttribute("title",e)},ChatWindow.prototype.updateThreadFollowerInfo=function(e,t,s,i){if(e){var n=document.getElementById(this.thread_parentid),a=n&&n.querySelector('[data-thread_msgid="'+this.thread_msgid+'"]');a&&a.setAttribute("data-thread_follower",this.thread_follower);var o=a?parseInt(a.getAttribute("data-thread_followercnt")):parseInt(this.partcount);i?o++:t||0==t?o+=parseInt(t):!s&&0!=s||(o-=parseInt(s)),a&&a.setAttribute("data-thread_followercnt",o),this.partcount=o,this.updatePartCount(o),i&&$WC.$CUtil.setInnerText(this.followernode,$WC.I18N("thread.unfollow"))}},ChatWindow.prototype.selectChat=function(){WindowHandler.lastViewed!=this.winIndex&&-1!=WindowHandler.lastViewed&&null!=WindowHandler.exist[WindowHandler.lastViewed]&&"empty"!=WindowHandler.exist[WindowHandler.lastViewed]&&(this.prevIndex=WindowHandler.lastViewed),WindowHandler.lastViewed=this.winIndex},ChatWindow.prototype.getMeFront=function(){this.selectChat()},ChatWindow.prototype.getScode=function(){return this.scode},ChatWindow.prototype.getSmsg=function(){return this.smsg},ChatWindow.prototype.getStype=function(){return this.stype},ChatWindow.prototype.getTitle=function(){return this.title},ChatWindow.prototype.getObjId=function(){return this.objId},ChatWindow.prototype.setObjId=function(e){this.objId=e},ChatWindow.prototype.closeAndPropagate=function(e){WebMessanger.isExclusiveChat()&&WebMessanger.isRTCChat()||(this.voicerecorderinstance.node?$WC.VoiceRecorderApi.isVoiceRecordingActive()&&$WC.VoiceRecorderApi.getActiveSessionId()==this.objId?this.throwVoiceMsgRemovalError({content:$WC.I18N("voicerecorder.endrecording"),confirmactiontext:$WC.I18N("common.continue"),confirmCallBack:function(e){$WC.VoiceRecorderApi.closeAndRemoveRecordingSession(),this.closeAndPropagate(e)}.bind(this,e)}):this.throwVoiceMsgRemovalError({confirmactiontext:$WC.I18N("common.continue"),content:$WC.I18N("voicemsg.deleteinfo"),confirmCallBack:this.closeAndPropagate.bind(this)}):(this.close(),this.propagateOperation("close"),e&&("function"==typeof e.stopPropagation?e.stopPropagation():e.cancelBubble=!0)))},ChatWindow.prototype.detachEvents=function(){Gator(this.mainwin).off(),Gator(this.actionlistnode).off(),Gator(this.editorreplydiv).off(),Gator(this.resendoverlay).off(),Gator(this.ctrlcomp.querySelector("#ctrlcomp")).off(),Gator(this.progressbarnode).off()},ChatWindow.prototype.close=function(e){if(!WebMessanger.isExclusiveChat()&&!WebMessanger.isRTCChat()){this.checkAndStoreDraftMsg(),ChatBlink.stopRepeat(),$WC.VideoPlayerFactory.removeAllComponents(this.objId),this.smileyvisible&&(this.smileycontainer.className=this.smileycontainer.className.replace(" wms-smileyborder",""),this.smileyinstance.unmountComponent(),this.smileyvisible=!1),WmsFileUploadHandler.getLivefupObj(this.objId)&&WmsFileUploadUI.cleanUpFileUpload(this.objId),this.detachEvents(),e?(WmsChatCache.remove(this.getObjId()),Message.deletedMessages.remove(this.getObjId())):this.msgdisp.firstChild&&!0===this.msgdisp.firstChild.matches("[data-loading]")?(WmsChatCache.remove(this.objId),Message.deletedMessages.remove(this.objId)):this.mutedinterval||!WebMessanger.isAutoJoinAllowed(this.title)||this.lazyload_transcript||(Message.furlVideoElement(this.msgdisp),WmsChatCache.insert(this.objId,this.msgdisp.innerHTML));function t(e,t){if(document.getElementById(t.getObjId())){$WC.Util.removeElement(t.win),WindowHandler.openedChats[t.getObjId()]="close";try{WindowHandler.exist[t.getPreIndex()].focus("",!0)}catch(e){WindowHandler.moveFocus(t.getObjId(),"",!0)}Factory.destroyDialog(t.winIndex,!0),WindowHandler.count--}}if("0"==this.savehistory&&$WC.Util.getCssAnimEndListener()){var s=$WC.Util.getCssAnimEndListener();$WC.Util.addEvent(this.win,s,t,!0,this),$WC.Util.addClass(this.win,"delete-chat")}else t(0,this);Message.PREV_SENDER["ch"+this.objId]&&delete Message.PREV_SENDER["ch"+this.objId],this.removeWindowState(),0===WindowHandler.count&&WmsMainUI.toggleSmartChatButton()}"undefined"!=typeof WmsUIImpl&&WmsImplHandler.invokeSynchronously(WmsUIImpl.handleChatWindowClose,this.ctype,this.objId,this.getChannelUID())},ChatWindow.prototype.isMaximised=function(){return this.maximized},ChatWindow.prototype.hide=function(){this.win.style.display="none"},ChatWindow.prototype.makeNormalAndPropagate=function(){this.makeNormal(!0)},ChatWindow.prototype.makeNormal=function(e,t){this.unread=!1,this.toggleUnreadBanner(),-1===this.headernode.className.indexOf("wms_cw_highlight")&&!t||($WC.Util.removeClass(this.headernode,"wms_cw_highlight"),$WC.Util.removeClass(this.barwin,"wms_cw_highlight"),e&&this.propagateOperation("seen")),silent&&!WebMessanger.isExclusiveChat()&&!WebMessanger.isRTCChat()||this.resetBarStatusIcon()},ChatWindow.prototype.highlight=function(){this.maximized?$WC.Util.addClass(this.headernode,"wms_cw_highlight"):(this.updateBarMsgcount(),$WC.Util.addClass(this.headernode,"wms_cw_highlight"),$WC.Util.addClass(this.barwin,"wms_cw_highlight")),this.unread=!0},ChatWindow.prototype.titleGlow=function(){this.maximized?$WC.Util.addClass(this.headernode,"wms-titleglow"):$WC.Util.addClass(this.barwin,"wms-titleglow"),this.focus()},ChatWindow.prototype.getInnerObject=function(e,t){return WindowHandler.getObjectInObject(this.win,e,t)},ChatWindow.prototype.checkSelectionAndFocus=function(e){""===window.getSelection().toString()&&this.focus(e)},ChatWindow.prototype.focus=function(e,t){if(e){var s=$WC.Util.getEventTarget(e);if("wmseditchattitletxt"===s.id||"true"===s.getAttribute("data-title")||"true"===s.getAttribute("data-edittitleicon")||"true"===s.getAttribute("data-videoinfo")||s.getAttribute("data-edited")||1==s.getAttribute("data-zomojiheader"))return;("true"!==s.getAttribute("data-previewable")&&"true"!==s.getAttribute("data-titlecontainer")||-1!==s.className.indexOf("zcmsg_bx"))&&this.composer.focus()}else this.composer.focus();(11==this.ctype?WmsMainUI.getUnreadCount(this.thread_parentid,null,this.objId):WmsMainUI.getUnreadCount(this.objId,null,null,!0))&&!t&&this.makeNormalAndPropagate(),this.hideActions(),this.hideVideoDropdown(),WindowHandler.checkAndHidePinmsgOptions(),ChatBlink.stopRepeat(),(this.smileyvisible||this.autocompletepickervisible)&&(this.hideSmileyUI(),this.hideReactionsUI()),this.salesiqchat&&WmsUIImpl.onComposerFocus(this.objId)},ChatWindow.prototype.maximize=function(){this.mainwin.style.display="flex",this.barwin.style.display="none",this.unread&&!this.salesiqchat?this.scrollToUnread():this.scrollDisplay(),this.focus(),this.maximized=!0,this.getMeFront(),WindowHandler.openedChats[this.getObjId()]="max",this.storeWindowState("max"),this.updateBarMsgcount(),this.changeFooterHeight(),this.fetchCompleteChannelData(),this.lazyload_transcript?(Message.loadSpecificTranscript(this.objId,this.msgdisp,this.lazyload_transcript),this.lazyload_transcript=null):this.msgdisp.clientHeight<this.ctrlcomp.clientHeight&&WMSUI.loadImages(this.ctrlcomp),!1===this.attached&&(Chat.isExists(this.objId)&&WmsMainUI.isAutoFocusScheduled(this.objId)&&WmsMainUI.removeAutoFocusSchedule(this.objId),WebMessanger.attachSession(this.objId))},ChatWindow.prototype.textAreaMinimize=function(){""===this.composer.value&&this.minimizeAndPropagate()},ChatWindow.prototype.checkAndMinimize=function(e){var t=$WC.Util.getEventTarget(e);(t.getAttribute("data-footer")||t.getAttribute("data-toolbar"))&&this.minimizeAndPropagate()},ChatWindow.prototype.minimizeAndPropagate=function(){this.disableminimize||(this.minimize(!0),this.propagateOperation("min"))},ChatWindow.prototype.minimize=function(e){this.disableminimize||(Self.Idle=!1,this.mainwin.style.display="none",this.barwin.style.display="block",this.maximized=!1,WindowHandler.lastViewed=-1,WindowHandler.openedChats[this.getObjId()]="min",e&&this.resetBarStatusIcon(),this.storeWindowState("min"))},ChatWindow.prototype.propagateOperation=function(e){var t="chid="+this.objId+"&action="+e;if("close"===e&&(t+="&uname="+myMsgObj.sender+"&sid="+encodeURIComponent(WebMessanger.getSid())),"seen"===e)if(WmsSettings.adminsettings.features&&WmsSettings.adminsettings.features.read_reciept||WebMessanger.isRTCChat())if(WebMessanger.isGuestUser()){var s={"x-cliq-guid":WebMessanger.guest_info.encrypt_id};$WC.Ajax.postRequestToChat("guestapi/v2/chats/"+this.objId+"/markread",null,null,null,null,null,s)}else{var i=this.lastmsg_uid||"",n=$WC.RecentChats.get(this.objId);(""==i||n&&n.LASTMSGINFO&&(n.LASTMSGINFO.msguid&&i!==n.LASTMSGINFO.msguid||n.LASTMSGINFO.msg.msguid&&i!==n.LASTMSGINFO.msg.msguid))&&(i=n.LASTMSGINFO.msguid),i&&$WC.Ajax.postRequestToChat("v2/chats/"+this.objId+"/messages/"+i+"/markread")}else $WC.Ajax.postRequestToChat("propagatemsgseen.do","chid="+this.objId);else $WC.Ajax.request("sendchatwindowopr.do",t)},ChatWindow.prototype.scrollDisplay=function(e,t){t=t||this.ctrlcomp,"boolean"==typeof e&&!1===e||0!==t.scrollHeight&&(t.scrollTop=t.scrollHeight-t.clientHeight)},ChatWindow.prototype.updateChatTitle=function(e){var t=this.titlenode.querySelector('[data-title="true"]');if("Group Chat"==e?e=$WC.I18N("Group_Chat"):$WC.Util.isChannelChid(this.objId)?e=e||$WC.Channels.getChannelName(this.objId):$WC.Util.isBotChid(this.objId)&&(e=$WC.Bots.getBotName($WC.Bots.getBotId(this.objId))||e),this.title=e,e=$WC.Util.unescapeHTML(e),$WC.$CUtil.setInnerText(t,e),$WC.$CUtil.setInnerText(this.bartitlenode,e),t.setAttribute("title",e),"11"==this.ctype){var s=document.getElementById(this.thread_parentid),i=s&&s.querySelector('[data-thread_msgid="'+this.thread_msgid+'"]');i&&i.setAttribute("data-thread_title",e)}},ChatWindow.prototype.setTitle=function(e){this.updateChatTitle(e)},ChatWindow.prototype.setIndex=function(e){this.winIndex=e},ChatWindow.prototype.getIndex=function(){return this.winIndex},ChatWindow.prototype.getPreIndex=function(){return this.prevIndex},ChatWindow.prototype.setPreIndex=function(e){this.prevIndex=e},ChatWindow.prototype.isMinimized=function(){return!this.maximized},ChatWindow.prototype.updateParticipantsFromJoin=function(e,t){this.addParticipants(e,!1,t)},ChatWindow.prototype.getImageUrl=function(){return this.imgurl},ChatWindow.prototype.updateAvatar=function(){var e="";e=1!=this.ctype||2!=this.partcount||this.customgroup&&"false"!=this.customgroup?$WC.Util.isChannelChid(this.objId)?$WC.HybridSearch.generateImageHtml(this.objId,$WC.WmsConstants.HYBRIDSEARCH.CHANNEL):$WC.Util.isBotChid(this.objId)?$WC.HybridSearch.generateImageHtml($WC.Bots.getBotId(this.objId),$WC.WmsConstants.HYBRIDSEARCH.BOT):11==this.ctype?$WC.HybridSearch.generateImageHtml(this.recipant,$WC.WmsConstants.HYBRIDSEARCH.THREAD,{TITLE:this.title}):$WC.HybridSearch.generateImageHtml(this.objId,$WC.WmsConstants.HYBRIDSEARCH.CHAT,{TITLE:this.title,SALESIQCHAT:this.salesiqchat},!0):$WC.HybridSearch.generateImageHtml(this.recipant,$WC.WmsConstants.HYBRIDSEARCH.CONTACT),this.avatarnode.innerHTML=e,$WC.Util.loadOriginalImage(this.avatarnode,null,!0),this.baravatarnode.innerHTML=e,$WC.Util.loadOriginalImage(this.baravatarnode,null,!0)},ChatWindow.prototype.updateChannelImage=function(){var e=$WC.HybridSearch.generateImageHtml(this.objId,$WC.WmsConstants.HYBRIDSEARCH.CHANNEL);this.updateAvatar(e)},ChatWindow.prototype.updateBotImage=function(e){var t=$WC.HybridSearch.generateImageHtml(e,$WC.WmsConstants.HYBRIDSEARCH.BOT);this.updateAvatar(t)},ChatWindow.prototype.updateWebUrl=function(e){var t=JSON.parse(e).weburl||JSON.parse(e).openurl;t&&this.updateUserStatus("",t)},ChatWindow.prototype.clearChatContent=function(){this.msgdisp.innerHTML=""},ChatWindow.prototype.updateInfoMsgTemplate=function(e){var t=JSON.parse(e).infomsgtemplate;this.addinfotemplate=t&&t.addmem,this.deleteinfotemplate=t&&t.deletemem,this.titleinfotemplate=t&&t.chattitle},ChatWindow.prototype.populateParticipants=function(){var e,t="10",s=" ";if(1!=this.ctype||2!=this.partcount||this.customgroup&&"false"!=this.customgroup){if(8!=this.ctype){var i=$WC.HybridSearch.generateImageHtml(this.objId,$WC.WmsConstants.HYBRIDSEARCH.CHAT,{TITLE:this.title,SALESIQCHAT:this.salesiqchat},!0);this.updateAvatar(i),s=this.getGroupStatus(),this.statusmsgnode.title="",$WC.Util.addClass(this.statusmsgnode,"wms_cw_activeusers"),this.recentchatsnode.style.display="none",this.videoinfonode.className="wms_cw_primetime",this.videoinfonode.setAttribute("title",$WC.I18N("videobroadcast.primetime")+" - "+$WC.I18N("videobroadcast.dlg.imagetitle")),delete WebMessanger.ucmap[WebMessanger.chatmap[this.objId]],delete WebMessanger.chatmap[this.objId]}}else{var n=$WC.Util.isLocalUser(Object.keys(this.partinfo)[0])?Object.keys(this.partinfo)[1]:Object.keys(this.partinfo)[0];n&&(i=$WC.HybridSearch.generateImageHtml(n,$WC.WmsConstants.HYBRIDSEARCH.CONTACT),this.updateAvatar(i),t=WmsContacts.status(n)||this.partinfo[n].scode,s=WmsContacts.getStatusMsg(n),e=WMSUI.getStype(this.partinfo[n].st),"0"===t&&"2"===t||(this.composer.placeholder="")),this.recentchatsnode.style.display="block",this.videoinfonode.className="wms_cw_videoinfo",this.videoinfonode.removeAttribute("title")}"10"===this.ctype&&(s=this.entityweburl||s),8!=this.ctype&&this.updateUserStatus(t,s,e)},ChatWindow.prototype.addParticipants=function(e,t,s){e.forEach(function(e){this.partinfo[e.uname||e.zuid]=e},this),t&&(this.updateParticipantsCount(),this.fetchparticipants=!0),s||this.populateParticipants()},ChatWindow.prototype.getGroupStatus=function(){var e=$WC.Util.getObjectLength(this.partinfo),t=null!=this.partinfo[WebMessanger.zuid]?e:e+1,s=t+" "+(2<=t?$WC.I18N("chat.participants"):$WC.I18N("chat.participant"));return 0==t&&(s=$WC.I18N("chat.participants.none")),s},ChatWindow.prototype.updateParticipantsCount=function(){this.partcount=$WC.Util.getObjectLength(this.partinfo)+1},ChatWindow.prototype.deleteParticipants=function(e){for(var t=0;t<e.length;t++){var s=e[t].uname;this.partinfo&&this.partinfo[s]&&delete this.partinfo[s]}this.updateParticipantsCount(),this.populateParticipants()},ChatWindow.prototype.updateAddInfo=function(e){if(e){for(var t=e.split(":"),s={},i=0;i<t.length;i+=2){var n=t[i];null!=n&&(s[n]=null!=t[i+1]?t[i+1]:"")}this.addinfo=s}},ChatWindow.prototype.isPrivateReplyAllowed=function(e){return!!!$WC.Util.isLocalUser(e.getAttribute("data-sender"))&&("1"==this.ctype&&2<this.partcount||"8"==this.ctype)},ChatWindow.prototype.isLiveSupportChat=function(){return this.getChatType()==CT_NFY_LIVESUPPORT},ChatWindow.prototype.isZohoGroupChat=function(){return this.getChatType()==CT_NFY_ZOHOGROUP||"true"===this.customgroup&&"1"===this.ctype},ChatWindow.prototype.getChatType=function(){try{return this.addinfo.CT_TYPE}catch(e){return null}},ChatWindow.prototype.getToolBarStatus=function(){return!("5"===this.ctype||"8"===this.ctype||"10"===this.ctype||"11"===this.ctype||2!=this.partcount||!1!==this.isLiveSupportChat()||!1!==this.isZohoGroupChat()||!0===this.salesiqchat||!(WebMessanger.isMediaCallEnabled(WMSUI.avCall.CALL_TYPE_VIDEO)||WebMessanger.isMediaCallEnabled(WMSUI.avCall.CALL_TYPE_VOICE)||WebMessanger.isMediaCallEnabled(WMSUI.avCall.CALL_TYPE_SCREENSHARE)))},ChatWindow.prototype.checkAndHideVideoDropdown=function(e){e.relatedTarget&&(e.relatedTarget.getAttribute("data-videodropdown")||e.relatedTarget.closest("[data-videodropdown=true]"))||this.hideVideoDropdown()},ChatWindow.prototype.toggleVideoDropdown=function(e){this.videodropdownshown?(this.hideVideoDropdown(),this.videodropdownshown=!1):(this.showVideoDropdown(e),this.videodropdownshown=!0)},ChatWindow.prototype.hideVideoDropdown=function(){this.videodropdownnode.style.display="none",this.videodropdownnode.className="wms_videoinfo_dropdown",this.videodropdownshown=!1},ChatWindow.prototype.showVideoDropdown=function(e){if(!e||"wms_cw_videoinfo"===$WC.Util.getEventTarget(e).id)if(this.getToolBarStatus()){var t="none",s="none",i="none";try{WebMessanger.isMediaCallEnabled(WMSUI.avCall.CALL_TYPE_VIDEO)&&WmsSettings.getAdminSetting("isMediacallAllowed")&&(t="block")}catch(e){}try{WebMessanger.isMediaCallEnabled(WMSUI.avCall.CALL_TYPE_VOICE)&&WmsSettings.getAdminSetting("isMediacallAllowed")&&(s="block")}catch(e){}try{WebMessanger.isMediaCallEnabled(WMSUI.avCall.CALL_TYPE_SCREENSHARE)&&WmsSettings.getAdminSetting("isMediacallAllowed")&&(i="block")}catch(e){}if("none"===t&&"none"===s&&"none"===i)this.videoinfonode.style.display="none";else if(e){"none"!==s&&(this.audioiconnode.style.display="block"),"none"!==t&&(this.videoiconnode.style.display="block"),"none"!==i&&(this.shareiconnode.style.display="block"),this.videodropdownnode.style.display="block"}else this.videoinfonode.style.display="inline-flex"}else(this.isZohoGroupChat()||2<this.partcount&&"1"===this.ctype||"8"===this.ctype)&&WebMessanger.isCliqUser()&&($WC.$CUtil.isChrome()||$WC.$CUtil.isFirefox())?(this.videoinfonode.className="wms_cw_primetime",this.videoinfonode.setAttribute("title",$WC.I18N("videobroadcast.primetime")+" - "+$WC.I18N("videobroadcast.dlg.imagetitle"))):this.videoinfonode.style.display="none"},ChatWindow.prototype.clearTypingStatus=function(){var e=this.typingstatusnode;$WC.Util.addClass(e,"wms_cw_typingstatus_animate"),e.setAttribute("data-typingstatus",!1)},ChatWindow.prototype.handleMediaCall=function(e){if(this.getToolBarStatus()){var t=this.recipant;if(0<t.length){var s=$WC.Util.getEventTarget(e);s.getAttribute("data-audioicon")?WMSUI.makeMediaCall(WMSUI.avCall.CALL_TYPE_VOICE,t):s.getAttribute("data-videoicon")?WMSUI.makeMediaCall(WMSUI.avCall.CALL_TYPE_VIDEO,t):s.getAttribute("data-shareicon")&&WMSUI.makeMediaCall(WMSUI.avCall.CALL_TYPE_SCREENSHARE,t)}}this.checkAndHideVideoDropdown(e),e.stopPropagation()},ChatWindow.prototype.startPrimeTime=function(){if(this.isZohoGroupChat()||2<this.partcount&&"1"===this.ctype||"8"===this.ctype){var e=_WMSCHATURL+"startprimetime.do?chid="+encodeURIComponent(this.objId),t=WmsSettings.primetime_onboard_count;if(2<t)window.open(e);else{var s="primetime_onboard_count="+(parseInt(t)+1);if(WebMessanger.updateSettings(s),null===document.getElementById("zcwindows")){var i=$WC.Util.createElement("div","zcwindows","zcoverlay");i.style.zIndex=WebMessanger.setzindex,document.body.appendChild(i)}var n='<div class="mcontent"><div class="zcprime_lhs"><img src="https://img.zohocdn.com/ichat/images/bar/642320e3_pt_dialog.png" width="280" height="218" /><strong class="zcprime_content">'+$WC.I18N("videobroadcast.dlg.imagetitle")+'</strong></div><div class="zcprime_rhs"><p>'+$WC.I18N("videobroadcast.dlg.title")+'</p><ul><li class="mcontent_p">'+$WC.I18N("videobroadcast.dlg.desc1")+'</li><li class="mcontent_p">'+$WC.I18N("videobroadcast.dlg.desc2")+'</li><li class="mcontent_p">'+$WC.I18N("videobroadcast.dlg.desc3")+'</li></ul><a href=" '+_PRIMETIMEHELPLINK+'" target="_blank">'+$WC.I18N("common.learnmore")+'</a><div class="zcprime_confirm"><p>'+$WC.I18N("videobroadcast.dlg.session")+'</p><div id="primetime_start_confirm" class="zcdbtn">'+$WC.I18N("videobroadcast.dlg.proceed")+"</div></div></div></div>";$WC.$Win.create({id:"primetime_trigger",header:'<div class="wms_cw_primetime "><strong>'+$WC.I18N("videobroadcast.primetime")+"</strong></div>",html:n,class:"zcprime"});var a=document.getElementById("primetime_start_confirm");Gator(a).on("click",function(){$WC.$Win.destroy("primetime_trigger"),window.open(e)})}}},ChatWindow.prototype.toggleActions=function(){"block"===this.actionlistnode.style.display?this.hideActions():($WC.Util.addClass(this.actionbutton,"wms_cw_toolbar_actionbutton_selected"),this.actionlistnode.style.display="block",this.makeNormalAndPropagate())},ChatWindow.prototype.hideActions=function(){"block"===this.actionlistnode.style.display&&(this.actionlistnode.style.display="none",$WC.Util.removeClass(this.actionbutton,"wms_cw_toolbar_actionbutton_selected"),this.makeNormalAndPropagate())},ChatWindow.prototype.getActions=function(s){if(!this.actionlistnode.querySelector('[data-purpose="wms_botactions"]')){var e=$WC.Bots.get(s),i=this.objId;if(!$WC.Util.isEmpty(e)&&e.actionhandles&&e.actionhandles.length)this.updateActionsUI(s);else{$WC.Bots.updateBotActions(s,[]);var t="v1/bots/"+s+"/getactions";$WC.Ajax.requestToChat(t,null,function(){var e=JSON.parse(this.response);$WC.Bots.updateBotActions(s,e.data.actions);var t=WindowHandler.getWinObjById(i);t&&(t.updateActionsUI(s),t.updatePinnedInfo(t.ispinned))},function(){$WC.Bots.updateBotActions(s,void 0)})}}},ChatWindow.prototype.updateActionsUI=function(e){var t="",s=$WC.Bots.get(e);if(!$WC.Util.isEmpty(s)&&void 0!==s.actionhandles)for(var i=0;i<s.actionhandles.length;i++){var n=s.actionhandles[i];t+='<div data-purpose="wms_botactions" data-botid="'+e+'" data-exec_id="'+n.id+'" data-display_props="'+n.display_props.name+'" class="wms_cw_toolbar_actionitem wms_botactionicn">'+n.display_props.name+"</div>"}this.actionlistnode.insertAdjacentHTML("beforeend",t)},ChatWindow.prototype.populateChatTitleEdit=function(){return'<form data-titleform="true"><input type="text" class="'+(2<this.partcount||this.isLiveSupportChat()||this.isZohoGroupChat()?"wms-gni":"wms-cni")+'" id="wmseditchattitletxt" autocomplete="off"/></form>'},ChatWindow.prototype.checkkey=function(e){27==e.keyCode&&this.setTitle(this.getTitle())},ChatWindow.prototype.focusChatTitle=function(){var e=this.getInnerObject("wmseditchattitletxt","INPUT");e.select(),e.focus()},ChatWindow.prototype.openInCliq=function(){var e=_WMSCHATURL+"chats/"+this.objId;window.open(e,"_blank").opener=null},ChatWindow.prototype.getRecentChats=function(){2==this.partcount&&this.recipant&&ZMSGUI.showChatHistory(this.recipant),this.hideActions()},ChatWindow.prototype.muteChat=function(e){var t=!0,s=$WC.Util.getEventTarget(e).getAttribute("data-duration");this.mutedinterval&&"-1"!==this.mutedinterval?t=!1:s=s||"-1",this.updateMuteInfo(t),this.hideActions(),WebMessanger.muteChat(this.objId,s,t)},ChatWindow.prototype.unsubscribeBot=function(e){var t="b-"+$WC.Bots.getBotId(this.objId);$WC.Ajax.postRequestToChat("v1/bots/"+t+"/unsubscribe"),this.closeAndPropagate(e)},ChatWindow.prototype.leaveChat=function(e){WMSUI.leaveChat(this.objId,this.title)},ChatWindow.prototype.followThread=function(e){WebMessanger.followThread(this.objId,this.thread_follower),this.hideActions()},ChatWindow.prototype.showInfoMsg=function(e){this.showErrorMsg(e,"info")},ChatWindow.prototype.showErrorMsg=function(e,t){$WC.$CUtil.setInnerText(this.errormsgnode,e),this.errormsgnode.className="info"===t?"wms_cw_infomsg wms-halign":"wms_cw_errormsg wms-halign",this.errormsgnode.style.display="block",this.error_timer=setTimeout(function(e){e.hideErrorMsg()},3e3,this)},ChatWindow.prototype.hideErrorMsg=function(){this.errormsgnode.style.display="",$WC.$CUtil.setInnerText(this.errormsgnode,"")},ChatWindow.prototype.pinChat=function(){WebMessanger.pinChat(this.objId,!this.ispinned),this.hideActions()},ChatWindow.prototype.revertTitle=function(){var e=WmsContacts.getDisplayName(this.recipant)||this.partinfo[this.recipant].dname;WebMessanger.setChatTitle(this.objId,e,this.title),this.hideActions()},ChatWindow.prototype.toggleChatTitle=function(){"cleartitle"===this.getInnerObject("wms-chattitle","P").getAttribute("data-purpose")?WebMessanger.setChatTitle(this.objId,""):this.editChatTitle()},ChatWindow.prototype.editChatTitle=function(){if(!("1"===this.ctype&&2===this.partcount||"9"===this.ctype||"8"===this.ctype||"5"===this.ctype||"10"===this.ctype||"wmseditchattitletxt"===document.activeElement.id||WMSUI.showErrorIfPermDenied(this.objId)||"4"===this.ctype&&this.salesiqchat||WebMessanger.isExclusiveChat()||WebMessanger.isRTCChat())){var e=this.titlenode.querySelector('[data-title="true"]');e.innerHTML=this.populateChatTitleEdit(),WindowHandler.getObjectInObject(e,"wmseditchattitletxt","INPUT").value=$WC.Util.unescapeHTML(this.getTitle()),this.focusChatTitle()}},ChatWindow.prototype.checkChatTitle=function(e){try{if(200<(e=e.trim()).length)return this.focusChatTitle(),!1;this.setTitle(unescape(this.getTitle()))}catch(e){return!1}},ChatWindow.prototype.saveChatTitle=function(e){e=e.trim();var t=this.getTitle();if(t!=e){if(0==e.length)return alert($WC.I18N("Please_enter_the_chat_title")),this.focusChatTitle(),!1;if(200<e.length)return alert($WC.I18N("Max_200_chatracters_allowed_for_chat_title")),this.focusChatTitle(),!1;WebMessanger.setChatTitle(this.objId,e,t),this.setTitle(e)}else this.setTitle(e)},ChatWindow.prototype.insertAddParticipant=function(e){if(this.hideActions(),!WMSUI.showErrorIfPermDenied(this.objId)){var t=this.composer.selectionStart;this.composer.value=this.composer.value.substring(0,t)+"+"+this.composer.value.substring(t),$WC.Util.moveCaretPosition(this.composer,t+1,t+1),WMSUI.handleStatus(e,this.composer,this.objId)}},ChatWindow.prototype.setHistoryStorage=function(){this.hideActions(),WMSUI.showErrorIfPermDenied(this.objId)||("0"===this.savehistory?(WebMessanger.setHistoryStorage("enable",this.objId),$WC.$CUtil.setInnerText(this.actionlistnode.querySelector("[data-historyoff]"),$WC.I18N("history.off"))):(WebMessanger.setHistoryStorage("disable",this.objId),$WC.$CUtil.setInnerText(this.actionlistnode.querySelector("[data-historyoff]"),$WC.I18N("history.on"))))},ChatWindow.prototype.leaveChannel=function(){WebMessanger.leaveChannel(this.objId),this.hideActions()},ChatWindow.prototype.handleCopyPermaLink=function(e){var t=$WC.Channels.get(this.objId);e="click"==e.type?t.un:e;var s=_WMSCHATURL+"channels/"+e,i=document.getElementById("wmstoolbar");$WC.Util.copyTextToClipboard(s,i),WMSUI.showInfoMsg($WC.I18N("channel.permalink.banner")),WindowHandler.getWinObjById(this.objId)&&this.hideActions()},ChatWindow.prototype.closeThread=function(){var e=this.objId,t=new $WC.ConfirmationDialog,s=[$WC.I18N("thread.close.header",[this.title])],i={actions:[{text:$WC.I18N("thread.action.close"),onclick:function(){WebMessanger.closeThread(e),t.unmountComponent()},buttonstyle:"destructive_button"},{text:$WC.I18N("common.cancel"),onclick:function(){t.unmountComponent()},buttonstyle:"cancel_button"}],heading:[s],bodytitle:$WC.I18N("info.thread.close.info1")};t.mountComponent(i),this.hideActions()},ChatWindow.prototype.updateSaveHistory=function(e){this.savehistory=e},ChatWindow.prototype.updateSaveHistoryInUI=function(){"0"===this.savehistory?($WC.$CUtil.setInnerText(this.actionlistnode.querySelector("[data-historyoff]"),$WC.I18N("history.on")),WmsChatCache.get(this.objId)||this.updateInfoMessage($WC.I18N("history.message"))):"1"===this.savehistory&&$WC.$CUtil.setInnerText(this.actionlistnode.querySelector("[data-historyoff]"),$WC.I18N("history.off"))},ChatWindow.prototype.changeActive=function(){WMSUI.handleDocumentActive()},ChatWindow.prototype.joinChat=function(){null!=this.objId&&setTimeout("WebMessanger.join('"+this.objId+"')",3e3)},ChatWindow.prototype.populateGroupMembers=function(){WMSUI.showParticipantsList(this.objId,this.title)},ChatWindow.prototype.showProgress=function(e){var t=e/100,s=this.progressbarnode.querySelector("[data-progressbar-basic]");if(-1==e){var i='<div class="wms_progressbar_failure_text">'+$WC.I18N("Sharing_failed")+'<span class="wms_cw_progressbar_cls" data-clearprogress="true" ><span class="wms_cw_opr_close"></span></span></div>';this.progressbarnode.style.display="block",s.setAttribute("data-progressbar-basic","true"),s.innerHTML=i}else if("false"==s.getAttribute("data-progressbar-basic")||0==e)i='<div class="wms_cw_progress_shadow"><div class="wms_cw_progressholder"><div class="wms-loading-sub" data-progressindicator="true" style="transform: scaleX('+t+')"></div></div><span id="wmsloadingtxt"class="wms-loading-text" data-progresstext="true">'+$WC.I18N("Sharing")+" "+e+"%</span></span></div>",this.progressbarnode.style.display="block",s.setAttribute("data-progressbar-basic","true"),s.innerHTML=i;else{this.progressbarnode.querySelector("[data-progressindicator]").style.transform="scaleX("+t+")";var n=this.progressbarnode.querySelector("[data-progresstext]");$WC.$CUtil.setInnerText(n,$WC.I18N("Sharing")+" "+e+"%")}},ChatWindow.prototype.clearProgress=function(){this.progressbarnode.style.display="none";var e=this.progressbarnode.querySelector("[data-progressbar-basic]");e.setAttribute("data-progressbar-basic","false"),e.innerHTML=""},ChatWindow.prototype.removeSendFile=function(){this.attachmentnode.style.display="none"},ChatWindow.prototype.storeWindowState=function(e){WebMessanger.isExclusiveChat()||WebMessanger.isRTCChat()||$WC.WmsSessionStorage.setChatInfo({chid:this.objId,state:e})},ChatWindow.prototype.removeWindowState=function(){$WC.WmsSessionStorage.removeChatState(this.objId)},ChatWindow.prototype.updateAttachInfo=function(e){this.attached=e},ChatWindow.prototype.replaceMessages=function(e){$WC.Util.isArray(e)&&0<e.length&&(Message.constructAndAppendChatContent(e,this.msgdisp,this.getObjId()),this.scrollDisplay())},ChatWindow.prototype.isMsgAlreadyUpdated=function(e,t){return!!t.querySelector('[data-msgid="'+e.sender+"_"+e.msgid+'"],[data-msgid="'+e.sender+"_"+e.time+'"]')},ChatWindow.prototype.updateMessage=function(e){var t=this.ctrlcomp,s=this.scrollDisplay,i=t.scrollHeight-t.clientHeight<=t.scrollTop+20,n={};n=Message.isMetaMsg(e)?$WC.Util.cloneObject(e,!0):e,$WC.Util.isArray(n)||(n=[n]);var a=this.msgdisp.querySelectorAll("#"+this.msgdisp.id+" > [data-senderzuid]");if(0<a.length)var o=a[a.length-1].getAttribute("data-senderzuid");var r=this.msgdisp.querySelectorAll("[data-msgtime]");if(0<r.length)var l=r[r.length-1].getAttribute("data-msgtime");""==l&&r[r.length-2]&&(l=r[r.length-2].getAttribute("data-msgtime"));var d=$WC.Util.isLocalUser(n[0].sender);if(n[0]&&Message.isDelayMsg(n[0])){var c=parseInt(n[0].meta.config.d);clearTimeout(this.msgdelaytimer),this.msgdelaytimer=setTimeout(function(){Message.constructAndAppendChatContent(n,this.msgdisp,this.getObjId(),o,l),s(i,t)}.bind(this),c)}else{this.typingstatusnode.getAttribute("data-typingstatus")&&this.typingstatusnode&&!d&&($WC.Util.addClass(this.typingstatusnode,"wms_cw_typingstatus_animate"),clearTimeout(Self.Timer[this.getObjId()]));var m=this.msgdisp.lastChild,u=!(!m||!m.getAttribute("data-loadmorebutton")&&!m.getAttribute("data-loadmore"));if(u&&(l=o=""),Message.constructAndAppendChatContent(n,this.msgdisp,this.getObjId(),o,l),Message.checkAndRemoveUrlImage(this.msgdisp),d&&"true"==this.msgdisp.lastChild.getAttribute("data-timefrag")&&("TEXTMSG"===Message.getMessageType(e)||"REPLYMSG"===Message.getMessageType(e))&&e.sentfromcomposer&&(this.msgdisp.lastChild.innerText=$WC.I18N("message.status.sending")),u){var p=$WC.Util.constructTranscriptLoadButton();m.insertAdjacentHTML("afterend",p),$WC.Util.removeElement(m)}else d&&(this.clearUnreadMarker(),this.scrollDisplay())}this.scrollDisplay(i,t),"undefined"!=typeof WmsUIImpl&&WmsImplHandler.invoke(WmsUIImpl.handleNewMessage,this.ctype,this.objId,this.getChannelUID(),n[0]&&n[0].msg)},ChatWindow.prototype.updateUnreadThreadCount=function(e,t){var s=WmsMainUI.getUnreadCount(e,null,t),i=this.ctrlcomp.querySelector('[data-thread_chid="'+t+'"]');if(i){var n=i.querySelector('[id="wms_threadlinkwrapper"]');$WC.Util.removeElement(n.querySelector('[id="wms_unreadthreadcount"]')),s&&n.insertAdjacentHTML("beforeend",'<span id="wms_unreadthreadcount" class="wms_menu_item_count wms_threadunread_count">'+s+"</span>")}},ChatWindow.prototype.updateMessageFragment=function(e,t,s){var i=this.ctrlcomp;t=t||e.sender+"_"+e.msgid;var n=i.querySelector('[data-msgid="'+t+'"]')||s&&i.querySelector('[data-msguid="'+s+'"]');if(n&&(!n.parentNode.closest("[data-type]")||n.parentNode.closest("[data-type]").getAttribute("data-type")!==Message.types.THREADMSG)){var a=Message.getMessageType(e);if(a===Message.types.THREADLINKMSG){(v=$WC.Util.cloneObject(e,!0)).msguid=s,h=Message.constructChatContent([v],i,this.objId,e.sender);var o=n;o.className="",n.outerHTML=h,(n=i.querySelector('[data-msgid="'+t+'"]')).parentNode.replaceChild(o,n);var r=o.querySelector('[class="wms_reaction_frag"]');r&&($WC.Util.removeElement(o.querySelector('[class="wms_reaction_frag"]')),o.parentNode.closest("[data-msgid]").appendChild(r))}else if(Message.isMetaMsg(e)||a===Message.types.IMGATT||a===Message.types.FILEATT||a===Message.types.AUDIOATT||a===Message.types.VIDEOATT){var l=i.scrollHeight-i.clientHeight<=i.scrollTop+20,d={};Message.isMetaMsg(e)?(d.dname=e.dname,d.meta=e.meta,d.msg=e.msg,d.msgid=e.msgid||t,d.sender=e.sender,d.time=e.time,d.msguid=e.msguid,e.reactions&&(d.reactions=e.reactions),e.mod&&(d.mod=e.mod)):d=e,$WC.Util.isArray(d)||(d=[d]);var c=i.querySelectorAll("[data-senderzuid]");if(0<c.length){var m=c[c.length-1].getAttribute("data-senderzuid");e.meta&&(e.meta.message_source||e.meta.btnindexvsdetails||e.meta.native_widget)&&(m=d[0].sender)}var u=i.querySelectorAll("[data-msgtime]");if(0<u.length)var p=u[u.length-1].getAttribute("data-msgtime");if(!n.querySelector("[data-furl]")||n.querySelector("[data-previewable]")&&n.querySelector("[data-localattachment]")||a==Message.types.VIDEOATT){var h=Message.constructChatContent(d,"",e.chid,m,p);return n.nextSibling&&"wms-msgtime"===n.nextSibling.className&&$WC.Util.removeElement(n.nextSibling),n.outerHTML=h,Message.checkAndRemoveUrlImage(this.msgdisp),void this.scrollDisplay(l,i)}n.querySelector("[data-furl]").setAttribute("data-msguid",d[0].msguid);var g="/"+_CHATCONT+"/v1/attachments/"+d[0].msg.url;if(n.querySelector("[data-furl]").setAttribute("data-src",d[0].msg.url),n.querySelector("[href]"))for(var f=n.querySelectorAll("[href]"),C=0;C<f.length;C++)f[C].href=g;n.querySelector("[data-filefrwrd]")&&n.querySelector("[data-filefrwrd]").setAttribute("data-furl",d[0].msg.url),n.querySelector("img[data-previewable]")&&(n.querySelector("img[data-previewable]").setAttribute("data-fsrc",d[0].msg.url),n.querySelector("img[data-previewable]").setAttribute("data-furl",d[0].msg.url),n.querySelector("img[data-previewable]").setAttribute("data-src",d[0].msg.url)),n.querySelector("[data-media]")&&n.querySelector("[data-media]").setAttribute("source",g),n.querySelector("[data-fcontent]")&&n.querySelector("[data-fcontent]").setAttribute("data-fcontent",d[0].msg.content)}else $WC.$CUtil.setInnerText(n.querySelector('[class="wms-msgtime"]'),$WC.DateUtil.formatTime(e.time));if(e.mtype===""+CT_EDITED_MSG){var v,b="";if(n.nextSibling&&"wms-msgtime"===n.nextSibling.className){b=n.nextSibling.getAttribute("data-read");var y=n.querySelector("[data-thread_chid]");if(y){var _={};_.chat_id=y.getAttribute("data-thread_chid"),_.follower_count=y.getAttribute("data-thread_followercnt"),_.is_follower=y.getAttribute("data-thread_follower"),_.message_count=y.getAttribute("data-thread_msgcount"),_.thread_message_id=y.getAttribute("data-thread_msgid"),_.title=y.getAttribute("data-thread_title")}$WC.Util.removeElement(y),$WC.Util.removeElement(n.nextSibling)}for(var W=n;W&&!W.getAttribute("data-senderzuid");)W=W.previousSibling;if(e.msg.mtype=e.mtype,(v=$WC.Util.cloneObject(e.msg,!0)).msg["img-data"]="",v.is_read=!(!v.is_read&&"true"!==b),_&&(v.thread_information=_),n.getAttribute("data-starselected")&&(v.star="true"==n.getAttribute("data-starselected"),v.startype=parseInt(n.getAttribute("data-startype"))),h=Message.constructChatContent([v],i,this.objId,W.getAttribute("data-senderzuid")),n.outerHTML=h,Message.checkAndRemoveUrlImage(this.msgdisp),this.updateReactionFragment(e.msg.msguid),n.setAttribute("data-msgtime",e.msg.origin_time),n.setAttribute("data-msgid",e.msg.sender+"_"+e.msg.origin_time),n.setAttribute("data-msguid",e.msg.msguid),(n=i.querySelector('[data-msgid="'+t+'"]')).nextSibling&&"wms-msgtime"===n.nextSibling.className){var S=n.nextSibling.querySelector("[data-timetext]");$WC.$CUtil.setInnerText(S,$WC.DateUtil.formatTime(e.msg.origin_time)),n.nextSibling.querySelector("[data-edited]").setAttribute("data-edited","true")}}else n.removeAttribute("data-notack"),n.setAttribute("data-msgtime",e.time),n.setAttribute("data-msgid",e.sender+"_"+e.time),"0"!==this.savehistory&&n.setAttribute("data-msguid",e.msguid)}},ChatWindow.prototype.updateReactionFragment=function(e){var t=this.ctrlcomp.querySelector('[data-msguid="'+e+'"]');if(t){var s=t.querySelector(".wms_reaction_frag"),i=Message.getScrollHeight(this.ctrlcomp),n=Message.getScrollTop(this.ctrlcomp);s?(this.reactions[e]?s.outerHTML=Message.constructReactionsFragment(this.reactions[e].data,this.reactions[e].list):s.outerHTML="",WMSUI.checkAndLoadCustomEmojis(this.ctrlcomp)):this.reactions[e]&&(t=t.nextSibling.getAttribute("data-thread_chid")?t.nextSibling:t).insertAdjacentHTML("beforeend",Message.constructReactionsFragment(this.reactions[e].data)),Message.restoreScrollPosition(this.ctrlcomp,i,n)}Message.toggleLiveZomoji(this.ctrlcomp)},ChatWindow.prototype.updateCurrentUserReactionData=function(e,t){var s=t[301],i=t.opr;for(var n in s){var a="add"==i?s[n].split(":")[1]:s[n];if(this.reactions[e]&&this.reactions[e].data[n]){var o=this.reactions[e].data[n].users?this.reactions[e].data[n].users:this.reactions[e].data[n],r=this.getReactionIndex(o,a);"add"==i&&(-1!=r?o[r]=s[n]:(o.push(s[n]),this.reactions[e].data[n].hasCurrentUserReacted="true")),"delete"==i&&-1!=r&&o.splice(r,1)}}},ChatWindow.prototype.checkAndUpdateThreadReaction=function(e,t,s){var i=this.ctrlcomp.querySelector('[data-msguid="'+e+'"]');if(i&&i.getAttribute("data-type")==Message.types.THREADLINKMSG){var n=i.querySelector("[data-thread_chid]").getAttribute("data-thread_chid");winobj=WindowHandler.getWinObjById(n),winobj&&(s==CT_MSG_REACT_CURR?winobj.updateCurrentUserReactionData(e,$WC.Util.cloneObject(t)):s==CT_MSG_REACT&&winobj.updateReactionData(e,$WC.Util.cloneObject(t)),winobj.updateReactionFragment(e))}},ChatWindow.prototype.getReactionIndex=function(e,t){return e.indexOf(e.find(function(e){if(-1!==e.indexOf(":"+t+":"))return!0}))},ChatWindow.prototype.updateReactionData=function(e,t){var s=Object.keys(t);if(0===s.length)delete this.reactions[e];else{if(this.reactions[e]&&this.reactions[e].list.length){for(var i=this.reactions[e].list,n=s,a=[],o=0;o<i.length;o++)-1!==n.indexOf(i[o])&&a.push(i[o]);for(var r=0;r<n.length;r++)-1===a.indexOf(n[r])&&a.push(n[r]);this.reactions[e].list=a}else this.reactions[e]={list:[],data:{}},this.reactions[e].list=WMSUI.checkAndSortReactions(t);for(var l in t)if(t[l].count&&this.reactions[e]&&this.reactions[e].data[l]&&"true"==this.reactions[e].data[l].hasCurrentUserReacted){var d=t[l].users;if(t[l].hasCurrentUserReacted="true",-1==this.getReactionIndex(d,WebMessanger.zuid)){var c=this.reactions[e].data[l].users,m=this.getReactionIndex(c,WebMessanger.zuid);-1!=m?t[l].users.push(c[m]):t[l].users.push(Date.now()+":"+WebMessanger.zuid+":"+WebMessanger.nname)}}this.reactions[e].data=t}},ChatWindow.prototype.updateMyReactionData=function(e,t,s){if(s){var i=this.reactions[e].data[t].users?this.reactions[e].data[t].users:this.reactions[e].data[t];if(this.reactions[e].data[t].count){var n=parseInt(this.reactions[e].data[t].count);n--,this.reactions[e].data[t].count=n+""}var a=i.indexOf(i.find(function(e){if(-1!==e.indexOf(":"+WebMessanger.zuid+":"))return!0}));i.splice(a,1),this.reactions[e].data[t].hasCurrentUserReacted="false",0===i.length&&(delete this.reactions[e].data[t],this.reactions[e].list.splice(this.reactions[e].list.indexOf(t),1)),0===this.reactions[e].list.length&&delete this.reactions[e]}else{var o=Date.now()+":"+WebMessanger.zuid+":"+WebMessanger.nname;this.reactions[e]?this.reactions[e].data[t]?this.reactions[e].data[t].count?(this.reactions[e].data[t].count=parseInt(this.reactions[e].data[t].count)+1+"",this.reactions[e].data[t].hasCurrentUserReacted="true",this.reactions[e].data[t].users.push(o)):this.reactions[e].data[t].push(o):(this.reactions[e].list.push(t),this.reactions[e].data[t]={count:"1",users:[o],hasCurrentUserReacted:"true"}):(this.reactions[e]={list:[t],data:{}},this.reactions[e].data[t]={count:"1",hasCurrentUserReacted:"true",users:[o]})}this.updateReactionFragment(e)},ChatWindow.prototype.updateInfoMessage=function(e,t,s){var i={msg:e={msg:e,type:s},messagetype:Message.types.INFOMSG,time:t||(new Date).getTime()};this.updateMessage(i)},ChatWindow.prototype.checkAndUpdateMissingTranscript=function(e,t){var s=e.lmsgtime,i=e.time,n=s&&this.msgdisp.querySelector('[data-msgtime="'+s+'"]');if(s&&!n&&t){for(;!t.getAttribute("data-msgid")||t.getAttribute("data-msgid")&&(t.getAttribute("data-notack")||"INFOMSG"==t.getAttribute("data-type"));)t=t.previousSibling;var a=t.getAttribute("data-msgtime");if(a&&a<i){for(var o=$WC.Util.createElement("div",null,null,{"data-prevtime":a});"wms-msgtime"==t.nextSibling.className||t.nextSibling.getAttribute("data-msgfailure");)t=t.nextSibling;t.insertAdjacentElement("afterend",o),Message.loadSpecificTranscript(this.objId,this.msgdisp,o)}}},ChatWindow.prototype.getAdjacentMsg=function(e,t){for(;e&&(!e.getAttribute("data-msgid")||"INFOMSG"==e.getAttribute("data-type"));)e=t?e.previousSibling:e.nextSibling;return e},ChatWindow.prototype.checkAndRemoveMsg=function(e){var t=e.nextSibling,s=e.previousSibling,i=[];if(t&&"wms-msgtime"==t.className){var n=this.getAdjacentMsg(s,!0),a=n&&n.nextSibling;!n||a&&"wms-msgtime"==a.className?i.push(t):t.removeAttribute("data-edited")}if(s&&s.getAttribute("data-senderzuid")){var o=this.getAdjacentMsg(t,!1),r=o&&o.previousSibling;(!o||r&&r.getAttribute("data-senderzuid"))&&i.push(s)}i.push(e),i.forEach(function(e){$WC.Util.removeElement(e)})},ChatWindow.prototype.forwardSelectedMessages=function(){var r=$WC.WmsLocalStorage.getItem($WC.Config.get("zuid")+"_allow_forward_info"),e=[{onclick:function(e,t){r!==t&&$WC.WmsLocalStorage.setItem($WC.Config.get("zuid")+"_allow_forward_info",t);var s={sid:WebMessanger.sid,fwdasgroup:!1},i=[],n=[],a=this.objId;e.forEach(function(e){WmsContacts.getContactsList(e)||WmsOrgContacts.getOrgContactsList(e)?i.push(e):n.push(e),WmsMainUI.scheduleAutoFocus(e)}),i.length&&(s.userids=i.join(",")),n.length&&(s.fwdchidlists=n.join(",")),t&&(s.retain_trace=!0),s.msguids=this.getSelectedMsgsId().join(",");var o={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.Util.getCSRF(),"Content-Type":"application/json"};$WC.Ajax.postRequestToChat("v1/chats/"+this.objId+"/forward",s,null,function(){var e=WindowHandler.getWinObjById(a),t="string"==typeof this.response&&""!=this.response?JSON.parse(this.response):this.response;t&&t.data&&e.handleChatRestrictions(t.data)},null,null,o),this.toggleMessageSelection()}.bind(this)}],t=null!==r&&r;(new $WC.ForwardMsg).mountComponent(this.objId,$WC.I18N("message.forward.to",""),$WC.I18N("message.forward.placeholder"),e,t)},ChatWindow.prototype.getSelectedMsgsId=function(){var e=this.msgdisp.querySelectorAll('[data-msgsel="true"]'),t=[];return e.forEach(function(e){t.push(e.closest('[class^="wms-msgfrag"]').getAttribute("data-msgid"))}),t},ChatWindow.prototype.toggleMessageSelection=function(e,t){var s=this.msgdisp.querySelectorAll("[data-msgsel]");if(e&&t){s.forEach(function(e){"DELETEDMSG"!==e.getAttribute("data-type")&&($WC.Util.removeClass(e,"wms_checkbox_hidden"),$WC.Util.addClass(e,"wms_checkbox_visible"))});var i=t.closest('[class^="wms-msgfrag"]');if(i){var n=i.querySelector("[data-msgsel]");$WC.Util.removeClass(n,"wms_fwdcheckbox"),$WC.Util.addClass(n,"wms_fwdcheckboxsel"),n.setAttribute("data-msgsel","true"),this.msgoprnode.style.display="flex",this.footernode.style.display="none",this.actionbutton.style.display="none"}}else s.forEach(function(e){$WC.Util.removeClass(e,"wms_checkbox_visible"),$WC.Util.removeClass(e,"wms_fwdcheckboxsel"),$WC.Util.addClass(e,"wms_checkbox_hidden"),$WC.Util.addClass(e,"wms_fwdcheckbox"),e.setAttribute("data-msgsel",!1)}),this.msgoprnode.style.display="none",this.footernode.style.display="table",this.actionbutton.style.display="block",$WC.$CUtil.setInnerText(this.msgselectcntnode,$WC.I18N("msg.select.fwdcnt",[1])),this.msgoprnode.setAttribute("data-msgoperation",!0),$WC.Util.removeClass(this.msgselectcntnode.parentNode,"wms_fwdsel_alert"),$WC.Util.removeClass(this.msgoprnode,"wms-shake")},ChatWindow.prototype.toggleSmiley=function(){this.permdenied||(this.smileyvisible?this.hideSmileyUI():this.showSmileyUI())},ChatWindow.prototype.showSmileyUI=function(i,e){if(this.autocompletepickervisible&&e)this.smileyinstance.updateSearchTerm(e);else{var t={autocomplete:!!i,hidesearch:!!i,showEmojiWithText:!!i,skintonepicker:!(i||!WmsSettings.adminsettings.showemojiskinpicker)};if(e&&(t.searchterm=e),this.autocompletepickervisible&&!i&&this.hideSmileyUI(),-1==this.smileycontainer.className.indexOf("wms-smileyborder")&&(this.smileycontainer.className+=" wms-smileyborder"),i){this.autocompletepickervisible=!0,WMSUI.autoComplete.setKeyNavigation(this.composer,this.smileyinstance);var s=this.composer.value,n=this.composer.selectionStart;s=s.substring(0,n),t.hidestickers=!(s.lastIndexOf(" "+$WC.WmsConstants.TRIGGERS.SMILEY)+1+n==this.composer.value.length)}else{var a=WmsSettings.showCustomEmojiOptions();this.smileyvisible=!0,a||(t.hidestickers=!0,t.hidecustomemoji=!0)}this.smileyinstance.mountComponent(this.smileycontainer,!0,function(e,t,s){i?"sticker"==s||"frequentemoji"==s&&$WC.Matcher.check("customemoji",e)?(this.composer.value="",Message.send(this.objId,e,null,null,null,null,this.getReplyMessageId(),null,!0)):WMSUI.autoComplete.select(this.composer,e):"sticker"==s||"frequentemoji"==s&&$WC.Matcher.check("customemoji",e)?Message.send(this.objId,e,null,null,null,null,this.getReplyMessageId()):Smiley.updateSmiley(this.composer,e),i?this.hideSmileyUI():this.toggleSmiley()}.bind(this),function(){i?this.hideSmileyUI():this.toggleSmiley()}.bind(this),t),this.footernode.style.borderRadius="0px 0px 5px 5px"}},ChatWindow.prototype.hideSmileyUI=function(){this.smileycontainer.className=this.smileycontainer.className.replace(" wms-smileyborder",""),this.smileyinstance.unmountComponent(),this.composer.focus(),this.footernode.style.borderRadius="5px 5px 5px 5px",this.autocompletepickervisible?(this.autocompletepickervisible=!1,WMSUI.autoComplete.removeKeyNavigation(this.composer,this.smileyinstance)):this.smileyvisible=!1},ChatWindow.prototype.resetBarStatusIcon=function(){if(11==this.ctype){WmsMainUI.resetUnreadCount(this.thread_parentid,null,this.objId);var e=WindowHandler.getWinObjById(this.thread_parentid);e&&e.toggleUnreadThreadBanner(),this.updateUnreadThreadCount(this.thread_parentid,this.objId)}else WmsMainUI.resetUnreadCount(this.objId);silent||($WC.HybridSearch.isUnreadFilterOpen()&&WmsMainUI.filterUnreadChats(),WmsMainUI.updateUnreadChatsCount(),this.updateBarMsgcount())},ChatWindow.prototype.updateBarMsgcount=function(){var e;e=this.salesiqchat&&$WC.Config.get("customContacts")?WmsImplHandler.invokeSynchronously($WC.Config.get("customContacts").getUnreadCount,this.objId):11==this.ctype?WmsMainUI.getUnreadCount(this.thread_parentid,null,this.objId):WmsMainUI.getUnreadCount(this.objId),e=99<(this.barmsgcountnode.title=e)?"99+":e,$WC.$CUtil.setInnerText(this.barmsgcountnode,e),11==this.ctype?WmsMainUI.updateUnreadCountInUI(this.thread_parentid):WmsMainUI.updateUnreadCountInUI(this.objId),11==this.ctype&&0<WmsMainUI.getUnreadCount(this.thread_parentid,null,this.objId)||0<WmsMainUI.getUnreadCount(this.objId)?this.barmsgcountnode.style.display="flex":this.barmsgcountnode.style.display="none"},ChatWindow.prototype.getChannelUID=function(){return this.channelid||$WC.Channels.get(this.objId)&&$WC.Channels.get(this.objId).oc_id},ChatWindow.prototype.getChannelServiceCode=function(){return this.channelservicecode||$WC.Channels.get(this.objId)&&$WC.Channels.get(this.objId).service},ChatWindow.prototype.getChannelSOID=function(){return this.channelsoid||$WC.Channels.get(this.objId)&&$WC.Channels.get(this.objId).servicespecid},ChatWindow.prototype.getReplyMessageId=function(e){var t,s,i="true"===this.editorreplydiv.getAttribute("data-editmsg"),n="true"===this.editorreplydiv.getAttribute("data-threadreply");if("block"==this.editorreplydiv.style.display&&!i){if(n)return this.editorreplydiv.getAttribute("data-threadmsgid");(t=this.editorreplydiv.querySelector("[data-replymsgtime]"))&&(s=e?t.getAttribute("data-privatereplychid"):t.getAttribute("data-replymsguid"))}return s},ChatWindow.prototype.constructReplyMessageObject=function(e,t,s,i){var n,a=e.getAttribute("data-msgtime"),o=e.getAttribute("data-msgid"),r=e.getAttribute("data-msguid"),l=e.querySelector("[data-sendername]"),d=e.getAttribute("data-sendername")||l&&l.getAttribute("data-sendername");n=Message.getMsgFromDom(this.objId,o,i,!0);var c=Message.getMessageType(n),m=o&&o.split("_"),u={meta:{opr_replydetails:{messagetype:c,msgtime:a,sender:m&&(WebMessanger.isRTCChat()?m.slice(0,3).join("_"):m[0]),sendername:d,msguid:r}}};if(t&&(u.msg=t,u.time=s,u.sender=WebMessanger.zuid),c===Message.types.IMGATT||c===Message.types.FILEATT||c===Message.types.AUDIOATT||c===Message.types.VIDEOATT)var p="addinfo";else p="msg";return u.meta.opr_replydetails[p]=n,u},ChatWindow.prototype.showEditPreview=function(e){"REPLYMSG"!==e.getAttribute("data-type")&&"THREADLINKMSG"!==e.getAttribute("data-type")||(e=e.querySelector("[data-msgid]"));var t=e.querySelector("[data-urlpreviewcomment]")||e.querySelector("[data-filecomment]")||e.firstChild;this.composer.value=Smiley.getTextForSkinToneCode(Message.getTextMsgFromDom(t.childNodes,!1,!0,!0)),this.changeFooterHeight(),this.hideVoiceMsgInvoker();var s=this;$WC.Util.convertToArray(t.childNodes).forEach(function(e){"SPAN"===e.nodeName&&(s.atmentions+=e.getAttribute("data-zcprofileid")+",",WMSUI.curtrigger=$WC.Util.getInnerText(e).slice(0,1))}),WMSUI.atMentions.changeColor(this.composer),this.editorreplydiv.setAttribute("data-originalmsg",this.composer.value),this.editorreplydiv.setAttribute("data-editmsg",!0),this.attachmentnode.querySelector('[id="wms-file"]').disabled="true"},ChatWindow.prototype.showReplyPreview=function(e,t,s,i){var n;s?(n='<div class="wms-replymsgwrapper"><div class="wms-replymsg"><div class="wms-replymsgheader"><div class="wms_settings_chckbx" style="padding:0px"><span data-type="custom" class="wms_settings_customcheckbox"></span><input id="wms_notifyeditmsg" data-setting="notifyedit" type="checkbox" class="wms_settings_checkbox"><label id="wms_notifyeditlabel" class="wms_settings_label" for="wms_notifyeditmsg">'+$WC.I18N("thread.msgs.post",[$WC.Channels.getChannelName(this.thread_parentid)])+'</label></div><div class="wms_cw_replyclose"></div></div></div></div>',this.editorreplydiv.setAttribute("data-threadmsg",!0)):(this.closeReplyPreview(),n=Message.constructReplyMessageFragment(this.constructReplyMessageObject(e,null,null,!t),!0,t,i,null,this.objId),t?this.showEditPreview(e):i&&(this.editorreplydiv.setAttribute("data-threadmsgid",e.getAttribute("data-msguid")),this.editorreplydiv.setAttribute("data-threadreply",!0))),this.focus(),this.footernode.style.borderRadius="0px 0px 5px 5px",this.editorreplydiv.innerHTML=n,this.editorreplydiv.style.display="block"},ChatWindow.prototype.closeReplyPreview=function(){(this.editorreplydiv.innerHTML="",this.editorreplydiv.style.display="none",this.editorreplydiv.getAttribute("data-editmsg"))?(this.editorreplydiv.removeAttribute("data-editmsg"),this.attachmentnode.querySelector('[id="wms-file"]').removeAttribute("disabled"),this.composer.value="",this.invisiblediv.innerHTML="",this.changeFooterHeight()):this.editorreplydiv.getAttribute("data-threadreply")&&(this.editorreplydiv.removeAttribute("data-threadreply"),this.editorreplydiv.removeAttribute("data-threadmsgid"));this.footernode.style.borderRadius="5px 5px 5px 5px"},ChatWindow.prototype.showRestrictedChannelIcon=function(){var e=this.win.querySelector("[data-channelrestricted]");"false"==($WC.Channels.get(this.objId)&&$WC.Channels.get(this.objId).open_to_all)&&$WC.Util.setAttribute(e,"data-channelrestricted",!0)},ChatWindow.prototype.disableActions=function(e){if((e=e||this).actionbutton){var t=e.actionbutton;t.style.cursor="not-allowed",t.disabled="true",e.actionlistnode.style.display="none"}},ChatWindow.prototype.disableComposerOptions=function(e,t){(t=t||this).composer.disabled="true",t.attachmentnode&&(t.attachmentnode.setAttribute("data-disabled",!0),t.attachmentnode.querySelector('[id="wms-file"]').disabled="true");t.smileyinvoker.disabled="true",this.footernode.setAttribute("data-disabled","true"),this.footernode.querySelector("[data-restriction-text]").innerText=e,$WC.Util.setAttribute(this.mainwin,"tabindex","1")},ChatWindow.prototype.disableFileShareOption=function(){this.attachmentnode&&(this.attachmentnode.setAttribute("data-attachment",!1),this.attachmentnode.querySelector('[id="wms-file"]').disabled="true",this.attachmentnode.style.display="none");this.restrict_file_upload=!0},ChatWindow.prototype.hideActionItem=function(e,t){this.actionlistnode.querySelector("[data-"+e+'="'+t+'"]').style.display="none"},ChatWindow.prototype.toggleEnlargeWindow=function(){this.isEnlarged?this.shrinkEnlargedWindow():(WindowHandler.shrinkEnlargedWindows(),this.focus(),this.isEnlarged=!0,this.enlargeicon.title=$WC.I18N("chat.shrink"),$WC.Util.addClass(this.mainwin,"wms_cw_enlarged"),$WC.Util.addClass(this.enlargeicon,"wms_cw_enlargeicon_rotate")),WindowHandler.onResize()},ChatWindow.prototype.shrinkEnlargedWindow=function(){this.isEnlarged=!1,this.changeFooterHeight(!0),this.enlargeicon.title=$WC.I18N("chat.enlarge"),$WC.Util.removeClass(this.enlargeicon,"wms_cw_enlargeicon_rotate"),$WC.Util.removeClass(this.mainwin,"wms_cw_enlarged")},ChatWindow.prototype.showReactionsUI=function(a){this.createOverlay();var e=$WC.Util.createElement("div",null,"wms_cw_reaction_container"),t=$WC.Util.createElement("span",null,"wms_cw_overlay_close");t.onclick=this.hideReactionsUI.bind(this);var s=$WC.Util.createElement("div",null,"wms_cw_reactionsparent");s.appendChild(e),s.appendChild(t),this.cw_overlay.appendChild(s),this.smileyinstance.mountComponent(e,!0,function(e){e=Smiley.checkAndReplaceTonePrefCode(e);var t=this.ctrlcomp.querySelector('[data-msguid="'+a+'"]'),s=t.getAttribute("data-type")==Message.types.THREADLINKMSG;if(this.updateMyReactionData(a,e),s){var i=t.querySelector("[data-thread_chid]").getAttribute("data-thread_chid"),n=WindowHandler.getWinObjById(i);n&&n.updateMyReactionData(a,e)}WebMessanger.updateReaction(this.objId,a,e,!1,t.getAttribute("data-type")==Message.types.THREADLINKMSG),this.hideReactionsUI()}.bind(this),function(){this.hideReactionsUI()}.bind(this),{showEmojiWithText:!1,skintonepicker:WmsSettings.adminsettings.showemojiskinpicker,hidecustomemoji:!0,hidestickers:!0}),this.smileyvisible=!0},ChatWindow.prototype.hideReactionsUI=function(){this.smileyinstance.unmountComponent(),this.composer.focus(),this.smileyvisible=!1,this.removeOverlay()},ChatWindow.prototype.showUnreadMsgs=function(e){var t,s=$WC.RecentChats.getLastSeenTime(this.objId),i=this.ctrlcomp.scrollHeight-this.ctrlcomp.clientHeight<=this.ctrlcomp.scrollTop+20,n=this.win.querySelector('[data-msgtime="'+s+'"][data-msgid]');if(n&&(t=n.previousSibling.getAttribute("data-senderzuid")?n.previousSibling:n),t){this.clearUnreadMarker();var a=$WC.Util.createElement("div","","wms_unread_marker",{"data-unread":"true"},'<div class="wms_unread_marker_wrapper"><span class="wms_unread_marker_text">'+$WC.I18N("chat.newmessages")+"</span></div>");t.insertAdjacentElement("beforeBegin",a)}e?this.scrollToUnread():i&&this.scrollDisplay(),this.toggleUnreadBanner()},ChatWindow.prototype.clearUnreadMarker=function(){var e=this.win.querySelector("[data-unread]");e&&$WC.Util.removeElement(e)},ChatWindow.prototype.scrollToUnread=function(e){var t=this.win.querySelector("[data-unread]");if(t){var s=Message.getScrollableParent(t.parentNode);e?setTimeout(function(){$WC.Util.scrollTo(t,{block:"center",behavior:"smooth"},s)},1):$WC.Util.scrollTo(t,{block:"center"},s)}},ChatWindow.prototype.scrollToUnreadThreads=function(){var e=WmsMainUI.getUnreadThreads(this.objId)[0],t=$WC.RecentChats.get(e).PARENTMSGUID;Message.showMessageFragmentInView(this.objId,t,null,{block:"end"}),WmsMainUI.getUnreadThreads(this.objId).unshift(WmsMainUI.getUnreadThreads(this.objId).pop())},ChatWindow.prototype.toggleUnreadBanner=function(){var e=this.win.querySelector("[data-unread]");!this.unread||!e||$WC.Util.isScrolledIntoView(e,this.ctrlcomp,!0)?(this.newmsgbanner.style.display="none",$WC.Util.setAttribute(this.newmsgbanner,"data-newmsgbanner",!1)):(e.getBoundingClientRect().top>this.ctrlcomp.getBoundingClientRect().bottom?$WC.Util.addClass(this.newmsgbanner,"wms_unread_msg_bottom"):$WC.Util.removeClass(this.newmsgbanner,"wms_unread_msg_bottom"),$WC.Util.setAttribute(this.newmsgbanner,"data-newmsgbanner",!0),this.newmsgbanner.style.display="block")},ChatWindow.prototype.toggleUnreadThreadBanner=function(){WmsMainUI.getUnreadThreads(this.objId)&&WmsMainUI.getUnreadThreads(this.objId).length?(this.threadunreadbanner.style.display="flex",$WC.$CUtil.setInnerText(this.threadunreadbanner.lastChild,WmsMainUI.getUnreadThreads(this.objId).length),this.threadunreadbanner.setAttribute("data-threadbanner",!0)):(this.threadunreadbanner.style.display="none",this.threadunreadbanner.setAttribute("data-threadbanner",!1),WmsMainUI.getUnreadCount(this.objId)||this.makeNormal())},ChatWindow.prototype.scrollToLastMsg=function(){var e=this.msgdisp.lastChild,t=!(!e||!e.getAttribute("data-loadmorebutton")&&!e.getAttribute("data-loadmore"));if(this.last_clicked_replymsg_time)Message.glowBubble(this.last_clicked_replymsg_time,this.ctrlcomp,this.objId),this.last_clicked_replymsg_time="";else if(t){$WC.RecentChats.updateLastSeenTime(this.objId);var s=$WC.Util.createElement("div");s.setAttribute("data-latestchunk",!0),this.msgdisp.innerHTML="",this.msgdisp.prepend(s),Message.loadSpecificTranscript(this.objId,this.msgdisp,s)}else{var i=Message.getScrollableParent(e.parentNode);$WC.Util.scrollTo(e,{behavior:"smooth"},i)}},ChatWindow.prototype.createOverlay=function(e){var t=$WC.Util.createElement("div",null,"wms_cw_overlay");this.cw_overlay=this.mainwin.appendChild(t),e&&(this.cw_overlay.onclick=function(){this.cw_overlay&&this.cw_overlay.childNodes[0]&&"true"===this.cw_overlay.childNodes[0].getAttribute("data-msgaction")&&e()}.bind(this))},ChatWindow.prototype.removeOverlay=function(){this.cw_overlay&&($WC.Util.removeElement(this.cw_overlay),this.cw_overlay=null)},ChatWindow.prototype.showUrlPreview=$WC.Util.debounce(function(){var n=$WC.Util.getUnfurlableLink($WC.Util.safeHTML(this.composer.value));n=n[0]?n[0].trim():"",this.previewlinkdetails&&n!=this.previewlinkdetails.url&&this.hideUrlPreview();var e=function(){this.hideUrlPreview()}.bind(this),t=function(e){if(e&&!this.urlpreviewvisible&&!$WC.Util.isEmptyObject(e)&&-1<this.composer.value.indexOf(n)){this.previewlinkdetails=e.linkdetails,this.unfurlmsg=!0,this.previewlinkdetails.redirected_url&&(this.previewlinkdetails.url=this.previewlinkdetails.redirected_url),this.previewlinkdetails.redirected_thumbnail_url&&(this.previewlinkdetails.thumbnailurl=this.previewlinkdetails.redirected_thumbnail_url);var t=$WC.Util.cloneObject(this.previewlinkdetails,!0);if(t.cliq_message){var s=t.description||t.url;t.description=Smiley.replace($WC.Util.safeHTML($WC.Util.unescapeHTML(s)))}var i=$WC.UrlPreview.populate(t,this.winIndex,null,!0,!1);this.urlpreviewcontainer.innerHTML=i,Message.checkAndRemoveUrlImage(this.urlpreviewcontainer),this.urlpreviewvisible=!0,this.unfurldata_cache_id=this.previewlinkdetails.unfurldata_cache_id?this.previewlinkdetails.unfurldata_cache_id:"",$WC.Config.get("zoholinks_auth")||0!=this.previewlinkdetails.authentication_consent&&1!=this.previewlinkdetails.authentication_consent||$WC.Config.set({zoholinks_auth:this.previewlinkdetails.authentication_consent}),this.urlpreviewcontainer.style.border="1px solid rgb(213, 213, 213)",this.fetchpreviewdetails=!1}else!$WC.Util.isEmptyObject(e)&&e||this.hideUrlPreview()}.bind(this);n&&!this.urlpreviewvisible&&(this.urlpreviewcontainer.innerHTML=$WC.UrlPreview.showLoadingPreview(),this.footernode.style.borderRadius="0px 0px 5px 5px",this.fetchpreviewdetails=!0,this.unfurlmsg=!0,$WC.Ajax.postRequestToChat("getunfurleddata.do","link="+encodeURIComponent(n),t,e))},null,500),ChatWindow.prototype.hideUrlPreview=function(e){(this.urlpreviewvisible||this.fetchpreviewdetails)&&((this.unfurlmsg=!0)===e&&(this.unfurlmsg=!1),this.urlpreviewcontainer.innerHTML="",this.urlpreviewcontainer.style.border="none",this.footernode.style.borderRadius="5px 5px 5px 5px",this.urlpreviewvisible=!1,this.fetchpreviewdetails=!1,this.previewlinkdetails=null)},ChatWindow.prototype.getUnfurlData=function(e){var t=$WC.Util.getUnfurlableLink(e);return t[0]&&(t=t[0].trim()),!(!this.previewlinkdetails||!t||this.previewlinkdetails.url!==t)&&this.previewlinkdetails},ChatWindow.prototype.checkAndStoreDraftMsg=function(){if(this.composer.value){var e=$WC.Drafts.get(this.objId);if(e&&e.msg==this.composer.value)return;var t=this.getReplyMessageId(),s=this.composer.value;this.atmentions&&(s=$WC.Util.unescapeHTML(WMSUI.atMentions.formatAtMentions(s,this.atmentions,this.objId,!0)));var i={msg:s,time:(new Date).getTime(),replied_to:t,chid:this.objId};$WC.Drafts.updateInServer(this.objId,i)}},ChatWindow.prototype.checkAndDeleteDraft=function(){""===this.composer.value&&$WC.Drafts.deleteDraftInServer(this.objId)},ChatWindow.prototype.restoreDraftedMsg=function(){if(!WebMessanger.isGuestUser()){var a=$WC.Drafts.get(this.objId);if(a&&""===this.composer.value){if(a.replied_to){var e=this.win.querySelector('[data-msgid="'+a.replied_to+'"]');if(e)r(this),this.showReplyPreview(e);else{var t=a.replied_to.split("_")[1],s=this.objId+"|"+t,i=$WC.Util.createElement("div",null,null,{"data-mentionmsgid":s});i.style="display:none";var n=this.msgdisp.querySelector("[data-loadmore],[data-transerror]");this.msgdisp.replaceChild(i,n);var o=i;Message.loadSpecificTranscript(this.objId,this.msgdisp,o)}}else r(this);this.changeFooterHeight()}}function r(s){var e=a.meta&&a.meta.mentions,t=Message.isAddMsg(a.msg),i=Message.formatDraftMsg(a);if(i&&(s.hideVoiceMsgInvoker(),s.composer.value=i,e||t)){for(var n in e)e[n].type!==$WC.CMsgUtil.UserMention&&e[n].type!=$WC.CMsgUtil.SpecialMention.participants&&e[n].type!=$WC.CMsgUtil.SpecialMention.available||(s.atmentions+=e[n].id+",",WMSUI.curtrigger="@");t&&(s.atmentions="",$WC.Matcher.replace("addmember",a.msg,function(e,t){s.atmentions+=t+","}),WMSUI.curtrigger="+"),WMSUI.atMentions.changeColor(s.composer)}}},ChatWindow.prototype.changeFooterHeight=function(e){var t=this.ctrlcomp.offsetHeight;this.footernode.style.height="56px",e&&setTimeout(this.changeFooterHeight.bind(this),260);var s=null===this.composer.offsetParent?this.msgoprnode:this.composer;if(s.scrollHeight<140){var i=s.scrollHeight<56?56:s.scrollHeight;this.footernode.style.height=i+"px",this.composer.style.overflow="hidden",this.invisiblediv.style.overflow="hidden",this.msgoprnode.style.overflow="hidden"}else this.footernode.style.height="140px",this.composer.style.overflow="auto",this.invisiblediv.style.overflow="auto",this.msgoprnode.style.overflow="auto";t>=this.ctrlcomp.offsetHeight?this.ctrlcomp.scrollTop=this.ctrlcomp.scrollTop+(t-this.ctrlcomp.offsetHeight):this.ctrlcomp.scrollTop!=this.ctrlcomp.scrollHeight-this.ctrlcomp.offsetHeight&&(this.ctrlcomp.scrollTop=this.ctrlcomp.scrollTop-(this.ctrlcomp.offsetHeight-t)),this.urlpreviewcontainer.style.bottom=this.footernode.offsetHeight+4+"px",this.smileycontainer.style.bottom=this.footernode.offsetHeight+4+"px",this.autocompletediv.style.bottom=this.footernode.offsetHeight+4+"px",this.editorreplydiv.style.bottom=this.footernode.offsetHeight+4+"px"},ChatWindow.prototype.updatePlatformMsg=function(e){var t=JSON.parse(e.msg.addldata),s=this.ctrlcomp.querySelector('[data-msguid="'+e.msguid+'"]').getAttribute("data-msgid");e.time=e.msguid.split("%")[0];var i=$WC.CustomMsg.msgobj[e.chid]&&$WC.CustomMsg.msgobj[e.chid][e.time];e.meta=t.meta,e.msg=t.msg,i&&(i.reactions&&0!=Object.keys(i.reactions).length&&(e.reactions=i.reactions),i.replied&&(e.meta.opr_replydetails=i.replied.info),e.sender=i.sender,e.zuid=i.sender,e.dname=i.dname,e.nname=i.dname);var n=document.getElementById("zcwindows");if(n&&n.getAttribute("data-msguid")==e.msguid){function a(){document.getElementById("zcwindows")&&(document.getElementById("zcwindows").removeAttribute("data-msguid"),document.getElementById("zcwindows").innerHTML=null)}a(),n.setAttribute("data-msguid",e.msguid),e["brief.msg"]=i["brief.msg"],e.raw=i.raw,$WC.$Win.create({id:"custommsg",class:"cmsgdlg",header:$WC.CMsgUtil.getBriefMsgTitle($WC.CMsgUtil.convertMsgObj(e)),html:$WC.CustomMsgUI.getCustomMsgOverlayHTML($WC.CMsgUtil.convertMsgObj(e)),additionalattrs:' chid="'+e.chid+'" time="'+e.time+'"',closefn:a})}this.updateMessageFragment(e,s)},ChatWindow.prototype.showMessageActionsUI=function(e,t,s){var i=!1;if(WebMessanger.show_message_actions_as_popup){i=!0;var n=e.querySelector("[data-options]"),a="",o=n.getBoundingClientRect(),r=this.ctrlcomp.getBoundingClientRect();o.x+o.width+158>r.x+r.width&&(a='style="left: auto; right: 38px;" data-align="left"');var l='<div id="wms_msgoptionsdiv" data-msgoperations="true"'+a+'class="wms_msgoptionsdiv wms-valign-mid-block"></div>';n.insertAdjacentHTML("beforeend",l),(u=(d=n.querySelector("[data-msgoperations]")).getBoundingClientRect()).y+u.height>=r.y+r.height?(d.style.bottom="0",$WC.Util.removeClass(d,"wms-valign-mid-block"),$WC.Util.addClass(d,"wms_msgoptions_pointer")):r.y>u.y&&(d.style.top="0",$WC.Util.removeClass(d,"wms-valign-mid-block"),$WC.Util.addClass(d,"wms_msgoptions_pointer_top"))}else var d=this.createActionsMountPoint(this.hideMessageActionsUI.bind(this));var c={};"undefined"!=typeof WmsUIImpl&&(c=WmsImplHandler.invokeSynchronously(WmsUIImpl.getMessageActions,WebMessanger.zuid,this.objId,this.ctype)||{});var m=function(e,t){var s=e.getAttribute("data-msguid");if(this.updateMyReactionData(s,t),e.getAttribute("data-type")==Message.types.THREADLINKMSG){var i=e.querySelector("[data-thread_chid]").getAttribute("data-thread_chid"),n=WindowHandler.getWinObjById(i);n&&n.updateMyReactionData(s,t)}WebMessanger.updateReaction(this.objId,s,t,!1,e.getAttribute("data-type")==Message.types.THREADLINKMSG)}.bind(this);c.hide_more_msg_actions=!(!WebMessanger.isGuestUser()&&"disable"!=c.moreactions),c.rtlmode=!!WebMessanger.rtlmode,c.show_as_popup=i;var u,p=e.getAttribute("data-type");"THREADLINKMSG"==p&&(p=e.querySelector("[data-msgid]").getAttribute("data-type")),this.messageactionsinstance.mountComponent({node:d,msgnode:e,allowed_actions:t,messageactionscallback:s,chid:this.objId,closeComponent:this.hideMessageActionsUI.bind(this),dreFunctionCallBack:$WC.Functions.handleExecuteFuncCallback,datatype:p,actionsconfig:c,quickReact:m}),WebMessanger.show_message_actions_as_popup&&((u=d.getBoundingClientRect()).y+u.height>=r.y+r.height?(d.style.bottom="0",$WC.Util.removeClass(d,"wms-valign-mid-block"),$WC.Util.addClass(d,"wms_msgoptions_pointer")):r.y>u.y&&(d.style.top="0",$WC.Util.removeClass(d,"wms-valign-mid-block"),$WC.Util.addClass(d,"wms_msgoptions_pointer_top")))},ChatWindow.prototype.hideMessageActionsUI=function(){this.messageactionsinstance.unmountComponent(),this.removeOverlay()},ChatWindow.prototype.createActionsMountPoint=function(e){this.createOverlay(e);var t=$WC.Util.createElement("div",null,"wms_cw_reaction_container"),s=$WC.Util.createElement("span",null,"wms_cw_overlay_close");s.onclick=e.bind(this);var i=$WC.Util.createElement("div",null,"wms_cw_msgactionsparent",{"data-msgaction":!0});return i.appendChild(t),i.appendChild(s),this.cw_overlay.appendChild(i),t},ChatWindow.prototype.showPinnedMsg=function(e){if(!WebMessanger.is_msgpin_option_disabled){var t=this.objId,s="stickymessage"===e.type||"ADD_STICKY"===e.module?e.data:e.stickymessage;if(s&&!$WC.Util.isEmptyObject(s)){var i=(s="string"==typeof s?JSON.parse(s):s).message,n=s.creator&&s.creator.name,a=this.pinmsgnode.getElementsByClassName("wms_pinmsg_content")[0];a.innerHTML=this.createPinMsgContentHTML(i),a.title=$WC.I18N("pinmsg.creator.info",n),this.pinmsgdetails.info.creator=s.creator&&s.creator.id,this.pinmsgdetails.info.msgtime=i&&i.origin_time||i.time,this.pinmsgdetails.info.msgid=s.message&&s.message.msguid,this.pinmsgdetails.info.duration=s.expiry_time,this.pinmsgdetails.info.duration_shown=!1,this.pinmsgnode.style.display="flex";var o=!!this.pinmsgdetails.action_enabled;this.pinmsgnode.setAttribute("data-show-options",o)}else e.addinfo&&-1!=e.addinfo.indexOf("STICKY")?_WMSWINFOCUS?WebMessanger.getPinnedMsg(t):(WebMessanger.get_pinmsg_onfocus=!0,this.pinmsgdetails.msg_pinned=!0):this.pinmsgdetails.msg_pinned=!1}},ChatWindow.prototype.createPinMsgContentHTML=function(e){var t;if(e.mod){var s="wms_pinmsg_att_icon",i=e.msg.name||e.msg.fName;"contact"===e.mod?s+=" wms_pinmsg_contact_icon":"location"===e.mod?s+=" wms_pinmsg_location_icon":"event"===e.mod&&(s+=" wms_pinmsg_event_icon"),t=$WC.Util.safeHTML($WC.Util.unescapeHTML(i))+'<span class="'+s+'"></span>'}else{var n=e.msg.indexOf("<br>"),a=e.msg.indexOf("\n");t=e.msg.substring(0,-1!==n?n:-1!==a?a:e.msg.length),t=$WC.Util.safeHTML($WC.Util.unescapeHTML(t)),t=$WC.Markdown.apply(t);var o=$WC.Util.cloneObject(e,!0);o.msg=t,t=o.meta&&o.meta.mentions?$WC.Util.formatMentions(o,!0):$WC.Util.formatMentions(t),t=Smiley.replace(t,!0)}return t},ChatWindow.prototype.updatePinnedMsg=function(e){var t=this.createPinMsgContentHTML(e.msg);this.pinmsgnode.getElementsByClassName("wms_pinmsg_content")[0].innerHTML=t},ChatWindow.prototype.clearPinnedMsg=function(){var e=this.pinmsgnode.getElementsByClassName("wms_pinmsg_content")[0];e.innerText="",e.title="",this.pinmsgdetails.info={},this.pinmsgdetails.msg_pinned=!1,this.pinmsgnode.style.display="none"},ChatWindow.prototype.highlightPinnedMsg=function(e,t){e="string"==typeof e?e:this.pinmsgdetails.info.msgtime;var s=this.ctrlcomp;if(!Message.glowBubble(e,s,this.objId)){t=t||this.pinmsgdetails.info.creator;var i=this.objId+"|"+t+"|"+e,n=Message.getMarkerElement(i,e,this.msgdisp);Message.loadSpecificTranscript(this.objId,this.msgdisp,n)}},ChatWindow.prototype.togglePinMsgOptions=function(e){var t=this.pinmsgdetails.info.duration,s=this.pinmsgnode.getElementsByClassName("wms_pinmsg_options")[0];if("true"==s.getAttribute("data-pinmsg-options")||e)this.pinmsgdetails.info.duration_shown&&(this.pinmsg_duration_selector_instance.unmountComponent(),this.pinmsgdetails.info.duration_shown=!1),s.setAttribute("data-pinmsg-options","false");else{var i="";-1==t?i=$WC.I18N("chat.forever"):-1!==(i=$WC.DateUtil.relativeTimeLeft(t)).indexOf($WC.I18N("chat.mute.day"))&&-1!==i.indexOf($WC.I18N("chat.mute.minute"))&&(i=i.substring(0,i.indexOf($WC.I18N("chat.mute.minute"))-4));var n=$WC.I18N("pinmsg.timeleft",i);$WC.$CUtil.setInnerText(this.pinmsgduration,n),s.setAttribute("data-pinmsg-options","true")}},ChatWindow.prototype.handleChatRestrictions=function(e){if(e){var t=["60000","61000","62000","63000"],s=["60001","60002","60003","60004","60005","60006","60007","60008"],i=$WC.Util.cloneObject(e,!0);if("string"==typeof i.restricted_message&&""!=i.restricted_message&&(i.restricted_message=JSON.parse(i.restricted_message)),"string"==typeof i.restricted_attachments&&""!=i.restricted_attachments&&(i.restricted_attachments=JSON.parse(i.restricted_attachments)),"number"==typeof i.ERRCODE&&(i.ERRCODE=""+i.ERRCODE),i.ERRCODE&&-1!=t.indexOf(i.ERRCODE)||i.restricted_message&&"disabled"===i.restricted_message.status||i.code&&-1!=i.code.indexOf("message")){var n=i.ERRMSG||i.message||i.restricted_message&&i.restricted_message.message||"";n&&(this.permdenied=!0,this.disableComposerOptions(n))}else(i.ERRCODE&&-1!=s.indexOf(i.ERRCODE)||i.restricted_attachments&&"disabled"===i.restricted_attachments.status||i.code&&-1!=i.code.indexOf("attachment"))&&this.disableFileShareOption();i.restricted_message&&i.restricted_message.place_holder&&(this.composer.placeholder=i.restricted_message.place_holder)}},ChatWindow.prototype.markMsgsRead=function(e){for(var t,s=e.split(","),i=0;i<s.length;i++){var n=(t=this.ctrlcomp.querySelector('[data-msguid="'+s[i]+'"]')).nextSibling&&t.nextSibling.querySelector("[data-msg-read]");WebMessanger.isReadReceiptEnabled()&&n&&(n.setAttribute("data-msg-read",!0),n.setAttribute("data-read-receipt",!0),n.setAttribute("title",$WC.I18N("Read")))}},ChatWindow.prototype.showDynamicActions=function(e,t,s){this.dynamicactioninstance=new $WC.DynamicActions;var i=this.createActionsMountPoint(this.hideDynamicActions.bind(this));this.dynamicactioninstance.mountComponent({node:i,data:e,loading:s,msgnode:t,chid:this.objId,closeCallBack:this.hideDynamicActions.bind(this),handleExecuteFuncCallback:$WC.Functions.handleExecuteFuncCallback})},ChatWindow.prototype.hideDynamicActions=function(){this.dynamicactionsvisible=!1,this.dynamicactioninstance.unmountComponent(),this.removeOverlay()},ChatWindow.prototype.populateDynamicActions=function(e){var t=e.getAttribute("data-url"),s=e.closest("[data-msgid]"),n=s.getAttribute("data-msgid");if(!this.dynamicactionsvisible)if(this.dynamicactionsvisible=!0,this.dynamicaction_msgs&&this.dynamicaction_msgs[n]&&(new Date).getTime()<this.dynamicaction_msgs[n].expires)this.showDynamicActions(this.dynamicaction_msgs[n],s,!1);else{this.showDynamicActions(null,s,!0);var i=function(e){var t=JSON.parse(e);if(t.buttons)this.dynamicactioninstance.updateDynamicActions(t),this.dynamicaction_msgs||(this.dynamicaction_msgs={}),this.dynamicaction_msgs[n]=t;else{var s=t.text?t.text:$WC.I18N("chat.settitle.error"),i=t.text?"info":null;$WC.Util.showErrorMsg(s,i)}}.bind(this),a=function(e){var t=$WC.I18N("chat.settitle.error");if(e){var s=JSON.parse(e);s.error&&s.error.text&&(t=s.error.text)}$WC.Util.showErrorMsg(t),this.hideDynamicActions()}.bind(this),o="";"chat"==e.getAttribute("data-dactionsparam")&&(o+="&chat_id="+this.objId),$WC.Ajax.requestToChat("v2/oembed/actions","url="+encodeURIComponent(t)+o,i,a)}},ChatWindow.prototype.fetchCompleteChannelData=function(){if(!$WC.Channels.get(this.objId)||!$WC.Channels.get(this.objId).muted_interval){var e="chid="+this.objId;$WC.Ajax.requestToChat("v1/channels",e,function(e){$WC.Channels.updateList(JSON.parse(e))})}},ChatWindow.prototype.uploadRecordedVoiceFile=function(e,t){WmsFileUploadUI.fillFileDetails(this.objId,[e]);var s=WmsFileUploadHandler.addFileForUpload(this.objId,e,"","",e.name);WmsFileUploadUI.setAndClearReplyMsg(this.objId,s),WmsFileUploadHandler.startFileUpload(this.objId,WmsFileUploadUI.getCallBackObject()),WmsFileUploadUI.addProgressBarForEachFile(this.objId,WmsFileUploadUI.getCallBackObject()),WmsFileUploadUI.setCustomCallBackObj(t)},ChatWindow.prototype.invokeVoiceMsg=function(){if($WC.VoiceRecorderApi.isVoiceRecordingActive()||"undefined"!=typeof MediaManager&&MediaManager.hasOnGoingSession())if($WC.VoiceRecorderApi.isVoiceRecordingActive())WMSUI.showMediaSessionErrorDialog({content:$WC.I18N("voicerecorder.endrecording"),buttontext:$WC.I18N("common.goahead")},function(){$WC.VoiceRecorderApi.closeAndRemoveRecordingSession(),this.invokeVoiceMsg()}.bind(this));else{var e=MediaCallImpl.hasOutgoingSession()?MediaCallImpl.getOutgoingSession():MediaCallImpl.getCurrentSession(),t=e.isAudioCall()?"videochat.audiocall":e.isVideoCall()?"videochat.videocall":"media.screenshare.session",s=e.isCaller(MediaUtil.getCurrentUserId())?e.getCallee().getName():e.getCaller().getName(),i=MediaUtil.getResource("media.endcall.info",[MediaUtil.getResource(t),s]);WMSUI.showMediaSessionErrorDialog({content:i,buttontext:$WC.I18N("common.goahead")},function(){MediaCallImpl.handleEnd(e.getId(),!0),this.invokeVoiceMsg()}.bind(this))}else{var n=$WC.Util.createElement("div","voicerecordercontainer","wms-voicerecordercontainer");this.win.querySelector("[data-footer=true]").appendChild(n);var a=function(){this.throwVoiceMsgRemovalError({confirmactiontext:$WC.I18N("Delete"),content:$WC.I18N("voicemsg.deleteinfo")})}.bind(this),o=function(e,t){WMSUI.showMediaSessionErrorDialog({content:$WC.I18N("media.mic"+t),buttontext:$WC.I18N("common.close")})}.bind(this);this.footernode.style.display="none";this.voicerecorderinstance.mountComponent(n,{closeCallBack:a,fileuploadCallBack:this.uploadRecordedVoiceFile.bind(this),errorCallBack:o,unmountCallBack:function(){this.footernode.style.display="table",this.changeFooterHeight(),this.composer.focus()}.bind(this),sessionid:this.objId})}},ChatWindow.prototype.hideVoiceMsgInvoker=function(){this.voicemsginvoker.style.display="none"},ChatWindow.prototype.showVoiceMsgInvoker=function(){this.disablevoicemsginvoker||(this.voicemsginvoker.style.display="block")},ChatWindow.prototype.throwVoiceMsgRemovalError=function(e){var t=new $WC.ConfirmationDialog,s=[{text:e.confirmactiontext,onclick:function(){this.voicerecorderinstance.unmountComponent(),t.unmountComponent(),"function"==typeof e.confirmCallBack&&e.confirmCallBack()}.bind(this),buttonstyle:"destructive_button"},{text:$WC.I18N("common.cancel"),onclick:function(){t.unmountComponent()},buttonstyle:"cancel_button"}],i=[$WC.I18N("voicemsg.alert"),$WC.I18N("voicemsg.alert")],n=[e.content];t.mountComponent({heading:i,content:n,actions:s,customimgiconclass:"wms_dialog_delete_icon"})},ChatWindow.prototype.updateCWInfoFromAttachSession=function(e){$WC.Util.isChannelChid(this.objId)?$WC.Channels.updateChannelMetaData(e):(this.addinfo=e.addinfo||this.addinfo,this.partcount=e.pcount||this.partcount,this.savehistory=e.history||this.savehistory,this.lastmsguid=e.lastmsguid||this.lastmsguid,this.customgroup=e.customgroup||this.customgroup,this.title=e.title||this.title,$WC.Util.isBotChid(this.objId)&&(this.title=$WC.Bots.getBotName($WC.Bots.getBotId(this.objId))||this.title),e.mutedinterval&&(this.mutedinterval=e.mutedinterval),$WC.Util.isThreadChid(this.objId)&&(this.thread_follower=e.is_follower)),("8"===this.ctype||"11"===this.ctype||"1"===this.ctype&&"true"===this.customgroup)&&this.updatePartCount(this.partcount),e.users&&(this.updateRecipientInfo(JSON.parse(e.users)),this.restrictFileSharingForExternalUser())},ChatWindow.prototype.updateRecipientInfo=function(e){for(var t=0;t<e.length;t++)$WC.Util.isLocalUser(e[t].zuid)||(this.recipientinfo[e[t].zuid]=e[t])},ChatWindow.prototype.getChatletPrd=function(){return"10"==this.ctype?this.entityid.split(".")[0]:""},ChatWindow.prototype.allowAddMemberForEntityChat=function(){return"10"==this.ctype&&-1<WmsSettings.adminsettings.chatlet_modify_enabled_prds.indexOf(this.getChatletPrd())},ChatWindow.prototype.isOneToOneChatWithExternalUser=function(){var e=!1;return 2==this.partcount&&WebMessanger.orgid&&this.recipientinfo[this.recipant]&&WebMessanger.orgid!=this.recipientinfo[this.recipant].zoid&&(e=!0),e},ChatWindow.prototype.restrictFileSharingForExternalUser=function(){WmsSettings.restrictFileSharingForExternalUser()&&this.isOneToOneChatWithExternalUser()&&this.disableFileShareOption()},Factory.createDialog=function(e,t){if(WindowHandler.getWinObjById(t.divId)){var s=WindowHandler.exist.indexOf(WindowHandler.getWinObjById(t.divId));WindowHandler.exist.splice(s,1)}var i=new ChatWindow;WindowHandler.exist.push(i);s=WindowHandler.exist.length-1;return i.setIndex(s),i.create(e,t)},Factory.removeDialog=function(e){WindowHandler.exist[e]="empty",WindowHandler.rearrange()},Factory.destroyDialog=function(e,t){Factory.removeDialog(e,t),WindowHandler.reopenRemovedChat()},WindowHandler.deleteParticipantsByID=function(e,t){var s=WindowHandler.getWinObjById(e);s&&s.deleteParticipants(t)},WindowHandler.addParticipantsByID=function(e,t){var s=WindowHandler.getWinObjById(e);s&&s.addParticipants(t,!0)},WindowHandler.checkAndHighlightChat=function(e){var t=WindowHandler.getWinObjById(e),s=$WC.RecentChats.getChatIdList($WC.RecentChats.getUnreadChatList());t&&-1!=s.indexOf(e)&&t.highlight()},WindowHandler.init=function(){this.count=0,this.exist=[],this.removed=[],this.lastViewed=-1,this.openedChats={},this.prevtime=null,this.cwsize=323,this.enlargedsize=455},WindowHandler.init(),WindowHandler.getMaxWin=function(){var e=0;!1===WebMessanger.isServiceStatus()&&(e=document.getElementById("wmsstatusbar").offsetWidth),WMSUI.globalsearchenabled&&document.getElementById("wmsglobalsearch")&&(e+=document.getElementById("wmsglobalsearch").offsetWidth),!WMSUI.notebook_widget_disabled&&document.getElementById("wms_notebook_icon")&&(e+=document.getElementById("wms_notebook_icon").offsetWidth);var t=document.getElementById("wmstoolbar").offsetWidth,s=WindowHandler.exist.find(function(e){if("empty"!==e&&e.isEnlarged)return!0})?this.enlargedsize-this.cwsize:0,i=(t-(e+document.getElementById("wms-menucontainer").offsetWidth+s))/this.cwsize;return i<1&&(i=1),void 0!==WebMessanger.forceMaxWin&&(i=WebMessanger.forceMaxWin),parseInt(i,10)},WindowHandler.reopenRemovedChat=function(){var e=WindowHandler.removed.pop();null!=e&&($WC.WmsSessionStorage.setChatInfo({chid:e,removed:"false"}),WebMessanger.attachSession(e))},WindowHandler.removeExcessChat=function(s,e){function t(e){var t=WindowHandler.exist[e];return"empty"==t||null==t||t.detached||null==document.getElementById(t.getObjId())||(t.getObjId()!=s&&null==a&&document.activeElement!=t.composer&&(t.composer.value||t.voicerecorderinstance.node?o=t:a=t),n++),a}var i,n=0,a=null,o=null;if(e)for(i=WindowHandler.exist.length;0<=i;i--)a=t(i);else for(i=0;i<WindowHandler.exist.length;i++)a=t(i);0<n&&WmsMainUI.toggleSmartChatButton(!0),n>this.getMaxWin()?(null==a&&(a=o),WindowHandler.removed.push(a.getObjId()),$WC.WmsSessionStorage.setChatInfo({chid:a.getObjId(),removed:"true",state:"min"}),a.win.style.display="none",$WC.Util.removeElement(a.win),WmsChatCache.remove(a.getObjId()),Message.deletedMessages.remove(a.getObjId()),Factory.removeDialog(a.winIndex,!1),WindowHandler.count--):WindowHandler.rearrange()},WindowHandler.sendBotSuggestions=function(e,t){var s=e.getAttribute("chid"),i=WindowHandler.getWinObjById(s);Message.send(s,t),i.listcommon.showUI(""),i.autocompletediv.style.display="none",i.footernode.style.borderRadius="5px"},WindowHandler.onResize=function(){if(document.getElementById("wms-menucontainer")){var e=$WC.Util.getObjectLength(WindowHandler.openedChats),t=WindowHandler.getMaxWin();if(t<e)for(var s=e-t,i=0;i<s;i++)WindowHandler.removeExcessChat(null,!0);else if(e<t&&0<WindowHandler.removed.length){var n=t-e;for(i=0;i<n;i++)WindowHandler.reopenRemovedChat()}}},$WC.Util.addEvent(window,"resize",WindowHandler.onResize),WindowHandler.getObjectInObject=function(e,t,s){for(var i=e.getElementsByTagName(s),n=0;n<i.length;n++)if(i[n].id==t)return i[n];return null},WindowHandler.getBarObject=function(e,t){return WindowHandler.getObjectInObject(this.chatbar,e,t)},WindowHandler.moveFocus=function(e,t,s){for(var i=0,n=0,a={},o={},r={},l=WindowHandler.exist.length;0<l;l--){var d=WindowHandler.exist[l];if("empty"!=d&&null!=d&&null!=d.win&&null!=d.win&&!d.isMinimized()){o=d;break}}for(var c=0;c<WindowHandler.exist.length;c++){var m=WindowHandler.exist[c];if("empty"!=m&&null!=m&&null!=m.win&&null!=m.win&&!m.detached&&!m.isMinimized()){if(0==i&&(a=m),i++,m.getObjId()==e){n=e;continue}if(0!=n)return t?$WC.Util.getObjectLength(r)?(r.selectChat(),r.focus("",s)):"block"===WmsMainUI.menu.style.display?(WmsMainUI.searchdiv.focus(),WindowHandler.lastViewed=-1):(o.selectChat(),o.focus("",s)):(m.selectChat(),m.focus("",s)),!1;r=m}}return t?(r.selectChat(),r.focus("",s)):s&&o.getObjId&&n==o.getObjId()&&a!=o?(a.selectChat(),a.focus("",!0)):n&&"block"===WmsMainUI.menu.style.display?(WmsMainUI.searchdiv.focus(),WindowHandler.lastViewed=-1):i&&(t?(o.selectChat(),o.focus("",s)):(a.selectChat(),a.focus("",s))),!1},WindowHandler.rearrange=function(){WindowHandler.openedChats={};for(var e=0;e<WindowHandler.exist.length;e++){var t=WindowHandler.exist[e];if("empty"!=t&&null!=t&&null!=t.win&&null!=t.win){var s=t.isMinimized()?"min":"max";$WC.WmsSessionStorage.setChatInfo({chid:t.getObjId(),state:s}),WindowHandler.openedChats[t.getObjId()]=s}}},WindowHandler.makeNormalWinById=function(e){var t=WindowHandler.getWinObjById(e);t&&t.makeNormal(!0)},WindowHandler.getWinObjById=function(e){e=""+e;for(var t=0;t<WindowHandler.exist.length;t++){var s=WindowHandler.exist[t];if("empty"!=s&&null!=s&&s.getObjId()==e)return s}return null},WindowHandler.removeWinById=function(e){var t=WindowHandler.getWinObjById(e);t&&t.close(!0)},WindowHandler.closeWinById=function(e){var t=WindowHandler.getWinObjById(e);t&&t.closeAndPropagate()},WindowHandler.updateMediacallPermissions=function(){for(var e=0;e<WindowHandler.exist.length;e++){var t=WindowHandler.exist[e];"empty"!==t&&t.showVideoDropdown()}},WindowHandler.updateUserStatus=function(e,t,s,i){for(var n=0;n<WindowHandler.exist.length;n++){var a=WindowHandler.exist[n];if("empty"!=a&&null!=a){var o=e;a.updatePartinfo(o,t,s,i),2==a.partcount&&a.recipant&&-1!=a.recipant.indexOf(o)?(a.updateUserStatus(t,s,i),0==t?a.updateOfflineMessage():0!=t&&a.offlinemessage&&a.updateOnlineMessage()):2<a.partcount&&void 0!==a.partinfo[o]&&"11"!=a.ctype&&a.populateParticipants()}}},WindowHandler.setTitle=function(e,t){WindowHandler.getWinObjById(e).setTitle(t)},WindowHandler.updateChatTitle=function(e,t){WindowHandler.getWinObjById(e).updateChatTitle(t)},WindowHandler.updateStatus=function(e,t,s,i){WindowHandler.getWinObjById(e).updateUserStatus(t,s,i)},WindowHandler.focusChatById=function(e){WindowHandler.getWinObjById(e).focus()},WindowHandler.changeActive=function(){WMSUI.handleDocumentActive()},WindowHandler.restoreChats=function(e){var t=$WC.WmsSessionStorage.getItem("wms_openchats");if(null!==t&&!WebMessanger.isExclusiveChat()&&!WebMessanger.isRTCChat()){var s=[];WindowHandler.removed=[];for(var i=0;i<t.length;i++){var n=t[i].chid;"true"===t[i].removed?WindowHandler.removed.push(n):"true"===t[i].salesiqchat?"undefined"!=typeof WmsUIImpl&&WmsImplHandler.invoke(WmsUIImpl.restoreChat,n):WebMessanger.prefetch_channels&&$WC.Util.isChannelChid(n)&&null===$WC.Channels.getLastFetchedTime()?($WC.Channels.initChannels(),WmsMainUI.scheduleAutoJoin(n)):e&&s.push(n)}var a=function(){if(0!=s.length){var e=s.shift();WebMessanger.joinChat(e,a)}};a()}},WindowHandler.syncChatWindowTranscripts=function(){var e=this.openedChats,t=0;function s(a,e){setTimeout(function(){var e=WindowHandler.getWinObjById(a).msgdisp,t=e.querySelectorAll("[data-transerror],[data-loading]"),s=e.querySelectorAll(".wms-msgfrag:not([data-notack]):not([data-transerror]),.wms-msginfofrag[data-editinfo]");if(s){var i=s[s.length-1];if(i){t.length&&!t[t.length-1].nextSibling&&$WC.Util.removeElement(t[t.length-1]);var n=$WC.Util.createElement("div",null,null,{"data-prevtime":i.getAttribute("data-msgtime"),"data-scrollbehaviour":"bottom"});n.style="display:none",e.appendChild(n),Message.loadSpecificTranscript(a,e,n,!0)}}},e)}for(var i in e)WindowHandler.getWinObjById(i).makeNormal(),s(i,t+=500)},WindowHandler.syncDraftsInUI=function(){for(var e=0;e<WindowHandler.exist.length;e++){var t=WindowHandler.exist[e];"empty"!==t&&t.restoreDraftedMsg()}},$WC.Util.pubsub.subscribe("drafts/updateui",function(){WindowHandler.syncDraftsInUI()}),WindowHandler.resetAllTypingStatus=function(){for(var e=0;e<WindowHandler.exist.length;e++)if("empty"!==WindowHandler.exist[e]){WindowHandler.exist[e].typingstatusnode.innerHTML="",WindowHandler.exist[e].typingindicatornode.style.display="none";var t=WindowHandler.exist[e].msgdisp.querySelector("[data-typingstatus]");t&&$WC.Util.removeElement(t)}},WindowHandler.updateBotsInfoInUI=function(){for(var e=0;e<WindowHandler.exist.length;e++){var t=WindowHandler.exist[e];if("empty"!==t&&9==t.ctype){var s=$WC.Bots.getBotId(t.objId),i=$WC.Bots.get(s);t.updateBotImage(s),t.setTitle(i.DNAME),t.updateUserStatus()}}},$WC.Util.pubsub.subscribe("/bots/updateui",function(){WindowHandler.updateBotsInfoInUI()}),WindowHandler.updateChannelProperties=function(){for(var e=0;e<WindowHandler.exist.length;e++){var t=WindowHandler.exist[e];"empty"!==t&&8==t.ctype&&($WC.Channels.get(t.objId)&&(0==$WC.Channels.isUserHasPermission(t.objId,$WC.WmsConstants.USERPERMISSIONS.SEND_MESSAGE)&&(t.permdenied=!0,t.disableComposerOptions($WC.I18N("channels.announcementonly"))),1==$WC.Channels.isUserHasPermission(t.objId,$WC.WmsConstants.USERPERMISSIONS.ADD_MEMBER)&&(t.addmembernode.style.display="block"),0==$WC.Channels.isUserHasPermission(t.objId,$WC.WmsConstants.USERPERMISSIONS.STICKY_MESSAGE)&&(t.pinmsgdetails.action_enabled=!1,t.pinmsgnode.setAttribute("data-show-options",!1)),t.showRestrictedChannelIcon(),0==$WC.Channels.isUserHasPermission(t.objId,$WC.WmsConstants.USERPERMISSIONS.LEAVE_ALLOWED)&&(t.leavechannelnode.style.display="none")),t.updateChannelImage())}},WindowHandler.shrinkEnlargedWindows=function(){for(var e=0;e<WindowHandler.exist.length;e++)"empty"!==WindowHandler.exist[e]&&WindowHandler.exist[e].shrinkEnlargedWindow()},WindowHandler.showProgress=function(e,t,s){var i=WindowHandler.getWinObjById(e);null!=i&&i.showProgress(t,s,WmsDragDrop.nooffiles)},WindowHandler.clearProgress=function(e){var t=WindowHandler.getWinObjById(e);null!=t&&t.clearProgress()},WindowHandler.checkAndHidePinmsgOptions=function(e){for(var t=0;t<WindowHandler.exist.length;t++)if("empty"!==WindowHandler.exist[t]&&!$WC.Util.isEmptyObject(WindowHandler.exist[t].pinmsgdetails.info)){if(e&&WindowHandler.exist[t].objId===e)continue;WindowHandler.exist[t].togglePinMsgOptions(!0)}},WindowHandler.getPinMsgForOpenedChats=function(){for(var e=0;e<WindowHandler.exist.length;e++)"empty"!==WindowHandler.exist[e]&&WindowHandler.exist[e].pinmsgdetails.msg_pinned&&WebMessanger.getPinnedMsg(WindowHandler.exist[e].objId);WebMessanger.get_pinmsg_onfocus=!1},WindowHandler.updateForwardedMsgFragments=function(){for(var e=0;e<WindowHandler.exist.length;e++)if("empty"!==WindowHandler.exist[e])for(var t=WindowHandler.exist[e].msgdisp.querySelectorAll("[data-forwardmsgchid]"),s=0;s<t.length;s++){var i=t[s].querySelector("[data-forwardchid]");if(i){var n=i.getAttribute("data-forwardchid");$WC.Util.isChannelChid(n)&&$WC.Channels.isJoinedChannel(n)?($WC.$CUtil.setInnerText(i.lastChild,$WC.Channels.get(n).dn),$WC.Util.setAttribute(t[s],"data-messagelink",!0)):($WC.Util.removeElement(i),$WC.Util.setAttribute(t[s],"data-messagelink",!1))}}},WindowHandler.updateInactiveUserStatus=function(e,t){var s=WindowHandler.getWinObjById(e);2===t.pcount&&t.users&&("string"==typeof t.users?JSON.parse(t.users):t.users).forEach(function(e){if("inactive"===e.status){var t=WmsContacts.getContactsList(e.zuid);t?(t.STATUS=e.status,WmsContacts.setContactsList(e.zuid,t)):WmsContacts.updateContact(e),s&&($WC.$CUtil.setInnerText(s.statusmsgnode,$WC.I18N("user.status.inactive")),s.statusmsgnode.title=$WC.I18N("user.status.inactive"),s.disableComposerOptions($WC.I18N("user.inactive.msg")),s.disableActions())}})},WindowHandler.updateThreadCount=function(e){var t=WindowHandler.getWinObjById(e.chid),s=WindowHandler.getWinObjById(e.threadchatid);if(t){t.toggleUnreadThreadBanner();var i=t.win.querySelector('[data-msguid="'+e.parentmsguid+'"]'),n=i&&i.querySelector('[data-thread_chid="'+e.threadchatid+'"]');if(n){var a=n&&n.getAttribute("data-thread_msgcount");$WC.$CUtil.setInnerText(n.querySelector('[id="wms_threadlink"]'),$WC.I18N("message.threads.count",[++a])),n.setAttribute("data-thread_msgcount",a)}}if(s){var o=s.win&&s.win.querySelector('[id="wms_threadsheader"]');a=$WC.Util.getInnerText(o).split(" ")[0];$WC.$CUtil.setInnerText(o,$WC.I18N("message.threads.count",[++a]))}},Message.types=$WC.Message.types,Message.getMsgCategory=function(e){return/span class="wms-commandtext">[/](?:.+?)<\/span>/.test(e)?"command":/span class="wms-atmtntext">[@](?:.+?)<\/span>/.test(e)||/span class="wms-atmtnlink" (.*?)>[@](?:.+?)<\/span>/.test(e)?"atmentions":/span class="wms-atmtntext">[+](?:.+?)<\/span>/.test(e)?"addmem":"msg"},Message.getCurtriggers=function(e){return"atmentions"==e?["@",":"]:"addmem"==e?["+",":"]:WMSUI.triggers},Message.metaInfo={},Message.mentionMsgInfo={},Message.translationmsgstore={},Message.urlmsgstore={},Message.replyPrivateMsgObj={},Message.toggleLiveZomoji=function(e){for(var t=e.querySelectorAll("[class^=zomoji-f-24-],[class^=zomoji-f-48-]"),s=0;s<t.length;s++){var i=t[s];if($WC.$CUtil.isScrolledIntoView(i,e,!0)){var n="https://static.zohocdn.com/chat/source/officechat/images/default/sm-animation/48/"+(r=(r=(r=i.closest("[data-reaction]").getAttribute("data-reaction")).replace(/:/g,"")).replace("!",""))+".png";if($WC.Config.get("builddomain")&&(n=$WC.Config.get("builddomain")+n),WMSUI.isLoadedImg(n))-1<i.className.indexOf("zomoji-f-24-")?i.className="zomojianim-24-"+r:-1<i.className.indexOf("zomoji-f-48-")&&(i.className="zomojianim-48-"+r);else{var a=new Image;a.src=n,a.onload=function(){WMSUI.loadedimg[n]=!0,Message.toggleLiveZomoji(e)}}}}var o=e.querySelectorAll("[class^=zomojianim-24-],[class^=zomojianim-48-]");for(s=0;s<o.length;s++){var r;i=o[s];if(!$WC.$CUtil.isScrolledIntoView(i,e,!0))r=(r=(r=i.closest("[data-reaction]").getAttribute("data-reaction")).replace(/:/g,"")).replace("!",""),-1<i.className.indexOf("zomojianim-24-")?i.className="zomoji-f-24-"+r:-1<i.className.indexOf("zomojianim-48-")&&(i.className="zomoji-f-48-"+r)}},Message.PREV_SENDER={},Message.send=function(e,t,s,i,n,a,o,r,l,d,c,m,u){var p=WindowHandler.getWinObjById(e);if(!WMSUI.showErrorIfPermDenied(e)&&!Message.checkAddMemberMsg(t)){if(4e3<t.length)return p.updateInfoMessage($WC.I18N("You_cannot_send_message_over_4000_characters_long")),!1;var h=(new Date).getTime();if(t=Smiley.replaceTextToEnglishCodes(t),r&&p){var g=p.ctrlcomp.querySelector('[data-msguid="'+r+'"]');if(g&&g.nextSibling&&"true"==g.nextSibling.getAttribute("data-timefrag")){var f=g.nextSibling.querySelector("[data-msg-read]");f&&g.nextSibling.setAttribute("data-read",f.getAttribute("data-msg-read")),g.nextSibling.innerText=$WC.I18N("message.status.sending")}}if(WebMessanger.sendFormattedMessage(e,t,h,s,i,n,a,o,r,d,c,m,u),t=$WC.Util.safeHTML(t),t=$WC.Markdown.apply(t),p.getUnfurlData(t)||(t=Message.trim(t)),o){var C=p.msgdisp.querySelector('[data-msgid="'+o+'"],[data-msguid="'+o+'"]');if(C){var v=p.constructReplyMessageObject(C,WMSUI.atMentions.updateMessage(t,e),h);v.sentfromcomposer=l}p.closeReplyPreview()}else if(0<p.urlpreviewcontainer.childNodes.length&&p.getUnfurlData(t)){var b=p.getUnfurlData(t);v={sender:WebMessanger.zuid,msg:t,time:h,notack:!0,meta:{linkdetails:b},sentfromcomposer:l}}else v={sender:WebMessanger.zuid,msg:WMSUI.atMentions.updateMessage(t,e),time:h,notack:!0,sentfromcomposer:l};return p.hideUrlPreview(),r||m?p.closeReplyPreview():i||Commands.isCommandMsg(t)||!v||p.updateMessage(v),p.removePromptMsg(),Self.isIdle[e]=!0,"11"!=p.ctype||"false"!==p.thread_follower||WebMessanger.threadmap[e]||(WebMessanger.threadmap[e]="true"),!0}},Message.checkAddMemberMsg=function(e){var t=e.replace(/{addchatmember(.*?)addchatmember}/g,"");return $WC.Util.isEmptyString(t)},Message.isSameBrowser=function(e){return e==WebMessanger.getSid()},Message.isSentFromApi=function(e){return!(!e||!e.api)},Message.isCustomMsg=function(e){var t=$WC.CMsgUtil.convertMsgObj(e);return t["btnindexvsdetails.msg"]&&!t.info||t["btnindexvsdetails.msg"]&&t.info&&"unfurling"!=t.info.type||!$WC.Util.isEmptyObject(t["brief.msg"])&&t["brief.msg"]||void 0!==t["long.msg"]&&0<t["long.msg"].length||e.meta&&e.meta.native_widget},Message.isReplyMsg=function(e){return null!=e.meta&&null!=e.meta.opr_replydetails},Message.isForwardMsg=function(e){return null!=e.meta&&null!=e.meta.forward_info},Message.isThreadMsg=function(e){return null!=e.meta&&null!=e.meta.post_in_parent_information},Message.isThreadNode=function(e){return!e.parentElement.closest("[data-type]")||"REPLYMSG"!==e.parentElement.closest("[data-type]").getAttribute("data-type")&&"FORWARDEDMSG"!==e.parentElement.closest("[data-type]").getAttribute("data-type")?e.querySelector("[data-thread_chid]"):e.parentElement.closest("[data-type]").querySelector("[data-thread_chid]")},Message.isBotMsg=function(e){return void 0!==e.meta&&1==e.meta.ms&&e.meta.bm||"string"==typeof e.sender&&$WC.Bots.isBotId(e.sender)||void 0!==e.meta&&e.meta.usermessagedetails&&e.meta.usermessagedetails.custom_sender_id&&$WC.Bots.isBotId(e.meta.usermessagedetails.custom_sender_id)},Message.isMsgFromBot=function(e){var t=Message.getMessageType(e);return e&&e.meta&&Message.isBotMsg(e)&&e.meta.message_source&&("bot"===e.meta.message_source.type||"command"===e.meta.message_source.type)||t===Message.types.BOTMSG||t===Message.types.CUSTOMMSG},Message.isDelayMsg=function(e){return void 0!==e.meta&&1==e.meta.ms&&e.meta.config&&e.meta.config.d},Message.isHidingMsg=function(e){return void 0!==e.meta&&1==e.meta.ms&&e.meta.config&&e.meta.config.h},Message.isMetaMsg=function(e){return void 0!==e.meta},Message.isTempMsg=function(e){return void 0!==e.meta&&e.meta.isTempResponse},Message.isCustomEmoji=function(e){return $WC.Matcher.check("customemoji",e)||void 0!==e.meta&&e.meta.customemoji},Message.furlVideoElement=function(e){for(var t,s=e.querySelectorAll("[data-playable=true]"),i=0;i<s.length;i++)t=s[i].getAttribute("thumbnailimg"),s[i].innerHTML='<div id="wms-urlvideo-play" class="wms-urlvideo-play wms-hvalign"></div>'+t},Message.formatCustomMsg=function(e,t){ZMSGUI.createOverlay();var s=Message.metaInfo[t],i=s.usermessagedetails,n=s.formattedmsg,a="",o="",r="",l='<div class="wms-custmmsgtitle">',d=i&&i.msg_title?'<div class="wms-custmmsgvline wms-truncate-ellipsis">{{msgtitle}}</div>':"",c=i&&(i.thumbnail_url||i.thumbnail_id)?'<div class="wms-custmmsgthumbnail"><img src="{{thumbnailurl}}" class="wms-custmmsgimg"></div>':"",m=n?n.length:0,u="";i&&i.thumbnail_url?u=i.thumbnail_url:i&&i.thumbnail_id&&(u="/"+_CHATCONT+"/v1/images/"+i.thumbnail_id);for(var p=0;p<m;p++){var h=n[p],g=h.data,f=h.type,C=h.title;if("text"===f)a=C?'<div class="wms-custmmsgtitle"><span class="wms-custmmsgtitvline wms-truncate-ellipsis">'+$WC.Util.escapeHTML(C)+"</span>":'<div class="wms-custmmsgtitle">',a+='<div class="wms-custmmsgcnt">'+$WC.Util.escapeHTML(g)+"</div></div>";else if("list"===f){o=C?'<div class="wms-custmmsgtitle"><span class="wms-custmmsgtitvline wms-truncate-ellipsis">'+$WC.Util.escapeHTML(C)+"</span>":'<div class="wms-custmmsgtitle">',o+='<ul class="wms-custmmsglist">';for(var v=g?g.length:0,b=0;b<v;b++)o+="<li>"+$WC.Util.escapeHTML(g[b])+"</li>";o+="</ul></div>"}else if("table"===f){r=C?'<div class="wms-custmmsgtitle"><span class="wms-custmmsgtitvline wms-truncate-ellipsis">'+$WC.Util.escapeHTML(C)+"</span>":'<div class="wms-custmmsgtitle">',r+='<div class="wms-custmtablediv"><div class="wms-custmtable"><div class="wms-custmrow">';for(var y=g.headers.length,_=0;_<y;_++)r+='<div class="wms-custmcel">'+$WC.Util.escapeHTML(g.headers[_])+"</div>";r+="</div>";for(var W=g.rows?g.rows.length:0,S=0;S<W;S++){r+='<div class="wms-custmrow">',v=g.rows[S].length;for(var w=0;w<v;w++)r+='<div class="wms-custmcel">'+$WC.Util.escapeHTML(g.rows[S][w])+"</div>";r+="</div>"}r+="</div></div>"}}l+=d+c+'<div class="wms-custmmsgpadding">{{custommsg}}</div></div>'+a+o+r+'</div></div><span class="wms-imgpreviewclose"><img src="https://img.zohocdn.com/ichat/images/a29a4f41_spacer.gif" class="wms-imgpreviewcls"></span>',l=$WC.template.replace(l,{msgtitle:i?i.msg_title:"",thumbnailurl:u,custommsg:e});var M=$WC.Util.createElement("div","wms-custmmsgcontainer","wms-custmmsg wms-hvalign");M.style.zIndex=$WC.Config.get("zindex"),document.body.appendChild(M),document.getElementById("wms-custmmsgcontainer").innerHTML=l,document.getElementById("wms-overlay").innerHTML='<span class="wms-imgpreviewclose"><img src="https://img.zohocdn.com/ichat/images/a29a4f41_spacer.gif" class="wms-imgpreviewcls"></span>'},Message.resend=function(e,t,s){var i=e.getAttribute("data-chid"),n=[],a=[];s?a=e.querySelectorAll("[data-msgfailure]"):a.push(t);for(var o=a.length-1;0<=o;o--)n.push(Message.getMsgFromDom(i,a[o].getAttribute("data-msgid")||a[o].parentNode.querySelector("[data-msgid]").getAttribute("data-msgid"),!1,!1)),Message.removeFailedMessages(a[o]);Message.sendmsg(i,n)},Message.removeFailedMessages=function(e){var t=e.previousSibling,s=e.nextSibling;if(t&&"wms-msgtime"===t.className&&(t=t.previousSibling),s&&"wms-msgtime"===s.className&&(s=s.nextSibling),t&&t.getAttribute("data-senderzuid")&&(!s||s&&s.getAttribute("data-senderzuid"))){var i=e.previousSibling;"wms-msgdate"===i.previousSibling.className&&$WC.Util.removeElement(i.previousSibling),$WC.Util.removeElement(e.previousSibling)}e.nextSibling&&"wms-msgtime"===e.nextSibling.className&&$WC.Util.removeElement(e.nextSibling),$WC.Util.removeElement(e)},Message.sendmsg=function(e,t){var s=t.pop();Message.send(e,s,t)},Message.getTextMsgFromDom=function(e,t,s,i){for(var n="",a=0;a<e.length;a++){if(i&&e[a-1]&&"BLOCKQUOTE"===e[a-1].nodeName&&(n+="\n"),"#text"===e[a].nodeName||"A"===e[a].nodeName)"A"===e[a].nodeName&&"linkhtml"===e[a].getAttribute("markdown")?n+=t?$WC.Util.safeHTML("["+$WC.Util.getInnerText(e[a])+"]("+e[a].href+")"):"["+$WC.Util.getInnerText(e[a])+"]("+e[a].href+")":n+=t?$WC.Util.safeHTML($WC.Util.getInnerText(e[a])):$WC.Util.getInnerText(e[a]);else if(e[a].getAttribute("data-urlpreviewcomment"))n+=Message.getTextMsgFromDom(e[a].childNodes,t,s);else if("SPAN"===e[a].nodeName){var o=e[a].outerHTML;n+=s?e[a].innerHTML:WMSUI.atMentions.replaceAtMentionsForHtml(o,t)}else if("EM"===e[a].nodeName){var r=e[a].outerHTML;n+=Smiley.replaceSmileyForHtml(r)}else"BLOCKQUOTE"===e[a].nodeName?n+=t?$WC.Markdown.apply("!"+Message.getTextMsgFromDom(e[a].childNodes,t)):"!"+Message.getTextMsgFromDom(e[a].childNodes,t):"CODE"===e[a].nodeName?n+=t?$WC.Markdown.apply("`"+Message.getTextMsgFromDom(e[a].childNodes,t)+"`"):"`"+Message.getTextMsgFromDom(e[a].childNodes,t)+"`":"PRE"===e[a].nodeName?n+=t?$WC.Markdown.apply("```"+Message.getTextMsgFromDom(e[a].childNodes,t)+"```"):"```"+Message.getTextMsgFromDom(e[a].childNodes,t)+"```":"STRONG"===e[a].nodeName?n+=t?$WC.Markdown.apply("*"+Message.getTextMsgFromDom(e[a].childNodes,t)+"*"):"*"+Message.getTextMsgFromDom(e[a].childNodes,t)+"*":"STRIKE"===e[a].nodeName?n+=t?$WC.Markdown.apply("~"+Message.getTextMsgFromDom(e[a].childNodes,t)+"~"):"~"+Message.getTextMsgFromDom(e[a].childNodes,t)+"~":"I"===e[a].nodeName?n+=t?$WC.Markdown.apply("_"+Message.getTextMsgFromDom(e[a].childNodes,t)+"_"):"_"+Message.getTextMsgFromDom(e[a].childNodes,t)+"_":"U"===e[a].nodeName?n+=t?$WC.Markdown.apply("__"+Message.getTextMsgFromDom(e[a].childNodes,t)+"__"):"__"+Message.getTextMsgFromDom(e[a].childNodes,t)+"__":"H1"===e[a].nodeName?n+=t?$WC.Markdown.apply("# "+Message.getTextMsgFromDom(e[a].childNodes,t)):"# "+Message.getTextMsgFromDom(e[a].childNodes,t):"H2"===e[a].nodeName?n+=t?$WC.Markdown.apply("## "+Message.getTextMsgFromDom(e[a].childNodes,t)):"## "+Message.getTextMsgFromDom(e[a].childNodes,t):"H3"===e[a].nodeName?n+=t?$WC.Markdown.apply("### "+Message.getTextMsgFromDom(e[a].childNodes,t)):"### "+Message.getTextMsgFromDom(e[a].childNodes,t):"H4"===e[a].nodeName?n+=t?$WC.Markdown.apply("#### "+Message.getTextMsgFromDom(e[a].childNodes,t)):"#### "+Message.getTextMsgFromDom(e[a].childNodes,t):"H5"===e[a].nodeName?n+=t?$WC.Markdown.apply("##### "+Message.getTextMsgFromDom(e[a].childNodes,t)):"##### "+Message.getTextMsgFromDom(e[a].childNodes,t):"H6"===e[a].nodeName?n+=t?$WC.Markdown.apply("###### "+Message.getTextMsgFromDom(e[a].childNodes,t)):"###### "+Message.getTextMsgFromDom(e[a].childNodes,t):"BR"===e[a].nodeName?n+="\n":"HR"===e[a].nodeName&&(n+="---");i&&e[a+1]&&"BLOCKQUOTE"===e[a+1].nodeName&&(n+="\n")}return n},Message.getMsgFromDom=function(e,t,s,i,n,a,o){var r=WindowHandler.getWinObjById(e).msgdisp,l=a?'.wms-msgfrag [data-msgid="'+t+'"]':'[data-msgid="'+t+'"]',d=(o=o?o.querySelector(l):r.querySelector(l)).getAttribute("data-type");d===Message.types.EDITEDMSG&&(d=o.firstChild.getAttribute("data-type")?o.firstChild.getAttribute("data-type"):Message.types.TEXTMSG);var c,m,u=(o=o&&o.firstChild).childNodes;if(d==Message.types.TEXTMSG||d==Message.types.BOTMSG)return Message.getTextMsgFromDom(u,i,n);if(d==Message.types.IMGATT){var p=o.querySelector("img[data-previewable]"),h=!s&&o.querySelector("[data-filecomment]")?$WC.Util.getInnerText(o.querySelector("[data-filecomment]")):"";m=p.getAttribute("data-fname");var g=p.getAttribute("data-furl");return{messagetype:d,fName:i?$WC.Util.safeHTML(m):m,fileurl:g+Message.getThumbnailImageUrl(g),isv1:p.getAttribute("data-isv1"),fcomment:$WC.Util.safeHTML(h)}}if(d==Message.types.REPLYMSG||d==Message.types.FORWARDEDMSG)return Message.getMsgFromDom(e,t,s,i,n,!0);if(d==Message.types.THREADLINKMSG){var f=null;return o.querySelector('[data-type="REPLYMSG"]')?f=o:t=o.querySelector("[data-msgid]").getAttribute("data-msgid"),Message.getMsgFromDom(e,t,s,i,n,null,f)}if(d==Message.types.FILEATT){c=o.querySelector(".wms-filetitle"),m=$WC.Util.getInnerText(c);h=!s&&o.querySelector("[data-filecomment]")?$WC.Util.getInnerText(o.querySelector("[data-filecomment]")):"";return{messagetype:d,fName:i?$WC.Util.safeHTML(m):m,fcomment:$WC.Util.safeHTML(h)}}if(d==Message.types.LOCATT)return c=o.querySelector(".wms-locmsgimg a"),m=$WC.Util.getInnerText(c),{messagetype:d,name:i?$WC.Util.safeHTML(m):m};if(d==Message.types.CONTACTATT)return c=o.querySelector(".wms-contactmsgimg span"),m=$WC.Util.getInnerText(c.firstChild),{messagetype:d,name:i?$WC.Util.safeHTML(m):m};if(d==Message.types.EVENTATT)return c=o.querySelector(".wms-evntmsgname"),m=$WC.Util.getInnerText(c),{messagetype:d,name:i?$WC.Util.safeHTML(m):m};if(d==Message.types.AUDIOATT){m=o.querySelector("[data-fname]")?o.querySelector("[data-fname]").getAttribute("data-fname"):"";h=!s&&o.querySelector("[data-filecomment]")?$WC.Util.getInnerText(o.querySelector("[data-filecomment]")):"";return{messagetype:d,fName:i?$WC.Util.safeHTML(m):m,fcomment:$WC.Util.safeHTML(h)}}if(d!=Message.types.VIDEOATT)return d==Message.types.CUSTOMMSG?(c=o.querySelector(".zcdesc"))?(m=$WC.Util.getInnerText(c),{messagetype:d,desc:i?$WC.Util.safeHTML(m):m}):Message.getTextMsgFromDom(u,i):d==Message.types.VIDEOLINK||d==Message.types.AUDIOLINK?(c=o.querySelector("a"),m=$WC.Util.getInnerText(c),{messagetype:d,desc:i?$WC.Util.safeHTML(m):m}):d==Message.types.IMGLINK?(c=o.querySelector("img"),{messagetype:d,desc:i?$WC.Util.safeHTML(c.src):c.src}):d==Message.types.HRMSG?(o=o.parentNode.lastChild,Message.getTextMsgFromDom([o],i)):void 0;m=(c=o.querySelector("#wms-videoplayer")).getAttribute("data-fname");h=!s&&o.querySelector("[data-filecomment]")?$WC.Util.getInnerText(o.querySelector("[data-filecomment]")):"";return{messagetype:d,fName:i?$WC.Util.safeHTML(m):m,fcomment:$WC.Util.safeHTML(h)}},Message.formatDraftMsg=function(e){var t=e.msg;if(e.meta&&e.meta.mentions){var s=e.meta.mentions;for(var i in s)if(s[i].type===$WC.CMsgUtil.UserMention){var n="{@"+s[i].id+"}";-1!=t.indexOf(n)&&(t=t.replace(n,"@"+$WC.Util.getContactName(s[i].id,s[i].name)))}else if(s[i].type===$WC.CMsgUtil.ChannelMention){n="{#"+s[i].id+"}";-1!=t.indexOf(n)&&(t=t.replace(n,s[i].dname))}else if(s[i].type==$WC.CMsgUtil.SpecialMention.participants||s[i].type==$WC.CMsgUtil.SpecialMention.available){n="{@"+s[i].id+"}";-1!=t.indexOf(n)&&(t=t.replace(n,s[i].dname))}}return Message.isAddMsg(t)&&(t=WMSUI.atMentions.format(t,!0)),t},Message.isMentionMsg=function(e){return $WC.Matcher.check("atmention",e)||$WC.Matcher.check("usersilentmention",e)||e.meta&&e.meta.mentions},Message.isAddMsg=function(e){return $WC.Matcher.check("addmember",e)||e.meta&&e.meta.mentions},Message.formatLastMsgInfo=function(e){var t=e;if(Message.isMentionMsg(e)||Message.isAddMsg(e)){t=WMSUI.atMentions.format(e,!0)}else"string"==typeof e&&-1!==e.indexOf("<hr>")&&(t=e.replace("<hr>","---"));return t},Message.getDnameFromMetaDataFormat=function(e){var t=$WC.Util.getContactName(e.split(":")[1]);return t=e.split(":")[1]===WebMessanger.zuid?WebMessanger.getNickName():t||e.split(":")[3],$WC.Util.escapeHTML(t)},Message.constructMessageFragment=function(){function re(e,t,s){return Message.isBotMsg(e)&&Message.isCustomMsg(e)?(Message.metaInfo[t]=e.meta,'<a data-custommsg="true" >'+$WC.CMsgUtil.convertLinks(e.msg)+"</a>"):(e=Message.isMentionMsg(e)||Message.isAddMsg(e)?WMSUI.atMentions.format(e):e,s||(e=$WC.Markdown.apply(e)),e=Message.getDisplayContent(e))}var le,n,de;function ce(e,t,s){var i,n,a,o,r="",l="",d="",c="",m="",u="",p={},h="wms-imgmsgcontainer",g=e.url||e.fileurl,f=e.content||e.contenttype;if(Message.isFileViewDisabled(e))return'<div class="wms-msg">'+Message.getDisabledFileView()+"</div>";if(e.meta&&e.meta.linkdetails&&-1!==e.meta.linkdetails.mimetype.indexOf("image/"))d=e.meta.linkdetails.url,e=e.msg,h="wms-imgmetamsgcontainer",n=240,i=130;else if(e.meta&&e.meta.linkdetails&&-1!==e.meta.linkdetails.mimetype.indexOf("text/")?(l='<div class="wms-iconseperator"><div class="wms-urlinfoouterdiv"><div class="wms-urlinfo"><a href="{{urllink}}" target="_blank" class="wms-urlinfolink">{{urltitlelink}}</a></div><div class="wms-urlinfo"><a href="{{urlauthorurl}}" target="_blank" class="wms-urlinfoauthor">{{urlauthor}}</a></div><div class="wms-urlinfo"><a href="{{urlproviderurl}}" target="_blank" class="wms-urlsiteinfo">{{urlprovider}}</a></div></div>',d=e.meta.linkdetails.imgurl,p=e.meta.linkdetails,e=e.msg,c=p.imgurl,m=p.providerurl,h="wms-imgmetamsgcontainer"):(d=e.constructeddownloadurl||e.url,u=e["img-data"]?"data:image/jpeg;base64,"+e["img-data"]:"",l='<div data-type="'+Message.types.IMGATT+'" class="wms-msg wms-imgwrapper">'),e.dim){var C=e.dim.height/e.dim.width;n=e.dim.width,240<=e.dim.width&&(n=240),i=Math.ceil(n*C),n<240&&(n=240),i<130&&(i=130),o=e.dim.width,a=e.dim.height}else n=229,a=i=130,o=240,d=e.constructeddownloadurl||e.url;var v="";if(e.comment){e.comment=$WC.Util.safeHTML($WC.Util.unescapeHTML(e.comment)),v=e.meta&&e.meta.mentions?$WC.Util.formatMentions(e):e.comment;var b=Message.getDisplayContent($WC.Markdown.apply(v));r=$WC.template.replace('<div data-filecomment=true class="wms-msgcomment">{{comment}}</div>',{comment:b},"InSecureHTML"),h+=" wms-imgmsgcontainer-withcomment"}var y='src="{{originalsrc}}"';!WMSUI.isLoadedImg(d)&&u&&(y='class="wms-imgbluroverlay" originalsrc="{{originalsrc}}" src="{{src}}"');var _=l+'<div class="{{classname}}" data-previewable="true"><img '+y+'src="{{originalsrc}}" data-fname="{{filename}}" data-fsize="{{size}}" data-fsender="{{sender}}" data-fdate="{{date}}" data-ftime="{{time}}" data-fheight="{{actualheight}}" data-fwidth="{{actualwidth}}" data-fcomment="{{comment}}" {{msguid}} data-fcontent="{{content}}" data-furl="{{url}}" data-dname="{{dname}}" data-previewable="true" data-filefrwrd={{filefrwrdsupport}} data-isv1={{isv1}}></div>'+r+"</div>";return $WC.template.replace(_,{originalsrc:d,src:u,classname:h,size:e.size||"",sender:e.sender,date:$WC.DateUtil.formatDate(e.time),time:$WC.DateUtil.formatTime(e.time),actualheight:a,actualwidth:o,height:i,width:n,filename:e.fName,comment:v,content:f,url:g,dname:t,linkurl:c,urllink:p.url,urltitlelink:p.title,urlauthorurl:p.authorurl,urlproviderurl:m,urlauthor:p.authorname,urlprovider:p.providername,filefrwrdsupport:!!e.isFileForwardSupported,isv1:!!e.isv1,$download:"chat.download",$forward:"chat.forward",$preview:"chat.preview",msguid:s})}function me(s){if(Message.isFileViewDisabled(s))return Message.getDisabledFileView();var e="",t="";if(s.commentmsg="",s.previewurl=Message.getDownloadUrl(s)+"&x-cli-msg=%7Bmode%3Aview%7D",WebMessanger.isUDSDownloadEnabled()&&!WebMessanger.isGuestUser()||(s.previewurl=Message.getDownloadUrl(s)+"/view"),WebMessanger.isGuestUser()&&(s.guestthumbnailurl=s.constructeddownloadurl),s.comment&&s.comment.trim()){s.comment=$WC.Util.safeHTML($WC.Util.unescapeHTML(s.comment)),t=s.meta&&s.meta.mentions?$WC.Util.formatMentions(s):s.comment;var i=Message.getDisplayContent($WC.Markdown.apply(t)).trim();e="<div data-filecomment=true class='wms-msgcomment'>{{comment}}</div>",e=$WC.template.replace(e,{comment:i},"InSecureHTML"),s.commentmsg=t}if(s.thumb){var n=s.guestthumbnailurl?s.guestthumbnailurl:s.constructeddownloadurl+Message.getThumbnailImageUrl(s.constructeddownloadurl);if(WMSUI.isLoadedImg(n))s.thumbnailurl=n;else{var a=new Image;a.src=n,a.onload=function(){var e=document.querySelector('[data-msgid="'+s.msgid+'"');if(e){var t=e.querySelector("[data-filethumbnail=true]").firstElementChild;n=s.guestthumbnailurl?s.guestthumbnailurl:s.constructeddownloadurl+Message.getThumbnailImageUrl(s.constructeddownloadurl),t.src=n,WMSUI.isLoadedImg[n]=!0}},s.thumbnailurl="data:image/jpeg;base64,"+s["img-data"]}}return $WC.UrlPreview.constructFileFragment(s)+e}function ue(e){if(Message.isFileViewDisabled(e))return Message.getDisabledFileView();var t="",s="";if(e.comment){e.comment=$WC.Markdown.apply($WC.Util.safeHTML($WC.Util.unescapeHTML(e.comment))),s=e.meta&&e.meta.mentions?$WC.Util.formatMentions(e):e.comment;var i=Smiley.replace(s);t="<div data-filecomment=true class='wms-msgcomment'>{{comment}}</div>",t=$WC.template.replace(t,{comment:i},"InSecureHTML")}var n='<div class="wms-audiofilecontainer"><div data-media="true" data-duration="{{duration}}" id="wms-audioplayer" data-mountaudioplayer="true" class="wms-audioplayerdiv" data-fsrc="{{filesrc}}" data-fname="{{filename}}" data-fcomment="{{comment}}" data-fcontent="{{type}}" data-furl="{{url}}" data-ftype="{{type}}" data-filefrwrd="{{fileforward}}" data-isv1="{{isv1}}"><div></div></div></div>';n+=t;var a=e.content||e.contenttype,o=e.url||e.fileurl,r=e.meta&&e.meta.linkdetails?e.meta.linkdetails.url:e.constructeddownloadurl?e.constructeddownloadurl:_WMSCHATURL+"download.sas?mime="+a+"&url="+o+"&fName="+e.fName;return $WC.template.replace(n,{filesrc:r,filename:e.fName||r,filesize:e.size||"",duration:e.duration||"0",url:o,type:a,comment:s,isv1:e.isv1,fileforward:!!e.isFileForwardSupported})}function pe(e){if(Message.isFileViewDisabled(e))return Message.getDisabledFileView();var t="",s="",i="wms-videoplayer wms-videoplayarea";if(e.comment){e.comment=$WC.Util.safeHTML($WC.Util.unescapeHTML(e.comment)),s=e.meta&&e.meta.mentions?$WC.Util.formatMentions(e):e.comment;var n=$WC.Markdown.apply(Smiley.replace(s));t="<div data-filecomment=true class='wms-msgcomment'>{{comment}}</div>",i+=" wms-videoplayer-withcomment",t=$WC.template.replace(t,{comment:n},"InSecureHTML")}var a=e.content||e.contenttype,o=e.url||e.fileurl,r=e.meta&&e.meta.linkdetails?e.meta.linkdetails.url:e.constructeddownloadurl?e.constructeddownloadurl:_WMSCHATURL+"download.sas?mime="+a+"&url="+o+"&fName="+e.fName,l=r,d={hideforwardicon:!e.isFileForwardSupported};WebMessanger.isGuestUser()&&(d.isguestuser=!0,d.videourl=r),e.thumb&&!WebMessanger.isGuestUser()&&(l+=Message.getThumbnailImageUrl(l));var c='<div id="wms-videoplayer" data-isv1="{{isv1}}" data-media="true" class="{{classname}}" data-fcomment="{{comment}}" data-fposter="{{posterurl}}" data-fsrc="{{filesrc}}" data-fname="{{filename}}"  data-fcontent="{{type}}" data-furl="{{url}}" data-filefrwrd="{{filefrwrd}}">'+(new $WC.VideoPlayer).createInitialState(l,d)+"</div>"+t;return $WC.template.replace(c,{filesrc:r,filename:e.fName||r,filesize:e.size||"",duration:"",classname:i,url:o,type:a,comment:s,filefrwrd:!!e.isFileForwardSupported,isv1:e.isv1,posterurl:l})}function he(e){if(e&&e.meta){1!==e.meta.revision&&2!==e.meta.revision||(e.raw=!0),e.meta.usermessagedetails||(e.meta.usermessagedetails={}),e.meta.usermessagedetails.themeid=e.meta.usermessagedetails.themeid||1;var t=$WC.CMsgUtil.convertMsgObj(e);return $WC.CustomMsgUI.getCustomMessageContent(t)}}function ge(e){var t=e.meta.post_in_parent_information,s=$WC.I18N("thread.msg.postinfo",['<span class="wms_threadmsgheader_title">"'+$WC.Util.safeHTML(t.thread_chat_title)+'"</span>']),i='<div class="wms_forwardmsg" data-threadmsg_post="'+t.thread_chat_id+'" data-thread_title="'+$WC.Util.safeHTML(t.thread_chat_title)+'" data-thread_msgid="'+t.thread_origin_message_id+'" data-thread_chid="'+t.thread_chat_id+'" data-thread_followercnt="1" data-thread_follower="true" data-thread_msgcnt="" data-thread_creator="'+t.sender+'"><div class="wms_threadmsgheader">'+s+"</div></div>";delete e.meta.post_in_parent_information,Ce(e);var n=Message.getMessageType(e),a=e.sender+"_"+e.msgid,o=e.msg;return(1<Object.keys(e.meta).length&&Message.getMessageType(e)!=Message.types.FILEATT&&Message.getMessageType(e)!=Message.types.IMGATT&&Message.getMessageType(e)!=Message.types.VIDEOATT&&Message.getMessageType(e)!=Message.types.AUDIOATT||Message.getMessageType(e)===Message.types.EDITEDMSG)&&(o=e),'<div class="wms_forwardmsgwrapper">'+i+Message.constructMessageFragment(e.sender,e.dname,e.time,o,n,e.sender,e.time,a,null,null,null,null,e.msguid,null,null,null,null,null,null,!0)+"</div>"}function fe(e,t,s){var i=e.meta.forward_info,n=i.chid,a=i.msguid,o="",r=!1;$WC.Util.isChannelChid(n)&&($WC.Util.isEmptyObject($WC.Channels.get())&&!1===_WMS_FETCHCHANNELSINITIATED?($WC.Channels.getChannels(),$WC.Util.pubsub.subscribe("/channels/updateui",function(){WindowHandler.updateForwardedMsgFragments()}),_WMS_FETCHCHANNELSINITIATED=!0):$WC.Channels.isJoinedChannel(n)&&(o=i.chat_title,r=!0));var l=$WC.Util.isLocalUser(i.sender)?$WC.Config.get("dname"):$WC.Util.getContactName(i.sender,i.dname);i.bot&&(l=i.bot.name);var d=$WC.I18N("forward.info.sender",['<span class="wms_forwardinfo_highlight" data-zcprofileid="'+i.sender+'">'+l+"</span>"]);d+=$WC.Util.isChannelChid(n)&&($WC.Channels.isJoinedChannel(n)||$WC.Util.isEmptyObject($WC.Channels.get()))?' <span data-forwardchid="'+n+'">'+$WC.I18N("forward.info.chat",['<span class="wms_forwardinfo_highlight">'+o+"</span>"])+"</span>":"";var c='<div class="wms_forwardmsg" data-forwardmsgid="'+a+'" data-forwardmsgchid="'+n+'" data-messagelink='+r+'><div class="wms_forwardmsgheader"><span class="wms_forwardmsgicon"></span><span class="wms_forwardinfo">'+$WC.I18N("forward.msg.info")+'</span></div><div><div class="wms_forwardmsgsender">'+d+"</div></div></div>";delete e.meta.forward_info,Ce(e);var m=Message.getMessageType(e),u=e.msg,p=e.sender+"_"+e.time;if(1<Object.keys(e.meta).length){if("object"!=typeof u)u=e;else for(var h in e.meta)e.msg.meta[h]=e.meta[h];u.meta.linkdetails&&(u.msg=$WC.Util.safeHTML($WC.Util.unescapeHTML(u.msg)))}else"object"!=typeof u&&(u=$WC.Util.safeHTML($WC.Util.unescapeHTML(u)));return'<div class="wms_forwardmsgwrapper">'+c+Message.constructMessageFragment(e.sender,e.dname,e.time,u,m,e.sender,e.time,p,t,null,null,null,e.msguid,null,null,null,null,null,s)+"</div>"}function Ce(e,t){var s,i=Message.getMessageType(e);i!==Message.types.IMGATT&&i!==Message.types.FILEATT&&i!==Message.types.VIDEOATT&&i!==Message.types.AUDIOATT||(t?((s=e).contenttype,s.fileurl):((s=e.msg).content,s.url),s.constructeddownloadurl=Message.getDownloadUrl(s),i===Message.types.IMGATT&&s.thumb?s.constructeddownloadurl+=Message.getThumbnailImageUrl(s.constructeddownloadurl):WebMessanger.isGuestUser()&&-1==s.constructeddownloadurl.indexOf("guest_id")&&(s.constructeddownloadurl+="?guest_id="+WebMessanger.guest_info.encrypt_id),s.isFileForwardSupported=!0)}function ve(e,t){e.meta.linkdetails.notification_configs&&e.msguid&&(Message.urlmsgstore[e.msguid]=e);var s={dname:e.dname,sender:e.sender,date:$WC.DateUtil.formatDate(e.time),time:$WC.DateUtil.formatTime(e.time)};e.sentfromcomposer||(t&&t!=Message.types.BOTMSG||!t)&&(e.msg=$WC.Util.safeHTML($WC.Util.unescapeHTML(e.msg)));var i=e.msg,n="";if(e.meta.linkdetails.chid=e.chid,$WC.UrlPreview.isWorkDriveURL(i)&&$WC.Util.isBetaOrg()){var a=$WC.UrlPreview.getWDPermalinkRegex($WC.UrlPreview.workdrivedomain),o=i.match(a)[0];n=o.replaceAll(o,$WC.UrlPreview.getWorkDriveRedirectURL(e.meta.linkdetails,o))}if(e.meta.mentions)i=$WC.Util.formatMentions(e);else{var r=e.chid,l=i.match(/{[\+|\-]?[@#](.*?)}/g);l&&0<l.length&&(i=WMSUI.atMentions.updateMessage(i,r))}var d='<div class="wms-msgcomment"  data-urlpreviewcomment="true"'+(n?'data-redirecturl="'+n+'"':"")+">"+(i=Message.getDisplayContent($WC.Markdown.apply(i))).trim()+"</div>",c=!1;if("rich"===e.meta.linkdetails.linktype&&(e.meta.linkdetails.html||e.meta.linkdetails.iframe_url)&&(c=!0),t===Message.types.VIDEOLINK)return'<div class="wms-msg">'+$WC.UrlPreview.constructVideoLinkFragment(e)+d+"</div>";if(t===Message.types.AUDIOLINK)return'<div class="wms-msg">'+$WC.UrlPreview.constructAudioLinkFragment(e)+d+"</div>";if(t===Message.types.IMGLINK)return e.meta.linkdetails.redirected_url&&(e.meta.linkdetails.url=e.meta.linkdetails.redirected_url),'<div class="wms-msg">'+$WC.UrlPreview.constructImageLinkFragment(e)+d+"</div>";var m=e.meta.linkdetails;return e.meta.btnindexvsdetails&&(m.btnindexvsdetails=e.meta.btnindexvsdetails),m.redirected_url&&(m.url=m.redirected_url),m.redirected_thumbnail_url&&(m.thumbnailurl=m.redirected_thumbnail_url),m.cliq_message&&(m.description=Smiley.replace($WC.Util.safeHTML($WC.Util.unescapeHTML(m.description||m.url)))),'<div class="wms-msg wms-urlpreviewmsg">'+$WC.UrlPreview.populate(m,null,s,!1,c)+d+"</div>"}return Message.constructReactionsFragment=le=function(s,e){var t=Object.keys(s),i=(e=e||t.sort(function(e,t){return s[t].length-s[e].length})).map(function(e){return n(s,e)}).join("");return'<div class="wms_reaction_frag">'+(i+='<span class="wms_reaction_container wms_reaction_add" title="'+$WC.I18N("message.actions.addreactions")+'" data-addreaction=true></span>')+"</div>"},Message.constructReactionFragment=n=function(e,t){var s="true"==e[t].hasCurrentUserReacted,i=e[t].users?e[t].users:e[t],n=$WC.Util.isArray(i)?i.map(function(e){var t=(e=e.split(":"))[1];return!1===s&&(s=$WC.Util.isLocalUser(t)),$WC.Util.isLocalUser(t)?$WC.I18N("chat.you"):$WC.Util.getContactName(t,e[2],!0)}).reverse().join(", "):"",a=Message.reactions.getSmileyName(t)||t,o=Message.isCustomEmoji(t)?Message.reactions.replaceCustomEmoji(t):Message.reactions.replace(t,!0),r=e[t].count?e[t].count:e[t].length,l=$WC.Util.safeHTML($WC.I18N("reactions.title",[n,a]));if(parseInt(r)>i.length){var d=r-i.length;l=$WC.Util.safeHTML($WC.I18N("reactions.titlewithmore",[n,d,a]))}return $WC.template.replace('<span class="wms_reaction_container" title="{{title}}" {{is_reacted_by_me}} data-reaction="{{code}}">{{reaction}}<span>{{count}}</span></span>',{reaction:o,count:r,is_reacted_by_me:s?"data-reactedbyme=true":"",title:l,code:$WC.Util.safeHTML(t)},"InSecureHTML")},Message.constructReplyMessageFragment=de=function(e,t,s,i,n,a){var o=e.meta.opr_replydetails;o.msg=o.meta&&o.meta.mentions&&o.msg?$WC.Util.formatMentions(o):o.msg;var r=o.msg||o;if("object"==typeof r)for(var l in r.addinfo)r[l]=r.addinfo[l];var d,c=$WC.Util.getContactName(o.sender)||o.sendername;if(delete e.meta.opr_replydetails,Ce(e),Ce(o,!0),Message.getMessageType(r)===Message.types.IMGATT)d=o.fcomment?'<span data-fileurl="'+o.fileurl+'" class="wms-replytext">'+o.fcomment+"</span>":'<div data-fileurl="'+o.fileurl+'" class="wms-replyimg"><img src="{{replyimgurl}}"/><span class="imgtext wms-truncate-ellipsis">{{fname}}</span></div>';else if(Message.getMessageType(r)===Message.types.FILEATT)d=o.msg&&o.msg.fcomment?'<span data-fileurl="'+o.fileurl+'" class="wms-replytext">'+o.msg.fcomment+"</span>":'<span data-fileurl="'+o.fileurl+'" class="imgtext wms-truncate-ellipsis">{{fname}}</span>';else if(Message.getMessageType(r)===Message.types.AUDIOATT)d=o.msg&&o.msg.fcomment?'<span data-fileurl="'+o.fileurl+'" class="wms-replytext">'+o.msg.fcomment+"</span>":'<span data-fileurl="'+o.fileurl+'" class="imgtext wms-truncate-ellipsis">{{fname}}</span>';else if(Message.getMessageType(r)===Message.types.VIDEOATT)d=o.msg&&o.msg.fcomment?'<span data-fileurl="'+o.fileurl+'" class="wms-replytext">'+o.msg.fcomment+"</span>":'<span data-fileurl="'+o.fileurl+'" class="imgtext wms-truncate-ellipsis">{{fname}}</span>';else if(Message.getMessageType(r)===Message.types.LOCATT)d="<div class='wms-filemsgcontainer wms-locmsgimg'><div><span>{{locname}}</span></div></div>";else if(Message.getMessageType(r)===Message.types.CONTACTATT)d="<div class='wms-filemsgcontainer wms-contactmsgimg'><span>{{contactname}}</span></div>";else if(Message.getMessageType(r)===Message.types.EVENTATT)d='<div class="wms-evntmsgcontainer"><span class="wms_calicon"></span><span>{{eventname}}</span></div>';else if(Message.getMessageType(r)===Message.types.CUSTOMMSG||Message.getMessageType(r)===Message.types.BOTMSG||Message.getMessageType(r)===Message.types.VIDEOLINK||Message.getMessageType(r)===Message.types.AUDIOLINK||Message.getMessageType(r)===Message.types.IMGLINK)d='<div class="wms-replytext">{{desc}}</div>';else try{d='<div class="wms-replytext">'+re(r)+"</div>"}catch(e){d="=========FORMAT TO BE SUPPORTED========"}var m="";if(!t){var u=e.sender+"_"+e.time,p=e.time;e.mtype===""+CT_EDITED_MSG&&(u=e.sender+"_"+e.origin_time,p=e.origin_time);var h=e.msg;(1<Object.keys(e.meta).length&&Message.getMessageType(e)!=Message.types.FILEATT&&Message.getMessageType(e)!=Message.types.IMGATT&&Message.getMessageType(e)!=Message.types.VIDEOATT&&Message.getMessageType(e)!=Message.types.AUDIOATT||Message.getMessageType(e)===Message.types.EDITEDMSG)&&(h=e),m=Message.constructMessageFragment(e.sender,e.dname,p,h,Message.getMessageType(e),e.sender,p,u,!0,null,null,null,e.msguid)}var g="";t&&(g='<div class="wms_cw_replyclose"></div>');var f="",C="",v="";s?(v='<div class="wms-replymsg"  data-replymsgtime="{{replymsgtime}}" data-msguid="{{msguid}}">',f='<span class="wms-editmsgicon"></span><span class="wms-replymsgtitle" title="'+$WC.I18N("message.edit.title")+'">'+$WC.I18N("message.edit.title")+"</span>",C='<div class="wms_settings_chckbx"><span data-type="custom" class="wms_settings_customcheckbox"></span><input id="wms_notifyeditmsg" data-setting="notifyedit" type="checkbox" class="wms_settings_checkbox"><label id="wms_notifyeditlabel" class="wms_settings_label" for="wms_notifyeditmsg">'+$WC.I18N("message.edit.notify")+"</label></div>"):(v='<div class="wms-replymsg" data-replymsgtime="{{replymsgtime}}" data-replysenderzuid="{{senderzuid}}" data-replymsguid="{{msguid}}" ',v+=(n=n||o.chid)?'data-privatereplychid="'+n+'">':">",i?(f='<span class="wms_threadreplyicon"></span>',C='<div class="wms_settings_chckbx"><span data-type="custom" class="wms_settings_customcheckbox"></span><input id="wms_notifyeditmsg" data-setting="notifyedit" type="checkbox" class="wms_settings_checkbox"><label id="wms_notifyeditlabel" class="wms_settings_label" for="wms_notifyeditmsg">'+$WC.I18N("thread.msgs.post",[$WC.Util.safeHTML($WC.Channels.getChannelName(a))])+"</label></div>"):f='<span class="wms-replymsgicon"></span>',f+='<span class="wms-replymsgsender wms-truncate-ellipsis" title="{{sendername}}">{{sendername}} ',f+=o.chat_title?'<span class="wms_replytitleicon">&#8594; </span><span class="wms_replychattitle">'+$WC.Util.safeHTML(o.chat_title)+"</span></span>":"</span>",f+='<span class="wms-replymsgtime wms-truncate-ellipsis" title="{{dateinwords}} {{formattedtime}}">{{dateinwords}} {{formattedtime}}</span>');var b='<div class="wms-replymsgwrapper">'+v+'<div class="wms-replymsgheader">'+f+g+"</div><div>"+d+C+"</div></div>"+m+"</div>";return $WC.template.replace(b,{replymsgtime:o.msgtime,sendername:c,senderzuid:o.sender,dateinwords:$WC.DateUtil.formatDateWithWords(o.msgtime),formattedtime:$WC.DateUtil.formatTime(o.msgtime),replyimgurl:r.constructeddownloadurl,locname:r.name,contactname:r.name,eventname:r.name,fname:r.fName,desc:r.desc,msguid:o.msguid})},function(e,t,s,i,n,a,o,r,l,d,c,m,u,p,h,g,f,C,v,b){var y,_,W,S="",w="",M=c?'data-msgackid="'+c+'"':"",I=m?'data-notack="true"':"";u=u?"data-msguid="+u:"";var T,A,E,U,x,N,k,O="",R="",H=!!i.star,$=i.startype?i.startype:"0",D='<span data-type="'+n+'" data-msgsel="false" class="wms_fwdcheckbox wms-valign-mid-block wms_checkbox_hidden"></span>';if(n===Message.types.LOADMORE)return'<div style="display:none" data-loadmore="true"></div>';if(n===Message.types.LOADMOREBUTTON)return $WC.Util.constructTranscriptLoadButton();if(n===Message.types.TRANSERR)return T=i.prevtime,A=i.nexttime,E=i.mentionmsgid,U=i.latestchunk,x=T?' data-prevtime="'+T+'"':" ",x+=A?' data-nexttime="'+A+'"':" ",x+=E?' data-mentionmsgid="'+E+'"':" ",'<div class="wms-msgfrag wms-transerror" data-transerror="true"'+(x+=U?' data-latestchunk="'+U+'"':" ")+">"+$WC.I18N("transcript.error")+' <span class="wms-transretry" data-retry="true">'+$WC.I18N("transcript.retry")+"</span></div>";if(l||v||b)W=_=y="";else{if(k=o,(y=(N=s)&&"-1"!==N&&(!k||k&&$WC.DateUtil.formatDate(k)!==$WC.DateUtil.formatDate(N))?$WC.template.replace("<div class='wms-msgdate' data-msgtime={{msgtime}}><span>{{date}}</span></div>",{date:$WC.DateUtil.formatDateWithWords(N),msgtime:N}):"")&&(a=""),i.meta&&i.meta.shareIntegrationResponse?(i.meta.isTempResponse=!0,R='<div class="wms-cmdvisiblediv"><span class="wms-cmdvisible"></span>'+$WC.I18N("chat.command.visibility")+"</div>"):(i.isTempResponse||i.meta&&i.meta.isTempResponse)&&(i.meta.isTempResponse=!0,R='<div class="wms-cmdvisiblediv"><span class="wms-cmdvisible"></span>'+$WC.I18N("chat.command.visibility")+"</div><div data-chid="+i.chid+" data-msgid="+i.time+' data-purpose="shareresponseclick_onmsg" class="wms_cmdvisible_share">'+$WC.I18N("chat.command.share")+"</div>"),_=function(e,t,s,i,n,a){var o="wms-msgsender",r="",l="",d="",c=null,m='<div class="{{classname}}" data-zcmsgsource={{msgsource}} data-senderzuid="{{senderzuid}}"><img class="wms_cw_userphoto" data-zcprofileid="{{senderzuid}}" src="{{userimage}}"><span class="wms_profileinfo_text" data-zcmsgsource={{msgsource}} data-zcprofileid="{{senderzuid}}">{{sendername}}</span></div>';if(a&&e&&!n||(m='<div class="{{classname}}" data-zcmsgsource={{msgsource}} data-senderzuid="{{senderzuid}}"><img class="wms_cw_userphoto" src="{{userimage}}"><span class="wms_profileinfo_text" data-zcmsgsource={{msgsource}}>{{sendername}}</span></div>'),i&&i.message_source&&i.message_source.type&&(d=new $WC.IntegrationsData(i.message_source)),i&&i.usermessagedetails&&i.usermessagedetails.custom_sender_name)r=i.usermessagedetails.custom_sender_name,l=i.usermessagedetails.custom_sender_imageurl?i.usermessagedetails.custom_sender_imageurl:"https://img.zohocdn.com/ichat/images/bar/ac31da36_customimg-default.png",$WC.Util.isLocalUser(e)&&(o+=" wms-msgsenderhl"),e=d&&d.getID()||e,i.usermessagedetails.custom_sender_imageid?l=_WMSCHATURL+"v1/images/"+i.usermessagedetails.custom_sender_imageid:d&&(i.usermessagedetails.custom_sender_id||i.message_source.photo_id)&&(l=d.getImageURL());else if(d&&i.isTempResponse)r=i.message_source.name,l=d.getImageURL(),e=d.getID(),c=d.getModule(),$WC.Util.isLocalUser(e)&&(o+=" wms-msgsenderhl");else{if(!e||s===e)return"";$WC.Util.isLocalUser(e)?(r=$WC.I18N("chat.you"),o+=" wms-msgsenderhl"):r=$WC.Util.getContactName(e,t)}return $WC.template.replace(m,{sendername:$WC.Util.unescapeHTML(r),senderzuid:e,classname:o,msgsource:c,userimage:l||WmsContacts.getUserPhoto(e)})}(e,t,a,i.meta,g,f),n!==Message.types.INFOMSG){n===Message.types.DELETEDMSG&&(s=i.origin_time),C=!(!WebMessanger.isReadReceiptEnabled()||!C);var L=WindowHandler.getWinObjById(i.chid),P=!(!L||"1"!==L.ctype||L.isZohoGroupChat()),B=!1;i.detected_language&&i.detected_language!=WebMessanger.language&&e!=WebMessanger.zuid&&"1"==WmsSettings.show_translate&&n==Message.types.TEXTMSG&&(B=!0,"2"==WmsSettings.message_translation_source&&-1==WmsSettings.adminsettings.features.zia_languages.indexOf(i.detected_language)&&(B=!1));var j={translatemsg:B,msg:i},F={star:i.star,startype:i.startype?i.startype:0,senderzuid:e};n!=Message.types.DELETEDMSG&&(n!=Message.types.FILEATT&&n!=Message.types.AUDIOATT&&n!=Message.types.VIDEOATT&&n!=Message.types.IMGATT||!Message.isFileViewDisabled(i))||(F.deleted=!0),S=Message.constructTimeFragment(s,null,C,P,$WC.Channels.isDefaultChannel(i.chid),j,F),i.mtype===""+CT_EDITED_MSG&&(S=Message.constructTimeFragment(i.origin_time,!0,C,P,$WC.Channels.isDefaultChannel(i.chid),j,F))}W="wms-msgfrag",!(i.isfirstthreadmessage&&$WC.Util.isLocalUser(i.parentmessagesenderid)||!i.isfirstthreadmessage&&$WC.Util.isLocalUser(e))||i.meta&&i.meta.isTempResponse||Message.isMsgFromBot(i)&&!(i.meta&&i.meta.message_source&&i.meta.message_source.forwarded)||(W+=" wms-msgsenderhl")}var z,G,q,Y,V,Z,K,X,J,Q,ee,te,se,ie="";if(n===Message.types.THREADLINKMSG)i.isfirstthreadmessage&&(S=_=""),ie+='<div class="wms-msg">'+function(e){var t=e.thread_information,s=(e.thread_state_info,e.thread_state_info?e.thread_state_info.thread_state:"open"),i=1<t.message_count?$WC.I18N("message.threads.count",[t.message_count]):$WC.I18N("message.thread.count",[t.message_count]),n=$WC.RecentChats.get(t.chat_id)&&$WC.RecentChats.get(t.chat_id).UNREADMSGS&&t.is_follower?'<span id="wms_unreadthreadcount" class="wms_menu_item_count wms_threadunread_count">'+$WC.RecentChats.get(t.chat_id).UNREADMSGS+"</span>":"";WmsMainUI.getUnreadCount(e.chid,null,t.chat_id)&&t.is_follower&&(n='<span id="wms_unreadthreadcount" class="wms_menu_item_count wms_threadunread_count">'+WmsMainUI.getUnreadCount(e.chid,null,t.chat_id)+"</span>");var a='<div class="wms_threadmsg" title="'+$WC.I18N("message.thread.view")+'"data-thread_chid="'+t.chat_id+'" data-thread_title="'+$WC.Util.safeHTML(t.title)+'" data-thread_followercnt="'+t.follower_count+'" data-thread_creator="'+e.sender+'" data-thread_parentid="'+e.chid+'" data-thread_msgid="'+t.thread_message_id+'" data-thread_follower="'+t.is_follower+'" data-thread_msgcount="'+t.message_count+'" data-thread_state="'+s+'"><div class="wms_threadseparator"></div><div id="wms_threadlinkwrapper" class="wms_threadlinkwrapper"><div id="wms_threadlink" class="wms_threadlink">'+i+"</div>"+n+"</div></div>";delete e.thread_information,Ce(e);var o=Message.getMessageType(e),r=e.sender+"_"+e.msgid,l=e.msg;return(e.meta&&1<Object.keys(e.meta).length&&Message.getMessageType(e)!=Message.types.FILEATT&&Message.getMessageType(e)!=Message.types.IMGATT&&Message.getMessageType(e)!=Message.types.VIDEOATT&&Message.getMessageType(e)!=Message.types.AUDIOATT||Message.getMessageType(e)===Message.types.EDITEDMSG||Message.getMessageType(e)===Message.types.REPLYMSG)&&(l=e),'<div class="wms_threadmsgwrapper">'+Message.constructMessageFragment(e.sender,e.dname,e.time,l,o,e.sender,e.time,r,null,null,null,null,e.msguid,null,null,null,null,null,null,!0)+a+"</div>"}(i)+"</div>";else if(n===Message.types.IMGATT)i.time=s,i.sender=e,ie+=ce(i,t,u),i.meta&&i.meta.linkdetails&&(s=W=y=_="");else if(n===Message.types.FILEATT)i.dname=t,i.time=s,i.sender=e,i.msgid=r,ie+='<div class="wms-msg">'+me(i)+"</div>";else if(n===Message.types.INFOMSG)i.opruser=i.opruser||{zuid:e,nname:t},"object"!=typeof i.msg||i.mode||(i=i.msg),ie+=(ee=i,te=s,se=f,$WC.MsgUtil.getInfoMsgString(ee,se)?$WC.template.replace('<div class="wms-msginfo" data-infotype="{{infotype}}" title="{{time}}">{{msg}}</div>',{msg:Smiley.replace($WC.Markdown.apply($WC.MsgUtil.getInfoMsgString(ee,se))),time:$WC.DateUtil.formatDTTime(te),infotype:ee.type?ee.type:"msginfo",zuid:ee.opruser?ee.opruser.zuid:""},"InSecureHTML"):""),_="",W="wms-msginfofrag",O=i.mode||"MESSAGE EDITED"===(i.msg&&i.msg.mode)?'data-editinfo="true"':"";else if(n===Message.types.AUDIOATT)ie+='<div class="wms-msg wms-audioattmsg">'+ue(i)+"</div>",i.meta&&i.meta.linkdetails&&(W=y=_="");else if(n===Message.types.VIDEOATT)i.sender=e,ie+='<div class="wms-msg">'+pe(i)+"</div>",i.meta&&i.meta.linkdetails&&(W=y=_="");else if(n===Message.types.LOCATT)ie+="<div class='wms-msg'>"+(J=i,Q="<div class='wms-filemsgcontainer wms-locmsgimg'><div class='wms-location-details'><a href='"+window.location.protocol+"//maps.google.com/?q={{latitude}},{{longitude}}' target='_blank'>{{locname}}</a><div id='wms-locationinfo' class='wms-locationinfo'><span title='{{loc}}' class='wms-truncate-ellipsis wms-filetype'>{{loc}}</span></div></div></div>",$WC.template.replace(Q,{latitude:J.lat,longitude:J.lng,locname:J.name,loc:J.loc||""}))+"</div>";else if(n===Message.types.CONTACTATT)ie+="<div class='wms-msg'>"+(X="",(K=i).extras&&(X=K.extras[0].value),$WC.template.replace("<div class='wms-filemsgcontainer wms-contactmsgimg'><span>{{contactname}}<div id='wms-contactinfo'><span class='wms-truncate-ellipsis wms-filetype'>{{contactno}}</span></div></div>",{contactname:K.name,contactno:X}))+"</div>";else if(n===Message.types.EVENTATT)ie+="<div class='wms-msg'>"+(z=i,G=$WC.DateUtil.formatDTTime(z.startdate)+" "+$WC.I18N("chat.event.to")+" "+$WC.DateUtil.formatDTTime(z.enddate),q=G.split(" "),Y=q[1],V=q[0]+" "+$WC.I18N("chat.event.th"),Z=q[3]+q[4],$WC.template.replace("<div class='wms-evntmsgcontainer'><div class='wms-evntmsgdiv'><div class='wms-evntmsgmon'>{{eventmonth}}</div><div class='wms-evntmsgdate'>{{eventdate}}<div class='wms-evntmsgtime'>&#64;{{eventstarttime}}</div></div></div><div class='wms-evntmsginfo'><span class='wms-evntmsgname'>{{eventname}}</span><div class='wms-evntmsgduration'>{{eventtime}}</div></div></div>",{eventmonth:Y,eventdate:V,eventstarttime:Z,eventname:z.name,eventtime:G}))+"</div>";else if(n===Message.types.CUSTOMMSG){ie+='<div class="wms-msg '+(Message.isTempMsg(i)?"wms_tempcustmmsg":"wms_custmmsg")+'">'+he(i)+R+"</div>"}else if(n===Message.types.BOTMSG)if(Message.isCustomMsg(i)){var ne=$WC.CMsgUtil.convertMsgObj(i);$WC.CustomMsg.storeMsgObj(ne),ie+="<div class='wms-msg'>"+he(i)+R+"</div>"}else i.msg=$WC.Markdown.apply($WC.Util.safeHTML($WC.Util.unescapeHTML(i.msg))),$WC.Matcher.checkWithFlag("linkRegExp",i.msg,"gi")&&i.meta&&i.meta.linkdetails&&!l?ie+=ve(i,n):ie+="<div class='wms-msg wms-txtmsg'>"+re(i.msg,r)+R+"</div>";else if(n===Message.types.VIDEOLINK||n===Message.types.AUDIOLINK||n===Message.types.IMGLINK)ie+=ve(i,n);else if(n===Message.types.REPLYMSG)i.sentfromcomposer||(i.msg="string"==typeof i.msg?$WC.Util.safeHTML($WC.Util.unescapeHTML(i.msg)):i.msg,i.meta.opr_replydetails.msg="string"==typeof i.meta.opr_replydetails.msg?$WC.Markdown.apply($WC.Util.safeHTML($WC.Util.unescapeHTML(i.meta.opr_replydetails.msg))):i.meta.opr_replydetails.msg),ie+='<div class="wms-msg">'+de(i)+"</div>";else if(n===Message.types.TEMPMSG){if(i.meta){var ae=$WC.CMsgUtil.convertMsgObj(i);$WC.CustomMsg.storeMsgObj(ae)}ie+='<div class="wms-msg">'+re(i.msg,r)+R+"</div>"}else if(n===Message.types.HRMSG)W+=" wms-hrmsg",ie=$WC.Markdown.apply(i.msg||i),S="";else if(n===Message.types.DELETEDMSG){if(i.isNextMsgDeleted)return Message.incrementDeletedMsgCount(i.time),$WC.template.replace("{{datefragment}}{{senderfragment}}",{datefragment:y,senderfragment:_},"InSecureHTML");ie+=Message.getDeletedMsgInfo(i.time)}else if(n===Message.types.EDITEDMSG)ie+=function(e,t){var s={};if("string"==typeof e)s.msg=e;else for(var i in e)s[i]=e[i];s.editedtime=e.time,s.time=e.origin_time,s.mtype=e.origin_mtype;var n=Message.getMessageType(s);return"object"==typeof s.msg&&n!==Message.types.FORWARDEDMSG&&n!==Message.types.THREADMSG&&(Ce(s),s.msg.sender=s.sender,s.msg.time=s.time,s.msg.meta=s.meta,s=s.msg),n===Message.types.TEXTMSG||n===Message.types.VIDEOLINK||n===Message.types.AUDIOLINK||n===Message.types.IMGLINK?$WC.Matcher.checkWithFlag("linkRegExp",e.msg,"gi")&&e.meta&&e.meta.linkdetails?ve(e,n):(t||(s.msg=$WC.Markdown.apply($WC.Util.safeHTML($WC.Util.unescapeHTML(s.msg)))),'<div class="wms-msg wms-txtmsg">'+re(s.meta&&s.meta.mentions?$WC.Util.formatMentions(s):s.msg)+"</div>"):n===Message.types.HRMSG?'<div class="wms-hrmsg">'+s.msg+"</div>":n===Message.types.REPLYMSG?'<div class="wms-msg">'+de(s)+"</div>":n===Message.types.IMGATT?ce(s):n===Message.types.FILEATT?'<div data-type="'+Message.types.FILEATT+'" class="wms-msg">'+me(s)+"</div>":n===Message.types.AUDIOATT?'<div data-type="'+Message.types.AUDIOATT+'" class="wms-msg wms-audioattmsg">'+ue(s)+"</div>":n===Message.types.VIDEOATT?'<div data-type="'+Message.types.VIDEOATT+'" class="wms-msg">'+pe(s)+"</div>":n===Message.types.FORWARDEDMSG?'<div data-type="'+Message.types.FORWARDEDMSG+'" class="wms-msg">'+fe(s)+"</div>":n===Message.types.THREADMSG?'<div data-type="'+Message.types.THREADMSG+'" class="wms-msg">'+ge(s)+"</div>":void 0}(i,l);else if(n===Message.types.FORWARDEDMSG)ie+='<div class="wms-msg">'+fe(i,l,!0)+"</div>";else if(n===Message.types.THREADMSG)$WC.Util.isLocalUser(e)&&(W+=" wms-msgsenderhl"),ie+='<div class="wms-msg">'+ge(i)+"</div>";else if(l||i.sentfromcomposer||("object"==typeof i?(i.msg=$WC.Util.safeHTML($WC.Util.unescapeHTML(i.msg)),1==i.rawstarmsg&&(i.msg=$WC.Util.decodeHTMLEntities(i.msg))):i=$WC.Util.safeHTML($WC.Util.unescapeHTML(i))),$WC.Matcher.checkWithFlag("linkRegExp",i.msg,"gi")&&i.meta&&i.meta.linkdetails&&!l)ie+=ve(i);else{var oe=i.ignoremarkdown;if(i.meta){if(!i.meta.mentions){ae=$WC.CMsgUtil.convertMsgObj(i);$WC.CustomMsg.storeMsgObj(ae),i=i.msg}}else i.msg&&(i=i.msg);ie+="<div class='wms-msg wms-txtmsg'>",ie+=re(i,r,oe)+R+"</div>"}return p&&(w=le(p,WMSUI.checkAndSortReactions(p))),(l||b)&&(D=""),Message.isCustomEmoji(ie)&&!l&&(ie=Smiley.replaceCustomEmoji(ie,Message.metaInfo[i.msguid])),$WC.template.replace('{{datefragment}}{{senderfragment}}<div class="{{classname}}" data-sender={{sender}} data-msgid={{msgid}} {{editmsginfo}} {{msgackattribute}} {{msguid}} data-type="{{msgtype}}" data-sendername="{{sendername}}" data-msgtime={{msgtime}} data-starselected="{{starred}}" data-startype="{{startype}}" {{notackattr}}>{{messagefragment}}{{reactionsfragment}}{{forwardsel_fragment}}</div>{{timefragment}}',{classname:W,datefragment:y,msgtime:s,senderfragment:_,messagefragment:ie,timefragment:S,msgid:r,msgackattribute:M,msgtype:n,sendername:$WC.Util.safeHTML($WC.Util.unescapeHTML(t)),notackattr:I,msguid:u,editmsginfo:O,reactionsfragment:w,forwardsel_fragment:D,sender:e,starred:H,startype:$},"InSecureHTML")}}(),Message.constructAndInsertChatContent=function(e,t,s,i,n,a){var o=t.querySelectorAll("[data-notack]:not([data-msgfailure])");for(var r=0;r<o.length;r++){var l=o[r],d=l.getAttribute("data-msgtime"),c=e.find(function(e){if(e.msgid==d)return!0});c&&(l.setAttribute("data-msgtime",c.time),l.setAttribute("data-msgid",c.sender+"_"+c.time),l.removeAttribute("data-notack"),e.splice(e.indexOf(c),1))}var m=t.querySelector('[data-msgtime="'+n+'"][data-msgid]'),u=t.querySelector('[data-msgtime="'+a+'"][data-msgid]');if(m&&u){e.length&&e[e.length-1].time==a&&(u=u.nextSibling);for(var p=[],h=m.nextSibling;h!=u;)h.getAttribute("data-msgid")&&!h.getAttribute("data-msgfailure")&&"INFOMSG"!=h.getAttribute("data-type")&&p.push(h),h=h.nextSibling;for(var g in!function(e){for(var t=0;t<e.length;t++)e[t].previousSibling.getAttribute("data-senderzuid")&&$WC.Util.removeElement(e[t].previousSibling),"wms-msgtime"==e[t].nextSibling.className&&$WC.Util.removeElement(e[t].nextSibling),$WC.Util.removeElement(e[t])}(p),e){t.querySelector('[data-msgid="'+e[g].sender+"_"+e[g].time+'"]')&&e.splice(g,1)}e[0]&&"more"==e[0].mode&&e.shift();var f=n,C=m.getAttribute("data-msgid"),v="INFOMSG"==m.getAttribute("data-type")?"":C.substring(0,C.indexOf("_"))}if(!n&&!a&&(m=t.querySelector("[data-msguid]"))){for(var b=0,y=e.length-1,_=y;0<=_;_--){(g=e[_]).msguid===m.getAttribute("data-msguid")&&(b=_)}e.splice(b,y)}var W=Message.constructChatContent(e,t,s,v,f,!0),S=Message.getScrollHeight(t),w=Message.getScrollTop(t),M=e[e.length-1],I=t.querySelector(".wms-msgdate");if(I){var T=I.getAttribute("data-msgtime"),A=M&&M.time;$WC.DateUtil.isSameDay(T,A)&&$WC.Util.removeElement(I)}var E=t.querySelector(".wms-msgsender");if(E){var U=E.getAttribute("data-senderzuid"),x=M&&"INFOMSG"===Message.getMessageType(M)?"":M&&M.sender;$WC.DateUtil.isSameDay(T,A)&&x===U&&$WC.Util.removeElement(E)}if(i.insertAdjacentHTML("afterend",W),(i===i.parentNode.firstChild||!n&&a)&&Message.restoreScrollPosition(t,S,w),"bottom"!==i.getAttribute("data-scrollbehaviour")||t.closest("[data-scrolldown]")){if("top"===i.getAttribute("data-scrollbehaviour")){var N=Message.getScrollableParent(t);$WC.Util.scrollTo(N.firstChild,{behavior:"smooth"},N)}}else Message.scrollDisplay(t)},Message.constructAndAppendChatContent=function(e,t,s,i,n){var a=Message.constructChatContent(e,t,s,i,n);t.insertAdjacentHTML("beforeend",a),0===t.parentElement.scrollTop&&(Message.toggleLiveZomoji(t.parentElement),WMSUI.loadImages(t),Message.checkAndLoadAudioPlayer(t.parentElement),Message.loadUrlThumbnail(t.parentElement),WMSUI.checkAndLoadCustomEmojis(t.parentElement))},Message.getMessageType=function(e){if(e.messagetype)return e.messagetype;if("more"===e.mode)return Message.types.LOADMORE;if("morebutton"===e.mode)return Message.types.LOADMOREBUTTON;if("object"==typeof e.thread_information&&e.thread_information.message_count)return Message.types.THREADLINKMSG;if(Message.isThreadMsg(e))return Message.types.THREADMSG;if(Message.isReplyMsg(e))return Message.types.REPLYMSG;if(e.mtype===""+CT_EDITED_MSG)return Message.types.EDITEDMSG;if(Message.isForwardMsg(e))return Message.types.FORWARDEDMSG;if("object"!=typeof e.msg&&!e.mod)return Message.isCustomMsg(e)?Message.types.CUSTOMMSG:Message.isBotMsg(e)?Message.types.BOTMSG:void 0!==e.meta&&void 0!==e.meta.linkdetails?"text/html"===e.meta.linkdetails.mimetype?"video"===e.meta.linkdetails.linktype&&(e.meta.linkdetails.iframe_url||e.meta.linkdetails.html)?Message.types.VIDEOLINK:"audio"===e.meta.linkdetails.linktype&&(e.meta.linkdetails.iframe_url||e.meta.linkdetails.html)?Message.types.AUDIOLINK:"image"===e.meta.linkdetails.linktype?Message.types.IMGLINK:Message.types.TEXTMSG:e.meta.linkdetails.mimetype&&-1!==e.meta.linkdetails.mimetype.indexOf("image/")?Message.types.IMGLINK:Message.types.TEXTMSG:Message.isTempMsg(e)?Message.types.TEMPMSG:"<hr>"===$WC.Markdown.apply(e.msg)?Message.types.HRMSG:e.mtype===""+CT_DELETED_MSG?Message.types.DELETEDMSG:Message.types.TEXTMSG;if("16"===e.mtype||"65"===e.mtype)return Message.types.INFOMSG;if("location"===e.mod||"att"===e.mode&&e.msg.__module&&"location"===e.msg.__module)return Message.types.LOCATT;if("contact"===e.mod||"att"===e.mode&&e.msg.__module&&"contact"===e.msg.__module)return Message.types.CONTACTATT;if("event"===e.mod||"att"===e.mode&&e.msg.__module&&"event"===e.msg.__module)return Message.types.EVENTATT;if("att"===e.mod||"att"===e.mode){var t,s,i,n="";return(s=e.addinfo&&e.addinfo.fName?e.addinfo.fName:e.msg&&e.msg.fName)&&(n=(i=s.split("."))[i.length-1]),t=e.addinfo&&e.addinfo.contenttype?e.addinfo.contenttype:e.msg&&e.msg.content,e.msg&&e.msg.content&&-1!==e.msg.content.indexOf("image")&&e.msg.dim&&e.msg.dim.height&&e.msg.dim.width||t&&-1!==t.indexOf("image")?Message.types.IMGATT:t&&WmsMediaPlayer.isSupportedVideoType(t,n)?Message.types.VIDEOATT:t&&WmsMediaPlayer.isSupportedAudioType(t,n)?Message.types.AUDIOATT:Message.types.FILEATT}},function(){var a=1,o=[];Message.incrementDeletedMsgCount=function(e){1===a&&o.push(e),a++},Message.getDeletedMsgInfo=function(e){var t;o.push(e),o.sort();var s="",i="",n=1===a?$WC.I18N("chat.info.deletemsg"):$WC.I18N("chat.info.deletemsgs",[a]);return t=1===o.length||$WC.DateUtil.formatTime(o[0])===$WC.DateUtil.formatTime(o[1])?(s=$WC.DateUtil.formatTime(o[0])+", "+$WC.DateUtil.formatDateWithWords(o[0]),$WC.I18N("chat.deletemsg.title",[s])):(s=$WC.DateUtil.formatDateWithWords(o[0])===$WC.DateUtil.formatDateWithWords(o[1])?$WC.DateUtil.formatTime(o[0]):$WC.DateUtil.formatTime(o[0])+", "+$WC.DateUtil.formatDateWithWords(o[0]),i=$WC.DateUtil.formatTime(o[1])+", "+$WC.DateUtil.formatDateWithWords(o[1]),$WC.I18N("chat.deletemsgs.title",[s,i])),a=1,o=[],"<div class='wms-msg wms-txtmsg wms-delmsg' title=\""+t+'">'+n+"</div>"}}(),Message.getDownloadUrl=$WC.Message.getDownloadUrl,Message.getThumbnailImageUrl=function(e){return WMSUI.isLoadedImg(e)?"":WebMessanger.isUDSDownloadEnabled()?"&x-cli-msg="+encodeURIComponent("{thumbnail:true}"):"/thumbnail"},Message.constructChatContent=function(e,t,s,i,n,a){var o,r="";if(!i&&t){var l=t.querySelectorAll("[data-senderzuid]"),d=l[l.length-1];i=d&&d.getAttribute("data-senderzuid")}if(!n&&t){var c=t.querySelectorAll("[data-msgtime]"),m=c[c.length-1];n=m&&m.getAttribute("data-msgtime")}for(var u=0;u<e.length;u++){var p=Message.getMessageType(e[u]);e[u].meta&&(!e[u].msg&&e[u].output&&(e[u].msg={msg:e[u].output.msg}),e[u].msg.meta=Object.assign({},e[u].meta)),e[u].thread_information&&(e[u].msg.thread_information=Object.assign({},e[u].thread_information),e[u].msg.chid=s);var h="object"==typeof e[u].msg?e[u].msg:e[u],g=!(1!==e[u].revision&&(!e[u].meta||1!==e[u].meta.revision&&2!==e[u].meta.revision));if("63"!=e[u].mtype||(Message.deletedMessages.insert(s,e[u].origin_time||e[u].time),0!=e[u].info_visiblity)){var f=null,C=WindowHandler.getWinObjById(s),v=!1;C&&(C.ctype,e[u].reactions&&C.updateReactionData(e[u].msguid,e[u].reactions),v=C.file_forward_restricted),p===Message.types.IMGATT||p===Message.types.FILEATT||p===Message.types.AUDIOATT||p===Message.types.VIDEOATT?(e[u].salesiqchat?h.downloadurl=WmsUIImpl.customContactsConfig().getAttachmentUrl(h.url):h.constructeddownloadurl=Message.getDownloadUrl(h),p===Message.types.IMGATT&&h.thumb&&!WebMessanger.isGuestUser()&&(h.constructeddownloadurl+=Message.getThumbnailImageUrl(h.constructeddownloadurl)),h.constructeddownloadurl=e[u].salesiqchat?h.downloadurl:h.constructeddownloadurl,h.isFileForwardSupported=!e[u].salesiqchat&&!v,h.chid=s,e[u].star&&(h.star=e[u].star,h.startype=e[u].startype)):p===Message.types.INFOMSG&&(h.chid=s),e[u].sender||p!==Message.types.IMGATT&&p!==Message.types.FILEATT||e[u].msg&&e[u].msg.sender&&(e[u].sender=e[u].msg.sender),!e[u].time&&e[u].msgtime&&(e[u].time=e[u].msgtime),e[u+1]&&(f=e[u+1].time),e[u+1]&&e[u+1].mtype===""+CT_DELETED_MSG&&e[u].sender===e[u+1].sender&&(e[u].isNextMsgDeleted=!0,f=e[u+1].origin_time),o=e[u].origin_time?e[u].sender+"_"+e[u].origin_time:e[u].sender+"_"+e[u].time;var b=e[u].msgackid,y=e[u].notack;Message.isHidingMsg(e[u])&&Message.setTimeToHideMsg(t,e[u],o),p!==Message.types.FORWARDEDMSG&&p!==Message.types.REPLYMSG&&p!==Message.types.BOTMSG&&p!==Message.types.CUSTOMMSG&&p!==Message.types.VIDEOLINK&&p!==Message.types.AUDIOLINK&&p!==Message.types.IMGLINK&&p!==Message.types.TEMPMSG&&p!==Message.types.DELETEDMSG&&p!==Message.types.EDITEDMSG&&p!==Message.types.THREADMSG&&p!==Message.types.THREADLINKMSG||(h=e[u]),e[u].chid=s;var _=e[u].origin_time||e[u].time||e[u].msg.time;Message.types.THREADMSG;r+=Message.constructMessageFragment(e[u].sender,e[u].dname,_,h,p,i,n,o,null,f,b,y,e[u].msguid,e[u].reactions,g,e[u].salesiqchat,WebMessanger.isProfileInfoAllowed(s),e[u].is_read),i=p!==Message.types.INFOMSG&&p!==Message.types.BOTMSG&&p!==Message.types.CUSTOMMSG?e[u].sender:"",n=p===Message.types.DELETEDMSG||p===Message.types.EDITEDMSG?e[u].origin_time:e[u].time,a&&e[u].sender&&!$WC.Users.getInfo(e[u].sender)&&e[u].dname&&(C&&"1"==C.ctype&&!1===C.isZohoGroupChat()&&C.title!==e[u].dname&&!$WC.Util.isLocalUser(e[u].sender)&&(WindowHandler.updateChatTitle(s,e[u].dname),$WC.RecentChats.updateTitle(s,e[u].dname)),$WC.Users.storeInfo(e[u].sender,{dname:e[u].dname}))}}return r},Message.setTimeToHideMsg=function(e,t,s){var i=e.getAttribute("data-chid"),n=WindowHandler.getWinObjById(i);clearTimeout(n.msghidetimer);var a=parseInt(t.meta.config.h);n.msghidetimer=setTimeout(function(){Message.hideMsg(e,s)},a)},Message.hideMsg=function(e,t){var s=e.querySelector('[data-msgid="'+t+'"]').parentNode;s.previousSibling.previousSibling.querySelector(".wms-msgdate")&&$WC.Util.removeElement(s.previousSibling.previousSibling),$WC.Util.removeElement(s.previousSibling),$WC.Util.removeElement(s)},Message.deletedMessages={list_index:[],list:{},insert:function(e,t){30==this.list_index.length&&this.remove(this.list_index[0]),this.list[e]?this.list[e].push(t):this.list[e]=[t],-1!=this.list_index.indexOf(e)&&this.list_index.splice(this.list_index.indexOf(e),1),this.list_index.push(e)},get:function(e){if(this.list[e])return this.list[e]},isAvailable:function(e,t){return!(!this.list[e]||-1===this.list[e].indexOf(t))},remove:function(e){this.list[e]&&(delete this.list[e],this.list_index.splice($WC.Util.indexOf(this.list_index,e),1))},removeAll:function(){this.list={},this.list_index=[]}},Message.glowBubble=function(e,t,s,i){if(Message.deletedMessages.isAvailable(s,e))return WindowHandler.getWinObjById(s).showErrorMsg($WC.I18N("chat.info.deletemsg")),!0;var n=t.querySelector('.wms-msgfrag[data-msgtime="'+e+'"]');if(t.setAttribute("data-glowtime",e),n){if($WC.$CUtil.isScrolledIntoView(n,t))$WC.Util.addClass(n.firstChild,"wms-bubbleglow"),t.removeAttribute("data-glowtime");else{var a=i&&i.block&&350<n.getBoundingClientRect().height?i.block:"center";$WC.Util.scrollTo(n,{behavior:"smooth",block:a},t)}return!0}return!1},Message.addEventListenersForTranscript=function(e,o){var t=Message.getScrollableParent(e);Gator(e).on("mouseover","[data-type]",$WC.Util.debounce(function(){var e=this.closest("[data-chid]"),t=e&&e.getAttribute("data-chid"),s=WindowHandler.getWinObjById(t);if((!s||"4"!==s.ctype||!s.salesiqchat)&&s&&(null===s.msgoprnode||null===s.msgoprnode.offsetParent)&&null===this.querySelector("[data-options]")&&"INFOMSG"!==this.getAttribute("data-type")&&"DELETEDMSG"!==this.getAttribute("data-type")&&"HRMSG"!==this.getAttribute("data-type")&&this.getAttribute("data-msguid")){var i=this.firstChild;if("THREADLINKMSG"===this.closest('[class*="wms-msgfrag"]').getAttribute("data-type")&&(i=this.closest('[class*="wms-msgfrag"]').firstChild),("REPLYMSG"===this.getAttribute("data-type")||"FORWARDEDMSG"===this.getAttribute("data-type")||"THREADMSG"===this.getAttribute("data-type"))&&"THREADLINKMSG"!==this.closest('[class*="wms-msgfrag"]').getAttribute("data-type")){var n=this.querySelector("[data-type]");i="HRMSG"===n.getAttribute("data-type")?n:n.firstChild}i.insertAdjacentHTML("afterbegin",'<div class="wms-valign-mid-block" data-options="hide"></div>')}},null,50)),Gator(e).on("mouseout","[data-type]",$WC.Util.debounce(function(e){var t=e.relatedTarget;if(t&&!t.closest("[data-type]")&&null===this.querySelector("[data-msgoperations]")&&!WebMessanger.show_message_actions_as_popup){var s=this.querySelector("[data-options]");$WC.Util.removeElement(s)}},null,100)),$WC.Util.addEvent(e,"click",function(e){var t=$WC.Util.getEventTarget(e),s=e.target.closest("#ctrlcomp")||e.target.closest("#wmschshtransmsg")||event.target.closest("#wmstranscriptcomponent"),i=Message.getScrollableParent(s),n=s.getAttribute("data-chid"),a=t.getAttribute("data-thread_chid")||t.closest("[data-thread_chid]")&&t.closest("[data-thread_chid]").getAttribute("data-thread_chid");if(!t.querySelector("[data-attachmentdisabled]")&&!t.getAttribute("data-attachmentdisabled"))if(a&&!WMSUI.handleChatExist(a))WmsMainUI.scheduleAutoFocus(a),t=t.closest("[data-thread_chid]")?t.closest("[data-thread_chid]"):t,WebMessanger.openThreadWindowFromCache(t,n);else if("true"===t.getAttribute("data-retry")||t.parentNode&&"true"===t.parentNode.getAttribute("data-loadmorebutton")){var o=t.parentNode,r=t;if(r.getAttribute("data-next-msgtime")){var l=$WC.Util.getAdjacentNode(o,!1,"data-msgid").getAttribute("data-msgtime")||"";o.setAttribute("data-nexttime",l)}else if(r.getAttribute("data-prev-msgtime")){var d=$WC.Util.getAdjacentNode(o,!0,"data-msgid").getAttribute("data-msgtime")||"";o.setAttribute("data-prevtime",d)}o.setAttribute("data-same-height","true"),Message.loadSpecificTranscript(n,s,o)}else if("true"===t.getAttribute("data-previewable"))"true"===t.getAttribute("data-filethumbnail")?t=t.parentNode.querySelector("[data-attachment]"):"true"===t.getAttribute("data-filedesc")&&(t=t.querySelector("[data-attachment]")),"IMG"===t.tagName||"true"===t.getAttribute("data-unfurl")||"true"===t.getAttribute("data-attachment")?WMSUI.imgPreview.init(s,t):WMSUI.imgPreview.init(s,t.firstChild);else if("true"===t.getAttribute("data-custommsg")){for(var c=t.parentNode.getAttribute("data-msgid"),m=t.querySelectorAll("br"),u=0;u<m.length;u++)m[u].parentNode.replaceChild(document.createTextNode("\n"),m[u]);Message.formatCustomMsg($WC.Util.getInnerText(t),c)}else if("true"===t.parentNode.getAttribute("data-playable")){var p=t.parentNode.getAttribute("iframe");t.parentNode.innerHTML=p}else if("true"===t.getAttribute("data-filefrwrd"))"wms-videoplayer"===t.parentNode.parentNode.getAttribute("id")&&(t=t.parentNode.parentNode),WmsFileForwardUI.handlePreview(t);else if(t.closest("[data-media]")&&"true"===t.closest("[data-media]").getAttribute("data-media")){var h=t.closest("[data-media]"),g="";if(h.parentNode.parentNode.getAttribute("data-sendername")?g=h.parentNode.parentNode.getAttribute("data-sendername"):h.parentNode.parentNode.parentNode.getAttribute("data-sendername")&&(g=h.parentNode.parentNode.parentNode.getAttribute("data-sendername")),-1!==h.getAttribute("data-fcontent").indexOf("video")||-1!==h.getAttribute("data-fcontent").indexOf("application/x-matroska")){var f=h.getAttribute("data-fsrc"),C=h.closest("[data-msguid]").getAttribute("data-msguid");if("attdownload"==t.getAttribute("data-documentclick"))return $WC.Util.triggerDownloadInDesktopApp(f),e.stopPropagation(),void e.preventDefault();-1!==f.indexOf("&x-cli-msg=%7Bthumbnail%3Atrue%7D")?f=f.replace("&x-cli-msg=%7Bthumbnail%3Atrue%7D",""):-1!==f.indexOf("/thumbnail")&&(f=f.replace("/thumbnail",""));var v=!!WebMessanger.isGuestUser();if(h.getAttribute("data-mountaudioplayer")||h.querySelector('[data-playertype="video"]'))return;$WC.VideoPlayerFactory.create(n,s.parentElement,h,f,h.getAttribute("data-fcontent"),h.getAttribute("data-fname"),g,h.getAttribute("data-fposter"),$WC.Config.get("zindex"),function(){WmsFileForwardUI.handlePreview(h)},e,C,{hideforwardicon:"false"===h.getAttribute("data-filefrwrd"),isguestuser:v})}}else if("true"===t.getAttribute("data-msgfailure")){(G=WindowHandler.getWinObjById(n)).clickedfailurenode=t,G.createChatwindowOverlay()}else if(t.getAttribute("data-infocallbtn")){var b=t.getAttribute("data-infocallbtn"),y=t.getAttribute("data-calleezuid");"triggerAudioCall"===b?WMSUI.makeMediaCall(WMSUI.avCall.CALL_TYPE_VOICE,y):"triggerVideoCall"===b?WMSUI.makeMediaCall(WMSUI.avCall.CALL_TYPE_VIDEO,y):WMSUI.makeMediaCall(WMSUI.avCall.CALL_TYPE_SCREENSHARE,y)}else if("shareresponseclick_onmsg"===t.getAttribute("data-purpose")){var _={msgid:t.getAttribute("data-msgid")},W={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.Util.getCSRF(),"Content-Type":"application/json"};$WC.Ajax.postRequestToChat("v1/chats/"+n+"/shareintegrationresponse",_,null,null,null,null,W)}else if(t.closest("[data-replymsgtime]")){var S=t.closest("[data-replymsgtime]"),w=S.getAttribute("data-replymsgtime"),M=S.getAttribute("data-privatereplychid");if(M)Message.showMessageFragmentInView(M,S.getAttribute("data-replymsguid"));else if((G=WindowHandler.getWinObjById(n))&&(G.last_clicked_replymsg_time=S.closest("[data-msgtime]").getAttribute("data-msgtime")),!Message.glowBubble(w,i,n)&&!WebMessanger.isGuestUser()){var I=n+"|"+S.getAttribute("data-replysenderzuid")+"|"+w,T=Message.getMarkerElement(I,w,s);Message.loadSpecificTranscript(n,s,T)}}else if(t.getAttribute("data-options")){if(WebMessanger.parseReminderTime(t,n),Message.hideOptions(),"show"==t.getAttribute("data-options"))return;G=WindowHandler.getWinObjById(n);t.getBoundingClientRect(),G.ctrlcomp.getBoundingClientRect();var A={include_all:!0};if("undefined"!=typeof WmsUIImpl&&(A=WmsImplHandler.invokeSynchronously(WmsUIImpl.getMessageActions,WebMessanger.zuid,n,G.ctype)||A),$WC.Util.isEmptyObject(A))return;if(WebMessanger.isGuestUser()){var E={reply:"enable",copy:"enable",react:"enable",edit:"enable"};if(!A.include_all)for(var U in E)A[U]||delete E[U];A=E}A=Message.getAllowedActions(t,A,n),G.showMessageActionsUI(t.closest("[data-msgid]"),A,Message.handleMessageActions),WebMessanger.show_message_actions_as_popup&&t.setAttribute("data-options","show"),WMSUI.addIndocClickcallbackQue("msgoptions",t,function(){Message.hideOptions(t)}),e.stopPropagation()}else if("addmem"===t.getAttribute("data-operation")){var x=t.getAttribute("data-id").split(",");G=WindowHandler.getWinObjById(n),WMSUI.confirmAndAddMember(n,null,x),G.removePromptMsg()}else if("removepromptmsg"===t.getAttribute("data-operation"))(G=WindowHandler.getWinObjById(n)).removePromptMsg();else if(!t.getAttribute("data-edited")||"REPLYMSG"!==t.parentNode.previousSibling.getAttribute("data-type")&&"EDITEDMSG"!==t.parentNode.previousSibling.getAttribute("data-type")&&"THREADLINKMSG"!==t.parentNode.previousSibling.getAttribute("data-type"))if(!t.closest("[data-reaction]")||"wms_reaction_container"!==t.parentNode.getAttribute("class")&&"wms_reaction_frag"!==t.parentNode.getAttribute("class")){if(t.closest("[data-addreaction]")){C=t.closest("[data-msguid]").getAttribute("data-msguid");(G=WindowHandler.getWinObjById(n))&&G.showReactionsUI(C)}else if(t.getAttribute("data-msgsel")||WindowHandler.getWinObjById(n)&&null!==WindowHandler.getWinObjById(n).msgoprnode.offsetParent){G=WindowHandler.getWinObjById(n);if(null!==WindowHandler.getWinObjById(n).msgoprnode.offsetParent)t=(X=t.closest('[class^="wms-msgfrag"]'))&&X.querySelector("[data-msgsel]");if(t){var N=G.msgdisp.querySelectorAll('[data-msgsel="true"]').length;25==N&&"false"==t.getAttribute("data-msgsel")&&($WC.Util.addClass(G.msgselectcntnode.parentNode,"wms_fwdsel_alert"),$WC.Util.removeClass(G.msgoprnode,"wms-shake"),setTimeout(function(){$WC.Util.addClass(G.msgoprnode,"wms-shake")},300)),"true"===t.getAttribute("data-msgsel")?($WC.Util.removeClass(t,"wms_fwdcheckboxsel"),$WC.Util.addClass(t,"wms_fwdcheckbox"),t.setAttribute("data-msgsel","false"),--N):N<25&&($WC.Util.removeClass(t,"wms_fwdcheckbox"),$WC.Util.addClass(t,"wms_fwdcheckboxsel"),t.setAttribute("data-msgsel","true"),++N),N&&N<26?($WC.$CUtil.setInnerText(G.msgselectcntnode,$WC.I18N("msg.select.fwdcnt",[N])),G.msgoprnode.setAttribute("data-msgoperation",!0),N<25&&($WC.Util.removeClass(G.msgselectcntnode.parentNode,"wms_fwdsel_alert"),$WC.Util.removeClass(G.msgoprnode,"wms-shake"))):($WC.$CUtil.setInnerText(G.msgselectcntnode,$WC.I18N("msg.tap.select")),G.msgoprnode.setAttribute("data-msgoperation",!1))}}else if("6"==t.getAttribute("data-mentiontype")){var k="";if(G=WindowHandler.getWinObjById(n))k=G.title;else{var O=ZMSG_transContent.querySelector('[cid="'+n+'"]');k=$WC.Util.getInnerText(O.querySelector('[id="namedivCID"]'))}WMSUI.showParticipantsList(n,k)}else if(t.getAttribute("data-pinned-msgtime")){if(G=WindowHandler.getWinObjById(n)){var R=t.getAttribute("data-pinned-msgtime"),H=t.getAttribute("data-pinned-user");G.highlightPinnedMsg(R,H)}}else if(t.closest("[data-forwardmsgid]")&&null===t.getAttribute("data-zcprofileid")){var $=t.closest("[data-forwardmsgid]");C=$.getAttribute("data-forwardmsgid"),n=$.getAttribute("data-forwardmsgchid");"true"===$.getAttribute("data-messagelink")&&Message.showMessageFragmentInView(n,C)}else if(t.getAttribute("data-msg-read")){if("false"===t.getAttribute("data-read-receipt")||!WebMessanger.isReadReceiptEnabled())return;"REPLYMSG"===(X=t.parentNode.previousSibling).getAttribute("data-type")&&(X=X.querySelector("[data-msgid]"));var D={};D.msguid=X.getAttribute("data-msguid"),D.time=$WC.DateUtil.formatDTTime(X.getAttribute("data-msgtime")),D.msg=Message.getReferenceContent(n,X),WebMessanger.showReadReceipt(n,D)}else if("true"==t.getAttribute("data-dynamicactions")){(G=WindowHandler.getWinObjById(n)).populateDynamicActions(t)}else if("true"==t.getAttribute("data-urlactions")){X=t.closest("[data-msguid]");var L=$WC.Util.createElement("span",null,"wms_urlshare_loader");t.appendChild(L),t.className+=" wms_cmsg_loadingon",t.style.fontSize="0px";$WC.Functions.execute(t.getAttribute("data-fname"),n,X.getAttribute("data-msgtime"),t.getAttribute("btnindex"),!1,"click",function(){t.removeChild(L),t.className.replace(" wms_cmsg_loadingon",""),t.style.fontSize="12px"})}else if("true"==t.getAttribute("data-translatemsg")){t.getAttribute("data-detectedlanguage"),C=(X=t.parentElement.previousElementSibling).getAttribute("data-msguid");if(Message.translationmsgstore[C]&&Message.translationmsgstore[C].translation)Message.replaceTranslatedMessage(X,Message.translationmsgstore[C],!0),t.outerHTML=Message.getOriginalMsgBtnHtml();else{t.outerHTML='<div class="wms_translate_loading" data-translatingmsg="true" >'+$WC.I18N("message.translatingmsg")+"</div>";$WC.Ajax.postRequestToChat("v2/chats/"+n+"/messages/"+C+"/translations","target="+WebMessanger.language,function(){var e=JSON.parse(this.response);Message.translationmsgstore[C].translation=e.text,Message.replaceTranslatedMessage(X,Message.translationmsgstore[C],!0),X.nextElementSibling.querySelector("[data-translatingmsg]").outerHTML=Message.getOriginalMsgBtnHtml()},function(){X.nextElementSibling.querySelector("[data-translatingmsg]").outerHTML=Message.getTranslateMsgBtnHtml()})}}else if("true"==t.getAttribute("data-showoriginalmsg")){C=(X=t.parentElement.parentElement.previousElementSibling).getAttribute("data-msguid");Message.replaceTranslatedMessage(X,Message.translationmsgstore[C]),t.parentElement.outerHTML=Message.getTranslateMsgBtnHtml()}else if(t.closest("[data-type]")&&t.closest("[data-type]").getAttribute("data-type")===Message.types.FILEATT){e.preventDefault();var P=(X=t.closest("[data-type]")).getElementsByTagName("a")[0];P.contains(t)&&WmsFileUploadUI.handleDownload(P.getAttribute("download"),P.getAttribute("href"))}else if(t.getAttribute("data-urlnotification")){C=(X=t.closest("[data-msguid]")).getAttribute("data-msguid");var B=Message.urlmsgstore[C],j={buttons:{}};for(u=0;u<B.meta.linkdetails.notification_configs.length;u++){var F=B.meta.linkdetails.notification_configs[u];j.buttons[F]=B.meta.btnindexvsdetails[F]}(G=WindowHandler.getWinObjById(n)).showDynamicActions(j,X,!1)}else if(t.getAttribute("data-starmsg"))WMSUI.showStarOptions(t,n),e.stopPropagation(),e.preventDefault();else if(t.getAttribute("data-redirecturl")||t.parentElement&&t.parentElement.getAttribute("data-redirecturl")){(t.getAttribute("data-redirecturl")?t.querySelector("a[href]"):t).href=t.getAttribute("data-redirecturl")||t.parentElement.getAttribute("data-redirecturl")}}else{var z=t.closest("[data-reaction]");"wms_reaction_container"!=z.className&&(z=z.parentNode);var G,q=z.getAttribute("data-reaction"),C=(X=t.closest("[data-msguid]")).getAttribute("data-msguid"),Y=z.getAttribute("data-reactedbyme"),V=X.getAttribute("data-type")==Message.types.THREADLINKMSG;if(WebMessanger.updateReaction(n,C,q,Y,V),(G=WindowHandler.getWinObjById(n))&&G.updateMyReactionData(C,q,Y),WMSUI.checkAndLoadCustomEmojis(s.parentElement),V){var Z=X.querySelector("[data-thread_chid]").getAttribute("data-thread_chid"),K=WindowHandler.getWinObjById(Z);K&&K.updateMyReactionData(C,q,Y)}}else{var X;"REPLYMSG"===(X=t.parentNode.previousSibling).getAttribute("data-type")&&(X=X.querySelector("[data-msgid]")),Message.showEditMessageHistory(X,n)}}),Message.getAllowedActions=function(e,t,s){var i=e.closest("[data-type]")&&e.closest("[data-type]").getAttribute("data-type");"EDITEDMSG"===i&&e.firstChild&&e.firstChild.getAttribute("data-type")&&(i=e.firstChild.getAttribute("data-type"));var n=e.closest("[data-msgid]"),a=WindowHandler.getWinObjById(s),o="TEXTMSG"===i||"EDITEDMSG"===i||"HRMSG"===i,r="DELETEDMSG"!==i;i!=Message.types.FILEATT&&i!=Message.types.AUDIOATT&&i!=Message.types.VIDEOATT&&i!=Message.types.IMGATT||!n.querySelector("[data-attachmentdisabled]")||(r=!1);var l,d=Message.isDeletable(n),c=Message.isEditable(n),m=!WebMessanger.is_set_reminder_option_disabled&&"CUSTOMMSG"!==i&&!1!==WebMessanger.isCliqUser(),u=!1===WebMessanger.is_copy_message_link_disabled,p=WindowHandler.getWinObjById(s),h=p.pinmsgdetails.info.msgid,g=n.getAttribute("data-msguid")!==h,f=!WebMessanger.is_msgpin_option_disabled&&p.pinmsgdetails.action_enabled,C=!(a.permdenied||!$WC.Channels.isReplyActionAllowed(s));l=!0;var v=!$WC.Channels.isDefaultChannel(s),b=!(!a.reactions[n.getAttribute("data-msguid")]||$WC.Channels.isDefaultChannel(s)),y=!(!$WC.Util.isChannelChid(s)||!$WC.Channels.isThreadReplyAllowed(s)||Message.isThreadNode(n)),_=!!a.isPrivateReplyAllowed(n),W={};if(W.forward=!!r,W.reply=C,W.private_reply=_,W.copy=o,W.react=v,W.fork=l,W.setreminder=m,W.markasunread=!0,W.messagelink=u,W.edit=!!c,W.delete=!!d,W.pinmsg=!!f&&g,W.unpinmsg=!!f&&!g,W.viewreaction=b,W.thread_reply=y,!t.include_all)for(var S in W)W[S]&&(t[S]&&"enable"==t[S]?W[S]=!0:W[S]=!1);return W},Message.isDeletable=function(e){var t=e&&e.getAttribute("data-msgid"),s=t&&t.split("_"),i=s&&(WebMessanger.isRTCChat()?s.slice(0,3).join("_"):s[0]);return!!($WC.Util.isLocalUser(i)&&WebMessanger.isMessageDeletionEnabled()&&(new Date).getTime()-e.getAttribute("data-msgtime")<=WebMessanger.getDeleteMessageTimeFrame())},Message.isEditable=function(e){if(e){var t=e.getAttribute("data-msgid"),s=t&&t.split("_"),i=s&&(WebMessanger.isRTCChat()?s.slice(0,3).join("_"):s[0]),n=e.getAttribute("data-type");if("EDITEDMSG"===n&&e.firstChild.getAttribute("data-type")&&(n=e.firstChild.getAttribute("data-type")),("TEXTMSG"===n||"EDITEDMSG"===n||"FORWARDEDMSG"===n||"THREADLINKMSG"===n||"THREADMSG"===n||("IMGATT"===n||"FILEATT"===n||"VIDEOATT"===n||"AUDIOATT"===n)&&!WebMessanger.isGuestUser()||"REPLYMSG"===n||"HRMSG"===n||"VIDEOLINK"===n||"AUDIOLINK"===n||"IMGLINK"===n)&&$WC.Util.isLocalUser(i)&&WebMessanger.isMessageEditingEnabled()&&(new Date).getTime()-e.getAttribute("data-msgtime")<=WebMessanger.getEditMessageTimeFrame())return!0}return!1},Gator(e).on("click",".zcmsg_bx",function(e){if(null===document.getElementById("zcwindows")){var t=$WC.Util.createElement("div","zcwindows","zcoverlay");t.style.zIndex=WebMessanger.setzindex,document.body.appendChild(t),Gator(t).on("click","[purpose='custom_image_preview']",function(e){$WC.CustomMsgUI.handleCustomBoxClick(this,e)})}if(null===e.target.closest("[custombuttonclick_onmsg]")){document.activeElement.blur();"a"!==e.target.tagName.toLowerCase()&&"custom_image_preview"!==e.target.getAttribute("purpose")&&this.closest("[data-msguid]")&&document.getElementById("zcwindows").setAttribute("data-msguid",this.closest("[data-msguid]").getAttribute("data-msguid")),$WC.CustomMsgUI.handleCustomBoxClick(this,e,function(){document.getElementById("zcwindows")&&(document.getElementById("zcwindows").removeAttribute("data-msguid"),document.getElementById("zcwindows").innerHTML=null)})}}),Gator(e).on("dblclick",".wms-msgfrag",function(e){var t=$WC.Util.getEventTarget(e),s=e.target.closest("#ctrlcomp");if(!t.querySelector("[data-attachmentdisabled]")&&!t.getAttribute("data-attachmentdisabled")&&null===t.closest(".wms-msg")&&"DELETEDMSG"!==this.getAttribute("data-type")&&"HRMSG"!==this.getAttribute("data-type")){var i=s.getAttribute("data-chid"),n=WindowHandler.getWinObjById(i);n&&!n.salesiqchat&&($WC.Channels.isReplyActionAllowed(i)?n.showReplyPreview(t):$WC.Channels.isThreadReplyAllowed(i)&&!Message.isThreadNode(t)&&n.showReplyPreview(t,null,null,!0))}}),$WC.Util.addEvent(t,"scroll",$WC.Util.debounce(function(e){var t=$WC.Util.getEventTarget(e);if(clearTimeout(this.scrolltimer),t){this.scrolltimer=setTimeout(function(){WMSUI.loadImages(t),Message.checkAndLoadAudioPlayer(t),Message.loadUrlThumbnail(t),WMSUI.checkAndLoadCustomEmojis(t)},_WMSORIGINALIMG_LOAD_TIMEOUT),clearTimeout(this.livezomoji),this.livezomoji=setTimeout(function(){Message.toggleLiveZomoji(t)},100);var s=t.scrollHeight-(t.scrollTop+t.clientHeight);if(t.scrollHeight>t.clientHeight&&t.scrollTop<=2*t.clientHeight&&null===t.getAttribute("data-glowtime"))(i=t.querySelector("[data-loadmore]"))&&i.nextSibling&&(i.nextSibling.getAttribute("data-msgtime")&&i.setAttribute("data-nexttime",i.nextSibling.getAttribute("data-msgtime")),Message.loadSpecificTranscript(o,t,i));else if(t.closest("[data-scrolldown]")&&s<=t.clientHeight){var i,n=t.querySelectorAll("[data-loadmore]");if(n.length)if((i=n[n.length-1]).previousSibling){var a=i.previousSibling.getAttribute("data-msgtime")||i.previousSibling.previousSibling.getAttribute("data-msgtime");a&&i.setAttribute("data-prevtime",a),Message.loadSpecificTranscript(o,t,i)}}}},this,70)),$WC.Util.addEvent(t,"scroll",$WC.Util.debounce(function(e){if(e.target){var t=Message.getScrollableParent(e.target.closest("#ctrlcomp")||e.target.querySelector("#ctrlcomp")||e.target.closest("#wmschshtransmsg")||e.target.closest("#wmstranscriptcomponent")),s=t.getAttribute("data-glowtime");if(s){var i=t.querySelector('.wms-msgfrag[data-msgtime="'+s+'"]');i&&($WC.Util.addClass(i.firstChild,"wms-bubbleglow"),t.removeAttribute("data-glowtime"))}}},this,70));var s=$WC.Util.getCssAnimEndListener();$WC.Util.addEvent(t,s,function(e){if("wms-bubbleglow"===e.animationName){var t=$WC.Util.getEventTarget(e);$WC.Util.removeClass(t,"wms-bubbleglow")}})},Message.hideOptions=function(e){var t=e&&e.closest&&e.closest("[data-options]")||document.querySelector('[data-options="show"]');t&&$WC.Util.removeElement(t)},Message.loadSpecificTranscript=function(e,t,s,i){var n,a,o,r=!1;if(s.getAttribute("data-mentionmsgid")){var l=s.getAttribute("data-mentionmsgid");r=!0;var d=16;2===(n=l).split("|").length&&(d=30)}else if(s.getAttribute("data-prevtime"))a=+(n=s.getAttribute("data-prevtime"));else if(s.getAttribute("data-nexttime"))o=+(n=s.getAttribute("data-nexttime"));else if(s.getAttribute("data-latestchunk")){n="latestchunk";var c=!0}if("true"===t.getAttribute("data-unread"))var m=!0;"true"===t.getAttribute("data-fromchat")&&(r=!0);for(var u=s.nextSibling;!o&&u;)u.getAttribute("data-msgtime")&&u.getAttribute("data-msgid")&&!u.getAttribute("data-notack")&&(o=+u.getAttribute("data-msgtime")),u=u.nextSibling;"latestchunk"==n&&o&&(n=o);var p=s===s.parentNode.lastChild,h=WMSUI.showLoadingIcon(s,"insert");h.setAttribute("data-marker",n),(s.getAttribute("data-scrollbehaviour")||p)&&h.setAttribute("data-scrollbehaviour",s.getAttribute("data-scrollbehaviour")||"bottom");var g=t;"true"===t.getAttribute("data-ctrlcomp")&&(g=t.querySelector("[data-msgdisp]"));var f=WindowHandler.getWinObjById(e);WebMessanger.getTranscript({chid:e,fromtime:a,totime:o,lineslimit:d||50,partial:c,type:"insert",mentionmsgid:l,salesiqchat:f&&f.salesiqchat||!1,unreadchat:m},g,r,i)},Message.formatAndDisplay=function(e){var t=e.chid;e.time||(e.time=Date.now()),WindowHandler.getWinObjById(t).updateMessage(e)},Message.getScrollableParent=function(e){return e.getAttribute("data-msgdisp")?e.parentNode:e},Message.getScrollHeight=function(e){return Message.getScrollableParent(e).scrollHeight},Message.getScrollTop=function(e){return Message.getScrollableParent(e).scrollTop},Message.restoreScrollPosition=function(e,t,s){e.getAttribute("data-msgdisp")&&(e=e.parentNode);var i=t-s,n=e.scrollHeight-i;e.scrollTop=n},Message.scrollDisplay=function(e){(e=Message.getScrollableParent(e)).scrollTop=e.scrollHeight},Message.trim=function(e){return e=(e=(e=(e=(e=(e=(e=e.replace(/<p>|<\/p>/gi,"")).replace(/<a/gi,"<a target='_blank'")).replace(/\n/gi,"<br>")).replace(/^\s*$/gi,"")).replace(/^(<br>)*$/gi,"")).replace(/(<br>)*$/gi,"")).replace(/\s*$/gi,"")},Message.format=function(e){try{for(var t=e.split(" "),s=[],i=/([a-z0-9]([a-z0-9_\-.+]*)@([a-z0-9_\-.]*)(\.[a-z]{2,3}(\.[a-z]{2}){0,2}))/gi,n=0;n<t.length;n++){var a=$WC.CMsgUtil.convertLinks(t[n]);t[n]===a&&(a=a.replace(i,"<a href='mailto:$1'>$1</a>")),s.push(a)}e=s.join(" ")}catch(e){}return e},Message.getDisplayContent=function(e){return e=Smiley.replace(e,!1,!0),e=Message.trim(e),e=Message.format(e)},Message.decodehtml=function(e){var t=e.replace(/&lt;/g,"<");return t=t.replace(/&gt;/g,">")},Message.showEditMessageHistory=function(e,t){if(null===document.getElementById("wms_msghistdiv")){ZMSGUI.createOverlay();var s=$WC.Util.createElement("div","wms_msghistdiv","wms_msghistdiv wms-hvalign");s.style.zIndex=$WC.Config.get("zindex"),document.body.appendChild(s);var i=e.getAttribute("data-msguid");WebMessanger.getEditMsgHistory(t,i);var n=e.getAttribute("data-msgtime");e=e.querySelector('[class~="wms-msgcomment"]')||e.querySelector('[class~="wms-msg"]')||e.querySelector('[class~="wms-hrmsg"]');var a=document.getElementById("wms_msghistdiv"),o={time:n,msg:Message.getTextMsgFromDom(e.childNodes,!1,!0)},r=Message.getEditMessageHTML([o]);r+='<div id="wms_loadingicon" class="wms-cmdloading"><div class="wms-loadingicon"><div class="wms_loading_container"><div></div><div></div><div></div></div></div></div>',a.insertAdjacentHTML("beforeend",'<div id="wms_msghistheader" class="wms_msghistheader">'+$WC.I18N("message.edit.history")+'<span data-operation="close" class="wms_msghistclose"></span></div><div id="wms_msghistcont" class="wms_msghistcont" data-msguid="'+i+'">'+r+"</div>"),Gator(a).on("click",'[data-operation="close"]',function(){$WC.Util.removeElement(this.closest('[id="wms_msghistdiv"]')),ZMSGUI.removeOverlay()})}},Message.getEditMessageHTML=function(e){var n="";return e.forEach(function(e){var t=$WC.DateUtil.formatTime(e.time),s=$WC.DateUtil.formatDate(e.time);"object"!=typeof e.msg||"20"!==e.origin_mtype&&"20"!==e.mtype?e.msg=Smiley.replace($WC.Markdown.apply($WC.Util.safeHTML($WC.Util.unescapeHTML(e.msg)))):e.msg.comment?e.msg='<div class="wms_editcomment">'+Smiley.replace($WC.Markdown.apply($WC.Util.safeHTML($WC.Util.unescapeHTML(e.msg.comment))))+"</div>":e.msg='<div class="wms_editnocomment">'+$WC.I18N("edithistory.comment.none")+"</div>";var i=e.meta&&e.meta.mentions?e:e.msg;i=Message.isMentionMsg(i)?$WC.Util.formatMentions(i):i,n+='<div id="wms_msghistitem" class="wms_msghistitem"><div id="wms_msghistitem_title" class="wms_msghistitem_title">'+$WC.I18N("message.edit.timeinfo",['<span class="wms_msghistitem_time">'+t+"</span>",s])+'</div><div class="wms_msghistitemcontent">'+Message.getDisplayContent(i)+"</div></div>"}),n},Message.updateEditMsgHistory=function(e){var t=document.getElementById("wms_msghistcont"),s=t&&t.getAttribute("data-msguid");e.reverse(),s===e[0].msguid&&(t.innerHTML=Message.getEditMessageHTML(e))},Message.showMessageFragmentInView=function(e,t,s,i){if(-1<t.indexOf("_"))var n=t.split("_")[0];else if(-1<t.indexOf("%20"))n=t.split("%20")[0];var a=WindowHandler.getWinObjById(e);if(a){var o=a.ctrlcomp.querySelector("#ctrlcomp");if(a.isMinimized()&&a.maximize(),o.querySelector('.wms-msgfrag[data-msgtime="'+n+'"]'))Message.glowBubble(n,a.ctrlcomp,e,i);else{var r=Message.getMarkerElement(e+"|"+n,n,o);Message.loadSpecificTranscript(e,o,r)}}else Message.mentionMsgInfo[e]=e+"|"+n,WmsMainUI.scheduleAutoFocus(e),s?WebMessanger.openThreadWindowFromCache(s,e):WebMessanger.createChatWindowFromCache(e)},Message.handleMessageLinkClick=function(e,t){if(!WebMessanger.isChatPaused()&&!silent){var s=e&&e.target.href&&e.target.href.match?event.target.href:t;if(s&&window.frameElement&&"undefined"!=typeof CrmPlusLib&&CrmPlusLib.isLoadedInCrmplusFrame){var i={link:s,event_from_wms_iframe:!0};return window.parent.postMessage(JSON.stringify(i)),void((s.match($WC.Matcher.regexes.messagelinkregex)||s.match($WC.Matcher.regexes.channelspermalink))&&(e.stopPropagation(),e.preventDefault()))}if(s&&s.match($WC.Matcher.regexes.messagelinkregex)){var n=s,a=n.match($WC.Matcher.regexes.messagelinkregex)[1],o=n.match($WC.Matcher.regexes.messagelinkregex)[2];if(!$WC.Util.isChannelChid(a)||$WC.Channels.get(a)&&$WC.Channels.get(a).joined)Message.showMessageFragmentInView(a,o);else{$WC.Ajax.requestToChat("v2/chats/"+a+"/messages/"+o,null,function(e){var t=JSON.parse(e).parent_resource_id;WebMessanger.fetchChannelDetails(t)})}e.preventDefault(),e.stopPropagation()}else if(s&&s.match($WC.Matcher.regexes.channelspermalink)){var r=s.match($WC.Matcher.regexes.channelsuniquename)[1],l=$WC.Channels.getListByUniqueName(r);if(l.length&&!WMSUI.handleChatExist(l[0].chid)&&l.joined)WmsMainUI.scheduleAutoFocus(l[0].chid),WebMessanger.createChatWindowFromCache(l[0].chid);else{$WC.Ajax.requestToChat("v1/channelsbyname/"+r,"tzoffset=330&getrecentconv=true",function(e){var t=JSON.parse(e).data;$WC.Channels.isJoinedChannel(t.chid)?($WC.Channels.updateList(JSON.parse(e)),WMSUI.handleChatExist(t.chid)||(WmsMainUI.scheduleAutoFocus(t.chid),WebMessanger.createChatWindowFromCache(t.chid))):WmsHybridSearch.showJoinChannelDialog(JSON.parse(e))},null,null,{"Content-Type":"application/json"})}e.preventDefault(),e.stopPropagation()}else if(e&&e.target&&e.target.closest("[data-threadmsglink]")){var d=e.target.getAttribute("data-thread_msgid")?e.target:e.target.closest("[data-thread_msgid]");o=d.getAttribute("data-thread_msgid"),a=d.getAttribute("data-threadmsglink")?d.getAttribute("data-thread_parentid"):d.getAttribute("data-thread_chid");d.getAttribute("data-threadmsglink")||d.closest("[data-type]").getAttribute("data-type")!==Message.types.THREADMSG?$WC.Util.isChannelChid(a)&&(d=null):d.setAttribute("data-thread_parentid",d.closest("[data-chid]").getAttribute("data-chid")),Message.showMessageFragmentInView(a,o,d),e.preventDefault(),e.stopPropagation()}else if(e&&e.target&&e.target.closest("[data-threadslist]")){a=e.target.closest("[id]").getAttribute("id");var c=WindowHandler.getWinObjById(a);(new $WC.ThreadsList).mountComponent(a,c.title,WmsSettings.adminsettings.include_closed_threads,function(e){WmsSettings.adminsettings.include_closed_threads=e},function(e){WebMessanger.attachSession(e)})}}},Message.getMarkerElement=function(e,t,s){var i,n=$WC.Util.createElement("div",null,null,{"data-mentionmsgid":e});n.style="display:none";var a=s.querySelectorAll("[data-prevtime],[data-loadmorebutton]");if(a.length)for(var o=0;o<a.length;o++){var r=a[o].getAttribute("data-prevtime");if(a[o].getAttribute("data-loadmorebutton"))+($WC.Util.getAdjacentNode(a[o],!0,"data-msgid").getAttribute("data-msgtime")||"")<+t&&(i=a[o].parentNode.insertBefore(n,a[o].nextSibling));else isNaN(r)?+(r=r.split("|")[2])<+t&&(i=a[o].parentNode.insertBefore(n,a[o].nextSibling)):+r<+t&&(i=a[o].parentNode.insertBefore(n,a[o].nextSibling))}if(!i){var l=s.querySelector("[data-loadmore],[data-transerror]");s.replaceChild(n,l),i=n}return i},Message.handleMessageActions=function(e,t){var s,i=e.closest("#ctrlcomp").getAttribute("data-chid");if((C=WindowHandler.getWinObjById(i)).hideMessageActionsUI(),Message.hideOptions(),"private_reply"===t){var n=e.closest("[data-sender]")&&e.closest("[data-sender]").getAttribute("data-sender");WmsMainUI.scheduleAutoFocus(n),Message.replyPrivateMsgObj[n]=[i,e.getAttribute("data-msguid")],WebMessanger.createChat(n)}else if("thread_reply"===t)C&&C.showReplyPreview(e,null,null,!0);else if("reply"===t)C&&C.showReplyPreview(e);else if("copy"===t){var a;a=(e=e.closest('[data-type="TEXTMSG"]')||e.closest('[data-type="EDITEDMSG"]'))?e.firstChild.childNodes:[(e=e.closest('[data-type="HRMSG"]')).lastChild];var o=Message.getTextMsgFromDom(a,!1,!0);$WC.Util.copyTextToClipboard(o,e),C.showInfoMsg($WC.I18N("message.info.copied"))}else if("delete"===t)WMSUI.showDeleteConfirmationDialog(e,i);else if("edit"===t)(C=WindowHandler.getWinObjById(i))&&C.showReplyPreview(e,!0);else if("setreminder"===t){e.getAttribute("data-type");var r=e.getAttribute("data-msgtime"),l=WebMessanger.getReminderInfo(r),d=(i=i,e.getAttribute("data-msgid")),c=Message.getReferenceContent(i,e);C=WindowHandler.getWinObjById(i);var m={time:$WC.DateUtil.formatDTTime(r),msg:c,sender:$WC.Util.isLocalUser(d.split("_")[0])?$WC.I18N("chat.you"):e.getAttribute("data-sendername")};C.remindercomponent=new $WC.RemindersDialog,C.remindercomponent.mountComponent(i,r,m,l,function(){C.showErrorMsg($WC.I18N("reminders.add.success"),"info")},function(){C.showErrorMsg($WC.I18N("reminders.add.failed"))})}else if("fork"===t){var u=Message.getReferenceContent(i,e),p=(d=e.getAttribute("data-msgid"),r=$WC.DateUtil.formatDTTime(e.getAttribute("data-msgtime")),WindowHandler.getWinObjById(i)),h=p.title+$WC.I18N("fork.title.text"),g=p.recipant&&p.recipant.split(",");m={time:r,msg:u,sender:$WC.Util.isLocalUser(d.split("_")[0])?$WC.I18N("chat.you"):e.getAttribute("data-sendername")};(new $WC.ForkChat).mountComponent(i,h,d,m,g,WMSUI.showErrorMsg)}else if("react"===t){var f=e.closest("[data-msguid]").getAttribute("data-msguid");(C=WindowHandler.getWinObjById(i)).showReactionsUI(f)}else if("markasunread"===t){var C;f=e.getAttribute("data-msguid"),r=e.getAttribute("data-msgtime");WebMessanger.markAsUnread(i,f,r),(C=WindowHandler.getWinObjById(i)).close()}else if("messagelink"===t){f=e.getAttribute("data-msguid");var v='<textarea id="wms_copyhidden" style="display:block;">'+(_WMSCHATURL+"chats/"+i+"/messages/"+f.replace("%20","_"))+"</textarea>";e.insertAdjacentHTML("afterend",v),C=WindowHandler.getWinObjById(i),document.getElementById("wms_copyhidden").select(),document.execCommand("copy"),e.parentElement.removeChild(document.getElementById("wms_copyhidden")),C.showInfoMsg($WC.I18N("messagelink.info.copied"))}else if("forward"===t)$WC.Util.isEmptyObject($WC.Channels.get())&&$WC.Channels.initChannels(),(C=WindowHandler.getWinObjById(i)).toggleMessageSelection(!0,e);else if("pinmsg"===t){var b=e,y=Message.getReferenceContent(i,e),_=!!WindowHandler.getWinObjById(i).pinmsgdetails.info.msgid;(new $WC.PinMsgDialog).mountComponent(function(e,t){var s=b.getAttribute("data-msguid");WebMessanger.pinMsg(i,s,e,t)},y,_)}else if("unpinmsg"===t)WebMessanger.unpinMsg(i);else if("viewreaction"===t){function W(){var e=document.getElementById("wms-viewreactionoverlay");$WC.Util.removeElement(e)}var S={},w=(d=e.getAttribute("data-msguid"),new $WC.ViewReactions);(s=$WC.Util.createElement("div","wms-viewreactionoverlay","wms_viewreaction_overlay")).style.zIndex=$WC.Config.get("zindex"),s.innerHTML='<div class="wms_viewreaction_container"><div class="wms_viewreaction_loading wms_loading_div"></div></div>',document.body.appendChild(s);function M(e){if(W(),"string"==typeof e){var t=JSON.parse(this.response);t.list=Object.keys(t.data),S.reactionlist=t}else S.reactionlist=e;S.partinfo=C.partinfo,S.onListItemClick=function(e,t,s){var i=t.getAttribute("data-zcprofileid")?t:t.querySelector("[data-zcprofileid]");i&&WebMessanger.showProfileInfo(i),s&&(s.stopPropagation(),s.preventDefault())};var s={};"undefined"!=typeof WmsUIImpl&&(s=WmsImplHandler.invokeSynchronously(WmsUIImpl.getChatBarOptions)||{}),S.config=s,w.mountComponent(S);if("disable"==s.userdescinfo)w.updateParticipantsData(C.partinfo);else if(2<C.partcount&&C.fetchparticipants)WebMessanger.fetchChannelMembers(C.objId,null,null,function(){C.fetchparticipants=!1,w.updateParticipantsData(C.partinfo)});else if(2==C.partcount&&!WmsProfileInfo.isExistInCache(WebMessanger.zuid)){$WC.Ajax.requestToChat("v2/users/"+WebMessanger.zuid,"fields="+encodeURIComponent("all,checkin_status"),function(e){var t=JSON.parse(this.response);WmsProfileInfo.update(WebMessanger.zuid,t.data),$WC.Config.set({email:t.data.email_id}),w.updateParticipantsData(C.partinfo)})}}var I={"x-consents-version":"1","X-XHR-exception":!0,"X-ZCSRF-TOKEN":$WC.Util.getCSRF()},T=!1;for(var A in C.reactions[d].data)if(C.reactions[d].data[A].length){T=!0;break}T?M(C.reactions[d]):$WC.Ajax.requestToChat("v2/chats/"+i+"/messages/"+d+"/reactions",null,M,function(){W(),$WC.Util.showErrorMsg($WC.I18N("event.status.update.error"))},null,null,I)}},Message.constructTimeFragment=function(e,t,s,i,n,a,o){if(e){var r=!!t,l='<div class="wms_msg_editinfo" title="'+$WC.I18N("message.edit.history")+'"data-edited="'+r+'">'+$WC.I18N("message.edit.info")+"</div>",d=!(WebMessanger.isExclusiveChat()||WebMessanger.isRTCChat()||n||i&&!s)&&WebMessanger.isReadReceiptEnabled(),c=!s||n||WebMessanger.isExclusiveChat()||WebMessanger.isRTCChat()?"msg.sent":"Read",m='<div class="wms_msg_receipt" title=\'{{msg_receipt_title}}\' data-read-receipt="'+d+'" data-msg-read="'+(!(n||WebMessanger.isExclusiveChat()||WebMessanger.isRTCChat())&&s)+'"></div>',u="";a&&a.translatemsg&&(u=Message.getTranslateMsgBtnHtml(a.msg.detected_language),Message.translationmsgstore[a.msg.msguid]=a.msg);var p="<div class='{{starclass}}' data-starmsg='true' data-starselected='{{starselected}}' data-startype='{{startype}}'></div>",h="",g="";return(o.deleted&&!o.startype||WebMessanger.isExclusiveChat())&&(p=""),$WC.Util.isLocalUser(o.senderzuid)?h=p:g=p,$WC.template.replace("<div class='wms-msgtime' data-timefrag=\"true\">"+h+"<span title='{{date}}' data-timetext=\"true\">{{msgtime}}</span>"+m+l+u+g+"</div>",{msgtime:$WC.DateUtil.formatTime(e),date:$WC.DateUtil.formatDate(e),msg_receipt_title:$WC.I18N(c),starselected:!!o.star,startype:o.startype,starclass:o.star?"wms_starsel wms_starbg"+o.startype:"wms_staricon"})}return""},Message.getReferenceContent=function(e,t){var s=!1;t.closest("[data-type="+Message.types.REPLYMSG+"]")&&(s=!0);var i=Message.getMsgFromDom(e,t.getAttribute("data-msgid"),s,!0,!0);if("object"==typeof i){var n="wms_pinmsg_att_icon";"CONTACTATT"===i.messagetype?n+=" wms_pinmsg_contact_icon":"LOCATT"===i.messagetype?n+=" wms_pinmsg_location_icon":"EVENTATT"===i.messagetype&&(n+=" wms_pinmsg_event_icon"),i=(i=i.fName||i.name||i.desc)+'<span class="'+n+'"></span>'}else if("string"==typeof i){var a=i.lastIndexOf("<br>"),o=i.lastIndexOf("\n");i=i.substring(-1!==a?a+4:-1!==o?o+1:0),i=$WC.Markdown.apply(i),i=Smiley.replace(i,!0)}return i},Message.getTranslateMsgBtnHtml=function(e){return'<div class="wms_translate_msg" data-translatemsg="true" data-detectedlanguage="'+e+'">'+$WC.I18N("message.translatemsg")+"</div>"},Message.getOriginalMsgBtnHtml=function(){var e="1"==WmsSettings.message_translation_source?"wms_googleicon":"wms_zia_icon";return'<div class="wms_original_msg_container"><div>'+$WC.I18N("message.translatedby",[""]).trim()+'</div><div class="'+e+'"></div><div class="wms_translatemsg_dot">&nbsp;&nbsp·&nbsp;&nbsp;&nbsp;</div><div class="wms_original_msg" data-showoriginalmsg="true">'+$WC.I18N("message.showoriginalmsg")+"</div></div>"},Message.replaceTranslatedMessage=function(e,t,s){var i=e.querySelector("[class*=wms-txtmsg]")||e.querySelector("[class*=wms-msgcomment]");t.translation=$WC.Util.safeHTML($WC.Util.unescapeHTML(t.translation));var n=s?t.translation:t.msg;(Message.isMentionMsg(t)||Message.isAddMsg(t))&&(n=WMSUI.atMentions.format(t,!1,s)),t.ignoremarkdown||(n=$WC.Markdown.apply(n)),i&&(i.innerHTML=Message.getDisplayContent(n))},Message.checkAndRemoveUrlImage=function(e){function s(e){var t=e.target.getAttribute("data-urlpreviewimg")?e.target.parentElement:e.target;$WC.Util.removeElement(t)}function t(e){for(var t=0;t<e.length;t++)e[t].complete||(e[t].onerror=s)}t(e.querySelectorAll("[data-urlpreviewimg]")),t(e.querySelectorAll("[data-urlfavicon]"))},Message.checkAndLoadAudioPlayer=function(e){function t(){WmsFileForwardUI.handlePreview(this)}for(var s=e.querySelectorAll('[data-mountaudioplayer="true"]'),i=0;i<s.length;i++){var n=s[i],a=n.closest("[data-chid]")?n.closest("[data-chid]").getAttribute("data-chid"):null;n.setAttribute("data-mountaudioplayer","false");var o=n.getAttribute("data-fsrc"),r=n.closest("[data-msguid]").getAttribute("data-msguid"),l=!!WebMessanger.isGuestUser(),d=n.closest("[data-sendername]").getAttribute("data-sendername"),c=n.getAttribute("data-fcontent"),m=parseInt(n.getAttribute("data-duration")||"0");-1==c.indexOf("audio/")&&(c="audio/mp3"),$WC.VideoPlayerFactory.create(a,e.parentElement,n,o,c,n.getAttribute("data-fname"),d,n.getAttribute("data-fposter"),$WC.Config.get("zindex"),t.bind(n),event,r,{hideforwardicon:"false"===n.getAttribute("data-filefrwrd"),isguestuser:l,duration:m})}},Message.handlePrivateReply=function(e){var t=WebMessanger.ucmap[e];if(Message.replyPrivateMsgObj[e]){var s=WindowHandler.getWinObjById(t),i=Message.replyPrivateMsgObj[e],n=i[0],a=i[1];if((o=WindowHandler.getWinObjById(n))&&s){var o,r=(o=WindowHandler.getWinObjById(n)).ctrlcomp.querySelector('[data-msguid="'+a+'"]'),l=Message.constructReplyMessageFragment(o.constructReplyMessageObject(r,null,null,!0),!0,!1,!1,n);s.focus(),s.footernode.style.borderRadius="0px 0px 5px 5px",s.editorreplydiv.innerHTML=l,s.editorreplydiv.style.display="block",delete Message.replyPrivateMsgObj[t]}}},Message.loadUrlThumbnail=function(e){for(var t=e.querySelectorAll("[data-urlpreviewimg]"),s=0;s<t.length;s++)if($WC.Util.isScrolledIntoView(t[s],e)&&t[s].getAttribute("data-originalsrc")){var i=t[s].getAttribute("data-originalsrc");t[s].removeAttribute("data-originalsrc"),t[s].src=i}},Message.isFileViewDisabled=function(e){return!(!e.hasOwnProperty("xorgpolicy")||"0"!=e.xorgpolicy)&&e.fscope!=_WMSAPPACCOUNTID},Message.getDisabledFileView=function(){return'<div class="wms_disabledFile" data-attachmentdisabled="true" title="'+$WC.I18N("fileview.noaccess.tip")+'"><span class="wms_disabledinfoicon"></span><span class="wms_disabledinfocontent">'+$WC.I18N("fileview.noaccess")+"</span></div>"},Chat.isExists=function(e){return null!=document.getElementById(e)},Chat.isExistsInCliqbar=function(e){return!(void 0===WindowHandler||!WindowHandler.chatbar||!WindowHandler.chatbar.querySelector('[id="'+e+'"]'))};var ChatBlink=function(){var s,t,i,n;function a(){1==t&&(t=!1,r(s),clearTimeout(i))}function o(){if(Self.Idle){var e=s,t=l();n!==t&&(s=t,e=n),r(e),i=setTimeout(o,1500)}else a()}function r(e){e&&(document.title=e)}function l(){if(document.title)return document.title}return{start:function(e){e&&(a(),s=l(),r(Message.decodehtml(e)),n=l(),r(s),t=!0,o())},stopRepeat:a}}();document.onclick=function(){Self.Idle=!1},$WC.Util.addEvent(window,"focus",function(){ChatBlink.stopRepeat()});var _SOUND_PLAYER,_MEDIA_SOUND_PLAYER,wmsuserstatus={};function Self(){Self.prevIdleStatus}function WMSZohoApi(){}function WMSKeyHandler(){}function WMSSessionConfig(){}function WmsSound(){}function WmsSettings(){}function WmsDragDrop(){}function PubSubObject(e,t,s,i,n,a){this.pskey=e,this.config=s,this.psuri=t,this.maxulist=-1,null!=i&&(this.maxulist=i),this.authtype=n,this.authid=a,this.userinfo={},this.wmsids=new Array,this.getUsers=function(){return this.userinfo},this.reInitUsers=function(){this.userinfo={},this.wmsids=new Array},this.addUsers=function(e){for(var t in e)this.addUser(t,e[t])},this.removeUsers=function(e){for(var t in e)this.removeUser(t,e[t])},this.addUser=function(e,t){var s=this.wmsids.indexOf(e);if(-1!=s&&this.wmsids.splice(s,1),this.wmsids.push(e),this.userinfo[e]=t,-1!=this.maxulist&&this.wmsids.length>this.maxulist){var i=this.wmsids.splice(0,1);delete this.userinfo[i]}},this.removeUser=function(e){var t=this.wmsids.indexOf(e);if(-1!=t){var s=this.wmsids.splice(t,1);delete this.userinfo[s]}},this.userCount=function(){return this.wmsids.length}}function PubSubApi(){}function PubSubBridge(){}function WmsNotification(){}Self.init=function(){Self.isIdle={},Self.prevIdleStatus={},Self.prevTypingTime={},Self.Timer={},setInterval(function(){Self.status.chkstatus()},1e4),Self.Idle=!0},Self.status={init:function(e){Self.isIdle[e]=!0,Self.Idle=!0,Self.prevIdleStatus[e]=!0},chkstatus:function(){try{var e={};for(var t in wmsuserstatus){var s=wmsuserstatus[t];if(null!=s&&void 0!==s&&"function"!=typeof s){var i=0;for(i in s);if(0==i)continue;if((new Date).getTime()-Self.prevTypingTime[t]<14e3){e[t]=s;continue}""!=Self.status.getmsg(t)&&Self.status.send(t,NFY_USER_ENTERED),Self.prevIdleStatus[t]=Self.isIdle[t],Self.isIdle[t]=!0,Self.Idle=!0}}wmsuserstatus=e}catch(e){}},isEnabled:function(){return WebMessanger.scode!=WMS_INVISIBLE&&!WebMessanger.isRTCChat()},send:function(e,t){try{if(-1===$WC.Util.indexOf(WebMessanger.liveChats,e))return}catch(e){}if(t==NFY_USER_ENTERED&&(wmsuserstatus[e]={}),Self.status.isEnabled()){var s="userid="+WebMessanger.getUserName()+"&chid="+e+"&status="+t+"&dname="+encodeURIComponent(WebMessanger.getNickName())+"&sid="+encodeURIComponent(WebMessanger.getSid());$WC.Ajax.postRequest("sendstatus"+dext,s)}},idle:function(e){var t={};t[(new Date).getTime()]=NFY_USER_IDLE,Self.prevIdleStatus[e]=Self.isIdle[e],Self.isIdle[e]=!0,Self.Idle=!0,wmsuserstatus[e]=t},update:function(e){var t=""+e.chid,s=t+"."+e.sender;if((clearTimeout(Self.Timer[s]),delete Self.Timer[s],e.sender!=WebMessanger.getUserName()&&e.sender!=WebMessanger.getZuid())&&null!=document.getElementById(t)){WindowHandler.getWinObjById(t).typingstatusnode.title="";var i=WindowHandler.getWinObjById(t).typingindicatornode;""!=e.msg?i.style.display="inline-block":i.style.display="none"}},check:function(e){var t={};t[(new Date).getTime()]=NFY_USER_TYPING,Self.isIdle[e]!=Self.prevIdleStatus[e]&&(""!=Self.status.getmsg(e)?(WindowHandler.makeNormalWinById(e),ChatBlink.stopRepeat(),Self.status.send(e,NFY_USER_TYPING),Self.prevTypingTime[e]=(new Date).getTime()):(Self.prevIdleStatus[e]=Self.isIdle[e],Self.Idle=!0,Self.isIdle[e]=!0,t[(new Date).getTime()]=NFY_USER_IDLE)),wmsuserstatus[e]=t},active:function(e){Self.prevIdleStatus[e]=Self.isIdle[e],Self.isIdle[e]=!1,Self.Idle=!1,null!=e&&Self.status.check(e)},clear:function(e,t){var s=e+"."+t;delete Self.Timer[s],Self.prevTypingTime[e]={},null!=document.getElementById(e)&&(WindowHandler.getWinObjById(e).typingindicatornode.style.display="none")},getmsg:function(e){try{if(null!=document.getElementById(e))return WindowHandler.getWinObjById(e).composer.value;if(null!=document.getElementById("editor"))return document.getElementById("editor").value}catch(e){}return""}},Self.init(),WMSZohoApi.acceptLiveSupport=function(e,t,s,i){if(""!=_WMSCHATURL){var n;(n=document.createElement("script")).setAttribute("type","text/javascript");var a="?chid="+e+"&guid="+t+"&a="+s+"&g="+i;silent||(a=a+"&sid="+encodeURIComponent(WebMessanger.getSid())),n.setAttribute("src",_WMSCHATURL+"acccsupport.ext"+a),document.body.appendChild(n)}},WMSKeyHandler.init=function(){ie?document.attachEvent("onkeydown",WMSKeyHandler.handle):document.addEventListener("keydown",WMSKeyHandler.handle),ie?document.attachEvent("onclick",WMSKeyHandler.onclick):document.addEventListener("click",WMSKeyHandler.onclick),WMSKeyHandler.skipeventlistener=!1},WMSKeyHandler.onclick=function(e){!0!==WMSKeyHandler.skipeventlistener?(WmsProfileInfo.handleDocumentClick(e),WMSUI.handleDocumentClick(e),Message.handleMessageLinkClick(e),WMSUI.handleDownloadLinkClickOnDesktop(e)):WMSKeyHandler.skipeventlistener=!1},WMSKeyHandler.handle=function(e){e=e||window.event;var t=window.event?e.keyCode:e.which;WMSUI.imgPreview.handleKeyMovement(e)||ChatTour.handleKeyMovement(e)?e.stopImmediatePropagation():(27==t&&WMSKeyHandler.escapee(e)&&WMSKeyHandler.cancelEvent(e),!1===WebMessanger.allprdchatdeactivated&&!1===WebMessanger.chatdeactivated&&!1===WebMessanger.smartchatshortcutdisabled&&!0===WMSUI.smartchatenabled&&32==t&&!0===e.ctrlKey&&!1===e.metaKey&&(WmsHybridSearch.toggleUI(),WMSKeyHandler.cancelEvent(e)),ZMSGUI.handleEvent(e))},WMSKeyHandler.escapee=function(e){return WMSUI.handleDocumentEscape(e)},WMSKeyHandler.cancelEvent=function(e){ie?(e.cancelBubble=!0,e.returnValue=!1):(e.preventDefault(),e.stopPropagation())},WMSKeyHandler.preventHandlingTabUpDownEnter=function(e){e.keyCode!==$WC.WmsConstants.KEYCODES.DOWN&&e.keyCode!==$WC.WmsConstants.KEYCODES.UP&&e.keyCode!==$WC.WmsConstants.KEYCODES.ENTER&&e.keyCode!==$WC.WmsConstants.KEYCODES.TAB||e.preventDefault()},WMSKeyHandler.init(),WMSSessionConfig.CHAT=1,WMSSessionConfig.CHAT_PRESENCE=2,WMSSessionConfig.PRESENCE_PERSONAL=4,WMSSessionConfig.PRESENCE_ORG=8,WMSSessionConfig.LOADBALANCED=16,WMSSessionConfig.MP=32,WMSSessionConfig.CROSS_PRD=64,WMSSessionConfig.MULTI_DISPATCH=128,WMSSessionConfig.REUSE_SESSION=256,WMSSessionConfig.TRANSIENT_PEX=512,WMSSessionConfig.APPNOTIFY=1024,WmsSound.getTune={},WmsSound.players={},WmsSound.constants={PERSONALCHAT:"mymsgsoundnotify",MENTION:"mentionsoundnotify",GROUPCHAT:"groupmessage_sound_notify",BOTMESSAGE:"botmessage_sound_notify",AVCALL:"av_call_sound_notify",SCREENSHARE:"screen_call_sound_notify"},WmsSound.notification_tunes=["","Cora","Cue","Celesta","Hail","Bell","Pac","Ting","Triangle","Wink","Heavenly","ViolinPing","Reverberate","Speedy","MusicboxDuo","MusicboxTriplet"],WmsSound.loadNotificationTunes=function(){for(var e={},t=[WmsSettings.adminsettings.smymessage,WmsSettings.adminsettings.smention,WmsSettings.adminsettings.groupmessage_tone,WmsSettings.adminsettings.botmessage_tone],s=0;s<t.length;s++){var i=WmsSound.notification_tunes[t[s]];i&&(e[i]="https://static.zohocdn.com/chat/source/officechat/sound/"+i+".wav")}WmsSound.preloadFiles(e)},WmsSound.init=function(){""!=(new Audio).canPlayType("audio/wav")&&"no"!=(new Audio).canPlayType("audio/wav")?WmsSound.getTune={newchat:"https://static.zohocdn.com/ichat/sound/977ffcde_newchatmsg2.wav",chatmsg:"https://static.zohocdn.com/ichat/sound/666003f7_tik.wav"}:WmsSound.getTune={newchat:"https://static.zohocdn.com/ichat/sound/33105394_newchatmsg2.mp3",chatmsg:"https://static.zohocdn.com/ichat/sound/823b32e2_tik.mp3"},WmsSound.timer=null},WmsSound.isNotifyAllowed=function(e){return 1==WmsSettings.adminsettings.globalsoundnotify&&1==WmsSettings.adminsettings[e]&&WebMessanger.isNotificationAllowedExternally()},WmsSound.checkAndPlayTune=function(e,t,s,i,n){s&&(WmsSound.getTune[t]=s),(e||wmsnotifyowner&&wmsnotifyowner.isOwner()||"INCOMING_TONE"!=t)&&WmsSound.playTune(t,null,i,n,!0)},WmsSound.playTune=function(e,t,s,i,n){if(n||WmsSound.isNotifyAllowed(t))try{e=e||"notify",WmsSound.players[e]=WmsSound.players[e]||new Audio(WmsSound.getTune[e]),i&&(WmsSound.players[e].volume=i),s?((_MEDIA_SOUND_PLAYER=WmsSound.players[e]).play(),WmsSound.timer=setInterval(function(){_MEDIA_SOUND_PLAYER.play()},1400)):(_SOUND_PLAYER=WmsSound.players[e]).play()}catch(e){}},WmsSound.stop=function(){try{_SOUND_PLAYER&&(_SOUND_PLAYER.pause(),_SOUND_PLAYER.currentTime=0,_SOUND_PLAYER=null),_MEDIA_SOUND_PLAYER&&(_MEDIA_SOUND_PLAYER.pause(),_MEDIA_SOUND_PLAYER.currentTime=0,_MEDIA_SOUND_PLAYER=null),clearInterval(WmsSound.timer)}catch(e){}},WmsSound.getWinFocus=function(){return _WMSWINFOCUS},WmsSound.preloadFiles=function(e){if(!$WC.Util.isEmptyObject(e))for(var t in e)WmsSound.players[t]||(WmsSound.players[t]=new Audio(e[t]))},WmsSettings.bsettings={},WmsSettings.bsettings={sound:"0",soc:"1",scp:"0",vmessage:"0",vmymessage:"1",vmention:"1",groupmessage_visual_notify:"1",botmessage_visual_notify:"1",read_reciept:"1:0",vustatus:"0",disann:{},deact:"",chatenabled:!0,cpinnedchats:"1",cunreadchats:"1",crecentchats:"1",tourenabled:"0",wmstourprops:"0",primetime_onboard_count:"0",salesiq_chatbar:"0",salesiq_chatbar_prdlist:"",adminsettings:{mymsgsoundnotify:"1",mentionsoundnotify:"1",groupmessage_sound_notify:"1",botmessage_sound_notify:"1",av_call_sound_notify:"0",screen_call_sound_notify:"0",smymessage:"1",smention:"2",groupmessage_tone:"1",botmessage_tone:"1",globalsoundnotify:"1"}},WmsSettings.constants={ONBOARD:1},WmsSettings.populate=function(){for(var e in this.sound=WmsSettings.bsettings.sound,this.soc=WmsSettings.bsettings.soc,this.scp=WmsSettings.bsettings.scp,this.vmessage=WmsSettings.bsettings.vmessage,this.vmymessage=WmsSettings.bsettings.vmymessage,this.vmention=WmsSettings.bsettings.vmention,this.groupmessage_visual_notify=WmsSettings.bsettings.groupmessage_visual_notify,this.botmessage_visual_notify=WmsSettings.bsettings.botmessage_visual_notify,this.read_receipt=WmsSettings.bsettings.read_reciept,this.vustatus=WmsSettings.bsettings.vustatus,this.disann=WmsSettings.bsettings.disann,this.deact=WmsSettings.bsettings.deact&&WmsSettings.bsettings.deact.split(","),this.chatenabled=WmsSettings.bsettings.chatenabled,this.cpinnedchats=WmsSettings.bsettings.cpinnedchats,this.cunreadchats=WmsSettings.bsettings.cunreadchats,this.crecentchats=WmsSettings.bsettings.crecentchats,this.primetime_onboard_count=WmsSettings.bsettings.primetime_onboard_count,this.salesiq_chatbar=WmsSettings.bsettings.salesiq_chatbar,this.salesiq_chatbar_prdlist=WmsSettings.bsettings.salesiq_chatbar_prdlist&&WmsSettings.bsettings.salesiq_chatbar_prdlist.split(","),WmsSettings.adminsettings={isChannelAllowed:!0,isMediacallAllowed:!0,isDisableHistoryAllowed:!0,cliqaccess:!0,user_read_receipt:"1:0"},WmsSettings.bsettings.adminsettings)WmsSettings.adminsettings[e]=WmsSettings.bsettings.adminsettings[e];if("object"==typeof WmsSettings.adminsettings.orgPolicies&&("false"===WmsSettings.adminsettings.orgPolicies.chat_with_non_org_users&&$WC.Config.set({other_orguser_chat:"disable"}),"false"===WmsSettings.adminsettings.orgPolicies.allow_turn_off_chat_history&&(WmsSettings.adminsettings.isDisableHistoryAllowed=!1)),WmsSettings.adminsettings.moduleconfig="string"==typeof WmsSettings.adminsettings.moduleconfig&&""!==WmsSettings.adminsettings.moduleconfig?JSON.parse(WmsSettings.adminsettings.moduleconfig):"","object"==typeof WmsSettings.adminsettings.moduleconfig&&$WC.SecurityManager.update(WmsSettings.adminsettings.moduleconfig),"object"==typeof WmsSettings.adminsettings.service_configurations&&(_DOWNLOADSERVERURL=WmsSettings.adminsettings.service_configurations.download_server_url,_UPLOADSERVERURL=WmsSettings.adminsettings.service_configurations.upload_server_url),!1===WmsSettings.adminsettings.isChannelAllowed&&$WC.Config.set({channels:"disable"}),WmsSettings.adminsettings.features&&WmsSettings.adminsettings.features.chatdrafts&&$WC.Drafts.checkAndUpdateLMTime(WmsSettings.adminsettings.features.chatdraft_lmtime),wmsUserConfig.infomsg)try{var t=JSON.parse(wmsUserConfig.infomsg);"true"==t.splann?window.frameElement&&"undefined"!=typeof CrmPlusLib&&CrmPlusLib.isLoadedInCrmplusFrame||WebMessanger.processSpecialAnnouncement(t):WMSUI.processAnnMsg(wmsUserConfig.infomsg,wmsUserConfig.infomsgtype)}catch(e){WMSUI.processAnnMsg(wmsUserConfig.infomsg,wmsUserConfig.infomsgtype)}if("ie"!==$WC.$CUtil.getBrowserName()||$WC.$CUtil.isIEVersion11()||(silent=!0,WebMessanger.showEmptyBar()),WebMessanger.registerAnnonUser||setTimeout(function(){WebMessanger.appendPhoneBridge()},1),WmsSettings.adminsettings.moduleconfig&&WmsSettings.adminsettings.moduleconfig.messaging.configs&&WmsSettings.adminsettings.moduleconfig.messaging.configs.message_translation&&(this.message_translation_source=WmsSettings.adminsettings.moduleconfig.messaging.configs.message_translation),WmsSettings.adminsettings&&WmsSettings.adminsettings.features&&WmsSettings.adminsettings.features.show_translate&&(this.show_translate=WmsSettings.adminsettings.features.show_translate),WmsSettings.adminsettings&&WmsSettings.adminsettings.emojiskintone&&WmsSettings.adminsettings.emoji_skintone_enabled&&(WmsSettings.adminsettings.showemojiskinpicker=!0,Smiley.isSkinToneSupported()||(WmsSettings.adminsettings.emojiskintone="0"),$WC.Config.set({emojiskintone:parseInt(WmsSettings.adminsettings.emojiskintone)})),_WMSEMPTYBAR)WMSUI.populateEmptyBar();else if(!1===this.chatenabled){!1===WebMessanger.isServiceStatus()?(WebMessanger.showEmptyBar(),WMSUI.populateEmptyBar()):silent=!0;try{WmsUIImpl.handleUIHidden()}catch(e){}}else-1!==$WC.Util.indexOf(this.deact,"ALL")||-1!==$WC.Util.indexOf(this.deact,WebMessanger.prd)||!1===WmsSettings.adminsettings.cliqaccess?(-1!==$WC.Util.indexOf(this.deact,"ALL")?(WebMessanger.allprdchatdeactivated=!0,WebMessanger.chatdeactivated=!1):-1!==$WC.Util.indexOf(this.deact,WebMessanger.prd)&&(WebMessanger.allprdchatdeactivated=!1,WebMessanger.chatdeactivated=!0),!1===WmsSettings.adminsettings.cliqaccess&&(WebMessanger.chatdisabled=!0),silent||WMSUI.populateDeactivatedChatUI()):(WebMessanger.chatdeactivated=!1,WebMessanger.allprdchatdeactivated=!1,WmsMainUI.maincontainer&&WmsMainUI.maincontainer.parentNode&&WmsMainUI.maincontainer.parentNode.removeChild(WmsMainUI.maincontainer),silent||(WMSUI.usersdiv=null,WMSUI.groupdiv=null,WMSUI.actchatdiv=null,WMSUI.populateMainBar(),WebMessanger.loadSalesIQJS()))},WmsSettings.updateWmsSettings=$WC.Util.debounce(function(e,t,s,i,n,a){"deact"===t?s?WebMessanger.UpdateWmsSettings(e,t,s,null,i,n,a):WebMessanger.UpdateWmsSettings(e,t,WebMessanger.prd,null,i,n,a):"disann"===t?WebMessanger.UpdateWmsSettings(e,t,wmsUserConfig.infomsgid,wmsUserConfig.infomsgprd):WebMessanger.UpdateWmsSettings(e,t,s)},null,500,!1),WmsSettings.handleUpdateWmsSettings=function(e){for(var t in e)if("sound"==t)this.sound=e[t],WmsMainUI.handleSettings(this.sound,WmsMainUI.settingscontainer.querySelector('[data-setting="sound"]'));else if("vmymessage"==t)this.vmymessage=e[t],WmsMainUI.handleSettings(this.vmymessage,WmsMainUI.settingscontainer.querySelector('[data-setting="vmymessage"]'));else if("vmention"==t)this.vmention=e[t],WmsMainUI.handleSettings(this.vmention,WmsMainUI.settingscontainer.querySelector('[data-setting="vmention"]'));else if("groupmessage_visual_notify"==t)this.groupmessage_visual_notify=e[t],WmsMainUI.handleSettings(this.groupmessage_visual_notify,WmsMainUI.settingscontainer.querySelector('[data-setting="groupmessage_visual_notify"]'));else if("botmessage_visual_notify"==t)this.botmessage_visual_notify=e[t],WmsMainUI.handleSettings(this.botmessage_visual_notify,WmsMainUI.settingscontainer.querySelector('[data-setting="botmessage_visual_notify"]'));else if("read_reciept"==t){this.read_receipt=e[t],this.adminsettings.user_read_receipt=e[t];var s=WebMessanger.isReadReceiptSettingEnabled()?"1":"0";WmsMainUI.handleSettings(s,WmsMainUI.settingscontainer.querySelector('[data-setting="read_receipt"]'))}else if("vustatus"==t)this.vustatus=e[t],WmsMainUI.handleSettings(this.vustatus,WmsMainUI.settingscontainer.querySelector('[data-setting="vustatus"]'));else if("show_translate_option"==t)this.show_translate=e[t],WmsMainUI.handleSettings(WmsSettings.show_translate,WmsMainUI.settingscontainer.querySelector('[data-setting="messagetranslation"]'));else if("cpinnedchats"==t)this.cpinnedchats=e[t];else if("cunreadchats"==t)this.cunreadchats=e[t];else if("crecentchats"==t)this.crecentchats=e[t];else if("primetime_onboard_count"==t)this.primetime_onboard_count=e[t];else if("scp"==t){this.scp=e[t];try{WMSUI.populateusrs(!1)}catch(e){}}else if("disann"===t)this.disann=e[t],WMSUI.isAnnBlocked()&&WMSUI.clearAnnBanner();else if("deact"===t)this.deact=e[t].split(","),-1!==$WC.Util.indexOf(this.deact,"ALL")||-1!==$WC.Util.indexOf(this.deact,WebMessanger.prd)?!1!==WebMessanger.chatdeactivated&&!1!==WebMessanger.allprdchatdeactivated||(-1!==$WC.Util.indexOf(this.deact,"ALL")?(WebMessanger.allprdchatdeactivated=!0,WebMessanger.chatdeactivated=!1):(WebMessanger.allprdchatdeactivated=!1,WebMessanger.chatdeactivated=!0),WebMessanger.turnOffChat(),WMSUI.populateDeactivatedChatUI(),_WMSCHATHIDDEN&&WebMessanger.hideChatBar()):!0!==WebMessanger.chatdeactivated&&!0!==WebMessanger.allprdchatdeactivated||!1!==WebMessanger.chatdisabled||(WebMessanger.chatdeactivated=!1,WebMessanger.allprdchatdeactivated=!1,WebMessanger.turnOnChat(),wmsnotifyowner&&wmsnotifyowner.clearOwnerSync(),WebMessanger.registerAnnonUser||(wmsnotifyowner=new $WC.NotificationOwner("chat",!0)),WMSUI.contactsenabled=!(WebMessanger.disabledmenus&WebMessanger.uisettingsconst.contacts),WMSUI.groupsenabled=!(WebMessanger.disabledmenus&WebMessanger.uisettingsconst.groups),WMSUI.activechatenabled=!(WebMessanger.disabledmenus&WebMessanger.uisettingsconst.activechats),WMSUI.profileenabled=!(WebMessanger.disabledmenus&WebMessanger.uisettingsconst.settings),WMSUI.smartchatenabled=!(WebMessanger.disabledmenus&WebMessanger.uisettingsconst.smartchat),WMSUI.populateMainBar(),_WMSCHATHIDDEN&&WebMessanger.hideChatBar());else if("salesiq_chatbar"===t)this.salesiq_chatbar=e[t],WebMessanger.loadSalesIQJS();else if("salesiq_chatbar_prdlist"===t)this.salesiq_chatbar_prdlist=e[t].split(","),WebMessanger.loadSalesIQJS();else if("hidden_chatlets_product"===t)WmsSettings.adminsettings.hidden_chatlets_product=e[t],silent||$WC.HybridSearch.populateRecentChats();else if("mymsgsoundnotify"===t)this.adminsettings.mymsgsoundnotify=e[t],WmsMainUI.handleSettings(this.adminsettings.mymsgsoundnotify,WmsMainUI.settingscontainer.querySelector('[data-setting="mymsgsoundnotify"]'));else if("mentionsoundnotify"===t)this.adminsettings.mentionsoundnotify=e[t],WmsMainUI.handleSettings(this.adminsettings.mentionsoundnotify,WmsMainUI.settingscontainer.querySelector('[data-setting="mentionsoundnotify"]'));else if("groupmessage_sound_notify"===t)this.adminsettings.groupmessage_sound_notify=e[t],WmsMainUI.handleSettings(this.adminsettings.groupmessage_sound_notify,WmsMainUI.settingscontainer.querySelector('[data-setting="groupmessage_sound_notify"]'));else if("botmessage_sound_notify"===t)this.adminsettings.botmessage_sound_notify=e[t],WmsMainUI.handleSettings(this.adminsettings.botmessage_sound_notify,WmsMainUI.settingscontainer.querySelector('[data-setting="botmessage_sound_notify"]'));else if("av_call_sound_notify"===t)this.adminsettings.av_call_sound_notify=e[t],WmsMainUI.handleSettings(this.adminsettings.av_call_sound_notify,WmsMainUI.settingscontainer.querySelector('[data-setting="av_call_sound_notify"]'));else if("screen_call_sound_notify"===t)this.adminsettings.screen_call_sound_notify=e[t],WmsMainUI.handleSettings(this.adminsettings.screen_call_sound_notify,WmsMainUI.settingscontainer.querySelector('[data-setting="screen_call_sound_notify"]'));else if("smymessage"===t)this.adminsettings.smymessage=e[t],WmsSound.loadNotificationTunes();else if("smention"===t)this.adminsettings.smention=e[t],WmsSound.loadNotificationTunes();else if("groupmessage_tone"===t)this.adminsettings.groupmessage_tone=e[t],WmsSound.loadNotificationTunes();else if("botmessage_tone"===t)this.adminsettings.botmessage_tone=e[t],WmsSound.loadNotificationTunes();else if("globalsoundnotify"===t){this.adminsettings.globalsoundnotify=e[t];var i=document.getElementById("wms_settings_soundnotification");WmsMainUI.handleSettings(this.adminsettings.globalsoundnotify,i.querySelector('[data-setting="globalsoundnotify"]')),$WC.Util.setAttribute(i.querySelector(".wms_settings_list"),"data-expanded","0"==e[t]?"false":"true")}else this[t]=e[t]},WmsSettings.isTourEnabled=function(){return 1==+WmsSettings.bsettings.tourenabled},WmsSettings.isOnboardSeen=function(){return(+WmsSettings.bsettings.wmstourprops&WmsSettings.constants.ONBOARD)===WmsSettings.constants.ONBOARD},WmsSettings.setOnboardSeen=function(){return+WmsSettings.bsettings.wmstourprops|WmsSettings.constants.ONBOARD},WmsSettings.getAdminSetting=function(e){return WmsSettings.adminsettings[e]},WmsSettings.handleTourSettings=function(e){WmsSettings.bsettings.wmstourprops=e,WmsSettings.isOnboardSeen()&&ChatTour.exit(!1)},WmsSettings.updateTourSettings=function(e,t){if(e===WmsSettings.constants.ONBOARD){var s=WmsSettings.setOnboardSeen();WebMessanger.updateTourSettings(s,t)}},WmsSettings.initModulesPermissions=function(){$WC.SecurityManager.init({direct_message:{status:"enabled"},audio_call:{status:"enabled"},video_call:{status:"enabled"},screen_sharing:{status:"enabled"},channels:{status:"enabled"},external_channels:{status:"enabled"},org_channels:{status:"enabled"},private_channels:{status:"enabled"},team_channels:{status:"enabled"},bots:{status:"enabled"},commands:{status:"enabled"}});var e={audio_call:WindowHandler.updateMediacallPermissions,video_call:WindowHandler.updateMediacallPermissions,screen_sharing:WindowHandler.updateMediacallPermissions,direct_message:$WC.HybridSearch.populateRecentChats,channels:WmsHybridSearch.populateGroupResultInMainUI,external_channels:WmsHybridSearch.populateGroupResultInMainUI,team_channels:WmsHybridSearch.populateGroupResultInMainUI,org_channels:WmsHybridSearch.populateGroupResultInMainUI,private_channels:WmsHybridSearch.populateGroupResultInMainUI,bots:WmsHybridSearch.populateContactListInMainUI};$WC.SecurityManager.registerCallbacks(e)},WmsSettings.restrictFileSharingForExternalUser=function(){return!!WebMessanger.isCliqUser()&&"false"==WmsSettings.adminsettings.orgPolicies.allow_external_orgusers_to_view_files},WmsSettings.showCustomEmojiOptions=function(){return!1},WmsDragDrop.onDropEvent=function(e,t,s,i){if(t.preventDefault(),i){var n=WmsDragDrop.dragged_file;if(!(n=n.getAttribute("data-filefrwrd")?n:n.closest("[data-msgid]").querySelector("[data-filefrwrd]")))return void(WmsDragDrop.dragged_file="");WmsFileForwardUI.handlePreview(n);var a={};a.chid=e;var o=WindowHandler.getWinObjById(e);if("8"==o.ctype)a.imagehtml=$WC.HybridSearch.generateImageHtml(e,$WC.WmsConstants.HYBRIDSEARCH.CHANNEL);else if("1"==o.ctype&&2<o.partcount)a.imagehtml=$WC.HybridSearch.generateImageHtml(e,$WC.WmsConstants.HYBRIDSEARCH.GROUP,{TITLE:o.title});else{var r=o.recipant||$WC.Bots.getBotId(e),l=WmsContacts.get(r);a.imagehtml=$WC.HybridSearch.generateImageHtml(r,$WC.WmsConstants.HYBRIDSEARCH.CONTACT,l)}return a.dname=o.title,a.type=o.ctype,WmsFileForwardUI.insertSuggestion("","",a),void document.getElementById("wms-fileupldcmt").focus()}var d=t.dataTransfer.files;WmsDragDrop.nooffiles=d.length,WmsDragDrop.pos=0;var c=WindowHandler.getWinObjById(e);if("5"!=c.ctype&&"true"!==c.editorreplydiv.getAttribute("data-editmsg")&&!c.permdenied)return!$WC.Util.isFilesizeExceeded(d)&&void(WmsFileUploadUI.checkSupport()&&d.length?WmsFileUploadUI.handlePreview(e,d):WmsDragDrop.uploadFile(e,d))},WmsDragDrop.uploadFile=function(s,e){var t={onprogress:function(e){var t=Math.round(e.loaded/e.total*100);WindowHandler.showProgress(s,t,WmsDragDrop.pos)},oncomplete:function(){},success:function(){WindowHandler.showProgress(s,100,WmsDragDrop.pos),WmsDragDrop.pos<WmsDragDrop.nooffiles?(WindowHandler.showProgress(s,0,WmsDragDrop.pos),WmsDragDrop.uploadFileUsingPost(s,e[WmsDragDrop.pos],t,e),WmsDragDrop.pos++):WindowHandler.clearProgress(s)}};WmsDragDrop.uploadFileUsingPost(s,e[WmsDragDrop.pos],t,e),WmsDragDrop.pos++},WmsDragDrop.uploadFileUsingPost=function(e,t,s,i){try{if(1e7<t.size)return alert($WC.I18N("You_have_exceeded_the_maximum_allowed_file_size_of_10MB")),WindowHandler.clearProgress(e),void(WmsDragDrop.nooffiles>WmsDragDrop.pos+1&&(WmsDragDrop.pos++,WmsDragDrop.uploadFileUsingPost(e,i[WmsDragDrop.pos],s,i)));var n=new XMLHttpRequest,a=["chid","username","sender","mod","sid",_CHATCFPARAMNAME],o=[e,WebMessanger.getUserName(),WebMessanger.getUserName(),"att",WebMessanger.getSid(),$WC.Cookie.get(_CHATCFTOKEN)];n.onreadystatechange=function(){if(4==n.readyState){var e=200==n.status?s.success:s.fail;e&&e(n.responseText)}},s.onprogress&&(n.addEventListener("progress",s.onprogress,!1),n.upload.addEventListener("progress",s.onprogress,!1)),s.oncomplete&&(n.addEventListener("load",s.oncomplete,!1),n.upload.addEventListener("load",s.oncomplete,!1));var r="/"+_CHATCONT+"/upload.do";if(n.open("POST",r,!0),"undefined"!=typeof FormData){for(var l=new FormData,d=0;d<a.length;d++)l.append(a[d],o[d]);return l.append("file1",t),n.send(l),n}var c=(new Date).getTime(),m="";m+="\r\n--"+c;var u,p="\r\n",h=t.fileName;u=u||[];for(var g=0;g<a.length;g++)u[u.length]=WmsDragDrop.getMultiPartParamObject(a[g],o[g]);for(g=0;g<u.length;g++){var f=u[g];p+=WmsDragDrop.getMultiPartParamStr(f.name,encodeURIComponent(f.value))+"\r\n--"+c+"\r\n"}return m+=p,null==(h=t.fileName)&&(h="file1"),m+='Content-Disposition: form-data; name="file1";filename="'+h+'"\r\nContent-Type:'+t.type+"\r\n\r\n"+t.getAsBinary(),m+="\r\n--"+c+"--",n.setRequestHeader("Content-Length",m.length),n.setRequestHeader("Content-Type","multipart/form-data; charset: UTF-8; accept-charset: UTF-8; boundary="+c),n.setRequestHeader("Connection","close"),n.sendAsBinary(m),n}catch(e){}},WmsDragDrop.getMultiPartParamStr=function(e,t){return'Content-Disposition: form-data; name="'+e+'"\r\n\r\n'+t},WmsDragDrop.getMultiPartParamObject=function(e,t){return{name:e,value:t}},WmsDragDrop.isFileSharable=function(){return!(WmsDragDrop.dragged_file&&!WmsDragDrop.dragged_file.getAttribute("data-filefrwrd")&&!WmsDragDrop.dragged_file.closest("[data-msgid]").querySelector("[data-filefrwrd]"))},PubSubApi.initialised=!1,PubSubApi.heartBeat=function(){for(var e in this.subinfo)try{PubSubApi.resubscribe(this.subinfo[e])}catch(e){}setTimeout(function(){PubSubApi.heartBeat()},3e4)},PubSubApi.init=function(){this.iframeObj=document.getElementById("psconnect"),this.uname="",this.wms_samedomain="",this.prdid="",this.userid="",this.sid="",this.nname="","function"==typeof WebMessanger?(this.uname=""!=WebMessanger.zuid?WebMessanger.zuid:WebMessanger.uname,this.wms_samedomain=_WMS_SAMEDOMAIN,this.prdid=WebMessanger.getPrd(),this.userid=WebMessanger.getUserId(),this.sid=WebMessanger.getSid(),this.nname=WebMessanger.getNickName(),this.staticdomain=WebMessanger.jsstaticdomain,this.staticversion=wmsjsversion):"function"==typeof WmsLite&&(this.uname=""!=WmsLite.zuid?WmsLite.zuid:WmsLite.uname,this.wms_samedomain=WM_SAMED,this.prdid=getPrd(),this.userid=getUserId(),this.sid=getSid(),this.nname=getNickName(),this.staticdomain=WmsLite.jsstaticdomain,this.staticversion=wmsjsversion),null==this.iframeObj?(this.iframeObj=document.createElement("iframe"),this.iframeObj.name="wmspsconnect",this.iframeObj.id="psconnect",this.iframeObj.style.display="none",this.iframeObj.src="/"+_WMSCONT+"/psconnect.sas?wmscont="+_WMSCONT+"&samedomain="+this.wms_samedomain+"&nodomainchange="+_WMS_NODOMAINCHANGE+"&uname="+this.uname+"&staticdomain="+this.staticdomain+"&staticversion="+this.staticversion,("function"==typeof WebMessanger&&WebMessanger.tokenpairauth||"function"==typeof WmsLite&&WmsLite.tokenpairauth)&&(this.iframeObj.src+="&tokenpair=true"),"function"==typeof WebMessanger&&WebMessanger.fp_hash&&(this.iframeObj.src+="&hash="+WebMessanger.fp_hash["psconnect.js"].split("_")[0]),_WMSZAID&&(this.iframeObj.src+="&zaid="+_WMSZAID),_WMSPOTYPE&&(this.iframeObj.src+="&potype="+_WMSPOTYPE),document.body.appendChild(this.iframeObj),!1===this.initialised&&(this.initialised=!0,this.subinfo={},this.psids={},setTimeout(function(){PubSubApi.heartBeat()},3e4))):PubSubImpl.onConnect()},PubSubApi.subscribe=function(e,t,s,i,n,a){var o="pskey="+e+"&prd="+this.prdid+"&wmsid="+this.userid+"&sid="+encodeURIComponent(this.sid)+"&config="+s+"&dname="+this.nname+"&opr=subscribe";null!=a&&null!=n&&(o=o+"&authtype="+n+"&authid="+a),"function"==typeof getZAID&&getZAID()&&(o+="&zaid="+getZAID());var r=[e,t,s,i,n,a];this.wms_samedomain?PubSubBridge.httpPost("subscribe","/pubsubsrv/"+t+"/pubsub",o,r):PubSubBridge.httpPost("subscribe","/"+t+"/pubsub",o,r)},PubSubApi.resubscribe=function(e){var t="pskey="+e.pskey+"&prd="+this.prdid+"&wmsid="+this.userid+"&sid="+encodeURIComponent(this.sid)+"&config="+e.config+"&dname="+this.nname+"&opr=resubscribe";null!=e.authid&&null!=e.authtype&&(t=t+"&authtype="+e.authtype+"&authid="+e.authid),"function"==typeof getZAID&&getZAID()&&(t+="&zaid="+getZAID());var s=[e.pskey];this.wms_samedomain?PubSubBridge.httpPost("resubscribe","/pubsubsrv/"+e.psuri+"/pubsub",t,s):PubSubBridge.httpPost("resubscribe","/"+e.psuri+"/pubsub",t,s)},PubSubApi.unSubscribe=function(e){if(PubSubApi.isSubscribed(e)){var t=PubSubApi.subinfo[e],s="pskey="+e+"&prd="+this.prdid+"&wmsid="+this.userid+"&sid="+encodeURIComponent(this.sid)+"&config="+t.config+"&dname="+this.nname+"&opr=unsubscribe";null!=t.authid&&null!=t.authtype&&(s=s+"&authtype="+t.authtype+"&authid="+t.authid),"function"==typeof getZAID&&getZAID()&&(s+="&zaid="+getZAID());var i=[e];this.wms_samedomain?PubSubBridge.httpPost("unsubscribe","/pubsubsrv/"+t.psuri+"/pubsub",s,i):PubSubBridge.httpPost("unsubscribe","/"+t.psuri+"/pubsub",s,i)}},PubSubApi.handleAuthFailure=function(e){PubSubBridge.httpPost("authfailure",e)},PubSubApi.getSubscribedList=function(){var e=new Array;for(var t in this.psids)e.push(t);return e},PubSubApi.isSubscribed=function(e){return null!=this.psids[e]},PubSubApi.getUsers=function(e){return PubSubApi.isSubscribed(e)?this.subinfo[e].getUsers():null},PubSubApi.isValidPSID=function(e,t){return this.psids[e]==t},PubSubApi.getPsid=function(e){return this.psids[e]},PubSubApi.ackSubscribe=function(e,t,s,i,n,a,o){var r=new PubSubObject(e,t,s,i,n,a);PubSubApi.subinfo[e]=r,PubSubApi.psids[e]=o},PubSubApi.ackUnSubscribe=function(e){delete PubSubApi.psids[e],delete PubSubApi.subinfo[e]},PubSubApi.ackResubscribe=function(e,t){PubSubApi.psids[e]!=t&&PubSubApi.subinfo[e].reInitUsers(),PubSubApi.psids[e]=t},PubSubApi.handleError=function(e,t){delete PubSubApi.psids[e],delete PubSubApi.subinfo[e]},PubSubApi.removeUsers=function(e,t,s){PubSubApi.isValidPSID(e,t)&&PubSubApi.subinfo[e].removeUsers(s)},PubSubApi.addUsers=function(e,t,s){PubSubApi.isValidPSID(e,t)&&PubSubApi.subinfo[e].addUsers(s)},PubSubBridge.onconnect=function(){PubSubImpl.onConnect()},PubSubBridge.handleHttpPost=function(e,t,s){try{if("subscribe"==e){var i=JSON.parse(t)[0];if(null!=i.errcode){var n=i.errcode;PubSubApi.handleError(i.pskey,n),PubSubImpl.handleError(e,i.pskey,n)}else PubSubApi.ackSubscribe(s[0],s[1],s[2],s[3],s[4],s[5],i.psid),PubSubImpl.handleSubscribe(s[0])}else"unsubscribe"==e?null!=(i=JSON.parse(t)[0]).errcode?(n=i.errcode,PubSubImpl.handleError(e,s[0],n)):(PubSubApi.ackUnSubscribe(s[0]),PubSubImpl.handleUnSubscribe(s[0])):"resubscribe"==e&&""!=t&&(null!=(i=JSON.parse(t)[0]).errcode?(n=i.errcode,PubSubApi.handleError(i.pskey,n),PubSubImpl.handleError(e,i.pskey,n)):PubSubApi.ackResubscribe(s[0],i.psid))}catch(e){}},WmsChatCache=function(){var t={},s=[];return{insert:function(e,t){},get:function(e){if(t[e])return t[e]},remove:function(e){if(this.isAvailable(e))return delete t[e],s.splice($WC.Util.indexOf(s,e),1),!0},removeAll:function(){t={},s=[]},isAvailable:function(e){return!!this.get(e)}}}(),WmsNotification.notifyNewMessage=function(e,t,s){if(!WebMessanger.is_custom_menu_opted){var i=e.sender,n=e.threadchatid||e.chid,a=WindowHandler.getWinObjById(n),o=a?a.getTitle():e.title,r=a?a.ctype:e.ctype;if((i!==WebMessanger.zuid||"9"===r)&&(a&&a.highlight(),s||wmsnotifyowner&&wmsnotifyowner.isOwner())){var l=WMSUI.getNotificationTitle(e)+" "+$WC.I18N("Says")+"...";"9"===r&&(l=o+" "+$WC.I18N("Says")+"..."),(WebMessanger.isExclusiveChat()||WebMessanger.isRTCChat()||WMSUI.isBarVisible())&&"3"!==WebMessanger.scode&&"5"!==WebMessanger.scode&&0==WebMessanger.isTitleBlinkDisabled&&ChatBlink.start(l)}if(3!=WebMessanger.scode&&5!=WebMessanger.scode&&(s||wmsnotifyowner&&wmsnotifyowner.isOwner())&&!$WC.Util.isLocalUser(i)){var d="",c="";c="1"===r?(d="true"===e.customgroup?WmsSound.constants.GROUPCHAT:WmsSound.constants.PERSONALCHAT,"true"===e.customgroup?WmsSettings.adminsettings.groupmessage_tone:WmsSettings.adminsettings.smymessage):"9"===r?(d=WmsSound.constants.BOTMESSAGE,WmsSettings.adminsettings.botmessage_tone):(d=WmsSound.constants.GROUPCHAT,WmsSettings.adminsettings.groupmessage_tone),e.meta&&e.meta.mentions&&e.meta.mentions[WebMessanger.zuid]&&WmsSound.isNotifyAllowed(WmsSound.constants.MENTION)&&(d=WmsSound.constants.MENTION,c=WmsSettings.adminsettings.smention),(t=WmsSound.notification_tunes[c])&&WmsSound.playTune(t,d)}WMSUI.checkAndNotifyMsg(e)}},WmsNotification.notifyNewCall=function(e,t,s,i,n,a){if(WMSUI.isBarVisible()&&"3"!==WebMessanger.scode&&"5"!==WebMessanger.scode&&wmsnotifyowner.isOwner()){var o=t==WMSUI.avCall.CALL_TYPE_VIDEO?"mediacall.incoming.video":t==WMSUI.avCall.CALL_TYPE_VOICE?"mediacall.incoming.audio":a,r=e?e+" "+$WC.I18N("mediacall.calling"):$WC.I18N(o);0==WebMessanger.isTitleBlinkDisabled&&ChatBlink.start(r),_WMSWINFOCUS||1!=WmsSettings.vmymessage||$WC.DesktopNotification.show({title:e||"",body:$WC.I18N(o),icon:n||WmsContacts.getUserPhoto(s),checkownership:wmsnotifyowner,requireInteraction:!0,duration:WMSUI.avCall.notification_close_timer,id:"call"})}},WMSUI.imgPreview={images:[],curimgpos:-1,init:function(e,t){var s=e.querySelectorAll('img[data-previewable="true"]:not([data-rich="true"]):not([data-originalsrc]) , div[data-unfurl="true"] , div[data-attachment="true"]');"true"===t.getAttribute("data-rich")&&(t=t.closest('[data-urlpreview="true"]').querySelector('div[data-unfurl="true"]')),WMSUI.imgPreview.getCurrentImgPosition(t,s),WMSUI.imgPreview.createOverlay(),WMSUI.imgPreview.bindevents();var i=e.getAttribute("data-chid");WMSUI.imgPreview.getAndReplaceImageDetails(WMSUI.imgPreview.images[WMSUI.imgPreview.curimgpos],i)},getAndReplaceImageDetails:function(e,t){var s=null!=e.getAttribute("data-fname")?decodeURIComponent(e.getAttribute("data-fname")):"",i=null!=e.getAttribute("data-fsize")?e.getAttribute("data-fsize"):"",n=e.getAttribute("data-fsender"),a=e.getAttribute("data-fdate"),o=e.getAttribute("data-ftime"),r=e.getAttribute("data-fcomment"),l=e.getAttribute("data-dname"),d=e.getAttribute("data-fcontent"),c=e.getAttribute("data-src")||e.getAttribute("data-furl"),m=e.getAttribute("data-customimg"),u="false"!==e.getAttribute("data-filefrwrd")&&!WebMessanger.isGuestUser(),p=e.getAttribute("data-isv1"),h=e.getAttribute("data-msguid"),g='<span id="wms-imgpreviewfdate">'+$WC.Util.escapeHTML(a)+'</span> | <span id="wms-imgpreviewftime">'+$WC.Util.escapeHTML(o)+"</span>";if(g+=i?' | <span id="wms-imgpreviewfsize">'+$WC.Util.escapeHTML(i)+"</span>":"",$WC.Util.isLocalUser(n))var f=$WC.I18N("Me");else f=$WC.Util.getContactName(n,l);var C=WMSUI.imgPreview.curimgpos+1,v=WMSUI.imgPreview.images.length,b=WMSUI.imgPreview.generateUI(),y="";if(e.getAttribute("originalsrc")?y=WMSUI.imgPreview.trimThumbnailImageUrl(e.getAttribute("originalsrc")):e.getAttribute("src")&&(y=WMSUI.imgPreview.trimThumbnailImageUrl(e.getAttribute("src"))),b+=m?"</div>":'<div id="wms-imgpreviewfinfo" class="wms-imgpreviewfinfo"><div id="wms-imgpreviewfname" class="wms-imgpreviewfname">{{FNAME}}</div><div class="wms-imgpreviewfdetails" id="wms-imgpreviewfdetails"></div></div></div>',b+=m?"":'<div id="wms-imgpreviewsenderinfo" class="wms-imgpreviewfsenderinfo"><div style="display:table-row"><div class="wms-imgpreviewuserinfo"><img src="{{SENDERPIC}}" class="wms-imgpreviewfsenderpic"><span id="wms-imgpreviewfsender" class="wms-imgpreviewfsender">{{FSENDERNAME}}</span><div id="wms-imgpreviewcomment" class="wms-imgpreviewcomment wms-truncate-ellipsis" title="{{COMMENT}}"><span id="wms-imgpreviewfcomment" class="wms-imgpreviewfcomment"></span></div></div><div id="wms-imgpreviewstatus" class="wms-imgpreviewstatus">{{IMGSTATUS}}</div><div class="wms-imgpreviewactions"><div class="wms-imgpreviewfdownload" data-fsize="{{FSIZE}}"><a id="wms-imgpreviewfdownload" data-documentclick="attdownload" target="_blank" href="{{IMGSRC}}" download="{{FNAME}}"></a></div>',b+=s&&u?'<span class="wms-fileforwardimg" data-msguid="{{MSGUID}}" data-chid="{{CHID}}" data-fcomment="{{COMMENT}}" data-fcontent="{{CONTENT}}" data-furl="{{URL}}" data-fname="{{FNAME}}" data-fsrc="{{IMGSRC}}" data-purpose="forward" data-isv1={{ISV1}} title="Forward"></span></div></div></div>':"</div></div></div>",b+='<span class="wms-imgpreviewclose" data-purpose="close"></span>',b=$WC.template.replace(b,{FNAME:s,FSIZE:i,FDATE:a,FTIME:o,COMMENT:r,$IMGSTATUS:["chat.imgpreview.status",[C,v]],FSENDERNAME:f,IMGSRC:y,SENDERPIC:$WC.WmsContacts.getUserPhoto(n),CONTENT:d,URL:WMSUI.imgPreview.trimThumbnailImageUrl(c),ISV1:p,CHID:t,MSGUID:h}),document.getElementById("wms-imgpreviewcontainer").innerHTML=b,document.getElementById("wms-imgpreviewfdetails")&&(document.getElementById("wms-imgpreviewfdetails").innerHTML=g),r){document.getElementById("wms-imgpreviewfsender").style.margin="0px 0px 0px 15px",document.getElementById("wms-imgpreviewcomment").style.display="block";r=$WC.Matcher.replacer(/<span .*?>(.*?)<\/span>/gi,null,r,function(e,t){return t}),document.getElementById("wms-imgpreviewfcomment").insertAdjacentHTML("beforeend",$WC.Markdown.apply($WC.Util.safeHTML($WC.Util.unescapeHTML(r))))}1===v?(document.getElementById("wms-imgpreviewright").style.cursor="not-allowed",document.getElementById("wms-imgpreviewnext").style.display="none",document.getElementById("wms-imgpreviewprev").style.display="none",document.getElementById("wms-imgpreviewleft").style.cursor="not-allowed"):1===C?(document.getElementById("wms-imgpreviewleft").style.cursor="not-allowed",document.getElementById("wms-imgpreviewprev").style.display="none"):C===v&&(document.getElementById("wms-imgpreviewright").style.cursor="not-allowed",document.getElementById("wms-imgpreviewnext").style.display="none"),WMSUI.imgPreview.resize()},bindevents:function(){document.getElementById("wms-imgpreviewcontainer").addEventListener("click",function(e){var t=e.target.getAttribute("data-purpose");"close"==t?WMSUI.imgPreview.removeOverlay():"nextimg"==t?WMSUI.imgPreview.next():"previmg"==t?WMSUI.imgPreview.prev():"forward"==t?(WMSUI.imgPreview.removeOverlay(),WmsFileForwardUI.handlePreview(e.target)):"startchat"==t&&(WMSUI.imgPreview.removeOverlay(),WmsHybridSearch.parseAndOpenChat(e.target))})},trimThumbnailImageUrl:function(e){var t=e,s=t.split("&"),i=t.split("/");if(WebMessanger.isGuestUser()&&-1!==e.indexOf("thumbnail")){var n="thumbnail?guest_id="+WebMessanger.guest_info.encrypt_id;i.splice(i.indexOf(n),1),t=i.join("/"),t+="?guest_id="+WebMessanger.guest_info.encrypt_id}else-1!==s.indexOf("x-cli-msg="+encodeURIComponent("{thumbnail:true}"))?(s.splice(s.indexOf("x-cli-msg="+encodeURIComponent("{thumbnail:true}")),1),t=s.join("&")):-1!==i.indexOf("thumbnail")&&(i.splice(i.indexOf("thumbnail"),1),t=i.join("/"));return t},removeLoadingDiv:function(){var e=document.getElementById("wms_contactdetails_loadingdiv")||document.getElementById("wms_imagepreview_loadingdiv");e&&(e.style.display="none",e.className+=" wms-fadeOut")},cloneImgElement:function(e){var t=e.cloneNode(),s=e.getAttribute("originalsrc"),i=e.getAttribute("src"),n=e.getAttribute("style");return t.setAttribute("tempsrc",i),t.setAttribute("style","background:transparent"),(s=s?WMSUI.imgPreview.trimThumbnailImageUrl(s):WMSUI.imgPreview.trimThumbnailImageUrl(i))&&(t.style.visibility="hidden",t.src=s,t.onload=function(){WMSUI.imgPreview.removeLoadingDiv(),t.style.visibility="visible",this.removeAttribute("originalsrc"),WMSUI.loadedimg[s]=!0},t.onerror=function(){e.src=i,e.setAttribute("style",n),e.setAttribute("class","wms-hvalign wms-blurfilter"),e.setAttribute("originalsrc",s),e.setAttribute("class","wms-hvalign wms-blurfilter")}),t.removeAttribute("class"),t.setAttribute("id","wms-imgpreview"+WMSUI.imgPreview.curimgpos),t.setAttribute("width",e.getAttribute("data-fwidth")+"px"),t.setAttribute("height",e.getAttribute("data-fheight")+"px"),t},createOverlay:function(){if(null==document.getElementById("wms-imgpreviewcontainer")){var e=WebMessanger.isDarkModeEnabled?"wms-imgpreviewcontainer zmNightMode":"wms-imgpreviewcontainer";e+=WebMessanger.isDNDBackupIconEnabled()?" wms_dnd_backup_icon":"";var t=$WC.Util.createElement("div","wms-imgpreviewcontainer",e);t.style.zIndex=$WC.Config.get("zindex"),document.body.appendChild(t)}if(null==document.getElementById("wms-imgoverlay")){var s=$WC.Util.createElement("div","wms-imgoverlay","wms-imgoverlay");s.style.zIndex=$WC.Config.get("zindex"),document.body.insertBefore(s,document.getElementById("wms-imgpreviewcontainer"))}},generateUI:function(){return'<div id="wms-imgpreviewleft" class="wms-imgpreviewleft" data-purpose="previmg"></div><div id="wms-imgpreviewright" class="wms-imgpreviewright" data-purpose="nextimg"></div><div id="wms-imgpreviewnext" data-purpose="nextimg" class="wms-imgpreviewnext wms-valign-mid-block"><span class="wms-imgnext" data-purpose="nextimg"></span></div><div id="wms-imgpreviewprev" data-purpose="previmg" class="wms-imgpreviewprev wms-valign-mid-block"><span class="wms-imgprev" data-purpose="previmg"></span></div><div id="wms-imgpreviewholder" class="wms-imgpreviewholder"><div id="wms-imgpreviewlist" class="wms-imgpreviewlist"></div>'},resize:function(){var s,e=document.getElementById("wms-imgpreviewnext"),t=document.getElementById("wms-imgpreviewprev");if(e&&t)if(document.getElementById("wms-imgpreview"+WMSUI.imgPreview.curimgpos))s=document.getElementById("wms-imgpreview"+WMSUI.imgPreview.curimgpos);else{var i=(s=WMSUI.imgPreview.images[WMSUI.imgPreview.curimgpos]).getAttribute("data-fname")&&s.getAttribute("data-fname").split(".")[s.getAttribute("data-fname").split(".").length-1];if("true"===s.getAttribute("data-attachment")&&$WC.UrlPreview.isFileSupportedByCliq(s.getAttribute("data-fcontent"),i)){var n=function(){WMSUI.imgPreview.removeLoadingDiv(),document.getElementById("wms-imgpreviewfinfo").style.display="block",WMSUI.imgPreview.images[WMSUI.imgPreview.curimgpos].removeAttribute("src"),WMSUI.imgPreview.images[WMSUI.imgPreview.curimgpos].setAttribute("data-nopreview","true"),s=WMSUI.imgPreview.images[WMSUI.imgPreview.curimgpos],WMSUI.imgPreview.populateUI(s)};document.getElementById("wms-imgpreviewcontainer").insertAdjacentHTML("beforeend",'<span id="wms_imagepreview_loadingdiv" class="wms-hvalign wms_imagepreview_loadingdiv"></span>'),document.getElementById("wms-imgpreviewfinfo").style.display="none",$WC.Ajax.requestToChat("v1/attachments/"+s.getAttribute("data-fsrc")+"/preview","",function(e){if(200===(e=JSON.parse(e)).code){document.getElementById("wms-imgpreviewfinfo").style.display="block",WMSUI.imgPreview.removeLoadingDiv();var t=e.data.response;WMSUI.imgPreview.images[WMSUI.imgPreview.curimgpos].setAttribute("src",t),s=WMSUI.imgPreview.cloneImgElement(WMSUI.imgPreview.images[WMSUI.imgPreview.curimgpos]),WMSUI.imgPreview.populateUI(s)}else n()},n)}else s=WMSUI.imgPreview.cloneImgElement(WMSUI.imgPreview.images[WMSUI.imgPreview.curimgpos]),WMSUI.imgPreview.populateUI(s)}},getCurrentImgPosition:function(e,t){for(var s=0;s<t.length;s++)t[s+1]&&t[s+1].getAttribute("data-furl")==t[s].getAttribute("data-furl")&&t[s].getAttribute("src")&&t[s].getAttribute("src").startsWith("data:image")?e=t[s]===e?t[s+1]:e:(t[s].getAttribute("data-unfurl")||t[s].getAttribute("data-attachment")?WMSUI.imgPreview.images.push(WMSUI.imgPreview.getIframeNode(t[s])):WMSUI.imgPreview.images.push(t[s]),t[s]===e&&(WMSUI.imgPreview.curimgpos=WMSUI.imgPreview.images.length-1))},next:function(){WMSUI.imgPreview.curimgpos+1<WMSUI.imgPreview.images.length&&(WMSUI.imgPreview.curimgpos++,WMSUI.imgPreview.getAndReplaceImageDetails(WMSUI.imgPreview.images[WMSUI.imgPreview.curimgpos]))},prev:function(){0<WMSUI.imgPreview.curimgpos&&(WMSUI.imgPreview.curimgpos--,WMSUI.imgPreview.getAndReplaceImageDetails(WMSUI.imgPreview.images[WMSUI.imgPreview.curimgpos]))},populateUI:function(e){var t=window.innerWidth,s=window.innerHeight;document.getElementById("wms-imgpreviewsenderinfo")&&(s-=document.getElementById("wms-imgpreviewsenderinfo").clientHeight),document.getElementById("wms-imgpreviewfinfo")&&(s-=document.getElementById("wms-imgpreviewfinfo").clientHeight),"IFRAME"!=e.nodeName&&"wms-nopreview"!=e.getAttribute("id")||(e.height=.8*window.innerHeight,e.width=.8*window.innerWidth);var i=e.width,n=e.height,a=400,o=300,r=0,l=0,d=document.getElementById("wms-imgpreviewholder");if(t<i||s<n){var c=[t/i,s/n];(c=Math.min(c[0],c[1]))<1&&(i*=c,n*=c)}var m=s/2-(o=n)/2,u=t/2-(a=i)/2;(i<400||n<300)&&(i<400&&(a=400),n<300&&(o=300),r=m,l=u,m=s/2-o/2,u=t/2-a/2),d.style.top=m+"px",d.style.left=u+"px",d.style.width=a+"px",d.style.height=o+"px",0==r&&0==l||(r-=m,l-=u),e.style.top=r+"px",e.style.left=l+"px",e.style.width=i+"px",e.style.height=n+"px",e.style.position="absolute",document.getElementById("wms-imgpreviewlist").appendChild(e),"true"===e.getAttribute("data-nopreview")&&"IFRAME"==e.nodeName&&(document.getElementById("wms-imgpreviewlist").querySelector('[data-nopreview="true"]').contentWindow.document.body.innerHTML='<div id="wms-nopreview" style=" display: flex;align-items: center;justify-content: center;background-color: #141414;border: 6px solid #fff;border-bottom: none;color: #fff;font-size: 20px;box-sizing: border-box;height:100%;width:100%;">'+$WC.I18N("chat.nopreview")+"</div>"),"true"===e.getAttribute("data-nopreview")||WMSUI.isLoadedImg(e.getAttribute("src"))||document.getElementById("wms-imgpreviewlist").insertAdjacentHTML("beforeend",'<span id="wms_contactdetails_loadingdiv" class="wms-hvalign wms_loading_div"></span>')},removeOverlay:function(){var e=document.getElementById("wms-imgoverlay"),t=document.getElementById("wms-imgpreviewcontainer");e&&t&&(document.body.removeChild(e),document.body.removeChild(t)),WMSUI.imgPreview.images.length&&(WMSUI.imgPreview.images.length=0)},handleKeyMovement:function(e){if(null!==document.getElementById("wms-imgoverlay")){var t=$WC.Util.getEventTarget(e);if("TEXTAREA"==t.nodeName||"text"==t.type||"wms-filefrwrdrecipant"===t.id)return!0;var s=window.event?e.keyCode:e.which;return 39==s?WMSUI.imgPreview.next():37==s?WMSUI.imgPreview.prev():27==s&&WMSUI.imgPreview.removeOverlay(),!0}},getIframeNode:function(e){var t=document.createElement("div");t.innerHTML=e.getAttribute("src");var s={};return"true"===e.getAttribute("data-attachment")?(s["data-fcontent"]=e.getAttribute("data-fcontent"),s["data-attachment"]=e.getAttribute("data-attachment"),s["data-fsrc"]=e.getAttribute("data-fsrc"),s["data-furl"]=e.getAttribute("data-furl"),s["data-filefrwrd"]=e.getAttribute("data-filefwd"),s["data-isv1"]=e.getAttribute("data-isv1")):(s["data-fsrc"]=t.childNodes[0].src,s["data-furl"]=t.childNodes[0].src,s.sandbox="allow-scripts allow-same-origin"),s.src=t.childNodes[0].src,s["data-fname"]=e.getAttribute("data-fname"),s["data-ftime"]=e.getAttribute("data-ftime"),s["data-fdate"]=e.getAttribute("data-fdate"),s["data-fsender"]=e.getAttribute("data-fsender"),s["data-dname"]=e.getAttribute("data-dname"),s.frameBorder="0",-1<s.src.indexOf("frameorigin=")&&-1==s.src.indexOf(window.location.host)&&(s.src=s.src.replace("frameorigin=","frameorigin="+window.location.origin+",")),$WC.Util.createElement("iframe","wms-url-preview",null,s)}};var WmsFileUploadHandler={live_file_uploads:{},islivefupExist:function(e){return this.live_file_uploads.hasOwnProperty(e)},getLivefupObj:function(e){return this.live_file_uploads[e]},handleAckReceived:function(e,t){this.islivefupExist(e)&&this.getLivefupObj(e).handleAckReceived(t)},addToPendingFilesList:function(e,t){this.islivefupExist(t.chat_id)&&(this.getLivefupObj(t.chat_id).pendingfiles[e]=t)},setReplyMsgId:function(e,t,s){var i=this.live_file_uploads[e];i&&i.filesdetails[s]&&(i.filesdetails[s].replyMsgUid=t)},setThreadMsgId:function(e,t,s){var i=this.live_file_uploads[e];i&&i.filesdetails[s]&&(i.filesdetails[s].threadMsgId=t)},addFileForUpload:function(e,t,s,i,n,a){return this.islivefupExist(e)||(this.live_file_uploads[e]=new WmsFileUpload(e)),this.getLivefupObj(e).addFileForUpload(t,s,i,n,a)},startNextFileUpload:function(e,t){this.startFileUpload(e,t)},startFileUpload:function(e,t){if(this.islivefupExist(e)){var s=this.getLivefupObj(e);if(1==Object.keys(s.filesdetails).length){var i=WindowHandler.getWinObjById(e);i.composer.value="",i.invisiblediv.innerHTML="",$WC.WmsSessionStorage.setChatInfo({chid:e,text:""}),i.changeFooterHeight()}if(!s.isAlreadyInProgress()){var n=function(e){for(var t=Object.keys(e),s=0;s<t.length;s++)if(!e[t[s]].error)return t[s];return""}(s.filesdetails);if(!n)return;this.doPost(e,n,t),WmsFileUploadUI.toggleCancelButton(e,n)}}},trimFileName:function(e,t){if(e.length>t){var s=e.lastIndexOf("."),i=0<s?e.substring(s):"";i=i.length>t/2?i.substring(0,t/2):i,e=(e=0<s?e.substring(0,s):e).substring(0,t-(i.length+1))+i}return e},doPost:function(t,s,i){var n=i.progresscallback,a=i.successcallback,o=i.errorcallback,e=this.getLivefupObj(t),r=e.getFileDetails(s),l=(new Date).getTime();0==e.uploaded&&(e.startingtime=(new Date).getTime());var d=s.substring(s.lastIndexOf("."),s.length),c=d?s.substring(0,s.lastIndexOf("."))+d.split("_")[0]:s,m=this.trimFileName($WC.Matcher.replace("invalidfilenamechars",c,"-"),WmsFileUploadUI.MAX_ALLOWED_FILE_NAME_LENGTH),u=WebMessanger.isUDSUploadEnabled(),p=new XMLHttpRequest,h="/"+_CHATCONT+"/v1/attachments";if(p.upload.addEventListener("progress",function(e){if("function"==typeof n)return n(e,t,s)},t),p.onreadystatechange=function(){if(4==p.readyState)if(200==p.status||204==p.status)WmsFileUploadHandler.cleanUpFileUpload(t,i,s,!0),"function"==typeof a&&a(t,s,p),this.startNextFileUpload(t,i);else{(e=p)&&!(e.getResponseHeader("x-error")||"abort"===e.statusText||400<=e.status&&e.status<500)&&"function"==typeof o?(this.markAsError(t,s),o(t,s)):this.cleanUpFileUpload(t,i,s),this.startNextFileUpload(t,i)}var e}.bind(this),u){h=_UPLOADSERVERURL+"/webupload",p.open("POST",h,!0),p.withCredentials=!0;var g={"upload-id":t,"x-service":WebMessanger.isRTCChat()?_UDS_RTC_SERVICE:_UDS_CLIQ_SERVICE,"x-cliq-sid":WebMessanger.sid,"x-dfs-service":WebMessanger.isRTCChat()?"wms":"zfs",charset:"UTF-8","x-streammode":"1","x-cliq-content-type":encodeURIComponent(r.fileobj.type),"file-name":encodeURIComponent(m),"Content-type":encodeURIComponent(r.fileobj.type)};for(var f in g)p.setRequestHeader(f,g[f]);WebMessanger.isRTCChat()&&$WC.Cookie.get("x-client-access-token")&&p.setRequestHeader("x-client-access-token",encodeURIComponent($WC.Cookie.get("x-client-access-token"))),r.comment&&p.setRequestHeader("x-cliq-comment",encodeURIComponent(r.comment)),r.replyMsgUid&&p.setRequestHeader("x-cliq-replyto",r.replyMsgUid),r.threadMsgId&&p.setRequestHeader("x-cliq-thread_message_id",r.threadMsgId),r.postmsg_in_parent&&p.setRequestHeader("x-cliq-post_in_parent",r.postmsg_in_parent)}else if(WebMessanger.isGuestUser())h="/"+_CHATCONT+"/guestapi/v2/chats/"+t+"/files",p.open("POST",h,!0);else{if(r.comment){var C={};C[1]=r.comment,r.comment=C}p.open("POST",h,!0)}p.setRequestHeader("X-XHR-exception","true"),p.setRequestHeader("X-ZCSRF-TOKEN",$WC.Util.getCSRF()),r.startingtime=(new Date).getTime(),(r.req=p).opts=r;var v=p.opts.fileobj;if(p.opts.id=l,p.opts.comment=r.comment,WebMessanger.isGuestUser()){var b={id:l,sid:WebMessanger.getSid(),guest_id:WebMessanger.guest_info.encrypt_id,zchat_csrparam:$WC.Util.getCSRF().split("=")[1]};if(p.setRequestHeader("x-cliq-guid",WebMessanger.guest_info.encrypt_id),p.opts.comment&&(b.comments=JSON.stringify([p.opts.comment])),"undefined"!=typeof FormData){for(var y in v=new FormData,b)v.append(y,b[y]);v.append("files",p.opts.fileobj)}}else u?p.setRequestHeader("x-cliq-msgid",l):(v=e.getFormData(t,l,s),p.opts.comment?(v.append("comment",JSON.stringify(p.opts.comment)),v.append("files",p.opts.fileobj,"1_"+p.opts.fileobj.name)):v.append("files",p.opts.fileobj));p.send(v),WmsFileUploadHandler.addToPendingFilesList(r.id,{chat_id:t,callbackobj:i,filename:s});var _=WindowHandler.getWinObjById(t);_&&_.closeReplyPreview(),WMSUI.imgPreview.removeOverlay(),WindowHandler.getWinObjById(t).composer.focus()},markAsError:function(e,t){this.islivefupExist(e)&&this.getLivefupObj(e).markAsError(t)},cleanUpFileUpload:function(e,t,s,i){var n,a=!this.islivefupExist(e)||$WC.Util.isEmpty(s);a||!this.islivefupExist(e)||$WC.Util.isEmpty(s)||(n=this.getLivefupObj(e)).removeFileFromUpload(s,i),!a&&0!=n.getRemainingFilesCount()||($WC.Util.isEmpty(t)||"function"!=typeof t.oncompletecallback||t.oncompletecallback(e,null,!0),this.islivefupExist(e)&&((n=this.getLivefupObj(e)).removeFileFromUpload(),delete this.live_file_uploads[e]))},getFailFilesCount:function(e){if(this.islivefupExist(e))return this.getLivefupObj(e).getFailedFilesCount()},resendFile:function(e,t,s,i){this.islivefupExist(e)&&t&&(this.getLivefupObj(e).markForResend(t),this.startFileUpload(e,s,i))}},WmsFileUpload=function(e){this.chid=e,this.uploadedfilecount=0,this.filesdetails={},this.total=0,this.uploaded=0,this.startingtime=(new Date).getTime(),this.failfilecount=0,this.pendingfiles={}};WmsFileUpload.prototype={getTotalFileCount:function(){return this.uploadedfilecount+$WC.Util.getObjectLength(this.filesdetails)},getSharingFilesCount:function(){var e=this.uploadedfilecount+1,t=this.getTotalFileCount();return t<e?t:e},getRemainingFilesCount:function(){return $WC.Util.getObjectLength(this.filesdetails)},getPendingFilesCount:function(){var e=0;for(var t in this.pendingfiles)this.pendingfiles[t].isuploaded&&e++;return e},getFileDetails:function(e){return e?this.filesdetails[e]:this.filesdetails},getFailedFilesCount:function(){return this.failfilecount},isReplyMessage:function(e){return this.filesdetails[e]&&this.filesdetails[e].replyMsgUid},getReplyMsgId:function(e){return this.filesdetails[e].replyMsgUid},addFileForUpload:function(e,t,s,i,n){var a=this.getTotalFileCount(),o=i;if(!o){var r=e.type,l=r.substring(r.indexOf("/")+1,r.length);o=$WC.I18N("chat.file.upload")+$WC.DateUtil.formatTime(new Date)+"."+l,e.name=o}return o=o+"_"+a+"_"+$WC.DateUtil.formatTime(new Date),void 0===this.filesdetails[o]&&(this.filesdetails[o]=[],this.filesdetails[o].fileobj=e,this.filesdetails[o].comment=t,this.filesdetails[o].atmentions=s,this.filesdetails[o].fname=i,this.filesdetails[o].uploaded=0,this.filesdetails[o].total=e.size,this.filesdetails[o].startingtime=(new Date).getTime(),this.filesdetails[o].req=null,this.filesdetails[o].progressing=!1,this.filesdetails[o].error=!1,this.filesdetails[o].postmsg_in_parent=n,this.total=this.total+e.size),o},isAlreadyInProgress:function(){for(var e in this.filesdetails)if(null!==this.filesdetails[e].req)return!0;return!1},markAsError:function(e){var t=this.filesdetails;if(e&&!$WC.Util.isEmptyObject(t)&&void 0!==t[e]){var s=t[e];this.uploaded-=s.uploaded,s.req=null,s.error=!0,this.failfilecount++}},removeFileFromUpload:function(e,t){var s=this.filesdetails;if(e){if(!$WC.Util.isEmptyObject(s)&&void 0!==s[e]){var i=s[e].req,n=s[e].fileobj.size-s[e].uploaded;null===i||t||0===i.status&&"abort"===i.statusText||s[e].req.abort(),this.uploadedfilecount+=t?1:0,this.failfilecount-=s[e].error?1:0,this.uploaded=this.uploaded+(0<n?n:0),delete this.filesdetails[e]}}else{var a={};for(var o in this.failfilecount=0,s)void 0!==s[o]&&null!==s[o].req?a[o]=s[o]:delete this.filesdetails[o];for(var r in a)a[r].req.abort(),delete this.filesdetails[r]}},markForResend:function(e){var t=this.filesdetails;e&&!$WC.Util.isEmptyObject(t)&&t[e]&&t[e].error&&(t[e].error=!1,t[e].uploaded=0,this.failfilecount--)},updateProgressDetails:function(e,t){t>this.filesdetails[e].uploaded&&(this.uploaded=this.uploaded+(t-this.filesdetails[e].uploaded),this.filesdetails[e].uploaded=t)},getFormData:function(e,t,s){var i={id:e,sid:WebMessanger.getSid()};1===this.getTotalFileCount()&&t&&(i.msgid=t);var n=this.getReplyMsgId(s);if(n&&(i.replyto=n),"undefined"!=typeof FormData){var a=new FormData;for(var o in i)a.append(o,i[o]);return a}},handleAckReceived:function(e){if(this.pendingfiles[e]){var t=this.pendingfiles[e],s=t.chat_id,i=t.filename;delete this.pendingfiles[e],WmsFileUploadUI.cleanUpFileUpload(s,t.callbackobj,i,!0,!1)}}};var WmsFileUploadUI={zomojicomponent:new $WC.ZomojiComponent,zomojicomponentvisible:!1,autocompletepickervisible:!1,chidvsfiles:{},filedetails:[],MAX_ALLOWED_FILE_SIZE:52428800,MAX_ALLOWED_FILE_NAME_LENGTH:100,FILE_EXTENSION:["plain","quicktime","javascript","x-sh"],handlePreview:function(e,t){this.validateInput(e,t)&&(WMSUI.imgPreview.createOverlay(),this.showPreview(e,t))},validateInput:function(e,t){return!$WC.Util.isFile(t[0])||!$WC.Util.isFilesizeExceeded(t,WebMessanger.getFileUploadLimit()||WmsFileUploadUI.MAX_ALLOWED_FILE_SIZE)||(this.resetForm(e),!1)},resetForm:function(e){delete this.chidvsfiles[e],this.filedetails=[],WindowHandler.getWinObjById(e)&&document.getElementById(e).querySelector("#formsend").reset();this.listcommon="",WMSUI.atMentions.autocompletediv="",WMSUI.atMentions.invisiblediv=""},showPreview:function(e,t){$WC.Util.isEmpty(this.chidvsfiles[e])||(t=this.chidvsfiles[e].concat(Array.prototype.slice.call(t)));var s=document.getElementById("wms-fileupldcmt");if(s){var i=parseInt(s.getAttribute("data-fileindex"));this.storeComments(i,s,e)}var n=1==t.length?"wms-fileupldwinbody1":"wms-fileupldwinbody",a=1==t.length?"style=display:none":"",o=this.getFileUploadWindowHTML();o=$WC.template.replace(o,{$SHAREINFO:["share.file.user",$WC.Util.unescapeHTML(WindowHandler.getWinObjById(e).title)],PREVIEWCLASS:n,CHID:e,UPLOADCHID:"uploads"+e,FILESLIST_HOLDER:a}),document.getElementById("wms-imgpreviewcontainer").innerHTML=o,$WC.Button.mountComponent(document.getElementById("wms_fileshare_button"),"button","12",$WC.I18N("file.upload.share"),"","wms_fileupld_share",$WC.I18N("file.upload.share"),this.uploadFile.bind(this,e)),$WC.Button.mountComponent(document.getElementById("wms_filecancel_button"),"button","12",$WC.I18N("common.cancel"),"","wms_fileupld_cancel",$WC.I18N("common.cancel"),this.cancelFileUpload.bind(this,e));var r=this.fillFileDetails(e,t);r=$WC.template.replace(r,{STYLE:a}),document.getElementById("wms-fileupldcontainer").insertAdjacentHTML("beforeend",r);var l=document.getElementById("wms-fileupldpreview0");this.setPreview(l,t[t.length-1],t.length-1),s=document.getElementById("wms-fileupldcmt");var d=WindowHandler.getWinObjById(e);if(1==t.length)this.storeComments(0,d.composer,e);else{document.getElementById("wms_fileslistholder").innerHTML=this.getMiniFilesPreview(t);for(var c=0;c<t.length;c++){var m=document.getElementById("wms_filespreview"+c);this.setMiniPreview(m,t[c])}}this.bindEvents(e),this.chidvsfiles[e]=Array.prototype.slice.call(t),this.fillComments(0,s,e),this.updateCommentCount(s)},setMiniPreview:function(s,e){var t=e.name.split("."),i=t[t.length-1];if(!i&&e.type&&-1==this.FILE_EXTENSION.indexOf(e.type.split("/")[1])&&(i=e.type.split("/")[1]),i="."+i,$WC.Matcher.check("imagemimetype",e.type)){var n=new FileReader;n.onload=function(e){var t='<img src="'+e.target.result+'">';s.insertAdjacentHTML("beforeend",t)},n.readAsDataURL(e)}else s.insertAdjacentHTML("beforeend",'<div class="wms-fileimgpreview_mini"><div class="wms_fileextn_mini">'+i+"</div></div>")},getMiniFilesPreview:function(e){for(var t="",s=0;s<e.length;s++){var i='<div class="'+(s==e.length-1?"wms_fileslist_wrappersel":"wms_fileslist_wrapper")+'"><div data-purpose="preview" data-fileindex={{index}} id="wms_filespreview{{index}}" class="wms_fileslist"><div data-purpose="close" class="wms_fileslist_close"></div></div></div>';t+=$WC.template.replace(i,{index:s})}return t},getFileUploadWindowHTML:function(){return'<div id="wms-fileupldwin" class="wms-fileupldwin wms-hvalign"><div id="wms-fileupldwinheader" class="wms-fileupldwinheader">{{SHAREINFO}}<span class="wms-fileupldclose" data-purpose="cancel"></span></div><div id="wms-fileupldwinbody" class="{{PREVIEWCLASS}}"><div id="wms-filefrwrderrormsg" class="wms-fileuploaderror"></div><div id="wms-fileupldcontainer" class="wms-fileupldcontainer1"><div id="wms_fileslistholder" class="wms_fileslistholder" {{FILESLIST_HOLDER}}></div></div><div class="wms-fileupldactions" id="wms_fileupldactions"><div class="wms_addfiles_wrapper"><div class="wms_addfiles" id="wms_addfiles">'+$WC.I18N("upload.add.files")+'</div><form type="html5" name="{{UPLOADCHID}}" enctype="multipart/form-data" class="wms_cw_actualfile" chid="{{CHID}}" id="formsend" title="Add files"><input name="file2" data-purpose="addfiles" id="wms-file1" tabindex="0" type="file" multiple size="30"></form></div><div class="wms_fileupld_button"><div data-purpose="upload" id="wms_fileshare_button"></div><div data-purpose="cancel" id="wms_filecancel_button"></div></div></div></div></div>'},fillFileDetails:function(e,t){var s,i="",n="",a=WindowHandler.getWinObjById(e).salesiqchat?" wms_filecomment_hide":"";i=this.getFileHTML(e);var o=(s=(s=t[0].name&&this.validateAndReplaceFilename("replace",t[0].name))||$WC.I18N("chat.file.upload")+$WC.DateUtil.formatTime(new Date)).lastIndexOf(".");return-1!=o?n=s.substring(o):o=s.length,s=s.substring(0,o),i=$WC.template.replace(i,{FNAME:s,FEXTN:n,INDEX:0,HIDEFILECOMMENT:a,CHID:e})},setPreview:function(s,i,e){var n=this.filedetails[e]&&this.filedetails[e].fname||i.name,t=i.name.split("."),a=t[t.length-1];if(!a&&i.type&&-1==this.FILE_EXTENSION.indexOf(i.type.split("/")[1])&&(a=i.type.split("/")[1]),a="."+a,$WC.Matcher.check("imagemimetype",i.type)){var o=new FileReader;o.onload=function(e){var t='<img src="'+e.target.result+'">';s.innerHTML=t+'<div class="wms_filedetails_wrapper"><div class="wms_filedetails"><div class="wms_fname_wrapper"><input id="wms_fnameinput" data-fextn="'+a+'" data-purpose="edit_fname" type="text" maxlength="50"/><span id="wms_fnameholder" data-fextn="'+a+'" class="wms_fname">'+$WC.Util.safeHTML($WC.Util.unescapeHTML(n))+'</span></div><div class="wms_fextn">'+$WC.Util.getFileSize(i.size)+"</div></div></div>"},s.innerHTML='<div class="wms_filedetails_wrapper"><div class="wms_filedetails"><div class="wms_fname_wrapper"><input id="wms_fnameinput" data-fextn="'+a+'" data-purpose="edit_fname" type="text" maxlength="50"/><span id="wms_fnameholder" data-fextn="'+a+'" class="wms_fname">'+$WC.Util.safeHTML($WC.Util.unescapeHTML(n))+'</span></div><div class="wms_fextn">'+$WC.Util.getFileSize(i.size)+"</div></div></div>",o.readAsDataURL(i)}else $WC.Util.addClass(s,"wms_fileupldbg"),s.innerHTML='<span class="wms-fileimgpreview wms-hvalign"><span class="wms_fileextn">'+a+'</span></span><div class="wms_filedetails_wrapper"><div class="wms_filedetails"><div class="wms_fname_wrapper"><input id="wms_fnameinput" data-fextn="'+a+'" data-purpose="edit_fname" type="text" maxlength="50"/><span id="wms_fnameholder" data-fextn="'+a+'" class="wms_fname">'+$WC.Util.safeHTML($WC.Util.unescapeHTML(n))+'</span></div><div class="wms_fextn">'+$WC.Util.getFileSize(i.size)+"</div></div></div>"},getFileHTML:function(e){var t=$WC.Util.isMacOS()?$WC.I18N("file.upload.comment.mac"):$WC.I18N("file.upload.comment"),s=WindowHandler.getWinObjById(e),i=s.thread_parentid?s.thread_parentid:e,n="block"===s.editorreplydiv.style.display&&(s.editorreplydiv.getAttribute("data-threadmsg")||s.editorreplydiv.getAttribute("data-threadreply"))&&s.editorreplydiv.querySelector('[data-type="custom"]').className||"wms_settings_customcheckbox",a=s.editorreplydiv.getAttribute("data-threadreply")||$WC.Util.isThreadChid(e)?'<div id="wms_thread_postmsg" data-checkbox_setting="0" data-purpose="post_threadmsg" class="wms_settings_chckbx wms_thread_postmsg"><span data-type="custom" class='+n+' ></span><input id="wms_notifyeditmsg" data-setting="notifyedit" type="checkbox" class="wms_settings_checkbox"><label id="wms_notifyeditlabel" class="wms_settings_label">'+$WC.I18N("thread.msgs.post",[$WC.Util.safeHTML($WC.Channels.getChannelName(i))])+"</label></div>":"";return this.checkSupport()?'<div data-fileindex="{{INDEX}}" data-type="file" class="wms-fileupldcnt1 wms-fileupldpreview"><div id="wms-fileupldpreview{{INDEX}}" class="wms-fileupldimgpreview"></div><div class="wms-smileycontainer wms-fileupldsmileycon" data-smileycontainer="true"></div><div id="wms-footer" class="wms-footer{{HIDEFILECOMMENT}}"><div class="wms-smileycontainer wms-smileyautocomplete" data-smileyautocomplete="true"></div><div id="wms-autocomplete" class="wms-autocomplete" data-autocomplete="true" style="display:none"></div><div id="wms-invisiblediv" class="wms-invisiblediv wms-fileupldcmt" data-invisiblediv="true"></div><textarea chid={{CHID}} id="wms-fileupldcmt" data-fileindex="0" data-purpose="keyupload" placeholder="'+t+'" class="wms-fileupldcmt"></textarea><div class="wms-filecmntcount" data-limit="1000">1000</div>'+a+'<div id="wms-smileyinvoker" class="wms-smileyinvoker wms-fileupldsmileyinvoker" data-purpose="smiley"></div></div></div>':'<div data-fileindex="{{INDEX}}" data-type="file" class="wms-fileupldcnt1 wms-fileupldpreview"><input class="wms-fileupldfname" id="wms-fileupldfname" style="height:10%" value="{{FNAME}}" disabled><div id="wms-fileupldpreview{{INDEX}}" class="wms-fileupldimgpreview" style="height:90%"></div></div>'},validateAndReplaceFilename:function(e,t){if(t){var s=/[`~!$%^&|\\"<>?/]/g;return"check"===e?s.test(t)||!t:"replace"===e?t.replace(s,"-"):void 0}},checkSupport:function(){if(void 0!==(new XMLHttpRequest).upload&&void 0!==new FormData)return!0},handleSmileyClick:function(e){var t=e.target.parentNode.parentNode.querySelector("[data-smileycontainer]");this.zomojicomponentvisible?this.hideEmojiPicker(t):this.showEmojiPicker(t)},updateSmiley:function(e,t){var s=null;document.getElementById("wms-fileupldwin")&&(s=$WC.Util.getEventTarget(t).closest('[data-type="file"]').querySelector('[id="wms-fileupldcmt"]'));Smiley.updateSmiley(s,e)},handleClose:function(e,t){var s=!1,i=e.parentNode.parentNode,n=e.parentNode.getAttribute("data-fileindex");"wms_fileslist_wrappersel"===i.className&&(s=!0),i.remove();var a=this.chidvsfiles[t];a.splice(parseInt(n),1),this.filedetails.length&&this.filedetails.splice(parseInt(n),1);for(var o=document.getElementById("wms_fileslistholder"),r=o.querySelectorAll("[data-fileindex]"),l=document.getElementById("wms-fileupldcmt"),d=r.length,c=0;c<d;c++)0==c&&s&&(r[c].parentNode.setAttribute("class","wms_fileslist_wrappersel"),this.setPreview(document.getElementById("wms-fileupldpreview0"),a[c])),s&&this.filedetails.length&&this.fillComments(0,l,t),"wms_fileslist_wrappersel"===r[c].parentNode.className&&document.getElementById("wms-fileupldcmt").setAttribute("data-fileindex",c),r[c].setAttribute("data-fileindex",c);1==d&&(o.style.display="none",document.getElementById("wms-fileupldwinbody").setAttribute("class","wms-fileupldwinbody1"))},initialiseMentions:function(e,t){if(e.keyCode===$WC.WmsConstants.KEYCODES.ESCAPE)WMSUI.atMentions.autocompletediv&&"none"!=WMSUI.atMentions.autocompletediv.style.display?(WmsFileUploadUI.listcommon.showUI(""),WMSUI.atMentions.autocompletediv.style.display="none"):e.target.value?(e.target.value="",WMSUI.atMentions.invisiblediv="",WmsFileUploadUI.updateCommentCount(e.target)):(WMSUI.imgPreview.removeOverlay(),WmsFileUploadUI.resetForm(t));else if(e.keyCode!==$WC.WmsConstants.KEYCODES.UP&&e.keyCode!==$WC.WmsConstants.KEYCODES.DOWN){var s=e.target.selectionStart,i=e.target.value;""==i&&(WMSUI.atMentions.invisiblediv.innerHTML="",WMSUI.atMentions.autocompletediv.style.display="none"),i=i.substring(0,s);for(var n=0,a=(WMSUI.atMentions.invisiblediv.innerHTML,["@"]),o=0;o<a.length;o++){var r=i.lastIndexOf(" "+a[o])+1;0==r&&(r=i.lastIndexOf("\n"+a[o])+1),0===r&&0!==i.indexOf(a[o])&&(r=-1),-1!==r&&n<=r&&(n=r,WMSUI.curtrigger=a[o])}WMSUI.atMentions.init(t,e.target,null,WMSUI.atMentions.invisiblediv,WMSUI.atMentions.autocompletediv)}},bindEvents:function(h){var g=document.getElementById("wms-fileupldwin");this.listcommon=new ListCommon(document.getElementById("wms-fileupldcmt"),g.querySelector('[id="wms-autocomplete"]')),WMSUI.atMentions.invisiblediv=g.querySelector('[id="wms-invisiblediv"]'),WMSUI.atMentions.autocompletediv=g.querySelector('[id="wms-autocomplete"]');var s=document.getElementById("wms-fileupldcmt");$WC.Util.addEvent(s,"scroll",function(e){WMSUI.handleSync(e.target)}),Gator(g).on("change","#wms-file1",function(e){var t=e.target.files;WMSUI.submitFile(h,t)}),Gator(g).on("keyup",function(e){var t=e.target.getAttribute("data-purpose");if("keyupload"===t)this.initialiseMentions(e,h),this.updateCommentCount(e.target);else if("edit_fname"==t&&13==e.keyCode){var s=document.getElementById("wms-fileupldcmt"),i=g.querySelector('[id="wms_fnameholder"]'),n=e.target.value+i.getAttribute("data-fextn");$WC.$CUtil.setInnerText(i,n),s.focus()}}.bind(this)),g.addEventListener("click",function(e){var t=e.target.getAttribute("data-purpose")||e.target.closest("[data-purpose]")&&e.target.closest("[data-purpose]").getAttribute("data-purpose");if("cancel"===t)this.cancelFileUpload(h);else if("close"===t)this.handleClose(e.target,h);else if("smiley"==t)this.handleSmileyClick(e);else if("search"!==t&&this.zomojicomponentvisible){for(var s=g.querySelectorAll("[data-smileycontainer]"),i=0;i<s.length;i++)s[i].className=s[i].className.replace(" wms-smileyborder","");this.zomojicomponent.unmountComponent(),this.zomojicomponentvisible=!1}else if("preview"==t){var n=document.getElementById("wms_fileslistholder").querySelectorAll('[class*="wms_fileslist_wrapper"]');for(i=0;i<n.length;i++)n[i].setAttribute("class","wms_fileslist_wrapper");e.target.closest("[data-purpose]").parentNode.setAttribute("class","wms_fileslist_wrappersel");var a=parseInt(e.target.closest("[data-purpose]").getAttribute("data-fileindex")),o=document.getElementById("wms-fileupldpreview0"),r=document.getElementById("wms-fileupldcmt"),l=this.chidvsfiles[h],d=parseInt(r.getAttribute("data-fileindex"));r=document.getElementById("wms-fileupldcmt");this.storeComments(d,r,h),this.setPreview(o,l[a],a),r.setAttribute("data-fileindex",a),this.fillComments(a,r,h),r.focus(),this.updateCommentCount(r)}else if("edit_fname"==t){var c=g.querySelector('[id="wms_fnameholder"]'),m=$WC.Util.getInnerText(c);e.target.value=m.substring(0,m.lastIndexOf("."))}else if("post_threadmsg"==t){var u=e.target.closest("[data-checkbox_setting]")||g.querySelector("[data-checkbox_setting]"),p=g.querySelector('[data-type="custom"]');"1"===(e.target.getAttribute("data-checkbox_setting")||u&&u.getAttribute("data-checkbox_setting"))?($WC.Util.removeClass(p,"wms_settings_customcheckboxsel"),$WC.Util.addClass(p,"wms_settings_customcheckbox"),u.setAttribute("data-checkbox_setting","0")):($WC.Util.removeClass(p,"wms_settings_customcheckbox"),$WC.Util.addClass(p,"wms_settings_customcheckboxsel"),u.setAttribute("data-checkbox_setting","1"))}}.bind(this)),g.addEventListener("keydown",function(e){"keyupload"==e.target.getAttribute("data-purpose")&&13==e.keyCode&&(e.ctrlKey||e.metaKey)&&(this.uploadFile(h),e.preventDefault())}.bind(this)),g.addEventListener("focusin",function(e){var t=e.target.getAttribute("data-purpose");if("fileupload"==t){for(var s=this.getElementsByClassName("wms-fileupldfname"),i=0;i<s.length;i++)s[i].setAttribute("style","border-color: transparent");document.getElementById("wms-filefrwrderrormsg").setAttribute("style","display:none")}else if("edit_fname"==t){var n=g.querySelector('[id="wms_fnameholder"]'),a=$WC.Util.getInnerText(n);e.target.value=a.substring(0,a.lastIndexOf("."))}else if("addfiles"==t){var o=g.querySelector('[id="wms_addfiles"]');$WC.Util.setAttribute(o,"data-addfiles",!0)}}.bind(this)),g.addEventListener("focusout",function(e){var t=e.target.getAttribute("data-purpose");if("edit_fname"==t){var s=document.getElementById("wms-fileupldcmt"),i=g.querySelector('[id="wms_fnameholder"]'),n=e.target.value+i.getAttribute("data-fextn");$WC.$CUtil.setInnerText(i,n),s.focus()}else if("addfiles"==t){g.querySelector('[id="wms_addfiles"]').removeAttribute("data-addfiles")}}.bind(this)),s.addEventListener("input",function(e){var t=e.target.value;WmsFileUploadUI.initiateEmojiPicker(t,g,s)}.bind(this))},fillComments:function(e,t,s){var i=WindowHandler.getWinObjById(s);this.filedetails[e]&&this.filedetails[e].comment?(t.value=this.filedetails[e].comment,this.filedetails[e].atmentions?(i.atmentions=this.filedetails[e].atmentions,WMSUI.atMentions.changeColor(t)):WMSUI.atMentions.invisiblediv&&(WMSUI.atMentions.invisiblediv.innerHTML="")):(t.value="",WMSUI.atMentions.invisiblediv&&(WMSUI.atMentions.invisiblediv.innerHTML="")),t.focus()},storeComments:function(e,t,s){var i=WindowHandler.getWinObjById(s),n=document.getElementById("wms_fnameinput"),a=n.getAttribute("data-fextn"),o=n.value?n.value+a:this.filedetails[e]&&this.filedetails[e].fname;this.filedetails[e]={comment:Smiley.replaceTextToEnglishCodes(t.value),atmentions:i.atmentions,fname:o},i.atmentions=""},updateCommentCount:function(e){var t=e.parentNode.querySelector("[data-limit]"),s=e.value.length,i=t.getAttribute("data-limit"),n=i-s;n<10?$WC.Util.addClass(t,"wms_cntred"):$WC.Util.removeClass(t,"wms_cntred"),n<0?e.value=e.value.substring(0,i):$WC.$CUtil.setInnerText(t,n)},setAndClearReplyMsg:function(e,t){var s=WindowHandler.getWinObjById(e),i=s.getReplyMessageId();$WC.Util.isEmpty(i)||(s&&s.editorreplydiv.getAttribute("data-threadreply")?WmsFileUploadHandler.setThreadMsgId(e,i,t):WmsFileUploadHandler.setReplyMsgId(e,i,t)),s&&s.closeReplyPreview()},cancelFileUpload:function(e){WMSUI.imgPreview.removeOverlay(),this.resetForm(e)},uploadFile:function(e){var t=this.chidvsfiles[e],s=document.getElementById("wms-fileupldcontainer").querySelectorAll('[data-type="file"]'),i=WindowHandler.getWinObjById(e);if(i&&i.salesiqchat)return WmsUIImpl.uploadFile(t,this.getCommentsDetails(s),e),this.resetForm(e),WMSUI.imgPreview.removeOverlay(),void i.composer.focus();var n=document.getElementById("wms-fileupldcmt"),a=parseInt(n.getAttribute("data-fileindex"));this.storeComments(a,n,e);for(var o=!(!document.getElementById("wms_thread_postmsg")||"1"!==document.getElementById("wms_thread_postmsg").getAttribute("data-checkbox_setting")),r=0;r<t.length;r++){var l="",d="";this.filedetails[r]&&(l=this.filedetails[r].atmentions?$WC.Util.unescapeHTML(WMSUI.atMentions.formatAtMentions(this.filedetails[r].comment,this.filedetails[r].atmentions,e,!0)):this.filedetails[r].comment,d=this.filedetails[r].atmentions);var c=t[r],m=this.filedetails[r]&&this.filedetails[r].fname||c.name,u=WmsFileUploadHandler.addFileForUpload(e,c,l,d,m,o);this.setAndClearReplyMsg(e,u)}var p=this.getCallBackObject();WmsFileUploadHandler.startFileUpload(e,p),this.resetForm(e),WMSUI.imgPreview.removeOverlay(),i.composer.focus(),this.addProgressBarForEachFile(e,p)},getCallBackObject:function(){return{progresscallback:this.handleProgress,successcallback:this.handlesuccess,errorcallback:this.errorUploadProgress,oncompletecallback:this.clearUploadProgress}},toggleCancelButton:function(e,t){if(!$WC.Util.isEmpty(e)){var s=WindowHandler.getWinObjById(e).progressbarnode;if(!$WC.Util.isEmpty(t)&&WmsFileUploadHandler.islivefupExist(e)){s.querySelector('[data-purpose="uploadcancel"]').display="none";var i=s.querySelector('[data-filename="'+WmsFileUploadUI.validateAndReplaceFilename("replace",t)+'"]');1<WmsFileUploadHandler.getLivefupObj(e).getTotalFileCount()&&i&&(i.querySelector('[data-purpose="close"]').display="none")}}},addProgressBarForEachFile:function(e){var t=WmsFileUploadHandler.getLivefupObj(e),s=t.getFileDetails(),i="",n=WindowHandler.getWinObjById(e).progressbarnode;if(1<t.getTotalFileCount()){for(var a in s){if(!n.querySelector('[data-filename="'+WmsFileUploadUI.validateAndReplaceFilename("replace",a)+'"]')){var o=s[a];i+=$WC.template.replace('<div  class="wms_uploaddetails {{FAIL}}" data-filename="{{FILENAME}}"><div class="wms_uploadprogress"><div class="wms_uploadfiledetails"><span class="wms_uploadfilename" title="{{FILE_DISPLAY_NAME}}">{{FILE_DISPLAY_NAME}}</span><span class="wms_file_errorinfo"></span></div><div class="wms_uploadprogresswrapper"><div id="wmsloadingtxt" class="wms-loading-sub" data-progressindicator="true"></div></div></div><div class="wms_uploadicons"><span data-purpose="resend" data-filename="{{FILENAME}}" title="Retry" class="wms_fileupld_resend"></span><span data-purpose="close" data-filename="{{FILENAME}}" title="Cancel" class="wms_fileupld_close"></span></div></div>',{FILE_DISPLAY_NAME:$WC.Util.safeHTML(o.fname)+this.getFileSizeForDisplay(o),FAIL:o.error?"sending-failed":"",FILENAME:a})}}n.querySelector('[id="wms_expandfilescontainer" ]').insertAdjacentHTML("beforeend",i)}this.updateUploadProgressBarContainer(n,e,t)},getFileSizeForDisplay:function(e){return" - ("+$WC.Util.getFileSize(e.fileobj.size)+")"},cleanUpFileUpload:function(e,t,s,i,n){WmsFileUploadHandler.cleanUpFileUpload(e,t,s,i),this.clearUploadProgress(e,s,i,n)},resendFile:function(e,t,s){e&&t&&(WmsFileUploadHandler.resendFile(e,t,this.getCallBackObject()),this.handleResend(e,t,s))},resendAllFiles:function(e){if(WmsFileUploadHandler.islivefupExist(e)){var t=WmsFileUploadHandler.getLivefupObj(e).filesdetails,s=WindowHandler.getWinObjById(e).progressbarnode;for(var i in t)this.resendFile(e,i,s)}},handleResend:function(e,t,s){if(e){var i=WmsFileUploadHandler.getFailFilesCount(e),n=(s=s||WindowHandler.getWinObjById(e).progressbarnode).querySelector('[data-filename="'+WmsFileUploadUI.validateAndReplaceFilename("replace",t)+'"]');t&&n&&$WC.Util.removeClass(n,"wms_sending_failed");var a=i?$WC.I18N("common.file.fail",[i]):"";a=1===i?$WC.I18N("common.singlefile.fail"):a,$WC.$CUtil.setInnerText(s.querySelector('[id="wms_failcountbar"]'),a),i||$WC.Util.removeClass(s.querySelector('[data-purpose="filecontainer" ]'),"wms_sending_failed")}},handleProgress:function(e,t,s){if(e.lengthComputable){var i=WmsFileUploadHandler.getLivefupObj(t);if(!$WC.Util.isEmpty(i)&&!$WC.Util.isEmptyObject(i)&&0<i.getTotalFileCount()&&void 0!==i.getFileDetails(s)){var n=i.getFileDetails();if(!$WC.Util.isEmpty(n[s])){i.updateProgressDetails(s,e.loaded);var a=n[s],o={uploaded:a.uploaded,total:a.total,fup:i};WmsFileUploadUI.updateUploadprogressBar(t,o,s)}}}},updateUploadprogressBar:function(e,t,s){var i,n,a,o=WindowHandler.getWinObjById(e);if(o){var r=o.progressbarnode,l=r.querySelector("[data-progressindicator]"),d=t.fup,c=(i=d.uploaded,n=d.total,a=i/n*(100/d.getTotalFileCount()),((a+=(d.getTotalFileCount()-d.getRemainingFilesCount())*(100/d.getTotalFileCount()))&&100<a?100:Math.round(a))/100);if(l.style.transform="scaleX("+c+")",1<d.getTotalFileCount()){c=(t.uploaded/t.total).toFixed(2);var m=r.querySelector('[data-filename="'+s+'"]');if(m)m.querySelector("[data-progressindicator]").style.transform="scaleX("+c+")"}}},updateUploadProgressBarContainer:function(e,t,s){s=$WC.Util.isEmpty(s)?WmsFileUploadHandler.getLivefupObj(t):s;var i=e.querySelector('[id="wms_failcountbar"]');if($WC.Util.isEmpty(s))e.querySelector("[data-progressindicator]").style="",i.style.display="none";else{var n=Object.keys(s.getFileDetails())[0];if(!$WC.Util.isEmpty(n)){var a=e.querySelector('[id="wms_fileexpandicon"]'),o=e.querySelector("[data-progresstext]");if(1==s.getTotalFileCount()){var r=s.getFileDetails(n);o.innerHTML=$WC.I18N("chat.file.sharing",["<b>"+$WC.Util.safeHTML(r.fname)+"</b>",this.getFileSizeForDisplay(r)]),$WC.Util.removeClass(a,"wms_fileupld_shrink"),$WC.Util.addClass(a,"wms_fileupld_expand"),a.setAttribute("title",$WC.I18N("common.expand")),a.setAttribute("data-purpose","expand"),a.style.display="none",e.querySelector("[data-progressholder]").style.display="block",e.querySelector('[id="wms_expandfilescontainer"]').style.display="none"}else o.innerHTML=$WC.I18N("chat.files.sharing",["<b>"+s.getSharingFilesCount()+"</b>","<b>"+s.getTotalFileCount()+"</b>"]),a.style.display="block",i.style.display="block";e.style.display="block"}}},handlesuccess:function(e,t,s){var i=WmsFileUploadHandler.getLivefupObj(e);i&&i.pendingfiles.hasOwnProperty(s.opts.id)&&(i.pendingfiles[s.opts.id].isuploaded=!0),WmsFileUploadUI.clearUploadProgress(e,t);WindowHandler.getWinObjById(e);s.opts.threadMsgId||WmsFileUploadUI.updateLocalFileData(e,t,s),WmsFileUploadUI.customCallBackObj&&"function"==typeof WmsFileUploadUI.customCallBackObj.successCallBack&&(WmsFileUploadUI.customCallBackObj.successCallBack(),WmsFileUploadUI.clearCustomCallBackObj())},updateLocalFileData:function(s,e,t){var i=WindowHandler.getWinObjById(s),n=t.opts&&t.opts.id,a=t.opts&&t.opts.comment,o=t.opts&&t.opts.atmentions,r=t.opts&&t.opts.fname,l=t.opts&&t.opts.replyMsgUid,d=t.opts&&t.opts.fileobj,c=d&&d.type;if(!i.msgdisp.querySelector('[data-msgackid="'+n+'"]')&&!l&&"video/quicktime"!==c&&"video/mov"!==c&&"application/x-matroska"!==c){var m={msg:{}};m.msg.dim={};var u=m,p=i,h=new FileReader;h.onload=function(e){if(u.url=e.target.result,u.msg.url=e.target.result,m.msg.comment&&Message.isCustomEmoji(m.msg.comment)&&!$WC.Util.isEmptyObject($WC.CustomEmoji.constructCustomEmojiMeta(m.msg.comment))&&(m.meta||(m.meta={}),m.meta.customemoji=$WC.CustomEmoji.constructCustomEmojiMeta(m.msg.comment)),$WC.Matcher.check("imagemimetype",d.type)){var t=new Image;t.onload=function(){u.msg.dim.width=this.width,u.msg.dim.height=this.height,p.msgdisp.querySelector('[data-msgackid="'+u.msgackid+'"]')||p.updateMessage(m)},t.src=e.target.result}else p.msgdisp.querySelector('[data-msgackid="'+u.msgackid+'"]')||p.updateMessage(m)},m.zuid=WebMessanger.zuid,m.sender=WebMessanger.zuid,m.ctype=i.ctype,m.chid=s,m.mod="att",m.time=n,m.msgackid=n,m.msg.isv1local=!0,m.msguid=escape(WebMessanger.zuid+" "+n),m.msg.isv1=!0,m.msg.fName=WmsFileUploadUI.validateAndReplaceFilename("replace",r),m.msg.content=d.type||"text/plain",m.msg.size=$WC.Util.getFileSize(d.size),m.msg.comment=a,d.duration&&(m.msg.duration=d.duration),o&&(m.msg.meta={},m.msg.meta.mentions={},o.split(",").forEach(function(e){if(e){var t={};t.id=e,t.type=$WC.Bots.isBotId(e)?4:1,t.name=$WC.Util.getContactName(e,null,!0)||$WC.Util.unescapeHTML(WindowHandler.getWinObjById(s).title),m.msg.meta.mentions[e]=t}})),h.readAsDataURL(d),"11"!=p.ctype||"false"!==p.thread_follower||WebMessanger.threadmap[s]||(WebMessanger.threadmap[s]="true")}},clearUploadProgress:function(e,t,s,i){var n,a,o=WindowHandler.getWinObjById(e).progressbarnode,r=o.querySelector('[id="wms_expandfilescontainer"]'),l=o.querySelector('[id="wms_fileexpandicon"]'),d=o.querySelector('[data-filename="'+WmsFileUploadUI.validateAndReplaceFilename("replace",t)+'"]');if(t&&d){var c=d.querySelector('[data-purpose="close"]');if(s){i||($WC.Util.removeClass(c,"wms_fileupld_close"),$WC.Util.addClass(c,"wms_fileupld_sel"),c.style.display="block"),n=r.getBoundingClientRect().height;var m=WmsFileUploadHandler.getLivefupObj(e);m?setTimeout(function(){var e=m.getRemainingFilesCount()+m.getPendingFilesCount(),t=e*(d.getBoundingClientRect().height+4)>n?n:e*(d.getBoundingClientRect().height+4);$WC.Util.animate(r,"height",n,t),t||0!=$WC.Util.getObjectLength(m.filedetails)||(r.innerHTML="",r.style.border="none",r.style.padding="0px",WmsFileUploadUI.toggleExpandContainerIcon(l),o.querySelector("[data-progressindicator]").style.display="block"),d.style.display="none",c.style.display="none"},1e3):(o.style.display="none",r.innerHTML="",r.style="",WmsFileUploadUI.toggleExpandContainerIcon(l))}else c.style.display="none"}else s&&(a=function(){r.innerHTML="",r.style.border="none",r.style.padding="0px"},n=r.getBoundingClientRect().height,$WC.Util.animate(r,"height",n,0,a),WmsFileUploadUI.toggleExpandContainerIcon(l),o.querySelector("[data-progressindicator]").style.display="block",o.style.display="none");WmsFileUploadUI.handleResend(e,t,o),WmsFileUploadUI.updateUploadProgressBarContainer(o,e),WmsFileUploadUI.toggleCancelButton(e,t,!0)},toggleExpandContainerIcon:function(e){"none"!==e.style.display&&($WC.Util.removeClass(e,"wms_fileupld_shrink"),$WC.Util.addClass(e,"wms_fileupld_expand"),e.setAttribute("data-purpose","expand"),e.setAttribute("title",$WC.I18N("common.expand")))},errorUploadProgress:function(e,t){var s=WindowHandler.getWinObjById(e).progressbarnode,i=s.querySelector('[id="wms_failcountbar"]'),n=WmsFileUploadHandler.getLivefupObj(e);$WC.Util.addClass(s.querySelector('[data-purpose="filecontainer" ]'),"wms_sending_failed"),i.innerHTML=1==n.getTotalFileCount()?$WC.I18N("common.singlefile.fail"):$WC.I18N("common.file.fail",[WmsFileUploadHandler.getFailFilesCount(e)]),i.style.display="block",t&&s&&$WC.Util.addClass(s.querySelector('[data-filename="'+t+'"]'),"wms_sending_failed"),WmsFileUploadUI.toggleCancelButton(e,t,!0),WmsFileUploadUI.customCallBackObj&&"function"==typeof WmsFileUploadUI.customCallBackObj.errorCallBack&&(WmsFileUploadUI.customCallBackObj.errorCallBack(),WmsFileUploadUI.clearCustomCallBackObj())},expandFilesContainer:function(e,t){var s,i,n=WindowHandler.getWinObjById(e).progressbarnode,a=n.querySelector('[id="wms_expandfilescontainer"]'),o=n.querySelector('[id="wms_fileexpandicon"]'),r=n.querySelector("[data-progressindicator]");"expand"===t?(a.style="",a.style.display="block",i=function(){setTimeout(function(){a.style.overflowY="auto"},500)},s=a.getBoundingClientRect().height,$WC.Util.animate(a,"height",0,s,i),$WC.Util.removeClass(o,"wms_fileupld_expand"),$WC.Util.addClass(o,"wms_fileupld_shrink"),o.setAttribute("title",$WC.I18N("common.collapse")),o.setAttribute("data-purpose","collapse"),r.style.display="none"):(i=function(){setTimeout(function(){a.style.border="none",a.style.padding="0px"},500)},a.style.overflow="hidden",s=a.getBoundingClientRect().height,$WC.Util.animate(a,"height",s,0,i),$WC.Util.removeClass(o,"wms_fileupld_shrink"),$WC.Util.addClass(o,"wms_fileupld_expand"),o.setAttribute("title",$WC.I18N("common.expand")),o.setAttribute("data-purpose","expand"),r.style.display="block")},handlePaste:function(e){var t=e.target.getAttribute("chid"),s=[],i=WindowHandler.getWinObjById(t),n=(e.originalEvent||e).clipboardData;if(n){var a=n.items;if(a){for(var o=0;o<a.length;o++)$WC.Matcher.check("imagemimetype",a[o].type)&&null!==a[o].getAsFile()&&s.push(a[o].getAsFile());0===s.length||i.restrict_file_upload||(WmsFileUploadUI.handlePreview(t,s),document.getElementById("wms-fileupldcmt").focus())}}},getCommentsDetails:function(e){for(var t={comments:{}},s=0;s<e.length;s++){var i=parseInt(e[s].getAttribute("data-fileindex")),n=e[s].querySelector('[id="wms-fileupldcmt"]').value;n&&(t.comments[i+1]=n.trim())}return t},initiateEmojiPicker:function(e,t,s){var i=Message.getCurtriggers("text");if(WMSUI.getCurtriggers(e,i)==$WC.WmsConstants.TRIGGERS.SMILEY||this.autocompletepickervisible){var n=t.querySelector('[data-smileyautocomplete="true"]'),a=s.value.substring(0,s.selectionStart),o=a.lastIndexOf(" "+$WC.WmsConstants.TRIGGERS.SMILEY)+1,r=WMSUI.autoComplete.isSmileyTriggerPresent(o,a);WmsFileUploadUI.autocompletepickervisible&&!r?WmsFileUploadUI.hideEmojiPicker(n,s,!0):r&&"false"!=WMSUI.autoComplete.getSearchTermForComposer(a)&&WmsFileUploadUI.showEmojiPicker(n,s,!0,WMSUI.autoComplete.getSearchTermForComposer(a))}},showEmojiPicker:function(s,i,n,e){if(this.autocompletepickervisible&&e)this.zomojicomponent.updateSearchTerm(e);else{var t={hidesearch:n,autocomplete:n,hidestickers:!0,hidecustomemoji:!0};e&&(t.searchterm=e),this.autocompletepickervisible&&!n&&this.hideEmojiPicker(this.zomojicomponent.node),s.className+=" wms-smileyborder",n?(this.autocompletepickervisible=!0,WMSUI.autoComplete.setKeyNavigation(i,this.zomojicomponent)):this.zomojicomponentvisible=!0,this.zomojicomponent.mountComponent(s,!0,function(e,t){n?WMSUI.autoComplete.select(i,e):WmsFileUploadUI.updateSmiley(e,t),this.hideEmojiPicker(s)}.bind(this),function(){this.hideEmojiPicker(s,n)}.bind(this),t)}},hideEmojiPicker:function(e){this.zomojicomponent.unmountComponent(),e.className=e.className.replace(" wms-smileyborder",""),this.autocompletepickervisible?(this.autocompletepickervisible=!1,WMSUI.autoComplete.removeKeyNavigation(e.parentElement.querySelector("#wms-fileupldcmt"),this.zomojicomponent)):this.zomojicomponentvisible=!1},isConfirmationNeeded:function(e){var t=e.split(".").pop();if($WC.Util.isMacOSMojaveOrOlder()){return["url","fileloc"].includes(t)}if($WC.Util.isWindowsOS()){return["lnk"].includes(t)}return!1},handleDownload:function(e,t){if(this.isConfirmationNeeded(e)){var s=[$WC.I18N("file.download.confirmation"),$WC.I18N("file.download.confirmation")],i=new $WC.ConfirmationDialog,n={actions:[{text:$WC.I18N("file.open.anyway"),onclick:function(){window.open(t,"_blank","noopener,noreferrer"),i.unmountComponent()},buttonstyle:"confirmation_button"},{text:$WC.I18N("common.cancel"),onclick:function(){i.unmountComponent()},buttonstyle:"cancel_button"}],heading:s,headercontent:[$WC.I18N("filename.download.confirmation",e)]};return i.mountComponent(n),!1}window.open(t,"_blank","noopener,noreferrer")},setCustomCallBackObj:function(e){this.customCallBackObj=e},clearCustomCallBackObj:function(){this.customCallBackObj=null}},WmsFileForwardUI={mentions:[],handlePreview:function(e){WMSUI.imgPreview.createOverlay();var t=e.getAttribute("data-chid")||e.closest("[data-chid]").getAttribute("data-chid"),s=e.getAttribute("data-msguid")||e.closest("[data-msguid]").getAttribute("data-msguid"),i=this.getWindowHTML();document.getElementById("wms-imgpreviewcontainer").innerHTML=i,$WC.Button.mountComponent(document.getElementById("wms-fileforward"),"button","12",$WC.I18N("message.actions.forward"),"","wms_fileupld_share",$WC.I18N("message.actions.forward"),this.createChatAndForward.bind(this,t,s)),$WC.Button.mountComponent(document.getElementById("wms-filecancel"),"button","12",$WC.I18N("common.cancel"),"","wms_fileupld_cancel",$WC.I18N("common.cancel"),this.cancelFileForward.bind(this,t)),document.getElementById("wms-filefrwrdrecipant").focus(),"true"==e.getAttribute("data-filefrwrd")&&!e.getAttribute("src")&&e.closest("#wms-videoplayer")&&(e=e.closest("#wms-videoplayer")),this.fill(e,t),this.bindEvents(t,s)},getWindowHTML:function(){this.retain_trace=$WC.WmsLocalStorage.getItem($WC.Config.get("zuid")+"_allow_forward_info");var e=this.retain_trace?"wms_show_forwardinfo":"wms_hide_forwardinfo";return'<div id="wms-fileupldwin" class="wms-fileupldwin wms-hvalign"><div id="wms-fileupldwinheader" class="wms-fileupldwinheader">'+$WC.I18N("file.forward")+'<span class="wms-fileupldclose" data-purpose="cancel"></span></div><div id="wms-fileupldwinbody" class="wms-fileupldwinbody wms_filefrwrdwinbody"><div id="wms-filefrwrderrormsg" class="wms-filefrwrderror"></div><span><div class="wms_filefrwrd_info">'+$WC.I18N("file.forward.to")+':</div><div id="wms-filefrwrdrecipant" data-type="contact" contenteditable="true" class="wms-filefrwrdrecipant" data-purpose="selectrecipant" placeholder="'+$WC.I18N("fileforward.select.recipient")+'"></div><div id="wms_filefrwrdsugg_wrapper" class="wms_filefrwrdsugg_wrapper"><div class="wms_filefrwrdsugg_container"><span class="wms_filefrwrdsugg_info">'+$WC.I18N("file.forward.suggestions")+'</span><div class="wms_filefrwrdsugg">'+this.getSuggestionsHTML()+'</div></div></div><div id="wms-selrecipant" class="wms-filefrwrdrecipant" style="display:none"></div><div id="wms-filefrwrdautocomplete" class="wms-filefrwrdautocomplete" style="display:none"></div><div id="wms-fileupldcontainer" class="wms-filefrwrdwinbody"></div><div class="wms_forwardinfo" data-purpose="forwardinfo"><div id="wms_forwardinfo"><span data-purpose="toggleforwardinfo" class="'+e+'"></span><input type="checkbox"/><label>'+$WC.I18N("forward.show.info")+'</label></div><div class="wms-fileupldactions wms_filefrwrdactions"><div data-purpose="forwardfile" id="wms-fileforward"></div><div data-purpose="cancel" id="wms-filecancel"></div></div></div></span></div></div>'},getSuggestionsHTML:function(){var e=$WC.HybridSearch.filter("DNAME","",WmsContacts.getContactsList(),5,"","EMAILID"),t="",s='<img title="{{DNAME}}" data-dname="{{DNAME}}" data-type="'+$WC.WmsConstants.HYBRIDSEARCH.CONTACT+'" data-id="{{USERID}}" data-purpose="usersugg" src="{{WMSPHOTOSERVER}}/file?ID={{USERID}}&exp=6000&t=user&fs=thumb">';return e.forEach(function(e){t+=$WC.template.replace(s,{DNAME:e.DNAME,USERID:e.USERID,WMSPHOTOSERVER:_WMSPHOTOSERVER})}),t},getFileHTML:function(){var e=$WC.Util.isMacOS()?$WC.I18N("file.forward.comment.mac"):$WC.I18N("file.forward.comment");return WmsFileUploadUI.checkSupport()?'<div data-type="file" data-fextn="{{FEXTN}}" data-content="{{CONTENT}}" data-url="{{URL}}" data-isv1={{ISV1}} class="wms-filefrwrdcnt1 wms-fileupldpreview"><input class="wms-fileupldfname" id="wms-fileupldfname" data-purpose="forwardfilename" placeholder="'+$WC.I18N("file.add.name")+'" value="{{FNAME}}"><div id="wms-fileupldpreview0" class="wms-fileupldimgpreview"></div><div class="wms-smileycontainer wms-filefrwrdsmileycon" data-smileycontainer="true"></div><div id="wms-footer" class="wms-footer"><div id="wms-autocomplete" class="wms-autocomplete" data-autocomplete="true" style="display:none"></div><div id="wms-invisiblediv" class="wms-invisiblediv wms-fileupldcmt" data-invisiblediv="true"></div><div class="wms-smileycontainer wms-smileyautocomplete" data-smileyautocomplete="true"></div><textarea chid={{CHID}} id="wms-fileupldcmt" data-purpose="keyforward" placeholder="'+e+'" class="wms-fileupldcmt"></textarea><div class="wms-filecmntcount" data-limit="1000">1000</div><div id="wms-smileyinvoker" class="wms-smileyinvoker wms-fileupldsmileyinvoker" data-purpose="smiley"></div></div></div>':'<div data-type="file" data-fextn="{{FEXTN}}" data-content="{{CONTENT}}" data-url="{{URL}}" data-isv1={{ISV1}} class="wms-filefrwrdcnt1 wms-fileupldpreview"><input class="wms-fileupldfname" id="wms-fileupldfname" placeholder="'+$WC.I18N("file.add.name")+'" style="height:10%" value="{{FNAME}}"><div id="wms-fileupldpreview0" class="wms-fileupldimgpreview" style="height:90%"></div></div>'},fill:function(e,t){var s="",i="null"!==e.getAttribute("data-fcomment")?e.getAttribute("data-fcomment"):"",n=e.getAttribute("data-furl")||e.src;n=-1==n.indexOf(_DOWNLOADSERVERURL)?Message.getDownloadUrl({isv1:!0,url:n}):n;var a=e.getAttribute("data-fcontent"),o=e.getAttribute("data-src")||e.getAttribute("data-furl"),r=e.getAttribute("data-fname"),l=e.getAttribute("data-isv1"),d=this.getFileHTML();d=$WC.template.replace(d,{FNAME:r,FEXTN:"",COMMENT:i,URL:o,CONTENT:a,ISV1:l,CHID:t});var c=document.getElementById("wms-fileupldcontainer");c.innerHTML=d,WmsFileUploadUI.listcommon=new ListCommon(document.getElementById("wms-fileupldcmt"),c.querySelector('[id="wms-autocomplete"]')),WMSUI.atMentions.invisiblediv=c.querySelector('[id="wms-invisiblediv"]'),WMSUI.atMentions.autocompletediv=c.querySelector('[id="wms-autocomplete"]');var m=document.getElementById("wms-fileupldpreview0"),u=WindowHandler.getWinObjById(t);i=e.getAttribute("data-fcomment"),WMSUI.atMentions.invisiblediv.innerHTML=$WC.Util.safeHTML($WC.Util.unescapeHTML(i));c.querySelector("#wms-fileupldcmt").value=$WC.Matcher.replacer(/<span .*?>(.*?)<\/span>/gi,null,i,function(e,t){return t});$WC.Matcher.replacer(/<span .*? data-zcprofileid="(.*?)">(.*?)<\/span>/gi,null,i,function(e,t){WmsFileForwardUI.mentions.push(t)}),u.atmentions=u.atmentions.concat(WmsFileForwardUI.mentions.join(",")).concat(","),/^image\/.+$/.test(a)?s="<img src="+n+">":(s='<span class="wms-fileimgpreview wms-hvalign"></span>',$WC.Util.addClass(m,"wms_fileupldbg")),s+='<div class="wms_filedetails_wrapper"><div class="wms_filedetails"><div class="wms_fname_wrapper"><input id="wms_fnameinput" data-purpose="edit_fname" type="text" maxlength="50"/><span id="wms_fnameholder" class="wms_fname">'+r+"</span></div></div></div>",m.innerHTML=s},cancelFileForward:function(e){var t=WindowHandler.getWinObjById(e);WMSUI.imgPreview.removeOverlay(),this.mentions=[],t.atmentions="",WmsFileUploadUI.listcommon="",WMSUI.atMentions.invisiblediv="",WMSUI.atMentions.autocompletediv=""},bindEvents:function(a,s){var o=document.getElementById("wms-fileupldwin");WindowHandler.getWinObjById(a);o.addEventListener("click",function(e){var t=o.querySelector("[data-smileycontainer]"),s=$WC.Util.getEventTarget(e),i=s.getAttribute("data-purpose")||s.closest("[data-purpose]")&&s.closest("[data-purpose]").getAttribute("data-purpose");if("cancel"==i)this.cancelFileForward(a);else if("selectrecipant"==i||"keyforward"==i)"keyforward"==i&&(WmsFileUploadUI.zomojicomponentvisible&&WmsFileUploadUI.hideEmojiPicker(t),this.closeRecipientList()),document.getElementById("wms-filefrwrderrormsg").setAttribute("style","display:none"),$WC.Util.removeClass(document.getElementById("wms_filefrwrdsugg_wrapper"),"wms_filefrwrderr");else if("smiley"==i)WmsFileUploadUI.zomojicomponentvisible?WmsFileUploadUI.hideEmojiPicker(t):WmsFileUploadUI.showEmojiPicker(t);else if("usersugg"==i)this.insertSuggestion(e);else if("delsugg"==i)this.removeSuggestion(e);else if(s.closest("[data-id]"))this.insertSuggestion(e);else if("search"!==i&&WmsFileUploadUI.zomojicomponentvisible)t.className=t.className.replace(" wms-smileyborder",""),WmsFileUploadUI.zomojicomponent.unmountComponent(),WmsFileUploadUI.zomojicomponentvisible=!1,this.closeRecipientList();else if("forwardinfo"===i){this.retain_trace=!this.retain_trace;var n=s.closest("[data-purpose]").querySelector('[data-purpose="toggleforwardinfo"]');this.retain_trace?($WC.Util.removeClass(n,"wms_hide_forwardinfo"),$WC.Util.addClass(n,"wms_show_forwardinfo")):($WC.Util.removeClass(n,"wms_show_forwardinfo"),$WC.Util.addClass(n,"wms_hide_forwardinfo"))}}.bind(this)),o.addEventListener("keyup",function(e){var t=$WC.Util.getEventTarget(e),s=t.getAttribute("data-purpose"),i=document.getElementById("wms-filefrwrdautocomplete");"keyforward"===s?(WmsFileUploadUI.initialiseMentions(e,a),WmsFileUploadUI.updateCommentCount(e.target),o.querySelector('[id="wms_forwardinfo"]').innerHTML='<span class="wms_forwardinfoicon"></span><span>'+$WC.I18N("forward.info.notallowed")+"</span>",this.retain_trace=!1):"selectrecipant"==s?40==e.keyCode||38==e.keyCode?this.handleNavigation(e):13==e.keyCode?(t=this.getSelectedRecipient(),this.insertSuggestion(t,!0)):27==e.keyCode?""==t.textContent?this.cancelFileForward(a):"block"===i.style.display?this.closeRecipientList():t.textContent="":this.populateRecipant():27==e.keyCode?t.value?(t.value="",WmsFileUploadUI.updateCommentCount(t)):this.cancelFileForward(a):"search"!==s&&WmsFileUploadUI.updateCommentCount(t)}.bind(this)),o.addEventListener("keydown",function(e){var t=$WC.Util.getEventTarget(e).getAttribute("data-purpose");"keyforward"==t?13==e.keyCode&&(e.ctrlKey||e.metaKey)&&this.createChatAndForward(a,s):"selectrecipant"==t&&13==e.keyCode&&e.preventDefault()}.bind(this)),o.addEventListener("mouseover",function(e){var t=$WC.Util.getEventTarget(e).closest("[data-id]");if(t&&0==t.className.indexOf("wms_menu_item")){var s=document.getElementById("wms-filefrwrdautocomplete").getElementsByClassName("wms-hysearch-result-hover")[0];s&&$WC.Util.removeClass(s,"wms-hysearch-result-hover"),$WC.Util.addClass(t,"wms-hysearch-result-hover")}}.bind(this)),o.querySelector("#wms-fileupldcmt").addEventListener("input",function(e){var t=$WC.Util.getEventTarget(e),s=t.value;WmsFileUploadUI.initiateEmojiPicker(s,o,t)}.bind(this))},createChatAndForward:function(e,t){var s,i=WindowHandler.getWinObjById(e),n=document.getElementById("wms-filefrwrdrecipant"),a=document.getElementById("wms-fileupldcontainer").querySelector('[data-type="file"]'),o=document.getElementById("wms-fileupldfname").value;if(document.getElementById("wms-fileupldcmt")){var r=document.getElementById("wms-fileupldcmt").value.trim();r=Smiley.replaceTextToEnglishCodes(r),r=i.atmentions?$WC.Util.unescapeHTML(WMSUI.atMentions.formatAtMentions(r,i.atmentions,e,!0)):r}if(!this.validate(o,r,n)){$WC.WmsLocalStorage.setItem($WC.Config.get("zuid")+"_allow_forward_info",this.retain_trace);var l,d=n.getAttribute("data-type"),c=d==$WC.WmsConstants.HYBRIDSEARCH.CONTACT||d==$WC.WmsConstants.HYBRIDSEARCH.ORGCONTACT?"im":d==$WC.WmsConstants.HYBRIDSEARCH.CHANNEL?"channel":"chat",m=a.getAttribute("data-url"),u=a.getAttribute("data-fextn"),p=a.getAttribute("data-content"),h=a.getAttribute("data-isv1");s="id="+n.getAttribute("data-userid"),s+="&type="+c+"&mod=att&sid="+encodeURIComponent(WebMessanger.getSid()),r&&(s+="&comment="+encodeURIComponent(r)),this.retain_trace&&(s+="&retain_trace="+this.retain_trace+"&source_chid="+e+"&source_msguid="+encodeURIComponent(t));function g(){400==JSON.parse(this.response)[0].objString.ERRCODE&&WMSUI.showErrorMsg($WC.I18N("Sharing_failed"))}"true"===h?(l={"X-XHR-exception":"true","X-ZCSRF-TOKEN":$WC.Util.getCSRF(),"x-consents-version":"1"},$WC.Ajax.postRequestToChat("v1/attachments/"+m+"/forward",s,null,g,null,null,l)):(l={"X-XHR-exception":"true"},s+="&fname="+o+u+"&url="+m+"&mime="+p,$WC.Ajax.postRequestToChat("fileforward.do",s,null,g,null,null,l)),this.cancelFileForward(e)}},closeRecipientList:function(){var e=document.getElementById("wms-filefrwrdautocomplete");"block"==e.style.display&&(e.innerHTML="",e.style.display="none")},insertSuggestion:function(e,t,s){var i=document.getElementById("wms-filefrwrdrecipant"),n=t?e:$WC.Util.getEventTarget(e),a=n&&n.closest("[data-id]"),o=a?a.getAttribute("data-id"):s.chid,r=a?a.getAttribute("data-dname"):s.dname,l=n&&"usersugg"==n.getAttribute("data-purpose")?n:s?s.imagehtml:a.getElementsByClassName("wms_badge_imgwrapper")[0],d=l.outerHTML||l,c=a?a.getAttribute("data-type"):s.type,m=d+'<span id="wms_filefrwrd_recipient">{{DNAME}}</span><div data-purpose="delsugg" class="wms_filefrwrddel"></div>';i.innerHTML=$WC.template.replace(m,{DNAME:r}),$WC.Util.loadOriginalImage(i),$WC.Util.setAttribute(i,"data-type",c),$WC.Util.setAttribute(i,"data-userid",o),$WC.Util.setAttribute(i,"contenteditable",!1),document.getElementById("wms-filefrwrdautocomplete").style.display="none"},removeSuggestion:function(){var e=document.getElementById("wms-filefrwrdrecipant");e.innerHTML="",$WC.Util.setAttribute(e,"contenteditable",!0),e.removeAttribute("data-userid"),e.removeAttribute("data-type")},handleNavigation:function(e){var t=document.getElementById("wms-filefrwrdautocomplete"),s=t.getElementsByClassName("wms-hysearch-result-hover")[0],i=null;40==e.keyCode?i=s.nextSibling||t.firstChild:38==e.keyCode&&(i=s.previousSibling||t.lastChild),"wms_menu_item_date"==i.className&&(i=40==e.keyCode?i.nextSibling:i.previousSibling||t.lastChild),$WC.Util.bringElemToView(i,e.keyCode),$WC.Util.removeClass(s,"wms-hysearch-result-hover"),$WC.Util.addClass(i,"wms-hysearch-result-hover")},getSelectedRecipient:function(){var e=document.getElementById("wms-filefrwrdautocomplete"),t=e.getElementsByClassName("wms-hysearch-result-hover")[0];return e.setAttribute("style","display:none"),document.getElementById("wms-fileupldcmt").focus(),t},populateRecipant:function(){var e=document.getElementById("wms-filefrwrdautocomplete"),t=$WC.Util.getInnerText(document.getElementById("wms-filefrwrdrecipant"));if(!t)return e.innerHTML="",void(e.style.display="none");e.style.display="block";var s={searchtext:t,inpresultset:$WC.WmsConstants.HYBRIDSEARCH.GENERICLIST,silentload:!0};WmsHybridSearch.getNextResultSet(s),$WC.Util.loadOriginalImage(e),$WC.Util.addEvent(e,"scroll",$WC.Util.loadImageWithDebounce(e)),e.firstChild&&-1==e.firstChild.className.indexOf("wmswms_menu_item_date")&&$WC.Util.addClass(e.firstChild,"wms-hysearch-result-hover")},validate:function(e,t,s){return!(!s||!$WC.Util.isEmptyObject(s.childNodes))&&($WC.$CUtil.setInnerTextById("wms-filefrwrderrormsg",$WC.I18N("fileforward.error.norecipient")),document.getElementById("wms-filefrwrderrormsg").setAttribute("style","display:block"),$WC.Util.addClass(document.getElementById("wms_filefrwrdsugg_wrapper"),"wms_filefrwrderr"),!0)}},WmsHybridSearch=function(){};WmsHybridSearch.tempmsgdetails=[],WmsHybridSearch.hintindex=0,WmsHybridSearch.showUI=function(){$WC.$CUtil.createOverlay(WmsHybridSearch.hideUI),WmsHybridSearch.resshowntext="";var e=document.createElement("div");e.id="wms-hysearch",WmsHybridSearch.keydownlistener=$WC.Util.addEvent(e,"keydown",WmsHybridSearch.handleEvent,!1),WmsHybridSearch.keyuplistener=$WC.Util.addEvent(e,"keyup",WmsHybridSearch.handleKeyUp,!1),e.className="wms-hysearch wms-hvalign",e.className+=WebMessanger.isDarkModeEnabled?" zmNightMode":"",e.className+=WebMessanger.isDNDBackupIconEnabled()?" wms_dnd_backup_icon":"",WebMessanger.rtlmode&&(e.className+=" wms-rtl"),e.style.zIndex=$WC.Config.get("zindex"),e.innerHTML=$WC.template.replace('<div class="wms-hysearch-toppart"><div class="wms_searchicon wms-hysearch-searchicon"></div><div id="wms-hysearch-inpcontainer" class="wms-hysearch-inpcontainer"><input id="wms-hysearch-actualinp" data-selectable="true" data-selected="true" autocomplete="off" required></input><input style="width:0px;opacity:0" id="wms-fakeinput"><label id="wms-hysearch-placeholder" class="wms-hysearch-placeholder"></label></div><div class="wms-hysearch-tipsicon"><div id="wms-hysearch-tips-container" class="wms-hysearch-tips-container" style="display: none;"><div class="wms-hysearch-tips-header">'+$WC.I18N("smartsearch.tips")+'</div><div class="wms-hysearch-tips"><span class="wms-hysearch-tips-desc">'+$WC.I18N("smartsearch.tips.hint1")+'</span><div class="wms-hysearch-tips-content"><span class="wms-hysearch-tips-format wms-hysearch-tips-name">'+$WC.I18N("smartsearch.tips.format.name")+'</span><div class="wms-hysearch-tips-example">'+$WC.I18N("smartsearch.tips.example")+'<span class="wms-hysearch-tips-eg1">'+$WC.I18N("smartsearch.tips.eg1")+'</span><span class="wms-hysearch-tips-eg3">'+$WC.I18N("smartsearch.tips.eg3")+'</span></div></div></div><div class="wms-hysearch-tips"><span class="wms-hysearch-tips-desc">'+$WC.I18N("smartsearch.tips.hint2")+'</span><div class="wms-hysearch-tips-content"><span class="wms-hysearch-tips-format wms-hysearch-tips-name">'+$WC.I18N("smartsearch.tips.format.name1")+'</span><span class="wms-hysearch-tips-format wms-hysearch-tips-name">'+$WC.I18N("smartsearch.tips.format.name2")+'</span><span class="wms-hysearch-tips-format wms-hysearch-tips-title">'+$WC.I18N("smartsearch.tips.format.title")+'</span><span class="wms-hysearch-tips-format wms-hysearch-tips-message">'+$WC.I18N("smartsearch.tips.format.message")+'</span><div class="wms-hysearch-tips-example">'+$WC.I18N("smartsearch.tips.example")+'<span class="wms-hysearch-tips-eg1">'+$WC.I18N("smartsearch.tips.eg4")+'</span><span class="wms-hysearch-tips-eg2">'+$WC.I18N("smartsearch.tips.eg2")+'</span><span class="wms-hysearch-tips-eg3">'+$WC.I18N("smartsearch.tips.eg3")+'</span></div></div></div></div></div><div class="wms-hysearch-closeicon"></div></div><div id="wms-hysearch-rescont" class="wms-hysearch-rescont"><div id="wms-hysearch-defrescont" class="wms-hysearch-defrescont"></div><div id="wms-hysearch-searchres" class="wms-hysearch-searchres"></div></div>',{}),document.body.appendChild(e);var t=$WC.template.replace('<div class="wms-hysearch-defres" data-selectable="true"><div class="wms-hysearch-resheading">'+$WC.I18N("menuname.chats")+'</div><div id="wms-hysearch-rchats" data-resset="true" class="wms-hysearch-resset"></div></div>',{}),s=$WC.template.replace('<div class="wms-hysearch-defres" data-selectable="true"><div class="wms-hysearch-resheading">'+$WC.I18N("Contacts")+'</div><div id="wms-hysearch-fcontacts" data-resset="true" class="wms-hysearch-resset"></div></div>',{}),i=$WC.template.replace('<div class="wms-hysearch-defres" data-selectable="true"><div id="wms-hysearch-thirdcolheading" style="visibility:hidden" class="wms-hysearch-resheading">'+$WC.I18N("Contacts")+'</div><div id="wms-hysearch-thirdcol" data-resset="true" class="wms-hysearch-resset"><center><div class="wms_loading_container wms-halign"><div></div><div></div><div></div></div></center></div></div>',{}),n=document.getElementById("wms-hysearch-defrescont");n.insertAdjacentHTML("beforeend",t),"disable"!=$WC.Config.get("contacts")&&n.insertAdjacentHTML("beforeend",s),$WC.Config.get("isOrgUser")()&&"disable"!=$WC.Config.get("channels")&&$WC.SecurityManager.hasPermission("channels")&&!WebMessanger.isPortalUser()&&(n.insertAdjacentHTML("beforeend",i),$WC.Util.addEvent($WC.HybridSearch.getNode("thirdcolumn"),"scroll",$WC.Util.debounce(function(e){WmsHybridSearch.checkScrollAndloadMoreChannels(e)},null,300))),WmsHybridSearch.showRotationalHint(),$WC.Util.addEvent($WC.HybridSearch.getNode("inputcontainer"),"click",WmsHybridSearch.focusInput),$WC.Util.addEvent($WC.HybridSearch.getNode("recentchatsdiv"),"scroll",$WC.Util.debounce(function(e){$WC.Util.loadOriginalImage($WC.HybridSearch.getNode("recentchatsdiv")),WmsHybridSearch.checkScrollAndloadMoreChatlist(e)},null,300)),WmsHybridSearch.populateRecentChatsInSmartChat(),WmsHybridSearch.bindEvents(),"disable"!=$WC.Config.get("contacts")&&($WC.Util.addEvent($WC.HybridSearch.getNode("freqcontactsdiv"),"scroll",$WC.Util.loadImageWithDebounce($WC.HybridSearch.getNode("freqcontactsdiv"))),$WC.Util.addEvent($WC.HybridSearch.getNode("freqcontactsdiv"),"click",function(e){var t=e.target.closest("[data-id]");e.target.getAttribute("data-operation")?WmsContacts.handleInviteOperation(e.target):t&&WmsHybridSearch.handleSelection(t)}),WmsHybridSearch.populateFrequentContactsInSmartChat(),setTimeout(function(){$WC.Util.loadOriginalImage($WC.HybridSearch.getNode("freqcontactsdiv"))},300)),$WC.Config.get("isOrgUser")()&&"disable"!=$WC.Config.get("channels")&&$WC.SecurityManager.hasPermission("channels")&&!WebMessanger.isPortalUser()&&($WC.Channels.initChannels(),WmsHybridSearch.populateThirdColumnInSmartChat(),$WC.Util.addEvent($WC.HybridSearch.getNode("thirdcolumn"),"scroll",$WC.Util.loadImageWithDebounce($WC.HybridSearch.getNode("thirdcolumn")))),document.getElementById("wmstoolbar")&&$WC.Bots.initBots(),$WC.Util.addEvent($WC.HybridSearch.getNode("searchresultdiv"),"scroll",$WC.Util.loadImageWithDebounce($WC.HybridSearch.getNode("searchresultdiv"))),WmsHybridSearch.focusInput()},WmsHybridSearch.populateThirdColumnInSmartChat=function(){$WC.Config.get("isRegistered")()&&$WC.Config.get("isOrgUser")()&&"disable"!=$WC.Config.get("channels")&&$WC.SecurityManager.hasPermission("channels")&&WmsHybridSearch.populateActiveChannels()},$WC.Util.pubsub.subscribe("/chatlist/updateui",function(e,t){var s=t&&t.reqid;t.stat===$WC.WmsConstants.REQSTATUS.FAILED?$WC.HybridSearch.updateManager("failureupdate",null,s):$WC.HybridSearch.updateManager("update",null,s)}),$WC.Util.pubsub.subscribe("/bots/updateui",function(){var e={suggestions:"show_suggestions"};silent||$WC.Config.get("customContacts")||(WmsHybridSearch.populateContactListInMainUI(!0,e),$WC.HybridSearch.getCurrentModule()===$WC.WmsConstants.HYBRIDSEARCH.modules.SMARTCHAT&&WmsHybridSearch.populateFrequentContactsInSmartChat())}),$WC.Util.pubsub.subscribe("/channels/updateui",function(e,t){var s=t&&t.reqid;t.stat===$WC.WmsConstants.REQSTATUS.FAILED?$WC.HybridSearch.updateManager("failureupdate",null,s):$WC.HybridSearch.updateManager("update",null,s),$WC.HybridSearch.getCurrentModule()===$WC.WmsConstants.HYBRIDSEARCH.modules.SMARTCHAT&&(WmsHybridSearch.populateActiveChannels(),WmsHybridSearch.populateRecentChatsInSmartChat()),!document.getElementById("wmstoolbar")&&!WebMessanger.is_custom_menu_opted||($WC.HybridSearch.getSearchText()||$WC.HybridSearch.populateRecentChats(null,$WC.WmsConstants.HYBRIDSEARCH.modules.CHATMENU),WmsHybridSearch.populateGroupResultInMainUI(),void 0!==WmsMainUI&&(WmsMainUI.updateLoadingForPinnedChats(!1),$WC.Util.loadOriginalImage(WmsMainUI.defaultgrouplist)))}),$WC.Util.pubsub.subscribe("/orgcontacts/updateui",function(e,t){var s=t&&t.reqid;t.stat===$WC.WmsConstants.REQSTATUS.FAILED?$WC.HybridSearch.updateManager("failureupdate",null,s):$WC.HybridSearch.updateManager("update",null,s)}),$WC.Util.pubsub.subscribe("/orgcontacts/suggestionui",function(e,t){var s={};t.stat===$WC.WmsConstants.REQSTATUS.FAILED?s.suggestions="suggestion_req_failed":s.suggestions="show_suggestions",_WMSEMPTYBAR||silent||$WC.Config.get("customContacts")||WmsHybridSearch.populateContactListInMainUI(!0,s)}),$WC.Util.pubsub.subscribe("/recentchats/updateui",function(e,t){document.getElementById("wms-hysearch")&&$WC.HybridSearch.populateRecentChats(t,$WC.WmsConstants.HYBRIDSEARCH.modules.SMARTCHAT),!document.getElementById("wmstoolbar")&&!WebMessanger.is_custom_menu_opted||$WC.HybridSearch.populateRecentChats(t)}),WmsHybridSearch.populateSuggestionList=function(e){var t="",s='<div class="wms_menu_subheading" >'+$WC.I18N("chat.suggestions")+"</div>";if(e){var i='<span data-retry="true">'+$WC.I18N("suggestions.retry")+"</span>";t+=s,t+='<div class="wms-suggestions-failed">'+$WC.I18N("suggestions.failed",i)+"</div>"}else if(WmsOrgContacts.checkAndUpdateContactsList(),0<$WC.Util.getObjectLength(WmsOrgContacts.getOrgContactsList())){var n={USERID:$WC.HybridSearch.generateContactResults(null,!0).map(function(e){return e.USERID})},a=$WC.HybridSearch.generateOrgContactResults("","",n,!0);0<$WC.Util.getObjectLength(a)&&(t+=s,t+=$WC.HybridSearch.generateHtml(a))}return t},WmsHybridSearch.focusInput=function(){setTimeout(function(){$WC.HybridSearch.getNode("inputdiv").focus()},1)},WmsHybridSearch.hideUI=function(){$WC.$CUtil.removeEvent(document,"keydown",WmsHybridSearch.keydownlistener),$WC.$CUtil.removeEvent(document,"keyup",WmsHybridSearch.keyuplistener),$WC.$CUtil.removeOverlay(),$WC.HybridSearch.getNode("mainUI")&&Gator($WC.HybridSearch.getNode("mainUI")).off(),$WC.Util.removeElement($WC.HybridSearch.getNode("mainUI")),WmsHybridSearch.hintindex++},WmsHybridSearch.createInnerSearchFragment=function(e,t,s){var i="wms-hysearch-chosentext";"user"===t&&(i+=" wms-hysearch-atmen"),"topic"===t&&(i+=" wms-hysearch-topic");return $WC.template.replace('<span data-id="{{id}}" class="{{classname}}" data-innerfrag="true" data-selectable="true" data-type={{type}}>{{name}}<span class="wms-hysearch-chosentext-closeicon" data-innerfragclose="true"></span></span>',{id:s,name:e,classname:i,type:t})},WmsHybridSearch.showCloseIcon=function(e){WmsHybridSearch.resetChosenClose(),$WC.Util.addClass(e,"wms-hysearch-chosentext-close")},WmsHybridSearch.hideCloseIcon=function(e){$WC.Util.removeClass(e,"wms-hysearch-chosentext-close")},WmsHybridSearch.resetChosenClose=function(){var e=$WC.HybridSearch.getNode("inputcontainer").getElementsByClassName("wms-hysearch-chosentext-close");if(e.length){e=$WC.Util.convertToArray(e);for(var t=0;t<e.length;t++)$WC.Util.removeClass(e[t],"wms-hysearch-chosentext-close")}},WmsHybridSearch.removeChosenText=function(e,t){$WC.Util.removeElement(t.parentNode),WmsHybridSearch.getNextResultSet()},WmsHybridSearch.toggleTipsUI=function(){var e=document.getElementById("wms-hysearch-tips-container");"none"===e.style.display?e.style.display="block":e.style.display="none"},WmsHybridSearch.virtual_list_objs=[],WmsHybridSearch.populateContactsUsingVirtualList=function(e,t,c,s,i,n){var m=$WC.HybridSearch.generateContactResults(null,!0);if($WC.Config.get("isOrgUser")()&&n&&n.suggestions&&m.length<10){var a=n.suggestions;if("suggestion_req_failed"===a)m.push("suggestions"),m.push("suggestions_failed");else if("show_suggestions"===a){WmsOrgContacts.checkAndUpdateContactsList();var o={USERID:m.map(function(e){return e.USERID})},r=$WC.HybridSearch.generateOrgContactResults("","",o,!0);r.length&&(m.push("suggestions"),m=m.concat(r))}else"suggestions_heading"===a&&m.push("suggestions_heading")}WmsHybridSearch.virtual_list_objs[i]&&WmsHybridSearch.virtual_list_objs[i].remove_event_listeners(),m.length&&(WmsHybridSearch.virtual_list_objs[i]=new $WC.VirtualList({w:e,h:t,itemHeight:c,totalRows:m.length,generatorFn:function(e){var t=m[e],s="",i=$WC.WmsConstants.HYBRIDSEARCH.modules.CONTACTMENU,n=$WC.HybridSearch.getResultInfo(t._filtertype),a=$WC.HybridSearch.getDescription(t);if(t.ISBOT)s=$WC.HybridSearch.createResultFragment(t.USERID,t.DNAME,$WC.Util.safeHTML($WC.Util.unescapeHTML(t.STATUSMSG)),$WC.Bots.getPhoto(t.USERID),n,$WC.WmsConstants.HYBRIDSEARCH.BOT,null,null,t,i);else if(t.USERID)s=$WC.HybridSearch.createResultFragment(t.USERID,t.DNAME,$WC.Util.safeHTML($WC.Util.unescapeHTML(a)),null,n,$WC.WmsConstants.HYBRIDSEARCH.CONTACT,null,null,null,i);else if("suggestions"==t)s='<div class="wms_menu_subheading" data-heading="suggestions" data-show="false">'+$WC.I18N("chat.suggestions")+"</div>";else if("suggestions_heading"==t)s='<div class="wms_menu_subheading" data-heading="suggestions" data-show="true">'+$WC.I18N("chat.suggestions")+"</div>";else{var o='<span data-retry="true">'+$WC.I18N("suggestions.retry")+"</span>";s='<div class="wms-suggestions-failed">'+$WC.I18N("suggestions.failed",o)+"</div>"}var r=document.createElement("div");r.innerHTML=s;var l,d=r.firstChild;return l=t.USERID?$WC.HybridSearch.getCurrentModule()==$WC.WmsConstants.HYBRIDSEARCH.modules.SMARTCHAT?103-c:77-c:29-c,"wms_menu_item"!=d.className&&"wms-hysearch-result"!=d.className&&(d=[d,l]),d},container:s,hoverFunction:function(e){var t=e.target?e.target.closest("[data-id]"):e;t&&$WC.HybridSearch.changeHover(t)}}))},WmsHybridSearch.populateFrequentContactsInSmartChat=function(){if(!(silent||WebMessanger.isChatPaused()||_WMSEMPTYBAR)){var e=$WC.HybridSearch.getNode("freqcontactsdiv");$WC.Util.getObjectLength(WmsContacts.getContactsList())||$WC.Util.getObjectLength(WmsOrgContacts.getOrgContactsList())||$WC.Util.getObjectLength($WC.Bots.getList(!0))?(e.innerHTML="",WmsHybridSearch.populateContactsUsingVirtualList(325,370,62,e,"smartchat")):e.innerHTML='<div class="wms-welcome-msg">'+$WC.I18N("contacts.welcomemessage")+"</div>"}},WmsHybridSearch.populateRecentChatsInSmartChat=function(e){$WC.HybridSearch.populateRecentChats(e,$WC.WmsConstants.HYBRIDSEARCH.modules.SMARTCHAT)},WmsHybridSearch.checkScrollAndloadMoreChatlist=function(e){var t=e.target;("wms-hysearch-rchats"==t.id||!1===$WC.HybridSearch.isUnreadFilterOpen())&&t.scrollTop+t.clientHeight>Math.floor(.75*t.scrollHeight)&&$WC.RecentChats.loadPreviousChatList()},WmsHybridSearch.checkScrollAndloadMoreChannels=function(e){var t=e.target;t.scrollTop+t.clientHeight>Math.floor(.75*t.scrollHeight)&&$WC.Channels.fetchNextResultSet()},WmsHybridSearch.populateActiveChannels=function(){if($WC.Channels.getLastFetchedTime()){var e=$WC.Channels.getJoinedChannels($WC.Util.getObjectLength($WC.Channels.list));if(e&&e.length){for(var t,s="",i=0;i<e.length;i++)t=e[i].cd||$WC.I18N("channel.nodescription"),s+=$WC.HybridSearch.createResultFragment(e[i].chid,$WC.Channels.getChannelName(e[i].chid),$WC.Util.safeHTML(t),$WC.Channels.getChannelImageHTML(e[i].chid),null,$WC.WmsConstants.HYBRIDSEARCH.CHANNEL);$WC.$CUtil.setInnerText($WC.HybridSearch.getNode("thirdcolumnheading"),$WC.I18N("menuname.channelsandgroups")),$WC.HybridSearch.getNode("thirdcolumnheading").style.visibility="visible",$WC.HybridSearch.getNode("thirdcolumn").innerHTML=s,$WC.Channels.getNextToken()&&$WC.HybridSearch.updateLoadingStatus($WC.HybridSearch.getNode("thirdcolumn"),$WC.WmsConstants.REQSTATUS.LOADING),$WC.Util.loadOriginalImage($WC.HybridSearch.getNode("thirdcolumn"))}else $WC.HybridSearch.getNode("thirdcolumnheading")&&$WC.Util.removeElement($WC.HybridSearch.getNode("thirdcolumnheading").parentNode)}},WmsHybridSearch.toggleUI=$WC.Util.debounce(function(){null===$WC.HybridSearch.getNode("mainUI")?("undefined"!=typeof WmsProfileInfo&&WmsProfileInfo.unmountComponent(),WmsHybridSearch.showUI()):WmsHybridSearch.hideUI()},null,300,!0),WmsHybridSearch.handleClick=function(e){WmsHybridSearch.handleSelection(e)},WmsHybridSearch.generateFreqContactResults=function(){var e=WmsContacts.getSortedContacts("UC",!0,null,WmsContacts.getContactsList().length),t="";if(0===e.length)t='<span class="wms-hysearch-infotxt">'+$WC.I18N("contacts.frequent.none")+"</span>";else for(var s=0;s<e.length;s++)e[s].ISBOT?t+=$WC.HybridSearch.createResultFragment(e[s].USERID,e[s].DNAME,e[s].EMAILID,null,null,$WC.WmsConstants.HYBRIDSEARCH.CONTACT,null,null,e[s]):t+=$WC.HybridSearch.createResultFragment(e[s].USERID,e[s].DNAME,e[s].EMAILID,null,null,$WC.WmsConstants.HYBRIDSEARCH.CONTACT);return t},WmsHybridSearch.handleEvent=function(){function t(e){var t,s,i,n=$WC.HybridSearch.getNode("resultcontainer");if(i="block"===getComputedStyle($WC.HybridSearch.getNode("searchresultdiv")).display?$WC.HybridSearch.getNode("searchresultdiv").getElementsByClassName("wms-hysearch-result-select")[0]:$WC.HybridSearch.getNode("defaultresultdiv").getElementsByClassName("wms-hysearch-result-select")[0],!$WC.HybridSearch.getNode("inputcontainer").querySelectorAll("[data-type='user'],[data-type='topic']").length||e!==$WC.WmsConstants.KEYCODES.LEFT&&e!==$WC.WmsConstants.KEYCODES.RIGHT){if(i){if($WC.HybridSearch.resetHover(),e===$WC.WmsConstants.KEYCODES.LEFT||e===$WC.WmsConstants.KEYCODES.RIGHT)if($WC.HybridSearch.getCurrentModule()===$WC.WmsConstants.HYBRIDSEARCH.modules.SMARTCHAT){s=n.firstChild,i&&(s=i.parentNode.parentNode);var a=i.getBoundingClientRect(),o={x:a.left+s.offsetWidth/2,y:a.top+i.offsetHeight/2},r=$WC.Util.convertToArray(s.parentNode.children),l=r.indexOf(s)+1;e===$WC.WmsConstants.KEYCODES.LEFT?1===l?o.x+=(r.length-1)*s.offsetWidth:o.x-=s.offsetWidth:e===$WC.WmsConstants.KEYCODES.RIGHT&&(l===r.length?o.x-=(r.length-1)*s.offsetWidth:o.x+=s.offsetWidth),null===(t=document.elementFromPoint(o.x,o.y)).getAttribute("data-id")&&(t=t.closest("[data-id]"))}else t=i;else if(e===$WC.WmsConstants.KEYCODES.UP||e===$WC.WmsConstants.KEYCODES.DOWN)if($WC.HybridSearch.getCurrentModule()!==$WC.WmsConstants.HYBRIDSEARCH.modules.SMARTCHAT&&$WC.HybridSearch.getCurrentModule()!==$WC.WmsConstants.HYBRIDSEARCH.modules.CONTACTMENU&&$WC.HybridSearch.getCurrentModule()!==$WC.WmsConstants.HYBRIDSEARCH.modules.CHATMENU||!(i==i.parentNode.querySelector("[data-id]")&&e===$WC.WmsConstants.KEYCODES.UP||i==i.parentNode.lastChild&&e===$WC.WmsConstants.KEYCODES.DOWN))t=$WC.$CUtil.getConditionalNextNode(i,e,"data-type");else{var d=i.closest("[data-menu]");if(e===$WC.WmsConstants.KEYCODES.UP){var c=d&&d.previousSibling;c&&"wms_menu_pinnedchats"===c.id&&(c=c.previousSibling);var m=c&&c.querySelectorAll("[data-type]");t=m&&m[m.length-1]||i}else{var u=d&&d.nextSibling;u&&"wms_menu_pinnedchats"===u.id&&(u=u.nextSibling),t=u&&u.querySelector("[data-type]")||i}}else e===$WC.WmsConstants.KEYCODES.TAB&&$WC.HybridSearch.getCurrentModule()===$WC.WmsConstants.HYBRIDSEARCH.modules.SMARTCHAT&&(s=n.firstChild,i&&(s=i.parentNode.parentNode),t=$WC.$CUtil.getConditionalNextNode(s,e,"data-selectable").querySelector("[data-resset]").querySelector("[data-id]"));t&&$WC.Util.bringElemToView(t,e)}else t=$WC.HybridSearch.getCurrentModule()===$WC.WmsConstants.HYBRIDSEARCH.modules.SMARTCHAT?"block"===getComputedStyle($WC.HybridSearch.getNode("searchresultdiv")).display?$WC.HybridSearch.getNode("searchresultdiv").firstChild:n.firstChild.getElementsByClassName("wms-hysearch-result")[0]:"block"===getComputedStyle($WC.HybridSearch.getNode("searchresultdiv")).display?$WC.HybridSearch.getNode("searchresultdiv").querySelector("[data-type]"):$WC.HybridSearch.getNode("defaultresultdiv").querySelector('[data-type][class="wms_menu_item"]');t&&$WC.HybridSearch.changeHover(t)}else{var p=$WC.HybridSearch.getNode("inputcontainer").querySelector("[data-selected='true']");if(p){WmsHybridSearch.resetChosenClose(),p.setAttribute("data-selected","false");var h=$WC.$CUtil.getConditionalNextNode(p,e,"data-selectable");h.setAttribute("data-selected","true"),"INPUT"===p.nodeName&&(p.blur(),$WC.HybridSearch.getNode("fakeinput").focus()),"INPUT"!==h.nodeName?WmsHybridSearch.showCloseIcon(h):h.focus(),$WC.Util.bringElemToView(h,e,!0)}}}return function(e){""===$WC.HybridSearch.getSearchText()&&(WmsHybridSearch.removesearchpart=!0),(!$WC.Util.isEmptyString($WC.HybridSearch.getSearchText())||e.keyCode!==$WC.WmsConstants.KEYCODES.LEFT&&e.keyCode!==$WC.WmsConstants.KEYCODES.RIGHT)&&e.keyCode!==$WC.WmsConstants.KEYCODES.UP&&e.keyCode!==$WC.WmsConstants.KEYCODES.DOWN&&e.keyCode!==$WC.WmsConstants.KEYCODES.TAB||t(e.keyCode),$WC.$CUtil.preventHandlingTabUpDownEnter(e)}}(),WmsHybridSearch.removesearchpart=!1,WmsHybridSearch.handleKeyUp=function(e){""!==WmsHybridSearch.resshowntext&&WmsHybridSearch.resshowntext===$WC.HybridSearch.getSearchText()&&e.keyCode!==$WC.WmsConstants.KEYCODES.ENTER&&e.keyCode!==$WC.WmsConstants.KEYCODES.BACKSPACE||(WmsHybridSearch.resshowntext=$WC.HybridSearch.getSearchText(),WmsHybridSearch.parseTextInput(e.keyCode))},WmsHybridSearch.parseTextInput=function(e){var t=$WC.HybridSearch.getSearchText();if(e===$WC.WmsConstants.KEYCODES.BACKSPACE&&$WC.Util.isEmptyString($WC.HybridSearch.getSearchText())){var s=$WC.HybridSearch.getNode("inputcontainer").getElementsByClassName("wms-hysearch-chosentext-close");if(1===s.length)$WC.Util.removeElement(s[0]),WmsHybridSearch.focusInput(),$WC.HybridSearch.getNode("inputdiv").setAttribute("data-selected","true");else if(!0===WmsHybridSearch.removesearchpart){WmsHybridSearch.removesearchpart=!1,$WC.HybridSearch.getNode("inputdiv").setAttribute("data-selected","false");var i=$WC.HybridSearch.getNode("inputcontainer").querySelectorAll("[data-type]");i.length&&(i[i.length-1].setAttribute("data-selected",!0),$WC.Util.addClass(i[i.length-1],"wms-hysearch-chosentext-close"))}}e===$WC.WmsConstants.KEYCODES.ENTER?WmsHybridSearch.handleSelection():t?($WC.HybridSearch.getCurrentModule()===$WC.WmsConstants.HYBRIDSEARCH.modules.SMARTCHAT&&(WmsHybridSearch.removesearchpart=!1,WmsHybridSearch.resetChosenClose()),$WC.HybridSearch.getNode("defaultresultdiv").style.display="none",$WC.HybridSearch.getNode("searchresultdiv").style.display="block",void 0!==WmsMainUI&&WmsMainUI.updateLoadingForPinnedChats(!1),WmsHybridSearch.getNextResultSet(),$WC.HybridSearch.getNode("searchresultdiv").querySelector("[data-type]")&&$WC.HybridSearch.changeHover($WC.HybridSearch.getNode("searchresultdiv").querySelector("[data-type]"))):WmsHybridSearch.getNextResultSet()},WmsHybridSearch.handleSelection=function(e){var t,s=$WC.HybridSearch.getSearchText(),i=(e=e||("block"===getComputedStyle($WC.HybridSearch.getNode("searchresultdiv")).display?$WC.HybridSearch.getNode("searchresultdiv").getElementsByClassName("wms-hysearch-result-select")[0]:$WC.HybridSearch.getNode("defaultresultdiv").getElementsByClassName("wms-hysearch-result-select")[0]))&&+e.getAttribute("data-type");if(e&&"wms_menu_feedsnotify"===e.getAttribute("data-id"))ZMSGUI.launchHistory();else if($WC.HybridSearch.getCurrentModule()===$WC.WmsConstants.HYBRIDSEARCH.modules.SMARTCHAT){var n=$WC.HybridSearch.getNode("inputcontainer").querySelector("[data-type='topic']");if(e&&"true"===e.getAttribute("data-retry"))$WC.HybridSearch.invokeRetry();else if(i===$WC.WmsConstants.HYBRIDSEARCH.CHAT||i===$WC.WmsConstants.HYBRIDSEARCH.CHANNEL)WmsHybridSearch.parseAndOpenChat(e,$WC.WmsConstants.HYBRIDSEARCH.modules.SMARTCHAT);else if(s.startsWith("#")&&1==$WC.HybridSearch.getChosenUsers().length||n&&1==$WC.HybridSearch.getChosenUsers().length&&!s.startsWith("@"))WmsHybridSearch.showInfoMessage($WC.I18N("Error"),$WC.I18N("topic.not.allowed"));else if(s.startsWith("#")&&WmsUIImpl.getChatBarOptions()&&"disable"===WmsUIImpl.getChatBarOptions().adhocchats)WmsHybridSearch.showInfoMessage($WC.I18N("Error"),$WC.I18N("adhocchats.not.allowed"));else if(e&&s.startsWith("@")){var a=e.getElementsByClassName("wms-hysearch-result-name")[0];a=$WC.Util.getInnerText(a),t=e.getAttribute("data-id"),$WC.HybridSearch.getNode("inputdiv").insertAdjacentHTML("beforebegin",WmsHybridSearch.createInnerSearchFragment("@"+a,"user",t)),$WC.HybridSearch.getNode("inputdiv").value="",$WC.HybridSearch.getNode("inputdiv").focus(),WmsHybridSearch.resshowntext="",WmsHybridSearch.getNextResultSet()}else if(n&&s.startsWith("#"))WmsHybridSearch.showInfoMessage($WC.I18N("Error"),$WC.I18N("topic.alreadyselected"));else if(n&&0===$WC.HybridSearch.getChosenUsers().length)WmsHybridSearch.showInfoMessage($WC.I18N("Error"),$WC.I18N("topic.nouser"));else if(!n&&s.startsWith("#")){var o=$WC.HybridSearch.getNode("inputdiv").value;$WC.HybridSearch.getNode("inputdiv").insertAdjacentHTML("beforebegin",WmsHybridSearch.createInnerSearchFragment(o,"topic")),$WC.HybridSearch.getNode("inputdiv").value="",$WC.HybridSearch.getNode("inputdiv").focus(),WmsHybridSearch.resshowntext="",WmsHybridSearch.getNextResultSet()}else e&&WmsContacts.isInvitedContact(e.getAttribute("data-id"))?(WmsHybridSearch.hideUI(),void 0!==WmsMainUI&&WmsMainUI.showPendingInvitations()):WmsHybridSearch.parseAndOpenChat(e,$WC.WmsConstants.HYBRIDSEARCH.modules.SMARTCHAT)}else if(e&&"true"===e.getAttribute("data-retry"))$WC.HybridSearch.invokeRetry();else if(e&&"addcontact"===e.getAttribute("data-operation"))t=e.getAttribute("data-id")||e.getAttribute("data-dname"),WMSUI.inviteMember(t,t),WmsMainUI.resetToDefaultUI();else{t=e.getAttribute("data-id");var r=e.getAttribute("data-chid"),l=!1;$WC.Config.get("customContacts")&&(l=WmsImplHandler.invokeSynchronously($WC.Config.get("customContacts").customContactClick,t,e),WMSUI.handleChatExist(r)),l||WmsContacts.isInvitedContact(t)||WmsHybridSearch.parseAndOpenChat(e)}$WC.HybridSearch.getNode("inputdiv")&&$WC.Util.bringElemToView($WC.HybridSearch.getNode("inputdiv"),$WC.WmsConstants.KEYCODES.RIGHT,!0)},WmsHybridSearch.parseAndOpenChat=function(e,t){var s,i,n,a,o,r,l,d,c,m=$WC.HybridSearch.getNode("inputcontainer")&&$WC.HybridSearch.getNode("inputcontainer").querySelectorAll("[data-type='user']")||[],u=$WC.HybridSearch.getNode("inputcontainer")&&$WC.HybridSearch.getNode("inputcontainer").querySelector("[data-type='topic']"),p=[];if(m.length&&(i=$WC.Util.convertToArray(m).map(function(e){return e.getAttribute("data-id")})),u&&(n=$WC.Util.getInnerText(u).slice(1)),i&&(l=$WC.WmsConstants.HYBRIDSEARCH.CONTACT,r=i.join(","),1<i.length&&!n&&(i.forEach(function(e){p.push({zuid:e})}),n=WmsHybridSearch.createChatTitle(p)),s=$WC.HybridSearch.getSearchText(),WmsHybridSearch.tempmsgdetails.push(s)),e)if(+e.getAttribute("data-type")===$WC.WmsConstants.HYBRIDSEARCH.CONTACT||+e.getAttribute("data-type")===$WC.WmsConstants.HYBRIDSEARCH.ORGCONTACT)r=e.getAttribute("data-id"),l=$WC.WmsConstants.HYBRIDSEARCH.CONTACT;else if(+e.getAttribute("data-type")===$WC.WmsConstants.HYBRIDSEARCH.BOT)r=e.getAttribute("data-id"),l=$WC.WmsConstants.HYBRIDSEARCH.BOT;else if(+e.getAttribute("data-type")===$WC.WmsConstants.HYBRIDSEARCH.GROUP)d=e.getAttribute("data-id"),l=$WC.WmsConstants.HYBRIDSEARCH.GROUP;else if(+e.getAttribute("data-type")===$WC.WmsConstants.HYBRIDSEARCH.CHAT)a=e.getAttribute("data-id"),l=$WC.WmsConstants.HYBRIDSEARCH.CHAT;else if(+e.getAttribute("data-type")===$WC.WmsConstants.HYBRIDSEARCH.CHANNEL)o=e.getAttribute("data-id"),c=e.getAttribute("data-oc_id"),l=$WC.WmsConstants.HYBRIDSEARCH.CHANNEL;else if(+e.getAttribute("data-type")===$WC.WmsConstants.HYBRIDSEARCH.ADDCONTACT){var h=e.closest("[data-operation]");l=$WC.WmsConstants.HYBRIDSEARCH.ADDCONTACT}else+e.getAttribute("data-type")===$WC.WmsConstants.HYBRIDSEARCH.THREAD&&(a=e.getAttribute("data-id"),l=$WC.WmsConstants.HYBRIDSEARCH.THREAD);if(l){if(void 0!==WmsMainUI){if(a)var g=a;else if(o)g=o;else if(r&&$WC.Bots.getList(!0)[r])g=$WC.Bots.getList(!0)[r].CHID;else g=r;WmsMainUI.scheduleAutoFocus(g)}WmsHybridSearch.hideUI(),"disable"==$WC.Config.get("adhocchats")&&i&&1<i.length||WmsHybridSearch.checkAndOpenChat(l,r,n,s,d,o,a,h,t,c),void 0!==WmsMainUI&&WmsMainUI.resetToDefaultUI()}else WmsHybridSearch.showInfoMessage($WC.I18N("Error"),$WC.I18N("selection.none"))},WmsHybridSearch.checkAndOpenChat=function(e,t,s,i,n,a,o,r,l,d){var c;if((o=o||WebMessanger.ucmap[t]||WebMessanger.ucmap[n]||a||$WC.RecentChats.getChidFor121UnreadChat(t))&&WMSUI.handleChatExist(o),o&&$WC.RecentChats.get(o)&&$WC.RecentChats.get(o).LASTSEEN&&($WC.RecentChats.get(o).uc_useropened=!0),l=l==$WC.WmsConstants.HYBRIDSEARCH.modules.SMARTCHAT?"smartchat":"mainui",e===$WC.WmsConstants.HYBRIDSEARCH.BOT){var m=$WC.Bots.get(t);if(m)if(m.ISSUBSCRIBED)WebMessanger.createChatWindowFromCache(m.CHID,l);else{var u={bodyhtml:'<div class="wms-dialog-txtcont">'+$WC.Util.safeHTML($WC.I18N("bot.subscribe.confirm",m.DNAME))+"</div>",focusbutton:2,operations:[{name:$WC.I18N("bot.action.subscribe"),action:function(){WmsMainUI.scheduleAutoFocus(t),$WC.Bots.subscribe(t),WmsDialog.removeModal()}},{name:$WC.I18N("Cancel"),classname:"wms-dialog-rejectbtn",action:function(){WmsDialog.removeModal()}}]};WmsDialog.showModal(u)}}else if(e===$WC.WmsConstants.HYBRIDSEARCH.CONTACT){if(s&&(c=!0),"1"==t.split(",").length&&!$WC.SecurityManager.hasPermission("direct_message"))return void $WC.SecurityManager.handleError({message:$WC.I18N("module.disabled.directmsg")});!c&&o&&i?Chat.isExists(o)?Message.send(o,i):(WmsChatCache.remove(o),Message.deletedMessages.remove(o),WebMessanger.openUserChat(t,c,s,i,l)):WebMessanger.openUserChat(t,c,s,i,l)}if(e===$WC.WmsConstants.HYBRIDSEARCH.CHAT&&o)WebMessanger.createChatWindowFromCache(o,l);else if(e===$WC.WmsConstants.HYBRIDSEARCH.CHANNEL&&a)if(!1===$WC.Channels.isJoinedChannel(a)){var p=$WC.Channels.get(a).un;WebMessanger.fetchChannelDetails(p)}else WebMessanger.createChatWindowFromCache(a,l);else if(e===$WC.WmsConstants.HYBRIDSEARCH.ADDCONTACT){var h=r.getAttribute("data-email");WmsHybridSearch.inviteMember(h)}else e===$WC.WmsConstants.HYBRIDSEARCH.THREAD&&WebMessanger.attachSession(o)},WmsHybridSearch.createChatTitle=function(e){var t,s=e.length;return 1<s&&(t=$WC.Util.getContactName(e[0].zuid,e[0].dname)+", "+$WC.Util.getContactName(e[1].zuid,e[1].dname)+" & ",2===s?t+=WebMessanger.getNickName():2<s&&(t+=s-1+" "+$WC.I18N("more"))),t},WmsHybridSearch.getNextResultSet=function(e){var t,s=e&&e.inpresultset||WmsHybridSearch.decideResultSet(),i=$WC.HybridSearch.getNode("searchresultdiv"),n=e&&e.searchtext||$WC.HybridSearch.getSearchText();if(s===$WC.WmsConstants.HYBRIDSEARCH.EMPTY)i.innerHTML="";else if(s===$WC.WmsConstants.HYBRIDSEARCH.EMPTYUSERHINT)i.innerHTML="",WmsHybridSearch.setPlaceHolderHint($WC.I18N("hint.chooseuser"));else if(s===$WC.WmsConstants.HYBRIDSEARCH.EMPTYTITLEHINT)i.innerHTML="",WmsHybridSearch.setPlaceHolderHint($WC.I18N("hint.choosetopic"));else if(s===$WC.WmsConstants.HYBRIDSEARCH.EMPTYMSGHINT)i.innerHTML="",WmsHybridSearch.setPlaceHolderHint($WC.I18N("hint.sendmessage"));else if(s===$WC.WmsConstants.HYBRIDSEARCH.FREQCONTACTS)i.innerHTML=$WC.HybridSearch.generateHtml(WmsHybridSearch.generateFreqContactResults());else if(s===$WC.WmsConstants.HYBRIDSEARCH.USERLIST||s===$WC.WmsConstants.HYBRIDSEARCH.USER_CHANNELLIST){n=e&&e.searchtext||$WC.HybridSearch.getPlainSearchText(),t=[],s===$WC.WmsConstants.HYBRIDSEARCH.USER_CHANNELLIST&&(t=$WC.HybridSearch.generateChannelResults(n,null,null,null));var a=[];if($WC.Config.get("customContacts")&&!$WC.Config.get("customContacts").separatePane)a=WmsHybridSearch.generateCustomContactResults(n),i.innerHTML=WmsHybridSearch.generateCustomContactsListHtml(a);else{var o={USERID:(a=$WC.HybridSearch.generateContactResults(n)).map(function(e){return e.USERID})},r=a.concat($WC.HybridSearch.generateOrgContactResults(n,!1,o));available_limited_contactlist=$WC.HybridSearch.filter("DNAME",n,r,null,null,"EMAILID","UC",!0),r=10<available_limited_contactlist.length?$WC.HybridSearch.filter("DNAME",n,r,null,null,"EMAILID","UC",!1):available_limited_contactlist;var l=$WC.HybridSearch.generateUnsubscribedBotResults(n,o);r=r.concat(l),e&&e.inpresultset||(i.innerHTML=$WC.HybridSearch.generateHtml(r.concat(t))),(r.length<=10||$WC.Matcher.check("emailid",n,!0))&&$WC.HybridSearch.updateManager("fetch",$WC.WmsConstants.HYBRIDSEARCH.ORGCONTACT,null,null,null,e)}}else if(s===$WC.WmsConstants.HYBRIDSEARCH.CUSTOMCONTACTLIST){n=e&&e.searchtext||$WC.HybridSearch.getPlainSearchText();a=WmsHybridSearch.generateCustomContactResults(n);i.innerHTML=WmsHybridSearch.generateCustomContactsListHtml(a)}else if(s===$WC.WmsConstants.HYBRIDSEARCH.TITLEHINT||s===$WC.WmsConstants.HYBRIDSEARCH.CHANNELLIST)if(""!==(n=$WC.HybridSearch.getPlainSearchText())){if(t=$WC.HybridSearch.generateChannelResults(n),$WC.HybridSearch.getCurrentModule()===$WC.WmsConstants.HYBRIDSEARCH.modules.SMARTCHAT&&s===$WC.WmsConstants.HYBRIDSEARCH.TITLEHINT?i.innerHTML=$WC.HybridSearch.createResultFragment("",n,"","<span></span>",null,$WC.WmsConstants.HYBRIDSEARCH.TITLEHINT)+$WC.HybridSearch.generateHtml(t):i.innerHTML=$WC.HybridSearch.generateHtml(t),t.length<10){var d=s===$WC.WmsConstants.HYBRIDSEARCH.TITLEHINT;$WC.HybridSearch.updateManager("fetch",$WC.WmsConstants.HYBRIDSEARCH.CHANNEL,null,d)}}else i.innerHTML=$WC.HybridSearch.generateHtml($WC.HybridSearch.generateChannelResults("",null,!0));else if(s===$WC.WmsConstants.HYBRIDSEARCH.MESSAGEHINT)i.innerHTML=$WC.HybridSearch.createResultFragment("",n,"","<span></span>","",$WC.WmsConstants.HYBRIDSEARCH.MESSAGEHINT);else if(s===$WC.WmsConstants.HYBRIDSEARCH.GENERICLIST){i.innerHTML="";var c=$WC.HybridSearch.generateSearchResults(n,null,null,null,!0);10<c.length&&(c=$WC.HybridSearch.generateSearchResults(n)),i.innerHTML=$WC.HybridSearch.generateHtml(c),(c.length<10||$WC.Matcher.check("emailid",n,!0))&&$WC.HybridSearch.updateManager("fetch",null,null,!0)}else s===$WC.WmsConstants.HYBRIDSEARCH.DEFAULTRESULT&&(WmsHybridSearch.showRotationalHint(),$WC.HybridSearch.getCurrentModule()===$WC.WmsConstants.HYBRIDSEARCH.modules.SMARTCHAT?$WC.HybridSearch.getNode("defaultresultdiv").style.display="table":$WC.HybridSearch.getNode("defaultresultdiv").style.display="block",i.style.display="none");$WC.Util.loadOriginalImage($WC.HybridSearch.getNode("searchresultdiv"))},WmsHybridSearch.updatePresence=function(t){var e=document.getElementById("wms_menu_listcontainer");if(e){var s=e.querySelectorAll('[data-id="'+t+'"],[data-userid="'+t+'"]'),i=$WC.Util.unescapeHTML(WmsContacts.getStatusMsg(t));(s=$WC.Util.convertToArray(s)).forEach(function(e){e.firstChild.className="wms_badge_imgwrapper wms_badge_statusicon_"+WmsContacts.getStatusClassName(t),e.querySelector("[data-cutouticon]").className="wms_badge_statusicon_"+WmsContacts.getStatusClassName(t)+"_cutout wms_badge_img_cutout",$WC.$CUtil.setInnerText(e.querySelector("[data-smsg]"),i),$WC.Util.setAttribute(e.querySelector("[data-smsg]"),"title",i)})}},WmsHybridSearch.populateContactListInMainUI=function(e,t){if(!WebMessanger.isExclusiveChat()&&(WmsMainUI.decideRepopulate("contactlist")||e)){if(!WebMessanger.is_custom_menu_opted&&(silent||WebMessanger.isChatPaused()||_WMSEMPTYBAR))return;var s=WebMessanger.is_custom_menu_opted?"custom_list":"mainui",i=$WC.HybridSearch.getNode("defaultresultdiv",$WC.WmsConstants.HYBRIDSEARCH.modules.CONTACTMENU);($WC.Util.getObjectLength(WmsContacts.getContactsList())||$WC.Util.getObjectLength(WmsOrgContacts.getOrgContactsList())||$WC.Util.getObjectLength($WC.Bots.getList(!0))||!$WC.WmsOrgContacts.isSuggestionsRequested())&&(i.innerHTML="",WmsHybridSearch.populateContactsUsingVirtualList(238,293,54,i,s,t)),$WC.Util.loadOriginalImage(WmsMainUI.defaultcontactlist),WmsMainUI.setRePopulateStatus("contactlist",!1)}},WmsHybridSearch.populateCustomContactListInMainUI=function(){var e=$WC.Config.get("customContacts").separatePane?$WC.WmsConstants.HYBRIDSEARCH.modules.CUSTOMCONTACTMENU:$WC.WmsConstants.HYBRIDSEARCH.modules.CONTACTMENU,t=$WC.HybridSearch.getNode("defaultresultdiv",e),s=WmsHybridSearch.generateCustomContactResults(null,!0);t.innerHTML="";var i=WmsHybridSearch.generateCustomContactsListHtml(s);t.innerHTML=i,$WC.Util.loadOriginalImage(WmsMainUI.defaultcontactlist)},WmsHybridSearch.populateGroupResultInMainUI=function(){if($WC.HybridSearch.getCurrentModule()!==$WC.WmsConstants.HYBRIDSEARCH.modules.SMARTCHAT&&void 0!==WmsMainUI&&WmsMainUI.decideRepopulate("grouplist")){var e=$WC.HybridSearch.generateHtml($WC.HybridSearch.generateChannelResults("",null,!0));e&&(document.getElementById("wms_menu_grouplist_def").innerHTML=e,$WC.Channels.getNextToken()&&$WC.HybridSearch.updateLoadingStatus(document.getElementById("wms_menu_grouplist_def"),$WC.WmsConstants.REQSTATUS.LOADING))}},WmsHybridSearch.decideResultSet=function(){var e=$WC.HybridSearch.getSearchText();if($WC.HybridSearch.getCurrentModule()===$WC.WmsConstants.HYBRIDSEARCH.modules.CUSTOMCONTACTMENU)return""===e?$WC.WmsConstants.HYBRIDSEARCH.DEFAULTRESULT:$WC.WmsConstants.HYBRIDSEARCH.CUSTOMCONTACTLIST;if($WC.HybridSearch.getCurrentModule()===$WC.WmsConstants.HYBRIDSEARCH.modules.CONTACTMENU)return""===e?$WC.WmsConstants.HYBRIDSEARCH.DEFAULTRESULT:$WC.WmsConstants.HYBRIDSEARCH.USERLIST;if($WC.HybridSearch.getCurrentModule()===$WC.WmsConstants.HYBRIDSEARCH.modules.GROUPMENU)return""===e?$WC.WmsConstants.HYBRIDSEARCH.DEFAULTRESULT:$WC.WmsConstants.HYBRIDSEARCH.CHANNELLIST;var t,s,i=$WC.HybridSearch.getNode("inputcontainer").querySelectorAll("[data-type]");return i.length&&""===e?(t=$WC.HybridSearch.getNode("inputcontainer").querySelectorAll("[data-type='user']"),(s=$WC.HybridSearch.getNode("inputcontainer").querySelector("[data-type='topic']"))&&(!t.length||1==t.length)||1==t.length?$WC.WmsConstants.HYBRIDSEARCH.EMPTYUSERHINT:s&&1<t.length?$WC.WmsConstants.HYBRIDSEARCH.EMPTYMSGHINT:t&&1<t.length?$WC.WmsConstants.HYBRIDSEARCH.EMPTYTITLEHINT:$WC.WmsConstants.HYBRIDSEARCH.EMPTY):""===e?$WC.WmsConstants.HYBRIDSEARCH.DEFAULTRESULT:(t=$WC.HybridSearch.getNode("inputcontainer").querySelector("[data-type='user']"),s=$WC.HybridSearch.getNode("inputcontainer").querySelector("[data-type='topic']"),e.startsWith("@")?0<e.indexOf("#")?$WC.WmsConstants.HYBRIDSEARCH.CHANNELLIST:$WC.WmsConstants.HYBRIDSEARCH.USER_CHANNELLIST:e.startsWith("#")?0<e.indexOf("@")||!t?$WC.WmsConstants.HYBRIDSEARCH.CHANNELLIST:s?$WC.WmsConstants.HYBRIDSEARCH.EMPTY:$WC.WmsConstants.HYBRIDSEARCH.TITLEHINT:t?$WC.WmsConstants.HYBRIDSEARCH.MESSAGEHINT:i.length?$WC.WmsConstants.HYBRIDSEARCH.EMPTY:$WC.WmsConstants.HYBRIDSEARCH.GENERICLIST)},WmsHybridSearch.showInfoMessage=function(){var i;return function(e,t){WmsHybridSearch.hideInfoMessage();var s=$WC.template.replace('<div id="wms-hysearch-infomsg" class="wms-hysearch-infomsg"><div class="wms-shake"><span style="font-weight: bold;">{{heading}}: </span><span>{{msg}}</span></div></div>',{heading:e,msg:t});$WC.HybridSearch.getNode("mainUI").insertAdjacentHTML("beforeend",s),clearTimeout(i),i=setTimeout(WmsHybridSearch.hideInfoMessage,3e3)}}(),WmsHybridSearch.hideInfoMessage=function(){$WC.Util.removeElement($WC.HybridSearch.getNode("infomsgdiv"))},WmsHybridSearch.showRotationalHint=function(){var e=["hint.chatwithmsg","hint.searchtopic"];$WC.Config.get("isOrgUser")()&&"disable"!=$WC.Config.get("channels")&&$WC.SecurityManager.hasPermission("channels")?e.unshift("search.commontitle"):e.unshift("search.contactsandchats"),"disable"!=$WC.Config.get("adhocchats")&&e.push("hint.groupchat"),void 0===e[WmsHybridSearch.hintindex]&&(WmsHybridSearch.hintindex=0);var t=$WC.I18N(e[WmsHybridSearch.hintindex]);WmsHybridSearch.setPlaceHolderHint(t)},WmsHybridSearch.setPlaceHolderHint=function(e){$WC.$CUtil.setInnerTextById("wms-hysearch-placeholder",e)},WmsHybridSearch.inviteMember=function(e){WMSUI.inviteMember(e)},WmsHybridSearch.debouncedRepopulate=$WC.Util.debounce(function(){if(void 0!==WmsMainUI&&!$WC.Config.get("customContacts")){var e={suggestions:"show_suggestions"};WmsHybridSearch.populateContactListInMainUI(!0,e),WmsMainUI.resetToDefaultUI()}},null,5e3,!0),WmsHybridSearch.clearInvite=function(e){e.status==$WC.WmsConstants.CONTACTSTATUS.NOCHAT&&-1===WmsContacts.getPendingInvitedContactsList().indexOf(e.zuid)?WmsContacts.setPendingInvitedContactsList(e.zuid):e.status!=$WC.WmsConstants.CONTACTSTATUS.NOCHAT&&$WC.Util.removeElementFromArray(WmsContacts.getPendingInvitedContactsList(),e.zuid),$WC.Util.removeElementFromArray(WmsContacts.getInvitedContactsList(),e.zuid),document.getElementById("wms-hysearch")&&WmsHybridSearch.populateFrequentContactsInSmartChat(),WmsHybridSearch.debouncedRepopulate()},WmsHybridSearch.showInvite=function(e){if(-1===WmsContacts.getInvitedContactsList().indexOf(e.zuid)&&-1===WmsContacts.getPendingInvitedContactsList().indexOf(e.zuid)&&(WmsContacts.setInvitedContactsList(e.zuid),WmsContacts.setPendingInvitedContactsList(e.zuid)),void 0!==WmsMainUI&&!$WC.Config.get("customContacts")){WmsMainUI.updateChatInvitationCount();var t={suggestions:"show_suggestions"};WmsHybridSearch.populateContactListInMainUI(!0,t)}document.getElementById("wms-hysearch")&&WmsHybridSearch.populateFrequentContactsInSmartChat()},WmsHybridSearch.generateCustomContactResults=function(e,t){var s=[],i=[],n=WmsImplHandler.invokeSynchronously($WC.Config.get("customContacts").customContactsList);if(t)if(s=(s=WmsImplHandler.invokeSynchronously($WC.Config.get("customContacts").invitationsList))||[],$WC.Util.isArray(n))i=s.concat(n);else if($WC.Util.getObjectLength(n)){var a=[];for(var o in n){if($WC.Util.isArray(n[o]))a.push(o),n[o].forEach(function(e){a.push(e)})}i=s.concat(a)}else i=s;else i=WmsImplHandler.invokeSynchronously($WC.Config.get("customContacts").customContactsList,e);return i},WmsHybridSearch.generateCustomContactsListHtml=function(e){var t="";return e.forEach(function(e){t+=function(e){var t,s,i,n,a="wms_menu_item",o="",r="",l="",d="",c="";if("string"==typeof e){return $WC.template.replace('<div class="wms_menu_subheading" data-heading="{{heading}}">{{heading}}</div>',{heading:e})}e.time&&(o='<span class="wms_menu_item_time" title="'+$WC.DateUtil.formatDateWithWords(e.time)+'">'+$WC.DateUtil.formatTime(e.time)+"</span>");var m=WmsImplHandler.invokeSynchronously($WC.Config.get("customContacts").getUnreadCount,e.id)||!1;m?(r='<span style="display:flex" class="wms_menu_item_count" data-unreadcount=true>'+m+"</span>",WmsMainUI.setUnreadCount(e.id,m,$WC.Config.get("customContacts").separatePane)):(r='<span class="wms_menu_item_count" data-unreadcount=true></span>',WmsMainUI.resetUnreadCount(e.id,$WC.Config.get("customContacts").separatePane));WmsMainUI.updateUnreadCountInUI(e.id);var u=WmsImplHandler.invokeSynchronously($WC.Config.get("customContacts").isInvitationPending,e)||!1;u?(c=e.statusMsg?e.statusMsg:e.mailId,a="wms_menu_item_invitations"):c=e.statusMsg;if(i='<div class="'+(c?"wms_menu_item_name wms-truncate-ellipsis":"wms_menu_item_name wms-truncate-ellipsis wms-valign-mid-block")+'" title="{{dname}}">{{dname}}</div>',t=C(e),s='<div class="wms_menu_item_msg wms-truncate-ellipsis" data-smsg="true" title="'+c+'">'+c+"</div>",$WC.Config.get("customContacts").getChatOwner){var p=WmsImplHandler.invokeSynchronously($WC.Config.get("customContacts").getChatOwner,e.id);if(p&&p.id!=$WC.Config.get("zuid"))var h=C(p)}u&&(d='<div class="wms_menu_inv" data-dname="{{dname}}"><span data-customoperation="{{invitationAcceptLabel}}" data-id="{{id}}" data-type="{{type}}" title="{{invitationAcceptLabel}}" class="wms_menu_invaccept" > {{invitationAcceptLabel}} </span><span>  |  </span><span data-customoperation="{{invitationDeclineLabel}}" data-id="{{id}}" data-type="{{type}}" title="{{invitationDeclineLabel}}" class="wms_menu_invreject" > {{invitationDeclineLabel}} </span></div>');h?l='<div class="wms_menu_item_profile_icon_img wms-valign-mid-block" data-zcprofileid="'+e.id+'" style="visibility:visible">'+h+"</div>":m||!0===$WC.Config.get("customContacts").disableProfileIcon||(l='<div class="wms_menu_item_profile_icon wms-valign-mid-block" data-zcprofileid="'+e.id+'"></div>');n='<div class="'+a+'" data-id="{{id}}" data-chid="{{chid}}" data-dname="{{dname}}" data-type="{{type}}">'+t+i+o+s+d+r+l+"</div>";var g=e.invitationActions||$WC.Config.get("customContacts").invitationActions||null,f={id:e.id,chid:e.chid||"",time:e.time,type:$WC.WmsConstants.HYBRIDSEARCH.CONTACT,dname:$WC.Util.unescapeHTML(e.name),invitationAcceptLabel:g?g[0].label:$WC.I18N("Accept"),invitationDeclineLabel:g?g[1].label:$WC.I18N("remind.later")};return $WC.template.replace(n,f)}(e)}),t;function C(e){var t=WmsImplHandler.invokeSynchronously($WC.Config.get("customContacts").getStatusClass,e.id)||"",s=$WC.Config.get("customContacts").separatePane?"":'data-zcprofileid="'+e.id+'"';return'<span class="wms_badge_imgwrapper wms_badge_statusicon_'+t+'">'+(e.name&&e.photo?"<img "+s+'src="'+e.photo+'"/>':"<span "+s+'class="wms_badge_letter">'+$WC.HybridSearch.getBadgeLetters(e.name)+"</span>")+"</span>"}},WmsHybridSearch.bindEvents=function(){var e=$WC.HybridSearch.getNode("mainUI");Gator(e).on("click","[class~=wms-hysearch-result] ",function(){WmsHybridSearch.handleClick(this)}),Gator(e).on("click","[data-retry]",function(){WmsHybridSearch.handleClick(this)}),Gator(e).on("click","[data-addcontact]",function(){WmsHybridSearch.handleClick(this)}),Gator(e).on("click","[data-innerfragclose]",function(e){WmsHybridSearch.removeChosenText(e,this)}),Gator(e).on("mouseover","[data-innerfrag]",function(){WmsHybridSearch.showCloseIcon(this)}),Gator(e).on("mouseout","[data-innerfrag]",function(){WmsHybridSearch.hideCloseIcon(this)}),Gator(e).on("click","#wms-hysearch-placeholder",WmsHybridSearch.focusInput),Gator(e).on("click","[class=wms-hysearch-closeicon]",WmsHybridSearch.hideUI),Gator(e).on("click","[class=wms-hysearch-tipsicon]",WmsHybridSearch.toggleTipsUI)},WmsHybridSearch.showJoinChannelDialog=function(e){if(e.data.joined)WmsMainUI.scheduleAutoFocus(e.data.chid),WebMessanger.attachSession(e.data.chid);else{var t=JSON.parse("["+e.data.re_conv.slice(0,-1)+"]"),s=Message.constructChatContent(t),i=new $WC.ChannelPreview,n={handleCopyLink:ChatWindow.prototype.handleCopyPermaLink,handleJoinChannel:function(e){WmsMainUI.scheduleAutoFocus(e),WebMessanger.joinChannel(e)},handleProfileInfo:WebMessanger.showProfileInfo,handleLoadImages:WMSUI.loadImages};i.mountComponent(e.data,s,n)}};var WmsDialog={showModal:function(e,t){WmsDialog.removeModal(),ZMSGUI.createOverlay(),WmsDialog.operations=e.operations;for(var s=e.imghtml?e.imghtml:"",i=e.width||"480",n=e.bodyhtml?e.bodyhtml:"",a='</div><div class="wms-dialog-inpcont">',o=0;o<e.operations.length;o++){var r=e.operations[o].classname?e.operations[o].classname:"wms-dialog-acceptbtn",l=e.operations[o].name;e.operations[o].link?a+='<a href="'+e.operations[o].link+'" target="_blank" rel="noopener"><input type="button" class="'+r+'" tabindex="'+(o+1)+'" value="'+l+'"></input></a>':a+='<input type="button" class="'+r+'" tabindex="'+(o+1)+'" value="'+l+'"></input>'}var d='<div class="wms-dialogheader"><span class="wms-dialogclose" data-operation="close"></span></div><div class="wms-dialogcontent"><div class="wms-dialogtext">'+s+n+(a+="</div></div>"),c=t?{"data-ownerchatid":t}:null,m=$WC.Util.createElement("div","wms-dialog","wms-dialogparent wms-hvalign",c,d);m.style.zIndex=$WC.Config.get("zindex"),m.style.width=i+"px",m.onclick=function(e){var t=$WC.Util.getEventTarget(e),s=t.getAttribute("tabindex");if("close"==t.getAttribute("data-operation"))WmsDialog.removeModal();else if(s){var i=WmsDialog.operations[s-1].action;i&&i.call(),WmsDialog.removeModal()}},document.body.appendChild(m).querySelector('[tabindex="'+e.focusbutton+'"]').focus()},removeModal:function(){if(ZMSGUI.removeOverlay(),document.getElementById("wms-dialog")){var e=document.getElementById("wms-dialog").getAttribute("data-ownerchatid");$WC.Util.removeElement(document.getElementById("wms-dialog")),e&&WindowHandler.focusChatById(e)}}},WmsMediaPlayer={supported_audio_formats:[],supported_video_formats:[],initSupportedAudioFormats:function(){for(var e=new Audio,t=["mp3","mpeg","wav","aac","amr","flac","gsm","tta","wv","x-wav","x-m4a","mp4"],s=0,i=t.length;s<i;s++)""!==e.canPlayType("audio/"+t[s])&&"no"!==e.canPlayType("audio/"+t[s])&&this.supported_audio_formats.push("audio/"+t[s])},initSupportedVideoFormats:function(){var e=$WC.Util.createElement("video");this.IS_VIDEO_TAG_SUPPORTED=!!e.canPlayType;for(var t=["webm","mkv","flv","ogg","avi","mov","qt","wmv","asf","mp4","3gp","quicktime"],s=0,i=t.length;s<i;s++)""!==e.canPlayType("video/"+t[s])&&"no"!==e.canPlayType("video/"+t[s])&&this.supported_video_formats.push("video/"+t[s])},isSupportedAudioFormat:function(e){return-1<this.supported_audio_formats.indexOf(e)},isSupportedVideoFormat:function(e){return-1<this.supported_video_formats.indexOf(e)},isSupportedAudioType:function(e,t){return this.isSupportedAudioFormat(e)||this.isSupportedAudioFormat("audio/"+t)},isSupportedVideoType:function(e,t){return e=this.getVideoType(e),this.isSupportedVideoFormat(e)||this.isSupportedVideoFormat("video/"+t)},getVideoType:function(e){return["image/heif","image/heif-sequence","image/heic","image/heic-sequence","video/mov","video/quicktime"].includes(e)?"video/mp4":e}};function ListCommon(e,t){this.container=t,this.input=e,this.selectedelem="";var s=this;e.addEventListener("keydown",function(e){var t=e.keyCode;WebMessanger&&(WebMessanger.userslist||WebMessanger.forkedlist)?t!==$WC.WmsConstants.KEYCODES.ENTER&&t!==$WC.WmsConstants.KEYCODES.UP&&t!==$WC.WmsConstants.KEYCODES.DOWN||e.preventDefault():"none"===s.container.style.display||t!==$WC.WmsConstants.KEYCODES.ENTER&&t!==$WC.WmsConstants.KEYCODES.UP&&t!==$WC.WmsConstants.KEYCODES.DOWN&&t!==$WC.WmsConstants.KEYCODES.LEFT&&t!==$WC.WmsConstants.KEYCODES.RIGHT||e.preventDefault()}),e.addEventListener("keyup",function(e){"none"!==s.container.style.display&&s.handleKeyMovement(e,s)}),t.addEventListener("click",function(e){var t=$WC.Util.getEventTarget(e);s.handleClick(t,s),"undefined"!=typeof WmsUIImpl&&WmsImplHandler.invoke(WmsUIImpl.onChatWindowDropUpClick,e,s),e.stopPropagation()})}ListCommon.prototype.getListHTML=function(e,t){var s="",i=e.USERID||e.id;i=e.ISBOT?"b-"+i:i;var n=$WC.Util.getContactName(i)||e.DNAME||e.name,a=WmsContacts.getEmailId(i)||e.EMAILID||e.description||"",o=e.STATUS||"",r=e.STYPE||"",l=e.STATUSCLASS||"";t?s=e.photo||"":e.id||(s=$WC.Bots.isBotId(i)?$WC.Bots.getPhoto(i):WmsContacts.getUserPhoto(i));var d='<div class="wms-filefrwrdcontact" data-dname="{{dname}}" data-userid="'+i+'" data-list="true">';return s&&(d+='<span class="wms-filefrwrdcontactspan"><div class="wms-filefrwrdcontactdiv"><img class="wms-filefrwrdcontactimg wms-autocompleteimg" src={{image}}><span class="{{statusclass}}"></span></div></span>'),d+='<span class="wms-filefrwrdcontactdetails wms-truncate-ellipsis" title="{{dname}}">{{dname}}</span><span class="wms-truncate-ellipsis wms-filefrwrddesc wms-valign-mid-block" title="{{emailid}}">{{emailid}}</span></div>',WmsContacts.getContactsList(i)?r==WmsContacts.userstatus.MOB_LOGIN?o==WmsContacts.userstatus.OFFLINE?l="wms-filefrwrdcontactstatus wms-contactstatus wms-statusicon-offline":o==WmsContacts.userstatus.ONLINE?l="wms-filefrwrdcontactstatus wms-contactstatus wms-statusicon-available-mobile":o==WmsContacts.userstatus.BUSY?l="wms-filefrwrdcontactstatus wms-contactstatus wms-statusicon-busy-mobile":o==WmsContacts.userstatus.AWAY?l="wms-filefrwrdcontactstatus wms-contactstatus wms-statusicon-away":o==WmsContacts.userstatus.IDLE?l="wms-filefrwrdcontactstatus wms-contactstatus wms-statusicon-idle-mobile":o==WmsContacts.userstatus.DONOTDISTURB&&(l="wms-filefrwrdcontactstatus wms-contactstatus wms-statusicon-dnd-mobile"):o&&(l=o==WmsContacts.userstatus.AWAY?"wms-filefrwrdcontactstatus wms-contactstatus wms-statusicon-away":o==WmsContacts.userstatus.DONOTDISTURB?"wms-filefrwrdcontactstatus wms-contactstatus wms-statusicon-dnd":"wms-filefrwrdcontactstatus wms-filefrwrdscode-"+o):e.ISBOT&&(l="wms-filefrwrdcontactstatus wms_boticon"),$WC.template.replace(d,{dname:$WC.Util.unescapeHTML(n),emailid:a,statusclass:l,image:s})},ListCommon.prototype.showUI=function(e,t,s,i,n){this.sethtml=s;var a=this,o="";$WC.Util.isArray(e)&&!s?e.forEach(function(e){if(i){var t=e.USERID||e.id;t=e.ISBOT?"b-"+t:t,a.container.querySelector('[data-userid="'+t+'"]')||(o+=a.getListHTML(e,n))}else o+=a.getListHTML(e,n)}):s&&(o=e),i?(this.container.innerHTML+=o,s||(this.selectedelem=this.container.querySelector('[class="wms-filefrwrdcontactsel"]'),this.selectElem(this.selectedelem,!0))):(this.container.innerHTML=o,this.container.scrollTop=0,this.selectedelem="",t&&(this.container.firstChild.getAttribute("data-list")?this.selectedelem=this.container.firstChild:this.selectedelem=this.container.firstChild.firstChild,this.selectElem(this.selectedelem,!0)))},ListCommon.prototype.handleKeyMovement=function(e,t){var s,i=e.keyCode,n=$WC.Util.getEventTarget(e);if(i!==$WC.WmsConstants.KEYCODES.LEFT&&i!==$WC.WmsConstants.KEYCODES.RIGHT||":"!==WMSUI.curtrigger)if(i===$WC.WmsConstants.KEYCODES.UP||i===$WC.WmsConstants.KEYCODES.DOWN)t.selectElem(t.selectedelem,!1),t.selectedelem=t.selectedelem?$WC.$CUtil.getConditionalNextNode(t.selectedelem,i,"data-list"):t.container.firstChild,t.selectElem(t.selectedelem,!0),t.selectedelem&&$WC.Util.bringElemToView(t.selectedelem,i),e.preventDefault();else if(i===$WC.WmsConstants.KEYCODES.ENTER){if(t.selectedelem){if(WebMessanger.userslist)WebMessanger.userslist.handleKeyMovement(e);else if(WebMessanger.forkedlist)WebMessanger.forkedlist.handleKeyMovement(e);else if(WMSUI.curtrigger===$WC.WmsConstants.TRIGGERS.SLASH||"-"===WMSUI.curtrigger&&-1!=n.value.indexOf($WC.WmsConstants.TRIGGERS.SLASH))Commands.select(n,t.selectedelem);else if(WMSUI.curtrigger===$WC.WmsConstants.TRIGGERS.ATMENTION||WMSUI.curtrigger===$WC.WmsConstants.TRIGGERS.ADDMEM)WMSUI.atMentions.select(n,t.selectedelem);else if(t.selectedelem.getAttribute("data-botsuggestion")){var a=t.selectedelem.getAttribute("data-suggestiontext");WindowHandler.sendBotSuggestions(n,a)}e.preventDefault()}}else WebMessanger.userslist?WebMessanger.userslist.handleKeyMovement(e):WebMessanger.forkedlist&&WebMessanger.forkedlist.handleKeyMovement(e);else{t.selectElem(t.selectedelem,!1);var o=t.container.firstChild,r=0;for(t.selectedelem&&(o=t.selectedelem.parentNode);r<o.childElementCount;)t.selectedelem===o.childNodes[r]&&(s=r),r++;var l=$WC.$CUtil.getNextRotationalNode(o,i);t.selectedelem=l.childNodes[s],t.selectElem(t.selectedelem,!0),e.preventDefault()}},ListCommon.prototype.selectElem=function(e,t){if(e||!this.sethtml){var s=e.getAttribute("class").replace(/sel$/,""),i=t?s+"sel":s;e.setAttribute("class",i)}},ListCommon.prototype.handleClick=function(e,t){if((e=e.closest('[data-list="true"]')).getAttribute("data-botsuggestion")){var s=e.getAttribute("data-suggestiontext");WindowHandler.sendBotSuggestions(t.input,s)}else WebMessanger.userslist?WebMessanger.userslist.handleClick(e):WebMessanger.forkedlist?WebMessanger.forkedlist.handleClick(e):WMSUI.curtrigger===$WC.WmsConstants.TRIGGERS.SLASH||"-"===WMSUI.curtrigger&&-1!=t.input.value.indexOf($WC.WmsConstants.TRIGGERS.SLASH)?Commands.select(t.input,e):WMSUI.curtrigger!==$WC.WmsConstants.TRIGGERS.ATMENTION&&WMSUI.curtrigger!==$WC.WmsConstants.TRIGGERS.ADDMEM||WMSUI.atMentions.select(t.input,e);t.selectedelem=e},WMSUI.autoComplete={init:function(e,t){WMSUI.atMentions.changeColor(t);var s=t.value.substring(0,t.selectionStart),i=s.lastIndexOf(" "+$WC.WmsConstants.TRIGGERS.SMILEY)+1;if(e)var n=WindowHandler.getWinObjById(e);this.isSmileyTriggerPresent(i,s)&&"false"!=this.getSearchTermForComposer(s)?n&&n.showSmileyUI(!0,this.getSearchTermForComposer(s)):n&&n.autocompletepickervisible&&n.hideSmileyUI()},select:function(e,t){var s=e.selectionStart,i=e.getAttribute("chid");if(i)var n=document.getElementById(i).querySelector('[id="wms-editorscrolldiv"]');Smiley.textcodes_lookup[t]&&(t=-1<t.indexOf("!")?":"+Smiley.textcodes_lookup[t]+"!: ":":"+Smiley.textcodes_lookup[t]+": ");var a=e.value,o=(a=a.substring(0,s)).lastIndexOf(" "+$WC.WmsConstants.TRIGGERS.SMILEY)+1;(0<o||0===o&&0===a.indexOf($WC.WmsConstants.TRIGGERS.SMILEY)||0===o&&"\n"===a[a.lastIndexOf($WC.WmsConstants.TRIGGERS.SMILEY)-1])&&("\n"===a[a.lastIndexOf($WC.WmsConstants.TRIGGERS.SMILEY)-1]&&(o=a.lastIndexOf("\n"+$WC.WmsConstants.TRIGGERS.SMILEY)+1),e.value=e.value.substring(0,o)+t+e.value.substring(s),$WC.Util.moveCaretPosition(e,o+t.length,o+t.length),i&&(WMSUI.atMentions.setScrollPosition(n,e),WMSUI.atMentions.changeColor(e))),WMSUI.currenttrigger=""},setKeyNavigation:function(e,t){e.addEventListener("keydown",t.handleCustomNavigation)},removeKeyNavigation:function(e,t){e.removeEventListener("keydown",t.handleCustomNavigation)},isSmileyTriggerPresent:function(e,t){return 0<e||0===e&&0===t.indexOf($WC.WmsConstants.TRIGGERS.SMILEY)||0===e&&"\n"===t[t.lastIndexOf($WC.WmsConstants.TRIGGERS.SMILEY)-1]},getSearchTermForComposer:function(e){var t=(e=e.replace(/:\w+:/g,"")).lastIndexOf($WC.WmsConstants.TRIGGERS.SMILEY);return"\n"===e[t-1]||" "===e[t-1]||0===t?e.substring(t+1):"false"}},WMSUI.atMentions={specialmentions:{keys:["available","participants"],getDisplayName:function(e,t){var s=WmsSettings.adminsettings.features.specialmentions_hash;for(var i in s)if(e==i||-1!==s[i].unique_key.indexOf(t))return s[i].display_name}},fetchmentionlist:!0,init:function(e,t,s,i,n){var a=[],o=t.value.substring(0,t.selectionStart),r=o.lastIndexOf(" "+WMSUI.curtrigger)+1,l=WindowHandler.getWinObjById(e),d=n||l.autocompletediv,c=WmsFileUploadUI.listcommon||l.listcommon,m=s&&s.callbackargs&&s.callbackargs.silentload;if(!(!0===l.disablemembercontrol&&WMSUI.curtrigger===$WC.WmsConstants.TRIGGERS.ADDMEM||WMSUI.curtrigger===$WC.WmsConstants.TRIGGERS.ATMENTION&&!0===l.disablemention||l.salesiqchat)){if(WMSUI.atMentions.changeColor(t),0<r||0==r&&0==o.indexOf(WMSUI.curtrigger)||0==r&&"\n"==o[o.indexOf(WMSUI.curtrigger)-1]){var u=WMSUI.atMentions.getSearchTerm(e,o);WMSUI.atMentions.fetchmentionlist&&(a=WMSUI.atMentions.getContactList(e,t,i,n,u))}a&&a.length&&""!==WMSUI.curtrigger?(c.showUI(a,!0,null,m),d.style.display="block",l.footernode.style.borderRadius="0px 0px 5px 5px",$WC.Channels.get(e)&&0!=WebMessanger.isPaginationEnabledForParticipantsSearch()||!(a.length<5||$WC.Matcher.check("emailid",u,!0))||!1!==WmsOrgContacts.isCachedRequest(u)||WmsHybridSearch.getNextResultSet({searchtext:u,inpresultset:$WC.WmsConstants.HYBRIDSEARCH.USERLIST,chid:e,topicname:"listview",silentload:!0})):$WC.Channels.get(e)||!u||s&&s.stat===$WC.WmsConstants.REQSTATUS.NORESULTS?l.autocompletepickervisible&&l.hideSmileyUI():WmsHybridSearch.getNextResultSet({searchtext:u,inpresultset:$WC.WmsConstants.HYBRIDSEARCH.USERLIST,chid:e,topicname:"listview"})}},getDname:function(e,t){if(t){var s=$WC.Util.getContactName(t);if(!s)(WMSUI.curtrigger===$WC.WmsConstants.TRIGGERS.ATMENTION?WindowHandler.getWinObjById(e).allowedmentions.members:WindowHandler.getWinObjById(e).allowedmembers.members).forEach(function(e){t===e.USERID&&(s=e.DNAME)});return s}},getSearchTerm:function(a,o){var e=WindowHandler.getWinObjById(a),t=e.atmentions?e.atmentions.split(","):"";$WC.Util.isArray(t)&&t.forEach(function(e){var t=WMSUI.atMentions.getDname(a,e),s='<span class="wms-atmtntext"> '+WMSUI.curtrigger+t+"</span>",i=WMSUI.curtrigger+t;i=i.replace(/(?=[$*+\[\]() ])/g,"\\");var n=new RegExp(i,"g");o=o.replace(n,s)});var s=o.replace(/<span class="wms-atmtntext">(.+?)<\/span>/g,""),i=s.lastIndexOf(WMSUI.curtrigger);return"\n"===s[i-1]||" "===s[i-1]||0===i?(WMSUI.atMentions.fetchmentionlist=!0,s.substring(i+1)):void(WMSUI.atMentions.fetchmentionlist=!1)},getContactList:function(e,t,s,i,n){var a,o,r,l,d,c=[],m=[],u=WindowHandler.getWinObjById(e),p=u.ctype,h="8"==p;function g(e){var t=[];if(WindowHandler.getWinObjById(e).atmentions){var s=WindowHandler.getWinObjById(e).atmentions.slice(0,-1).split(",");$WC.Util.isArray(s)&&s.forEach(function(e){t.push(e)})}return t}function f(e,t){var s=WindowHandler.getWinObjById(e);return t===$WC.WmsConstants.TRIGGERS.ADDMEM&&s.allowedmembers.members.length?s.allowedmembers.members:s.allowedmentions.members.length?s.allowedmentions.members:void 0}function C(e,t,s){var i,n=[],a=[];for(var o in i=s===$WC.WmsConstants.CHANNELS.TEAM?$WC.Channels.getTeamChannelMembers(e):WindowHandler.getWinObjById(e).partinfo)$WC.Util.isLocalUser(o)||(WmsContacts.get(o,!0)?n.push(WmsContacts.get(o,!0)):n.push(WMSUI.atMentions.wrapParticipantsObj(i[o])),a.push(o));return t?a:n}return m={USERID:g(e)},h&&1==WebMessanger.isPaginationEnabledForParticipantsSearch()||WMSUI.curtrigger===$WC.WmsConstants.TRIGGERS.ADDMEM&&$WC.Util.isThreadChid(e)?WMSUI.curtrigger!==$WC.WmsConstants.TRIGGERS.ADDMEM||"5"==p||h&&!$WC.Channels.isUserHasPermission(e,$WC.WmsConstants.USERPERMISSIONS.ADD_MEMBER)||$WC.Util.isThreadChid(e)&&"true"!==u.thread_follower?WMSUI.curtrigger===$WC.WmsConstants.TRIGGERS.ATMENTION&&(WebMessanger.isSpecialMentionEnabled()&&(c=$WC.HybridSearch.filter("name",n,function(e,t){var s,i=[];if(e||2<t){for(var n in s=WmsSettings.adminsettings.features.specialmentions_hash)i.push({id:s[n].unique_key.slice(s[n].unique_key.indexOf("@")+1),name:s[n].display_name,description:s[n].desc});return i}}(h,u.partcount),10)),(c=c.concat($WC.HybridSearch.filter("DNAME",n,f(e,WMSUI.curtrigger),10,m,"EMAILID"))).length?c.length<10&&WebMessanger.fetchChannelMembers(e,n,WMSUI.curtrigger):Commands.hideLoadingIcon(e)):u.allowedmembers.members.length||u.allowedmembers.token_mapping[n]?(c=c.concat($WC.HybridSearch.filter("DNAME",n,f(e,WMSUI.curtrigger),10,m,"EMAILID"))).length?c.length<10&&WebMessanger.fetchChannelMembers(e,n,WMSUI.curtrigger):Commands.hideLoadingIcon(e):(Commands.showLoadingIcon(WMSUI.atMentions.autocompletediv||u.autocompletediv,e),WebMessanger.fetchChannelMembers(e,n,WMSUI.curtrigger)):WMSUI.curtrigger!==$WC.WmsConstants.TRIGGERS.ATMENTION&&h&&!$WC.Channels.isUserHasPermission(e,$WC.WmsConstants.USERPERMISSIONS.ADD_MEMBER)||(WMSUI.curtrigger===$WC.WmsConstants.TRIGGERS.ADDMEM&&"5"!=p&&(m={USERID:g(e).concat(C(e,!0))}),c=h&&$WC.Channels.isTeamChannel(e)&&WMSUI.curtrigger===$WC.WmsConstants.TRIGGERS.ADDMEM?($WC.Util.isEmptyObject($WC.Channels.getTeamChannelMembers(e))&&(Commands.showLoadingIcon(WMSUI.atMentions.autocompletediv||u.autocompletediv,e),WebMessanger.fetchTeamChannelMembers(e)),$WC.HybridSearch.filter("DNAME",n,C(e,null,$WC.WmsConstants.CHANNELS.TEAM),10,m,"EMAILID")):($WC.Util.isEmptyObject(u.partinfo)&&WebMessanger.fetchChannelMembers(e),c=(c=$WC.HybridSearch.filter("DNAME",n,(l=n,d={USERID:d||[]},$WC.HybridSearch.filter("DNAME",l,WmsContacts.getContactsList(),10,d,"EMAILID")),10,m,"EMAILID")).concat((a=n,o={USERID:(o=m.USERID.concat((r=[],c.filter(function(e){r.push(e.USERID)}),r)))||[]},$WC.HybridSearch.filter("DNAME",a,WmsOrgContacts.getOrgContactsList(),10,o,"EMAILID"))),$WC.HybridSearch.filter("DNAME",n,c,20,null,"EMAILID"))),c},wrapParticipantsObj:function(e){var t={};return t.DNAME=e.dname||e.DNAME,t.USERID=e.uname||e.zuid||e.ZUID,t.STATUS=e.scode,t.STYPE=e.st,t.EMAILID=e.email||e.EMAILID,t.UC=t.UC||"0",t},select:function(e,t){var s=t.getAttribute("data-userid"),i=e.getAttribute("chid"),n=$WC.Util.unescapeHTML(WMSUI.atMentions.getDname(i,s)||t.getAttribute("data-dname"))+" ",a=e.selectionStart,o=document.getElementById(i).querySelector('[id="wms-editorscrolldiv"]'),r=WindowHandler.getWinObjById(e.getAttribute("chid")),l=WMSUI.atMentions.autocompletediv||r.autocompletediv,d=e.value;d=d.substring(0,a),n=0===n.indexOf(WMSUI.curtrigger)?n.substring(1):n,WindowHandler.getWinObjById(i).listcommon.showUI(""),l.style.display="none";var c=d.lastIndexOf(" "+WMSUI.curtrigger)+1;(0<c||0===c&&0===d.indexOf(WMSUI.curtrigger)||0===c&&"\n"===d[d.lastIndexOf(WMSUI.curtrigger)-1])&&("\n"===d[d.lastIndexOf(WMSUI.curtrigger)-1]&&(c=d.lastIndexOf("\n"+WMSUI.curtrigger)+1),e.value=e.value.substring(0,c+1)+n+e.value.substring(a),$WC.Util.moveCaretPosition(e,c+n.length+1,c+n.length+1),WMSUI.atMentions.setScrollPosition(o,e),WMSUI.atMentions.insertAtmentions(e.getAttribute("chid"),s),WMSUI.atMentions.changeColor(e)),r.footernode.style.borderRadius="5px"},changeColor:function(e){var t=$WC.Util.escapeHTML(e.value),s=e.getAttribute("chid"),i=WindowHandler.getWinObjById(s);if(invisiblediv=WMSUI.atMentions.invisiblediv||i.invisiblediv,i.selectedoptions?invisiblediv.innerHTML=Commands.format(t,i.selectedoptions,s):i.atmentions&&(invisiblediv.innerHTML=WMSUI.atMentions.formatAtMentions(t,i.atmentions,s)),e.getAttribute("data-command")){var n=invisiblediv.innerHTML;invisiblediv.innerHTML=n.replace(e.getAttribute("data-command"),'<span class="wms-commandtext">'+e.getAttribute("data-command")+"</span>")}invisiblediv.scrollTop=e.scrollTop},format:function(t,l,e){t=$WC.Util.formatMentions(t,l,e);function s(e,r){t="silentmention"===e?$WC.Config.get("getSilentUserMention")(t):$WC.Matcher.replace(e,t,function(e,t,s,i){var n=i,a=s,o=t;return n=$WC.Config.get("zuid")==o?$WC.Util.safeHTML($WC.Util.unescapeHTML($WC.Config.get("dname"))):$WC.Util.getContactName(o,n,!0),l?r+n:'<span class="wms-atmtnlink" '+("1"!==a&&"4"!==a||'data-zcprofileid="'+o+'"')+">"+r+n+"</span>"})}return s("atmention","@"),s("addmember","+"),s("silentmention"),t},getSilentMentionHtml:function(e){return $WC.Matcher.replace("usersilentmention",e,function(e,t,s,i){var n=s;i&&(n=WmsContacts.getZuid(i));var a=$WC.Util.isLocalUser(n)?WebMessanger.getNickName():WmsContacts.getDisplayName(n)||t;return'<span class="wms-atmtnlink" data-zcprofileid="'+n+'">@'+$WC.Util.safeHTML($WC.Util.unescapeHTML(a))+"</span>"})},insertAtmentions:function(e,t,s){var i=WindowHandler.getWinObjById(e),n=i.composer.value,a=i.atmentions?i.atmentions.split(","):"";s?(i.atmentions=i.atmentions.replace(t+",",""),i.selectedoptions=i.selectedoptions.replace(WMSUI.atMentions.getDname(e,t)+",","")):a.indexOf(t)<0&&(i.atmentions+=t.concat(","),n.startsWith($WC.WmsConstants.TRIGGERS.SLASH)&&(i.selectedoptions+=WMSUI.curtrigger+WMSUI.atMentions.getDname(e,t).concat(","))),$WC.WmsSessionStorage.setChatInfo({chid:e,atmentions:i.atmentions})},isLocalUserMentioned:function(e){return!!(e.meta&&e.meta.mentions&&(e.meta.mentions.participants||e.meta.mentions.available&&"1"===WebMessanger.scode||e.meta.mentions[$WC.Config.get("zuid")]))},formatAtMentions:function(s,e,i,n){var t=WMSUI.atMentions.invisiblediv||WindowHandler.getWinObjById(i).invisiblediv,a=a||Message.getMsgCategory(t.innerHTML),o="";o="atmentions"==a||"command"==a?"@":"addmem"==a?"+":WMSUI.curtrigger;var r=(e=e.replace(/,+$/,"")).split(","),l="",d="";return s=$WC.Util.escapeHTML(s),$WC.Util.isArray(r)&&r.forEach(function(e){if(-1!==WMSUI.atMentions.specialmentions.keys.indexOf(e)){var t=WMSUI.atMentions.specialmentions.getDisplayName("",e);l=n?"{"+o+e+"}":'<span class="wms-atmtntext">'+t+"</span>",d=new RegExp(t),s=s.replace(d,function(){return l})}else{t=$WC.Util.escapeHTML(WMSUI.atMentions.getDname(i,e));if(l=n?"+"===o?"{addchatmember:"+e+":1:"+t+":addchatmember}":"{"+o+e+"}":'<span class="wms-atmtntext">'+o+t+"</span>",t)t=t.replace(/(?=[$*+\[\]() \\])/g,"\\"),(d=new RegExp("["+o+"]"+t)).test(s)||WMSUI.atMentions.insertAtmentions(i,e,!0),s=s.replace(d,function(){return l})}}),s},updateMessage:function(i,n,e,t){var s=WMSUI.atMentions.invisiblediv||WindowHandler.getWinObjById(n).invisiblediv;t=t||Message.getMsgCategory(s.innerHTML);var a="";if("atmentions"==t){a="@",atmentions=e||WindowHandler.getWinObjById(n).atmentions.replace(/,+$/,"");var o=atmentions.split(",");i=$WC.Util.escapeHTML(i),$WC.Util.isArray(o)&&o.forEach(function(e){var t=$WC.Util.escapeHTML(WMSUI.atMentions.getDname(n,e)),s=new RegExp("{@"+e+"}");i=i.replace(s,function(){return-1!==WMSUI.atMentions.specialmentions.keys.indexOf(e)?(t=WMSUI.atMentions.specialmentions.getDisplayName("",e),'<span class="wms-atmtnlink" data-zcprofileid="'+e+'">'+t+"</span>"):'<span class="wms-atmtnlink" data-zcprofileid="'+e+'">'+a+t+"</span>"})})}return i},setScrollPosition:function(e,t){var s=t.value.substring(0,t.selectionStart);e.innerHTML=$WC.Util.escapeHTML(s),t.scrollTop=e.scrollHeight,e.innerHTML=""},replaceAtMentionsForHtml:function(e,n){var a="";return e.replace(/<span(?:.*?)data-zcprofileid="(.*?)">@(.*?)<\/span>/g,function(e,t,s){var i=$WC.Util.getContactName(t,s,n);a+="{mention:"+t+":1:"+i+":mention}"}),a},isLocationAllowedForMentionedBots:function(e){var t=WindowHandler.getWinObjById(e);if(t.atmentions)return t.atmentions.split(",").some(function(e){if($WC.Bots.isBotId(e)){var t=$WC.Bots.get(e);if(t&&t.PERMISSION)return 0<(2&t.PERMISSION)}})}};var Commands={get:function(t){var e=$WC.WmsSessionStorage.getItem("commands")||{},s="limit=1000";Commands.sync&&e&&e.sync_token&&(s+="&sync_token="+e.sync_token);$WC.Ajax.requestToChat("v2/commands",s,function(){var e=JSON.parse(this.response);Commands.sync=!1,Commands.updateList(e.data,e.sync_token),Commands.deleteObj(e.deleted||[]),Commands.show(t)})},showLoadingIcon:function(e,t){var s=WindowHandler.getWinObjById(t);s.listcommon.showUI('<div class="wms-cmdloading"><div class="wms-loadingicon"><div class="wms_loading_container"><div></div><div></div><div></div></div></div></div>',!1,!0),e.style.display="block",s.footernode.style.borderRadius="0px 0px 5px 5px"},hideLoadingIcon:function(e){var t=WindowHandler.getWinObjById(e),s=t.autocompletediv;t.listcommon.showUI(""),s.style.display="none",t.footernode.style.borderRadius="5px"},showProgressBar:function(e){Commands.removeProgressBar(e);WindowHandler.getWinObjById(e).autocompletediv.insertAdjacentHTML("beforebegin",'<div id="loadingline" class="wms-loadinglinediv"><div class="wms-loadingline"></div></div>')},removeProgressBar:function(e){var t=document.getElementById(e).querySelector('[id="loadingline"]');$WC.Util.removeElement(t)},show:function(e,t){if(!1!==WebMessanger.isCliqUser()){var s=$WC.WmsSessionStorage.getItem("commands"),i=WindowHandler.getWinObjById(e),n=i.autocompletediv,a=i.composer.value;if(!s||Commands.sync)return Commands.get(e),s=$WC.WmsSessionStorage.getItem("commands"),void Commands.showLoadingIcon(n,e);Commands.remove(n,e);var o=a.lastIndexOf(" "+WMSUI.curtrigger)+1;if(t||(0==o||0==a.indexOf(WMSUI.curtrigger))&&a.startsWith(WMSUI.curtrigger)){var r='<div class="wms-commandlist" data-command="{{commandname}}" data-list="true"><span class="wms-commandname wms-truncate-ellipsis" title="{{commandname}}">{{commandname}}</span><span title="{{commandhint}}" class="wms-commandhint wms-truncate-ellipsis">{{commandhint}}</span></div>',l="",d=Commands.getSearchTerm(i.composer),c="";if(t){d=d.substring(1),c=a.split(" ")[0],WMSUI.atMentions.changeColor(i.composer,!0);for(var m=Commands.getByName(c).options,u=i.selectedoptions.split(","),p=0;p<u.length;p++){if(""!==u[p]&&-1!==u[p].indexOf(d))delete m[u[p].substring(1)]}for(var h in m){var g=m[h];h.startsWith(d)&&(l+=$WC.template.replace(r,{commandname:"-"+h,commandhint:g}))}}else{WMSUI.atMentions.changeColor(i.composer,!0),$WC.HybridSearch.filter("name","",s.list,"","","","name").forEach(function(e){c=e.name;var t=e.hint;c.startsWith(d)&&(l+=$WC.template.replace(r,{commandname:"/"+c,commandhint:t}))})}CommandSuggestions.init(e,d),""!=l&&(i.listcommon.showUI(l,!0,!0),n.style.display="block",i.footernode.style.borderRadius="0px 0px 5px 5px")}}},remove:function(e,t){var s=WindowHandler.getWinObjById(t);s.listcommon.showUI(""),e.style.display="none",s.footernode.style.borderRadius="5px"},getSearchTerm:function(e){var t=e.selectionStart,s=e.value.substring(1,t);return s.substring(s.lastIndexOf(" "+WMSUI.curtrigger)+1,t)},isCommandMsg:function(e){return!!e.startsWith($WC.WmsConstants.TRIGGERS.SLASH)},getCommandId:function(e){var t=e.substr(0,e.indexOf(" ")),s=Commands.getByName(t);if(s)return s.id},select:function(e,t){if(t.getAttribute("data-suggestion"))CommandSuggestions.handleClick(e,t);else{var s=t.getAttribute("data-command");e.setAttribute("data-command",s);var i=e.selectionStart,n=e.value.substring(0,i).lastIndexOf(" "+WMSUI.curtrigger)+2,a=e.getAttribute("chid"),o=WindowHandler.getWinObjById(a),r=o.autocompletediv,l=o.invisiblediv;o.selectedoptions+=s.concat(","),l.innerHTML='<span class="wms-commandtext">/'+s.substring(1)+"</span>",Commands.remove(r,a);var d=e.value;e.value=d.substring(0,n)+s.substring(1)+" "+d.substring(i),$WC.Util.moveCaretPosition(e,n+s.length,n+s.length),WMSUI.atMentions.changeColor(e,!0),CommandSuggestions.init(a,s.substring(1))}},format:function(e,t,s){var i=WindowHandler.getWinObjById(s);if(""!==t&&""!==e)for(var n=t.split(","),a=0;a<n.length;a++){var o=new RegExp($WC.Util.escapeHTML(n[a]),"g");""!==n[a]&&(o.test(e)||(i.selectedoptions=t.replace(n[a]+",","")),e=e.replace(o,'<span class="wms-commandtext">'+n[a]+"</span>"))}return e},handle:function(e,t,s){var i,n=WindowHandler.getWinObjById(s),a=Commands.getByName(e).id,o=$WC.Util.unescapeHTML(WMSUI.atMentions.formatAtMentions(t.value,n.atmentions,s,!0)),r="&commandid="+a;$WC.Util.isEmptyString(CommandSuggestions.getSelections(s))||(r+="&selections="+CommandSuggestions.getSelections(s));return i=Message.send(s,o,[],a,r,!0),n.selectedoptions="",Commands.showProgressBar(s),i},clear:function(){$WC.WmsSessionStorage.removeItem("commands")},showResponse:function(t,e,s){Commands.removeProgressBar(t);var i=WindowHandler.getWinObjById(t),n=[];if(s.output?s.output.sender=0<e?e+"command":"":s.output={},s.output.meta||(s.output.meta={},s.output.meta.usermessagedetails={},e<0&&(s.output.meta.usermessagedetails.custom_sender_name=Commands.getById(e).name,s.output.meta.usermessagedetails.custom_sender_imageurl="https://img.zohocdn.com/ichat/images/bar/c"+e+".png",s.output.meta.shareIntegrationResponse=!0)),"Success"===s.status&&s.output){if(s.output.msg)n.push(s.output);else if(s.output&&s.output.inputs){$WC.Channels.initChannels(),(new $WC.Forms).mountComponent(s,Commands.showResponse,function(){var e=WindowHandler.getWinObjById(t);e&&e.composer.focus()})}else"banner"===s.output.type&&("success"===s.output.status?WMSUI.showInfoMsg(s.output.text):"failure"===s.output.status&&WMSUI.showErrorMsg(s.output.text));n.length&&i.updateMessage(n)}else if("Failure"===s.status){if($WC.Util.isEmpty(s.resumeUrl))if(s.output.msg)n.push(s.output),i.updateMessage(n);else{var a={sender:s.output.sender,time:s.output.time,meta:s.output.meta,msg:s.errorMsg||$WC.I18N("commands.exec.error")};n.push(a),i.updateMessage(n)}else(new $WC.Consents).mountComponent(t,s)}},getObject:function(e){var t=$WC.WmsSessionStorage.getItem("commands")||{};return t&&t.list&&t.list[e]},getImgUrl:function(e,t){var s=Commands.getObject(e);return(t=!$WC.Util.isEmpty(s)&&s.photo_id?s.photo_id:t)?_WMSCHATURL+"commandimg/"+t+"/photo.do":"https://img.zohocdn.com/ichat/images/bar/95b9d288_slash.png"},deleteObj:function(e){var t=$WC.WmsSessionStorage.getItem("commands");t.list&&(e.forEach(function(e){delete t.list[e]}),$WC.WmsSessionStorage.setItem("commands",t))}};Commands.updateList=function(e,t){function n(e,t){for(var s in t)if(t.id<0)if("object"==typeof t[s]&&t[s].constructor==Object)for(var i in e[s]||(e[s]={}),t[s])e[s][i]="boolean"==typeof t[s][i]?t[s][i]:$WC.I18N(t[s][i]);else if($WC.Util.isArray(t[s])){e[s]||(e[s]=[]);for(var n=0;n<t[s].length;n++)e[s][n]="boolean"==typeof t[s][i]?t[s][n]:$WC.I18N(t[s][n])}else e[s]="boolean"==typeof t[s]?t[s]:$WC.I18N(t[s]);else e[s]=t[s];return e}var s=$WC.WmsSessionStorage.getItem("commands")||{},a=s.list||{};!function(e){for(var t=0;t<e.length;t++){var s=e[t],i=s.id;a[i]=a[i]||{},a[i]=n(a[i],s)}}(e),s.list=a,s.sync_token=t,$WC.WmsSessionStorage.setItem("commands",s)},Commands.getAllowedTriggers=function(e){if(e.getAttribute("data-command"))return["@","-","/",":"]},Commands.getByName=function(e){var t=$WC.WmsSessionStorage.getItem("commands");if(t)for(var s in e=e.toLowerCase(),t.list){if(e=="/"+t.list[s].name.toLowerCase())return t.list[s]}},Commands.getById=function(e){var t=$WC.WmsSessionStorage.getItem("commands");if(t)for(var s in t.list)if(e==t.list[s].id)return t.list[s]},Commands.isLocationAllowedForExecution=function(e){return 0<(1&Commands.getById(e).permission)},Commands.isLocationAllowedForSuggestion=function(e){return 0<(2&Commands.getById(e).permission)},Commands.consentsCallback=function(e,t){if(!t.data.bots){var s=t.data,i=s.dreResponse.message_source||s.dreResponse.output.meta.message_source;"Success"===s.dreResponse.status&&s.dreResponse.result&&0<s.dreResponse.result.output.length?(Commands.hideLoadingIcon(e),CommandSuggestions.populate(e,s.dreResponse.result.output)):Commands.showResponse(e,i.id,t.data.dreResponse)}};var CommandSuggestions={prevSugg:null,suggestiontimer:""};CommandSuggestions.execute=function(e,s,i,t){var n="chid="+s+"&message="+encodeURIComponent(i);t&&(n+="&selections="+t);function a(){var e=JSON.parse(this.response).data;if("Consent"===e.status||"Failure"===e.status){Commands.hideLoadingIcon(s);var t=WindowHandler.getWinObjById(s).composer;(new $WC.Consents).mountComponent(s,e,Commands.consentsCallback,t)}else"Success"===e.status&&CommandSuggestions.prevSugg===i&&CommandSuggestions.populate(s,e.result.output)}function o(){Commands.hideLoadingIcon(s)}var r={"x-consents-version":"1"};Commands.isLocationAllowedForSuggestion(e)?$WC.Ajax.postRequestToChatWithLocation("v1/commands/"+e+"/suggestions",n,a,o,null,null,r):$WC.Ajax.postRequestToChat("v1/commands/"+e+"/suggestions",n,a,o,null,null,r)},CommandSuggestions.populate=function(e,t){if(t.length){for(var s="",i=WindowHandler.getWinObjById(e),n=i.autocompletediv,a=t[0],o=a&&a.imageurl&&!a.title&&!a.description,r=0;r<t.length;r++){var l="",d=t[r].id,c=t[r].title,m=t[r].description,u=t[r].imageurl;o?l+='<div data-list="true" class="wms-cmdsuggimgdiv" data-suggestion="true" data-imgurl="{{IMGURL}}"><img src="{{IMGURL}}" class="wms-cmdsuggimg"></div>':c&&(l+='<div class="wms-cmndlist wms-filefrwrdcontact" data-list="true" data-suggestion="true" data-id="{{ID}}" data-title="{{TITLE}}" data-desc="{{DESC}}" data-imgurl="{{IMGURL}}">',l+=u?'<img class="wms-filefrwrdcontactimg wms-cmndlistimg" src="{{IMGURL}}"><div class="wms-cmndlistdetails">':'<div class="wms-cmndlistdetails wms-valign-mid-block">',l+='<div class="wms-filefrwrdcontactdetails wms-cmndlisttitle wms-truncate-ellipsis" title="{{TITLE}}">{{TITLE}}</div>',m&&(l+='<div class="wms-cmndlistdesc wms-truncate-ellipsis" title="{{DESC}}">{{DESC}}</div>'),l+="</div></div>"),s+=$WC.template.replace(l,{ID:d||"",TITLE:c||"",DESC:m||"",IMGURL:u||""})}i.listcommon.showUI(s,!0,!0),n.style.display="block",i.footernode.style.borderRadius="0px 0px 5px 5px"}else Commands.hideLoadingIcon(e)},CommandSuggestions.handleClick=function(e,t){var s=e.value,i=e.getAttribute("chid"),n=WindowHandler.getWinObjById(i),a=!1,o={};n.selectedoptions+=t.getAttribute("data-title")+",",t.getAttribute("data-title")&&(o.title=t.getAttribute("data-title"),a=!0),t.getAttribute("data-desc")&&(o.description=t.getAttribute("data-desc")),t.getAttribute("data-imgurl")&&(o.imageurl=t.getAttribute("data-imgurl")),t.getAttribute("data-id")&&(o.id=t.getAttribute("data-id")),o=$WC.Util.isEmptyObject(o)?"":JSON.stringify([o]);var r=e.getAttribute("data-command"),l=Commands.getByName(r),d=l.id,c="&commandid="+d;$WC.Util.isEmptyObject(o)||(c+="&selections="+encodeURIComponent(o)),CommandSuggestions.format(n,t),CommandSuggestions.init(i,e.value.trim(),CommandSuggestions.getSelections(i)),1===l.max_suggestions?(Message.send(i,s,[],d,c,a),n.listcommon.showUI(""),n.autocompletediv.style.display="none",n.footernode.style.borderRadius="5px",e.value="",n.invisiblediv.innerHTML="",n.changeFooterHeight()):CommandSuggestions.isSelectionLimitReached(l,i)&&(Commands.handle(r,e,i),n.listcommon.showUI(""),n.autocompletediv.style.display="none",n.footernode.style.borderRadius="5px",e.value="",n.invisiblediv.innerHTML="",n.changeFooterHeight())},CommandSuggestions.format=function(e,t){var s=t.getAttribute("data-title"),i=' <span class="wms-commandtext" data-suggestion=true data-title="'+t.getAttribute("data-title")+'" data-desc="'+t.getAttribute("data-desc")+'" data-imgurl="'+t.getAttribute("data-imgurl")+'" data-id="'+t.getAttribute("data-id")+'">'+t.getAttribute("data-title")+"</span> ",n="",a="",o=!0;$WC.Util.convertToArray(e.invisiblediv.childNodes).forEach(function(e){e.nodeType===Node.TEXT_NODE&&" "!==e.textContent?(n+=s||e.textContent.trim()+" ",a+=i,o=!1):" "!==e.textContent&&(n+=e.textContent+" ",a+=" "+e.outerHTML)}),e.invisiblediv.innerHTML=o?a.trim()+i:a.trim(),e.composer.value=o&&s?n+s:n},CommandSuggestions.isSelectionLimitReached=function(e,t){var s=WindowHandler.getWinObjById(t),i="/"+e.name+",",n=new RegExp(i+"|^,\\s*|,\\s*$","g"),a=s.selectedoptions.replace(n,"").split(",").length;if(e.max_suggestions<a)return!0},CommandSuggestions.getSelections=function(e){for(var t=[],s=WindowHandler.getWinObjById(e).invisiblediv.querySelectorAll("[data-suggestion]"),i=0;i<s.length;i++){var n={};s[i].getAttribute("data-title")&&(n.title=encodeURIComponent(s[i].getAttribute("data-title"))),s[i].getAttribute("data-desc")&&(n.description=encodeURIComponent(s[i].getAttribute("data-desc"))),s[i].getAttribute("data-imgurl")&&(n.imageurl=encodeURIComponent(s[i].getAttribute("data-imgurl"))),s[i].getAttribute("data-id")&&(n.id=encodeURIComponent(s[i].getAttribute("data-id"))),t.push(n)}return t.length?JSON.stringify(t):""},CommandSuggestions.getFormattedNode=function(e){var t=e.getAttribute("data-title");return' <span class="wms-commandtext" data-suggestion=true data-title="'+t+'" data-desc="'+e.getAttribute("data-desc")+'" data-imgurl="'+e.getAttribute("data-imgurl")+'" data-id="'+e.getAttribute("data-id")+'">'+t+"</span>"},CommandSuggestions.init=function(e,t,s){var i=WindowHandler.getWinObjById(e);if(""!=i.selectedoptions){var n=i.composer.getAttribute("data-command"),a=Commands.getByName(n);if(a&&0<a.id){var o=a.id;CommandSuggestions.prevSugg!=t&&t&&a.has_suggestions&&(!s||!a.max_suggestions||JSON.parse(s).length<a.max_suggestions)&&(clearTimeout(CommandSuggestions.suggestiontimer),CommandSuggestions.prevSugg="/"+t,Commands.showLoadingIcon(i.autocompletediv,e),CommandSuggestions.suggestiontimer=setTimeout(function(){CommandSuggestions.execute(o,e,"/"+t,s)},1e3))}}},($WC=$WC||{}).CMsgUtil={UserMention:1,GroupMention:2,ChannelMention:3,BotMention:4,SpecialMention:{participants:6,available:7},OldMention:8,isCustomMessage:function(e){return!!e&&!$WC.Util.isEmptyObject(e["brief.msg"])},isCustomFormattedMsg:function(e){return!!e&&(void 0!==e["long.msg"]&&0<e["long.msg"].length)},isMessageCardAttachment:function(e){return void 0!==e&&void 0!==e["att.msg"]},getDisplayContent:function(e,t){var s=e.msg;return s?(s=s.trim(),s=this.processMsg(s,e,t),($WC.Matcher.check("atmentiontemplate",s)||this.isNewMentionMsg(s))&&(s=this.getDisplayableMention(e,s,'<span elemtype="{MENTIONELEMTYPE}" hover="true" uid="$1" class="hvrinfo" mentionedid="$1" {MENTIONATTRIBUTES}>$2</span>')),s=this.getMarkedEmailIds(s,Date.now())):""},getMarkedEmailIds:function(e,o){var t=new RegExp("(<a.*?>.*?</a>)|(<pre>(.|\n)*?</pre>)|(\\s|^|<br>)"+$WC.Matcher.regexes.mail.source+"(?=\\s|<br>|$)","ig"),r=this;return e=e.replace(t,function(e,t,s,i,n,a){return r.isAllowedforParsing(e)?n+$WC.template.replace('<a href="mailto:{{content}}" class="eventnotifier"  id="MCPE_{{time_stamp}}" parsertype="emailid">{{content}}</a>',{time_stamp:o,content:a}):e})},isAllowedforParsing:function(e){return-1===e.indexOf("</a>")&&-1===e.indexOf("</pre>")},isNewMentionMsg:function(e){return $WC.Matcher.check("zcatmention_v2",e)},getDisplayableMentionHTML:function(e,t,s,i){var n=t.type,a=t.mentionedid,o=t.operation,r=t.dname,l="";if(null==r)return t.mentionmsg;(r=$WC.$CUtil.processXSS(r),n===$WC.CMsgUtil.UserMention)?(r=("addchatmember"==o?"+":"deletechatmember"==o?"-":"@")+r,l="user"):n===$WC.CMsgUtil.GroupMention?(-1!=a.search("G")&&(a=a.substring(1)),r="@"+r,l="group"):n===$WC.CMsgUtil.ChannelMention?(r=r||WmsChannels.getChannelName(a),l="channel"):n===$WC.CMsgUtil.BotMention?(r="@"+r,l="user"):n!==$WC.CMsgUtil.AvailableMention&&n!==$WC.CMsgUtil.ParticipantsMention||(l=n===$WC.CMsgUtil.ParticipantsMention?r+"mention":r,r="@"+r);var d=s+' mentiontype="'+n+'"';return i.replace(/{MENTIONATTRIBUTES}/g,d).replace(/{MENTIONELEMTYPE}/g,l).replace(/\$1/g,a).replace(/\$2/g,$WC.Matcher.replace("escapeReplacementString",r))},getDisplayableMention:function(e,t,u){var p=' mention_on="'+(void 0!==e.ctype?parseInt(e.ctype):1)+'"';if(this.isNewMentionMsg(t)){function s(e,t,s,i,n){this.type=s,this.mentionedid=i,this.dname=t,this.action=void 0!==n?n:"",this.mentionmsg=$WC.Util.isEmpty(e)?this.getMentionFormat():e,this.mentionregex=$WC.Util.isEmpty(e)?this.getMentionFormat(!0):e}s.prototype.getMentionFormat=function(e){var t=this.type===$WC.CMsgUtil.ChannelMention?"#":"@",s=this.type===$WC.CMsgUtil.GroupMention?"G":"";return"{"+((e&&!$WC.Util.isEmpty(this.action)?"\\"+this.action:this.action)+t+s+this.mentionedid)+"}"},s.prototype.getOperation=function(){return $WC.Util.isEmpty(this.action)?"mention":"+"===this.action?"addchatmember":"deletechatmember"};var i=function(e){var t=e.hasOwnProperty("meta")?e.meta.hasOwnProperty("mentions")?e.meta.mentions:e.meta:{};e.hasOwnProperty("mentions")&&$WC.Util.extend(t,e.mentions);e.hasOwnProperty("replied")&&e.replied.hasOwnProperty("info")&&e.replied.info.hasOwnProperty("meta")&&$WC.Util.extend(t,e.replied.info.meta.mentions);return void 0!==t?t:{}}(e);if(void 0!==i&&!$WC.Util.isEmptyObject(i))for(var n in i){var a=i[n],o=new s("",a.name,a.type,a.id,a.action),r={};r.mentionmsg=o.mentionmsg,r.operation=o.getOperation(),r.mentionedid=a.id,r.type=a.type,r.dname=a.name;var l=new RegExp(o.mentionregex,"gi");t=t.replace(l,this.getDisplayableMentionHTML(e,r,p,u))}return t}return $WC.Matcher.replaceWithFlag("atmentiontemplate",t,"g",function(e,t,s,i,n){var a=i.split(":"),o=a[0].slice(1),r=a[1],l=parseInt(a[2]),d="";(a=a.slice(3)).pop();var c=$WC.Util.decodeHTMLEntities(a.join(":"));(c=$WC.$CUtil.processXSS(c),l===$WC.CMsgUtil.UserMention)?(c=("addchatmember"==o?"+":"deletechatmember"==o?"-":"@")+c,d="user"):l===$WC.CMsgUtil.GroupMention?(c="@"+c,d="group"):l===$WC.CMsgUtil.ChannelMention?d="channel":l===$WC.CMsgUtil.BotMention&&(c="@"+c,d="user");var m=p+' mentiontype="'+l+'"';return u.replace(/{MENTIONATTRIBUTES}/g,m).replace(/{MENTIONELEMTYPE}/g,d).replace(/\$1/g,r).replace(/\$2/g,$WC.Matcher.replace("escapeReplacementString",c))})},processMsg:function(e,t,s){return void 0!==t&&t.raw&&(e=$WC.$CUtil.processXSS(e),e=$WC.Markdown.replaceInstantButton(e,t),e=$WC.Markdown.apply(e)),this.getMarkedDownContent(e,s)},getMarkedDownContent:function(e,t){if(e=e.trim(),e=Smiley.replace(e),e=this.trim(e),"function"==typeof $WC.Config.get("getSilentUserMention")&&(e=$WC.Config.get("getSilentUserMention")(e)),!t){for(var s=e.split(" "),i=[],n=0;n<s.length;n++){var a=s[n];a=this.convertLinks(a),a=this.getSafeATagTarget(a),a=this.addAttributesToViewableImg(a),i.push(a)}e=i.join(" ")}return e},trim:function(e){return e=e.replace(/<p>/gi,"").replace(/<\/p>/gi,"").replace(/\n/gi,"<br>")},convertMailIds:function(e){return e=" "+e,e=(e=$WC.Matcher.replaceWithFlag("mail",e,"gi")).trim()},convertHomographToText:function(e){var t=e;0!==e.indexOf("http://")&&0!==e.indexOf("https://")&&(t="http://"+e);var s=document.createElement("a");s.href=t;var i=s.href.toLowerCase();return i===t.toLowerCase()||i===e.toLowerCase()+"/"||i===t.toLowerCase()+"/"?e:s.href},convertLinks:function(i){var e=!1;return i.startsWith("(")&&i.endsWith(")")&&(i=i.slice(1,-1),e=!0),i=$WC.Matcher.replaceWithFlag("linkRegExp",i,"gi",function(e,t){return e!==i&&$WC.Matcher.checkWithFlag("invalidlink",$WC.Util.decodeHTMLEntities(i),"i")?e:"<a href='"+$WC.CMsgUtil.convertHomographToText(t)+"' target='_blank' rel='noopener'>"+t+"</a>"}),i=$WC.Matcher.replaceWithFlag("zcWWWlinkRegExp",i,"gi",function(e,t,s){return e!==i&&$WC.Matcher.checkWithFlag("invalidlink",$WC.Util.decodeHTMLEntities(i),"i")?e:"<a href='http://"+$WC.CMsgUtil.convertHomographToText(t)+"' target='_blank' rel='noopener'>"+t+"</a>"}),i=$WC.Matcher.replaceWithFlag("twoletterendinglink",i,"gi","$1<a href='http://$2' target='_blank' rel='noopener'>$2</a>"),i=(i=$WC.Matcher.replaceWithFlag("threeletterendinglink",i,"gi","$1<a href='http://$2' target='_blank'rel='noopener'>$2</a>")).trim(),i=e?"("+i+")":i},getSafeATagTarget:function(e){return $WC.Matcher.replacer($WC.Matcher.getRegexToGetAttrValueInHtmlTag("a","href"),null,e,function(e,t,s,i,n,a,o,r){return 0===n.indexOf("mailto:")?e:t+n+o+' dataurl="'+$WC.$CUtil.processXSS(n)+'" '+r})},addAttributesToViewableImg:function(e){return $WC.Matcher.replacer($WC.Matcher.getRegexToAddAttrToHtmlTag("img"),null,e,'$1 documentclick="viewattachment" previewelem $3')},getFormattedMsgContent:function(n){for(var e="",t=n["long.msg"],s=0;s<t.length;s++){var i=t[s],a=i.buttons;if(e+='<div class="msgbox '+(a&&a.length?"zccustmsg":"")+'" >',e+=i.title?'<div class="msgtitle ellips"><span class="subtitle">'+this.processMsg(""+i.title,n)+"</span></div>":"","text"===i.type)e+=['<div class="cntmsgtxt">',"<div>"+this.processMsg(i.data,n)+"</div>","</div>"].join("");else if("list"===i.type){var o="";i.styles&&(o=i.styles.type),e+=['<div class="msgcntbdy dIB">','<ul class="lst mrgL8 '+(o||"non_type")+'">'+E(i)+"</ul>","</div>"].join("")}else if("table"===i.type){var r=[],l=[];i.styles&&(i.styles.width&&(r=i.styles.width),i.styles.text_align&&(l=i.styles.text_align));var d="",c="style=max-width:fit-content; ";r.length&&(d="tblefxed",c=""),e+="<div "+c+'class="msgcntbdy dIB">',e+='<div class="msgtble"><div class="msgtblecnt '+d+'">';var m=i.data.rows,u=i.data.headers;r=[];i.styles&&i.styles.width&&(r=i.styles.width),e+='<div class="tblerow">';for(var p=0;p<u.length;p++){var h="style=text-align:"+(l[p]?l[p]+";":"center;");r[p]&&(h=h+"width:"+r[p]+"%;"),e+='<div class="tblecel" '+h+">"+this.processMsg(""+u[p],n)+"</div>"}if(e+="</div>",m)for(var g=0;g<m.length;g++){var f=m[g];e+='<div class="tblerow">';for(var C=0;C<f.length;C++){e+='<div class="tblecel" '+(h="style=text-align:"+(l[C]?l[C]:"center"))+">"+(f[C]?this.processMsg(""+f[C],n):"-")+"</div>"}e+="</div>"}e+="</div></div></div>"}else if("images"===i.type){for(var v=$WC.$CUtil.getAspectRatioFit(i.data[0].width,i.data[0].height,300,200,!1),b="",y=0;y<i.data.length;y++){var _=i.data[y];b+='<img previewelem purpose=custom_image_preview style="height:'+v.height+'px; width: auto;" src="'+_.url+'" />'}e+='<div class="zcimgsldr" style="height:'+v.height+'px;">'+b+"</div>"}else if("image"===i.type){if($WC.Util.isEmptyObject(i.data))continue;var W=i.data;e+='<div><img previewelem purpose=custom_image_preview style = "max-width:100%; width:'+(W.width?W.width+"px;":"100%;")+" height="+(W.height?W.height+"px;":"224px;")+'" src="'+i.url+'" /></div>'}else if("label"===i.type){e+='<div class="msgcntbdy dIB"><div class="msgtble"><div class="thmeslabcnt">';for(var S=i.styles,w=(r="100%",S&&S.short?"short":"lblmsgcnt"),M=0;M<i.data.length;M++){var I=i.data[M];for(var T in I)e+='<div class="zclblpair '+w+'"><div class="zcmslble">'+this.processMsg(T,n)+'</div><div class="zcmsnme">'+this.processMsg(I[T],n)+"</div></div>"}e+="</div></div></div>"}else if("percentage_chart"===i.type){e+="<div data-chartindex="+s+" data-operation='openchartpreview' >";var A={chartObjInfo:i,isPreview:!1,showLegends:!1};e+=$WC.Charts.getChartsHtml(A)+"</div></div>"}else if("graph"===i.type){e+="<div class='zcq-graph-inline' data-chartindex="+s+" data-operation='openchartpreview' >";A={chartObjInfo:i,isPreview:!1,showLegends:!1};e+=$WC.Charts.getChartsHtml(A)+"</div></div>"}e+=a?$WC.CustomMsgUI.getButtonHTML(n,a,!0):"",e=(e+="</div>").replace(/PRIMARY_INDEX/g,s)}function E(e){for(var t=e.data,s="",i=0;i<t.length;i++)s+="<li>"+$WC.CMsgUtil.processMsg(""+t[i],n)+"</li>";return s}return e},getMsgCardAttWin:function(e,t,s,i){t.chid=e.chid,t.time=e.time,$WC.CustomMsg.storeMsgCardAttObj(t),e["btnindexvsdetails.msg"],t.btnindexvsdetails=e["btnindexvsdetails.msg"],MessageCardAttachments.getMsgAttWindow(t,s,i)},handleMsgCardAtt:function(e,t,s){var i,n={};if(s||(i=$(e.currentTarget).children(),n.status={loading:i}),s||void 0===t["att.msg"].data){n.success=function(e){$WC.CMsgUtil.getMsgCardAttWin(t,e,void 0,s)},n.error=function(){MessageCardAttachments.handleErrorOnFetchFile()};var a=t["att.msg"].key;if($WC.Matcher.check("qq",a))n.url="/api/v2/chats/"+t.chid+"/messages/"+t.msguid+"/attachments";else{var o=MessageCardAttachments.getMsgAttFileUrl(a);if(!o.startsWith("/v2"))return s||$Util.Button.addLoadIconForAjax(i),FileDownload.fetchFile(o,i,{onSuccess:function(e){$WC.CMsgUtil.getMsgCardAttWin(t,e,i,s)},onError:MessageCardAttachments.handleErrorOnFetchFile});n.url=o}$ZCAjx.ajax(n)}else{$Util.Button.addLoadIconForAjax(i);var r=t["att.msg"].data;t["btnindexvsdetails.msg"],r.btnindexvsdetails=t["btnindexvsdetails.msg"],MessageCardAttachments.getMsgAttWindow(r,i,s)}},handleButtons:function(e,t,s,i,n,a){var o=$WC.CustomMsg.getMsgObj(e,i,n);if(o){if($WC.CMsgUtil.isMessageCardAttachment(o)&&t.currentTarget.hasAttribute("attbtn"))return $WC.CMsgUtil.handleMsgCardAtt(t,o,!1);var r,l=o.msguid;if(o["btnindexvsdetails.msg"]){var d=e.getAttribute("btnindex");r=o["btnindexvsdetails.msg"][d]}else{var c=e.parentElement.getAttribute("primaryindex"),m=(d=e.getAttribute("index"),c?o["long.msg"][c]:o["brief.msg"]);r=m.buttons[d]}var u=r.action,p=u.data;if(void 0!==p){var h,g=u.type,f=u.confirm,C=(i=o.chid,o.sender);n=o.time;if(void 0!==f&&((h=$WC.Util.extend(!0,{},f)).type="confirm"),"undefined"!==g)if("invoke.function"===g||"oembed.action"===g||"invoke.internalurl"===g){if("undefined"!==p.name){var v=p.name;if(void 0!==h){if($WC.$Win.destroy("custommsg"),h.btncallback=function(){"function"==typeof s&&s(v,i,n,e.getAttribute("btnindex"))},f.input&&"user_webhook_token"===f.input.type&&($WC.$Win.destroy("custommsg"),o.message_source.store_appname?h.component_name=o.message_source.store_appname:h.component_name=o.message_source.name),void 0!==WmsMainUI)if(h.closeCallback=function(){document.getElementById("zcwindows")&&(document.getElementById("zcwindows").innerHTML=null)},null===document.getElementById("zcwindows"))(_=$WC.Util.createElement("div","zcwindows","zcoverlay")).style.zIndex=WebMessanger.setzindex,document.body.appendChild(_);$WC.Widgets.construct(h)}else"function"==typeof s&&s(v,i,n,e.getAttribute("btnindex"))}}else if("open.url"===g||"preview.url"===g){if("undefined"!==p.web){var b,y=p.web;if(b="preview.url"===g?function(){$WC.IFrame.create({id:"button_preview_iframe",header:r.label,url:y})}:function(){window.open(y,"_blank")},void 0!==h){var _;if(h.btncallback=b,void 0!==WmsMainUI)if(h.closeCallback=function(){document.getElementById("zcwindows")&&(document.getElementById("zcwindows").innerHTML=null)},null===document.getElementById("zcwindows"))(_=$WC.Util.createElement("div","zcwindows","zcoverlay")).style.zIndex=WebMessanger.setzindex,document.body.appendChild(_);$WC.Widgets.construct(h)}else{var W=y.split(window.location.host)[1];!$WC.Util.isEmpty(W)&&window.ZCPermalink&&ZCPermalink.handle(W.split("/"),!0)||b()}}}else if("system.api"===g){var S=p.api;void 0!==S&&(this.isClientTriggerSystemApi(S.split("/")[0])&&"function"==typeof $WC.Config.get("SystemApiHandler")?($WC.$Win.destroy("custommsg"),$WC.$Win.destroy("attmsg"),$WC.Config.get("SystemApiHandler")(S,{chid:i,sender:C,msguid:l})):this.triggerSystemAction(S,d,i,l,n,a,{buttonText:t.target.getAttribute("value")||t.target.text}))}}}},triggerSystemAction:function(e,t,s,i,n,a,o){var r="api="+e+"&chid="+s+(void 0!==i?"&msguid="+i.replace("%20","_"):""),l={index:t,chid:s,msgtime:n,isTempResponse:a};o&&(l.additionalparams=o),$WC.Config.get("ExecuteButtonResponseHandler")("handleStatusChange","loading"),$WC.Ajax.postRequestToChat("executesystemaction.do",r,function(e){$WC.CMsgUtil.handleActionResponse(e,this.opts.callbackargs)},function(e){$WC.CMsgUtil.handleActionResponse(e,this.opts.callbackargs)},l,!0)},handleActionResponse:function(e,t){if($WC.Config.get("ExecuteButtonResponseHandler")("handleStatusChange","complete"),e){var s=t.chid;t.msgtime,t.index;if("banner"===e.type)"function"==typeof $WC.Config.get("ExecuteButtonResponseHandler")&&$WC.Config.get("ExecuteButtonResponseHandler")("handleSystemResponse",e,{chid:s});else if("function"==typeof $WC.Config.get("ExecuteButtonResponseHandler")){var i={chid:s,title:t.additionalparams?t.additionalparams.buttonText:""};$WC.Config.get("ExecuteButtonResponseHandler")("renderResponse",e,i)}}},isClientTriggerSystemApi:function(e){return 0<=["startchat","audiocall","videocall","videobroadcast","joinchannel","invite","userrecentchats","locationpermission"].indexOf(e)},getBriefMsgTitle:function(e){var t=e["brief.msg"];return void 0!==t.title?(t.icon?'<img class="zcprvwicn" src="'+t.icon+'"/>':"")+this.processMsg(t.title,e):""},getMsgObjVersion:function(e){return void 0!==e.version?e.version:"v0"},getImageUrlFromId:function(e){return $WC.Config.get("CHATCONT")?"/"+$WC.Config.get("CHATCONT")+"/v1/images/"+e:"/v1/images/"+e},convertMsgObj:function(e){switch($WC.CMsgUtil.getMsgObjVersion(e)){case"v0":var t=$WC.Util.cloneObject(e),s=$WC.Util.cloneObject(e);switch(e.mtype?e.mtype:"12"){case"12":if(void 0!==t.meta){var i=t.meta.usermessagedetails;if(void 0!==i){var n={};void 0!==i.custom_sender_name&&(n.name=i.custom_sender_name,void 0!==i.hiddensender&&(n.hiddensender=i.hiddensender)),void 0!==i.custom_sender_imageurl?n.img=i.custom_sender_imageurl:void 0!==i.custom_sender_imageid&&(n.img=this.getImageUrlFromId(i.custom_sender_imageid)),void 0!==i.custom_sender_id&&(n.id=i.custom_sender_id),void 0!==t.meta.ms&&(n.ms=t.meta.ms),$WC.Util.isEmptyObject(n)||(s["custom.sender"]=n);var a={};void 0!==i.msg_title&&(a.title=i.msg_title),e.meta.usermessagedetails.custom_message&&void 0!==t.msg&&(a.desc=t.msg),void 0!==i.thumbnail_url?a.thumbnail=i.thumbnail_url:void 0!==i.thumbnail_id?a.thumbnail=this.getImageUrlFromId(i.thumbnail_id):void 0!==i.thumbnail_zuid&&(a.thumbnail=WmsContacts.getUserPhoto(i.thumbnail_zuid)),void 0!==i.thumbnail_preview_url?a.img=i.thumbnail_preview_url:void 0!==i.thumbnail_preview_id&&(a.img=this.getImageUrlFromId(i.thumbnail_preview_id)),void 0!==i.icon_url&&(a.icon=i.icon_url),void 0!==i.themeid&&(a.themeid=i.themeid),void 0!==i.themeColor&&(a.themeColor=i.themeColor),void 0!==i.buttons&&(a.buttons=i.buttons),$WC.Util.isEmptyObject(a)||(s["brief.msg"]=a)}void 0!==t.meta.post_in_parent_information&&(s.post_in_parent_information=t.meta.post_in_parent_information),void 0!==t.meta.formattedmsg&&(s["long.msg"]=$WC.$CUtil.cloneArray(t.meta.formattedmsg)),void 0!==t.meta.attachments_button&&(s["att.msg"]=$WC.Util.cloneObject(t.meta.attachments_button)),void 0!==t.meta.config&&(s.config=$WC.Util.cloneObject(t.meta.config)),void 0!==t.meta.date_time_info&&(s.date_time_info=$WC.$CUtil.cloneArray(t.meta.date_time_info)),void 0!==t.meta.linkdetails&&(s.info={type:"unfurling",linkdetails:$WC.Util.cloneObject(t.meta.linkdetails),quotedlink:t.meta.quotedlink}),void 0!==t.meta.mentions&&(s.mentions=$WC.Util.cloneObject(t.meta.mentions)),void 0!==t.meta.customemoji&&(s.customemoji=t.meta.customemoji),void 0!==t.meta.btnindexvsdetails&&(s["btnindexvsdetails.msg"]=$WC.Util.cloneObject(t.meta.btnindexvsdetails)),void 0!==t.meta.opr_replydetails&&(s.isreply=!0,s.replied={info:$WC.Util.cloneObject(t.meta.opr_replydetails)},void 0!==t.meta.reply_type&&(s.reply_type=t.meta.reply_type)),void 0!==t.meta.message_source&&(s.message_source=t.meta.message_source),void 0!==t.meta.native_widget&&(s.native_widget=t.meta.native_widget),delete s.meta}void 0!==t.temp_info&&void 0!==t.temp_info.suggestions&&(s.botSuggestions=$WC.$CUtil.cloneArray(t.temp_info.suggestions));break;case"16":s.info=$WC.Util.cloneObject(t.msg,!0),delete s.msg,s.info.type="operations",$WC.Util.isEmpty(s.info.opruser)||$WC.Util.isEmptyObject(s.info.opruser)||(s.sender=s.info.opruser.zuid);break;case"20":void 0!==t.meta&&void 0!==t.meta.mentions&&(s.mentions=t.meta.mentions),void 0!==t.meta&&void 0!==t.meta.customemoji&&(s.customemoji=t.meta.customemoji),void 0!==t.meta&&void 0!==t.meta.post_in_parent_information&&(s.post_in_parent_information=t.meta.post_in_parent_information),void 0!==t.meta&&void 0!==t.meta.opr_replydetails&&(s.isreply=!0,s.replied={info:$WC.Util.cloneObject(t.meta.opr_replydetails)},void 0!==t.meta.reply_type&&(s.reply_type=t.meta.reply_type),delete s.meta),s.info=$WC.Util.cloneObject(t.msg,!0),delete s.msg,s.msg=s.info.comment,s.info.type="attachments",s.info.mod=t.mod,t.wmsfilesharingtype&&(s.info.wmsfilesharingtype=t.wmsfilesharingtype)}(e=s).version="v1",void 0!==e.msgid&&(e.ack=e.msgid),e.id=e.time,delete e.msgid}return e}},($WC=$WC||{}).WindowObject=function(e){this.id=e.id,this.draggable=void 0!==e.draggable&&e.draggable,this.nav=!0===e.nav,this.sigleton=!0===e.sigleton,this.bg=void 0===e.bg||e.bg,this.opencallback=void 0!==e.openfn?e.openfn:null,this.closecallback=void 0!==e.closefn?e.closefn:null,this.closebeforecallback=void 0!==e.closebeforefn?e.closebeforefn:null,this.closeoutside=void 0!==e.closeoutside&&e.closeoutside,this.aligncenter=void 0===e.aligncenter||e.aligncenter},$WC.WindowObject.prototype={create:function(e){var t=this.id,s=this.getTemplate(),i=this.aligncenter?" zcalgncntr":"",n='<span id="winclose" title="'+$WC.I18N("common.to.close")+'" class="zchat-close cclose"></span>',a=e.additionalattrs||"";s=s.replace(/{WININDEX}/g,t).replace(/{WINCLASS}/g,void 0!==e.class?e.class+i:i).replace(/{WINHEADER}/g,void 0!==e.header?$WC.Matcher.replace("escapeReplacementString",e.header):"").replace(/{WINCLOSE}/g,void 0!==e.closehtml?$WC.Matcher.replace("escapeReplacementString",e.closehtml):n).replace(/{DRAGGABLE}/g,this.draggable?"drag":"").replace(/{WINADDITIONALATTR}/g,a).replace(/{WINHTML}/g,$WC.Matcher.replace("escapeReplacementString",e.html));var o=document.getElementById("zcwindows");if(o){o.insertAdjacentHTML("beforeend",s);var r=this.getelem(),l=this;return Gator(r).on("mousedown",function(e){l.handleClick(l,e)}),this.getMeFront(),this.focusInputField(),null!=this.opencallback&&this.opencallback(this.id),this.draggable&&Gator(r).on("mousedown",".drag",function(e){l.drag(e,l)}),$WC.$Win.current=t,this.get()}},focusInputField:function(){var e=this.getelem();if(e){var t=e.querySelectorAll("input[type=text]");if(t.length)t[0].focus();else{var s=e.querySelectorAll("textarea");s.length&&s[0].focus()}}},handleClick:function(e,t){var s={winnav:function(){e.sigleton&&$WC.$Win.destroy(e.id,!0)},winclose:function(){$WC.$Win.destroy(e.id)}}[t.target.id];"function"==typeof s&&s()},drag:function(e,t){if(1==e.which||"INPUT"!==e.target.tagName){var s=t.getelem();if(s){var i=e.clientX-s.offsetLeft,n=e.clientY-s.offsetTop;Gator(s).on("mousemove",function(e){e.preventDefault();var t=s.style;t.left=e.clientX-i+"px",t.top=e.clientY-n+"px"}),Gator(s).on("mouseup",function(e){Gator(s).off("mousemove"),Gator(s).off("mouseup"),e.preventDefault})}}},close:function(e){var t=this.getelem();t&&(null!=this.closebeforecallback&&this.closebeforecallback(this.id),t.remove(),null==this.closecallback||e||this.closecallback(this.id))},getelem:function(){return document.getElementById(this.id)},get:function(){return!0===$WC.Config.get("PUREJS")?this.getelem():(window.jQuery?jQuery:$)('[id="'+this.id+'"]')},getMeFront:function(){var e=this.getelem();if(e){var t=e.querySelectorAll("#winnav");if(t.length&&t.remove(),this.nav&&$WC.$Win.persists())e.querySelectorAll("#winhead")[0].insertAdjacentHTML("afterbegin",'<span id="winnav" title="'+$WC.I18N("common.back")+'" class="zchat-zcheadicn mrgR10 fl_left"></span>');$WC.Util.removeClass(e,"zcbg_mask"),this.bg&&$WC.Util.addClass(e,"zcbg_mask"),this.handleCloseOutside(),e.parentNode.appendChild(e)}},handleCloseOutside:function(){var e=this.getelem(),t=this;this.closeoutside&&(e.insertAdjacentHTML("afterbegin",'<div class="zcbg_mask"></div>'),Gator(e).on("click",".zcbg_mask",function(){$WC.$Win.destroy(t.id)}))},getTemplate:function(){return['<div id="{WININDEX}" type="popup" class="modalwindow {WINCLASS} " {WINADDITIONALATTR}><div>','<div id="winhead" class="mheader {DRAGGABLE}">{WINHEADER}{WINCLOSE}</div>{WINHTML}</div>',"</div>"].join("")}},$WC.$Win=function(){var a={},n={"window-created":[],"window-destroyed":[]};return{isExist:function(e){return a.hasOwnProperty(e)},persists:function(){var e=document.getElementById("zcwindows");if(e)return 1<e.children.length},get:function(e){return this.isExist(e)?a[e].get():null},destroy:function(e,t){if(this.isExist(e)){a[e].close(t),delete a[e];var s=document.getElementById("zcwindows")&&document.getElementById("zcwindows").lastChild;this.current=$WC.Util.isEmpty(s)||$WC.Util.isEmptyObject(s)?null:s.getAttribute("id")}this.triggerEvent("window-destroyed")},handleOutsideClose:function(){var e=this.current;e&&this.isExist(e)&&a[e].closeoutside&&$WC.$Win.destroy(e)},getFront:function(e){a[e].getMeFront()},closeAll:function(){var e=document.getElementById("zcwindows");if(e){var t=e.children;t.length;if(!t)return;for(;t[0];){var s=t[0].id;this.isExist(s)&&this.destroy(s)}}},handleEscape:function(){var e=document.getElementById("zcwindows");if(e&&e.lastChild){var t=e.lastChild.id;if(this.isExist(t))return this.destroy(t),!0}return!1},create:function(e){var t,s,i=e.id;t=i,s=new $WC.WindowObject(e),a[t]=s;var n=a[i].create(e);return this.triggerEvent("window-created"),n},triggerEvent:function(e){if(n.hasOwnProperty(e)){function t(e){setTimeout(function(){e()},0)}for(var s=n[e],i=0;i<s.length;i++)"function"==typeof s[i]&&t(s[i])}},on:function(e,t){n.hasOwnProperty(e)&&n[e].push(t)},off:function(e){n.hasOwnProperty(e)&&(n[e]=[])}}}(),$WC.$Dlg={},$WC.$Dlg=function(){var n,t,s,a={},d=1,c=[1,2,3],e=!1;function o(){!1===e&&(n={draggable:!0,bg:!0,class:"zcdalogbx",openfn:function(){},bodyhtml:"",headerhtml:"",version:1,buttons:[]},t={buttons:[{text:$WC.I18N("common.ok"),colour:1}]},s={buttons:[{text:$WC.I18N("common.ok"),colour:2}]},e=!0)}function i(e){function t(e,t){switch(e){case 1:return 2===t?"buttn_neg":"buttn_pos";case 2:return"zcdlgbtn "+(2===t?"zcdlgbtn-red":1===t?"zcdlgbtn-green":"");case 3:return"zcl-btn-large mL20 "+(t||"zcl-btn--primary")}}for(var s,i="",n=e.imagehtml?'<div class="zcdlg_lft"><div class="zcpp_dlgltin">'+e.imagehtml+"</div></div>":"",a=(s=e,c.includes(s.version)?s.version:1),o=e.buttons.length,r=!1,l=0;l<o;l++)r||(d=l+1,r=!0),i+='<button button="'+(l+1)+'" class="'+t(a,e.buttons[l].colour)+'">'+e.buttons[l].text+"</button>";return m(a).replace(/{IMAGE}/g,n).replace(/{MESSAGE}/g,$WC.Matcher.replace("escapeReplacementString",e.bodyhtml)).replace(/{BUTTON}/g,i)}function r(t){var e;a[(e=t).id]={},a[e.id].buttons=e.buttons;var s=$WC.$Win.create({id:t.id,header:t.headerhtml,closehtml:'<span id="winclose" title="'+$WC.I18N("common.cancel")+'" class="zchat-close cclose"></span>',html:i(t),class:t.class,draggable:t.draggable,bg:t.bg,openfn:t.openfn,closefn:function(e){delete a[e],"function"==typeof t.closefn&&t.closefn()}});return"undefined"!=typeof jQuery&&s instanceof jQuery&&(s=s[0]),l(s,t.id),s}var m=function(e){switch(e){case 1:return['<div class="mcontent"><div class="dialogmn">{IMAGE}<div class="zcdlg_rht"><div class="zcdlgmsg">{MESSAGE}</div></div></div><div class="wctxtcent">{BUTTON}</div></div>'].join("");case 2:return['<div class="mcontent"><div class="mcontent_txt_con">{MESSAGE}</div><div class="mcontent_btn_con">{BUTTON}</div></div>'].join("");case 3:return['<div class="mcontent"><div class="mcontent_txt_con">{MESSAGE}</div><div class="mcontent_btn_con textR">{BUTTON}</div></div>'].join("")}},l=function(e,n){Gator(e).on("click","[button]",function(e){if($WC.$Dlg.isExist(n)){e.stopPropagation();var t=parseInt(this.getAttribute("button")),s=a[n].buttons[t-1].action;if("function"==typeof s)var i=s.call($WC.$Win.get(n));i||$WC.$Win.destroy(n)}})};return{GREEN_BUTTON:1,RED_BUTTON:2,GREY_BUTTON:3,create:function(e){if(o(),d=1,!$WC.$Dlg.isExist(e.id)){e=$WC.Util.extend(!0,{},n,e),(i=e).class+=void 0===i.imagehtml?" zcdgimgnone":"";var t=r(e=i),s=t.querySelectorAll('[button="'+d+'"]');return s&&s[0]&&s[0].focus(),t}var i},alert:function(e){o(),e=$WC.Util.extend(!0,{},t,e),this.create(e)},confirm:function(e){o(),e=$WC.Util.extend(!0,{},s,e),this.create(e)},isExist:function(e){return a.hasOwnProperty(e)},destroy:function(e){$WC.$Win.destroy(e)},frameHeaderHTML:function(e){var t="",s=e&&e.ispositive?"mheader_ttl clr-green":"mheader_ttl",i=e&&e.ispositive?"mheader_p clr-green":"mheader_p";return e&&e.imagehtml&&(t+=e.imagehtml),e&&e.header&&(t+='<div class="'+s+'">'+e.header+"</div>"),e&&e.subheader&&(t+='<div class="'+i+'">'+e.subheader+"</div>"),t},frameBodyInfoHTML:function(e){var t=e&&e.info?e.info.length:0,s=e&&e.infoheader?e.infoheader:$WC.I18N("dialogue.info.header"),i=0<t?'<div class="mcontent_ttl">'+s+"</div>":"";if(e&&$WC.Util.isEmpty(e.infoheader)&&1==t)i='<div class="zcdlg_rht">'+e.info[0]+"</div>";else if(0<t)for(var n=0;n<t;n++)i+='<div class="mcontent_p msi-rgtarw">'+e.info[n]+"</div>";return i},getButtonObj:function(e,t,s){return{text:$WC.I18N(e),colour:t,action:s}}}}(),$WC.Widgets=function(){var o={},e=!1;function r(){!1===e&&(o={alert:{class:"zchat-alrt",title:$WC.I18N("info.warning")},info:{class:"zchat-hisseld",title:$WC.I18N("info.success")},confirm:{class:"zchat-question",title:$WC.I18N("info.confirm")}},e=!0)}return{construct:function(e){if(r(),this.isValid(e)){var t='<div class="zcartcnt"><div><div class="{DLGLASS} wcdIB f40 mrgL10"></div><div class="wcdIB zcfarlt"><div class="zcartnm">{HEADER}</div><div class="clr0">{MSG}</div></div></div>{INPUT}</div>',s=o[e.type];if(t=(t="confirm"===e.type&&e.input?"user_webhook_token"===e.input.type?t.replace(/{INPUT}/g,"").replace(/{DLGLASS}/g,"zcf-integ").replace(/{HEADER}/g,$WC.I18N("webhooktoken.title.extn",[e.component_name])).replace(/{MSG}/g,$WC.I18N("webhooktoken.desc.extn",[e.component_name])):t.replace(/{INPUT}/g,'<textarea id="buttonconfirminput" placeholder="'+$WC.$CUtil.processXSS(e.input)+'" maxlength="300" class="zcartinp"></textarea>'):t.replace(/{INPUT}/g,"")).replace(/{DLGLASS}/g,s.class).replace(/{HEADER}/g,void 0!==e.title?$WC.$CUtil.processXSS(e.title):s.title).replace(/{MSG}/g,$WC.CMsgUtil.convertLinks(e.description)),("alert"===e.type||"info"===e.type||"confirm"===e.type)&&($WC.$Dlg.alert({id:"widget"+e.type,bodyhtml:t,buttons:[(a={},(n=e).input&&"user_webhook_token"===n.input.type?a.text=$WC.I18N("common.authenticate"):void 0!==n.btntxt&&(a.text=n.btntxt),void 0!==n.btncallback&&(a.action=n.btncallback),a.colour=$WC.$Dlg.GREEN_BUTTON,a)],closefn:"function"==typeof e.closeCallback?e.closeCallback:""}),"confirm"===e.type)){var i=document.getElementById("buttonconfirminput");null==i&&(i=document.getElementById("widget"+e.type).querySelector("button")),null!=i&&i.focus()}}var n,a},isValid:function(e){r();var t=!1;return void 0!==e.type&&(t=-1!=["alert","confirm","prompt","info","poll","photo"].indexOf(e.type)),t}}}(),($WC=$WC||{}).CustomMsg={msgobj:{},storeMsgObj:function(e){(e["brief.msg"]||e["btnindexvsdetails.msg"])&&($WC.CustomMsg.msgobj[e.chid]=$WC.CustomMsg.msgobj[e.chid]||{},$WC.CustomMsg.msgobj[e.chid][e.time]=e)},removeMsgObj:function(e){delete $WC.CustomMsg.msgobj[e]},getMsgObj:function(e,t,s){var i=e.closest("[chid]")||e;return $WC.CustomMsg.msgobj[t||i.getAttribute("chid")||e.closest("[data-chid]").getAttribute("data-chid")][s||i.getAttribute("time")||e.closest("[data-msgtime]").getAttribute("data-msgtime")]},getTheme:function(e){var t=e["brief.msg"];return t?t.themeid:""},storeMsgCardAttObj:function(e){$WC.CustomMsg.msgobj[e.chid][e.time]["att.msg"].data=e}},$WC.CustomMsgUI={button:{text:{theme1:1,theme2:3,theme3:1,theme4:2,theme5:1,theme6:0,theme7:3,theme8:1,theme9:10,theme10:2}},getCustomMessageContent:function(e){if(!e["brief.msg"])return"";var t="";void 0===e["long.msg"]||"percentage_chart"!==e["long.msg"][0].type&&"graph"!==e["long.msg"][0].type||(t=" zcq-charts-box"),$WC.CustomMsg.storeMsgObj(e);var s="zcmsg_bx zcmsg_bx"+$WC.CustomMsg.getTheme(e)+t,i="";return e["brief.msg"].themeColor&&(s+=" zcmsg_cstm_theme",i="--theme-clr: #"+e["brief.msg"].themeColor),['<div class="'+s+'" chid="'+e.chid+'"  time="'+e.time+'"     data-sendername="'+$WC.Util.safeHTML(e.dname)+'" customcardmsg',e["brief.msg"].themeColor?' style="'+i+'"':"",">",this.getThemeTemplateObj(e).getlayout(this.getThemeParamObj(e),e),"</div>"].join("")},getThemeParamObj:function(e){var t=e["brief.msg"];return{img:this.getThemeImageURL(e),desc:$WC.CMsgUtil.getDisplayContent(e),desctitle:e.msg?$WC.CMsgUtil.processMsg(e.msg.trim(),e):"",title:t.title?$WC.CMsgUtil.processMsg(t.title,e):"",titletooltip:t.title?e.raw?$WC.$CUtil.processXSS(t.title):t.title:"",icon:t.icon,button:$WC.CustomMsgUI.getButtonHTML(e),chid:e.chid,time:e.time}},getThemeImageURL:function(e){var t=$WC.CustomMsg.getTheme(e),s=e["brief.msg"];return-1<["1","2","4","7"].indexOf(t)?s.thumbnail||s.img:s.img||s.thumbnail},getCustomMsgOverlayHTML:function(e){var t='<div class="zc_cstm_ovrly';return e["brief.msg"].themeColor&&(t+=' zcmsg_cstm_theme" style="--theme-clr: #'+e["brief.msg"].themeColor),t+='">',$WC.CMsgUtil.isCustomMessage(e)&&(t+=$WC.CustomMsgTemplate.getOverlayCustomMsgHTML(e)),$WC.CMsgUtil.isCustomFormattedMsg(e)&&(t+=$WC.CMsgUtil.getFormattedMsgContent(e)),t+"</div>"},getThemeTemplateObj:function(e){return $WC.CustomMsgTemplate["theme_"+$WC.CustomMsg.getTheme(e)]},getButtonHTML:function(e,t,s){var i=e["brief.msg"],n=!!t;if(!(t=t||i.buttons)||!t.length)return"";var a="",o=t.length;$WC.CustomMsg.getTheme(e);btncount=n?5:$WC.CustomMsgUI.button.text["theme"+$WC.CustomMsg.getTheme(e)];for(var r=0;r<o;r++){var l=t[r],d=s?"primaryindex = PRIMARY_INDEX":"";if(r>=btncount){a+=this.constructBtnDropDown(t,e,d,btncount);break}a+=$WC.CustomMsgTemplate.getbutton(l,e,r)}return'<div class="zcntnbx"  '+d+">"+a+"</div>"},getMessageCardAttachmentButton:function(e){var t=e["att.msg"],s=$WC.$CUtil.processXSS(t.label);return['<div class="msgbox zccustmsg"><a class="zcbtn" title="View Attachments" chid="'+e.chid+'" time="'+e.time+'" custombuttonclick_onmsg attbtn>','<span data-cmsgbtn="true" class="cmsg-btn">'+s+"</span>","</a></div>"].join("")},constructBtnDropDown:function(e,t,s,i){for(var n=e.length,a='<div class="zcmorebtn" custom_btn_click><em custom_btn_click></em><ul>',o=i;o<n;o++)a+="<li "+s+">"+$WC.CustomMsgTemplate.getbutton(e[o],t,o)+"</li>";return a+"</ul></div>"},handleMoreMessage:function(e){var t=e.target.getAttribute("custom_message"),s=document.getElementById("cardmainmessage");$WC.Util.addClass(e.target,"zc_dN"),"show_more"===t?(s.style.height=parseInt(s.getAttribute("scrollHeight"))+30+"px",$WC.Util.removeClass(document.querySelectorAll('[custom_message="show_less"]')[0],"zc_dN")):(s.style.height=parseInt(s.getAttribute("clientHeight"))+"px",$WC.Util.removeClass(document.querySelectorAll('[custom_message="show_more"]')[0],"zc_dN"))},handleCustomBoxClick:function(e,t,s){var i=$WC.CustomMsg.getMsgObj(e);if("custom_image_preview"===t.target.getAttribute("purpose")){var n=i["brief.msg"];return!n.img&&t.target.src&&(n.img=t.target.src),void this.showOriginalImage(n)}"a"!==t.target.tagName.toLowerCase()&&$WC.$Win.create({id:"custommsg",class:"cmsgdlg",header:$WC.CMsgUtil.getBriefMsgTitle(i),html:$WC.CustomMsgUI.getCustomMsgOverlayHTML(i),additionalattrs:' chid="'+i.chid+'" time="'+i.time+'"',closefn:s})},handleOverlayImage:function(e){var t=$WC.CustomMsg.getMsgObj(e),s=t?t["brief.msg"]:{img:e.getAttribute("src")};this.showOriginalImage(s)},showOriginalImage:function(e){$WC.$Win.create({id:"custommsgimgprev",class:"cmsgdlg cmsgprev",html:$WC.CustomMsgTemplate.getImagePreviewHTML(e)})}},$WC.CustomMsgTemplate={theme_0:{getlayout:function(e,t){var s="";return $WC.CMsgUtil.isCustomFormattedMsg(t)&&(s=$WC.CMsgUtil.getFormattedMsgContent(t)),$WC.CMsgUtil.isMessageCardAttachment(t)&&(s+=$WC.CustomMsgUI.getMessageCardAttachmentButton(t)),['<div class="zcthm0ctr">',e.title?'<div class="zctitle" title="'+e.titletooltip+'">'+(e.icon?'<img src="'+e.icon+'">':"")+e.title+"</div>":"",e.img?'<img src="'+e.img+'" purpose="custom_image_preview" >':"",'<div class="btncnt">','<div class="zcdesc">'+e.desc+"</div>","</div>",e.button,"</div>","<div>"+s+"</div>"].join("")}},theme_1:{getlayout:function(e){return[e.desc?'<div class="zcdesc"><div>'+e.desc+"</div></div>":"",'<div class="btncnt">',e.img?'<div class="zcimg"><img src="'+e.img+'" purpose="custom_image_preview" ></div>':"",e.title?'<div class="zctitle">'+(e.icon?'<img src="'+e.icon+'">':"")+'<div title="'+e.titletooltip+'">'+e.title+"</div></div>":"",e.button,"</div>"].join("")}},theme_2:{getlayout:function(e){return[e.img?'<img src="'+e.img+'" purpose="custom_image_preview" >':"",'<div class="btncnt">',e.title?'<div class="zctitle" title="'+e.titletooltip+'">'+(e.icon?'<img src="'+e.icon+'">':"")+e.title+"</div>":"",'<div class="zcdesc"><div>'+e.desc+"</div></div>",e.button,"</div>"].join("")}},theme_3:{getlayout:function(e){return['<div class="btncnt">',e.img?'<img src="'+e.img+'" purpose="custom_image_preview" >':"",e.title?'<div class="zctitle" title="'+e.titletooltip+'">'+(e.icon?'<img src="'+e.icon+'">':"")+e.title+"</div>":"",'<div class="zcdesc"><div>'+e.desc+"</div></div>",e.button,"</div>"].join("")}},theme_4:{getlayout:function(e){return['<div class="btncnt">',e.img?'<img src="'+e.img+'" purpose="custom_image_preview" >':"",e.title?'<div class="zctitle" title="'+e.titletooltip+'">'+(e.icon?'<img src="'+e.icon+'">':"")+e.title+"</div>":"",'<div class="zcdesc"><div>'+e.desc+"</div></div>","</div>",e.button].join("")}},theme_5:{getlayout:function(e){return[e.img?'<img src="'+e.img+'" purpose="custom_image_preview" >':"",e.button,'<div class="btncnt">',"<div>",e.title?'<div class="zctitle" title="'+e.titletooltip+'">'+(e.icon?'<img src="'+e.icon+'">':"")+e.title+"</div>":"",'<div class="zcdesc"><div>'+e.desc+"</div></div>","</div>","</div>"].join("")}},theme_6:{getlayout:function(e){var t=e.title||"";return['<div class="btncnt '+(e.img?"":"zcnobg")+'" >',e.img?'<img src="'+e.img+'" purpose="custom_image_preview" >':"",t?'<div class="zctitle" title="'+e.titletooltip+'">'+(e.icon?'<img src="'+e.icon+'">':"")+t+"</div>":"","</div>",'<div class="zcbtmbx">','<div class="zcdesc"><div class="ellips">'+e.desc+"</div></div>",e.button,"</div>"].join("")}},theme_7:{getlayout:function(e){return[e.img?'<img src="'+e.img+'" purpose="custom_image_preview" >':"",'<div class="btncnt">',e.title?'<div class="zctitle" title="'+e.titletooltip+'">'+(e.icon?'<img src="'+e.icon+'">':"")+e.title+"</div>":"",'<div class="zcdesc"><div>'+e.desc+"</div></div>","</div>",e.button].join("")}},theme_8:{getlayout:function(e){var t=e.desc;return t=t.replace(/(?:\r\n|\r|\n)/g,"<br />"),[e.img?'<img src="'+e.img+'" purpose="custom_image_preview" >':"","<div>",'<div class="btncnt">',e.title?'<div class="zctitle" title="'+e.titletooltip+'">'+(e.icon?'<img src="'+e.icon+'">':"")+e.title+"</div>":"",'<div class="zcdesc"><div>'+t+"</div></div>","</div>",e.button,"</div>"].join("")}},theme_9:{getlayout:function(e){var t=document.createElement("div");t.innerHTML=e.button;var s,i=t.querySelectorAll("[btnindex]");return i.length&&(s=i[i.length-1],t.querySelectorAll("[btnindex]:last-child")[0].remove()),['<div class="btncnt">',e.img?'<img src="'+e.img+'" purpose="custom_image_preview" >':"",e.title?'<div class="zctitle" title="'+e.titletooltip+'">'+(e.icon?'<img src="'+e.icon+'">':"")+e.title+"</div>":"",'<div class="zcdesc"><div >'+e.desc+"</div>","</div>","</div>",t.innerHTML,'<div class="zcntrslut">'+(i.length?s.outerHTML:"")+"</div>"].join("")}},theme_10:{getlayout:function(e,t){var s="";return $WC.CMsgUtil.isCustomFormattedMsg(t)&&(s=$WC.CMsgUtil.getFormattedMsgContent(t)),['<div class="btncnt">',e.title?'<div class="zctitle" title="'+e.titletooltip+'">'+(e.icon?'<img src="'+e.icon+'">':"")+e.title+"</div>":"",'<div class="zcdesc">',e.img?'<img src="'+e.img+'" purpose="custom_image_preview" >':"","<p>"+e.desc+"</p>","</div>","</div>","<div>"+s+"</div>","<div>",e.button,"</div>"].join("")}},formatButton:function(e){return e.label||(e.text&&(e.label=e.text,delete e.text),e.click&&(e.action={},e.click["action.type"]&&(e.action.type=e.click["action.type"]),e.click["action.data"]&&(e.action.data=e.click["action.data"]),e.click["action.confirm"]&&(e.action.confirm=e.click["action.confirm"]),delete e.click)),e},getbutton:function(e,t,s){var i=t["btnindexvsdetails.msg"]?t["btnindexvsdetails.msg"][e]:e;if(!(i=this.formatButton(i)).action||!i.label)return"";var n=$WC.$CUtil.processXSS(i.label),a=i.hint?$WC.$CUtil.processXSS(i.hint):n;return['<a class="zcbtn '+("+"===i.type?"zcok":"-"===i.type?"zccancel":"")+'" title="'+a+'" chid="'+t.chid+'" time="'+t.time+'" custombuttonclick_onmsg index="'+s+'" btnindex="'+i.index+'" >','<span data-cmsgbtn="true" class="cmsg-btn">'+n+"</span>","</a>"].join("")},getImagePreviewHTML:function(e){return['<div class="cmsgimg">','<img src="'+(e.img||e.thumbnail)+'" />',"</div>"].join("")},getOverlayCustomMsgHTML:function(e){var t=e["brief.msg"],s=t.thumbnail||t.img,i=t.buttons;return['<div class="msgbox zccard-bx '+(i&&i.length?"zccustmsg":"")+'">','<div class="zccard">',s?'<img src="'+s+'" purpose="custom_image_preview" chid="'+e.chid+'" time="'+e.time+'"/>':"",'<div id="cardmainmessage" class="zccarddesc">'+$WC.CMsgUtil.getDisplayContent(e)+"</div>","</div>",$WC.CustomMsgUI.getButtonHTML(e,i),"</div>"].join("")},getBotSuggestionsContent:function(e){for(var t='<div botsuggestions class="zcbotsugg">',s=0;s<e.length;s++){var i=e[s],n=$WC.$CUtil.processXSS(i.text);t+='<div suggestionsclick_onmsg text="'+n+'" title="'+n+'">'+(i.icon?'<img src="'+i.icon+'">':"")+'<span class="font14 txtcent bold">'+n+"</span></div>"}return t+"</div>"}},$WC.IFrame=function(){var r=function(e,t,s,i){var n=$WC.template.replace(c.global_iframe,{iframe_tag_id:e+"_iframe",iframe_loader_id:e+"_loader",frame_url:t,frame_id:e});return $WC.template.replace(n,{header_txt:s,loader:o(i)},"InSecureHTML")},l=function(e,t,s){var i=document.getElementById(t+"_iframe"),n=e.length?e[0]:e;i.addEventListener("load",function(){setTimeout(function(){a(t,!0)},10)}),i.addEventListener("error",function(){setTimeout(function(){var e=i.getAttribute("src");d(e);a(t,!1)},10)}),n.addEventListener("click",function(e){if(e.target.hasAttribute("purpose")){var t=e.target,s=t.getAttribute("purpose"),i=t.getAttribute("uid");"frame_close"===s?$WC.$Win.destroy(i):"iframe_minimize"===s&&$WC.IFrame.minimize(i)}})},a=function(e,t){var s=document.getElementById(e+"_loader");s.innerHTML=null,s.classList.add("zci-hide"),t&&document.getElementById(e+"_iframe").classList.remove("zci-hide")},o=function(e){return $WC.template.replace(c.iframe_loading,{loader_txt:e})},d=function(e){var t="",s="This page content can’t be loaded here.",i="To help protect the security of information you enter into this website, the publisher of this content does not allow i to be displayed in a frame.",n="Open this content in a new tab",a="";return $WC.template.replace(c.iframe_load_error,{image_cls:t,error_hdr:s,error_text:i,btn_txt:n,btn_icn:a,frame_url:e})},c={global_iframe:'<div class="zci-wh100"><div class="zci-cont"><div class="zci-hdr"><div class="zci-hdr-txt">{{header_txt}}</div><div class="zci-fshrink"><div purpose="frame_close" uid={{frame_id}} class="zci-icon zchat-close"></div></div></div><div class="zci-flexG zci-posrel"><div id="{{iframe_loader_id}}" class="zci-wh100 zci-posabs">{{loader}}</div><iframe id="{{iframe_tag_id}}" class="zci-wh100 zci-hide" src={{frame_url}} style="border: none;"></iframe></div></div></div>',iframe_loading:'<div class="zci-loader-cont"><div class="zci-rloader zci-posrel zci-mB20" style="height: 40px; width: 40px;"></div><div class="zci-loader-txt">{{loader_txt}}</div></div>',iframe_load_error:'<div class="zci-loader-cont zci-empty"><div class="zci-error-img {{image_cls}}"></div><div class="zci-error-hdr">{{error_hdr}}</div><div class="zci-error-txt">{{error_text}}</div><a href="{{frame_url}}" button_type="open.url" target="_blank" class="zci-error-btn"><em class="{{btn_icn}}"></em>{{btn_txt}}</a></div>',within_iframe:"<div></div>"};return{create:function(e){if(e&&e.id&&e.url){var t=e.id,s=e.url,i=e.header||"IFrame",n=e.loader_txt;void 0===n&&(n="undefined"!=typeof $Util?$Util.getRandomQuotes():"Counting backwards from infinity..well that was fast.");var a=document.getElementById(t);if(null===a){var o=$WC.$Win.create({id:t,class:"zci-cont-holder",closeoutside:!0,html:r(t,s,i,n)});l(o,t,s)}else a.style.display="block",$WC.$Win.getFront(t)}},maximize:function(e){document.getElementById(e).style.display="block",$WC.$Win.getFront(e)},minimize:function(e){document.getElementById(e).style.display="none"},getHtml:r}}();var ChatTour={helpTipHtml:'<div id="wms_chattour_icon" class="{{ICON}}"></div><h4 class="wms_chattour_title">{{TITLE}}</h4><p>{{CONTENT}}</p><span data-operation="tournext">{{NAVIGATOR}}</span><div data-operation="close" class="{{CLOSE}}"></div>',checkAndScheduleNotifier:function(e){if(WmsSettings.isTourEnabled()&&!1===WmsSettings.isOnboardSeen()&&!1===WebMessanger.isChatPaused()){var t=(new Date).getTime()-e;clearTimeout(ChatTour.notifytimer);var s=1728e6-t;s<0&&(s=0),ChatTour.notifytimer=setTimeout(function(){if(!1===WmsSettings.isOnboardSeen()&&0===WmsMainUI.getUnreadChatsCount()){if(!0===WebMessanger.isCliqUser())return;ChatTour.insertTourNotifier(document.querySelector('#wms_menubar > [data-menuname="chat"]'))}},s)}},isTourNotificationShown:function(){return!!this.tournotifier},insertTourNotifier:function(e){if(e){var t=$WC.Util.createElement("span",null,"wms_chattour_initial");ChatTour.tournotifier=e.appendChild(t)}},removeTourNotifier:function(){ChatTour.tournotifier&&($WC.Util.removeElement(ChatTour.tournotifier),ChatTour.tournotifier=null)},init:function(e,t){if(ChatTour.list=e,ChatTour.removeTourNotifier(),ChatTour.tipnum=0,null===document.getElementById("wms_tourcontainer")){var s='<div id="wms_tourcontainer"><div id="wms_touroverlay" class="wms_touroverlay"></div><div id="wms_skiptour" data-operation="tourskip" class="wms_tourskip">'+$WC.I18N("tour.skip")+"</div></div>";t.insertAdjacentHTML("beforeend",s);var i='<div id="wms_chattour" class="wms_chattour" style="z-index:'+$WC.Config.get("zindex")+'"><div id="wms_tourpointer" class="wms_tour_pointer wms_tour_pntdown"></div><div id="wms_chattour_content"></div></div>';document.body.insertAdjacentHTML("beforeend",i),ChatTour.bindEvents(),ChatTour.showHelpTip()}},bindEvents:function(){var e=document.getElementById("wms_tourcontainer"),t=document.getElementById("wms_chattour");Gator(t).on("click","[data-operation]",function(){var e=this.getAttribute("data-operation");"tournext"===e?ChatTour.tipnum===ChatTour.list.length-1?ChatTour.exit(!0,!0):ChatTour.nextHelpTip():"tourprev"===e?ChatTour.prevHelpTip():"close"===e?ChatTour.exit(!0):"visitcliq"===e&&(window.open(_WMSCHATURL),ChatTour.exit(!0,!0))}),Gator(e).on("click","[data-operation]",function(){"tourskip"===this.getAttribute("data-operation")&&ChatTour.exit(!0)})},handleKeyMovement:function(e){if(null!==document.getElementById("wms_tourcontainer")){var t=window.event?e.keyCode:e.which;return t===$WC.WmsConstants.KEYCODES.LEFT?ChatTour.prevHelpTip():t===$WC.WmsConstants.KEYCODES.ENTER||t===$WC.WmsConstants.KEYCODES.RIGHT?ChatTour.tipnum!==ChatTour.list.length-1&&ChatTour.nextHelpTip():t===$WC.WmsConstants.KEYCODES.ESCAPE&&ChatTour.exit(!0),!0}},prevHelpTip:function(){0<ChatTour.tipnum&&(ChatTour.hidePreviousHighlight(),ChatTour.tipnum--,ChatTour.showHelpTip())},nextHelpTip:function(){ChatTour.hidePreviousHighlight(),ChatTour.tipnum<ChatTour.list.length-1&&(ChatTour.tipnum++,ChatTour.tipnum<ChatTour.list.length&&ChatTour.showHelpTip())},exit:function(e,t){if("number"==typeof ChatTour.tipnum&&ChatTour.list&&ChatTour.tipnum<ChatTour.list.length&&ChatTour.hidePreviousHighlight(),e){var s=t?"0:"+ChatTour.list.length:ChatTour.tipnum+1+":"+ChatTour.list.length;WmsSettings.updateTourSettings(WmsSettings.constants.ONBOARD,s)}ChatTour.removeTourNotifier();var i=document.getElementById("wms_tourcontainer");$WC.Util.removeElement(i);var n=document.getElementById("wms_chattour");$WC.Util.removeElement(n)},showHelpTip:function(){var e=document.getElementById("wms_chattour_content"),t=$WC.I18N("Next"),s=ChatTour.helpTipHtml,i=ChatTour.list[ChatTour.tipnum];0===ChatTour.tipnum&&i.sethtml||(s+='<span data-operation="tourprev" style="float:left">'+$WC.I18N("tour.back")+"</span>"),ChatTour.tipnum===ChatTour.list.length-1&&(t=$WC.I18N("Finish")),s=$WC.template.replace(s,{ICON:i.icon||"",TITLE:$WC.I18N(i.title||""),CONTENT:$WC.I18N(i.content||""),NAVIGATOR:$WC.I18N(i.navigator)||t,CLOSE:i.sethtml?"":"wms_chattour_close"});var n=document.querySelector("["+i.elemid+"]");if(e.innerHTML=s,i.sethtml){if(i.replacetext)for(var a in i.replacetext){var o={};o[a]=$WC.I18N(i.replacetext[a]),i.sethtml=$WC.template.replace(i.sethtml,o)}document.getElementById("wms_chattour_icon").insertAdjacentHTML("afterend",i.sethtml)}i.elemid&&$WC.Util.addClass(n,"wms_chattour_elemhighlight"),ChatTour.positionHelpTip(n,i.align,i.position)},positionHelpTip:function(e,t,s){var i=document.getElementById("wms_chattour"),n=document.getElementById("wms_tourpointer"),a=0,o=0,r=0;if("fixed"!==s&&(i.style.width="",i.style.transform=""),"center"===t)$WC.Util.addClass(i,"wms_chattour_hvalign"),i.style.width="320px",a=window.innerWidth/2-i.offsetWidth/2+20,o=window.innerHeight/2-i.offsetHeight/2,n.style.display="none";else{var l=e.getBoundingClientRect();a=l.left+10,o=window.innerHeight-l.height-i.offsetHeight-20,r=l.width/2-n.offsetWidth/2-10,"fixed"===s&&(a=i.offsetLeft||10,r+=l.left),n.style.display="block",n.style.transform="translateX("+r+"px)"}i.style.transform="translate("+a+"px,"+o+"px)",ChatTour.list[ChatTour.tipnum+1]&&ChatTour.list[ChatTour.tipnum+1].align===ChatTour.list[ChatTour.tipnum].align&&$WC.Util.removeClass(i,"wms_chattour_hvalign")},hidePreviousHighlight:function(){var e=ChatTour.list[ChatTour.tipnum]&&ChatTour.list[ChatTour.tipnum].elemid;if(e){var t=document.querySelector("["+e+"]"),s=document.getElementById("wms_chattour");e&&$WC.Util.removeClass(t,"wms_chattour_elemhighlight"),s&&$WC.Util.removeClass(s,"wms_tourfadeIn")}}};WebMessanger.servicelist={ZI:"ZohoShowtime",ZP:"ZohoPayments",ZH:"ZohoHome",CC:"ZohoCommandCenter",PY:"PayRoll",ZG:"Zoho Bigin",ZK:"ZohoInk",OF:"ZohoOffice",TI:"TeamInbox",ZX:"ZohoShowtimeAPI",RA:"ZohoRemoteAccess",VO:"Zoho Mail",ZM:"Zoho Mobile",SL:"DataPrep",WE:"ZohoWebinar",SZ:"ZohoSites",CT:"ZohoCliq",ZS:"ZohoSupport",ML:"MTACENTRAL",BT:"ZohoBugtracker",WR:"ZohoWriter",ST:"ZohoSheet",NB:"Notebook",RE:"Remotely",SW:"ZohoShow",ZO:"Business",OZ:"ZohoChat",PD:"ZOHOPAD",FO:"ZohoForms",ZE:"ZohoExpense",CP:"CRMPlus",IV:"ZohoInventory",WH:"Startwith",MC:"ZohoMCreator",ZB:"ZohoBooks",ZV:"ZohoInvoice",SB:"ZohoSubscriptions",CI:"ZohoCode",AL:"alarmsone",ZA:"ZohoRecruit",EX:"Zoho Docs",TD:"TeamDrive",PZ:"ZIAPlatform",AU:"Temp Staffing",BP:"Orchestly",CO:"ZohoContacts",CR:"ZohoCRM",CE:"ZohoCreator",PR:"ZohoProjects",WK:"ZohoWiki",CA:"ZohoCampaigns",MI:"MICS",VA:"ZohoVault",PB:"PhoneBridge",FS:"ZohoFSM",PT:"ZohoPilot",MP:"ZohoProjectsMarketPlace",SC:"Screenplay",PE:"Peopleplus",GC:"ZohoGC",PI:"ZIAPipelines",RS:"Solopreneur",IM:"ZohoIM",RY:"ZohoRepository",SD:"Service Desk Plus",MT:"ZohoMeeting",TL:"Trainercentral",WB:"Whiteboard",MU:"Murphy",IG:"Insights",MD:"MDMOnDemand",LE:"ZohoLens",FM:"ZohoDiscussions",AC:"AaaServer",CL:"ZohoCalendar",RM:"Remote Agent",SG:"ZohoSign",TC:"Tele Adapter - CRM",TS:"Tele Adapter - Support",SI:"Site 24 x 7",SR:"Zoho Store",ZC:"ZohoGadgets",IS:"Zoho Issue Tracker",HR:"zohopeople",VI:"ZohoVideo",ZF:"ZohoFlow",SE:"ZohoSearch",JS:"Jabber Server",CM:"Contacts Manager",MB:"Zoho Mobile Sync",SV:"ZohoSurvey",MO:"zohomotivator",AT:"ZohoAssist",ZQ:"QUOTES",ES:"ZohoReports",PG:"ZohoPlugin",SP:"ZohoSprints",BS:"zohobackstage",BI:"ZohoBills",IO:"ZohoIOT",ZD:"ZohoDirectory",ZN:"ZohoDirectory",PM:"PATCHMANAGER",BL:"BLOGS",RC:"RECEIPTS",XS:"Zoho Showtime",SH:"ZohoShowtime-local",ZT:"ZohoTax",AD:"DirectoryAdmin",CH:"CHECKOUT",VE:"ZohoVoice",MH:"ZohoMarketingHub",ZW:"ZohoWorkerly",IN:"ZohoPulse",DC:"DesktopCentralCloud",DE:"DesktopCentralMSPCloud",VH:"ZohoChatVijay",CS:"CRM SalesInbox",LC:"Logs360Cloud",CY:"ZohoCatalyst",ZL:"ZohoTables",CZ:"contracts",PC:"ZohoCreatorPlus",RP:"RemoteAccessPlusCloud",OA:"OfficeAPI",LZ:"ZohoLearn",SU:"shortenurl",NS:"ZohoBetaLens",TZ:"Slate",CU:"Cirrus",AS:"Activity Collation Server",ZR:"ZohoSocial",WP:"Workplace",WA:"WebAnalytics",WS:"WebStats",LD:"Zoho SalesIQ",SF:"ZohoShifts",HS:"HackSaw"};var lfromstatic=!0;

function WmsContactImpl(){}function Collaboration(){}function WmsChatUIImpl(){}function ZohoFeedImpl(){}function CustomChat(){}function ZTI(){}function WMSTP(){}function WmsUIImpl(){}function PubSubImpl(){}function Presence(){}function ChatletImpl(){}WmsContactImpl.handlePresence=function(n,t,e,o,a){},WmsContactImpl.handleAddressBook=function(){},WmsContactImpl.handleInvitations=function(n){},WmsContactImpl.handleInvite=function(n,t,e){},WmsContactImpl.notifyInvite=function(n,t,e){},WmsContactImpl.handleAccept=function(n,t,e){},WmsContactImpl.notifyAccept=function(n,t,e){},WmsContactImpl.handleReject=function(n,t,e){},WmsContactImpl.notifyRemove=function(n,t,e){},WmsContactImpl.handleDelete=function(n,t,e){},WmsContactImpl.handleContactUpdated=function(){},WmsContactImpl.handleStatusMessage=function(n,t){},WmsContactImpl.handeAllStatusMessages=function(){},WmsContactImpl.handleHideContactsUI=function(){},WmsContactImpl.handleShowContactsUI=function(){},WmsContactImpl.handleGetContacts=function(){},WmsContactImpl.handleMPReject=function(n,t,e){},WmsContactImpl.handleMPAccept=function(n,t,e){},WmsContactImpl.handleMPDelete=function(n,t,e){},WmsContactImpl.handleMPAdd=function(n,t,e){},WmsContactImpl.handleMPInvite=function(n,t,e){},WmsContactImpl.handleLogin=function(n,t,e,o){},WmsContactImpl.handleLogout=function(n,t,e,o,a){},WmsContactImpl.handleGetAccounts=function(n){},WmsContactImpl.handleBulkPresence=function(n,t){},Collaboration.handleUserList=function(n,t){},Collaboration.handleMessage=function(n,t,e,o,a){},Collaboration.handlePresence=function(n,t,e,o,a){},Collaboration.join=function(n){WebMessanger.joinCollab(n)},Collaboration.quit=function(n){WebMessanger.quit(n)},Collaboration.serverup=function(){},Collaboration.serverdown=function(){},Collaboration.handleZohoMessage=function(n,t,e,o,a,l,i,s,u,c,m,d){return!1},Collaboration.handleCustomMessage=function(n){},Collaboration.handleCrossProductMessage=function(n,t){},Collaboration.onConnect=function(){},Collaboration.openURL=function(n,t,e,o){return!0},Collaboration.handleCollabAdd=function(n,t,e,o,a){},Collaboration.handleCollabDelete=function(n,t,e,o,a){},Collaboration.handleUserAdd=function(n,t){},Collaboration.handleUserDeleted=function(n,t){},Collaboration.handleIsOnline=function(n){},Collaboration.handleLogout=function(n){},Collaboration.goOffline=function(){},Collaboration.wmsOffline=function(){},Collaboration.handleChatNotifyMessage=function(n,t,e){},Collaboration.getPageTitle=function(){return!1},Collaboration.handleWmsDisable=function(n){},Collaboration.handleComposeMail=function(n,t){return!1},Collaboration.handleServiceMessage=function(n){},Collaboration.handleLanguageChange=function(n){},Collaboration.handleAuthFailure=function(){},Collaboration.handleWebRTCMessage=function(n){},WmsChatUIImpl.handleUserIdle=function(n,t){},WmsChatUIImpl.handleUserEnteredText=function(n,t){},WmsChatUIImpl.handleUserTyping=function(n,t){},WmsChatUIImpl.handleNewChat=function(n){},WmsChatUIImpl.handleChatMessage=function(n){},WmsChatUIImpl.isActive=function(n){return!1},WmsChatUIImpl.handleTranscript=function(n,t){},WmsChatUIImpl.handleRTCEventMsg=function(n){},ZohoFeedImpl.handleFeedHistory=function(n){},ZohoFeedImpl.handleFeedHistoryCount=function(n){},ZohoFeedImpl.handleUnreadFeeds=function(n){},ZohoFeedImpl.handleFeedsInRange=function(n){},ZohoFeedImpl.handleFeedDelete=function(n){},ZohoFeedImpl.handleFeedHistoryUI=function(){return!1},ZohoFeedImpl.handleUnreadFeedUI=function(){return!1},ZohoFeedImpl.handleLiveFeedsUI=function(n){return!1},CustomChat.handleUserList=function(n,t){},CustomChat.handleMessage=function(n){},CustomChat.handlePresence=function(n,t,e,o,a){},CustomChat.handleUserAdded=function(n,t,e){},CustomChat.handleUserDeleted=function(n,t,e){},CustomChat.handleTranscript=function(n,t){},CustomChat.join=function(n){WebMessanger.join(n)},CustomChat.transcript=function(n,t){},CustomChat.quit=function(n){WebMessanger.quit(n)},CustomChat.handleAttachmentMessage=function(n,t){},CustomChat.handleTitleUpdated=function(n,t){},CustomChat.isActive=function(n,t){return!1},CustomChat.handleCloseWin=function(n){},ZTI.handleFailure=function(n,t){},ZTI.handleCrossProductMessage=function(n){},WMSTP.isVideoEnabled=function(){return!1},WMSTP.isAudioEnabled=function(){return!1},WMSTP.isScreenShareEnabled=function(){return!1},WMSTP.handleNewVideo=function(n,t){},WMSTP.handleNewAudio=function(n,t){},WMSTP.handleAVMessage=function(n){},WmsUIImpl.handleFeedHistory=function(){},WmsUIImpl.handleUnreadFeeds=function(){},WmsUIImpl.handleDocumentIdle=function(){},WmsUIImpl.UIReady=function(){},WmsUIImpl.handleUIShown=function(){},WmsUIImpl.handleUIHidden=function(){},WmsUIImpl.handleChatWindowClose=function(n,t,e){},WmsUIImpl.preventChatWindowOpen=function(n,t){},WmsUIImpl.handleNewMessage=function(n,t,e,o){},WmsUIImpl.handleAnnouncement=function(n,t){return!1},WmsUIImpl.getHeaderHTML=function(n,t,e,o,a,l){},WmsUIImpl.getStatusHTML=function(n,t,e,o,a){},WmsUIImpl.getChatWindowContainer=function(n,t,e,o,a,l){},WmsUIImpl.getChatWindowOptions=function(n,t,e,o,a,l){},WmsUIImpl.getChatBarOptions=function(){},WmsUIImpl.customContactsConfig=function(){},WmsUIImpl.getTranscript=function(n,t,e){},WmsUIImpl.handleKeyMovement=function(n,t){},WmsUIImpl.handleKeyUp=function(n,t){},WmsUIImpl.handleKeyDown=function(n,t){},WmsUIImpl.openChatWindowDropUp=function(n,t,e){WMSUI.openChatWindowDropUp(n,t,e)},WmsUIImpl.closeChatWindowDropUp=function(n){WMSUI.closeChatWindowDropUp(n)},WmsUIImpl.onChatWindowDropUpClick=function(n,t){},WmsUIImpl.restoreChat=function(n){},WmsUIImpl.uploadFile=function(n,t,e){},WmsUIImpl.showDialog=function(n,t){WmsDialog.showModal(n,t)},WmsUIImpl.disableComposerOptions=function(n,t){WMSUI.disableComposerOptions(n,t)},WmsUIImpl.closeChatWindow=function(n,t){n?WMSUI.closeChatWindow(n):t&&WMSUI.closeEntityChatWindow(t)},WmsUIImpl.updateCountInContactsTab=function(n){WmsMainUI.updateChatInvitationCount(n)},WmsUIImpl.updateMessageInComposer=function(n,t){WMSUI.updateMessageInComposer(n,t)},WmsUIImpl.getUserPhoto=function(n,t){},WmsUIImpl.showFileUploadProgress=function(n,t){WindowHandler.showProgress(n,t)},WmsUIImpl.clearFileUploadProgress=function(n){WindowHandler.clearProgress(n)},WmsUIImpl.getMessageActions=function(n,t,e){},WmsUIImpl.destroyChatWindow=function(n){var t=WindowHandler.getWinObjById(n);null!==t&&(Factory.destroyDialog(t.winIndex,!0),t.removeWindowState())},WmsUIImpl.getChatWindowStatusText=function(n){},WmsUIImpl.disableActions=function(n){var t=WindowHandler.getWinObjById(n);t&&t.disableActions()},WmsUIImpl.updateChatWindowStatusText=function(n){var t=WindowHandler.getWinObjById(n);t&&t.updateUserStatus()},WmsUIImpl.updateChatTitle=function(n,t){WindowHandler.updateChatTitle(n,t)},WmsUIImpl.updateStatusInCustomContactMenu=function(n,t){WmsMainUI.updateStatusInCustomContactMenu(n,t)},WmsUIImpl.onComposerFocus=function(n){},WmsUIImpl.showFilesizeExceedAlert=function(n){},WmsUIImpl.handleMsgForMeetingChat=function(n,t){},WmsUIImpl.handleTurnOffChat=function(){},WmsUIImpl.getScreenCapturerForAVCall=function(){},WmsUIImpl.isDesktopApp=function(){},WmsUIImpl.handleTurnOnChat=function(){},WmsUIImpl.getCustomMenuListContainer=function(){},PubSubImpl.onConnect=function(){},PubSubImpl.handleSubscribe=function(n){},PubSubImpl.handleUnSubscribe=function(n){},PubSubImpl.handleError=function(n,t,e){},PubSubImpl.handleUserList=function(n,t){},PubSubImpl.handleUserIn=function(n,t){},PubSubImpl.handleUserOut=function(n,t){},PubSubImpl.handleMessage=function(n,t){},Presence.handleUserStatus=function(n,t){},Presence.handleForceLogout=function(n){},Presence.handleMessage=function(n){},Presence.handleUserAdd=function(n){},Presence.handleUserDelete=function(n){},Presence.handleUserList=function(n,t){},Presence.handlePresence=function(n,t,e,o,a){},Presence.handleUserAdded=function(n,t){},Presence.handleUserDeleted=function(n,t){},ChatletImpl.handleURLInvocation=function(n,t){return!1},ChatletImpl.handleUserList=function(n,t,e){};
WebMessanger.fp_hash={"json2.min.js":"0ea6dc8b_json2.min.js","pex.js":"Mar_23_2022_4_pex.js","psconnect.js":"e6ced38c_psconnect.js","pubsubapi.js":"2b7db185_pubsubapi.js","resource/ar.js":"resource/7b52dfe3_ar.js","resource/ca.js":"resource/14681178_ca.js","resource/cs.js":"resource/0b474040_cs.js","resource/da.js":"resource/83fef45e_da.js","resource/de.js":"resource/e855b1d4_de.js","resource/el.js":"resource/cac8c34b_el.js","resource/en.js":"resource/01ae000b_en.js","resource/es.js":"resource/1c06fd4f_es.js","resource/et.js":"resource/a55328aa_et.js","resource/fi.js":"resource/601851dc_fi.js","resource/fr.js":"resource/628c6fdc_fr.js","resource/fuji_en.js":"resource/22dd5c1b_fuji_en.js","resource/fuji_ja.js":"resource/f946afd1_fuji_ja.js","resource/hr.js":"resource/6a9714ac_hr.js","resource/hu.js":"resource/4b358f32_hu.js","resource/it.js":"resource/87c9e4f8_it.js","resource/ja.js":"resource/0795b0a8_ja.js","resource/ko.js":"resource/228a58fd_ko.js","resource/lt.js":"resource/be52b1ab_lt.js","resource/nb.js":"resource/3d6bfd64_nb.js","resource/nl.js":"resource/280465d1_nl.js","resource/pl.js":"resource/7b5f42fd_pl.js","resource/pt.js":"resource/066cb546_pt.js","resource/ro.js":"resource/f46d2962_ro.js","resource/ru.js":"resource/75035b26_ru.js","resource/sk.js":"resource/53c92bfd_sk.js","resource/sv.js":"resource/ae4aba29_sv.js","resource/ta.js":"resource/5bf2dc5e_ta.js","resource/th.js":"resource/fd4b98cc_th.js","resource/tr.js":"resource/5d3db523_tr.js","resource/uk.js":"resource/20c3ffeb_uk.js","resource/vi.js":"resource/1175b8ed_vi.js","resource/zh.js":"resource/30170272_zh.js","wmsbar.js":"Mar_23_2022_4_wmsbar.js","wmsbarimpl.js":"d0ccc023_wmsbarimpl.js","wmsbridge.js":"b99fbf88_wmsbridge.js","wmsliteapi.js":"Mar_23_2022_4_wmsliteapi.js","zohomaps.js":"ad528ebf_zohomaps.js"}