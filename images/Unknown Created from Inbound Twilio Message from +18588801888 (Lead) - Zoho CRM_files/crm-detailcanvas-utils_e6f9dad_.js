lyteDomObj.prototype.getviewport=function(){for(var e=$L(),t=$L(window),a=t.scrollTop(),i=a+t.height(),o=this.length,n=0;n<o;n++){var r=$L(this.eq(n)),l=r.offset().top,s=r.height();l<=i&&l+s>=a&&(e=e.add(r))}return e},Lyte.Mixin.register("crm-detailcanvas-utils",{isSectionMigrationNeed:!1,isLazyLoad:!0,requestedRule:[],deletedRule:[],maincompname:void 0,ruledelete:!1,CanvasIdVsCanvasComp:{},CompVsRule:{},cscript_action_mapping:{edit_record:"edit",clone_record:"clone",convert_record:"convert",send_mail:"send_mail",delete_record:"delete",mail_merge:"mail_merge",schedule_online_meeting:"scheduleonlinemeeting",client_portal_invite:"inviteClientPortal",previous_record:"previous_record",next_record:"next_record",page_back:"back",print_preview:"print_preview",share_via_slack:"slack",share_via_cisco:"cisco",share_via_cliq:"cliq"},lazyloadexclude:["stage_navigator","blueprint"],LRuleManField:[],layoutRuleShowFld:[],layoutRuleShowSections:[],layoutRuleSubformSections:[],revlayoutRuleShowFld:[],revlayoutRuleShowSections:[],revlayoutRuleSubformSections:[],revLRuleManField:[],lRuleSubformSections:[],RpHiddenFldId:[],RpPermissionLessFldId:[],gallerypreviewRL:[],ajaxLookupFldId:void 0,blueprintFldId:void 0,isBluePrintTrans:!1,showStage:!0,visitFldColumn:["DAYSVISITED","AVERAGETIMESPENT","NUMBEROFCHATS","LASTVISITEDTIME","FIRSTVISITEDTIME","FIRSTVISITEDURL","REFERRER","VISITORSCORE"],staticButtons:["canvas_button_group"],staticComponents:["timeline","sales_summary","data_privacy","stage_navigator","followers","blueprint","subform","score_summary","campaign_integ_analytics","campaign_analytics","backstage_analytics","backstage_status","zfinance_stock_info","zfinance_business_info","upcoming_action","orchestrations","segmentation","best_time","prediction","recommendation","similarity","Activities","Activities_History","Entity_Scores__s","next_best_action"],staticRlMapping:["Activities","Activities_History","Entity_Scores__s"],staticRelViewableComp:["Notes","Attachments"],canvasRuleUnsupportComp:["timeline","sales_summary","data_privacy","stage_navigator","followers","blueprint","Activities","subform","score_summary","campaign_integ_analytics","campaign_analytics","backstage_analytics","backstage_status","zfinance_stock_info","zfinance_business_info","upcoming_action","orchestrations","segmentation","best_time","prediction","recommendation","similarity","Notes","Attachments","next_best_action","Social","Visits_Zoho_Livedesk","Competitors","CheckLists","Stage_History","Zoho_Finance","Zoho_Books","Zoho_Invoice","Zoho_Expense","Zoho_Subscriptions","Zoho_Survey","Zoho_Projects","Polls","Questions_and_Answers","Child_Campaigns","Zoho_Support","Emails","EmailSentiment","Visits","Activities","Tasks","Events","Calls","Services__s","Appointments__s","Appointments_History__s","Open_Appointments__s","Job_Sheets__s","Data_Subject_Requests","Consents","zohoshowtime__ShowTime_Sessions","zohoshowtime__Zoho_ShowTime","Desk","DealHistory","messages__s","Forecasts"],getCompNamefromId:function(e){for(var t="",a=e.length,i=0;i<a;i++)t=t.concat((10+parseInt(e[i])).toString(36));return"canvas-"+t+"-view"},scoreColumn:["SCORE","TP_SCORE","POSITIVE_SCORE","TP_POSITIVE_SCORE","NEGATIVE_SCORE","TP_NEGATIVE_SCORE"],componentvsEditionCheck(e){var t=Crm.userDetails.LICENSE_TYPE,a={orchestrations:["S","Y","R","P"],best_time:["S","Y","R","P"],prediction:["S","Y","R","P"]};return!(a[e]&&a[e].indexOf(t)>-1)},getReviewProcessFields:function(e){var t=[];if(e){if(e.length>0&&"crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route){var a=Lyte.registeredMixins["crm-detailcanvas-utils"],i=a.revlayoutRuleShowFld;a.RpHiddenFldId=e.filter((function(e){var t=!1,o=store.peekRecord("field",e.id);return a.revlayoutRuleShowSections.includes(o.section[0].name)&&(t=!0),o.visible&&(i.includes(e.id)||t)}));var o=[];a.RpHiddenFldId.filter((function(e){o.push(e.id)})),a.RpHiddenFldId=o;var n=[];e.filter((function(e){store.peekRecord("field",e.id).visible||n.push(e.id)})),a.RpPermissionLessFldId=n,e=i&&e.filter((function(e){return!i.includes(e.id)&&store.peekRecord("field",e.id).visible}))}for(var r=e,l=r.length,s=0;s<l;s++){if(r[s].hasOwnProperty("subform_records"))for(var d=r[s].subform_records,c=d.length,u=0;u<c;u++)for(var p=d[u].process_fields,m=p.length,f=0;f<m;f++){var v=p[f];t.push(v.id)}t.push(r[s].id)}return t}return t},dataPreProcess:function(e,t,a,i,o,n){for(var r=e&&e.children||[],l=r.length,s=[],d=this.getData("fields"),c=this.getData("layoutId"),u=this.getData("systemidobjectmap"),p=0;p<l;p++){var m=r[p]._type;if(u&&r[p].ui&&r[p].ui.value&&r[p].ui.value&&r[p].ui.value.system_id&&u[r[p].ui.value.system_id]&&u[r[p].ui.value.system_id].action){var f=r[p].ui.value.system_id;r[p].ui.value.class||(r[p].ui.value.class=""),CScriptLib&&(r[p].ui.value.class+=" zcpImp",r[p].ui.value.interactions=[{event:"onclick",handler:"{{action('customActiondispatcher',this, event , '"+f+"')}}"}])}if("dummyDiv"!==m){if(null!==r[p].id&&"field"===m)if(r[p].customField&&(r[p].id=r[p].id.replace("_profileimage","")),(ue=store.peekRecord("field",r[p].id))&&ue.visible&&(i||d.indexOf(ue.id)>=0)&&this.scoreColumn.indexOf(ue.column_name)<0){if(r[p].customField){var v=new CrmDetailViewHandler(a,t,r[p].id,r[p].datatype,void 0,void 0,void 0,!0,o);r[p].value=v.getHTML(),r[p].label=$ESAPI.encoder().encodeForHTMLAttribute(ue.field_label+" "+I18n.getMsg("crm.label.image")),r[p].zcqaval=ue.field_label+"_profileimage";continue}if(r[p].value=this.constructCruxComponentForCanvas(r[p].id,a,null,i,o,!1),r[p].label=$ESAPI.encoder().encodeForHTMLAttribute(ue.field_label),r[p].zcqaval=ue.field_label,"picklist"===ue.data_type&&this.removePicklistprops(r[p],e),!i){var h=ue.tooltip,g="";h&&"Info Icon"===h.name&&(g='<span data-zcqa="zc_ajxFld_'+ue.id+'" id="zc_ajax_info_icon_'+ue.id+'" lt-prop-title="'+$ESAPI.encoder().encodeForHTMLAttribute(h.value)+'" lt-prop-tooltip-config={"position":"top"} class="icon_roundinfo mL5 cP vam"></span>'),r[p].label+=g}if(ue.api_name&&r[p].ui&&r[p].ui.value&&(r[p].ui.value.class||(r[p].ui.value.class=""),r[p].ui.value.class+=" canvasselectablefield canvas-element-apiname-"+ue.api_name,r[p].ui.value.attr={"data-apiname":ue.api_name}),this.isAjaxEditableField(ue,!i))if((r[p].ui.holder||r[p].ui.field).interactions=[{event:"onmouseover",handler:"{{action('handleMouseActions',this, event)}}"},{event:"onmouseout",handler:"{{action('handleMouseActions',this, event)}}"}],"row"===e._type&&r[p].ui.field){r[p].ui.value&&(r[p].ui.value.class?r[p].ui.value.class+=" zcanvas-table-row-field":r[p].ui.value.class="zcanvas-table-row-field",e.ui.value&&e.ui.value.position&&e.ui.value.position.height<25&&(r[p].ui.value.class+=" zcanvas-low-size-row"));var y="";if(r[p].ui.value&&r[p].ui.value.class&&r[p].ui.value.class.indexOf("zctextarea")>-1&&(y="non-center-edit"),r[p].ui.field&&r[p].ui.field.style&&r[p].ui.field.style.default&&r[p].ui.field.style.default["vertical-align"]){var b=r[p].ui.field.style.default["vertical-align"];"top"===b?y+=" zc-top-edit-icon":"bottom"===b&&(y+=" zc-bottom-edit-icon")}r[p].ui.field.extrahtml="<span data-zcqa='"+$ESAPI.encoder().encodeForHTML(ue.field_label)+"' class='zc-ajax-edit zc-ajax-edit-inner "+y+"' onclick={{action('handleeditButton')}}></span>"}}else if(ue&&!ue.visible&&"row"===e._type)r[p].ui=JSON.parse('{"value": {"class": "zc-table-cell"}}'),r[p]._type="empty-field";else{if("row"!==e._type||!r[p]){r.splice(p,1),p--,l=r.length;continue}if(r[p].ui.value='{"class":"zc-table-cell"}',r[p]._type="empty-field",r[p].children=[],p===l-1){for(var _=!0,x=0;x<l;x++)"empty-field"!==r[x]._type&&(_=!1);_&&(e.ui.value.class="dNImp")}}else if("Custom Layout"==r[p].theme&&"component"==r[p]._type){var z=r[p].children,R=!1;r[p].ui&&r[p].ui.value&&r[p].ui.value.class&&r[p].ui.value.class.indexOf("zc-tab-all-fields")>-1&&(r[p]=Lyte.registeredMixins["crm-detailcanvas-utils"].allFieldFormation(r[p]),z=r[p].children),"Tab Layout"==n&&(z=1==z.length?z[0].children:z);var L=z.map((function(e){return e._type}));if(L.indexOf("relatedlist")>=0){var C,w=L.indexOf("relatedlist"),S=z[w].id,I=z[w].personalityName;if((ie=store.peekRecord("related_list",S))&&(C="Invited_Events"===ie.api_name?"Meetings":ie.api_name),"Activities_History"!==S&&"Activities"!==S||!Crm.isActivitySplitDone||Crm.userDetails.permissions.Crm_Implied_View_Tasks||Crm.userDetails.permissions.Crm_Implied_View_Events||Crm.userDetails.permissions.Crm_Implied_View_Calls||("Contacts"===this.data.module?(!moduleRecordMapping.Services||moduleRecordMapping.Services&&!Crm.userDetails.permissions.Crm_Implied_View_Appointments)&&(r[p].hidden=!0,r[p].tabrelatedlistid?r[p].hidetab=!0:r[p].tabrelatedlistid||1!==z.length||(r[p].hidetab=!0)):(r[p].hidden=!0,r[p].tabrelatedlistid?r[p].hidetab=!0:r[p].tabrelatedlistid||1!==z.length||(r[p].hidetab=!0))),ie||!clientPortalName||"data_privacy"===S||"stage_navigator"===S||z[w].subformid||"LazyLoad Component"===z[w].theme||(r[p].hidden=!0,r[p].tabrelatedlistid?r[p].hidetab=!0:r[p].tabrelatedlistid||1!==z.length||(r[p].hidetab=!0)),clientPortalName&&ie){var M=ie.personality_name;["ATTACHMENTSPERSONALITY","EMAILSENTIMENTPERSONALITY","EMAILSPERSONALITY","SOCIALPERSONALITY","CHECKLISTSPERSONALITY","REPORTINGCONTACTSPERSONALITY"].contains(M)&&(r[p].hidden=!0,r[p].tabrelatedlistid?r[p].hidetab=!0:r[p].tabrelatedlistid||1!==z.length||(r[p].hidetab=!0))}var A=!1,k=Lyte.Router.getRouteInstance().currentModel.relatedlist?Lyte.Router.getRouteInstance().currentModel.relatedlist.filter((function(e){return e.personality_name===I&&e.visible})):[];if(k.length&&(z[w].id=k[0].id,A=!0),!A&&I)r[p].hidden=!0,r[p].tabrelatedlistid?r[p].hidetab=!0:r[p].tabrelatedlistid||1!=z.length||(r[p].hidetab=!0);else if(I||"LazyLoad Component"===z[w].theme||z[w].subformid||!(this.staticComponents.indexOf(S)<0&&!ie||ie&&("multiselectlookup"!==ie.type||"custom_lookup"!==ie.type)&&"Meetings"!==C&&(!ie.visible||moduleRecordMapping[C]&&this.staticRelViewableComp.indexOf(moduleRecordMapping[C].api_name)<0&&(!moduleRecordMapping[C].viewable||!moduleRecordMapping[C].visible))))if(z[w].subformid){var P=z[w].subformid,D=store.peekRecord("field",P);if(!D){r.splice(p,1),p--,l=r.length;continue}for(var O=store.peekRecord("layout",Lyte.Router.getRouteInstance().currentModel.layoutId),E=O?O.sections.filterBy({isSubformSection:!0}):[],T=E.length,F=!!D.subform,$=0;$<T;$++)E[$].fields.filterBy({api_name:D.api_name}).length>0&&E[$].fields.filterBy({visible:!0}).length<2&&(r[p].hidden=!0),E[$].fields.filterBy({api_name:D.api_name}).length>0&&(F=!1);if(F){r.splice(p,1),p--,l=r.length;continue}}else if(this.staticComponents.indexOf(S)>-1&&!ie){this.componentvsEditionCheck(S)||(r[p].hidden=!0,r[p].tabrelatedlistid?r[p].hidetab=!0:r[p].tabrelatedlistid||1!==z.length||(r[p].hidetab=!0));var N=Lyte.Router.getRouteInstance().currentModel?Lyte.Router.getRouteInstance().currentModel.record:void 0,j=!1;N&&("rejected"!==N.$review&&"Review in Progress"!==N.$review&&"Pending for Review"!==N.$review&&"Pending for ReReview"!==N.$review||(j=!0)),["orchestrations","blueprint"].indexOf(S)>-1&&!Crm.userDetails.permissions.Crm_Implied_Manage_Workflow&&("orchestrations"!==S||t.$orchestration||(r[p].hidden=!0,r[p].tabrelatedlistid?r[p].hidetab=!0:r[p].tabrelatedlistid||1!=z.length||(r[p].hidetab=!0))),("segmentation"===S&&!Lyte.Router.getRouteInstance().currentModel.segmentation_canvas||"next_best_action"===S&&!Crm.userDetails.permissions.Crm_Implied_View_Nba||"recommendation"===S&&!Lyte.Router.getRouteInstance().currentModel.recommendation_canvas||"stage_navigator"===S&&(N&&!N.$approved||j)&&"detailview"!==Lyte.Router.getRouteInstance().routeName)&&(r[p].hidden=!0,r[p].tabrelatedlistid?r[p].hidetab=!0:r[p].tabrelatedlistid||1!=z.length||(r[p].hidetab=!0))}else if(ie&&"multiselectlookup"===ie.type){var q,H=Lyte.Router.getRouteInstance().currentModel.relatedlist?Lyte.Router.getRouteInstance().currentModel.relatedlist.filter((function(e){return e.personality_name===ie.personality_name})):[],B=ie.connectedmodule;q=moduleRecordMapping[B].viewable,z[w].subformid||!(this.staticComponents.indexOf(S)<0)||ie&&q&&(!B||moduleRecordMapping[B].visible)&&H.length||(r[p].hidden=!0,r[p].tabrelatedlistid?r[p].hidetab=!0:r[p].tabrelatedlistid||1!=z.length||(r[p].hidetab=!0))}else if(ie&&"custom_lookup"===ie.type){H=Lyte.Router.getRouteInstance().currentModel.relatedlist?Lyte.Router.getRouteInstance().currentModel.relatedlist.filter((function(e){return e.personality_name===ie.personality_name})):[];var V=$u.invert(moduleApiMapping)[ie.module.api_name];if(!moduleRecordMapping[V]){R=!0,r.splice(p,1),p--,l=r.length;continue}J=moduleRecordMapping[V].viewable,W=moduleRecordMapping[V].visible;z[w].subformid||!(this.staticComponents.indexOf(S)<0)||ie&&J&&W&&H.length||(r[p].hidden=!0,r[p].tabrelatedlistid?r[p].hidetab=!0:r[p].tabrelatedlistid||1!=z.length||(r[p].hidetab=!0))}else I||"Meetings"!==C||!moduleRecordMapping[C]||ie.visible&&moduleRecordMapping[C].viewable||(r[p].hidden=!0,r[p].tabrelatedlistid?r[p].hidetab=!0:r[p].tabrelatedlistid||1!=z.length||(r[p].hidetab=!0));else if(ie&&"custom_lookup"===ie.type){var U=$u.invert(moduleApiMapping)[ie.module.api_name];if(moduleRecordMapping[U]){var J=moduleRecordMapping[U].viewable,W=moduleRecordMapping[U].visible;J&&W||(r[p].hidden=!0,r[p].tabrelatedlistid?r[p].hidetab=!0:r[p].tabrelatedlistid||1!=z.length||(r[p].hidetab=!0))}}else ie&&"custom_related_list"===ie.type&&ie.visible||(r[p].hidden=!0,r[p].tabrelatedlistid?r[p].hidetab=!0:r[p].tabrelatedlistid||1!=z.length||(r[p].hidetab=!0))}if(Crm.isActivitySplitDone&&ie&&("Activities"===ie.api_name||"Activities_History"===ie.api_name)&&(r[p].hidden=!0,r[p].isSplit=!0,r[p].tabrelatedlistid?r[p].hidetab=!0:r[p].tabrelatedlistid||1!=z.length||(r[p].hidetab=!0)),!R){var X=Object.assign({},r[p]),Y=this.getCompNamefromId(r[p].id);r[p].hidden&&(r[p].ui.value.position.height=0);var Z='<template is="component" id=comp_'+r[p].id+" component-name="+Y+" name="+Y+' module={{module}} record={{record}} layout-id={{layoutId}} entity-details={{entityDetails}} lazyload="'+!this.isLazyLoad+'" lyte-keep-alive="true" class="zcanvas_lyte_component zcanvas_not_rendered" style="height: '+r[p].ui.value.position.height+'px" actualheight="'+r[p].ui.value.position.height+'"></template>';r[p].value=Z,r[p].postLoad=!0,e&&e.sectionId&&(X.tempSectionId=e.sectionId),this.fetchComponentData(X,t,a,n),r[p].children=[]}if(z=[],r[p].tabrelatedlistid)if(ie=store.peekRecord("related_list",r[p].tabrelatedlistid))r[p].ui.value.name=ie.display_label;else if(clientPortalName&&"data_privacy"!==r[p].tabrelatedlistid&&"stage_navigator"!==r[p].tabrelatedlistid){r.splice(p,1),p--,l=r.length;continue}}else if("link"===m||"button"===m){var G="link"===m?"custom_link":"custom_button",Q=(X=store.peekAll(G).filter((function(e){return e.id===r[p].id&&("button"!==r[p].datatype&&e.profiles.filter((function(e){return e.name===Crm.userDetails.PROFILE_NAME})).length>0||"view"===e.position)})),null),K=Lyte.registeredMixins["crm-detailcanvas-utils"];if(K.staticButtons&&K.staticButtons.indexOf(r[p].id)>-1&&(Q=r[p],r[p].ui&&r[p].ui.value&&r[p].ui.value.class)){var ee=zutils.getRandomId();Q.referid=ee,r[p].ui.value.class+=" zccstaticbutton zcpImp "+ee}if(0===X.length&&!Q){r.splice(p,1),p--,l=r.length;continue}v=new CrmDetailViewHandler(a,t,r[p].id,m,X[0]||Q);r[p].value=v.getHTML(),r[p].ui&&r[p].ui.value&&r[p].ui.value.class&&(r[p].ui.value.class+=" canvasselectable"+m+" canvas-element-"+m+"-id-"+r[p].id,r[p].ui.value.attr={"data-id":r[p].id})}else if("relatedlist"===m){var te=!1,ae=!1,ie=(S=r[p].id,store.peekRecord("related_list",S));if(e&&e.ui&&e.ui.value&&e.ui.value.class&&ie){var oe=ie.api_name;e.ui.value.class+=" canvasselectablerelatedlist canvas-relatedlist-element-id-"+S+" canvas-relatedlist-apiname-"+oe,e.ui.value.attr={"data-api-name":oe,"data-id":S}}if(Crm.isActivitySplitDone&&ie&&("Activities"===ie.api_name||"Activities_History"===ie.api_name))if("LazyLoad Component"===r[p].theme){var ne=this.getCompNamefromId(r[p].componentid),re=this.getData("layoutId"),le={};(ge=r[p].id)&&ge.indexOf("_")>-1?le.id=ge:le.uid=ge;var se=(ye=store.peekRecord("layout",re).sections.filterBy(le)||[])&&ye[0]?ye[0].fields:[],de=this.sectionview(r[p],se,{module:this.getData("module"),record:this.getData("record")});this.registerComponent(de,ne);Z='<template is="component" id=comp_'+r[p].componentid+" component-name="+ne+" name="+ne+' module={{module}} record={{record}} layout-id={{layoutId}} entity-details={{entityDetails}} lyte-keep-alive="true" class="zcanvas_lyte_component"></template>'}else{var ce=Object.assign({},r[p]);Z='<div class="p30 aligncenter fontsmooth">'+I18n.getMsg("crm.canvas.activity.component.change.alert")+"</div>"}else if(!ie||ie[c]&&ie[c].visible)if("Table Layout"===r[p].theme){var ue;if(!(ue=store.peekRecord("field",r[p].id))&&r[p].subformid){Z=I18n.getMsg("crm.canvas.subform.removed");te=!0}else if(!ue||"subform"!==ue.data_type&&"Product_Details"!==ue.api_name)if(ue&&"Pricing_Details"===ue.api_name)Z='<crm-detail-view-pricing-details cx-Prop-Empty-Value="-"  record=\''+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(t))+"'></crm-detail-view-pricing-details>";else if(this.staticComponents.indexOf(r[p].id)>-1){Z=(v=new CrmDetailViewHandler(a,t,r[p].id,r[p].id,null,"view")).getHTML();te=!0}else{Z=(v=new CrmDetailViewHandler(a,t,r[p].id,"static_rel",null,"view",r[p].personalityName)).getHTML();te=!0}else{var pe=r[p].id;r[p].id="subform";var Z=(v=new CrmDetailViewHandler(a,t,r[p].id,r[p].id,pe,"view")).getHTML();te=!0}if(r[p].ui&&r[p].ui.context){var me=zutils.getRandomId(),fe=zcanvasrelatedList&&zcanvasrelatedList.getStyleElement(r[p].ui.context,me),ve=!1;this.lazyloadexclude&&this.lazyloadexclude.indexOf(r[p].id)>-1&&(ve=!0),Z='<div id="'+me+'">'+(this.isLazyLoad&&!ve?'<template is="if" value="{{lazyload}}"><template case="true">':"")+Z+(this.isLazyLoad&&!ve?"</template></template>":"")+fe.outerHTML()+"</div>",ae=!0,e.lazyload=!0}if(r[p].ui&&r[p].ui.rlcontainer&&r[p].ui.rlcontainer.position&&(Z='<div class="zcfixedrlcontainer" style="overflow:auto;height:'+r[p].ui.rlcontainer.position.height+'px;">'+Z+"</div>"),v){var he=v.getResources();he.length&&(e.asyncresources=he,e.asyncloader={})}}else if("LazyLoad Component"===r[p].theme){var ge;ne=this.getCompNamefromId(r[p].componentid),re=this.getData("layoutId"),le={};(ge=r[p].id)&&ge.indexOf("_")>-1?le.id=ge:le.uid=ge;var ye;se=(ye=store.peekRecord("layout",re).sections.filterBy(le)||[])&&ye[0]?ye[0].fields:[],de=this.sectionview(r[p],se,{module:this.getData("module"),record:this.getData("record")});this.registerComponent(de,ne);Z='<template is="component" id=comp_'+r[p].componentid+" component-name="+ne+" name="+ne+' module={{module}} record={{record}} layout-id={{layoutId}} entity-details={{entityDetails}} lyte-keep-alive="true" class="zcanvas_lyte_component"></template>'}else Z='<crm-related-list-canvas rellist-id="'+(ce=Object.assign({},r[p])).id+'" id="relcomp_'+ce.id+'" module={{module}} is-loading="{{lbind(isLoading)}}" from-record={{record}} record_id={{record.id}} comp_obj="'+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(ce))+'" > </crm-related-list-canvas>';else Z="";if(r[p].children=[],r[p].value=Z,r[p].postLoad=!0,te&&r[p]&&r[p].ui&&(r[p].ui.value.postclass="zc-static-rl-comp"),"stage_navigator"===r[p].id&&("Potentials"===a||"Deals"===a)){var be=moduleRecordMapping.Potentials.fields.filterBy({api_name:"Stage"})[0];be&&be.enable_colour_code&&(r[p].ui.value.postclass+=" colorEnableDetailviewStage")}ve=!1;this.lazyloadexclude&&this.lazyloadexclude.indexOf(r[p].id)>-1&&(ve=!0),!this.isLazyLoad||ae||ve||(e.lazyload=!0,"LazyLoad Component"===r[p].theme?r[p].value="<div>"+Z+"</div":r[p].value='<div> <template is="if" value="{{lazyload}}"><template case="true">'+Z+"</template></template></div>")}else if("system"===m||"action"===m||"special_comp"===m||"zia"===m){"zia"===m&&(r[p]._type="field");var _e=(v=new CrmDetailViewHandler(a,t,r[p].id,r[p].id,null,"view")).getHTML();if("action"===m&&r[p]&&r[p].ui&&r[p].ui.value&&r[p].ui.value.class&&(r[p].ui.value.class+=" canvasselectablebutton canvas-element-action-button canvas-element-button-id-"+r[p].id,r[p].ui.value.attr={"data-apiname":r[p].id}),["cliq","slack","cisco"].indexOf(r[p].id)>=0&&this.getData(r[p].id+"_integration"),r[p].value=_e||r[p].value,this.isLazyLoad&&"action"!=m&&(e.lazyload=!0,r[p].value='<template class="zc_lazy_component">'+Z+"</template>"),"data_enrichment"===r[p].id&&Lyte.Router.getRouteInstance().currentModel&&Lyte.Router.getRouteInstance().currentModel.components){var xe=Lyte.Router.getRouteInstance().currentModel.components,ze=xe.length;if(ze){for(var Re=[],Le=0;Le<ze;Le++)"data_enrichment"===xe[Le].name&&(Re=xe[Le]);if(Re&&!Re.comp_available){r.splice(p,1),p--,l=r.length;continue}}}}else if("static_content"===m){r[p]._type="component",r[p].theme="Custom Layout";var Ce=r.map((function(e){return e._type})),we=Ce.indexOf("relatedlist")>=0?Ce.indexOf("relatedlist"):null;ie=null;if(we)S=r[we].id,ie=Lyte.Router.getRouteInstance().currentModel.relatedlist?Lyte.Router.getRouteInstance().currentModel.relatedlist.filter((function(e){return e.id===S})):[];var Se=[];if(ie&&ie.length&&ie[0])if(v=new CrmDetailViewHandler(a,null,ie[0].id)){var Ie=v.getCanvasActions();Ie.length&&(Se=Ie)}if(!(ie&&ie.length&&ie[0]&&ie[0].actions&&ie[0].actions.length?ie[0].actions.concat(Se):Se).length){for(var Me=r[p].children.length,Ae=[],ke=0;ke<Me;ke++){var Pe=r[p].children[ke];Pe&&Pe.ui&&Pe.ui.value&&Pe.ui.value.class&&Pe.ui.value.class.indexOf("zccbutton")>-1||Ae.push(Pe)}r[p].children=Ae}this.RelListTitleProcess(r[p],r,a,t.id)}else if("Tab Layout"==r[p].theme&&"component"==r[p]._type){for(var De=r[p].children,Oe=De.length,Ee=0;Ee<Oe;Ee++){var Te=De[Ee];if(Te.tabrelatedlistid){var Fe;S=Te.tabrelatedlistid,ie=store.peekRecord("related_list",S);if(Crm.isActivitySplitDone&&ie&&("Activities"===ie.api_name||"Activities_History"===ie.api_name))(Fe=this.data.components.filter((function(e){return e.name===Te.tabrelatedlistid}))).length&&(Te.ui.value.name=Fe[0].display_label);else if(!ie||ie[c]&&ie[c].visible)(Fe=this.data.components.filter((function(e){return e.name===Te.tabrelatedlistid}))).length&&(Te.ui.value.name=Fe[0].display_label);else De.splice(Ee,1),Ee--,Oe=De.length}else Te.ui.value.disabled&&!Te.ui.value.class.includes("zc-tab-all-fields")&&(De.splice(Ee,1),Ee--,Oe=De.length);if(Te.tabrelatedlistid&&"stage_navigator"==Te.tabrelatedlistid&&t.$process_flow){var $e=Lyte.registeredMixins["crm-detailcanvas-utils"],Ne=$e.showStage,je=$e.isBluePrintTrans;(Ne||je)&&je&&!clientPortalName?Te.ui.value.name=I18n.getMsg("crm.label.cf.blueprint"):Te.ui.value.name=I18n.getMsg("Stage")}else Te.tabrelatedlistid&&"stage_navigator"==Te.tabrelatedlistid&&!t.$process_flow&&(Te.ui.value.name=I18n.getMsg("Stage"))}n="Tab Layout"}e&&e.tempSectionId&&(r[p].tempSectionId=e.tempSectionId),this.handledeletion(r[p]),this.dataPreProcess(r[p],t,a,i,o||null,n)}else e&&e.sectionId?r[p].sectionId=e.sectionId:e&&e.tempSectionId&&(r[p].tempSectionId=e.tempSectionId),this.dataPreProcess(r[p],t,a,i,o,n)}if(e&&e.tempSectionId&&"Static Text"===e.theme){var qe=store.peekRecord("layout",c).sections,He=qe.length;for($=0;$<He;$++)e.tempSectionId===qe[$].id&&(e.ui.value.value=qe[$].display_label)}var Be=s.length;for($=0;$<Be;$++)r.splice(s[$]-$,1);return e},RelListActionsPreProcess:function(e){for(var t=[],a=e[0].children,i=a.length,o=0;o<i;o++){var n=a[o],r=n.children[0],l="dummyDiv"===n._type?"dummyDiv"===(r&&r._type)?r.children[0]:r:n,s=l.datatype?l.id:null;null!==s&&t.push(s)}return t},RelListTitleProcess:function(e,t,a,i,o){for(var n=t.length,r="",l=0;l<n;l++)"relatedlist"==t[l]._type&&t[l].id&&(r=t[l].id);var s=e.children||[],d=s.length,c=store.peekRecord("related_list",r),u=("Activities_History"===r||"Activities"===r)&&Crm.isActivitySplitDone;if(o||c&&c.visible||u)for(l=0;l<d;l++){var p=s[l],m=p.children[0],f="dummyDiv"===p._type?"dummyDiv"===(m&&m._type)?m.children[0]:m:p;if("dummyDiv"!==f._type){if("Static Text"===f.theme&&f.ui.value.class&&f.ui.value.class.indexOf("zc_disabled")>-1){if(u){C='<span id="RL_dataCount_'+r+'" data-zcqa="canvasCnt_'+r+'"></span>';f.ui.value.value=f.ui.value.value+C,c={id:r}}else{var v=this.labelPreProcess(c,{module:a,entityData:{id:i}});f.ui.value.value=v}if(!f.ui.value.zcode&&c)if(c.display_label)f.ui.value.zcode={name:c.display_label+"-title"};else if(c.id){var h;h="Activities"===c.id||"Activities_History"===c.id?"Activities"===c.id?I18n.getMsg("crm.label.open.activities",I18n.getMsg("Activities")):I18n.getMsg("crm.label.closed.activities",I18n.getMsg("Activities")):c.id,f.ui.value.zcode={name:h+"-title"}}}if(u&&(c={id:r}),"action"===f._type){if(clientPortalName){s.splice(l,1),l--,d=s.length;continue}if(0===f.id.indexOf("moreRLActions")){var g=this.RelListActionsPreProcess(t);f.includedActions=g}f.value=this.getRelListButton(c,f,a)}}else this.RelListTitleProcess(p,t,a,i,!0)}else{var y=store.peekRecord(moduleRecordMapping[a].id,i),b=store.peekRecord("field",r),_=s[0]&&"dummyDiv"===s[0]._type?"dummyDiv"===(s[0].children[0]&&s[0].children[0]._type)?s[0].children[0].children[0]:s[0].children[0]:s[0];if("stage_navigator"===r&&("Potentials"===a||"Deals"===a)&&y.$process_flow&&d>0){Crm.canvasStageName=this.data.components.filter((function(e){return e.name===r}))[0].display_label;var x=Lyte.registeredMixins["crm-detailcanvas-utils"],z=x.showStage,R=x.isBluePrintTrans;(z||R)&&R&&!clientPortalName?_.ui.value.value=I18n.getMsg("crm.label.cf.blueprint"):_.ui.value.value=I18n.getMsg("Stage")}else if("stage_navigator"===r&&("Potentials"===a||"Deals"===a)&&d>0)_.ui.value.value=I18n.getMsg("Stage");else if(b&&("Product_Details"===b.api_name||"Pricing_Details"===b.api_name)&&d>0)_.ui.value.value=b.field_label;else{var L=this.data.components.filter((function(e){return e.name===r}));if(L.length&&d>0){var C='<span id="RL_dataCount_'+r+'" data-zcqa="canvasCnt_'+r+'"></span>';_.ui.value.value=L[0].display_label+C}}}},labelPreProcess:function(e,t,a){var i=this.countAndRefreshIconHandler(e);if(a)return $ESAPI.encoder().encodeForHTML(e.display_label);var o=e.api_name,n=e.type;if("custom_function"===n)return'<span class="customRLName_'+e.id.toString()+'" data-zcqa="customRLName_'+e.id.toString()+'">'+$ESAPI.encoder().encodeForHTML(e.display_label)+'</span><span id="customRLCount_'+e.id.toString()+'" data-zcqa="customRLCount_'+e.id.toString()+'" style="height: 10px; padding: 2px 5px; background-color: rgb(224, 224, 224); border-radius: 2px; line-height: 12px; text-align: center; font-size: 12px; cursor: auto;" class="mL8 dIB hide"></span><div id=\'customRLRef_'+e.id.toString()+'\'data-zcqa="refresh_customRLRef" class="mL10 tb_small_loader vmiddle" onclick="javascript:CustomRelatedListObj.reloadRL(\''+e.id.toString()+'\');"><span class="ld_init"/><span class="ld_process"/></div>';if("custom_related_list"===n)return $ESAPI.encoder().encodeForHTML(e.display_label);switch(o){case"Zoho_Finance":case"Zoho_Books":case"Zoho_Invoice":return $ESAPI.encoder().encodeForHTML(e.display_label)+'<div class="zIconLoader mL10 dIB vam" id="zinvoiceRef" onclick="javascript:ZInvoice.loadRL(\'ZINVOICEPERSONALITY\',\''+t.module+"','"+e.id+"','{{record.id}}');\"  lt-prop-title=\""+I18n.getMsg("crm.button.refresh")+'"><span class="zIconLoadInit"></span><span class="zIconLoadProcess"></span></div>';case"Zoho_Expense":return $ESAPI.encoder().encodeForHTML(e.display_label)+'<div class="zIconLoader mL10 dIB vam" id="zExpenseRefresh" onclick="javascript:ZInvoice.loadRL(\'ZEXPENSEPERSONALITY\',\''+t.module+"','"+e.id+"','{{record.id}}');\"  lt-prop-title=\""+I18n.getMsg("crm.button.refresh")+'"><span class="zIconLoadInit"></span><span class="zIconLoadProcess"></span></div>';case"Zoho_Subscriptions":return $ESAPI.encoder().encodeForHTML(e.display_label)+'<div class="zIconLoader mL10 dIB vam" id="zSubscriptionsRefresh" onclick="javascript:ZInvoice.loadRL(\'ZSUBSCRIPTIONSPERSONALITY\',\''+t.module+"','"+e.id+"','{{record.id}}');\"  lt-prop-title=\""+I18n.getMsg("crm.button.refresh")+'"><span class="zIconLoadInit"></span><span class="zIconLoadProcess"></span></div>';case"Zoho_Survey":return'<crm-zsurvey-rl-label type="CANVAS" entity_id="{{record.id}}" module="'+t.module+'" related_list_id="'+e.id+'" display_label="'+$ESAPI.encoder().encodeForHTML(e.display_label)+'"></crm-zsurvey-rl-label>';case"Zoho_Support":return'<crm-zdesk-rl-label type="CANVAS" entity_id="{{record.id}}" module="'+t.module+'" related_list_id="'+e.id+'" display_label="'+$ESAPI.encoder().encodeForHTML(e.display_label)+'"></crm-zdesk-rl-label>';case"Circuit_Executions":return'<crm-circuits-rl-label type="CANVAS" entity_id="{{record.id}}" module="'+t.module+'" related_list_id="'+e.id+'" display_label="'+$ESAPI.encoder().encodeForHTML(e.display_label)+'"></crm-circuits-rl-label>';default:return'<lyte-text id="label_'+e.id+'" class="rl_name" lt-prop-value = "'+$ESAPI.encoder().encodeForHTML(e.display_label)+'"></lyte-text>'+i}},relatedListDataCnt:function(e,t,a){0!=e.relRecords.length&&"showPreviousRel"!==a.nav_type&&Lyte.triggerEvent("relatedListCount",{id:t,api_name:e.module[0].api_name,more_records:e.relRecords.info.more_records,per_page:e.relRecords.info.per_page,page:e.relRecords.info.page,count:e.relRecords.info.count,format:"template"})},fetchComponentData:function(e,t,a,i){e.id;this.componentDataProcess.call(this,e,t,a,i)},componentDataProcess:function(e,t,a,i){e.id;var o=this.dataPreProcess(e,t,a,null,null,i);if(!createStruture.toolinst){var n=new zcanvastools({baseeditor:"body",tools:{},meta:{fallbackurl:networkUtils.getImageUrl("image_profile_canvas_1d7b1e9_.svg",ResourceConstants.CRM)},nodeattr:{key:"zcqaval",key2:"label",attr:{"data-zcqa":"canvas-detail-"}},viewcallback:function(e,t){t&&t.ui&&t.ui.value&&t.ui.value.zcode&&t.ui.value.zcode.name&&e.attr&&e.attr("data-zcqa","canvas-detail-"+t.ui.value.zcode.name)},classstyles:zutils.classstyles,classselector:function(e){return e.indexOf("zcanvas-holder")>-1&&(e=e.replace(".zcanvas-holder","").trim()),e},stylepriority:function(e,t){return e&&e.endsWith(".zc-tabs li.tab")&&(t=!0),t},processstylevalue:function(e,t){return Lyte.registeredMixins["crm-detailcanvas-utils"].getUrlfromStyleData(e,t)},processvaluebyconfig:function(e,t){return"image"===e?Lyte.registeredMixins["crm-detailcanvas-utils"].getUrlfromStyleData(null,t,1):t},poststylecreate:function(e,t,a){if(e&&e.indexOf(".zcanvas-field")>=0&&e.indexOf(":hover")>-1){e+=" .zcanvas-inner-component";for(var i=["font-family","font-size","color","background-color"],o={},n=i.length,r=0;r<n;r++)t[i[r]]&&(o[i[r]]=t[i[r]]);this.addrule(e,o,a,!0)}if(e&&e.indexOf(".zc-tablist-container .zc-tabs")>-1){var l=zutils.getSpacingProperties("margin",t),s=zutils.getSpacingProperties("padding",t),d=e.replace(".zc-tabs",".zc-tabs-nav");o={"padding-top":s["padding-top"]+"px","padding-bottom":s["padding-bottom"]+"px","margin-top":l["margin-top"]+"px","margin-bottom":l["margin-bottom"]+"px"};this.addrule(d,o,a,!0)}},compressionmap:zutils.stylecompressionmap,customstate:Lyte.registeredMixins["crm-detailcanvas-utils"].customstateview,theme:{currenttheme:o.ui.theme,selector:{field:{default:".zcanvas-field:not(.zccbutton):not(.zc-rl-field):not(.zcclink)"},label:{default:".zcanvas-field:not(.zccbutton):not(.zc-rl-field):not(.zcclink) .zcanvas-label"},value:{default:".zcanvas-field:not(.zccbutton):not(.zc-rl-field):not(.zcclink) .zcanvas-value-container"},textarea:{default:".zcanvas-field.zctextarea:not(.zccbutton):not(.zc-rl-field) .zcanvas-value-container"},tag:{default:".zcanvas-field:not(.zccbutton):not(.zc-rl-field) .zcanvas-value-container crm-tag ul li"},section:{default:".zcanvassection:not(.zcanvas-non-delete):not(.zcanvas-title-editor):not(.zcanvas-static-content-container):not(.zc-no-theme):not(.zc-tab-section)"},"relatedlist section":{default:".zcanvassection.zcanvas-non-delete"},"relatedlist title":{default:".zcanvassection.zcanvas-title-editor"},title:{default:".zcstatictext.zc_disabled"},button:{default:".zccbutton.zcanvas-field"},"Tab Layout":{default:".zctabview .zc-tabs .tab:not(.active)",hover:".zctabview .zc-tabs .tab:not(.active):hover",active:".zctabview .zc-tabs .tab.active"},page:{default:".zc-page-component"},relatedlist:{default:".zc-list-component"},"Static Text":{default:".zcstatictext:not(.zc_disabled)"},Line:{default:".zclayout.zcdivider .zc-divider-line"},"Table Layout":{default:".zclayout-table > .canvas-outer"},textarea:{default:".zcanvas-field.zctextarea:not(.zccbutton):not(.zc-rl-field) .zcanvas-value-container"}}}});createStruture.toolinst=n}this.addtoqueue(e,o,(function(e,t,a){var i=this.getCompNamefromId(t.id);t.asyncresources&&t.asyncresources.length?(this.loadResourceOnDemand(t),t.asyncloader&&t.asyncloader.then(function(){this.registerComponent(e,i,void 0,a._type,a.lazyload,a),this.loadRecordImage(),delete t.asyncloader,delete t.asyncresources}.bind(this))):(this.registerComponent(e,i,void 0,a._type,a.lazyload,a),this.loadRecordImage())}))},tabHandler:function(e){if(e){var t=e.attr("data-tab");if(t){var a=document.querySelector(t+" crm-stage-history");if(a){var i=a.component;setTimeout((function(){i.setWidthForStagesParent.bind(i)()}),100)}}}Lyte.registeredMixins["crm-detailcanvas-utils"].scrollhandler()},tabrefresh:function(e){for(var t=zclayout.prototype.layouts["Tab Layout"],a=e.find(".zctabview:not(.zcrefreshedlayout)"),i=a.length,o=0;o<i;o++){t.refreshlayout(a.eq(o),this.tabHandler);for(var n=a.get(o).querySelectorAll(".zc-tabs"),r=n.length,l=[],s=0;s<r;s++){var d=$L(n[s]).children(".tab.active.zc-hideable-tab");d&&d.length&&!d.is(":visible")&&l.push({newnode:this.findalternativetab(d[0]),active:d})}l.map((function(e){if(e.newnode){e.active.removeClass("active");var t=e.active.attr("data-tab");document.querySelector(t).style.display="none",e.newnode.addClass("active");var a=e.newnode.attr("data-tab");document.querySelector(a).style.display="block"}}))}},findalternativetab:function(e){for(var t=e.parentElement,a=$L(t).children(".tab"),i=-1,o=a.length,n=0;n<o;n++)a[n]===e[0]&&(i=n);for(n=i+1;n<o;n++){var r=a.eq(n);if(r&&r.length&&(!r.hasClass("zc-hideable-tab")||r.is(":visible")))return r}for(n=i-1;n>=0;n--){var l=a.eq(n);if(l&&l.length&&(!l.hasClass("zc-hideable-tab")||l.is(":visible")))return l}t.closest(".zctabview").closest(".row").addClass("zcanvas_forced_hidden")},populateActiveActions:function(e,t){for(var a=e.children,i=a?a.length:0,o=0;o<i;o++)"action"===a[o]._type&&t.push(a[o].id),this.populateActiveActions(a[o],t)},fetchRelatedListData:function(e,t,a,i){return new Promise(function(o,n){var r,l,s=store.peekRecord("related_list",a);i=i||{per_page:5,page:1},r=s.module?s.module.id:moduleRecordMapping[e].id;var d=this.constructRelatedListQP(r);if(l=null!==d&&0===Object.keys(d).length?store.peekRecord("module",r):app.store.makeRequest("findRecord","module",r,void 0,void 0,!0,d),s.connectedmodule){var c=moduleRecordMapping[s.connectedmodule].id,u=this.constructRelatedListQP(c),p={relatedId:t,relationId:s.id,per_page:i.per_page,page:i.page};s.customize_sort&&s.sort_order&&s.sort_by&&(p.sort_order=s.sort_order,p.sort_by=s.sort_by.api_name),p.approved="both",p.approval_state="approved,approval_process_pending,approval_process_rejected",Lyte.resolvePromises({module:l,relRecords:t?app.store.makeRequest("findAll",moduleRecordMapping[e].id,p,void 0,!1):[],linkModule:app.store.makeRequest("findRecord","module",c,void 0,void 0,!0,u)}).then(function(t){var r=moduleRecordMapping[e].id,l=t.relRecords[r];if(this.relatedListDataCnt(t,a,i),!l||!l.length)return t.relRecords=[],void o(t);var d=s.module.id;t.meta=t.relRecords.info,t.relRecords=store.pushPayload(d,l);for(var c=moduleRecordMapping[s.connectedmodule].id,u=store.peekRecord("module",c),p=this.getConnectedModuleApiName(s.api_name),m=t&&t.relRecords?t.relRecords.length:0,f=[],v={},h=0;h<m;h++){var g=t.relRecords[h][p].id;f.push(g),v[g]=t.relRecords[h]}this.fetchRelatedModuleRecordsById(u,f,v).then((function(){o(t)})).catch((function(e){n(e)}))}.bind(this)).catch((function(e){n(e)}))}else if("Campaigns"!==s.api_name||"Leads"!==e&&"Contacts"!==e)if("Contact_Roles"===s.api_name){f="DealContactRole",p={relatedId:t,relationId:s.id,per_page:i.per_page,page:i.page};s.customize_sort&&s.sort_order&&s.sort_by&&(p.sort_order=s.sort_order,p.sort_by=s.sort_by.api_name),p.approved="both",p.approval_state="approved,approval_process_pending,approval_process_rejected",Lyte.resolvePromises({module:l,relRecords:t?app.store.makeRequest("findAll",moduleRecordMapping[e].id,p,void 0,!1):[],contactRoles:app.store.makeRequest("findAll","contact_role")}).then(function(t){var n=["Full_Name","Account_Name","Phone","Email"],r=t.module.fields?t.module.fields:t.module[0].fields,l=r.length,d=[];this.relatedListDataCnt(t,a,i);for(var c=0;c<l;c++){var u=r[c];n.indexOf(u.api_name)>=0&&d.push(u)}var p=moduleRecordMapping[e].id,m=t.relRecords[p],v=s.module.id;m&&m.length>0?(t.meta=t.relRecords.info,t.relRecords=store.pushPayload(v,m)):t.relRecords=[];var h=["Role"];app.store.makeRequest("findAll","field",{module:f}).then((function(e){for(var a=e,i=a.length,n=0;n<i;n++){var r=a[n];h.indexOf(r.api_name)>=0&&(store.pushPayload("field",r),d.push(r))}t.contactRoleFields=d,o(t)}),(function(){o(t)}))}.bind(this)).catch((function(e){n(e)}))}else{var m={relatedId:t,relationId:s.id,per_page:i.per_page,page:i.page};s.customize_sort&&s.sort_order&&s.sort_by&&(m.sort_order=s.sort_order,m.sort_by=s.sort_by.api_name),"Calls_History"!==s.api_name&&"Calls"!==s.api_name||(m.sort_by="Call_Start_Time",m.sort_order="Calls"===s.api_name?"asc":"desc"),m.approved="both",m.approval_state="approved,approval_process_pending,approval_process_rejected","Visits_Zoho_Livedesk"===s.api_name&&this.getData&&"All Portals"!==this.getData("salesiqPortal")&&(m.filters=JSON.stringify({comparator:"equal",value:this.getData("salesiqPortal"),field:{api_name:"Portal_Name"}})),"picklist_tracker"===s.action&&(d.type="GET"),Lyte.resolvePromises({module:l,relRecords:t?app.store.makeRequest("findAll",moduleRecordMapping[e].id,m,void 0,!1,d):[],fields:"Invited_Events"===s.api_name?app.store.makeRequest("findAll","field",{module:"Activities"}):[]}).then(function(t){var n=moduleRecordMapping[e].id,r=t.relRecords[n],l=s.module.id;this.relatedListDataCnt(t,a,i),r&&r.length>0?(t.meta=t.relRecords.info,t.relRecords=store.pushPayload(l,r)):t.relRecords=[],o(t)}.bind(this)).catch((function(e){n(e)}))}else{var f="Campaign_"+e+"_Members",p={relatedId:t,relationId:s.id,per_page:i.per_page,page:i.page};s.customize_sort&&s.sort_order&&s.sort_by&&(p.sort_order=s.sort_order,p.sort_by=s.sort_by.api_name),p.approved="both",p.approval_state="approved,approval_process_pending,approval_process_rejected",Lyte.resolvePromises({module:l,relRecords:t?app.store.makeRequest("findAll",moduleRecordMapping[e].id,p,void 0,!1):[],campaignFields:app.store.makeRequest("findAll","field",{module:f})}).then(function(t){var n=moduleRecordMapping[e].id,r=t.relRecords[n],l=s.module.id;this.relatedListDataCnt(t,a,i),r&&r.length>0?(t.meta=t.relRecords.info,t.relRecords=store.pushPayload(l,r)):t.relRecords=[];for(var d=t.campaignFields,c=d.length,u=t.module.fields?t.module.fields:t.module[0].fields,p=u.map((function(e){return e.id})),m=0;m<c;m++){var f=d[m];if("Member_Status"===f.api_name){var v=store.peekRecord("field",f.id);if(!v){store.pushPayload("field",f),u.push(f),(t.module.related_list_properties?t.module.related_list_properties:t.module[0].related_list_properties).fields.push({api_name:f.api_name,field_label:f.field_label,id:f.id,ui_type:f.ui_type});break}if(p.indexOf(v.id)<0){u.push(f);break}}}o(t)}.bind(this)).catch((function(e){n(e)}))}}.bind(this))},constructRelatedListQP:function(e){var t=store.peekRecord("module",e),a={allowMultiple:!0};return t.related_list_properties&&!t.fields?(t.fields=[],t.related_list_properties={},a.getOnlyMeta=!0):t.fields&&!t.related_list_properties?(t.fields=[],a.getOnlyMeta=!0):t.related_list_properties||t.fields||(t.related_list_properties={},a.getOnlyMeta=!1),a},fetchViewData:function(e,t){return new Promise((function(a){app.store.makeRequest("findRecord","canvasview",e,{feature:"CustomComponent",module:t,unparsed:!0}).then((function(e){Lyte.registeredMixins["crm-detailcanvas-utils"].editPreProcess(e[0],t).then((function(e){var t=e;t.name="CustomComponent",t.componentid=t.id,delete t.id,a(t)}))}))}))},loadRecordImage:function(){var e=$("[data-cvsrc]"),t=e.length;if(t)for(var a=0;a<t;a++){var i=e.eq(a);" N/A "===i.attr("data-fileid")?emptyImgRemove(i):i.attr("src",i.attr("data-cvsrc")),i.removeAttr("data-cvsrc")}},componentPreProcess:function(e){for(var t=e.relatedlist.length,a=0;a<t;a++)if(Crm.isActivitySplitDone&&"Calls"===e.relatedlist[a].api_name||"Tasks"===e.relatedlist[a].api_name||"Events"===e.relatedlist[a].api_name||"Open_Appointments__s"===e.relatedlist[a].api_name){e.components.components.push({comp_available:!0,display_label:I18n.getMsg("crm.label.open.activities",I18n.getMsg("Activities")),name:"Activities",type:"system"}),e.components.components.push({comp_available:!0,display_label:I18n.getMsg("crm.label.closed.activities",I18n.getMsg("Activities")),name:"Activities_History",type:"system"});break}for(var i=e.components.components.length,o=0;o<i;o++){var n=e.components.components[o],r=n.type;"field"==r?this.componentPreProcess_Field(e,n):"link"==r||"button"==r?this.componentPreProcess_LinkButton(e,n):"relatedlist"==r?this.componentPreProcess_RelatedList(e):("action"==r||"system"==r||"zia"==r)&&this.componentPreProcess_SystemComp(e,n)}},componentPreProcess_Field:function(e,t){var a=store.peekRecord("layout",e.layoutId),i=t.type;e.components[i]=e.components[i]?e.components[i]:[],(e.module.indexOf("CustomModule")>-1||e.module.indexOf("LinkingModule")>-1)&&(Customization.displayFieldMap[e.module]=["Name"]),e.components.section=[];for(var o=e.module,n=a.sections,r=n.length,l=0;l<r;l++){var s=n[l],d=s.fields,c=s.api_name,u=d.length;if(0!==u&&((!s.isSubformSection||"unused"!==s.type)&&"Score Summary"!==c)){var p={apiname:c,"data-zcqa":"canvas_"+o+"_"+s.api_name,datatype:"section",_type:"section",label:s.display_label,id:s.uid,data:[]};e.components.section.push(p);for(var m=0;m<u;m++){var f=null,v=d[m];if("Sales_Cycle_Duration"!=v.api_name&&"Lead_Conversion_Time"!=v.api_name&&"Overall_Sales_Duration"!=v.api_name&&!(s.isSubformSection&&"subform"!==v.data_type||this.scoreColumn.indexOf(v.column_name)>-1)){var h=this.getCruxName(v.ui_type,v.data_type);if("profileimage"==v.data_type)h="profileimage";else{if("Data_Processing_Basis_Details"==v.api_name)continue;(v.subform||"Product_Details"===v.api_name||"Pricing_Details"===v.api_name)&&(h="subform",u=1)}f=null==(f=this.constructCruxComponentForCanvas(v.id,o,e.record,!0,void 0,!0))?" N/A ":f;var g={apiname:v.api_name,datatype:h,_type:i,label:$ESAPI.encoder().encodeForHTMLAttribute(v.field_label),id:v.id,value:f,zcqaval:v.field_label,hidden:!v.visible};"subform"===h&&(g={data:{},datatype:h,_type:"subform",label:$ESAPI.encoder().encodeForHTMLAttribute(v.field_label),id:v.id,template:f,value:$ESAPI.encoder().encodeForHTMLAttribute(v.field_label),zcqaval:v.field_label});var y=v.tooltip;y&&"Info Icon"===y.name&&(g.label+='<span data-zcqa="zc_ajxFld_'+v.id+'" id="zc_ajax_info_icon_'+v.id+'" class="icon_roundinfo mL5 cP zcanvas-label-info"></span>'),e.components[i].push(g),p.data.push(g),this.componentPreProcess_subField(e,v,p,g)}}}}},componentPreProcess_subField:function(e,t,a,i,o,n){if(["userlookup","ownerlookup"].contains(t.data_type)){(i=objectUtils.cloneObject(i)).datatype="profileimage",i.zcqaval=i.zcqaval+"_profileimage",i.id=i.id+"_profileimage",i.label=$ESAPI.encoder().encodeForHTMLAttribute(t.field_label+" Image"),i.customField=!0;var r=new CrmDetailViewHandler(e.module,e.record,i.id,i.datatype,void 0,void 0,void 0,!0,n);i.value=r.getHTML(),"fromRL"===o?a.push(i):a.data.push(i)}},componentPreProcess_LinkButton:function(e,t){var a=t.type;e.components[a]=e.components[a]?e.components[a]:[];for(var i=e[a]?e[a]:[],o=i.length,n=0;n<o;n++){var r=i[n].id;if("button"!==t.type||"view"===i[n].position){var l=new CrmDetailViewHandler(e.module,e.record,r,a,i[n]).getHTML(),s={datatype:a,_type:a,label:i[n].name,id:r,value:l,hidden:!(i[n].profiles.filter((function(e){return e.name===Crm.userDetails.PROFILE_NAME})).length>0)};e.components[a].push(s)}}if("button"===a&&(!Customization.orgSpec.includes(Crm.userDetails.LICENSE_TYPE)||e.components[a].length>0)){var d=o?i[0].name:"Button Group";l=new CrmDetailViewHandler(e.module,e.record,r,a,{name:d}).getHTML();e.components[a].push({datatype:a,_type:a,label:I18n.getMsg("crm.canvas.allcustombuttons"),id:"canvas_button_group",value:l,iconhtml:'<span class="icon-Icon_dot_three aligncenter dB zc-systembtn-icon"></span>'})}},componentPreProcess_RelatedList:function(e){var t=e.relatedlist||[],a="relatedlist";e.components[a]=e.components[a]?e.components[a]:[];for(var i=t.length,o=0;o<i;o++){if(["Email_Sentiment","Mailing_History","WebformUsage"].indexOf(t[o].api_name)<=-1&&t[o][e.layoutId].visible){var n;t[o].module&&(n=t[o].module.id);var r=t[o].display_label,l=t[o].personality_name,s={url_params:[e.module,e.record.id,t[o].id],module_id:n},d=this.labelPreProcess(t[o],e,!0),c={api_name:t[o].api_name,datatype:"relatedlist",_type:"relatedlist",label:d,id:t[o].id,value:r,action:s,relListModId:n};c.p_name=l,t[o].connectedmodule&&(c.connectedModName=t[o].api_name);var u=t[o].api_name;if(["Social","Visits_Zoho_Livedesk","Notes","Competitors","Attachments","CheckLists","Stage_History","Zoho_Finance","Zoho_Books","Zoho_Invoice","Zoho_Expense","Zoho_Subscriptions","Zoho_Survey","Zoho_Projects","Polls","Questions_and_Answers","Child_Campaigns","Zoho_Support","Emails","LinkedIn Sales Navigator","Entity_Scores__s","messages__s","Circuit_Executions"].indexOf(u)>=0||"custom_function"===t[o].type||"custom_related_list"===t[o].type){var p=new CrmDetailViewHandler(e.module,e.record,t[o].id,"static_rel");c.template=p.getHTML(),c.data={},c.datatype="static_rel",["Social","Visits_Zoho_Livedesk","Zoho_Finance","Zoho_Books","Zoho_Invoice","Zoho_Expense","Zoho_Subscriptions","Zoho_Survey","Zoho_Projects","Zoho_Support","Emails","LinkedIn Sales Navigator","Circuit_Executions"].indexOf(u)>=0&&(c.personalityName=t[o].personality_name);var m=p.getResources();m.length&&(c.async=!0,c.asyncresources=m)}e.components[a].push(c)}}},getCanvasIconforButton:function(e){if(e)switch(e.id){case"back":e.iconhtml='<span class="backtoIcon dIB zc-abs-center zc-systembtn-icon"></span>';break;case"navigate":e.iconhtml='<div class="lyteNavigator zc-disable-mouse dIB zc-systembtn-icon">  <div class="lyteNavigator lyteSingleBack lyteIconSingleBack fL"></div>  <div class="lyteNavigator lyteSingleFront lyteIconSingleFront"></div>   </div> ';break;case"morebutton":e.iconhtml='<span class="icon-Icon_dot_three zc-abs-center zc-systembtn-icon"></span>'}},componentPreProcess_SystemComp:function(e,t){var a=t.type;e.components[a]=e.components[a]?e.components[a]:[];var i=new CrmDetailViewHandler(e.module,e.record,t.name,t.name,t),o=i.getHTML(),n=a;"callnow"===t.name&&(t.comp_available=!1,(Crm.userDetails.TELEPHONY_ENABLED||window.ZPB&&ZPB.clickToDial&&ZPB.clickToDial.isEnabled())&&(t.comp_available=!0));var r={api_name:t.name,datatype:n,_type:a,label:t.display_label,id:t.name,value:o,hidden:!t.comp_available};"action"==a?(r.datatype="button",this.getCanvasIconforButton(r)):"system"!=a&&"zia"!=a||(r.action={url_params:[e.module,e.record.id,null],module_id:null},r.template=r.value,r.value=r.label,r.data={});var l=i.getResources();l.length&&(r.async=!0,r.asyncresources=l),o&&e.components[a].push(r)},constructCruxComponentForCanvas:function(e,t,a,i,o,n,r,l){var s,d,c,u,p,m,f,v,h,g,y=t;a=$u.isEmpty(a)||!(a&&a.$&&a.$.toJSON)?a:a.$.toJSON();var b=[36,77,143,144,145];o&&(h=o.connectedModName,g=o.relatedListModule);var _,x=r?l:store.peekRecord("field",e),z=x.module&&x.module[0]?x.module[0].module_name:null;if(_=o||r?"fieldupdate_rl":"canvas_fld fieldupdate_"+x.column_name,a){if(u=$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(a)),p=a.id+"","Activities"===t&&(s=a.Activity_Type,d=a.$se_module),"Tasks"===t||"Events"===t||"Calls"===t){if(r&&a.$se_module){var R;R={api_name:moduleApiMapping[a.$se_module]},x.lookup.module=R}d=a.$se_module}if("Member_Status"===x.api_name)m=a.$member_info?a.$member_info.Member_Status:null;else if("Role"===x.api_name&&"CNTROLEID"===x.column_name){var L=a.Contact_Role,C=store.peekRecord("contact_role",L);m=C?C.name:null}else if(h&&z&&z!==g){var w=x.module[0].module_name,S=a&&a[h]?a[h].id:null;if(S){var I=store.peekRecord(moduleRecordMapping[w].id,S);m=I?I[x.api_name]:null}if("profileimage"===x.data_type)return c=new CrmDetailViewHandler(z,I,e,x.data_type).getHTML();if(b.indexOf(x.ui_type)>=0){var M=I?I.Currency:"";if(m)return c="<crux-number-component data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(x))+'\' cx-Prop-Empty-Value="-"  class="canvasCruxComponent  '+_+" \" cx-prop-iso-code='"+M+"'  cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(r?x:x.$.toJSON()))+"' cx-prop-value='"+m+"'></crux-number-component>"}}else m=a[x.api_name];m&&"object"==typeof m&&(!Array.isArray(m)||m.length>0)&&(f=m.id+"",(v=m.name+"")&&"string"==typeof v&&(v=$ESAPI.encoder().encodeForHTMLAttribute(v)),m=JSON.stringify(m)),m&&"string"==typeof m&&(m=$ESAPI.encoder().encodeForHTMLAttribute(m))}else if(h&&z&&z!==t&&z!==g){if(u='{{getConnectedModuleData(record,"'+(y=x.module[0].module_name)+'","'+h+'")}}',p='{{getConnectedModuleData(record,"'+y+'","'+h+'","id")}}',m='{{getConnectedModuleData(record,"'+y+'","'+h+'","'+(k=x.api_name)+'")}}',f='{{getConnectedModuleData(record,"'+y+'","'+h+'","'+k+'.id")}}',v='{{getConnectedModuleData(record,"'+y+'","'+h+'","'+k+'.name")}}',"Activities"===y&&(s='{{getConnectedModuleData(record,"'+y+'","'+h+'","'+k+'.Activity_Type")}}'),"profileimage"===x.data_type)return c="<img cx-Prop-Empty-Value=\"-\"  onerror='Customization.replaceEmptyImgDC(this);' id='img_"+p+"' "+(a?"src":"data-cvsrc")+"='"+Crm.getCrmBasePath()+"/EntityImageAttach.do?action_module="+y+"&entityId="+p+"&actionName=readImage&fileId="+m+"' data-fileid='"+m+"'/>";if(b.indexOf(x.ui_type)>=0){var A='{{getConnectedModuleData(record,"'+y+'","'+h+'","Currency")}}';M=I?I.Currency:"";return c="<crux-number-component  data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(x))+'\' cx-Prop-Empty-Value="-"  class="canvasCruxComponent '+_+" \" cx-prop-iso-code='"+A+"'  cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(r?x:x.$.toJSON()))+"' cx-prop-value='"+m+"'></crux-number-component>"}if(this.isRelListLookupFld(y,k))return c="<crux-lookup-component  data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(x,o,m))+'\' cx-Prop-Empty-Value="-"  class="canvasCruxComponent '+_+' "',"Activities"===y&&(c+=' cx-prop-query-params=\'{"sub_module" : "'+s+"\"}' "),c+=" cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(r?x:x.$.toJSON()))+'\' cx-prop-route-name="crm.tab.module.entity.detail"  cx-prop-dynamic-params =\'["'+y+'","'+p+"\"]'   cx-prop-value='"+m+"'></crux-lookup-component>"}else{var k;"Member_Status"===(k=x.api_name)?(u="{{record}}",p="{{record.id}}",m="{{record."+(k="$member_info.Member_Status")+"}}"):"Role"===k&&"CNTROLEID"===x.column_name?(u="{{record}}",p="{{record.id}}",m="{{getContactRoles(record."+(k="Contact_Role")+")}}"):"Status"===k&&"Events"===g?(k="status",u="{{record}}",p="{{record.id}}",m="{{getInvitedEventStatus(record.Participants)}}"):(u="{{record}}",p="{{record.id}}",m="{{record."+k+"}}",f="{{record."+k+".id}}",v="{{record."+k+".name}}"),"Activities"===y&&(s="{{record.Activity_Type}}",d="{{record.$se_module}}"),"Tasks"!==t&&"Events"!==t&&"Calls"!==t||(d="{{record.$se_module}}")}if("profileimage"===x.data_type)c=new CrmDetailViewHandler(t,a,e,x.data_type,void 0,o).getHTML();else if(x.subform&&x.section&&!o)c='<crm-detail-view-subform cx-Prop-Empty-Value="-"  subform=\''+JSON.stringify(x.section[0].$.toJSON())+"'  subform_api='"+x.section[0].api_name+"' record='"+u+"' module='"+t+"'></crm-detail-view-subform>";else if("Quotes"!=t&&"SalesOrders"!=t&&"PurchaseOrders"!=t&&"Invoices"!=t||"Product_Details"!=x.api_name||!x.section){if("PriceBooks"==t&&"Pricing_Details"==x.api_name)c='<crm-detail-view-pricing-details cx-Prop-Empty-Value="-"  record=\''+u+"'></crm-detail-view-pricing-details>";else if("Comments"===x.api_name&&99===x.ui_type){var P=!1;n&&(P=!0),c='<crm-comment-information cx-Prop-Empty-Value="-" class="zc_cursor_nodrop canvasCruxComponent '+_+' " lyte-unbound = '+P+' cx-Prop-Empty-Value="-" cx-prop-field =\''+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(r?x:x.$.toJSON()))+"' ",!i&&this.isAjaxEditableField(e)&&(c+=" onmouseover=\"{{action('handleMouseActions',this)}}\" onmouseout=\"{{action('handleMouseActions',this)}}\""),c+="record='"+u+"'></crm-comment-information>"}else if("Status"===x.api_name&&"Events"===g)if(n){var D=$L("crm-detailview-canvas-gallery")[0];if(F=D?D.component.getData("record"):store.peekAll(moduleRecordMapping[t].id)[0]){var O=a?store.peekRecord(moduleRecordMapping.Events.id,a.id):null;if(O)c="<span>"+Lyte.Component.registeredHelpers.getInvitedEventStatus(O,F)+"</span>"}}else c="{{unescape(getInvitedData( "+n+" , fromRecord , '"+t+"' , record ))}}";else if(null!=m&&(!Array.isArray(m)||m.length>0)&&("string"==typeof m?m.length>0:"boolean"!=typeof m||m)){var E=this.getCruxName(x.ui_type,x.data_type);if(4==x.ui_type||"lookup"==x.data_type)c="<crux-lookup-component onmouseover=\"{{action('showHideRelatedFields','"+t+"','"+e+"',event)}}\" onmouseout=\"{{action('showHideRelatedFields',,,event)}}\" on-value-change=\"{{method('onValueChange')}}\"   data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(x))+"'  class=\"canvasCruxComponent "+_+' "  cx-Prop-Empty-Value="-" ',"Activities"===y&&(c+=' cx-prop-query-params=\'{"sub_module" : "'+s+"\"}' "),d="Activities"===y||"Tasks"===y||"Events"===y||"Calls"===y?"Who_Id"===x.api_name?"Contacts":d:"Service_Name"===x.api_name&&"Appointments"===y?"Services":x.lookup.module.api_name,store.peekAll("module").forEach((function(e){e.api_name==d&&(d=e.module_name)})),c+=" cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(r?x:x.$.toJSON()))+'\' cx-prop-route-name="crm.tab.module.entity.detail"  cx-prop-dynamic-params = ["'+d+'","'+f+"\"]  cx-prop-value='"+m+"'></crux-lookup-component>";else if(132==x.ui_type&&"multi_module_lookup"==x.data_type)c="<crux-lookup-component  onmouseover=\"{{action('showHideRelatedFields','"+t+"','"+e+"',event)}}\" onmouseout=\"{{action('showHideRelatedFields',,,event)}}\"  data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(x))+"'  class=\"canvasCruxComponent "+_+' "  cx-Prop-Empty-Value="-" ',c+=" cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(r?x:x.$.toJSON()))+'\' cx-prop-route-name="crm.tab.module.entity.detail"  cx-prop-dynamic-params = ["'+y+'","'+f+'"]  cx-prop-value="'+v+'"></crux-lookup-component>';else if(445==x.ui_type)c="<crux-user-component  data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(x))+'\'  cx-Prop-Empty-Value="-" class="canvasCruxComponent '+_+" \"  cx-prop-value='"+m+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(r?x:x.$.toJSON()))+"' ",!i&&this.isAjaxEditableField(e)&&(c+=" onmouseover=\"{{action('handleMouseActions',this)}}\" onmouseout=\"{{action('handleMouseActions',this)}}\""),c+="cx-prop-value='"+m+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(r?x:x.$.toJSON()))+"'></crux-user-component>";else if(444==x.ui_type){P=!1;n&&(P=!0);var T=x.api_name;x.multiselectlookup&&x.multiselectlookup.connectedlookup_apiname&&(T=x.multiselectlookup.connectedlookup_apiname),c="<crm-multi-lookup lyte-unbound = "+P+" data-zcqa ='"+this.getZcqa(x)+"' cx-Prop-Empty-Value=\"-\" class='canvasCruxComponent "+_+" ' cx-prop-field='"+m+"' cx-field-label='"+T+"'></crm-multi-lookup>"}else if(8==x.ui_type||221==x.ui_type)c="<crux-"+E+"-component  data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(x))+'\' cx-Prop-Empty-Value="-"  class="canvasCruxComponent  '+_+" \"   cx-prop-is-business-card='true' ",!i&&this.isAjaxEditableField(e)&&(c+=" onmouseover=\"{{action('handleMouseActions',this)}}\" onmouseout=\"{{action('handleMouseActions',this)}}\""),c+=" cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(r?x:x.$.toJSON()))+"' cx-prop-value='"+m+"' ></crux-"+E+"-component>";else if(37==x.ui_type)c="<crm-skype-field  data-zcqa ='"+this.getZcqa(x)+"' cx-Prop-Empty-Value=\"-\" cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(r?x:x.$.toJSON()))+"' class='canvasCruxComponent "+_+" ' ",!i&&this.isAjaxEditableField(e)&&(c+=" onmouseover=\"{{action('handleMouseActions',this)}}\" onmouseout=\"{{action('handleMouseActions',this)}}\""),c+=" crm-skype-value='"+m+"'></crm-skype-field>";else if(555==x.ui_type){P=!1;n&&(P=!0),c="<crm-file-upload class='canvasCruxComponent "+_+" ' lyte-unbound = "+P+" data-zcqa ='"+this.getZcqa(x)+"' cx-Prop-Empty-Value=\"-\" cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(r?x:x.$.toJSON()))+"' ",!i&&this.isAjaxEditableField(e)&&(c+=" onmouseover=\"{{action('handleMouseActions',this)}}\" onmouseout=\"{{action('handleMouseActions',this)}}\""),c+="cx-prop-fieldvalue='"+m+"'></crm-file-upload>"}else if(x.ui_type===CrmField.UITYPES.IMAGE_UPLOAD)c=this.getImageUploadComponentData(this,a,x,y,m,p);else if(b.indexOf(x.ui_type)>=0||116===x.ui_type&&"currency"==x.formula.return_type){M=a?a.Currency:"{{record.Currency}}";if(c="<crux-number-component",a&&a.id)(F=store.peekRecord(moduleRecordMapping[t].id,a.id))&&F.$formatted_currency&&F.$formatted_currency[x.api_name]&&(c+=' cx-prop-formatted-currency = "'+F.$formatted_currency[x.api_name]+'"'),F&&F.$home_converted_currency&&F.$home_converted_currency[x.api_name]&&(c+=' cx-prop-home-currency = "'+F.$home_converted_currency[x.api_name]+'"');else c+=' cx-prop-formatted-currency="{{canvasformattingCurrency('+("record.$formatted_currency."+x.api_name)+')}}" ',c+=' cx-prop-home-currency="{{canvasformattingCurrency('+("record.$home_converted_currency."+x.api_name)+')}}" ';M?(c+=" data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(x))+"' class=\"canvasCruxComponent  "+_+' " cx-Prop-Empty-Value="-"  cx-prop-iso-code=\''+M+"' ",!i&&this.isAjaxEditableField(e)&&(c+=" onmouseover=\"{{action('handleMouseActions',this)}}\" onmouseout=\"{{action('handleMouseActions',this)}}\""),c+="cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(r?x:x.$.toJSON()))+"' cx-prop-value='"+m+"'></crux-number-component>"):c+=" data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(x))+"' class=\"canvasCruxComponent "+_+' " cx-Prop-Empty-Value="-"  cx-prop-field =\''+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(r?x:x.$.toJSON()))+"' cx-prop-value='"+m+"'></crux-number-component>"}else{if(25==x.ui_type||"Email"==x.api_name){var F,$=!0;return(F=a||(this.$node&&this.getData("records")?this.getData("records")[0]:void 0))&&F.Data_Processing_Basis_Details&&!F.Data_Processing_Basis_Details.Contact_Through_Email&&($=!1),c="<crm-email-field class='canvasCruxComponent "+_+" ' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(x))+"' record=\"{{record}}\" module-name='"+t+"'  email-opt-out="+!1+" email-opt-value="+$,!i&&this.isAjaxEditableField(e)&&(c+=" onmouseover=\"{{action('handleMouseActions',this)}}\" onmouseout=\"{{action('handleMouseActions',this)}}\""),c+="  cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(r?x:x.$.toJSON()))+"' cx-prop-value='"+m+"' ></crm-email-field>"}if(999==x.ui_type){var N=!1;return o&&(N=!0),c='<crm-territory-field cx-Prop-Empty-Value="-" from-Rl='+N+' entity-details="{{entityDetails}}"  data-zcqa =\''+this.getZcqa(x)+"' record='"+u+"' module=\""+t+"\" cx-prop-value1='"+m+"'></crm-territory-field>"}if(i&&this.isRelListLookupFld(t,x.api_name))c="<crux-lookup-component  data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(x,o,m))+'\' cx-Prop-Empty-Value="-"  class="canvasCruxComponent '+_+' "',i||(c+=" onmouseover=\"{{action('handleMouseActions',this)}}\" onmouseout=\"{{action('handleMouseActions',this)}}\""),"Activities"===y&&(c+=' cx-prop-query-params=\'{"sub_module" : "'+s+"\"}' "),c+=" cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(r?x:x.$.toJSON()))+'\' cx-prop-route-name="crm.tab.module.entity.detail"  cx-prop-dynamic-params =\'["'+t+'","'+p+'"]\'   cx-prop-value="'+m+'"></crux-lookup-component>',!o||"Activities"!==o.relatedListModule&&"Tasks"!==o.relatedListModule||"Subject"!==x.api_name||(c+=Lyte.Component.registeredHelpers.getColorCodeForEvents(n,a),c+='<template is="if" value="{{record.$in_project_sync}}"><template case="true"><span style="margin-left: 2px;margin-bottom: 2px;" class="task_syncIcon vam" lt-prop-title="{{concat(getI18n(&quot;crm.schedules.prefix.in&quot;),getI18n(&quot;crm.integ.sync.message&quot;,&quot;crm.project.integration.title&quot;))}}"  lt-prop-tooltip-config="{&quot;position&quot;:&quot;followcursor&quot;, &quot;appearance&quot; : &quot;box&quot;}"></span></template>');else if("integer"===x.data_type||"currency"===x.data_type)c="<crux-"+E+"-component  data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(x))+"' class=\"canvasCruxComponent "+_+' " cx-Prop-Empty-Value="-" ',!i&&this.isAjaxEditableField(e)&&(c+=" onmouseover=\"{{action('handleMouseActions',this)}}\" onmouseout=\"{{action('handleMouseActions',this)}}\""),c+=" cx-prop-field='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(r?x:x.$.toJSON()))+"' cx-prop-value="+m+"></crux-"+E+"-component>";else if("tag"===E){if(n&&m.length<=2)return c;n&&S&&(u=$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(I)),t=w);N=!1;(o&&(o.relatedListModule||o.connectedModName)||r)&&(N=!0);P=!1;n&&(P=!0),c='<crm-tag class="crmtagrecord_'+p+'" lyte-unbound='+P+" from-Rl="+N+"  data-zcqa ='"+this.getZcqa(x)+"' cx-Prop-Empty-Value=\"-\" record='"+u+"' module=\""+t+'" record-id="'+p+'"></crm-tag>'}else if("picklist"===E||"multi-picklist"===E){var j=x;if(t=x.module&&x.module[0]?x.module[0].api_name:t||"",c="<crux-picklist-component   data-zcqa ='"+this.getZcqa(x)+'\' cx-Prop-Empty-Value="-"  class="canvasCruxComponent '+_+" \" cx-prop-from='view'",!i&&this.isAjaxEditableField(e)&&(c+=" onmouseover=\"{{action('handleMouseActions',this)}}\" onmouseout=\"{{action('handleMouseActions',this)}}\""),"multi-picklist"===E)c+="cx-prop-type= ' multisearch ' ";else if("picklist"===E&&x.enable_colour_code&&"Activities"!==t&&"Events"!==t){var q=$L("crm-detailview-canvas")[0]?$L("crm-detailview-canvas")[0]:$L("crm-detailview-oldeditor")[0],H=(q=q||$L("crm-detailview-canvas-gallery")[0]).component.data.layoutId;null!==x[H]&&(c+=" cx-prop-layout="+H),c+=" cx-prop-is-color-code-enabled="+x.enable_colour_code}c+=" cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(r?x:j.$.toJSON()))+"' cx-prop-value='"+m+"'></crux-picklist-component>"}else if(116===x.ui_type&&"boolean"==x.formula.return_type)c="<crux-"+x.formula.return_type+"-component   data-zcqa ='"+this.getZcqa(x)+"'  class=\"canvasCruxComponent "+_+' " cx-Prop-Empty-Value="-" ',c+=" cx-prop-field ='"+JSON.stringify(r?x:x.$.toJSON())+"' cx-prop-value='"+m+"' ></crux-"+x.formula.return_type+"-component>";else if(301===x.ui_type&&"Email_Opt_Out"===x.api_name)c="<crm-email-field data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(x))+'\' record="{{record}}" class="canvasCruxComponent '+_+' " cx-Prop-Empty-Value="-" module-name=\''+t+"' email-opt-out="+!0+" cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(r?x:x.$.toJSON()))+"' cx-prop-value='"+m+"' ></crm-email-field>";else if("number"==typeof m&&(m=m.toString()),3==x.ui_type||110==x.ui_type){P=!1;n&&(P=!0),c="<crux-"+E+"-component cx-prop-highlight-url='true' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(x))+'\' cx-Prop-MaxCharacter ="295" lyte-unbound = '+P+' class="canvasCruxComponent '+_+' " cx-Prop-Empty-Value="-" ',!i&&this.isAjaxEditableField(e)&&(c+=" onmouseover=\"{{action('handleMouseActions',this)}}\" onmouseout=\"{{action('handleMouseActions',this)}}\""),c+=" cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(r?x:x.$.toJSON()))+"' cx-prop-value='"+m+"' ></crux-"+E+"-component>"}else{if(c="<crux-"+E+"-component data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(x))+"' "+("user"===E?"cx-prop-show-bus-card='true'":"")+' class="canvasCruxComponent '+_+' " cx-Prop-Empty-Value="-" ',33==x.ui_type)c+="cx-prop-module ='"+y+"' cx-prop-entity-name ='"+(a?a.Full_Name:"{{record.Full_Name}}")+"' cx-prop-entity-id ='"+p+"'";"user"===E&&(c+="cx-prop-is-business-card='true'"),"Events"===y&&"Event_Title"===x.api_name&&11==x.ui_type&&(c+='style="cursor: pointer;"'),!i&&this.isAjaxEditableField(e)&&(c+=" onmouseover=\"{{action('handleMouseActions',this)}}\" onmouseout=\"{{action('handleMouseActions',this)}}\""),!n&&o&&"Activities"===o.relatedListModule&&"Activity_Type"===x.api_name&&(m="{{meetingLiteral(record)}}"),c+=" cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(r?x:x.$.toJSON()))+"' cx-prop-value='"+m+"' ></crux-"+E+"-component>",o&&("Activities"===o.relatedListModule||"Tasks"===o.relatedListModule)&&"Subject"===x.api_name&&a&&a.$in_project_sync&&(c+='<span style="margin-left: 2px;margin-bottom: 2px;" class="task_syncIcon vam"></span>'),o&&"Activities"===o.relatedListModule&&"Subject"===x.api_name&&(c+=Lyte.Component.registeredHelpers.getColorCodeForEvents(n,a))}}}}else c='<crm-detail-view-subform cx-Prop-Empty-Value="-"  subform=\''+JSON.stringify(x.section[0].$.toJSON())+"' subform_api='"+x.section[0].api_name+"' record='"+u+"'  module='"+t+"'></crm-detail-view-subform>";return c&&o&&"Events"===o.relatedListModule&&"Event_Title"===x.api_name&&(c+=Lyte.Component.registeredHelpers.getColorCodeForEvents(n,a)),c},getImageUploadComponentData:function(e,t,a,i,o,n){var r;void 0===o&&(o=[]);var l="id",s="zcanvas-editor-outer";"canvas"===Lyte.Router.getRouteInstance().routeName&&(l="class",s="zc-page-component-outer");var d="{{getImageExsistingData(record."+a.api_name+")}}";return t&&Array.isArray(t[a.api_name])&&(d=t[a.api_name],d=JSON.stringify(d),a&&a.module&&a.module[0]&&a.module[0].module_name&&(i=a.module[0].module_name)),r='<div class="uitype_556 imageUploadDetailPage canvasCruxComponent"><div class="zcImageUpload imageDetailWrap"  id = \'value_'+a.column_name+"'><div class='imageUploadHead' id='Crm_"+i+"_"+a.column_name+"'><crm-image-upload-detail from-print-preview='true'  class=' canvasCruxComponentEdit fieldupdate_"+a.column_name+" '  zcflag empty-value='-' component-rendering-element='"+s+"' component-rendering-type = '"+l+"' is-detail-page='false' api-name ='"+a.api_name+"' data-zcqa ='"+e.getZcqa(a)+"'  existing-data='"+d+"' id = 'Image_"+a.id+"' fieldid = '"+a.id+"' entity-id='"+n+"'' module='"+i+"' column-name ='"+a.column_name+"' readonly='"+a.read_only+"' allowed-size='"+a.length+"' parent-feature='' cx-prop-field ='"+JSON.stringify(a.$.toJSON())+"'></crm-image-upload-detail></div></div></div>",r=t?r.replace("zcflag","lyte-rendered zcflag"):r.replace("zcflag","")},getZcqa:function(e,t,a){return t?"relatedList_"+a+"_"+(t.connectedModName?t.connectedModName:t.relatedListModule):e.custom_field?"value_"+e.display_label:"value_"+e.column_name},isRelListLookupFld:function(e,t){return!!(Customization.displayFieldMap[e]&&Customization.displayFieldMap[e].indexOf(t)>=0)||(e.indexOf("CustomModule")>-1||e.indexOf("LinkingModule")>-1)&&"Name"===t},editProcessing:function(e,t,a){var i=e;this.handledeletion(i);var o=Lyte.Router.getRouteInstance().parent.currentModel;if("field"==i._type||"link"==i._type||"single-field"==i._type||"label"==i._type||"button"==i._type||"action"==i._type||"system"==i._type){if("action"===i._type&&!t[e.id]&&e.id.indexOf("Canvas_Custom")<0&&e.id.indexOf("moreRL")<0&&e.id.indexOf("add")<0&&e.id.indexOf("new")<0&&e.id.indexOf("logCall")<0&&e.id.indexOf("LookupRel")<0&&e.id.indexOf("dissociate")<0&&e.id.indexOf("associate")<0&&e.id.indexOf("edit")<0&&e.id.indexOf("import")<0){var n=Lyte.Router.getRouteInstance().currentModel.module,r=new CrmDetailViewHandler(n,null,null,i.id,null);i.zcvalue=r.getDummyButton(i.id,i.id),i.value=r.getDummyButton(i.id,i.id),i.label=i.id,i.labelupdate=!0,i.fieldContainer="#zcanvas_menu"}if("link"===i._type)if(!store.peekRecord("custom_link",e.id))return null;if("button"===i._type){var l=Lyte.registeredMixins["crm-detailcanvas-utils"];if(!(store.peekRecord("custom_button",e.id)||l.staticButtons&&l.staticButtons.indexOf(e.id)>-1))return null}if("picklist"===(i=$.extend({},i,t[e.id])).zctype&&Lyte.registeredMixins["crm-detailcanvas-utils"].removePicklistprops(i,a),a&&"row"==a._type)i.table=!0;else{var s=t[e.id]?$(t[e.id].fieldContainer).data("zcanvasMenu"):null;s&&s.reduceScope(i)}i.zcanvasId=zutils.getRandomId(),i.dataHolder=!0}if("view"!==i._type&&"component"!==i._type||"Static Text"===i.theme||"Static Icon"===i.theme||"Line"===i.theme||"Canvas Button"===i.theme||"Canvas Image"===i.theme||"MERGEFIELD"===i.theme){if("relatedlist"==i._type){if(i.components=i.children,i.children.filter((function(e){Lyte.registeredMixins["crm-detailcanvas-utils"].handledeletion(e)})),i.children=[],(a.children&&a.children.filter((function(e){return"stage_navigator"===e.id}))).length>0&&("Potentials"===o.module||"Deals"===o.module))for(var d=a.children.filter((function(e){return"relatedlist"!=e._type})),c=d[0].children.length,u=0;u<c;u++)d[0].children[u].ui.value.class.indexOf("zc_disabled")>-1&&(o.renameStage?d[0].children[u].ui.value.value=I18n.getMsg("crm.label.cf.blueprint"):d[0].children[u].ui.value.value=I18n.getMsg("Stage"))}else if("static_content"==i._type&&(i._type="component",i.theme="Custom Layout",a)){var p=a.children.filter((function(e){return"relatedlist"===e._type}));if(p&&p[0])for(var m=(t[p[0].id]||{}).label||"",f=i.children.length,v=0;v<f;v++){m&&"Static Text"==i.children[v].theme&&i.children[v].ui&&i.children[v].ui.value&&i.children[v].ui.value.class&&i.children[v].ui.value.class.indexOf("zc_disabled")>-1&&(i.children[v].ui.value.value=m);var h=store.peekRecord("related_list",p[0].id),g=[],y=o?o.module:h.module.api_name,b=new CrmDetailViewHandler(y,null,p[0].id);if(b){var _=b.getCanvasActions();_.length&&(g=_)}var x=h&&h.actions&&h.actions.length?h.actions.concat(g):g;i.children[v]&&"Static Text"!==i.children[v].theme&&i.children[v].ui&&i.children[v].ui.value&&i.children[v].ui.value.class&&i.children[v].ui.value.class.indexOf("zccbutton")>-1&&!x.length&&(i.children.splice(v,1),v--,f=i.children.length)}}}else{if(!i.ui||(i.ui.value.class?i.ui.value.class:i.ui.value.class=[]),i.ui&&i.ui.value&&i.ui.value.name){var z=$("#zcanvas_menu").data("zcdatamap");i.tabrelatedlistid&&z[i.tabrelatedlistid]&&(i.ui.value.name=z[i.tabrelatedlistid].label),i.tabrelatedlistid&&"stage_navigator"==i.tabrelatedlistid&&(o.renameStage?i.ui.value.name=I18n.getMsg("crm.label.cf.blueprint"):i.ui.value.name=I18n.getMsg("Stage"))}"Tab Layout"!=i.theme&&("string"==typeof i.ui.value.class?i.ui.value.class+=" zcanvas-editor":i.ui.value.class.push("zcanvas-editor")),i._type="component"}var R=i.children.length,L=[];for(v=0;v<R;v++){i.children[v].id||(i.children[v].id=e.id),a&&a.sectionId&&(i.tempSectionId=a.sectionId);var C=this.editProcessing(i.children[v],t,i);C&&L.push(C)}if(i.children=L,a&&a.tempSectionId){var w=$("#zcanvas_menu").data("zcdatamap"),S="",I=a.tempSectionId;if(I&&I.indexOf("_")>-1){var M=I.substring(0,I.indexOf("_")),A=store.peekRecord("layout",M);if(A&&A.sections){var k=A.sections.filterBy({id:I});k&&k.length&&(I=k[0].uid)}}for(var P in w)if(w.hasOwnProperty(P)&&w[P].sectionid&&w[P].sectionid===I){S=w[P].zclabel;break}i.ui.value.value=S}return i},editPreProcess:function(e,t,a){return new Promise(function(i){var o=e.children||[],n=$("#zcanvas_menu").data("zcdatamap"),r=o.length,l=[],s=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0],d=Lyte.Router.getRouteInstance().transition.info.dynamicParams[1],c=document.querySelector("crm-detailview-oldeditor");"clone"!==Lyte.Router.getRouteInstance().routeName&&"create"!==Lyte.Router.getRouteInstance().routeName||!e||"view"!==e._type||this.traversingComponents(e),e&&"view"===e._type&&this.checkdeletedRule(e.ui.canvas_rules);for(var u=0;u<r;u++){var p=o[u]._type,m=o[u].children;if(("component"===p&&"Custom Layout"===o[u].theme&&m.length<=0||"view"===p)&&(o[u].postLoad=!0,l.push(this.fetchViewData(o[u].id,t))),"clone"!==Lyte.Router.getRouteInstance().routeName&&"create"!==Lyte.Router.getRouteInstance().routeName||"relatedlist"!==p||(o.relatedList=!0),"Tab Layout"===a&&(m=1===m.length?m[0].children:m,o[u].tabrelatedlistid||"Tab Layout"!==e.theme||this.editPreProcess(o[u],t,a)),"component"===p&&"Custom Layout"===o[u].theme){var f=m.map((function(e){return e._type}));if(f.indexOf("relatedlist")>=0){if(("clone"===Lyte.Router.getRouteInstance().routeName||"create"===Lyte.Router.getRouteInstance().routeName)&&(o[u].relatedList=!0,t!==s))continue;var v,h=f.indexOf("relatedlist"),g=m[h].id,y=m[h].personalityName,b=!0;v=!(V=store.peekRecord("related_list",g))||!!V.visible;var _=!1;if(!V&&y){_=!0;var x=store.peekAll("related_list").filterBy({personality_name:y}).filter((function(e){return e}));x.length?m[h].id=x[0].id:(o[u].hidden=!0,m[h].exception=!0)}if(V&&"multiselectlookup"===V.type){var z=V.connectedmodule;b=!(!moduleRecordMapping[z]||!moduleRecordMapping[z].viewable),v=!!v&&moduleRecordMapping[z].visible}if("LazyLoad Component"===m[h].theme||_||m[h].subformid||!(this.staticComponents.indexOf(g)<0)||V&&b&&v)if(m[h].subformid){var R=m[h].subformid,L=store.peekRecord("field",R);if(!L){o.splice(u,1),u--,r=o.length;continue}for(var C=store.peekRecord("layout",Lyte.Router.getRouteInstance().parent.getDynamicParam()).sections.filterBy({isSubformSection:!0}),w=C.length,S=!!L.subform,I=0;I<w;I++)C[I].fields.filterBy({api_name:L.api_name}).length>0&&C[I].fields.filterBy({visible:!0}).length<2&&(o[u].hidden=!0,o[u].errorMsg=I18n.getMsg("crm.canvas.component.permission.denied"),m[h].exception=!0),C[I].fields.filterBy({api_name:L.api_name}).length>0&&(S=!1);if(S){o.splice(u,1),u--,r=o.length;continue}}else this.staticComponents.indexOf(g)>-1&&!V&&(n.hasOwnProperty(g)||(o[u].hidden=!0,o[u].errorMsg=I18n.getMsg("crm.canvas.component.permission.denied"),m[h].exception=!0));else o[u].hidden=!0,o[u].errorMsg=I18n.getMsg("crm.canvas.component.permission.denied"),m[h].exception=!0;Crm.isActivitySplitDone&&V&&("Activities"===V.api_name||"Activities_History"===V.api_name)&&(o[u].hidden=!0,o[u].errorMsg=I18n.getMsg("crm.canvas.component.permission.denied"),m[h].exception=!0),V&&("INVITEDEVENTSPERSONALITY"===V.personality_name&&!Crm.userDetails.permissions.Crm_Implied_View_Events||"CONTACTSROLESPERSONALITY"===V.personality_name&&!Crm.userDetails.permissions.Crm_Implied_View_Contacts)&&(o[u].hidden=!0,o[u].errorMsg=I18n.getMsg("crm.canvas.component.permission.denied"),m[h].exception=!0);var M=this.getModuleNameFromRelatedlistId(g),A=moduleApiMapping[M];this.RequestingcanvasruleinBuilder(A),"relatedlist"===m[h]._type&&m[h].ui.canvas_rules&&this.checkdeletedRule(m[h].ui.canvas_rules)}else f.indexOf("component")>=0&&this.editPreProcess(o[u],t,void 0)}if("LazyLoad Component"===o[u].theme&&!n[o[u].id]){var k=d;if(k){var P=store.peekRecord("layout",k);if(P){var D=P.sections.filterBy({id:o[u].id}),O=o[u].id;if(D&&D.length){var E=D[0].fields,T=this.sectionfieldmapping(E),F=E.map((function(e){return e.id})),N=this.processRelListObj(T,c.getData("record"),c.getData("module"),F);n&&(n[O]||(n[O]={}),n[O].template=N,n[O].label=D[0].display_label)}}}}if("Tab Layout"==o[u].theme){(a=a||{}).skipRelLists=!0;for(var j=m,q=j.length,H=0;H<q;H++){var B=j[H];if(B.tabrelatedlistid){g=B.tabrelatedlistid;var V=store.peekRecord("related_list",g);B.ui&&B.ui.value&&V&&(B.ui.value.name=V.display_label)}else B.ui.value.disabled&&!B.ui.value.class.includes("zc-tab-all-fields")&&(j.splice(H,1),H--,q=j.length)}}if("Tab Layout"==o[u].theme&&o[u].children&&o[u].children.length>0){for(var U=o[u].children.length,J=!1,W=0;W<U;W++)o[u].children[W].children.length>0&&(J=!0);J?l.push(this.editPreProcess(o[u],t,"Tab Layout")):l.push(this.editPreProcess(o[u],t,a))}else if("static_content"==p)o[u]._type="component",o[u].theme="Custom Layout";else if("field"==p){var X=o[u].id;o[u].customField&&(X=o[u].id.replace("_profileimage",""));var Y=store.peekRecord("field",X);if(("clone"===Lyte.Router.getRouteInstance().routeName||"create"===Lyte.Router.getRouteInstance().routeName)&&t!==s)continue;if(!Y){o.splice(u,1),u--,r=o.length;continue}}else if("action"===p&&"data_enrichment"===o[u].id){var Z=Lyte.Router.getRouteInstance("crm.settings.section.modules.module.canvas").currentModel;if(Z&&Z.components&&Z.components.action){var G=Z.components.action,Q=G.length;if(Q){for(var K=[],ee=0;ee<Q;ee++)"Enrich data"===G[ee].label&&(K=G[ee]);if(K&&K.hidden){o.splice(u,1),u--,r=o.length;continue}}}}}var te=l.length;te?Promise.all(l).then((function(t){r=o.length;for(var a=0;a<r;a++)for(var n=0;n<te;n++)(t[n].id&&o[a].id&&t[n].id==o[a].id||t[n].componentid&&o[a].componentid&&t[n].componentid==o[a].componentid)&&(o[a].children=t[n].children);i(e)})):(e.children=o,i(e))}.bind(this))},editPostProcess:function(e){var t=e,a=$("#zcanvas-editor-outer"),i=a.data("zcanvas"),o=this.editProcessing(t,$("#zcanvas_menu").data("zcdatamap")).children;if(i.addElement(o,null),i.config.toolsRef.config.theme.currenttheme=zutils.decompresstheme(t.ui.theme),i.config.toolsRef.compiletheme(),a.zccss(t.ui.value.style||{}),t.ui.value&&t.ui.value.position&&t.ui.value.position.width&&(a.css({width:t.ui.value.position.width}),a.parent().css({width:t.ui.value.position.width}),t.ui.value.fixed)){a.attr("fixed","true");var n=document.querySelector(".fitToScreenEditor");n&&n.setData("ltPropChecked",!1)}a.addClass(t.ui.value.class).zaddClass(t.ui.value.class),a.removeClass("zcanvas-editor").zremoveClass("zcanvas-editor");for(var r=a.find("[zcflag]"),l=r.length,s=0;s<l;s++){var d=r.eq(s),c=d.removeAttr("lyte-rendered zcflag").outerHTML(),u=d.parent();d.remove(),u.append(c)}i.resetheight(),$.ui.droppable.prototype._rearrangescopes&&$.ui.droppable.prototype._rearrangescopes("default")},processRelListObj:function(e,t,a,i,o,n,r){var l=n?n.id:null,s=null;if(l){var d=store.peekRecord("related_list",l),c=d.module.id;s=store.peekRecord("module",c).module_name}var u=null;d&&d.connectedmodule&&(u=this.getConnectedModuleApiName(d.api_name)),"clone"!==Lyte.Router.getRouteInstance().routeName&&"create"!==Lyte.Router.getRouteInstance().routeName||(t=void 0===t?{}:t);for(var p=e.children||[],m=p.length,f=0;f<m;f++){var v=p[f]._type;if("dummyDiv"!==v){var h={};if("field"===v){var g;if(p[f].id?g=p[f].id:i&&(g=i.shift()),!g)return e;if(p[f].customField&&(g=p[f].id.replace("_profileimage","")),!(h=store.peekRecord("field",g))){p.splice(f,1),f--,m=p.length;continue}var y={relatedListModule:s,connectedModName:u};if(p[f].customField){g=p[f].id;var b=h.module&&h.module[0]?h.module[0].module_name:null,_=new CrmDetailViewHandler(b,t,p[f].id,p[f].datatype,p[f],void 0,void 0,!0,y);p[f].value=_.getHTML(),p[f].label=$ESAPI.encoder().encodeForHTMLAttribute(h.field_label+" "+I18n.getMsg("crm.label.image"))}else{var x=!!["create","edit","clone"].includes(Lyte.Router.getRouteInstance().routeName),z=Lyte.registeredMixins["crm-detailview-canvas-utils"];!!z&&z.getmetadata().fromDVGallery&&(x=!0);var R=this.constructCruxComponentForCanvas(g,a,x?t:null,!0,r?void 0:y,x);if(x?p[f].value=null==R?" N/A ":R:(p[f].value=null==R?" - ":R,p[f].ui&&p[f].ui.value&&(p[f].ui.value.class||(p[f].ui.value.class=""),p[f].ui.value.class+=" canvasselectablefield canvas-element-apiname-"+h.api_name)),p[f].label=$ESAPI.encoder().encodeForHTMLAttribute(h.field_label),null===l&&h){var L=h.tooltip,C="";L&&"Info Icon"===L.name&&(C=x?'<span class="icon_roundinfo mL5 vam"></span>':'<span data-zcqa="zc_ajxFld_'+h.id+'" id="zc_ajax_info_icon_'+h.id+'" lt-prop-title="'+$ESAPI.encoder().encodeForHTMLAttribute(L.value)+'" lt-prop-tooltip-config={"position":"top"} class="icon_roundinfo mL5 cP vam"></span>'),p[f].label+=C}}p[f].id=g,p[f].zcvalue=p[f].value,p[f].zclabel=p[f].label,p[f].zcqaval=h.field_label,p[f].zcanvasId=o&&p[f].zcanvasId?p[f].zcanvasId:zutils.getRandomId(),p[f].dataHolder=!0,p[f].connectedModName=u,"picklist"===h.data_type&&this.removePicklistprops(p[f],e)}else"component"==v&&(p[f].zcanvasId=o&&p[f].zcanvasId?p[f].zcanvasId:zutils.getRandomId());if(p[f].zctype=h.data_type||v,("text-area"==p[f].zctype||"textarea"==p[f].zctype)&&p[f].ui.value&&"string"==typeof p[f].ui.value.class)if(p[f].ui.value.class.indexOf("zctextarea")>-1){var w=p[f].ui.value.class.split(" ");w=$u.uniq(w),p[f].ui.value.class=w.join(" ")}else p[f].ui.value.class+=" zctextarea";this.processRelListObj(p[f],t,a,i,o,n||u,r)}else this.processRelListObj(p[f],t,a,i,o,n,r)}return e},relatedListDataProcessing:function(e,t,a){e.data=new Promise(function(i){var o=e.action.url_params,n=o[0],r=o[1],l=o[2];this.fetchRelatedListData(n,r,l,{per_page:3,page:1}).then(function(r){var s=store.peekRecord("related_list",l),d=d=moduleRecordMapping[n].id,c=[],u=r.relRecords?r.relRecords:[],p=s.connectedmodule,m=null;if(p&&(m=this.getConnectedModuleApiName(s.api_name)),d=s.module?s.module.id:moduleRecordMapping[n].id,m&&u){var f=moduleRecordMapping[p].id,v=store.peekRecord("module",f),h=s.module.id,g=store.peekRecord("module",h);this.populateRelatedListFields(v,c,!1,n)}if("Contact_Roles"===s.api_name){g=store.peekRecord("module",d);var y=Object.assign({},g),b=r.contactRoleFields;y.related_list_properties.fields=b,this.populateRelatedListFields(y,c,!0,n);u=r.relRecords?r.relRecords:[]}else if("Invited_Events"===s.api_name){g=store.peekRecord("module",d),y=Object.assign({},g);var _=store.peekAll("field"),x=_.filter((function(e){if(e.module&&"Events"===e.module[0].api_name&&"Event_Title"===e.api_name)return!0}));x=(x=x.concat(_.filter((function(e){if(e.module&&"Events"===e.module[0].api_name&&"Owner"===e.api_name)return!0})))).concat(_.filter((function(e){if(e.module&&"Activities"===e.module[0].api_name&&("Status"===e.api_name||"Start_DateTime"===e.api_name||"End_DateTime"===e.api_name))return!0}))),y.related_list_properties.fields=[],y.related_list_properties.fields=x,this.populateRelatedListFields(y,c,!0);u=r.relRecords?r.relRecords:[]}else{g=store.peekRecord("module",d);this.populateRelatedListFields(g,c,!1,n);u=r.relRecords?r.relRecords:[]}var z={views:JSON.parse('{"zcanvasId":"zcanvas_kwe17n9t9y","_type":"component","ui":{"value":{"class": "zcanvas-non-delete","style":{},"position":{"startX":202,"startY":23,"endX":556,"width":334,"height":144,"minTop":12,"minLeft":20}}},"theme":"Custom Layout","children":[{"zcanvasId":"zcanvas_uerdv4zib8","datatype":"text","_type":"field","ui":{"field":{"style":{"default":{"font-family":"b","color":"rgb(44, 123, 208)","font-size":"16px"}},"class":"zcanvasuppercase"},"value":{"style":{"default":{"font-family":"b"}},"position":{"endX":232,"width":"auto","startY":13,"startX":17,"height":19},"class":"zcanvas-field zc-rl-field zc-ta-left"}},"children":[]},{"zcanvasId":"zcanvas_gndu7jzpvi7","datatype":"picklist","_type":"field","ui":{"field":{"style":{"default":{"margin-left":"8px","font-size":"15px"}},"class":""},"holder":{"style":{},"class":""},"label":{"style":{"default":{"font-size":"15px"}},"class":""},"value":{"style":{"default":{"font-size":"15px"}},"position":{"endX":164,"width":"auto","startY":47,"startX":17,"height":17},"class":"zcanvas-field zc-rl-field zc-ta-left"}},"children":[]},{"zcanvasId":"zcanvas_at8sqvr78hp","datatype":"date-time","_type":"field","ui":{"field":{"style":{"default":{"margin-left":"8px","font-size":"15px"}},"class":""},"holder":{"style":{},"class":""},"label":{"style":{"default":{"font-size":"15px"}},"class":""},"value":{"style":{"default":{"font-size":"15px"}},"position":{"endX":91,"width":"auto","startY":75,"startX":17,"height":17},"class":"zcanvas-field zc-rl-field zc-ta-left"}},"children":[]},{"zcanvasId":"zcanvas_ri64ydjvkp","datatype":"date-time","_type":"field","ui":{"field":{"style":{"default":{"margin-left":"8px","font-size":"15px"}},"class":""},"holder":{"style":{},"class":""},"label":{"style":{"default":{"font-size":"15px"}},"class":""},"value":{"style":{"default":{"font-size":"15px"}},"position":{"endX":169,"width":"auto","startY":103,"startX":17,"height":17},"class":"zcanvas-field zc-rl-field zc-ta-left"}},"children":[]}]}')},R={relatedListModule:g.module_name,connectedModName:m};"Invited_Events"==e.api_name&&(R.connectedModName=e);var L=this.getRelListCompJson(z.views,u,n,c,R,!0),C=JSON.parse('{"zcanvasId":"zcanvas_kwe17n9t9y","_type":"component","ui":{"value":{"class": "zcanvas-non-delete","style":{},"position":{"startX":202,"startY":23,"endX":556,"width":334,"height":160,"minTop":12,"minLeft":20}}},"theme":"Custom Layout","children":[{"zcanvasId":"zcanvas_ihop2mp7tka","datatype":"text","_type":"field","ui":{"field":{"style":{"default":{"font-family":"b","color":"rgb(44, 123, 208)","font-size":"16px"}},"class":"zcanvasuppercase"},"value":{"style":{},"position":{"endX":254,"width":222,"startY":15,"startX":32,"height":19},"class":"zcanvas-field zc-rl-field"}},"children":[]},{"zcanvasId":"zcanvas_t9kh0gvcl2","datatype":"picklist","_type":"field","ui":{"field":{"style":{"default":{"font-size":"15px","margin-top":"5px","font-family":"r"}},"class":""},"holder":{"style":{"default":{"flex-direction":"column"}},"class":""},"label":{"style":{"default":{"color":"rgba(153, 153, 150, 1)","font-size":"15px"}},"class":""},"value":{"style":{},"position":{"endX":206,"width":174,"startY":50,"startX":32,"height":38},"class":"zcanvas-field zc-rl-field"}},"children":[]},{"zcanvasId":"zcanvas_oxz2kjyw1e","datatype":"lookup","_type":"field","ui":{"field":{"style":{"default":{"font-size":"15px","margin-top":"5px","font-family":"m"}},"class":""},"holder":{"style":{"default":{"flex-direction":"column"}},"class":""},"label":{"style":{"default":{"color":"rgba(153, 153, 150, 1)","font-size":"15px"}},"class":""},"value":{"style":{},"position":{"endX":444,"width":217,"startY":51,"startX":227,"height":38},"class":"zcanvas-field zc-rl-field"}},"children":[]},{"zcanvasId":"zcanvas_qbil6k0yaak","datatype":"text","_type":"field","ui":{"field":{"style":{"default":{"font-size":"15px","margin-top":"5px","font-family":"b"}},"class":""},"holder":{"style":{"default":{"flex-direction":"column"}},"class":""},"label":{"style":{"default":{"color":"rgba(153, 153, 150, 1)","font-size":"15px"}},"class":""},"value":{"style":{},"position":{"endX":206,"width":173,"startY":105,"startX":33,"height":38},"class":"zcanvas-field zc-rl-field"}},"children":[]},{"zcanvasId":"zcanvas_8ymk18stptf","datatype":"date","_type":"field","ui":{"field":{"style":{"default":{"font-size":"15px","margin-top":"5px","font-family":"b"}},"class":""},"holder":{"style":{"default":{"flex-direction":"column"}},"class":""},"label":{"style":{"default":{"color":"rgba(153, 153, 150, 1)","font-size":"15px"}},"class":""},"value":{"style":{},"position":{"endX":443,"width":216,"startY":105,"startX":227,"height":38},"class":"zcanvas-field zc-rl-field"}},"children":[]}]}'),w=this.getRelListCompJson(C,u,n,c,R),S=store.peekRecord("related_list",e.id),I=store.peekRecord("module",moduleRecordMapping[n].id).layouts[0].id,M=o[1],A=store.peekRecord(moduleRecordMapping[n].id,M),k=A?JSON.stringify(A.$.toJSON()):JSON.stringify([]),P="<crm-related-list-view-header layout-id='"+I+"' record='"+$ESAPI.encoder().encodeForHTMLAttribute(k)+"' entity-id='"+M+"' module='"+o[0]+"' related-list='"+JSON.stringify(S.$.toJSON())+"'></crm-related-list-view-header>";if(Crm.isActivitySplitDone&&("Activities"==e.api_name||"Activities_History"==e.api_name)){var D="Activities"===e.api_name?"openActivities":"closedActivities",O="Activities"===e.api_name?"activity_split_wrapper":"activity_history_split_wrapper";P='<crm-activity-rel-customize btn_name="'+D+'" related_list_id ="'+e.id+'"layout_id="'+I+'" canvas="true" entity_id="'+M+'" rel_module="'+n+'" parent_relation_name="'+e.api_name+'"></crm-activity-rel-customize> <div id='+O+'> <crm-activity-rel-wrapper layout_id="'+I+'"related_list_id ="'+e.id+'" canvas="true" entity_id=\''+M+"' rel_module='"+n+"' parent_relation_name='"+e.api_name+"'></crm-activity-rel-wrapper> </div> <div id=\""+e.api_name+'_split_no_data_div" width="100%" cellspacing="0" cellpadding="0" class="norec pR30 italic fontsmooth noDataFountDetailtxt dN">'+I18n.getMsg("crm.new.label.no.records")+"</div>"}var E={"Template 1":{data:L.compJson,template:L.compHtml},Table:{data:{},template:P,noneditable:!0},"Template 3":{data:w.compJson,template:w.compHtml}};if(t){var T=this.getRelListCompJson(t,u,n,c,R);E["Designed Component"]={data:T.compJson,template:T.compHtml,noneditable:"Table Layout"==t.theme,userdefined:!0}}a&&(a._data={data:objectUtils.cloneObject_new(T?T.compJson:L.compJson),template:T?T.compHtml:L.compHtml,menu:{data:T?T.fieldsCompArray:L.fieldsCompArray},actions:this.getRelListActions(s),rellistdata:u,module:n,gallery:E}),i({data:objectUtils.cloneObject_new(T?T.compJson:L.compJson),template:T?T.compHtml:L.compHtml,menu:{data:T?T.fieldsCompArray:L.fieldsCompArray},actions:this.getRelListActions(s),rellistdata:u,module:n,gallery:E})}.bind(this))}.bind(this))},populateRelatedListFields:function(e,t,a,i){t=t||[];for(var o=e.related_list_properties.fields,n=o.length,r=e.module_name,l=e.related_list_properties.fields.filter((function(e){return"Full_Name"===e.api_name})),s=0;s<n;s++){var d=store.peekRecord("field",o[s].id);!d||"Role"!==d.api_name||"Potentials"!==i&&"Deals"!==i||(d.view_type.view=!0);var c=!1;if("Contacts"===e.api_name&&!l.length&&d&&"Last_Name"===d.api_name&&(c=!0),d&&d.view_type.view||c){var u=o[s].api_name;Customization.displayFieldMap&&Customization.displayFieldMap[r]&&Customization.displayFieldMap[r].indexOf(u)>=0?t.unshift(o[s].id):t.push(o[s].id)}}if(a)return t;if(e.fields)var p=e.fields.sort((function(e,t){return e.display_label<t.display_label?-1:e.display_label>t.display_label?1:0}));var m=p.length;for(s=0;s<m;s++)("Activities"!=e.api_name&&"Tasks"!=e.api_name&&"Events"!=e.api_name&&"Calls"!=e.api_name||"Tag"!=p[s].api_name&&"Recurring_Activity"!=p[s].api_name&&"Send_Notification_Email"!=p[s].api_name&&"Remind_At"!=p[s].api_name&&"Reminder"!=p[s].api_name&&"Remind_Participants"!=p[s].api_name&&"Latitude"!=p[s].api_name&&"Longitude"!=p[s].api_name&&"Scheduled_In_CRM"!=p[s].api_name&&"BEST_TIME"!=p[s].api_name)&&("Quotes"!=e.api_name&&"Sales_Orders"!=e.api_name&&"Purchase_Orders"!=e.api_name&&"Invoices"!=e.api_name||"Product_Details"!==p[s].api_name)&&("Price_Books"!=e.api_name||"Pricing_Details"!==p[s].api_name)&&("Appointments__s"!=e.api_name&&"Open_Appointments__s"!==e.api_name&&"Appointments_History__s"!==e.api_name||"Appointment_End_Time"!==p[s].api_name&&"Remind_At"!==p[s].api_name&&"Rescheduled_From"!==p[s].api_name)&&t.indexOf(p[s].id)<0&&p[s].view_type.view&&t.push(p[s].id);return t},getConnectedModuleApiName:function(e){return store.peekAll("field").filterBy({data_type:"multiselectlookup"}).filter((function(t){return t.multiselectlookup.api_name===e}))[0].multiselectlookup.connectedlookup_apiname},getRelListCompJson:function(e,t,a,i,o){for(var n={},r=[],l=i.length,s=[],d=0;d<l;d++){var c=i[d],u=store.peekRecord("field",c);if(u&&u.view_type.view)if(!u||"Role"!==u.api_name||"Potentials"!==a&&"Deals"!==a||(u.view_type.view=!0),!(u.column_name.indexOf("MXN")>=0||u.module&&u.module[0]&&2==u.module[0].visibility&&"picklisttracker"!==u.module[0].generated_type&&"field_tracker"!==u.module[0].generated_type)){var p=t[0]?t[0]:{},m=this.constructCruxComponentForCanvas(c,a,p,!0,o,!0);m=null==m?" N/A ":m;var f=this.getCruxName(u.ui_type,u.data_type);"profileimage"==u.data_type&&(f="profileimage");var v=u.field_label;u.module&&u.module[0]&&"Activities"===u.module[0].plural_label&&"Tag"===u.field_label?v=u.field_label+"("+u.sub_module.api_name+")":s.indexOf(v)<0?s.push(v):v=u.field_label+"("+u.module[0].plural_label+")";var h={apiname:u.api_name,datatype:f,_type:"field",label:$ESAPI.encoder().encodeForHTMLAttribute(v),id:u.id,value:m,zcqaval:v},g={module:a,record:p};this.componentPreProcess_subField(g,u,r,h,"fromRL",o),r.push(h)}}return n.fieldsCompArray=r,n.compHtml=this.getRelListHtml(e,t,a,i,n,!(!e.meta||!e.meta.zcf)||null,o.connectedModName),n},getRelListActions:function(e){for(var t=e?e.actions:void 0,a=[],i=t?t.length:0,o=0;o<i;o++){var n={datatype:"button",id:t[o]["data-cid"],label:t[o].label,hideLabel:!0,_type:"action",formationclass:"zccrlaction"};n.value='<lyte-button onclick ={{action("executeRelatedListAction")}} data-relid="'+e.id+'" lt-prop-appearance="default-success" lt-prop-disable="false"><template is="registerYield" yield-name="text">'+t[o].label+"</template></lyte-button>",a.push(n)}if(i>1){var r={datatype:"button",id:"moreRLActions"+e.id,label:"More Actions",hideLabel:!0,_type:"action",formationclass:"zccrlaction"};r.value='<crm-more-component data-zcqa="relatedList_MoreButton_'+e.module.api_name+'" type="relatedList" include-array="[]" exclude-array="[]"></crm-more-component>',a.push(r)}return a},getRelListButton:function(e,t,a){var i=t.id,o=[];e&&e.actions&&(o=e.actions);var n=new CrmDetailViewHandler(a,null,e.id);if(n){var r=n.getCanvasActions();r.length&&(o=objectUtils.cloneObject_new(o.concat(r)))}if(0===i.indexOf("moreRLActions")){var l,s=o,d=t.includedActions;return(l=e.module?e.module.api_name:e.api_name)||(l=e.id),t.label="canvas_moreoptions_"+l,"<crm-more-component id='id_"+e.id+"' module ='"+l+"' data-zcqa=\"relatedList_MoreButton_"+l+'" type="relatedList" rel-list-id=\''+e.id+"' include-array='"+JSON.stringify(s).replace(/'/g,"\\")+"' exclude-array='"+JSON.stringify(d).replace(/'/g,"\\")+"'></crm-more-component>"}for(var c=o||[],u=c.length,p=0;p<u;p++)if(c[p]["data-cid"]==i){t.label=c[p].label;var m=!1,f=Lyte.Router.getRouteInstance().currentModel.record;return!f||"Activities"===e.api_name&&"Tasks"===e.api_name&&"Events"===e.api_name&&"Calls"===e.api_name||"rejected"!==f.$review&&"Review in Progress"!==f.$review&&"Pending for Review"!==f.$review&&"Pending for ReReview"!==f.$review||(t.ui.value.class=t.ui.value.class.concat(" eventNone"),m=!0),"Edit All"===c[p].label?'<lyte-button lt-prop-disabled="'+m+'" onclick ={{action("executeRelatedListAction",\''+c[p]["data-cid"]+"','"+e.id+"')}} data-relid=\""+e.id+'" id="zcDetail_Edit_'+e.id+'" data-zcqa="'+c[p].data_zcqa+'" lt-prop-appearance="default-success"><template is="registerYield" yield-name="text">'+c[p].label+"</template></lyte-button>":'<lyte-button lt-prop-disabled="'+m+'" onclick ={{action("executeRelatedListAction",\''+c[p]["data-cid"]+"','"+e.id+"')}} data-relid=\""+e.id+'" id="zcDetail_'+c[p].label+"_"+e.id+'" data-zcqa="'+c[p].data_zcqa+'" lt-prop-appearance="default-success"><template is="registerYield" yield-name="text">'+c[p].label+"</template></lyte-button>"}},fetchActionsForStaticRel:function(e,t){var a=e.id,i=store.peekRecord("related_list",a),o=i&&i.actions||[],n=[],r=this,l=new CrmDetailViewHandler(t,null,a);if(l){var s=l.getCanvasActions();s.length&&(o=objectUtils.cloneObject_new(o.concat(s)))}if(o&&o.forEach((function(e){var t={id:e["data-cid"],label:e.label,hideLabel:!0,_type:"action",formationclass:"zccrlaction",value:r.getButtonHTMLForStaticRel(e["data-cid"],a,e.label)};n.push(t)})),n.length>1){var d={datatype:"button",id:"moreRLActions"+e.id,label:"More Actions",hideLabel:!0,_type:"action",formationclass:"zccrlaction",value:"<crm-more-component type='relatedList' include-array='[]' exclude-array='[]'></crm-more-component>"};n.push(d)}e.actions=n},getButtonHTMLForStaticRel:function(e,t,a){return'<lyte-button onclick ={{action("executeRelatedListAction",\''+e+"','"+t+"')}} data-relid=\""+t+'"  lt-prop-appearance="default-success" lt-prop-disable="false"><template is="registerYield" yield-name="text">'+a+"</template></lyte-button>"},getRelListHtml:function(e,t,a,i,o,n,r){var l="",s=t.length>=3?3:t.length;s=s<=0?1:s;for(var d=$L("crm-detailview-canvas-gallery")[0],c=$L("crm-detailview-oldeditor")[0],u=0;u<s;u++){var p=t[u]?t[u]:{},m=i?i.slice():null,f=this.processRelListObj(e,p,a,m,n,r);o&&null==o.compJson&&(o.compJson=JSON.parse(JSON.stringify(f)));var v=objectUtils.cloneObject_new(f);if(v._type="component",!d||d&&d.component.getData("skipHtmlConstruct")||c&&c.component.getData("showObjPreview")){var h=canvasOutput.html(void 0,v,!0);l+=(h.length?h[0]:h).outerHTML}}return(l='<div class="zc-replaceclass zc-rl-outcontainer">'+l+"</div>")||(l="<div class='zcnorecord'>No records found</div>"),l},getEditDeleteIconsHtml:function(){return'<crm-edit-delete-icons record={{record}} module="{{module}}" from-module="{{relatedModule}}"></crm-edit-delete-icons>'},registerComponent:function(e,t,a,i,o,n){if(Customization.dropCache&&Lyte.Component.unregisterComponent(t),!Lyte.Component.registeredComponents[t]){var r=$(e);n&&n.children&&n.children[1]&&("stage_navigator"===n.children[1].id||"blueprint"===n.children[1].id)?r.addClass('{{showOrHideStageAndBp(record.id, module, "'+n.hidetab+'","'+n.children[1].id+'")}}'):n&&n.hidden&&!n.isSplit?(r.addClass("zcanvas_contd_hidden"),n.hidetab&&r.addClass("zcanvas_tab_hidden")):r.removeClass("zcanvas_contd_hidden zcanvas_tab_hidden"),n&&n.hidden&&n.isSplit&&r.addClass("pointerEveNone"),o&&n&&n.label&&r.attr("data-zcqa",n.label);var l=r.outerHTML();l="<template tag-name='"+t+"'>"+l+"</template>";var s=document.createElement("div");s.innerHTML=l,LyteComponent.lyteComponentsDiv.append(s.firstElementChild),this.registerCanvasComp(t,o),this.canvasIDvsCompMapping(t)}},registerCanvasComp:function(e,t){Lyte.Component.register(e,{data:function(){return{module:Lyte.attr("string"),record:Lyte.attr("object"),rellistId:Lyte.attr("string"),records:Lyte.attr("object"),entityDetails:Lyte.attr("object"),layoutId:Lyte.attr("string"),lazyload:Lyte.attr("boolean"),isLoading:Lyte.attr("boolean",{default:!1}),displayField:Lyte.attr("object",{default:crmConstants.moduleDisplayField}),fromRecord:Lyte.attr("object"),mainmodulerule:Lyte.attr("string"),relatedmodulerule:Lyte.attr("string"),canvas_rules:Lyte.attr("array",{default:[]}),actualheight:Lyte.attr("string")}},parentRuleObserver:function(){$(this.$node).addClass(this.data.relatedmodulerule)}.observes("mainmodulerule"),loadingstatechange:function(e){e&&!e.newValue&&($L(this.$node).removeClass("zcanvas_not_rendered").removeAttr("style"),this.handleHeightDrop())}.observes("isLoading"),handleHeightDrop:function(){var e=this.$node.firstElementChild.offsetHeight,t=parseInt(this.getData("actualheight"));if(t&&t/2.5>e){var a=Lyte.registeredMixins["crm-detailcanvas-utils"];a.runListLoading&&a.runListLoading(),a._trackAjax("fromHandleHeightDrop")}},didConnect:function(){var e=$L(this.$node);Lyte.registeredMixins["crm-detailcanvas-utils"].executingLayoutRule();for(var a,i,o=[],n=[],r=this.data.canvas_rules.length,l=[],s=0;s<r;s++)if((a=store.peekRecord("canvas_rule",this.data.canvas_rules[s].id))&&(!a||"inactive"!==a.status))if(this.data.rellistId&&moduleApiMapping[Lyte.registeredMixins["crm-detailcanvas-utils"].getModuleNameFromRelatedlistId(this.data.rellistId)]===moduleApiMapping[this.data.module]){if(i=this.data.record,"multiselectlookup"===(p=store.peekRecord("related_list",this.data.rellistId)).type){var d=Lyte.registeredMixins["crm-detailcanvas-utils"].getConnectedModuleApiName(p.api_name),c=this.data.record[d];i=store.peekRecord(moduleRecordMapping[c.module].id,c.id)}(u=Lyte.registeredMixins["crm-create-mixin"].checkCriteriaMatchForCanvas(a.criteria,i,Lyte.registeredMixins["crm-create-mixin"]))?o.push(a.zcid):n.push(a.zcid)}else{i=moduleApiMapping[this.data.module]!==a.module.api_name?this.data.record:this.data.fromRecord;var u,p=store.peekRecord("related_list",this.data.rellistId);if(moduleApiMapping[this.data.module]!==a.module.api_name&&p&&"multiselectlookup"===p.type){d=Lyte.registeredMixins["crm-detailcanvas-utils"].getConnectedModuleApiName(p.api_name),c=this.data.record[d];i=store.peekRecord(moduleRecordMapping[c.module].id,c.id)}(u=Lyte.registeredMixins["crm-create-mixin"].checkCriteriaMatchForCanvas(a.criteria,i,Lyte.registeredMixins["crm-create-mixin"]))&&moduleApiMapping[this.data.module]!==a.module.api_name?o.push(a.zcid):n.push(a.zcid),u&&moduleApiMapping[this.data.module]===a.module.api_name&&l.push(a.zcid)}e.addClass(o.join(" ")).removeClass(n.join(" ")),this.setData("relatedmodulerule",o.join(" "));var m=$("crm-detailview-canvas");m.addClass(l.join(" ")),Lyte.registeredMixins["crm-detailcanvas-utils"].expandcombinedcriteria(e),Lyte.registeredMixins["crm-detailcanvas-utils"].expandcombinedcriteria(m);var f=$("template.zcanvas_not_rendered[component-name="+this.$node.tagName.toLowerCase()+"]");e.find("button").each(function(e,t){var a=$L(t).parents(".zcanvas-field:not(.zc-propagated)");if(a.length){a.click(this.propagateclick).addClass("zc-propagated zcpImp");var i=a.find("crm-more-component");if(i.length){var o=zutils.getRandomId();a.addClass(o),i[0].setData("menuorigin","."+o),"true"==i[0].getData("disabled")&&("relatedList"===i[0].getData("type")?a.addClass("zcanvas-tool-disable"):a.addClass("zcanvas-morebtn-disable"))}var n=a.find("button[disabled]");if(n.length){var r=I18n.getMsg("crm.canvas.button.action.unavailable");a.attr({onmouseover:"newshowtt('"+r+"')",onmouseout:"newhidett()"}),a.addClass("canvaslockedaction")}var l=a[0].querySelectorAll("lyte-button")[0].getAttribute("lt-prop-type");n.length&&l&&l.length&&"removeButton"===l&&$L(a).addClass("dNImp")}}.bind(this)),e.find("crm-stage-history").each((function(){var e=$(this);e.length&&e.is(":visible")&&e[0].component.setWidthForStagesParent()})),t||(e.removeClass("zcanvas_not_rendered"),e.removeAttr("style"),f.removeClass("zcanvas_not_rendered"),f.removeAttr("style")),$L.fastdom.measure(function(){Lyte.registeredMixins["crm-detailcanvas-utils"].tabrefresh($(this.$node))}.bind(this)),$L.fastdom.measure(function(){Lyte.registeredMixins["crm-detailcanvas-utils"].tabrefresh($(this.$node))}.bind(this))},propagateclick:function(e){var t=$L(e.target),a=t.closest("button"),i=a.closest("crm-more-component");if(!a.length&&!t.hasClass("cscript-canvas-disable-np")){var o=t.not("button").closest(".zcanvas-field").find("button:not([disabled])");if(i=o.closest("crm-more-component"),o.click(),i.length)return!0}if(e.stopPropagation(),i.length)return!1},showEditIcon:function(){var e=this.getData("record"),t=Lyte.Router.getRouteInstance().currentModel,a="Deals"===this.getData("module")?"Potentials":this.getData("module");return!!store.peekRecord("module",moduleRecordMapping[a].id).editable&&("crm.settings.section.modules.module.canvas.create"!==Lyte.Router.getRouteInstance().transition.info.route&&((!e||"Review in Progress"!==e.$review&&"Pending for Review"!==e.$review&&"Pending for ReReview"!==e.$review)&&(!(e.$stop_processing||!e.$editable)&&(!!Crm.userDetails.permissions["Crm_Implied_Edit_"+a]&&((!e||"read_only"!==e.$sharing_permission)&&!(t&&t.entityDetails&&t.entityDetails.editActionRestricted))))))},handleMouseActions:function(e,t){var a=this.showEditIcon(),i=null,o=Lyte.registeredMixins["crm-detailcanvas-utils"],n=this.getData("record");if(e&&e.classList.contains("zcanvas-holder")){var r=e.parentElement;i=r.classList.contains("zcanvas-table-row-field")?r:null;var l=e.querySelector(".zcanvas-value-container").children;l[0]&&(e=l[0])}else e&&e.classList.contains("zcanvas-value-container")&&(e=e.children[0]);if(a){if(e.classList.contains("uitype_556"))return void($(e).find("crm-image-upload-detail")[0].component.data.cxPropField.read_only||this.throwEvent("mouseActions",e,t.type,i,!1));if(e.component&&e.component.getData("cxPropField")&&e.component.getData("cxPropField").id){var s=store.peekRecord("field",e.component.getData("cxPropField").id),d=$("crm-detailview-canvas")[0].component.data.layoutId;if("Stage"!==s.api_name&&s[d]&&s[d].pick_list_values&&s[d].pick_list_values[0].maps.length>0)return;if(!s.read_only||"Closing_Date"!==s.api_name&&"Reporting_To"!==s.api_name){if("Contacts"===this.getData("module")&&"Reporting_To"===s.api_name&&!this.getData("record").Account_Name)return}else this.throwEvent("mouseActions",e,t.type,i,!0);if(this.getData("record")&&this.getData("record").$approved||!this.getData("record").$approved&&"Owner"===s.api_name||"approval_process_rejected"===this.getData("record").$approval_state)return"Layout"===s.api_name&&"Rejected"===this.getData("record").$review?void $(e).addClass("zc_cursor_nodrop"):("Layout"===s.api_name&&(c=o.layoutEditPermissionCheck(this.getData("module"),this.getData("record"))),"Layout"===s.api_name&&!c||-1!==o.visitFldColumn.indexOf(s.column_name)||o.blueprintFldId&&o.blueprintFldId===s.id||s.read_only||"Expected_Revenue"===s.api_name||"Handler"===s.api_name||"Layout"===s.api_name&&this.getData("record").$process_flow||"ownerlookup"===s.data_type&&"read_write"===n.$sharing_permission||"ownerlookup"===s.data_type&&!Crm.userDetails.permissions["Crm_Implied_Change_Owner_"+this.getData("module")]?void this.throwEvent("mouseActions",e,t.type,i,!0):void this.throwEvent("mouseActions",e,t.type,i,!1))}}else if(e.component&&e.component.getData("cxPropField")&&e.component.getData("cxPropField").id){var c;s=store.peekRecord("field",e.component.getData("cxPropField").id),d=$("crm-detailview-canvas")[0].component.data.layoutId;if("Layout"===s.api_name&&(c=o.layoutEditPermissionCheck(this.getData("module"),this.getData("record"))),"Layout"===s.api_name&&!c||-1!==o.visitFldColumn.indexOf(s.column_name)||o.blueprintFldId&&o.blueprintFldId===s.id||s.read_only||"Expected_Revenue"===s.api_name||"Handler"===s.api_name||"Layout"===s.api_name&&this.getData("record").$process_flow||"ownerlookup"===s.data_type&&!Crm.userDetails.permissions["Crm_Implied_Change_Owner_"+this.getData("module")])return void this.throwEvent("mouseActions",e,t.type,i,!0);if("ownerlookup"===s.data_type){if(n.$stop_processing)return;if("read_only"===n.$sharing_permission)return void this.throwEvent("mouseActions",e,t.type,i,!0);if(Crm.userDetails.permissions["Crm_Implied_Change_Owner_"+this.getData("module")])return void this.throwEvent("mouseActions",e,t.type,i,!1)}}},actions:{customActiondispatcher:function(e,t,a){"click"===t.type&&CScriptLib&&CScript.dispatchEvent("onClick",a)},customEventHandler:function(e){if("canvas_button_group"===e){var t=event.target;if(t.classList.contains("zcanvas-inner-component")&&(t=t.parentElement),t){var a=t.querySelector("lyte-dropdown");a&&a.open&&a.open()}}},throwEventToModuleRoute:function(e,t,a,i,o,n){"canvas_button_group"===o&&(o=n);var r=this.getData("record");if(r=store.peekRecord(moduleRecordMapping[this.getData("module")].id,r.id),["customButton","deleteEntity","follow","inviteClientPortal"].indexOf(e)>=0){if("customButton"===e)return CustomButtonJSObjectInit.execute(o,"viewEntity",a,"",t);if("deleteEntity"===e){if(!Crm.userDetails.permissions["Crm_Implied_Delete_"+t])return void Lyte.registeredMixins["crm-detailcanvas-utils"].showPermissionErrorMsgPopup();var l=this.getData("entityDetails");Lyte.registeredMixins["crm-detailcanvas-utils"].deleteEntity(t,a,r,l)}else if("follow"===e)r.$.triggerAction("follow",{type:r.$followed?"DELETE":"PUT"}).then((function(){r.$.set("$followed",!r.$followed),$L("crm-detailview-canvas")[0].component.setData("record",objectUtils.cloneObject(r)),r.$.save().then((function(){Lyte.triggerEvent("followersList",{record:r,entityId:a,module:t})}))}));else if("inviteClientPortal"===e){var s=$L("#clientPortalPrefButton"),d={top:s.offset().top+s.outerHeight()+"px",left:s.offset().left+"px"};$L("#portalUsrPreferenceDD").css(d).show()}}else Lyte.registeredMixins["crm-detail-view-utils"].executeActionButton(e,t,a,i,r,n)},refreshingrelatedlist:function(e,t){(t=$L(document.querySelectorAll("#"+t))).removeClass("ref_complete").addClass("ref_loading pointerEveNone"),Lyte.triggerEvent("relatedList",{id:e,refreshTemplate:!0})},handleMouseActions:function(e,t){this.handleMouseActions(e,t)},handleeditButton:function(){var e=document.querySelector("crm-detailview-canvas");e&&e.component.handleeditButtonMethod.bind(e.component)()},moreEvent:function(e,t){var a=this.getData("module"),i=this.getData("record"),o=this.getData("record").id;i=store.peekRecord(moduleRecordMapping[a].id,o);var n=moduleRecordMapping[a].singular_label;if(["send_mail","mail_merge","add_related_list","share","folow","print_preview","exportpdf","cliq","slack","cisco","sendDM"].indexOf(e)>=0){var r=e.replace(/_(.)/g,(function(e,t){return t.toUpperCase()}));Lyte.registeredMixins["crm-detail-view-utils"].executeActionButton(r,a,o,n,i,event)}else if(["edit","convert","findandmerge","clone"].indexOf(e)>=0){Lyte.Router.transitionTo({route:{edit:"crm.tab.module.entity.edit",convert:"crm.tab.module.entity.convert",findandmerge:"crm.tab.module.entity.find-and-merge",clone:"crm.tab.module.entity.clone"}[e],dynamicParams:[a,o]})}else if("scheduleonlinemeeting"===e)detailView.scheduleOnlineMeeting();else if("meetnow"===e)detailView.startCrmMeeting();else if("follow"===e)this.actions.throwEventToModuleRoute.call(this,"follow");else if("delete"===e){if(!Crm.userDetails.permissions.hasOwnProperty("Crm_Implied_Delete_"+a))return void Lyte.registeredMixins["crm-detailcanvas-utils"].showPermissionErrorMsgPopup();var l=this.getData("entityDetails");Lyte.registeredMixins["crm-detailcanvas-utils"].deleteEntity(a,o,i,l)}else if("reviewHistory"===e)a=moduleRecordMapping[a].api_name,detailView.showHistory(this,a,o);else if("inviteClientPortal"===e){var s=(l=this.getData("entityDetails")).clientPortal?l.clientPortal:{};s.sendClientInvitation?CPMF.getClientPortalProfilesRelatedToPersonalityModule(a,o,"invite"):s.sendClientReInvitation&&CPMF.getClientPortalProfilesRelatedToPersonalityModule(a,o,"reinvite",s.userTypeId)}return!1},executeRelatedListAction:function(e,t){var a=this.getData("record"),i=this.getData("module");if(e&&e.indexOf("Canvas_Custom")>-1){var o=new CrmDetailViewHandler(i,null,t);if(o){var n=o.getCanvasActions().filter((function(t){return t["data-cid"]===e}));if(n&&n.length){var r=n[0];if("component"===r.customactiontype){var l=this.$node;if(l&&l.querySelector&&r.actionprop){var s=l.querySelector(r.actionprop.component);s&&s.component&&s.component[r.actionprop.method]&&s.component[r.actionprop.method].bind(s.component)()}}}}}!Crm.canvasScroll&&e.indexOf("new")>-1&&(Crm.canvasScroll=this.$node.id);var d=store.peekRecord("related_list",t);return Lyte.registeredMixins["crm-detail-view-utils"].executeRelatedListActions(e,d,i,a,event),!1},onAttachMenuClose:function(e){this.setData("attachLinkMenuOpen",!1),$L("#attachLinks_"+e,this.$node)[0].classList.add("vH")},attachLinksOpen:function(){this.setData("attachLinkMenuOpen",!0)},invitedEventsDrop:function(e,t){switch(e){case"edit":Crm.editEntity(event,void 0,{module:"Events",id:t.id,reqFrom:"detailView",from:"relatedlist_new"}),event.preventDefault();break;case"delete":Lyte.registeredMixins["crm-detail-view-utils"].recordDeletePopup(t,2,"Events");break;case"disassociate":$L("crm-detailview-footer")[0].component.removeParticipant(this.getData("fromRecord")[crmConstants.moduleDisplayField[this.getData("module")][0]],t,this.data.fromRecord)}},showHideRelatedFields:function(e,t,a){if(this.throwEvent("mouseActions",a.target),"mouseout"==a.type)return crmui.hideTooltip(),!0;if(!(a&&a.target&&a.target.classList.contains("cscript-canvas-maskedfield"))){var i=this.getData("record"),o=store.peekRecord("field",t),n=o.api_name;if(i[n]){var r={},l=$(a.target);r.module=o.lookup.module.api_name,i[n]&&(r.id=i[n].id,store.peekAll("module").forEach((function(e){e.api_name==r.module&&(r.module=e.module_name)})),crmLookupBusinessCard.showingSide="showOnRight",renderingUtils.windowWidth/2<l.offset().left&&(crmLookupBusinessCard.showingSide="showOnLeft"),l.offset().left<400&&l[0].getBoundingClientRect().right>renderingUtils.windowWidth-400&&(crmLookupBusinessCard.showingSide="showOnBottom"),r&&r.module&&r.id&&setTimeout((function(){l.is(":hover")&&crmLookupBusinessCard.getRecordJSon(r.module,r.id,l)}),950))}}}},methods:{throwEventToRoute:function(e,t){var a=t||{};this.throwEvent("throwEventToRoute",e,a)},showNoteCnt:function(e){var t=e.$node.getAttribute("relid"),a=e.data.allNotesCount,i=$("#RL_dataCount_"+t);if(a){$(i.eq(0)).text(a),i.css({cursor:"auto",padding:" 2px 5px",color:"#14161D",display:"inline-block","text-align":"center","font-size":"1.2rem","margin-left":"8px",background:"#D2E2FE","border-radius":"7px","min- width":"12px","line-height":"normal",height:"auto"})}else i.hide()},updateTimelinebasedOnNotes:function(){Lyte.triggerEvent("NotesTimeline")},checkingDisabledorNot:function(e){return!e||!e.$converted},recordImagemenu:function(e,t){if(store.peekRecord("field",t).read_only)return!1;var a=this.getData("record");if(!a.$approved||!a.$editable||"Review in Progress"===a.$review||"Pending for ReReview"===a.$review||"Pending for Review"===a.$review)return!1;var i=Lyte.registeredMixins["crm-detailcanvas-utils"];if(a.$zia_visions&&a.$zia_visions.length>0&&i.fieldInvolvedInZia(a,t))return!1;var o=$L("#img_"+e),n=o[0].getAttribute("data-fileid"),r=o[0].getAttribute("src"),l=ResourceConstants.CRM;return""!=n&&null!=n&&"null"!=n||""!=r&&null!=r&&"null"!=r&&r!=networkUtils.getImageUrl("companylogonew_437ab19_.svg",l)&&r!=networkUtils.getImageUrl("user_profile_d6908a7_.svg",l)&&r!=networkUtils.getImageUrl("image_pholder_bb67c93_.svg",l)&&r!=networkUtils.getImageUrl("nophoto_80ea3af_.png",l)&&r!=networkUtils.getImageUrl("image_profile_canvas_1d7b1e9_.svg",l)&&r!=networkUtils.getImageUrl("image_error_c634220_.svg",l)},onMenuClick:function(e,t,a){a.component.setData("ltPropShow",!1)}},_observedAttributes:["module","record","records","rellistId","entityDetails","layoutId","isLoading","displayField","fromRecord","mainmodulerule","relatedmodulerule","canvas_rules","actualheight"]})},showPermissionErrorMsgPopup:function(){_cruxUtils.showCustomAlert({params:{ltPropPrimaryMessage:I18n.getMsg("crm.delete.error"),ltPropSecondaryMessage:I18n.getMsg("crm.security.error"),ltPropButtons:[{type:"accept",text:I18n.getMsg("crm.button.ok"),appearance:"primary"}],ltPropButtonPosition:"right",ltPropWrapperClass:"crm-canvas-delete-alert"},show:function(e){e.childComp.querySelector(".alertPrimaryMsg").style="color:#E20000"}})},deleteEntity:function(e,t,a,i){if(("Accounts"===e||"Contacts"===e)&&i.zbCustomModuleObj&&i.zbCustomModuleObj.isZBCustomModuleEnabled){var o=[t],n=moduleRecordMapping[e].singular_label;ZInvoice.fetchAssociatedIds(e,o,(function(t){if(t.length>0){var i=[{type:"accept",text:I18n.getMsg("crm.button.ok"),appearance:"default"}],o=I18n.getMsg("crm.cannot.delete.account.contact.header",n),r=I18n.getMsg("crm.cannot.delete.account.contact.singular",n.toLowerCase()),l=$L("#detailViewUtilAlert"),s={ltPropPrimaryMessage:o,ltPropSecondaryMessage:r,ltPropButtons:i,id:"detailViewUtilAlert",ltpropWrapperClass:"dv_Alert",ltPropShowCloseButton:!1};0===l.length?l.push(Lyte.Component.render("lyte-alert",s,"body")):l[0].setData(s),l[0].ltProp("show",!0)}else Lyte.registeredMixins["crm-detail-view-utils"].recordDeletePopup(a,2,e,null,null,null,!0)}))}else{if(Lyte.Router.getRouteInstance().currentModel.entityDetails.showAddForCPUser)return void Lyte.registeredMixins["crm-detailcanvas-utils"].showPermissionErrorMsgPopup();Lyte.registeredMixins["crm-detail-view-utils"].recordDeletePopup(a,2,e,null,null,null,!0)}},handleLoad:function(e,t){if("delete"===e){var a=store.peekRecord("module",moduleRecordMapping[t].id).custom_view.id;Lyte.Router.transitionTo({route:"crm.tab.module.custom-view.list",dynamicParams:[t,a]})}else if("page"===e){["crm-tag","crm-upcoming-actions"].forEach((function(e){$L(e).each((function(e,t){t.component.methods.reloadComponent.call(t.component)}))}))}else"reviewProcess"===e?$L("crm-review-process")[0].component.methods.reviewCallback(t):($L("crm-related-list-canvas").each((function(e,t){t.component.methods.reloadComponent.call(t.component)})),$L("crm-related-list-view-header").each((function(e,t){t.component.fetchRecords()})))},getCruxName:function(e,t){var a=Object.assign({},crmConstants.defaultUiTypeToCruxMapping);Object.assign(a,{20:"user",2:"picklist",556:"image",555:"fileupload",99:"text-area",133:"lookup",444:"multiselectlookup"});var i=a[e]?a[e]:"text";return 20===e&&"autonumber"===t?"number":i},removeRelatedListHeader:function(){$(".relListHeader").addClass("dN")},readymadecomponents:function(e){var t=[],a={datatype:"component",fieldContainer:"#zcanvas_menu",group:"component",data:{}},i={ui:{value:{style:{default:{"border-radius":"0","box-shadow":"none",border:"none","background-color":"rgba(243, 242, 242, 1)"}},position:{startX:0,startY:0,endX:1640,width:"100%",height:38,minTop:37,minLeft:24},tagname:"DIV"}},children:[],_type:"component",theme:"Custom Layout",zcanvasId:"zcanvas_hcw8rjbwfbd"},o={zcanvasId:"zcanvas_4si4xy5gemp",_type:"component",ui:{value:{style:{backgroundColor:"transparent"},position:{startX:10,startY:7,endX:174,width:164,height:27},class:"zc_disabled",value:"Products"}},theme:"Static Text",children:[]},n={zcanvasId:"#zcanvas_us58qoeplr",_type:"component",ui:{value:{position:{startX:0,startY:184,endX:1278,width:"100%",height:480,minTop:5},style:{backgroundColor:"rgb(255, 255, 255)"},class:"zclayout-table",layoutstyle:{row:{height:"50px"},field:{width:"50%"},inner:[{percent:34.80194017784964},{percent:35.12530315278901}]}}},theme:"Table Layout",children:[]},r={_type:"row",ui:{value:{position:{startX:0,startY:5,endX:1259,width:1259,height:50},style:{},class:"zcanvas-row"}},children:[]},l={zcanvasId:"zcanvas_3kga5lwc3z4",datatype:"user",type:"field",_type:"field",ui:{value:{style:{},position:{startX:0,startY:0,endX:625,width:625,height:50},tagname:"DIV",class:"zcanvas-field"},holder:{style:{},tagname:"SPAN",class:""},field:{style:{},tagname:"SPAN",class:""},label:{style:{backgroundColor:"rgb(250, 250, 249)"},tagname:"SPAN",class:""}},fieldContainer:"#zcanvas_menu",group:"fields",children:[]},s=e.components.section,d=s.length,c=objectUtils.cloneObject_new({ui:{value:{style:{},position:{startX:0,startY:0,endX:1640,width:1620,height:943,minTop:37,minLeft:24},tagname:"DIV"}},children:[],_type:"component",theme:"Custom Layout",zcanvasId:"zcanvas_hcw8rjbwfbd"});c.zcanvasId=zutils.getRandomId();for(var u=0,p=function(e){return"profileimage"!=e.datatype},m=function(e){return e.id},f=0;f<d;f++){if((w=s[f].data.filter(p).map(m)).length){var v=objectUtils.cloneObject_new(n);v.zcanvasId=zutils.getRandomId();var h=Math.round(w.length/2),g=objectUtils.cloneObject_new(i);g.zcanvasId=zutils.getRandomId();var y=objectUtils.cloneObject_new(o);y.zcanvasId=zutils.getRandomId(),y.ui.value.value=s[f].label,g.children.push(y),g.ui.value.position.startY=u,u+=50;for(var b=0,_=0;_<h;_++){var x=JSON.parse(JSON.stringify(r)),z=zutils.zcopyobj(l);if(z.zcanvasId=zutils.getRandomId(),x.children.push(z),2*(_+1)<w.length){var R=zutils.zcopyobj(l);z.zcanvasId=zutils.getRandomId(),x.children.push(R)}v.children.push(x),b+=50}v.ui.value.position.height=b,v.ui.value.position.startY=u,u+=b+20;var L=this.processRelListObj(v,e.record,e.module,w);c.children.push(g),c.children.push(L)}}c.ui.value.position.height=u,c.ui.value.class="zc-component-overflow";var C=$u.clone(a);C.data=c,C.label="Details Table",C.id="zc_readymade_detailstable",C.value="";var w=e.components.field.map((function(e){return e.id})),S=(L=this.processRelListObj({zcanvasId:"zcanvas_ux28dwul8jo",_type:"component",ui:{value:{style:{backgroundColor:"rgb(255, 255, 255)",borderBottomWidth:"0px",borderLeftWidth:"0px",borderRightWidth:"0px",borderTopWidth:"0px",borderWidth:"0px",boxShadow:"rgba(0, 0, 0, 0.12) 3px 3px 4px 0px",borderRadius:"5px"},position:{startX:8,startY:7,endX:1284,width:1266,height:150},tagname:"DIV"}},theme:"Custom Layout",children:[{zcanvasId:"zcanvas_7c0dno80y8r",_type:"component",ui:{value:{style:{backgroundColor:"rgb(250, 250, 249)",borderRadius:"5px"},position:{startX:0,startY:0,endX:1265,width:1265,height:73,minTop:5,minLeft:13},tagname:"DIV"}},theme:"Custom Layout",children:[{zcanvasId:"zcanvas_jncifzq1t58",datatype:"profileimage",type:"field",_type:"field",ui:{value:{style:{paddingRight:"0px",width:63,height:58},position:{startX:13,startY:5,endX:78,width:65,height:60},tagname:"DIV",class:"zcanvas-field"},field:{style:{borderRadius:"50%",width:null,height:null},tagname:"DIV"}},fieldContainer:"#zcanvas_menu",group:"fields",children:[]},{zcanvasId:"zcanvas_1a2gm6pnwfe",datatype:"text",type:"field",_type:"field",ui:{value:{style:{},position:{startX:83,startY:7,endX:373,width:290,height:50},tagname:"DIV",class:"zc-ta-left zcanvas-field"},holder:{style:{},tagname:"DIV",class:"zcanvastopLabel "},field:{style:{fontFamily:"b",fontSize:"24px",paddingTop:"6px"},tagname:"DIV"},label:{style:{fontSize:"11px"},tagname:"DIV"}},fieldContainer:"#zcanvas_menu",group:"fields",children:[]}]},{zcanvasId:"zcanvas_5ap6hbrg78l",datatype:"lookup",type:"field",_type:"field",ui:{value:{style:{},position:{startX:22,startY:90,endX:225,width:203,height:41},tagname:"DIV",class:"zcanvas-field"},holder:{style:{},tagname:"DIV",class:"zcanvastopLabel "},field:{style:{fontSize:"17px",paddingTop:"4px",paddingLeft:"0px"},tagname:"DIV"},label:{style:{fontSize:"12px"},tagname:"DIV"}},fieldContainer:"#zcanvas_menu",group:"fields",children:[]},{zcanvasId:"zcanvas_tmxtkol890d",datatype:"number",type:"field",_type:"field",ui:{value:{style:{color:"rgb(17, 17, 17)",backgroundColor:"rgba(0, 0, 0, 0)",fontFamily:"r",fontSize:"15px",fontWeight:"400",textTransform:"none",textDecoration:"none solid rgb(17, 17, 17)",paddingTop:"0px",paddingBottom:"0px",paddingLeft:"0px",paddingRight:"10px",marginTop:"0px",marginLeft:"0px",marginBottom:"0px",marginRight:"0px",borderBottom:"1px solid rgba(0, 0, 0, 0)",borderBottomColor:"rgba(0, 0, 0, 0)",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba(0, 0, 0, 0)",borderLeft:"1px solid rgba(0, 0, 0, 0)",borderLeftColor:"rgba(0, 0, 0, 0)",borderLeftStyle:"solid",borderLeftWidth:"1px",borderRight:"1px solid rgba(0, 0, 0, 0)",borderRightColor:"rgba(0, 0, 0, 0)",borderRightStyle:"solid",borderRightWidth:"1px",borderStyle:"solid",borderTop:"1px solid rgba(0, 0, 0, 0)",borderTopColor:"rgba(0, 0, 0, 0)",borderTopStyle:"solid",borderTopWidth:"1px",borderWidth:"1px",boxShadow:"none",borderRadius:"0px"},position:{startX:258,startY:91,endX:483,width:225,height:41},tagname:"DIV",class:"zcanvas-field"},holder:{style:{color:"rgb(17, 17, 17)",backgroundColor:"rgba(0, 0, 0, 0)",fontFamily:"r",fontSize:"15px",fontWeight:"400",textTransform:"none",textDecoration:"none solid rgb(17, 17, 17)",paddingTop:"0px",paddingBottom:"0px",paddingLeft:"0px",paddingRight:"0px",marginTop:"0px",marginLeft:"0px",marginBottom:"0px",marginRight:"0px",borderBottom:"0px none rgb(17, 17, 17)",borderBottomColor:"rgb(17, 17, 17)",borderBottomStyle:"none",borderBottomWidth:"0px",borderColor:"rgb(17, 17, 17)",borderLeft:"0px none rgb(17, 17, 17)",borderLeftColor:"rgb(17, 17, 17)",borderLeftStyle:"none",borderLeftWidth:"0px",borderRight:"0px none rgb(17, 17, 17)",borderRightColor:"rgb(17, 17, 17)",borderRightStyle:"none",borderRightWidth:"0px",borderStyle:"none",borderTop:"0px none rgb(17, 17, 17)",borderTopColor:"rgb(17, 17, 17)",borderTopStyle:"none",borderTopWidth:"0px",borderWidth:"0px",boxShadow:"none",borderRadius:"0px"},tagname:"DIV",class:"zcanvastopLabel "},field:{style:{color:"rgb(17, 17, 17)",backgroundColor:"rgba(0, 0, 0, 0)",fontFamily:"r",fontSize:"17px",fontWeight:"400",textTransform:"none",textDecoration:"none solid rgb(17, 17, 17)",paddingTop:"4px",paddingBottom:"0px",paddingLeft:"0px",paddingRight:"0px",marginTop:"0px",marginLeft:"0px",marginBottom:"0px",marginRight:"0px",borderBottom:"1px solid rgba(0, 0, 0, 0)",borderBottomColor:"rgba(0, 0, 0, 0)",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba(0, 0, 0, 0)",borderLeft:"1px solid rgba(0, 0, 0, 0)",borderLeftColor:"rgba(0, 0, 0, 0)",borderLeftStyle:"solid",borderLeftWidth:"1px",borderRight:"1px solid rgba(0, 0, 0, 0)",borderRightColor:"rgba(0, 0, 0, 0)",borderRightStyle:"solid",borderRightWidth:"1px",borderStyle:"solid",borderTop:"1px solid rgba(0, 0, 0, 0)",borderTopColor:"rgba(0, 0, 0, 0)",borderTopStyle:"solid",borderTopWidth:"1px",borderWidth:"1px",boxShadow:"none",borderRadius:"0px"},tagname:"DIV"},label:{style:{color:"rgb(140, 133, 133)",backgroundColor:"rgba(0, 0, 0, 0)",fontFamily:"r",fontSize:"12px",fontWeight:"400",textTransform:"none",textDecoration:"none solid rgb(140, 133, 133)",paddingTop:"0px",paddingBottom:"0px",paddingLeft:"0px",paddingRight:"0px",marginTop:"0px",marginLeft:"0px",marginBottom:"0px",marginRight:"0px",borderBottom:"1px solid rgba(0, 0, 0, 0)",borderBottomColor:"rgba(0, 0, 0, 0)",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba(0, 0, 0, 0)",borderLeft:"1px solid rgba(0, 0, 0, 0)",borderLeftColor:"rgba(0, 0, 0, 0)",borderLeftStyle:"solid",borderLeftWidth:"1px",borderRight:"1px solid rgba(0, 0, 0, 0)",borderRightColor:"rgba(0, 0, 0, 0)",borderRightStyle:"solid",borderRightWidth:"1px",borderStyle:"solid",borderTop:"1px solid rgba(0, 0, 0, 0)",borderTopColor:"rgba(0, 0, 0, 0)",borderTopStyle:"solid",borderTopWidth:"1px",borderWidth:"1px",boxShadow:"none",borderRadius:"0px"},tagname:"DIV"}},fieldContainer:"#zcanvas_menu",group:"fields",children:[]},{zcanvasId:"zcanvas_4ydrpnldx7l",datatype:"number",type:"field",_type:"field",ui:{value:{style:{color:"rgb(17, 17, 17)",backgroundColor:"rgba(0, 0, 0, 0)",fontFamily:"r",fontSize:"15px",fontWeight:"400",textTransform:"none",textDecoration:"none solid rgb(17, 17, 17)",paddingTop:"0px",paddingBottom:"0px",paddingLeft:"0px",paddingRight:"10px",marginTop:"0px",marginLeft:"0px",marginBottom:"0px",marginRight:"0px",borderBottom:"1px solid rgba(0, 0, 0, 0)",borderBottomColor:"rgba(0, 0, 0, 0)",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba(0, 0, 0, 0)",borderLeft:"1px solid rgba(0, 0, 0, 0)",borderLeftColor:"rgba(0, 0, 0, 0)",borderLeftStyle:"solid",borderLeftWidth:"1px",borderRight:"1px solid rgba(0, 0, 0, 0)",borderRightColor:"rgba(0, 0, 0, 0)",borderRightStyle:"solid",borderRightWidth:"1px",borderStyle:"solid",borderTop:"1px solid rgba(0, 0, 0, 0)",borderTopColor:"rgba(0, 0, 0, 0)",borderTopStyle:"solid",borderTopWidth:"1px",borderWidth:"1px",boxShadow:"none",borderRadius:"0px"},position:{startX:505,startY:91,endX:684,width:179,height:41},tagname:"DIV",class:"zcanvas-field"},holder:{style:{color:"rgb(17, 17, 17)",backgroundColor:"rgba(0, 0, 0, 0)",fontFamily:"r",fontSize:"15px",fontWeight:"400",textTransform:"none",textDecoration:"none solid rgb(17, 17, 17)",paddingTop:"0px",paddingBottom:"0px",paddingLeft:"0px",paddingRight:"0px",marginTop:"0px",marginLeft:"0px",marginBottom:"0px",marginRight:"0px",borderBottom:"0px none rgb(17, 17, 17)",borderBottomColor:"rgb(17, 17, 17)",borderBottomStyle:"none",borderBottomWidth:"0px",borderColor:"rgb(17, 17, 17)",borderLeft:"0px none rgb(17, 17, 17)",borderLeftColor:"rgb(17, 17, 17)",borderLeftStyle:"none",borderLeftWidth:"0px",borderRight:"0px none rgb(17, 17, 17)",borderRightColor:"rgb(17, 17, 17)",borderRightStyle:"none",borderRightWidth:"0px",borderStyle:"none",borderTop:"0px none rgb(17, 17, 17)",borderTopColor:"rgb(17, 17, 17)",borderTopStyle:"none",borderTopWidth:"0px",borderWidth:"0px",boxShadow:"none",borderRadius:"0px"},tagname:"DIV",class:"zcanvastopLabel "},field:{style:{color:"rgb(17, 17, 17)",backgroundColor:"rgba(0, 0, 0, 0)",fontFamily:"r",fontSize:"17px",fontWeight:"400",textTransform:"none",textDecoration:"none solid rgb(17, 17, 17)",paddingTop:"4px",paddingBottom:"0px",paddingLeft:"0px",paddingRight:"0px",marginTop:"0px",marginLeft:"0px",marginBottom:"0px",marginRight:"0px",borderBottom:"1px solid rgba(0, 0, 0, 0)",borderBottomColor:"rgba(0, 0, 0, 0)",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba(0, 0, 0, 0)",borderLeft:"1px solid rgba(0, 0, 0, 0)",borderLeftColor:"rgba(0, 0, 0, 0)",borderLeftStyle:"solid",borderLeftWidth:"1px",borderRight:"1px solid rgba(0, 0, 0, 0)",borderRightColor:"rgba(0, 0, 0, 0)",borderRightStyle:"solid",borderRightWidth:"1px",borderStyle:"solid",borderTop:"1px solid rgba(0, 0, 0, 0)",borderTopColor:"rgba(0, 0, 0, 0)",borderTopStyle:"solid",borderTopWidth:"1px",borderWidth:"1px",boxShadow:"none",borderRadius:"0px"},tagname:"DIV"},label:{style:{color:"rgb(140, 133, 133)",backgroundColor:"rgba(0, 0, 0, 0)",fontFamily:"r",fontSize:"12px",fontWeight:"400",textTransform:"none",textDecoration:"none solid rgb(140, 133, 133)",paddingTop:"0px",paddingBottom:"0px",paddingLeft:"0px",paddingRight:"0px",marginTop:"0px",marginLeft:"0px",marginBottom:"0px",marginRight:"0px",borderBottom:"1px solid rgba(0, 0, 0, 0)",borderBottomColor:"rgba(0, 0, 0, 0)",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba(0, 0, 0, 0)",borderLeft:"1px solid rgba(0, 0, 0, 0)",borderLeftColor:"rgba(0, 0, 0, 0)",borderLeftStyle:"solid",borderLeftWidth:"1px",borderRight:"1px solid rgba(0, 0, 0, 0)",borderRightColor:"rgba(0, 0, 0, 0)",borderRightStyle:"solid",borderRightWidth:"1px",borderStyle:"solid",borderTop:"1px solid rgba(0, 0, 0, 0)",borderTopColor:"rgba(0, 0, 0, 0)",borderTopStyle:"solid",borderTopWidth:"1px",borderWidth:"1px",boxShadow:"none",borderRadius:"0px"},tagname:"DIV"}},fieldContainer:"#zcanvas_menu",group:"fields",children:[]},{zcanvasId:"zcanvas_hbybyj3x69b",datatype:"text",type:"field",_type:"field",ui:{value:{style:{color:"rgb(17, 17, 17)",backgroundColor:"rgba(0, 0, 0, 0)",fontFamily:"r",fontSize:"15px",fontWeight:"400",textTransform:"none",textDecoration:"none solid rgb(17, 17, 17)",paddingTop:"0px",paddingBottom:"0px",paddingLeft:"0px",paddingRight:"10px",marginTop:"0px",marginLeft:"0px",marginBottom:"0px",marginRight:"0px",borderBottom:"1px solid rgba(0, 0, 0, 0)",borderBottomColor:"rgba(0, 0, 0, 0)",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba(0, 0, 0, 0)",borderLeft:"1px solid rgba(0, 0, 0, 0)",borderLeftColor:"rgba(0, 0, 0, 0)",borderLeftStyle:"solid",borderLeftWidth:"1px",borderRight:"1px solid rgba(0, 0, 0, 0)",borderRightColor:"rgba(0, 0, 0, 0)",borderRightStyle:"solid",borderRightWidth:"1px",borderStyle:"solid",borderTop:"1px solid rgba(0, 0, 0, 0)",borderTopColor:"rgba(0, 0, 0, 0)",borderTopStyle:"solid",borderTopWidth:"1px",borderWidth:"1px",boxShadow:"none",borderRadius:"0px"},position:{startX:713,startY:90,endX:891,width:178,height:41},tagname:"DIV",class:"zcanvas-field"},holder:{style:{color:"rgb(17, 17, 17)",backgroundColor:"rgba(0, 0, 0, 0)",fontFamily:"r",fontSize:"15px",fontWeight:"400",textTransform:"none",textDecoration:"none solid rgb(17, 17, 17)",paddingTop:"0px",paddingBottom:"0px",paddingLeft:"0px",paddingRight:"0px",marginTop:"0px",marginLeft:"0px",marginBottom:"0px",marginRight:"0px",borderBottom:"0px none rgb(17, 17, 17)",borderBottomColor:"rgb(17, 17, 17)",borderBottomStyle:"none",borderBottomWidth:"0px",borderColor:"rgb(17, 17, 17)",borderLeft:"0px none rgb(17, 17, 17)",borderLeftColor:"rgb(17, 17, 17)",borderLeftStyle:"none",borderLeftWidth:"0px",borderRight:"0px none rgb(17, 17, 17)",borderRightColor:"rgb(17, 17, 17)",borderRightStyle:"none",borderRightWidth:"0px",borderStyle:"none",borderTop:"0px none rgb(17, 17, 17)",borderTopColor:"rgb(17, 17, 17)",borderTopStyle:"none",borderTopWidth:"0px",borderWidth:"0px",boxShadow:"none",borderRadius:"0px"},tagname:"DIV",class:"zcanvastopLabel "},field:{style:{color:"rgb(17, 17, 17)",backgroundColor:"rgba(0, 0, 0, 0)",fontFamily:"r",fontSize:"17px",fontWeight:"400",textTransform:"none",textDecoration:"none solid rgb(17, 17, 17)",paddingTop:"4px",paddingBottom:"0px",paddingLeft:"0px",paddingRight:"0px",marginTop:"0px",marginLeft:"0px",marginBottom:"0px",marginRight:"0px",borderBottom:"1px solid rgba(0, 0, 0, 0)",borderBottomColor:"rgba(0, 0, 0, 0)",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba(0, 0, 0, 0)",borderLeft:"1px solid rgba(0, 0, 0, 0)",borderLeftColor:"rgba(0, 0, 0, 0)",borderLeftStyle:"solid",borderLeftWidth:"1px",borderRight:"1px solid rgba(0, 0, 0, 0)",borderRightColor:"rgba(0, 0, 0, 0)",borderRightStyle:"solid",borderRightWidth:"1px",borderStyle:"solid",borderTop:"1px solid rgba(0, 0, 0, 0)",borderTopColor:"rgba(0, 0, 0, 0)",borderTopStyle:"solid",borderTopWidth:"1px",borderWidth:"1px",boxShadow:"none",borderRadius:"0px"},tagname:"DIV"},label:{style:{color:"rgb(140, 133, 133)",backgroundColor:"rgba(0, 0, 0, 0)",fontFamily:"r",fontSize:"12px",fontWeight:"400",textTransform:"none",textDecoration:"none solid rgb(140, 133, 133)",paddingTop:"0px",paddingBottom:"0px",paddingLeft:"0px",paddingRight:"0px",marginTop:"0px",marginLeft:"0px",marginBottom:"0px",marginRight:"0px",borderBottom:"1px solid rgba(0, 0, 0, 0)",borderBottomColor:"rgba(0, 0, 0, 0)",borderBottomStyle:"solid",borderBottomWidth:"1px",borderColor:"rgba(0, 0, 0, 0)",borderLeft:"1px solid rgba(0, 0, 0, 0)",borderLeftColor:"rgba(0, 0, 0, 0)",borderLeftStyle:"solid",borderLeftWidth:"1px",borderRight:"1px solid rgba(0, 0, 0, 0)",borderRightColor:"rgba(0, 0, 0, 0)",borderRightStyle:"solid",borderRightWidth:"1px",borderStyle:"solid",borderTop:"1px solid rgba(0, 0, 0, 0)",borderTopColor:"rgba(0, 0, 0, 0)",borderTopStyle:"solid",borderTopWidth:"1px",borderWidth:"1px",boxShadow:"none",borderRadius:"0px"},tagname:"DIV"}},fieldContainer:"#zcanvas_menu",group:"fields",children:[]}]},e.record,e.module,w),$u.clone(a));S.data=L,S.label="Business Card",S.id="zc_readymade_businesscard",S.value="";var I=$u.clone(a);return I.data={ui:{value:{style:{},position:{startX:3,startY:977,endX:1356,width:1343,height:239},tagname:"DIV",layoutstyle:{default:{"background-color":"transparent",color:"#666","padding-top":"10px","padding-right":"10px","padding-bottom":"10px","padding-left":"10px","border-bottom-width":"3px","border-color":"transparent"},active:{"background-color":"transparent",color:"#1A73E8","border-bottom-width":"3px","border-color":"#1A73E8"},hover:{color:"#333"},container:{backgroundColor:"rgb(255, 255, 255)",marginLeft:"0px"},editor:{}}}},children:[],prefill:!0,theme:"Tab Layout",_type:"component"},I.label="Relatedlists as Tab",I.id="zc_readymade_rl_as_tab",I.value="",t.push(S),t.push(C),t.push(I),t},unregisterCanvasComponents:function(e){var t=store.peekRecord("canvasview",e),a=this.getCanvasComponentsArr(t);a.push(e);for(var i=a.length,o=0;o<i;o++){var n=this.getCompNamefromId(a[o]);Lyte.Component.registeredComponents[n]&&Lyte.Component.unregisterComponent(n)}},getCanvasComponentsArr:function(e){var t=[];return this.populateCanvasComponents(e,t),t},populateCanvasComponents:function(e,t){"component"===e._type&&"Custom Layout"===e.theme&&t.push(e.id),"relatedlist"===e._type&&"Custom Layout"===e.theme&&t.push(e.componentid);for(var a=e.children?e.children.length:0,i=0;i<a;i++)this.populateCanvasComponents(e.children[i],t)},unregisterComponent:function(e){Lyte.Component.registeredComponents[e]&&Lyte.Component.unregisterComponent(e)},registerRelatedModuleModel:function(e){return new Promise((function(t){if(!store.model[moduleRecordMapping[e].id])return app.store.makeRequest("findRecord","module",moduleRecordMapping[e].id,void 0,void 0,!0,{getOnlyMeta:!1,allowMultiple:!0}).then((function(e){t(e)}));t(!0)}))},fetchRelatedModuleRecordsById:function(e,t,a){return new Promise((function(i,o){var n=t?t.join(","):"";""===n&&i([]);var r="/crm/v2.1/"+e.api_name,l={params:{ids:n,approved:"both"}};networkUtils.lyteInitiateRequest(r,"GET",l,!0).then((function(t){for(var o=t.data,n=o.length,r=0;r<n;r++){var l=o[r];l.parentCompRecord=a[l.id],l.parentCompId=a[l.id].id,l.isTemplate=!0,store.pushPayload(moduleRecordMapping[e.module_name].id,l)}i(t)})).catch((function(e){o(e)}))}))},fetchRelatedModuleRecords:function(e,t){var a=this;return new Promise((function(i){return a.registerRelatedModuleModel(e).then((function(){var a=store.peekRecord(moduleRecordMapping[e].id,t);if(!a)return app.store.makeRequest("findRecord",moduleRecordMapping[e].id,t).then((function(e){i(e)}));i(a)}))}))},contextchangehandler:function(e,t){var a=this.main.selectedfields.closest(".zcanvas-static-editor"),i=a.data("zcanvas");i.contextstyles[e.selector]||(i.contextstyles[e.selector]={});var o=objectUtils.cloneObject_new(i.contextstyles),n=zutils.getCompressionMapping("stylekey",e.actionproperty);i.contextstyles[e.selector][n]=zutils.getCompressionMapping("stylevalue",t.style[e.actionproperty]);var r=objectUtils.cloneObject_new(i.contextstyles);a.find("style").remove(),a.append(zcanvasrelatedList.getStyleElement(i.contextstyles,a.attr("id"))),undoredomanager.push({action:"callback",node:"#"+a.attr("id"),previous:o,current:r,callback:function(e,t){var a=$(e.node),i=a.data("zcanvas");a.find("style").remove(),"undo"==t?(a.append(zcanvasrelatedList.getStyleElement(e.previous,a.attr("id"))),i.contextstyles=objectUtils.cloneObject_new(e.previous)):(a.append(zcanvasrelatedList.getStyleElement(e.current,a.attr("id"))),i.contextstyles=objectUtils.cloneObject_new(e.current))}})},contextpopulate:function(e){var t,a=this.main.selectedfields.closest(".zcanvas-static-editor"),i=a.data("zcanvas").contextstyles,o={};i&&i[e.selector]&&i[e.selector][zutils.getCompressionMapping("stylekey",e.actionproperty)]?o[e.actionproperty]=zutils.getReverseCompressionMapping("stylevalue",i[e.selector][zutils.getCompressionMapping("stylekey",e.actionproperty)]):o[e.actionproperty]=a.find(e.selector).css(e.actionproperty),o[e.actionproperty]=o[e.actionproperty]?((t=(t=o[e.actionproperty]).replace("!important","")).indexOf(",")>-1&&t.indexOf("rgb")<=-1&&(t=t.split(",")[0]),t):e.defaultselected,this.main.tools.populate[e.type].bind(this)(e,o)},getcontextsettings:function(e,t,a,i,o,n,r,l,s,d,c){var u="zc_"+a+"_"+a+e.replaceAll(" ","_").replace(/\./g,""),p=u+"bgcontainer",m=u+"bgcolor",f=m+"bgtool",v=u+"bghex",h=u+"bordercontainer",g=u+"bordercolor",y=g+"bordertool",b=u+"borderhex",_=u+"color",x=_+"tool",z=u+"size",R=u+"weight",L=$("<div/>",{class:"zc-tool canvas-tool-container",id:u});i.append(L);var C=$("<div/>",{class:"canvas-tool-name bold uppercase"});l&&C.addClass(l),C.html($ESAPI.encoder().encodeForHTML(e)),L.append(C);var w=$("<div/>",{class:"canvas-context-tool"});L.append(w);var S=$("<div/>",{id:z,class:"sizeselection"}),I=$("<div/>",{id:R,class:"weightselect"}),M=$("<div/>",{id:_}),A=$("<div/>",{id:m}),k=$("<div/>",{id:v,class:"zc_hexinput"}),P=$("<div/>",{id:m+"container",class:"w100p pT10"}).hide();P.append('<div class="canvas-tool-name bold uppercase">'+I18n.getMsg("zc.editor.templbg")+"</div>");var D=$("<div/>",{id:p,class:"zc-bg-fill"});D.append(k),D.append(A),P.append(D);var O=$("<div/>",{id:g}),E=$("<div/>",{id:b,class:"zc_hexinput"}),T=$("<div/>",{id:g+"container",class:"w100p pT10"}).hide();!c&&T.append('<div class="canvas-tool-name bold uppercase">'+I18n.getMsg("zc.editor.border.color")+"</div>");var F=$("<div/>",{id:h,class:"zc-bg-fill"});F.append(E),F.append(O),T.append(F),s&&w.append("<div class='w100p pb10 canvas-tool-name bold uppercase'>"+I18n.getMsg("crm.label.text")+"</div>"),c||w.append(S).append(I).append(M),d&&w.append($("<div/>",{id:u+"_sub",class:"canvas-tool-subcontext pT10 w100p"})),w.append(P).append(T);var N=o;return n&&n.bgcolor&&N.addtool({toolname:m,container:"#"+m,type:"colorpicker",actiontype:"action",actionproperty:"background-color",el:f,selector:r?r("bgcolor"):t,basecontainer:"#"+m+"container",populate:this.contextpopulate,onChange:this.contextchangehandler,sync:"#"+v}),n&&n.bgcolor&&N.addtool({toolname:v,container:"#"+v,type:"hexinput",actiontype:"action",actionproperty:"background-color",selector:r?r("bgcolor"):t,populate:this.contextpopulate,onChange:this.contextchangehandler,sync:"#"+m}),n&&n.bordercolor&&N.addtool({toolname:g,container:"#"+g,type:"colorpicker",actiontype:"action",actionproperty:"border-bottom-color",el:y,selector:r?r("bordercolor"):t,basecontainer:"#"+g+"container",populate:this.contextpopulate,onChange:this.contextchangehandler,sync:"#"+b}),n&&n.bordercolor&&N.addtool({toolname:b,container:"#"+b,type:"hexinput",actiontype:"action",actionproperty:"border-bottom-color",selector:r?r("bordercolor"):t,populate:this.contextpopulate,onChange:this.contextchangehandler,sync:"#"+g,basecontainer:c?"#"+u:null}),(!n||n.fsize)&&N.addtool({toolname:z,container:"#"+z,type:"select",selected:"12",defaultselected:"15px",actiontype:"action",actionproperty:"font-size",extravalue:!0,min:"1",max:"99",actualmin:1,actualmax:99,basecontainer:"#"+u,populate:this.contextpopulate,onChange:this.contextchangehandler,selector:r?r("fsize"):t,list:[{selectvalue:"11",displayvalue:"11",style:{"font-size":"11px"}},{selectvalue:"12",displayvalue:"12",style:{"font-size":"12px"}},{selectvalue:"14",displayvalue:"14",style:{"font-size":"14px"}},{selectvalue:"15",displayvalue:"15",style:{"font-size":"15px"}},{selectvalue:"16",displayvalue:"16",style:{"font-size":"16px"}},{selectvalue:"18",displayvalue:"18",style:{"font-size":"18px"}}]}),(!n||n.color)&&N.addtool({toolname:_,container:"#"+_,type:"colorpicker",actiontype:"action",actionproperty:"color",el:x,selector:r?r("color"):t,populate:this.contextpopulate,onChange:this.contextchangehandler}),(!n||n.fweight)&&N.addtool({toolname:R,container:"#"+R,type:"select",selected:"Regular",actiontype:"action",actionproperty:"font-family",populate:this.contextpopulate,selector:r?r("fweight"):t,defaultselected:"LatoRegular",onChange:this.contextchangehandler,list:[{selectvalue:"Thin",displayvalue:"Thin",style:{"font-family":"LatoThin"}},{selectvalue:"Light",displayvalue:"Light",style:{"font-family":"LatoLight"}},{selectvalue:"Regular",displayvalue:"Regular",style:{"font-family":"LatoRegular"}},{selectvalue:"Medium",displayvalue:"Medium",style:{"font-family":"LatoMedium"}},{selectvalue:"Semi Bold",displayvalue:"Semi Bold",style:{"font-family":"LatoSemibold"}},{selectvalue:"Bold",displayvalue:"Bold",style:{"font-family":"LatoBold"}},{selectvalue:"Extra Bold",displayvalue:"Extra Bold",style:{"font-family":"LatoBlack"}},{selectvalue:"Thin Italic",displayvalue:"Thin Italic",style:{"font-family":"LatoThinItalic"}},{selectvalue:"Light Italic",displayvalue:"Light Italic",style:{"font-family":"LatoLightItalic"}},{selectvalue:"Regular Italic",displayvalue:"Regular Italic",style:{"font-family":"LatoItalic"}},{selectvalue:"Medium Italic",displayvalue:"Medium Italic",style:{"font-family":"LatoMediumItalic"}},{selectvalue:"Semi Bold Italic",displayvalue:"Semi Bold Italic",style:{"font-family":"LatoSemiboldItalic"}},{selectvalue:"Bold Italic",displayvalue:"Bold Italic",style:{"font-family":"LatoBoldItalic"}},{selectvalue:"Extra Bold Italic ",displayvalue:"Extra Bold Italic",style:{"font-family":"LatoBlackItalic"}}]}),!0},createcontextuals:function(e){var t=$("#canvas-context-styles"),a=e.config.contexttools;for(key in a)for(var i=a[key],o=i.length,n=0;n<o;n++)if(this.getcontextsettings(i[n].field,i[n].selector,key,t,e,i[n].requiredtools,i[n].selectorformula,i[n].titleclass,i[n].texttitle,i[n].subtools,i[n].nobasictools),i[n].subtools)for(var r=i[n].subtools.length,l=i[n].subtools,s="zc_"+key+"_"+key+i[n].field.replaceAll(" ","_").replace(/\./g,""),d=$("#"+s+"_sub"),c=0;c<r;c++)this.getcontextsettings(l[c].field,l[c].selector,key,d,e,l[c].requiredtools,l[c].selectorformula,l[c].titleclass)},contextualstyles:function(e,t,a){var i=t.find("crm-related-list-view-header").length;if(("Notes"==e.api_name||"timeline"==e.api_name||i)&&(t.find(".zcanvas-relatedlist-container").addClass("zc-rl-sub-selectable"),$u.isEmpty(e.contextstyles))){if(e.contextstyles={},i)o=a.toolsRef.config.contexttools.Table;else var o=a.toolsRef.config.contexttools[e.api_name];for(var n=o.length,r=0;r<n;r++){e.contextstyles[o[r].selector]={},o[r].selectorformuladefault&&(e.contextstyles[o[r].selectorformuladefault]={});var l=o[r].subtools;if(l)for(var s=l.length,d=0;d<s;d++)e.contextstyles[l[d].selector]={},l[d].selectorformuladefault&&(e.contextstyles[l[d].selectorformuladefault]={})}}},contextselection:function(e,t){var a=this.data.api_name;$(".canvas-tool-typetext").html(this.data.label),!e&&$(this.options.toolsRef.config.toolcommon).hide();var i=this.element.find("crm-related-list-view-header").length;e?t&&(a=t):i?(e=this.options.toolsRef.config.contexttools.Table,a="Table"):e=this.options.toolsRef.config.contexttools[this.data.api_name];for(var o=e.length,n=0;n<o;n++){var r="zc_"+a+"_"+a+e[n].field.replaceAll(" ","_").replace(/\./g,""),l=r+"color",s=r+"size",d=r+"weight",c=r+"bgcolor",u=r+"bghex",p=r+"bordercolor",m=r+"borderhex",f=this.options.toolsRef.availabletools[s],v=this.options.toolsRef.availabletools[l],h=this.options.toolsRef.availabletools[d],g=this.options.toolsRef.availabletools[c],y=this.options.toolsRef.availabletools[u],b=this.options.toolsRef.availabletools[p],_=this.options.toolsRef.availabletools[m],x=this.data.contextstyles[e.selector];if(e[n].requiredtools&&!e[n].requiredtools.fsize||(f.basecontainer&&$(f.basecontainer).show(),f.populate.bind({main:this.options.toolsRef})(f,x)),e[n].requiredtools&&!e[n].requiredtools.color||(v.basecontainer&&$(v.basecontainer).show(),v.populate.bind({main:this.options.toolsRef})(v,x)),e[n].requiredtools&&!e[n].requiredtools.fweight||(h.basecontainer&&$(h.basecontainer).show(),h.populate.bind({main:this.options.toolsRef})(h,x)),e[n].subtools){var z=Lyte.registeredMixins["crm-detailcanvas-utils"];z&&z.contextselection.bind(this)(e[n].subtools,a)}e[n].requiredtools&&e[n].requiredtools.bgcolor&&(g.basecontainer&&$(g.basecontainer).show(),g.populate.bind({main:this.options.toolsRef})(g,x),y.populate.bind({main:this.options.toolsRef})(y,x)),e[n].requiredtools&&e[n].requiredtools.bordercolor&&(b.basecontainer&&$(b.basecontainer).show(),_.basecontainer&&$(_.basecontainer).show(),b.populate.bind({main:this.options.toolsRef})(b,x),_.populate.bind({main:this.options.toolsRef})(_,x))}},preProcessMoreComponent:function(){var e=this.getData("components"),t=this.getData("includedActions"),a=[],i=["morebutton","navigate","back"],o=[];this.getData("record").$approved||(o=["edit","delete","mail_merge","macro","findandmerge"]);var n=[];Crm.calPreferences.MEETINGPREFDETAILS||(n=["meetnow","scheduleonlinemeeting"]);for(var r=e.length,l=0;l<r;l++){var s=e[l];"action"===s.type&&i.indexOf(s.name)<0&&t.indexOf(s.name)<0&&o.indexOf(s.name)<0&&n.indexOf(s.name)<0&&(clientPortalName?["edit","clone","delete","reviewHistory"].includes(s.name)&&a.push({name:s.display_label,label:s.name,data_zcqa:s.data_zcqa}):a.push({name:s.display_label,label:s.name,data_zcqa:s.data_zcqa}))}this.setData("moreActions",a)},getPickListValues:function(e){var t=this.getData("record"),a=this.getData("dependencyMaps"),i=this.getData("childParentDepMap")[e];if(!i)return!1;var o=t[i]?t[i]:"-None-";return a[i][o][e]},isAjaxEditableField:function(e,t,a){var i;Lyte.Router.getRouteInstance().currentModel;if(!t)return!1;if(!(i="string"==typeof e?store.peekRecord("field",e):e))return!1;var o=i.api_name;return!(a&&a.indexOf(i.data_type)>-1)&&("multiselectlookup"!==i.data_type&&"Currency"!==o&&"Probability"!==o&&"Pricing_Model"!==o&&"Wizard"!==o&&"territory_updated_time"!==o&&(-1!==Lyte.registeredMixins["crm-detailcanvas-utils"].visitFldColumn.indexOf(i.column_name)||i.view_type.edit))},constructRPFldsJson:function(e,t){var a={total:0,approved:0,rejected:0},i=t.review.process_fields;if(i&&i.length>0&&"crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route){var o=Lyte.registeredMixins["crm-detailcanvas-utils"],n=o.revlayoutRuleShowFld;i=i.filter((function(e){var t=!0,a=store.peekRecord("field",e.id);return o.revlayoutRuleShowSections.includes(a.section[0].name)&&(t=!1),a.visible&&!n.includes(e.id)&&t}))}for(var r=i.length,l=this.constructReviewProcessFldMap(i),s=this.getData("module"),d=this.getData("record"),c=[],u=[],p=[],m=0;m<r;m++){var f=i[m],v=f.id;if(f.subform_records){if(f.subform_records.length>0){for(var h=f.api_name,g=f.id,y=f.subform_records,b=y.length,_={},x=this.getSubformRecordsMap(d[h]),z=0;z<b;z++)for(var R=y[z],L=R.process_fields,C=L.length,w=R.id,S=x[w],I=0;I<C;I++){var M=L[I],A=M.id,k=store.peekRecord("field",A),P={id:k.id,field_label:k.field_label,sys_name:k.api_name},D=k.id;E=(E=this.constructCruxComponentForCanvas(D,s,S,!0))||"-",P.fieldHtml=E,P.subform={subformApiName:h,subformRecordId:w,subformId:g},P.review_status=M.status,a.total++,"Rejected"===M.status?a.rejected++:"Approved"===M.status&&a.approved++;var O=store.peekRecord("field",P.subform.subformId).display_label;u.indexOf(P.subform.subformApiName)<0&&(u.push(P.subform.subformApiName),_.subform=[],_.subformname=O),_.subform.push(P)}p.push(_)}}else{var E,T=store.peekRecord("field",v),F={id:T.id,field_label:T.field_label,sys_name:T.api_name},$={};if(Crm.moduleInfo.Leads&&($.Leads=Crm.moduleInfo.Leads.translatedSingularLabel+" "+I18n.getMsg("crm.label.NAME")),Crm.moduleInfo.Contacts&&($.Contacts=Crm.moduleInfo.Contacts.translatedSingularLabel+" "+I18n.getMsg("crm.label.NAME")),"Last_Name"==T.api_name){var N=store.peekAll("field").filter((function(e){return e.module&&e.module[0]&&e.module[0].module_name===s&&"Full_Name"===e.api_name}))[0],j=N.id;F.id=j,F.field_label=$[N.module[0].module_name]}E=(E=(h=l[v].subform_apiname)?this.constructCruxComponentForCanvas(v,s,d[h],!0):this.constructCruxComponentForCanvas(F.id,s,d))||"-",F.id=v,F.fieldHtml=E,F.review_status=l[v].status,a.total++,"Rejected"===F.review_status?a.rejected++:"Approved"===F.review_status&&a.approved++,T&&T.tooltip&&"Info Icon"===T.tooltip.name&&(F.field_label+='<span data-zcqa="zc_ajxFld_'+T.id+'" id="zc_ajax_info_icon_'+T.id+'" lt-prop-title="'+$ESAPI.encoder().encodeForHTMLAttribute(T.tooltip.value)+'" lt-prop-tooltip-config={"position":"top"} class="icon_roundinfo mL5 cP vam"></span>'),c.push(F)}}return c=c.concat(p),this.setReviewStatusCount(a),c},getSubformRecordsMap:function(e){for(var t={},a=e?e.length:0,i=0;i<a;i++){var o=e[i];t[o.id]=o}return t},constructReviewProcessFldMap:function(e){var t={};return e.map((function(e){return e.hasOwnProperty("subform_records")||(t[e.id]={api_name:e.api_name,status:e.status}),null})),t},horizontalaligntool:function(e){var t=$(".zcanvas-selected-element,.zcanvas-multiselect");(p={}).startY=$u.min(t.toArray(),(function(e){return e.offsetLeft})).offsetLeft;var a=$u.max(t.toArray(),(function(e){return e.offsetLeft+e.offsetWidth}));p.endY=a.offsetLeft+a.offsetWidth;var i={action:"link",actionarray:[],node:t},o={action:"drag",current:{},previous:{},node:{}};if("zc-va-left"==e)t.each((function(){var e=$(this),a=JSON.parse(JSON.stringify(o));if(a.node=e,-1===$.map(t,(function(e){return $(e).is(".zcanvas-field")})).indexOf(!1)){var n=JSON.parse(JSON.stringify(o));n.node=e,n.action="actionclasslist",n.previous.class=e.attr("data-zcanvasclass")||"",n.previous.class.indexOf("zc-ta")>-1&&(e.removeClass("zc-ta-right zc-ta-center").zremoveClass("zc-ta-right"),e.zremoveClass("zc-ta-center"),n.previous.class=e.attr("data-zcanvasclass")||""),e.addClass("zc-ta-left").zaddClass("zc-ta-left"),n.current.class=n.previous.class+" zc-ta-left",i.actionarray.push(n)}a.previous.left=e.position().left,e.css("left",p.startY),a.current.left=p.startY,i.actionarray.push(a)}));else if("zc-va-center"==e){var n=p.endY-p.startY,r=p.startY+parseInt(n/2),l=-1===$.map(t,(function(e){return $(e).is(".zcanvas-field:not(.zcbdrbox)")})).indexOf(!1);t.each((function(){var t=$(this),a=JSON.parse(JSON.stringify(o));if(a.node=t,a.previous.left=t.position().left,l){var s=JSON.parse(JSON.stringify(o));s.node=t,s.action="actionclasslist",s.previous.class=t.attr("data-zcanvasclass")||"",s.previous.class.indexOf("zc-ta")>-1&&(t.removeClass("zc-ta-left zc-ta-right").zremoveClass("zc-ta-left"),t.zremoveClass("zc-ta-right"),s.previous.class=t.attr("data-zcanvasclass")||""),t.addClass("zc-ta-center").zaddClass("zc-ta-center"),s.current.class=s.previous.class+" zc-ta-center",i.actionarray.push(s),a.previous.width=t.width(),t.css({width:n,left:p.startY}),a.current.width=n,a.current.left=p.startY}else e=r-this.offsetWidth/2,t.css("left",e),a.current.left=e;i.actionarray.push(a)}))}else if("zc-va-right"==e){l=-1===$.map(t,(function(e){return $(e).is(".zcanvas-field")})).indexOf(!1);t.each((function(){var e=$(this),t=JSON.parse(JSON.stringify(o));if(t.node=e,l){var a=JSON.parse(JSON.stringify(o));a.node=e,a.action="actionclasslist",a.previous.class=e.attr("data-zcanvasclass")||"",a.previous.class.indexOf("zc-ta")>-1&&(e.removeClass("zc-ta-left zc-ta-center").zremoveClass("zc-ta-left"),e.zremoveClass("zc-ta-center"),a.previous.class=e.attr("data-zcanvasclass")||""),e.addClass("zc-ta-right").zaddClass("zc-ta-right"),a.current.class=a.previous.class+" zc-ta-right",i.actionarray.push(a)}t.previous.left=e.position().left;var n=this.offsetLeft,r=this.offsetWidth,s=p.endY-(n+r);e.css("left",n+s),t.current.left=n+s,i.actionarray.push(t)}))}else if("zc-va-distribute"==e){var s=$(".zcanvas-selectbox"),d=s.position();d.width=s.outerWidth();var c=$u.sortBy(t,(function(e){return e.offsetLeft})),u=$(c),p={},m=$u.min(u,(function(e){return e.offsetLeft}));p.top=m.offsetLeft+m.offsetWidth;var f=$u.max(u,(function(e){return e.offsetLeft+e.offsetWidth}));p.bottom=f.offsetLeft,p.distance=p.bottom-p.top,canvasObjUtils._.map(u.not(m).not(f).toArray(),(function(e){p.distance=p.distance-$(e).outerWidth()})),p.vdist=p.distance/(u.length-1);var v=p.activetop=m.offsetLeft,h=!0;if(canvasObjUtils._.map(u,(function(e){var t=$(e).outerWidth();!d||!d.left||d.left<=v&&d.left+d.width>=v||(h=!1),v=v+t+p.vdist})),!h)return;canvasObjUtils._.map(u,(function(e){var t=$(e),a=t.outerWidth(),n=JSON.parse(JSON.stringify(o));n.node=t,n.previous.left=t.position().left,n.current.left=p.activetop,t.css("left",p.activetop),i.actionarray.push(n),p.activetop=p.activetop+a+p.vdist}))}if(t.is(".zcanvas-field")){var g=t.parent(".zcanvas-editor").data("zcanvas");g&&g.config.onChange("drag",t)}undoredomanager.push(i)},verticalaligntool:function(e,t){var a=$(".zcanvas-selected-element,.zcanvas-multiselect");(p={}).startY=$u.min(a.toArray(),(function(e){return e.offsetTop})).offsetTop;var i=$u.max(a.toArray(),(function(e){return e.offsetTop+e.offsetHeight}));p.endY=i.offsetTop+i.offsetHeight;var o={action:"link",actionarray:[],node:a},n={action:"drag",current:{},previous:{},node:{}};if("zc-va-top"==e)a.each((function(){var e=$(this),t=JSON.parse(JSON.stringify(n));t.node=e,t.previous.top=e.position().top,e.css("top",p.startY),t.current.top=p.startY,o.actionarray.push(t)}));else if("zc-va-center"==e){var r=p.endY-p.startY,l=p.startY+parseInt(r/2);a.each((function(){var t=$(this),a=JSON.parse(JSON.stringify(n));a.node=t,a.previous.top=t.position().top,e=l-this.offsetHeight/2,t.css("top",e),a.current.top=e,o.actionarray.push(a)}))}else if("zc-va-bottom"==e)a.each((function(){var e=$(this),t=JSON.parse(JSON.stringify(n));t.node=e,t.previous.top=e.position().top;var a=this.offsetTop,i=this.offsetHeight,r=p.endY-(a+i);e.css("top",a+r),t.current.top=a+r,o.actionarray.push(t)}));else if("zc-va-distribute"==e){var s=$(".zcanvas-selectbox"),d=s.position();d.height=s.outerHeight();var c=$u.sortBy(a,(function(e){return e.offsetTop})),u=$(c),p={},m=$u.min(u,(function(e){return e.offsetTop}));p.top=m.offsetTop+m.offsetHeight;var f=$u.max(u,(function(e){return e.offsetTop+e.offsetHeight}));p.bottom=f.offsetTop,p.distance=p.bottom-p.top,canvasObjUtils._.map(u.not(m).not(f).toArray(),(function(e){p.distance=p.distance-$(e).outerHeight()})),p.vdist=p.distance/(u.length-1);var v=p.activetop=m.offsetTop,h=!0;if(canvasObjUtils._.map(u,(function(e){var t=$(e).outerHeight();!d||!d.top||d.top<=v&&d.top+d.height>=v||(h=!1),v=v+t+p.vdist})),!h)return;canvasObjUtils._.map(u,(function(e){var t=$(e),a=JSON.parse(JSON.stringify(n));a.node=t,a.previous.top=t.position().top,t.css("top",p.activetop),a.current.top=p.activetop,p.activetop=p.activetop+t.outerHeight()+p.vdist,o.actionarray.push(a)}))}if(a.is(".zcanvas-field")){var g=a.parent(".zcanvas-editor").data("zcanvas");g&&g.config.onChange("drag",a)}t.push(o)},selectionchange:function(e){for(var t=e.length,a=0;a<t;a++){var i=e.eq(a);if(i.hasClass("zc-tab-container")&&(i=i.closest(".zctablayout")),i.hasClass("ui-resizable"))for(var o=i.css(["border-left","border-right","border-top","border-bottom"]),n=i.children(".ui-resizable-handle"),r=n.length,l=i.outerHeight(),s=0;s<r;s++){var d={};n.eq(s).hasClass("ui-resizable-e")?(d.height="inherit",d.top=-(parseInt(o["border-top"])+5),d.right=-(parseInt(o["border-right"])+5)):n.eq(s).hasClass("ui-resizable-w")?(d.height="inherit",d.top=-(parseInt(o["border-top"])+5),d.left=-(parseInt(o["border-left"])+5)):n.eq(s).hasClass("ui-resizable-n")?(d.width="inherit",d.top=-(parseInt(o["border-top"])+5),d.left=-(parseInt(o["border-left"])+5)):n.eq(s).hasClass("ui-resizable-s")?("auto"!=i.get(0).style.height&&""!=i.get(0).style.height||i.height(l),d.width="inherit",d.bottom=-(parseInt(o["border-bottom"])+5),d.left=-(parseInt(o["border-left"])+5)):n.eq(s).hasClass("ui-resizable-nw")?(d.left=-(parseInt(o["border-left"])+5),d.top=-(parseInt(o["border-top"])+5)):n.eq(s).hasClass("ui-resizable-ne")?(d.top=-(parseInt(o["border-top"])+5),d.right=-(parseInt(o["border-right"])+5)):n.eq(s).hasClass("ui-resizable-sw")?(d.left=-(parseInt(o["border-left"])+5),d.bottom=-(parseInt(o["border-bottom"])+5)):n.eq(s).hasClass("ui-resizable-se")&&(d.right=-(parseInt(o["border-right"])+5),d.bottom=-(parseInt(o["border-bottom"])+5)),n.eq(s).css(d)}}},updateAsyncprop:function(e,t){if(e&&e.fieldContainer){var a=$(e.fieldContainer).data("zcdatamap");a&&a[e.id]&&(a[e.id].async=t)}},loadResourceOnDemand:function(e,t){e.asyncloader=new Promise((function(a){var i=objectUtils.cloneObject_new(e.asyncresources);if(i&&i.length){var o=networkUtils.returnDependencyFiles(i,crmConstants.jsStaticPathForLyte);Lyte.injectResources(o).then((function(){e.async=!1,t&&Lyte.registeredMixins["crm-detailcanvas-utils"].updateAsyncprop(e,!1),a(e)}))}else e.async=!1,t&&Lyte.registeredMixins["crm-detailcanvas-utils"].updateAsyncprop(e,!1),a(e)}))},debouncescroll:function(){var e,t=this.scrollhandler;return function(){var a=this,i=arguments,o=function(){e=null,t.apply(a,i)};clearTimeout(e),e=setTimeout(o,150)}},scrollhandler:function(){var e=$L(".zcanvas_lyte_component.zcanvas_not_rendered:not(template):visible,.fieldupdate-highlight").getviewport(),t=e.length;Lyte.registeredMixins["crm-detailcanvas-utils"].executeLRsubform(),Lyte.registeredMixins["crm-detailcanvas-utils"].executeLRSections();for(var a=0;a<t;a++){if($(e[a]).hasClass("fieldupdate-highlight"))setTimeout((function(e){e.removeClass("fieldupdate-highlight")}),1e4,$(e[a]));else e[a].setData("lazyload",!0),e[a]&&e[a].getData&&!e[a].getData("isLoading")&&(e[a].classList.remove("zcanvas_not_rendered"),e[a].removeAttribute("style"))}},countAndRefreshIconHandler:function(e){var t="";return t='<span id="RL_dataCount_'+e.id+'" data-zcqa="canvasCnt_'+e.id+'"></span>',e&&e.api_name&&"Notes"!=e.api_name&&"Social"!=e.api_name&&"CheckLists"!==e.api_name&&"custom_related_list"!==e.type&&"Zoho_Support"!==e.api_name&&"Entity_Scores__s"!==e.api_name&&(t+=' <div id="fetch_'+e.id+'" data-zcqa="refresh_'+e.display_label+"\" onClick=\"{{action('refreshingrelatedlist','"+e.id+"','fetch_"+e.id+'\')}}" class="mL10 tb_small_loader vmiddle"  ><span class="ld_init"></span><span class="ld_process"></span></div>'),t},getAvailableModulesByFeatureForPrediction:function(e){var t=["Visits","Forecasts"],a=1,i=2,o=[],n=this;return"prediction"===e&&store.peekAll(e).filter((function(e){void 0!==e.module&&o.push(e.module.module_name)})),store.peekAll("module").filter((function(r){if(!0===r.presence_sub_menu&&!0===r.visible&&"linking"!==r.generated_type&&t.indexOf(r.module_name)<0&&("prediction"!==e||("Leads"!==r.api_name&&"Deals"!==r.api_name&&n.moduleOccurenceCount(o,r)<i||("Leads"===r.api_name||"Deals"===r.api_name)&&n.moduleOccurenceCount(o,r)<a)))return r}))},moduleOccurenceCount:function(e,t){return e.filter((function(e){return e===t.module_name})).length},transformdatatocriteria:function(e){if(!e)return[];var t=["profileimage","fileupload","owner","multiselectpicklist","multiselectlookup","subform"];return e=e.filter((function(e){if(e&&!(t.indexOf(e.data_type)>-1))return!0}))},processgallery:function(e,t){var a=Lyte.registeredMixins["crm-detailview-canvas-utils"],i=!!a&&a.getmetadata().fromDVGallery,o=$L("crm-detailview-canvas-gallery")[0],n=$L("crm-detailview-oldeditor")[0],r=!!o&&o.component.getData("isPreviewClicked"),l=!1;n&&n.component.getData("showObjPreview")&&(r=!0,l=!0);var s=i?o.component.getData("menuOptionsData"):objectUtils.cloneObject_new($("#zcanvas_menu").data("zcdatamap"));o&&r&&!i||o&&t?o.component.setData("menuOptionsData",s):n&&n.component.setData("menuDetails",s);var d={},c={},u=[],p=[];for(key in s){var m=s[key],f=m.api_name?"api_name":"apiname";d[m[f]]||(d[m[f]]=[]),c[m.datatype]||(c[m.datatype]=[]),"relatedlist"!==m.group||m.hidden||("crm.settings.section.modules.module.canvas.create"!==Lyte.Router.getRouteInstance().transition.target&&!i&&!l||t?m.data&&$u.isEmpty(m.data)?u.push(m):p.push(m):(delete m.mappedCount,"relatedlist"===m.datatype?(m.zcscope=2,delete m.template,delete m._data,m.connectedModName||p.push(m)):(m.zcscope=1,u.push(m)))),"crm.settings.section.modules.module.canvas.create"!==Lyte.Router.getRouteInstance().transition.target&&!i&&!r||t||m.mappedCount&&m.zcscope&&(m.zcscope=m.zcscope+m.mappedCount,delete m.mappedCount),m.hidden||(d[m[f]].push(m),c[m.datatype].push(m))}var v=function(e,t){for(var a=e,i=e.length,o=0;o<i;o++)e[o]&&e[o][t]&&delete e[o][t],e[o].children&&(e[o].children=v(e[o].children,t));return a},h=function(e,a,i,o){var n=e,r=e.api_name?"api_name":"apiname",s=["profileimage","textarea","fileupload","image"];if(n.zcanvasId&&!t||(n.zcanvasId=zutils.getRandomId()),e[r]||e.datatype&&!e.noprocess){var m=!1,f=e[r],h=!1,g=[];if(d[f]&&f&&!t&&!l&&(g.length||(g=d[f].filter((function(a){return t&&a.zcscope>0?a.id!==e.id||0!==a.mappedCount&&a.mappedCount?a.zcscope:a.id===e.id:a.mappedCount<a.zcscope||!a.mappedCount}))),m=g.length>0),c[e.datatype]&&!m&&!e.noprocess){g=[];var y=!1;if("button"===e.datatype&&(g=c[e.datatype].filter((function(a){return t&&a.zcscope>0?a.id!==e.id||0!==a.mappedCount&&a.mappedCount?a.zcscope:a.id===e.id:a.id===e.id&&a.zcscope>0})),t)){var b=g.filter((function(t){return t.id===e.id&&0!==t.zcscope&&t.zcscope<=5}));g=b.length>0?b:g}if(!g.length)if("button"===e._type&&(y=!!(g=c[e.datatype].filter((function(e){return store.peekRecord("custom_button",e.id)}))).length),e.customField)g=c[e.datatype].filter((function(e){return e.customField&&(e.mappedCount<e.zcscope||!e.mappedCount)}));else if(l&&(g=c[e.datatype].filter((function(t){return t.id===e.id}))),g.length||(g=c[e.datatype].filter((function(a){return t&&a.zcscope>0?a.id!==e.id||0!==a.mappedCount&&a.mappedCount?a.zcscope:a.id===e.id:a.mappedCount<a.zcscope||!a.mappedCount}))),t){var x=g.filter((function(t){return t.id===e.id&&(0===t.mappedCount||!t.mappedCount)}));g=x.length>0?x:g}g&&g.length?m=!0:h="button"!==e._type||y}if("link"!==e.datatype||c[e.datatype]||m||(m=!0,e.delFromjson=!0),"button"!==e._type||g.length||m||(m=!0,e.delFromjson=!0),!c[e.datatype]&&!m||h){g=[];if(s.indexOf(e.datatype)<0)for(var z in c)if(s.indexOf(z)<0&&c[z].length>0&&"fields"===c[z][0].group&&(g=c[z].filter((function(e){return t&&e.zcscope>0?e.zcscope:e.mappedCount<e.zcscope||!e.mappedCount})))&&g.length)break}if(g&&g.length){if(g[0].mappedCount){for(var R=g.length,L=0;L<R;L++)if(g.push(g.shift()),!g[0].mappedCount){g[0].mappedCount=0;break}}else g[0].mappedCount=0;g[0].mappedCount=g[0].mappedCount+1,g[0].zcscope=g[0].zcscope-1;var C=$L("crm-detailview-oldeditor")[0];if(!!C&&C.component.getData("showObjPreview")||!i&&!o){if(!l){var w=$("#zcanvas_menu").data("zcdatamap");if(w[g[0].id].zcscope=g[0].zcscope,w[g[0].id].mappedCount=g[0].mappedCount,t&&g[0].zcscope<=0){var S=$('#zcanvas_menu [data-uniquekey="'+g[0].id+'"]');S.addClass("zc-strict-hide");var I=S.parent(".zcanvas-submenu-container");I.find(".zcanvas-field:not(.zc-strict-hide)").length||(I.addClass("zc-strict-hide"),I.prev(".zcanvas-submenu-heading").addClass("zc-strict-hide"))}}}else $L("crm-detailview-canvas-gallery")[0].component.getData("menuOptionsData")[g[0].id].zcscope=g[0].zcscope;"picklist"===(n=$L.extend(n,g[0])).zctype&&Lyte.registeredMixins["crm-detailcanvas-utils"].removePicklistprops(n,a)}else n.noMapAvail=!0,n.value="N/A",n.label="N/A",n.fieldContainer="#zcanvas_menu"}if(e.sectionId){var M=e.sectionId.split("_")[1];0===(ee=c.undefined.filter((function(e){return e.sectionid&&e.sectionid.split("_")[1]===M}))).length&&(ee=c.undefined.filter((function(e){if(e.data.length&&"profileimage"!==e.data[0].datatype&&"subform"!==e.data[0].datatype&&(!e.mappedCount||e.mappedCount<2))return e}))),ee&&ee.length?(ee[0].mappedCount||(ee[0].mappedCount=0),ee[0].mappedCount+=1,_(ee[0]),n.children=ee[0].data.children,n.children&&n.children.forEach((function(e){e.noprocess=!0}))):n.noMapAvail=!0}var A=e.children;if(e.relatedList||A&&A.relatedList){for(var k,P,D,O,E=0,T=n.children.length,F=0;F<T;F++){var N=n.children[F];switch(N._type){case"relatedlist":k=F;var j=N.data?N.data.p_name:void 0;P=j||(store.peekRecord("related_list",N.id)?store.peekRecord("related_list",N.id).personality_name:N.id),D=N.id;break;case"static_content":E=F;break;case"component":if(N.children.length>0)for(var q=N.children.length,H=0;H<q;H++){var B=N.children[H];if("relatedlist"===B._type){k=H;j=B.data?B.data.p_name:void 0;P=j||(store.peekRecord("related_list",B.id)?store.peekRecord("related_list",B.id).personality_name:B.id),D=B.id}else"static_content"===B._type&&(E=H)}}}var V=n.children[k];if(V||(V=n.children[0].children[k],O=!0),V){var U,J,W=!1,X=!(!V.data||!V.data.mappedCount),Y=!(!V.data||"relatedlist"!==V.data.datatype),Z=[];if(V.data&&!X||(Y="Table Layout"!==V.theme,Z=function(e,a,i,o,n){var r=[];return(r=e.filter((function(e){var a=store.peekRecord("related_list",e.id)?store.peekRecord("related_list",e.id).personality_name:null;return l||t?a===i&&(e.mappedCount<e.zcscope||!e.mappedCount||1===e.mappedCount&&1===e.zcscope):a===i}))).length||(r=a.filter((function(e){var a=store.peekRecord("related_list",e.id)?store.peekRecord("related_list",e.id).personality_name:e.id;return l||t?(a===i||e.id===o)&&(e.mappedCount<e.zcscope||!e.mappedCount):a===i||e.id===o&&(e.mappedCount<e.zcscope||!e.mappedCount)}))),r.length||(n.noExactMap?((r=e.filter((function(e){return!e.mappedCount||e.mappedCount<e.zcscope||1===e.mappedCount&&1===e.zcscope}))).length||(r=a.filter((function(e){return!e.mappedCount||e.mappedCount<e.zcscope||1===e.mappedCount&&1===e.zcscope}))),n.noExactMap=!(r.length>0)&&"noMapAvail"):n.noExactMap=!0),r}(p,u,P,D,n),W=!0),W||(Y?((Z=p.filter((function(e){return(store.peekRecord("related_list",e.id)?store.peekRecord("related_list",e.id).personality_name:null)===P}))).length||(n.noExactMap?(Z=p.filter((function(e){return!e.mappedCount||e.mappedCount<e.zcscope})),n.noExactMap=!(Z.length>0)&&"noMapAvail"):n.noExactMap=!0),U="canvasRL"):((Z=u.filter((function(e){return((store.peekRecord("related_list",e.id)?store.peekRecord("related_list",e.id).personality_name:e.id)===P||e.id===D)&&(e.mappedCount<e.zcscope||!e.mappedCount)}))).length||(n.noExactMap?(Z=u.filter((function(e){return!e.mappedCount||e.mappedCount<e.zcscope})),n.noExactMap=!(Z.length>0)&&"noMapAvail"):n.noExactMap=!0),U="staticRL")),V.subformid&&(Z=c.undefined.filter((function(e){return e.data.length&&"subform"===e.data[0].datatype&&(!e.mappedCount||e.mappedCount<2)})))&&0===Z.length&&(n.noExactMap="noMapAvail"),Z&&Z.length){if(Z[0].mappedCount){for(var G=Z.length,Q=0;Q<G;Q++)if(Z.push(Z.shift()),!Z[0].mappedCount){Z[0].mappedCount=0;break}}else Z[0].mappedCount=0;var K,ee;Z[0].mappedCount=Z[0].mappedCount+1,l||!i&&$("#zcanvas_menu").data("zcdatamap")[Z[0].id]&&($("#zcanvas_menu").data("zcdatamap")[Z[0].id].mappedCount=Z[0].mappedCount),V.subformid&&(Z=Z[0].data);var te=$L("crm-detailview-canvas-gallery")[0];n.children[k]?(n.children[k].id=Z[0].id,K=n.children[E].children,n.children[k].components=n.children[k].children,n.children[k].data=Z[0],"canvasRL"===U&&(n.children[k].data.rellistdata=[]),ee=Lyte.registeredMixins["crm-detailcanvas-utils"].relListCreate(n.children[k],te?te.component.getData("menuOptionsData")[Z[0].id]:$("#zcanvas_menu").data("zcdatamap")[Z[0].id],t,l)):(n.children[0].children[k].id=Z[0].id,K=n.children[0].children[E].children,n.children[0].children[k].components=n.children[0].children[k].children,n.children[0].children[k].data=Z[0],"canvasRL"===U&&(n.children[0].children[k].data.rellistdata=[]),ee=Lyte.registeredMixins["crm-detailcanvas-utils"].relListCreate(n.children[0].children[k],te?te.component.getData("menuOptionsData")[Z[0].id]:$("#zcanvas_menu").data("zcdatamap")[Z[0].id],t,l)),(i||o)&&ee&&ee.data instanceof Promise&&Lyte.registeredMixins["crm-detailcanvas-utils"].gallerypreviewRL.push(ee.data);for(var ae=K.length,ie=0;ie<ae;ie++)if(K[ie])if(K[ie].ui.value.class&&K[ie].ui.value.class.indexOf("zc_disabled")>-1)"stage_navigator"!==Z[0].id&&(K[ie].ui.value.value=Z[0].zcvalue),O||a&&a.tabrelatedlistid?a&&a.tabrelatedlistid?"stage_navigator"!==Z[0].id&&(a.ui.value.name=Z[0].zcvalue):(n.children[0].children[E].children=K,n.tabrelatedlistid&&"stage_navigator"!==Z[0].id&&(n.ui.value.name=Z[0].zcvalue)):n.children[E].children=K;else if("button"===K[ie].datatype){var oe,ne=store.peekRecord("related_list",Z[0].id),re=!1;if(re=Lyte.registeredMixins["crm-detailcanvas-utils"].staticRlMapping.indexOf(Z[0].api_name)>=0,!ne||re)(O?n.children[0].children[1].id:n.children[1].id)===Z[0].id&&(Lyte.registeredMixins["crm-detailcanvas-utils"].fetchActionsForStaticRel(Z[0],Lyte.Router.getRouteInstance().transition.info.dynamicParams[0]),oe=Z[0].actions,re=!0);if(ne||re){re||(oe=Lyte.registeredMixins["crm-detailcanvas-utils"].getRelListActions(ne));var le=oe.length;0===le&&(O?n.children[0].children[E].children.splice(ie,1):n.children[E].children.splice(ie,ae-1));var se=!1;for(F=0;F<le;F++)oe[F].id.indexOf(K[ie].id.split(/(\d+)/)[0])>-1&&(K[ie]=$L.extend(K[ie],oe[F]),K[ie].noprocess=!0,se=!0);if(1===le&&K[ie]&&K[ie].ui.icon?K[ie].ui.icon.icon="icon-Icon_plus":le>1&&K[ie]&&K[ie].ui.icon&&(K[ie].ui.icon.icon="icon-Icon_dot_three"),!se&&le>0){var de=le>1?oe[le-1]:oe[0];K[ie]=$L.extend(K[ie],de),K[ie].zcvalue=K[ie].value,K[ie].noprocess=!0}}else O?n.children[0].children[E].children.splice(ie,1):n.children[E].children.splice(ie,1)}}else"noMapAvail"===n.noExactMap&&(n.ui.value.editorclass+=" zcanvas-loading-component",(n.children[k]||n.children[0].children[k])&&(O?(n.children[0].children[k].noMapAvail=!0,n.children[0].children[k].children.forEach((function(e){e.label="N/A",e.value="N/A"})),Y||(n.children[0].children[k].components=[])):(n.children[k].noMapAvail=!0,n.children[k].children.forEach((function(e){e.label="N/A",e.value="N/A"})),Y||(n.children[k].components=[]))),a&&a.tabrelatedlistid&&(a.noMapAvail=!0,a.noExactMap="noMapAvail"),n.noMapAvail=!0);if(!Z.length){var ce=O?n.children[0].children[E]:n.children[E];if(ce)for(var ue=ce.children,pe=ue.length,me=0;me<pe;me++){ue[me].noprocess=!0}}if(n.children[k]){var fe=n.children[k].children.length;for(F=0;F<fe;F++){(he=n.children[k].children[F]).noprocess=!0,he.datatype&&s.indexOf(he.datatype)>-1&&(n.children[k].children.splice(F,1),F-=1,fe-=1)}J=v(n.children[k].children,"id"),n.children[k].children=J}if(O&&n.children[0].children){var ve=n.children[0].children[k].children.length;for(F=0;F<ve;F++){var he;(he=n.children[0].children[k].children[F]).noprocess=!0,he.datatype&&s.indexOf(he.datatype)>-1&&(n.children[0].children[k].children.splice(F,1),F-=1,ve-=1)}}n.noprocess=!0}}return n},g=function(e,a,i,o){for(var n=e,r=e.children,l=r?r.length:0,s=[],d=0;d<l;d++){var c=r[d].noprocess;a?c=!0:"Tab Layout"===e.theme&&r[d]&&r[d].children&&r[d].ui.value.class.indexOf("zc-tab-all-fields")>-1?(t&&$(".zc-tab-content[data-zcanvasclass~='zc-tab-all-fields']").length?(r[d].noMapAvail=!0,r[d].noExactMap="noMapAvail"):(r[d].children=[],r[d].ui.allfieldstabstyle={}),c=!0):e.children[d]=h(e.children[d],e,i,o),e.children[d].delFromjson||s.push(g(e.children[d],c,i,o))}return n.children=s,n},y=function(e,t,a){for(var i=e,o=["profileimage","textarea","fileupload","image"],n=i.children.length,r=0;r<n;r++){var l=i.children[r];l.noMapAvail&&l.datatype&&o.indexOf(l.datatype)>-1&&(l.fieldContainer="#zcanvas_menu"),l.noExactMap&&"noMapAvail"!==l.noExactMap?l=h(l,i,t,a):y(l,t,a)}return e},b=function(e){for(var t=e,a=t?t.children.length:0,i=0;i<a;i++){var o=t.children[i];o&&o.noMapAvail&&"noMapAvail"===o.noExactMap?(e.children.splice(i,1),a-=1,i-=1):b(o)}return e},_=function(e){e.menudata&&(e.data=objectUtils.cloneObject_new(e.menudata));var t=e.data&&1===e.data.length&&(e.data[0].datatype.indexOf("image")>-1||e.data[0].datatype.indexOf("subform")>-1);if(t){if(t&&!external){var a=$("#zcanvas_menu").data("zcanvasMenu");el.helper.addClass("zcanvas-field zcanvas-afterdrop").removeClass("zcanvas-submenu-heading");var i=objectUtils.cloneObject_new(e.data[0]),o=el.helper.attr("data-uniquekey"),n=$('#zcanvas_menu [data-uniquekey="'+o+'"]');i["zcanvas-afterdrop"]=e,n.data("zcanvas",i),a.dragstarthandler(null,el,i)}}else{var r={ui:{value:{style:{},class:"zc-fieldsection",position:{startX:0,startY:0,endX:1640,width:1620,height:943,minTop:37,minLeft:24},tagname:"DIV"}},children:[],_type:"component",theme:"Custom Layout",zcanvasId:"zcanvas_hcw8rjbwfbd",zcMinWidth:"500"},l={ui:{value:{style:{default:{"border-radius":"0","box-shadow":"none",border:"none","background-color":"rgba(243, 242, 242, 1)"}},position:{startX:0,startY:0,endX:1640,width:"100%",height:38,minTop:37,minLeft:24},tagname:"DIV"}},children:[],_type:"component",theme:"Custom Layout",zcanvasId:"zcanvas_hcw8rjbwfbd"},s={zcanvasId:"zcanvas_4si4xy5gemp",_type:"component",ui:{value:{style:{},position:{startX:10,startY:7,endX:174,width:164,height:27},class:"zc_disabled",value:"Products"}},theme:"Static Text",children:[]},d={zcanvasId:"#zcanvas_us58qoeplr",_type:"component",ui:{value:{position:{startX:30,startY:52,endX:1278,width:"calc(100% - 60px)",height:480,minTop:5},style:{},class:"zclayout-table zcrestricttable",layoutstyle:{row:{height:"50px"},field:{width:"50%"},inner:[{percent:34.80194017784964},{percent:35.12530315278901}]}}},theme:"Table Layout",children:[]};d.zcanvasId=zutils.getRandomId();var c={_type:"row",ui:{value:{position:{startX:0,startY:5,endX:1259,width:1259,height:50},style:{},class:"zcanvas-row"}},children:[]},u={zcanvasId:"zcanvas_3kga5lwc3z4",datatype:"user",type:"field",_type:"field",ui:{value:{style:{},position:{startX:0,startY:0,endX:625,width:625,height:50},tagname:"DIV",class:"zcanvas-field"},holder:{style:{},tagname:"SPAN",class:""},field:{style:{},tagname:"SPAN",class:""},label:{style:{},tagname:"SPAN",class:""}},fieldContainer:"#zcanvas_menu",group:"field",children:[]},p=d,m=Math.round(e.data.length/2);l.zcanvasId=zutils.getRandomId(),r.zcanvasId=zutils.getRandomId(),s.zcanvasId=zutils.getRandomId(),s.ui.value.value=e.zclabel,l.children.push(s);for(var f=0,v=0;v<m;v++){var h=JSON.parse(JSON.stringify(c)),g=objectUtils.cloneObject_new(u);if(g.zcanvasId=zutils.getRandomId(),h.children.push(g),2*(v+1)<=e.data.length){var y=objectUtils.cloneObject_new(u);g.zcanvasId=zutils.getRandomId(),h.children.push(y)}p.children.push(h),f+=50}p.ui.value.position.height=f,r.ui.value.position.height=f+100;var b=e.data.map((function(e){return e.id})),_=Lyte.Router.getRouteInstance().parent.currentModel,x=Lyte.registeredMixins["crm-detailcanvas-utils"].processRelListObj(p,_.entityData,_.module,b);if(r.children.push(l),r.children.push(x),e.zctype="component",e.value="",e.menudata=objectUtils.cloneObject_new(e.data),r.zccompmeta={sectionId:e.sectionid},e.data=r,e.containment="parent",e.condition=function(e){return!($(".zc-fieldsection[data-sectionid="+e.sectionid+"]").length>1)},e.callback=function(e,t){e.attr("data-sectionid",t.sectionid);var a=e.attr("id");e.addClass("zc-non-insertable");var i=e.find(".ui-draggable");i.draggable("option","containment","parent"),i.draggable("option","scope",a),e.find(".ui-droppable").add(e).droppable("option","scope",a),e.find(".zctable-sortable").addClass("zctable-disabled")},external)return e}},x=g(e,void 0,i,r);if(x=y(x,i,r),x=b(x),t)return x.children.length||_cruxUtils.showCustomMessage({params:{ltPropMessage:"No relevant data present to map",ltPropType:"warning"}}),x.children;if(n&&n.component.getData("showObjPreview"))Lyte.registeredMixins["crm-detailcanvas-utils"].getObjParsedJson(x);else if(i||r)o.component.setData("current_view",x),o.component.fetchParsedJson(x);else{var z=$("#zcanvas-editor-outer"),R=z.data("zcanvas");R&&R.addElement(x.children),x.ui.theme&&(R.config.toolsRef.config.theme.currenttheme=x.ui.theme,R.config.toolsRef.compiletheme()),z.zccss(x.ui.value.style||{}),x.ui.value&&x.ui.value.position&&x.ui.value.position.width&&(z.css({width:x.ui.value.position.width}),z.parent().css({width:x.ui.value.position.width})),z.addClass(x.ui.value.class).zaddClass(x.ui.value.class),z.removeClass("zcanvas-editor").zremoveClass("zcanvas-editor"),R.resetheight()}},getObjParsedJson:function(e){var t=e.children;t&&t[0]&&t[0].ui.value.position&&(t[0].ui.value.position.startX=0,t[0].ui.value.position.startY=0),Lyte.resolvePromises(Lyte.registeredMixins["crm-detailcanvas-utils"].gallerypreviewRL).then(function(){networkUtils.lyteInitiateRequest(Crm.getCrmBasePath()+"/CanvasParser.do","POST",{params:JSON.stringify(e),skip_load_tab:!0}).then(function(e){this.manipulateObjJson(e)}.bind(this))}.bind(this))},manipulateObjJson:function(e){var t=$L("crm-detailview-oldeditor")[0];Lyte.registeredMixins["crm-detailcanvas-utils"].gallerypreviewRL=[],zclayout&&zclayout.prototype.layouts&&!zclayout.prototype.layouts["Tab Layout"].onnavigation&&(zclayout.prototype.layouts["Tab Layout"].onnavigation=Lyte.registeredMixins["crm-detailcanvas-utils"].tabOnNavigation);var a=this.gettoolinst();createStruture.toolinst=a,createStruture.toolinst.rellistcompile=this.relatedlistcompile,createStruture.toolinst.tabViewcallback=this.allFieldFormation.bind(this),createStruture.toolinst.customstaticview=Lyte.registeredMixins["crm-detailcanvas-utils"].customStatiView,createStruture.singleshotrender=!0,createStruture.galleryrender=!0,createStruture.menuData=$("#zcanvas_menu").data("zcanvasMenu");var i=canvasOutput.html(void 0,e,!0);createStruture.singleshotrender=!1,createStruture.galleryrender=!1;var o=$("#previewObj"),n=$L("#obj-preview")[0];i.width(e.ui.value.position.width);var r=renderingUtils.windowOuterHeight,l=t.getData("previewTopOffset");if(e.ui.value.position.width>700&&e.ui.value.position.height>500){var s=Math.round(700/e.ui.value.position.width*10)/10/2+.1,d=Math.round(500/e.ui.value.position.height*10)/10/2+.1;i.css({transform:"scale("+s+","+d+")","transform-origin":"top left","margin-bottom":"-100%"}),l>r/2&&($L(".zc-reusable-preview-modal .lyteModal").e[0].style.top=l/2+"px"),n.ltProp({height:"460px",width:"560px"})}else if(e.ui.value.position.width>700&&e.ui.value.position.height<500||e.ui.value.position.width<700&&e.ui.value.position.height<500){var c=!1,u=null,p=renderingUtils.windowOuterWidth;e.ui.value.position.width>p/2&&(u=p/2*100/e.ui.value.position.width,i.css({transform:"scale("+u/100+")","transform-origin":"top left","margin-bottom":"-100%"}),c=!0,u=p/2+u-20);var m=c?u:e.ui.value.position.width+40,f=t.component.data.objPreviewName.match(new RegExp(".{1,"+m+"}","g")),v=(f?18*f.length:0)+90;n.ltProp({height:e.ui.value.position.height+v+"px",width:m+"px"})}else if(e.ui.value.position.height>500&&e.ui.value.position.width<700){if(e.ui.value.position.height<r)e.ui.value.position.height+l>r&&($L(".zc-reusable-preview-modal .lyteModal").e[0].style.top="2px");var h=e.ui.value.position.width+40,g=t.component.data.objPreviewName.match(new RegExp(".{1,"+h+"}","g")),y=(g?18*g.length:0)+90;n.ltProp({height:e.ui.value.position.height+y+"px",width:e.ui.value.position.width+"px"})}o.html(i),t.component.setData("isPreviewAppend",!0);var b=e.ui.theme;createStruture.toolinst.config.theme.currenttheme=b,createStruture.toolinst.compiletheme(),Lyte.registeredMixins["crm-detailcanvas-utils"].afterPreview()},renderPreview:function(e,t,a){this.canvasModelPromise(e,t).then(function(i){a&&(i.views.filter((function(e){return e.id===t})).length?document.getElementById("previewModal").ltProp("show",!0):Lyte.registeredMixins["crm-detailcanvas-utils"].showPermissionErrorMsgPopup());this.afterModelCanvasPromise(i,e,t).then(function(t){var i=this.getPreviewResources(e);Lyte.Router.getRouteInstance().currentModel||(Lyte.Router.getRouteInstance().currentModel={}),Lyte.Router.getRouteInstance().currentModel.relatedlist=t.relatedlist,Lyte.Router.getRouteInstance().currentModel.layoutId=t.layoutId,Lyte.Router.getRouteInstance().currentModel.components=t.components,t.components.forEach((function(e){"segmentation"===e.name&&e.comp_available&&(Lyte.Router.getRouteInstance().currentModel[e.name+"_canvas"]=!0)})),Lyte.injectResources(i,void 0,function(){t.viewType="preview",a?Lyte.Component.render("crm-detailview-canvas",t,"#gallerypreview"):Lyte.Component.render("crm-detailview-canvas",t,"#preview"),$(".canvas-rp-bar").addClass("eventNone");var e=$("#showFldPopup");e.length>0&&e.addClass("dNImp"),this.loadRecordImage(),this.debouncemethod=this.debouncescroll.bind(this)(),document.addEventListener("scroll",this.debouncemethod,!0),this.scrollhandler(),commonUtils.showHideLoadingDiv()}.bind(this))}.bind(this))}.bind(this))},getPreviewResources:function(e){var t=networkUtils.returnDependencyFiles(["crm-canvasview.js","crm-tag.js","crm-skype-field.js","crm-circuits-rl-label.js","crm-recommendation-details-newview.js","similarity-details-page.js","zia-insights.js","zia-helpers.js","prediction-result.js","nba-detail-page.js","crm-image-mixin.js","setup/orchestration/crm-orchestration-detailview-pop.js","crm-salesiq-detail-view.js","crm-rl-users-list.js","crm-emails-related-list.js","email-emotions.js","crm-rl-share-email.js","social_related_list_store.js","recommendation-detailed-main.js","emails_rl_user-model.js","crm-image-preview.js","crm-emailsrl-canvas-view-comp.js","crm-related-list-action-wrapper.js","crm-detail-view-data-privacy.js","crm-custom-button-wrapper.js","sales-navigator.js","crm-social-integ-outer-template.js","crm-macro.js","crm-column-list.js","crm-attachments.js","crm-activity-rel-wrapper.js","crm-detailcanvas-utils.js","crm-tag.js","crm-email-field.js","crm-list-helpers.js","crux-video.js","crux-note.js","lyte-colorbox.js","crux-tag.js","crm-zdesk-rl-all.js","crm-zdesk-rl-label.js","crm-activity-rel.js"],crmConstants.jsStaticPathForLyte);if(t=t.concat(networkUtils.returnDependencyFiles(["zohocrm_detailview_canvas.js"],crmConstants.jsStaticPath)),t=(t=(t=(t=(t=(t=(t=(t=(t=Crm.userDetails.detailView_newUI?t.concat(networkUtils.returnDependencyFiles(["zcrm_customization.js","zcrm_dataprivacy_view_new.js",networkUtils.getI18nJSUrl("customization")])):t.concat(networkUtils.returnDependencyFiles(["zcrm_customization.js","zcrm_dataprivacy_view.js",networkUtils.getI18nJSUrl("customization")]))).concat(networkUtils.returnDependencyFiles(["crm-canvasview.css","crm-msg-related-list.css","crm-activity-rel-customize.css","crux-boolean-component.css","crm-canvas-criteria.css","crm-column-list.css","crm-custom-rl.css","crm-image-preview.css","crm-macro.css","crm-related-list-view-header.css","crm-activity-rel-wrapper.css","crm-emails-related-list.css","crm-rl-share-email.css","crm-rl-users-list.css","crm-zdesk-rl-all-wrapper.css","crm-zsurvey-rl-label.css","scoring_entityscore.css","crm-recommendation-details-newview.css","prediction-result.css","crm-list-view-crux.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["canvas-detailview-less.css"],crmConstants.lessStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["recommendation-similarity.css"],crmConstants.lessStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("SimilarityRecommendation")],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("NextBestAction")],crmConstants.jsStaticPath))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("reviewprocess")]))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("crossorgs")]))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("emailsummary")])),Crm.userDetails.isSegmentationEnabled&&(t=(t=(t=t.concat(networkUtils.returnDependencyFiles(["related-list-rfm.js"],crmConstants.jsStaticPathForLyte))).concat(networkUtils.returnDependencyFiles(["related-list-rfm.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("segmentation")]))),"Activities"!==e&&(t=t.concat(networkUtils.returnDependencyFiles(["crm-image-upload.js","crm-image-upload-create.js","crm-image-preview.js","lyte-cropper.js","lyte-scrollTo.js","lyte-colorbox.js","exif-plugin.js"],crmConstants.jsStaticPathForLyte)),t=(t=Crm.userDetails.RTL_ENABLED?t.concat(networkUtils.returnDependencyFiles(["crm-image-upload-rtl.css"],crmConstants.cssStaticPathForLyte)):t.concat(networkUtils.returnDependencyFiles(["crm-image-upload.css"],crmConstants.cssStaticPathForLyte))).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("imageupload"),networkUtils.getI18nJSUrl("scoringRulesChart")]))),"Campaigns"===e){var a=networkUtils.returnDependencyFiles(["crm-campaigns-detail-view.js","crm-campaign-setup-mixin.js","crm-campaign-detail-utils.js"],crmConstants.jsStaticPathForLyte);a=a.concat(networkUtils.returnDependencyFiles(networkUtils.includeChartFiles()));var i=networkUtils.returnDependencyFiles(["crm-campaigns-detail-view.css","crm-setup-campaign-index.css"],crmConstants.cssStaticPathForLyte);t=t.concat(a.concat(i));var o=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("campaignsdetail")]);t=t.concat(o);var n=networkUtils.returnDependencyFiles(["zWebinar.js",networkUtils.getI18nJSUrl("zohowebinar")]);t=t.concat(n)}var r=networkUtils.returnDependencyFiles(["crm_finance_suite.js","zohocrm_lookupBusinessCard.js"]);return t=t.concat(r)},canvasModelPromise:function(e){return Lyte.resolvePromises({module:app.store.makeRequest("findRecord","module",moduleRecordMapping[e].id,{getOnlyMeta:!1}),views:app.store.makeRequest("findAll","canvasview",{module:e,feature:"DetailView"}),records:app.store.makeRequest("findAll",moduleRecordMapping[e].id,{per_page:1,approved:"both"}),button:app.store.makeRequest("findAll","custom_button",{module:moduleRecordMapping[e].api_name},!0),link:app.store.makeRequest("findAll","custom_link",{module:moduleRecordMapping[e].api_name},!0)})},afterModelCanvasPromise:function(e,t,a){var i=e;i.view=store.peekRecord("canvasview",a),i.viewId=e.view.id,i.module=t,i.record=e.records[0],commonUtils.showHideLoadingDiv(!1);var o=store.peekRecord("module",moduleRecordMapping[t].id),n=o.api_name;if(i.record&&i.record.Layout&&i.record.Layout.id)i.layoutId=i.record.Layout.id;else if(i.record&&i.record.layout_id)i.layoutId=e.record.layout_id;else{var r=o.layouts.filter((function(t){return e.view.layout_id===t.id}));i.layoutId=r.length?r[0].id:o.layouts[0].id}"Deals"!==i.module&&"Potentials"!==i.module||(i.stage=app.store.makeRequest("findAll","stage",{module:"Deals",layout_id:i.layoutId}));var l={feature:"DetailView",module:t,layoutId:i.layoutId},s=Lyte.resolvePromises({components:networkUtils.lyteInitiateRequest("/crm/v2/customization/views/components","GET",{params:l}),field:app.store.makeRequest("findRecord","layout",i.layoutId,{module:n},!1,!0,{apiVersion:"2.2"}),relatedlist:app.store.makeRequest("findAll","related_list",{module:n,layout_id:i.layoutId})}),d=[];return o.fields.forEach((function(e){if("subform"===e.data_type){var t=e.subform.id;d.push(store.findRecord("module",t))}})),s.subform=Lyte.resolvePromises(d),i.record?s.record=app.store.makeRequest("findRecord",moduleRecordMapping[t].id,i.record.id,{approved:"both",formatted_currency:!0,home_converted_currency:!0}):i.record={},new Promise((function(e){s.then((function(t){i.components=t.components.components,i.relatedlist=t.relatedlist,i.field=t.field,e(i)}))}))},getModuleNameFromRelatedlistId:function(e){var t=store.peekRecord("related_list",e);if(t&&t.module)return"Email_Sentiment"===t.api_name?"EmailSentiment":t.connectedmodule?t.connectedmodule:t.module.id&&store.peekRecord("module",t.module.id)?store.peekRecord("module",t.module.id).module_name:void 0},getCriteriaToJsonArray:function(e){var t=[];return e&&e.forEach((function(e){t.push(e.$.toJSON())})),t},criteriaref:{},expandcombinedcriteria:function(e){var t=Lyte.registeredMixins["crm-detailcanvas-utils"];for(var a in t.criteriaref){for(var i=a.split("_and_"),o=i.length,n=!0,r=0;r<o;r++)n&&(n=e.hasClass(i[r]));n&&e.addClass(t.criteriaref[a])}},getcombinedzcid:function(e){var t=Lyte.registeredMixins["crm-detailcanvas-utils"];return e.indexOf("_and_")>-1?(t.criteriaref[e]||(t.criteriaref[e]=zutils.getRandomId()),t.criteriaref[e]):e},criteriaswithcase:function(e,t,a){for(var i=Lyte.registeredMixins["crm-detailcanvas-utils"],o=i.stylekeys(t||{}),n=["default","active","hover"],r=o.filter((function(e){return!n.contains(e)&&e.indexOf("_mousestate_")<0})),l=r.indexOf(a),s=e.split(" "),d=s[0],c=s[1]||"",u=0;u<l;u++){var p=r[u].split("_child_"),m=p[0]||"",f=p[1]||"";if(m){var v=i.getcombinedzcid(m);d.indexOf(v)<0&&c.indexOf(v)<0&&(d+=":not(."+v+")")}if(f){v=i.getcombinedzcid(f);d.indexOf(v)<0&&c.indexOf(v)<0&&(c+=":not(."+v+")")}}return d+c},customstateview:function(e,t,a,i,o){if(!e||0!==e.indexOf("zcanvas"))return t;var n="_mousestate_",r=e.indexOf(n),l="";if(r>-1){var s=e.length,d=n.length;l=e.slice(r+d,s),e=e.slice(0,r)}var c=[e],u="";e.indexOf("_child_")>-1&&(c=e.split("_child_"));for(var p=c.length,m=Lyte.registeredMixins["crm-detailcanvas-utils"],f=0;f<p;f++)u+=m.getcombinedzcid(c[f]),f!==p-1&&(u+=".");return u=m.criteriaswithcase(u,i,e),l&&("hover"===l?t+=":hover":"active"===l&&(t+=".active")),a&&a.hasClass("zcanvas-non-delete")?"."+u+t:o&&o.personalityName||canvasOutput.isRLRendering?".crm-rl-list-record."+u+" "+t:"."+u+" "+t+(i&&i[e]&&i[e]._adjust?":not("+t+"_adjustforce)":"")},addtoqueue:function(e,t,a){zutils.renderingqueue||(zutils.renderingqueue=[]);var i={json:t,src:e,callback:a};zutils.renderingqueue.push(i)},renderfromqueue:function(e){if(zutils.renderingqueue&&zutils.renderingqueue.length){var t=zutils.renderingqueue.shift(),a=canvasOutput.html(void 0,t.json,!0);t.callback.bind(this)(a,t.src,t.json),setTimeout(function(){this.renderfromqueue(e)}.bind(this),30)}else{Customization.dropCache=!1;var i=Lyte.registeredMixins["crm-detailcanvas-utils"];i.initializeLazyLoad();var o=document.querySelector("crm-detailview-canvas");if(i.maincompname&&(o&&o.component.setData("comp_name",i.maincompname),i.maincompname=void 0,i.ruledelete=!1),o&&!o.getData("isPageLoaded"))o.querySelector(".zc-page-component")&&o.setData("isPageLoaded",!0),o.component.onPageLoaded.bind(o.component)();e()}},stylekeys:function(e){var t=[],a=Object.keys(e||{});return t=a.filter((function(t){return e[t]._inherited})),a.filter((function(t){return!e[t]._inherited})).sort((function(t,a){return(e[t]._order||0)-(e[a]._order||0)})).concat(t.sort((function(t,a){return(e[t]._order||0)-(e[a]._order||0)})))},removeCanvasRuleAllFields:function(e){if(e&&e.datastyle&&(e.datastyle.canvas_rules=[],e.datastyle&&e.datastyle.value&&(Object.keys(e.datastyle.value.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.datastyle.value.style[t]})),e.datastyle.value.tablestyles))){for(var t in e.datastyle.value.tablestyles.fields)e.datastyle.value.tablestyles.fields[t].field&&Object.keys(e.datastyle.value.tablestyles.fields[t].field.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(a){delete e.datastyle.value.tablestyles.fields[t].field.style[a]})),e.datastyle.value.tablestyles.fields[t].holder&&Object.keys(e.datastyle.value.tablestyles.fields[t].holder.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(a){delete e.datastyle.value.tablestyles.fields[t].holder.style[a]})),e.datastyle.value.tablestyles.fields[t].label&&Object.keys(e.datastyle.value.tablestyles.fields[t].label.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(a){delete e.datastyle.value.tablestyles.fields[t].label.style[a]})),e.datastyle.value.tablestyles.fields[t].value&&Object.keys(e.datastyle.value.tablestyles.fields[t].value.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(a){delete e.datastyle.value.tablestyles.fields[t].value.style[a]}));if(e.datastyle.value.tablestyles.rows)for(var a=e.datastyle.value.tablestyles.rows.length,i=0;i<a;i++)Object.keys(e.datastyle.value.tablestyles.rows[i].value.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.datastyle.value.tablestyles.rows[i].value.style[t]}));e.datastyle.value.tablestyles.table&&Object.keys(e.datastyle.value.tablestyles.table.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.datastyle.value.tablestyles.table.style[t]}))}e&&e.sectionstyle&&e.sectionstyle.value&&Object.keys(e.sectionstyle.value.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.sectionstyle.value.style[t]})),e&&e.titlesection&&e.titlesection.ui&&e.titlesection.ui.value&&Object.keys(e.titlesection.ui.value.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.titlesection.ui.value.style[t]}));for(var o=e.titlesection.children,n=o.length,r=0;r<n;r++)Object.keys(o[r].ui.value.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(e){delete o[r].ui.value.style[e]}))},removeCanvasRuleinJson:function(e){if(e.ui.field&&e.ui.field.style&&Object.keys(e.ui.field.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.ui.field.style[t]})),e.ui.holder&&e.ui.holder.style&&Object.keys(e.ui.holder.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.ui.holder.style[t]})),e.ui.label&&e.ui.label.style&&Object.keys(e.ui.label.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.ui.label.style[t]})),e.ui.value&&e.ui.value.style&&(Object.keys(e.ui.value.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.ui.value.style[t]})),e.ui.value.layoutstyle&&e.ui.value.layoutstyle.editor&&(Object.keys(e.ui.value.layoutstyle).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.ui.value.layoutstyle[t]})),Object.keys(e.ui.value.layoutstyle.editor).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.ui.value.layoutstyle.editor[t]})))),e.ui.image&&e.ui.image.style&&Object.keys(e.ui.image.style).filter((function(e){return e.includes("zcanvas_")})).filter((function(t){delete e.ui.image.style[t]})),e.ui.canvas_rules&&(e.ui.canvas_rules=[]),e.ui.allfieldstabstyle)for(var t in e.ui.allfieldstabstyle)this.removeCanvasRuleAllFields(e.ui.allfieldstabstyle[t])},traversingComponents:function(e){var t=e.children||[],a=t.length;e&&this.removeCanvasRuleinJson(e);for(var i=0;i<a;i++)this.traversingComponents(t[i])},updatingRuleData:function(e){store.modelFor("canvas_rule")&&store.peekRecord("canvas_rule",e)&&store.findRecord("canvas_rule",e)},RequestingcanvasruleinBuilder:function(e){var t=$L("crm-detailview-oldeditor")[0].component,a=t.getData("criterias")||[];!e||this.requestedRule.includes(e)||this.canvasRuleUnsupportComp.includes(e)||0!==a.filter((function(t){return t.module.api_name===e})).length||(this.requestedRule.push(e),store.findAll("canvas_rule",{module:e}).then((function(e){var i=Lyte.registeredMixins["crm-detailcanvas-utils"].getCriteriaToJsonArray(e);Lyte.arrayUtils(a,"concat",i),t.setData("criterias",a)})))},checkdeletedRule:function(e,t,a){if(e){for(var i,o,n=e.length,r=!1,l=Lyte.registeredMixins["crm-detailcanvas-utils"],s=0;s<n;s++)if(i=e[s].id,l.deletedRule.includes(i))a&&(l.CompVsRule[a]?l.CompVsRule[a].includes(i)||(o=!0,l.CompVsRule[a].push(i)):(o=!0,l.CompVsRule[a]=[],l.CompVsRule[a].push(i)));else if(!store.peekRecord("canvas_rule",i)||store.peekRecord("canvas_rule",i)&&"inactive"===store.peekRecord("canvas_rule",i).status){for(var s in this.criteriaref)s.includes(i)&&delete this.criteriaref[s];l.deletedRule.push(i),l.ruledelete=!0,r=!0,a&&(l.CompVsRule[a]?l.CompVsRule[a].includes(i)||(o=!0,l.CompVsRule[a].push(i)):(o=!0,l.CompVsRule[a]=[],l.CompVsRule[a].push(i)))}t&&r&&!a?l.unregisterCanvasView(t):a&&(o||r)&&Lyte.Component.registeredComponents[a]&&(this.CanvasIdVsCanvasComp[t].removeFirstOccurenceOfElement(a),Lyte.Component.unregisterComponent(a))}},splitstate:function(e){var t={hasmousestate:!1,main_:[],sub_:[]},a=e.indexOf("_mousestate_");a>-1&&(t.hasmousestate=!0,e=e.slice(0,a));var i=e.split("_child_"),o=i[0],n=i[1]||"";return t.main_=o.split("_and_").filter((function(e){return e})),t.sub_=n.split("_and_").filter((function(e){return e})),t},processdeletedrules:function(e){for(var t=Object.keys(e),a=t.length,i=0;i<a;i++){var o=t[i],n=o;if(!(o.indexOf("zcanvas_")<0)){for(var r=this.splitstate(o),l=r.main_.length,s=r.sub_.length,d=!1,c=0;c<l;c++){this.deletedRule.contains(r.main_[c].replace("zcanvas_",""))&&(n=n.replace(r.main_[c],""),d=!0)}for(c=0;c<s;c++){this.deletedRule.contains(r.sub_[c].replace("zcanvas_",""))&&(n=n.replace(r.sub_[c],""),d=!0)}if(d){var u=this.splitstate(n),p="",m=u.main_.length,f=u.sub_.length;for(c=0;c<m;c++)p+=u.main_[c],m-1!==c&&(p+="_and_");if(f){p&&(p+="_child_");for(c=0;c<f;c++)p+=u.sub_[c],f-1!==c&&(p+="_and_")}if(u.hasmousestate){var v=n.slice(n.indexOf("_mousestate_"),n.length);p&&(p+=v)}p&&!e[p]&&(e[p]=zutils.zcopyobj2(e[o])),delete e[o]}}}},handledeletion:function(e){if(e&&e.ui&&this.deletedRule&&this.deletedRule.length){if(e.ui.value&&e.ui.value.style&&this.processdeletedrules(e.ui.value.style),e.ui.value&&e.ui.value.tabstyle&&this.processdeletedrules(e.ui.value.tabstyle),e.ui.field&&e.ui.field.style&&this.processdeletedrules(e.ui.field.style),e.ui.holder&&e.ui.holder.style&&this.processdeletedrules(e.ui.holder.style),e.ui.icon&&e.ui.icon.style&&this.processdeletedrules(e.ui.icon.style),e.ui.label&&e.ui.label.style&&this.processdeletedrules(e.ui.label.style),e.ui.value&&e.ui.value.layoutstyle&&this.processdeletedrules(e.ui.value.layoutstyle),e.ui.value&&e.ui.value.layoutstyle)for(var t=["container","editor"],a=t.length,i=0;i<a;i++)e.ui.value.layoutstyle[t[i]]&&this.processdeletedrules(e.ui.value.layoutstyle[t[i]]);if(e.ui.allfieldstabstyle)for(var o in e.ui.allfieldstabstyle){var n=e.ui.allfieldstabstyle[o];for(var r in n)if("titlesection"===r){this.handledeletion(n[r]);for(var l=n[r].children||[],s=l.length,d=0;d<s;d++)this.handledeletion(l[d])}else this.handledeletion({ui:n[r]})}if(e.ui.value&&e.ui.value.tablestyles)for(var c in e.ui.value.tablestyles)if("fields"===c){var u=e.ui.value.tablestyles[c];for(var i in u)this.handledeletion({ui:u[i]})}else if("rows"===c){var p=e.ui.value.tablestyles[c],m=p.length;for(i=0;i<m;i++)this.handledeletion({ui:p[i]})}else"table"===c&&this.handledeletion({ui:{value:e.ui.value.tablestyles[c]}})}},getTableStylescompression:function(e,t,a,i,o){var n=Lyte.registeredMixins["crm-detailcanvas-utils"];for(var r in e)if("fields"===r){var l=e[r];for(var s in l)n.compressioncallback({ui:l[s]},t,a,i,o)}else if("rows"===r){var d=e[r],c=d.length;for(s=0;s<c;s++)n.compressioncallback({ui:d[s]},t,a,i,o)}else"table"===r&&n.compressioncallback({ui:{value:e[r]}},t,a,i,o)},getAllfieldStylecompression:function(e,t,a,i,o){var n=Lyte.registeredMixins["crm-detailcanvas-utils"];for(var r in e)for(var l in e[r])if("titlesection"===l){n.compressioncallback(e[r][l],t,a,i,o);for(var s=e[r][l].children,d=s.length,c=0;c<d;c++)n.compressioncallback(s[c],t,a,i,o)}else n.compressioncallback({ui:e[r][l]},t,a,i,o)},compressioncallback:function(e,t,a,i,o){var n=["default","active","hover"],r=Lyte.registeredMixins["crm-detailcanvas-utils"];if(e&&e.ui)for(var l in e.ui)if("allfieldstabstyle"===l&&(r.getAllfieldStylecompression(e.ui[l],t,a,i,o),r.splitAllFields(e)),"value"===l&&e.ui[l].tablestyles&&r.getTableStylescompression(e.ui[l].tablestyles,t,a,i,o),e.ui[l]&&(e.ui[l].style||i)){var s=i||e.ui[l].style;e:for(var d in s){if(!(n.indexOf(d)>-1)){if(a){delete e.ui[l].style[d];continue e}if(o&&e.ui[l].style[d]._inherited)continue;var c="_mousestate_",u=d.indexOf(c);if(u>-1){var p=d.length,m=c.length;d=d.slice(u+m,p)}var f=d.indexOf("child")>-1,v=[],h=[d];f&&(h=d.split("_child_"));for(var g=h.length,y=0;y<g;y++){var b=h[y];b.indexOf("and")>-1?v=v.concat(b.split("_and_")):v.push(b)}v.length||d&&d.indexOf("zcanvas")>-1&&v.push(d);var _=v.length;for(y=0;y<_;y++)t?t.push(v[y]):zutils.evalcriteria&&zutils.evalcriteria.push(v[y])}"holder"!==l&&"field"!==l||(e.ui[l].style[d]._hide_?(e.ui.value.style[d]||(e.ui.value.style[d]={}),e.ui.value.style[d]._hide_="true"):e.ui[l].style[d]._show_&&(e.ui.value.style[d]||(e.ui.value.style[d]={}),e.ui.value.style[d]._show_="true"))}}},colorPersistance:function(){if(Crm.canvasUsedColors){Crm.canvasUsedColors=$u.uniq(Crm.canvasUsedColors);var e=document.getElementById("zcanvascolorpicker");if(e){for(var t=e.getData("ltPropUsedColorsList"),a=t?t.length:0,i=Crm.canvasUsedColors.length-1,o=0;o<a;o++){var n=Crm.canvasUsedColors[i-o];n&&(t[o]=n)}e.setData("ltPropUsedColorsList",t)}delete Crm.canvasUsedColors}},FieldsFilterForCanvasRule:function(e){for(var t=[],a=["Data_Source"],i=e.length,o=0;o<i;o++)a.indexOf(e[o].api_name)>-1||e[o].subform||t.push(e[o]);return t},flusheditor:function(){delete window.undoredomanager;for(var e=$("#zcanvas-editor-outer"),t=e.add(e.find(".zcanvas")),a=t.length,i=0;i<a;i++){var o=t.eq(i);o.off();var n=o.data();if(n)for(var r in n)n[r]&&"function"==typeof n[r].destroy&&n[r].destroy(),"zcanvas"===r&&n[r]&&(n[r].container=null,n[r].selectable&&(n[r].selectable.area=null,n[r].selectable.selectables=null,n[r].selectable=null),n[r].config&&(n[r].config.staticelement=null,n[r].config=null)),n[r]&&(n[r].bindings=null,n[r].element=null,n[r]=null)}t.off(),"undefined"!=typeof jsonCreation&&jsonCreation.toolinst&&(delete jsonCreation.toolinst.selectedfields,delete jsonCreation.toolinst),$.ui.ddmanager&&$.ui.ddmanager.current&&delete $.ui.ddmanager.current,$.ui.ddmanager&&$.ui.ddmanager.droppables&&(delete $.ui.ddmanager.droppables,$.ui.ddmanager.droppables={default:[]}),delete zutils.getExternali18n,$(window).off("click.zcanvasdropdown")},unregisterCanvasView:function(){var e=Lyte.registeredMixins["crm-detailcanvas-utils"];for(var t in e.CanvasIdVsCanvasComp){var a=e.CanvasIdVsCanvasComp[t]?e.CanvasIdVsCanvasComp[t]:[];e.dropCompBasedOnCanvasID(a),e.CanvasIdVsCanvasComp[t]&&(e.CanvasIdVsCanvasComp[t]=[])}},dropCompBasedOnCanvasID:function(e){var t=Lyte.registeredMixins["crm-detailcanvas-utils"];e.filter((function(e){Lyte.Component.registeredComponents[e]&&(Lyte.Component.unregisterComponent(e),delete t.CompVsRule[e])}))},canvasIDvsCompMapping:function(e){var t=Lyte.Router.getRouteInstance().getDynamicParam();if(t){var a=this.CanvasIdVsCanvasComp[t];a&&!a.includes(e)&&a.push(e)}},preProcessFieldValue:function(e,t,a){var i=a||e[t.api_name];if(96===t.ui_type)i=void 0===i?[]:i.split(";");else if("multiselectpicklist"===t.data_type)i=void 0===i||""===i?[]:i.split("; ");else if("multiuserlookup"===t.data_type)void 0===i&&((i={}).users=[]);else if(i&&"phone"===t.data_type&&"en_US"===Crm.userDetails.COUNTRY_LOCALE&&i.startsWith("(")&&i.includes(")"))i=i.replace(/[^a-zA-Z0-9]/g,"");else if(void 0===i)return"";return i},postProcessFieldValue:function(e,t,a){if(void 0===e)return e;if(96===t.ui_type)e=e.length?e.join(";"):void 0;else{if("picklist"===t.data_type&&("-None-"===e||""===e))return;if("multiselectpicklist"===t.data_type)e=e.join("; ");else if("datetime"===t.data_type)e=this.getUserDateTimeFormatFromServerFormat(e);else if("multiuserlookup"===t.data_type){var i=store.peekRecord("field",t.id).multiuserlookup.connectedlookup_apiname,o=[];a[t.api_name]&&a[t.api_name].users.filter((function(e){o.push(e[i].id)}));var n=[],r={},l=[],s=e.length;if(s>0){for(var d=0;d<s;d++)r[i]=e[d],n.push(e[d].id),l.push(r),r={};(e={}).users=l}else e=void 0;o.length===n.length&&$u.intersection(o,n).length===o.length&&(e=a[t.api_name])}}return"string"==typeof e&&(e=e.trim(),-1!==[1,11,27,127,62].indexOf(t.ui_type)&&(e=renderingUtils.removeMultiSpacestoSingleSpace(e))),e},getUserDateTimeFormatFromServerFormat:function(e){if(e&&"string"==typeof e&&e.match("T")){var t=(e=e.replace(/[+-]\d{2}:\d{2}/,"")).split("-"),a=new Date(t[0],t[1]-1,t[2].split("T")[0]),i=(e=e.split("T"))[1]?e[1].split(":"):"";i&&(a.setHours(i[0]),a.setMinutes(i[1]));var o=Utils.getDateTimeInUserFormat(a,!0),n=o.slice(0,3);return o.replace(n,I18n.getMsg(n))}return e},checkFieldVisiblityforLayoutRule:function(e,t){var a=!1;if(e.filter((function(e){store.peekRecord("field",e.showFldId).visible&&(a=!0)})),a)return!0;var i=Lyte.Router.getRouteInstance().currentModel.layoutId,o=store.peekRecord("layout",i);(o=o.sections.filter((function(e){return t.includes(e.name)}))).filter((function(e){e.fields.filter((function(e){store.peekRecord("field",e.id).visible&&(a=!0)}))}));var n=Lyte.registeredMixins["crm-detailcanvas-utils"],r=store.peekAll("field").filter((function(e){return n.revlayoutRuleSubformSections.includes(e.id)}));return store.peekAll("field").filter((function(e){return n.lRuleSubformSections.includes(e.id)})).length>0?a=!0:r.length>0&&(a=!1),!!a},executeLayoutRuleforAjaxEdit:function(e,t){var a=Lyte.registeredMixins["crm-detailcanvas-utils"],i=t.getData("moduleData"),o=store.peekAll("layout_rule"),n=t.getData("layoutId");o.length>0&&o.forEach((function(a){if(a.layout&&(a.layout.id?a.layout.id:a.layout)===n){var o=i.fields.filter((function(e){return e.id===a.primary_field.id}))[0];o&&o.visible&&o.view_type.edit&&t.handleOneLayoutRule(t,a.queries,e)}})),a.handleFldSecVisiblityforLayoutRule(a),a.checkFieldVisiblityforLayoutRule(a.layoutRuleShowFld,a.layoutRuleShowSections)?$("#showFldPopup").removeClass("dNImp"):($("#showFldPopup").addClass("dNImp"),this.setData&&this.setData("showPopup",!1))},handleOneLayoutRule:function(e,t,a){var i=[];t&&t.forEach((function(t){t.actions&&t.actions.length>0&&i.push(t.actions),e.handleOneLayoutRuleQuery(e,t,a)}))},handleOneLayoutRuleQuery:function(e,t,a){var i=t.criteria;if(t.actions&&t.actions.length){var o=e.checkCriteriaMatch(i,a,void 0,void 0,e);void 0===o&&(o=!1),e.triggerLayoutRuleActions(e,t,a,o)}},triggerLayoutRuleActions:function(e,t,a,i){t.actions&&t.actions.slice().reverse().forEach((function(t){switch(t.type){case"Mandatory_Fields":case"Show_Fields":t.fields&&t.fields.forEach((function(o){e.handleLayoutRuleActions(t.type,t,o,a,e,i)}));break;case"Show_Sections":t.sections&&t.sections.forEach((function(o){e.handleLayoutRuleActions(t.type,t,o,a,e,i)}));break;case"Show_Subforms":t.subforms&&t.subforms.forEach((function(o){e.handleLayoutRuleActions(t.type,t,o,a,e,i)}))}}))},handleLayoutRuleActions:function(e,t,a,i,o,n){var r,l=Lyte.registeredMixins["crm-detailcanvas-utils"],s=store.peekRecord("layout",o.getData("layoutId"));if(s=s.sections,"Show_Sections"===t.type){var d=s.filter((function(e){if(e.type&&"used"===e.type)return e.name===a}));r=d[0]}else"Show_Subforms"===t.type?s.filter((function(e){e.type&&"used"===e.type&&e.fields.some((function(e){e.api_name===a&&(r=e)}))})):s.filter((function(e){e.type&&"used"===e.type&&e.fields.some((function(e){if(e.id===a.id)return r=e,e}))}));if(r){var c=r;switch(e){case"Mandatory_Fields":if("First_Name"===r.api_name&&("Leads"===r.module[0].api_name||"Contacts"===r.module[0].api_name))break;var u;u="userlookup"===r.data_type?!i[r.api_name]:this.checkComparator(i[r.api_name],"${EMPTY}","equal",i,r.api_name,void 0,void 0,void 0,this,!0),n&&!l.LRuleManField.includes(c.id)&&u&&r.visible&&c.id!==l.blueprintFldId&&l.LRuleManField.push({targetFieldId:c.id}),n&&!l.LRuleManField.includes(c.id)&&c.id!==l.blueprintFldId&&l.revLRuleManField.push({targetFieldId:c.id});break;case"Show_Fields":if("First_Name"===r.api_name&&("Leads"===r.module[0].api_name||"Contacts"===r.module[0].api_name))break;var p=!!l.layoutRuleShowFld.filter((function(e){return e.showFldId===c.id})).length,m=l.revlayoutRuleShowFld.includes(c.id),f=l.revlayoutRuleShowSections.includes(r.section[0].name);f&&(n=!1),p||m?!n||p||f||l.suffleLRfields(l,c,!0):(n&&l.layoutRuleShowFld.push({showFldId:c.id}),n||l.revlayoutRuleShowFld.push(c.id));break;case"Show_Sections":var v=l.layoutRuleShowSections.includes(c.name),h=l.revlayoutRuleShowSections.includes(c.name);v||h?n&&!v&&l.suffleLRsections(l,c.name,!0):(n&&l.layoutRuleShowSections.push(c.name),n||l.revlayoutRuleShowSections.push(c.name));break;case"Show_Subforms":var g=!!l.layoutRuleSubformSections.filter((function(e){return e.subformId===c.id})).length,y=!1;if(n&&!g){l.layoutRuleSubformSections.push({subformId:c.id}),l.lRuleSubformSections.push(c.id);var b=l.revlayoutRuleSubformSections.indexOf(c.id);-1!==b&&l.revlayoutRuleSubformSections.splice(b,1),y=!0}var _=l.revlayoutRuleSubformSections.indexOf(c.id)>=0,x=l.lRuleSubformSections.indexOf(c.id)>=0;if(n||_||x||(l.revlayoutRuleSubformSections.push(c.id),y=!0),y){var z=$L("#"+c.id).closest(".zcanvassection");this.handlingShowOrhideFld(z,n)}}}},handlingShowOrhideFld:function(e,t){var a=e.length;if(a)for(var i=0;i<a;i++)t?e.removeClass("hide"):e.addClass("hide")},executeValidationRuleforAjaxEdit:function(e,t,a,i){var o=t.data.layoutId,n=[],r=t.getData("moduleData.fields");t.setData("vrPassed",!1);var l={};store.peekAll("validation_rule").filter((function(e){l[e.id]=[],l[e.id].push(e.field.api_name);for(var t=e.conditions?e.conditions.length:0,a=0;a<t;a++)if(e.conditions[a].sub_conditions)for(var i=e.conditions[a].sub_conditions.length,o=0;o<i;o++)if(e.conditions[a].sub_conditions[o].criteria&&e.conditions[a].sub_conditions[o].criteria.field)l[e.id].push(e.conditions[a].sub_conditions[o].criteria.field.api_name);else if(Array.isArray(e.conditions[a].sub_conditions[o].criteria))for(var n=e.conditions[a].sub_conditions[o].criteria.length,r=0;r<n;r++)e.conditions[a].sub_conditions[o].criteria[r].field&&l[e.id].push(e.conditions[a].sub_conditions[o].criteria[r].field.api_name)}));var s=Lyte.registeredMixins["crm-detailcanvas-utils"].blueprintFldId;s&&(s=store.peekRecord("field",s).api_name);var d=e.$.getDirtyAttributes();Crm.canvas&&Crm.canvas.stageStrip&&d.push("Stage");var c=[];if(c=store.peekAll("validation_rule").filter((function(e){return s?e.layout.id===t.data.layoutId&&l[e.id].intersection(d).length>0&&!l[e.id].contains(s):e.layout.id===t.data.layoutId&&l[e.id].intersection(d).length>0}))){var u=0,p=c.filter((function(e){var t=e.layout.id?e.layout.id:e.layout;return o===t&&e.active&&"function"===e.validation_type})),m=c.filter((function(e){var t=e.layout.id?e.layout.id:e.layout;return o===t&&e.active&&"criteria"===e.validation_type}));if(m.length+p.length){var f=[],v=0;p.forEach((function(a){var i=a.field.api_name,o=r.filter((function(e){return e.id===a.field.id}))[0];if(o.errorDetails&&(o.errorDetails={}),o.aggerrorDetails&&(o.aggerrorDetails={}),o&&o.visible&&o.view_type.edit){++v;var n={};n.column_name=o.column_name,n.uitype=o.ui_type,void 0===e[i]||""===e[i]?n.value="":n.value=e[i]+"",n.api_name=o.api_name,n.field_label=o.field_label,n.id=a.associated_function.id,n._targetFieldid=o.id,n.record=t.filterValidUITypes(e,"edit",r),f.push(n)}}));var h=v+m.length;v&&(Crm.canvas&&Crm.canvas.stageStrip&&(Crm.canvas.stageValidFunc=!0),store.triggerAction(e.$.model._name,"execute",{type:"POST",jsonData:f}).then((function(o){if(o&&o.functions&&t.handleVRFunctionResponse(t.getData("module"),o.functions,f,t,n,!1),h===(u+=v))if(i(e,n),!Crm.canvas||Crm.canvas&&!Crm.canvas.stageStrip)a(e,!(n.length>0||t.getData("vrPassed")));else if(Crm.canvas&&Crm.canvas.stageData&&!(t.getData("vrPassed")||n.length>0)){$L("crm-stage-verify-popup")[0].component.sendStageChange(Crm.canvas.stageData)}}),(function(){i(e,n)}))),m.forEach((function(o){var l,s;if(o.field){l=o.field.api_name,s=o.field.id;var d=r.filter((function(e){return e.id===s}))[0];delete d.isSecVal,d.errorDetails&&(d.errorDetails={}),d.aggerrorDetails&&(d.aggerrorDetails={}),d&&d.visible&&d.view_type.edit&&o.conditions&&t.fieldInPath(d)&&o.conditions.forEach((function(a){d.isSecVal||t.handleValidationRuleCondition(a,l,o.execution_type,t,e,s,n)}))}if(++u,h===u)if(i(e,n),!Crm.canvas||Crm.canvas&&!Crm.canvas.stageStrip)a(e,!(n.length>0||t.getData("vrPassed")));else if(Crm.canvas&&Crm.canvas.stageData&&!(t.getData("vrPassed")||n.length>0)){$L("crm-stage-verify-popup")[0].component.sendStageChange(Crm.canvas.stageData)}})),0===v&&0===m.length&&a(e,!(n.length>0||t.getData("vrPassed")))}else(!Crm.canvas||Crm.canvas&&!Crm.canvas.stageStrip)&&a(e,!(n.length>0||t.getData("vrPassed")))}},HandlindValidationRuleErrorforAjaxEdit:function(e,t,a,i){if(Crm.canvas&&Crm.canvas.stageStrip&&t.length>0){Crm.canvas.stageValidation=!0;var o={};return o[t[0].targetField]=t[0].message,$("#newRelatedListPopUpDiv").removeClass("w800").css("width","30%").html(Handlebars.templates.validationRuleError(o)),crmui.showPopup("newRelatedListPopUpDiv"),!1}if(Crm.canvas&&Crm.canvas.stageStrip)return!1;var n=$L("#changeOwnerPopUp"),r=n.length>0?n[0].component.data.fieldIdFol:$L("#AjaxEditFieldId")[0].value,l=$L("crm-canvas-ajaxeditpopup")[0].component,s=$L("#AjaxEditComponent");if(s=s[0],t.length>0&&(l&&!0!==l.getData("showAjaxPop")&&(t=t.filter((function(e){return r===e.targetFieldId&&(s=s.children[0].component,"layoutRule"!==a?s.setData("cxPropErrorMessage",e.message):(s.getData("cxPropField").required=!0,s.validate())),r!==e.targetFieldId}))),t.length>0)){var d=[];t.filter((function(e){d.push(e.targetFieldId),e.errMsg=!0}));var c=l.getData("errorRecord"),u=[];c.filter((function(e,a){u.push(e.targetFieldId),d.includes(e.targetFieldId)?t.filter((function(t){t.targetFieldId!==e.targetFieldId||Lyte.arrayUtils(c,"replaceAt",a,t)})):e.errMsg=!1}));var p=d.intersection(u),m=[];t.filter((function(e){p.includes(e.targetFieldId)||m.push(e)})),m=m.filter((function(e){return e.fldObj=store.peekRecord("field",e.targetFieldId),e.fldObj.visible})),Lyte.arrayUtils(l.getData("errorRecord"),"concat",m),l.setData("showAjaxPop",!0),window.CScriptLib&&i&&CScript.dispatchEvent("onMandatoryFormLoad",null,{apiname:i.api_name,value:e[i.api_name]})}},constructCompForAjaxEdit:function(e,t,a,i,o,n,r,l,s){var d,c=$L("crm-detailview-canvas")[0],u=c.component.data.layoutId,p=store.peekRecord("field",e);if("COUNTRY"===p.column_name){var m=c.component;d=JSON.stringify(m.getTextAutocompleteOptions({column_name:p.column_name})),d=$ESAPI.encoder().encodeForHTMLAttribute(d)}var f=p.$.toJSON();(a&&(f.required=!0),s)&&(r=((c.getData("cscriptconfigs")||{}).field||{})[p.id]);r&&r.maxlen&&(f.length=r.maxlen);var v="",h=void 0!==o&&o?n:this.preProcessFieldValue(t,p,l);["text","textarea"].includes(p.data_type)&&(h=$ESAPI.encoder().encodeForHTMLAttribute(h));var g=p.tooltip,y="";g&&"Static Text"===g.name&&(y=$ESAPI.encoder().encodeForHTMLAttribute(g.value)),i||(i="");var b,_=crmConstants.defaultUiTypeToCruxMapping[p.ui_type];if(_||(_=p.data_type),v="","picklist"!==p.data_type&&"multiselectpicklist"!==p.data_type||(b="Stage"===p.api_name?this.stageValues(p,t,u):p.canvasDependencyMap&&p.canvasDependencyMap.length>0?p.canvasDependencyMap:p[u]?p[u].pick_list_values:pick_list_values),96===p.ui_type)v="<crux-picklist-component cx-prop-error-message = '"+i+"' cx-prop-type ='multiple' cx-prop-from = 'create' cx-prop-placeholder='"+y+"' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(p))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(f))+"' cx-prop-value='"+JSON.stringify(h)+"' ></crux-picklist-component>";else if(36===p.ui_type||143===p.ui_type||144===p.ui_type||145===p.ui_type)v="<crux-"+_+"-component cx-prop-error-message = '"+i+"' cx-prop-clear-error-message='false' cx-prop-placeholder='"+y+"' cx-prop-display-currency='false' cx-prop-from = 'create' cx-prop-show-calculator='true' ",p.length&&(v+=" cx-prop-maxlength= '"+f.length+"'"),v+="cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(p))+"'  cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(f))+"' cx-prop-value='"+h+"' ></crux-"+_+"-component>";else if(35===p.ui_type)v="<crux-phone-component cx-prop-error-message = '"+i+"' cx-prop-placeholder='"+y+"' cx-prop-from = 'create'",f.length&&(v+=" cx-prop-maxlength= '"+f.length+"'"),v+="cx-prop-appearance='box'  data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(p))+"'    cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(f))+"' cx-prop-value='"+h+"' ></crux-phone-component>";else if(555===p.ui_type)v="<crm-file-upload cx-Prop-View='false' class='canvasCruxComponent' lyte-unbound = 'false' data-zcqa ='"+this.getZcqa(p)+"' cx-Prop-Empty-Value=\"-\" cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(f))+"' cx-prop-fieldvalue='"+h+"'></crm-file-upload>";else if("multiselectpicklist"===p.data_type)p.canvasDependencyMap&&0===p.canvasDependencyMap.length&&delete p.canvasDependencyMap,v="<crux-"+_+"-component cx-prop-error-message = '"+i+"' cx-prop-type ='multiple' cx-prop-placeholder='"+y+"' cx-prop-picklist-values = ' "+JSON.stringify(b)+" '  cx-prop-from = 'create' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(p))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(f))+"' cx-prop-value='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(h))+"' ></crux-"+_+"-component>";else if("multiuserlookup"===p.data_type)v="<crux-user-component cx-prop-error-message = '"+i+"' cx-prop-placeholder='"+y+"' cx-prop-max-limit='10' cx-prop-filterable='false' cx-prop-filter-options='[{\"id\":\"ActiveUsers\",\"category\":\"Active\"}]' cx-prop-type ='multiple' cx-prop-from = 'create' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(p))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(f))+"' cx-prop-value=''></crux-user-component>";else if("userlookup"===p.data_type){h&&(h.name||h.id)&&(h=JSON.stringify(h));const t=store.peekRecord("field",e);let a="";t&&t.lookup&&(a=t.lookup.query_details),v="<crux-user-component cx-prop-error-message = '"+i+"' cx-prop-query-param='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(a))+"' cx-prop-placeholder='"+y+"' cx-prop-filterable='false' cx-prop-filter-options='[{\"id\":\"ActiveUsers\",\"category\":\"Active\"}]' cx-prop-show-close-icon='true'  cx-prop-from = 'create' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(p))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(f))+"' cx-prop-value='"+h+"' ></crux-user-component>"}else if("datetime"===p.data_type||"date"===p.data_type)v="<crux-"+_+"-component cx-prop-error-message = '"+i+"' cx-prop-placeholder='"+y+"' cx-prop-clear-error-message='false' cx-prop-default-time='"+this.getNearestDate()+"'cx-prop-date-in-user-pattern = 'true' cx-prop-datetime-in-user-pattern='true' cx-prop-from = 'create' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(p))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(f))+"' cx-prop-value='"+h+"' ></crux-"+_+"-component>";else if("lookup"===p.data_type){var x=p.lookup.module.id,z=store.peekRecord("module",x),R=z.module_name,L=I18n.getMsg("crm.label.lookup.norecord",z.singular_label)+" ";v="<crux-"+_+"-component cx-prop-footer-yield = 'true' cx-prop-placeholder='"+y+"' cx-prop-error-yield = 'true' cx-prop-popover-wrapper-class=\"zclookupTooltip\" cx-prop-from = 'create' cx-prop-create-yield='true' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(p))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(f))+"' cx-prop-value='"+JSON.stringify(h)+"' >","Quotes"!==R&&"PriceBooks"!==R&&(v+="<template is='yield' yield-name= 'footer'><span id='lookupFldId_"+f.id+"' onclick=\"Customization.quickCreatePop( "+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(f))+", false, "+a+");\" class='lookupFldVal link1 pL10 dIB'> +"+I18n.getMsg("crm.module.new",z.singular_label)+" </span></template>",v+="<template is='yield' yield-name= 'createYield'><span id='lookupFldId_"+f.id+"' onclick=\"Customization.quickCreatePop( "+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(f))+", true, "+a+");\" class='lookupFldVal outlineprimaryflat link1 pL10 dIB'> "+I18n.getMsg("crm.module.new",z.singular_label)+" </span></template> "),v+="<template is='yield' yield-name= 'errorYield'>",v+="Quotes"!==R&&"Invoices"!==R&&"SalesOrders"!==R&&"PurchaseOrders"!==R&&"Services"!==R?"<div><span class='cruxErrMsg cruxErrorMsgDesc'>"+L+'<u><span class="link1" onclick="Customization.quickCreatePop( '+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(f))+", false, "+a+')">'+I18n.getMsg("crm.label.create.new")+" "+z.singular_label+"</span></u></span></div>":"<div><span class='cruxErrMsg cruxErrorMsgDesc'>"+L+"</span></div>",v+="</template></crux-"+_+"-component>"}else if("picklist"===p.data_type){p.canvasDependencyMap&&0===p.canvasDependencyMap.length&&delete p.canvasDependencyMap;var C="";p.enable_colour_code&&(C=" cx-prop-is-color-code-enabled="+p.enable_colour_code),v="<crux-"+_+"-component "+C+"  cx-prop-error-message = '"+i+"' cx-prop-placeholder='"+y+"' cx-prop-from = 'create' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(p))+"'  cx-prop-picklist-values = ' "+JSON.stringify(b)+" '  cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(f))+"' cx-prop-value='"+h+"' ></crux-"+_+"-component>"}else v="<crux-"+_+"-component cx-prop-error-message = '"+i+"' cx-prop-placeholder='"+y+"' cx-prop-clear-error-message='false' cx-prop-from = 'create'","Email_Opt_Out"===p.api_name&&"EMAILOPTOUT"===p.column_name&&"boolean"===p.data_type&&301===p.ui_type&&(v+="class='"+p.api_name+"' id='zc-edit-el-confirm'"),f.length&&(v+=" cx-prop-maxlength= '"+f.length+"'"),"text-area"===_&&(v+=" class = 'cxBigTextarea' cx-prop-prevent-collapse = 'true' "),"Country"===p.api_name&&"COUNTRY"===p.column_name&&(v+="cx-prop-autocomplete-options='"+d+"'"),"Email_Opt_Out"===p.api_name&&"EMAILOPTOUT"===p.column_name&&"boolean"===p.data_type&&301===p.ui_type?v+="class='"+p.api_name+"' id='zc-edit-el-confirm' cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(p))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(f))+"' cx-prop-value='"+t.Email_Opt_Out+"' ></crux-"+_+"-component>":v+="cx-prop-appearance='box' data-zcqa ='"+$ESAPI.encoder().encodeForHTMLAttribute(this.getZcqa(p))+"' cx-prop-field ='"+$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(f))+"' cx-prop-value='"+h+"' ></crux-"+_+"-component>";return v},stageValues:function(e,t,a){var i=[],o=store.peekAll("stage");if(t.Pipeline){for(var n=!0,r=store.peekAll("field").filter((function(e){if("Pipeline"===e.api_name)return!0})),l=(r=r[0][a].pick_list_values).length,s=0;s<l;s++)if(t.Pipeline===r[s].display_value){for(var d=r[s].maps[0].pick_list_values.length,c=0;c<d;c++)o.forEach((function(e){e.name===r[s].maps[0].pick_list_values[c].actual_value&&i.push(r[s].maps[0].pick_list_values[c])}));n=!1}if(n){var u=e.pick_list_values.filter((function(e){return e.display_value===t.Stage})),p={};p.display_value=u[0].display_value,p.actual_value=u[0].actual_value,u[0].colour_code&&(p.colour_code=u[0].colour_code),i.push(p)}}else i=e[a].pick_list_values;return i},canvasDependencyfieldHandling:function(e,t,a){for(var i,o,n,r,l,s,d=store.peekRecord("layout",e).fields.filter((function(t){return"picklist"===t.data_type&&t[e].pick_list_values&&t[e].pick_list_values[0].maps.length>0})),c=d.length,u=0;u<c;u++){i=void 0===t[(o=d[u]).api_name]?"-None-":t[o.api_name],r=(n=o[e].pick_list_values).length;for(var p=0;p<r;p++)if(n[p].display_value===i){s=n[p].maps.length;for(var m=0;m<s;m++)(l=this.getFieldByFieldApiNameandModuleApiName(n[p].maps[m].api_name,a))[0]&&(l[0].canvasDependencyMap=n[p].maps[m].pick_list_values)}}},getFieldByFieldApiNameandModuleApiName:function(e,t){return store.peekAll("field").filter((function(a){return a.api_name===e&&a.module&&a.module[0].api_name===t}))},validatingCanvasRule:function(e,t){for(var a=store.peekAll("canvas_rule").filter((function(t){return t.module.api_name===e})),i=Lyte.registeredMixins["crm-create-mixin"],o=a.length,n=[],r=[],l=0;l<o;l++)i.checkCriteriaMatchForCanvas(a[l].criteria,t,i)?r.push(a[l].zcid):n.push(a[l].zcid);r.push("zcanvas_zcdefaultcontd");var s=$("crm-detailview-canvas");s.attr("class",""),s.removeClass(n.join(" ")).addClass(r.join(" ")),this.expandcombinedcriteria(s);for(var d=$L("crm-related-list-canvas"),c=d.length,u=s.attr("class"),p=0;p<c;p++)d[p].component.setData("mainmodulerule",u)},getDuplicateErrorMsg:function(e){var t=Crm.userDetails.MODULE_LIST[objectUtils.getMatchedKey(moduleApiMapping,e.duplicate_record.module.api_name)],a=t.singular_label,i=store.peekAll("field").filter((function(t){return t.api_name===e.api_name}))[0].field_label,o=e.duplicate_record.id,n=I18n.getMsg("crm.duplicate.value.not.allowed");if(!1===e.more_records){n+=I18n.getMsg("crm.duplicate.value.available",[a,i]),n=$ESAPI.encoder().encodeForHTML(n);var r=Crm.getCrmBasePath()+"/EntityInfo.do?module="+t.module_name+"&id="+o;r=Crm.getPortalURL(r),n+=" <a data-zcqa='viewExistingRecord' class='viewExistingRecordQuickInfo' id='viewExistingRecordQuickInfo' onmouseleave=\"Crm.dontHideQuickInfoPop(event);\" onmouseenter=\"Customization.canvasDvRecordPopup('"+t.api_name+"','"+o+"','"+e.duplicate_record.Owner.zuid+"',this)\" rel='noopener noreferrer' target='_blank' href='"+r+"'>"+I18n.getMsg("crm.view.record",I18n.getMsg(moduleRecordMapping.Leads.singular_label))+"</a>"}else n+=I18n.getMsg("crm.duplicate.value.available.multiple",[a,i]),n=$ESAPI.encoder().encodeForHTML(n),n+='<link-to lt-prop-target="_blank" lt-prop-route="crm.tab.module.entity.find-and-merge" lt-prop-qp=\'{"findDupFldName" :"'+i+"\"}'    lt-prop-dp='[\""+t.module_name+'","'+o+"\"]'>"+I18n.getMsg("crm.label.module.merge",I18n.getMsg(t.plural_label))+"</link-to>";return n},executingLayoutRule:function(){var e=Lyte.registeredMixins["crm-detailcanvas-utils"];e.revlayoutRuleShowFld.filter((function(t){var a=store.peekRecord("field",t),i=$L(".fieldupdate_"+a.column_name).closest(".zcanvas-field ");e.handlingShowOrhideFld(i,!1)}));var t=$L("crm-detailview-canvas")[0].component.data.layoutId;store.peekRecord("layout",t).sections.filter((function(t){return e.revlayoutRuleShowSections.includes(t.name)})).filter((function(t){t.fields.filter((function(t){var a=store.peekRecord("field",t.id),i=$L(".fieldupdate_"+a.column_name).closest(".zcanvas-field ");e.handlingShowOrhideFld(i,!1)}))}))},executeLRsubform:function(){var e=Lyte.registeredMixins["crm-detailcanvas-utils"],t=store.peekAll("field").filter((function(t){return e.revlayoutRuleSubformSections.includes(t.id)}));store.peekAll("field").filter((function(t){return e.lRuleSubformSections.includes(t.id)})).filter((function(t){var a=$L("#"+t.id).closest(".zcanvassection");e.handlingShowOrhideFld(a,!0)})),t.filter((function(t){var a=$L("#"+t.id).closest(".zcanvassection");e.handlingShowOrhideFld(a,!1)}))},executeLRSections:function(){var e=Lyte.registeredMixins["crm-detailcanvas-utils"],t=$L("crm-detailview-canvas")[0];if(t){var a=store.peekRecord("layout",t.component.data.layoutId),i=(a=a.sections).filter((function(t){if(t.type&&"used"===t.type)return e.revlayoutRuleShowSections.includes(t.name)}));a.filter((function(t){if(t.type&&"used"===t.type)return e.layoutRuleShowSections.includes(t.name)})).filter((function(t){if(t.fields[0]){var a=$L(".fieldupdate_"+t.fields[0].column_name).closest(".zc-fieldsectionallfield");e.handlingShowOrhideFld(a,!0)}})),i.filter((function(t){if(t.fields[0]){var a=$L(".fieldupdate_"+t.fields[0].column_name).closest(".zc-fieldsectionallfield");e.handlingShowOrhideFld(a,!1)}}))}},fldinBluePrint:function(e){var t=Lyte.registeredMixins["crm-detailcanvas-utils"],a=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];if(e.$process_flow){var i=new crmRequestPool,o="/crm/v2.2/"+moduleApiMapping[a]+"/"+e.id+"/actions/blueprint",n={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};i.initiate({type:"GET",url:o,data:"",headers:n,success:function(e){t.blueprintFldId=e.blueprint.process_info.field_id,t.isBluePrintTrans=!!e.blueprint.transitions.length},error:function(){t.blueprintFldId=void 0}})}else t.blueprintFldId=void 0},getNearestDate:function(){var e=new Date;e.setMinutes(0);var t=!1;"HH:mm"===Crm.userDetails.TIME_FORMAT&&(t=!0);var a="";if(t)a=Utils.formatTimeVal(e.getHours())+":"+Utils.formatTimeVal(e.getMinutes());else{var i=Utils.convertTo12HoursFormatTimeObj(e);a=i.hrs+":"+i.mins+" "+I18n.getMsg(i.meridiem.toUpperCase())}return a},layoutEditPermissionCheck:function(e,t){var a=moduleRecordMapping[e].layouts.filter((function(e){return"Standard"!==e.name}));if(t.Layout&&"Standard"!==t.Layout.name)return!0;for(var i=a.filter((function(e){return"active"===e.status})),o=i.length,n=0,r=0;r<o;r++)i[r].profiles.filter((function(e){return e.name===Crm.userDetails.PROFILE_NAME})).length>0&&n++;return n>0},executelayoutRuleforCurrentRec:function(){var e=$L("crm-detailview-canvas")[0];if(e){e=e.component;var t=Lyte.registeredMixins["crm-detailcanvas-utils"];t.LRuleManField=[],t.layoutRuleShowFld=[],t.layoutRuleShowSections=[],t.layoutRuleSubformSections=[],t.revlayoutRuleShowFld=[],t.revlayoutRuleShowSections=[],t.revlayoutRuleSubformSections=[],t.revLRuleManField=[],t.lRuleSubformSections=[],t.executeLayoutRuleforAjaxEdit(e.getData("originalRecord"),e)}},tabOnNavigation:function(e,t){var a=e.find(".zc-tabs");a.length&&$L.fastdom.measure((function(){var e=t||parseInt(a[0].scrollLeft),i=parseInt(a[0].scrollWidth),o=parseInt(a[0].clientWidth),n=e<=0,r=e+o>=i;$L.fastdom.mutate((function(){var e=a.next();e.find(".zcnavleft")[n?"addClass":"removeClass"]("zc-disabled-tool"),e.find(".zcnavright")[r?"addClass":"removeClass"]("zc-disabled-tool")}))}))},removePicklistprops:function(e,t){var a=store.peekRecord("field",e.id),i=["color","background-color","border","border-top","border-bottom","border-left","bottom-right","padding","padding-top","padding-bottom","padding-left","padding-right","border-radius","border-top-left-radius","border-top-right-radius","border-bottom-left-radius","border-bottom-right-radius"],o=i.length,n=!t||"row"!==t._type;if(a&&a.enable_colour_code&&e.ui&&e.ui.field&&n){var r=e.ui.field.style;for(var l in r)for(var s=0;s<o;s++)delete r[l][i[s]]}},handleStageInTabLayout:function(){for(var e=$L(".zctabview"),t=e.length,a=Lyte.Router.getRouteInstance().currentModel,i=0;i<t;i++)for(var o=e[i].getElementsByTagName("LI"),n=o.length,r=0;r<n;r++)if(o[r].textContent===I18n.getMsg("Stage")||o[r].textContent===I18n.getMsg("crm.label.cf.blueprint"))if(a.record.$process_flow){var l=Lyte.registeredMixins["crm-detailcanvas-utils"],s=l.showStage,d=l.isBluePrintTrans;(s||d)&&d&&!clientPortalName?o[r].textContent=I18n.getMsg("crm.label.cf.blueprint"):o[r].textContent=I18n.getMsg("Stage")}else o[r].textContent=I18n.getMsg("Stage")},fieldInvolvedInZia:function(e,t){for(var a=!1,i=e.$zia_visions.length,o=0;o<i;o++)t===e.$zia_visions[o].field.id&&(a=!0);return a},sectionfieldmapping:function(e){var t={zcanvasId:"#zcanvas_us58qoeplr",_type:"component",ui:{value:{position:{startX:30,startY:52,endX:1278,width:"calc(100% - 60px)",height:480,minTop:5},style:{},class:"zclayout-table zcrestricttable zcnochange",layoutstyle:{row:{height:"50px"},field:{width:"50%"},inner:[{percent:34.80194017784964},{percent:35.12530315278901}]}}},theme:"Table Layout",children:[]};t.zcanvasId=zutils.getRandomId();for(var a={_type:"row",ui:{value:{position:{startX:0,startY:5,endX:1259,width:1259,height:50},style:{},class:"zcanvas-row"}},children:[]},i={zcanvasId:"zcanvas_3kga5lwc3z4",datatype:"user",type:"field",_type:"field",ui:{value:{style:{},position:{startX:0,startY:0,endX:625,width:625,height:50},tagname:"DIV",class:"zcanvas-field"},holder:{style:{},tagname:"SPAN",class:""},field:{style:{},tagname:"SPAN",class:""},label:{style:{},tagname:"SPAN",class:""}},fieldContainer:"#zcanvas_menu",group:"field",children:[]},o={ui:{value:{class:"zc-table-cell"}},children:[],_type:"empty-field"},n=t,r=Math.round(e.length/2),l=0,s=0;s<r;s++){var d=JSON.parse(JSON.stringify(a)),c=objectUtils.cloneObject_new(i);if(c.zcanvasId=zutils.getRandomId(),d.children.push(c),2*(s+1)<=e.length){var u=objectUtils.cloneObject_new(i);u.zcanvasId=zutils.getRandomId(),d.children.push(u)}else{o=objectUtils.cloneObject_new(o);d.children.push(o)}n.children.push(d),l+=50}return n.ui.value.position.height=l,n},sectionview:function(e,t,a){for(var i=[],o=t.length,n=0;n<o;n++){var r=t[n];createStruture.singleshotrender&&(r=store.peekRecord("field",r.id)),r&&("Sales_Cycle_Duration"!==r.api_name&&"Lead_Conversion_Time"!==r.api_name&&"Overall_Sales_Duration"!==r.api_name&&"Data_Processing_Basis_Details"!==r.api_name&&"Unsubscribed_Mode"!==r.api_name&&"Unsubscribed_Time"!==r.apiName&&(!r.visible||this.scoreColumn.indexOf(r.column_name)>-1||i.push(r)))}var l=this.sectionfieldmapping(i),s=i.map((function(e){return e.id})),d=this.processRelListObj(l,a.record,a.module,s,void 0,void 0,!0),c=d.children,u=c.length,p=e.ui.value.tablestyles?e.ui.value.tablestyles:{},m=p.rows||[],f=p.fields||{},v=e.ui.value.tablestyles&&e.ui.value.tablestyles.table&&!$u.isEmpty(e.ui.value.tablestyles.table)?e.ui.value.tablestyles.table:l.ui.value,h=v.position&&v.position.width;for(n=0;n<u;n++){var g=m[n];g&&(c[n].ui.value.style=g.value.style,c[n].ui.value.system_id=g.value.system_id,this.handledeletion(c[n]));for(var y=(t=c[n].children).length,b=0;b<y;b++){var _=t[b].id;if(f[_]?(t[b].ui=f[_],this.handledeletion(t[b])):t[b].ui=f.commonfield?objectUtils.cloneObject_new(f.commonfield):JSON.parse('{"value":{"style":{},"position":{"startX":0,"startY":0,"endX":625,"width":625,"height":50},"tagname":"DIV","class":"zcanvas-field"},"holder":{"style":{},"tagname":"SPAN","class":""},"field":{"style":{},"tagname":"SPAN","class":""},"label":{"style":{},"tagname":"SPAN","class":""}}'),_){var x=i[i.map((function(e){return e.id})).indexOf(_)];createStruture.singleshotrender||this.addAjaxEditDetails(x,c[n],t[b])}}var z={ui:{value:{style:{default:{"flex-direction":"column",display:"flex","margin-right":"0%"}},position:{endX:1644,depth:1,width:1646,startY:0,startX:0,height:50}}},children:[],_type:"dummyDiv"},R={ui:{value:{style:{default:{"flex-direction":"column",display:"flex","margin-right":"0%"}},position:{endX:1646,singleCellWidth:"",width:1646,startY:0,startX:0,height:50},class:["row"]}},children:[{ui:{value:{style:{default:{}},position:{endX:1644,depth:1,width:1646,startY:0,startX:0,height:50}}},children:[],_type:"dummyDiv"}],_type:"dummyDiv",divType:"row"};R.children[0].children=[objectUtils.cloneObject(c[n])],z.children=[R],h&&(z.ui.value.position.width=h,z.ui.value.position.endX=h,R.ui.value.position.width=h,R.ui.value.position.endX=h,R.children[0].ui.value.position.width=h,R.children[0].ui.value.position.endX=h),c[n]=z}(z={ui:{value:{style:{default:{"flex-direction":"column",display:"flex","margin-right":"0%"}},position:{endX:1644,depth:1,width:1646,startY:0,startX:0,height:50}}},children:[],_type:"dummyDiv"}).children=d.children,l.children=[z],h&&(z.ui.value.position.width=h,z.ui.value.position.endX=h);var L=zclayout.prototype.layouts["Table Layout"],C=document.createElement("div");$L(C).attr("id",zutils.getRandomId()).css({"min-height":l.ui.value.position.height,height:"auto"}),C.classList.add("zclayout-table"),l.ui.value.layoutstyle=e.ui.value.tablestyles&&e.ui.value.tablestyles.layoutstyles?e.ui.value.tablestyles.layoutstyles:l.ui.value.layoutstyle,l.ui.value=v,v&&v.style&&Lyte.registeredMixins["crm-detailcanvas-utils"].handleDynamicSectionVisibility(l,v.style),this.handledeletion(l);var w=L.toView(l,C);return w&&l.ui.value&&l.ui.value.system_id&&$L(C).addClass("canvasselectableelemnt canvas-element-id-"+l.ui.value.system_id),C.appendChild(w[0]),C},getEmptyNodeFromTree:function(e){return e.children.length?this.getEmptyNodeFromTree(e.children[0]):e},handleDynamicSectionVisibility:function(e,t){if(e&&e.ui&&e.ui.value&&e.ui.value.style&&t)for(var a in t){var i=t[a];e.ui.value.style[a]||(e.ui.value.style[a]={}),"true"===i._hide_?e.ui.value.style[a].display="none":"true"===i._show_&&(e.ui.value.style[a].display="flex")}},allFieldFormation:function(e){if(e.children.length&&!e.ui.allfieldstabstyle&&(e=this.extractInfoFromSection_View(e)).children&&e.children.length)return e;var t,a=$L("crm-detailview-canvas-gallery")[0];t=a&&a.component.getData("isGalleryVisible")?'{"ui":{"value":{ "class" : "zc-list-component" , "position" : {"minTop" : "30","minLeft":"30","width" : '+(e.ui.value.position.width-60)+'} , "style": {"default" : {"overflow":"auto" , "padding-left":"30px" , "padding-top":"30px"} } }},"_type":"component","theme":"Custom Layout","relatedList":true,"children":[{},{"_type":"relatedlist","ui":{"value":{"position": {}}},"id":"","theme":"LazyLoad Component","lazyload":true,"children":[]}]}':'{"ui":{"value":{ "class" : "zc-list-component zc-fieldsectionallfield" , "position" : {"minTop" : "30","minLeft":"30","width" : '+(e.ui.value.position.width-60)+'} , "style": {"default" : {"overflow":"auto" , "padding-left":"30px" , "padding-top":"30px"} } }},"_type":"component","theme":"Custom Layout","relatedList":true,"children":[{},{"_type":"relatedlist","ui":{"value":{"position": {}}},"id":"","theme":"LazyLoad Component","lazyload":true,"children":[]}]}';var i=JSON.parse('{"ui":{"value":{"style":{"default":{"flex-direction":"column","display":"flex"}},"position":{"endX":1629,"singleCellWidth":"","width":1609,"startY":10,"startX":20,"height":2770},"class":["row"]}},"children":[],"_type":"dummyDiv","divType":"row"}');i.ui.value.position.width=e.ui.value.position.width-60,i.ui.value.position.endX=e.ui.value.position.endX-30;var o=!1,n=document.querySelector("crm-detailview-canvas");n||(n=document.querySelector("crm-detailview-canvas-gallery"),o=!0);var r=n?n.getData("layoutId"):Lyte.Router.getRouteInstance().transition.info.dynamicParams[1],l=store.peekRecord("layout",r),s=e.ui.allfieldstabstyle||{};if(l){for(var d=l.sections,c=d.length,u=0;u<c;u++){var p=JSON.parse('{"ui":{"value":{"style":{"default":{"flex-direction":"column","display":"flex","margin-right":"2.3966446%"}},"position":{"endX":1629,"singleCellWidth":"","width":1609,"startY":10,"startX":20,"height":2770},"class":["row"]}},"children":[{"ui":{"value":{"style":{"default":{"flex-direction":"column","display":"flex","margin-bottom":"30px"}},"position":{"endX":1629,"singleCellWidth":"","width":1609,"startY":10,"startX":20,"height":1350},"class":["column"]}},"children":[{"ui":{"value":{"style":{"default":{"margin-left":"0%","flex-direction":"column","display":"flex","margin-right":"0%"}},"position":{"endX":1629,"singleCellWidth":"","width":1609,"startY":10,"startX":20,"height":1350},"class":["row"]}},"children":[{"ui":{"value":{"style":{"default":{}},"position":{"endX":1629,"depth":1,"width":1609,"startY":10,"startX":20,"height":1350}}},"children":[],"_type":"dummyDiv"}],"_type":"dummyDiv","divType":"row"}],"_type":"dummyDiv","divType":"column"}],"_type":"dummyDiv","divType":"row"}'),m=Lyte.registeredMixins["crm-detailcanvas-utils"].getEmptyNodeFromTree(p),f=d[u].fields&&1==d[u].fields.length&&d[u].fields[0].data_type.indexOf("profileimage")>-1,v=d[u].fields&&1==d[u].fields.length&&("Product_Details"===d[u].fields[0].api_name||"Pricing_Details"===d[u].fields[0].api_name),h=d[u].isSubformSection,g=!d[u].fields||0===d[u].fields.length,y="Score Summary"===d[u].api_name,b=0===d[u].fields.filter((function(e){return e.visible})).length;if(!(f||h||g||y||v||b)){var _=s[d[u].uid]||{},x=JSON.parse(t);x.zcanvasId=zutils.getRandomId(),x.ui=_.sectionstyle?_.sectionstyle:x.ui,p.ui.value.position.width=x.ui.value.position.width,Lyte.registeredMixins["crm-detailcanvas-utils"].handleDynamicSectionVisibility(p,x.ui.value.style);var z=x.children;z[0]=_.titlesection?_.titlesection:JSON.parse('{"zcanvasId":"zcanvas_of4y9sszxd","ui":{"value":{"tagname":"DIV","style":{"default":{}},"position":{"endX":855,"depth":1,"width":825,"minTop":11,"startY":30,"startX":30,"height":50,"minLeft":10},"class":"zcanvas-title-editor"}},"children":[{"ui":{"value":{"style":{"default":{"flex-direction":"column","display":"flex","margin-right":"82.545456%"}},"position":{"endX":174,"singleCellWidth":"","width":164,"startY":11,"startX":10,"height":22},"class":["row"]}},"children":[{"ui":{"value":{"style":{"default":{}},"position":{"endX":174,"depth":1,"width":164,"startY":11,"startX":10,"height":22}}},"children":[{"zcanvasId":"zcanvas_qvm51ys1n1","ui":{"autoheight":false,"value":{"tagname":"DIV","style":{"default":{"background-color":"transparent"}},"position":{"endX":174,"depth":1,"width":164,"startY":11,"startX":10,"height":22},"class":"zc_disabled","value":"${section.title}"}},"children":[],"_type":"component","theme":"Static Text","componentid":true}],"_type":"dummyDiv"}],"_type":"dummyDiv","divType":"row"}],"_type":"static_content","theme":"Custom Layout"}'),z[0].zcanvasId=zutils.getRandomId();var R=this.findComponentNodeOnTreeByCondition(z[0],{classname:"zc_disabled"});if(R||(R=this.findComponentNodeonTree(z[0])),R&&R.ui&&R.ui.value&&(R.ui.value.value=d[u].display_label),z[1].id=d[u].uid,o)z[1]&&(z[1].ui=_.datastyle?_.datastyle:{value:{position:{}}});else{var L=Lyte.Router.getRouteInstance().getDynamicParam()||Math.random().toString().substr(2,9),C=d[u].uid;z[1].componentid=(C+L.toString()+"11").replace("_","000"),z[1].ui=_.datastyle?_.datastyle:{value:{position:{}}},x.id=(C+L.toString()+"1").replace("_","000"),z[0].id=(C+L.toString()+"10").replace("_","000")}m.children=[x],i.children.push(p)}}e.children.push(i)}return e},extractInfoFromSection:function(e){if(!this.isSectionMigrationNeed)return e;var t=e.children,a=t.length;e.ui.allfieldstabstyle={};for(var i=0;i<a;i++){var o=t[i],n=o.ui,r=o.children;r[0].ui.value.class="zcanvas-title-editor",r[0]._type="static_content",r[0].theme="Custom Layout";for(var l={fields:{},layoutstyles:r[1].ui.value.layoutstyle,rows:[],table:r[1].ui.value.style},s=r[1].children,d=s.length,c=0;c<d;c++){l.rows.push(s[c].ui);for(var u=s[c].children,p=u.length,m=0;m<p;m++)l.fields[u[m].id]=u[m].ui}var f=r[1].ui;f.value.tablestyles=l,delete f.value.layoutstyle;var v={sectionstyle:n,titlesection:r[0],datastyle:f};e.ui.allfieldstabstyle[o.sectionId]=v}return e.children=[],e},findComponentNodeOnTreeByCondition:function(e,t){return e?e&&t&&t.classname&&e.ui&&e.ui.value&&e.ui.value.class&&e.ui.value.class.indexOf(t.classname)>-1?e:this.findComponentNodeOnTreeByCondition(e.children[0],t):null},findComponentNodeonTree:function(e){return e?e&&e.componentid?e:this.findComponentNodeonTree(e.children[0]):null},findSectionElementsinTree:function(e){for(var t=e.children,a=t.length,i=[],o=0;o<a;o++)i.push(this.findComponentNodeonTree(t[o]));return i},extractInfoFromSection_View:function(e){if(!this.isSectionMigrationNeed)return e;var t=e.children,a=t.length;e.ui.allfieldstabstyle={};for(var i=0;i<a;i++)for(var o=this.findSectionElementsinTree(t[i]),n=o.length,r=0;r<n;r++){for(var l={sectionstyle:o[r].ui,titlesection:null,datastyle:null},s=o[r].children[0].children,d=s.length,c=0;c<d;c++)for(var u=this.findSectionElementsinTree(s[c]),p=u.length,m=0;m<p;m++)if("Custom Layout"===u[m].theme)u[m].ui.value.class="zcanvas-title-editor",u[m]._type="static_content",u[m].theme="Custom Layout",l.titlesection=u[m];else if("Table Layout"===u[m].theme){for(var f={fields:{},layoutstyles:u[m].ui.value.layoutstyle,rows:[],table:u[m].ui.value},v=u[m].children[0].children,h=v.length,g=0;g<h;g++){var y=this.findSectionElementsinTree(v[g]);if(y.length){f.rows.push(y[0].ui);for(var b=y[0].children,_=b.length,x=0;x<_;x++){var z=b[x];f.fields[z.id]=z.ui?z.ui:JSON.parse('{"value":{"style":{},"position":{"startX":0,"startY":0,"endX":625,"width":625,"height":50},"tagname":"DIV","class":"zcanvas-field"},"holder":{"style":{},"tagname":"SPAN","class":""},"field":{"style":{},"tagname":"SPAN","class":""},"label":{"style":{},"tagname":"SPAN","class":""}}')}}}var R=u[m].ui;R.value.tablestyles=f,delete R.value.layoutstyle,l.datastyle=R}e.ui.allfieldstabstyle[o[r].sectionId]=l}return e.children=[],e},addAjaxEditDetails:function(e,t,a){var i=e.id;if((e.api_name&&a.ui&&a.ui.value&&(a.ui.value.class||(a.ui.value.class=""),a.ui.value.class+=" canvasselectablefield canvas-element-apiname-"+e.api_name,a.ui.value.attr={"data-apiname":e.api_name}),this.isAjaxEditableField(i,!0))&&((a.ui.holder||a.ui.field).interactions=[{event:"onmouseover",handler:"{{action('handleMouseActions',this, event)}}"},{event:"onmouseout",handler:"{{action('handleMouseActions',this, event)}}"}],a.ui.field)){a.ui.value&&(a.ui.value.class?a.ui.value.class+=" zcanvas-table-row-field":a.ui.value.class="zcanvas-table-row-field",t.ui.value&&t.ui.value.position&&t.ui.value.position.height<25&&(a.ui.value.class+=" zcanvas-low-size-row"));var o="";if(a.ui.value&&a.ui.value.class&&a.ui.value.class.indexOf("zctextarea")>-1&&(o="non-center-edit"),a.ui.field&&a.ui.field.style&&a.ui.field.style.default&&a.ui.field.style.default["vertical-align"]){var n=a.ui.field.style.default["vertical-align"];"top"===n?o+=" zc-top-edit-icon":"bottom"===n&&(o+=" zc-bottom-edit-icon")}a.ui.field.extrahtml="<span data-zcqa='"+$ESAPI.encoder().encodeForHTML(e.field_label)+"' class='zc-ajax-edit zc-ajax-edit-inner "+o+"' onclick={{action('handleeditButton')}}></span>"}},onSpecialCompLoaded:function(e){var t=document.querySelector("crm-detailview-canvas");if(t){var a=t.getData("excludecomps");if(a){for(var i=e.length,o=0;o<i;o++)a[e[o]]=!0;t.setData("excludecomps",a),t.component.onSpecialCompLoadedComp.bind(t.component)()}}},ignoreSystemvalues:function(e){if("object"==typeof e){var t={};for(var a in e)0!==a.indexOf("$")&&(t[a]=e[a]);return t}return e},sanitizeCscriptValue:function(e){if(Array.isArray(e)){for(var t=e.length,a=[],i=0;i<t;i++)a.push(this.sanitizeCscriptValue(e[i]));return a}return"object"==typeof e?this.ignoreSystemvalues(e):e},suffleLRfields:function(e,t,a){var i=!!e.layoutRuleShowFld.filter((function(e){return e.showFldId===t.id})).length,o=e.revlayoutRuleShowFld.includes(t.id);if(a){if(i||e.layoutRuleShowFld.push({showFldId:t.id}),o)for(var n=e.revlayoutRuleShowFld.length,r=0;r<n;r++)e.revlayoutRuleShowFld[r]===t.id&&(e.revlayoutRuleShowFld.splice(r,1),n=e.revlayoutRuleShowFld.length,r--)}else if(o||e.revlayoutRuleShowFld.push(t.id),i)for(n=e.layoutRuleShowFld.length,r=0;r<n;r++)e.layoutRuleShowFld[r].showFldId===t.id&&(e.layoutRuleShowFld.splice(r,1),n=e.layoutRuleShowFld.length,r--)},suffleLRsections:function(e,t,a){var i=e.layoutRuleShowSections.includes(t),o=e.revlayoutRuleShowSections.includes(t);if(a){if(i||e.layoutRuleShowSections.push(t),o)for(var n=e.revlayoutRuleShowSections.length,r=0;r<n;r++)e.revlayoutRuleShowSections[r]===t&&(e.revlayoutRuleShowSections.splice(r,1),n=e.revlayoutRuleShowSections.length,r--)}else if(o||e.revlayoutRuleShowSections.push(t),i)for(n=e.layoutRuleShowSections.length,r=0;r<n;r++)e.layoutRuleShowSections[r]===t&&(e.layoutRuleShowSections.splice(r,1),n=e.layoutRuleShowSections.length,r--)},handleFldSecVisiblityforLayoutRule:function(e){for(var t,a,i,o,n=Lyte.Router.getRouteInstance().currentModel.layoutId,r=e.layoutRuleShowSections.length,l=0;l<r;l++)if((t=store.peekRecord("layout",n).sections.filter((function(t){return t.name===e.layoutRuleShowSections[l]}))[0])&&t.fields&&t.fields[0]){a=$L(".fieldupdate_"+t.fields[0].column_name).closest(".zc-fieldsectionallfield"),e.handlingShowOrhideFld(a,!0),o=t.fields.length;for(var s=0;s<o;s++)e.revlayoutRuleShowFld.includes(t.fields[s].id)||(i=$L(".fieldupdate_"+t.fields[s].column_name).closest(".zcanvas-field"),e.handlingShowOrhideFld(i,!0))}r=e.revlayoutRuleShowSections.length;for(l=0;l<r;l++)if((t=store.peekRecord("layout",n).sections.filter((function(t){return t.name===e.revlayoutRuleShowSections[l]}))[0])&&t.fields&&t.fields[0]){a=$L(".fieldupdate_"+t.fields[0].column_name).closest(".zc-fieldsectionallfield"),e.handlingShowOrhideFld(a,!1),o=t.fields.length;for(s=0;s<o;s++)i=$L(".fieldupdate_"+t.fields[s].column_name).closest(".zcanvas-field"),e.handlingShowOrhideFld(i,!1),e.layoutRuleShowFld.filter((function(e){return e.showFldId===t.fields[s].id})).length>0&&e.suffleLRfields(e,t.fields[s],!1)}r=e.layoutRuleShowFld.length;for(l=0;l<r;l++)(t=store.peekRecord("field",e.layoutRuleShowFld[l].showFldId))&&!e.revlayoutRuleShowSections.includes(t.section[0].name)&&(i=$L(".fieldupdate_"+t.column_name).closest(".zcanvas-field"),e.handlingShowOrhideFld(i,!0));r=e.revlayoutRuleShowFld.length;for(l=0;l<r;l++)(t=store.peekRecord("field",e.revlayoutRuleShowFld[l]))&&(i=$L(".fieldupdate_"+t.column_name).closest(".zcanvas-field"),e.handlingShowOrhideFld(i,!1));r=e.LRuleManField.length;for(l=0;l<r;l++)(t=store.peekRecord("field",e.LRuleManField[l].targetFieldId))&&(e.revlayoutRuleShowSections.includes(t.section[0].name)||e.revlayoutRuleShowFld.includes(e.LRuleManField[l].targetFieldId))&&(e.LRuleManField.splice(l,1),l--,r--);r=e.revLRuleManField.length;for(l=0;l<r;l++)(t=store.peekRecord("field",e.revLRuleManField[l].targetFieldId))&&(e.revlayoutRuleShowSections.includes(t.section[0].name)||e.revlayoutRuleShowFld.includes(e.revLRuleManField[l].targetFieldId))&&(e.revLRuleManField.splice(l,1),l--,r--)},gettoolinst:function(){return new zcanvastools({baseeditor:"body",tools:{},meta:{fallbackurl:networkUtils.getImageUrl("image_profile_canvas_1d7b1e9_.svg",ResourceConstants.CRM)},nodeattr:{key:"zcqaval",key2:"label",attr:{"data-zcqa":"canvas-detail-"}},viewcallback:function(e,t){t&&t.ui&&t.ui.value&&t.ui.value.zcode&&t.ui.value.zcode.name&&e.attr&&e.attr("data-zcqa","canvas-detail-"+t.ui.value.zcode.name)},compressionmap:zutils.stylecompressionmap,classstyles:zutils.classstyles,classselector:function(e){return e.indexOf("zcanvas-holder")>-1&&(e=e.replace(".zcanvas-holder","").trim()),e},customstate:Lyte.registeredMixins["crm-detailcanvas-utils"].customstateview,stylepriority:function(e,t){return e&&e.endsWith(".zc-tabs li.tab")&&(t=!0),t},processstylevalue:function(e,t){return Lyte.registeredMixins["crm-detailcanvas-utils"].getUrlfromStyleData(e,t)},processvaluebyconfig:function(e,t){return"image"===e?Lyte.registeredMixins["crm-detailcanvas-utils"].getUrlfromStyleData(null,t,1):t},poststylecreate:function(e,t,a){if(e&&e.indexOf(".zcanvas-field")>=0&&e.indexOf(":hover")>-1){e+=" .zcanvas-inner-component";for(var i=["font-family","font-size","color","background-color"],o={},n=i.length,r=0;r<n;r++)t[i[r]]&&(o[i[r]]=t[i[r]]);this.addrule(e,o,a,!0)}if(e&&e.indexOf(".zcanvas-holder")>-1&&t&&t["flex-direction"]&&t["flex-direction"].indexOf("column")>-1){this.addrule(e+"> .zcanvas-label",{"white-space":"normal;"},a,!0)}if(e&&e.indexOf(".zc-tablist-container .zc-tabs")>-1){var l=zutils.getSpacingProperties("margin",t),s=zutils.getSpacingProperties("padding",t),d=e.replace(".zc-tabs",".zc-tabs-nav");o={"padding-top":s["padding-top"]+"px","padding-bottom":s["padding-bottom"]+"px","margin-top":l["margin-top"]+"px","margin-bottom":l["margin-bottom"]+"px"};this.addrule(d,o,a,!0)}if(e&&e.indexOf(".zcanvas-value-container img")>-1){d=e+".cd_people_image";var c=zutils.getImageMaxProps(t);this.addrule(d,c,a,!0)}},theme:{selector:{field:{default:".zcanvas-field:not(.zccbutton):not(.zc-rl-field):not(.zcclink)"},label:{default:".zcanvas-field:not(.zccbutton):not(.zc-rl-field):not(.zcclink) .zcanvas-label"},value:{default:".zcanvas-field:not(.zccbutton):not(.zc-rl-field):not(.zcclink) .zcanvas-value-container"},textarea:{default:".zcanvas-field.zctextarea:not(.zccbutton):not(.zc-rl-field) .zcanvas-value-container"},tag:{default:".zcanvas-field:not(.zccbutton):not(.zc-rl-field) .zcanvas-value-container crm-tag ul li"},section:{default:".zcanvassection:not(.zcanvas-non-delete):not(.zcanvas-title-editor):not(.zcanvas-static-content-container):not(.zc-no-theme):not(.zc-tab-section)"},"relatedlist section":{default:".zcanvassection.zcanvas-non-delete"},"relatedlist title":{default:".zcanvassection.zcanvas-title-editor"},title:{default:".zcstatictext.zc_disabled"},button:{default:".zccbutton.zcanvas-field"},"Tab Layout":{default:".zctabview .zc-tabs .tab:not(.active)",hover:".zctabview .zc-tabs .tab:not(.active):hover",active:".zctabview .zc-tabs .tab.active"},page:{default:".zc-page-component"},relatedlist:{default:".zc-list-component"},"Static Text":{default:".zcstatictext:not(.zc_disabled)"},Line:{default:".zclayout.zcdivider .zc-divider-line"},"Table Layout":{default:".zclayout-table > .canvas-outer"},textarea:{default:".zcanvas-field.zctextarea:not(.zccbutton):not(.zc-rl-field) .zcanvas-value-container"}}},nocompile:!0})},_trackAjax:function(e){Crm.client_tracking("CanvasAjaxEditActions - "+e)},initPageConfigMethods:function(e){if("debounce_load"===e){var t=Lyte.registeredMixins["crm-detailcanvas-utils"];t.runListLoading=$L.debounce(t.scrollhandler,1500)}},afterPreview:function(){var e=$("#previewcanvas .zclayout.zctabview"),t=zclayout.prototype.layouts["Tab Layout"];e.each((function(){t.refreshlayout($L(this),(function(){$L("#previewcanvas").find("crm-stage-history").each((function(){var e=$(this);e.length&&e[0].component.setWidthForStagesParent()}))}))}));var a=$L(".zccbutton .navigateRecord");if(a.length){var i=a[0];i.setMethods({onNext:function(){},onPrevious:function(){}}),i.component.buttonDisable.call(i.component)}$L("#previewcanvas").find("crm-stage-history").each((function(){var e=$(this);e.length&&e[0].component.setWidthForStagesParent()}));for(var o=$("#previewcanvas [zcflag]"),n=o.length,r=0;r<n;r++){var l=o.eq(r),s=l.removeAttr("lyte-rendered zcflag").outerHTML(),d=l.parent();l.remove(),d.append(s)}},customStatiView:function(e,t){var a=e.id,i=null,o=$("#zcanvas_menu").data("zcdatamap");if(t||(t={record:{},module:" "}),o&&o[a]&&o[o[a].label]&&o[o[a].label].menudata)i=o[o[a].label].menudata;else{var n=Lyte.Router.getRouteInstance().parent.getDynamicParam(),r=$L("crm-detailview-canvas-gallery")[0];r&&(n=r.getData("layoutId"),t.record=r.getData("record"),t.module=r.getData("module"));var l=store.peekRecord("layout",n);if(l){var s=l.sections.filter((function(e){return e.uid===a}));s&&s[0]&&(i=s[0].fields)}}return Lyte.registeredMixins["crm-detailcanvas-utils"].sectionview(e,i||[],t)},relListCreate:function(e,t,a,i){var o,n=$L("crm-detailview-canvas-gallery")[0],r=$L("crm-detailview-oldeditor")[0],l=(o="crm.settings.section.modules.module.canvas.clone"===Lyte.Router.getRouteInstance().transition.target||"crm.settings.section.modules.module.canvas.edit"===Lyte.Router.getRouteInstance().transition.target?r.component.getData("menuDetails"):n.component.getData("menuOptionsData"))[e.id];if(l&&1===l.zcscope&&"Custom Layout"===e.theme&&!i&&(e.theme="Table Layout"),"Table Layout"===e.theme&&l){var s=$(l.fieldContainer).data("zcanvasMenu");if(s&&s.config&&s.config.zmenustart&&!a&&s.config.zmenustart(l),r&&e.data&&"relatedlist"===e.data.datatype&&("crm.settings.section.modules.module.canvas.clone"===Lyte.Router.getRouteInstance().transition.target||"crm.settings.section.modules.module.canvas.edit"===Lyte.Router.getRouteInstance().transition.target)){var d=r.component.getData("layoutId"),c=r.component.getData("module"),u=r.component.getData("record")?JSON.stringify(r.component.getData("record")):void 0,p=r.component.getData("entityId");l.template="<crm-related-list-view-header layout-id='"+d+"' record='"+u+"' entity-id=\""+p+"\" module='"+c+'\' show-loading="{{lbind(isLoading)}}" related-list-id="'+l.id+"\" related-list='"+JSON.stringify(store.peekRecord("related_list",l.id).$.toJSON())+"'></crm-related-list-view-header>"}else if(e.data&&"relatedlist"===e.data.datatype){d=n.component.getData("layoutId"),c=n.component.getData("module"),u=n.component.getData("record")&&n.component.getData("record").$&&n.component.getData("record").$.toJSON()?$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(n.component.getData("record").$.toJSON())):void 0,p=n.component.getData("entityId");l.template="<crm-related-list-view-header layout-id='"+d+"' record='"+u+"' entity-id=\""+p+"\" module='"+c+'\' show-loading="{{lbind(isLoading)}}" related-list-id="'+l.id+"\" related-list='"+JSON.stringify(store.peekRecord("related_list",l.id).$.toJSON())+"'></crm-related-list-view-header>"}}if(a)return l;if(l&&l.template&&$u.isEmpty(l.data)&&(!(2===l.zcscope&&l.mappedCount>1&&"Custom Layout"===e.theme)||"static_rel"===l.datatype&&1===l.zcscope&&1===l.mappedCount&&"Custom Layout"===e.theme))return o[e.id].data=new Promise((function(e){l.async&&Lyte.registeredMixins["crm-detailcanvas-utils"].loadResourceOnDemand(l);var t=l.actions;e({data:{},template:l.template,async:l.async,asyncloader:l.asyncloader,actions:t})})),l;e.children=e.components;var m=!0,f=!0;if(l&&!l.noAction){var v=l.action.url_params[2],h=store.peekRecord("related_list",v);if(h&&"multiselectlookup"===h.type){var g=h.connectedmodule;m=moduleRecordMapping[g].viewable,f=moduleRecordMapping[g].visible}}if("create"!==Lyte.Router.getRouteInstance().routeName&&"clone"!==Lyte.Router.getRouteInstance().routeName&&"detail"!==Lyte.Router.getRouteInstance().routeName&&"canvas"!==Lyte.Router.getRouteInstance().routeName&&"edit"!==Lyte.Router.getRouteInstance().routeName||!l)if(l&&m&&f&&!l.noAction)Lyte.registeredMixins["crm-detailcanvas-utils"].relatedListDataProcessing(l,e);else{l={};var y,b,_,x="";c=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];if(("create"===Lyte.Router.getRouteInstance().routeName||"clone"===Lyte.Router.getRouteInstance().routeName||"detail"===Lyte.Router.getRouteInstance().routeName||"canvas"===Lyte.Router.getRouteInstance().routeName||"edit"===Lyte.Router.getRouteInstance().routeName)&&"Table Layout"===e.theme)b=(y=["timeline","sales_summary","data_privacy","stage_navigator","followers","blueprint","subform","score_summary","campaign_integ_analytics","campaign_analytics","backstage_analytics","backstage_status","zfinance_stock_info","zfinance_business_info","upcoming_action","orchestrations","segmentation","best_time","prediction","recommendation","similarity","next_best_action"].indexOf(e.id)>-1?new CrmDetailViewHandler(c,{},e.id,e.id,null,"",e.personalityName):new CrmDetailViewHandler(c,{},e.id,"static_rel",null,"",e.personalityName)).getHTML(),_=y.getResources(),l.asyncresources=_,l.async=!0,x=b;l.data=new Promise((function(t){Lyte.registeredMixins["crm-detailcanvas-utils"].loadResourceOnDemand(l),t({data:e,template:x,actions:[],rellistdata:[],module:"",asyncloader:l.asyncloader,async:l.async})}))}else Lyte.registeredMixins["crm-detailcanvas-utils"].relatedListDataProcessing(l,e,t);return l},relatedlistcompile:function(e,t,a){var i=Lyte.Router.getRouteInstance().transition.info.dynamicParams[0];if((t&&t._data&&(t=t._data),t&&t.id)&&!store.peekRecord("related_list",t.id))return;return Lyte.registeredMixins["crm-detailcanvas-utils"].getRelListHtml(e,t&&t.rellistdata?t.rellistdata:[],i,t&&t.fieldid?t.fieldid:[],null,a,t)},splitSectionStyles:function(e){var t=[];if(e.value&&e.value.tablestyles){var a=e.value.tablestyles.fields,i=e.value.tablestyles.rows,o=e.value.tablestyles.layoutstyles,n=e.value.tablestyles.table;if(a){var r={ui:{datastylefields:{},value:{}},children:[]};for(var l in a){var s={ui:a[l],children:[]};s.id=l,s._type="field",r.children.push(s)}t.push(r)}if(i){for(var d=i.length,c={ui:{datastylerow:{}},children:[]},u=0;u<d;u++){var p={ui:i[u],children:[]};p.ui.index=u,c.children.push(p)}t.push(c)}if(o){var m={ui:{datastylelayout:{}},children:[]},f={ui:o,children:[]};m.children.push(f),t.push(m)}if(n){var v={ui:{datastyletable:{}},children:[]},h={ui:n,children:[]};v.children.push(h),t.push(v)}}return t},splitAllFields:function(e){var t=["sectionstyle","titlesection","datastyle"],a=e.ui.allfieldstabstyle,i=t.length,o=Lyte.registeredMixins["crm-detailcanvas-utils"],n=[];for(var r in a){var l={ui:{},children:[]};l.id=r,l._type="section";for(var s=0;s<i;s++){var d={ui:{value:{}},children:[]};"datastyle"!==t[s]?d.ui[t[s]]=a[r][t[s]]:(d.ui.datastyle={},d.children=o.splitSectionStyles(a[r].datastyle)),l.children.push(d)}n.push(l)}e.ui.allfieldstabstyle={},e.children=n},swapSectionStyles:function(e){for(var t={},a=e.children,i=a.length,o=0;o<i;o++){var n=a[o];if(n){var r=n.ui;if(r){if(r.datastylefields){var l={},s=n.children;if(s)for(var d=s.length,c=0;c<d;c++){var u=s[c];l[u.id]=u.ui}t.fields=l}if(r.datastylerow){l=[];var p=n.children;if(p){var m=p.length;for(c=0;c<m;c++){var f=p[c];l.push(f.ui)}}t.rows=l}if(r.datastylelayout){var v=n.children;v&&v.length>0&&(t.layoutstyles=v[0].ui)}if(r.datastyletable){var h=n.children;h&&h.length>0&&(t.table=h[0].ui)}}}}return{value:{tablestyles:t}}},swapAllFields:function(e){for(var t=e.children,a=e.ui.allfieldstabstyle,i=t.length,o=0;o<i;o++){for(var n=t[o],r=n.id,l=n.children,s=l.length,d={},c=0;c<s;c++){var u=l[c],p=u.ui;if(p&&p.sectionstyle&&(d.sectionstyle=p.sectionstyle),p&&p.titlesection&&(d.titlesection=p.titlesection),p&&p.datastyle){var m=Lyte.registeredMixins["crm-detailcanvas-utils"];d.datastyle=m.swapSectionStyles(u)}}a[r]=d}e.children=[]},getUrlfromStyleData:function(e,t,a){if("background-image"===e||a){var i=t;if(i){var o=i.match(/\$Image\{([\s]*[^;\s\{]+[\s]*)\}/g);if(o){var n=o[0].replace("$Image",""),r=n.substring(1,n.length-1);"canvas"!==Lyte.Router.getRouteInstance().routeName||a?t=i=i.replace(o[0],Lyte.registeredMixins["crm-detailcanvas-utils"].getBgImageURL(r)):(Crm.CanvasBg?Crm.CanvasBg.includes(r)||Crm.CanvasBg.push(r):Crm.CanvasBg=[r],t="var(--zcanvasbg-"+r+")")}}}return t},getBgImageURL:function(e,t){var a=crmBasePath+"/EntityImageAttach.do?actionName=getBackgroundImagesforCanvas&fileId="+e;return t&&(a=a+"&size="+t),a},initializeLazyLoad:function(){if(Crm.CanvasBgLoad&&Crm.CanvasBg&&Crm.CanvasBg.diff(Crm.CanvasBgLoad).length<=0)return;for(var e,t=Crm.CanvasBg?Crm.CanvasBg:[],a=(t=t.slice(0)).length>=4?t.length:4,i=Math.ceil(a/4),o=0;o<4;)e=t.splice(0,i),this.initializeImageRequest(e),o++},initializeImageRequest:function(e){if(e.length>0){var t=e.splice(0,1),a=new Image;a.id=t[0],a.url=Lyte.registeredMixins["crm-detailcanvas-utils"].getBgImageURL(t[0]),a.imageIdArray=e,a.onload=function(){var e={};e["--zcanvasbg-"+this.id]="url("+this.url+")",$(":root").css(e),Lyte.registeredMixins["crm-detailcanvas-utils"].initializeImageRequest(this.imageIdArray),Crm.CanvasBgLoad?Crm.CanvasBgLoad.includes(this.id)||Crm.CanvasBgLoad.push(this.id):Crm.CanvasBgLoad=[this.id]},a.setAttribute("src",a.url)}},canvasHelpDoc:function(){var e=null;switch(Crm.userDetails.LOCALE?Crm.userDetails.LOCALE.split("_")[0]:"en"){case"fr":e="/customize-crm-account/managing-module-views/articles/personnalisation-de-la-page-d%C3%A9tail-de-l-enregistrement-%C3%A0-l-aide-du-concepteur-de-canvas";break;case"ja":e="/customize-crm-account/managing-module-views/articles/%E3%82%AD%E3%83%A3%E3%83%B3%E3%83%90%E3%82%B9%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%9F%E3%83%87%E3%83%BC%E3%82%BF%E8%A9%B3%E7%B4%B0%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AE%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA";break;default:e="/customize-crm-account/managing-module-views/articles/customize-record-detail-page-canvas"}return RebrandLinkUtil.getProperty("KB_CRM_URL")+e}});
