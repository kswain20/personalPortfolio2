var httphandle=getHTTPObject(),globalfieldlabel="",globalvaluespanid="",globallabelspanid="",globalsubvaluespanid="",globaltextboxpanid="",globaltextareapanid="",globaluitype=void 0,comboCount=1,fieldDetails={},itsonview=!1,sortOrderString="null",temp="null",tkveventajax=!1,selectfieldtoupdate="",updatedsuccesfully="",cancelButton="",saveButton="",OR="",searchResultObj={},creator_scroll_div_width=0,itsonedit="false",jsonFields={},concentrixResponse="",isAdwordsMetrixRecordsFetched=!1,singularModule="",valueBeforeAjaxEdit="",idBeforeAjaxEdit="",recordid1="";function Callonclickofbutton(e,t,a,i,r,l,n,s,o,d,c,m,u,p,g,v){var f=null,h=null,b=null,C=(w="Calls"===l&&isNewCallView?$("#fullInfoDiv"):$(document)).find("#mouseArea__"+r).data("params");e="Campaigns"===l?"/crm/v2.2/":e;if(-1===(e=s+""=="445"||C.filterQueryId?"/crm/v2.2/":e).indexOf("/crm/v2/")&&-1===e.indexOf("/crm/v2.1/")&&-1===e.indexOf("/crm/v2.2/")||crmTab.checkPresenceInCache(l)&&crmTab.deleteFromCache(l),detailView.fadeOutHighLight(),$(".highlightFieldUpdate").length>0){var y=$("#leftPanel");y&&y.removeClass("highlightFieldUpdate")}var I=$("#fullInfoDiv"),w="Calls"===l&&isNewCallView?I:$(document),A=(C=$("#mouseArea__"+r).data("params")).module;p=C.fieldid;"32"!==(s=C.uitype)&&"38"!==s&&"52"!==s||store.findRecord("field",p,{module:moduleApiMapping[A]},void 0,void 0,{apiVersion:"2.2"}).then((function(e){this.fieldDetails=e}));var E=$("#subvalue_yesId");if(E.length>0){var T=E.attr("idval"),S="<span id=yes_"+T+' width="13px" height="12px" class="yes nohyphon"></span>',L="#detailViewButtonLayerDummyTableRow #headervalue_"+T+" .busniess_card_Hover",_=$(L+" #subvalue_yesId");_.length>0&&(_.remove(),$(L).append(S));var O=$("#detailViewButtonLayerMainTableRow #headervalue_"+T+"busniess_card_Hover"+" #subvalue_yesId");O.length>0&&(O.remove(),O.append(S)),$("#value_"+T+" #subvalue_yesId").remove(),$("#value_"+T).append(S)}e=e+moduleApiMapping[l]+"/"+c;var M,P="Calls"==l&&isNewCallView?w.find("#Crm_"+l+"_"+r)[0]:document.getElementById("Crm_"+l+"_"+r),k="",R="";if(httphandle){if(786===parseInt(s)||14===parseInt(s)||333===parseInt(s)){var D=w.find("#Crm_"+l+"_"+r+"_TimeOption"),U=-1!=t.indexOf("*")?t.substring(0,t.indexOf("*")):t;if(0!=P.value.trim().length){var F=D.val().split(" ")[0],x=F.split(":"),N=""!=F?Utils.getMeridiem(D.timeEntry("getTime")).toUpperCase():"AM",B=""!=F?x[0]:"00",j=""!=F?x[1]:"00";k=P.value.trim()+" "+B+":"+j+" "+N.toUpperCase()}}else if(100===parseInt(s)||96===parseInt(s))for(var V=0,H=P.length,z=0;z<H;z++)1==P.options[z].selected?(k=0==V?P.options[z].value:k+"; "+P.options[z].value,V++):0==V&&(k="");else if(300===parseInt(s)||301===parseInt(s))k=getObj(globaltextboxpanid).checked,"false"===(k+="")&&$(".unsubInfo").hide();else if(98===parseInt(s))k=w.find("#textarea_STATUS").find("select").val();else if(555===parseInt(s))fileupload.removedAttachmentIds.length>0&&(fileupload.editObj.removedAttachmentIds=fileupload.removedAttachmentIds),fileupload.uploadedFileObject.length>0&&(fileupload.editObj.uploadedFileObject=fileupload.uploadedFileObject),k=JSON.stringify(fileupload.editObj);else if(556===parseInt(s)){var G=$("#Crm_"+l+"_"+r)[0].children[0].component;M=G;var q=!1;if(G.data.removedIds.length>0&&!q&&(q=!0),G.data.previewPageChanges.length>0&&!q&&(q=!0),Object.keys(G.data.sequenceChanges).length>0&&!q&&(q=!0),!q)for(var J=G.data.imageData.length,W=0;W<J;W++)if(void 0!==G.data.imageData[W].encryptedUploadId){q=!0;break}q?k=M.constructAPIRequestBody():(G.saveImageEditButtons(),k="{}")}else if(444===parseInt(s)){var Y=w.find("#"+t);k=(k=Y.data("id"))&&"null"!=k||(k=Y.data("selectedid"))&&"null"!=k?k.split(",").length:""}else if(221===parseInt(s)){Y=w.find("#"+t);k=Y.data("id"),R=void 0===Y[0].component.data.userName?"":Y[0].component.data.userName}else if(parseInt(s)===CrmField.UITYPES.SERVICE_DURATION){if("string"==typeof(k=w.find("#"+t).val().trim())&&(k=k.trim()),!CSU.getServiceTiming("Services",!1,!0))return renderingUtils.showCustomAlert(I18n.getMsg("crm.service.dur.less.avail",moduleRecordMapping.Services.singular_label),"",!1),!1}else{"string"==typeof(k=w.find("#"+t).val().trim())&&(k=k.trim());var Z=w.find("#rItemDataDiv");""!=Z.html()&&{Leads:"LASTNAME",Accounts:"ACCOUNTNAME",Contacts:"LASTNAME",Potentials:"POTENTIALNAME",Campaigns:"CAMPAIGNNAME",Cases:"CASESUBJECT",Solutions:"SOLUTIONTITLE",Products:"PRODUCTNAME",Vendors:"VENDORNAME",PriceBooks:"BOOKNAME",Quotes:"QUOTESUBJECT",SalesOrders:"SALESORDERSUBJECT",PurchaseOrders:"PURCHASEORDERSUBJECT",Invoices:"INVOICESUBJECT",Tasks:"SUBJECT",Events:"SUBJECT",Calls:"SUBJECT",Activities:"SUBJECT"}[l]==r&&Z.find("a").first().find("div").text(k)}if("38"==s&&0!=(k+="").length){var Q=k.split(".");0==Q[0].length&&(k=0+k),k=k.includes(".")&&0===Q[1].length||0===parseInt(Q[1])?Q[0]:k}if(k&&"CODE"===d||"ZIPCODE"===d||"MAILINGZIP"===d||"OTHERZIP"===d){var X=k.replace(/[~`#%^&*()+={}[\]|\;"<>\\]/g,"RV");X=replace(X,"RV",""),k=X}var K=Crm.validateEntityAndShowErrorMsg(["Crm_"+l+"_"+r],l,!0);if(K?$("#Crm_"+l+"_"+r).closest(".tabdiv").removeClass("errorFieldP"):$("#Crm_"+l+"_"+r).closest(".tabdiv").addClass("errorFieldP"),!K)return void(786===parseInt(s)||14===parseInt(s)||333===parseInt(s)?w.find("#"+U).length&&w.find("#"+U).focus():w.find("#"+t).focus());parseInt(s)===CrmFieldConstants.PHONE&&(k=commonUtils.getValue(w.find("#"+t)),"string"==typeof value&&(k=k.trim())),itsonview=!1,loadAjaxTab(""),""!=k&&k instanceof String&&(k=k.trim()+""),32===parseInt(s)&&(k=k.replace(/\+/g,"")),!k||1!=s&&11!=s&&27!=s&&127!=s&&62!=s||(k=renderingUtils.removeMultiSpacestoSingleSpace(k));var ee=C.label;"ACCOUNTID"==r&&"Accounts"!=l?ee="Account Name":"CONTACTID"==r&&"Contacts"!=l&&(ee="Contact Name");var te=null,ae=k,ie=valueBeforeAjaxEdit;if(/\b(5|4|6|7|9|10|12|13|15|133|136)\b/.test(s)&&(te=w.find("#"+globaltextboxpanid).data("id")?w.find("#"+globaltextboxpanid).data("id")+"":"",k||(te=""),ae=""===te?k:te,ie=idBeforeAjaxEdit),"Account Name"==ee&&"Accounts"!=l&&(te=w.find("#"+globaltextboxpanid).data("id")?w.find("#"+globaltextboxpanid).data("id")+"":""),25===parseInt(s)&&("Leads"===l||"Contacts"===l)){var re=w.find("#subvalue_"+r).text();null!=re&&isValidEmail(re)||(re="")}Crm.VR&&delete Crm.VR,Crm.VR={},Crm.VR.ajaxEditFieldLabel=r,Crm.VR.entityDetails={},Crm.VR.entityDetails.entityMapJson=returnJson.entityMapJson?objectUtils.cloneObject(returnJson.entityMapJson):returnJson.entityMapJson,Crm.VR.ajaxEditFieldLabelValue=Crm.requestParamWithColname[r];var le=!1;if("Events"==l&&(le=!0,Crm.VR.fieldsInPopup=[Crm.VR.ajaxEditFieldLabel]),221===parseInt(s)&&trimBoth(k)===trimBoth(idBeforeAjaxEdit)||trimBoth(k)===trimBoth(valueBeforeAjaxEdit)&&trimBoth(ae)===trimBoth(ie)||(555===parseInt(s)||556===parseInt(s))&&("{}"===k||!k))return commonUtils.showHideLoadingDiv(),w.find("#"+a).show(),void $("#"+escapeSingleQuote(globaltextareapanid)+"_cancel").click();if((void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains(l))&&CFRExec&&CFRExec.evalAjaxEditForLayoutRule(l,r,null!==te?te+"#"+k:k,!0))return;new Promise((function(e){e(CVRExec.evalRules("view",l,r,!0,le))})).then((function(C){if(!C)return commonUtils.showHideLoadingDiv(),void(itsonview=!0);var y={},I={},A=[],E=$("#mouseArea__"+r),T=E.data("params"),S=E.data("params").sysRefName;S=-1!=S.indexOf(".")?S.replace(".","__"):S;var L=new RegExp("CustomModule\\d+_Name");if("STATUS"===d&&"Tasks"===l&&detailView.taskStatusMap.Completed===k&&!Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup){$("#showDontAskOption").prop("checked")&&(Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup=!0,localStorage.setItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID,!0));var _=$("#notifyOwnerOption").prop("checked");I.Send_Notification_Email=_}"Potentials"!==l||"FORECASTCATEGORY"!==d&&"FORECAST_CATEGORY"!==d||(e="/crm/v2.1/"+moduleApiMapping[l]+"/"+c);var O=new crmRequestPool,U={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};clientPortalName&&(U["X-CRMPORTAL"]=window.clientPortalName);var F=$("#Crm_"+l+"_"+r);if(301===parseInt(s)||300===parseInt(s))I[S]="true"===k;else if(24===parseInt(s)||202===parseInt(s))if(""===k)I[S]=k;else{if(!apiDateFormat(k))return Crm.showErrorMsg(I18n.getMsg("crm.field.valid.check",[F.data("label")]),F),void(itsonview=!0);I[S]=apiDateFormat(k)}else if(786===parseInt(s)||14===parseInt(s)||333===parseInt(s))if(""===k)I[S]=k;else{if(""===apiDateTimeFormat(k))return Crm.showErrorMsg(I18n.getMsg("crm.field.valid.check",[F.data("label")]),F),void(itsonview=!0);I[S]=apiDateTimeFormat(k)}else if(/\b(5|4|6|7|9|10|12|13|15|133)\b/.test(s))I[S]={},I[S].name=k,""!==te&&te!==idBeforeAjaxEdit?I[S].id=te:te="",""===k&&""===te&&(I[S].id=te,I[S]=""),"Accounts"===F.data("lookupModule")&&F.data("colname")&&-1===F.data("colname").indexOf("CF")&&(e="/crm/v2.2/"+moduleApiMapping[l]+"/"+c),b=S;else if(221===parseInt(s))I[S]={},""!==k&&(I[S].name=R,I[S].id=k);else if(100===parseInt(s)||96===parseInt(s)){for(var x=k.split("; "),N=[],B=x.length,j=0;j<B;j++)N.push(x[j]);""===k&&(N=""),I[S]=N}else if(26===parseInt(s)){var V=k.indexOf(":");I[S]=k.substring(V+1)}else if(555===parseInt(s)){var H=[];if(fileupload.removedAttachmentIds.length>0)for(var z=fileupload.removedAttachmentIds,G=Object.keys(z).length,q=0;q<G;q++){(W={}).attachment_id=z[q],W._delete=null,H.push(W)}if(fileupload.uploadedFileObject.length>0){var J=fileupload.uploadedFileObject;for(G=Object.keys(J).length,q=0;q<G;q++){var W;(W={}).file_id=J[q].encryptedUploadId,H.push(W)}}I[S]=H}else if(556===parseInt(s)){var Y=M.constructAPIRequestBody();I[S]=Y}else if(1===parseInt(s)&&L.test(S))I.Name=k;else if(445===parseInt(s)){var Z=[],Q=$("#mouseArea__"+r).data("params").selectedAPIJson,X=k.split("-"),K=X[0].split(","),ee=K.length;(le={}).api_name=S;var ae=moduleRecordMapping[l].fields.filterBy(le)[0].multiuserlookup.connectedlookup_apiname,ie=0,re=Q.length;if(""!=X[0])for(j=0;j<ee;j++){var le;(le={}).id=K[j];for(var ne=!1,se=0;se<re;se++)if(Q[se][ae].id===K[j]){ne=!0;break}ne||(Z[ie]={},Z[ie][ae]=le,ie++)}if(2==X.length){ee=(K=X[1].split(",")).length;for(j=0;j<ee;j++)for(se=0;se<re;se++)if(Q[se][ae].id===K[j]){Z[ie]={},Z[ie].id=Q[se].id,Z[ie]._delete="null",ie++;break}}I[S]=Z}else I[S]=k;A.push(I),y.data=A,v&&(y.escape_blocklist=!0),y.formruleValue=CFRExec.getFormRuleDataParams(),e+="?affected_data=true","Quotes"===l&&Crm.isCpqActivated()&&(y.cpq=["product_configurator","pricing_rule"]),O.initiate({action:e,type:"PUT",data:JSON.stringify(y),headers:U,contentType:"application/json",success:function(o){if($(".imageUploadDetailPage").removeClass("eventNone"),"STAGE"===d){var u=k.split(":");returnJson.entityMapJson.STAGE.val.forEach((function(e){e.name===u[1]&&(e.pbty=o.data[0].details.affected_data[0].Probability)}))}if("STATUS"!==d&&"DUEDATE"!==d&&"SUBJECT"!==d||$$rightPanel.detailRightPanel(!0,"info",!0),o.data&&"error"===o.data[0].status&&"the id given seems to be invalid"===o.data[0].message)renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"));else{if("REPORTINGTO_COUNT_EXCEEDED"==o.STATUS){var p="<span id='errorMsg_Crm_Contacts_REPORTINGTOCONTACTID' class='errMsg errorMsgDesc'>"+o.INFO+"</span>";return $("#mouseArea__REPORTINGTOCONTACTID").addClass("errorFieldP"),$("#mouseArea__REPORTINGTOCONTACTID").find("#textarea_REPORTINGTOCONTACTID").append(p),void commonUtils.showHideLoadingDiv()}if("ACCOUNT_PERMISSION_DENIED"==o.STATUS){p="<span id='errorMsg_Crm_Contacts_ACCOUNTID' class='errMsg errorMsgDesc'>"+o.INFO+"</span>";return $("#mouseArea__ACCOUNTID").addClass("errorFieldP"),$("#value_ACCOUNTID").append(p),void commonUtils.showHideLoadingDiv()}if("IMAGELIMITEXCEEDED"==o.STATUS)return crmui.showMsgBand("error",o.INFO,3e3),void commonUtils.showHideLoadingDiv();crmCalendar.close(),"32"!==s&&"38"!==s&&"52"!==s||null!==o.separator&&!0===o.separator&&(o.outputValue=o.formattedValue);var v=o;if(w.find("#errorMsg_textbox_"+r).remove(),w.find("#textbox_"+r).removeClass("errorHighlight"),"DESCRIPTION"==r&&"Events"==$("#module").val()&&w.find("#mouseArea__"+globalfieldlabel).removeClass("dB").addClass("dIB"),"object"==typeof v&&"true"===v.isRemovedFromExternalSource&&$(".businessInfoBtn").hide(),"object"==typeof v&&"duplicate data"===v.data[0].message)return"MSG"===v.TYPE?void commonUtils.checkErrorMsg(o,void 0,e,void 0,l):void displayUniqueFieldDuplicateError(v,r,l);if(v&&v.message&&v.message.indexOf("validation rule execution failed")>-1){if("error"==v.status){if(v.validation_rule_error_fields)for(var C=v.validation_rule_error_fields,y=C.length,I={},A={},S=0;S<y;S++)I=C[S],A=$("#"+CVRExec.getElemId("edit",I.column_name,l)),Crm.showErrorMsg(I.alert,A,l),$(A).focus();return}}else{if(v&&v.data[0].status&&"error"===v.data[0].status&&v.data[0].message)return Crm.showAlertMsg(v.data[0].message),void commonUtils.showHideLoadingDiv();if(v&&v.STATUS&&"ZIAFAILURE"===v.STATUS&&v.INFO){var L=Crm.getVisionMyJobsDependency();Lyte.injectResources(L,void 0,(function(){!function(){var e=$("crm-zia-vision-error-popup");0!=e.length&&e.remove();if(Crm.client_tracking("Zia Vision Entity Validation Failure",{type:v.INFO.message}),"do_not_create"===v.INFO.message||"create_without_image"===v.INFO.message)Lyte.Component.render("crm-zia-vision-error-popup",{action:v.INFO.message},"#zia-vision-popup"),$L("#visionModal")[0].ltProp("show",!0)}()}))}else if($L(".lnPhoto_ziaVision").length>0&&!v.hasVisionApproval)Lyte.Router.getRouteInstance().refresh();else if(v.hasVisionApproval){var _=$L(".photoUploadSec");if(returnJson){var O="#"+returnJson.relListLabelsJson.module+"_"+returnJson.relListLabelsJson.entityid+"_photo";$(O)&&deleteEntityImage(O,returnJson.relListLabelsJson.module,!1),_.attr("onclick","detailView.renderVisionErrorPopUp('"+v.failureType+"','"+returnJson.relListLabelsJson.module+"','"+returnJson.relListLabelsJson.entityid+"','"+v.visionId+"','"+v.approvalId+"')"),$L(".lnPhoto_ziaVision")||detailView.renderVisionErrorPopUp(v.failureType,returnJson.relListLabelsJson.module,returnJson.relListLabelsJson.entityid,v.visionId,v.approvalId)}Crm.client_tracking("Zia Vision Entity Validation Failure",{type:v.failureType}),$L(".lnPhoto").addClass("lnPhoto_ziaVision"),_.addClass("cP")}}$("#unique").length&&(document.getElementById("unique").style.display="none");var M=$("#accountId");if(M.length>0&&"view"===window[l].currentStatus&&"Crm_Potentials_ACCOUNTID"===t&&M.val(c),s+""=="445"){var U=$("#mouseArea__"+r).data("params").sysRefName;getMultiuserLookupValues(l,c,U,d,!0)}delete CFRExec.fieldVsValue,delete CFRExec.manateFldVsValue,w.find("#textarea_"+r).hide();var F=!1,x=!1,N=!1,B="",j="",V="",H=null,z="",G="",q="",J="",W="",Y="",Z="",Q="",X="",K=featuresAvailable.MultiCurrency,ee=Crm.userDetails,ae=returnJson.entityMapJson.CURRENCYISOCODE?returnJson.entityMapJson.CURRENCYISOCODE.defaultvalue:ee.BASE_CURRENCY?ee.BASE_CURRENCY:void 0,ie="";if("string"==typeof v)B=(ie=v.split("AJAX::::"))[1].trim(),j=ie[2],("Cases"!==l&&"Solutions"!==l||"ADDCOMMENT"!==r)&&(j=revertSplChrs(j)),H=ie[3].trim(),J=ie[4].trim(),G=ie[5].trim(),uiFormulaVals=ie[7].trim(),z=ie[8].trim(),ie[9].trim(),ie[12].trim(),ie[13].trim(),q=ie[14].trim();else if(ie="",v.isRemovedFromExternalSource="Accounts"===l&&"ACCOUNTNAME"===d,v){if(B="success"===(ie=v).data[0].status,"TWITTER"===d){if("error"===ie.data[0].status){var re=r.replace(/ /g,"\\ ");return Crm.showErrorMsg(I18n.getMsg("crm.tw.err.twHandleName.patterenCheck"),$("#Crm_"+l+"_"+re)),void $("#textarea_TWITTER").show()}var le=k;j=le,"undefined"!=crmSocialInteg&&crmSocialInteg.reloadTwitter(le)}else if(/\b(5|4|6|7|9|10|12|13|15|133)\b/.test(s))j=""===te&&""!==k?k+"|||"+ie.data[0].details[b].id:k+"|||"+te;else if(221===parseInt(s))j=R;else if(32===parseInt(s))j=/^(0)\1{0,}$/.test(k)?"0":k.replace(/^0+/,"");else if(556===parseInt(s))j=JSON.stringify(k);else if(1!=/^[0-9]*$/.test(k)||33!==parseInt(s)&&35!==parseInt(s)||null==Crm.userDetails.COUNTRY_LOCALE||"en_US"!=Crm.userDetails.COUNTRY_LOCALE)if(445===parseInt(s)){for(var ne=$("#temp_"+t).find("li"),se=ne.length,oe="",de=0;de<se;de++){var ce=ne[de].textContent;0===de?oe+=ce:oe=oe+", "+ce}j=oe}else j=k;else{j=10==(dt=k).length?"("+dt.substring(0,3)+") "+dt.substring(3,6)+"-"+dt.substring(6,10):9==dt.length?"("+dt.substring(0,5)+")-"+dt.substring(5,9):dt}("Cases"!==l&&"Solutions"!==l||"ADDCOMMENT"!==r)&&(V=j,j=revertSplChrs(j)),H=!0;var me=(Z=ie.data[0].details).Modified_By.name,ue=Z.Modified_By.id,pe=Z.Modified_Time;pe=new Date(pe.substring(0,pe.length-6)),pe=Utils.convertDateToGivenPattern("D, d M yy",pe)+" "+Utils.getTimeInUserFormat(pe,!0),G="<span purpose='showUserBC'  data-params='{'userId':'"+ue+"'}' >"+$ESAPI.encoder().encodeForHTML(me)+"</span><br><span class='f12 fontSmooth color_7 crm-font-regular'>"+pe+"</span>",36!==parseInt(s)&&143!==parseInt(s)&&144!==parseInt(s)&&145!==parseInt(s)||(null!==k&&""===k&&(k="10000000000000000"!==k?k.toString():"9999999999999999"),z=k),(W=null!==Z.affected_data&&Z.affected_data[0])&&"$process_flow"in W&&(x=W.$process_flow,delete W.$process_flow),W&&"$approved"in W&&(N=W.$approved,delete W.$approved),W&&"Expected_Revenue"in W&&W.Expected_Revenue}if(W=null!==ie.data[0].details.affected_data&&ie.data[0].details.affected_data[0],"Tasks"===l&&"DUEDATE"===r){var ge="",ve="REMINDAT",fe=$("#mouseArea__"+ve),he=$("#value_"+ve),be=$("#subvalue_"+ve),Ce=$("#headervalue_"+ve);if(void 0!==W.Remind_At){var ye=Utils.convertFrom8601DateFormat(W.Remind_At);delete W.Remind_At;var Ie=Utils.convertDateToUserPattern(ye),we=Utils.convertDateToUserPattern(returnJson.entityMapJson.REMINDAT.reminderDate);ge=returnJson.entityMapJson.REMINDAT.reminderTime.replace(we,Ie)}he.html(ge),be.html(ge),Ce.html(ge)}if(W.Overall_Sales_Duration&&W.Sales_Cycle_Duration&&(Q=W.Sales_Cycle_Duration,X=W.Overall_Sales_Duration),W.$converted&&(F=!0,detailView.isRecordConverted=!0,delete W.$converted),W||555===parseInt(s)){W&&delete W.id;var Ae=returnJson.entityMapJson;for(var Ee in Ae){var Te=Ae[Ee].uitype,Se=(ve=Ae[Ee].colname,W[Ae[Ee].sysRefName]);if("CLOSEDTIME"===ve&&""!=Se){var Le=new Date(Z.Modified_Time);Utils.convertToUserTimezone(Le),Se=Utils.getDateTimeInUserFormat(Le,!0,!0)}if(555===parseInt(Te)&&Ae[Ee].sysRefName in Z)Y=Se=Z[Ae[Ee].sysRefName],delete Z[Ae[Ee].sysRefName];else if(W&&Ae[Ee].sysRefName in W){fe=$("#mouseArea__"+ve),he=$("#value_"+ve),be=$("#subvalue_"+ve),Ce=$("#headervalue_"+ve);if(36!==parseInt(Te)&&143!==parseInt(Te)&&145!==parseInt(Te)&&144!==parseInt(Te)||(Se=K&&void 0!==Crm.userDetails.CURRENCY_DETAILS[ae]?returnJson.entityMapJson.EXCHANGERATE&&returnJson.entityMapJson.EXCHANGERATE.defaultvalue?currencyUtils.returnValueInDefaultCurrency(ae,Se,Crm.userDetails.CURRENCY_DETAILS[ae].decimals,parseFloat(returnJson.entityMapJson.EXCHANGERATE.defaultvalue)):currencyUtils.returnValueInDefaultCurrency(ae,Se,Crm.userDetails.CURRENCY_DETAILS[ae].decimals):currencyUtils.returnValueInDefaultCurrency(ae,Se)),he.length>0||be.length>0)if(null!==fe&&"string"===fe.data("params").formulaType&&(Se=$ESAPI.encoder().encodeForHTML(Se)),he.html(Se),be.html(Se),Ce.html(Se),null!==fe&&"date"===fe.data("params").formulaType&&""!==Se){Le=Utils.convertFrom8601DateFormat(Se);Utils.convertToUserTimezone(Le);var _e=Utils.getDateInUserDatePattern(Le,!0);he.html(_e),be.html(_e),Ce.html(_e)}else if(null!==fe&&"datetime"===fe.data("params").formulaType&&""!==Se){var Oe=Utils.getUserDateTimeFormatFromServerFormat(Se);he.html(Oe),be.html(Oe),Ce.html(Oe)}else null!==fe&&"number"===fe.data("params").formulaType?(Se=Se.toString(),he.html(Se.replace(/,/g,"")),be.html(Se.replace(/,/g,"")),Ce.html(Se.replace(/,/g,""))):null!==fe&&"boolean"===fe.data("params").formulaType?(Se=Se.toString(),he.html(Se),be.html(Se),Ce.html(Se)):null!==fe&&"currency"===fe.data("params").formulaType&&(Se=K&&void 0!==Crm.userDetails.CURRENCY_DETAILS[ae]?currencyUtils.returnValueInDefaultCurrency(ae,Se,Crm.userDetails.CURRENCY_DETAILS[ae].decimals):currencyUtils.returnValueInDefaultCurrency(ae,Se),he.html(Se),be.html(Se),Ce.html(Se));delete W[Ee.sysRefName]}if(0===!W.length)break}}if(N)reloadCurrentEntityView(detailView.entityId,detailView.currentModule);else{if(x&&detailView.currentModule&&detailView.entityId){if(!($("#pb_processButtonLayerInner").length>0))return void reloadCurrentEntityView(detailView.entityId,detailView.currentModule);ProcessFlow.refreshButtonLayer(detailView.currentModule,detailView.entityId,detailView.orchestrationDetailsArray)}if(786===parseInt(s)||14===parseInt(s)||333===parseInt(s)){var $e=null,Me=D.val().split(" "),Pe=Me[0].split(":"),ke=""!=Me?Utils.getMeridiem(D.timeEntry("getTime")).toUpperCase():"AM",Re=""!=Me?parseInt(Pe[0]):"HH:mm"===Crm.userDetails.TIME_FORMAT?0:12,De=""!=Me?Pe[1]:"00";"HH:mm"!==Crm.userDetails.TIME_FORMAT&&(Re=Utils.convertTimeTo24HoursFormat(Re,ke)),$e=P.value?Utils.getDateObject(P.value,{hrs:Re,mins:De}):"",detailView.replaceDataParams(r,$e+""),j=$e&&""!==$e?Utils.getDateTimeInUserFormat($e,!0):""}if(B){if(!F){if(556==s){var Ue=ie.data[0].details[returnJson.entityMapJson[r].sysRefName],Fe=$("#mouseArea__"+r).find("crm-image-upload-detail")[0].component;return void 0!==Ue&&Fe.renderDataForComponent(!0,Ue),Fe.setData("removedIds",[]),Fe.setData("previewPageChanges",[]),Fe.setData("sequenceChanges",{}),Fe.saveImageEditButtons(),void refreshFollowDiv()}var xe="";if(f=document.getElementById(a),-1==$("#"+a).attr("id").indexOf("header")?(xe="header"+a,h=$("#"+xe).length?getObj(xe):f):(xe=a.replace("header",""),h=getObj(xe)),25===parseInt(s)){var Ne="";Ne=' <a class="link" href="mailto:'+k+'" id="'+n+'"/>'+j+"</a>",$(f).empty(),f.innerHTML=Ne,Ne=changeSubValueId(Ne,[f,h]),$(h).empty(),h.innerHTML=Ne;var Be=new RegExp("CustomModule\\d+");if(("Leads"==l||"Contacts"==l||Be.test(l))&&getObj("mailType")&&getObj("mailType")&&"ZMAIL"==getObj("mailType").value&&getObj("relatedPageContent")){if(getObj("zmailEmail")){var je="";if("EMAIL"==r)""!=k&&(je=k),(Ve=getObj("subvalue_ADDN_EMAIL"))&&null!=Ve.href&&"mailto:"!=Ve.href&&(je=""!=je?je+","+getObj("subvalue_ADDN_EMAIL").href.replace("mailto:",""):getObj("subvalue_ADDN_EMAIL").href.replace("mailto:",""));else if("ADDN_EMAIL"==r){var Ve;""!=k&&(je=k),(Ve=getObj("subvalue_EMAIL"))&&null!=Ve.href&&"mailto:"!=Ve.href&&(je=""!=je?getObj("subvalue_EMAIL").href.replace("mailto:","")+","+je:getObj("subvalue_EMAIL").href.replace("mailto:",""))}getObj("zmailEmail").value=je,""!=je&&(getObj("mailConfigType").value=je)}"undefined"!=typeof crmSocialInteraction&&crmSocialInteraction.fetchSocialRelatedList(),fetchCustomRelatedList(),ZInvoice.loadRelatedList(),loadMailListForRL(l)}detailView.replaceDataParams(r,j)}else if(555===parseInt(s)){var He=E.data("params").colname,ze=$("#subvalue1_"+He);if(ze.empty(),""===Y){var Ge=E.data("params").defaultvalue,qe=fileupload.removedAttachmentIds.length;for(de=0;de<qe;de++)for(var Je=Ge.length,We=0;We<Je;We++)if(Ge[We].attachment_Id===fileupload.removedAttachmentIds[de]){Ge.splice(We,1);break}Y=Ge}j=Y;var Ye=Y.length;for(We=0;We<Ye;We++){var Ze=Y[We].attachment_Id,Qe='<a class="oH tOE nwrp vab dIB" style="max-width: 240px;">'+$ESAPI.encoder().encodeForHTMLAttribute(Y[We].file_Name)+"</a>";if(0==Y[We].link_Docs)if(Y[We].is_Preview_Available)if("pdf"==Y[We].extn){var Xe="javascript:openSheetForExport('"+Y[We].preview_Url+"','pdfViewPlugin');sE(event);";Qe='<a id="fileUploadField_'+Ze+'" class="oH tOE nwrp vab dIB pT0" style="max-width: 180px;cursor: pointer;" title="'+$ESAPI.encoder().encodeForHTMLAttribute(Y[We].file_Name)+'" onClick="'+Xe+'">'+$ESAPI.encoder().encodeForHTMLAttribute(Y[We].file_Name)+"</a>"}else if(""!=Y[We].mode){Xe="javascript:openSheetForExport('"+Y[We].preview_Url+"');sE(event);";Qe='<a id="fileUploadField_'+Ze+'" class="oH tOE nwrp vab dIB pT0" style="max-width: 180px;cursor: pointer;" title="'+$ESAPI.encoder().encodeForHTMLAttribute(Y[We].file_Name)+'" onClick="'+Xe+'">'+$ESAPI.encoder().encodeForHTMLAttribute(Y[We].file_Name)+"</a>"}else"png"==Y[We].extn&&(Qe='<a id="fileUploadField_'+Ze+'" class="oH tOE nwrp vab dIB pT0" style="max-width: 180px;cursor: pointer;" title="'+$ESAPI.encoder().encodeForHTMLAttribute(Y[We].file_Name)+'" onClick="showImagePreview(this);" href="'+Y[We].preview_Url+'" class="cboxElement" name="cboxElement">'+$ESAPI.encoder().encodeForHTMLAttribute(Y[We].file_Name)+"</a>");else Qe='<a id="fileUploadField_'+Ze+'" class="oH tOE nwrp vab dIB" style="max-width: 180px;cursor: pointer;" title="'+$ESAPI.encoder().encodeForHTMLAttribute(Y[We].file_Name)+'" href="'+Y[We].preview_Url+'">'+$ESAPI.encoder().encodeForHTMLAttribute(Y[We].file_Name)+"</a>";else if(1==Y[We].link_Docs){Xe="triggerLinkDocsView('"+Y[We].preview_Url+"','"+Y[We].extn+"','"+Ze+"','fileupload');sE(event);";Qe='<a id="fileUploadField_'+Ze+'" class="oH tOE nwrp vab dIB" style="max-width: 180px;cursor: pointer;" title="'+$ESAPI.encoder().encodeForHTMLAttribute(Y[We].file_Name)+'" onClick="'+Xe+'">'+$ESAPI.encoder().encodeForHTMLAttribute(Y[We].file_Name)+"</a>"}else if(3==Y[We].link_Docs){Xe="triggerLinkDocsView('"+Y[We].preview_Url+"','"+Y[We].extn+"','"+Ze+"','fileupload');sE(event);";Qe='<a id="fileUploadField_'+Ze+'" class="oH tOE nwrp vab dIB" style="max-width: 180px;cursor: pointer;" rel="noopener noreferrer" target="_blank" title="'+$ESAPI.encoder().encodeForHTMLAttribute(Y[We].file_Name)+'" href="'+Y[We].preview_Url+'">'+$ESAPI.encoder().encodeForHTMLAttribute(Y[We].file_Name)+"</a>"}var Ke='<span class="dIB f13 col888 pR" style="max-width: 250px;">'+Qe+'</span><span class="cNdownloadOption svgIconsImg mL10 t5 pA opacity5 t3"><a id="downloadlink" class="attachDropMenuRow" style="cursor: pointer" href="'+Y[We].download_Url+'"></a></span>',et='<li id ="upload_'+Ze+'" class="oH p0 m0 mT5 fileUploadLi" data-type="edit"><div class="dIB fL pR"><span class="dIB vat mR5 mT1 fileIconDefault svgIconsImg"></span>'+Ke+"<div></li>";3==Y[We].link_Docs&&(et='<li id ="upload_'+Ze+'" class="oH p0 m0 mT5 fileUploadLi" data-type="edit"><div class="dIB fL pR"><span class="dIB vat mR5 mT1 svgIcons ico-teamDrive"></span>'+(Ke='<span class="dIB f13 col888 pR" style="max-width: 250px;">'+Qe+"</span></span>")+"<div></li>"),ze.append(et);var tt=$("#upload_"+Ze).find(".fileIconDefault"),at=showImageType(Y[We].extn);tt.addClass(at)}$("#"+a).css({display:"inline-block"}),(ta=E.data("params")).defaultvalue=j}else if(300===parseInt(s)||301===parseInt(s)){var it="yes_"+r,rt="no_"+r,lt="",nt="";"true"==j?(lt=$("[id='"+it+"']"),nt=$("[id='"+rt+"']")):(lt=$("[id='"+rt+"']"),nt=$("[id='"+it+"']"),"EMAILOPTOUT"===r&&($("#fullInfoDiv i.unsubscribeInfo").remove(),$("#bcWraperDiv i.unsubscribeInfo").remove())),lt.length?($.each(lt,(function(e,t){t.style.display="inline-block"})),$.each(nt,(function(e,t){t.style.display="none"}))):(lt.style.display="inline-block",nt.style.display="none"),detailView.replaceDataParams(r,j)}else if(21===parseInt(s)||22===parseInt(s)){Ne="";if(21===parseInt(s)){var st="http";Ne=0==k.toLowerCase().indexOf("http")?' <a class="link" href="'+k+'" target="_blank" rel="noopener noreferrer" id="'+n+'"/>'+j+"</a>":' <a class="link" href="'+st+"://"+k+'" target="_blank"  id="'+n+'"/>'+j+"</a>"}else if(k.trim().length>0){var ot={screen_name:k,mode:"get_twitter_name"};(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/socialIntegration.do",data:ot,async:!1,success:function(e){Ne=null!=e&&"null"!=e&&e.trim().length>0?'<a class="link" href="'+RebrandLinkUtil.getProperty("TW_URL")+"/"+e+'" target="_blank" id="'+n+'">'+j+"</a>":' <span id="'+n+'">'+j+"</span>"}})}else Ne=' <span id="'+n+'">'+j+"</span>";$(f).empty(),f.innerHTML=Ne,Ne=changeSubValueId(Ne,[f,h]),$(h).empty(),h.innerHTML=Ne,detailView.replaceDataParams(r,j)}else if(33===parseInt(s)){var dt=k;$(f).empty(),$(h).empty();Ne="";if("PHONE"===d){var ct=$("#zpbCallAllowedField"),mt=$("#ctiCallAllowedField");ct.length&&ct.attr("onClick","crmCallsNew.initiateCallViaZPB('"+$ESAPI.encoder().encodeForJavaScript(dt)+"', '"+c+"', '"+l+"',  '"+$ESAPI.encoder().encodeForJavaScript(detailView.changedBCJson.hidden.entityName)+"')"),mt.length&&mt.attr("onClick","ctiApiNotifier.click2Call('"+$ESAPI.encoder().encodeForJavaScript(dt)+"', '"+Crm.userDetails.ZGID+"','"+Crm.userDetails.USER_ID+"', '"+c+"','', '"+l+"',  '"+$ESAPI.encoder().encodeForJavaScript(detailView.changedBCJson.hidden.entityName)+"')")}if(k=0==(k=replace4Skype(k)).indexOf("+")?k.substring(1):k,"false"===g||!1===g){if((ut=document.createElement("SPAN")).id=n,ut.setAttribute("id",n),ut.setAttribute("class","phoneRtl"),ut.innerHTML=j,f.appendChild(ut),f.id!=h.id)(pt=document.createElement("SPAN")).id=n,pt.setAttribute("class","phoneRtl"),pt.setAttribute("id",n.replace("subvalue_","subvalue1_")),pt.innerHTML=j,h.appendChild(pt)}else if(!k||1!=m&&"true"!=m){var ut,pt;if((ut=document.createElement("SPAN")).id=n,ut.setAttribute("id",n),ut.setAttribute("class","phoneRtl"),ut.innerHTML=j,f.appendChild(ut),f.id!=h.id)(pt=document.createElement("SPAN")).id=n,pt.setAttribute("class","phoneRtl"),pt.setAttribute("id",n.replace("subvalue_","subvalue1_")),pt.innerHTML=j,h.appendChild(pt);if(k)if(Crm.userDetails.ZPBENABLED){var gt=$("#id").val(),vt='asyncFn(crmCallsNew.getClick2CallPromise,"'+gt+'","'+l+'","'+$ESAPI.encoder().encodeForJavaScript($("#entityName").val())+'")';Ne="<zpb-phone number="+$ESAPI.encoder().encodeForHTMLAttribute(j)+" module="+l+" recordid='"+gt+"' callbackparamfn='"+vt+"'></zpb-phone>"}else Ne="<a class='pH2 fL ' title='"+I18n.getMsg("crm.phoneNo.Link.Title")+"' href='skype:+"+k+"?call' id='zti_"+n+"'></a>";else Ne=""}else Ne="<span class='fL'>"+j+"</span><a href='javascript:;' class='calliconOuter' onmouseover=\"CTIAPI.showCallButtonlabel(this)\" onmouseout=\"CTIAPI.hideCallButtonlabel(this)\" onclick=\"ctiApiNotifier.click2Call('"+$ESAPI.encoder().encodeForJavaScript(j)+"','"+Crm.userDetails.ZGID+"','"+Crm.userDetails.USER_ID+"','"+recordid1+"','','"+l+"','"+$ESAPI.encoder().encodeForJavaScript($("#entityName").val())+"')\" ><i class='callIcon'></i><span id='calllabel1' style='display:none;'>"+I18n.getMsg("Call")+"</span></a>",Ne+='<input type="hidden" name="isTelephonyEnabled" id="isTelephonyEnabled" value="S"/>',Ne+='<input type="hidden" name="telephonyzgid" id="telephonyzgid" value="'+Crm.userDetails.ZGID+'"/>',Ne+='<input type="hidden" name="telephonyuserid" id="telephonyuserid" value="'+Crm.userDetails.USER_ID+'"/>',Ne+='<input type="hidden" name="recordid" id="recordid" value="'+recordid1+'"/>';f.innerHTML=Ne+f.innerHTML,Ne=changeSubValueId(Ne,[f,h]),f.id!=h.id&&(h.innerHTML+=Ne),detailView.replaceDataParams(r,dt)}else if(35===parseInt(s)){Ne='<span class="phoneRtl" id="'+n+'"/>'+j+"</span>";$(f).empty(),f.innerHTML=Ne,Ne=changeSubValueId(Ne,[f,h]),$(h).empty(),h.innerHTML=Ne,detailView.replaceDataParams(r,k)}else if(37===parseInt(s)){Ne="";Ne=""!=k?'<a class="phoneRtl" href="skype:'+$ESAPI.encoder().encodeForHTML(k)+'" id="'+n+'">'+j+'<span class="skype dIB fr mL5 mT2" onclick="sE(event)"></span></a>':'<a class="phoneRtl" href="skype:'+$ESAPI.encoder().encodeForHTML(k)+'" id="'+n+'"/>'+j+"</a>",$(f).empty(),f.innerHTML=Ne,Ne=changeSubValueId(Ne,[f,h]),$(h).empty(),h.innerHTML=Ne,detailView.replaceDataParams(r,j)}else if(4===parseInt(s)||6===parseInt(s)||7===parseInt(s)||9===parseInt(s)||10===parseInt(s)||12===parseInt(s)||13===parseInt(s)||15===parseInt(s)||5===parseInt(s)||133===parseInt(s)){var ft=j.split("|||"),ht=$(P).data("lookupModule"),bt=ft[0],Ct=ft[1],yt="<a class='link' id='"+n+"' onclick=\"Crm.trackSpotLightAction('Lookup Click',{'Module':'"+ht+'\'});" onmouseenter="crmLookupBusinessCard.showLookupDetails(this)" onmouseout="crmui.hideTooltip()" data-zcqa=\'detailView\' data-cid=\'detailView\' data-params=\'{"module":"'+ht+'","id":"'+Ct+'"}\' href="'+Crm.getCrmBasePath()+"/EntityInfo.do?module="+ht+"&amp;id="+Ct+'">'+bt+"</a>";$(f).empty(),f.innerHTML=yt,yt=changeSubValueId(yt,[f,h]),$(h).empty(),h.innerHTML=yt,"Accounts"===ht&&M&&M.val(Ct),"Accounts"===ht&&getElemById("accountId")&&getElemById("accountName")&&(getElemById("accountId").value=accountID,getElemById("accountName").value=accountName);var It={defaultvalue:replaceSplChrs(bt),defaultid:Ct};if(detailView.replaceDataParams(r,It),crmConstants.reloadSalesNavigator=!0,"Accounts"!==ht||"SalesOrders"!==l&&"Invoices"!==l&&"Quotes"!==l||detailView.loadRelatedDetails(l,c,"Accounts"),crmConstants.reloadSalesNavigator=!0,"Accounts"===ht&&"Contacts"===l){var wt=$("#value_REPORTINGTOCONTACTID");wt.length>0&&(wt.empty(),wt.innerHTML=""),$("#headervalue_REPORTINGTOCONTACTID").html("")}}else if(98===parseInt(s)){var At=$("#textarea_STATUS").find("select")[0];f.setAttribute("statusvalue",At[At.selectedIndex].value),f.innerHTML=At[At.selectedIndex].text,reloadCurrentEntityView(),detailView.replaceDataParams(r,At[At.selectedIndex].text)}else if(36===parseInt(s)||143===parseInt(s)||145===parseInt(s)||144===parseInt(s)){var Et,Tt=$("#mouseArea__"+r).data("params");if(36!=s)try{Tt&&!isNaN(Tt.rounding_precision)&&(Et=parseInt(Tt.rounding_precision),$(f).empty().data("value",currencyUtils.applyRounding(k,s,Et)))}catch(e){$(f).empty().data("value",k)}else $(f).empty().data("value",k);var St="";null!==k&&""!==k&&(St=K&&void 0!==Crm.userDetails.CURRENCY_DETAILS[ae]?returnJson.entityMapJson.EXCHANGERATE&&returnJson.entityMapJson.EXCHANGERATE.defaultvalue?currencyUtils.returnValueInDefaultCurrency(ae,k,Crm.userDetails.CURRENCY_DETAILS[ae].decimals,parseFloat(returnJson.entityMapJson.EXCHANGERATE.defaultvalue),s,Et):currencyUtils.returnValueInDefaultCurrency(ae,k,Crm.userDetails.CURRENCY_DETAILS[ae].decimals,void 0,s,Et):currencyUtils.returnValueInDefaultCurrency(ae,k,Tt?Tt.decimalLength:void 0,void 0,s,Et)),f.innerHTML=St,$(h).empty(),h.innerHTML=St;var Lt=getObj("actualValue_"+r),_t=$("#value_"+r);if(_t.data("value")&&_t.data("value",z),Lt&&(Lt.value=z),"Campaigns"==l&&"ACTUALCOST"==r){var Ot=$("#stripValue_ACTUALCOST");Ot.empty(),Ot.html(j)}It={defaultvalue:z,plainValue:z};detailView.replaceDataParams(r,It)}else if(3===parseInt(s)||110===parseInt(s)){if(("Cases"===l||"Solutions"===l)&&"ADDCOMMENT"===r){St="<div class='commentSection'><pre class='value commentText crm-font-regular' style='width: 540px;overflow:hidden;word-wrap: break-word;' wrap='soft'>"+$ESAPI.encoder().encodeForHTML(k)+"</pre><div class='label commentDesc f12 fontSmooth color_7 crm-font-regular' align='right'> "+$ESAPI.encoder().encodeForHTML(me)+" On "+pe+"</div></div>";j=populateCommentSection(St)}if("Events"!==l&&(f&&h&&f.id==h.id?h=$("#subvalue_"+r).length>0?$("#subvalue_"+r)[0]:h:-1!==f.id.indexOf("header")&&(h=f),f=$("[id='subvalue_"+r+"']")),Pt=j,!0!==Crm.userDetails.DISABLE_TEXTAREA_TRUNCATE&&j.length>295){var $t="mouseArea__"+r,Mt="1"==$("#"+$t).data("params").layout?440:295,Pt=renderingUtils.highlightUrlInText(j.substring(0,Mt));Pt.endsWith("</a>")&&!j.substring(Mt).startsWith(" ")&&(Mt=-1===j.substring(Mt).indexOf(" ")?Mt+j.substring(Mt).length+1:Mt+j.substring(Mt).indexOf(" "),Pt=j.substring(0,Mt),Pt=renderingUtils.highlightUrlInText($ESAPI.encoder().encodeForHTML(Pt))),Pt+='... <a href="#" class="showMoreLink" onclick="toggleTextArea(this,\''+$t+"',true)\">Show More</a>"}else j&&""!==j&&(Pt=renderingUtils.highlightUrlInText(Pt));var kt=$(f).find("pre");kt.length>0&&(f=kt),$(f).html(Pt),detailView.replaceDataParams(r,j)}else if(26===parseInt(s)){var Rt="";if(1==(ft=j.split(":")).length)Rt+=ft[0];else{var Dt=ft.length;for(de=1;de<Dt;de++)de==Dt-1?Rt+=ft[de]:Rt=Rt+ft[de]+":"}var Ut=Rt;if(T&&T.colorcode_enabled){var Ft=getPickListColorCode(Rt,T.val,!0);T.color_code=Ft;var xt=getPLStyleObj(Ft);Ut="<span id='subvalue_STAGE' data-zcqa='colorcode_"+r+"_"+c+"' class='colorAppliedPicklist' style='"+xt+"'>"+Rt+"</span>"}if($(f).empty(),f.innerHTML=Ut,$(h).empty(),h.innerHTML=Ut,-1!==replaceSplChrs(j).indexOf("\\")?$("#stageContain").find('li[data-value="'+replaceSplChrs(j).replace(/\\/,"\\\\")+'"]').trigger("click"):$("#stageContain").find('li[data-value="'+replaceSplChrs(j)+'"]').trigger("click"),$("#potclosedv").val(replaceSplChrs(j)).trigger("change.select2"),getObj("relatedPageContent")){var Nt="",Bt="potstagehistpersonality",jt=(Sa=crmRelatedList.personalityArr.split("||")).length;for(de=0;de<jt;de++){if((st=Sa[de].split("_"))[0]===Bt){Bt=st[0],Nt=st[1];break}}if(void 0!==Nt){var Vt=Crm.getCrmBasePath()+"/NewRelatedList.do?action=getData&module="+getObj("module").value+"&id="+getObj("id").value+"&cvid="+getObj("cvid").value+"&pname="+Bt.toLocaleUpperCase();mR(Vt,(function(e){crmRelatedList.load(crmRelatedList.Module,crmRelatedList.EntityId,e)}))}}It={defaultvalue:Rt,plainValue:Rt};detailView.replaceDataParams(r,It),Crm.userDetails.detailView_newUI&&Lyte.registeredMixins["crm-detail-view-utils"].renderStageComponent()}else if(786!==parseInt(s)&&333!==parseInt(s)||!j)if(221===parseInt(s)){var Ht=j;j&&(Ht='<span purpose="showUserBC" data-params=\'{"userId":"'+k+'"}\' id="ownerName_id" data-zcqa="value_'+r+'">'+j+"</span>"),$(f).html(Ht),$(h).html(Ht);It={defaultid:k,defaultvalue:j};detailView.replaceDataParams(r,It)}else{if("Events"!==l){f&&h&&f.id==h.id?h=$("#subvalue_"+r).length>0?$("#subvalue_"+r)[0]:h:-1!==f.id.indexOf("header")&&(h=f);var zt=$("span#subvalue_"+r);f=zt.length>0?zt:f}var Gt=getObj("entity_name"),qt=l.slice(0,l.length-1),Jt=$("#rItemDataSubDiv").find("#recentItemImg_"+c).find("div");a=="value_"+qt+" Name"?Gt&&(Gt.value=j):qt&&a=="value_"+qt.toUpperCase()+"NAME"&&($("#entityName").val(j),Jt.html(j));var Wt=$(f);if(Wt.empty(),Wt.parents("td").removeClass("selectBoxSelect2"),s==CrmField.UITYPES.SERVICE_DURATION){var Yt=Handlebars.helpers.setServiceDuration(j);Wt.html(Yt)}else{if(("32"===s||"38"===s||"52"===s)&&""!==j&&!0===fieldDetails[0].separator){var Zt=Crm.userDetails.COUNTRY_LOCALE.replace("_","-");"ar-SA"!==Zt&&"es-PR"!==Zt&&"bn-BD"!==Zt&&"ar-AE"!==Zt||(Zt="en-US"),Rt="38"===s?Intl.NumberFormat(Zt,{maximumFractionDigits:fieldDetails[0].decimal_place}).format(j):j.length>16?Search.formatBigNumber(j,Zt):Intl.NumberFormat(Zt).format(j);var Qt=new Intl.NumberFormat(Zt).format(11111).replace(/1/g,""),Xt=new Intl.NumberFormat(Zt).format(1.1).replace(/1/g,""),Kt=Rt.split(Qt).join(Crm.userDetails.numberSeparators.group);if(1===Search.countCharacters(Xt,Rt)){var ea=new RegExp(Xt+"([^"+Xt+"]*)$");Kt=Kt.replace(ea,Crm.userDetails.numberSeparators.decimal+"$1")}j=Kt}Wt.html(j),1==s&&(j=V)}var ta,aa="true"===$("#iskanbanview").val();if("Events"!==l||2!==s&&"2"!==s){if(2===parseInt(s)&&T&&T.colorcode_enabled){Ft=getPickListColorCode(j,T.picklistmap);T.color_code=Ft;xt=getPLStyleObj(Ft);$(f).attr("style",xt),"-None-"===j||""===j?$(f).addClass("colorAppliedPKNone"):$(f).removeClass("colorAppliedPKNone")}}else if((ta=E.data("params"))&&ta.dataObj&&ta.dataObj["data-picklist-color"]){var ia=$("#selectColorComponent"),ra=$("#detailViewButtonLayerMainTable"),la=$("#detailView_"+detailView.entityId);if(aa&&(la=$("#kanban_"+detailView.entityId)),ia.length>0){Crm.userDetails.RTL_ENABLED?ia.css({right:"calc(40% + 4px)",top:"12px"}):ia.css({left:"calc(40% + 5px)",top:"12px"});var na=ia.css("background-color");ia.insertBefore($(f)),(sa=ra.find(".activitesColor"))&&sa.length>0?sa.css("background-color",na):$("#eventNameDiv").append('<span class="activitesColor eventColor_dv" data-zcqa="eventTemplecolor" style="background: '+Events.rgbtohex(na)+'"></span>'),(oa=la.find(".activitesColor")).length>0?oa.css("background-color",na):aa?la.append('<span class="activitesColor" data-zcqa="relcvColor_'+detailView.entityId+'" style="background: '+Events.rgbtohex(na)+'"></span>'):$("#cvlist_"+c).find("a").append('<span class="activitesColor" data-zcqa="relcvColor_'+detailView.entityId+'" style="background: '+Events.rgbtohex(na)+'"></span>')}else{var sa,oa;(sa=ra.find(".activitesColor"))&&sa.length>0&&sa.remove(),(oa=la.find(".activitesColor"))&&oa.length>0&&oa.remove()}}if("CLOSINGDATE"==r){var da=ma||j;$("#value_CLOSINGDATE").text(da),$("#headervalue_CLOSINGDATE").text(da),setTimeout((function(){Lyte.registeredMixins["crm-detail-view-utils"].renderStageComponent()}),50)}if(aa||"Calls"!==l&&"Tasks"!==l||"STATUS"!==r&&"PRIORITY"!==r&&"SUBJECT"!==r){if("Tasks"===l&&"DUEDATE"===r){var ca=getFormattedDate(j);aa||$("#cvlist_"+c).find('span[id="lp_Due Date"]').text(ca)}}else{$("#cvlist_"+c).find("#lp_"+{STATUS:"Status",PRIORITY:"Priority",SUBJECT:"Subject"}[r]).text(j).attr("title",j),"STATUS"===r?detailView.taskStatusMap.Completed==j?($("#completedTask").show().find("div").show(),$("#closeTaskTr").hide()):($("#completedTask").hide(),$("#completedValue:visible").hide(),$("#closeTaskTr").show()):"SUBJECT"===r&&Jt.html(j)}if(aa&&("CALLTYPE"===r||"LOCATION"===r||"PRIORITY"===r||"STATUS"===r||"DUEDATE"===r||"ENDDATETIME"===r||"STARTDATETIME"===r||"SUBJECT"===r)){"DUEDATE"===r?taskDetailsview.updaterecord(c,r,j,ca):aa&&"ENDDATETIME"===r||"STARTDATETIME"===r?(taskDetailsview.formatdatetime(stime,etime,c),"ENDDATETIME"!==r&&"STARTDATETIME"!==r&&(Wt.empty(),$(f).empty(),f.innerHTML=j),tkveventajax=!0):taskDetailsview.updaterecord(c,r,j);var ma=j;document.getElementById("value_"+r)&&(document.getElementById("value_"+r).innerText=ma)}var ua=j;24!==parseInt(s)&&202!==parseInt(s)||""===ua||(ua=crmCalendar.getDateObjectFromGivenDateString(ua)+""),"COMPANY"===r&&(crmConstants.reloadSalesNavigator=!0),"1"===s&&(ua=revertSplChrs(ua)),detailView.replaceDataParams(r,ua)}else $(f).html(j),$(h).html(j);$("[id=topSectionTitle]:eq(1)").html($("[id=topSectionTitle]:eq(0)").html());var pa=$("#headervalue_"+r);if(pa.length>0&&(pa.children().length>0&&(pa=pa.children().eq(0)),pa.addClass("bCardHover")),"Potentials"==l&&"CLOSINGDATE"==r)SalesSummaryInfo.DEALDURATION=Q,SalesSummaryInfo.SALESDURATION=X,loadSalesSummary();else if("Events"==l&&"VENUE"==r){var ga=$("#value_VENUE"),va=trimBoth(ga.html());""!=va&&Events.loadMap(va,500,200)}if("true"==H){var fa=getObj("h2");fa&&($(fa).empty(),fa.innerHTML=J)}null!=getElemById("value_MODIFIEDBY")&&($('[id="value_MODIFIEDBY"]').html(G),Crm.bindEventForUserBCView()),"Tasks"==l&&"STATUS"==r&&""!=q&&"null"!=q&&($('[id="value_CLOSEDTIME"]').text(q),$('[id="headervalue_CLOSEDTIME"]').length>0&&$('[id="headervalue_CLOSEDTIME"]').text(q)),-1===e.indexOf("/crm/v2/")||"Leads"!==l&&"Contacts"!==l&&"Accounts"!==l&&"Potentials"!==l||crmTab.deleteFromCache(l),refreshFollowDiv(),E.removeClass("errorFieldP"),$("#labelTD_"+r).removeClass("newmandatory").find(".infotoolTip").css("visibility","hidden").removeClass("infoTTStay")}if(("Tasks"==l||"Events"==l)&&-1!=Activities.reminderList.indexOf(c)){var ha=$("#notificationCount").text();$("#reminder_notification").text(ha).show(),$(".remainder-notifi").slideUp(),$(".timericon").removeClass("footIconActive timericonAct"),Activities.notifyCountToCrmPlusFrame(ha),$("#reminderContent").empty(),Activities.reminderCount=0,Activities.reminderList=""}}else B?renderingUtils.showCustomAlert("Invalid response!!!!"):"Potentials"==l&&"PROBABILITY"==r?renderingUtils.showCustomAlert(I18n.getMsg("crm.create.pbty.check")):null==j||"null"==j?renderingUtils.showCustomAlert(I18n.getMsg("crm.copy.error.mail.internal.error")):renderingUtils.showCustomAlert("Error:"+j);var ba=$("#"+i),Ca=ba.find("select");if(Ca.length>0&&Ca.select2("close"),ba.empty(),getObj(a).id.indexOf("header")>-1?show(a,"inline-block"):$("#"+a).css({display:"inline-block"}),"EMAIL"==r?setInfoIconNearEmailFeild(o.bouncedreason,"",o.bouncedtype):"ADDN_EMAIL"==r&&setInfoIconNearEmailFeild("",o.bouncedreason,"",o.bouncedtype),Crm.isUnsubscribeEnabled&&("EMAIL"===r||"ADDN_EMAIL"===r||"EMAILOPTOUT"===r||25==s)){var ya,Ia,wa=o.unsubInfo,Aa=o.hasOwnProperty("emailOptOutInfo"),Ea=new crmRequestPool;ot="recordId="+encodeURIComponent($("#id").val());ot+="&module="+encodeURIComponent(l),"EMAIL"!=r&&"ADDN_EMAIL"!=r||!k||""==k||(ot+="&emailid="+encodeURIComponent(k));try{Ia=Crm.getCrmBasePath()}catch(e){Ia=""}Ia&&""!=Ia&&Ea.initiate({action:Ia+"/unsubscribelink.do?step=getUnsubscribeInfo",type:"GET",data:ot,success:function(e){ya=e.unsubscribedInfo,Aa=e.hasOwnProperty("emailOptOutInfo"),wa=e.unsubInfo,setTimeout((function(){updateRecordUnsubscribeInfo(ya,Aa,e.emailOptOutInfo,wa)}),100)}})}if(F){var Ta=$("#entityId").val();if("Leads"==l)return void detailView.callLyteRefresh("Leads");"Quotes"!=l&&"SalesOrders"!=l||(document.location.href=Crm.getPortalURL(Crm.getCrmBasePath()+"/EntityInfo.do?module="+l+"&id="+Ta))}if(Macro.autoSuggest(l,!1),fileupload.removedAttachmentIds.length=0,fileupload.uploadedFileObject.length=0,"ACCOUNTID"==r&&"Contacts"==l&&(reloadPersonality("reportingcontactspersonality"),$('div[ddname="REPORTINGCONTACTSPERSONALITY"]').find("[id=contactTreePopup]")&&$('div[ddname="REPORTINGCONTACTSPERSONALITY"]').find("[id=contactTreePopup]").addClass("disabledArow")),2===parseInt(s)&&featuresAvailable.PickListTracker){var Sa;for(Nt="",Bt="historypersonality",jt=(Sa=crmRelatedList.personalityArr.split("||")).length,de=0;de<jt;de++){if(0==(st=Sa[de].split("_"))[0].indexOf(Bt)){Bt=st[0],Nt=st[1];break}}void 0!==Nt&&""!==Nt&&reloadPersonality(Bt)}var La=$(".detailViewContainer, .newBusinessCardView");$(".detailViewContainer").removeClass("editModeEnable"),$(".newBusinessCardView").removeClass("editModeEnable"),$(".newBusinessCardView").find(".newDateTimeField").removeClass("newDateTimeField"),$(".newBusinessCardView").find(".editLabelBC").removeClass("editLabelBC focusEleField"),$(".newBusinessCardView").find(".lookupFieldCreate").removeClass("lookupFieldCreate"),$(".newBusinessCardView").find("td").removeClass("selectBoxSelect2");var _a=$("#"+a);"TD"===_a.parent()[0].tagName&&(_a=_a.parent()),_a.removeClass("highlightNewLookupField forceHyphen").addClass("highlightNewLookupField"),_a.find(".busniess_card_Hover").removeClass("forceHyphen"),La.find(".forceHyphen").removeClass("forceHyphen"),1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&(detailView.setCurrentStageSetOnChange(),detailView.lastupdateChecking())}}},error:function(e){var v=e.responseJSON,f=$("#value_"+r);if("MAX_RECORDS_LIMIT_REACHED"!==v.code&&"MAX_LIMIT_REACHED"!==v.code)if("AUTHENTICATION_FAILURE"!==v.code&&"Authentication failed"!==v.message)if(v.code&&"INVALID_DATA"===v.code&&"error"===v.status&&"the id given seems to be invalid"===v.message)renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"));else if("MANDATORY_NOT_FOUND"===v.code||v.data&&"MANDATORY_NOT_FOUND"===v.data[0].code){if(v.data&&v.data[0]&&v.data[0].details&&"id"===v.data[0].details.api_name&&/\b(5|4|6|7|9|10|12|13|15|133|135)\b/.test(F.data("uitype"))){var h=F.data("lookupModule"),b=moduleRecordMapping[h].singular_label,C=I18n.getMsg("crm.label.lookup.norecord",b)+" ",y=$("<a class='cP autoRecordCreateAlert'>");y.attr({id:"lookupFieldAlertDiv","data-zcqa":"createNewRecord",onclick:"crmLookupAutoComplete.openSearchCreatePopUp('"+F[0].id+"','createPageLookup','"+h+"')"}).text(I18n.getMsg("crm.label.create.new")+" "+b),C+=y.get(0).outerHTML,Crm.showErrorMsg(C,F)}else Crm.showErrorMsg(I18n.getMsg("crm.field.valid.check",[F.data("displaylabel")]),F);itsonview=!0}else{if(v.data&&("WEBINAR_SCHEDULE_INVALID"===v.data[0].code||"TP_SERVICE_UPDATE_FAILED"===v.data[0].code))return crmui.showMsgBand("error",v.data[0].message,3e3),void commonUtils.showHideLoadingDiv();if(v.data&&"MAPPING_MISMATCH"===v.data[0].code&&"Pipeline"===v.data[0].details.mapped_field&&""===returnJson.entityMapJson.PIPELINE.defaultvalue)Crm.showErrorMsg(I18n.getMsg("crm.pipeline.empty.detailview.disable"),F);else if(v.data&&"MAPPING_MISMATCH"===v.data[0].code&&"Pipeline"===v.data[0].details.mapped_field&&""===returnJson.entityMapJson.PIPELINE.defaultvalue)Crm.showErrorMsg(I18n.getMsg("crm.pipeline.empty.detailview.disable"),F);else if("NO_PERMISSION"===v.code||v.data&&"RECORD_IN_BLUEPRINT"===v.data[0].code||v.data&&"CANNOT_PERFORM_ACTION"===v.data[0].code||v.data&&"MAPPING_MISMATCH"===v.data[0].code)renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"));else{if(v.data&&"DELETED_ZOHO_CAMPAIGN_UPDATE"===v.data[0].code)return commonUtils.showHideLoadingDiv(),void crmui.showMsgBand("error",I18n.getMsg("crm.zcampaign.record.deleted.campaigns.dynamic",Crm.integrationsAppName.ZOHO_CAMPAIGNS),4e3);if(v.data&&"UNAUTHORIZED_CAMPAIGN_USER"===v.data[0].code)return commonUtils.showHideLoadingDiv(),void crmui.showMsgBand("error",I18n.getMsg("crm.campaign.non.campaign.user.error.dynamic",Crm.integrationsAppName.ZOHO_CAMPAIGNS),4e3);if(v.data&&"NO_PERMISSION_FOR_EMAILID"===v.data[0].code)return commonUtils.showHideLoadingDiv(),void crmui.showMsgBand("error",I18n.getMsg("crm.zcampaign.emailid.permission.denied"),4e3);if(v.data&&"NOT_ALLOWED"===v.data[0].code){if("Zoho Campaign can't be updated after the campaign is sent"!==v.data[0].message)return void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.alert.can.not.edit.email"));crmui.showMsgBand("error",I18n.getMsg("crm.zcampaign.edit.campaign.disallowed.dynamic",Crm.integrationsAppName.ZOHO_CAMPAIGNS),4e3)}if(f&&f.hasClass("imageDetailWrap")){var I=f.find("crm-image-upload-detail")[0].component;if(void 0!==v.data){var w="";return w="storage space exceeds"===v.data[0].message?I18n.getMsg("crm.fileuploader.entityattachments.message.507"):"LIMIT_EXCEEDED"===v.data[0].code?1===v.data[0].details.limit?I18n.getMsg("crm.attachment.imageUploadField.Minlen.check"):I18n.getMsg("crm.imageupload.allowed.field.length",v.data[0].details.limit):I18n.getMsg("crm.imageupload.failure"),I.constructErrorDiv(w),void commonUtils.showHideLoadingDiv()}renderingUtils.displayPermissionDenied(null,null,v.message)}else{if("Internal Server Error"===v.message||v.data[0].code&&"INVALID_DATA"===v.data[0].code){var A=v.message?v.message:v.data[0].message;return 555!==parseInt(s)&&556!==parseInt(s)||!v.details.maximum_length?void renderingUtils.displayPermissionDenied(null,null,A):(crmui.showMsgBand("error",I18n.getMsg("crm.attachment.fileUploadField.Maxlen.check.field",[v.details.maximum_length,r]),3e3),void commonUtils.showHideLoadingDiv())}if("duplicate data"===v.data[0].message){var E={},T=v.data[0].details,S=returnJson.entityMapJson,L="",_=v.data[0].details.api_name;for(var O in S)if(S[O].sysRefName===_){L="true"===S[O].customfield?S[O].displaylabel:S[O].label;break}var M=T.duplicate_record;E.FIELDLABEL=L,E.OWNERNAME=M.Owner.name,E.MODULE=l,E.RECORDS={},E.COUNT=T.more_records?2:1,E.ZUID=M.Owner.zuid,delete M.Owner;var P={};P.ENTITYID=M.id,delete M.id;var k=[];if(Object.keys(M).length>1){var R=Crm.userDetails.NAME_FORMAT;R=R.split(",");var D=[];R.forEach((function(e){"Salutation"!==e&&(e=e.replace(" ","_")),M[e]&&D.push(M[e])})),P.ENTITYNAME=D.join(" "),P.ENTITYNAMEFORPOPOVER=D.join(" ")}else for(var U in M)P.ENTITYNAME=M[U],P.ENTITYNAMEFORPOPOVER=M[U];k.push(P),E.RECORDS=k,Crm.hideDuplicateErrorMsg("viewentityform"),itsonview=!0;var x=Crm.getDuplicateErrorMsg(E,!1);return Crm.showErrorMsg(x,$("#Crm_"+l+"_"+r),l),void commonUtils.showHideLoadingDiv()}if("DUPLICATE_LINKING_DATA"===v.data[0].code){var N=(V=v.data[0].details.duplicate_record).id,B=V.Name,j=(Crm.getCrmBasePath(),I18n.getMsg("crm.linking.module.duplicate.warning",[l,N,B,Crm.getCrmBasePath()]));renderingUtils.showCustomAlert(j,"",!0),Crm.hideDuplicateErrorMsg("viewentityform"),itsonview=!0}else if("SELF_REFERENCE_LINKING_DATA_INPUT"===v.data[0].code){var V;N=(V=v.data[0].details.duplicate_record).id,B=V.Name,j=I18n.getMsg("crm.linking.module.sameassociation.warning");renderingUtils.showCustomAlert(j,"",!0),Crm.hideDuplicateErrorMsg("viewentityform"),itsonview=!0}else if("FILTER_CRITERIA_NOT_SATISFIED"===v.data[0].code){h=F.data("lookupModule");let e=221===F.data("uitype")?I18n.getMsg("crm.user.text"):moduleRecordMapping[h].singular_label;Crm.showErrorMsg(I18n.getMsg("crm.lookupfilter.entity.errormsg",e),F,l),commonUtils.showHideLoadingDiv(),itsonview=!0}else"SCHEDULER_RUNNING"===v.data[0].code&&(renderingUtils.showCustomAlert(v.data[0].message,"",!0),Crm.hideDuplicateErrorMsg("viewentityform"),itsonview=!0);if("BLOCKED_RECORD"===v.data[0].code){var H=Handlebars.templates.blockListWarning();return $(H).appendTo("body"),crmui.showPopup("blockListWarning"),void $("#blockListWarning .redbtn").on("click",(function(){crmui.hidePopup("blockListWarning"),$(H).remove();Callonclickofbutton("/crm/v2/",t,a,i,r,l,n,s,o,d,c,m,u,p,g,!0)}))}e&&"error"===e.status&&renderingUtils.displayPermissionDenied(http)}}}else renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error"));else Crm.showStorageExceedPopup()},complete:function(){commonUtils.showHideLoadingDiv();var e=$("#"+r),t=document.getElementById("iskanbanview");if(!e||t&&"true"===t.value||e.attr("class","label"),("Contacts"==l||"Leads"==l)&&"EMAIL"==r){var a="false",i=$("#supportStatus");null!=i&&(a=i.val()),"Enabled"==a&&getSupportLists(k,"1")}$(".newDetailPageStyle").find(".focusEleField").removeClass("focusEleField"),$L("#rpBtnResubmit").removeClass("disable")}})}))}crmLookupBusinessCard.result=null}function displayUniqueFieldDuplicateError(e,t,a){Crm.hideDuplicateErrorMsg("viewentityform");var i=e.INFO[0],r=i.MODULE,l=t.replace(/ /g,"\\ "),n=Crm.getDuplicateErrorMsg(i,!1);Crm.showErrorMsg(n,$("#Crm_"+a+"_"+l),r),commonUtils.showHideLoadingDiv(),itsonview=!0}function show(e,t){t=t||"block",$("#"+e).css("display",t)}function showHide(e,t){show(e),hide(t)}function hide(e,t){if($("#"+e).hide(),"popupnew"==e&&$("body").removeClass("leftPanelHovered oH"),"crmspanid"!=e&&(null==t||""==t)){var a=document.getElementById("iskanbanview");a&&"true"===a.value||!document.getElementById("FreezeLayer")||$(".etTrendsWrapper").length||$(".etTrendsWrapperCNS").length||document.body.removeChild(document.getElementById("FreezeLayer"))}"summaryfield"==e&&$(".bCardHover,.bCardHoverLeft").removeClass("bCardHoverLeft"),$(".fieldHover").removeClass("fieldHover")}function handleMouseOver(e,t,a,i,r,l,n,s){if(!detailView.recordLocked)if(detailView.readOnlyField=!1,"LAYOUTID"==t&&returnJson&&returnJson.layout_jsonarrayObj.showLayoutOption)a=!1;else{t=unescape(t);var o=$("#module").val();if(s||"true"===String(a)||-1!==["DAYSVISITED","NUMBEROFCHATS","FIRSTVISITEDTIME","REFERRER","AVERAGETIMESPENT","LASTVISITEDTIME","FIRSTVISITEDURL","REMINDAT","PROBABILITY","COMMENTCOUNT","PRICINGMODEL","RECURRING","REMINDINVITEESAT"].indexOf(t)||"false"===String(allowEditProf)||"Who Id"===t||"What Id"===t||"Potentials"===o&&"EXPECTEDREVENUE"===t||"Calls"===o&&("CALLSTARTDATETIME"===t||"CALLDURATION"===t||"CALLDURATIONINSEC"===t||"CALLTYPE"===t))detailView.readOnlyField=!0;else if(Crm.isUnsubscribeEnabled||"EMAILOPTOUT"!==t||!$("#mouseArea__EMAILOPTOUT").find("#emailOptOutInfo").hasClass("unsubInfo"))if(detailView.changedBCJson.hidden.SECURITY_EDIT_ALLOWED)if(detailView.changedBCJson.hidden.RECORD_FIELDS_EDIT_ALLOWED){if("Contacts"===o&&"REPORTINGTOCONTACTID"===t){var d=$("#subvalue_ACCOUNTID");if(!d[0]||!d[0].dataset.params||""===JSON.parse(d[0].dataset.params).id)return void(detailView.readOnlyField=!0);detailView.readOnlyField=!1}if("Appointments"===o){if("REMINDER"===t||"APPOINTMENTDATEANDTIME"===t||"SERVICEID"===t||"SEID"===t||"SMOWNERID"===t||"APPOINTMENTFOR"===t||"APPOINTMENTSTATUS"===t||"APPOINTMENTLOCATION"===t||"APPOINTMENTADDRESS"===t||"APPOINTMENTNAME"===t||"RESCHEDULEDFROM"===t){if("APPOINTMENTDATEANDTIME"===t&&!n){var c=$("#iconReminder1");c.css({position:"absolute",top:$("#subvalue_"+t).position().top+4,left:$("#value_"+t).width()+10}),c.show(),c.children().first().css({left:-33}),$("#mouseArea__"+t).attr("onMouseOut","$('#iconReminder1').hide();")}return void(detailView.readOnlyField=!0)}var m="#mouseArea__"+t;if($("#jobSheetInfoSection").find(m).length>0)return void(detailView.readOnlyField=!0)}if(itsonview)return $(".imageDetailWrap").not(".imageEditState").closest(".imageUploadDetailPage").addClass("eventNone"),void(detailView.readOnlyField=!0);var u="";n?(u="header_"+t,globalvaluespanid="headervalue_"+t,globaltextareapanid="headertextarea_"+t):(u="mouseArea__"+t,globalvaluespanid="value_"+t,globaltextareapanid="textarea_"+t);o=detailView.currentModule;globaltextboxpanid="Crm_"+o+"_"+t,globalfieldlabel=t,objectUtils.getKeys(Crm.jsonDepValues[o]).contains(globalfieldlabel)||209==e||show("crmspanid"),globalsubvaluespanid="subvalue_"+t,globaluitype=parseInt(e),comboCount=r;var p=getObj("crmspanid"),g=null,v=null,f=0,h=$("#"+globalvaluespanid),b=h.parents("td"),C=(h.offset(),h.width(),$(getObj(u))),y=C.find(".labelVal"),I=C.hasClass("bcEditIcon"),w=y.offset(),A=w.top+9,E=w.left+y.outerWidth()-20,T=b.offset(),S=$("#DetailViewInnerTabs"),L=$("#detailViewButtonLayerDiv"),_=document.getElementById("iskanbanview"),O=9;if(1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI){if(O=5,S.length&&null!=S){var M=L.outerHeight();$("#DetailViewInnerTabs").outerHeight();O="undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()?M:M+55}var P=$("#subscriptionExpiryMsgband");if(P.length)O+=P.outerHeight()}if(I)A=T.top-O,E=T.left+b.outerWidth()-20;if(n)g=T.top-2,1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&(g=T.top-O),v=T.left;else{var k=document.getElementById("basic").offsetLeft;g=$(getObj(u)).offset().top,1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&(g=$(getObj(u)).offset().top-O),v=$(getObj(u)).find(".labelVal").offset().left}if(p.setAttribute("onclick","ajaxEdit();sE(event);"),_&&"true"===_.value)if(1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI){$(p).offset({top:A,left:E});var R=C.parents(".busniesscard_width");$("#kventitydetailspage").length&&R.length&&$(p).offset({top:A+11,left:E})}else I&&(f=20),$(p).offset({top:A+f,left:E});else n?Crm.userDetails.RTL_ENABLED?p.style.left=findPosX(getObj("header_"+t))+10+"px":p.style.left=v+$(getObj(globalvaluespanid)).parents("td").outerWidth()-23+"px":Crm.userDetails.RTL_ENABLED?p.style.left=v+10-k+"px":p.style.left=v+$(getObj(u)).find(".labelVal").outerWidth()-22-0-k+"px",$(getObj(u)).hasClass("tabDiv"),p.style.top=g+11+"px",$(getObj(u)).hasClass("uiType3")&&(p.style.top=g-11+"px")}else detailView.readOnlyField=!0;else detailView.readOnlyField=!0;else detailView.readOnlyField=!0}}function Callonclickofbutton2(e,t,a,i,r,l,n,s,o,d){var c="";if(!d||!d.skipAlert){if("Forecasts"==t)c=window.confirm(I18n.getMsg("confirmforecast"));else{if("Contacts"==t&&customViewObject.isZBCustomModuleEnabled)return void ZInvoice.getAlertContentForContacts(e,t,a,i,r,l,n,s,o,d);"Accounts"!=t?c=window.confirm(I18n.getMsg("confirmmsg")):(c=!0,$("#Warningdiv").hide())}if(0==c)return}loadAjaxTab();var m=void 0;crmListView.getObject().doMassActioninScheduler?m=crmListView.getObject().totalCount:null==(m=crmListView.getObject().selectedIds.length)&&(m=1);var u=!1;!d||1!=d.isWfTriggerCheckReq&&"true"!=d.isWfTriggerCheckReq||(u=!0),crmListView.getObject().doMassActioninScheduler&&m<=Crm.massOperationWorkflowLimit&&0==u&&Crm.trackSpotLightAction("Mass Scheduler - Delete Confirmed",{Module:t});var p=crmListView.getObject().includeChild?1:0,g={isload:!0,cvid:r,module:t,ajax:!0,display_cust_view_name:i,FROM_INDEX:crmListView.getObject().fromIndex,TO_INDEX:crmListView.getObject().toIndex,deleteEntityID:a,rangeValue:crmListView.getObject().currentOption,advSearchEnableVal:crmListView.getObject().advSearchEnable,isMassJobScheduled:crmListView.getObject().doMassActioninScheduler,isWfTriggerCheck:u,territoryId:crmListView.getObject().territoryId,includechild:p};if("Visits"===t){var v=crmListView.getObject().portalName;"All Portals"==v?g.allPortals=!0:(g.portalName=v,g.allPortals=!1)}"Potentials"!==t&&"Deals"!==t||crmListView.getObject().pipeline&&"0"!==crmListView.getObject().pipeline&&(g.pipeline=crmListView.getObject().pipeline),"All"!=crmListView.getObject().searchletter&&(g.searchletter=crmListView.getObject().searchletter);var f=null;if(crmListView.getObject().criteriaSearch&&1==crmListView.getObject().criteriaSearch){var h=crmListView.getObject();g.rowCount=Search.rowcnt;for(var b=[],C=1;C<=Search.rowcnt;C++){var y={text:h["searchfield"+C],type:h["searchfieldtype"+C],match:h["match"+C]};g["searchfield"+C]=h["searchfield"+C],1!=C&&(g["match"+C]=h["match"+C]),g["searchfieldtype"+C]=h["searchfieldtype"+C],"U"==(o=h["searchfieldtype"+C])?(y.value=g["searchuser"+C]=h["searchuser"+C],y.ptn=g["usercondition"+C]=h["usercondition"+C],Search.formUserConditionValues(y,C,"temp_value",y.value),y.temp_value=g["temp_searchuser"+C]=y.temp_value):"T"==o?(y.ptn=g["textcondition"+C]=h["textcondition"+C],y.value=g["searchtext"+C]=h["searchtext"+C]):"picklist"==o?(y.value=g["searchpicklist"+C]=h["searchpicklist"+C],y.ptn=g["textpicklistcondition"+C]=h["textpicklistcondition"+C]):"N"==o?(y.value=g["searchnum"+C]=h["searchnum"+C],y.ptn=g["numcondition"+C]=h["numcondition"+C]):"B"==o?(y.value=g["searchboolean"+C]=h["searchboolean"+C],y.ptn=g["booleancondition"+C]=h["booleancondition"+C]):"CML"==o?(y.value=dataOb["searchcampcv"+C]=h["searchcampcv"+C],y.ptn=g["campcvcondition"+C]=h["campcvcondition"+C],y.temp_value=g["temp_searchcampcv"+C]=h["temp_searchcampcv"+C]):"D"==o?(y.ptn=g["datecondition"+C]=h["datecondition"+C],h["datecondition"+C]==Search.ageCrt||h["datecondition"+C]==Search.dueCrt?(y.ageindayscondition=g["ageindayscondition"+C]=h["ageindayscondition"+C],y.ageindays=g["ageindays"+C]=h["ageindays"+C]):(y.value=g["searchdate"+C]=h["searchdate"+C],y.edate=g["searchedate"+C]=h["searchedate"+C])):"DT"==o?(y.ptn=g["datetimecondition"+C]=h["datetimecondition"+C],h["datetimecondition"+C]==Search.ageCrt||h["datetimecondition"+C]==Search.dueCrt?(y.ageindayscondition=g["ageindayscondition"+C]=h["ageindayscondition"+C],y.ageindays=g["ageindays"+C]=h["ageindays"+C]):(y.value=g["searchdatedate"+C]=h["searchdatedate"+C],y.sthour=g["searchsthour"+C]=h["searchsthour"+C],y.stminute=g["searchstminute"+C]=h["searchstminute"+C],y.stampm=g["searchstampm"+C]=h["searchstampm"+C],y.enddate=g["searchenddate"+C]=h["searchenddate"+C],y.endhour=g["searchethour"+C]=h["searchethour"+C],y.endminute=g["searchetminute"+C]=h["searchetminute"+C],y.stime=g["searchstime"+C]=h["searchstime"+C],y.etime=g["searchetime"+C]=h["searchetime"+C],y.endampm=g["searchetampm"+C]=h["searchetampm"+C])):"territory"==o&&(y.ptn=g["territorycondition"+C]=h["territorycondition"+C],y.value=g["searchterritory"+C]=h["searchterritory"+C]),b.push(y)}g.patternVal=h.patternVal,b.push(g.patternVal),g.criteriaSearch=!0,f=JSON.stringify(b)}g[csrfParamName]=csrfToken;var I=objectUtils.getKeys(crmListView.startIndex).sort()[0];g.FROM_INDEX=I,g.TO_INDEX=parseInt(I)+parseInt(g.rangeValue)-1,crmListView.getFilterParams(g),g.fetchOnlyBody="true",("list"===Lyte.Router.getRouteInstance().routeName||crmListView.getObject().isPrivacyListView)&&(g.from="listview"),doMassDelete(t,e,g,a.split(";"),f)}function doMassDelete(e,t,a,i,r){var l=void 0;l=isWFSchedulerUser()?i.splice(0,i.length):i.splice(0,crmConstants.maxRecOperCnt),a.deleteEntityID=l.join(";");var n=new crmRequestPool;customViewObject.filters&&(a.isNewFilter=!0,a.filters=JSON.stringify(customViewObject.filters)),customViewObject.cross_filters&&(a.isNewFilter=!0,a.cross_filters=JSON.stringify(customViewObject.cross_filters)),hideAnimatePopup("deletepopup"),n.initiate({action:t,data:a,type:"POST",dataType:"json",success:function(l){var n=l.orchestration_used;if(n)Crm.showOrchUsedBUlkDenyPopUp(n);else if(l.CannotDelete){var s='<div onclick="sE()" class="w500 p20"><div class="floatL pL20 w430"><div class="f20"><h2 style="color:#E20000";>'+I18n.getMsg(l.CannotDelete[0])+'</h2></div><div class="mT10">'+I18n.getMsg(l.CannotDelete[1])+'</div></div><br class="clearB"><div  class="alignright mT20"><input type="button" id="popupok" class="primarybtn" value="'+I18n.getMsg("crm.button.ok")+"\" onclick=\"hide('popupnew');removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30\"></div></div>";renderingUtils.popUpWithFreeze(s)}else{var o,d=Lyte.Router.getRouteInstance();if(1===i.length&&""===i[0]||i.length<=0){if("listview"!=a.from&&l.body&&0!=l.body.length){for(var c=[],m=l.fromIndex-1,u=0;m<=l.toIndex;m++,u++)l.body[u]?c[m]=l.body[u]:c[m]=null;l.body=c}var p=crmListView.getObject();if(void 0!==l.isWfTriggered&&1==l.isWfTriggered&&void 0!==l.approvalProcessTriggered&&1==l.approvalProcessTriggered)return void showMassDeleteRelatedRulesAlert(I18n.getMsg("crm.mass.actions.rules.alert.content",[I18n.getMsg("crm.mass.actions.workflow.rules")+" & "+I18n.getMsg("crm.mass.actions.approval.process")]));if(void 0!==l.isWfTriggered&&1==l.isWfTriggered)return void showMassDeleteRelatedRulesAlert(I18n.getMsg("crm.mass.actions.rules.alert.content",[I18n.getMsg("crm.mass.actions.workflow.rules")]));if(void 0!==l.approvalProcessTriggered&&1==l.approvalProcessTriggered)return void showMassDeleteRelatedRulesAlert(I18n.getMsg("crm.mass.actions.rules.alert.content",[I18n.getMsg("crm.mass.actions.approval.process")]));if(1==l.exceededRecordLimit);else if(void 0!==l.isWfTriggered&&0==l.isWfTriggered)commonUtils.showHideLoadingDiv(),removeFreezeLayer();else if(1==l.isScheduledMassOperation||"true"==l.isScheduledMassOperation){if(commonUtils.showHideLoadingDiv(),removeFreezeLayer(),hideFreezeLayer(),hideAnimatePopup("massActionWorkFlowPopUp"),"listview"!=a.from?(crmListView.checkAll(),showHideListViewBtnFn(),crmListView.selectAllEntity("",$(".selCountIcon dIB"))):Lyte.registeredMixins["crm-view-utils"].clearSelection(),0==l.isValidInterval)return;if(1!=l.success){if(1==l.jobRunningForCvid)return void crmui.showMsgBand("info",I18n.getMsg("crm.mass.actions.cv.running"),4e3,"");var g=I18n.getMsg("crm.mass.actions.delete"),v=I18n.getMsg("crm.mass.actions.scheduled.fail",[g]);return void crmui.showMsgBand("error",v,18e4,"")}var f=I18n.getMsg("crm.mass.actions.mass.delete.job");f=l.isQueued?f+" "+I18n.getMsg("crm.mass.actions.scheduled.submit"):f+" "+I18n.getMsg("crm.mass.actions.scheduled.success"),crmui.showMsgBand("success",f,4e3,"");var h=$("#selectAllRecords");if(crmListView.setHideActionInModule(),h.length>0)return h.hide(),customViewObject.showSelectAll=!1,void customViewObject.moreActions.push("hideSelectAllRecords")}else if("false"==l.error&&"listview"!=a.from){1!=l.isStageView&&1!=l.isPredictView&&(p.body=l.body),p.fromIndex=l.fromIndex,p.toIndex=l.toIndex,p.selectedIds=[],l.body&&0!=l.body.length?($("#listviewHeaderRow").parent().html(Handlebars.templates.heading(p)),$(".fixedrowTd").html(Handlebars.templates.fixedColumnlistview(p)),$("#lvTred").html(Handlebars.templates.body(p)),p.isCustomizedView?new listViewHandler(p).renderListView():(renderingUtils.tableSorter("listViewTable","2",""),$("#listviewtablescroll").removeClass("oH"))):l.isStageView||l.isPredictView?(l.isPredictView?p.predictData=l.predictData:p.stageBoardDetails=l.stageBoardDetails,$("#lv_stageview").html(Handlebars.templates.stageView(p)),l.isPredictView?crmListView.loadPredictSummary():crmListView.loadStageSummary(),crmListView.afterRenderStageView(p)):(0===$("#lvNoRecordsFound").length&&($("#lvTred").html(""),$("#listviewHeaderRow").parent().html(Handlebars.templates.heading(p)),$(".fixedrowTd").html(Handlebars.templates.fixedColumnlistview(p)),$(Handlebars.templates.noRecordsFound(p)).insertAfter("#lvTred"),renderingUtils.tableSorter("listViewTable","0","")),$("#tcDiv").hide(),$("#checkAll").hide()),1!=l.isStageView&&1!=l.isPredictView&&crmListView.getNavigationDiv(p),crmListView.checkAll(),showHideListViewBtnFn(),crmNavig.parseCurrentListView();var b='&nbsp;&nbsp;<nobr><a id="totalRecordsCount" href="javascript:;" onclick="showTotalCount(this,\''+I18n.getMsg("crm.label.totalcount")+'\')" class="link date">'+I18n.getMsg("crm.label.totalcount")+': <span id="totalCountNo">###</span></a></nobr>&nbsp;&nbsp;';$("#tcDiv").html(b),l.fetchCountValues&&showTotalCount($("#tcDiv #totalRecordsCount"),void 0,"false"),delete p.totalCount}else"listview"!=a.from&&$("#show").empty().html(l.responseText);customViewObject.isPrivacyListView||crmTab.putInCache(e,p),commonUtils.showHideLoadingDiv(!1),removeFreezeLayer(),overLayForSelectAllClick(!1)}else doMassDelete(e,t,a,i,r);if("listview"==a.from)if((1==l.isScheduledMassOperation||"true"==l.isScheduledMassOperation&&1==l.success)&&(o=!0),customViewObject.isPrivacyListView&&(Events.isPageLayoutModified=!0,CrmPrivacyDashboard.reloadCurrentListView()),(customViewObject.totalCount%customViewObject.currentOption==customViewObject.selectedIds.length||customViewObject.selectedIds.length==customViewObject.currentOption)&&customViewObject.totalCount>customViewObject.currentOption){var C=customViewObject.totalCount-customViewObject.selectedIds.length;crmTab.deleteFromCache(customViewObject.module),Lyte.registeredMixins["crm-view-utils"].hideCVbtns();var y=Math.round(C/customViewObject.currentOption);0==Math.round(C%customViewObject.currentOption)&&d.getQueryParams().page==y+1?d.setQueryParams("page",y):crmListView.reloadCurrentListView(void 0,d.routeName,o)}else crmListView.reloadCurrentListView(void 0,d.routeName,o)}}})}function convertColumnName(e,t){return"SMCREATORID_FIRSTNAME"==e?e="Created By":"MODIFIEDBY_FIRSTNAME"==e?e="Modified By":"SMOWNERID_FIRSTNAME"==e&&"Activities"!=t?e=t.substring(0,t.length-1)+" Owner":"SMOWNERID_FIRSTNAME"==e&&"Activities"==t?e="Activity Owner":"Last Name"==e&&(e="Full Name"),e}function showSortDiv(e,t,a,i){var r,l=$(e),n=l.offset(),s=document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop,o=document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft,d=getObj("sort_div"),c="BEST_TIME"===e.id;d.style.top=n.top+l.outerHeight()+"px",d.style.position="fixed";var m=moduleRecordMapping[a].cvid;if(o>0&&0===s&&(d.style.left=n.left+"px"),s<50)d.style.left=n.left-o+"px";else{var u=$("#cvpadding");0==$("#copyListviewHeaderDiv").is(":visible")&&1==u.hasClass("pFixed")?d.style.top=l.position().top+l.outerHeight()+82-(u.outerHeight()+15)-s+"px":$("#sort_div").addClass("fixedTopColumnList"),d.style.position="fixed",d.style.left=n.left-o+"px",d.style.zIndex=2502}var p=getObj("sorted_column"),g=void 0!==crmListView&&void 0!==crmListView.getObject().nearmeSortOrder?crmListView.getObject().nearmeSortOrder.trim():"",v="<div><ul>",f=JSON.stringify({clickId:"sortingRecords",clearCache:!0,module:a,fromIndex:1,sortColumnString:t,sortOrderString:"sort_asc",webTab:"false",mailingAddress:g}),h=JSON.stringify({clickId:"sortingRecords",clearCache:!0,module:a,fromIndex:1,sortColumnString:t,sortOrderString:"sort_desc",webTab:"false",mailingAddress:g}),b=JSON.stringify({clickId:"sortingRecords",clearCache:!0,module:a,fromIndex:1,sortColumnString:"",sortOrderString:"sort_desc",webTab:"false",mailingAddress:g});if(crmListView.getObject().isPrivacyListView){var C={};C.module=crmListView.getObject().module.replace("privacy_",""),C.fromIndex=1,C.toIndex=parseInt(crmListView.getObject().currentOption),C.currentOption=crmListView.getObject().currentOption,C.type=crmListView.getObject().privacyDetails.type,C.status=crmListView.getObject().privacyDetails.status,crmListView.getObject().filters&&crmListView.getObject().filters.length&&(C.filters=JSON.stringify(crmListView.getObject().filters)),C.sortColumnString="",C.sortOrderString="sort_desc",b=$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(C)),C.sortColumnString=t,h=$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(C)),C.sortColumnString=t,C.sortOrderString="sort_asc",f=$ESAPI.encoder().encodeForHTMLAttribute(JSON.stringify(C))}"Potentials"!=a&&"Accounts"!=a&&"Contacts"!=a&&"Leads"!=a||(f.fetchOnlyBody=!0,h.fetchOnlyBody=!0,b.fetchOnlyBody=!0);var y=JSON.stringify({module:a,fromIndex:1,sortColumnString:t,sortOrderString:"sort_desc",webTab:"false",mailingAddress:"sortby_name"}),I=JSON.stringify({module:a,fromIndex:1,sortColumnString:t,sortOrderString:"sort_desc",webTab:"false",mailingAddress:"sortby_distance"}),w={};if(w.sort_by=t,crmListView.getObject()){var A=crmHistory.getPageDetailsFromIndex(1,crmListView.getObject().currentOption);w.page=A.page,w.per_page=A.perPage}var E=Lyte.Router.getRouteInstance().transition.info.queryParams;E.filters?w.filters=E.filters:E.filter_id&&(w.filter_id=E.filter_id);var T=objectUtils.cloneObject(w),S=objectUtils.cloneObject(w);if(c)T.sort_order="sort_asc",crmListView.getObject().isPrivacyListView?v+='<li><link-to data-zcqa="privacySorting_desc" lt-prop-route="crm.settings.section.compliance.consent-dashboard.list-view" lt-prop-qp="'+h+'">'+I18n.getMsg(c?"crm.column.sort.asc":"crm.column.sort.desc")+'&nbsp;<span class="svgIcons '+(c?"sort_asc":"sort_desc")+'"></span></link-to></li>':v+='<li><link-to  data-zcqa="sorting_desc" lt-prop-route="crm.tab.module.custom-view.list"  lt-prop-td=\''+f+"'  lt-prop-dp='[\""+a+'","'+m+"\"]'>"+I18n.getMsg(c?"crm.column.sort.asc":"crm.column.sort.desc")+'&nbsp;<span class="svgIcons '+(c?"sort_asc":"sort_desc")+'"></span></link-to></li>',S.sort_order="sort_unsort",crmListView.getObject().isPrivacyListView?v+='<li><link-to data-zcqa="privacySorting_unsort" lt-prop-route="crm.settings.section.compliance.consent-dashboard.list-view" lt-prop-qp="'+b+'">'+I18n.getMsg("crm.column.unsort")+"</link-to></li>":v+="<li><link-to  lt-prop-td= '"+b+'\'  lt-prop-route="crm.tab.module.custom-view.list"  lt-prop-dp=\'["'+a+'","'+m+'"]\' data-zcqa="sort_unsort">'+I18n.getMsg("crm.column.unsort")+"</link-to></li>";else if(null!=p){var L=$("#sorted_column").data("param").fieldid;null!=L&&(r=getObj("sorted_column").className),L==t?r.indexOf("sort_asc")>-1?(T.sort_order="sort_desc",crmListView.getObject().isPrivacyListView?v+='<li><link-to data-zcqa="privacySorting_desc" lt-prop-route="crm.settings.section.compliance.consent-dashboard.list-view" lt-prop-qp="'+h+'">'+I18n.getMsg("crm.column.sort.desc")+'&nbsp;<span class="svgIcons sort_desc"></span></link-to></li>':v+='<li><link-to  data-zcqa="sorting_desc" lt-prop-route="crm.tab.module.custom-view.list"  lt-prop-td=\''+f+"'  lt-prop-dp='[\""+a+'","'+m+"\"]'>"+I18n.getMsg("crm.column.sort.desc")+'&nbsp;<span class="svgIcons sort_desc"></span></link-to></li>',S.sort_order="sort_unsort",crmListView.getObject().isPrivacyListView?v+='<li><link-to data-zcqa="privacySorting_unsort" lt-prop-route="crm.settings.section.compliance.consent-dashboard.list-view" lt-prop-qp="'+b+'">'+I18n.getMsg("crm.column.unsort")+"</link-to></li>":v+="<li><link-to  lt-prop-td= '"+b+'\'  lt-prop-route="crm.tab.module.custom-view.list"  lt-prop-dp=\'["'+a+'","'+m+'"]\' data-zcqa="sort_unsort">'+I18n.getMsg("crm.column.unsort")+"</link-to></li>"):(T.sort_order="sort_asc",crmListView.getObject().isPrivacyListView?v+='<li><link-to data-zcqa="privacySorting_asc" lt-prop-route="crm.settings.section.compliance.consent-dashboard.list-view" lt-prop-qp="'+f+'">'+I18n.getMsg("crm.column.sort.asc")+'&nbsp;<span class="svgIcons sort_asc"></span></link-to></li>':v+='<li><link-to data-zcqa="sorting_asc"  lt-prop-td=\''+f+'\'  lt-prop-route="crm.tab.module.custom-view.list"   lt-prop-dp=\'["'+a+'","'+m+"\"]'>"+I18n.getMsg("crm.column.sort.asc")+'&nbsp;<span class="svgIcons sort_asc"></span></link-to></li>',S.sort_order="sort_unsort",crmListView.getObject().isPrivacyListView?v+='<li><link-to data-zcqa="privacySorting_unsort" lt-prop-route="crm.settings.section.compliance.consent-dashboard.list-view" lt-prop-qp="'+b+'">'+I18n.getMsg("crm.column.unsort")+"</link-to></li>":v+="<li><link-to  lt-prop-dp='[\""+a+'","'+m+"\"]'  lt-prop-td= '"+b+'\'  lt-prop-route="crm.tab.module.custom-view.list" data-zcqa="sort_unsort">'+I18n.getMsg("crm.column.unsort")+"</link-to></li>"):(T.sort_order="sort_asc",crmListView.getObject().isPrivacyListView?v+='<li><link-to data-zcqa="privacySorting_asc" lt-prop-route="crm.settings.section.compliance.consent-dashboard.list-view" lt-prop-qp="'+f+'">'+I18n.getMsg("crm.column.sort.asc")+'&nbsp;<span class="svgIcons sort_asc"></span></link-to></li>':v+='<li><link-to data-zcqa="sortingasc"  lt-prop-td=\''+f+'\'  lt-prop-route="crm.tab.module.custom-view.list"   lt-prop-dp=\'["'+a+'","'+m+"\"]'>"+I18n.getMsg("crm.column.sort.asc")+'&nbsp;<span class="svgIcons sort_asc"></span></link-to></li>',S.sort_order="sort_desc",crmListView.getObject().isPrivacyListView?v+='<li><link-to data-zcqa="privacySorting_desc" lt-prop-route="crm.settings.section.compliance.consent-dashboard.list-view" lt-prop-qp="'+h+'">'+I18n.getMsg("crm.column.sort.desc")+'&nbsp;<span class="svgIcons sort_desc"></span></link-to></li>':v+="<li><link-to  lt-prop-dp='[\""+a+'","'+m+"\"]'  lt-prop-td='"+h+'\'  lt-prop-route="crm.tab.module.custom-view.list" data-zcqa="sort_desc">'+I18n.getMsg("crm.column.sort.desc")+'&nbsp;<span class="svgIconsImg sort_desc"></span></link-to></li>')}else T.sort_order="sort_asc",crmListView.getObject().isPrivacyListView?v+='<li><link-to data-zcqa="privacySorting_asc" lt-prop-route="crm.settings.section.compliance.consent-dashboard.list-view" lt-prop-qp="'+f+'">'+I18n.getMsg("crm.column.sort.asc")+'&nbsp;<span class="svgIcons sort_asc"></span></link-to></li>':v+='<li><link-to data-zcqa="sorting_asc" lt-prop-td=\''+f+'\' lt-prop-route="crm.tab.module.custom-view.list"  lt-prop-dp=\'["'+a+'","'+m+"\"]'>"+I18n.getMsg("crm.column.sort.asc")+'&nbsp;<span class="svgIcons sort_asc"></span></link-to></li>',S.sort_order="sort_desc",crmListView.getObject().isPrivacyListView?v+='<li><center><link-to data-zcqa="privacySorting_desc" lt-prop-route="crm.settings.section.compliance.consent-dashboard.list-view" lt-prop-qp="'+h+'">'+I18n.getMsg("crm.column.sort.desc")+'&nbsp;<span class="svgIcons sort_desc"></span></link-to></li>':v+="<li><link-to lt-prop-td='"+h+"'lt-prop-dp='[\""+a+'","'+m+'"]\' lt-prop-route="crm.tab.module.custom-view.list" data-zcqa="sort_desc">'+I18n.getMsg("crm.column.sort.desc")+'&nbsp;<span class="svgIconsImg sort_desc"></span></link-to></li>';null==e||"MAILINGSTREET"!=e.id&&"BILLINGSTREET"!=e.id&&"LANE"!=e.id||!getObj("nearme")||"yes"!=getObj("nearme").value||((void 0!==customViewObject&&null!=customViewObject.nearmeSortOrder?customViewObject.nearmeSortOrder:"").indexOf("sortby_name")>-1?v+="<li><a data-cid='sortingRecords' data-zcqa='sort_unsort' data-params='"+I+"'>"+I18n.getMsg("View Distance")+"</a></li>":v+="<li><a data-cid='sortingRecords' data-zcqa='sort_unsort' data-params='"+y+"'>"+I18n.getMsg("View Mailing Address")+"</a></li>");v+="</ul></div>",$(d).empty(),d.innerHTML=v;var _=d.queryAll("li");crmListView.getObject().isPrivacyListView||(_[0].children[0].setAttribute("lt-prop-qp",JSON.stringify(T)),_[1].children[0].setAttribute("lt-prop-qp",JSON.stringify(S))),d.style.display="block",i||(i=window.event),i.stopPropagation&&(i.stopPropagation(),i.cancelBubble=!0)}function sortColumns(e,t,a,i,r,l){loadAjaxTab("","lightblue");var n=getObj("sorted_column");if(getObj("sort_div")&&(getObj("sort_div").style.display="none"),null!=n){var s=getObj("sorted_column").title;sortOrderString=getObj("sorted_column").className,null!=(temp=s)&&(temp=convertColumnName(temp,t))}var o=getObj("chk");if(o){var d=o.length;(null==d||d<=1)&&o.parentNode.removeChild(o)}var c=formData2QueryString(document.showcvdetails);document.getElementById("advSearchEnable")&&document.getElementById("advSearchEnable").value,sortOrderString=getObj("sorted_column")?getObj("sorted_column").className:temp==e&&"sort_asc"==sortOrderString?"sort_desc":"sort_asc",getObj("currentOption")&&(document.showcvdetails.rangeValue.value=getObj("currentOption").value);var m=Crm.getCrmBasePath()+"/DeleteFromCV.do";m=m+"?start_index="+r+"&end_index="+l+"&sortColumnString="+encodeURIComponent(e)+"&sortOrderString="+sortOrderString;var u="";null!=c&&(u=c),u=u+"&"+csrfParamName+"="+csrfToken,httphandle.open("POST",m,!0),httphandle.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),httphandle.onreadystatechange=function(){if(4==httphandle.readyState){var e=httphandle.responseText;if(200==httphandle.status)"Leads"==t||"Contacts"==t||"Accounts"==t||"Potentials"==t?changeShowCacheObj(t,e):(divObj=getObj("idForCV"),$(divObj).empty(),divObj.innerHTML=e),JSEvalScript(getObj("idForCV")),document.getElementById("ajax_load_tab").style.display="none",bindEventListView(),hide("zohobusy_loadpage_cv");else if(httphandle.status==crmConstants.errorStatusCode)return void renderingUtils.displayPermissionDenied(httphandle)}},httphandle.send(u),temp=e}function handleCancel(e,t,a,i){$L("#rpBtnResubmit").removeClass("disable");var r=$("#"+t);event&&event.stopPropagation(),r.hide();var l=$("#"+e);l.closest(".tabDiv").removeClass("focusEleField errorFieldP"),l.closest(".tabdiv").removeClass("errorFieldP"),$("#labelTD_"+a).removeClass("newmandatory").find(".infotoolTip").css("visibility","hidden").removeClass("infoTTStay"),document.getElementById("unique").style.display="none",$(".errMsg").hide();var n=$("#mouseArea__"+globalfieldlabel);if("DESCRIPTION"==a&&"Events"==$("#module").val()&&n.removeClass("dB").addClass("dIB"),r.empty(),i){var s=$('<span data-zcqa="selectColorComponent" class="dIB activitesColor" id="selectColorComponent" style="background:'+i+'"></span>'),o=l.find("span");o.length>0?(o.find(".activitesColor_dv").remove(),s.insertBefore(o)):l.append(s)}if(e.indexOf("headervalue_")>-1)show(e,"inline-block");else{l.show(),$("#value_"+a).removeClass("newmandatory");var d=1;n.data("params")&&n.data("params").uitype&&(d=n.data("params").uitype);var c=valueBeforeAjaxEdit;"1"!==d&&"3"!==d&&"110"!==d||(c=revertSplChrs(c)),detailView.replaceDataParams(a,c)}var m=getObj(a),u=document.getElementById("iskanbanview");!m||u&&"true"===u.value||(m.className="label"),hideMenu(),itsonview=!1,$(".imageUploadDetailPage").removeClass("eventNone");var p=$(".detailViewContainer"),g=$(".newBusinessCardView");return p.removeClass("editModeEnable"),g.removeClass("editModeEnable"),g.find(".newDateTimeField").removeClass("newDateTimeField"),g.find(".editLabelBC").removeClass("editLabelBC focusEleField"),g.find(".newBCPhoneViewedit").removeClass("newBCPhoneViewedit"),g.find(".lookupFieldCreate").removeClass("lookupFieldCreate"),r.closest("td").removeClass("selectBoxSelect2"),p.add(g).find(".highlightNewLookupField").removeClass("highlightNewLookupField"),tkveventajax=!1,!1}function patternValidate1(e,t,a,i,r){var l=null;if("EMAIL"==a.toUpperCase()&&(l=validationUtils.emailRegex),"DATE"==a.toUpperCase())switch(Crm.userDetails.DATE_PATTERN.toLowerCase()){case"yyyy/mm/dd":case"yyyy.mm.dd":case"yyyy-mm-dd":l=/^\d{4}(\-|\/|\.)\d{1,2}\1\d{1,2}$/;break;case"mm/dd/yyyy":case"mm.dd.yyyy":case"mm-dd-yyyy":case"dd/mm/yyyy":case"dd.mm.yyyy":case"dd-mm-yyyy":l=/^\d{1,2}(\-|\/|\.)\d{1,2}\1\d{4}$/}if("TIME"==a.toUpperCase())l=/^\d{1,2}(\:\d{1,2})*$/;if(!validationUtils.validatePattern(l,i))return"inline"===r?renderingUtils.displayErrorDiv(e,t,"crm.field.valid.check"):renderingUtils.showCustomAlert(I18n.getValueForFields("crm.field.valid.check",t)),!1}function emailValidate1(e,t,a,i){return 0!=patternValidate1(e,t,"EMAIL",a,i)}function numValidate1(e,t,a,i){var r=i.replace(/^\s+/g,"").replace(/\s+$/g,"");if("any"!=a&&0!=parseInt(a))var l="^-?\\d+((\\d)+)*(\\.\\d{1,"+(a=a.split(","))[0]+"})*$",n=new RegExp(l);else n=/^-?\d+((\d)+)*(\.\d{1,2})*$/;if(n.test(r))return!0;var s=t.replace(/_____/g,")").replace(/____/g,"(").replace(/___/g,".");return $("#module").val()&&(s=$("[name='property("+t+")']").data()?$("[name='property("+t+")']").data().displaylabel:s),renderingUtils.showCustomAlert(I18n.getValueForFields("crm.field.valid.check",s)),getObj("textbox_"+t).setAttribute("autocomplete","off"),getObj("textbox_"+t).focus(),!1}function phoneValidate1(e,t,a){var i=document.getElementById("textbox_"+t),r=$(i),l=a.replace(/^\s+/g,"").replace(/\s+$/g,"");if($("#module").val()&&(t=$("[name='property("+t+")']").data()?$("[name='property("+t+")']").data().displaylabel:n),validationUtils.isValidPhoneNo(r,l))return!0;var n=t.replace(/_____/g,")").replace(/____/g,"(").replace(/___/g,".");return renderingUtils.showCustomAlert(I18n.getValueForFields("crm.field.valid.check",n)),r.attr("autocomplete","off"),r.focus(),!1}function formValidate1(e,t,a){var i=e.replace(/_____/g,")").replace(/____/g,"(").replace(/___/g,".");if((o=singularModule=getObj("singularModule")?getObj("singularModule").value:"")&&"true"===o.value){r=$('[name="fieldname"]').val().split(";"),l=$('[name="fielddatatype"]').val().split(";"),n=$('[name="fieldlabel"]').val().split(";");"STARTDATETIME"!==i&&"ENDDATETIME"!==i&&"LOCATION"!==i||(l="DT~O~istkv~OTH",r=new Array("property("+i+")"),n=i)}else var r=getObj("fieldname").value.split(";"),l=getObj("fielddatatype").value.split(";"),n=getObj("fieldlabel").value.split(";"),s="";for(var o=document.getElementById("iskanbanview"),d=r.length,c=0;c<d;c++){var m="undefined"!=typeof labelToCol?labelToCol[n[c]]:n[c];if(!o||"true"!==o.value||"STARTDATETIME"!==i&&"ENDDATETIME"!==i){var u=l[c].split("~");if(i!=m)continue;var p=$("[name='property("+i+")']");s=p.data()&&p.data().displaylabel?p.data().displaylabel:e}else{u=l.split("~");n[c]=i}if("M"==u[1]&&!emptyCheck1(r[c],e,!1,t,a))return!1;switch(u[0]){case"O":case"V":case"C":break;case"E":if(null!=t&&0!=t.replace(/^\s+/g,"").replace(/\s+$/g,"").length&&!emailValidate1(r[c],s,t))return!1;break;case"DT":if(null!=t&&0!=t.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(void 0===u[3])var g="OTH";else g=u[3];if(!dateTimeValidate(r[c],u[2],e,g))return tkveventajax=!0,!1;if(tkveventajax=!1,u[4]){if(!dateTimeComparison(r[c],u[2],e,u[5],u[6],u[7],u[4]))return tkveventajax=!1,!1;tkveventajax=!1}}break;case"D":if(null!=t&&0!=t.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(g=void 0===u[2]?"OTH":u[2],!dateValidate(r[c],e,g))return!1;if(u[3]&&!dateComparison(r[c],s,u[4],u[5],u[3]))return!1}break;case"T":if(null!=t&&0!=t.replace(/^\s+/g,"").replace(/\s+$/g,"").length){var v="";if(v=void 0===u[2]?"OTH":u[2],!timeValidate(r[c],e,v))return!1;if(u[3]&&!timeComparison(r[c],s,u[4],u[5],u[3]))return!1}break;case"I":case"B":if(null!=t&&0!=t.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(!intValidate1(e,t))return!1;if(u[2]&&!numConstComp(r[c],e,u[2],u[3]))return!1}break;case"DE":if(null!=t&&0!=t.replace(/^\s+/g,"").replace(/\s+$/g,"").length){var f="";if(f=void 0===u[2]?"any":u[2],!decimalValidate(r[c],e,f))return!1;if(u[2]&&!numConstComp(r[c],e,u[2],u[3]))return!1}break;case"N":if(null!=t&&0!=t.replace(/^\s+/g,"").replace(/\s+$/g,"").length){f="";if(f=void 0===u[2]?"any":u[2],!numValidate1(r[c],e,f,t))return!1;if(u[3]&&!numConstComp(r[c],e,u[3],u[4]))return!1}break;case"P":if(null!=t&&0!=t.replace(/^\s+/g,"").replace(/\s+$/g,"").length&&!phoneValidate1(r[c],e,t))return!1;break;case"W":if(null!=t&&0!=t.replace(/^\s+/g,"").replace(/\s+$/g,"").length&&!isValidWebURL(s,t))return!1}}return!0}function intValidate1(e,t){var a=t.replace(/^\s+/g,"").replace(/\s+$/g,""),i=e.replace(/_____/g,")").replace(/____/g,"(").replace(/___/g,".");$("#module").val()&&(i=$("[name='property("+e+")']").data()?$("[name='property("+e+")']").data().displaylabel:i);return!(isNaN(a)||-1!=a.indexOf(".")||!/^\d+(,(\d)+)*$/.test(a))||(renderingUtils.showCustomAlert(I18n.getValueForFields("crm.field.valid.check",i)),getObj("textbox_"+e).setAttribute("autocomplete","off"),getObj("textbox_"+e).focus(),!1)}function emptyCheck1(e,t,a,i,r){var l=t.replace(/\./g,"___").replace(/\(/g,"____").replace(/\)/g,"_____"),n=getObj("textbox_"+l);return 100==r&&(n=getObj("comboValue"+comboCount)),$("#module").val()&&(t=$("[name='property("+t+")']").data()?$("[name='property("+t+")']").data().displaylabel:t),a&&"none"==n.value?(renderingUtils.showCustomAlert(I18n.getValueForFields("crm.field.none.check",t)),!1):0!=n.value.trim().length||(renderingUtils.showCustomAlert(I18n.getValueForFields("crm.field.empty.check",t)),n.setAttribute("autocomplete","off"),!1)}function formDataFormSecurity(){for(var e="",t=getObj("counter").value,a=1;a<=parseInt(t);a++){var i="checkBoxAjax_"+a;1==getObj(i).checked&&(e+=encodeURIComponent(getObj(i).name),""!=getObj(i).value&&(e+="="+encodeURIComponent(getObj(i).value)),e+="&")}return e}function handleEnter(e,t,a,i,r,l,n,s,o,d,c,m){if(13==event.keyCode)return Callonclickofbutton(e,t,a,i,r,l,n,s,o,d,c),hide(m),!1}function addStyle(e,t){if("3"==t||"110"==t)$(e).addClass("tAreaBox");else if(t===CrmField.UITYPES.SERVICE_DURATION.toString())for(var a=$(e).length,i=0;i<a;i++){var r=$(e)[i];"Crm_Services_SERVICEDURATION"===r.id?$(r).attr("style","display:none"):$(r).attr("style","")}else $(e).attr("style","");return e}function getMultiuserLookupValues(e,t,a,i,r){var l={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};clientPortalName&&(l["X-CRMPORTAL"]=window.clientPortalName),(new crmRequestPool).initiate({action:"/crm/v2.1/"+moduleApiMapping[e]+"/"+t+"?fields="+a,type:"GET",headers:l,success:function(t){var l=t.data[0][a];if($("#mouseArea__"+i).data("params").selectedAPIJson=l,r){var n={};n.api_name=temp;for(var s=moduleRecordMapping[e].fields.filterBy(n)[0].multiuserlookup.connectedlookup_apiname,o=l.length,d="",c=0;c<o;c++)d=0==c?l[c][s].name:d+", "+l[c][s].name;$("#value_"+i).text(d)}}})}function ajaxEdit(){var e=[CrmField.UITYPES.LOOK_UP_ENTITY,CrmField.UITYPES.MULTISELECT_LOOK_UP,CrmField.UITYPES.CURRENCY,CrmField.UITYPES.ACCOUNT_NAME_LOOKUP,CrmField.UITYPES.SALESORDER_ID,CrmField.UITYPES.CONTACT_ID,CrmField.UITYPES.VENDOR_NAME_LOOKUP,CrmField.UITYPES.CONTACT_LOOKUP,CrmField.UITYPES.POTENTIAL_ID,CrmField.UITYPES.PRODUCT_NAME_LOOKUP,CrmField.UITYPES.CAMPAIGN_NAME_LOOKUP,CrmField.UITYPES.QUOTE_ID,CrmField.UITYPES.CURRENCY_ROUND_OFF,CrmField.UITYPES.CURRENCY_ROUND_DOWN,CrmField.UITYPES.CURRENCY_ROUND_UP,CrmField.UITYPES.LAYOUT_LOOKUP],t=$(".detailViewContainer"),a=$(".newBusinessCardView"),i=$("#headervalue_"+globalfieldlabel).parent("td.labelVal").outerWidth();if(itsonview){var r=detailView.currentModule;$("#Crm_"+r+"_"+globalfieldlabel).focus()}if(!itsonview&&!detailView.readOnlyField){var l=$("#mouseArea__"+globalfieldlabel).data("params");if(detailView.oldfieldUpdateJson&&detailView.oldfieldUpdateJson.length>0)detailView.currency&&(s=detailView.currency[globalfieldlabel]+""),"undefined"!==s&&(s=detailView.cloneupdateMap[globalfieldlabel]+""),"undefined"!==s&&(l.defaultvalue=s);"32"!==l.uitype&&"38"!==l.uitype&&"52"!==l.uitype||(l.formattedValue?l.defaultvalue=Search.reverseFormatNumber(l.formattedValue):l.defaultvalue=Search.reverseFormatNumber(l.defaultvalue)),"true"==l.mandate&&($("#labelTD_"+globalfieldlabel).addClass("newmandatory"),$("#value_"+globalfieldlabel).addClass("newmandatory")),$("#labelTD_"+globalfieldlabel).find(".infotoolTip").css("visibility","visible").addClass("infoTTStay");r=detailView.currentModule;var n=returnJson;n.currentField=l,n.module=r,n.currentStatus="ajaxEdit",n.isClientAccount=Crm.userDetails.CLIENT_ACCOUNT;var s,o=n[r].entityid;if(valueBeforeAjaxEdit=l.defaultvalue,/\b(5|4|6|7|9|10|12|13|15|133|136|221)\b/.test(l.uitype)&&(idBeforeAjaxEdit="null"===l.defaultid?"":l.defaultid),l.uitype+""=="445"&&getMultiuserLookupValues(r,o,l.sysRefName,l.colname),n[r].fieldDependency&&(Crm.fieldDependency[r]=JSON.parse(n[r].fieldDependency)),"36"==l.uitype||"144"==l.uitype||"143"==l.uitype||"145"==l.uitype)"null"===(s=l.plainValue?l.plainValue:valueBeforeAjaxEdit)&&(s=""),valueBeforeAjaxEdit=s;if("35"!=l.uitype&&"33"!=l.uitype||(valueBeforeAjaxEdit=l.dbPhoneValue?l.dbPhoneValue:commonUtils.getPlainPhoneNo(valueBeforeAjaxEdit)),l.defaultvalue=valueBeforeAjaxEdit,"26"==l.uitype){var d=$("#value_PROBABILITY"),c="";d.length>0?(c=""==(c=d.text().trim())?"0":c,l.defaultvalue=c+":"+l.plainValue):l.defaultvalue=l.plainValue}l.defaultvalue&&l.default&&l.default[0]&&(l.default[0].value=l.defaultvalue),l.isDetailView=!0;var m=crmTemplate.createFieldContent(n),u=document.createDocumentFragment(),p=addStyle(m.children,l.uitype);"3"!==l.uitype&&"110"!==l.uitype?$(p).keydown((function(e){handleButton("button__"+escapeSingleQuote(globalfieldlabel),e)})):"3"==l.uitype&&"Events"==r&&$("#mouseArea__"+globalfieldlabel).removeClass("dIB").addClass("dB");var g=!1,v=!1;l.iscallallowed&&(v=!0),"33"==l.uitype&&1==l.outbound&&(g="true",recordid1=$("#id").val()),u=$(u).append(p);var f=l.fieldid,h=l.colname,b="",C="",y="",I="",w=document.getElementById("iskanbanview"),A="Callonclickofbutton('/crm/v2/','"+escapeSingleQuote(globaltextboxpanid)+"','"+escapeSingleQuote(globalvaluespanid)+"','"+escapeSingleQuote(globaltextareapanid)+"','"+escapeSingleQuote(globalfieldlabel)+"','"+r+"','"+escapeSingleQuote(globalsubvaluespanid)+"','"+l.uitype+"',undefined,'"+h+"','"+o+"','"+g+"',undefined,'"+f+"','"+v+"')";if(w&&"true"===w.value)b=renderingUtils.createHTML({name:"span",attr:{value:"",class:"saveAct svgIcons saveLink f13 vam kanbanviewImages tkvsaveLink",name:"button__"+globalfieldlabel,onclick:A}});else{var E=I18n.getMsg("Save")+" ",T=I18n.getMsg("Cancel"),S=I18n.getMsg("or")+" ";b=renderingUtils.createHTML({name:"span",attr:{value:E,class:"saveAct svgIcons saveLink f13 vam",name:"button__"+globalfieldlabel,onclick:A}})}if(26==globaluitype){var L=$("#value_PROBABILITY").text().trim();L=L+":"+$("#value_STAGE").text().trim();var _="handleCancel('"+escapeSingleQuote(globalvaluespanid)+"','"+escapeSingleQuote(globaltextareapanid)+"','"+escapeSingleQuote(globalfieldlabel)+"'),setProbabilityInAjaxEdit('"+$ESAPI.encoder().encodeForJavaScript(L)+"');Crm.calculateExpectedRevenue();"}else if(2==globaluitype&&l.dataObj["data-picklist-color"]){var O=$(".activitesColor_dv");if(0==O.length&&(O=$("#selectColorComponent")),O.length>0){var M=Events.rgbtohex(O.css("background-color"));_="handleCancel('"+escapeSingleQuote(globalvaluespanid)+"','"+escapeSingleQuote(globaltextareapanid)+"','"+escapeSingleQuote(globalfieldlabel)+"', '"+M+"')"}else _="handleCancel('"+escapeSingleQuote(globalvaluespanid)+"','"+escapeSingleQuote(globaltextareapanid)+"','"+escapeSingleQuote(globalfieldlabel)+"')"}else _="handleCancel('"+escapeSingleQuote(globalvaluespanid)+"','"+escapeSingleQuote(globaltextareapanid)+"','"+escapeSingleQuote(globalfieldlabel)+"')";w&&"true"===w.value?(y=renderingUtils.createHTML({name:"a",attr:{id:revertSplChrs(escapeSingleQuote(globaltextareapanid))+"_cancel",value:"",href:"javascript:;",class:"cancelAct smalledit dIB kanbanviewImages tkvcancelLink vam",name:"button__"+globalfieldlabel,onclick:_}}),I=renderingUtils.createHTML({name:"span",attr:{class:"svgIcons"}}),$(y).append(I)):(C=renderingUtils.createHTML({name:"b",attr:{value:S,class:"dim"}}),y=renderingUtils.createHTML({name:"a",attr:{id:revertSplChrs(escapeSingleQuote(globaltextareapanid))+"_cancel",value:T,href:"javascript:;",class:"cancelAct smalledit mL10 lightgreyText vam",name:"button__"+globalfieldlabel,onclick:_}}),I=renderingUtils.createHTML({name:"span",attr:{class:"svgIcons"}}),$(y).append(I),$(C).text(""+S));var P=renderingUtils.createHTML({name:"span",attr:{id:"saveCancelSpan",class:"fR"}}),k=$(P);k.append(b),k.append(y),$(u).append(P);var R,D=getObj(globaltextareapanid),U=$(D);if(D){$('[id="'+globaltextareapanid+'"]').show();var F=$("#"+globaltextareapanid);F.addClass("labelValTwo"),221==globaluitype&&F.addClass("userLookupDetailView userLookupNewUI"),U.html(u),U.find(".lookup_hIconO").first().addClass("lookupIconChange"),"786"!=l.uitype&&"202"!=l.uitype&&"24"!=l.uitype&&"333"!=l.uitype||U.closest(".tabdiv").addClass("newDateTimeField"),R=U}else{var x=document.createElement("SPAN"),N=$(x);x.setAttribute("class","labelValTwo"),221==globaluitype&&x.setAttribute("class","labelValTwo userLookupDetailView"),x.setAttribute("id","textarea_"+globalfieldlabel),$("#value_"+globalfieldlabel).after(N.append(u)),N.find(".lookup_hIconO").first().addClass("lookupIconChange"),"786"!=l.uitype&&"202"!=l.uitype&&"24"!=l.uitype&&"333"!=l.uitype||N.closest(".tabdiv").addClass("newDateTimeField"),R=N}if(t.find("select").closest(".labelValTwo").addClass("selectBoxSelect2"),a.find("select").closest("td").addClass("selectBoxSelect2"),"33"==l.uitype&&Crm.userDetails.isPhoneNoNewView?U.closest("td").addClass("editLabelBC focusEleField newBCPhoneViewedit"):U.closest("td").addClass("editLabelBC focusEleField"),hide(globalvaluespanid),-1!==e.indexOf(parseInt(l.uitype))&&R.parent().addClass("lookupFieldCreate"),"100"!==l.uitype&&"96"!==l.uitype||R.find("select").attr("onchange","focusEnableFuncDetailpage(this)"),"3"==l.uitype&&R.find("textarea").css("height","18px").on("blur",(function(e){removeFocusClass(e)})),"2"===l.uitype&&l.colorcode_enabled){var B=$(".activitesColor_dv");if(B.length>0){var j=B.clone();R.find(".createSelect").find("div").append(j)}else{var V=$("#"+globalvaluespanid).find(".activitesColor");V.length>0&&R.find(".createSelect").find("div").append(V)}}if("555"==l.uitype){f=l.fieldid;if(""!=l.defaultvalue&&0!=l.defaultvalue.length){for(var H=0,z=0,G=0;G<l.defaultvalue.length;G++){var q=0,J=l.defaultvalue[G].file_Size.split(" ");"KB"==J[1]?q=1024*J[0]:"MB"==J[1]&&(q=1024*J[0]*1024),z+=parseInt(q),H++}$("#attachCount_"+f).val(H),$("#attachSize_"+f).val(z)}fileupload.removedAttachmentIds.length=0,fileupload.uploadedFileObject.length=0}"Events"==r&&3==globaluitype&&"DESCRIPTION"==globalfieldlabel&&$("#value_DESCRIPTION").hide(),786!==globaluitype&&14!==globaluitype||populateTimeVal(),hide("crmspanid"),itsonview=!0,t.addClass("editModeEnable"),a.addClass("editModeEnable");var W=U.length?U:$(x),Y=W.find(".newChosenSel select,.mlSelect select");-1!=W.attr("id").indexOf("header")&&W.addClass("oI"),Y.length&&(2!==globaluitype&&26!==globaluitype||!l.colorcode_enabled||(Y.data("colorcode",l.color_code),W.addClass("colorEnabledPicklist"),"-None-"===Y.val()||""===Y.val()?W.addClass("colorEnabledPKNone"):W.removeClass("colorEnabledPKNone")),thirdPartyUtils.bindSelect2(Y),"33"!=l.uitype&&setTimeout((function(){Y.select2("open"),Y.next(".select2").find(".select2-search__field").length?Y.next(".select2").find(".select2-search__field").focus():Y.next(".select2").find(".select2-selection").focus()}),30),sE());var Z=$("#"+globaltextboxpanid);return Z.length>0&&(555!==globaluitype&&221!==globaluitype&&2!==globaluitype&&100!==globaluitype&&26!==globaluitype&&301!==globaluitype&&300!==globaluitype&&96!==globaluitype&&setCaretPosition("Crm_"+r+"_"+globalfieldlabel,l.defaultvalue?l.defaultvalue.length:0),$("#Crm_"+r+"_"+globalfieldlabel).focus(),Z.closest(".tabDiv").addClass("focusEleField"),24!=globaluitype&&202!=globaluitype&&786!=globaluitype&&14!=globaluitype&&333!=globaluitype&&4!=globaluitype&&6!=globaluitype&&7!=globaluitype&&9!=globaluitype&&10!=globaluitype&&12!=globaluitype&&13!=globaluitype&&15!=globaluitype&&5!=globaluitype&&133!=globaluitype&&globaluitype!=CrmField.UITYPES.LAYOUT_LOOKUP||renderingUtils.triggerEvent("click",$("#"+globaltextboxpanid))),globaluitype==CrmField.UITYPES.SERVICE_DURATION&&$("#serviceDurationDiv").click(),/(2|100|96)/.test(l.uitype)&&crmTemplate.setDependentFields(r,"view"),1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&(hide("summaryfield",!0),$("#headertextarea_"+globalfieldlabel).parent("td.labelVal").css("width",i)),!1}}function listMUFields(e,t,a,i,r,l,n,s,o,d,c,m){var u=$("#bulkUpdateFldsListForScheduler");c||(c=Crm.userDetails.USER_ID),store.unloadAll("pipeline"),"undefined"==m&&hide("bulkUpdate_display");var p=!0;if("true"!=m&&1!=m||(p=!1),p){if(!$(".customCheckBoxChecked[data-cid=selectEntity]"))return;var g=customViewObject.selectedIds.length;1==customViewObject.isStageView?(count=0,Object.keys(crmTab.getFromCache(e).stageBoardDetails).forEach((function(t){count+=crmTab.getFromCache(e).stageBoardDetails[t].body.length})),h=count):1==customViewObject.isPredictView?(count=0,Object.keys(crmTab.getFromCache(e).predictData).forEach((function(t){count+=crmTab.getFromCache(e).predictData[t].body.length})),h=count):h=customViewObject.body.length;var v=crmTab.getFromCache(e).doMassActioninScheduler;if(0==h)return}else{if(!$("[name=chk]"))return;var f=$("[name=chk]"),h=f.length}var b="";if(0!=h){if(p){if(0==g)return renderingUtils.showCustomAlert(I18n.getMsg("crm.alert.select.one")),!1}else if(!f.is(":checked"))return renderingUtils.showCustomAlert(I18n.getMsg("crm.alert.select.one")),!1;if(m&&"undefined"!=m&&$("#FreezeLayer").css("z-index",30),p)b=customViewObject.selectedIds.join(";");else for(var C=0;C<h;C++)if(f[C].checked){var y=f[C].value.split("&&||")[0];b=y+";"+b}}selectfieldtoupdate||(selectfieldtoupdate=I18n.getMsg("crm.module.mass.update")),v&&Crm.trackSpotLightAction("Mass Scheduler - Mass Update Clicked",{Module:e});var I={};I.module=e,jQuery.ajax({type:"GET",url:Crm.getCrmBasePath()+"/Security.do?actionName=getMassUpdateParameters",data:I,success:function(c){if(void 0!==c&&c[0]){c[0]=c[0].replace(/'/g,""),c[2]=c[2].replace(/'/g,""),c[3]=c[3].replace(/'/g,""),c[4]=c[4].replace(/'/g,""),c[5]=c[5].replace(/'/g,""),c[6]=c[6].replace(/'/g,"");var p=c[3].split(","),g=c[4].split(","),f=c[1].split("~~"),h=c[6].split(","),C=c[0].split(","),y=c[5].split(","),I=c[2].split("~~"),w=C.length,A="<input type='button' value='"+I18n.getMsg("crm.button.cancel")+"' class='newgraybtn' data-zcqa='link_WfDelete_Cancel' href='javascript:;' onclick=\"handleCancelMUNew('"+e+"')\">",E='<h2 class="mB0 pp-header">'+selectfieldtoupdate+"</h2>";E+='<div class="pp-content pB12Imp" style="max-height: 322px;">';var T=(E+='<div class="fieldSelectionWrapper pB7 nuEnhancFocusBox"><table class="w100per"><tbody><tr>')+"<td class='selectCntn'><div class='newSelect'><select id='muFlds' name='muFlds' onChange='setMUFld(this.value, \""+b+'", "'+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(t))+'", "'+a+'","'+i+'","'+r+'","'+l+'", "'+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(n))+'","'+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(s))+'", "'+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(o))+'","'+d+'","'+e+'","'+m+"\",true,false)'class='fetchLayouts'>";T=T+"<option value='None' style='font-weight:bold'>"+I18n.getMsg("crm.multiselect.massupdate.select")+"</option>";for(var S=0;S<w;S++)(p[S]==CrmField.UITYPES.LAYOUT||"CrmPotential"===y[S]&&"PIPELINE"===C[S])&&v||("CrmPotential"===y[S]&&"PIPELINE"===C[S]&&(I[S]=I[S].replace("O","M")),"ISCALLBILLABLE"!==C[S]&&(T=T+"<option id='"+y[S]+"_"+C[S]+"' style='color:black;font-weight:normal' value="+p[S]+"||||"+g[S]+"||||"+encodeURIComponent(f[S])+"||||"+h[S]+"||||"+C[S]+"||||"+y[S]+"||||"+I[S]+"> "+revertSplChrs(f[S])+"</option>"));T+="</select></div></td>",T+="<td><div id='dynCont' class='dIB w100per pR'><div class='inputWrapper pL5 pR noFeildSel' id='dummyMassUpdTextFld' name='dummyMassUpdTextFld'><input class='IPArea w100per noborder txtField noBg newuiTextField eventNone' data-zcqa='txt_MassUpdate_Value' disabled='disabled' maxlength='16'></div></div></td></tr></tbody></table></div>",T+=" </tr></tbody></table>",T=(T=(T+="<div id='multiselectoptionChk' class='actionDecision mT10 dN'>")+"<label class='cP'><input class='rbRealHtml hide' name='multiselect_option' id='multiselect_overwrite' value='multiselect_overwrite' type='radio' data-zcqa='multiselect-overwrite' checked='checked'><span class='rbHtml dIB pR'><span class='rbTickHtml pA'></span></span><span class='rbHtmlLb mL5'>"+I18n.getMsg("crn.social.overrite")+"</span></label>")+"<label class='cP mL20'><input class='rbRealHtml hide' name='multiselect_option' id='multiselect_add' value='multiselect_add' data-zcqa='multiselect-add' onclick='multiselectOptionSelect(true );' type='radio'><span class='rbHtml dIB pR'><span class='rbTickHtml pA'></span></span><span class='rbHtmlLb mL5'>"+I18n.getMsg("crm.import.duplicates.append")+"</span></label>",T=(T+='</div><div id="layoutInfo" class="dN"><p class="pipelineStageInfo pR pL20"><span class="f13"></span></p></div></div>')+'<div class="pp-footer"><div id="cancelButtonDiv" class="dIB">'+A+'</div><div id="saveButtonDiv" class="dIB"><input type="button" value='+I18n.getMsg("crm.button.update")+' disabled="disabled" class="primarybtn"></div></div></div>',u.html(T),showAnimatePopup("bulkUpdateFldsListForScheduler"),freezeBackground(),thirdPartyUtils.bindSelect2("#muFlds");var L=I18n.getMultipleMsg([{key:"crm.massupdate.updatedsuccesfully",params:"' + module + '"},{key:"crm.button.update",params:"' + module + '"},{key:"crm.button.cancel",params:"' + module + '"},{key:"crm.label.lowercase.or",params:"' + module + '"}]);updatedsuccesfully=L["crm.massupdate.updatedsuccesfully"],saveButton=L["crm.button.update"],cancelButton=L["crm.button.cancel"],OR=L["crm.label.lowercase.or"]}else renderingUtils.showCustomAlert(I18n.getMsg("crm.nomassupdatefield1"),"",!1)}})}function getPipelineOptionsForLayout(e){var t=$("#txt_"+CrmField.UITYPES.PICK_LIST),a=$(".forStageSelection"),i=$(".forpipeline");i.removeClass("eventNone op5");var r=store.peekAll("pipeline").filterBy({layout_id:e});if(r&&r.length)t.html(crmListView.MUPipelineOptionsTemplate(r[0])),t.val("-None-").trigger("change"),$("#txt_"+CrmField.UITYPES.STAGE).val("-None-").trigger("change"),a.addClass("eventNone op5"),a.show(),i.show();else{commonUtils.showHideLoadingDiv(!0),store.findAll("pipeline",{layout_id:e}).then((function(e){e&&e.length?(t.html(crmListView.MUPipelineOptionsTemplate(e[0])),t.val("-None-").trigger("change"),$("#txt_"+CrmField.UITYPES.STAGE).val("-None-").trigger("change"),a.addClass("eventNone op5"),a.show(),i.show()):(a.hide(),i.hide()),commonUtils.showHideLoadingDiv()}))}}function getStageOptionsForLayout(e,t){var a="",i=store.peekAll("pipeline").filterBy({layout_id:e});return i&&i.length&&i[0].pick_list_values.every((function(e){return e.id!=t||(a+=crmListView.MUStageOptionsTemplate({stages:e.maps}),!1)})),a}function getStageOptionsForPipeline(e){var t="",a=e.split("||");return store.peekAll("layout").filterBy({id:a[0]})[0].sections.every((function(e){var i=e.fields.filterBy({column_name:"PIPELINE"});return 0==i.length||(i[0][a[0]].pick_list_values.every((function(e){if(e.display_value===a[1]){for(var i=e.maps,r=i.length,l={},n=store.peekAll("field").filterBy({column_name:"STAGE"})[0],s=n.api_name,o=0;o<r;o++)if(i[o].api_name===s){l=i[o];break}if(t+=crmListView.MUStageOptionsTemplate({stages:l.pick_list_values}),!0===n.enable_colour_code){var d=$("#txt_"+CrmField.UITYPES.STAGE);d.parent().parent().addClass("colorEnabledPicklist colorEnabledPKNone"),d.data("colorcode_enabled",!0),d.data("fieldid",n.id),d.attr("data-picklistmap",JSON.stringify(l.pick_list_values))}return!1}return!0})),!1)})),t}function handlePipelineSelection(){var e=$("#txt_"+CrmField.UITYPES.PICK_LIST).find("option:selected").val(),t=$("#txt_"+CrmField.UITYPES.STAGE);if("-None-"===e)return t.val("-None-").trigger("change"),void $(".forStageSelection").addClass("eventNone op5");"PIPELINE"==$("#muFlds").val().split("||||")[4]?t.html(getStageOptionsForPipeline(e)):t.html(getStageOptionsForLayout($("#txt_"+CrmField.UITYPES.LAYOUT).val(),e)),$(".forStageSelection").removeClass("eventNone op5"),t.val("-None-").trigger("change")}function handleStageSelection(e){var t=$("#layoutInfo"),a=$("#txt_"+CrmField.UITYPES.STAGE),i=a.val();"-None-"==i?t.addClass("dN"):"mPStage"===e?(t.removeClass("dN"),t.find("span").html(I18n.getMsg("crm.massupdate.stage.info",$ESAPI.encoder().encodeForHTML(i)))):"mPPipe"===e&&(t.removeClass("dN"),t.find("span").html(I18n.getMsg("crm.massupdate.pipeline.info",$ESAPI.encoder().encodeForHTML($("#txt_"+CrmField.UITYPES.PICK_LIST).find("option:selected").closest("optgroup").attr("label"))))),a.data("colorcode_enabled")&&updateColorCodeForSelObj(a)}function updateContent(e,t){var a=$("#bulkUpdateFldsListForScheduler"),i=a.find("#txt_"+e).find("option:selected").text(),r="<span class='crm-font-bold'>'"+$ESAPI.encoder().encodeForHTML(i)+"'</span>";a.find("#dynamicNote").html(I18n.getMsg("crm.mass.update.mpl.note",r)),"Potentials"===t&&getPipelineOptionsForLayout($("#txt_"+e).val())}function setMUFld(e,t,a,i,r,l,n,s,o,d,c,m,u,p,g){var v=$("#bulkUpdateFldsListForScheduler"),f=$("#dynCont");$("#layoutInfo").addClass("dN"),f.html(""),f.removeClass("plMSUpdate");var h=e.split("||||"),b=parseInt(h[0]),C=h[1],y=h[2],I=decodeURIComponent(y),w=h[3],A=h[4],E=h[5],T=h[6],S=void 0,L=!1,_=0,O=!1;void 0!==y&&hide("dummyMassUpdTextFld"),crmTab.getFromCache(m)&&(L=crmTab.getFromCache(m).doMassActioninScheduler),L&&(_=crmListView.getObject().totalCount)>Crm.massOperationWorkflowLimit&&(O=!0),S=getObj("module").value,crmListView.getObject()&&crmListView.getObject().length>0&&(S=crmListView.getObject().module);var M="",P=I18n.getMsg("crm.module.mass.update"),k="";void 0!==y&&(k=y.replace(/'/g,"\\'")),void 0===y&&f.show();var R="";if(L&&_>Crm.massOperationWorkflowLimit&&(R=R+"massActionWorkflowPopUp('false','"+A+"','"+saveButton+"','"+b+"','"+m+"','"+E+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(k))+"','"+T+"','"+t+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(a))+"','"+i+"','"+r+"','"+l+"','"+n+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(s))+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(o))+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(d))+"','"+c+"','"+u+"')",R+=";"),g?(void 0!==y&&(y=y.replace(/'/g,"\\'")),R=R+"CallonBulkUpdate('"+Crm.getCrmBasePath()+"/BulkUpdateField.do','"+S+"','"+E+"','"+A+"', '"+b+"','"+y+"','"+T+"','"+t+"','"+r+"','"+l+"','"+n+"')"):R=R+"CallonMassUpdate('"+Crm.getCrmBasePath()+"/MassUpdateField.do','"+m+"','"+E+"','"+A+"', '"+b+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(k))+"','"+T+"','"+t+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(a))+"','"+i+"','"+r+"','"+l+"','"+n+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(s))+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(o))+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(d))+"','"+c+"','"+u+"','"+O+"')","LAYOUTID"!==A&&v.find("#dynamicNote").length>0&&v.find("#dynamicNote").remove(),100==b||96==b?(v.find(".popup-model-content").addClass("muwrapper"),$("#multiselect_overwrite").trigger("click"),$("#multiselectoptionChk").addClass("dN")):(v.find(".popup-model-content").removeClass("muwrapper"),v.removeClass("w500"),$("#multiselectoptionChk").addClass("dN")),1===b||11===b||21===b||33===b||33===b||35===b||37===b)M=M+"<input type='text' data-zcqa='txt_MassUpdate_Value' id='txt_"+b+"' name='txt_"+b+"' class='newuiTextField'  maxlength='"+w+"' onkeydown=\"handleButton('button__"+b+"',event)\" onchange=\"Crm.enableMassUpdateSaveBtn('button__"+b+"',event)\"></td></tr>"+"<tr><td colspan='2' class='p15'>";else if(5==b||"CAMPAIGNID"===A&&"CrmPotential"===E){M=(M=(M=M+"<input type='text' readonly='true' maxlength='50' width='10%' class='newuiTextField fL' id='"+$ESAPI.encoder().encodeForHTMLAttribute(I)+"' name='property("+$ESAPI.encoder().encodeForHTMLAttribute(I)+")'/>")+"<input id='property(campName:"+$ESAPI.encoder().encodeForHTMLAttribute(I)+")' type='hidden' name='property(campName:"+$ESAPI.encoder().encodeForHTMLAttribute(I)+")'/>")+"<img border='0' align='absmiddle' data-zcqa='img_MassUpdate_CampaignLkp' onclick=\"showLookUp('"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(I))+"','property(campName:"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(I))+")','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(I))+"','"+"Campaigns')\" class='"+"Campaigns-small fL mL5 mT7 w20' src='"+networkUtils.getImageUrl("spacer_e17b417_.gif",ResourceConstants.CRM)+"'/></td></tr>"+"<tr><td colspan='2' class='p15'>"}else if(34==b)M=M+"<input type='text' data-zcqa='txt_MassUpdate_Value' maxlength=5 id='txt_"+b+"' name='txt_"+b+"' class='newuiTextField'  maxlength='"+w+"' onkeydown=\"handleButton('button__"+b+"',event)\" onchange=\"Crm.enableMassUpdateSaveBtn('button__"+b+"',event)\"></td></tr>"+"<tr><td colspan='2' class='p15'>";else if(208==b){var D=Crm.getCrmBasePath()+"/GetComboValues.do",U="fieldId="+C+"&isMassUpdate=true&module="+m+"&uiType="+b+"&isProfileBasedLayouts="+!0;http&&(http.open("POST",D,!0),http.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),http.onreadystatechange=function(){if(4==http.readyState){var e=http.responseText.trim().split("~~"),t=e.length;M+="<div class='newSelect forLayout mB15'><select data-zcqa='select_MassUpdate_Value' id='txt_"+b+"' onChange='updateContent("+b+',"'+m+"\")' name='txt_"+b+"'>";for(var a=0;a<t;a++){var i=e[a].split("|");M+="<option value='"+$ESAPI.encoder().encodeForHTMLAttribute(i[0])+"'>"+$ESAPI.encoder().encodeForHTML(i[1])}if(M+="</select></div>","Potentials"===m&&(M+=crmListView.MUPipelineStageTemplate({picklist_uitype:CrmField.UITYPES.PICK_LIST,stage_uitype:CrmField.UITYPES.STAGE,pipelineFieldInfo:$("#CrmPotential_PIPELINE").attr("value"),stageFieldInfo:$("#CrmPotential_STAGE").attr("value")}),f.addClass("plMSUpdate")),M+="</div><p></p></td></tr><tr><td colspan='2' class='p15'>",f.html(M),$(".forpipeline").hide(),$(".forStageSelection").hide(),"LAYOUTID"===A){v.find(".popup-model-content").append("<div></div><br><div id='dynamicNote' class='mB25 noteCont f12 color_5 crm-font-regular' style='margin-top:-10px'></div>")}var r=v.find("#txt_"+b).find("option:selected").text(),l="<span class='crm-font-bold'>'"+$ESAPI.encoder().encodeForHTML(r)+"'</span>";v.find("#dynamicNote").html(I18n.getMsg("crm.mass.update.mpl.note",l)),thirdPartyUtils.bindSelect2("#bulkUpdateFldsListForScheduler select"),$("#txt_"+b).trigger("change"),$("#txt_"+b+"_chosen").addClass("fL").prevAll("span").css({float:"left",margin:"6px 10px 0 0"})}},http.send(U))}else if(2==b||26==b)if("CrmPotential"===E&&"PIPELINE"===A){commonUtils.showHideLoadingDiv(!0),f.addClass("plMSUpdate");var F=$("#muFlds"),x=store.peekAll("layout");if(!F.hasClass("fetchLayouts")&&x.length)M+=crmListView.MUPipelineStageTemplate({picklist_uitype:CrmField.UITYPES.PICK_LIST,stage_uitype:CrmField.UITYPES.STAGE,layouts:x,stageFieldInfo:$("#CrmPotential_STAGE").attr("value")}),f.html(M),$(".forStageSelection").addClass("eventNone op5"),thirdPartyUtils.bindSelect2("#bulkUpdateFldsListForScheduler select"),commonUtils.showHideLoadingDiv();else{var N={};N.module=Crm.moduleInfo.Potentials.apiname,store.findAll("layout",N,!1,!0,{apiVersion:"2.2"}).then((function(e){M+=crmListView.MUPipelineStageTemplate({picklist_uitype:CrmField.UITYPES.PICK_LIST,stage_uitype:CrmField.UITYPES.STAGE,layouts:e,stageFieldInfo:$("#CrmPotential_STAGE").attr("value")}),f.html(M),$(".forStageSelection").addClass("eventNone op5"),F.removeClass("fetchLayouts"),thirdPartyUtils.bindSelect2("#bulkUpdateFldsListForScheduler select"),commonUtils.showHideLoadingDiv()}),(function(){crmui.showMsgBand("error",I18n.getMsg("crm.schedules.error.occured"),2e3)}))}}else{D=Crm.getCrmBasePath()+"/GetComboValues.do",U="fieldId="+C+"&module="+m;"STATUS"==A&&"Tasks"==m||"Case"==m||"Solution"==m||"Sales Order"==m||"Purchase Order"==m||"PRIORITY"==A&&"Task"==m||"USAGE_UNIT"==A||"GLACCOUNT"==A||"CARRIER"==A||"QUOTESTAGE"==A||(U+="&allowEmpty=true"),http&&(http.open("POST",D,!0),http.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),http.onreadystatechange=function(){var e,t={};if("Events"!==m)if(p)e=!!(t=!0===p?store.peekRecord("field",C):null).enable_colour_code;else if(g){var a=$("#colorEnabledfieldIdVsProp").val();void 0!==(a=void 0!==a?JSON.parse(a):{})[C]&&(t.id=C,t.pick_list_values=a[C],e=!0)}if(4==http.readyState){var i,r=http.responseText.trim().split("~~"),l=r.length,n="",s=[];e&&(s=(g&&t.pick_list_values,t.pick_list_values),n="colorEnabledPicklist colorEnabledPKNone",i="data-fieldid='"+t.id+"' data-uitype="+b+" data-colorcode_enabled=true data-picklistmap='"+JSON.stringify(s)+"'"),M+="<div class='"+n+"'><div class='newSelect'><select "+i+" data-zcqa='select_MassUpdate_Value' id='txt_"+b+"' name='txt_"+b+"'",b==CrmField.UITYPES.STAGE&&Crm.userDetails.isMultiPipelineActivated&&(M+=' onchange=handleStageSelection("mPStage")'),M+=">";for(var o=0;o<l;o++){var d=r[o],c=null;e&&(c=getPickListColorCode(d,s)),M+="<option data-colorcode="+c+" value='"+$ESAPI.encoder().encodeForHTMLAttribute(d)+"'>"+$ESAPI.encoder().encodeForHTML(d)+"</option>"}M+="</select></div></div><p></p></td></tr><tr><td colspan='2' class='p15'>",b==CrmField.UITYPES.STAGE&&(M+="<div id='error_status_alert' class='alignleft pT5 dN f12 redText pA left0'></div>"),f.html(M);var u=$("#txt_"+b);e&&"-None-"!==u.val()&&updateColorCodeForSelObj(u),thirdPartyUtils.bindSelect2("#bulkUpdateFldsListForScheduler select"),$("#txt_"+b+"_chosen").addClass("fL").prevAll("span").css({float:"left",margin:"6px 10px 0 0"}),b==CrmField.UITYPES.STAGE&&$("#txt_"+b).trigger("change"),e&&$("#txt_"+b).on("change",(function(){updateColorCodeForSelObj($(this))}))}},http.send(U))}else if(100==b||96==b){D=Crm.getCrmBasePath()+"/GetComboValues.do",U="fieldId="+C+"&module="+m;http&&(http.open("POST",D,!0),http.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),http.onreadystatechange=function(){if(4==http.readyState){var e=http.responseText.trim().split("~~"),t=e.length;M+="<div class='cchosen dIB massUpd' onchange='checkanddisplayoptions(this)'><select data-zcqa='select_MassUpdate_Value' multiple size=4 id='txt_"+b+"' name='txt_"+b+"'>";for(var a=0;a<t;a++){var i=e[a];M+="<option value='"+$ESAPI.encoder().encodeForHTMLAttribute(i)+"'>"+$ESAPI.encoder().encodeForHTML(i)}M+="</select></div><p></p></td></tr><tr><td colspan='2' class='p15'>",M+="<div id='error_status_alert' class='alignleft pT5 dN f12 redText pA left0'></div>",f.html(M),thirdPartyUtils.bindSelect2($("#txt_"+b))}},http.send(U))}else if(24==b||202==b||786==b||14==b||333==b)if(M+="<div style='display:inline-block;' class='inputWrapper nobdr'>",M+="<input type='text' data-zcqa='txt_MassUpdate_Value' data-label='"+$ESAPI.encoder().encodeForHTMLAttribute(I)+"'id='txt_"+b+"' placeholder='"+$ESAPI.encoder().encodeForHTMLAttribute(Crm.userDetails.DATE_PATTERN)+"' name='txt_"+b+"' class='textField mT_1' width='10%' onClick=\"crmCalendar.showCalendar(event)\" onFocus=\"crmCalendar.showCalendar(event)\" maxlength='"+w+"' onkeydown=\"handleButton('button__"+b+"',event)\" onchange=\"Crm.enableMassUpdateSaveBtn('button__"+b+"',event)\">",786==b||14==b||333==b){var B="newtimefrmt h12";"HH:mm"==Crm.userDetails.TIME_FORMAT&&(B="newtimefrmt h24"),M+="<input type='hidden' id='txt_"+b+"minute' value='00' name='txt_"+b+"minute'>",M+="<input type='hidden' id='txt_"+b+"hour' value='01' name='txt_"+b+"hour'>",M+="<span class='"+B+" mL10 fR mT_1 focusEleFielEnable'>",M+="<input type='text' fldlabel='txt_"+b+"@{pattern}' value='01:00' id='txt_"+b+"dateTime' maxlength='5' class='textField ddTime massUpdtddTime' onfocus='crmTemplate.applyFocusInputBox(this, event)' onblur='crmTemplate.applyFocusInputBox(this, event)' />","HH:mm"!=Crm.userDetails.TIME_FORMAT&&(M+="<span name='txt_"+b+"ampmSpan' id='txt_"+b+"ampmSpan' class='ampmSpan massUpdtAMspan' ampm='AM' >"+I18n.getMsg("AM")+"</span>",M+="<input type='hidden' id='txt_"+b+"ampm' value='AM' name='txt_"+b+"ampm'>"),M+="</span></td></tr><tr><td class='p15'>",M+="</div></td></tr><tr><td colspan='2' class='p15'>"}else M+="</tr><tr><td colspan='2' class='p15'>";else 25==b||32==b||52==b?M+="<input type='text' data-zcqa='txt_MassUpdate_Value' id='txt_"+b+"' name='txt_"+b+"' class='newuiTextField' maxlength='"+w+"' onkeydown=\"handleButton('button__"+b+"',event)\" onchange=\"Crm.enableMassUpdateSaveBtn('button__"+b+"',event)\"></td></tr>"+"<tr><td colspan='2' class='p15'>":36==b||38==b||144==b||145==b||143==b?(M+="<input type='text' data-zcqa='txt_MassUpdate_Value' id='txt_"+b+"' name='txt_"+b+"' class='newuiTextField' data-maxlength='"+w+"' maxlength='"+(parseInt(w)+1)+"' onkeydown=\"controlPercentagefieldValue(this,event);handleButton('button__"+b+"',event)\" onchange=\"Crm.enableMassUpdateSaveBtn('button__"+b+"',event)\">",M+="</td></tr><tr><td colspan='2' class='p15'>"):300!=b&&301!=b||(M+="<label class='newCustomchkbox-md'><input type='checkbox' data-zcqa='chk_MassUpdate_Value' id='txt_"+b+"' name='txt_"+b+"'><span class='chkbxIcon'></span></label></td></tr>"+"<tr><td colspan='2' class='p15'>");void 0===y?($(".newuiTextField").hide(),M+="<div class='inputWrapper pL5 pR pB2 noFeildSel' id='dummyMassUpdTextFld' name='dummyMassUpdTextFld'><input class='IPArea w100per noborder txtField noBg' data-zcqa='txt_MassUpdate_Value' class='newuiTextField eventNone' maxlength='16'></div>",f.append(M)):(0==$("#error_status_alert").length&&100!=b&&b!=CrmField.UITYPES.STAGE&&96!=b&&(M+="<div id='error_status_alert' class='alignleft pT5 dN f12 redText pA left0'></div>"),f.html(M)),24!=b&&202!=b&&786!=b&&14!=b&&333!=b||setTimeout((function(){$("#txt_"+b).focus()}),10),2!=b&&100!=b&&96!=b&&26!=b&&208!=b&&$("#txt_"+b).focus(),786!==b&&14!==b&&333!==b||populateTimeVal($(".ddTime")),freezeBackground(),u&&"undefined"!=u&&$("#FreezeLayer").css("z-index",30);var j="";if(""==M&&void 0===y?j="":j+="<input type='button' data-zcqa='btn_MassUpdate_Save' value='"+saveButton+"' class='primarybtn' id='button__"+b+"' name='button__"+b+"' onclick=\""+R+'">',v.find("#saveButtonDiv").empty().append(j),v.find("#promptTextId").empty().append(P),crmui.escPopup("bulkUpdateFldsListForScheduler"),void 0===y){var V='<input type="button" value='+I18n.getMsg("crm.button.update")+' disabled="disabled" class="primarybtn">';v.find("#saveButtonDiv").empty().append(V)}}function multiselectOptionSelect(e){var t=$(e).is(":checked");t&&t.prop("checked",!0)}function handleCancelMUNew(e){hideAnimatePopup("bulkUpdateFldsListForScheduler",!0),removeFreezeLayer(),hideFreezeLayer(),crmListView.getObject().doMassActioninScheduler&&Crm.trackSpotLightAction("Mass Scheduler - Mass Update Cancel",{Module:e})}function checkanddisplayoptions(e){$(e).find(".select2-selection__rendered li").length>=2?($("#multiselectoptionChk").removeClass("dN"),$("#error_status_alert").text("")):$("#multiselectoptionChk").addClass("dN")}function getWorkflowPopUpContent(e,t,a){var i="<div class='zcrm-content w650'>";return i+="<div style='padding:60px; text-align:center;' class='f21'>",i+="<span id='ruleNamesForMassActions'></span>",i=(i+=" <div class='pT30 aligncenter'>")+"<div id='muBtnLayerModal' style='display:visible' ><input type='button' value='"+I18n.getMsg("crm.button.cancel")+"' class='newgraybtn' data-zcqa='link_WfDelete_Cancel' href='javascript:;' onclick=\""+t+"('"+a+"')\">",i+=e,i+="</div></div></div></div>"}function massActionWorkflowPopUp(e,t,a,i,r,l,n,s,o,d,c,m,u,p,g,v,f,h,b){var C="handleMassActionWorkFlowPopUpSave('"+t+"','"+i+"','"+r+"','"+l+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(n))+"','"+s+"','"+o+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(d))+"','"+c+"','"+m+"','"+u+"','"+p+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(g))+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(v))+"','"+$ESAPI.encoder().encodeForHTMLAttribute($ESAPI.encoder().encodeForJavaScript(f))+"','"+h+"','"+b+"')",y=getWorkflowPopUpContent("<input type='button' data-zcqa='btn_MassUpdate_Save' value='"+I18n.getMsg("crm.mass.actions.ok.proceed")+"' class='primarybtn' id='button__"+i+"' name='button__"+i+"' onclick=\""+C+'">',"handleMassActionWorkFlowPopUpCancel",r);$("#massActionWorkFlowPopUp").html(y)}function handleMassActionWorkFlowPopUpSave(e,t,a,i,r,l,n,s,o,d,c,m,u,p,g,v,f){hideAnimatePopup("massActionWorkFlowPopUp"),CallonMassUpdate(Crm.getCrmBasePath()+"/MassUpdateField.do",a,i,e,t,r,l,n,s,o,d,c,m,u,p,g,v,f,!1),Crm.trackSpotLightAction("Mass Scheduler - Mass Update WorkFlow OK Proceed",{Module:a})}function handleMassActionWorkFlowPopUpCancel(e){hideAnimatePopup("massActionWorkFlowPopUp",!0),hideAnimatePopup("bulkUpdateFldsListForScheduler"),Crm.trackSpotLightAction("Mass Scheduler - Mass Update WorkFlow Cancel",{Module:e})}function CallonMassUpdate(e,t,a,i,r,l,n,s,o,d,c,m,u,p,g,v,f,h,b){$("#bulkUpdateFldsListForScheduler").find("#saveButtonDiv").find("input")[0].disabled=!0;var C="";$(".form_err_msg").empty();var y=$("#error_status_alert");y.html("");var I=!!customViewObject.doMassActioninScheduler&&customViewObject.doMassActioninScheduler,w=[],A=0;I&&(A=crmListView.getObject().totalCount,null==k&&(A=0),(1==b||"true"==b||A<=Crm.massOperationWorkflowLimit)&&Crm.trackSpotLightAction("Mass Scheduler - Mass Update Confirmed",{Module:t}));var E=isFieldValueValid(r=parseInt(r),n,i,a,l,y);if(!E)return!1;C=E[0],333===r&&0===$L("#txt_"+r)[0].value.length&&(C="");var T=E[1],S=$(".depField:visible"),L=S.length;if(S.length)for(var _=0;_<L;_++){var O=S[_].getAttribute("data-fieldinfo").split("||||");if(!isFieldValueValid(parseInt(O[0]),O[6],O[4],O[5],O[2],y))return!1;w.push({column:O[4],value:$("#txt_"+O[0]+" :selected").text().trim()})}var M=!0;if("true"!=h&&1!=h||(M=!1),M){if(!mupFieldValidate(l,C,r,n))return 5!=r&&"CAMPAIGNID"!=i&&"CrmPotential"!=a&&getObj("txt_"+r).focus(),!1;var P="";crmListView.getObject().advSearchEnable&&(P=crmListView.getObject().advSearchEnable);var k=void 0;I?k=crmListView.getObject().totalCount:null==(k=crmListView.getObject().selectedIds.length)&&(k=1);var R=crmListView.getObject().includeChild?1:0;!C||1!=r&&11!=r&&27!=r&&127!=r&&62!=r||(C=renderingUtils.removeMultiSpacestoSingleSpace(C));var D={module:t,fieldValue:C,uiType:r.toString(),multiSelectOptionVal:T,columnName:i,idlist:s,isFromCamp:void 0,display_cust_view_name:o,cvid:d,start_index:crmListView.getObject().fromIndex,end_index:crmListView.getObject().toIndex,rangeValue:u,searchString:p,searchletter:"",searchField:"All",tableName:a,territoryId:crmListView.getObject().territoryId,includechild:R,retrievejson:!0,isMassJobScheduled:I,isWfTriggerCheck:b};"All"!=crmListView.getObject().searchletter&&(D.searchletter=crmListView.getObject().searchletter),"list"==Lyte.Router.getRouteInstance().routeName&&(D.from="listview");var U=crmListView.getObject(),F=void 0;if(U.criteriaSearch&&1==U.criteriaSearch){var x=[];D.rowCount=Search.rowcnt,q+="&rowCount="+Search.rowcnt;for(_=1;_<=Search.rowcnt;_++){var N={text:U["searchfield"+_],type:U["searchfieldtype"+_],match:U["match"+_]};D["searchfield"+_]=U["searchfield"+_],1!=_&&(D["match"+_]=U["match"+_]),D["searchfieldtype"+_]=U["searchfieldtype"+_];var B=U["searchfieldtype"+_];"U"==B?(N.value=D["searchuser"+_]=U["searchuser"+_],N.ptn=D["usercondition"+_]=U["usercondition"+_],Search.formUserConditionValues(N,_,"temp_value",N.value),N.temp_value=D["temp_searchuser"+_]=N.temp_value):"T"==B?(N.ptn=D["textcondition"+_]=U["textcondition"+_],N.value=D["searchtext"+_]=U["searchtext"+_]):"picklist"==B?(N.value=D["searchpicklist"+_]=U["searchpicklist"+_],N.ptn=D["textpicklistcondition"+_]=U["textpicklistcondition"+_]):"N"==B?(N.value=D["searchnum"+_]=U["searchnum"+_],N.ptn=D["numcondition"+_]=U["numcondition"+_]):"B"==B?(N.value=D["searchboolean"+_]=U["searchboolean"+_],N.ptn=D["booleancondition"+_]=U["booleancondition"+_]):"CML"==B?(N.value=dataOb["searchcampcv"+_]=U["searchcampcv"+_],N.ptn=D["campcvcondition"+_]=U["campcvcondition"+_],N.temp_value=D["temp_searchcampcv"+_]=U["temp_searchcampcv"+_]):"D"==B?(N.ptn=D["datecondition"+_]=U["datecondition"+_],U["datecondition"+_]==Search.ageCrt||U["datecondition"+_]==Search.dueCrt?(N.ageindayscondition=D["ageindayscondition"+_]=U["ageindayscondition"+_],N.ageindays=D["ageindays"+_]=U["ageindays"+_]):(N.value=D["searchdate"+_]=U["searchdate"+_],N.edate=D["searchedate"+_]=U["searchedate"+_])):"DT"==B?(N.ptn=D["datetimecondition"+_]=U["datetimecondition"+_],U["datetimecondition"+_]==Search.ageCrt||U["datecondition"+_]==Search.dueCrt?(N.ageindayscondition=D["ageindayscondition"+_]=U["ageindayscondition"+_],N.ageindays=D["ageindays"+_]=U["ageindays"+_]):(N.value=D["searchdatedate"+_]=U["searchdatedate"+_],N.sthour=D["searchsthour"+_]=U["searchsthour"+_],N.stminute=D["searchstminute"+_]=U["searchstminute"+_],N.stampm=D["searchstampm"+_]=U["searchstampm"+_],N.enddate=D["searchenddate"+_]=U["searchenddate"+_],N.endhour=D["searchethour"+_]=U["searchethour"+_],N.endminute=D["searchetminute"+_]=U["searchetminute"+_],N.stime=D["searchstime"+_]=U["searchstime"+_],N.etime=D["searchetime"+_]=U["searchetime"+_],N.endampm=D["searchetampm"+_]=U["searchetampm"+_])):"territory"==B&&(N.ptn=D["territorycondition"+_]=U["territorycondition"+_],N.value=D["searchterritory"+_]=U["searchterritory"+_]),x.push(N)}D.patternVal=U.patternVal,D.criteriaSearch=!0,x.push(U.patternVal),F=JSON.stringify(x)}D[csrfParamName]=csrfToken;var j=s.split(";");""==j[j.length-1]&&j.pop(),commonUtils.showHideLoadingDiv(!0),$("#muBtnLayer").css("display","none"),$("#busyBtn").css("display","block");var V=objectUtils.getKeys(crmListView.startIndex).sort()[0];D.rangeValue=crmListView.getObject().currentOption,D.dependentFieldsUpdate=0!=w.length?JSON.stringify(w):[],void 0!==V&&(D.FROM_INDEX=V,D.TO_INDEX=parseInt(V)+parseInt(D.rangeValue)-1);var H=Lyte.Router.getRouteInstance().routeName;"list"!=H&&"canvas"!=H&&"kanban"!=H||!customViewObject.filters&&!customViewObject.cross_filters?crmListView.getFilterParams(D):(customViewObject.filters&&(D.filters=JSON.stringify(customViewObject.filters)),customViewObject.cross_filters&&(D.cross_filters=JSON.stringify(customViewObject.cross_filters)),D.isNewFilter=!0),D.fetchOnlyBody="true",doMassUpdate(t,e,D,j,F,A)}else{if(document.getElementById("advSearchEnable")&&(P=document.getElementById("advSearchEnable").value),httphandle){if(!mupFieldValidate(l,C,r,n))return 5!=r&&"CAMPAIGNID"!=i&&"CrmPotential"!=a&&getObj("txt_"+r).focus(),!1;commonUtils.showHideLoadingDiv(!0),$("#muBtnLayer").css("display","none"),$("#busyBtn").css("display","block"),loadAjaxTab("","lightblue");var z=document.getElementById("searchField"),G=z?z.value:"All";33==r&&(C=getObj("txt_"+r).value),C="string"==typeof C?trimBoth(C):C;var q="module="+t+"&fieldValue="+encodeURIComponent(C)+"&uiType="+r+"&tableName="+a+"&columnName="+i+"&idlist="+s+"&isFromCamp="+h;if("undefined"!=h&&($("#selAllCon").is(":checked")&&"true"==$("#isNeedSchedule").val()||s.split(";").length>201))return void addToSchedule(id,t,q);if(q=q+"&display_cust_view_name="+o+"&cvid="+d+"&start_index="+c+"&end_index="+m+"&rangeValue="+u+"&searchString="+p+"&searchletter="+g+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&searchField="+G,"true"==P){var J=formData2QueryStringforAdvSearch(document.showcvdetails);null!=J&&(q=q+"&"+J)}var W=getElemById("territoryId");q+=W?"&territoryId="+W.value+"&includechild="+getElemById("includechild").value:"",httphandle.open("POST",e,!0),httphandle.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),httphandle.onreadystatechange=function(){if(4==httphandle.readyState){var e=httphandle.responseText;if(e.indexOf("Why does my session expire")>-1||e.indexOf("Affordable for Medium Business")>-1)return renderingUtils.showCustomAlert(I18n.getMsg("crm.reauth.login.expired")),void(document.location.href=Crm.getCrmBasePath()+"/ShowHomePage.do");if(200==httphandle.status)if(e.indexOf("SECURITY::::")>-1){var a=e.split("SECURITY::::");divObj=getObj("ShowCustomViewDetails"),$(divObj).empty(),divObj.innerHTML=a[1]}else if(e.indexOf("DELETE::::")>-1){var i=e.split("DELETE::::");divObj=getObj("ShowCustomViewDetails"),$(divObj).empty(),divObj.innerHTML=i[1]}else if(commonUtils.showHideLoadingDiv(),"undefined"!=h){var r=$("#lookupdiv").position();$(".chk").prop("checked",!1),$("#selAllCon").prop("checked",!1);var l=$("#bulkUpdateSuccess");l.html(updatedsuccesfully),setCenter(document.getElementById("bulkUpdateSuccess")),l.css({top:r.top+10,left:r.left+180}),show("bulkUpdateSuccess"),$("#FreezeLayer").css("z-index",20),setTimeout((function(){l.fadeOut("slow")}),2e3),hideAnimatePopup("bulkUpdateFldsListForScheduler")}else"Leads"==t||"Contacts"==t||"Accounts"==t||"Potentials"==t?changeShowCacheObj(t,e):(divObj=getObj("idForCV"),$(divObj).empty(),divObj.innerHTML=e),deSelectAll(),bindEventListView(),placeExtra(),$("#h2").empty(),getObj("recentItem")&&(getObj("h2").innerHTML=getObj("recentItem").innerHTML),removeFreezeLayer(),$("#bulkUpdateSuccess").empty(),getObj("bulkUpdateSuccess").innerHTML=updatedsuccesfully,mailsetCenter("bulkUpdateSuccess"),setTimeout((function(){hide("bulkUpdateSuccess")}),2e3);else if(httphandle.status==crmConstants.errorStatusCode)return void renderingUtils.displayPermissionDenied(httphandle)}},httphandle.send(q)}"undefined"==h&&hideAnimatePopup("bulkUpdateFldsListForScheduler")}}function doMassUpdate(e,t,a,i,r,l){Macro.canShowAutoSuggest=!0,isWFExecuted=!1;var n=new crmRequestPool,s=void 0;s=isWFSchedulerUser()?i.splice(0,i.length):i.splice(0,crmConstants.maxRecOperCnt),(customViewObject.isStageView&&1==customViewObject.isStageView||customViewObject.isPredictView&&1==customViewObject.isPredictView)&&customViewObject.layoutId&&"0"!=customViewObject.layoutId&&(a.layoutId=customViewObject.layoutId),a.idlist=s.join(";"),n.initiate({action:t,data:a,type:"POST",dataType:"json",success:function(n){if("SecurityError"==n.responseText)return hideAnimatePopup("bulkUpdateFldsListForScheduler"),renderingUtils.displayPermissionDenied(),!1;null!=Macro.autoSuggestHandler&&clearTimeout(Macro.autoSuggestHandler),Macro.autoSuggestHandler=setTimeout((function(){Macro.canShowAutoSuggest=!1}),1e4);var s=Lyte.Router.getRouteInstance();if(1===i.length&&""===i[0]||i.length<=0){var o=a.isMassJobScheduled;if(n.body&&0!=n.body.length&&"listview"!=a.from){for(var d=[],c=n.fromIndex-1,m=0;c<=n.toIndex;c++,m++)n.body[m]?d[c]=n.body[m]:d[c]=null;n.body=d}var u=crmTab.getFromCache(e);if(void 0!==n.isWfTriggered&&1==n.isWfTriggered&&void 0!==n.approvalProcessTriggered&&1==n.approvalProcessTriggered)return void showMassActionRelatedRulesPop(I18n.getMsg("crm.mass.actions.rules.alert.content",[I18n.getMsg("crm.mass.actions.workflow.rules")+" & "+I18n.getMsg("crm.mass.actions.approval.process")]));if(void 0!==n.isWfTriggered&&1==n.isWfTriggered)return void showMassActionRelatedRulesPop(I18n.getMsg("crm.mass.actions.rules.alert.content",[I18n.getMsg("crm.mass.actions.workflow.rules")]));if(void 0!==n.approvalProcessTriggered&&1==n.approvalProcessTriggered)return void showMassActionRelatedRulesPop(I18n.getMsg("crm.mass.actions.rules.alert.content",[I18n.getMsg("crm.mass.actions.approval.process")]));if(1==n.exceededRecordLimit);else if(void 0!==n.isWfTriggered&&0==n.isWfTriggered)commonUtils.showHideLoadingDiv(),hideAnimatePopup("bulkUpdateFldsListForScheduler"),removeFreezeLayer();else{if(1==n.isScheduledMassOperation||"true"==n.isScheduledMassOperation){if(commonUtils.showHideLoadingDiv(),removeFreezeLayer(),hideFreezeLayer(),hideAnimatePopup("massActionWorkFlowPopUp"),hideAnimatePopup("bulkUpdateFldsListForScheduler"),"listview"==a.from?1==n.success?crmListView.reloadCurrentListView(void 0,void 0,!0):crmListView.reloadCurrentListView():(crmListView.checkAll(),showHideListViewBtnFn(),crmListView.selectAllEntity("",$(".selCountIcon dIB"))),0==n.isValidInterval)return;if(1==n.success){var p=I18n.getMsg("crm.mass.actions.mass.update.job");p=n.isQueued?p+" "+I18n.getMsg("crm.mass.actions.scheduled.submit"):p+" "+I18n.getMsg("crm.mass.actions.scheduled.success"),crmui.showMsgBand("success",p,4e3,"");var g=$("#selectAllRecords");g.length>0&&(g.hide(),customViewObject.moreActions.push("hideSelectAllRecords")),customViewObject.showSelectAll=!1,crmListView.setHideActionInModule()}else if(1==n.jobRunningForCvid)crmui.showMsgBand("info",I18n.getMsg("crm.mass.actions.cv.running"),4e3,"");else{var v=I18n.getMsg("crm.mass.actions.update"),f=I18n.getMsg("crm.mass.actions.scheduled.fail",[v]);crmui.showMsgBand("error",f,18e4,"")}return}if("false"==n.error||"listview"==a.from){if(isWFSchedulerUser()&&n.isWFScheduler&&null!=o&&!o){var h=a.idlist.split(";").length,b=n.wfOffloadedJobid;detailView.currWFOffloadingJobIds.push(b),detailView.isMassupdatePopupLoading=!0;var C=automationActionsNotificationScheduler.setTimeoutForAutomationActionsOffload(h);return void setTimeout((function(){detailView.isMassupdatePopupLoading&&(detailView.isMassupdatePopupLoading=!1,automationActionsNotificationScheduler.showNotificationInProgress(b))}),C)}if("listview"==a.from)crmListView.reloadCurrentListView();else{1!=n.isStageView&&1!=n.isPredictView&&u&&(u.body=n.body),u&&(n.isStageView&&(u.stageBoardDetails=n.stageBoardDetails),n.isPredictView&&(u.predictData=n.predictData),u.fromIndex=n.fromIndex,u.toIndex=n.toIndex,u.selectedIds=[],crmTab.putInCache(e,u));var y=moduleRecordMapping[a.module].id;store.model[y]&&store.unloadAll(y);var I=u?crmHistory.getPageDetailsFromIndex(u.fromIndex,u.toIndex):crmHistory.getPageDetailsFromIndex(1,10);s.getQueryParams().page!=I.page&&"kanban"!=s.routeName&&"canvas"!=s.routeName&&"zia"!=s.routeName||s.refresh()}}else u=n,crmListView.createTemplate(n)}}if(void 0===n.isWfTriggered||0==n.isWfTriggered){crmTab.putInCache(e,u),crmTab.updateTabContent(e);var w=$("#checkAll");w.attr("class","customCheckBoxChecked")&&w.attr("class","customCheckBox"),commonUtils.showHideLoadingDiv(),hideAnimatePopup("bulkUpdateFldsListForScheduler",!0),removeFreezeLayer()}if(!(!o&&0==i.length||o&&l<Crm.massOperationUserThreadLimit))return doMassUpdate(e,t,a,i,r);o&&overLayForSelectAllClick(!1),"string"==typeof n.responseText&&-1!=n.responseText.indexOf("CRM_ERROR_PAGE_500")?crmui.showMsgBand("error",I18n.getMsg("crm.unable.to.process.request"),"4000",""):crmui.showMsgBand("success",updatedsuccesfully,"4000",""),Macro.autoSuggest(e,!1),crmListView.startIndex={}},error:function(e){555===e.status&&(commonUtils.showHideLoadingDiv(),removeFreezeLayer(),hideFreezeLayer(),hideAnimatePopup("massActionWorkFlowPopUp"),hideAnimatePopup("bulkUpdateFldsListForScheduler"),crmui.showMsgBand("error",e.responseText,"4000",""))}})}function showMassActionRelatedRulesPop(e){commonUtils.showHideLoadingDiv(),removeFreezeLayer(),hideAnimatePopup("bulkUpdateFldsListForScheduler",!1),$("#ruleNamesForMassActions").text(e),showAnimatePopup("massActionWorkFlowPopUp"),$("#muBtnLayerModal").css({display:"",visibility:"visible"})}function showMassDeleteRelatedRulesAlert(e){commonUtils.showHideLoadingDiv(),removeFreezeLayer(),hideAnimatePopup("deletepopup",!1),$("#ruleNamesForMassActions").text(e),showAnimatePopup("massActionWorkFlowPopUp")}function showTransferRelatedRulesAlert(e){hideFreezeLayer(),hideAnimatePopup("changeOwnerPopup",!1),$("#ruleNamesForMassActions").text(e),showAnimatePopup("massActionWorkFlowPopUp"),hideFreezeLayer(),removeFreezeLayer()}function navigate(e,t,a,i,r,l){"next"==r?(a+=10,i+=10):(a-=10,i-=10),crmNavig.checkForNavigReq("gsearch",t,a,10,(function(){httpHandle=getHTTPObject(),httpHandle.open("POST",e,!0),httpHandle.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),httpHandle.onreadystatechange=function(){if(4==httpHandle.readyState){var e=httpHandle.responseText;if(200==httpHandle.status){var i=getObj("ajax_"+t);$(i).empty(),i.innerHTML=e,JSEvalScript(i),$("#ajax_"+t+" #navigationNextIcon").hasClass("nextDisabled")?(jarr.isLast=!0,crmNavig.assignNavigCacheData("gsearch",t,a,10,jarr)):(jarr.isLast=!1,crmNavig.assignNavigCacheData("gsearch",t,a,10,jarr))}else if(httpHandle.status==crmConstants.errorStatusCode)return void renderingUtils.displayPermissionDenied(httpHandle)}},httpHandle.send("ajaxSearch=true&")}),(function(e){var r=$("#tmpl_"+t).html(),n=Handlebars.compile(r),s=$("#ajax_"+t),o=s.find("#gsearchTable"),d=s.find("#toindex"),c=s.find("#navigationPrevIcon"),m=s.find("#navigationNextIcon");o.find(".topband_dv_row").remove(),o.append(n(e));var u=i-a+1;s.find("#fromindex").text(a),d.text(i);var p=Crm.getCrmBasePath()+"/GSearch.do?mod_"+t+"=true&searchCategory=AllEntities&userOption="+(null==userOption?userOption:encodeURIComponent(crmHistory.getState().data.userOption))+"&searchword="+encodeURIComponent(l)+"&sModules="+t+"&isNavigate=true";a>10?(c.removeClass("previous_disabled"),c.addClass("previous"),$("#navigatePrev"+t).attr("onclick","javascript:navigate('"+Crm.getCrmBasePath()+"/NavigateByRecords.do?totalRecords="+u+"&fileName="+$ESAPI.encoder().encodeForJavaScript(p)+"&toIndex="+i+"&fromIndex="+a+"&currentOption=10&previous.x=x','"+encodeURIComponent(t)+"',"+a+","+i+",'previous')")):(c.addClass("previous_disabled"),c.removeClass("previous"),$("#navigatePrev"+t).removeAttr("onclick")),!0===e.isLast?(m.removeClass("next"),m.addClass("nextDisabled"),$("#navigateNext"+t).removeAttr("onclick"),d.text(i+e.length-10)):(m.addClass("next"),m.removeClass("nextDisabled"),$("#navigateNext"+t).attr("onclick","javascript:navigate('"+Crm.getCrmBasePath()+"/NavigateByRecords.do?totalRecords="+u+"&fileName="+$ESAPI.encoder().encodeForJavaScript(p)+"&toIndex="+i+"&fromIndex="+a+"&currentOption=10&next.x=x','"+encodeURIComponent(t)+"',"+a+","+i+",'next')"))}),!1)}function putGsearchOnHistory(){var e=getObj("searchStr").value,t=getObj("userOption").checked,a="ajaxSearch=true&searchword="+encodeURIComponent(e)+"&userOption="+t+"&searchCategory=AllEntities";putInHistory("Gsearch_11","GSearch|?"+a)}function populateCommentSection(e){var t=$("#value_COMMENTCONTENTS"),a=t.html();return t.html(e+a),""}function replace4Skype(e){return e=(e=(e=e.replace(/ /gi,"")).replace("(","")).replace(")","")}function formData2QueryStringforAdvSearch(e){for(var t="",a="",i=e.elements.length,r=0;r<i;r++){var l=(a=e.elements[r]).name+"";if(new RegExp("^advSearch.*").test(l))switch(a.type){case"text":case"select-one":case"hidden":case"password":case"textarea":t+=encodeURIComponent(a.name)+"="+encodeURIComponent(a.value)+"&";break;case"checkbox":getObj(a.name).checked&&(t+=encodeURIComponent(a.name)+"="+encodeURIComponent(a.value)+"&")}}return t}function submitMergeForm(e){var t=Crm.getCrmBasePath()+"/MailMerge.do?action=mergeRecords",a=document.allMailMergeForm;if(validateFile())if(null!=a.openfilein[0]&&a.openfilein[0].checked)if("zoho"==a.openfilein[0].value){var i=formData2QueryString(a);closeDashletDiv("lookupdiv"),sendMergeRequestToWriter(t,i,e)}else"msword"==a.openfilein[0].value&&(a.action=t,a.submit());else if(null!=a.openfilein[1]&&a.openfilein[1].checked)if("zoho"==a.openfilein[1].value){i=formData2QueryString(a);closeDashletDiv("lookupdiv"),sendMergeRequestToWriter(t,i,e)}else"msword"==a.openfilein[1].value&&(a.action=t,a.submit());else if(null!=a.openfilein&&a.openfilein.checked)if("zoho"==a.openfilein.value){i=formData2QueryString(a);closeDashletDiv("lookupdiv"),sendMergeRequestToWriter(t,i,e)}else"msword"==a.openfilein.value&&(a.action=t,a.submit())}function validateFile(){return""!=getObj("mailMergeListId").value||(alert("Please choose Mailmerge document"),!1)}function updateHomeCurrency(e){var t=document.getElementById(e),a=formData2QueryString(t);return a=a.replace(/_back/g,""),doAjaxUpdate("result",t.action,a,(function(){removeFreezeLayer()})),!1}function validateERate(e){var t=e.value,a=document.getElementById("save_bbtn");""==t||isNaN(t)?a.setAttribute("disabled","disabled"):parseFloat(t,10)>0?a.removeAttribute("disabled"):a.setAttribute("disabled","disabled")}function populateCurrencyDetails(e,t,a){var i=e.value,r=e.options[e.selectedIndex],l=r.getAttribute("symbol");if(""==i)return showHideDivSpan("active_spn;exchangeRate_div;currencyFormatDiv_"+t,"none"),void("setup"==a&&document.getElementById("confirm_bbtn").setAttribute("disabled","disabled"));document.getElementById("currencyName_"+t).value=r.innerHTML,document.getElementById("currencySymbol_"+t).value=r.getAttribute("symbol"),document.getElementById("currFrmtDiv_"+t).style.display="none";for(var n=document.getElementById("currencySymbol_front");n.hasChildNodes();)n.removeChild(n.lastChild);var s=document.createElement("OPTION");s.setAttribute("value",l),s.innerHTML=l,n.appendChild(s),i!=l&&((s=document.createElement("OPTION")).setAttribute("value",i),s.innerHTML=i,n.appendChild(s)),setCurrencyCustomValue("decimalPlace_"+t,r.getAttribute("decimalplace")),setCurrencyCustomValue("decimalSeparator_"+t,r.getAttribute("decimalSep")),setCurrencyCustomValue("thousandSeparator_"+t,r.getAttribute("thousandSep")),selectCurrencyFormat(t),showHideDivSpan("active_spn;exchangeRate_div","table-row"),"DIV"===$("#currencyFormatDiv_"+t).prop("tagName")?showHideDivSpan("currencyFormatDiv_"+t,"block"):showHideDivSpan("currencyFormatDiv_"+t,"table-row");var o=getObj("exchangeRate_"+t);o&&o.focus(),"setup"==a&&document.getElementById("confirm_bbtn").removeAttribute("disabled")}function showHideDivSpan(e,t){var a=e.split(";");for(var i in a){var r=document.getElementById(a[i]);r&&(r.style.display=t,"currFrmtDiv_front"!==a[i]&&"currFrmtDiv_back"!==a[i]||(thirdPartyUtils.bindSelect2($("#crn_fui, #crn_fuiT, #currFrmtDiv_front").find(".newSelect select")),select2ChangesInFields($(r))))}}function selectCurrencyFormat(e){if(validateCurrencySeparators(e)){var t="1#234#567@899",a=getObj("decimalPlace_"+e).value,i=getObj("decimalSeparator_"+e).value,r=getObj("thousandSeparator_"+e).value;return t=t.replace(/#/g,r),t="0"==a?t.substring(0,t.indexOf("@")):(t=t.replace("@",i)).substring(0,t.length-(3-a)),$("#dispCurrencySymbol_"+e).empty(),document.getElementById("dispCurrencySymbol_"+e).innerHTML=getObj("currencySymbol_"+e).value,$("#dispCurrencyFormat_"+e).empty(),document.getElementById("dispCurrencyFormat_"+e).innerHTML=t,setHiddenCurrencyFormat(e),!0}return!1}function setCurrencyCustomValue(e,t){for(var a=getObj(e),i=a.options.length,r=0;r<i;r++)a.options[r].value==t&&(a.options[r].selected=!0)}function setHiddenCurrencyFormat(e){var t=getObj("decimalSeparator_"+e).value,a=getObj("thousandSeparator_"+e).value;getObj("currencyFormat_"+e).value=a+"|"+t}function validateCurrencySeparators(e){var t=getObj("decimalPlace_"+e).value;getObj("decimalSeparator_tr_"+e).style.display=0==t?"none":"";var a=getObj("decimalSeparator_"+e).value,i=getObj("thousandSeparator_"+e).value;return 0!=t&&a==i?(document.getElementById("customize_err_"+e).style.visibility="visible",document.getElementById("ok_btn_"+e).setAttribute("disabled","disabled"),!1):(document.getElementById("customize_err_"+e).style.visibility="hidden",document.getElementById("ok_btn_"+e).removeAttribute("disabled"),!0)}var sendMergeRequestToWriter=function(e,t,a){mR(e,(function(e){0==e.indexOf("http")?window.open(e):0==e.indexOf("ERROR:::")?renderingUtils.showCustomAlert(e.split("ERROR:::")[1]):renderingUtils.showCustomAlert(a)}),t)};function changeSubValueId(e,t){var a=e;return t&&t[0].id!=t[1].id&&(a=e.replace("subvalue_","subvalue1_")),a}function scrollDivLeft(e,t){creator_scroll_div_width<300&&(creator_scroll_div_width=300*t-601),getObj("rightImgId").style.visibility="visible";document.getElementById(e).scrollLeft+=300,(creator_scroll_div_width-=300)<300&&(getObj("leftImgId").style.visibility="hidden")}function scrollDivRight(e){var t=document.getElementById(e).scrollLeft;getObj("leftImgId").style.visibility="visible";document.getElementById(e).scrollLeft-=300,creator_scroll_div_width+=300,t-300<300&&(getObj("rightImgId").style.visibility="hidden")}function checkAll(e){var t=document.getElementsByName(e).length;if(null==t)getObj(e).checked=!0;else for(var a=0;a<t;a++)document.getElementsByName(e)[a].checked=!0}function unSelectAll(e){var t=document.getElementsByName(e).length;if(null==t)getObj(e).checked=!1;else for(var a=0;a<t;a++)document.getElementsByName(e)[a].checked=!1}function updateTabGroup(){store.unloadAll("tab_group"),store.findAll("tab_group").then((function(e){var t,a,i=document.getElementsByTagName("crm-tab-group")[0],r=document.getElementsByTagName("crm-tab")[0],l=document.querySelector("crm-menu");if(e&&1===e.length)return r.setData("tabModules",e[0].modules.sortBy("sequence_number")),void l.setData("showTabGroup",!1);l.setData("showTabGroup",!0),i&&(i.setData("tabGroupsName",e),t=i.getMethods("changeTabGroup")),i&&(a=i.getData("tabGroupsSelectedItem"));for(var n=0;n<e.length&&(!a||a!=e[n].id)&&(!e[n].default||null!=(a=e[n].id));n++);r&&a&&t&&t.call(i,null,a)}))}function editTabGroup(e){var t=Crm.getCrmBasePath()+"/CustomizeTabGroup.do?action=editTabGroup&tabGroupId="+e,a=$("#topBandPopup");a.is(":visible")?t+="&isFrom=popup":t+="&isFrom=setup",mR(t,(function(e){if(e.includes("The action that you intend to perform is not possible"))$("#show").html(e);else{e='<div class="pR"><span onclick="hideAnimatePopup(\'topBandPopup\');" id="popup_editTabGroup" style="float:right;display:block;right: 20px;top: 20px;z-index: 1;" class="newPopupCloseIcon svgIcons ico-close-small2 cP op08 pA"></span></div><div id="result">'+e+"</div>",a.html(e),showAnimatePopup("topBandPopup");var t=$('[name=CustomizeTabGroupForm] [data-zcqa="btn_tab_cancel"]');"popup"===$("#tabGroup input[name='isFrom']").val()?t.attr("onclick","showCustomizePopup('tabGroupList','popup')"):t.attr("onclick","hideAnimatePopup('topBandPopup');"),setTimeout((function(){getObj("tabGroupName")&&getObj("tabGroupName").focus()}),500)}})),updateTabGroup()}function deleteTabGroup(){var e=getObj("deleteTabName").value.split("_"),t=e[0],a={},i={key:"alltabgroups"};i.label=I18n.getMsg("crm.tabgroup.label.AllAccessibleTabs"),removeFreezeLayer(),loadAjaxTab("","lightblue");a="action=deleteTabGroup&tabGroupName="+e[1]+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);var r=JSON.parse('{"id":'+JSON.stringify(e[0])+',"currentdepartment":'+JSON.stringify(i)+"}"),l=Crm.getCrmBasePath()+"/CustomizeTabGroup.do";mR(l,(function(e){var l=$("lyte-menu-item[id='"+e+"']"),n=l.length>0?l.find("span"):void 0,s=$(n).css("visibility");if(-1!=e.indexOf("SECURITY_ERROR_403::::INSUFFICIENT")||-1!=e.indexOf("CRM_ERROR_PAGE_500"))return renderingUtils.showCustomAlert(I18n.getMsg("crm.maximum.request.limit")),void $("#TabGroupWarningDiv").hide();null!=n&&"visible"===s?(changeMyTabGroup("0"),a.currentdepartment=i):($("tr[id="+e+"]").remove(),$("#tabGroupListTable tr").length<2&&($("#tabGroups #tabGroupListTable").hide(),$("#emptyTabGroup").show()),updateTabGroup()),a.id=t;var o=document.getElementsByTagName("crm-tab-group")[0].getData("tabGroupsSelectedItem");crmplusImplTriggerActions("removeUIElement",["department",r]),o==t&&"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()&&Utils.windowLocationReload()}),a)}function showHideNewTabGroup(e,t){var a="";if("new"==t?a=document.newCreatorApp:"old"==t&&(a=document.myCreator),"none"!=getObj("tabGroupDivWithSelect").style.display){var i=a.existingTabGroups.selectedIndex;"cntg"==a.existingTabGroups.options[i].value&&(e<10?(getObj("createtabGroupDiv").style.display="block",getObj("tabGroupDivWithSelect").style.display="none"):(renderingUtils.showCustomAlert(I18n.getMsg("crm.creator.label.tabgroup.error.maxexceeded")),a.existingTabGroups.value="0"))}else"none"!=getObj("createtabGroupDiv").style.display&&(getObj("createtabGroupDiv").style.display="none",getObj("tabGroupDivWithSelect").style.display="block",getObj("existingTabGroups").value="0")}function checkTabGroupSpecialChar(e){for(var t=new Array("`","~","!","#","^","*","[","]","{","}","|","\\",'"',";","'","&","+","%","(",")","@","_","?","<",">"),a=e.length,i=0;i<a;i++)if(-1!=t.toString().indexOf(e.charAt(i)))return!1;return!0}function checkTabGroupFields(e){buildTabGroup();var t=getObj("tabGroupName").value.trim(),a=!0;if(""==t.trim())return getObj("tabGroupName").focus(),renderingUtils.showCustomAlert(I18n.getMsg("crm.tabgroup.name.check")),!1;var i=Crm.getCrmBasePath()+"/CustomizeTabGroup.do?action=validateTabGroupName&tabGroupName="+t+"&tabGroupId="+e;return mR(i,(function(i){if("true"==i)renderingUtils.showCustomAlert(I18n.getMsg("crm.tabgroup.error.duplicateName")),document.getElementsByName("tabGroupName")[0].focus();else{if(!checkTabGroupSpecialChar(t))return renderingUtils.showCustomAlert(I18n.getMsg("crm.tabgroup.name.specialCharacter")),a=!1,!1;if(t.length>25)return renderingUtils.showCustomAlert(I18n.getMsg("crm.tabgroup.name.lengthcheck")),a=!1,!1;if(1==a){var r=formData2QueryString(document.CustomizeTabGroupForm);mR(getAttr(document.CustomizeTabGroupForm,"action"),(function(t){if(-1==t.indexOf("SECURITY_ERROR_403::::INSUFFICIENT")&&-1==t.indexOf("CRM_ERROR_PAGE_500")){if(-1!=t.indexOf("DUPLICATE TABGROUP"))return renderingUtils.showCustomAlert(I18n.getMsg("crm.tabgroup.error.duplicateName")),void document.getElementsByName("tabGroupName")[0].focus();if(-1==t.indexOf("TABGROUPLIMITEXCEED")){if(t=JSON.parse(t),"manage"===$("[name='isFrom']").val()||"setup"===$("[name='isFrom']").val()){var a="<tr id='"+t.tabGroupId+'\' class="topband_dv_row"><td nowrap align="center"><a class="link neweditIcon dIB" href="javascript:editTabGroup(\''+t.tabGroupId+'\')"></a><span class="sep"></span><a class="link deleteIcon dIB" href="javascript:" onclick="javascript:openWarningMessage(\'deleteTabGroup\',\''+t.tabGroupId+"_"+$ESAPI.encoder().encodeForHTML(t.tabGroupName)+"', this);\" data-onclick=\"deleteTabGroup(); hideAnimatePopup('deletepopup');\"></a></td><td nowrap>"+$ESAPI.encoder().encodeForHTML(t.tabGroupName)+"</td><td>"+t.tabNameList+"</td></tr>";if($("tr[id="+t.tabGroupId+"]").length>0)$("tr[id="+t.tabGroupId+"]").replaceWith(a);else{var i=$("#tabGroupListTable");i.is("visible")||($("#tabGroups #tabGroupListTable").show(),$("#emptyTabGroup").hide()),i.append(a)}}if(updateTabGroup(),hideAnimatePopup("topBandPopup"),$("#errorMsgDiv").html(I18n.getMsg("crm.entity.add.success",I18n.getMsg("crm.tabGroup"))).show().fadeOut(3e3),"new"==$("#tabGroupType").val()){var r=[],l={};l.key=t.tabGroupId,l.label=t.tabGroupName,r.push(l);var n=["department",{list:r,isnewdepartment:!0,cansetselected:!1}];crmplusImplTriggerActions("modifyUI",n)}else{n=["department",t.tabGroupId,t.tabGroupName];var s=document.getElementsByTagName("crm-tab-group")[0].getData("tabGroupsSelectedItem");crmplusImplTriggerActions("updateField",n),s==e&&"undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()&&Utils.windowLocationReload()}}else renderingUtils.showCustomAlert(I18n.getMsg("crm.massmail.limit.title"))}else renderingUtils.showCustomAlert(I18n.getMsg("crm.maximum.request.limit"))}),r),Crm.trackSpotLightAction("Tab Groups - New Tab Group Created")}}})),!1}function moduleFields(e,t,a,i,r){if(!Crm.userDetails.CLIENT_ACCOUNT){itsonview&&$("#saveCancelSpan").find('[value="Cancel"]').click();var l="",n=$("#labelTD_LAYOUTID").parent().data();void 0!==n&&(l=n.params.defaultid);var s=Crm.getCrmBasePath()+"/EntityFieldCustomize.do?action=getSummaryFieldJson&module="+a+"&layoutId="+l;if("false"==i||"true"==itsonedit)return!1;r||(e=escape(e));var o='<select id="textbox_fieldlabels" name="fieldlabels" onchange= "updateSummarySequence(this.options[this.options.selectedIndex].value,this.options[this.options.selectedIndex].text ,'+t+",'"+a+"','"+e+"');\">";e=unescape(e),mR(s,(function(i){var r=jsonFields=jQuery.parseJSON(i),l=r.I18NFields,n=r.FieldId,s=r.colname,d=r.uiType;"SCORE"===s&&(l.splice(l.indexOf("Score"),1),s.splice(s.indexOf("SCORE"),1)),globalvaluespanid="headervalue_"+e,globallabelspanid="headerlabel_"+e;var c=$("#"+globallabelspanid),m=c.text();m=m.replace("&amp;","&");for(var u=l.length,p=0;p<u;p++)if(1!=Crm.userDetails.detailView_newUI||null==Crm.userDetails.detailView_newUI||"3"!==d[p]&&"110"!==d[p]){var g=l[p],v=s[p];if(!(jsonFields.CurrentFields.indexOf(v)>-1&&trimBoth(v)!==trimBoth(e)||CFRExec&&CFRExec.isLayoutRuleHiddenElem(v))){var f=n[p];trimBoth(v)==trimBoth(e)?o+='<option value="'+f+'" col="'+v+'" selected>':o+='<option value="'+f+'" col="'+v+'">',o+=g+"</option>"}}o+="</select>",e=escape(e),o+='<a href=javascript:; id="summaryEdit" onclick="clearSummaryEdit(\''+e+"','"+t+"','"+a+"','True');\"></a>",$(c[0]).empty(),c[0].innerHTML=o;var h=$("#textbox_fieldlabels");thirdPartyUtils.bindSelect2(h),h.closest("td").addClass("selectBoxSelect2"),$(".newBusinessCardView").addClass("bCLeftPanelEditOpen"),setTimeout((function(){$(h).select2("open")}),30),h.next().trigger("mousedown"),itsonedit="true",hide("summaryfield")}))}}function updateSummarySequence(e,t,a,i,r){for(var l=document.getElementById("textbox_fieldlabels"),n=l.options[l.selectedIndex].getAttribute("col"),s=void 0,o=jsonFields,d=o.CurrentFields,c=o.FieldId,m=o.colname,u=m.length,p=(r=unescape(r)).replace(/_____/g,")").replace(/____/g,"(").replace(/___/g,"."),g=0;g<u;g++){var v=r;if(m[g]==v){s=c[g];break}}for(var f=d.length,h=0;h<f;h++)if(d[h]==n){renderingUtils.showCustomAlert(I18n.getMsg("crm.summary.same.field.alert",t));var b=$("#textbox_fieldlabels");return b.val(s),b.select2("close"),b.select2("destroy"),document.getElementsByTagName("body")[0].click(),!1}var C=Crm.getCrmBasePath()+"/Security.do?actionName=updateSS",y="sequence="+a+"&module="+i+"&selectedfieldId="+e+"&oldfieldId="+s+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&entityId="+$("[name='id']").val();mR(C,(function(){void 0!==CFRExec&&CFRExec.handleBusinessCardFields()}),y),globallabelspanid="headerlabel_"+r;var I="header_"+r,w=getObj("historyFrame"),A=null;A=w.contentDocument?w.contentDocument:w.contentWindow?w.contentWindow.document:w.document;var E=n.replace(/\./g,"___").replace(/\(/g,"____").replace(/\)/g,"_____"),T="<table id='tab'><tr><td id=\"header_"+E+'" class="dvValueTxt bcEditIcon dblClk" onMouseOver="detailView.mouseover(\'#'+unescape("mouseArea__"+E)+"','true')\" onMouseOut=\"hide('crmspanid')\"><span id=\"headermouseArea__"+E+'" style="display: inline;"></span><span id="headervalue_'+E+'" style="display: inline-block;"></span><span id="headertextarea_'+E+'"></span></td></tr></table>';A.open(),A.write(T),A.close();var S=A.getElementById("tab").firstChild.firstChild.childNodes[0],L=getObj(I).parentNode;L.removeChild(getObj(I)),L.appendChild(S.cloneNode(!0));var _="<table id='tab1'><tr><td id=\"headerlabel_"+E+'"  class="bcDropDownTd alignleft pR" width="120" name="fieldlabel" onclick= "moduleFields(\''+escape(n)+"',"+a+",'"+i+"','True','True');\" onmouseover=\"summaryEditMouseOver('"+escape(E)+"',"+a+",'"+i+'\',\'True\');" onmouseout="hide(\'summaryfield\');" onclick="sE(event);"><span class="bcDropDownIcon fL">'+$ESAPI.encoder().encodeForHTML(t)+"</span></td></tr></table>";A.open(),A.write(_),A.close();var O="headerlabel_"+r,M=A.getElementById("tab1").firstChild.firstChild.childNodes[0],P=getObj(O).parentNode;$("#textbox_fieldlabels").select2("close"),$(getObj(O)).empty(),P.removeChild(getObj(O)),$(M).removeClass("alignleft").addClass("labelTab"),$(M).find("span").removeClass("fL"),P.insertBefore(M.cloneNode(!0),P.firstChild);var k="value_"+E,R=$("#"+("headervalue_"+E)),D=$("#mouseArea__"+E).data("params");detailView.changedBCJson.BCViewObject[detailView.BCkeyVsArrayIndex[r]]=D,detailView.BCkeyVsArrayIndex[E]=detailView.BCkeyVsArrayIndex[r],delete detailView.BCkeyVsArrayIndex[r],$(R[0]).empty(),R[0].innerHTML=$("[id='"+k+"']").html(),$(R[0]).closest("td").addClass("labelVal").attr({onclick:"triggerClickEvent(event)","data-uitypesele":D.uitype}),$(R[0]).closest("td").find("span:first").css("padding","0");var U=$("#changeOwnerIco");""===R.html().trim()&&R.addClass("forceHyphen"),"8"==D.uitype&&0===R.find("#changeOwnerIco").length&&U.length>0&&R.after(U.clone()),R.addClass("busniess_card_Hover"),"true"==D.readonly&&R.addClass("lockIconBC"),"LAYOUTID"==D.colname&&returnJson.layout_jsonarrayObj.showLayoutOption&&R.removeClass("lockIconBC");for(var F=0;F<f;F++)d[F]==p&&(d[F]=n);jsonFields.CurrentFields=d,$(".newBusinessCardView").removeClass("bCLeftPanelEditOpen"),itsonedit="false",crmLookupBusinessCard.result=null}function summaryEditMouseOver(e,t,a,i){$(".kv_detailview").outerWidth();if("false"==i||"true"==itsonedit||Crm.userDetails.CLIENT_ACCOUNT)return!1;var r;r="headerlabel_"+(e=unescape(e)),show("summaryfield");var l=getObj("summaryfield"),n=$(getObj(r)),s=n.find("span.bcDropDownIcon"),o=$("#detailViewButtonLayerDiv"),d=$(".kanbanTaskDetailContainer"),c=";",m=o.outerHeight(),u=document.getElementById("iskanbanview");u&&"true"===u.value?(c=s.offset().top-52,1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&(c=s.offset().top-52-m)):c=s.offset().top-2,o.length&&$("#DetailViewInnerTabs").length&&1==Crm.userDetails.detailView_newUI&&("undefined"!=typeof CrmPlusImpl&&CrmPlusImpl.isLoadedInCrmplus()?c-=m:c-=m+50);var p=s.offset().left;if($(l).off("click").click((function(){moduleFields.apply(moduleFields,[e,t,a,i])})),Crm.userDetails.RTL_ENABLED)l.style.left=p+10+"px";else if(n.find("span").hasClass("bcDropDownIcon")){if(u&&"true"===u.value){var g=s.position().left+$("#"+r).find("span.bcDropDownIcon").width();v=g+65;if(1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI)v=g+65}else{var v=s.offset().left+$("#"+r).find("span.bcDropDownIcon").width()+21;if(1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI)var v=s.offset().left+$("#"+r).find("span.bcDropDownIcon").width()+18}l.style.left=v+"px",d.length&&(l.style.left=v-15+"px")}else l.style.left=p+s.offsetWidth-22+"px";l.style.top=c+16+"px";var f=$(".bCardHover");if("yes bCardHover"!=f.attr("class")&&"no-new bCardHover"!=f.attr("class")){var h=$("#"+r).next("td");0==h.find(".busniess_card_Hover").hasClass("lockIconBC")&&""==h.find(".bCardHover").html()?h.find(".bCardHover").addClass("bCardHoverLeft"):0==h.find(".busniess_card_Hover").hasClass("lockIconBC")&&""==h.find(".bCardHover>span").html()&&h.find(".bCardHover>span").addClass("bCardHoverLeft"),0==h.find(".busniess_card_Hover").hasClass("lockIconBC")&&""==h.find(".bCardHover>pre").html()&&h.find(".bCardHover>pre").addClass("bCardHoverLeft"),0==h.find(".busniess_card_Hover").hasClass("lockIconBC")&&""==h.find(".bCardHover .link").html()?h.find(".bCardHover .link").addClass("bCardHoverLeft"):$(".lockIconBC").css("position","relative")}}function clearSummaryEdit(e,t,a){var i=(e=unescape(e)).replace(/\./g,"___").replace(/\(/g,"____").replace(/\)/g,"_____"),r=getObj("historyFrame"),l=null;r.contentDocument?l=r.contentDocument:r.contentWindow&&(l=r.contentWindow.document);var n=getObj("textbox_fieldlabels"),s=n[n.selectedIndex].text,o="<table id='tab1'><tr><td id=\"headerlabel_"+i+'"  class="bcDropDownTd alignleft pR" width="120" name="fieldlabel" onclick= "moduleFields(\''+escape(e)+"',"+t+",'"+a+"','True','True');\" onmouseover=\"summaryEditMouseOver('"+escape(i)+"',"+t+",'"+a+'\',\'True\');" onmouseout="hide(\'summaryfield\');" onclick="sE(event);"><span class="bcDropDownIcon fL">'+revertSplChrs(s)+"</span></td></tr></table>";l.open(),l.write(o),l.close();var d="headerlabel_"+i,c=l.getElementById("tab1").firstChild.firstChild.childNodes[0];$(c).removeClass("alignleft").addClass("labelTab"),$(c).find("span").removeClass("fL");var m=getObj(d).parentNode;m.removeChild(getObj(d)),m.insertBefore(c.cloneNode(!0),m.firstChild),itsonedit="false"}function setDivWidthHeight(e){document.body.clientWidth;getObj(e).style.top="0px",getObj(e).style.width="850px",navigator.appName.indexOf("Internet Explorer"),getObj(e).style.height="550px"}function reloadRelatedList(e){var t="false";if(0!=$("[name='rlContentChngd']").length&&(t=$("[name='rlContentChngd']").val()),"false"==t&&null==e)hideAnimatePopup("topBandPopup",!0);else{var a=$("[name='module']").val();a||(a=detailView.currentModule);var i=$("[name='id']").val(),r=$("[name='cvid']").val();hideAnimatePopup("topBandPopup",!0),loadRelatedListNew(Crm.getCrmBasePath()+"/NewRelatedList.do?action=getAllData&module="+a+"&id="+i+"&cvid="+r+"&updateLeftPanel=true",onCompleteFnRl,onSuccessFnRl,a,i)}removeFreezeLayer()}function showDefaultRelatedList(){var e=$("[name='module']").val();e||(e=detailView.currentModule);var t=$("[name='id']").val(),a=Crm.getCrmBasePath()+"/CustomizePage.do?module="+e+"&entityid="+t+"&from=frmCustomRL";mR(a,(function(e){$("#topBandPopup").html(e)}))}function validateSplCharInNameFields(e){for(var t=new Array("`","~","!","#","^","*","[","]","{","}","|","\\",'"',";","'","&","+","%","(",")","@","?",":","<",">",":",".",",","$","=","/","-","_"),a=t.length,i=0;i<a;i++)if(e.indexOf(t[i])>=0)return!0;return!1}function validateWhiteSpace(e){return e.indexOf(" ")>=0}function validateIsNumberAsFirstChar(e){for(var t=new Array("0","1","2","3","4","5","6","7","8","9"),a=t.length,i=0;i<a;i++)if(e.charAt(0)==t[i])return!0;return!1}function validateForForeignLanguage(e){return!new RegExp("^[a-zA-Z0-9_]*$").test(e)}function showMyRelatedListDiv(e,t){var a=getObj("pageNum_"+e).value,i=getObj("totalPageCount_"+e).value;if("prev"==t){var r=e+"_"+(a-2),l=e+"_"+(a-1);getObj(r).style.display="",getObj(l).style.display="none";var n=parseInt(a)-1;$("#"+e+"_from").html($("#"+e+"_from").html()-10),$("#"+e+"_to").html($("#"+e+"_to").html()-10)}else if("next"==t){r=e+"_"+(a-1),l=e+"_"+a;$("#"+r).hide(),getObj(l).style.display="";n=parseInt(a)+1;$("#"+e+"_from").html(10*a+1),$("#"+e+"_to").html(parseInt($("#"+e+"_from").html())+9)}if(getObj("pageNum_"+e).value=n,n>1){var s=e+"_prev",o=e+"_prevDisabled";getObj(s).style.display="",getObj(o).style.display="none";var d=e+"_next",c=e+"_nextDisabled";getObj(d).style.display="",getObj(c).style.display="none"}if(n<=1){s=e+"_prev",o=e+"_prevDisabled";getObj(s).style.display="none",getObj(o).style.display="";d=e+"_next",c=e+"_nextDisabled";getObj(d).style.display="",getObj(c).style.display="none"}if(n>=i){d=e+"_next",c=e+"_nextDisabled";getObj(d).style.display="none",getObj(c).style.display=""}}function validateRLColumnSelection(e){$("[id^='cb']:checked").length>7&&(renderingUtils.showCustomAlert(I18n.getMsg("crm.newrelatedlist.selectedColumn.exceeded")),$(e).prop("checked",!1))}var AjaxAPI=function(e){for(var t in e)this[t]=e[t]};function ajaxSuccessCallBack(e,t,a){e?!a&&$("#"+e)[0]&&($("#"+e).empty(),document.getElementById(e).innerHTML=t,JSEvalScript(document.getElementById(e))):"Success"!=t?($("#failureMsgEditTab").empty(),document.getElementById("failureMsgEditTab").innerHTML=t,$("#errMsgId").fadeIn().delay(2e3).fadeOut("slow"),document.getElementById("submitBtn").style.display="inline-block",document.getElementById("busyBtn").style.display="none"):(changeLocal(tabName,singularName,tabId),cancelfun())}function isElementVisible(e){var t=$(window),a=$(e),i=t.scrollTop(),r=i+t.height(),l=a.offset().top;return l+a.height()<=r&&l>=i}function setRelatedListScroll(){var e=$(".innerScrollCtn");e.length>0&&e.height($("#newRelatedListPopUpDiv").height()-(e.position().top+100))}function setDelugeWtHt(){$("#newRelatedListPopUpDiv").css({width:"1000px",height:"650px"})}function getUIFormatData(e,t,a,i,r,l){var n="subvalue_"+a,s=$("#"+n);if(validationUtils.isJsonCheck(e)?36==t||143==t||145==t||144==t?e.actualValue=$ESAPI.encoder().encodeForHTML(e.actualValue.toString()):e.defaultvalue=$ESAPI.encoder().encodeForHTML(e.defaultvalue.toString()):24!=t&&202!=t&&333!=t&&786!=t&&14!=t&&301!=t&&(e=$ESAPI.encoder().encodeForHTML(e.toString())),!e&&s.length>0){if(s.empty(),36==t||143==t||145==t||144==t){var o={defaultvalue:"",plainValue:""};detailView.replaceDataParams(a,o)}else if(4==t||6==t||7==t||9==t||10==t||12==t||13==t||15==t||5==t||133==t){o={defaultvalue:"",defaultid:""};detailView.replaceDataParams(a,o)}else detailView.replaceDataParams(a,"");return s.outerHTML()}if(25==t)return detailView.replaceDataParams(a,e+""),'<a class="link" href="mailto:'+e+'" id="'+n+'">'+e+"</a>";if(300!=t&&301!=t){if(21==t){var d="http",c=0!=e.toLowerCase().indexOf(d)?"http://"+e:e;return detailView.replaceDataParams(a,e+""),'<a class="link" href="'+c+'" target="_blank" rel="noopener noreferrer" id="'+n+'">'+e+"</a>"}if("en_GB"!=Crm.userDetails.COUNTRY_LOCALE&&"en_US"!=Crm.userDetails.COUNTRY_LOCALE||24!=t&&202!=t||""==e){if(786==t||14==t||333==t){var m=e.split(" "),u=m[1].split(":"),p=parseInt(u[0]),g=u[1];"HH:mm"!==Crm.userDetails.TIME_FORMAT&&m.length>2&&(p=Utils.convertTimeTo24HoursFormat(p,m[2].toUpperCase()));var v=Utils.getDateObject(m[0],{hrs:p,mins:g});detailView.replaceDataParams(a,v+"");A=v&&""!==v?Utils.getDateTimeInUserFormat(v,!0):"";return s.html(A),s.outerHTML()}if(33==t){var f=replace4Skype(e),h="";f=0==f.indexOf("+")?f.substring(1):f,s.html(e);var b=!1;return i.params.iscallallowed&&(b=!0),"true"!==b&&!0!==b||!f||(h="<a class='pH2 fL phoneRtl' title='"+I18n.getMsg("crm.phoneNo.Link.Title")+"' href='skype:+"+f+"?call' id='zti_"+n+"'></a>"),detailView.replaceDataParams(a,e+""),h+s.outerHTML()}if(36==t||143==t||145==t||144==t&&e){s.html(e.outputValue+"");var C=getObj("actualValue_"+a);C&&(C.value=e.actualValue);o={defaultvalue:e.actualValue,plainValue:e.actualValue};return detailView.replaceDataParams(a,o),s.outerHTML()}if(4==t||6==t||7==t||9==t||10==t||12==t||13==t||15==t||5==t||133==t){var y=i.params.lookupmodule,I="<a class='link' id='"+n+"' onclick=\"Crm.trackSpotLightAction('Lookup Click',{'Module':'"+y+'\'});" onmouseenter="crmLookupBusinessCard.showLookupDetails(this)" onmouseout="crmui.hideTooltip()" data-zcqa=\'detailView\' data-cid=\'detailView\' data-params=\'{"module":"'+y+'","id":"'+e.defaultid+'"}\' href="Crm.getCrmBasePath()/EntityInfo.do?module='+y+"&amp;id="+e.defaultid+'">'+e.defaultvalue+"</a>";if(detailView.replaceDataParams(a,e),4==t&&(getElemById("accountId")&&getElemById("accountName")&&(getElemById("accountId").value=e.defaultid,getElemById("accountName").value=e.defaultvalue),"SalesOrders"!==r&&"Invoices"!==r&&"Quotes"!==r||detailView.loadRelatedDetails(r,l,"Accounts"),"Contacts"===r)){var w=$("#value_REPORTINGTOCONTACTID");w.length>0&&(w.empty(),getObj("value_REPORTINGTOCONTACTID").innerHTML=""),$("#headervalue_REPORTINGTOCONTACTID").html("")}return I}return s.length>0?(s.html(e+""),detailView.replaceDataParams(a,e+""),s.outerHTML()):(detailView.replaceDataParams(a,e+""),e+"")}var A=Utils.getDateInUsrViewFormat(e);return s.html(A),detailView.replaceDataParams(a,crmCalendar.getDateObjectFromGivenDateString(e)+""),s.outerHTML()}var E="yes_"+a,T="no_"+a,S="",L="";1==e?(S=$("#"+E),L=$("#"+T)):(S=$("#"+T),L=$("#"+E)),S.show(),L.hide(),detailView.replaceDataParams(a,e+"")}function getFormattedDate(e){if(!e)return"";if(e.indexOf("/")>-1)var t=e.split("/");else if(e.indexOf("-")>-1)t=e.split("-");else if(e.indexOf(".")>-1)t=e.split(".");var a=Crm.userDetails.DATE_PATTERN.toLowerCase(),i=null;if("mm/dd/yyyy"===a||"mm.dd.yyyy"===a||"mm-dd-yyyy"===a)i=e;else if("dd/mm/yyyy"===a||"dd.mm.yyyy"===a||"dd-mm-yyyy"===a)i=t[1]+"/"+t[0]+"/"+t[2];else if("yyyy/mm/dd"===a||"yyyy-mm-dd"===a||"yyyy. mm. dd"===a||"yyyy.mm.dd."===a)i=t[1]+"/"+t[2]+"/"+t[0];else if("zh_HK"===Crm.userDetails.COUNTRY_LOCALE){var r=(a=a.replace(/'/g,"")).replace(/mm/i,"(\\d{1,2})");r=(r=r.replace(/dd/i,"\\d{1,2}")).replace(/yyyy/i,"\\d{4}");var l=new RegExp(r).exec(e),n=l[1];n=n.length<2?"0"+n:n;var s=a.replace(/yyyy/i,"(\\d{4})");s=(s=s.replace(/dd/i,"\\d{1,2}")).replace(/mm/i,"\\d{1,2}");var o=(l=new RegExp(s).exec(e))[1],d=a.replace(/dd/i,"(\\d{1,2})");d=(d=d.replace(/mm/i,"\\d{1,2}")).replace(/yyyy/i,"\\d{4}");var c=(l=new RegExp(d).exec(e))[1];i=n+"/"+(c=c.length<2?"0"+c:c)+"/"+o}null!=i&&(i=new Date(i));var m=new Date;if($.datepicker.formatDate("yyyy",m)===$.datepicker.formatDate("yyyy",i))var u=$.datepicker.formatDate("M dd",i);else u=$.datepicker.formatDate("M dd, yy",i);return u}function loadRelatedListNew(e,t,a,i,r,l){i||(i=detailView.currentModule);for(var n=returnJson.relListLabelsJson.relListLabelJson.length,s=[],o=0;o<n;o++)s[o]=returnJson.relListLabelsJson.relListLabelJson[o].name.toLowerCase()+"_"+returnJson.relListLabelsJson.relListLabelJson[o].id;crmRelatedList.personalityArr=s.join("||");var d=Handlebars.templates.RelatedList(returnJson.relListLabelsJson);$("#relatedPageContent").html(d);(new crmRequestPool).initiate({action:e,type:"GET",data:{fromIndex:1},complete:function(){t(l)},success:function(e){a(e),crmRelatedList.load(i,r,e,!1)}})}function onCompleteFnRl(e){null==getObj("nav")&&showDrillDownPtr(e)}function onSuccessFnRl(e){ajaxSuccessCallBack("relatedPageContent",e,returnJson?returnJson.relListLabelsJson:void 0)}function bindEventListView(){if(null!=document.getElementById("listViewTable"))for(var e=document.getElementById("listViewTable").getElementsByTagName("tr"),t=e.length,a=1;a<t;a++)$(e[a]).mouseover(dropRofn(this,this.id)),$(e[a]).mouseout(dropRoutfn(this,this.id))}function buildTabGroup(){var e=[];$("#tabGroupList input[type='checkbox']:checked").each((function(t,a){e.push($(a).val())})),e=e.join(";"),getObj("selectedTabsList").value=e;var t=document.getElementById("profileIds").value;if(""!=t){for(var a=t.split(","),i="",r=0;r<a.length;r++){var l=a[r]+"_visible";a[r];1==getObj(l).checked&&(i=""==i?""+getObj(l).value:i+";"+getObj(l).value)}getObj("visibleProfileList").value=i}}function changeShowCacheObj(e,t){if("Leads"==e||"Contacts"==e||"Accounts"==e||"Potentials"==e){var a="tab_"+e;if(showCacheObj.hasOwnProperty(a)){var i=document.getElementById("idForCV");i.parentNode.removeChild(i);var r=document.createElement("div");r.id="dummydivtagid",r.style.display="none",r.innerHTML=showCacheObj[a],document.body.appendChild(r),$("#idForCV").empty(),document.getElementById("idForCV").innerHTML=t;var l=document.getElementById("dummydivtagid").innerHTML;$("#lvTred tr").length?(setDataFetchDate(),showCacheObj[a]=l):clearShowCacheObj(a),document.getElementById("dummydivtagid").parentNode.removeChild(document.getElementById("dummydivtagid")),$("#show").empty(),getObj("show").innerHTML=l,EvalInnerScript(getObj("show"))}else divObj=getObj("idForCV"),$(divObj).empty(),divObj.innerHTML=t,EvalInnerScript(getObj("idForCV"))}}function openWarningMessage(e,t,a){if(getObj("deleteTabName").value=t,"deleteTabGroup"==e)hideMenu(),showDeletePopup(I18n.getMsg("crm.tabgroup.deleteWarning"),"crm.button.delete","","",a),$("#freezeBackGround").css("z-index","249");else{if(freezeBackground(),"deActivateCreator"==e)var i="CreatorDeactivationWarningDiv";else if("deleteCreatorTab"==e)i="CreatorDeleteCreatorWarningDiv";else if("creatorEditForm"==e)i="CreatorFormEditWarningDiv";else if("createCreatorAcc"==e)i="CreateCreatorAccWarningDiv";getObj(i).style.display="block",getObj(i).style.zIndex=10001,"deActivateCreator"!=e&&"deleteCreatorTab"!=e&&"createCreatorAcc"!=e||mailsetCenter(i)}}function isFieldValueValid(e,t,a,i,r,l){var n=!1,s=null,o="";if(1===e||11===e||2===e||26===e||21===e||33===e||34===e||35===e||37===e||25===e||24===e||202===e||32===e||36===e||38===e||144===e||143===e||145===e||52===e){var d="txt_"+e,c=getObj(d);o=c.value;var m=t.split("~");if(o>101&&"PROBABILITY"==a&&"CrmPotential"==i&&(n=!0,s=I18n.getMsg("crm.create.pbty.check"),c.focus()),(24==e||202==e)&&o&&""!=o&&0==o.trim().length||(2==e||26==e)&&"M"==m[1]&&"-None-"==o){var u=decodeURIComponent(r).replace(/_____/g,")").replace(/____/g,"(").replace(/___/g,"."),p=24==e||202==e?"crm.field.valid.check":"crm.field.empty.check",g=I18n.getValueForFields(p,u);return renderingUtils.displayAlert(d,void 0,g,c,"inline"),!1}2==e&&"M"!==m[1]&&"-None-"==o&&(o=null),"PIPELINE"==a&&"CrmPotential"==i&&c.value.includes("||")&&(o=c.value.split("||")[1])}else if(5==e||"CAMPAIGNID"===a&&"CrmPotential"===i){var v="property(campName:"+decodeURIComponent(r)+")";o=getObj(v).value}else if(100==e||96==e){var f=$("input[name='multiselect_option']:checked").val();""!=(o=$("#txt_"+e).val().join(";"))&&o.endsWith(";")&&(o=o.substring(0,o.length-1)),""==o&&(n=!0,s=I18n.getMsg("crm.alert.picklist.empty.message"))}else if(300==e||301==e)o=getObj("txt_"+e).checked;else if(208==e)o=getObj("txt_"+e).value;else if(786==e||14==e||333==e){var h="txt_"+e,b="txt_"+e+"hour",C="txt_"+e+"minute";if("HH:mm"!=Crm.userDetails.TIME_FORMAT){var y="txt_"+e+"ampm";o=document.getElementById(h).value.trim()+" "+document.getElementById(b).value.trim()+":"+document.getElementById(C).value.trim()+" "+document.getElementById(y).value.trim()}else o=document.getElementById(h).value.trim()+" "+document.getElementById(b).value.trim()+":"+document.getElementById(C).value.trim()}return n?(l.html(s),l.show(),!1):[o,f]}function apiDateFormat(e){if(!e)return"";var t=CrmDateUtils.getDateObjectFromString(e);return"Invalid Date"==t?"":CrmDateUtils.getFormattedDate(t)}function apiDateTimeFormat(e){var t=e.indexOf(":"),a=e.substring(0,t-3),i=e.substring(t-2,e.length).trim(),r=apiDateFormat(a);if(!r)return"";var l=r+"T";return"hh:mm a"===Crm.userDetails.TIME_FORMAT&&(i=Utils.convertTimeValueTo24HourFormat(i)),l+(i.split(" ")[0]+":00")}function getPLStyleObj(e){var t;null!==e&&(t="background-color:"+e+";color:"+getPickListFontColor(e),"#ffffff"===e&&(t+=";border: 1px solid #C9C9C9"));return t}function updateColorCodeForSelObj(e){var t=e.data(),a=e.children("option:selected").eq(0),i=a.attr("data-colorcode")?a.attr("data-colorcode"):"";if(26===t.uitype&&""===i){var r=t.values.filter((function(e){return e.value===a.val()}))[0];i=r?r.colorCode:""}var l="selectColorComponent",n=void 0!==e.data("subformsectionlabel"),s=n?e.data("zcqa"):"crmajax_colorcode_"+e.data("fieldid");l=n?l+"-"+e.attr("id"):l+"-"+e.data("fieldid"),e.data("colorcode",i);var o=e.parent().parent();(o.addClass("colorEnabledPicklist"),o.find("#"+l).remove(),a.val()&&"-None-"!==a.val())?(o.removeClass("colorEnabledPKNone"),$('<span class="dIB activitesColor" data-zcqa="'+s+'" id="'+l+'" style="background:'+i+'"></span>').insertBefore(e)):o.addClass("colorEnabledPKNone")}function getPKcolorAppliedVal(e,t,a){return null===e||"-None-"===e?e:'<span class="colorAppliedPicklist" data-zcqa="colorcode_'+("colorcode_span_-"+e)+'"  style="'+getPicklistStyleObj(e,t,a)+'">'+e+"</span>"}function getPicklistStyleObj(e,t,a){return getPLStyleObj(getPickListColorCode(e,t,a))}function getPickListColorCode(e,t,a){if(e){void 0!==e.html&&(e=e.html);for(var i=t.length,r=0;r<i;r++)if(a&&(e===t[r].name||e===t[r].html||e===t[r].content)||e===t[r].display_value||e===t[r].DisplayValue||e===t[r].uservalue)return t[r].colour_code?t[r].colour_code:t[r].colorCode;if(""!==e.trim())return"#ffffff"}}function getPickListFontColor(e){if(e&&""!==e&&0===e.indexOf("#")&&(e=e.substring(1),(299*parseInt(e.substr(0,2),16)+587*parseInt(e.substr(2,2),16)+114*parseInt(e.substr(4,2),16))/1e3<155))return"white";return"black"}function isColorCodeEnabled(e,t){var a=store.peekAll("field").filterBy({api_name:e}).filter((function(e){if(e.module&&e.module[0].module_name===t)return e}));return!(!a[0]||!0!==a[0].enable_colour_code)}function viewUserinAjax(e,t){if(loadAjaxTab(""),http){var a="";a=null!=t?t+"&ajaxload=true":"ajaxload=true",http.open("POST",e,!0),http.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),http.setRequestHeader("X-Requested-With","XMLHttpRequest"),http.onreadystatechange=function(){if(4==http.readyState){if(http.status==crmConstants.errorStatusCode)return void renderingUtils.displayPermissionDenied(http);var e=http.responseText;$("#result").empty();var t=document.getElementById("result");t.innerHTML=e;var a=document.getElementById("userCountryLocale");a&&(a.value=getObj("userCntLocTxt").value),commonUtils.showHideLoadingDiv(),JSEvalScript(t)}},http.send(a)}}function userValidate(e,t,a,i,r){(i=i?$(i):$(document.addUserForm)).find(".form_err_msg").remove(),i.find(".form_err_fld").removeClass("form_err_fld");var l=i.attr("name"),n=!0;if("true"==e.value&&"upgrade2Org"==t.value&&!emptyCheck("j_organization","Company Name",void 0,"addUserForm","inline"))return!1;0!=$("#fN").find(".wf_requiredMark").length&&(emptyCheck("firstName","First Name",void 0,l,"inline")||(n=!1)),0!=$("#lN").find(".wf_requiredMark").length&&(emptyCheck("lastName","Last Name",void 0,l,"inline")||(n=!1)),old_splCharArray=splCharArray,splCharArray=new Array("`","~","!","#","^","*","[","]","{","}","|","\\",'"',";","$");var s=getObjFromPopup("lastName",i);s&&!splCharCheck(s.value)&&(n=!1,renderingUtils.displayErrorDiv("lastName","Last Name","crm.alert.label.special.characters",s));var o=getObjFromPopup("firstName",i);o&&!splCharCheck(o.value)&&(n=!1,renderingUtils.displayErrorDiv("firstName","First Name","crm.alert.label.special.characters",o)),splCharArray=old_splCharArray,"addUserForm"===l&&(getObjFromPopup("roleName",i)&&!emptyCheck("roleName","Role Name",void 0,l,"inline")&&(n=!1),getObjFromPopup("roleName_Add",i)&&!emptyCheck("roleName_Add","Role Name",void 0,l,"inline")&&(n=!1),"Edit"==a.value||emptyCheck("j_username","crm.label.email.address",void 0,"addUserForm","inline")&&emailValidate("j_username","crm.label.email.address",void 0,"addUserForm","inline")||(n=!1));isContainsPipeSymbol({alias:"Alias",phone:"Phone",mobile:"Mobile",fax:"Fax",street:"Street",city:"City",state:"State",zip:"Zip",country:"Country"},void 0,"inline")&&(n=!1);var d=document.getElementById("submitbutton"),c=$("#submitbutton");return d&&(c.empty(),d.innerHTML="<img src='"+networkUtils.getImageUrl("zoho-busy_36265df_.gif",ResourceConstants.CRM)+"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>"),!!n}function newUserForm(e){return e=e||document.addUserForm,userValidate(getObj("ispersonal"),getObjFromPopup("actionName",$(e)),getObjFromPopup("screenMode",$(e)),e,getObj("struts_action"))}function cancelEditing(e,t){var a="";a="viewAllUsers"==e?Crm.getCrmBasePath()+"/Security.do?actionName=viewAllUsers&loadfullpage=true":Crm.getCrmBasePath()+"/Security.do?actionName=viewUser&userId="+t,loadUrl("result",a)}function setDataFetchDate(e,t){var a=Crm.userDetails.LOCALE,i=new Date;null!=t&&i.setTime(t);var r=i.getYear();r<1e3&&(r+=1900);var l=i.getDay(),n=i.getMonth(),s=i.getDate();s<10&&(s="0"+s);var o=new Array("Sun","Mon","Tue","Wed","Thu","Fri","Sat"),d=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"),c=o[l]+", "+s+" "+d[n]+", "+r,m=i.getHours(),u=i.getMinutes(),p=i.getSeconds(),g=document.getElementById("datafetchdate"),v="",f=$("#datafetchdate");if("HH:mm"!==Crm.userDetails.TIME_FORMAT?(0==m&&(m=12),v=(m>12?m-12:m)+":"+(u<10?"0":"")+u+":"+(p<10?"0":"")+p+" "+(m>=12?"PM":"AM")):v=m+":"+(u<10?"0":"")+u+":"+(p<10?"0":"")+p,g||getObj("showHome")||getObj("dashboardItems"))if(-1!=a.indexOf("ja")||-1!=a.indexOf("zh")){if((n+=1)<10&&(n="0"+n),c=-1!=a.indexOf("ja")?r+"/"+n+"/"+s:n+"/"+s+"/"+r,"HH:mm"!==Crm.userDetails.TIME_FORMAT){var h=I18n.getMsg("AM"),b=I18n.getMsg("PM");v=(m>12?m-12:m)+":"+(u<10?"0":"")+u+":"+(p<10?"0":"")+p+" "+(m>=12?b:h)}else v=(m>12?m-12:m)+":"+(u<10?"0":"")+u+":"+(p<10?"0":"")+p;if(e&&(getObj("showHome")||getObj("dashboardItems")))e.setAttribute("onmouseover","newshowtt('"+I18n.getMsg("crm.cv.datafetch.message")+" : "+c+", "+v+"',true)"),e.setAttribute("onmouseout","newhidett()");else if(f.empty(),g.innerHTML=c+" "+v,getObj("fetch_msg"))C=(C=getObj("fetch_msg").innerHTML).replace("&nbsp;"," "),getObj("fetchdate_title").title=C+c+" "+v}else{var C;if(e&&(getObj("showHome")||getObj("dashboardItems")))e.setAttribute("onmouseover","newshowtt('"+I18n.getMsg("crm.cv.datafetch.message")+" : "+c+", "+v+"',true)"),e.setAttribute("onmouseout","newhidett()");else if(f.empty(),g.innerHTML=c+", "+v,getObj("fetch_msg"))C=(C=getObj("fetch_msg").innerHTML).replace("&nbsp;"," "),getObj("fetchdate_title").title=C+c+", "+v}}function RefreshDetailsAction(e,t){parseInt($("input[name=fromIndex]").val()),$("input[name=searchletter]").val(),crmHistory.getState(),moduleRecordMapping[e].cvid;$("#cvid").length>0&&"null"!==$("#cvid")[0].value&&$("#cvid")[0].value,crmTab.deleteFromCache(e);var a=Lyte.Router.getRouteInstance().transition.info.route.split(".")[2];"Forecasts"===a.charAt(0).toUpperCase()+a.slice(1)&&1!=Crm.userDetails.TMENABLED&&Crm.userDetails.isUserHierarchy?$("input[type=checkbox]").each((function(){$(this).prop("checked",!1)})):Lyte.Router.getRouteInstance().refresh()}function decideGetHtml(e){var t=getActionTypeFromUrl(e),a=objectUtils.URL(e).getParams().module;return-1==e.indexOf("/ShowEntityInfo.do")&&-1==e.indexOf("/Edit.do")&&-1==e.indexOf("/Create.do")&&-1==e.indexOf("/Clone.do")||PAGE_CACHE[a]&&PAGE_CACHE[a][t]&&(e=e+"&html=false&pcVersion="+PAGE_CACHE[a][t].PC_VERSION),e}function checkForGTaskList(e,t,a){freezeBackground(),loadAjaxTab("");var i=$("#lookupdiv"),r=Crm.getCrmBasePath()+"/GApps.do?mode=CheckGTask&"+csrfParamName+"="+encodeURIComponent(csrfToken);return mR(r,(function(e){if(commonUtils.showHideLoadingDiv(),"true"==e)removeFreezeLayer(),Crm.requestParam.ActionType="AddToZG",Crm.saveEntity(a,t,(function(e,t){t&&$("#ajax_load_tab").is(":visible")&&$("#show").html(e)}));else{document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop;i.css({display:"block","z-index":"30",width:"650px",position:"absolute"}),i.html(e),mailsetCenter("lookupdiv")}})),!1}function validateGTasks(){var e=getObj("gTaskList").value.trim(),t=getObj("errorMsg").value.trim(),a=$("#lookupdiv");if(!e||e.length<=0)return alert(t),!1;var i=Crm.getCrmBasePath()+"/GApps.do?mode=saveDefaultGTask&gTaskList="+e,r=csrfParamName+"="+encodeURIComponent(csrfToken);mR(i,(function(e){removeFreezeLayer(),getObj("isListView")?addCrmTaskIdsToGTask(taskArr):viewEntityInfo("Create&AddToZG","Tasks"),a.html(""),a.hide()}),r)}function cancelfun(e){var t=void 0===e?getObj("module").value:e;if(getObj("oldEntityId")){var a=Crm.getCrmBasePath()+"/ShowEntityInfo.do?module="+t+"&id="+getObj("oldEntityId").value+"&cvid="+getObj("cvid").value+"&recordNum="+getObj("recordNum").value;return ajaxNew(a),!1}getObj("pfrom")&&"gsearch"==getObj("pfrom").value?backToSearchResult():window.history.back()}function settotalnoofrows(){getObj("rowCount")&&(rowCnt=getObj("rowCount").value);var e=getObj("module").value;Crm.isInventoryModule(e)&&(getObj("totalProductCount").value=rowCnt)}function setProbability(e,t){var a=$(t);if(t)var i=a.closest("form")[0].name;else i=$("[name^=createEntityForm]")[0].name;selectedText=e.substring(e.indexOf(":")+1,e.length),e.indexOf(":")>-1&&(e=e.substring(0,e.indexOf(":")));var r=document[i].elements["property(Probability)"];if(null!=r&&(r.value=e),a.data()&&a.data("colorcode_enabled")){var l="selectColorComponent-"+a.data("fieldid"),n=a.children("option:selected").eq(0),s=n.attr("data-colorcode")?n.attr("data-colorcode"):"",o=a.parent().parent();if(o.addClass("colorEnabledPicklist"),$("#"+l).remove(),"-None-"===n.val()||""===n.val())o.addClass("colorEnabledPKNone");else o.removeClass("colorEnabledPKNone"),$('<span class="dIB activitesColor" data-zcqa="validationaction_colorcode_'+a.data("fieldid")+'" id="'+l+'" style="background:'+$ESAPI.encoder().encodeForHTMLAttribute(s)+'"></span>').insertBefore(a)}}function lookUp(e,t,a,i){if(i)var r=i.target,l=$(r).closest("form")[0].name;else l=void 0;var n=getElm(l,"modsel"),s=n.options[n.options.selectedIndex].value;if(Crm.userDetails.isLookupAdvancedSearchEnabled&&"ownername"!=s){var o=networkUtils.returnDependencyFiles(["crm-entity-lookup.js"],crmConstants.jsStaticPathForLyte);o=o.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Lookup")],crmConstants.jsStaticPath));var d=[];Crm.userDetails.RTL_ENABLED&&(d=networkUtils.returnDependencyFiles(["crm-entity-lookup-rtl.css"],crmConstants.cssStaticPathForLyte));var c=o.concat(d);Lyte.injectResources(c,void 0,(function(){var e={};e.lookupModule=s,e.module=s,e.labelName="modname",e.searchModule=s,e.linkingmodule=void 0,e.parentModule="Calls",e.fieldid=$("#_modSel").data("fieldid").split("_")[1];var t=document.getElementById("lookupListPopup"),a=$("#modname");if(a.data("module",e.module),!t){var i=a.closest("div.labelValCreate"),r=document.createElement("crm-entity-lookup");r.component.setData("reqData",{}),i.append(r),t=document.getElementById("lookupListPopup")}var l=$("crm-entity-lookup")[0].component;l.layersAnalystAgent(l,!1,e,!1,!0)}))}else newShowLookUp("modname","modid",s,s,e,a,"leContModId",void 0,void 0,void 0,void 0,void 0,void 0,void 0,i)}function leContModLookUp(e,t,a,i){$("#quick_module").val(),$("#ctinotifier.taskpop").is(":visible");if(i)var r=i.target,l=$(r).closest("form")[0].name;else l=$("[name^=createEntityForm]")[0].name;var n=$("input[id*='leContModSel']"),s=document.getElementById("iskanbanview");if(s&&"true"===s.value){if(void 0===(o=n[0]))var o=$("[name='"+l+"'] [id='leContModSel']")[0]}else o=$("[name='"+l+"'] [id='leContModSel']")[0];var d,c="";if(getElm(l,"property(modsel)")&&"Accounts"==getElm(l,"property(modsel)").value&&null!=getElm(l,"property(modid)")&&(c="modid"),s&&"true"===s.value&&"hidden"===o.type&&(d=o.value),"select-one"==o.type?d=o.options[o.options.selectedIndex].value:"radio"==o.type&&(s&&"true"===s.value?void 0===(o=n)&&(o=document[l].elements["property(leContModSel)"]):o=document[l].elements["property(leContModSel)"],d=o[0].checked?o[0].value:o[1].value),Crm.userDetails.isLookupAdvancedSearchEnabled&&"ownername"!=d){var m=networkUtils.returnDependencyFiles(["crm-entity-lookup.js"],crmConstants.jsStaticPathForLyte);m=m.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Lookup")],crmConstants.jsStaticPath));var u=[];Crm.userDetails.RTL_ENABLED&&(u=networkUtils.returnDependencyFiles(["crm-entity-lookup-rtl.css"],crmConstants.cssStaticPathForLyte));var p=m.concat(u),g={};c&&(g.productFldId=c),g.lookupModule=d,g.labelName="leContModName",g.linkingmodule=void 0,g.parentModule="Calls",g.fieldid=$("#_modSel").data("fieldid").split("_")[1],Lyte.injectResources(p,void 0,(function(){"Leads"===d?(g.module="Leads",g.searchModule="Leads"):"Contacts"==d&&(g.module="Contacts",g.searchModule="Contacts");var e=$("#leContModName");e.data("module",g.module);var t=document.getElementById("lookupListPopup");if(!t){var a=e.closest("div.labelValCreate"),i=document.createElement("crm-entity-lookup");i.component.setData("reqData",{}),a.append(i),t=document.getElementById("lookupListPopup")}var r=$("crm-entity-lookup")[0].component;$("#qCreate").is(":visible"),Crm.isFromSalesInbox;r.layersAnalystAgent(r,!1,g,!1,!0)}))}else newShowLookUp("leContModName","leContModId",d,d,"",a,c,void 0,void 0,void 0,void 0,void 0,void 0,void 0,i),document[l].elements["property(module)"]&&(document[l].elements["property(module)"].value=d)}function showTaskType(e,t,a,i,r,l){if(Crm.userDetails.isLookupAdvancedSearchEnabled){var n=networkUtils.returnDependencyFiles(["crm-entity-lookup.js","crm-picklist-lookup.js"],crmConstants.jsStaticPathForLyte);n=n.concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("Lookup")],crmConstants.jsStaticPath));var s=[];Crm.userDetails.RTL_ENABLED&&(s=networkUtils.returnDependencyFiles(["crm-entity-lookup-rtl.css"],crmConstants.cssStaticPathForLyte));var o=n.concat(s);Lyte.injectResources(o,void 0,(function(){var a={};a.lookupModule=t,a.module=$('input[name="searchModule"]').val(),a.labelName=e,a.searchModule=t,a.linkingmodule=void 0,a.parentModule="Tasks";var i=$("#task_subject");a.fieldid=i.data("fieldid").split("_")[1];var r=document.getElementById("lookupListPopup");if(!r){var l=$("#leContModName"),n=l.length>0?l.closest("div.labelValCreate"):i.closest("div.labelValCreate"),s=document.createElement("crm-entity-lookup");s.component.setData("reqData",{}),n.append(s),r=document.getElementById("lookupListPopup")}var o=$("crm-entity-lookup")[0].component;o.layersAnalystAgent(o,!1,a,!1,!0)}))}else{var d=l.target,c=$(d).closest("form")[0].name,m=(getObj(e),Crm.getCrmBasePath()+"/Search.do?targetForm="+c+"&searchmodule="+t+"&fldName="+e+"&openInAdvSearch=false");commonUtils.openCustomLookup(m,void 0,"topBandPopup",renderingUtils.windowWidth-300)}}function populatePicklist(e,t,a){var i=$(e).data("mapval");if(i){if($(e).data("colorcode_enabled")){var r=[],l=$(e).data("picklistmap");void 0===l&&(l=$(e).data("mapval"));for(var n=i.length,s=0;s<n;s++){var o=getPickListColorCode(i[s],l);void 0!==i[s].html?(i[s].colorCode||(i[s].colorCode=o),r.push(i[s])):r.push({content:i[s],colorCode:o})}i=r}}else(i=$(e).data("picklistmap"))&&Crm.isValidJSON(i)||(i=$(e).data("values"));var d=i;if(t){var c=$(e).data("colorcode_enabled")&&i&&"Array"===i.constructor.name;"Object"===d[0].constructor.name?d=$(e).data("values"):c=!1;var m=[];const a=26===$(e).data("uitype");t=t.filter((function(e){if(a)return d.find((t=>e.value===t.value));var t=d.indexOf(e);return c&&-1!==t&&i.filter((function(t){return(t.uservalue===e||t.content===e||t.value===e)&&(m.push(t),!0)})),-1!==t})),i=t,m.length>0&&(i=m)}if(!$(e).hasClass("dataPopulated")){for(var u=[],p=0;p<$(e)[0].options.length;p++)$(e)[0].options[p].selected&&(u[p]=$(e)[0].options[p].value);$(e).empty();var g=$("<option></option>");for(s=0;s<i.length;s++){var v=g.clone(),f="";i[s].uservalue&&"-None-"!==i[s].uservalue?f=i[s].uservalue:!i[s].value&&0!=i[s].value||"-None-"===i[s].value?i[s].content&&"-None-"!=i[s].content?f=i[s].content:i[s].html&&"-None-"!=i[s].html?f=i[s].html:"-None-"!=i[s]&&"object"!=typeof i[s]&&(f=i[s]):f=i[s].value,v.attr({value:f,"data-colorcode":i[s].colorCode,"data-fcCategory":i[s].fcCategory,"data-fctype":i[s].fctype});var h="";"object"!=typeof(h=i[s].html?i[s].html:i[s].content?i[s].content:i[s].uservalue?i[s].uservalue:i[s])&&(e[0]&&"Crm_Potentials_STAGE"===e[0].id&&v.attr("id","Crm_Stage"+h),v.text(h),$(e).append(v))}for(var b=0;b<u.length;b++)$(e).find('option[value="'+$.escapeSelector(u[b])+'"]').prop("selected",!0),e[0]&&"Crm_Potentials_STAGE"===e[0].id&&u[b]&&e.find('option[id="Crm_Stage'+$.escapeSelector(u[b].split(":")[1])+'"]').prop("selected",!0);thirdPartyUtils.bindSelect2($(e),{show:!0}),a||t||($(e).addClass("dataPopulated"),setTimeout((function(){e.select2("open")}),1))}}function handleButton(e,t,a,i){if(!a||"Account Name"!=a&&"ACCOUNTID"!=a||(document.getElementById("actName").value=""),13==t.keyCode){if(void 0===i||"true"!==i)if("undefined"!=typeof customViewObject&&customViewObject.doMassActioninScheduler);else document.activeElement.blur(),getObj(e).click();return!0}return 27==t.keyCode&&globaltextareapanid&&$("#"+globaltextareapanid+"_cancel")[0].click(),!0}function loadTimeBasedActions(e,t,a,i){if(i=i||"upcmng_actn",!TBALoading){var r=new getHTTPObject;r.open("GET",Crm.getCrmBasePath()+"/TimeTrigger.do?step=getTimeBasedActions&id="+t+"&pageNum="+e+"&module="+a,!0),r.onreadystatechange=function(){if(4==r.readyState){if(r.status==crmConstants.errorStatusCode)return void renderingUtils.displayPermissionDenied(r);var t=getElemById("mrTBADIV");t&&($(t).empty(),t.parentNode.removeChild(t)),TBAPageNum=e;var a=r.responseText.trim();if(null!=typeof e&&1==e){var l=getElemById(i);null!=l&&($(l).empty(),l.innerHTML=a)}else{var n=getElemById("TBADIV").innerHTML+a;$("#TBADIV").empty(),getElemById("TBADIV").innerHTML=n,getElemById(i).style.display="block"}if($("#noupcomingaction").length>0){if(noMoreTBActions=!0,$(".upcomingActionsDivEle").addClass("noDataFountDetail"),!isTimeBasedActionSupported(Crm.userDetails.LICENSE_TYPE)){var s=$("#upcomingActionsDiv");s.hide(),s.prev().hide()}}else $(".upcomingActionsDivEle").removeClass("noDataFountDetail");getElemById("plstact_d").style.display="none",getElemById("mrlalnk_d").style.display="none",TBALoading=!1}},TBALoading=!0,r.send(null)}}function moreAction(e,t){hideMenu(t);var a="actionMenu";"moreAct1"==e.id?a="actionMenu1":"moreActForScheduler"==e.id&&(a="actionMenuForScheduler",$("#actionMenuForScheduler").css({display:"",visibility:"visible"})),Crm.menu.createMenu(t,a),$("#"+a).on("onBeforeShow",(function(t,a){var i=renderingUtils.getTargetElem(a);selectfieldtoupdate=I18n.getMsg("crm.module.mass.update"),i.parentNode.className="clickDropDown";if("moreAct"===e.id&&""!==getObj("listviewButtonLayerDiv").style.position){document.getElementById("show").offsetLeft;$(window).scrollTop()}else;this.style.left="0px",this.style.top=$(e).outerHeight()+"px"})).on("onBeforeClose",(function(e,t){$(this).off("onBeforeClose").off("onBeforeShow");var a=this;do{a=a.previousSibling}while(a&&1!==a.nodeType);a.className="normalDropDown"})),$(e).hasClass("showAct")&&$(e).addClass("borAct")}function showAll(){document.getElementById("advSearchEnable")&&(advSearchEnableVal=document.getElementById("advSearchEnable").value),document.showcvdetails.rangeValue.value=getObj("rangeValue").value,document.showcvdetails.searchletter.value="";var e=formData2QueryString(document.showcvdetails),t=Crm.getCrmBasePath()+"/ShowSelectedCustomView.do?module="+getObj("module").value+"&isload=false";ajaxNew(t,e)}function alphaSearch(e,t){if(document.getElementById("advSearchEnable")&&(advSearchEnableVal=document.getElementById("advSearchEnable").value),"recordHistory"==t){document.showcvdetails.searchletter.value=e;var a=formData2QueryString(document.showcvdetails);a="module="+getObj("module").value+"&isload=false&"+a,""==e&&(e="all"),putInHistory("alphaSearch_"+e,"ShowSelectedCustomView|?"+a)}else{document.showcvdetails.searchletter.value=e;a=formData2QueryString(document.showcvdetails);var i=Crm.getCrmBasePath()+"/ShowSelectedCustomView.do?module="+getObj("module").value+"&isload=false";ajaxNew(i,a)}}function selectAll(e){if(null==e&&getObj("fixedSelectAll")&&(document.showcvdetails.fixedSelectAll.checked=document.showcvdetails.allcheck.checked),null!=document.showcvdetails.chk){noofentries=document.showcvdetails.chk.length,checkstatus=document.showcvdetails.allcheck.checked;var t="",a="",r="",l="";for(null==noofentries&&(document.showcvdetails.chk.checked=checkstatus,t=document.showcvdetails.chk,r=$(t).parent().parent().children("td"),l=t.parentNode.parentNode,checkstatus?(l.style.backgroundColor="#FFFBE2",r.addClass("rowSelTd")):(l.style.backgroundColor="",r.removeClass("rowSelTd"))),i=0;i<noofentries;i++)t=document.showcvdetails.chk[i],a="true"==$(t).closest("tr").attr("lockedrecord"),t.disabled||(t.checked=checkstatus,checkstatus?(l.style.backgroundColor="#FFFBE2",r.addClass("rowSelTd")):(l.style.backgroundColor="",r.removeClass("rowSelTd"))),a&&(l.style.backgroundColor="#FFFBE2",r.addClass("rowSelTd"));editObj=document.getElementById("cvEdit"),editObj&&(1==noofentries&&(editObj.disabled=!1),noofentries>1&&(editObj.disabled=!0))}showHideListViewBtnFn()}function deSelectAll(){if(null!=document.showcvdetails&&null!=document.showcvdetails.chk)for(noofentries=document.showcvdetails.chk.length,null==noofentries&&(document.showcvdetails.chk.checked=!1),i=0;i<noofentries;i++)document.showcvdetails.chk[i].checked=!1}function toggleCheckBox(e){(chkedLen=0,state=e.checked,noofentries=document.showcvdetails.chk.length,null==noofentries)&&(null!=document.showcvdetails.chk&&(document.showcvdetails.allcheck.checked=!0));var t=e.parentNode.parentNode;if(state?t.style.backgroundColor="#FFFBE2":t.style.backgroundColor="",locked_record="true"==$(e).closest("tr").attr("lockedrecord"),locked_record&&(t.style.backgroundColor="#FFFBE2"),0==state)document.showcvdetails.allcheck.checked=!1;else if(null!=noofentries){var a=!1;for(i=0;i<noofentries;i++)if(0==document.showcvdetails.chk[i].checked){document.showcvdetails.allcheck.checked=!1,a=!0;break}0==a&&(document.showcvdetails.allcheck.checked=!0)}for(var r=0;r<noofentries;r++)document.showcvdetails.chk[r].checked&&chkedLen++;editObj=document.getElementById("cvEdit"),editObj&&(1==chkedLen&&(editObj.disabled=!1),chkedLen>1&&(editObj.disabled=!0)),getObj("fixedSelectAll")&&(document.showcvdetails.fixedSelectAll.checked=document.showcvdetails.allcheck.checked)}function deleteEntity(e,t,a){deleteActivity()&&deleteAction(Crm.getCrmBasePath()+"/MassDelete.do?module="+e+"&id="+t+"&customviewname="+a)}function deleteActivity(){var e=I18n.getMsg("confirmmsg");return!!window.confirm(e)}function tabAction(e,t,a){hideEditionTrialPopup();var i="tab_"+t;if(a)document.location.href=e;else if(-1!=$.inArray(t,["Reports","Documents","Dashboards","Emails","Chat","Pulse","Google Adwords","Social"])||!getObj("show")||getObj("setupshow")||getObj("externalIframe"))if("Emails"==t&&-1==jQuery.inArray("mail",usernameNotNeeded)){commonUtils.checkUsernameNeeded((function(){document.location.href=Crm.getCrmBasePath()+"/tab/Emails?quickcreate=true"}),"mail")}else document.location.href=e;else{if(e+="&isload=false",showCacheObj.hasOwnProperty(i)||Crm.CURRENT_REQUEST.module!=t){var r={module:t,url:e};Crm.CURRENT_REQUEST=r;var l=function(e){Crm.CURRENT_REQUEST={}};getObj("san")||getObj("otherCVblankScreen")||-1==$.inArray(t,["Leads","Contacts","Accounts","Potentials"])?ajaxNew(e,"",l):showCacheAjaxNew(e,t,l)}window.scrollTo(0,0),getObj("menu").style.display="none",currCVMod=t,currCVId=""}return!1}function isRelatedRecordsModule(e){return"Attachments"!==e&&"Notes"!=e&&"Solutions"!==e&&"PriceBooks"!==e&&"Tasks"!==e&&"Events"!==e&&"Calls"!==e&&"Activities"!==e&&"Emails"!==e&&"Competitors"!==e&&"CheckIns"!==e&&"Visits"!==e&&"Appointments"!==e}function getRelatedChildModules(e){switch(e){case"Leads":case"Contacts":return["Activities","Visits"];case"Accounts":return["Activities","Contacts","Potentials","Quotes","SalesOrders","Invoices","Cases"];case"Potentials":return["Cases","Activities"];case"Campaigns":case"Cases":case"Vendors":case"Quotes":case"SalesOrders":case"PurchaseOrders":case"Invoices":return["Activities"];case"Products":return["Activities","Solutions","Cases"];case"Services":return["Appointments"];default:if(e.includes("CustomModule")||e.includes("LinkingModule"))return["Activities"]}}function getAllRelatedChildModulesPluralLabel(e){var t=getRelatedChildModules(e),a="";if(void 0!==t&&(t=getNewRelatedChildModules(e,t)),t)for(var i=t.length,r=0;r<i;r++){var l=t[r];moduleRecordMapping[l]&&(a=0!=a.length?a.concat(", ").concat(moduleRecordMapping[l].plural_label):a.concat(moduleRecordMapping[l].plural_label))}return a}function getNewRelatedChildModules(e,t){return new RegExp("Contacts|CustomModule[0-9]{1,3}$").test(e)&&moduleRecordMapping.Appointments&&"default"===moduleRecordMapping[e].generated_type&&(t=t.concat(["Appointments"])),t}function submitForm(e,t,a){var i=getObj("module")?getObj("module").value:"",r=!0;getObj("ajaxRequest")&&(r=!1),e.OnSelect.value="true";var l,n=getObj("currentOption").value;if(getObj("rangeValue").value=n,a&&"currentOption"===a.id&&"viewPipeline"===$(e).find('input[name="actiontype"]').val()&&n&&!isNaN(parseInt(n))&&localStorage.setItem("rangeValueForPipeline",n),cntElem=getObj("navCount"),navCount=1,null!=cntElem&&(navCount=parseInt(cntElem.value)),void 0===t&&clearShowCacheObj("tab_"+i),""!=i&&r){var s=formData2QueryString(e),o=Crm.getCrmBasePath()+"/NavigateByRecords.do";return"next"==t?s+="&next.x=true":"previous"==t&&(s+="&previous.x=true"),"AssignmentRuleForm"==e.name?(Territory.doUpdateForm("result",s,"","",o),!1):"TransferWizardForm"==e.name?(getObj("massResult")?Territory.doUpdateForm("massResult",s,"","",o):Territory.doUpdateForm("show",s,"","",o),!1):(ajaxNew(o,s),!1)}"next"==t?(navCount+=1,getObj("navCount")&&(getObj("navCount").value=navCount),l=Crm.getCrmBasePath()+"/NavigateByRecords.do?next.x=true"):l="previous"==t?Crm.getCrmBasePath()+"/NavigateByRecords.do?previous.x=true":Crm.getCrmBasePath()+"/NavigateByRecords.do",mR(l,(function(e){e.indexOf("No tasks are assigned to you")>-1?alert(I18n.getMsg("crm.new.label.no.records")):replaceTaskDiv(e)}),$("[name=showhome]").serializeArray())}function findMap(e,t,a){var i;i=null==Crm.baiduAvailable||"true"!=Crm.baiduAvailable||null==Crm.baiduUrl||"China"!=RebrandLinkUtil.getProperty("DeploymentLocation")&&"skyDesk"!=Crm.brandName&&"Baidu"!=t?httpprotocol+"maps.google.com/maps?q="+e:"location"==a?Crm.baiduUrl+"?location="+e+"&coord_type=wgs84&output=html":Crm.baiduUrl+"?address="+e+"&output=html",window.open(i)}function enableSkype(){}function showSheet(e,t){if(commonUtils.showHideLoadingDiv(!0),null!=usernameNeeded&&"boolean"==typeof usernameNeeded&&1==usernameNeeded&&-1==jQuery.inArray("sheet",usernameNotNeeded)){commonUtils.checkUsernameNeeded((function(){showSheet(e)}),"sheet")}else http&&(getObj("previous_sort_column")&&(e=e+"&sortColumnString="+encodeURIComponent(getObj("previous_sort_column").value)+"&sortOrderString="+getObj("previous_sort_order").value),loadAjaxTab("","lightblue"),http.open("POST",e,!1),http.setRequestHeader("X-ZCSRF-TOKEN",csrfParamName+"="+csrfToken),http.onreadystatechange=function(){if(4==http.readyState){var t=http.responseText;if(commonUtils.showHideLoadingDiv(),http.status==crmConstants.errorStatusCode)return void renderingUtils.displayPermissionDenied(http);if(t.indexOf("Error")>-1)return void openSheetError(t.split("Error::")[1]);if(t.indexOf("||")<0)return void openSheetError(I18n.getMsg("crm.alert.generalError"));var a=t.split("||")[1],i=cookieUtils.getCookie("isSheetOpen");null===i||"true"!==i?mR(Crm.getCrmBasePath()+"/SheetViewMessage.do",(function(t){openTips(e,t,a)})):openSheet(e,a)}commonUtils.showHideLoadingDiv()},http.send(t))}function openSheetError(e){var t=document.getElementById("sheetTips");t.style.display="block",t.style.zIndex=30,$("#sheetTips").empty(),crmui.showPopup("sheetTips");var a=document.createElement("div");a.setAttribute("class","f17"),a.setAttribute("id","sheetErrorDiv"),t.appendChild(a);var i=document.getElementById("sheetErrorDiv");$("#sheetErrorDiv").empty(),i.innerHTML=e;var r=document.createElement("input");r.setAttribute("type","button"),r.setAttribute("value","Close"),r.setAttribute("name","sheetcancel"),r.setAttribute("id","sheetcancel"),r.setAttribute("class","newwhitebtn");var l=document.createElement("div");l.setAttribute("class","mT15"),i.appendChild(l),i.appendChild(l),i.appendChild(r),document.getElementById("sheetcancel").onclick=function(){crmui.hidePopup("sheetTips")}}function openTips(e,t,a){var i=$("#sheetTips");i.css({display:"block",zIndex:"30",width:"700px"}),t&&""!==t&&(i.empty(),i[0].innerHTML=t),crmui.showPopup("sheetTips"),getObj("tipButton").onclick=function(){openSheet(e,a)},document.getElementById("sheetcancel").onclick=function(){closeDashletDiv("sheetTips")}}function openSheet(e,t){getObj("isSheetOpen")&&getObj("isSheetOpen").checked&&cookieUtils.setCookie("isSheetOpen","true"),closeDashletDiv("sheetTips");var a=document.getElementById("FreezeLayer");a&&document.body.removeChild(a),null!=t&&(winObj=window.open(t))}function mupFieldValidate(e,t,a,i){e=decodeURIComponent(e);var r="txt_"+a;5==a&&(r="property(campName:"+e+")");var l=i.split("~");if("M"==l[1]&&!emptyCheck(r,e,void 0,void 0,"inline"))return!1;switch(l[0]){case"O":case"V":case"C":break;case"E":if(null!=getObj(r)&&0!=getObj(r).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length&&!emailValidate(r,e,void 0,"inline"))return!1;break;case"DT":if(null!=getObj(r)&&0!=getObj(r).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(void 0===l[3]?currdatechk="OTH":currdatechk=l[3],l[2]="txt_"+a,!dateTimeValidate(r,l[2],e,currdatechk,void 0,"inline"))return!1;if(l[4]&&!dateTimeComparison(r,l[2],e,l[5],l[6],l[7],l[4],void 0,"inline"))return!1}break;case"D":if(null!=getObj(r)&&0!=getObj(r).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(void 0===l[2]?currdatechk="OTH":currdatechk=l[2],!dateValidate(r,e,currdatechk,void 0,void 0,"inline"))return!1;if(l[3]&&!dateComparison(r,e,l[4],l[5],l[3],"inline"))return!1}break;case"T":if(null!=getObj(r)&&0!=getObj(r).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(void 0===l[2]?currtimechk="OTH":currtimechk=l[2],!timeValidate(r,e,currtimechk,void 0,"inline"))return!1;if(l[3]&&!timeComparison(r,e,l[4],l[5],l[3],void 0,"inline"))return!1}break;case"I":case"B":if(null!=getObj(r)&&0!=getObj(r).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(!intValidate(r,e,void 0,"inline"))return!1;if(l[2]&&!numConstComp(r,e,l[2],l[3],void 0,"inline"))return!1}break;case"DE":if(null!=getObj(r)&&0!=getObj(r).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(void 0===l[2]?numformat="any":numformat=l[2],!decimalValidate(r,e,numformat,void 0,"inline"))return!1;if(l[2]&&!numConstComp(r,e,l[2],l[3],void 0,"inline"))return!1}break;case"N":if(null!=getObj(r)&&0!=getObj(r).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length){if(void 0===l[2]?numformat="any":numformat=l[2],!numValidate(r,e,numformat,void 0,"inline"))return!1;if(l[3]&&!numConstComp(r,e,l[3],l[4],void 0,"inline"))return!1}break;case"P":if(null!=getObj(r)&&0!=getObj(r).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length&&!phoneValidate(r,e,void 0,"inline"))return!1;break;case"W":if(null!=getObj(r)&&0!=getObj(r).value.replace(/^\s+/g,"").replace(/\s+$/g,"").length&&!isValidWebURL(e,getObj(r).value))return!1}return!0}function showHideGTask(){var e=getObj("viewdiv")&&"f16 dN"==getObj("viewdiv").className?"f16":"f16 dN";getObj("viewdiv").className=e;var t=getObj("viewtab")&&"bdrT_Dash mt5 dN"==getObj("viewtab").className?"bdrT_Dash mt5":"bdrT_Dash mt5 dN";getObj("viewtab").className=t;var a=getObj("editdiv")&&"f16 dN"==getObj("editdiv").className?"f16":"f16 dN";getObj("editdiv").className=a;var i=getObj("edittab")&&"bdrT_Dash mt5 dN"==getObj("edittab").className?"bdrT_Dash mt5":"bdrT_Dash mt5 dN";getObj("edittab").className=i}function selectAllGAppUsers(){if(document.gappUsersForm.userChk){var e=document.gappUsersForm.userChk.length,t=document.gappUsersForm.allcheck.checked;if(null==e)document.gappUsersForm.userChk.checked=t;else for(var a=0;a<e;a++)document.gappUsersForm.userChk[a].checked=t}}function importGAppUsers(e){var t=Crm.getCrmBasePath()+"/GApps.do?mode=importGUsers",a=document.gappUsersForm.userChk.length,i="";if(null==a)document.gappUsersForm.userChk.checked&&(i=document.gappUsersForm.userChk.value);else for(var r=0;r<a;r++)document.gappUsersForm.userChk[r].checked&&(i=""==i?document.gappUsersForm.userChk[r].value:i+","+document.gappUsersForm.userChk[r].value);if(""==i)alert(e);else{document.gappUsersForm.selUsers.value=i;var l=formData2QueryString(document.gappUsersForm)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);freezeBackground(),loadAjaxTab(""),mR(t,(function(e){commonUtils.showHideLoadingDiv();var t=document.getElementById("nextStepDiv");t.style.display="block",t.style.zIndex=600,t.style.position="absolute",mailsetCenter("nextStepDiv")}),l)}}function closeGadgets(){getObj("mainGadgetsDiv").style.display="none",removeFreezeLayer()}function showGadgetsMenu(e,t,a,i,r,l){var n=document.getElementById("gadgetsMenu"),s=getObj(a).offsetHeight,o=$("#"+a).offset().top,d="<a href=\"javascript:openCRMGadGets('"+e+"','"+t+'\');"><img border="0" src="/images/webpageIcon_0112a5e_.gif"> &nbsp;'+i+"</a><a href=\"javascript:openEGadgets('google','"+e+'\')"><img border="0" src="/images/igBigIcon_5dc0ed6_.gif"> &nbsp;'+r+"</a><a href=\"javascript:openEGadgets('orkut','"+e+'\')"><img border="0" src="/images/orkutBigIcon_2abf0cc_.gif"> &nbsp;'+l+"</a>";n.style.display="block",$("#gadgetsMenu").empty(),n.innerHTML=d,n.style.left=findPosX(getObj(a))+"px",n.style.top=o+s+"px"}function opensocialPopup(e,t){var a=document.getElementById("opensocial"),i=document.getElementById("lookupdiv");if("block"==i.style.display)i.style.display="none";else{freezeBackground(),$("#lookupdiv").empty(),i.style.display="block",i.style.zIndex="21",i.style.left="0px",i.style.top="0px",i.style.width="690px",i.style.height="530px";var r="<p>"+t+':</p> <input type="text" size="80" value="'+"http://hosting.gmodules.com/ig/gadgets/file/112646789256826398286/ZohoCRM"+e+'.xml"/>';$("#openSocialBlock").empty(),document.getElementById("openSocialBlock").innerHTML=r;var l="<a href='javascript:;'>http://hosting.gmodules.com/ig/gadgets/file/112646789256826398286/ZohoCRM"+e+".xml</a><br>";l=l+'<img width="580" src="/images/Gadgets'+e+'.gif"/></td>',$("#gadgetsModule").empty(),document.getElementById("gadgetsModule").innerHTML=l,i.innerHTML=a.innerHTML,mailsetCenter("lookupdiv")}}function showTotalCount(e,t,a,i){I18n.getMsg("loading");customViewObject.doMassActioninScheduler||null!=a||$(e).find("span").html('<img src="'+networkUtils.getImageUrl("moreloading_90b33f4_.gif",ResourceConstants.CRM)+'" border="0" class="mL10">');var r=crmListView.getObject()?crmListView.getObject().cvId:getObj("cvid").value,l=crmListView.getObject()?crmListView.getObject().module:getObj("module").value;customViewObject.isPrivacyListView&&(l=l.replace("privacy_",""));var n=customViewObject.singularModName;if(!a||r&&l&&"null"!==r&&"undefined"!==r&&"null"!==l&&"undefined"!==l){var s=Crm.getCrmBasePath()+"/RecordsCount.do?step=step2&cvId="+r+"&module="+l;if($("#territoryDropDown")[0]){var o=moduleRecordMapping[l].territory;s+=o?"&territoryId="+o.id+"&includechild="+(o.subordinates?1:0):""}if((customViewObject.isStageView&&1==customViewObject.isStageView||customViewObject.isPredictView&&1==customViewObject.isPredictView)&&customViewObject.layoutId&&"0"!=customViewObject.layoutId&&(s+="&layoutId="+customViewObject.layoutId),"Visits"==l){var d=crmListView.getObject().screenName,c=crmListView.getObject().portalName;s+="All Portals"!=d?"&portalName="+c+"&allPortals=false":"&allPortals=true"}if(customViewObject.selectAllInCurrentView&&customViewObject.doMassActioninScheduler&&(s+="&isMassJob="+customViewObject.doMassActioninScheduler),null!=a){s+="&fetchAllFilterCount="+(a=!1);var m=crmListView.getObject().filterId;m&&(s+="&filterId="+m)}var u={};customViewObject.isPrivacyListView&&(u.isPrivacyListView=!0,u.privacyDetails=JSON.stringify(customViewObject.privacyDetails)),customViewObject.isCampaignAddMemberListView&&(u.isCampaignAddMemberListView=!0,u.campaignId=detailView.entityId),u[csrfParamName]=encodeURIComponent(csrfToken),$("#dataRange").val()&&(u.dataRange=$("#dataRange").val()),customViewObject.isPredictView&&(u.predictionView=!0);var p=Lyte.Router.getRouteInstance();if("kanban"==p.routeName||"canvas"==p.routeName||"zia"==p.routeName){var g=crmTab.getFromCache(l);if((g.filters||g.cross_filters)&&(u.isNewFilter=!0,u.filters=g.filters?JSON.stringify(g.filters):void 0,u.cross_filters=g.cross_filters?JSON.stringify(g.cross_filters):void 0),g.filter_id){var v=store.peekRecord("filter",g.filter_id);(v.criteria||v.cross_filters)&&(u.isNewFilter=!0,u.filters=v.criteria?JSON.stringify(v.criteria):void 0,u.cross_filters=v.cross_filters?JSON.stringify(v.cross_filters):void 0)}customViewObject.searchletter&&"All"!=customViewObject.searchletter&&(u.searchletter=customViewObject.searchletter)}else crmListView.getAdvSearchCrtFromCVObject(u);(new crmRequestPool).initiate({action:s,type:"POST",data:u,success:function(t){if("canvas"==p.routeName||"kanban"==p.routeName||"zia"==p.routeName){var r=$("crm-custom-filter")[0];if(p.getQueryParams().filter_id||r&&r.component.data.appliedFilterId&&!r.getData("isSaveFilter")&&r.getData("savedFilters").length){var s,o=(r=r.component).getData("savedFilters"),d=o.length,c=p.getQueryParams().filter_id?p.getQueryParams().filter_id:r.filter_id;for(s=0;s<d;s++)o[s].id==c&&(Lyte.objectUtils(customViewObject,"add","totalCount",t.TotalCount),Lyte.objectUtils(o[s],"add","count",t.TotalCount))}}if(null!=a){if(null==crmTab.countCache[l])customViewObject.isPrivacyListView||!crmTab.getFromCache(l)||customViewObject.isCampaignAddMemberListView||(crmTab.getFromCache(l).isTotalcountCached=!0),crmListView.getObject().isTotalcountCached=!0,crmTab.countCache[l]=t;else{if(!i&&crmListView.getObject().fetchCountOnMismatch)return void crmListView.compareAndFetchCount(t,l);if(t.hasOwnProperty(customViewObject.filterId))return void crmListView.renderFilterCount(t,e,l);$.extend(crmTab.countCache[l],t)}crmListView.renderFilterCount(crmTab.countCache[l],e,l)}else{if(customViewObject.doMassActioninScheduler||($(e).find("span").html("<b>"+t+"</b>&nbsp;"),$(e).children().unwrap()),customViewObject.isPrivacyListView||customViewObject.isCampaignAddMemberListView||(customViewObject.totalCount=crmTab.getFromCache(l).totalCount=t),crmListView.getObject().totalCount=t,customViewObject.selectAllInCurrentView&&customViewObject.doMassActioninScheduler&&t>Crm.massOperationTotalLimit){customViewObject.doMassActioninScheduler=!1,customViewObject.showSelectAll=!1,$("#selectAllRecords").hide(),$("#scheduleMassActionDiv").hide(),$("#actionMenuForScheduler").css({display:"",visibility:"hidden"});var m="<span id='maxLimitAlertMassOperation'>"+I18n.getMsg("crm.listview.maximum.records.alert",[Crm.massOperationTotalLimit])+"</span>";$("#selectAllRecords").parent().append(m)}customViewObject.doMassActioninScheduler&&t<=Crm.massOperationTotalLimit&&(t>1&&(n=customViewObject.pluralModName),$(".selCountNum").html(I18n.getMsg("crm.mass.actions.all.selected",[t,n])),showMassOperationsForScheduler(),overLayForSelectAllClick(!0)),customViewObject.doMassActioninScheduler||customViewObject.selectAllInCurrentView||$("html, body").animate({scrollTop:$(document).height()},50)}},error:function(e){a?$("#lv_saved_filters").find(".listTxtCount").hide():alert("Unable to process request")}})}}function handlePrivateEvent(e){if(getObj("userId")&&getObj("property(Private)")&&getObj("property(ownerId)")){var t=getObj("userId").value,a=getObj("property(ownerId)").value;getObj("property(Private)").disabled=t!=a,e&&(getObj("property(Private)").checked=!1)}}function EntSendMail(e,t,a,i,r,l,n,s,o,d,c){var m=$("email-summary");if(m.hasClass("hide")||hideEmailSummaryDiv(),Crm.userDetails.isStorageLimitReached)Crm.showStorageExceedPopup("mailAlert");else{if("true"===window.isSandboxAcc){var u=window.event||arguments.callee.caller.arguments[0];return u.stopPropagation(),void renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.sandbox.error.email"))}if("true"===l){if(null!=$("#surveyLinkQuery").val()&&""==$("#surveyLinkQuery").val())return alert(I18n.getMsg("crm.zsurvey.alert.mesg")),!1;ZSurvey.cancelPopup("lookupdiv")}var p=e,g=t;if(e=null==e?$("#module").val():e,i=null==i?moduleRecordMapping[e].singular_label:i,EmailSendingUtil.entityId=t,"Potentials"==e&&getObj("contId")&&"null"!=getObj("contId").value)$("#zmailEmail").length>0?$("#zmailEmail").val():"";else if("Accounts"==e){p="Contacts";var v=$("#contactSelDropdownInAcc :selected");if(0==v.length){var f=$("#contactSelDropdownInAcc").attr("lt-prop-selected"),h=$(document.querySelector('lyte-drop-item[data-value="'+f+'"]'));g=null!=h?h.data().value:h,null!=h?h.data().email:h}else g=v.attr("value"),v.attr("email")}var b=Crm.getCrmBasePath()+"/mailer/EntReply.do",C="action=openComposeWindow&entType="+p+"&entityId="+g;if(void 0===a||"consentView"!==a&&"Export"!==a&&"Rectify"!==a&&"Access"!==a)EmailSendingUtil.isConsentEmail=!1,EmailSendingUtil.dataReqObj=void 0;else if(C=C+"&from="+a,"consentView"!==a&&Crm.userDetails.isNewEditor){EmailLaunchUtil.privacyPolicyDetails={};var y={};y.type=a.toLowerCase(),y.id=s,EmailLaunchUtil.privacyPolicyDetails.dataReqObj=y,EmailLaunchUtil.privacyPolicyDetails.isConsentEmail=!1}else Crm.userDetails.isNewEditor?(EmailLaunchUtil.privacyPolicyDetails={},EmailLaunchUtil.privacyPolicyDetails.isConsentEmail=!0):EmailSendingUtil.isConsentEmail=!0;var I="";commonUtils.showHideLoadingDiv(!0),jQuery.ajax({type:"POST",url:b,data:C,async:!1,success:function(m){commonUtils.showHideLoadingDiv(),I=m,EmailLaunchUtil.postResourceLoadInitialization=function(){EmailSendingUtil.entityId=t},launchEmailWindow(I,e,t,a,i,r,l,n,s,o,d,c)},error:function(){commonUtils.showHideLoadingDiv(),alert("Error Occurred! Please Try again.")}})}}function launchEmailWindow(e,t,a,i,r,l,n,s,o,d,c){var m=t,u=a,p=a,g="",v="",f="";if("Accounts"===t)if($("crm-rl-users-list").length>0)p=$("#contactSelDropdownInAcc").attr("lt-prop-selected"),f=e;else{var h=$("#contactSelDropdownInAcc :selected");p=h.attr("value"),f=h.attr("email")}if(window.addEventListener("message",receiveMessage,!1),$("#isFromNewAPI").length>0){var b=$(".rLESelectAction");b.length>0&&"block"==b.css("display")&&$L(".ernLyteBody .ecnChkBoxtd lyte-checkbox").attr("lt-prop-checked",!1)}if(null!=store.peekRecord("emails_rl_user","shared_users_"+a)&&store.deleteRecord("emails_rl_user","emails_"+a),"1101"==e)return renderingUtils.showCustomAlert(I18n.getMsg("crm.security.error")),!1;if("8011"==e)return renderingUtils.showCustomAlert(I18n.getMsg("crm.priv.email.consent")),!1;if(e.indexOf("UNCONFIRMED_USER")>-1)return e=e.substring(16,e.length),$("#shownotes").addClass("newPopup p30"),$("#shownotes").html(e),getObj("shownotes").style.zIndex=21,getObj("shownotes").style.width="600px",getObj("shownotes").style.position="absolute",$("#shownotes input[type=button]").click((function(){removeFreezeLayer(),$("#shownotes").html(""),$("#shownotes").hide()})),freezeBackground(),$("#shownotes").show(),mailsetCenter("shownotes"),!1;if(e.indexOf("TRANSMAIL_BLOCKED_ERROR")>-1&&"Potentials"!==t){e=e.substring(23,e.length);var C="<div class='aligncenter crm-font-bold f20' text-align:auto;'>";C+=I18n.getMsg("crm.bouncemail.heading"),C+="</div>",$("#emailalert").hide(),e="<div class='massMailstatscloseIcon cP' style='top:20px;right:20px' onclick=closealertMail('emailalert')></div><div class='aligncenter crm-font-regular f14 mT20'>"+e+"</div> </div></div>",$("#emailalert").empty(),document.getElementById("emailalert").innerHTML=C+e;var y=parseInt($(".emailalert").css("margin-top"))-$("#wmstoolbar").outerHeight()-12;return $(".emailalert").css("margin-top",y),$("html,body").css("overflow","hidden"),mailsetCenter("emailalert"),$(".emailalert").css("max-height",$(window).height()-110),mailsetCenter("emailalert"),freezeBackground(),!1}if("1003"==e&&"Potentials"!==t)return renderingUtils.showCustomAlert(I18n.getMsg("crm.label.emailoptout.alert.message")),!1;if("2310"==e){var I=a,w="";if(Crm.userDetails.isNewEditor){if(EmailSendingUtil.isSendMailActionCalled)return;EmailSendingUtil.isSendMailActionCalled=!0,setTimeout((function(){EmailSendingUtil.isSendMailActionCalled=!1}),4e3),EmailSendingUtil.entityId=u,EmailSendingUtil.singularMod=r,EmailLaunchUtil.SendMailEvent(m,u,"listview")}else openPopUp("entreplyWin",this,Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+I+"/send-mail?action=compose&entEmail="+encodeURIComponent(w)),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes")}else if("2309"==e)renderingUtils.showCustomAlert(I18n.getMsg("crm.zmail.unableto.sendmail",Crm.moduleInfo[t].translatedSingularLabel),I18n.getMsg("crm.error.email.notfound"));else{I=a;var A=document.getElementById("subvalue_EMAIL"),E=document.getElementById("subvalue_ADDN_EMAIL"),T=document.getElementById("iskanbanview");if(EmailSendingUtil.switchedToOldWin||("Accounts"!==t||f)&&("salessignals"==i||"fromMap"==i||"listview"==i||"BestTimeMail"==i||null!=A&&""!=A.innerHTML||null!=E&&""!=E.innerHTML||!("Leads"==t||"Contacts"==t||t.length>11&&"CustomModule"==t.substring(0,12)||"LinkingModule"==t.substring(0,13))||T&&"true"===T.value)){var S="";if(g=getObj("subvalue_EMAIL"),v=getObj("subvalue_ADDN_EMAIL"),"Accounts"!=t&&(g&&""!=g.innerHTML||v&&""!=v.innerHTML)){if(g&&""!=g.innerHTML&&validationUtils.isValidEmail(g.innerText.replace(/\s/g,""))?(S=g.innerText.replace(/\s/g,""),v&&""!=v.innerHTML&&validationUtils.isValidEmail(v.innerText.replace(/\s/g,""))&&(S=S+","+v.innerText.replace(/\s/g,""))):v&&""!=v.innerHTML&&validationUtils.isValidEmail(v.innerText.replace(/\s/g,""))&&(S=v.innerText.replace(/\s/g,"")),!(""!=S&&null!=S||"Leads"!=t&&"Contacts"!=t))return void renderingUtils.showCustomAlert(I18n.getMsg("crm.primary.secondary.no.valid.email",I18n.getMsg(r)));if("Potentials"==t&&!isEmailValidInAssocCont(getObj("associatedContName"),getObj("associatedContEmail")))return}else"Accounts"===t&&(S=f,I=p,t="Contacts");if("listview"==i)if(str=e,null!=str&&""!=str){w=null;if(str.indexOf(",")>-1)w=str.split(",")[0];else w=str;if(!validationUtils.isValidEmail(w))return renderingUtils.showCustomAlert(I18n.getMsg("crm.primary.no.valid.email")),!1;if(Crm.userDetails.isNewEditor){if(EmailSendingUtil.isSendMailActionCalled)return;EmailSendingUtil.isSendMailActionCalled=!0,setTimeout((function(){EmailSendingUtil.isSendMailActionCalled=!1}),4e3);EmailLaunchUtil.postResourceLoadInitialization=function(){EmailSendingUtil.entityId=u,EmailSendingUtil.view=i,EmailSendingUtil.singularMod=r},!$("#addNewSign")[0]&&EmailComposeUtil.TEMP_TAB&&(EmailComposeUtil.CURRENT_TAB=EmailComposeUtil.TEMP_TAB),EmailLaunchUtil.SendMailEvent(m,u,i)}else"true"===n?openPopUp("entreplyWin",this,Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+I+"/send-mail?action=compose&entEmail="+encodeURIComponent(str)+"&from=sendsurvey"),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"):openPopUp("entreplyWin",this,Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+I+"/send-mail?action=compose&entEmail="+encodeURIComponent(str)),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"),entreplyWin||renderingUtils.showCustomAlert(I18n.getMsg("crm.label.popup.blocker",I18n.getMsg(t.substring(0,t.length-1))))}else null==r&&(r=t),renderingUtils.showCustomAlert(I18n.getMsg("crm.zmail.unableto.sendmail",Crm.moduleInfo[t].translatedSingularLabel),I18n.getMsg("crm.error.email.notfound"));else if("fromMap"==i){w=null;null!=s&&validationUtils.isValidEmail(s.replace(/\s/g,""))?(w=s.replace(/\s/g,""),Crm.userDetails.isNewEditor?EmailLaunchUtil.SendMailEvent(m,u,i):openPopUp("entreplyWin",this,Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+I+"/send-mail?action=compose&entEmail="+encodeURIComponent(w)),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes")):renderingUtils.showCustomAlert(I18n.getMsg("crm.zmail.unableto.sendmail",Crm.moduleInfo[t].translatedSingularLabel))}else if(getObj("unabletosendmail"))alert(I18n.getMsg("crm.zmail.passwordchange.alt",""));else if(getObj("currentUserTicketUnavailable"))freezeBackground(),document.getElementById("alertDiv").style.zIndex="30",mailsetCenter("alertDiv");else if(Crm.userDetails.isNewEditor){var L;if(EmailSendingUtil.isSendMailActionCalled)return;EmailSendingUtil.isSendMailActionCalled=!0,setTimeout((function(){EmailSendingUtil.isSendMailActionCalled=!1}),4e3),"true"===n&&(L=EmailLaunchUtil.launchComposeMailWithSurvey),EmailLaunchUtil.SendMailEvent(m,u,i,L)}else document.getElementById("iskanbanview")&&"true"===document.getElementById("iskanbanview").value?"true"===l?"true"===n?openPopUp("entreplyWin",this,Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+I+"/send-mail?action=compose&iskanbanview=true&tkvsentmail=true&isSendMail=true&entEmail="+encodeURIComponent(S)+"&from=sendsurvey"),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"):openPopUp("entreplyWin",this,Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+I+"/send-mail?action=compose&iskanbanview=true&tkvsentmail=true&isSendMail=true&entEmail="+encodeURIComponent(S)),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"):"true"===n?openPopUp("entreplyWin",this,Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+I+"/send-mail?action=compose&iskanbanview=true&tkvsentmail=true&entEmail="+encodeURIComponent(S)+"&from=sendsurvey"),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"):validationUtils.isNotEmpty(d)?openPopUp("entreplyWin",this,Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+I+"/send-mail?action=compose&iskanbanview=true&tkvsentmail=true&entEmail="+encodeURIComponent(S)+"&parentModule="+d),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"):openPopUp("entreplyWin",this,Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+I+"/send-mail?action=compose&iskanbanview=true&tkvsentmail=true&entEmail="+encodeURIComponent(S)),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"):("true"===n?openPopUp("entreplyWin",this,Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+I+"/send-mail?action=compose&entEmail="+encodeURIComponent(S)+"&from=sendsurvey"),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"):"consentView"===i?openPopUp("entreplyWin",this,Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+I+"/send-mail?action=compose&entEmail="+encodeURIComponent(S)+"&from=consentView"),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"):"Export"===i||"Rectify"===i||"Access"===i?openPopUp("entreplyWin",this,Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+I+"/send-mail?action=compose&entEmail="+encodeURIComponent(S)+"&from="+i+"&requestId="+o),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"):validationUtils.isNotEmpty(d)?openPopUp("entreplyWin",this,Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+I+"/send-mail?action=compose&entEmail="+encodeURIComponent(S)+"&parentModule="+d),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"):c?openPopUp("entreplyWin",this,Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+I+"/send-mail?action=compose&entEmail="+encodeURIComponent(S)+"&bestTime="+c),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"):openPopUp("entreplyWin",this,Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+I+"/send-mail?action=compose&entEmail="+encodeURIComponent(S)),"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"),entreplyWin||alert(I18n.getMsg("crm.label.popup.blocker",I18n.getMsg(t.substring(0,t.length-1)))))}else renderingUtils.showCustomAlert(I18n.getMsg("crm.zmail.unableto.sendmail",Crm.moduleInfo[t].translatedSingularLabel),I18n.getMsg("crm.error.email.notfound"))}1==Crm.userDetails.detailView_newUI&&null!=Crm.userDetails.detailView_newUI&&detailView.btnAddClassSelected($("#sendEntityMailLink"))}function closealertMail(e){hide(e),$(".freezelayer").hide(),removeFreezeLayer(),$("html,body").css("overflow","auto")}function searchDelAction(e,t){var a=csrfParamName+"="+encodeURIComponent(csrfToken);networkUtils.parseUrl(e).params;mR(e,(function(e){$(e).filter("#securityError").length?renderingUtils.displayPermissionDenied():($("#ajax_"+t).html(e),searchResultObj.searchResponse=getObj("show").innerHTML)}),a),hideAnimatePopup("deletepopup")}function showConvertQuoteMenu(e,t){t?$("#dropDownMenuCnt").css({left:"0px",display:"block",top:"32px",position:"absolute"}):$("#dropDownMenuCnt").css({left:findPosX(e)+"px",display:"block",top:findPosY(e)+e.offsetHeight+"px",position:"fixed"})}function receiveMessage(e){if(e.origin===window.location.origin){var t=JSON.parse(e.data),a=document.querySelector("crm-emails-related-list");null!=a&&(a.component.setData(t),populateRLCount($("#mailListRelId").val(),void 0,"next"===t.navaction&&0!==t.fromIndex))}}function deleteApprove(e){document.deleteForm.action=Crm.getCrmBasePath()+"/DeleteCustomField.do?module="+e+"&id="+gblid,document.deleteForm.method="post",cfAjax(document.deleteForm)}function cfAjax(e){commonUtils.showHideLoadingDiv(!0);var t=$(e).attr("action"),a=$(e).serialize();return $.ajax({type:"POST",url:t,data:a,success:function(e){if(commonUtils.showHideLoadingDiv(),$("#isFrom").length&&"pagelayout"==$("#isFrom").val()){"Events"==$("#modlist").val()?addnewFieldInEventLayout(e):createNewSortableField(e)}else{if(getObj("basic"))0!=(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)&&$.scrollTo("#basic",{axis:"y",duration:1e3,offset:-50});document.getElementById("FreezeLayer")&&newcloseFreez("FreezeLayer"),$("#result").empty(),$("#result")[0].innerHTML=e,EvalInnerScript(getObj("result"))}return!1}}),!1}function createNewSortableField(e){try{var t="object"==typeof e?e:JSON.parse(e),a=t.fieldId,i=t.fieldLabel,r=t.sectionId,l=t.SCH_FOR_AUTONUM,n=$("#sectionId_"+r).attr("columncount"),s=$("<div  sysdefmandatory='false' class='detBlk'><span class='dotLine floatL dIB vam' alt=''></span><span class='floatL'>Form Field</span></div>");if(s.attr("id","fieldId_"+a),s.find("span").html(i),1==n)$("#mainMatrix #sectionId_"+r+" .wid3h").append(s);else if(2==n){$("#mainMatrix #sectionId_"+r+" #odd").find("div").length<=$("#mainMatrix #sectionId_"+r+" #even").find("div").length?$("#mainMatrix #sectionId_"+r+" #odd").append(s):$("#mainMatrix #sectionId_"+r+" #even").append(s)}if(getObj("basic"))0!=(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)&&$.scrollTo("#basic",{axis:"y",duration:1e3,offset:-50});if(document.getElementById("FreezeLayer")&&newcloseFreez("FreezeLayer"),cancelCF(),createsortables(),null!=l&&getObj("loadingDiv")){var o=getObj("loadingDiv");o.style.position="absolute",$("#loadingDiv").empty(),o.innerHTML=l,o.style.width="auto",o.className="successMsg",mailsetCenter("loadingDiv"),$("#loadingDiv").fadeIn().delay(3e3).fadeOut("slow")}}catch(t){$("#lookupdiv").html(e)}}function viewMailForSignal(e,t,a,i,r,l,n,s,o,d){Crm.trackSpotLightAction("CRM Signals - View EMail Popup");var c=Crm.getCrmBasePath()+"/mailer/EntReply.do?action=viewMail&msgid="+e+"&user_id="+t+"&module="+a+"&entId="+i+"&mailType="+encodeURIComponent(r)+"&sentOrReceived="+l+"&entEmailId="+encodeURIComponent(n)+"&flag="+s;o&&(c+="&notificationId="+o),d&&(c+="&isZiaNotificationsView=true"),loadAjaxTab("");var m=csrfParamName+"="+encodeURIComponent(csrfToken);mR(c,(function(e){var t=$("#lookupdiv");commonUtils.showHideLoadingDiv(),$("#lookupdiv").addClass("p20");var a=$(document.createElement("iframe"));t.removeAttr("style"),a.attr({id:"emailDetailIframeContent",style:"opacity:1; width:100%; height:100%;clear: both; border: medium none",src:"/crm/html/content1.html"}),$(document.getElementById("lookupdiv")).append(a),$("#emailDetailIframeContent").on("load",(function(){setTimeout((function(){document.getElementById("emailDetailIframeContent").contentWindow.document.write(e),$("#emailDetailIframeContent").contents().find(".ceMailContentOuter").find(".dN")}),0),$("#lookupdiv").removeClass("p20").addClass("mB20"),$("#emailDetailIframeContent").contents().find("body").css("overflow","hidden"),$("#emailDetailIframeContent").contents().find("#emailDetailContentDivOuter").perfectScrollbar({wheelSpeed:1,wheelPropagation:!0,suppressScrollX:!1}),setTimeout((function(){$("#emailDetailIframeContent").contents().find("body").css("margin","0");var e=$("#emailDetailIframeContent").contents().find(".ecMailDp").hasClass("emptyImgContainer")?"/nophoto_80ea3af_.png":$("#emailDetailIframeContent").contents().find(".ecMailDp").attr("src");if($("#emailDetailIframeContent").contents().find("#emailDetailContentDivOuter .getFirstEmailContent").height()>545&&$("#emailDetailIframeContent").contents().find("#mailClientPopupCss").addClass("headerFixCssAfter"),$("#emailDetailIframeContent").contents().find("#emailDetailContentDivOuter").perfectScrollbar({wheelSpeed:1,wheelPropagation:!0,suppressScrollX:!1}),"nophoto_80ea3af_.png"==e.substr(e.lastIndexOf("/")+1))$("#emailDetailIframeContent").contents().find(".ecMailDp").addClass("emptyImgContainer"),createAvatar();else{var t='<img src="'+e+'" alt="" style=" border:1px solid #fff;border-radius:50%;" height="48" width="48">';$("#emailDetailIframeContent").contents().find(".ecMailDp").parent().append(t),$("#emailDetailIframeContent").contents().find(".ecMailDp").remove()}}),100)})),t.css({position:"absolute",width:"1000px",height:"600px",zIndex:33,opacity:"1"}).show(),setPopCenter(t),t.addClass("topAlignEmailDetail"),freezeBackground(),d?($L("#FreezeLayer").addClass("zIncSpCase"),t.addClass("zIncSpCase")):$("#FreezeLayer").css({"z-index":"32"}),EvalInnerScript(t.get(0))}),m)}AjaxAPI.prototype.post=function(){this.loadingimg&&loadAjaxTab(),this.freezebg&&freezeBackground();var e=this.id;this.url=Crm.getPortalURL(this.url),$.ajax({type:"POST",url:this.url,data:this.params,dataType:this.dataType||"html",complete:this.callbackfn,success:function(t){ajaxSuccessCallBack(e,t,void 0)}})},AjaxAPI.prototype.get=function(){this.loadingimg&&loadAjaxTab(),this.freezebg&&freezeBackground();var e=this.id;this.url=Crm.getPortalURL(this.url),$.ajax({type:"GET",url:this.url,data:this.params,dataType:this.dataType||"html",complete:this.callbackfn,success:function(t){ajaxSuccessCallBack(e,t,void 0)}})},$(window).on("popstate",(function(){closealertMail("emailalert")}));var validation={};function closeUnneccessaryPopup(){var e=$("#lookupdiv");e.html(""),e.css({display:"none"});var t=$L("crm-ziaforemails")[0];t&&t.component.executeMethod("close");removeFreezeLayer(),$("#qCreate").html(""),$("#eventCreatePopup").html(""),$L("#createEditCallDiv").css("display","none"),$("#diNotificationDetails").css({right:"-900px",display:"none"}),$("#diNotificationDetailsContent").empty()}function getOnclickAttr(e){var t,a=e.response.type;switch(a){case"Event":t={event:"event",eventType:"Meeting",isActivityCreated:e.response.isActivityCreated,title:e.response.title,startMillis:e.response.startMillis,endMillis:e.response.endMillis,entityId:e.response.entityId,module:e.response.module,name:e.response.name};break;case"Call":t={event:"event",eventType:a,isActivityCreated:e.response.isActivityCreated,title:e.response.title,startMillis:e.response.startMillis,entityId:e.response.entityId,module:e.response.module,name:e.response.name};break;case"Task":t={event:"event",eventType:a,isActivityCreated:e.response.isActivityCreated,title:e.response.title,endMillis:e.response.endMillis,entityId:e.response.entityId,module:e.response.module,name:e.response.name}}return t}function viewMail(e,t,a,i,r,l,n,s,o,d,c,m,u,p){var g=null;if(p){g="action=viewMail&msgid="+e+"&user_id="+o.response.userId+"&module="+o.response.module+"&entId="+s+"&mailType="+encodeURIComponent(t)+"&sentOrReceived="+i+"&entEmailId="+encodeURIComponent(o.response.emailId)+"&flag="+n+"&isZiaNotificationsView=true";var v=csrfParamName+"="+encodeURIComponent(csrfToken),f=Crm.getCrmBasePath()+"/mailer/EntReply.do?"+g;(new crmRequestPool).initiate({action:f,type:"GET",success:function(e){if(Lyte.Component.registeredComponents["crm-ziaforcns"])validation.showZiaForCNSView(e,o);else{var t=networkUtils.returnDependencyFiles(["crm-ziaforcns.js"],crmConstants.jsStaticPathForLyte),a=networkUtils.returnDependencyFiles(["crm-ziaforcns.css"],crmConstants.lessStaticPathForLyte),i=t.concat(a);Lyte.injectResources(i,void 0,(function(){validation.showZiaForCNSView(e,o)}))}},error:function(){_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("error.database.problem"),ltPropType:"error",ltPropDuration:"2000"}})}})}else if(u){g="action=viewMail&msgid="+e+"&user_id="+o.response.userId+"&module="+o.response.module+"&entId="+s+"&mailType="+encodeURIComponent(t)+"&sentOrReceived="+i+"&entEmailId="+encodeURIComponent(o.response.emailId)+"&flag="+n+"&isZiaNotificationsView=true";v=csrfParamName+"="+encodeURIComponent(csrfToken),f=Crm.getCrmBasePath()+"/mailer/EntReply.do?"+g;(new crmRequestPool).initiate({action:f,type:"GET",success:function(e){if(Lyte.Component.registeredComponents["crm-ziaforemails"])validation.showZiaForEmailsView(e,o,c);else{var t=networkUtils.returnDependencyFiles(["crm-ziaforemails.js"],crmConstants.jsStaticPathForLyte),a=networkUtils.returnDependencyFiles(["crm-ziaforemails.css"],crmConstants.cssStaticPathForLyte),i=t.concat(a);Lyte.injectResources(i,void 0,(function(){validation.showZiaForEmailsView(e,o,c)}))}},error:function(){_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("error.database.problem"),ltPropType:"error",ltPropDuration:"2000"}})}})}else{var h=null!=event?$(event.target):null;if(null==h||null!=h&&"INPUT"!=h.prop("tagName")&&"I"!=h.prop("tagName")&&!h.hasClass("erlThreadViewIcon")&&!h.hasClass("MoveToMailIcon")&&!h.hasClass("ernSummery")){var b=$("#krp_mail_conversation").outerWidth(),C=null,y="",I=null,w=$("#isFromNewAPI"),A=null,E=null;C=null;n=void 0!==n&&n;var T=$("#"+e),S=$("#isMailAppsFlow"),L="true"===(S.length>0?S.val():$(getOpenerObj("isMailAppsFlow")).value),_=$("#selectMails"),O=_.length>0?_:$(getOpenerObj("selectMails"));if(i==crmConstants.Z_Retrying||i==crmConstants.Z_Scheduled||r==crmConstants.ZFSDown){if($(o.parentElement).closest("tr").find(".mailcontDiv").find(".import_unsuccess_img").length<=0){var M=$("#"+e),P=document.createElement("span");$(P).attr({class:"import_unsuccess_img",id:"errorMsg_"+i,onmouseover:"crmui.showTooltip(I18n.getMsg('crm.zfs.down.preview'),false,'left',$(this))",onclick:"crmui.showTooltip(I18n.getMsg('crm.zfs.down.preview'),false,'left',$(this))",onmouseleave:"crmui.hideTooltip()"});var k=M.closest("div");return M.css({cursor:"auto",color:"black"}),k.append(P),setTimeout((function(){$(o).closest(".mailcontDiv").find("#errorMsg_"+i).trigger("click")}),100),void setTimeout((function(){crmui.hideTooltip()}),3e3)}return}if($("#krp_mail_conversation").length>0)A=$$rightPanel.currentModule,E=$$rightPanel.entityId,C=s;else if(E=$("#id").val(),A=getObj("module").value,_.length>0){var R=null==_[0].value?_[0].getAttribute("lt-prop-selected"):_[0].value;w.length>0&&(R=_[0].getAttribute("lt-prop-selected")),C="IMAP_ALL"===R||"ALL_MAIL_VIEW"===R||"POP_ALL"===R?s:R.substring(0,R.indexOf("_"))}var D=$("#associatedContEmail"),U=document.getElementById("subvalue_EMAIL"),F=document.getElementById("subvalue_ADDN_EMAIL"),x=document.getElementById("secondMail"),N=$("#primEmail");if(o&&$(o).attr("data-searchid"))y=$(o).attr("data-searchid");else if(D.length>0)y=D.val(),(I=F?F.innerText:"")||(I=x&&x.value?x.value:""),""!=I&&I.indexOf("<i")>1&&(I=I.substring(0,I.indexOf("<i")));else if(Lyte.Router.getRouteInstance()&&"canvas"==Lyte.Router.getRouteInstance().routeName&&"Potentials"==A&&null!=N.val())y=N.val();else if(U||F){if(""!=(y=U?U.innerText:"")&&y.indexOf("<i")>1&&(y=y.substring(0,y.indexOf("<i"))),(I=F?F.innerText:"")||(I=x&&x.value?x.value:""),""!=I&&I.indexOf("<i")>1&&(I=I.substring(0,I.indexOf("<i"))),null!=y&&!validationUtils.isValidEmail(y)&&null!=I&&!validationUtils.isValidEmail(I))return void alert(I18n.getMsg("crm.primary.no.valid.email",I18n.getMsg(singularModule)));validationUtils.isValidEmail(y)||(y=null)}o&&$(o).attr("data-isunread")&&(n=$(o).attr("data-isunread"));var B=$("#contactSelDropdownInAcc"),j="";if(B.length>0&&(j=w.length>0?B.attr("lt-prop-selected"):$("#contactSelDropdownInAcc :selected").attr("value")),"Accounts"===A&&B.length>0&&"ACCOUNTS_ALL"!=j)if(A="Contacts","ALL"!=j){E=j;var V=B.children(":selected").attr("email");w.length>0&&(V=$(document.querySelector("lyte-drop-item[data-value='"+j+"']")).data().email),V&&V.indexOf(",")>-1?(y=V.split(",")[0],I=V.split(",")[1]):y=V}else E=d;var H=$(o).attr("purpose");if(L&&"ALL"!==j){var z=null!=O?O.attr("lt-prop-selected"):null;!z||"IMAP_ALL"!==z&&"ALL_MAIL_VIEW"!==z||(t=H)}("CRMMASSMAIL"===H||o&&"ernSummery2"==o.id&&"CRMMASSMAIL"===$(o).parent().find(".emailSubjectEllipisis").attr("purpose"))&&(t="ALLUSERSMAILS");g="action=viewMail&msgid="+e+"&user_id="+C+"&module="+A+"&entId="+E+"&mailType="+encodeURIComponent(t)+"&sentOrReceived="+i+"&entEmailId="+encodeURIComponent(y)+"&flag="+n;if(null!=I&&validationUtils.isValidEmail(I)&&(g+="&secondaryEmailId="+encodeURIComponent(I)),"Potentials"==A&"dealsOnly"===$("#dealOnlyDropDown").val()&&(g+="&isDealsMail=true"),m&&(g+="&isForSummary=true"),($(o).closest("#RelatedListCommonDiv").length||$("crm-emailsrl-canvas-view").length>0)&&(g+="&source=relatedList"),c&&(g+="&id="+c),loadAjaxTab(""),"MailClient"===$$rightPanel.featureName||$(".outlookInfoCont").is(":visible"))if($(".outlookInfoCont").is(":visible")){f=Crm.getCrmBasePath()+"/mailer/EntReply.do?"+g;f+="&isfromOutlookRightPanel=true",f+="&mailRead=false",$$rightPanel.openNewWindowFromOutlook(f,550,1100),$(".loadingsplash").hide()}else"MailClient"==$$rightPanel.featureName&&("true"===n&&(g+="&mailRead=false"),g+="&fromSource="+$$rightPanel.featureName,o&&($(o).attr("data-isunread","false"),$(o).addClass("erpSelectedMail"),$(o).css({width:b-40})),"salesinbox"==$$rightPanel.rightPanelSource?$$rightPanel.loadEmailDetailView(g):EmailTabHomeUtil.loadEmailDetailViewFromConversations(g));else{v=csrfParamName+"="+encodeURIComponent(csrfToken);var f=Crm.getCrmBasePath()+"/mailer/EntReply.do?"+g;mR(f,(function(t){if("object"!=typeof t&&"null"!=t&&null!=t){window.getSelection().removeAllRanges();var a=$("#lookupdiv");a.parent("crm-zsurvey-rl-body").length>0&&(a=$(".showhide").find("#lookupdiv"));var i=$("#isNewMailRLEnabled");if(commonUtils.showHideLoadingDiv(),document.getElementById("iskanbanview")&&"true"===document.getElementById("iskanbanview").value)if(""!==mailtreeStructure)$(".recentDate").html($(mailtreeStructure).closest("tr").find(".kvMailtreedate").html()),$(".tkvMailBubble").addClass("hide"),$(".mailConversationList").css("background","#ffffff"),$(mailtreeStructure).closest("li").css("background","#f3f3f3"),$(mailtreeStructure).closest("li").find(".tkvMailBubble").removeClass("hide"),$(".thread td em").css("color","#7a7a7a"),$(".thread td .kvMailtreedate").css("color","#7a7a7a"),$(mailtreeStructure).find("em").css("color","#464646"),$(mailtreeStructure).closest("td").siblings("td").find(".kvMailtreedate").css("color","#464646"),mailtreeStructure="";else{$(".recentDate").html($("#mailList"+e).find(".maildate").text()),$(".thread td em").css("color","#7a7a7a"),$(".mailConversationList").css("background","#ffffff"),$(".tkvMailBubble").addClass("hide");var r=$("#mailList"+e);r.css("background","#f3f3f3"),r.find(".tkvMailBubble").removeClass("hide"),r.find("#mailconvstatus")&&("tkvincoming"===r.find("#mailconvstatus").val()?$(".tkvmailstatus").html("<span class='dIB kanbanviewImages tkvincoming'></span>"):$(".tkvmailstatus").html("<span class='dIB kanbanviewImages tkvoutgoing'></span>"))}o&&($("#krp_mail_conversation").length>0?$(o).removeClass("kso_mail_read_status0").addClass("kso_mail_read_status1").attr("data-isunread","false"):Crm.userDetails.USER_ID===s&&$(o).removeClass("sbFont black").attr("data-isunread","false")),w.length>0&&T.hasClass("crm-font-bold")&&T.removeClass("crm-font-bold");var l=$(document.createElement("iframe")),n="";Crm.frameOriginForEmail&&""!=Crm.frameOriginForEmail&&(n="?"+Crm.frameOriginForEmail),l.attr({id:"emailDetailIframeContent",style:"opacity:1; width:100%; height:100%;clear: both; border: medium none",src:"/crm/html/content1.html"+n}),a.html(""),0==$("crm-emails-related-list").length&&"true"!=i.val()&&a.addClass("edvContainer"),a.append(l).append('<div id="edvFreezeLayer" class="hide"><div id="loading-bar-spinner" class="spinner"><div class="spinner-icon"></div></div></div>'),$("#emailDetailIframeContent").load((function(){setTimeout((function(){$("#emailDetailIframeContent").parent().css("z-index",28),document.getElementById("emailDetailIframeContent").contentWindow.document.write(t),0==$("crm-emails-related-list").length&&"true"!=i.val()&&mailsetCenter("lookupdiv")}),0),$("#lookupdiv").removeClass("p20").addClass("mB20"),$("#emailDetailIframeContent").contents().find("body").css("overflow","hidden"),$("#emailDetailIframeContent").contents().find("#emailDetailContentDivOuter").perfectScrollbar({wheelSpeed:1,wheelPropagation:!0,suppressScrollX:!1}),setTimeout((function(){var e=$("#emailDetailIframeContent");$("#emailDetailIframeContent").contents().find("body").css("margin","0");var t=$("#emailDetailIframeContent").contents().find(".ecMailDp").hasClass("emptyImgContainer")?"/nophoto_80ea3af_.png":$("#emailDetailIframeContent").contents().find(".ecMailDp").attr("src");if($("#emailDetailIframeContent").contents().find("#emailDetailContentDivOuter .getFirstEmailContent").height()>545&&$("#emailDetailIframeContent").contents().find("#mailClientPopupCss").addClass("headerFixCssAfter"),$("#emailDetailIframeContent").contents().find("#emailDetailContentDivOuter").perfectScrollbar({wheelSpeed:1,wheelPropagation:!0,suppressScrollX:!1}),t&&"nophoto_80ea3af_.png"==t.substr(t.lastIndexOf("/")+1))$("#emailDetailIframeContent").contents().find(".ecMailDp").addClass("emptyImgContainer"),createAvatar();else{var a='<img src="'+t+'" alt="" style=" border:1px solid #fff;border-radius:50%;" height="48" width="48">';$("#emailDetailIframeContent").contents().find(".ecMailDp").parent().append(a),$("#emailDetailIframeContent").contents().find(".ecMailDp").remove()}$("#edvFreezeLayer").length&&$("#edvFreezeLayer").addClass("hide"),"canvas"==Lyte.Router.getRouteInstance().routeName&&e.contents().find(".enrichData").hide(),$("email-summary").hasClass("hide")||hideEmailSummaryDiv()}),200)})),freezeBackground(),$("#FreezeLayer").css({"z-index":"24"}),$("#chatbotDiv #kso_mails_list .kso_eachMailContainer").length?(a.css({position:"absolute",width:"1000px",height:"600px",zIndex:35,opacity:"1"}).show(),$("#FreezeLayer").css({"z-index":"33"})):o&&null!=o._callee?"CRM-EMAILS-RELATED-LIST"===o._callee.tagName?(a.addClass("topAlignEmailDetail").show(),setPopCenter(a)):a.css({position:"absolute",width:"1000px",height:"600px",zIndex:30,opacity:"1"}).show():$("#isFromNewAPI").length>0||"true"==i.val()?(a.addClass("topAlignEmailDetail").show(),"true"==i.val()&&setPopCenter(a)):a.css({position:"absolute",width:"1000px",height:"600px",zIndex:30,opacity:"1"}).show(),EvalInnerScript(a.get(0)),$(".currViewedMail").removeClass("currViewedMail"),e&&$("#"+e).addClass("currViewedMail")}}),v)}}}}function setPopCenter(e){var t=e.innerWidth(),a=($(window).innerWidth()-t)/2;e.css("left",a)}function addTempFreezeLayer(){var e;e=$(".etTrendsWrapper").length?"<div class='temp_freezelayer emailAI op3' style='z-index: 313' />":"<div class='temp_freezelayer emailAI zI28 op3'/>",$("body").append(e)}function removeTempFreezeLayer(){var e=$(".temp_freezelayer.emailAI");e&&e.remove()}function openEventCreate(e,t,a,i){var r;addTempFreezeLayer(),null==(r=Crm.frameOriginForEmail&&Crm.frameOriginForEmail.includes("one")&&Crm.frameOriginForEmail.includes("zoho.com")?Events:parent.Events)&&(r=Events),r.globalCreate(event,"quickcreate",void 0,void 0,void 0,void 0,void 0,(function(){if(addTempFreezeLayer(),$("#Events_fldRow_SUBJECT").find("input").val(e),$("#Events_fldRow_LOCATION").find("input").val(t),0!=a){var l=new Date(a);a=l.getTime(),0==i&&(i=l.getTime())}if(0!=i){var n=new Date(i);i=n.getTime()}r.setStartDateAndTime(a),a==i?r.setEndDateAndTime(i):r.setEndDateAndTime(!1,!1,i);var s=$("#module").val(),o=$("#entityName").val(),d=$("#id").val(),c=$("#subvalue_EMAIL"),m=""==c.text()?null:c.text(),u=$("#Crm_Events_CONTACTID_select");"Leads"==s||"Contacts"==s?u.val(s).change():u.val("Others").change();var p=$("#Crm_Events_CONTACTID");if("Contacts"==u.val()){var g=$("#value_ACCOUNTID").find("a"),v=null!=g.data().params?""==g.data().params.id?null:g.data().params.id:null,f=""==g.text()?null:g.text(),h=$("zpb-phone"),b=null==h.attr("number")?null:h.attr("number"),C=JSON.stringify({accountName:f,accountId:v,cntPhone:b,cntEmail:m});encodeURIComponent(C);if(p.val(o),p.data("id",d),""!=f)(y=$("#Crm_Events_SEID")).val(f),y.data("id",v)}else if("Leads"==u.val())p.val(o),p.data("id",d);else{var y;(y=$("#Crm_Events_SEID")).val(o),y.data("id",d)}var I=$("#addpartCheckbox");if($("#addpartCheck").show(),$("#addpartCheckboxTitle").text(I18n.getMsg("crm.event.add.contact",[o])),I.attr({recId:d,module:s,onclick:"Events.addRelatedParticipant($(this),'"+d+"','"+s+"')"}),$("#signalDetailViewClose").length>0&&$("#ntcInnerDivContent").length>0){var w=$(".temp_freezelayer");w.removeClass("zI28"),w.css("z-index","33"),$("#eventCreatePopup").css("z-index","34")}}))}function activityCreate(e,t,a,i,r,l,n,s){if("Event"==t)return openEventCreate(a,l,i,r),!0;var o,d,c,m="";o=n||(getObj("id")?getObj("id").value:null),d=s||((c=$("input[name=relmodule]")).length?c.val():getObj("property(module)")?getObj("property(module)").value:getObj("module")?getObj("module").value:null);var u,p=$("#module").val();u=n||$("#id").val();var g="",v=!0;if("Task"==t){var f=Crm.getCrmBasePath()+"/QCreate.do?module=Tasks&id="+o+"&relmodule="+d+"&primmodule="+p+"&entityid="+u;f+=Q.getCvidAndRecordNum(),quickTask.init(),m="NewTask"}else if(isNewCallView)v=!1,Crm.globalCreate(e,"emailsAI",$(this),i);else{if($("#relatedPageContent").length)for(var h=crmRelatedList.personalityArr,b="string"==typeof h?h.split("||"):[],C=b.length,y=0;y<C;y++)if("activityhistorypersonality"===b[y].split("_")[0]){b[y];break}m="NewCall";f=Crm.getCrmBasePath()+"/QCreate.do?module=Calls&id="+o+"&relmodule="+d+"&primmodule="+p+"&entityid="+u;f+=Q.getCvidAndRecordNum(),$(".outlookqCreate").length&&(f+="&isfromOutlookRightPanel=true")}Crm.isFromSalesInbox&&(f+="&isFromSalesInbox=true"),v&&(Q.url=f,Q.anchor="",Q.operation=m,Q.callFrom="RelatedList",g=g+"&crmcsrfparam="+csrfToken,mR(f+"&fromCreate=QuickCreate",(function(e){Q.loadResponse(e,a,i,t)}),g))}function reloadActivityRL(){var e=$("#module").val(),t=$("#id").val();(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/NewRelatedList.do?action=getData&type=jsp&id="+t+"&module="+e+"&cvid="+t+"&pname=ACTIVITYPERSONALITY",type:"GET",success:function(a){var i=(a=a.replace("parent.crmRelatedList.load","window.parent.crmRelatedList.load").replace("parent.crmRelatedList.Module",'"'+e+'"').replace("parent.crmRelatedList.EntityId",t)).match(/window.parent.crmRelatedList.load(\S+)/);null!==i&&new Function("window.parent.crmRelatedList.load"+i[1])()}})}function createAvatar(){if($("#emailDetailIframeContent").contents().find(".emptyImgContainer").length){$("#emailDetailIframeContent").contents().find(".ecMailDp").removeAttr("style");var e=["0px 0px","-53px 0px","-103px 0px","-154px 0px","-205px 0px","0px -55px","-53px -55px","-103px -55px","-154px -55px","-205px -55px"],t=e[Math.floor(Math.random()*e.length)];$("#emailDetailIframeContent").contents().find(".emptyImgContainer").css("background-position",t),dvTitle=$("#emailDetailIframeContent").contents().find(".ecSenderInfo").text(),dvTitle=dvTitle.trim(),$("#emailDetailIframeContent").contents().find(".emptyImgContainer").html(dvTitle.substring(0,1))}}function populateReplyDetailsFromIframe(e){var t=null,a=null,i=null,r=null,l=null,n=null,s=null,o=null,d=null,c=null;if(void 0!==e&&"null"!==e||(e=""),$("#emailDetailIframeContent"+e).length){var m=$("#emailDetailIframeContent"+e).contents();m.find("#fromAddress").length&&(i=m.find("#fromAddress").val()),m.find("#toAddress").length&&(r=m.find("#toAddress").val()),m.find("#ccAddress").length&&(l=m.find("#ccAddress").val()),m.find("#bccAddress").length&&(n=m.find("#bccAddress").val()),m.find("#replyToAddress").length&&(s=m.find("#replyToAddress").val());var u=m.find("#subject");u.length&&(o=encodeURIComponent(u.val().replace(/[\n\r]/g,"").trim())),m.find("#msgid").length&&(t=m.find("#msgid").val()),m.find("#sentOrReceived").length&&(a=m.find("#sentOrReceived").val()),m.find("#mid").length&&(d=m.find("#mid").val());var p=m.find("#gmailAPImsgId");Crm.userDetails.isNewEditor&&p.length&&(c=p.val())}var g="&fromAddr="+encodeURIComponent(i)+"&toAddr="+encodeURIComponent(r)+"&ccAddr="+encodeURIComponent(l)+"&bccAddr="+encodeURIComponent(n)+"&replyToAddr="+encodeURIComponent(s)+"&inReplyTo="+encodeURIComponent(null)+"&msgid="+t+"&sub="+o+"&sentOrReceived="+a+"&mid="+d;return c&&(g=g+"&gmailAPImsgId="+c),g}function populateReplyDetailsFromSummary(){var e=$L("#summaryMailDet"),t=e.data("msgid"),a=e.data("sentOrReceived"),i=e.data("from"),r=void 0!==e.data("to")?e.data("to"):null,l=void 0!==e.data("cc")?e.data("cc"):null,n=void 0!==e.data("bcc")?e.data("bcc"):null,s=void 0!==e.data("reply_to")&&""!==e.data("reply_to")?e.data("reply_to"):null,o=e.data("subject");o&&(o=encodeURIComponent(o.replace(/[\n\r]/g,"").trim()));return hideEmailSummaryDiv(),"&fromAddr="+encodeURIComponent(i)+"&toAddr="+encodeURIComponent(r)+"&ccAddr="+encodeURIComponent(l)+"&bccAddr="+encodeURIComponent(n)+"&replyToAddr="+encodeURIComponent(s)+"&inReplyTo="+encodeURIComponent(null)+"&msgid="+t+"&sub="+o+"&sentOrReceived="+a+"&mid=null"}function hideEmailSummaryDiv(){$("email-summary").addClass("hide"),$("#ernOptions").addClass("hide"),$("#ecnAttachment").addClass("hide"),$L(".ernActiveSummary").removeClass("ernActiveSummary");var e=document.querySelector("#replyOptionsMenu");e&&e.ltProp("show",!1);var t=document.querySelector("#ecnAttachmentUl");t&&t.ltProp("show",!1);var a=document.querySelector("#emailSummaryPopOver");a&&a.ltProp("show",!1)}function populateReplyDetailsForMailMagnet(e,t,a){var i,r=null,l=null,n=null,s=null,o=null,d=null,c=null,m=null,u=null;return i=a||getObj("fromAddress").value,e&&"true"!==e.value?null!=getObj("toAddress")&&(n=t||getObj("toAddress").value):null!=$("#toAddress")&&(n=t||$("#toAddress")[0].value),null!=getObj("ccAddress")&&(addr=getObj("ccAddress").value)&&(s=addr),null!=getObj("bccAddress")&&(addr=getObj("bccAddress").value)&&(o=addr),null!=getObj("replyToAddress")&&(d=getObj("replyToAddress").value),null!=getObj("inReplyTo")&&(c=getObj("inReplyTo").value),null!=getObj("subject")&&(m=encodeURIComponent(getObj("subject").value)),null!=getObj("msgid")&&(r=getObj("msgid").value),null!=getObj("sentOrReceived")&&(l=getObj("sentOrReceived").value),null!=getObj("mid")&&(u=getObj("mid").value),"&fromAddr="+encodeURIComponent(i)+"&toAddr="+encodeURIComponent(n)+"&ccAddr="+encodeURIComponent(s)+"&bccAddr="+encodeURIComponent(o)+"&replyToAddr="+encodeURIComponent(d)+"&inReplyTo="+encodeURIComponent(c)+"&msgid="+r+"&sub="+m+"&sentOrReceived="+l+"&mid="+u}function replyEmail(e,t,a,i,r,l,n,s){EmailCompose.action=a;var o=document.getElementById("iskanbanview");if(!r||"entityMailView"!=r&&"signalDetailView"!=r)if(r&&"summaryView"===r)d=populateReplyDetailsFromSummary();else d=populateReplyDetailsForMailMagnet(o,l,n);else var d=populateReplyDetailsFromIframe(s);var c=objectUtils.parseURLParamString(d),m=c.msgid;c.gmailAPImsgId&&(m=c.gmailAPImsgId);var u=t,p=EmailLaunchUtil.getApiNameForModule(e),g="Sent"===c.sentOrReceived||"Opened"===c.sentOrReceived||"Clicked"===c.sentOrReceived||"Bounced"===c.sentOrReceived,v=c.user_id&&"null"!==c.user_id?c.user_id:Crm.userDetails.USER_ID;if($("#krp_mail_conversation").length>0)v=-1===(v=$("#krp_sel_mail_user").attr("userId"))||"-1"===v||"-1"===v?"null":v;else{var f=document.getElementById("selectMails");if(f){var h=null==f.value?$(f).attr("lt-prop-selected"):f.value;if("ALL"!==h&&(v=h.substring(0,h.indexOf("_")),"IMAP_ALL"===h||"ALL_MAIL_VIEW"===h)){var b=$("#emailDetailIframeContent").contents();if(b=b[0])v=b.getElementById("mailUserId").value;else if("summaryView"===r){v=$("#rLEmailSub_"+c.msgid).data("userid")}}}}v&&"null"!==v&&!isNaN(v)||(v=Crm.userDetails.USER_ID);var C="/crm/v2/__internal/"+p+"/"+u+"/Emails/"+m+"/actions/"+a;d="user_id="+v+"&mail_type="+i+"&sent="+g;(new crmRequestPool).initiate({action:C,headers:{"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken},data:d,type:"GET",success:function(t){EmailLaunchUtil.postResourceLoadInitialization=function(){EmailSendingUtil.action=a},EmailLaunchUtil.launchReplyMail(t,e,u)},error:function(){renderingUtils.showCustomAlert(I18n.getMsg("crm.email.error"))}})}function replyMail(e,t,a,i,r,l,n,s){var o=!1,d=document.getElementById("iskanbanview");if(window.addEventListener("message",receiveMessage,!1),Crm.userDetails.isNewEditor){if(EmailSendingUtil.isReplyClicked)return;return setTimeout((function(){EmailSendingUtil.isReplyClicked=!1}),2e3),EmailSendingUtil.isReplyClicked=!0,EmailSendingUtil.entityId=t,EmailLaunchUtil.postResourceLoadInitialization=function(){EmailSendingUtil.action=a},void replyEmail(e,t,a,i,r,l,n,s)}var c="action=isEmailOptOut&entityId="+t+"&moduleName="+e;(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/mailer/EntReply.do",type:"POST",async:!1,data:c,success:function(c){if(null!==(o=c)&&"true"===o)alert(I18n.getMsg("crm.label.emailoptout.alert.message"));else{var m=document.getElementById("subvalue_EMAIL"),u=m?""==m.innerText?" ":m.innerText:" ";if(!r||"entityMailView"!=r&&"signalDetailView"!=r)if(r&&"summaryView"===r){p=populateReplyDetailsFromSummary();"allContacts"===i&&(i="ALLUSERSMAILS")}else p=populateReplyDetailsForMailMagnet(d,l,n);else var p=populateReplyDetailsFromIframe(s);c=objectUtils.parseURLParamString(p);if(validationUtils.checkEmailLimitExceed(c.toAddr,c.ccAddr,c.bccAddr))renderingUtils.showCustomAlert(I18n.getMsg("crm.email.bcc.check"));else{var g=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/mailer/EntReply.do?action="+a+"&entId="+t+"&module="+e+p+"&entityMail="+encodeURIComponent(u));if(void 0!==s&&"null"!==s&&(g=g+"&notificationId="+s),$("#mid").length>0&&(g+="&mid="+$("#mid").val()),d&&"true"===d.value&&(g+="&iskanbanview=true",$("#spacerDiv_Btm").hide()),""!=a&&"forward"==a){var v="";if($("#krp_mail_conversation").length>0)v=-1==(v=$("#krp_sel_mail_user").attr("userId"))?"null":v;else{var f=getObj("selectMails");if(f){var h=null==f.value?$(f).attr("lt-prop-selected"):f.value;if(v=h.substring(0,h.indexOf("_")),"POP_ALL"===h||"IMAP_ALL"===h||"ALL"===h||"ALL_MAIL_VIEW"===h){var b=$("#emailDetailIframeContent").contents();if(v=b.find("#mailUserId").val(),0===b.length&&"summaryView"===r){var C=$("#rLEmailSub_"+c.msgid);v=C.data("userid"),"CRMMASSMAIL"===C.data("emailtype")&&(i="ALLUSERSMAILS")}}}else v=Crm.userDetails.USER_ID}g+="&user_id="+v}if(i&&(g+="&mailType="+encodeURIComponent(i)),"recentMailView"==r)return g+="&source=recentMailView",hide("rmNavDiv"),new AjaxAPI({id:"rmDetailView",url:g,callbackfn:function(e){EvalInnerScript(document.getElementById("rmDetailView"))}}).post(),!1;openPopUp("entreplyWin",this,g,"entreply",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes")}}}})}function updateMailRange(e,t,a){if(0==e&&(Crm.mailIndex={}),t.mailRange){0==e&&(crmRelatedList.mailRange={});var i=t.mailRange;i&&(crmRelatedList.mailRange[e]=i),a&&crmRelatedList.mailRange[e+10]&&delete crmRelatedList.mailRange[e+10]}else if(t.next_index&&"number"!=typeof t.next_index&&t.next_index.length>5){var r=t.next_index;r&&(Crm.mailIndex[e]=r),a&&Crm.mailIndex[e+10]&&delete Crm.mailIndex[e+10]}}function getCassMailsRange(e,t){var a,i="";return crmRelatedList.mailRange&&crmRelatedList.mailRange[e]&&(t?0!=(e-=10)&&crmRelatedList.mailRange[e-10]&&(a=crmRelatedList.mailRange[e-10].cassRange):a=crmRelatedList.mailRange[e].cassRange,a&&(i+="&cassRangeEnd="+a.cassRangeEnd,i+="&lastMailTime="+a.lastMailTime)),i}function getMailAPIRange(e,t){var a,i="";return crmRelatedList.mailRange&&crmRelatedList.mailRange[e]&&(t?0!==(e-=10)&&crmRelatedList.mailRange[e-10]&&(a=crmRelatedList.mailRange[e-10].mailapiRange):a=crmRelatedList.mailRange[e].mailapiRange,a&&(i+="&mailapiLastIndex="+a.mailapiLastIndex)),i}function showMailsListViaAPI(e,t,a,i,r){var l=$("#module"),n=l.length>0?l.val():getOpenerObj("module").value,s=$("#id"),o=s.length>0?s.val():getOpenerObj("id").value,d=!1,c=1,m=null==moduleApiMapping[n]?opener.window.moduleApiMapping[n]:moduleApiMapping[n];"Deals"!=n&&"Deals"!=m||(n="Potentials",m="Potentials");var u="/crm/v2.2/"+m+"/"+o+"/Emails",p={},g="",v=(Q=$("#selectMails")).length>0?Q:$(getOpenerObj("selectMails")),f=$("#scheduledMails"),h=f.length>0?f:$(getOpenerObj("scheduledMails")),b=$("#dealOnlyDropDown"),C=b.length>0?b:$(getOpenerObj("dealOnlyDropDown")),y=$("#relatedMailList"),I=y.length>0?y:$(getOpenerObj("relatedMailList")),w=$("#sendEntityMailLink"),A=$("#contactSelDropdownInAcc"),E=(A=A.length>0&&"Accounts"==n?A:$(getOpenerObj("contactSelDropdownInAcc"))).attr("lt-prop-selected"),T=$("#accountsScheduled");T=T.length>0?T:$(getOpenerObj("accountsScheduled"));var S=$(".selectTab"),L=S.length>0?S:window.opener.$(".selectTab"),_=$("#draftMails"),O=_.length>0?_:$(getOpenerObj("draftMails")),M=(V=$("#mails")).length>0?V:$(getOpenerObj("mails")),P=document.getElementById("accountsDrafts"),k="Potentials"==n&&C.length>0;P=$(P).length>0?P:getOpenerObj("accountsDrafts");var R=$(".rLETabsElement");R=R.length>0?R:$(opener.document.getElementsByClassName("rLETabsElement"));var D=$(".rLESelectAction");D=D.length>0?D:$(opener.document.getElementsByClassName("rLESelectAction"));var U=$('[lt-prop-name="ernHead"]');U=U.length>0?U:null!=opener?$(opener.document.querySelector('[lt-prop-name="ernHead"]')):U;var F=$("#isMailAppsFlow"),x="true"===(F.length>0?F.val():$(getOpenerObj("isMailAppsFlow")).value);if(h.show(),O.show(),commonUtils.showHideLoadingDiv(!0),"block"==D.css("display")&&(U.find("input").prop("checked")?U.attr("lt-prop-checked",!1):(D.hide(),R.show(),$("#mailsToDelete").val(""),$("#mailsSub").html(""),$(".eRListPartialSelect").removeClass("eRListPartialSelect"))),"scheduledMails"==r){if(e="scheduled_in_crm",I.hide(),"Accounts"===n){var N=getSelectedContact(L);A.hide(),$(P).hide();var B=document.querySelector("#accountsScheduled"),j=null==B?opener.document.querySelector("#accountsScheduled"):B;j.ltProp("selected",N),"ALL"==N?(j.setData("ltPropSelected","ALL"),e="all_contacts_scheduled_crm_emails",w.hide()):0==A.length?(e="scheduled_in_crm",w.hide()):(j.setData("ltPropSelected",N),u="/crm/v2.2/Contacts/"+N+"/Emails",e="scheduled_in_crm",w.show()),$(j).show()}L.removeClass("selectTab"),h.addClass("selectTab")}else if("mails"==r){if("Accounts"===n&&A.length>0){N=getSelectedContact(L);E=N,A[0].ltProp("selected",E),A.show(),T.hide(),$(P).hide(),"ACCOUNTS_ALL"!=E&&"ALL"!=E?(u="/crm/v2.2/Contacts/"+E+"/Emails",w.show()):w.hide()}else I.show();var V;L.removeClass("selectTab"),(M=(V=$("#mails")).length>0?V:$(getOpenerObj("mails"))).addClass("selectTab")}else if("draftMails"==r){if(I.hide(),e="drafts","Accounts"===n){N=getSelectedContact(L);A.hide(),T.hide(),P.ltProp("selected",N),"ALL"!=N?(u="/crm/v2.2/Contacts/"+N+"/Emails",e="drafts",w.show()):e="all_contacts_draft_crm_emails",$(P).show()}L.removeClass("selectTab"),O.addClass("selectTab")}else"Accounts"!=n||"ACCOUNTS_ALL"!=E&&"ALL"!=E||("ACCOUNTS_ALL"==E&&M.hasClass("selectTab")&&(h.hide(),O.hide()),I.hide(),w.hide());var H=O.hasClass("selectTab"),z=h.hasClass("selectTab"),G=T.length>0?T.attr("lt-prop-selected"):"";if(null==r||"mails"==r){if(0==v.length&&(e="ALLUSERSMAILS"),"Accounts"===n&&null==E||"Accounts"===n&&"ACCOUNTS_ALL"==E?e="ALLUSERSMAILS":x||null==v||"IMAP_ALL"!==v.attr("lt-prop-selected")||"Accounts"===n&&"ALL"==E?null!=v&&"ALL"===v.attr("lt-prop-selected")&&(e="ALLUSERSMAILS"):e="IMAP_ALLUSERSMAILS","Accounts"===n&&"ALL"==E&&(e="allContacts"),x||null==v||"IMAP_ALL"!==v.attr("lt-prop-selected")||"ALL"===E||("true"===$("#isALLOptOnly").val()||getOpenerObj("isALLOptOnly")&&"true"===getOpenerObj("isALLOptOnly").value)&&(e="IMAP_CRMMAILS"),x&&"ALL"!==E){var q=null!=v?v.attr("lt-prop-selected"):null;"IMAP_ALL"!==q&&"POP_ALL"!==q&&"ALL_MAIL_VIEW"!==q||(e=q)}H&&"Accounts"==n?"ALL"==$(P).attr("lt-prop-selected")?(e="all_contacts_draft_crm_emails",w.hide()):(u="/crm/v2.2/Contacts/"+P.getAttribute("lt-prop-selected")+"/Emails",w.show()):z&&"Accounts"==n&&("ALL"==G?(e="all_contacts_scheduled_crm_emails",w.hide()):(u="/crm/v2.2/Contacts/"+G+"/Emails",w.show()))}if("Accounts"===n&&"ACCOUNTS_ALL"!=E&&"ALL"!=E&&!H&&!z&&A.length>0&&(w.show(),u="/crm/v2.2/Contacts/"+(E=z?G:E)+"/Emails",null==getOpenerObj("module")&&(event&&event.currentTarget&&event.currentTarget.origindd&&"contactSelDropdownInAcc"==event.currentTarget.origindd.id||null!=r))){var J,W=store.peekRecord("emails_rl_user","shared_users_"+o);J=null!=W?W.data:W;var Y=store.peekRecord("emails_rl_user","shared_users_"+E);if(null==Y)store.findAll("emails_rl_user",{},!0,!0,{module:"Contacts",entityId:E,action:"getUsers"}).then((function(e){(Y={}).rid=J.rid,Y.email="",Y.fullName=$("#fullname").val(),Y.mailObj=e[0].data.email_related_list[0],Y.mailObj.module=n,Y.mailObj.entityId=o,Y.mailObj.loginUserId=Crm.userDetails.USER_ID,Y.mailObj.singularMod=moduleRecordMapping[n].singular_label,store.pushPayload("emails_rl_user",{content:"shared_users_"+E,data:Y}),Y.mailObj.all_contacts_emails=J.mailObj.all_contacts_emails,Y.mailObj.contacts_details=J.mailObj.contacts_details,Y.mailObj.selectedContact=E;var t=getSelOptionForAccounts(Y,v,r);document.querySelector("crm-rl-users-list").component.setData(t.contactSharedDetails);var l=t.type,s=document.querySelector("#selectMails");s&&(s.ltProp("selected",""),s.ltProp("selected",l)),getMailsForContact(l,u,o,n,a,i,v),I.show()}));else{null==(Y=Y.data).mailObj&&(Y.mailObj=Y.email_related_list[0]),"Accounts"==n&&(Y.mailObj.module="Accounts"),Y.mailObj.all_contacts_emails=J.mailObj.all_contacts_emails,Y.mailObj.contacts_details=J.mailObj.contacts_details,Y.mailObj.selectedContact=E;var Z=getSelOptionForAccounts(Y,v,r);document.querySelector("crm-rl-users-list").component.setData(Z.contactSharedDetails);var Q,X=Z.type;I.show(),(Q=document.querySelector("#selectMails"))&&(Q.ltProp("selected",""),Q.ltProp("selected",X)),getMailsForContact(X,u,o,n,a,i,v)}}else{var K=$('lyte-drop-item[data-value="'+v.attr("lt-prop-selected")+'"]'),ee=K.length>0?K:null!=opener?$(opener.document.querySelectorAll('lyte-drop-item[data-value="'+v.attr("lt-prop-selected")+'"]')):null,te=null!=ee?ee.parent():null;if(k){d=!0;var ae=C.attr("lt-prop-selected");if("dealsOnly"!=ae)d=!1,u="/crm/v2.2/Contacts/"+ae+"/Emails",v[0].ltProp("disabledList",[]);else{var ie=store.peekRecord("emails_rl_user","pop_users_"+o);ie=null!=ie?ie.data:ie,""==e&&1==parseInt(te.attr("type"))&&(e="IMAP_ALL",v[0].ltProp("selected","IMAP_ALL")),null!=ie&&v[0].ltProp("disabledList",ie)}}if(z&&"all_contacts_scheduled_crm_emails"!=e?(e="scheduled_in_crm",g="scheduled_in_crm"):H&&"all_contacts_draft_crm_emails"!=e&&(e="drafts"),"ALLUSERSMAILS"==e?(g="sent_from_crm",c=6):"scheduled_in_crm"==e?(g="scheduled_in_crm",c=7):!x&&"IMAP_ALL"==e||"IMAP_ALLUSERSMAILS"==e?(g="",c=3):"allContacts"==e?(I.hide(),g="all_contacts_sent_crm_emails",c=4):"IMAP_CRMMAILS"==e?(g="",c=5):"all_contacts_scheduled_crm_emails"==e?(g="all_contacts_scheduled_crm_emails",c=8):"drafts"==e?(g="drafts",c=9):"all_contacts_draft_crm_emails"==e?(g="all_contacts_draft_crm_emails",c=10):1==x?"ALL_MAIL_VIEW"==e?(g="",c=5):"IMAP_ALL"==e?(g="all_imap_shared_users",c=3):"POP_ALL"==e?(g="all_pop_shared_users",c=11):(g="user_emails",e=parseInt(te.attr("type")),c=2):(g="user_emails",e=parseInt(te.attr("type")),c=2),"ACCOUNTS_ALL"===E&&(g="sent_from_crm",c=6),""!=g&&(p.type=g),t=parseInt(t),"next"==a?t+=10:"previous"==a&&(t-=10),p.index=t,x||5!=c&&3!=c&&(2!=c||!v||null==te||"2"!=te.attr("type")&&"3"!=te.attr("type"))||0==t){if(x&&(3==c||5==c)&&0!=t){var re=t/10-1;Crm.mailIndex[re]&&(p.index=Crm.mailIndex[re])}}else p.index=Crm.mailIndex[t/10-1];csrfParamName,csrfToken;var le=null!=v.attr("lt-prop-selected")?v.attr("lt-prop-selected").split("_")[0]:null;2==c&&le!=Crm.userDetails.USER_ID&&(p.owner_id=le),getMailsListReq(e,o,n,t,d,c,a,le,i,u,p)}}function getSelectedContact(e){if("mails"==(e=e.attr("id"))){var t=$("#contactSelDropdownInAcc");return(t=t.length>0?t:$(getOpenerObj("contactSelDropdownInAcc"))).attr("lt-prop-selected")}if("draftMails"==e){var a=$("#accountsDrafts");return(a=a.length>0?a:$(getOpenerObj("accountsDrafts"))).attr("lt-prop-selected")}var i=$("#accountsScheduled");return(i.length>0?i:$(getOpenerObj("accountsScheduled"))).attr("lt-prop-selected")}function getSelOptionForAccounts(e,t,a){var i={};if(0==t.length)i.contactSharedDetails=e,i.type="ALL";else if(1==t.find("lyte-drop-item").length&&e.mailObj.mailConfigured)i.contactSharedDetails=e,i.type=Lyte.Component.registeredHelpers.getSelValue(Lyte.Component.registeredHelpers.getUserStatus("IMAP_STATUS"),e.mailObj,"Accounts",!0);else if("ALL"==t.attr("lt-prop-selected"))i.contactSharedDetails=e,i.type="ALL";else if("IMAP_ALL"==t.attr("lt-prop-selected"))e.mailObj&&(e.mailObj.hasOwnProperty("all_imap_shared_users")||e.mailObj.hasOwnProperty("all_emails"))?(i.contactSharedDetails=e,i.type="IMAP_ALL"):(i.contactSharedDetails=e,i.type=Lyte.Component.registeredHelpers.getSelValue(Lyte.Component.registeredHelpers.getUserStatus("IMAP_STATUS"),e.mailObj,"Accounts",!0));else{var r=$('lyte-drop-item[data-value="'+t.attr("lt-prop-selected")+'"]'),l=r.length>0?r:null!=opener?$(opener.document.querySelectorAll('lyte-drop-item[data-value="'+t.attr("lt-prop-selected")+'"]')):null,n=null!=l?l.parent():null,s=parseInt(n.attr("type")),o=t.attr("lt-prop-selected").split("_");if(1==s){var d=e.mailObj.pop_users;if(null==d){(f={}).user_id=o[0],f.user_name=o[1],e.mailObj.pop_users=[],e.mailObj.pop_users[0]=f}else{for(var c=!1,m=d.length,u=0;u<m;u++)if(o[0]==d[u].user_id){c=!0;break}if(!c)(f={}).user_id=o[0],f.user_name=o[1],e.mailObj.pop_users.push(f)}}else if(2==s){var p=e.mailObj.imap_users;if(null==p){(f={}).user_id=o[0],f.user_name=o[1],e.mailObj.imap_users=[],e.mailObj.imap_users[0]=f}else{c=!1;var g=p.length;for(u=0;u<g;u++)if(o[0]==p[u].user_id){c=!0;break}if(!c)(f={}).user_id=o[0],f.user_name=o[1],e.mailObj.imap_users.push(f)}}else{var v=e.mailObj.gmail_users;if(null==v){(f={}).user_id=o[0],f.user_name=o[1],e.mailObj.gmail_users=[],e.mailObj.gmail_users[0]=f}else{c=!1;var f,h=v.length;for(u=0;u<h;u++)if(o[0]==v[u].user_id){c=!0;break}if(!c)(f={}).user_id=o[0],f.user_name=o[1],e.mailObj.gmail_users.push(f)}}i.contactSharedDetails=e,i.type=t.attr("lt-prop-selected")}return i}function getMailsListReq(e,t,a,i,r,l,n,s,o,d,c){var m,u=$("#fullname"),p=u.length>0?u.val():getOpenerObj("fullname").value,g=$("#mailListRelId"),v=g.length>0?g.val():getOpenerObj("mailListRelId").value,f=new crmRequestPool,h={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};if(Lyte.registeredMixins["crm-email-emotions-mixin"])m=Lyte.registeredMixins["crm-email-emotions-mixin"].findZiaEmailConfigDetails();else{var b=networkUtils.returnDependencyFiles(["email-emotions.js"],crmConstants.jsStaticPathForLyte);Lyte.injectResources(b,void 0,(function(){m=Lyte.registeredMixins["crm-email-emotions-mixin"].findZiaEmailConfigDetails()}))}m.then((function(m){var u=!1;if(m&&m.zia_config.configs.length>0){var g=m.zia_config.configs[0].configs;8===g.length&&(u=g[7].status)}Crm.userDetails.isEmotionsEnabled=u,f.initiate({type:"GET",url:d,data:c,headers:h,success:function(d){showMailsListHandling(handleMailsList(d,e,t,a,i,p,r,l,n,s),v,i,"true",n,a,t,o,"previous"==n)},error:function(d){showMailsListHandling(handleMailsList(d,e,t,a,i,p,r,l,n,s),v,i,"true",n,a,t,o,"previous"==n)}})}))}function setContactSharedUsers(e,t){var a=Lyte.Component.registeredHelpers.getSelValue(Lyte.Component.registeredHelpers.getUserStatus("IMAP_STATUS"),e);t.attr("lt-prop-selected",a),$("#relatedMailList").show()}function getMailsForContact(e,t,a,i,r,l,n){var s="",o={},d=0,c=$('lyte-drop-item[data-value="'+n.attr("lt-prop-selected")+'"]'),m=c.length>0?c:null!=opener?$(opener.document.querySelectorAll('lyte-drop-item[data-value="'+n.attr("lt-prop-selected")+'"]')):null,u=null!=m?m.parent():null,p=$("#isMailAppsFlow");if(1==("true"===(p.length>0?p.val():$(getOpenerObj("isMailAppsFlow")).value)))"ALL_MAIL_VIEW"==e?(o.type="",d=5):"IMAP_ALL"==e?(o.type="all_imap_shared_users",d=3):"POP_ALL"==e&&(o.type="all_pop_shared_users",d=11);else if("ALL"==e)s="ALLUSERSMAILS",o.type="sent_from_crm",d=6;else if("IMAP_ALL"==e)s="IMAP_ALL",d=3,0==$("#zmailPublicUsers").length&&(s="IMAP_CRMMAILS",d=5);else{s=parseInt(u.attr("type")),o.type="user_emails";var g=e.split("_")[0];g!=Crm.userDetails.USER_ID&&(o.owner_id=g),d=2}o.index=0,getMailsListReq(s,a,i,0,!1,d,r,null!=n.attr("lt-prop-selected")?n.attr("lt-prop-selected").split("_")[0]:null,l,t,o)}function getRelatedMails(e,t){var a=csrfParamName+"="+encodeURIComponent(csrfToken),i=document.getElementById("iskanbanview");if(i&&"true"===i.value)t=document.getElementById("userid").value;var r=Crm.getCrmBasePath()+"/ZMailConfig.do?action=showRelatedMails&msgid="+e+"&user_id="+t;i&&"true"===i.value&&(r+="&iskanbanview=true");var l="RelMails_"+e,n=$("#test_"+e+",#"+l),s=$("#"+l),o=$("#mail_type");if(s.length&&o.length&&"GMail"===o[0].value)"none"!==s[0].style.display?n.hide():n.show();else if(document.getElementById(l)&&"none"!==s[0].style.display&&!i)n.hide();else if(i&&"true"===i.value){var d=$("#mailthreads_"+e);d.hasClass("hide")?ajaxNew(r,void 0,(function(e){var t=setInterval((function(){var e=$("#addactionmain");""!==e.html()&&(d.html(e.html()),d.removeClass("hide"),clearInterval(t))}),100)}),"addactionmain"):d.addClass("hide")}else loadAjaxTab(""),new AjaxAPI({id:l,url:r,params:a,callbackfn:function(){commonUtils.showHideLoadingDiv(),$("#test_"+e+",#"+l).show()}}).post()}function handleMailsList(e,t,a,i,r,l,n,s,o,d){var c={},m=[],u=!1,p=$("#isMailAppsFlow"),g="true"===(p.length>0?p.val():getOpenerObj("isMailAppsFlow").value);e&&("error"==e.statusText?(e=e.responseJSON.message,m[0]=e,u=!0):null!=e.Emails?m=e.Emails:Array.isArray(e)?m=e:null!=e.mailsList?m=e.mailsList:(u=!0,m=e),null!=e.associatedContEmail&&(c.associatedContEmail=e.associatedContEmail)),g||3!=s||"true"!=$("#isALLOptOnly").val()||(s=5);var v=m.length;c.isScheduledMail="scheduled_in_crm"==t||"all_contacts_scheduled_crm_emails"==t;var f="scheduled_in_crm"==t||"ALL"==t?"ALLUSERSMAILS":t;if("all_contacts_sent_crm_emails"!=t&&"all_contacts_scheduled_crm_emails"!=t||(f="allContacts"),2==s&&(1==t?f="ZMAIL":2==t?f="IMAP":3==t&&(f="GMail")),3==s&&(f="IMAP"),3!=s&&5!=s||!Crm.userDetails.IMAP_STATUS||(f="IMAP"),!g||3!=s&&5!=s&&11!=s||(f="ZMAIL"),Crm.userDetails.mailType=f,"Deals"==i&&(i="Potentials"),c.mail_type=s,c.mailType=f,c.moduleEntityId=a,c.module=i,c.startIndex=r+1,c.toIndex=r+v,10==v&&(c.disableNext=!1),c.fromIndex=r,c.noofMails=v,c.fullname=l,c.supportMailId=RebrandLinkUtil.getProperty("SUPPORTMAILID"),c.isDealsMail=n,c.emailId="",c.isZiaEnabled=!1,c.isSentimentEnabled=Crm.userDetails.emailsentimentEnabled,c.isIntentEnabled=Crm.userDetails.intentEnabled,c.isEmotionsEnabled=Crm.userDetails.isEmotionsEnabled,!JSON.stringify(m).includes("sentiment_info")&&!JSON.stringify(m).includes("intent")||3!=s&&5!=s&&"IMAP"!=f||"Quotes"==i||(c.isZiaEnabled=!0),c.isEmailSummaryEnabled=Crm.userDetails.isEmailSummaryEnabled,e&&null!=e.user_id?c.user_id=e.user_id:c.user_id=null!=d?d:null,!u)for(var h=0;h<v;h++){var b=m[h];if(null!=b.subject&&(m[h].subject=unescape(b.subject)),null!=b.summary&&(b.summary.includes("&nbsp;")&&(b.summary=b.summary.replaceAll("&nbsp;"," ")),b.summary.includes("&amp;")&&(b.summary=b.summary.replaceAll("&amp;","&")),m[h].summary=b.summary),g?"ews"==b.source||"EWS"==b.source||(5==s||3==s)&&"imap"==b.source||"IMAP"==b.source?m[h].viewmail="IMAP":2==s&&"GMail"!=f||"imap"==b.source||"IMAP"==b.source||"zmail"==b.source||"ZMAIL"==b.source?m[h].viewmail="ZMAIL":"GMail"!=f&&(m[h].viewmail="CRMMASSMAIL"):5!=s&&3!=s||"zmail"!=b.source&&"ZMAIL"!=b.source?"imap"==b.source||"IMAP"==b.source||"ews"==b.source||"EWS"==b.source||(2==s||3==s)&&"IMAP"==f?m[h].viewmail="IMAP":"GMail"!=f&&"ZMAIL"!=f&&(m[h].viewmail="CRMMASSMAIL"):m[h].viewmail="ZMAIL",null!=m[h].source?m[h].source=getMailSourceString(b.source):2==s&&"IMAP"==f&&(m[h].source="IMAP"),null==m[h].status){var C="Received";m[h].sent&&(C="Sent"),m[h].status=[{type:C}]}for(var y=b.to,I=null!=y?y.length:0,w=0;w<I;w++){var A=y[w];if(A.hasOwnProperty("user_name"))null!=(O=A.user_name)&&O.includes('"')&&(O=O.replace(/\"/g,""),m[h].to[w].user_name=O)}var E=b.cc,T=null!=E?E.length:0;for(w=0;w<T;w++){var S=E[w];if(S.hasOwnProperty("user_name"))null!=(O=S.user_name)&&O.includes('"')&&(O=O.replace(/\"/g,""),m[h].cc[w].user_name=O)}var L=b.bcc,_=null!=L?L.length:0;for(w=0;w<_;w++){var O,M=L[w];if(M.hasOwnProperty("user_name"))null!=(O=M.user_name)&&O.includes('"')&&(O=O.replace(/\"/g,""),m[h].bcc[w].user_name=O)}}e&&e.meta&&(e.info=e.meta);var P=$("#mailListRelId"),k=P.length>0?P.val():getOpenerObj("mailListRelId").value,R=$("div[id="+("fetch_"+k));R.hasClass("ref_loading")&&(R.removeClass("ref_loading pointerEveNone"),$(".rLETabsElement").show(),$(".rLESelectAction").hide());var D=R.prev();return D.show(),e?("string"!=typeof e?(c.next_index=null==c.next_index?null!=e.next_index?e.next_index:null!=e.info?e.info.next_index:0:c.next_index,c.mailsList=m,"canvas"==Lyte.Router.getRouteInstance().routeName&&(0==c.toIndex||Number.isNaN(c.toIndex)?D.hide():e.info?e.info.more_records?D.html(c.toIndex+"+"):D.html(c.toIndex):c.toIndex%10==0?D.html(c.toIndex+"+"):D.html(c.toIndex))):(c.mailsList=[],c.mailsList[0]=getErrorType(e),"permission_disabled"==c.mailsList[0]&&(c.permissionDisabled=e),c.partnerName=Crm.partnerName,"ticketUnavailable"==c.mailsList[0]?c.user_name=e.split(" ")[7]:"mailboxUnavailable"==c.mailsList[0]?c.user_name=e.split(" ")[9]:"currentUserMailboxUnavailable"==c.mailsList[0]?c.zmailId=e.split(" ")[2]:"errorwhileprocessing"==c.mailsList[0]&&(c.supportMailId=e.split('"link">')[1].split("</a>")[0]),D.hide()),"string"!=typeof e&&c.mailsList.length>0&&c.next_index&&c.next_index.length>5&&updateMailRange(r/10,c,"previous"==o)):(c.mailsList=[],D.hide(),c.next_index=""),c.isFromNewAPI=!0,c}function getErrorType(e){return e.includes("Sorry, "+Crm.partnerName+" Mail is unavailable. Please try again later.")?"zohomailunavailable":e.includes("Customer email access in CRM is temporarily unavailable. Sorry for any inconvenience!")?"searchfunctionnotavailable":e.includes("mailbox may have been changed or deleted and is inaccessible. Please configure another mailbox.")?"currentUserMailboxUnavailable":e.includes("Unable to fetch emails from ")?"mailboxUnavailable":e.includes("Unable to display ")?"ticketUnavailable":e.includes("Sorry, we're unable to process your request. To send or receive emails, please update your ")?"currentUserTicketUnavailable":e.includes("This user has been deactivated. Backup for this user has not been initiated or completed. To back up your data or view the status of a current backup, click")||e.includes("This user has been deactivated. The administrator has not initiated a backup.")?"initiateBackup":e.includes("Sorry, you cannot view emails for this user because their account has been deactivated by your "+Crm.partnerName+" CRM administrator.")?"accountnotactive":e.includes("Email sync is in progress. You will receive an email notification once the sync is complete.")?"imap_sync_in_progress":e.includes("Sync not yet started")?"imap_sync_yet_to_start":e.includes("Sorry, we are unable to process your request. Please try again later. For assistance, contact us at")?"errorwhileprocessing":e.includes("Gmail API Authentication failed")?"gmailOAuth2Error":"permission_disabled"}function getMailSourceString(e){return"IMAP"==e?I18n.getMsg("crm.label.email.imap"):"workflow"==e?I18n.getMsg("crm.workflow.alert"):"individual"==e?I18n.getMsg("emailSource.sendmail.option.individual"):"auto_massmail"==e?I18n.getMsg("emailSource.scheduler"):"manual_massmail"==e?I18n.getMsg("crm.module.mass.mail"):"consent_mail"==e?I18n.getMsg("crm.label.consent.email"):"datarequest_access"==e||"datarequest_rectify"==e||"datarequest_export"==e?I18n.getMsg("emailSource.sendmail.option.individual"):"outlook"==e?I18n.getMsg("emailSource.outlook.plugin"):"auto_responder"==e?I18n.getMsg("emailSource.autoresponder"):"auto_responder_follow_up"==e?I18n.getMsg("emailSource.autoresponder.followup"):"mass_email_follow_up"==e?I18n.getMsg("crm.massmail.source.followup"):"mass_primary_mail"==e?I18n.getMsg("crm.module.mass.mail"):"template_mass_mail"==e?I18n.getMsg("emailSource.sendmail.option.multiple"):"mail_merge"==e?I18n.getMsg("crm.module.mailmerge.mail"):"api"==e?I18n.getMsg("emailSource.sendmail.option.api",PartnerUtil.getBrandName()):"bcc_dropbox"==e?I18n.getMsg("emailSource.sendmail.option.bcc"):"auto_response"==e?I18n.getMsg("emailSource.autoresponder"):"webform"==e?I18n.getMsg("crm.label.webtoentity.webform"):"plugin_mail"==e?I18n.getMsg("emailSource.sendmail.pluginmail"):"imap"==e?I18n.getMsg("crm.mail.addon.imap"):"event"==e?I18n.getMsg("emailSource.event.invitaion",[I18n.getMsg("Meeting")]):"integration_email"==e?I18n.getMsg("emailSource.integration.email"):"ews"==e||"EWS"==e?"EWS":"external"==e?I18n.getMsg("crm.label.widgets.external"):I18n.getMsg("emailSource.sendmail.option.individual")}function disablePOPUsers(e){var t=[],a=e.pop_users;if(a){for(var i=a.length,r=0;r<i;r++){var l=a[r];t[r]=l.user_id+"_"+l.user_name}var n=$("#selectMails");n.length>0&&n[0].ltProp("disabledList",t),store.pushPayload("emails_rl_user",{content:"pop_users_"+$("#id").val(),data:t})}}function showMailsList(e,t,a,i,r,l,n,s,o,d,c){var m=!1,u=!1,p=csrfParamName+"="+encodeURIComponent(csrfToken),g="previous"==l;"object"==$.type(e)&&(e=$(e).val(),m=!0);var v=$("#selectMails").length?$("#selectMails"):$(getOpenerObj("selectMails"));v.hasClass("onDealChange")&&(v.removeClass("onDealChange"),u=!0);var f,h=$("#id").val();f=null==d?Crm.getCrmBasePath()+"/ZMailConfig.do?action=getMailsList&isSendMail=true":Crm.getCrmBasePath()+"/ZMailConfig.do?action=getMailsList&isSendMail=false";var b=null,C=null,y=null,I=r,w=$("#isMailAppsFlow"),A="true"===(w.length>0?w.val():getOpenerObj("isMailAppsFlow").value);getObj("selectMails")?y=getObj("selectMails"):getOpenerObj("selectMails")&&(y=getOpenerObj("selectMails")),""==i&&getObj("mailListRelId")?i=getObj("mailListRelId").value:""==i&&getOpenerObj("mailListRelId")&&(i=getOpenerObj("mailListRelId").value);var E=$("#contactSelDropdownInAcc :selected");if(E.length<1&&(E=$(getOpenerObj("contactSelDropdownInAcc")).find("option:selected")),void 0!==o&&"null"!=o||!getObj("module")?void 0!==o&&"null"!=o||!getOpenerObj("module")||(o=getOpenerObj("module").value):o=getObj("module").value,"Accounts"===o&&0==E.length||"Accounts"===o&&E.length>0&&"ACCOUNTS_ALL"==E.attr("value"))f+="&mailType=ALLUSERSMAILS";else if(null==y||"IMAP_ALL"!==y.value||"Accounts"===o&&E.length>0&&"ALL"==E.attr("value"))if(!A||null===y||"POP_ALL"!==y.value||"Accounts"===o&&E.length>0&&"ALL"===E.attr("value"))if(null!=y&&"DRAFTS"===y.value)f+="&mailType=DRAFTS";else if(null===y||"ALL"===y.value||"ALL_MAIL_VIEW"===y.value||"Accounts"===o&&E.length>0&&"ALL"===E.attr("value"))f+="&mailType=ALLUSERSMAILS";else{var T=y.value;b=T.substring(0,T.indexOf("_")),C=T.substring(T.indexOf("_")+1,T.length),A||(f+=getCassMailsRange(parseInt(r),g))}else f+="&mailType=POP_ALLUSERSMAILS";else f+="&mailType=IMAP_ALLUSERSMAILS",A||(f+=getCassMailsRange(parseInt(r),g));if(null!=getObj("nextPageToken")){var S="",L=0;null!=l&&"next"===l&&(S=getObj("nextPageToken").innerHTML,L=parseInt(r)+10),null!=l&&"previous"===l&&(L=parseInt(r)-10),"undefined"!=typeof Storage&&("next"===l&&sessionStorage.setItem(L,S),f=f+"&pageToken="+(S=sessionStorage.getItem(L)))}E.length>0?"ACCOUNTS_ALL"==E.attr("value")?(e=$("#id").val(),$("#relatedMailList").hide(),$("#sendEntityMailLink").hide(),f+="&isAccountsMail=true"):"ALL"!=E.attr("value")?(e=E.attr("value"),t=E.attr("email"),$("#sendEntityMailLink").show(),$("#addNewIcP_Emails").removeClass("hide"),$("#relatedMailList").show()):(e=null==(e=$("#id").val())?getOpenerObj("id").value:e,$("#relatedMailList").hide(),$("#sendEntityMailLink").hide(),$("#addNewIcP_Emails").addClass("hide"),f+="&entityType=allContacts"):"Potentials"==o&&(e=getObj("id")&&null!=getObj("id").value?getObj("id").value:getOpenerObj("id").value),r="previous"==l?parseInt(r)-10:parseInt(r)+10,"true"==s&&loadAjaxTab(""),"true"==d?a=getObj("entityName").value:(a.replace(/___/g,"'"),a=a.replace(/____/g,'"'));var _="Cases"===o||"Vendors"===o?$("#zs_EMAIL"):null;if(null!=t&&"null"!=t){getObj("zmailEmail")?t=getObj("zmailEmail").value:_&&(t=_.attr("value")),f=f+"&entId="+e+"&moduleId="+h+"&user_id="+b+"&user_name="+encodeURIComponent(C)+"&searchid="+encodeURIComponent(t)+"&fullname="+encodeURIComponent(a)+"&listRelationId="+i+"&module="+o+"&fromIndex="+r+"&stateinfo="+n;var O="true"===$("#isALLOptOnly").val()||getOpenerObj("isALLOptOnly")&&"true"===getOpenerObj("isALLOptOnly").value;if(!A&&null!==y&&"IMAP_ALL"===y.value&&"ALL"!==E.attr("value"))if(O&&(f+="&mailType1=IMAP_CRMMAILS"),!m&&!u)if(f+="&nav_action="+l,0!=r&&crmRelatedList.mailRange[r-10]&&crmRelatedList.mailRange[r-10].mmRange)f+="&mmLastIndex="+crmRelatedList.mailRange[r-10].mmRange.mmLastIndex;if(A&&null!==y&&"ALL_MAIL_VIEW"===y.value&&"ALL"!==E.attr("value"))if(O&&(f+="&mailType1=IMAP_POPMAILS",f+=getMailAPIRange(parseInt(I),g)),!m&&!u)if(f+="&nav_action="+l,0!==r&&crmRelatedList.mailRange[r-10]&&crmRelatedList.mailRange[r-10].mmRange)f+="&mmLastIndex="+crmRelatedList.mailRange[r-10].mmRange.mmLastIndex;var M=$("#dealOnlyDropDown").length?$("#dealOnlyDropDown"):$(getOpenerObj("dealOnlyDropDown"));"Potentials"==o&"dealsOnly"===M.val()&&(f+="&isDealsMail=true"),mR(f,(function(t){showMailsListHandling(t,i,r,s,l,o,e,c,g)}),p,null,s)}else getOpenerObj(i)&&(EmailSendingUtil.showFeedBack||window.self.close())}function showMailsListHandling(e,t,a,i,r,l,n,s,o){var d=e;if("object"!=typeof e&&(d=JSON.parse(e)),$(".emailTrackingDiv").hide(),"DRAFTS"===d.mailType){if(!(0==a||d&&d.draftsList&&0!==d.draftsList.length))return mailListOnly10RecordAlert(t,a),void commonUtils.showHideLoadingDiv(!1)}else if(!(0==a||d&&d.mailsList&&0!==d.mailsList.length))return mailListOnly10RecordAlert(t,a),void commonUtils.showHideLoadingDiv(!1);var c=null;if(d.hasOwnProperty("isFromNewAPI")||(c=Handlebars.templates.MailDetailsList(d)),getObj(t)){"true"==i&&($("#zmNotifiedUsers").val(""),commonUtils.showHideLoadingDiv()),d.hasOwnProperty("isFromNewAPI")?document.querySelector("crm-emails-related-list").component.setData(d):($(getObj(t)).empty(),getObj(t).innerHTML=c);var m=getObj(t);placeExtra(),"previous"!==r?populateRLCount(t,void 0,"next"===r&&0!==a,0==a):populateRLCount(t,void 0,!1)}else if(getOpenerObj(t)||null!=opener&&opener.document.querySelector("crm-emailsrl-canvas-view")){if(d.hasOwnProperty("isFromNewAPI")){$("#id").val();d.navaction=r,d.fromIndex=a,opener.window.postMessage(JSON.stringify(d),window.location.origin)}else $(getOpenerObj(t)).empty(),getOpenerObj(t).innerHTML=c;m=getOpenerObj(t);placeExtra(),"previous"!==r&&opener.populateRLCount(t,void 0,"next"===r&&0!==a),"undefined"!=typeof EmailSendingUtil&&EmailSendingUtil.isSurvey&&opener.ZSurvey.refreshSurveyPersonality(l,n),"undefined"!=typeof EmailSendingUtil&&EmailSendingUtil.isConsentEmail&&opener.DataPrivacy.loadDataPrivacy($("#newleft_DataPrivacy")),window.self.close()}else $("crm-emails-related-list")[0].component.setData(d);var u=null;if(getObj("selectMails")?u=getObj("selectMails"):getOpenerObj("selectMails")&&(u=getOpenerObj("selectMails")),u&&(u.style.visibility="visible"),s){var p,g,v=$("#isFromNewAPI").length>0;if("first"===s)f=v?$($(".rLEmailSub")[0]):$($("#mailTable").find("tr")[1]).find(".emailSubjectEllipisis"),$("#edvFreezeLayer").removeClass("hide"),renderingUtils.triggerEvent("click",f);else if(v){if((g=(p=$("#ernTable")).find("lyte-tr").length)>1){var f=$(p.find("lyte-tr")[g-1]).find(".emailSubjectEllipisis");$("#edvFreezeLayer").removeClass("hide"),renderingUtils.triggerEvent("click",f)}}else if((g=(p=$("#mailTable")).find("tr").length)>1){f=$(p.find("tr")[g-1]).find(".emailSubjectEllipisis");$("#edvFreezeLayer").removeClass("hide"),renderingUtils.triggerEvent("click",f)}}EvalInnerScript(m),updateMailRange(parseInt(a),d,o),commonUtils.showHideLoadingDiv(!1)}function openComposeView(e){var t=null,a="",i="",r="";if(1===$("#krp_Rightpanel_InfoContainer").length||1===$("#kso_rightPanel_Card").length)a=$$rightPanel.entityId,i=$$rightPanel.currentModule;else{a=$("#id").val(),i=$("#module").val();var l=$("#subvalue_EMAIL");r=l.length?l.text():""}"Accounts"===i&&(a=$(e).attr("entityid"));var n=$("#emailDetailIframeContent"),s=$("email-summary");if(s.length>0&&!s.hasClass("hide")){var o=$L("#summaryMailDet");t=o.data("msgid"),r=o.data("to");var d=$L(".ernActiveSummary");if("Accounts"===i){var c=d.parent().parent().find(".rLEmailSub").data();c&&(a=c.contactid)}hideEmailSummaryDiv()}else if(n.length>0){r=null;var m=n.contents();t=m.find("#msgid").val(),r=m.find("#entity_emailAdd").val()}if(window.addEventListener("message",receiveMessage,!1),$("#isFromNewAPI").length>0){var u=$(".rLESelectAction");u.length>0&&"block"==u.css("display")&&$L(".ernLyteBody .ecnChkBoxtd lyte-checkbox").attr("lt-prop-checked",!1)}var p=new crmRequestPool,g=Crm.getCrmBasePath()+"/mailer/EntReply.do?action=checkMailInQueue&massMailId="+t;p.initiate({action:g,type:"GET",success:function(e){if(null!=e&&"success"===e)if(i="Accounts"===i?"Contacts":i,Crm.userDetails.isNewEditor)EmailSendingUtil.entityId=a,EmailLaunchUtil.editScheduleMail(i,a,t);else{var l=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/mailer/EntReply.do?action=editInCompose&massMailId="+t+"&entId="+a+"&entEmailId="+encodeURIComponent(r)+"&module="+i);openPopUp("entreplyWin",this,l,"SendMail",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes")}else renderingUtils.showCustomAlert(I18n.getMsg("crm.besttime.mail.processed.msg"));if(n.length>0){var s=parent.$("#lookupdiv");s.parent("crm-zsurvey-rl-body").length>0&&(s=$(".showhide").find("#lookupdiv")),parent.removeFreezeLayer(),parent.$("#ddm").hide(),parent.$("#kanbanTaskDetailctn").removeClass("hide"),s.hide()}store.deleteRecord("emails_rl_user",t)},error:function(){alert(I18n.getMsg("crm.unable.to.process.request"))}})}function mailListOnly10RecordAlert(e,t){alert(I18n.getMsg("crm.label.no.more.records"));var a=$("div[ddid="+e+"]");a.find("img.next").removeClass("next").addClass("next_disabled"),("EMAILSPERSONALITY"==a.attr("ddname")||$("crm-emailsrl-canvas-view").attr("list-relation-id")==e&&"canvas"==Lyte.Router.getRouteInstance().routeName)&&$("#isFromNewAPI").length>0&&document.querySelector("crm-emails-related-list").component.setData("disableNext",!0),a.find("img.next_disabled").parent().parent().prepend(a.find("img.next_disabled")),a.find("img.next_disabled").siblings().remove(),$(getObj("newleft_"+e)).find("span.numCountVal").text(t);var i=$("#emailDetailIframeContent").contents();1==i.length&&i.find(".nextNav").addClass("eNavDisabled")}function mailPrintView(e,t){var a,i,r="",l="",n="";if(void 0!==t&&"null"!==t||(t=""),1===$("#krp_Rightpanel_InfoContainer").length||1===$("#kso_rightPanel_Card").length)r=$$rightPanel.entityId,l=$$rightPanel.currentModule;else if(crmNTC.isSignalDetailViewVisible()){r=(s=$("#notificationGroupList").find("li.ntc-entity-active").data("ntc-entityobj")).entityId,l=s.module,n=s.entityEmail}else if("undefined"!=typeof CrmIntelligence&&CrmIntelligence.notificationDetailJson){var s;r=(s=CrmIntelligence.notificationDetailJson.entity_info).entityId,l=s.module,n=s.entityEmail}else{var o;if($L(".etTrendsWrapper").length){var d=$L("crm-ziaforemails")[0].component.getData("onclickAttr");r=d.entityId,l=d.module}else if($L(".etTrendsWrapperCNS").length){r=(v=$L("crm-ziaforcns")[0].component.getData("data")).entityId,l=v.module}else r=document.getElementById("id").value,l=getObj("module").value,o=document.getElementById("subvalue_EMAIL");n=null,o&&(n=o?o.innerHTML:"")}if($("#emailDetailIframeContent"+t).length>0){var c=$("#emailDetailIframeContent"+t).contents();a=c.find("#msgid").val(),i=c.find("#mailUserId").val(),!crmNTC.isSignalDetailViewVisible()&&c.find("#entity_emailAdd").length>0&&(n=c.find("#entity_emailAdd").val())}else if(!$("email-summary").hasClass("hide")){var m=$L("#summaryMailDet");a=m.data("msgid"),i=m.data("user_id");var u=$L("#selectMails");if(u.length>0){var p=void 0===u[0].value?u[0].getAttribute("lt-prop-selected"):u[0].value;if("IMAP_ALL"===p||"IMAP_CRMMAILS"===p)"CRMMASSMAIL"===$("#rLEmailSub_"+a).data("emailtype")&&(e="ALLUSERSMAILS")}"allContacts"===e&&(e="ALLUSERSMAILS")}var g=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/mailer/EntReply.do?action=printMail&mailUserId="+i+"&msgid="+a+"&mailType="+encodeURIComponent(e)+"&entId="+r+"&entEmailId="+encodeURIComponent(n)+"&module="+l),v=$("#contactSelDropdownInAcc :selected").attr("value"),f=$("#contactSelDropdownInAcc");if("Accounts"===l&&f.length>0&&"ACCOUNTS_ALL"!=v){if(l="Contacts","ALL"!=v){var h=f[0].component.getDropBox().querySelector(".lyteDropdownSelection").getAttribute("data-email");h&&h.indexOf(",")>-1&&(g+="&secondaryEmailId="+h.split(",")[1])}}else{var b=document.getElementById("subvalue_ADDN_EMAIL");if(b)g+="&secondaryEmailId="+(b?b.innerText:"")}openPopUp("entreplyWin",this,g,"printMail",860,570,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes")}function updateUsersList(e,t){var a=$("#status_"+t)[0];if(a){a.disabled="disabled";var i=$("#zmailkey")[0].value,r=Crm.getCrmBasePath()+"/ZMailConfig.do?action=updateUsersList&entId="+e+"&shareMails="+a.checked+"&zmailkey="+i,l="&"+csrfParamName+"="+csrfToken;loadAjaxTab(""),mR(r,(function(e){commonUtils.showHideLoadingDiv();var t=$("#bulkUpdateSuccess");t.empty(),t[0].innerHTML=e,show("bulkUpdateSuccess"),mailsetCenter("bulkUpdateSuccess"),setTimeout((function(){hide("bulkUpdateSuccess"),a.disabled=""}),4e3)}),l)}}function getComboValues(e,t,a,i,r,l,n,s,o,d,c,m){var u="",p=Crm.getCrmBasePath()+"/GetComboValues.do";r&&r.includes("$$$")&&(r=r.split("$$$")[0]);var g="fieldId="+e+"&module="+(void 0===r?"":r)+"&uiType="+t+"&action=workflow";l&&(g+="&allowEmpty=true"),s&&(g+="&isPotentialStage=true");var v=!1;if(t==CrmField.UITYPES.PICK_LIST&&Crm.userDetails.isMultiPipelineActivated&&e==Crm.userDetails.isMultiPipelineActivated)v=!0,store.findAll("layout",{module:Crm.moduleInfo.Potentials.apiname}).then((function(e){$(getObj("fieldValuetd1")).empty();var t=m?crmListView.BPFieldUpdateTemplate:crmListView.WFPipelineTemplate;getObj("fieldValuetd1").innerHTML=t({layouts:e,selectedPipeline:i}),thirdPartyUtils.bindSelect2($("#fieldValuetd1").find("select")),showDependentFieldsForEdit(c,i),m&&i&&ProcessBuilder.createTransformAction()}));else if(!v){var f=getHTTPObject();f&&(f.open("POST",p,!0),f.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),f.setRequestHeader("X-Requested-With","XMLHttpRequest"),f.onreadystatechange=function(){if(4==f.readyState){dataStr=f.responseText.trim(),null!=n||100!=t&&t!=CrmField.UITYPES.GLOBAL_TAX?u+=null==n?"<div id='EmptyValue' class='dN'>$EMPTY</div><div id='picklistFieldDiv' class='newSelect'><span class='crm-font-regular f14 sltSetVal sltBdr dIB'></span><select id='fieldValue"+a+"'":"<div id='EmptyValue' class='dN'>$EMPTY</div><div id='picklistFieldDiv' class='newSelect'><span class='crm-font-regular f14 sltSetVal sltBdr dIB'></span><select id='"+n+"'":u+="<div class='cchosen mlSelect mlSelAutoWidth pR'><div class='wf_highLight'></div><span class='crm-font-regular f14 sltSetVal sltBdr dIB'></span><select  multiple size='4' onchange='selectBoxLimitationInMultiselect(this);wfForm.setSltVal(this);' data-zcqa='select_MassUpdate_Value' id='fieldValue"+a+"'",null!=o&&(u+=" style='width:"+o+"%'"),100!=t&&t!=CrmField.UITYPES.GLOBAL_TAX&&(u+=null!=d?" onchange='"+d+";wfForm.setSltVal(this);'":" onchange=wfForm.setSltVal(this);");var e=!1,r=null,l=null;if(2===t||26===t||"2"===t||"26"===t){var s=JSON.parse(dataStr),c=[],m=s.length;for(O=0;O<m;O++)c.push(s[O].Id);for(var p=[],g=c.length,v=0;v<g;v++){var h=s[v];h.colorCode?(e=!0,p[p.length]=h):"-None-"===h.ActualValue&&(p[p.length]=h)}u+=" data-colorcode_enabled="+e+" data-picklistmap='"+JSON.stringify(p)+"' "}u+=">";var b=!1;if(2==t||26==t){var C=(y=JSON.parse(dataStr)).length;null==i&&(i="None"),t==CrmField.UITYPES.STAGE&&"None"==i&&(u+="<option id='None' value='None' actualvalue='-None-' selected>"+I18n.getMsg("crm.label.choose.stage")+"</option>");for(v=0;v<C;v++){(E=y[v])&&E.colorCode?E.DisplayValue==i||E.Id==i?(u+="<option data-colorcode='"+E.colorCode+"'value='"+E.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(E.ActualValue)+"'selected>"+$ESAPI.encoder().encodeForHTML(E.DisplayValue)+"</option>",r=E.colorCode,l=E.ActualValue):u+="<option data-colorcode='"+E.colorCode+"'value='"+E.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(E.ActualValue)+"'>"+$ESAPI.encoder().encodeForHTML(E.DisplayValue)+"</option>":E.DisplayValue==i||E.Id==i||"-None-"==E.ActualValue&&"None"==i?u+="<option value='"+E.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(E.ActualValue)+"'selected>"+$ESAPI.encoder().encodeForHTML(E.DisplayValue)+"</option>":u+="<option value='"+E.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(E.ActualValue)+"'>"+$ESAPI.encoder().encodeForHTML(E.DisplayValue)+"</option>"}e&&!l&&(t!==CrmField.UITYPES.STAGE&&t!==CrmField.UITYPES.STAGE+""||"None"!==i)&&(r=y[0].colorCode,l=y[0].ActualValue)}else if(100==t||t==CrmField.UITYPES.GLOBAL_TAX){$("#typeSection").show();var y=JSON.parse(dataStr);if(null!=i){var I,w=i.split("_"),A=w[1].split(",");for(C=y.length,v=0;v<C;v++){var E=y[v];I=0;for(var T=0;T<A.length;T++)E.Id==A[T]&&(I=1);0==I?(u+="<option value='"+E.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(E.ActualValue)+"'>"+$ESAPI.encoder().encodeForHTML(E.DisplayValue)+"</option>",b=!0):u+="<option value='"+E.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(E.ActualValue)+"' selected>"+$ESAPI.encoder().encodeForHTML(E.DisplayValue)+"</option>"}}else for(C=y.length,v=0;v<C;v++){E=y[v];u+="<option value='"+E.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(E.ActualValue)+"'>"+$ESAPI.encoder().encodeForHTML(E.DisplayValue)+"</option>"}u+="</select></div></tr></td>";var S="<tr id='typeSection' class= 'typeSection'> <td width='100'><div class='wf_requiredMark wf_form_lab'>"+I18n.getMsg("crm.workflow.field.to.update.Action")+"</div></td><td><label class='rbCheckHtml dIB'><input type='radio' id='OverwriteVal' class='rbRealHtml hide triggerRad' checked='checked' name='recordOrDate1'>";S+="<span class='rbHtml dIB irpR'> <span class='rbTickHtml pA'></span></span><span class='rbHtmlLb pL5'>"+I18n.getMsg("crm.import.duplicates.overwrite")+"</span></label><label class='pL15 rbCheckHtml dIB'> <input type='radio' id='AppendVal' class='rbRealHtml hide triggerRad' name='recordOrDate1'>",S+="<span class='rbHtml dIB pR'><span class='rbTickHtml pA'></span> </span><span class='rbHtmlLb pL5'>"+I18n.getMsg("crm.import.duplicates.append")+"</span></label></td></tr> ",$("#wf_nw_fld tr:last").after(S);var L=$("#pb_transitionAction_form");if(L.length>0)S="<fieldset class='form-group' ><div id='typeSection' class= 'typeSection'><label >"+I18n.getMsg("crm.workflow.field.to.update.Action")+"</label><label class='rbCheckHtml dIB'><input type='radio' id='OverwriteVal' class='rbRealHtml hide triggerRad' checked='checked' name='recordOrDate1'>",S+="<span class='rbHtml dIB irpR'> <span class='rbTickHtml pA'></span></span><span class='rbHtmlLb pL5'>"+I18n.getMsg("crm.import.duplicates.overwrite")+"</span></label><label class='rbCheckHtml dIB'> <input type='radio' id='AppendVal' class='rbRealHtml hide triggerRad' name='recordOrDate1'>",S+="<span class='rbHtml dIB pR'><span class='rbTickHtml pA'></span> </span><span class='rbHtmlLb pL5'>"+I18n.getMsg("crm.import.duplicates.append")+"</span></label></div></fieldset>",L.find("fieldset").last().after(S);$("#isinitial").val("1"),null!=i&&(0==w[0]?($("#OverwriteVal").prop("checked",!0),$("#AppendVal").prop("checked",!1)):1==w[0]&&($("#AppendVal").prop("checked",!0),$("#OverwriteVal").prop("checked",!1)))}else{for(var _=dataStr.split("~~"),O=0;O<_.length;O++){var M=_[O];if(t==CrmField.UITYPES.LAYOUT){var P=M.split("|");P[0]===i?(u+="<option id='"+O+"' value='"+$ESAPI.encoder().encodeForHTMLAttribute(P[0])+"' selected>"+$ESAPI.encoder().encodeForHTML(P[1])+"</option>",b=!0):(0!=O||b||null!=i||(u+="<option id='None' value='' selected>"+I18n.getMsg("crm.pipeline.choose.layout")+"</option>"),u+="<option id='"+O+"' value='"+$ESAPI.encoder().encodeForHTMLAttribute(P[0])+"'>"+$ESAPI.encoder().encodeForHTML(P[1])+"</option>")}else M==i?(u+="<option id='"+O+"' value='"+$ESAPI.encoder().encodeForHTMLAttribute(M)+"' selected>"+$ESAPI.encoder().encodeForHTML(M)+"</option>",b=!0):u+="<option id='"+O+"' value='"+$ESAPI.encoder().encodeForHTMLAttribute(M)+"'>"+$ESAPI.encoder().encodeForHTML(M)+"</option>"}!b&&i&&"undefined"!=i&&(u+="<option id='"+O+"' value='"+$ESAPI.encoder().encodeForHTMLAttribute(i)+"' selected>"+$ESAPI.encoder().encodeForHTML(i)+"</option>"),u+="</select></div>"}var k=$(getObj("fieldValuetd"+a));if(k.empty(),getObj("fieldValuetd"+a).innerHTML=u,""==i&&($("#picklistFieldDiv").addClass("dN"),$("#EmptyValue").removeClass("dN")),null!==r)$('<span class="dIB activitesColor" data-zcqa="colorcode_selectWFupdatecolorcode" id="selectWFupdatecolorcode" style="background:'+$ESAPI.encoder().encodeForHTMLAttribute(r)+'"></span>').insertBefore("#fieldValue"+a);!0!==e||l&&"-None-"!==l?!0===e&&"-None-"!==l&&(k.removeClass("colorEnabledPKNone"),k.addClass("colorEnabledPicklist")):k.addClass("colorEnabledPicklist colorEnabledPKNone "),thirdPartyUtils.bindSelect2($("#fieldValuetd"+a).find("select")),t==CrmField.UITYPES.STAGE&&d.indexOf("handleStageSelection")>-1&&$("#fieldValue1").trigger("change")}},f.send(g))}}function selectBoxLimitationInMultiselect(e){var t=$(e).val().length-1,a=$(e).attr("id");if(t<49&&($("#select2-"+a+"-results").show(),$("#"+a).closest("tr").removeClass("form_err_fld"),$("#"+a).closest("tr").find(".form_err_msg").remove()),t>=50){var i,r=e.parentElement.parentElement,l=$(r).attr("id");if($("#select2-"+a+"-results").hide(),renderingUtils.displayErrorDiv(l,void 0,I18n.getMsg("crm.alert.picklist.empty.message.overflow",[50])),workflow.selectedObj)i=$(e).val().filter((function(e){return workflow.selectedObj.indexOf(e)<0}));var n=$("#"+a+" option[value='"+i+"']").text();$("#"+l+" .selection ul li[title='"+n+"'] .select2-selection__choice__remove").click()}workflow.selectedObj=$(e).val()}function getOptOut(e,t,a){var i="<label class='cbCheckHtml'><input type='checkbox' class='hide ccbRealHtml' id='fieldValue"+t+"' value='0'/><span class='ccbHtml dIB pR'><span class='ccbTickHtml dIB pA'></span></span></label>";1==a&&(i="<label class='cbCheckHtml'><input type='checkbox' class='hide ccbRealHtml' id='fieldValue"+t+"' value='1' checked/><span class='ccbHtml dIB pR'><span class='ccbTickHtml dIB pA'></span></span></label>"),$(getObj("fieldValuetd"+t)).empty(),getObj("fieldValuetd"+t).innerHTML=i}function checkWFDupFields(e,t){for(var a=getObj("fieldOption1").value.split("&&&"),i="",r=2;r<e+1;r++){if(i=getObj("fieldOption"+r).value.split("&&&"),a[0]==i[0])return alert(t),!1}if(3==e){var l=getObj("fieldOption2").value.split("&&&");if(i[0]==l[0])return alert(t),!1}return!0}function enableZMailConfig(e,t){if("ActivateUser"==e||"purchase"==e)return alert(t),!1;if(-1===jQuery.inArray("mail",usernameNotNeeded))commonUtils.checkUsernameNeeded((function(){enableZMailConfig(e,t)}),"mail");else{var a=Crm.getCrmBasePath()+"/ZMailConfig.do?action=zmailLoginPage";"enabled"==e&&(a=Crm.getCrmBasePath()+"/ZMailConfig.do?action=checkConfiguration&isAjax=true"),loadAjaxTab(""),mR(a,(function(e){if(commonUtils.showHideLoadingDiv(),$("#helpdesk").hasClass("cobclicked")){$("#cobdiv").show(),$("#cobdiv .zcrm-content").html(e),freezeBackground()}else{var t=document.getElementById("result");$(t).empty(),t.innerHTML=e,EvalInnerScript(t)}}))}}function mailconfiguration(e,t){document.getElementById("currentmail"),document.getElementById("currentmailwithshare"),document.getElementById("currentmailTR"),document.getElementById("currentmailwithshareTR"),document.getElementById("currentmailwithglobalshareTR");var a=document.getElementById("sharingExcludes");$("#helpdesk").hasClass("cobclicked")&&(a=document.querySelector("#cobdiv #sharingExcludes")),"PR"==e?($("#excludeDiv").hide(),a.style.display="none",$("#currentmailTR").css("background-color","rgb(243, 248, 252)"),$("#currentmailwithglobalshareTR").css("background-color","#fff"),$("#currentmailwithshareTR").css("background-color","#fff")):"RS"==e?(document.getElementById("plsInfoSpan").style.display="block",document.getElementById("glsInfoSpan").style.display="none",$("#currentmailwithshareTR").css("background-color","rgb(243, 248, 252)"),$("#currentmailwithglobalshareTR").css("background-color","#fff"),$("#currentmailTR").css("background-color","#fff"),$("#excludeDiv").hide(),a.style.display="none"):"GLS"==e&&(document.getElementById("plsInfoSpan").style.display="none",document.getElementById("glsInfoSpan").style.display="block",document.getElementById("alertDiv").style.display="block",$("#cobdiv_alert .zcrm-content").html($("#alertDiv").show()),$("#excludeDiv").show(),a.style.display="inline-block",$("#currentmailwithglobalshareTR").css("background-color","rgb(243, 248, 252)"),$("#currentmailTR").css("background-color","#fff"),$("#currentmailwithshareTR").css("background-color","#fff"),crmui.showPopup("cobdiv_alert")),document.getElementById("mailOption").value=e}function proceedZMailConfigSave(){removeFreezeLayer(),$("#switchIMAPWarning").hide(),$("#imapConfigStatus").attr("data-confirm","true"),$(document.zloginForm).submit()}function zmailFormValidate(e,t,a,r){var l=$("#imapConfigStatus");if("true"===l.val()&&"false"===l.attr("data-confirm"))return freezeBackground(),mailsetCenter("switchIMAPWarning"),!1;var n=document.getElementById("mailOption").value;if(($('input[id="zmailAccountId"]').val($("#mailBoxNameSSO1 option:selected").attr("accId")),"GLS"==n)&&!AdminEmailSharing.handleExcludeDomain())return!1;I18n.getMsg("mailbox");if("PR"==n&&0==$("#mailboxdiv").length)return alert(e),!1;if("RS"==n&&0==$("#mailboxdiv").length)return alert(e),!1;if("GLS"==n){var s=$("#excludeDomains").val();if(null!=s&&null!=s&&""!=s){var o=s.split(",");if(!checkSplChars("excludeDomains",a))return!1;if(o.length>10)return alert(r),!1;if(0==$("#mailboxdiv").length)return alert(e),!1;$('input[id="globalshareexclude"]').val(s)}}if($("#searchMailAliasesChk").prop("checked")&&$("input[name=searchMailAliases]:checked").length>3)return alert(fmtStr.mailaliasalert),!1;if($("#labelorfolderChk").prop("checked")){var d=new Array("`","~","!","@","#","$","%","^","&","*","(",")","+","=","[","]","\\","'",";",",",".","/","{","}","|",'"',":","<",">","?");if("folder"==$("input:radio[name=labelorfolder]:checked").val()&&!emptyCheck("labelorfolderName","Folder Name"))return!1;if("label"==$("input:radio[name=labelorfolder]:checked").val()&&!emptyCheck("labelorfolderName","Label Name"))return!1;var c=document.getElementById("labelorfolderName").value;if(c.length>50&&"folder"==$("input:radio[name=labelorfolder]:checked").val())return alert(fmtStr.folderlengthalert),!1;if(c.length>25&&"label"==$("input:radio[name=labelorfolder]:checked").val())return alert(fmtStr.labellengthalert),!1;for(i=0;i<d.length;i++)if(document.getElementById("labelorfolderName").value.indexOf(d[i])>=0)return"folder"==$("input:radio[name=labelorfolder]:checked").val()?alert(fmtStr.foldernamealert):alert(fmtStr.labelnamealert),!1}else $("labelorfolderName").val("");var m="result";return $("#helpdesk").hasClass("cobclicked")&&(m="cobdiv"),doAjaxUpdate(m,getAttr(document.zloginForm,"action"),formData2QueryString(document.zloginForm),(function(){crmTab.reloadTabMenu((function(){$("#toIMAP").length&&(Crm.userDetails.IMAP_STATUS=!1)}))})),!1}function cancelWizard(e){document.location.href=Crm.getCrmBasePath()+"/Customize.do?title="+e}function zmailLoginInitMethod(e,t,a,i,r){document.getElementById("currentmail"),document.getElementById("currentmailwithshare");var l=document.getElementById("currentmailTR"),n=document.getElementById("currentmailwithshareTR"),s=document.getElementById("currentmailwithglobalshareTR"),o=document.getElementById("sharingExcludes");$("#helpdesk").hasClass("cobclicked")&&(o=document.querySelector("#cobdiv #sharingExcludes")),"PR"==a?"null"!=e&&(document.getElementById("mailBoxNameSSO1").value=e,$("#mailBoxNameSSO").text(e),o.style.display="none"):"RS"==a?(l.style.backgroundColor="#fff",n.style.backgroundColor="#f3f8fc",s.style.backgroundColor="#fff","null"!=e&&($("#mailBoxNameSSO").text(e),document.getElementById("mailBoxNameSSO1").value=e,o.style.display="none")):"GLS"==a&&(l.style.backgroundColor="#fff",n.style.backgroundColor="#fff",s.style.backgroundColor="#f3f8fc","null"!=e&&(document.getElementById("mailBoxNameSSO1").value=e,$("#mailBoxNameSSO").text(e),o.style.display="block")),r&&$("#mailBoxNameSSO1").find("option[accid='"+r+"']").attr("selected","selected")}function showStatusDiv(e){$("#statusDiv").html(e),$("#helpdesk").hasClass("cobclicked")?(show("statusDiv"),setTimeout((function(){$("#statusDiv").hide()}),2e3)):(mailsetCenter("statusDiv"),setTimeout((function(){hide("statusDiv")}),2e3))}function deleteZMailConfig(){var e=Crm.getCrmBasePath()+"/ZMailConfig.do?action=delete";document.deleteForm.action=e;var t="result";$("#helpdesk").hasClass("cobclicked")&&(t="cobdiv"),doAjaxUpdate(t,getAttr(document.deleteForm,"action"),formData2QueryString(document.deleteForm),(function(){removeFreezeLayer(),crmTab.reloadTabMenu()})),Lyte.Router.getRouteInstance().setQueryParams({action:"mailSelect"})}function showQuickCreate(e){var t=e.value;if(!isWorking&&http&&""!=t){var a="module="+t+"&fromCreate=QuickCreate",i=Crm.getCrmBasePath()+"/QuickCreateAction.do";try{http.open("POST",i,!0)}catch(e){http=getHTTPObject(),http.open("POST",i,!0)}http.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),http.setRequestHeader("X-Requested-With","XMLHttpRequest"),http.onreadystatechange=function(){if(4==http.readyState){if(200==http.status){if(txt=http.responseText,txt.indexOf("Your login session has expired")>-1)return alert(I18n.getMsg("crm.alert.session.check")),void Utils.windowLocationReload();getObj("dashboardContent")&&(getObj("dashboardContent").style.display="none"),showDialog(txt,"position=absolute,title=<fmt:message key='crm.quickcreate.title'/>,top=100,left=100,width=335,height="+("Calls"!=t?"375":"475")+",modal=yes,closeOnEscKey=no")}isWorking=!1}},http.send(a)}document.QuickCreate.tabList.value=""}function showExportMenu(e,t,a,i,r){var l;if(hideMenu(),-1!=e.indexOf("linkDocs=true")){if(i||(i=renderingUtils.getTargetElem(event)),null!=usernameNeeded&&"boolean"==typeof usernameNeeded&&1==usernameNeeded&&-1==jQuery.inArray("zdoc",usernameNotNeeded))return commonUtils.checkUsernameNeeded((function(){showExportMenu(e,t,a,i)}),"zdoc"),!1;var n=objectUtils.URL(e).getParams();$.ajax({type:"POST",url:Crm.getCrmBasePath()+"/ZDocs.do?mode=isTrashedDocInZDocs",async:!1,data:"fileId="+n.fileId+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),success:function(a){if("true"==trimBoth(a)){var r=I18n.getMsg("crm.trashdoc.alert");return alert(r),!1}if($.inArray(t,["jpeg","jpg","gif","png","webp","bmp","svg"])>-1)return event.preventDefault(),$(i).attr({onclick:"showImagePreview(this)",href:e,name:"cboxElement"}),renderingUtils.triggerEvent("click",$(i)),!1}})}var s=$("#viewlink"),o=$("#ddm"),d=$("#"+a);if("pdf"==t?(s.html(I18n.getMsg("crm.file.open")),l="pdfViewPlugin"):(l=function(){var e={sheet:["excel","xls","csv"],show:["ppt","pps"],writer:["word","txt","doc","docx","htm","html","sxw","odt","rtf"]};for(var a in e)if(e[a].indexOf(t)>-1)return a}(),s.html(I18n.getMsg("crm.view.attachment."+l,Crm.partnerName))),l?s.parent().parent().show():s.parent().parent().hide(),Crm.userDetails.RTL_ENABLED)o.css({display:"block",right:d.closest("td").prev("td").outerWidth()+40,top:d.position().top+d.height()});else{var c=$("#setup_new_ContentDiv"),m=$("#kventitydetailspage");"true"===r&&(c=$("#dvinner"));var u=findPosX(d.get(0)),p=findPosY(d.get(0))+d.height()-c.scrollTop();m.length&&(u-=m.offset().left,p=c.scrollTop()+d.offset().top-170),o.css({display:"block",left:u,top:p})}var g=e.split("attachName=");null!=g[1]&&(g[1]=g[1].replace("&","%26")),o.find("#downloadlink").attr("href",e+"&attach="+g[1]+"&downLoadMode=default"),"pdf"==t?s.attr("href","javascript:openSheetForExport('"+encodeURI(e)+"&downLoadMode=pdfViewPlugin','pdfViewPlugin')"):s.attr("href","javascript:openSheetForExport('"+encodeURI(e)+"&downLoadMode="+l+"')")}function openSheetForExport(e,t){var a=e.split("downLoadMode="),i=a[1];if("pdfViewPlugin"==t){var r=a[0].split("attachName=");window.open(e+"&attach="+encodeURIComponent(r[1]))}else if(null!=usernameNeeded&&"boolean"==typeof usernameNeeded&&1==usernameNeeded&&-1==jQuery.inArray(i,usernameNotNeeded)&&"viewer"!=i)commonUtils.checkUsernameNeeded((function(){openSheetForExport(e,t)}),i);else{r=a[0].split("attachName=");var l=e+"&attach="+encodeURIComponent(r[1]);mR(l,(function(e){var t=e.split("||"),a=t[1],i=t[3],r=httpprotocol+t[5];"writer"==i?window.open(r+"/editor.im?doc="+a):"sheet"==i?a.includes("sheet")?networkUtils.openUrl(a):networkUtils.openUrl(r+"/sheeteditor.do?doc="+a):"show"==i?window.open(r+"/show/remoteedit.sas?doc="+a):"viewer"==i&&window.open(r+"/apidoc/"+a)}))}}function openForDocs(e,t,a,i){var r=$("#multipleFieldsEditPop").is(":visible");if($("#attachOptionsFromDetailMenu,#eventActionsMenu").hide(),i&&(fileupload.fromFileUploadField=!0),null!=usernameNeeded&&"boolean"==typeof usernameNeeded&&1==usernameNeeded&&-1==jQuery.inArray(e,usernameNotNeeded)){var l=e;"gcontacts"!=e&&"gdoc"!=e||(l="gadgets"),commonUtils.checkUsernameNeeded((function(){openForDocs(e,t,a)}),l)}else{var n=window.location.protocol;if("zdoc"==e){var s={servicename:"zcrm",attachCount:"5",docsURL:RebrandLinkUtil.getProperty("docsStaticUrl")};ATTACHDIALOG.showAttachFileDialog(s)}else if("gcontacts"==e)var o="<iframe id='zohodocsframe' height='500px' frameborder='0' width='650px' src='"+httpprotocol+"localgadgets.zoho.com/gcontacts?zservice=zcrm&serURL="+encodeURIComponent(n+"//localhost:9090/jsp/integration/gcontacts.jsp")+"'> </iframe>";else{var d;if("undefined"!=typeof CrmPlusLib&&CrmPlusLib.isLoadedInCrmplusFrame&&CrmPlusLib.getFrameOriginForURL)var c=CrmPlusLib.getFrameOriginForURL()+",";d=c?encodeURIComponent(c+n+"//"+a):encodeURIComponent(n+"//"+a),1==i?(o='<iframe id="zohodocsframe" height="500px" frameborder="0" width="650px" src="'+httpprotocol+t+"/gdocs?zservice=zcrm&serURL="+encodeURIComponent(n+"//"+a+"/crm/Gdocs.do?fromFileUploadField=true&moduleVal="+fileupload.module+"&FieldId="+fileupload.fieldID)+"&frameorigin="+d+'"></iframe>',fileupload.fromFileUploadField=!1):o='<iframe id="zohodocsframe" height="500px" frameborder="0" width="650px" src="'+httpprotocol+t+"/gdocs?zservice=zcrm&serURL="+encodeURIComponent(n+"//"+a+"/crm/Gdocs.do")+"&frameorigin="+d+'"></iframe>'}o&&($("body").append('<div id="freezeBackGround_gdocs" style="display:block"></div>'),getObj("attachdialogdiv").style.display="block",$(getObj("attachdialogdiv")).html(o),r&&$("#attachdialogdiv").css("z-index","40"),mailsetCenter("attachdialogdiv"))}}function check(e,t,a,i,r){if(emptyCheck("assignedto","Owner Name")){null==document.changeEntityOwner.notify?document.changeEntityOwner.action=Crm.getCrmBasePath()+"/ChangeOwnership.do?target="+e+"&display_cust_view_name="+t+"&cvid="+a+"&module="+r:document.changeEntityOwner.notify.checked?document.changeEntityOwner.action=Crm.getCrmBasePath()+"/ChangeOwnership.do?target="+e+"&display_cust_view_name="+t+"&cvid="+a+"&module="+r+"&notify=true":document.changeEntityOwner.action=Crm.getCrmBasePath()+"/ChangeOwnership.do?target="+e+"&display_cust_view_name="+t+"&cvid="+a+"&module="+r+"&notify=false";var l=document.getElementById("saveBtn");l.disabled=!0,l.style.opacity="0.7",document.changeEntityOwner.id.value=i,document.changeEntityOwner.submit()}}function deleteAction(e,t,a,i){var r=$("#deletepopup");if(e.indexOf("closeTask.do")>-1){var l=localStorage.getItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID);"string"==typeof l&&(l="true"===l);var n=networkUtils.parseUrl(e).params;if(($("#showDontAskOption").prop("checked")||l)&&(localStorage.setItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID,!0),l=!0,"Activities"!==n.module&&"Tasks"!==n.module&&"Home_Tasks"!==n.module||(Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup=!0)),!Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup&&"hidden"===r.css("visibility")){var s=window.event,o=renderingUtils.getTargetElem(s);return void showDeletePopup(I18n.getMsg("crm.confirm.close.task"),"crm.label.yes","","",o,void 0,"primarybtn",!0)}}document.deleteForm.action=e,document.deleteForm.method="post";var d="show";getObj("setupshow")&&(d="result",getObj("subTabBottomDiv")&&(d="subTabBottomDiv"));if(1==t)document.deleteForm.submit(),r.is(":visible")&&hideAnimatePopup("deletepopup");else{var c=!1;n=networkUtils.parseUrl(e).params;if(e.indexOf("closeTask.do")>-1&&(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains("Tasks"))){c=!0,Crm.VR||(Crm.VR={});var m=Crm.getCrmBasePath()+"/ShowEntityInfo.do?id="+n.taskid+"&module=Tasks&format=json";if(Crm.VR.ajaxEditFieldLabel="STATUS",!i)return void Crm.downloadValidationRules(m,"Tasks",(function a(){deleteAction(e,t,a,!0)}))}if(e.indexOf("closeTask.do")>-1&&(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains("Tasks"))){freezeBackground();var u={module:"Tasks",entityId:n.taskid,layoutId:""};return c&&(u.includeVR=!0),u[csrfParamName]=encodeURIComponent(csrfToken),void(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/FormRule.do?action=getLayoutRuleNEntityInfo",data:u,type:"POST",success:function(t){returnJson=$.parseJSON(t.entityInfo),c&&(Crm.VR.entityDetails=returnJson,Crm.validationRuleJSONData.Tasks=JSON.parse(t.validationRuleJSON)),CFRExec.init(t.layoutRuleJSONObj,"Tasks","list");var i=CFRExec.getTaskCompletedOptionLabel("list");if(CFRExec.evalAjaxEditForLayoutRule("Tasks","STATUS",i)){hideAnimatePopup("deletepopup");var l={};l.moduleid=n.taskid,l.module="Tasks",l.columnName="STATUS",l.fieldValue=i,networkUtils.setCsrfParam(l);var s=$("#showDontAskOption").prop("checked"),o=$("#notifyOwnerOption").prop("checked");Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup||(s&&(l.isDontAskAgainChecked=s),l.isNotifyOwnerChecked=o),l.check={type:"closeTask",module:"Tasks",id:n.taskid,url:e},l.check.from="dashboard",CFRExec.haltStageChange(l)}else c?new Promise((function(t){t(evalVRForDbTaskClose(n,e))})).then((function(e){e||(removeFreezeLayer(),doAjaxUpdateForm(d,document.deleteForm,a),r.is(":visible")&&hideAnimatePopup("deletepopup"))})):(removeFreezeLayer(),doAjaxUpdateForm(d,document.deleteForm,a),r.is(":visible")&&hideAnimatePopup("deletepopup"))},error:function(e){alert(I18n.getMsg("game.common.error")),hideAnimatePopup("deletepopup")}})}if(c)return freezeBackground(),(u={module:"Tasks",entityId:n.taskid,layoutId:""})[csrfParamName]=encodeURIComponent(csrfToken),u.onlyEntityDetails=!0,u.includeVR=!0,void(new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/FormRule.do?action=getLayoutRuleNEntityInfo",data:u,type:"POST",success:function(t){returnJson=$.parseJSON(t.entityInfo),Crm.VR.entityDetails=$.parseJSON(t.entityInfo),Crm.validationRuleJSONData.Tasks=JSON.parse(t.validationRuleJSON),new Promise((function(t){t(evalVRForDbTaskClose(n,e))})).then((function(e){e||(removeFreezeLayer(),doAjaxUpdateForm(d,document.deleteForm,a),r.is(":visible")&&hideAnimatePopup("deletepopup"))}))},error:function(e){alert(I18n.getMsg("game.common.error")),hideAnimatePopup("deletepopup")}});doAjaxUpdateForm(d,document.deleteForm,a),r.is(":visible")&&hideAnimatePopup("deletepopup")}r.is(":visible")&&hideAnimatePopup("deletepopup")}function evalVRForDbTaskClose(e,t){var a=CVRExec.getTaskCompletedUserValue();return CVRExec.setAjaxEditPrimaryField(!0),new Promise((function(e){e(CVRExec.evalRules("view","Tasks","STATUS",!0,!0))})).then((function(i){if(!i){hideAnimatePopup("deletepopup");var r={};r.moduleid=e.taskid,r.module="Tasks",r.columnName="STATUS",r.fieldValue=a;var l=$("#showDontAskOption").prop("checked"),n=$("#notifyOwnerOption").prop("checked");return Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup||(l&&(r.isDontAskAgainChecked=l),r.isNotifyOwnerChecked=n),networkUtils.setCsrfParam(r),r.check={type:"closeTask",module:"Tasks",id:e.taskid,url:t},r.check.from="dashboard",CVRExec.storeCachedParams(r),!0}return!1}))}function checkFields(e){var t=document.getElementById("name").value.trim(),a=document.getElementById("link").value.trim(),i=document.getElementById("weblink").getAttribute("webtablink");if(""==t.trim())return crmui.showMsgBand("warning",I18n.getMsg("crm.webtab.name.check"),2e3),document.getElementById("name").focus(),!1;if(!checkSplChars("name",I18n.getMsg("crm.webtab.name")))return!1;if(!e){var r=new RegExp("^http[s]?://");if(""==a.trim())return crmui.showMsgBand("warning",I18n.getMsg("crm.webtab.validwebAddress"),2e3),document.getElementById("link").focus(),!1;if(!isValidWebURL(i,a.split("?")[0]))return document.getElementById("link").focus(),!1;if(r.test(a))return!0;if(r.test(a)||a.length>0)return document.getElementById("link").value="http://"+a,!0}return!0}function selectPermaLink(e,t){var a=document.querySelector("#tabNameLyte");""==a.ltProp("value").trim()&&(e=e.replace(/_/g," "),a.ltProp("value",e)),document.querySelector("#link").ltProp("value",t),$("#save_webTab").removeClass("inActiveSec"),closeownernamedialog()}function cancel(){document.location.href=Crm.getCrmBasePath()+"/SaveCreator.do?action=webTab"}function addToGTask(e){var t=Crm.getCrmBasePath()+"/GApps.do?mode=CheckGTask&isListView=true";freezeBackground(),loadAjaxTab("");var a=csrfParamName+"="+encodeURIComponent(csrfToken);mR(t,(function(t){var a=t;if(commonUtils.showHideLoadingDiv(),"true"==a)removeFreezeLayer(),addCrmTaskIdsToGTask(e);else{taskArr=e;document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop;$("#lookupdiv").css({display:"block","z-index":"30",width:"650px",position:"absolute"}),$("#lookupdiv").html(a),mailsetCenter("lookupdiv")}}),a)}function addCrmTaskIdsToGTask(e){freezeBackground();var t=getObj("imageLoading"),a=csrfParamName+"="+encodeURIComponent(csrfToken);t.style.display="block",mailsetCenter("imageLoading");var i=Crm.getCrmBasePath()+"/GApps.do?mode=GTaskSync&taskIds="+e;mR(i,(function(e){var t="gCalMessageDiv";$("#"+t).empty(),document.getElementById(t).innerHTML=e,getObj("imageLoading").style.display="none",removeFreezeLayer(),getObj("gCalMessageDiv").style.display="block",mailsetCenter("gCalMessageDiv"),$("#gCalMessageDiv").fadeOut(2e3)}),a)}function addToGCal(e,t,a,i,r,l,n,s,o,d,c){var m="",u=crmTab.getFromCache(e);if(0==u.body.length)return alert(I18n.getMsg("crm.alert.select.one")),!1;if(0==(m=u.selectedIds).length)return alert(I18n.getMsg("crm.alert.select.one")),!1;if(m=m.join(","),crmListView.startIndex={},!(t.indexOf("Events")>-1))return addToGTask(m),!1;freezeBackground(),getObj("imageLoading").style.display="block",mailsetCenter("imageLoading");var p=Crm.getCrmBasePath()+"/GApps.do?mode=GCalSync&eventIds="+m;mR(p,(function(e){var t="gCalMessageDiv";$("#"+t).empty(),document.getElementById(t).innerHTML=e,getObj("imageLoading").style.display="none",removeFreezeLayer(),getObj("gCalMessageDiv").style.display="block",mailsetCenter("gCalMessageDiv"),$("#gCalMessageDiv").fadeOut(2e3)}))}function GMailConfig(){var e=document.gmailConfForm.incomingUser.value,t=document.gmailConfForm.incomingPasswd.value;if(""==trim(e))return alert(I18n.getMsg("crm.alert.GApps.userId")),!1;if(""==trim(t))return alert(I18n.getMsg("crm.alert.GApps.password")),!1;freezeBackground(),getObj("gmailConfigDiv").style.display="none";var a=getObj("imageLoading");a.style.display="block",mailsetCenter("imageLoading");var i=csrfParamName+"="+encodeURIComponent(csrfToken),r=Crm.getCrmBasePath()+"/GApps.do?mode=GMailConfig&incomingUser="+e+"&incomingPasswd="+t;return mR(r,(function(e){removeFreezeLayer();var t=e,i=document.getElementById("result");$("#result").empty(),i.innerHTML=t,document.gmailConfForm.reset(),a.style.display="none",getObj("gmailMessageDiv").style.display="block",mailsetCenter("gmailMessageDiv")}),i),!1}function openCRMGadGets(e,t){var a=window.location.protocol;freezeBackground();var i="<iframe id='zohoGadgetsframe' height='500px' frameborder='0' width='650px' src='"+a+"//"+RebrandLinkUtil.getProperty("GadGetsURL")+"/embed/crm/"+e+"?title="+t+"'> </iframe>";getObj("mainGadgetsDiv").style.display="block",$("#gadgetsdiv").empty(),getObj("gadgetsdiv").innerHTML=i,mailsetCenter("mainGadgetsDiv")}function openEGadgets(e,t){if("google"==e){var a=httpprotocol+"www.google.com/ig/directory?url=hosting.gmodules.com/ig/gadgets/file/112646789256826398286/";"tasks"==t?window.open(a+"ZohoCRMTasks.xml"):"contacts"==t?window.open(a+"ZohoCRMContacts.xml"):"leads"==t?window.open(a+"ZohoCRMLeads.xml"):"accounts"==t&&window.open(a+"ZohoCRMAccounts.xml")}else{var i=httpprotocol+"www.orkut.co.in/Main#AppInfo.aspx?appUrl="+httpprotocol+"hosting.gmodules.com/ig/gadgets/file/112646789256826398286/";"tasks"==t?window.open(i+"ZohoCRMTasks_Embed.xml&objs=&sn=&ref=SR"):"contacts"==t?window.open(i+"ZohoCRMContacts_Embed.xml&objs=&sn=&ref=SR"):"leads"==t?window.open(i+"ZohoCRMLeads_Embed.xml&objs=&sn=&ref=SR"):"accounts"==t&&window.open(i+"ZohoCRMAccounts_Embed.xml&objs=&sn=&ref=SR")}}function hideQuickCreate(){var e=getObj("ph3"),t=getObj("h3");null!=e&&null!=t&&(t.style.display="none",e.style.display="none")}function splitDialCode(e){var t=document.getElementById("dialCodeBackUp")[e].value.split(";");document.getElementById("groupName").selectedIndex=e;var a=document.createElement("SELECT");if(a.setAttribute("id","dialCode"),a.setAttribute("name","dialCode"),a.className="select",a.onchange=function(){phoneFormat()},document.getElementById("dialLabel").appendChild(a),valueArray=t,labelArray=t,t.length>1){$("#dialLabel").empty();for(var i=0;i<valueArray.length;i++){if(0==i){(r=document.createElement("option")).text="-None-",r.value="";try{a.add(r,null)}catch(e){a.add(r)}}(r=document.createElement("option")).text=changeDialCodeShape(valueArray[i]),r.value=changeDialCodeShape(labelArray[i]);try{a.add(r,null)}catch(e){a.add(r)}}document.getElementById("dialLabel").appendChild(a),$("#pbxLabel").empty(),document.getElementById("pbxLabel").innerHTML=document.getElementById("pbxType").value}else if(1==t.length&&""!=t&&"NOPREFIX"!=t){$("#dialLabel").empty();for(i=0;i<valueArray.length;i++){if(0==i){(r=document.createElement("option")).text="-None-",r.value="";try{a.add(r,null)}catch(e){a.add(r)}}var r;(r=document.createElement("option")).text=changeDialCodeShape(valueArray[i]),r.value=changeDialCodeShape(labelArray[i]);try{a.add(r,null)}catch(e){a.add(r)}}document.getElementById("dialLabel").appendChild(a),$("#pbxLabel").empty(),document.getElementById("pbxLabel").innerHTML=document.getElementById("pbxType").value}else $("#dialLabel").empty(),document.getElementById("dialLabel").innerHTML=document.getElementById("dialCodeBackUp")[e].value,$("#pbxLabel").empty(),document.getElementById("pbxLabel").innerHTML=document.getElementById("pbxType").value;phoneFormat()}function changeDialCodeShape(e){var t=new Array,a="";return t=e.split(":"),null!=e&&(a=t[0],""!=t[1]&&null!=t[1]&&(a+="("+t[1]+")")),a}function phoneFormat(){$("#phoneLabel").empty(),null!=document.getElementById("dialCode")&&null!=document.getElementById("dialCode")?dialCode=document.getElementById("dialCode").value:dialCode=document.getElementById("dialLabel").innerHTML;var e=splitByPattern("\\((.*?)\\)",dialCode);e=""!=e?e+"-":"",$("#phoneLabel").empty(),document.getElementById("phoneLabel").innerHTML=e+document.getElementById("toNumber").value}function showCFoffectedRecords(e,t,a,i,r){edUrl=a;$(getElemById(t+"div"));if("scoringRule"!==t){if(i){var l=$(document.createElement("div"));l.attr("id",t+"head").addClass("denyHead crm-font-regular wfcustomActionHead").text(I18n.getMsg("crm.workflow.title")+" "+t),l.insertAfter($("#wfDGdiv"));var n=$(document.createElement("div"));n.attr("id",t+"div").addClass("ncff wfcustomActionDiv"),n.insertAfter(l)}else null!=getElemById(t+"head")&&(getElemById(t+"head").style.display="",getElemById(t+"div").style.display="");var s=document.createElement("ul"),o={},d=[];for(var c in e){var m=e[c];"canvasUsed"!==t&&"voc"!==t||(m=[e[c]]),"ziaSimilarity"===t&&(m=e[c]),"dbComponents"==t||"wizardUsed"===t?m.name&&(m.name=("dbComponents"===t&&m.feature_type&&m.feature_type,m.name),m[0]=m.name):"bPTransCriRule"==t?m[0]=m.ProcessName:"reports"===t&&m.name&&(m[0]=m.name),m[0]=$ESAPI.encoder().encodeForHTML(m[0]),(g=document.createElement("li")).setAttribute("class","p3");v=document.createElement("a");$(v).empty(),v.innerHTML=m[0];a=edUrl;if(i)a+=m[2]+"&actionId="+c;else"dbComponents"===t?"cpq"===m.feature_type?a=Crm.getCrmBasePath()+"/tab/Quotes":a+=m.dashboardid+"&chooseComponent="+c:"reports"===t?a+=c:"segmentCriteria"===t||"segmentField"===t?a=a+c+"/edit?step=1":"abmConfig"===t?a=m[0].includes("RFM")?edUrl+"techniques/rfm":m[0].includes("Firmographic")?edUrl+"techniques/firmographic":edUrl+c:"abmSegment"===t?a=edUrl+c+"/home":"lookupFilter"===t?a+=m[1]+"&module="+m[2]:"canvasUsed"===t||"ziaSimilarity"===t?a=edUrl:"calSch"===t?a=a+"/"+c+"/edit?module=Events&type="+m[1]:"wfDG"===t?a=a+c+"Row":"customButton"===t?a=a.replace("${module}",m[3]):"wizardUsed"==t?a=a+c+"?layoutid="+r:"territory"===t||"cpqProductConfigurator"===t||"cpqPriceRule"===t?a=a+c+"/edit":"visionRulesOfLayout"===t?a+=c:"sharingRules"===t?a=a.replace("{id}",c):("webForm"!==t||"wfAlert"===t)&&(a+=c);if("formRule"!=t&&"vR"!=t||(a=a+"&layoutId="+m[1]),v.setAttribute("href",a),v.setAttribute("target","_blank"),"layout"===t)"-1"===m[1]||!CrmPageLayout.isMPLAvailable&&!CrmPageLayout.isMPLInGracePeriod?($(g).empty(),g.innerHTML=m[0]):g.appendChild(v),o[m[0]]=g,d.push(m[0]);else if("bPTransCriRule"===t)g.appendChild(v),m.Transitions.forEach((function(e){var a=document.createElement("span");a.innerHTML="vR"!=t?" -  "+e:"( "+e+" )",a.setAttribute("class","mL10");var i=g.cloneNode(!0);i.appendChild(a),s.appendChild(i)}));else if("lookupFilter"===t){moduleRecordMapping[m[2]].visible||(v.setAttribute("href","#"),$(v).on("click",(function(){return renderingUtils.showCustomAlert(I18n.getMsg("crm.lookupfilter.fielddelete.modulehidden.error")),!1}))),g.appendChild(v),(u=document.createElement("span")).innerHTML="("+I18n.getMsg("crm.label.module")+":"+m[3]+")",u.setAttribute("class","mL5"),g.appendChild(u),s.appendChild(g)}else{var u;if(g.appendChild(v),"bPTransRule"==t||"orchTransRule"==t||"bPTransAction"==t||"vR"==t&&null!=m[2])(u=document.createElement("span")).innerHTML="vR"!=t?" -  "+m[1]:"( "+m[2]+" )",u.setAttribute("class","mL10"),g.appendChild(u);s.appendChild(g)}}if("layout"===t){d=d.sort((function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}));for(var p=0;p<d.length;p++){var g=o[d[p]];s.appendChild(g)}}$(getElemById(t+"div")).html(""),getElemById(t+"div").appendChild(s)}else{if(0===$("#"+t+"head").has("a").length){var v=document.createElement("a");$(v).empty(),v.innerHTML=I18n.getMsg("crm.label.scoring.rules"),v.setAttribute("href",a),v.setAttribute("class","mL5"),v.setAttribute("target","_blank"),getElemById(t+"head").appendChild(v)}getElemById(t+"head").style.display=""}}function deleteCRFWarning(e,t,a,i,r,l,n,s,o,d){n=null!=n&&n,gblid=e,freezeBackground();var c=$("#gameDashboardhead");c.hide();var m=$("#gameDashboarddiv");m.empty();var u=!1,p=document.getElementById("cvdiv"),g=$("#assRestDiv");g.empty(),$("#itdiv,#businessCardDiv,#ffdiv,#afdiv,#etdiv,#cvdiv,#predictiondeldiv,#recommendationdeldiv,#ziacallanalyticsdeldiv,#wfOnFUdiv,#wfTaskdiv,#wfFUdiv,#macroFUdiv,#wfTBAdiv,#pfCridiv,#wfCridiv,#wfWHdiv,#wfDGdiv,#mailParserdiv,#convertLeadMappingdiv,#cpqProductConfiguratordiv,#cpqPriceRulediv,#soConvertMappingdiv,#quoteConvertMappingdiv,#territorydiv,#layoutdiv,#approvalRuleCridiv,#gametrophydeldiv,#gamebadgedeldiv,#autofollowdiv,#wftagActiondiv,#bPRulediv,#bPTransRulediv,#bPTransActiondiv,#assRuleDiv,#caseEscDiv,#vRdiv,#dbComponentsdiv,#reportsdiv,#calSchdiv,#lookupFilterdiv,#customButtondiv,#wfAlertdiv,#automationdiv,#orchTransRulediv,#reviewprocessCridiv,#reviewprocessdiv,#segmentCriteriadiv,#segmentFielddiv,#abmConfigdiv,#abmSegmentdiv,#bPTransCriRulediv,#wizardUseddiv,#currencyISODiv,#visionRulesOfLayoutdiv #sharingRulesFUDiv").empty();var v=$("#assRestHead");0==n?(getElemById("ithead").style.display="none",getElemById("ffhead").style.display="none",getElemById("afhead").style.display="none",getElemById("businessCardHead").style.display="none",getElemById("businessCardHead1").style.display="none",getElemById("ethead").style.display="none",getElemById("predictiondelhead")&&(getElemById("predictiondelhead").style.display="none"),getElemById("recommendationdelhead")&&(getElemById("recommendationdelhead").style.display="none"),getElemById("ziacallanalyticsdelhead")&&(getElemById("ziacallanalyticsdelhead").style.display="none"),getElemById("wizardUsedhead").style.display="none",getElemById("canvasUsedhead")&&(getElemById("canvasUsedhead").style.display="none"),getElemById("ziaSimilarityhead")&&(getElemById("ziaSimilarityhead").style.display="none"),getElemById("wfTaskhead").style.display="none",getElemById("wfFUhead").style.display="none",getElemById("wfAlerthead").style.display="none",getElemById("mailParserhead").style.display="none",getElemById("macroFUhead").style.display="none",getElemById("reviewprocessCrihead")&&(getElemById("reviewprocessCrihead").style.display="none"),getElemById("reviewprocessCridiv").style.display="none",getElemById("reviewprocesshead").style.display="none",getElemById("reviewprocessdiv").style.display="none",getElemById("wfTBAhead").style.display="none",getElemById("wfCrihead").style.display="none",getElemById("wfWHdiv").style.display="none",getElemById("wfDGdiv").style.display="none",getElemById("mailParserdiv").style.display="none",getElemById("wfWHhead").style.display="none",getElemById("wfDGhead").style.display="none",getElemById("layouthead").style.display="none",getElemById("convertLeadMappinghead").style.display="none",getElemById("quoteConvertMappinghead").style.display="none",getElemById("soConvertMappinghead").style.display="none",getElemById("scoringRulehead").style.display="none",getElemById("scoringRuleNewhead").style.display="none",getElemById("wfOnFUhead").style.display="none",getElemById("formRulehead").style.display="none",getElemById("segmentCriteriahead").style.display="none",getElemById("segmentFieldhead").style.display="none",getElemById("abmConfighead")&&(getElemById("abmConfighead").style.display="none"),getElemById("abmSegmenthead")&&(getElemById("abmSegmenthead").style.display="none"),getElemById("sharingRuleshead").style.display="none",getElemById("sharingRulesdiv").style.display="none",null!=getElemById("customButtonhead")&&null!=getElemById("calSchdhead")&&(getElemById("customButtonhead").style.display="none"),null!=getElemById("pfCrihead")&&null!=getElemById("pfCrihead")&&(getElemById("pfCrihead").style.display="none"),null!=getElemById("vRhead")&&null!=getElemById("vRhead")&&(getElemById("vRhead").style.display="none"),null!=getElemById("calSchdhead")&&null!=getElemById("calSchdhead")&&(getElemById("calSchdhead").style.display="none"),getElemById("currensyisohead")&&(getElemById("currensyisohead").style.display="none"),getElemById("visionRulesOfLayouthead")&&(getElemById("visionRulesOfLayouthead").style.display="none"),getElemById("visionRulesOfLayoutdiv")&&(getElemById("visionRulesOfLayoutdiv").style.display="none")):($("#orchTransRulehead").hide(),$("#orchTransRulediv").hide(),$("#pfCrihead").hide(),$("#wfCrihead").hide(),$("#reviewprocessCrihead").hide(),$("#reviewprocess").hide(),$("#bPRulehead").hide(),$("#bPTransRulehead").hide(),$("#bPTransCriRulehead").hide(),$("#bPTransActionhead").hide(),$("#assRuleHead").hide(),v.hide(),g.hide(),$("#caseHead").hide(),getElemById("abmConfighead").style.display="none",getElemById("abmConfigdiv").style.display="none",getElemById("abmSegmenthead").style.display="none",getElemById("abmSegmentdiv").style.display="none",getElemById("wftagActiondiv").style.display="none",$("#wftagActionhead").hide(),getElemById("approvalRuleCrihead").style.display="none",getElemById("approvalRuleCridiv").style.display="none",getElemById("visionRulesOfLayouthead")&&(getElemById("visionRulesOfLayouthead").style.display="none"),getElemById("visionRulesOfLayoutdiv")&&(getElemById("visionRulesOfLayoutdiv").style.display="none"));getElemById("canvasruledeldiv")&&getElemById("canvasrulehead")&&($("#canvasruledeldiv").empty(),getElemById("canvasrulehead").style.display="none"),$("#deleteDetails").find(".wfcustomActionHead,.wfcustomActionDiv").remove(),getElemById("autofollowhead").style.display="none",getElemById("cvhead").style.display="none",getElemById("territoryhead").style.display="none",$("#dbComponentshead").hide(),$("#reportshead").hide(),$("#cpqProductConfiguratorhead").hide(),$("#cpqPriceRulehead").hide(),$("#lookupFilterhead").hide(),$("#formRulediv").empty(),$("#wizardUseddiv").empty(),$("#canvasUseddiv").empty(),$("#ziaSimilaritydiv").empty(),$("#currencyISODiv").empty(),0==n&&(document.getElementById("caseHead")&&$("#caseHead").remove(),document.getElementById("caseEscDiv")&&$("#caseEscDiv").remove(),document.getElementById("assRuleHead")&&$("#assRuleHead").remove(),v&&v.length>0&&v.remove(),g&&g.length>0&&g.remove(),document.getElementById("assRuleDiv")&&$("#assRuleDiv").remove()),$("#gametrophydelhead,#gamebadgedelhead ").hide();var f=t.split("|~|")[0],h=t.split("|~|")[1],b=f.split("|*|");if(b.length>2){var C=JSON.parse(b[2]);for(var y in C){var I=C[y];if(("forecastField"==y||"forecastArchivedField"===y)&&"true"==I){u=!0,$("#forecastDiv").show(),$("#deleteInfo2,#deleteDetails,#deleteInfo1").hide();break}if("gametrophies"===y){var w="<ul>",A=I.length;if("true"===Crm.userDetails.isMotivatorEnabled)for(var E=0;E<A;E++)w+="<li><a href='"+Crm.getCrmBasePath()+"/gamification/rules' target='_blank'>"+$ESAPI.encoder().encodeForHTML(I[E].paramname)+"</a></li>";else for(E=0;E<A;E++)w+="<li><a href='"+Crm.getCrmBasePath()+"/ShowSetup.do?tab=general&subTab=gameSettings&action=gamesetting&entityid="+I[E].paramid+"' target='_blank'>"+$ESAPI.encoder().encodeForHTML(I[E].paramname)+"</a></li>";w+="</ul>",$("#gametrophydeldiv").html(w).show(),$("#gametrophydelhead").show()}else if("gamebadges"===y){for(var T="<ul>",S=0;S<I.length;S++)T+="<li class='p3'><a href='"+Crm.getCrmBasePath()+"/ShowSetup.do?tab=general&subTab=gameSettings&action=gamesetting&entityid="+I[S].badgeid+"' target='_blank'>"+$ESAPI.encoder().encodeForHTML(I[S].badgename)+"</a></li>";T+="</ul>",$("#gamebadgedeldiv").html(T).show(),$("#gamebadgedelhead").show()}else if("gamedashboard"===y){var L="<ul>",_=I.length;for(S=0;S<_;S++)L+="<li class='p3'><a href='"+Crm.getCrmBasePath()+"/gamification/dashboards?id="+I[S].id+"' target='_blank'>"+$ESAPI.encoder().encodeForHTML(I[S].paramname)+"</a></li>";L+="</ul>",m.html(L).show(),c.show()}else if("webtab"===y){T="<ul>";var O=I.Webtab;for(var y in O)if(O.hasOwnProperty(y)){var M=O[y];T+="<li class='p3'><link-to lt-prop-route='crm.settings.section.web-tabs.edit-webtabs' lt-prop-dp='[\""+M.id+"\"]' lt-prop-target='_blank'>"+$ESAPI.encoder().encodeForHTML(M.name)+"</link-to></li>"}T+="</ul>",$("#webTabULDiv").html(T).show(),$("#webTabHead").show()}else if("Image_Validation"===y){var P="<ul>",k=I.length;for(S=0;S<k;S++)P+="<li class='p3'><link-to data-zcqa='VisionViewfromDel"+S+"' lt-prop-route='crm.settings.section.zia.vision.view' lt-prop-target='_blank' lt-prop-dp= [\""+I[S].id+'"]>'+$ESAPI.encoder().encodeForHTML(I[S].name)+"</link-to></li>";P+="</ul>",$("#imageValidationDelDiv").html(P).show(),$("#imageValidationDelHead").show()}else if("Recommendation"===y){for(T="<ul>",k=I.length,S=0;S<k;S++)T+="<li class='p3'><link-to data-zcqa='PBViewfromDel"+S+"' lt-prop-route='crm.settings.section.zia.recommendation.view' lt-prop-target='_blank' lt-prop-dp= [\""+I[S].recommendationId+'"]>'+$ESAPI.encoder().encodeForHTML(I[S].recommendationName)+"</link-to></li>";T+="</ul>",$("#recommendationdeldiv").html(T).show(),$("#recommendationdelhead").show()}else if("Similarity"===y){for(T="<ul>",k=I.length,S=0;S<k;S++)T+="<li class='p3'><link-to data-zcqa='PBViewfromDel"+S+"' lt-prop-route='crm.settings.section.zia.similarity.view' lt-prop-target='_blank' lt-prop-dp= [\""+I[S].similarityId+'"]>'+$ESAPI.encoder().encodeForHTML(I[S].similarityName)+"</link-to></li>";T+="</ul>",$("#similaritydeldiv").html(T).show(),$("#similaritydelhead").show()}else if("Vision"===y){for(T="<ul>",k=I.length,S=0;S<k;S++)T+="<li class='p3'><link-to data-zcqa='VisionViewfromDel"+S+"' lt-prop-route='crm.settings.section.zia.vision.view' lt-prop-target='_blank' lt-prop-dp= [\""+I[S].visionId+'"]>'+$ESAPI.encoder().encodeForHTML(I[S].visionName)+"</link-to></li>";T+="</ul>",$("#visiondeldiv").html(T).show(),$("#visiondelhead").show()}else if("ZiaVoice"===y){for(var R="<ul>",D=I.length,U=0;U<D;U++){var F=I[U];R+="<li class='p3'><link-to data-zcqa='ZiaVoicefromDel"+F.configId+"' lt-prop-route='crm.settings.section.zia.zia-voice.index' lt-prop-target='_blank'>"+F.configName+"</link-to></li>"}R+="</ul>",$("#ziaVoicedeldiv").html(R).show(),$("#ziaVoicedelhead").show()}else if("canvas_rules"===y){T="<ul>",k=I.length;for(var x in I)T+="<li class='p3'><link-to data-zcqa='canvasruleViewfromDel"+x+"' lt-prop-route='crm.settings.section.canvas-builder.canvasrules' lt-prop-target='_blank' lt-prop-qp='{\"ruleId\": \""+x+"\"}' >"+$ESAPI.encoder().encodeForHTML(I[x][0])+"</link-to></li>";T+="</ul>",$("#canvasruledeldiv").html(T).show(),$("#canvasrulehead").show()}else if("inventoryRecords"===y)showCFoffectedRecords(I,"it",Crm.getCrmBasePath()+"/ShowSetup.do?tab=custom&subTab=inventory&step=editInventoryTemplate&emailTemplateId=");else if("autofollowRulesRecords"===y){document.getElementById("autofollowhead").style.display="",document.getElementById("autofollowdiv").style.display="";var N=document.createElement("ul");for(var e in null==n&&(N.style.marginTop="0px"),I){var B=I[e];(de=document.createElement("li")).setAttribute("class","p3");var j=document.createElement("a");$(j).empty(),j.innerHTML=B,j.setAttribute("href","javascript:void(0);"),j.setAttribute("data-params",'{"action":"editFollowUp", "followUpId":"'+e+'" }'),j.addEventListener("click",(function(){$("#feedsLookupDiv").data("id",gblid),CrmModule.hide("deletefield"),showFollowUpRule(this)}),!1),de.appendChild(j),N.appendChild(de)}document.getElementById("autofollowdiv").appendChild(N)}else if("formulaFiledRecords"===y)if(i){if(!CrmSubform.showFormulaFieldInvolvedAlertOnPermDel(l,r,I,d))return}else{$("#ffhead").css("display",""),$("#ffdiv").css("display","");N=document.createElement("ul");for(var e in N.style.marginTop="0px",I){var V=I[e];(de=document.createElement("li")).setAttribute("class","p3");var H=document.createElement("a"),z=Crm.getCrmBasePath()+"/EntityFieldCustomize.do?module="+V[1];if($(j).empty(),H.innerHTML=V[0],H.setAttribute("href",z),H.setAttribute("target","_blank"),V.length>2&&(CrmPageLayout.isMPLAvailable||CrmPageLayout.isMPLInGracePeriod)){var G=$("<span/>").addClass("moduleLink fontSmooth color_4");G.append("&nbsp;&nbsp;(");var q=[],J=Crm.getCrmBasePath()+"/ShowSetup.do?tab=customize&subTab=modules&innerTab=layouts&module="+V[1]+"&layoutId=",W=V[2];for(var y in W){var Y=W[y];if("-1"===Y[1])q.push(Y[0]);else{var Z=document.createElement("a"),Q=J+y;Z.setAttribute("href",Q),Z.setAttribute("target","_blank"),Z.innerHTML=$ESAPI.encoder().encodeForHTML(Y[0]),q.push(Z)}}if(q.length>0){G.append($ESAPI.encoder().encodeForHTML(q[0]));for(U=1;U<q.length-1;U++)G.append(",&nbsp;"),G.append($ESAPI.encoder().encodeForHTML(q[U]));q.length>1&&(G.append("&nbsp;"),G.append($("<span/>").addClass("color2").html(I18n.getMsg("and")+"&nbsp;")),G.append($ESAPI.encoder().encodeForHTML(q[q.length-1]))),G.append(")"),de.innerHTML=$ESAPI.encoder().encodeForHTML(V[0]),$(de).append($ESAPI.encoder().encodeForHTML(G))}else de.appendChild(H)}else!0,de.appendChild(H);N.appendChild(de)}$("#ffdiv").append(N)}else if("caseEscalationRuleRecords"===y){showLayoutOffectedPlaces("caseHead","caseEscDiv",X=I18n.getMsg("crm.pricing.case.escalation.rules"),z=Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=escalationRules",I,n)}else if("assignmentRuleRecords"===y){var X=I18n.getMsg("crm.common.menu.assignmentRules"),K=null!==Object.keys(I)[0]?"/"+Object.keys(I)[0]:"";showLayoutOffectedPlaces("assRuleHead","assRuleDiv",X,z=Crm.getCrmBasePath()+"/settings/assignment-rules"+K+"?module="+a+"&action=viewRuleEntries",I,n),n&&$("#assRuleDiv").find("ul").removeAttr("style")}else if("assignmentRestrictionRecords"==y){showLayoutOffectedPlaces("assRestHead","assRestDiv",X=I18n.getMsg("crm.label.assignment.restrictions"),z=Crm.getCrmBasePath()+"/settings/assignment-thresholds?module="+a,I,n),n&&g.find("ul").removeAttr("style")}else if("emailTemplateRecords"==y)showCFoffectedRecords(I,"et",Crm.getCrmBasePath()+"/ShowSetup.do?tab=custom&subTab=email&step=editEmailTemplate&emailTemplateId=");else if("workflowCriteriaRecords"===y)showCFoffectedRecords(I,"wfCri",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=workflow&step=showRule&ruleId=");else if("workflowTriggerRecords"===y)showCFoffectedRecords(I,"wfTrig",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=workflow&step=showRule&ruleId=");else if("game_tagActionRecords"===y)showCFoffectedRecords(I,"gameKpiCri",Crm.getCrmBasePath()+"/gamification/rules/");else if("gamedashboard"===y)showCFoffectedRecords(I,"gameDashboard",Crm.getCrmBasePath()+"gamification/dashboards?id=");else if("cpqProductConfigurator"===y)showCFoffectedRecords(I,"cpqProductConfigurator",Crm.getCrmBasePath()+"/settings/zohocpq/productConfigurator/");else if("cpqPriceRule"===y)showCFoffectedRecords(I,"cpqPriceRule",Crm.getCrmBasePath()+"/settings/zohocpq/priceRules/");else if("processFlowCriteriaRecords"===y){showCFoffectedRecords(I,n?"bPRule":"pfCri",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=process&action=getProcessDetails&module="+a+"&processId=")}else if(-1!==["automation_Task_used_details","workFlowFURuleRecords","automation_CreateRecord_used_details","orchestrationRecords","orchestrationCriteriaRecords","automationActions","workFlowWebHookRecords","chatActionsDtls","actionAlerts","wfConvertDtls","automation_triggers","orchestration_conectivity","workFlowCustomFunctions","workflowAssignOwner"].indexOf(y)){var ee=JSON.parse(JSON.stringify(I));if("automation_triggers"===y){var te=ee.Orchestration;if(te)for(var y in te){var ae=te[y].Trigger;te[y].Trigger=ae.map((function(e){return{id:e.id,rules:[{id:e.ruleId,name:e.ruleName,subtype:e.subtype,subtype_id:e.subtype_id,subtype_name:e.subtype_name}]}}))}}renderAutomationDenyPopComp(ee,void 0,void 0,"#automationdiv")}else if("workOnFURuleRecords"===y)showCFoffectedRecords(I,"wfOnFU",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=workflow&step=showRule&ruleId=");else if("workFlowFURuleRecords"===y)showCFoffectedRecords(I,"wfFU",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=fieldUpdate&step=showFieldUpdate&fieldUpdateId=");else if("mailParserRuleRecords"===y)showCFoffectedRecords(I,"mailParser",Crm.getCrmBasePath()+"/settings/email-parser/");else if("macroFURecords"===y)showCFoffectedRecords(I,"macroFU",Crm.getCrmBasePath()+"/showMacro.do?type=2&module="+a+"&ruleId=");else if("workFlowTimeRuleRecords"===y)showCFoffectedRecords(I,"wfTBA",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=workflow&step=showRule&ruleId=");else if("WorkFlow Custom Actions"===y)for(var ie in I){showCFoffectedRecords(I[ie],ie,Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=workflow&step=showRule&ruleId=",!0)}else if("Prediction"===y)showCFoffectedRecords(I,"predictiondel",Crm.getCrmBasePath()+"/settings/zia/prediction/");else if("territoryRecords"===y)showCFoffectedRecords(I,"territory",Crm.getCrmBasePath()+"/settings/territories/");else if("approvalCriteriaRecords"===y)showCFoffectedRecords(I,"approvalRuleCri",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=approvalProcess&processId=");else if("scoringRules"===y)isMultiScoreAvail?showCFoffectedRecords(I,"scoringRuleNew",Crm.getCrmBasePath()+"/settings/scoring-rules/"):showCFoffectedRecords(I,"scoringRule",Crm.getCrmBasePath()+"/settings/scoring-rules?module="+a);else if("scoringRulesLayoutAssociated"===y)showCFoffectedRecords(I,"scoringRuleNew",Crm.getCrmBasePath()+"/settings/scoring-rules/");else if("layoutRecords"===y)showCFoffectedRecords(I,"layout",Crm.getCrmBasePath()+"/ShowSetup.do?tab=customize&subTab=modules&innerTab=layouts&module="+(void 0!==s?s:a)+"&layoutId=");else if("formRuleObj"===y)showCFoffectedRecords(I,"formRule",Crm.getCrmBasePath()+"/ShowSetup.do?tab=customize&subTab=modules&innerTab=formRules&module="+a+"&formRuleId=");else if("workflow_tagActionRecords"===y){renderAutomationDenyPopComp(ee=JSON.parse(JSON.stringify(I)),void 0,void 0,"#automationdiv")}else if("processFlowCriteriaRecords"===y||"blueprintRecords"===y)showCFoffectedRecords(I,"bPRule",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=process&action=getProcessDetails&module="+a+"&processId=");else if("wizardRecords"===y)showCFoffectedRecords(I,"wizardUsed",Crm.getCrmBasePath()+"/settings/wizard/",void 0,void 0!==o?o:e);else if("CanvasRecords"==y)showCFoffectedRecords(I,"canvasUsed",Crm.getCrmBasePath()+"/settings/canvas-builder/detailview?feature=DetailView&module="+a+"&layoutId="+e);else if("ZiaSimilarityRecords"===y)showCFoffectedRecords(I,"ziaSimilarity",Crm.getCrmBasePath()+"/settings/zia/similarity/"+Object.keys(I)[0]);else if("blueprintTransitionCriteriaRecords"==y)showCFoffectedRecords(I,"bPTransCriRule",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=process&action=getProcessDetails&module="+a+"&processId=");else if("processFlowTransitionCriteriaRecords"===y)showCFoffectedRecords(I,"bPTransRule",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=process&action=getProcessDetails&module="+a+"&processId=");else if("processFlowTransitionActionRecords"===y)showCFoffectedRecords(I,"bPTransAction",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=process&action=getProcessDetails&module="+a+"&processId=");else if("orchestrationTransitionCriteriaRecords"==y)showCFoffectedRecords(I,"orchTransRule",Crm.getCrmBasePath()+"/settings/commandcenter/");else if("ConvertLeadMapping"===y)showCFoffectedRecords(I,"convertLeadMapping",Crm.getCrmBasePath()+"/ShowSetup.do?tab=customize&subTab=modules&innerTab=layouts&module=Leads&isLoadPage=mapping&leadLayoutId=");else if("QuoteConvertMapping"===y)showCFoffectedRecords(I,"quoteConvertMapping",Crm.getCrmBasePath()+"/settings/modules/Quotes/conversion-mapping?quoteLayoutId=");else if("SOConvertMapping"===y)showCFoffectedRecords(I,"soConvertMapping",Crm.getCrmBasePath()+"/settings/modules/SalesOrders/conversion-mapping?salesOrderLayoutId=");else if("validation_rule"===y)showCFoffectedRecords(I,"vR",Crm.getCrmBasePath()+"/ShowSetup.do?tab=customize&subTab=modules&innerTab=validationRules&module="+a+"&validationRuleId=");else if("DashboardComponents"===y){for(var re in I)I[re].feature_type&&"cpq"===I[re].feature_type&&(I[re].name=I18n.getMsg("cpqdashboard.component.chart.name",[moduleRecordMapping.Quotes.plural_label,r]));showCFoffectedRecords(I,"dbComponents",Crm.getCrmBasePath()+"/Dashboard.do?action=showDashboard&dbId=")}else"Reports"===y?showCFoffectedRecords(I,"reports",Crm.getCrmBasePath()+"/tab/Reports/"):"calendarScheduling"===y?showCFoffectedRecords(I,"calSch",Crm.getCrmBasePath()+"/settings/booking"):"workflowAssignOwner"===y?showCFoffectedRecords(I,"wfAssignOwner",Crm.getCrmBasePath()+"/ShowSetup.do?tab=automate&subTab=workflow&step=showRule&ruleId="):"lookupFilterCriteria"===y?showCFoffectedRecords(I,"lookupFilter",Crm.getCrmBasePath()+"/ShowSetup.do?tab=customize&subTab=modules&innerTab=layouts&layoutId="):"customButtonRecords"===y?showCFoffectedRecords(I,"customButton",Crm.getCrmBasePath()+"/settings/modules/${module}/links-and-buttons"):"ReviewProcessCriteria"===y?showCFoffectedRecords(I,"reviewprocessCri",Crm.getCrmBasePath()+"/settings/review-process/"):"ReviewProcess"===y?showCFoffectedRecords(I,"reviewprocess",Crm.getCrmBasePath()+"/settings/review-process/"):"segmentCriteria"===y||"segmentField"===y?showCFoffectedRecords(I,y,Crm.getCrmBasePath()+"/settings/segmentation/"):"abmConfig"===y?showCFoffectedRecords(I,y,Crm.getCrmBasePath()+"/abm/configuration/"):"abmSegment"===y?showCFoffectedRecords(I,y,Crm.getCrmBasePath()+"/abm/segments/"):"voc"===y?showCFoffectedRecords(I,y,Crm.getCrmBasePath()+"/tab/voc/analytics/"):"visionRulesOfLayout"===y?showCFoffectedRecords(I,y,Crm.getCrmBasePath()+"/settings/zia/vision/"):"sharingRules"===y&&showCFoffectedRecords(I,y,Crm.getCrmBasePath()+"/settings/data-sharing/{id}/edit?module="+a)}}var le=b[0];if(b[1]&&"false"!=le)var ne=b[1].split("~~");var se=!1;if(le.indexOf("||**||true")>-1&&(le=le.replace("||**||true",""),se=!0),le=le.split("~~"),p.innerHTML="",se||le[0].length&&!u){document.getElementById("cvhead").style.display="",p.style.display="";var oe;N=document.createElement("ul");for(null==n&&(N.style.marginTop="0px"),oe="Tasks"==a||"Calls"==a||"Events"==a?"Activities":a,U=0;U<le.length-1;U++){var de=document.createElement("li"),ce=document.createElement("link-to");ce.setAttribute("lt-prop-route","crm.settings.section.custom-view.cvid.edit-custom-view"),ce.setAttribute("lt-prop-dp",JSON.stringify([ne[U]])),ce.setAttribute("lt-prop-qp",JSON.stringify({module:oe})),ce.setAttribute("lt-prop-target","_blank"),ce.innerText=revertSplChrs(le[U]),de.appendChild(ce),N.appendChild(de)}if(p.appendChild(N),null!=h){var me=document.getElementById("lookupCrtDiv");me.style.display="",document.getElementById("lookupheading").style.display="",h=h.split("|*|");for(var ue=document.createElement("ul"),pe=h[0].split("~~"),ge=h[1].split("~~"),ve=pe.length,fe=0;fe<ve;fe++){(de=document.createElement("li")).innerHTML=pe[fe]+" ("+ge[fe]+" )",ue.appendChild(de)}me.appendChild(ue)}if(se){var he=$("#cvdiv").width()-20;$("#cvdiv").append('<div style="width:'+he+'px" id="AccessCVWarning">'+I18n.getMsg("crm.warning.delete.field.from.inaccessible.cv")+"</div><br>")}}if(u||($("#forecastDiv").hide(),$("#deleteInfo2,#deleteDetails,#deleteInfo1").show()),void 0!==i){var be=$("#deletefield");be.find("#delfldhd").html(I18n.getMsg("crm.fielddelete.title")),be.find("#deleteInfo1").html(I18n.getMsg("crm.fielddelete.info1.1",$ESAPI.encoder().encodeForHTML(r))),be.find("#deleteInfo2").html(I18n.getMsg("crm.fielddelete.info2"))}i||null==n||null!=n&&0==n?($("#deletefield").addClass("ppTop p0"),crmui.showPopup("deletefield")):($("#tagDelete").addClass("ppTop p0"),crmui.showPopup("tagDelete"))}function renderAutomationDenyPopComp(e,t,a,i,r){i&&$(i).empty();var l=networkUtils.returnDependencyFiles(["crm-automationcomponentDenyPop.js",networkUtils.getI18nJSUrl("facebook"),networkUtils.getI18nJSUrl("twitter")],crmConstants.jsStaticPathForLyte);Lyte.injectResources(l,void 0,(function(){Lyte.Component.render("crm-automation-component-denypop",{values:e,actionIdVsOptionArr:t,componentId:a,newUiModel:r},i)})),i&&$(i).show()}function renderDenyTemp(e,t,a){var i,r,l,n="workflow"==t?I18n.getMsg("rule.smaller.case"):I18n.getMsg("process.smaller.case");r=I18n.getMsg("deluge.v1.deny.msg.info1",n),l=I18n.getMsg("deluge.v1.deny.msg.info2")+' <a class="mL3" target="_blank" href="'+RebrandLinkUtil.getProperty("V1_DEPRECATED_HELP_DOC")+'">'+I18n.getMsg("crm.label.function.v1.deprecation.readmore")+"</a><br> "+I18n.getMsg("deluge.v1.deny.msg.info3"),"statuschange"==a&&(i=I18n.getMsg("rule.activate.deny",n)),"save"==a&&(i=I18n.getMsg("rule.save.deny",n)),"republish"==a&&(i=I18n.getMsg("republish.deny.msg",n)),"publish"==a&&(i=I18n.getMsg("publish.deny.msg",n));var s=Handlebars.templates.deleteFieldWarningPopup();$("#result").append(s);var o=$("#automationdiv");$("#delfldhd").html(i);var d=document.createElement("div"),c=document.createElement("ul"),m=e.details;for(var u in m){var p=m[u],g=document.createElement("li");g.setAttribute("class","p3"),g.innerHTML='<a class="mL3" target="_blank" href='+Crm.getCrmBasePath()+"/settings/workflow-deluge?delugeId="+u+">"+$ESAPI.encoder().encodeForHTML(p)+"</a>",c.appendChild(g)}d.appendChild(c),d.setAttribute("class","denyHead crm-font-regular mT10"),o.html(d),o.show(),$("#deleteInfo1").html(r),$("#deleteInfo2").html(l),crmui.showPopup("deletefield")}function showLayoutOffectedPlaces(e,t,a,i,r,l){var n=l?$("#"+e):document.createElement("div");l||(n.setAttribute("id",e),n.setAttribute("class","denyHead crm-font-regular"),$(n).empty(),n.innerHTML=a);var s=l?$("#"+t):document.createElement("div");l||(s.setAttribute("id",t),s.setAttribute("class","ncff"));var o=document.createElement("ul");for(var d in o.style.marginTop="0px",r){var c=r[d],m=document.createElement("li");m.setAttribute("class","p3");var u=document.createElement("a");if($(u).empty(),u.innerHTML=c[0],"assRestHead"===e){var p=i.replace("/assignment-thresholds","/assignment-thresholds/"+d);u.setAttribute("href",p)}else u.setAttribute("href",i);u.setAttribute("target","_blank"),m.appendChild(u),o.appendChild(m)}var g=$("#deletefield").find("#deleteDetails");l?(n.show(),s.show()):(g.append(n),g.append(s)),document.getElementById(t).appendChild(o)}function closeTask(e,t,a){var i=localStorage.getItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID);"string"==typeof i&&(i="true"===i);var r=networkUtils.parseUrl(e).params;if(!i||"Tasks"!==$("#module").val()&&"Activities"!==r.module&&"Tasks"!==r.module||(Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup=!0),!Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup&&"hidden"===$("#deletepopup").css("visibility")){var l=networkUtils.parseUrl(e).params,n=window.event,s=renderingUtils.getTargetElem(n),o=new crmRequestPool;return l[csrfParamName]=encodeURIComponent(csrfToken),l.action="showNotifyOwner",void o.initiate({action:Crm.getCrmBasePath()+"/closeTask.do",data:l,type:"POST",success:function(e){showDeletePopup(I18n.getMsg("crm.confirm.close.task"),"crm.label.mark.completed","","",s,void 0,"primarybtn",!0,void 0,"true"==e,t)},error:function(){showDeletePopup(I18n.getMsg("crm.confirm.close.task"),"crm.label.mark.completed","","",s,void 0,"primarybtn",!0,void 0,!1,t)}})}var d=!1;r=networkUtils.parseUrl(e).params;if($("#showDontAskOption").prop("checked")&&("Activities"===r.module||Crm.isActivitySplitDone&&"Tasks"===r.module)&&(localStorage.setItem("isDontAskAgainChecked_"+Crm.userDetails.ZUID,!0),Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup=!0),void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains("Tasks")){d=!0,Crm.VR||(Crm.VR={}),"detailView"==r.page&&(Crm.VR.entityDetails=returnJson?objectUtils.cloneObject(returnJson):returnJson),Crm.VR.ajaxEditFieldLabel="STATUS";var c=Crm.getCrmBasePath()+"/ShowEntityInfo.do?id="+r.taskid+"&module=Tasks&format=json";if(!a)return void Crm.downloadValidationRules(c,"Tasks",(function(){closeTask(e,t,!0)}))}if(void 0===Crm.userDetails.LAYOUTRULEAVAILABLE||!0===Crm.userDetails.LAYOUTRULEAVAILABLE&&Crm.userDetails.LRINVOLVEDMODULES.contains("Tasks"))if(void 0===r.page||"detailView"!==r.page){freezeBackground();l={module:"Tasks",entityId:r.taskid,layoutId:""};d&&(l.includeVR=!0),l[csrfParamName]=encodeURIComponent(csrfToken);var m=$("#showDontAskOption").prop("checked"),u=$("#notifyOwnerOption").prop("checked");Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup||(m&&(r.isDontAskAgainChecked=m),r.isNotifyOwnerChecked=u),(o=new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/FormRule.do?action=getLayoutRuleNEntityInfo",data:l,type:"POST",success:function(t){returnJson=$.parseJSON(t.entityInfo),d&&(Crm.VR.entityDetails=returnJson,Crm.validationRuleJSONData.Tasks=JSON.parse(t.validationRuleJSON)),CFRExec.init(t.layoutRuleJSONObj,"Tasks","list"),new Promise((function(t){t(validateTaskForLR(r,e,d))}))},error:function(e){alert(I18n.getMsg("game.common.error")),hideAnimatePopup("deletepopup")}})}else validateTaskForLR(r,e,d);else if(d){if(void 0===r.page||"detailView"!==r.page)return freezeBackground(),(l={module:"Tasks",entityId:r.taskid,layoutId:""})[csrfParamName]=encodeURIComponent(csrfToken),l.onlyEntityDetails=!0,l.includeVR=!0,void(o=new crmRequestPool).initiate({action:Crm.getCrmBasePath()+"/FormRule.do?action=getLayoutRuleNEntityInfo",data:l,type:"POST",success:function(t){returnJson=$.parseJSON(t.entityInfo),d&&(Crm.validationRuleJSONData.Tasks=JSON.parse(t.validationRuleJSON),Crm.VR.entityDetails=returnJson),new Promise((function(t){t(validateTaskForVR(r,e))}))},error:function(e){alert(I18n.getMsg("game.common.error")),hideAnimatePopup("deletepopup")}});new Promise((function(t){t(validateTaskForVR(r,e))}))}else removeFreezeLayer(),closeTaskNow(e)}function validateTaskForLR(e,t,a){"675892647"!=Crm.userDetails.ZGID&&"659089839"!=Crm.userDetails.ZGID&&"55171602"!=Crm.userDetails.ZGID||(murphy.addCustomTracking({message:JSON.stringify(e),name:"givenParams",type:"custom event"}),murphy.error(new Error("Layout Rule Related Information-givenParams")));var i=CFRExec.getTaskCompletedOptionLabel("list");"675892647"!=Crm.userDetails.ZGID&&"659089839"!=Crm.userDetails.ZGID&&"55171602"!=Crm.userDetails.ZGID||(murphy.addCustomTracking({message:i,name:"closedLbl",type:"custom event"}),murphy.error(new Error("Layout Rule Related Information-closedLbl")));var r=CFRExec.evalAjaxEditForLayoutRule("Tasks","STATUS",i,"detailView"===e.page);if(-1!=r)if(r){hideAnimatePopup("deletepopup");var l={};l.moduleid=e.taskid,l.module="Tasks",l.columnName="STATUS",l.fieldValue=i,networkUtils.setCsrfParam(l);var n=$("#showDontAskOption").prop("checked"),s=$("#notifyOwnerOption").prop("checked");Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup||(n&&(l.isDontAskAgainChecked=n),l.isNotifyOwnerChecked=s),l.check={type:"closeTask",module:"Tasks",id:e.taskid,url:t},"true"===e.iskanbanview?l.check.from="kanbanview":"detailView"===e.page?l.check.from="detailspage":l.check.from="list",CFRExec.haltStageChange(l)}else a?new Promise((function(a){a(validateTaskForVR(e,t))})):(removeFreezeLayer(),closeTaskNow(t))}function validateTaskForVR(e,t){var a=CVRExec.getTaskCompletedUserValue();CVRExec.setAjaxEditPrimaryField(!0),new Promise((function(e){e(CVRExec.evalRules("view","Tasks","STATUS",!0,!0))})).then((function(i){if(i)removeFreezeLayer(),closeTaskNow(t);else{hideAnimatePopup("deletepopup");var r={};r.moduleid=e.taskid,r.module="Tasks",r.columnName="STATUS",r.fieldValue=a;var l=$("#showDontAskOption").prop("checked"),n=$("#notifyOwnerOption").prop("checked");Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup||(l&&(r.isDontAskAgainChecked=l),r.isNotifyOwnerChecked=n),networkUtils.setCsrfParam(r),r.check={type:"closeTask",module:"Tasks",id:e.taskid,url:t},"true"===e.iskanbanview?r.check.from="kanbanview":"detailView"===e.page?r.check.from="detailspage":r.check.from="list",CVRExec.storeCachedParams(r)}}))}function closeTaskNow(e){var t,a=networkUtils.parseUrl(e).params,i=$("#notifyOwnerOption"),r=$("#detailViewButtonLayerDiv");if(r.length&&""!=r.html()||"true"===$("#iskanbanview").val()&&$(".leftheaderBack:visible").length){(s={})[csrfParamName]=csrfToken;var l=$("#showDontAskOption").prop("checked"),n=i.prop("checked");return Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup||(l&&(s.isDontAskAgainChecked=l),s.isNotifyOwnerChecked=n),-1===e.indexOf("page")&&(s.page="detailView"),void mR(e,(function(e){if(hideAnimatePopup("deletepopup"),e.indexOf("success")>-1){Crm.isActivitySplitDone&&"Tasks"===a.module?crmTab.deleteFromCache("Tasks"):crmTab.deleteFromCache("Activities");var t=JSON.parse(e);if(isWFKafkaUser()&&(detailView.refreshInWms=t.callWMS,detailView.isWFExecInKafka=t.isWFExecInKafka,detailView.prevModule=t.module,detailView.refreshInWms))return void detailView.hideElementsForKafkaWorkFlow(t.module);var i=t.closedTime,r=t.modifiedTime,l="";null!=t.uiFormulaUpdateVals&&(l=t.uiFormulaUpdateVals),""===$('[id="value_CLOSEDTIME"]').text().trim()&&($('[id="value_CLOSEDTIME"]').text(i),$('[id="headervalue_CLOSEDTIME"]').length>0&&$('[id="headervalue_CLOSEDTIME"]').text(i));var n='<span purpose="showUserBC" data-params=\'{"userId":"'+Crm.userDetails.USER_ID+'"}\' id="ownerName_id" >'+$ESAPI.encoder().encodeForHTML(Crm.userDetails.DISPLAY_NAME)+'</span><span class="f12 color_616e88 crm-font-regular mL10 createdTimeDetailview">'+r+"</span>";$('[id="value_MODIFIEDBY"]').html(n),null!=getElemById("headervalue_MODIFIEDBY")&&$('[id="headervalue_MODIFIEDBY"]').html(n),Crm.bindEventForUserBCView();for(var s=l.split("||"),o=0;o<s.length;o++){var d=s[o].lastIndexOf("##"),c=s[o].substring(0,d),m=s[o].substring(d+2,s[o].length);null!=getElemById("value_"+c)&&($("#value_"+c).empty(),getElemById("value_"+c).innerHTML=m)}var u=$("#entityId").val(),p=$("#completedTask");completedValue=p.find("#completedValue").text(),u==a.taskid&&(p.prev("tr").hide(),p.show(),p.find("#followup").show(),p.find("#completedValue").show(),$$rightPanel.detailRightPanel(!0,"info",!0),$("#value_STATUS").text(completedValue),$("#headervalue_STATUS").text(completedValue),$("#cvlist_"+u).length&&$("#cvlist_"+u).find("#lp_Status").text(completedValue).attr("title",completedValue)),"true"===$("#iskanbanview").val()&&($("#recordid_"+a.taskid).find('[class="seperatorLine"]').hide(),$("#listViewClose_"+a.taskid).hide(),$("#recordid_"+a.taskid).find("#Status").text(completedValue).attr("title",completedValue)),detailView.replaceDataParams("STATUS",completedValue),refreshFollowDiv()}else $("#show").html(e)}),s)}if(document.getElementById("iskanbanview")&&"true"===document.getElementById("iskanbanview").value){var s={};l=$("#showDontAskOption").prop("checked"),n=i.prop("checked");-1!=e.indexOf("action=CloseTask")&&(!Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup&&l&&(e+="&isDontAskAgainChecked="+l),Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup||(e+="&isNotifyOwnerChecked="+n),t=csrfParamName+"="+csrfToken);e=networkUtils.constructUrl(e,s);ajaxNew(e,t,(function(e){var t=JSON.parse(e);if(-1!=t.response.indexOf("success")){$("#listViewClose_"+t.taskid).hide();var a=$("#recordid_"+t.taskid);a.find("#Status").text(t.taskStatus).attr("title",t.taskStatus);var i=a.find(".overDueCtn");i.length&&(i[0].parentElement.innerText=i[0].firstElementChild.innerText),hideAnimatePopup("deletepopup")}}),"closetask")}else{e=Crm.getCrmBasePath()+"/closeTask.do",a[csrfParamName]=csrfToken;var l=$("#showDontAskOption").prop("checked"),n=i.prop("checked");!Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup&&l&&(a.isDontAskAgainChecked=l),Crm.userDetails.CUSTOMIZE_INFO.CloseTaskPopup||(a.isNotifyOwnerChecked=n),"crm.tab.module.custom-view.list"==Lyte.Router.getRouteInstance().transition.target?a.from="listview":crmListView.getFilterParams(a),(new crmRequestPool).initiate({action:e,data:a,type:"POST",dataType:"json",success:function(e){if(hideAnimatePopup("deletepopup"),Crm.isActivitySplitDone&&"Tasks"===a.module?crmTab.deleteFromCache("Tasks"):crmTab.deleteFromCache("Activities"),"listview"==a.from)crmListView.reloadCurrentListView();else{if(e.body&&0!=e.body.length){for(var t=[],i=e.fromIndex-1,r=0;i<=e.toIndex;i++,r++)e.body[r]?t[i]=e.body[r]:t[i]=null;e.body=t}crmListView.createTemplate(e),Crm.isActivitySplitDone?crmTab.putInCache("Tasks",e):crmTab.putInCache("Activities",e)}}})}}function mailProcess(e){if(getObj("mailListRelId")){var t=getObj("mailListRelId").value,a=$("#norec_"+t).html(),i=$("crm-rl-users-list");if(null!=a&&" "!=a||(a=$("#ract_"+t).html()),getObj(t)){if(0==i.length&&$(getObj(t)).empty(),"object"==typeof e){var r=$("#associatedContEmail");r.length>0&&(e.associatedContEmail=r.val()),"sent_from_crm"!=e.mailType&&"allContacts"!=e.mailType||(e.mailType="ALLUSERSMAILS"),"all_contacts_sent_crm_emails"==e.mailType&&(e.mailType="allContacts"),e.isEmailSummaryEnabled=e.isSummaryEnabled,e.isEmotionsEnabled=Crm.userDetails.isEmotionsEnabled,Crm.userDetails.mailType=e.mailType,store.pushPayload("emails_rl_user",{content:"emails_"+$("#id").val(),data:e});var l=JSON.parse(JSON.stringify(e));if(l&&l.mailsList)for(var n=l.mailsList,s=n.length,o=0;o<s;o++)l.mailsList[o].source=getMailSourceString(n[o].source);var d=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("notification")],crmConstants.jsStaticPath);0==$("crm-emails-related-list").length?(Lyte.injectResources(d,void 0,void 0),Lyte.Component.render("crm-emails-related-list",l,"[id='"+t+"']")):document.querySelector("crm-emails-related-list").component.setData(l)}else getObj(t).innerHTML=e;var c=null!=e.mailsList?e.mailsList.length:0;if(c>0&&(e.mailsList[c-1].hasOwnProperty("mail_index")||e.hasOwnProperty("next_index"))){var m=$("#mailIndex");m.length>0?i.append("<input type='hidden' id='mailIndex' value='"+e.mailsList[c-1].mail_index+"'/>"):m.val(e.mailsList[c-1].mail_index)}var u=getObj(t);placeExtra()}"object"!=typeof e&&$("#ract_"+t).html(a),placeExtra(),$("#selectMails optgroup[id=zmailPublicUsers] option").sort((function(e,t){return"NA"==e.innerHTML?1:"NA"==t.innerHTML?-1:e.innerHTML>t.innerHTML?1:-1})).appendTo("#selectMails optgroup[id=zmailPublicUsers]");var p=null,g=$("#dealOnlyDropDown");if(g.length&&0==i.length&&thirdPartyUtils.bindSelect2(g),getObj("selectMails")){p=getObj("selectMails"),g.length&&("dealsOnly"===g.val()||g.attr("lt-prop-selected"))&&$(p).find('optGroup:not([type="2"]) option').prop("disabled",!0),p.style.visibility="visible";var v=$("#isFromNewAPI");v&&0==v.length&&thirdPartyUtils.bindSelect2("#selectMails")}EvalInnerScript(u),getObj("zs_EMAIL")&&(getObj("zs_EMAIL1")?getObj("zs_EMAIL").value=getObj("zs_EMAIL1").value:getObj("subvalue_EMAIL")&&(getObj("zs_EMAIL").value=getObj("subvalue_EMAIL").innerHTML)),getObj("contactSelDropdownInAcc")&&0==i.length&&thirdPartyUtils.bindSelect2("#contactSelDropdownInAcc"),populateRLCount(t)}}function SelectAllUsers(e,t,a){if(!isDisabledAll(a)){e&&getObj(t)&&getObj(t).removeChild(getObj(t+"link"));var i=document.createElement("A");document.getElementById(t)&&"selected"==document.getElementById(t).name||isCheckedAll(a)?(document.getElementById(t).name="unselected",$(i).empty(),i.innerHTML=I18n.getMsg("crm.select.unselectall"),i.setAttribute("class","pointer"),i.setAttribute("onclick","selectORUnselect('"+a+"', false);SelectAllUsers(this,'"+t+"','"+a+"');")):(getObj(t)&&(document.getElementById(t).name="selected"),$(i).empty(),i.innerHTML=I18n.getMsg("crm.select.all"),i.setAttribute("class","pointer"),i.setAttribute("onclick","SelectAllUsers(this,'"+t+"','"+a+"');selectORUnselect('"+a+"', true)")),i.id=t+"link",getObj(t)&&($(getObj(t)).empty(),getObj(t).appendChild(i))}}function togglegsearchmenu(e){var t=document.getElementById("newgsearchcatagory");"hide"!=arguments[0]&&"none"==t.style.display?t.style.display="block":t.style.display="none",sE(e)}function changeSearchCategory(e){var t=e.sModule.length;for(i=0;i<t;i++){if(0!=i&&0==e.sModule[i].checked){e.sModule[0].checked=!1;break}e.sModule[0].checked=!0}}function sendMail(e,t,a,i,r){var l=Crm.getOrgSpecificURL(Crm.getCrmBasePath()+"/tab/"+t+"/"+e+"/send-mail?action=compose&entEmail="+encodeURIComponent(a));(i&&(l+="&isRequestFrom=invitee"),document.getElementById("tkvsentmail"))&&(l=l+"&isSendMail="+document.getElementById("isSendMail").value);return openPopUp("entreplyWin",this,l,"entsend",1335,666,"toolbar=no,statusbar=no,menubar=no,directories=no,resizable=yes,scrollbars=yes"),!1}function showSubMenuLayer(){if(getObj("createsubmenu")){var e=$(window),t=$(".lyteMenuSettings #createNew");Crm.userDetails.RTL_ENABLED?($("#createsubmenu").css("left",t.offset().left-55),$("#createsubmenu .SocialArrow").css({left:"52px",right:"auto"})):($("#createsubmenu").css("right",e.width()+e.scrollLeft()-(t.offset().left+t.outerWidth())-16.5),$("#createsubmenu .SocialArrow").css({left:"auto",right:"15px"})),$("#createsubmenu .boxShadowMask").css("max-height",e.height()-($("#tabLayer").outerHeight()+20+$("#wmstoolbar").outerHeight())-70),$("#createsubmenu .boxShadowMask").addClass("oH pR"),getObj("createsubmenu").style.display="block";var a=getObj("createNew");$("#tabLayer").width(),findPosX(a),a.width;getObj("createNew").className="svgIconsImg createNewIconH",thirdPartyUtils.bindPerfectScroll("#createsubmenu .boxShadowMask",{wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!1})}}function assignRurl(){var e=getObj("rurl");e&&(cvUrlInfo.CV_URL=e.value)}function isGlobalSearch(e){if(e){var t=renderingUtils.getTargetElem(e);return $(t).parents("#gsearchTable").length}}function loadDVWithRp(e,t){var a=e.pfrom?e.pfrom:null;if("CEC"===a&&(a="cv"),$("#gsearchTable").length>1&&(e.pfrom=a="gsearch",e.FROM_INDEX=1,e.TO_INDEX=crmNavig[e.module].recordId.length),null!==a&&"null"!==a){if(e.FROM_INDEX=e.FROM_INDEX?e.FROM_INDEX:1,e.TO_INDEX=e.TO_INDEX?e.TO_INDEX:10,"rel"===(a=e[""])){var i=getObj("pn"),r=getObj("peId"),l=getObj("bMod");null!==i&&"null"!==i.value&&(e.pn=i.value),null!==r&&"null"!==r.value&&(e.peId=r.value),null!==l&&"null"!==l.value&&(e.bMod=l.value)}if("cv"===e.pfrom){var n=crmListView.getObject();n&&n.module===Crm.activityGrp[e.module]&&(crmListView.getAdvSearchCrtFromCVObject(e),e.filters&&(e.isNewFilter=!0))}var s=parseInt(e.FROM_INDEX),o=e.cvid&&null!==e.cvid&&"null"!==e.cvid?e.cvid:e.module;if("gsearch"===e.pfrom){var d=commonUtils.getFromToIndexes(parseInt(e.recordNum)-1,10);s=e.FROM_INDEX=d[0],e.TO_INDEX=d[1],s--}e.forRp=!0;for(var c=[];o&&crmNavig[o]&&crmNavig[o].recordId[s]&&s<=parseInt(e.TO_INDEX);)c.push(crmNavig[o].recordId[s].id),s++;delete e.step;var m=networkUtils.constructEncodedUrl(Crm.getCrmBasePath()+"/RelActCV.do",e,!0);(new crmRequestPool).initiate({action:m,type:"GET",data:{seIds:c.toString()},success:function(a){if(t?t({outlet:"#show",html:a}):$("#show").html(a),m=m.replace("fromActivityListView=true&",""),e.cvid&&null!==e.cvid&&"null"!==e.cvid&&(crmNavig.customViewKey=e.cvid),crmNavig[crmNavig.customViewKey]&&(crmNavig[crmNavig.customViewKey].rpURl=m),cvUrlInfo.CV_URL=m+"&seIds="+c,crmNavig.removeFeaturCacheObj("gsearch"),!t){var i=$("#detailCView").children().length;if(i<10){$("#taskMenuBlkdiv").css("min-height","0").css("height","auto");var r=parseInt(getObj("cvFromIndex").value);parseInt(getObj("cvToIndex").value);$("#from_To").text(r+" - "+(r+i-1))}}}})}}function selectCurrentCV(){var e=$("#taskDetailsPart").find("form").attr("name");if(!e||-1==e.indexOf("createEntityForm")){var t=getObj("detailCView");$(t).find("li.selectedRightActivity").removeClass("selectedRightActivity");var a=$("[name='id']").val();if(a){var i=$("#detailView_"+a);if(i.length){i.addClass("selectedRightActivity").length;Territory.doHighLight("#rightPanelInfo",i,$("#rightPanelInfo").offset().top,$("#rightPanelInfo").height())}else crmNavig.parseCurrentListView(!0)}var r=$("#backArrowDV").clone().addClass("fL pR5");0==$("#relcvname").find("#backArrowDV").length&&$("#relcvname").prepend(r.removeClass("hide"))}}function disableAll(e){var t=e.sModule.length,a=e.sModule,r=e.sModule[0].checked;for(i=1;i<t;i++){a[i].checked=r}}function showHideNew(e){var t=getObj(e);t&&("none"==t.style.display?(t.style.display="",thirdPartyUtils.bindSelect2($(".newSelect").find("select"))):"block"!=t.style.display&&""!=t.style.display||(t.style.display="none"))}function placeExtra(){try{buttonIdChange()}catch(e){}var e=document.getElementById("btl"),t=document.getElementById("getPushToDB"),a=document.getElementById("placePushToDB"),i=document.getElementById("tcInner"),r=document.getElementById("tcDiv");i&&r&&($(r).empty(),r.innerHTML=i.innerHTML),e&&document.showcvdetails&&(e.style.display="none"),t&&a&&($(a).empty(),a.innerHTML=t.innerHTML);var l=getAccessibleObj("getMailOpt"),n=getAccessibleObj("putMailOpt");l&&n&&($(n).empty(),n.innerHTML=l.innerHTML)}function swapACPcount(e,t,a,i,r){var l=0,n=0,s=0,o=0;document.getElementById("totalLead")&&(l=document.getElementById("totalLead").value),document.getElementById("totalContact")&&(n=document.getElementById("totalContact").value),document.getElementById("totalPotential")&&(s=document.getElementById("totalPotential").value),document.getElementById("potentialAmount")&&(o=document.getElementById("potentialAmount").value),0==l||"0"==l?($("#campaignSummaryRtPanel").empty(),document.getElementById("campaignSummaryRtPanel").innerHTML="<table class='campaignTable' cellspacing='0'><tr><td valign='top'><span class='relListHead'>"+t+"</span><br><span class='title'>"+n+"</span></td><td valign='top' style='border:none'><span class='relListHead'>"+a+"</span><br><span class='title'>"+s+"</span><br><span>"+i+"&nbsp; </span><span>"+o+"</span></td></tr></table>"):0!=l||0!=n||0!=s?($("#campaignSummaryRtPanel").empty(),document.getElementById("campaignSummaryRtPanel").innerHTML="<table class='campaignTable' cellspacing='0'><tr><td valign='top'><span class='relListHead'>"+e+"</span><br><span class='title'>"+l+"</span></td><td valign='top'><span class='relListHead'>"+t+"</span><br><span class='title'>"+n+"</span></td><td valign='top' style='border:none'><span class='relListHead'>"+a+"</span><br><span class='title'>"+s+"</span><br><span>"+i+"&nbsp; </span><span>"+o+"</span></td></tr></table>"):($("#campaignSummaryRtPanel").empty(),document.getElementById("campaignSummaryRtPanel").innerHTML="<table class='campaignTable' cellspacing='0'><tr><td valign='top'><span class='relListHead'>"+r+"</span></td></tr></table>"),$("#showSummaryAlink").empty(),document.getElementById("showSummaryAlink").style.display="none"}function closeCal(e){e&&sE(e)}function showHideListViewBtnFn(e){var t=$(".cvBtnHeader");($("#listviewtablescroll").length||$("#stageViewContainer").length||$("#canvasview-container").length)&&t.css("overflow","hidden"),clearTimeout(crmListView.listviewActionTimer);var a=Lyte.Router.getRouteInstance().routeName,i=$("#listviewButtonLayerDiv");if("list"==a||"canvas"==a||"kanban"==a||"zia"==a){var r=document.getElementsByTagName("crm-custom-outer-box")[0],l=r.getData("selectedIds");if(l&&l.length&&(r.setData("selectedIds",[]),"list"==a)){for(var n=$("#listviewtablescroll lyte-checkbox[data-id='selectEntity'] .customCheckBoxChecked"),s=n.length,o=0;o<s;o++)n[o].closest("lyte-checkbox").ltProp("class","customCheckBox"),n[o].classList.add("customCheckBox"),n[o].classList.remove("customCheckBoxChecked"),n[o].closest("lyte-exptable-tr").classList.remove("listViewRowSelected");var d=document.getElementById("listviewHeaderRow"),c=d.querySelector("lyte-checkbox");d&&c&&c.ltProp("class","customCheckBox")}var m=$("crm-customview-buttons");$("#listviewButtonLayer").length>0&&m[0]&&($("#custom_layer_table").removeClass("cvtransform"),document.getElementsByTagName("crm-custom-filter")[0].classList.remove("selectAllOverlay"),m[0].setData("selectAllEntity",!1),document.getElementById("viewcontainer").classList.remove("selectAllOverlay"),setTimeout((function(){$L("crm-customview-layer")[0].style.visibility="visible",$("#listviewButtonLayer").css({visibility:"hidden"})}),200))}if(crmListView.getObject().selectedIds&&0==crmListView.getObject().selectedIds.length){var u=$("#cvTable");u.css("visibility","visible"),t.hasClass("headNormalPost")?$(".detailPageNation").removeClass("detailPageNationAct"):$(".detailPageNation").addClass("detailPageNationAct"),u.removeClass("cvTableAct"),t.removeClass("cvBtnHeaderAct"),cvTablDown(),i.removeClass("privacyDBbtnHeadShow"),crmListView.getObject().isCampaignAddMemberListView&&$("#addCampaignMembersNextButton").addClass("dN")}else $("#cvTable").addClass("cvTableAct"),$("#selectAllRecords").length>0&&0==customViewObject.showSelectAll?($("#selectAllRecords").hide(),customViewObject.showSelectAll=!1,customViewObject.doMassActioninScheduler=!1,$("#scheduleMassActionDiv").hide(),$("#actionMenuForScheduler").css({display:"",visibility:"hidden"})):customViewObject.selectAllInCurrentView&&!customViewObject.doMassActioninScheduler&&customViewObject.totalCount<=Crm.massOperationTotalLimit&&$("#selectAllRecords").length>0&&"customCheckBoxChecked"==$("#checkAll").attr("class")&&$("#selectAllRecords").show(),i.css({display:"",visibility:"visible"}),customViewObject.isPrivacyListView&&i.addClass("privacyDBbtnHeadShow"),crmListView.getObject().isCampaignAddMemberListView&&(i.addClass("privacyDBbtnHeadShow"),$("#addCampaignMembersNextButton").removeClass("dN")),0==customViewObject.doMassActioninScheduler&&$("#selectAllRecords").length>0&&($("#scheduleMassActionDiv").hide(),$("#actionMenuForScheduler").css({display:"",visibility:"hidden"})),0==customViewObject.doMassActioninScheduler&&void 0!==customViewObject.totalCount&&customViewObject.totalCount>Crm.massOperationTotalLimit?($("#selectAllRecords").length>0&&($("#selectAllRecords").hide(),customViewObject.showSelectAll=!1,$("#scheduleMassActionDiv").hide(),$("#actionMenuForScheduler").css({display:"",visibility:"hidden"})),$("#macroDiv").css({display:"",visibility:"visible"}),$("#moreActionsDiv").css({display:"",visibility:"visible"})):1==customViewObject.doMassActioninScheduler&&(customViewObject.totalCount<=Crm.massOperationTotalLimit||customViewObject.indTotalCount<=Crm.massOperationTotalLimit)?showMassOperationsForScheduler():($("#macroDiv").css({display:"",visibility:"visible"}),$("#moreActionsDiv").css({display:"",visibility:"visible"})),$(".detailPageNation").addClass("detailPageNationAct"),cvTablUp(e)}function cvTablUp(e){$(".cvBtnHeader").addClass("cvBtnHeaderAct"),crmListView.listviewActionTimer=setTimeout((function(){$("#cvTable").css("visibility","hidden"),$(".cvBtnHeader").css("overflow","inherit")}),500);var t,a=!1;t=e?$("#"+e+" .customCheckBox[data-cid=selectEntity]"):$(".customCheckBox[data-cid=selectEntity]");for(var i=0;i<t.length;i++){var r=$(t)[i];if("customCheckBox"==$(r).attr("class")){a=!0;break}}if(customViewObject.doMassActioninScheduler&&0==customViewObject.selectedStages.length&&("customCheckBox"==$("#checkAll").attr("class")||"customCheckBox checkAlllistView"==$("#checkAll").attr("class")||a)){var l=crmListView.getObject().module,n=crmTab.getFromCache(l).selectedIds,s=crmListView.getObject().fromIndex;$("#checkAll").attr("class","customCheckBoxChecked"),$("#fixedChkSelAll").attr("class","customCheckBoxChecked");for(i=0;i<t.length;i++){r=$(t)[i];$(r).attr("class","customCheckBoxChecked"),crmListView.getObject().isStageView&&$(r).closest("li").addClass("sv-stage-card-selected"),$(r).closest("tr").css("background-color","#FFFCED").addClass("setTdBorBtm"),0==$(r).closest("tr").prev("tr").hasClass("setTdBorBtm")&&$(r).closest("tr").prev("tr").addClass("setTdBorBtm"),selectedId=JSON.parse($(r).attr("data-params")).entityId,n.contains(selectedId)||n.push(selectedId)}crmListView.startIndex.hasOwnProperty(s)?crmListView.startIndex[s]=crmListView.startIndex[s]+t.length:crmListView.startIndex[s]=t.length,crmTab.getFromCache(l).selectedIds=customViewObject.selectedIds=n}}function cvTablDown(){crmListView.listviewActionTimer=setTimeout((function(){$("#listviewButtonLayerDiv").css("visibility","hidden"),customViewObject.selectAllInCurrentView=!1,customViewObject.doMassActioninScheduler=!1,$("#selectAllRecords").length>0&&$("#selectAllRecords").hide();for(var e=!1,t=customViewObject.moreActions?customViewObject.moreActions.length:0,a=0;a<t;a++)if("hideSelectAllRecords"==customViewObject.moreActions[a]){e=!0;break}void 0===customViewObject.filters&&"All"===customViewObject.searchletter?($("#selectAllRecords").hide(),customViewObject.showSelectAll=!0):(customViewObject.filters&&customViewObject.filters.length>0||"All"!==customViewObject.searchletter)&&($("#selectAllRecords").hide(),customViewObject.showSelectAll=!1),e&&($("#selectAllRecords").hide(),customViewObject.showSelectAll=!1),$("#maxLimitAlertMassOperation").length>0&&$("#maxLimitAlertMassOperation").css("display","none"),$("#scheduleMassActionDiv").hide(),$("#actionMenuForScheduler").css({display:"",visibility:"hidden"}),$(".cvBtnHeader").css("overflow","inherit")}),500)}function validateAddUser(){$("#j_saveuser").prop("disabled",!0);var e=getObj("orgName");if(e&&""==e.value)return $("#userErrorMsgDisp").empty(),getObj("userErrorMsgDisp").innerHTML=document.getElementById("compnamealert").value,getObj("userErrorMsgDisp").style.display="block",$("#j_saveuser").prop("disabled",!1),!1;getElemById("userTerritoryIds")&&setTerritoryValue(),"None"==$("#addUserReporting").val()&&$("#userReporting").remove(),UpdateDetails(["newUserForm"],document.addUserForm,"","","",!1),$("#j_saveuser").prop("disabled",!1).val(I18n.getMsg("crm.button.save"))}function setTerritoryValue(){var e=[];$("#territories li").each((function(){var t=this.id;t=t.replace("li",""),e.push(t)})),$('form[name="addUserForm"] #userTerritoryIds').val(e.join(","))}function getFieldPresencePopup(e){if(validationUtils.IsJsonString(e)){var t=JSON.parse(e);if(null!==t.FieldPresenceError&&"FieldPresenceError"===t.FieldPresenceError){var a=null!==t.FieldIds?t.FieldIds:null;if(null!==a){for(var i=a.length,r="",l=0,n=automationActions.comboBoxInfo.comboBoxInfo_TO.optionModels,s=automationActions.comboBoxInfo.comboBoxInfo_CC.optionModels.length,o=0;o<s;o++){var d=automationActions.comboBoxInfo.comboBoxInfo_CC.optionModels[o];n.contains(d)||n.concat(d)}s=automationActions.comboBoxInfo.comboBoxInfo_BCC.optionModels.length;for(o=0;o<s;o++){d=automationActions.comboBoxInfo.comboBoxInfo_BCC.optionModels[o];n.contains(d)||n.concat(d)}var c=[];for(o=0;o<i;o++)if("Creator"===a[o])r+="Creator, ";else for(var m=n.length,u=0;u<m;u++){var p=n[u];if("availEmailFieldPL"===p.prefix.split(":")[0]||"availRelEmailFieldPL"===p.prefix.split(":")[0])for(var g=n[u].cxPropOptions.length,v=0;v<g;v++)if(p.cxPropOptions[v].id.split(":")[1]===a[o]){-1===c.indexOf(p.cxPropOptions[v].name)&&c.push(p.cxPropOptions[v].name),"REF"!==p.cxPropOptions[v].id.split(":")[0]&&l++;break}}var f=c.length;for(o=0;o<f;o++)r+=c[o]+", ";r=r.substring(0,r.length-2),l>1?renderingUtils.showCustomAlert(I18n.getMsg("crm.workflow.alert.multipleEmailFieldNotPresentMsg",r)):renderingUtils.showCustomAlert(I18n.getMsg("crm.workflow.alert.emailFieldNotPresentMsg",r));var h=$("#save_Alert");return void 0!==h&&h[0].removeAttribute("disabled"),commonUtils.showHideLoadingDiv(),!0}}}return!1}function UpdateDetails(e,t,a,i,r,l,n){var s,o="",d=!0,c="",m=!1,u=$("#isSandboxAddDeveloper").val(),p=Crm.isMultiSandboxEnabled;event&&(event.target&&"submit"==event.target.type||"submit"==event.type)&&(s=!0),$("#deletepopup").is(":visible")&&hideAnimatePopup("deletepopup");if("workFlowForm"==t.name&&$("#ruleName_inp").val(),e&&e.length){c=e[0];var g=e.slice(1);if(d=window[c].apply(window,g),"true"===u&&p){var v=$L("#selectSandboxDropdown")[0].ltProp("selected");"[]"===v||""===v?($("#displayContent_sandboxName_Add").removeClass("dN"),d=!1):JSON.parse(v).length>10?($("#displayContent_sandboxName_Add").addClass("dN"),$("#displayContent_sandboxName_Limit").removeClass("dN"),d=!1):($("#displayContent_sandboxName_Add").addClass("dN"),$("#displayContent_sandboxName_Limit").addClass("dN"))}}var f=$(t).attr("action");if(o=f,null!=a&&""!=a&&(o=a),d){$("#j_saveuser")&&$("#j_saveuser").prop("disabled",!0).val(I18n.getMsg("crm.signup.wait")+"...");var h=!1;"WFFieldDetails"==t.name&&(h=!0);var b=$("#reportingtoId");if(b.length>0){var C=$("#reportingToDropdown")[0].component.getData("cxPropSelectedUser").id;b.val(C)}var y=formData2QueryString(t,void 0,h),I=$(t).attr("name");if(void 0!==n&&(y+="&hierarchyDetails="+encodeURIComponent(JSON.stringify(n))),"profilePerForm"==I)y+=unCheckedPermissions();var w=$("#entityID");"true"===Crm.userDetails.MPL_MIGRATION_COMPLETED&&o===Crm.getCrmBasePath()+"/CustomRelatedList.do?action=saveCustomFormAsRelatedList"&&w.length>0&&(y=y+"&entityId="+w.val()),"true"===u&&p&&(y=y+"&sandboxIds="+v);var A=$("#j_username")?$("#j_username").val():"";return commonUtils.showHideLoadingDiv(!0),$.ajax({type:"POST",url:f,data:y,async:null==l||l,success:function(e){if(s&&"updateEscalationForEscRuleEntry"!==t.action.value&&"addEscalationForEscRuleEntry"!==t.action.value){var a=Lyte.Router.getRouteInstance().transition.info;"crm.settings.section.case-escalation-rule.view-case-escalation-rule"===a.route&&a.queryParams.entryId&&Lyte.Router.getRouteInstance().setQueryParams("entryId",void 0,!1)}if(e.misMatchType)networkUtils.loadFeatureScripts(["zohocrm_forecastTemplate.js",networkUtils.getI18nJSUrl("reportingtopopup")],(function(){Handlebars.registerPartial("role_change",Handlebars.templates.role_branch_change);var t=$("#roleChangePopUp");t.length>0&&t.remove(),$("#show").append(Handlebars.templates.role_branch_change(e));var a=$("#roleDD"),i=[];a.children().each((function(){var e=$(this).val();i.contains(e)?$(this).remove():i.push(e)})),showAnimatePopup("roleChangePopUp"),userSelect(),a.trigger("change"),$("#subOrdinateList").hide()}));else{if("Deleted Tag Found"==e.undefError)return renderingUtils.showCustomAlert(I18n.getMsg("crm.workflow.undefined.tag.error")),void Utils.showHideLoadingDiv();if("assignOwner"==e.action)return wfActionHandler.getAssignOwnerErrorMsg(e),void commonUtils.showHideLoadingDiv();if("scheduler running"===e.error)return crmui.showPopup("scheduler_Sharing_Rule"),void commonUtils.showHideLoadingDiv();if("module unavailable"===e.error)return crmui.showPopup("module_Sharing_Rule"),void commonUtils.showHideLoadingDiv();if("deleted_role/group/DSR_selected"!==e.error){if("invalid_ruleid"===e.error)return crmui.showMsgBand("error",I18n.getMsg("com.datasharingrules.error.unavailable"),4e3),void commonUtils.showHideLoadingDiv();var i=$("#save_Alert");if("PermissionDeniedIAR"==e)return renderingUtils.displayPermissionDenied(null,null,I18n.getMsg("crm.security.error")),void(void 0!==i&&i[0].removeAttribute("disabled"));if(!($("#wfNewAlert").length>0&&getFieldPresencePopup(e))){if($("#workFlowForm").length>0){if("trigger_invalid_field"===e.undefError)return commonUtils.showHideLoadingDiv(),void wfNew.showWarningPopup(I18n.getMsg("crm.workflow.trigger.criteria.invalid.field")," ",void 0);if("condition_invalid_field"===e.undefError)return commonUtils.showHideLoadingDiv(),void wfNew.showWarningPopup(I18n.getMsg("crm.workflow.rule.criteria.invalid.field","1")," ",void 0);if("Invalid Related Criteria"===e.undefError&&"Appointments"===e.module)return commonUtils.showHideLoadingDiv(),void wfNew.showWarningPopup(I18n.getMsg("crm.workflow.appointments.relmodule.criteria.unsupported.error",crmTab.getDisplayName(e.relModule)),I18n.getMsg("crm.workflow.appointments.relmodule.unsupported.criteria.header"),"error");if("No Action Configured"===e.undefError||"Timetrigger Without Action"===e.undefError)return renderingUtils.showCustomAlert(I18n.getMsg("crm.workflow.task.permission.denied.msg",[e.module,"workflow"])),void commonUtils.showHideLoadingDiv();if("Unsupported TPCriteria field"===e.undefError){var l=networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("scorefieldunsupport")],crmConstants.jsStaticPath);return Lyte.injectResources(l,void 0,(function(){renderingUtils.showCustomAlert(I18n.getMsg("crm.workflow.criteria.tpscore.notsupport",e.fields))})),void commonUtils.showHideLoadingDiv()}if("object"==typeof e)return e.invalidScoreRuleId?crmui.showMsgBand("error",I18n.getMsg("wf.scorerule.not.exists"),"5000",$("#setupInnerLinks")):wfCriteria.showDuplicateCriterias(e),commonUtils.showHideLoadingDiv(),!1;"string"==typeof e&&e.indexOf('data-zcqa="crm_error_page"')>0&&(commonUtils.showHideLoadingDiv(),m=!0)}if($("[name=fromModuleBuilder]").length>0&&"object"==typeof e&&null!=r&&"function"==typeof r)return commonUtils.showHideLoadingDiv(),r(e),!1;if(networkUtils.loadFeatureScripts(["zohocrm_msintegration.js",networkUtils.getI18nJSUrl("office365")],(function(){""!==msApps.approvalList&&A&&""!==A&&"ALERTERROR:::"!==e.substring(0,"ALERTERROR:::".length)&&msApps.removeAddeduserFromUserList(A)})),-1==e.indexOf("tError")){var n="result";if(getObj("subTabBottomDiv")&&(n="subTabBottomDiv"),"ALERTERROR:::"===e.substring(0,"ALERTERROR:::".length)){var d=e.split("ALERTERROR:::"),u=$(t).find("#userErrorMsgDisp")[0];if($("#tpUsers")&&null!=$("#tpUsers").val()&&$("#tpUsers").select2({placeholder:I18n.getMsg("crm.lar.rr.chooseUser"),allowClear:!1,templateResult:tpuserName,templateSelection:tpuserName,matcher:function(e,t){return matchStart(e,t)},escapeMarkup:function(e){return e}}),u)return $(u).empty(),u.innerHTML=d[1],u.style.display="block",commonUtils.showHideLoadingDiv(),!1}if(-1!=this.data.indexOf("isSandboxAddDeveloper"))return $("#adduserPopup").hide(),commonUtils.showHideLoadingDiv(!1),removeFreezeLayer(),void hideFreezeLayer();if("newUserForm"===c&&Crm.trackSpotLightAction("Users - Added"),o===Crm.getCrmBasePath()+"/WorkFlowRule.do"){if("createRule"==$("#step").val()){Crm.trackSpotLightAction("Workflow Rules - Added");try{var p=$L("#wf_act_ul_decs_1");if(0!==p.length){var g=$L("#triggerApiJSON").val();if(0!==g.length)if("recommendation_rebuy"===JSON.parse(g).type){var v=[],f=p.children("li"),h=f.length;if(0!==h)for(var b=0;b<h;b++){var C=f.eq(b);if(C.is(":visible")){var y=C.attr("id");v.push(y.replace("List_1",""))}}var w=0!==$L("#critEditorDIV_1").data("criteria").length;Crm.client_tracking("Zia Recommendation workflow save",{actions:JSON.stringify(v),criteria:w})}}}catch(e){Crm.client_tracking("Zia Recommendation workflow error")}}var E=Lyte.Router.getRouteInstance().transition.info;if("string"==typeof e&&e.indexOf("FEATURELIMIT_ERROR_403")>0)return commonUtils.showHideLoadingDiv(),void $("#"+n).html(e);if(m)return void crmui.showMsgBand("error",I18n.getMsg("crm.workflow.save.error"),"5000",$("#setupInnerLinks"));if("crm.settings.section.workflow-rules.create-workflow-rule"==E.route||"crm.settings.section.workflow-rules.view-workflow-rule"==E.route){var T=e.split("ruleId:::")[1]||E.dynamicParams[0];return void(Lyte.Router.transitionTo({route:"crm.settings.section.workflow-rules.index-workflow-rule"}).extraDetails={highlight:T,from:"save"})}}if(o!==Crm.getCrmBasePath()+"/Role.do?action=transferAndDel"||"ALERTERROR:::"!==e.substring(0,"ALERTERROR:::".length)){if(o===Crm.getCrmBasePath()+"/WorkFlowTask.do?step=createTask")Crm.trackSpotLightAction("Workflow Tasks - Added",{Place:"Tasks"});else if(o===Crm.getCrmBasePath()+"/WorkFlowTask.do?step=updateTask")Crm.trackSpotLightAction("Workflow Tasks - Updated",{Place:"Tasks"});else if(o==Crm.getCrmBasePath()+"/potentials/EditOrgFiscal.do?action=saveFiscal")Crm.trackSpotLightAction("Fiscal Month Changed");else if(o===Crm.getCrmBasePath()+"/WorkFlowWebHook.do?step=createWebHook")Crm.trackSpotLightAction("Webhook Configured");else if(o===Crm.getCrmBasePath()+"/WorkFlowAlert.do?step=createAlert")Crm.trackSpotLightAction("Workflow Alerts - Added");else if(o==Crm.getCrmBasePath()+"/autoresprules.do"){"createEmptyRule"===(_=getObj("action")?getObj("action").value:"")&&Crm.trackSpotLightAction("Autoresponder Rule Created")}else if(o==Crm.getCrmBasePath()+"/CaseEscalation.do"){"addBusinessHour"==(_=getObj("action")?getObj("action").value:"")&&Crm.trackSpotLightAction("Business Hour Added")}if(void 0!==r&&"function"==typeof r&&-1===o.indexOf("SharingSetting"))if(""==e)r();else if(-1!=e.indexOf("WFsavedId")){T=JSON.parse(e).WFsavedId;r(T)}else if(-1!=e.indexOf("InvalidWebHookUrl"))wfNew.showWebHookInValidAlert();else if("true"==e)$("#relatedListDuplicateDiv").show(),$("[name='rlContentChngd']").val("false"),setTimeout((function(){$("#relatedListDuplicateDiv").hide()}),5e3);else if(-1!=e.indexOf("customRelatedListCountExceeded")){var S=e.split(":")[1];$("#relatedListLimitExceededDiv").html(I18n.getValueForFields("crm.label.newrelatedlist.exceeded",S)),$("#relatedListLimitExceededDiv").show(),$("[name='rlContentChngd']").val("false"),setTimeout((function(){$("#relatedListLimitExceededDiv").hide()}),5e3)}else $("#relatedListErrorDiv").show(),$("[name='rlContentChngd']").val("false"),setTimeout((function(){$("#relatedListErrorDiv").hide()}),5e3);else if(getObj("basic")&&$.scrollTo("#basic",{axis:"y",duration:1e3,offset:-50}),"addUserForm"===I&&"true"===$(document.viewAllUsersForm).attr("data-ispersonal"))""!=$("#showAddUser").val()&&"true"==$("#showAddUser").val()?($("#bulkUpdateSuccess").show(),$("#bulkUpdateSuccess").html("User Added Successfully!"),setTimeout((function(){$("#bulkUpdateSuccess").hide()}),2e3)):mR(Crm.getCrmBasePath()+"/ShowDetails.do?module=Setup&isload=true&loadJson=true",(function(e){$("#show").html(e),$("#usersPermi_users").trigger("click")})),hideAnimatePopup("topBandPopup");else{if(""!=$("#showAddUser").val()&&"true"==$("#showAddUser").val())$("#bulkUpdateSuccess").show(),$("#bulkUpdateSuccess").html("User Added Successfully!"),setTimeout((function(){$("#bulkUpdateSuccess").hide()}),2e3);else{if($("#"+n).show(),$("#subTabBottomDiv").hasClass("setBgClr")&&($("#subTabBottomDiv").removeClass("setBgClr"),$("#setup_new_ContentDiv").removeClass("workflow_rule")),$("#wf_wfCreateNewRule").hasClass("hide")&&$("#wf_wfCreateNewRule").removeClass("hide"),o==Crm.getCrmBasePath()+"/WorkFlowRule.do"){var L=$("#step").val();"createRule"!=L&&"updateRule"!=L||(Lyte.Router.transitionTo({route:"crm.settings.section.workflow-rules.index-workflow-rule"}),wfBG.setWhiteBG(),wfNew.showSetupTabs())}else if(o==Crm.getCrmBasePath()+"/CaseEscalation.do"||-1!=o.indexOf(Crm.getCrmBasePath()+"/CaseEscalation.do?action=deleteEscRuleEntry")){var _;"createBusinessHour"!==(_=$(t).find("input[name='action']").val())&&"editBusinessHour"!==_&&"addBusinessHour"!==_&&"updateBusinessHour"!==_&&"addEscRuleEntry"!==_&&"newEscRule"!==_&&"renameEscRule"!==_&&"addEscalationForEscRuleEntry"!==_&&"updateEscRuleEntry"!==_&&Lyte.Router.transitionTo(Lyte.Router.getRouteInstance().transition.info)}if($("#"+n).empty(),$("#"+n)[0].innerHTML=e,o===Crm.getCrmBasePath()+"/Role.do?action=transferAndDel"&&$("#result").find("#roleListPage").length>0){Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.roles.index-roles").data={data:e};var O={status:"progress"};O.message=I18n.getMsg("crm.role.transfer.delete.inprogress",[t.getElementsByTagName("td")[1].innerText]),crmSchedulerNotification.addOrUpdateStatus(O,I18n.getMsg("crm.role.transfer.delete.status"))}JSEvalScript(getObj(n)),wfForm.chosen_show(),wfForm.initFormClick(),wfForm.inputfieldFocus(),$("#roleChangePopUp").length>0&&showAnimatePopup("roleChangePopUp"),-1!==o.indexOf("SharingSetting")&&-1!==o.indexOf("delRule")&&0===$("#sharingRuleUnavailable").length&&(UserModule.showSharingRuleSuccessPopup("delRule"),r())}hideAnimatePopup("topBandPopup")}return thirdPartyUtils.bindSelect2($(".newSelect").find("select")),commonUtils.showHideLoadingDiv(!1),!1}Lyte.Router.getRouteInstance().transitionTo("crm.settings.section.roles.index-roles").data={data:e}}else alert(I18n.getMsg("crm.alert.thresholdError"))}}else r(e)}},error:function(e){if(o==Crm.getCrmBasePath()+"/WorkFlowRule.do"){var t=$("#step").val();"object"!=typeof e.responseJSON||"Usage of V1 API is Deprecated"!=e.responseJSON.message||"createRule"!=t&&"updateRule"!=t?setTimeout((function(){400===e.status&&e.responseText.indexOf("ENCRYPTED_FIELDS_IN_CRITERIA")>-1?crmui.showMsgBand("error",I18n.getMsg("ear.error.message.criteria.comparator.not.allowed",e.responseText.split("###")[1]),4e3,$("#subTabBottomDiv")):400===e.status&&e.responseText.indexOf("ENCRYPTED_FIELD_NOT_SUPPORTED_IN_GROUPING")>-1?crmui.showMsgBand("error",I18n.getMsg("ear.error.message.grouping.not.allowed",e.responseText.split("###")[1]),4e3,$("#subTabBottomDiv")):e.status!==crmConstants.limitExceedsCode&&crmui.showMsgBand("error",I18n.getMsg("crm.workflow.save.error"),4e3,$("#subTabBottomDiv"))}),50):renderDenyTemp(e.responseJSON,"workflow","save")}else 400===e.status&&e.responseText.indexOf("ENCRYPTED_FIELDS_IN_CRITERIA")>-1&&renderingUtils.showCustomAlert(I18n.getMsg("ear.error.message.criteria.comparator.not.allowed",e.responseText.split("###")[1]));-1!==o.indexOf(Crm.getCrmBasePath()+"/SharingSetting.do?action=updateOrgDefPer")&&(hideAnimatePopup("editOrgDefDiv"),renderingUtils.displayPermissionDenied(e)),e.status===crmConstants.limitExceedsCode?Search.displayLookupExceedsMsg(e):400===e.status&&"CRITERIA_LIMIT_EXCEEDED"===e.responseText?renderingUtils.showCustomAlert(I18n.getMsg("crm.criteria.limit.error",Search.MAX_CRT_CNT)):(401===e.status&&o.indexOf("Role.do")>-1||401===e.status&&o.indexOf("WorkFlowTask.do")>-1)&&renderingUtils.displayPermissionDenied(),commonUtils.showHideLoadingDiv()}}),!1}return!1}function updateAndStayonPage(e,t){loadAjaxTab("","lightblue");var a=validate(),i=e.action,r=formData2QueryString(e);return a&&$.ajax({type:"POST",url:i,data:r,success:function(a){(commonUtils.showHideLoadingDiv(),getObj("basic")&&$.scrollTo("#basic",{axis:"y",duration:1e3,offset:-50}),"SignatureForm"===e.name&&!0===t)&&(setSignatureContent(a),"plaintext"==$("#emailEditor").data("zEditor").mode?$("form[name=SignatureForm]").find("iframe").contents().find("body").text(a):$("form[name=SignatureForm]").find("iframe").contents().find("body").html(a));return!1}}),!1}function navTwenty(e){var t,a=document.getElementsByName("chk");for(t=0;t<a.length;t++)a[t].checked=!1;if(-1!=encodeURIComponent(e).indexOf(encodeURIComponent("isload=false")))if(document.recyclebin){document.recyclebin.sortColumnString.value="";var i=formData2QueryString(document.recyclebin);doAjaxUpdate("result",e,i,updateRBRecCountFromCache)}else doAjaxUpdate("result",e,updateRBRecCountFromCache);else document.location.href=e}function loadRecycleBinTotalRecCount(){var e=new getHTTPObject,t="https://"+RebrandLinkUtil.getProperty("CRMURL")+Crm.getCrmBasePath()+"/ShowRBList.do?"+formData2QueryString(document.recyclebin)+"loadRBRecCount=true";e.open("GET",t,!0),e.onreadystatechange=function(){if(4==e.readyState){var t=e.responseText.trim();$("#rbRecCount").html(t),crmTab.getFromCache("RecycleBin")?crmTab.getFromCache("RecycleBin").totalCount=t:crmTab.cacheObj.RecycleBin={totalCount:t}}},e.send(null)}function updateRBRecCountFromCache(){crmTab&&crmTab.getFromCache("RecycleBin")&&crmTab.getFromCache("RecycleBin").totalCount?$("#rbRecCount").html(crmTab.getFromCache("RecycleBin").totalCount):loadRecycleBinTotalRecCount()}function buttonIdChange(){if(null!=getObj("lvBottomButtonTD")){var e=getObj("lvBottomButtonTD"),t=e.getElementsByTagName("span");if(t[0]){var a=t[0].getElementsByTagName("input"),i=e.getElementsByTagName("div");a.length>0&&i.length>0&&(a[0].id="moreAct1",i[0].id="actionMenu1")}}}function showCustomizeBusinessCardPopup(e,t){networkUtils.loadFeatureScripts(["OptionChooser-min.js"],(function(){showCustomizePopup(e,t)}))}function showCustomizePopup(e,t,a,i,r,l,n,s){var o,d,c,m=$("#id").val(),u=$("#orgId");if(null==u||""===u.val()||"null"===u.val())return redirectTOCompanyInfo(),!1;if("RelatedList"==e)o=Crm.getCrmBasePath()+"/CustomizePage.do?module="+t+"&id="+m+"&entityid="+m+"&nocache="+(new Date).getTime();else if("SummaryView"==e)o=Crm.getCrmBasePath()+"/CustomizeBC.do?module="+t+"&id="+m+"&cvid="+getObj("cvid").value+"&recordNum="+getObj("recordNum").value;else if("CreateList"==e)t||(t=$("[id=module]").val()),o=Crm.getCrmBasePath()+"/CustomButton.do?step=createCustomButton&module="+t+"&component=link",null==$("[id=fromPage]").val()||"setup"!=$("[id=fromPage]").val()&&!$("#topBandPopup").is(":visible")?o+="&fromPage=popup":o+="&fromPage="+$("[id=fromPage]").val();else if("ManageLink"==e)o=Crm.getCrmBasePath()+"/CustomButton.do?step=loadCustomButtonsForModule&module="+t+"&component=Links&fromPage=detailPage",d="manageLink";else if("createTabGroup"==e)o=Crm.getCrmBasePath()+"/CustomizeTabGroup.do?action="+e+"&isFrom="+t;else if("tabGroupList"==e)o=Crm.getCrmBasePath()+"/CustomizeTabGroup.do?action="+e+"&isFrom="+t;else if("addDeveloper"==e)o=Crm.getCrmBasePath()+"/Security.do?actionName=newUser&mode=create&tptype=5&showAddUser="+t;else if("addUser"==e)o=Crm.getCrmBasePath()+"/Security.do?actionName=newUser&mode=create&showAddUser="+t;else if("Attach"==e){if(1==r){var p=!1;if(null!=n){var g=$(n).attr("data-module"),v=$(n).attr("data-fieldid");fileupload.module=g,fileupload.fieldID=v}5==l&&(p=!0);var f=$("#attachSize_"+fileupload.fieldID).val(),h=$("#attachCount_"+fileupload.fieldID).val();""==f&&(f=0),o=Crm.getCrmBasePath()+"/NewFileAttachment.do?module="+fileupload.module+"&fromFileUploadField=true&fieldId="+fileupload.fieldID+"&attachedSize="+f+"&attachedCount="+h,s&&(o+="&isAjaxEdit=true")}else{g=getAttachmentModule(i),m=getAttachmentEntityId(i);var b=getAttachmentCvid(i),C=void 0===getObj("recordNum")?null:getObj("recordNum").value;o=Crm.getCrmBasePath()+"/NewFileAttachment.do?module="+g+"&returnAnchor="+t+"&id="+m+"&cvid="+b+"&recordNum="+C}getElemById("attachTotCnt")&&(o+="&attachTotCnt="+getElemById("attachTotCnt").value);var y="false";try{FileUploader&&(y="true")}catch(e){y="false"}o+="&newAttachFlow="+y,void 0!==i&&(o+="&fromSrc="+i)}if("ManageLink"==e||"CreateList"==e)mR(o,(function(t){$("#topBandPopup").html(t),"ManageLink"==e&&$("#topBandPopup").setPopupClass(d),showAnimatePopup("topBandPopup"),thirdPartyUtils.bindSelect2($(".newSelect").find("select")),setTimeout((function(){getObj("linkLabel")&&$("#linkLabel").focus()}),500)}));else if("createTabGroup"==e||"tabGroupList"==e)mR(o,(function(t){if(-1!=t.toString().indexOf("TABGROUPLIMITEXCEED")){var a=t.split(":")[1];alert(I18n.getMsg("crm.tabgroup.length.exceeded",a))}else{if($("#topBandPopup").html(t),"createTabGroup"===e)$('[name=CustomizeTabGroupForm] [data-zcqa="btn_tab_cancel"]').attr("onclick","hideAnimatePopup('topBandPopup');");showAnimatePopup("topBandPopup"),thirdPartyUtils.bindSelect2($(".newSelect").find("select")),setTimeout((function(){getObj("tabGroupName")&&getObj("tabGroupName").focus()}),500)}}));else if("addUser"==e||"addDeveloper"==e){var I="";a&&(I="isMsAppsCreate=true",msApps.userNextPage&&(msApps.data.nextlink=msApps.userNextPage,$("#tpUsers").one("select2:open",(function(e){msApps.lazyLoadUsers(),$("#select2-tpUsers-results").parent().parent().find(".select2-search__field").attr("onkeyup","msApps.searchMSUsers();")})))),"addLiteUser"===i&&(I="isLiteUserCreate=true"),mR(o,(function(t){var r=t;try{var l,n=JSON.parse(r),s=n.accounttype;"CRMPLUS"!==s&&"ZOHOONE"!==s||(l=n.redirectUrl,window.open(l))}catch(e){}if("CRMPLUS"!=s&&"ZOHOONE"!=s)if(r.indexOf("ALERTERROR:::")>-1){var o=r.split("ALERTERROR:::");alert(o[1])}else if(r.indexOf("DeveloperLimitExceeds")>-1)crmui.showMsgBand("warning",I18n.getMsg("crm.sandbox.developer.limit.reached"),5e3);else{if(r.indexOf("LimitExceeds")>-1)return"addLiteUser"===i?(Crm.client_tracking("Lite exceed popup"),showAnimatePopup("liteUserLimitExceedsAlertDiv")):showAnimatePopup("limitExceedsAlertDiv"),!1;if($("#topBandPopup").html(r),$("#topBandPopup .popup-model-content").css({"max-height":renderingUtils.windowHeight-270}),showAnimatePopup("topBandPopup"),thirdPartyUtils.bindSelect2($(".newSelect").find("select")),"addDeveloper"===e&&Crm.isMultiSandboxEnabled){var d=$L("crm-sandbox-list")[0].component.data.sandboxList,c=d.length;if(c>0){for(var m=new Array,u=0;u<c;u++)m.push({value:d[u].id,name:d[u].name});$L("#selectSandboxDropdown")[0].ltProp("options",JSON.parse(JSON.stringify(m)))}}}if(a){$("#fromTP").show();var p="<option data-fullname='' data-fn='' data-ln='' data-email='' selected>"+I18n.getMsg("crm.lar.rr.chooseUser")+"</option>";$("#tpUsers").append(p),networkUtils.loadFeatureScripts(["zohocrm_msintegration.js",networkUtils.getI18nJSUrl("office365")],(function(){msApps.appendUsers(a)})),setTimeout((function(){$("#tpUsers").select2({placeholder:I18n.getMsg("crm.lar.rr.chooseUser"),allowClear:!1,matcher:function(e,t){return matchStart(e,t)},templateResult:tpuserName,templateSelection:tpuserName,escapeMarkup:function(e){return e}}),msApps.userNextPage&&$("#tpUsers").one("select2:open",(function(e){msApps.lazyLoadUsers(),$("#select2-tpUsers-results").parent().parent().find(".select2-search__field").attr("onkeyup","msApps.searchMSUsers();")}))}),10),"true"!=$("#isMSAppsAcc").val()||!msApps||msApps.approvalList&&msApps.approvalList.id&&""!==msApps.approvalList.id?($("#fromTP").hide(),$("input[name='property(First Name)']").parent().parent().hide(),$("input[name='property(Last Name)']").parent().parent().hide(),$("#fN").hide(),$("#lN").hide(),$("#fullName").show(),$("#approveBTN").show(),$("#addUserBTN").hide()):($("input[name='property(First Name)']").parent().parent().hide(),$("input[name='property(Last Name)']").parent().parent().hide(),$("input[name='property(Email)']").parent().parent().hide(),$("#fN").hide(),$("#lN").hide(),$("#eM").hide(),$("#fullName").hide())}}),I)}else mR(o,(c=e,function(e){$("#topBandPopup").html(e),showAnimatePopup("topBandPopup"),thirdPartyUtils.bindSelect2($(".newSelect").find("select")),"Attach"===c&&(1==r?fileupload.bindFileUploaderForFileUploadField({save:crmConstants.FileUploader.fileUploadFieldAttachments.saveElement,uploadmethod:crmConstants.FileUploader.uploadMethod.ZFSNG,acceptedfiles:crmConstants.FileUploader.fileUploadFieldAttachments.acceptedfiles,previewtemplate:crmConstants.FileUploader.fileUploadFieldAttachments.previewtemplate,clickable:crmConstants.FileUploader.fileUploadFieldAttachments.clickableElement,container:crmConstants.FileUploader.fileUploadFieldAttachments.previewElement,cancel:crmConstants.FileUploader.fileUploadFieldAttachments.cancelElement,mainform:crmConstants.FileUploader.fileUploadFieldAttachments.mainformElement,uploadlimit:l,uploadsizeflex:crmConstants.FileUploader.fileUploadFieldAttachments.uploadSizeFlex,uploadsizelimit:crmConstants.FileUploader.fileUploadFieldAttachments.uploadSizeLimit,parallelupload:crmConstants.FileUploader.fileUploadFieldAttachments.parallelUpload,filesizebase:crmConstants.FileUploader.fileUploadFieldAttachments.fileSizeBase,progressratio:crmConstants.FileUploader.fileUploadFieldAttachments.progressratio,tabload:crmConstants.FileUploader.fileUploadFieldAttachments.tabLoadElement,attachframe:crmConstants.FileUploader.fileUploadFieldAttachments.targetAttachFrameElement,popupname:crmConstants.FileUploader.fileUploadFieldAttachments.popupName,module:fileupload.module,fieldId:fileupload.fieldID,action:crmConstants.FileUploader.fileUploadFieldAttachments.action,resourcetype:crmConstants.Docs.ResourceTypes.ENTITY_ATTACHMENTS,workspace:crmConstants.Docs.WorkSpace.WS_ATTACHMENT_LIBRARY,zgid:Crm.userDetails.ZGID,needMultipleSelection:p}):crmRelatedList.bindFileUploaderForRelatedListAttachments({save:crmConstants.FileUploader.relatedListAttachments.saveElement,uploadmethod:crmConstants.FileUploader.uploadMethod.ZFSNG,acceptedfiles:crmConstants.FileUploader.relatedListAttachments.acceptedfiles,previewtemplate:crmConstants.FileUploader.relatedListAttachments.previewtemplate,clickable:crmConstants.FileUploader.relatedListAttachments.clickableElement,container:crmConstants.FileUploader.relatedListAttachments.previewElement,cancel:crmConstants.FileUploader.relatedListAttachments.cancelElement,mainform:crmConstants.FileUploader.relatedListAttachments.mainformElement,uploadlimit:crmConstants.FileUploader.relatedListAttachments.uploadLimit,uploadsizeflex:crmConstants.FileUploader.relatedListAttachments.uploadSizeFlex,uploadsizelimit:crmConstants.FileUploader.relatedListAttachments.uploadSizeLimit,parallelupload:crmConstants.FileUploader.relatedListAttachments.parallelUpload,filesizebase:crmConstants.FileUploader.relatedListAttachments.fileSizeBase,progressratio:crmConstants.FileUploader.relatedListAttachments.progressratio,tabload:crmConstants.FileUploader.relatedListAttachments.tabLoadElement,attachframe:crmConstants.FileUploader.relatedListAttachments.targetAttachFrameElement,popupname:crmConstants.FileUploader.relatedListAttachments.popupName,entityid:$("#multipleFieldsEditPop").is(":visible")?$("#multipleFieldEditEntityId").val():$("#entityId").val(),module:$("#multipleFieldsEditPop").is(":visible")?$("#multipleFieldEditModule").val():$("#module").val(),action:crmConstants.FileUploader.relatedListAttachments.action,resourcetype:crmConstants.Docs.ResourceTypes.ENTITY_ATTACHMENTS,workspace:crmConstants.Docs.WorkSpace.WS_ATTACHMENT_LIBRARY,zgid:Crm.userDetails.ZGID,preventUploadObjDestroy:{prevent:$("#multipleFieldsEditPop").is(":visible"),objBindTo:"#multipleFieldsEditPop"}}))}));$(".actSettings").removeClass("actSettings")}function tpuserName(e){var t=e.element,a=e.text;return null!=$(t).data("email")?""!=$(t).data("email")?($("#searchCreateDiv").length>0?($("input[name='property(First Name)']").val($(t).data("fn")),$("input[name='property(Last Name)']").val($(t).data("ln")),$("input[name='property(Email)']").val($(t).data("email"))):($("#firstName").val($(t).data("fn")),$("#lastName_focus ").val($(t).data("ln")),$("#j_username").val($(t).data("email"))),$("#Name").val($(t).data("fullname")),$("#tp_username").val($(t).data("tpemail")),a+' <br/><span class="color2 f11">'+$(t).data("email")+"</span>"):I18n.getMsg("crm.lar.rr.chooseUser")+"":""}function showCustomizeListPopup(e,t,a){var i;if(Crm.listRId=e.id.split("_"),$(e).data()&&!crmRelatedList.isNotActivitySubPersonality($(e).data().name)&&(Crm.listRId=$(e).data().relid.split("_")),3==Crm.listRId.length&&(Crm.listRId[0]=Crm.listRId[0]+"_"+Crm.listRId[1],Crm.listRId[1]=Crm.listRId[2]),"gsearchclm"==Crm.listRId[0]){function r(){var e=$("#ajax_"+a);e.find("#fieldListContents").sortable({helper:"clone"}),e.find("#columnlistsearch").focus()}if($(e).siblings("#GSearch").length)$(e).siblings("#GSearch").show(),$("#"+e.id).css("visibility","visible").addClass("selectRlEdit").removeClass("newRlEdit"),r(),sE(event);else i=Crm.getCrmBasePath()+"/CustomSearchAction.do?action=custom&module="+a,(new crmRequestPool).initiate({action:i,type:"POST",success:function(t){var i={from:"gsearch"};i.save="saveSearchFields('"+a+"');",i.cancel="hideCustomizeListPopup('GSearch');",i.divid="fieldListContents",i.otherparams={gSearchMod:a},i.columns=t,i.module=a;var l=Handlebars.templates.columnList(i);$("#"+e.id).css("visibility","visible").addClass("selectRlEdit").removeClass("newRlEdit"),$(e).parent().addClass("pR"),$(e).after(l),r();var n=$(window).height()-($(e).next().children().first().outerHeight()+$(e).next().find(".columnListBtn").outerHeight()+$("#wmstoolbar").outerHeight()+$(e).offset().top)-30;$(e).next(".ddMenus.boxShadowMask").find("#menuColumnListView").css({"max-height":n}),$(e).next(".ddMenus.boxShadowMask").find("#menuColumnListView").perfectScrollbar({wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!1})}})}else{function l(t){var a=!crmRelatedList.isNotActivitySubPersonality(Crm.listRId[0]),i=t?$("#"+t):$("[ddid="+Crm.listRId[1]+"]");i.find("#relateList_"+Crm.listRId[1]).sortable({helper:"clone"}),i.find("#columnlistsearch").focus();var r=$("#dvinner").scrollTop(),l=document.getElementById("dvinner"),n=$(".newTopbar:visible"),s=n.length?n.outerHeight():null,o=$("#detailViewButtonLayerDiv:visible"),d=o.length?o.outerHeight()+10:null,c=$("#wmstoolbar:visible"),m=renderingUtils.windowHeight-(s+d+(c.length?c.outerHeight():null))-180,u="#relatedListCols_"+Crm.listRId[0];if(a){var p=$(u);p.addClass("actColumnsDivStd"),p.hide(),p.show();var g=$(".openActPop").offset().top-100;p.find("#menuColumnListView").css({"max-height":m-g}),p.find("#menuColumnListView").perfectScrollbar({wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!1})}else $(".ddMenus.boxShadowMask").hide(),$(e).next(".ddMenus.boxShadowMask").show(),$(e).next(".ddMenus.boxShadowMask").find("#menuColumnListView").css({"max-height":m}),$(e).next(".ddMenus.boxShadowMask").find("#menuColumnListView").perfectScrollbar({wheelSpeed:1,wheelPropagation:!1,suppressScrollX:!1});var v=a?$(e).find(u).next(".ddMenus.boxShadowMask").offset().top:$(e).next(".ddMenus.boxShadowMask").offset().top,f=a?$(e).find(u).next(".ddMenus.boxShadowMask").outerHeight():$(e).next(".ddMenus.boxShadowMask").outerHeight(),h=$(window).outerHeight(),b=f+v;f+v>h&&l.scrollTo({behavior:"smooth",top:b-(h-(d+s))+r})}var n=!crmRelatedList.isNotActivitySubPersonality($(e).data().name),s=$(e).siblings(".ddMenus");!n&&$(e).siblings("#relatedListCols").length?($("#"+e.id).css("visibility","visible").addClass("selectRlEdit").removeClass("newRlEdit"),$(e).siblings("#relatedListCols").show(),$("#"+e.id).css("visibility","visible").addClass("selectRlEdit").removeClass("newRlEdit"),l()):n&&$(e).siblings("#relatedListCols_"+$(e).data().name).length?(s.hide(),$(e).siblings("#relatedListCols_"+$(e).data().name).show(),l(e.id+"_outer"),crmRelatedList.validateLimit(void 0,$(e).data().name)):(i=Crm.getCrmBasePath()+"/CustomDisplay.do?actionName=show&frmmodule="+a+"&from=detailView&nocache="+(new Date).getTime(),Crm.listRId[0]&&(Crm.listRId[1]&&crmRelatedList.EachModuleData[Crm.listRId[1]]&&crmRelatedList.EachModuleData[Crm.listRId[1]].isLinkingModule||0===Crm.listRId[0].indexOf("HISTORYPERSONALITY"))?(i+="&pname="+Crm.listRId[0],i+="&rid="+Crm.listRId[1],crmRelatedList.EachModuleData[Crm.listRId[1]]&&(i+="&cust_disp_module="+crmRelatedList.EachModuleData[Crm.listRId[1]].parentModule)):(n&&(i+="&pname="+Crm.listRId[0]),i+="&cust_disp_module="+a,Crm.listRId&&Crm.listRId[1]&&(i+="&rid="+Crm.listRId[1],"POTSTAGEHISTPERSONALITY"==Crm.listRId[0]&&(i+="&pname="+Crm.listRId[0]))),i=i+"&entityid="+$("[name='id']").val()+"&entitymodule="+$("[name='module']").val(),(new crmRequestPool).doAjax(i,(function(t){var a="relateList_"+Crm.listRId[1];if("object"==typeof t){t.from="relatedlist",t.save="saveRelatedListColumns('"+Crm.listRId[1]+"');",t.cancel="hideCustomizeListPopup('relatedListCols');",t.divid=a;var i=$(e).siblings(".ddMenus");n&&(t.isActComp=!0,t.name=$(e).data().name,i.hide(),t.cancel="hideCustomizeListPopup('relatedListCols_"+t.name+"');");var r=Handlebars.templates.columnList(t);n||($("#"+e.id).css("visibility","visible").addClass("selectRlEdit").removeClass("newRlEdit"),$(e).parent().addClass("pR")),$(e).after(r);var s=null;if(n){(i=$(e).siblings(".ddMenus")).addClass("selectColPop");var o=$("#"+a+" input[type='checkbox']:disabled"),d=o.length;o.addClass("actMandColUnSort"),crmRelatedList.mandFields[$(e).data().name]=d;var c=$(e).data().name,m=-1===c.indexOf("HISTORY")?"openActivities":"closedActivities",u=$(".addNewValues_"+m),p=$("#"+m+"_btn"),g=p.offset().left+p.outerWidth()-u.offset().left+1,v=$("#relatedListCols_"+c);v.removeClass("r0"),Crm.userDetails.RTL_ENABLED?(g=u.offset().left+u.outerWidth()+1-p.offset().left,v.css("left",g+"px")):v.css("right",g+"px"),s=e.id+"_outer",crmRelatedList.restrictMandatorySortable(c),crmRelatedList.validateLimit(void 0,c)}l(s),rowClickRelList(a)}else alert(I18n.getMsg("game.common.error"))}),void 0,(function(e){555===e.status&&alert(e.responseText)}))),sE(event)}}function rowClickRelList(e){$("#"+e+" li").find("label").on("click",(function(t){var a=$(this).find("input"),i=Crm.moduleInfo.Services?Crm.moduleInfo.Services.Id:void 0;if("moduleList"==e&&i&&(arguments.length<2||"avoidRec"!==arguments[1]))if(i===a.val()){if(a.is(":checked"))return showServicesHideAlert("Services"),void t.preventDefault();setTimeout((function(){$("#"+e+" li[tabid='"+Crm.moduleInfo.Appointments.Id+"'] label").trigger("click",["avoidRec"])}),400)}else if(Crm.moduleInfo.Appointments.Id===a.val()){if(a.is(":checked"))return showServicesHideAlert("Appointments"),void t.preventDefault();setTimeout((function(){$("#"+e+" li[tabid='"+Crm.moduleInfo.Services.Id+"'] label").trigger("click",["avoidRec"])}),400)}"moduleList"==e?OptionChooser.checkDependentModule(this):sortableRowClickEvent(e,a),e.startsWith("relateList")&&crmListView.relatedMandatoryCheck(e),t.preventDefault()})),e.startsWith("relateList")&&crmListView.relatedMandatoryCheck(e)}function showServicesHideAlert(e){$("crm-services-deleteprofile").remove();var t=networkUtils.returnDependencyFiles(["crm-services-deleteprofile.js"],crmConstants.jsStaticPathForLyte);Lyte.injectResources(t,void 0,(function(){Lyte.Component.render("crm-services-deleteprofile",{isHide:!0,modName:e},"#modulePermissionDiv"),$("#services-deleteProfile")[0].ltProp("show",!0)}))}function sortableRowClickEvent(e,t){var a=$("#"+e+" li");if(t.is(":disabled"))return!1;var r=a.find("label input:checked").length-1,l=t.closest("li"),n=l.index()-1;if(t.is(":checked")){var s=r-n-1;for(s*=a.outerHeight(),t.prop("checked",!1),l.css({transform:"translateY("+s+"px)",transition:"0.3s all ease"}),i=n+1;i<r;i++)myCSSObj={},myCSSObj.transition="0.3s transform ease",myCSSObj.transform="translateY(-100%)",$($("#"+e+" li")[i+1]).css(myCSSObj);l.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",(function(t){a.css({transform:"",transition:""}),l.insertAfter($("#"+e+" li")[r]),l.off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend")}))}else{s=n-r;for(t.prop("checked",!0),s*=a.outerHeight(),l.css({transform:"translateY(-"+s+"px)",transition:"0.3s all ease"}),i=r;i<n;i++)myCSSObj={},myCSSObj.transition="0.3s transform ease",myCSSObj.transform="translateY(100%)",$($("#"+e+" li")[i+1]).css(myCSSObj);l.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",(function(t){a.css({transform:"",transition:""}),l.insertAfter($("#"+e+" li")[r]),l.off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend")}))}if("bcardList"==e){var o=a.find("label  input:checked");o.length>=5?a.find("label  input:not(:checked)").attr("disabled","disabled").closest("li").addClass("disable"):1===o.length?a.find("label  input:checked").attr("disabled","disabled").closest("li").addClass("disable"):o.length<5&&o.length>1&&a.find("label  input").removeAttr("disabled").closest("li").removeClass("disable")}}function hideCustomizeListPopup(e){$("[id="+e+"]").hide(),$(".selectRlEdit").addClass("newRlEdit").removeClass("selectRlEdit").css("visibility","hidden")}function saveSearchFields(e){var t,a=trimBoth(getObj("searchStr").value),i=[];$("#ajax_"+e+" #fieldListContents input[type='checkbox']").each((function(e,t){var a=$(this);a.is(":checked")?(i.push(a.attr("id")),a.prop("checked",!0)):a.prop("checked",!1)})),t="&fieldIds="+(i=i.join(","))+"&"+csrfParamName+"="+encodeURIComponent(csrfToken)+"&searchword="+encodeURIComponent(a),url=Crm.getCrmBasePath()+"/CustomSearchAction.do?action=addOrUpdate&module="+e,crmNavig[e]&&crmNavig[e].recordId&&(crmNavig[e].recordId=[],crmNavig.NAVIGCACHEOBJ.gsearch[e]={}),(new crmRequestPool).initiate({action:url,type:"POST",data:t,success:function(t){if($("#ajax_"+e).find("#GSearch").hide(),"NO_CHANGE"!=t){var a=getObj("ajax_"+e);$(a).empty(),a.innerHTML=t,JSEvalScript(a),searchResultObj.searchResponse=getObj("show").innerHTML}else $(".selectRlEdit").addClass("newRlEdit").removeClass("selectRlEdit").css("visibility","hidden")},error:function(e){commonUtils.showHideLoadingDiv(),e.responseText&&555==e.status&&(alert(e.responseText),$("[id^=GSearch]").hide(),$(".selectRlEdit").addClass("newRlEdit").removeClass("selectRlEdit").css("visibility","hidden"))}})}function tabGroupLimitCheck(e,t){var a=$("#ajax_"+t+" #fieldListContents input[type='checkbox']:checked").length;a>10?(alert(I18n.getMsg("crm.custom.search.maxfields")),$(e).prop("checked",!1)):a<1&&(alert(I18n.getMsg("crm.custom.search.minfields")),$(e).prop("checked",!0))}function fixedBtnFnCreate(){if($("#rwb").length&&$("#buttonTD").length){var e=$(window).scrollTop(),t=$("#rwb").offset().top,a=$(".calculaterInfo");if(0==$("#createFixedButtonDiv").length){$("<div id='createFixedButtonDiv' style='display:none; position:fixed; top:0px; left:0px; width:100%; z-index:10;box-shadow: rgb(229, 229, 229) 0px 1px 3px;'></div>").prependTo("#rwb"),$("#show").find(".cvpadding").clone().appendTo("#createFixedButtonDiv"),(n=$("#createFixedButtonDiv")).find("#layoutDetails").attr("id","layoutDetails_f");var i=$("#layoutDetails_f");i.next(".select2").remove(),thirdPartyUtils.bindSelect2(i);var r=$("#zCampIntegLayout");if(r.length>0){n.find("#zCampIntegLayout").attr("id","zCampIntegLayout_f");var l=$("#zCampIntegLayout_f");l.val(r.val()),l.next(".select2").remove(),thirdPartyUtils.bindSelect2(l)}}if(t<e)$("#createFixedButtonDiv").show(),$(".cvpadding .customPluswithImpotBtnCon, #btntoolsId").hide(),$("#createFixedButtonDiv .cvpadding .customPluswithImpotBtnCon").show();else{$("#createFixedButtonDiv").hide(),$(".cvpadding .customPluswithImpotBtnCon").show(),$("#createFixedButtonDiv .cvpadding .customPluswithImpotBtnCon").hide();var n,s=(n=$("#createFixedButtonDiv")).find("lyte-messagebox");s&&s.remove()}a.is(":visible")&&a.hide()}}function changeMyTabGroup(e){$("#tabGroupList .yes").css("visibility","hidden"),$("#"+e+" .yes").css("visibility","visible"),e="alltabgroups"===e?"0":e;var t=Crm.getCrmBasePath()+"/CustomizeTabGroup.do",a="action=updateMyTabGroup&tabGroupId="+e+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);store.findAll("tab_group").then((function(e){document.getElementsByTagName("crm-tab-group")[0].setData("tabGroupsName",e)})),mR(t,(function(){Lyte.Router.transitionTo({route:"crm.tab.module.begin",dynamicParams:["Home"]}),crmTab.reloadTabMenu()}),a)}function openNewTab(e,t,a,i){var r=document.deleteForm;if("get"==a){r=document.getForm;var l="";if(i)for(var n in i)l+="<input type='hidden' name='"+n+"' value='"+$ESAPI.encoder().encodeForHTMLAttribute(i[n])+"'/>";$("#getFormParams").html(l)}"subscription"==t&&($("#lookupdiv").empty(),getObj("lookupdiv").style.display="none"),r.action=e,r.target="_blank",r.submit()}function showWFtab(e,t,a){$("#workrule").addClass("sel"),$("li").removeClass("sel"),$("#"+a).addClass("sel"),-1!==t.indexOf("editRule")?doAjaxUpdate(e,t,""):doAjaxUpdate(e,t,"",wfBG.setWhiteBG)}function updateCustomization(e,t,a){var i=Crm.getCrmBasePath()+"/EntityCustomization.do?action=updateCustomization",r="&key="+e+"&value="+t+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);mR(i,(function(e){try{var t=JSON.parse(e);Crm.userDetails.CUSTOMIZE_INFO=t,null!=a&&"function"==typeof a&&a()}catch(e){}}),r)}function saveAndExportToGoogleCal(e,t,a){var i=$("#pcVersionInfo").closest("form")[0].name,r="&"+csrfParamName+"="+encodeURIComponent(csrfToken);if("continue"==a){getObj("alertMessageForUserDiv").style.display="none",getObj("FreezeLayer").style.display="none";$.ajax({url:Crm.getCrmBasePath()+"/CalendarSyncConfig.do",type:"POST",data:"event=add_gcal_alerted"+r,dataType:"json",success:function(a){if("3003"==a.result){var r="",l="",n=formData2QueryString(document[i],t);"Create"==e?(r=Crm.getCrmBasePath()+"/CreateCommonModule.do",l="ActionType=AddToZG&"):"Edit"==e&&(r=Crm.getCrmBasePath()+"/EditCommonModule.do",l="ActionType=Edit&GappsUpdate=yes&"),l=(l+=n)+"&"+csrfParamName+"="+encodeURIComponent(csrfToken),ajaxNew(r,l)}else"3004"==a.result&&alert("<fmt:message key='crm.GcalSync.error'/>")},error:function(e){alert("<fmt:message key='crm.GcalSync.error'/>")}})}else"cancel"==a&&(getObj("alertMessageForUserDiv").style.display="none",getObj("FreezeLayer").style.display="none")}function showFrameMsg(e,t){jQuery(t).html($("#AttachmentFrame").contents().find(e).html()),jQuery("#fileAttachForm  input[name=Attach]").attr({style:"opacity: none;",disabled:""})}function getModuleLinks(){var e=$("#module").val(),t=Crm.getCrmBasePath()+"/CustomButton.do?step=showLnkInDetailPage&module="+e+"&fromPage=popup",a=new getHTTPObject;a.open("POST",t,!0),a.onreadystatechange=function(){if(4==a.readyState){if(a.status==crmConstants.errorStatusCode)return void renderingUtils.displayPermissionDenied(a);var e=a.responseText;hideAnimatePopup("topBandPopup"),$("#cuslnkquickact").empty(),getObj("cuslnkquickact").innerHTML=e;var t=$("#detailAddLink"),i=$("#linksCreatedCount").val(),r=parseInt($("#customlinkcount").data("max"));$("#customlinks").removeClass("noDataFountDetail"),i<r?(t.attr("onclick","showCustomizePopup('CreateList','"+$("#module").val()+"')"),t.attr("onmouseenter",""),t.attr("onmouseleave","")):(t.attr("onmouseenter","zctt.showtt('"+I18n.getMsg("crm.customlink.limitexist.new",r)+"',"+!0+")"),t.attr("onmouseleave","zctt.hidett()"),t.attr("onclick","")),0===parseInt(i)?$("#customlinks").addClass("noDataFountDetail"):$("#customlinks").removeClass("noDataFountDetail")}},a.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),a.send(null)}function submitInvPdtDelAction(){return deleteInvLineItems(gblid),removeFreezeLayer(),getObj("InventoryWarningDiv").style.display="none",!1}function setCaretPosition(e,t){var a=document.getElementById(e);if(null!=a)if(a.createTextRange){var i=a.createTextRange();i.move("character",t),i.select()}else document.createRange?$("#"+e).get(0).setSelectionRange(t,t):a.selectionStart?(a.focus(),a.setSelectionRange(t,t)):a.focus()}function showHideCallDuration(e,t){if($("#checkDuplicateEvent").hide(),$("input[name='property(Call Start Time)']").length>0&&$("input[name='property(Call Start Time)']")[0].setAttribute("onclick","crmCalendar.showCalendar(event,'leftPanel',undefined, undefined, 786)"),$("form[name='"+t+"'] #whichCallDiv").length&&($("form[name='"+t+"'] input[name='property(Call Duration)']").parent().css("display",e).parent().css("display",e),$("form[name='"+t+"'] input[name='property(Call Start Time)']").parent().css("display",e),getObj("compCalDiv")&&$("form[name='"+t+"'] #compCalDiv").css("display",e),getObj("qownerName_select")&&$("#call_qowner").css("display","none"),getObj("remTime")&&($("#remTime").closest(".tabDivCreate").css("display","none"),$("form[name='"+t+"'] [name='remCheckTask']").prop("checked",!1))),$("form[name='"+t+"'] #whichCall1").is(":checked")){var a=$("form[name='"+t+"'] select[name='property(Call Type)']").find("[actualvalue=Outbound]").val();$("form[name='"+t+"'] select[name='property(Call Type)']").val(a).trigger("change").attr("disabled",!0)}else $("form[name='"+t+"'] select[name='property(Call Type)']").prop("disabled",!1);$("form[name='"+t+"'] [id='_leContModSel']").parent().children("span").children("label").removeClass("qmandatory"),"ScheduleCall"===jQuery("input[name=whichCall]:checked").val()&&($("#checkDuplicateEvent").show(),$("input[name='property(Call Start Time)']")[0].setAttribute("onclick","crmCalendar.showCalendar(event,'leftPanel',Events.callDuplicationDateHandler, undefined, 786)"))}function create_twtLoad(){$(".twtinpt").focus((function(){$("#twtInptDiv").addClass("twtFocus")})),$(".twtinpt").bind("click",(function(){$("#twtInptDiv").addClass("twtFocus")})),$(".twtinpt").bind("blur",(function(){$("#twtInptDiv").removeClass("twtFocus")}))}function openZDocsLinkDialog(e,t){if(t&&(fileupload.fromFileUploadField=!0),$("#attachOptionsFromDetailMenu,#eventActionsMenu").hide(),null!=usernameNeeded&&"boolean"==typeof usernameNeeded&&1==usernameNeeded&&-1==jQuery.inArray("zdoc",usernameNotNeeded))commonUtils.checkUsernameNeeded((function(){LINKDOCS.showLinkFileDialog("crm",e,"10","true","docsURL",RebrandLinkUtil.getProperty("docsStaticUrl"))}),"zdoc",(function(){return!1}));else{var a={servicename:"crm",zsoid:e,filelimit:"10",docsURL:RebrandLinkUtil.getProperty("docsStaticUrl")};LINKDOCS.showLinkFileDialog(a)}}function isEmailValidInAssocCont(e,t,a,i){if("object"==typeof e&&(e=e.value),t&&"null"!=t.value&&""!=t.value||void 0!==a&&"null"!=a){var r=void 0===a?t.value:a,l=[i=i||(void 0===a?"Contact":"Vendor"),e];return!(""==r||!validationUtils.isValidEmail(r))||(renderingUtils.showCustomAlert(I18n.getMsg("no.proper.email.for.mapped.contactOrVendor",I18n.getMsg(l))),!1)}return!0}function callGAppsURL(e,t){t&&null!=t&&"createdLeads"==t&&onscrollhiddendiv(),null!=t&&""!=t||(t="result");var a=csrfParamName+"="+encodeURIComponent(csrfToken);if(e.indexOf("processFromAdminPage")<=0){var i=adwordParams||{};if(i){var r=null!=i.startDate?i.startDate:"",l=null!=i.endDate?i.endDate:"",n=null!=i.orderby?i.orderby:"",s=null!=i.sortby?i.sortby:"",o=null!=i.dateFilter?i.dateFilter:"";e.indexOf("startDate")<=0&&(e+="&startDate="+r),e.indexOf("endDate")<=0&&(e+="&endDate="+l),e.indexOf("dateFilter")<=0&&(e+="&dateFilter="+o),e.indexOf("orderby")<=0&&(e+="&orderby="+n),e.indexOf("sortBy")<=0&&(e+="&sortBy="+s)}}loadAjaxTab(""),e.indexOf("isFirstTime=true")<=0&&commonUtils.showHideLoadingDiv(!0),$.ajax({type:"POST",url:e,data:a,success:function(a){if("ITS_NOT_ADWORD_ACC"==a){if(getObj("NOT_VALID_ADWORD_ACC"))return freezeBackground(),document.getElementById("ajax_load_tab")&&commonUtils.showHideLoadingDiv(),getObj("NOT_VALID_ADWORD_ACC").style.zIndex=645,getObj("NOT_VALID_ADWORD_ACC").style.display="block",void mailsetCenter("NOT_VALID_ADWORD_ACC")}else{if(-1!=e.toLowerCase().indexOf("adword")&&-1!=a.indexOf("NO_OF_ACCOUNT_EXCEEDED")){var i=JSON.parse(a).Message;return renderingUtils.showCustomAlert(i),getObj("savebutton").disabled=!1,getObj("cancelbutton").disabled=!1,void commonUtils.showHideLoadingDiv()}if(-1!=e.indexOf("adwDemo")){var r=a.split("successfullySchDemo")[1];return document.getElementById("ajax_load_tab")&&commonUtils.showHideLoadingDiv(),getObj("training").style.display="none",void alert(r)}if(-1!=e.indexOf("MSApps.do"))return $("#result").html(Handlebars.templates.MScalendar(a)),void commonUtils.showHideLoadingDiv(!1);if(-1!=e.indexOf("GoogleApps.do"))return a.addressError?(commonUtils.showHideLoadingDiv(!1),void crmui.showMsgBand("error",I18n.getMsg("crm.gmail.emailChange"),5e3)):(GmailAPI.alertForReAuthentication(!1),$("#result").html(Handlebars.templates.gmailSetup(a)),GmailAPI.onLoad(a),void commonUtils.showHideLoadingDiv(!1))}removeFreezeLayer(),commonUtils.showHideLoadingDiv(),$(t).empty(),getObj(t).innerHTML=a,JSEvalScript(getObj(t)),-1!=e.indexOf("dataPopulated=S")?getObj("successfullyDataPopulated")&&(freezeBackground(),getObj("successfullyDataPopulated").style.zIndex=3455,getObj("successfullyDataPopulated").style.display="block",mailsetCenter("successfullyDataPopulated")):-1!=e.indexOf("action=profileList")?(freezeBackground(),getObj("profilePermission").style.zIndex=545,getObj("profilePermission").style.display="block",mailsetCenter("profilePermission"),JSEvalScript(getObj("profilePermission"))):-1!=e.indexOf("action=addDelPermission")?(removeFreezeLayer(),getObj("profilePermission").style.display="none"):getObj(t)&&"successfully deactivated"==getObj(t).value?location.href=Crm.getCrmBasePath()+"/ShowHomePage.do":"createdLeads"==t?(freezeBackground(),$("#LeadConversionDiv").css({position:"absolute"}),mailsetCenter("LeadConversionDiv")):"historyInfo"==t?(freezeBackground(),$("#historyInfo").css({height:$(window).height()-100}),mailsetCenter("historyInfo"),getObj("historyInfo").style.zIndex=545,getObj("historyInfo").style.display="block"):-1!=e.indexOf("sortBy=")&&changeImageClass()},error:function(){}})}function regerateHTML(e){freezeBackground(),loadAjaxTab(""),http&&(http.open("POST",e,!0),http.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),http.setRequestHeader("X-Requested-With","XMLHttpRequest"),http.onreadystatechange=function(){if(4==http.readyState){if(http.status==crmConstants.errorStatusCode)return commonUtils.showHideLoadingDiv(),void renderingUtils.displayPermissionDenied(http);var e=http.responseText;$("#appendHTML").empty(),getObj("appendHTML").innerHTML=e,mailsetCenter("ContainerDiv"),getObj("ContainerDiv").style.display="block",commonUtils.showHideLoadingDiv(),JSEvalScript(getObj("ContainerDiv"))}},http.send())}function removeHTML(){removeFreezeLayer(),getObj("ContainerDiv").style.display="none"}function sendProfile(e){var t=!1,a="";if(getObj(e).length>1)for(var i=0;i<getObj(e).length;i++)1==getObj(e)[i].checked&&(a+=getObj(e)[i].value+",",t=!0);else 1==getObj(e).checked&&(t=!0,a=getObj(e).value);t?callGAppsURL(Crm.getCrmBasePath()+"/gadword.do?action=addDelPermission&profileId="+a):alert("Please atleast one profile")}function showDivOnFreezeLayer(){freezeBackground(),mailsetCenter("genaratescriptPop")}function loadMailListForRL(e){if(getObj("mailListRelId")&&getObj("mailConfigType")){var t=getObj("mailListRelId").value,a=getObj("mailConfigType").value.split("#"),i=a[0];getObj("getMailOpt")&&getObj("getMailOpt").innerHTML,"1"==i&&a[1]?($("#"+t).empty(),document.getElementById(t).innerHTML="<table cellspacing='0' cellpadding='0' width='95%' border='0' class='norec' align='center'><tbody><tr><td valign='center' height='50px'><div class='pL25'>"+a[1]+"</div><br/></td></tr></table><br/>"):"2"==i&&a[1]?getObj(t)?($("#"+t).empty(),document.getElementById(t).innerHTML="<table cellspacing='0' cellpadding='0' width='95%' border='0' class='norec' align='center'><tbody><tr><td valign='center' height='50px'><div class='pL25'>"+a[1]+"</div><br/></td></tr></table><br/>"):($("#"+t).empty(),getOpenerObj(t).innerHTML="<table cellspacing='0' cellpadding='0' width='95%' border='0' class='norec' align='center'><tbody><tr><td valign='center' height='50px'><div class='pL25'>"+a[1]+"</div><br/></td></tr></table><br/>",window.self.close()):getObj("entIdForZMail")&&($("#isFromNewAPI").length>0?showMailsListViaAPI("ALL","-10","next"):showMailsList(getObj("entIdForZMail").value,i,"",t,"-10","next","","false",e,"true"),getObj("zmailRS").style.display="")}getObj("zs_EMAIL")&&(getObj("zs_EMAIL1")?getObj("zs_EMAIL").value=getObj("zs_EMAIL1").value:getObj("subvalue_EMAIL")&&(getObj("zs_EMAIL").value=getObj("subvalue_EMAIL").innerHTML))}function gotoAccount(e,t,a){var i="",r=$("#account")[0];i=r&&""==r.value?Crm.getCrmBasePath()+"/gadword.do?action=accDesc":Crm.getCrmBasePath()+"/gadword.do?action=accSummary",r&&""!=r.value&&(i+="&accId="+r.value),null!=t&&(i+="&campId="+t),null!=a&&(i+="&gid="+a);var l=adwordParams||"";""!=l.dateFilter&&(i+="&dateFilter="+l.dateFilter+"&startDate="+l.startDate),callGAppsURL(i,"show")}function showFeedBackResponse(e){$("#helpHome").hide(),$("#timesData").show();var t=$(window).width();"Yes"==e?($("#timesData").text(I18n.getMsg("crm.case.sent.message")),$("#timesData").addClass("successAlert"),t=t/2-200):($("#timesData").text(I18n.getMsg("crm.MassEmail.ajax.failure")),$("#timesData").addClass("errorAlert"),t=t/2-300);var a=$("#tmC").get(0),i=findPosY(a);$("#timesData").css({left:t,top:i+5,position:"absolute"}),setTimeout((function(){$("#timesData").fadeOut(2e3)}),2e3)}function checkHandle(e,t){32==(e=e||window.event).keyCode&&(alert(I18n.getMsg("crm.quick.create.twitter.error")),t.value=t.value.substring(0,t.value.length-1))}function attachmentExceedCheck(){for(var e=0,t=0,a=getfilesCount(),i=0;i<a;i++)if(null==getObj("fvtheFile_"+i)&&t<5)t+=1,a+=1;else if(null!=getObj("fvtheFile_"+i)){t=0,e+=getObj("theFile_"+i).files[0].size}return e>10485760}function hideShowDiv(e,t){getObj(e)&&(getObj(e).style.display="none"),getObj(t)&&(getObj(t).style.display="block")}function activeBanner(e){getObj("banner_"+e).className="gawMenutype mL30 fL gawActive";for(var t=e-1;t>=1;t--)getObj("banner_"+t)&&(getObj("banner_"+t).className="gawMenutype mL30 fL gawComplete")}function showPlayIcon(e){jQuery(e).find(".icon_play").show()}function hidePlayIcon(e){jQuery(e).find(".icon_play").hide()}function playAudio(e,t){var a=jQuery(e),i=jQuery("#"+t+"_audio")[0],r=jQuery("#timerarea_"+t);a.hasClass("icon_pause")?(a.removeClass("icon_pause"),i.pause(),r.addClass("hide")):(a.addClass("icon_pause"),i.play(),r.removeClass("hide"),jQuery.browser.msie||i.addEventListener("ended",(function(){a.removeClass("icon_pause"),i.load(),r.addClass("hide")})))}function validateCallTime2(e){var t="property(Call Start Time)";if(!getElm(e,t))return!0;var a=$("form[name='"+e+"'] input[name='operation']").val(),i=$("form[name='"+e+"'] input[name='whichCall']:checked"),r=0!=i.length?i.val():"";return!("CompletedCall"===r&&!dateTimeValidate(t,"Call Start Time","Call Start Time","LE",e))&&("ScheduleCall"!==r||"edit"===a||!!emptyCheck(t,"Call Start Time")&&(!!dateTimeValidate(t,"Call Start Time","Call Start Time","G",e)&&qCreateCall.isEntityAssociated(e,r)))}function getZuidsForGroupId(e,t){var a=void 0!==Crm.userDetails.permissions.Crm_Implied_Manage_Groups&&Crm.userDetails.permissions.Crm_Implied_Manage_Groups;if(null==groupIdsVsZuids||null==groupIdsVsZuids[e]){var i="actionType=groupUsersInfo&groupId="+e+"&"+csrfParamName+"="+encodeURIComponent(csrfToken);mR(Crm.getCrmBasePath()+"/specific/noteattach.do?",(function(i){var r=JSON.parse(i);groupIdsVsZuids[e]=r[e];var l=Handlebars.templates.FeedsGroupUsers;if(groupIdsVsZuids[e].length>20)var n=l({zuids:groupIdsVsZuids[e].slice(0,15),count:groupIdsVsZuids[e].length,groupId:e,groupName:t,manageGroupPermission:a});else n=l({zuids:groupIdsVsZuids[e],count:groupIdsVsZuids[e].length,groupId:e,groupName:t,manageGroupPermission:a});$("#groupUsers").html(""),$("#groupUsers").html(n),$("#groupUsers").show()}),i)}else{var r=Handlebars.templates.FeedsGroupUsers;if(groupIdsVsZuids[e].length>20)var l=r({zuids:groupIdsVsZuids[e].slice(0,15),count:groupIdsVsZuids[e].length,groupId:e,groupName:t,manageGroupPermission:a});else l=r({zuids:groupIdsVsZuids[e],count:groupIdsVsZuids[e].length,groupId:e,groupName:t,manageGroupPermission:a});$("#groupUsers").html(""),$("#groupUsers").html(l),$("#groupUsers").show()}}function getZuidsForGroupIdPopup(e,t,a){var i=void 0!==Crm.userDetails.permissions.Crm_Implied_Manage_Groups&&Crm.userDetails.permissions.Crm_Implied_Manage_Groups,r=(0,Handlebars.templates.FeedsGroupAllUsers)({zuids:groupIdsVsZuids[e],count:groupIdsVsZuids[e].length,groupName:t,groupId:e,manageGroupPermission:i}),l=$(a).offset().left,n=$(a).offset().top;$("#feedsGroupMembersDiv").css({visibility:"hidden"}),$("#feedsGroupMembersDiv").show();var s=$("#feedsGroupMembersDiv").outerWidth();$("#feedsGroupMembersDiv").css({left:l-(s+10),top:n-200}),$("#feedsGroupMembersDiv").html(""),$("#feedsGroupMembersDiv").html(r),$("#feedsGroupMembersDiv").css({visibility:"visible"}),EvalInnerScript(getElemById("feedsGroupMembersDiv")),setPerfectScrollBar("feed_member_popup_outer","feed_member_popup_inner")}function getComboValuesForAp(e,t,a,i,r,l,n,s,o){var d="",c="";null!=l&&(d=l);var m="";null!=n&&(m=n);var u=r,p=Crm.getCrmBasePath()+"/GetComboValues.do",g="fieldId="+e+"&module="+(void 0===i?"":i)+"&uiType="+t+"&action=approvalProcess";s&&(g+="&allowEmpty=true"),o&&(g+="&isPotentialStage=true");var v=getHTTPObject();v&&(v.open("POST",p,!0),v.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),v.setRequestHeader("X-Requested-With","XMLHttpRequest"),v.onreadystatechange=function(){if(4==v.readyState){dataStr=v.responseText.trim();for(var e=null,i=!1,r=null,l=1;l<=u;l++){if(a=$("#"+m+"fieldUpdate"+l+d).val(),100==t||t==CrmField.UITYPES.GLOBAL_TAX){$("#"+m+"typeSection"+d).show(),c+="<div class='cchosen mlSelect mlSelAutoWidth noborder_multiselect pR'><span class='crm-font-regular f14 sltSetVal sltBdr dIB'></span><select  multiple size='4' data-zcqa='select_MassUpdate_Value' id='"+m+"fieldUpdate"+l+d+"' onchange='approvalProcess.selectBoxLimitationInMultiselect(this);wfForm.setSltVal(this);'>";var n=JSON.parse(dataStr);if(null!=a){var s=a.split("_");1==s.length&&s.unshift($("#"+m+"isAppend"+d).val());for(var o,p=s[1].split(","),g=n.length,f=0;f<g;f++){var h=n[f];o=0;for(var b=0;b<p.length;b++)h.Id==p[b]&&(o=1);c+=0==o?"<option value='"+h.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(h.ActualValue)+"'>"+$ESAPI.encoder().encodeForHTML(h.DisplayValue)+"</option>":"<option value='"+h.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(h.ActualValue)+"' selected>"+$ESAPI.encoder().encodeForHTML(h.DisplayValue)+"</option>"}0==s[0]?($("#"+m+"OverwriteVal"+d).prop("checked",!0),$("#"+m+"AppendVal"+d).removeAttr("checked")):1==s[0]&&($("#"+m+"AppendVal"+d).prop("checked",!0),$("#"+m+"OverwriteVal"+d).removeAttr("checked"))}else for(g=n.length,f=0;f<g;f++){h=n[f];c+="<option value='"+h.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(h.ActualValue)+"'>"+$ESAPI.encoder().encodeForHTML(h.DisplayValue)+"</option>"}if(c+="</select></div>","0"==$("#"+m+"isinitial"+d).val()){var C="<tr id='"+m+"typeSection"+d+"' class= 'typeSection'> <td width='100'><div class='wf_requiredMark wf_form_lab'>"+I18n.getMsg("crm.workflow.field.to.update.Action")+"</div></td><td><label class='rbCheckHtml dIB'><input type='radio' id='"+m+"OverwriteVal"+d+"' class='rbRealHtml hide triggerRad' checked='checked' name='recordOrDate1'>";C+="<span class='rbHtml dIB pR'> <span class='rbTickHtml pA'></span></span><span class='rbHtmlLb pL5'>"+I18n.getMsg("crm.import.duplicates.overwrite")+"</span></label><label class='pL15 rbCheckHtml dIB'> <input type='radio' id='"+m+"AppendVal"+d+"' class='rbRealHtml hide triggerRad' name='recordOrDate1'>",C+="<span class='rbHtml dIB pR'><span class='rbTickHtml pA'></span> </span><span class='rbHtmlLb pL5'>"+I18n.getMsg("crm.import.duplicates.append")+"</span></label></td></tr> ",$("#"+m+"APFieldUpdate"+d+" tr:last").after(C),$("#"+m+"isinitial"+d).val("1")}approvalProcess.selectedObj=$("#"+m+"fieldUpdate"+l+d).val()}else if(2==t||26==t){c="<div class='newSelect'><select id='"+m+"fieldUpdate"+l+d+"' name='"+m+"fieldUpdate"+l+d+"' onchange='wfForm.setSltVal(this);'>";var y=JSON.parse(dataStr),I=[],w=y.length;for(P=0;P<w;P++)I.push(y[P].Id);var A=[],E=I.length;for(f=0;f<E;f++){var T=y[f],S=T.colorCode;T.Id;S?(i=!0,A[A.length]=T):"-None-"===T.ActualValue&&(A[A.length]=T)}A.length>0&&(c="<div class='newSelect'><select data-colorcode_enabled="+i+" id='"+m+"fieldUpdate"+l+d+"' name='"+m+"fieldUpdate"+l+d+"' onchange='wfForm.setSltVal(this);'",c+=" data-picklistmap='"+JSON.stringify(A)+"'>");g=(n=JSON.parse(dataStr)).length;null==a&&(a="None");for(f=0;f<g;f++){(h=n[f])&&h.colorCode?h.DisplayValue==a||h.Id==a?(c+="<option data-colorcode='"+h.colorCode+"'value='"+h.Id+"'actualvalue='"+h.ActualValue+"'selected>"+$ESAPI.encoder().encodeForHTML(h.DisplayValue)+"</option>",e=h.colorCode,r=h.ActualValue):c+="<option data-colorcode='"+h.colorCode+"'value='"+h.Id+"'actualvalue='"+h.ActualValue+"'>"+$ESAPI.encoder().encodeForHTML(h.DisplayValue)+"</option>":"-None-"==h.ActualValue?c+="None"==a?"<option value='"+h.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(h.ActualValue)+"'selected>"+$ESAPI.encoder().encodeForHTML("None")+"</option>":"<option value='"+h.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(h.ActualValue)+"'>"+$ESAPI.encoder().encodeForHTML("None")+"</option>":h.DisplayValue==a||h.Id==a?c+="<option value='"+h.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(h.ActualValue)+"' selected>"+$ESAPI.encoder().encodeForHTML(h.DisplayValue)+"</option>":c+="<option value='"+h.Id+"'actualvalue='"+$ESAPI.encoder().encodeForHTMLAttribute(h.ActualValue)+"'>"+$ESAPI.encoder().encodeForHTML(h.DisplayValue)+"</option>"}i&&!r&&(e=n[0].colorCode,r=n[0].ActualValue),c+="</select></div>"}else{var L,_=dataStr.split("~~"),O=!1;c="<div class='newSelect'><select id='"+m+"fieldUpdate"+l+d+"' name='"+m+"fieldUpdate"+l+d+"' onchange='wfForm.setSltVal(this);'>";for(var M=_.length,P=0;P<M;P++){var k=_[P];if(k=(k=(k=k.replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&#39;"),208==t){var R=k.split("|");R[0]==a?(0==P&&(L=R[1]),c+="<option data-val='"+R[0]+"' id='"+P+"' value='"+R[0]+"' selected>"+R[1]+"</option>",O=!0):(0==P&&(L=R[1],t!=CrmField.UITYPES.LAYOUT||O||null!=a||(c+="<option id='None' value='' selected>"+$ESAPI.encoder().encodeForHTML(I18n.getMsg("crm.social.choose.layout"))+"</option>")),c+="<option data-val='"+R[0]+"' id='"+P+"' value='"+R[0]+"'>"+R[1]+"</option>")}else k==a?(0==P&&(L=k),c+="<option data-val='"+k+"' id='"+P+"' value='"+k+"' selected>"+k+"</option>",O=!0):(0==P&&(L=k),c+="<option data-val='"+k+"' id='"+P+"' value='"+k+"'>"+k+"</option>")}!O&&a&&(0==P&&(L=a),c+="<option data-val='"+a+"' id='"+P+++"' value='"+a+"' selected>"+a+"</option>"),c+="</select></div>",$(getObj(m+"fieldLabletd"+l+d)).empty(),$("#fldUp_spn").text(L),wfForm.chosen_show()}var D=getObj(m+"fieldLabletd"+l+d);if(D.innerHTML=c,thirdPartyUtils.bindSelect2($("#"+m+"fieldLabletd"+l+d).find("select")),null!==e)$('<span class="dIB activitesColor" data-zcqa="colorcode_selectWFupdatecolorcode" id="selectWFupdatecolorcode"style="background:'+e+'"></span>').insertBefore("#"+m+"fieldUpdate"+l+d);!0!==i||r&&"-None-"!==r?!0===i&&"-None-"!==r&&$(D).addClass("colorEnabledPicklist"):$(D).addClass("colorEnabledPicklist colorEnabledPKNone ")}}},v.send(g))}function getOptOutForAp(e,t,a,i,r){var l="";null!=i&&(l=i);var n="";null!=r&&(n=r);var s=a,o="<label class='cbCheckHtml'><input type='checkbox' class='hide ccbRealHtml' id='"+n+"fieldUpdate"+s+l+"' name='"+n+"fieldUpdate"+s+l+"' value='0' onchange='OnChangeCheckbox(this)'/><span class='ccbHtml dIB pR'><span class='ccbTickHtml dIB pA'></span></span><div class='clearB'></div></label>";1==t&&(o="<label class='cbCheckHtml'><input type='checkbox' class='hide ccbRealHtml' id='"+n+"fieldUpdate"+s+l+"' name='"+n+"fieldUpdate"+s+l+"' value='1' onchange='OnChangeCheckbox(this)' checked/><span class='ccbHtml dIB pR'><span class='ccbTickHtml dIB pA'></span></span><div class='clearB'></div></label>"),$(getObj(n+"fieldLabletd"+s+l)).empty(),getObj(n+"fieldLabletd"+s+l).innerHTML=o}function updateTaskOwner(e,t,a){$("#value_SMOWNERID").find("#ownerName_id").text(t),$("#headervalue_SMOWNERID").find("#ownerName_id").text(t);var i=document.viewentityform.id;if(i)if(i=i.value,a){var r=$("#recordid_"+i),l=r.find("[id='TaskOwner']").length?"TaskOwner":"taskOwner";r.find("[id='"+l+"']").attr("title",t).text(t)}else e===Crm.userDetails.USER_ID?$("#cvlist_"+i).find("#lp_owner").text(I18n.getMsg("crm.label.you")):$("#cvlist_"+i).find("#lp_owner").text(t)}function loadActivityDetails(e,t,a,i,r,l,n,s){crmTemplate.downloadedContentLoaded=!1;var o=customViewObject?customViewObject.isKanbanView:void 0;if(o=o||"true"===$("#iskanbanview").val(),t?t=$(t):i&&(t=$("#cvlist_"+i).length?$("#cvlist_"+i):$("#recordid_"+i)),t.length){a=JSON.parse(t.attr("data-params"));if(1==t.attr("loading")||!r&&a.id===$('form[name="viewentityform"]').find('input[name="id"]').val()&&t.parent("li").hasClass("selectedRightActivity"))return;if(t.attr("loading",!0),$("#fromTaskPage").remove(),o){Calls.callGroupArr=[],Calls.callGroupArrLabel=[],$("#cvEditSave").empty(),$("#cvEditSave").css("display","none");d="entitypopup",c=""}else{a.FROM_INDEX=$("#cvFromIndex").val(),a.TO_INDEX=$("#cvToIndex").val();var d="taskDetailsPart",c="lp_"}if(detailView.isKafkaRefreshForActivitiesPage(a.module))return;$("#"+d).html('<div class="ks_loading_new pA" style="top:50%;left:50%"></div>');var m=networkUtils.constructUrl(Crm.getCrmBasePath()+"/ShowEntityInfo.do",a);if(n)var u=!0;if(s){var p=new Promise((function(e,t){s.resolve=e,s.reject=t}));s.dummyPromise=p}if(ajaxNew(m,void 0,(function(e){if(n&&n(e),crmTemplate.downloadedContentLoaded=!0,"Events"==a.module){var t=$("#detailViewButtonLayerMainTable").find(".activitesColor"),i=$("#detailView_"+a.id),r=!1;0==i.length&&(i=$("#kanban_"+a.id),r=!0);var s=i.find(".activitesColor");if(t.length>0){var o=t.css("background-color"),d=Events.rgbtohex(o);s.length>0?s.css("background-color",d):r?i.append('<span class="activitesColor" data-zcqa="relcvColor_'+a.id+'" style="background: '+d+'"></span>'):$("#cvlist_"+a.id).find("a").append('<span class="activitesColor" data-zcqa="relcvColor_'+a.id+'" style="background: '+d+'"></span>')}else s.length>0&&s.remove()}l&&l.call(window),Crm.evalAfterLRDownload(Crm.getCrmBasePath()+"/ShowEntityInfo.do",a.module,a.id)}),d,u),o&&!u){var g=t.closest(".kvtlistbgheader").attr("id");$("#kvType").val(g),taskDetailsview.listAnimation("open"),(void 0===Crm.userDetails.VALIDATIONRULEAVAILABLE||!0===Crm.userDetails.VALIDATIONRULEAVAILABLE&&Crm.userDetails.VRINVOLVEDMODULES.contains(a.module))&&Crm.downloadValidationRules(m,a.module)}if(a.conid&&"null"!==a.conid)var v=a.conid;if(a.relid&&"null"!==a.relid)var f=a.relid;var h=a.setype;if(v&&f&&v!==f){var b='<option value=\'{"id":"'+v+'","module":"Contacts"}\'>'+$ESAPI.encoder().encodeForHTML(t.find("#"+c+"contactname").text())+'</option><option value=\'{"id":"'+f+'", "module":"'+h+"\"}'>"+$ESAPI.encoder().encodeForHTML(t.find("#"+c+"relatedto").text())+"</option>";$("#rightPanelSelect").html(b).parent().show()}else $("#rightPanelSelect").parent().hide();v&&(f=v,h="Contacts"),f?($("#rp_parent").show(),$("#rp_td").css("visibility","hidden"),getRightPanelDetails(f,h,"rp_parent",(function(){}),s)):$("#rp_parent").hide()}else{var C=Lyte.Router.getRouteInstance(),y=a&&a.module?a.module:C.obj?C.obj.module:C.params.module;if(C.params&&C.params.id!=i)Lyte.Router.transitionTo({route:"crm.tab.module.entity.detail",dynamicParams:["Activities",i],queryParams:{sub_module:y}}).data={fromDetailView:!0,backOneLevel:C.transition.data.backOneLevel};else{a=$("#rightPanel").length?{id:i,module:y,fromDetailView:!0}:{id:i,module:y},m=networkUtils.constructUrl(Crm.getCrmBasePath()+"/ShowEntityInfo.do",a);ajaxNew(m,"",(function(e){Crm.evalAfterLRDownload(Crm.getCrmBasePath()+"/ShowEntityInfo.do",a.module,a.id)}))}}}function switchTaskRightPanel(e){var t=$(e).val();t=JSON.parse(t),getRightPanelDetails(t.id+"",t.module+"","rp_parent",(function(){}))}function updateLeftPanel(e,t){var a="true"===$("#iskanbanview").val(),i=a?$("#recordid_"+e):$("#cvlist_"+e),r=a?"":"lp_";if(i&&i.length){var l=JSON.parse(i.attr("data-params")),n=["property(leContModName)","property(modname)","property(Venue)","property(Subject)","property(Status)","property(Priority)"],s=["contactname","relatedto","Venue","Subject","Status","Priority"],o="Events"===t;$("#leContModSel").length?$("#leContModSel").val():$('input[name="property(leContModSel)"]:checked').val();if(l.conid="",l.relid="",l.setype="","Contacts"===Crm.requestParam["property(leContModSel)"]&&Crm.requestParam["property(leContModId)"]?l.conid=Crm.requestParam["property(leContModId)"]:Crm.requestParam["property(leContModId)"]&&(l.relid=Crm.requestParam["property(leContModId)"],l.setype="Leads"),Crm.requestParam["property(modid)"]){var d=Crm.requestParam["property(modsel)"];l.setype=d,l.relid=Crm.requestParam["property(modid)"]}if(Crm.requestParam["property(Event Title)"]&&i.find("#"+r+"Subject").text(Crm.requestParam["property(Event Title)"]),Crm.requestParam["property(Start DateTime)"]&&Crm.requestParam["property(End DateTime)"]){if("HH:mm"===Crm.userDetails.TIME_FORMAT)var c=Utils.getDateObject(Crm.requestParam["property(Start DateTime)"],{hrs:Crm.requestParam["property(Start DateTimehour)"],mins:Crm.requestParam["property(Start DateTimeminute)"]}),m=Utils.getDateObject(Crm.requestParam["property(End DateTime)"],{hrs:Crm.requestParam["property(End DateTimehour)"],mins:Crm.requestParam["property(End DateTimeminute)"]});else c=Crm.requestParam["property(Start DateTime)"]+" "+Crm.requestParam["property(Start DateTimehour)"]+":"+Crm.requestParam["property(Start DateTimeminute)"]+" "+Crm.requestParam["property(Start DateTimeampm)"],m=Crm.requestParam["property(End DateTime)"]+" "+Crm.requestParam["property(End DateTimehour)"]+":"+Crm.requestParam["property(End DateTimeminute)"]+" "+Crm.requestParam["property(End DateTimeampm)"];var u=taskDetailsview.formatdatetime(c,m,e);i.find('span[id="'+r+'Start DateTime_tkv"]').text(u).removeAttr("title")}if(Crm.requestParam["property(Due Date)"]){var p=getFormattedDate(Crm.requestParam["property(Due Date)"]);a?taskDetailsview.updaterecord(e,"Due Date",Crm.requestParam["property(Due Date)"],p):i.find('span[id="'+r+'Due Date"]').text(p)}if($("#Crm_Tasks_SMOWNERID").length)(h=Crm.requestParam["property(ownerId)"])===Crm.userDetails.USER_ID?i.find("#"+r+"owner").text(I18n.getMsg("crm.label.you")):i.find("#"+r+"owner").text($("#Crm_Tasks_SMOWNERID").text());i.attr("data-params",JSON.stringify(l));for(var g=o?3:n.length,v=0;v<g;v++){var f=Crm.requestParam[n[v]];f=f||"",i.find("#"+r+s[v]).text(f)}if("Calls"==t&&isNewCallView){var h,b,C,y=crmCallsNew.getCallStartCrmDate(),I=$("#createEditCallPopup"),w=I.find("#Crm_Calls_CALLDURATION_Mins").val(),A=I.find("#Crm_Calls_CALLDURATION_Secs").val(),E=I.find("#Crm_Calls_OUTBOUNDCALLSTATUS").find("option:selected").data("actual-value"),T=null,S=null,L=I.find("#Crm_Calls_CONTACTID_WhoId_select"),_=I.find("#Crm_Calls_CONTACTID"),O=I.find("#Crm_Calls_SEID_select"),M=I.find("#Crm_Calls_SEID"),P=_.data("id")?L:O,k=_.data("id")?_:M;I.find("#"+crmCallsNew.fields.Call_Owner.fieldRow).is(":visible")&&(h=I.find("#"+crmCallsNew.fields.Call_Owner.dataElement).data("id"),T=I.find("#"+crmCallsNew.fields.Call_Owner.displayNameEl).text()),k.data("id")&&(S=P.val(),C=k.val(),b=k.data("id")),Calls.updateDataInCards(e,E,y,w,A,h,T,S,b,C)}}}function getRelatedCounts(e,t){if(http){var a="module="+e+"&id="+t+"&action=getCount",i=Crm.getCrmBasePath()+"/RelatedEntity.do";http.open("POST",i,!0),http.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=UTF-8"),http.setRequestHeader("X-Requested-With","XMLHttpRequest"),http.onreadystatechange=function(){if(3==http.readyState){var e=http.responseText,a=Handlebars.templates.RelatedEntitiesCount,i=e.split("||");for(j=0;j<i.length;j++)if(i[j].length>0){var r=JSON.parse(i[j]),l=r.details[0].type,n=a(r);0==$("#cntContainerDiv"+t).length?$("#dvinner").prepend('<div class="container" id="cntContainerDiv'+t+'">'+n+"</div>"):0==$("div[id='relCount_"+l+"_"+t+"']").length&&$("#cntContainerDiv"+t).append(n)}}else if(4==http.readyState){if(0==$("#cntContainerDiv"+t).length){e=http.responseText,a=Handlebars.templates.RelatedEntitiesCount,i=e.split("||");for(j=0;j<i.length;j++)if(i[j].length>0){n=a(JSON.parse(i[j]));0==$("#cntContainerDiv"+t).length?$("#dvinner").prepend('<div class="container summarycontainer" id="cntContainerDiv'+t+'">'+n+"</div>"):$("#cntContainerDiv"+t).append(n)}}$("#cntContainerDiv"+t).append('<div class="clearB"></div><div id="relEntDetailsContainerDiv" class="newStyleAct pR"></div>')}},http.send(a)}return!1}function showHideSummaryCount(e,t){if(!Crm.userDetails.CLIENT_ACCOUNT){var a=Crm.getCrmBasePath()+"/EntityCustomization.do",i={action:"updateCustomization",key:"SHOW_COUNTS",value:e};i[csrfParamName]=encodeURIComponent(csrfToken),mR(a,(function(a){if("SUCCESS"===(a=JSON.parse(a)).STATUS){var i=e?I18n.getMsg("crm.hide.summary.count"):I18n.getMsg("crm.show.summary.count");$("#countSummary").text(i),sE(t),$("#countSummary").off("click"),$("#countSummary").on("click",(function(){showHideSummaryCount(!e)})),e?getRelatedCounts($("#module").val(),mapValuesVar.system_sales_entity_id):$("#cntContainerDiv"+mapValuesVar.system_sales_entity_id).remove()}}),i)}}function populateRLCount(e,t,a,i){var r=$("#lp_rellist").children("li"),l=e?$("#newleft_"+e):r;!l.length&&e&&(l=r);var n=l.length,s=0,o=document.querySelector("crm-child-campaigns");if(o)var d=o.getData("info");var c=$L("crm-webinar-poll-details")[0];if(c)var m=c.getData("pollDetails");var u=$L("crm-webinar-qanda-details")[0];if(u)var p=u.getData("questionRecords");var g,v=$L("crm-zsurvey-rl-label")[0];v&&(g=v.getData("rlCount"));$("#deskRelatedListMenu");var f="TASKSPERSONALITY CALLSPERSONALITY EVENTSPERSONALITY APPOINTMENTSPERSONALITY",h="TASKSHISTORYPERSONALITY CALLSHISTORYPERSONALITY EVENTSHISTORYPERSONALITY APPOINTMENTSHISTORYPERSONALITY",b=0,C=0,y=document.querySelector("#TASKSPERSONALITY_split"),I=document.querySelector("#CALLSPERSONALITY_split"),w=document.querySelector("#EVENTSPERSONALITY_split"),A=document.querySelector("#APPOINTMENTSPERSONALITY_split"),E=document.querySelector("#TASKSHISTORYPERSONALITY_split"),T=document.querySelector("#CALLSHISTORYPERSONALITY_split"),S=document.querySelector("#EVENTSHISTORYPERSONALITY_split"),L=document.querySelector("#APPOINTMENTSHISTORYPERSONALITY_split");if(null!=y||null!=I||null!=w||null!==A){var _=null!=y?y.component.data.info:void 0,O=null!=I?I.component.data.info:void 0,M=null!=w?w.component.data.info:void 0,P=null!=A?A.component.data.info:void 0;C=(null!=O?(O.page-1)*O.per_page+O.count:0)+(null!=_?(_.page-1)*_.per_page+_.count:0)+(null!=M?(M.page-1)*M.per_page+M.count:0)+(null!=P?(P.page-1)*P.per_page+P.count:0)}if(null!=E||null!=R||null!=S||null!==L){var k=null!=E?E.component.data.info:void 0,R=null!=T?T.component.data.info:void 0,D=null!=S?S.component.data.info:void 0,U=null!=L?L.component.data.info:void 0;b=(null!=R?(R.page-1)*R.per_page+R.count:0)+(null!=k?(k.page-1)*k.per_page+k.count:0)+(null!=D?(D.page-1)*D.per_page+D.count:0)+(null!=U?(U.page-1)*U.per_page+U.count:0)}for(;s<n;s++){var F=l.eq(s),x=F.attr("id").split("_")[1],N=$("div[ddid="+x+"]"),B=N.attr("ddname");if("SUPPORTPERSONALITY"!==B){var j=!("APPOINTMENTSPERSONALITY"===B&&(module&&"Services"===module.value||!Crm.isActivitySplitDone)),V=t?$("#customRelatedListDiv_"+x).find(".topband_dv_row").length:N.find(".topband_dv_row").length?N.find(".topband_dv_row").length:$("#"+x).find(".topband_dv_row").length;V=f.includes(B)&&j?C:V,V=h.includes(B)?b:V,V="CHILDCAMPAIGNSPERSONALITY"==B&&d&&null!=d.count?d.more_records?d.count+"+":d.count:V,V="WEBINAR_POLLS_PERSONALITY"==B&&m?m.length:V,V="WEBINAR_QUESTION_PERSONALITY"==B&&p?p.length:V;var H=document.querySelector('crm-related-list-view-header[related-module="Attachments"]');if(V="ATTACHMENTSPERSONALITY"===B&&H&&void 0!==H.getData("relatedListCount")?H.getData("relatedListCount"):V,a)V=N.find("#rellist_end_index").length?parseInt(N.find("#rellist_end_index").text()):F.find("span.numCountn").text().replace("+","")?parseInt(F.find("span.numCountn").text().replace("+",""))+V:V;else if(1==n&&"EMAILSPERSONALITY"===B){var z=F.find("span.numCountn").text().replace("+","");if(N.find("#rellist_end_index").length)V=parseInt(N.find("#rellist_end_index").text());else if(z){var G=z?parseInt(z):0;G>10&&(i||(V=G%10==0?G-V:G-G%10))}}if(f.includes(B)||h.includes(B)||0===V){if("CIRCUITSPERSONALITY"===B){F.find("span.addNewIcP").addClass("dN");continue}if(0===V&&"CIRCUITSPERSONALITY"!==B)$("#newleft_"+x).find(".numCountn").removeClass("numCountVal"),V="";else if(f.includes(B)||h.includes(B)){if(V>=10)V=f.includes(B)&&null!=_&&1==_.more_records||null!=O&&1==O.more_records||null!=M&&1==M.more_records||h.includes(B)&&(null!=k&&1==k.more_records||null!=R&&1==R.more_records||null!=D&&1==D.more_records)?V+"+":V}}else"ATTACHMENTSPERSONALITY"!==B&&V>=10&&0===N.find("#rellist_navig_next").find("img.next_disabled").length&&(V=V%10==0?V+"+":V);if("SURVEYPERSONALITY"==B&&"0"!==g&&($("#newleft_"+x).find("span.numCountn").addClass("numCountVal").text(g),V=g),"SUPPORTPERSONALITY"==B&&V>=7&&0===N.find("#rellist_navig_next").find("img.next_disabled").length&&(V=V%7==0?V+"+":V),""!=V?(F.find("span.numCountn").addClass("numCountVal").text(V),"EMAILSPERSONALITY"===B&&F.find("span.numCountn").addClass("plusVal"),"SOCIALPERSONALITY"!==B&&"ATTACHMENTSPERSONALITY"!==B&&$('#RelatedListCommonDiv[ddid="'+x+'"]').removeClass("noDataFountDetail")):F.find("span.numCountn").text(V).removeClass("numCountVal"),N.find(".dummyForLeftPanel").length||f.includes(B)){if(("ACTIVITYPERSONALITY"==B||"ATTACHMENTSPERSONALITY"==B)&&0==$("#options_"+x).length){var q=N.find("#ract_"+x).find(".dummyForLeftPanel").clone();0==q.length&&(q=N.find("#norec_"+x).find(".dummyForLeftPanel").clone());var J='<div id="options_'+x+'" class="eventActionsMenu nwrp" style="display:none;" data-options="'+B+'" onclick="sE(event)"></div>';F.closest("td").append(J),$("#options_"+x).append(q)}"SUPPORTPERSONALITY"!==B&&F.find("span.addNewIcP").removeClass("dN")}else"newleft_Notes"!==F.attr("id")&&F.find("span.addNewIcP").addClass("dN");var W=$L("crm-attachments lyte-menu-item");if("ATTACHMENTSPERSONALITY"==B&&W.length>0){F.find("crm-related-list-actions").remove(),F.find("span.addNewIcP").remove();var Y=store.peekRecord("related_list",x),Z=store.peekRecord(moduleRecordMapping[detailView.currentModule].id,entityId.value);Lyte.Component.render("crm-related-list-actions",{module:detailView.currentModule,relatedList:Y,record:Z,options:"left_pannel"},"#newleft_"+x)}}}if($("#TotalNotesCount").length&&(0==$("#TotalNotesCount").val()?$("#newleft_Notes").find("span.numCountn").text("").removeClass("numCountVal"):$("#newleft_Notes").find("span.numCountn").text($("#TotalNotesCount").val()).addClass("numCountVal")),"undefined"!=typeof businessCardJson&&(businessCardJson.customizePermission?businessCardJson.customRelatedListEnabled?$("#newleft_NewRL").addClass("dIB").removeClass("dN"):$("#newleft_NewRL").remove():($("#newleft_OrganizeRL").remove(),$("#newleft_NewRL").remove())),$("#lp_salesSummaryDiv").length&&SalesSummaryInfo&&loadSalesSummary(),detailView.bindScroll(),Crm.userDetails.detailView_newUI){$L("#RelatedListCommonDiv #RelatedListDataScroll,#newRelDetailsScroll,#RelatedListCommonDiv #ticketsDropDiv").scroll({preventVertical:!0});var Q=$L.debounce(detailView.detailViewRelatedListDataScrollHandler,1);$("#RelatedListCommonDiv .lyteScrollBar").off("scroll",Q).on("scroll",Q)}}function searchColumnList(e,t,a){var i,r=$("#"+e);i=$("#"+e+" li:visible");var l=$(".columnListBtn");if(13===(t.keyCode?t.keyCode:t.which)){var n=i[0];return null!=n&&crmListView.selectColumn(void 0,n),!1}if(!a){$("#"+e+" li").show(),$("#columnlistnomatch").hide(),l.show(),r.show();var s=r.parent().parent().parent()[0].id.split("_")[1];if(Crm.isActivitySplitDone&&!crmRelatedList.isNotActivitySubPersonality(s,"Services"===getObj("module").value||void 0)){var o=$("#relatedListCols_"+s),d=o.find("#customize_error"),c=o.width()-38;d.css("width",c+"px")}}a=a.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var m=new RegExp(a,"i");r.show(),$("#"+e+" li").each((function(){m.test($(this).text())?$(this).show():$(this).hide(),i=$("#"+e+" li:visible")})),i.length?($("* #columnlistnomatch").hide(),r.show(),l.show(),r.closest(".ps-container").scrollTo(i.eq(0))):(r.closest("#menuColumnListView").next("#columnlistnomatch").show(),r.hide(),l.hide())}function getAlertContent(e,t,a){var i=new Array,r="fromDetailsView"==e?new Array($("#id").val()):null!=customViewObject&&null!=customViewObject.isZBCustomModuleEnabled?customViewObject.selectedIds:i,l=null;"module"in window?l=module.value:null!=customViewObject?l=customViewObject.module:"zbCustomModuleObjForAccountContactDeletion"in window&&(l=zbCustomModuleObjForAccountContactDeletion.module),ZInvoice.fetchAssociatedIds(l,r,(function(e){if(e.length>0){var a;a=null==customViewObject||!(customViewObject.selectedIds.length>1);var i=null!=customViewObject&&null!=customViewObject.isZBCustomModuleEnabled?customViewObject.singularModName?customViewObject.singularModName:moduleRecordMapping[l].singular_label:zbCustomModuleObjForAccountContactDeletion.singularModuleName,r=null!=customViewObject&&null!=customViewObject.isZBCustomModuleEnabled?customViewObject.pluralModName?customViewObject.pluralModName:moduleRecordMapping[l].plural_label:zbCustomModuleObjForAccountContactDeletion.pluralModuleName,n=I18n.getMsg("crm.cannot.delete.account.contact.singular",i.toLowerCase()),s=I18n.getMsg("crm.cannot.delete.account.contact.plural",r.toLowerCase()),o=a?n:s;o=null==$("#id").val()||""==$("#id").val()?o:n;var d='<div onclick="sE()" class="w500 p20"><div class="floatL pL20 w430"><div class="f20"><h2 style="color:#E20000";>'+I18n.getMsg("crm.cannot.delete.account.contact.header",a?i:r)+'</h2></div><div class="mT10">'+o+'</div></div><br class="clearB"><div  class="alignright mT20"><input type="button" id="popupok" class="newgraybtn" value="'+I18n.getMsg("crm.button.ok")+"\" onclick=\"hide('popupnew');removeFreezeLayer();document.getElementById('popupnew').style.zIndex=30\"></div></div>";renderingUtils.popUpWithFreeze(d)}else{var c=isRelatedRecordsModule(customViewObject.module)?I18n.getMsg("crm.warning.related.modules",getAllRelatedChildModulesPluralLabel(customViewObject.module)):"";showDeletePopup(I18n.getMsg("crm.warning.move.to.trash"),"crm.button.delete","",c,t)}}))}function changeImageClass(){var e="";"undefined"!=typeof Storage&&(e="asc"===localStorage.orderby?"sort_asc":"desc"===localStorage.orderby?"sort_desc":""),$("#"+localStorage.sortby+"_img").addClass(e)}function siChangeVideoUrl(e,t){$(".selectedList").removeClass("selectedList"),$(e).addClass("selectedList"),$("#siQTVideo").attr("src",RebrandLinkUtil.getProperty(t))}function docsIntegCallBackFn(e){var t=$("#fileCheckVariable");if(Crm.userDetails.isNewEditor&&(t=$("#fileCheckVariable_"+EmailComposeUtil.CURRENT_TAB)),t.length>0&&("EntMail"==t.val()||"EntityMail"==t.val()||"EmailClient"==t.val()))EmailAttachmentsUtil.docsIntegCallBackFn(e);else if($("#multipleFieldsEditPop").is(":visible"))fileAttachSubmitIntercept("attachDocuments",e);else{if(!fileupload.fromFileUploadField){var a=document.getElementById("moduleForIFrame").value,i=document.getElementById("anchorId").value,r=document.getElementById("entityId").value;e=e+"&entityID="+r+"&module="+a+"&anchorId="+i+"&service=ZDocsLink&linkDocs=true"}var l="crmcsrfparam="+$("input[name='crmcsrfparam']").val(),n=!1;if(fileupload.fromFileUploadField){var s=$("#attachSize_"+fileupload.fieldID).val(),o=$("#attachCount_"+fileupload.fieldID).val();""==s&&(s=0),e=e+"&fromFileUploadField=true&fieldId="+fileupload.fieldID+"&module="+fileupload.module+"&service=ZDocsLink&linkDocs=true&attachedSize="+s+"&attachedCount="+o}"Events"==a&&document.getElementById("attachTotCnt")&&(n=!0,e+="&attachTotCnt="+document.getElementById("attachTotCnt").value);var d=Crm.getCrmBasePath()+"/docsSubmit.do?"+e;mR(d,(function(e){if(fileupload.fromFileUploadField){if("crm.FileuploadField.size.limitstmt"==e.trim())return void renderingUtils.showCustomAlert(I18n.getMsg("crm.FileuploadField.size.limitstmt"));if("crm.attachment.name.check"==e.trim())return void renderingUtils.showCustomAlert(I18n.getMsg("crm.attachment.name.check"));if("crm.attachment.fileUploadField.Maxcount.check"==e.trim())return void renderingUtils.showCustomAlert(I18n.getMsg("crm.attachment.fileUploadField.Maxcount.check"));if("crm.attachment.fileUploadField.Mincount.check"==e.trim())return void renderingUtils.showCustomAlert(I18n.getMsg("crm.attachment.fileUploadField.Mincount.check"));var t=JSON.parse(e),i=null,l=null,s=$L("#AjaxEditComponent");if($(".zc_fileup_alert").addClass("dNImp"),"crm.FileuploadField.size.limitstmt"==t.message){i=t.columnname,l=t.module;var o=(c=$("#Crm_"+l+"_"+i)).data();if(removeFreezeLayer(),"crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route&&s.length>0){var d=I18n.getMsg("crm.FileuploadField.size.limitstmt",$ESAPI.encoder().encodeForHTML(o.displaylabel));c[0].innerText=d,c.removeClass("dNImp")}else Crm.showErrorMsg(parent.I18n.getMsg("crm.FileuploadField.size.limitstmt",$ESAPI.encoder().encodeForHTML(o.displaylabel)),c,l);return!1}if("crm.attachment.fileUploadField.Maxcount.check"==t.message){i=t.columnname,l=t.module;o=(c=$("#Crm_"+l+"_"+i)).data();if(removeFreezeLayer(),"crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route&&s.length>0){d=I18n.getMsg("crm.attachment.fileUploadField.Maxcount.check",$ESAPI.encoder().encodeForHTML(o.displaylabel));c[0].innerText=d,c.removeClass("dNImp")}else Crm.showErrorMsg(parent.I18n.getMsg("crm.attachment.fileUploadField.Maxcount.check",$ESAPI.encoder().encodeForHTML(o.displaylabel)),c,l);return!1}if("crm.attachment.fileUploadField.Mincount.check"==t.message){i=t.columnname,l=t.module;var c;o=(c=$("#Crm_"+l+"_"+i)).data();if(removeFreezeLayer(),"crm.tab.module.entity.canvas"===Lyte.Router.getRouteInstance().transition.info.route&&s.length>0){d=I18n.getMsg("crm.attachment.fileUploadField.Mincount.check",$ESAPI.encoder().encodeForHTML(o.displaylabel));c[0].innerText=d,c.removeClass("dNImp")}else Crm.showErrorMsg(parent.I18n.getMsg("crm.attachment.fileUploadField.Mincount.check",$ESAPI.encoder().encodeForHTML(o.displaylabel)),c,l);return!1}t.fromFileUpload.length&&(fileupload.createAttachElement(t),removeFreezeLayer())}else{if("crm.attachment.size.check"==e.trim())return void renderingUtils.showCustomAlert(I18n.getMsg("crm.attachment.size.exceed.limit"));if("crm.attachment.name.check"==e.trim())return void renderingUtils.showCustomAlert(I18n.getMsg("crm.attachment.name.check"));if(n)return void(document.querySelector('crm-related-list-view-header[related-module="Attachments"]')?(Lyte.triggerEvent("relatedList",{module:"Attachments"}),refreshFollowDiv()):$("#AttachmentFrame").html(e));doAjaxUpdate("relatedPageContent",Crm.getCrmBasePath()+"/NewRelatedList.do?id="+r+"&module="+a+"&action=getAllData")}ZDDialog.closePopUp("linkdocsdialogdiv"),fileupload.fromFileUploadField=!1}),l)}}function backToSearchResult(){var e=searchResultObj.searchResponse;$("#show").empty(),getObj("show").innerHTML=e,hide("zohobusy_loadpage_search"),isWorking=!1,enableSkype()}function mailsetCenterNew(e,t){var a=$("#"+e),i=$(window).width()/2-a.outerWidth()/2;a.css({top:0,left:i}).show(),t&&$("#qCreateOuter").css({top:"80px",left:i}).show()}function fileAttachSubmitIntercept(e,t){var a,i=$("#multipleFieldsEditPop"),r=$L("#attachmentBlueprint")[0],l=$L("crm-detail-view-blueprint-action")[0],n=i.is(":visible")?"bluePrint":"general";if(r&&(n="bluePrint"),"general"===n)return"proceed";if("bluePrint"===n&&"undefined"!=typeof ProcessFlow){var s=$("#transitionAttachDiv .labelValCreate");switch(e){case"fileUpload":if(hideAnimatePopup("attachPopup"),showFreezeLayer(),r)return l.component.attachmentInterceptor(e,t),"skipSave";validatePreview(e,s,t),$("#freezeBackGround").addClass("hide"),commonUtils.showHideLoadingDiv(!1);break;case"attachLink":a=$("#attachmentUrl").val();var o={action:"getFileName"};o.attachmentUrl=a,o.entityId=r?l.getData("record").id:ProcessFlow.ExcecutionObjs.entityId,o.module=$("#multipleFieldEditModule").val(),o.feature=n;var d=new crmRequestPool;commonUtils.showHideLoadingDiv(!0),d.initiate({type:"GET",action:Crm.getCrmBasePath()+"/fileattach.do",data:o,async:!1,success:function(t){if("failure"===t.status)"LinkExists"===t.reason&&crmui.showMsgBand("error",I18n.getMsg("crm.attach.link.exists"),"2500");else{if(r)return l.component.attachmentInterceptor(e,a,t),"skipSave";t.fileName=t.fileName.replace(/\+/g,"%20");var i=decodeURIComponent(t.fileName);if($("#attachmentList-"+e+' li>a:contains("'+i+'")').length>0)crmui.showMsgBand("error",I18n.getMsg("crm.attach.link.exists"),"2500");else{var n=$("<div>",{id:"attachmentList-"+e,type:e}),o=ProcessFlow.getFileNamesHtmlForTransPop({names:[i],ids:[a]},e);if(o)if(n.html(o),"true"===s.attr("isAttachmentAdded")){var d=$("#attachmentList-"+e);d.length>0?d.append(o):s.append(n)}else{var c=$(s.html());c.addClass("attachmentsLabel blueprintAttachment"),c.css("margin","7px"),s.removeClass("attachmentsLabel"),s.html(n),s.parent().after().append($("<div>").append(c).html()),s.attr("isAttachmentAdded","true"),BlueprintAttachment.appendClickEventForDropdown()}hideAnimatePopup("topBandPopup"),$("#freezeBackGround").addClass("hide")}}commonUtils.showHideLoadingDiv(!1)}});break;case"attachDocuments":if(r)return l.component.attachmentInterceptor(e,t),"skipSave";validatePreview(e,s,t);break;case"attachZDocs":case"attachGDocs":validateDocAttachment(e,s,t);break;case"attachFromTeamDrive":validatePreview(e,s,t)}return"skipSave"}return"proceed"}function validateDocAttachment(e,t,a){var i,r,l=$("#multipleFieldEditModule").val(),n=$("#multipleFieldEditEntityId").val(),s=$("#attachdialogdiv"),o=document;"attachGDocs"===e?(o=document.getElementById("zohodocsframe").contentDocument,(i=$(o.getElementsByName("submitForm")[0])).append($("<input>").attr("type","hidden").attr("name","fromGoogleDocs").val("fromGoogleDocs"))):(i=$(document.getElementsByName("submitForm")[0])).append($("<input>").attr("type","hidden").attr("name","crmcsrfparam").val(csrfToken));i.append($("#anchorId").clone()),r=i.serializeArray(),o.submitForm.action=Crm.getCrmBasePath()+"/docsSubmit.do?entityID="+n+"&module="+l+"&fromSrc=blueprint";var d=o.submitForm.action;commonUtils.showHideLoadingDiv(!0),(new crmRequestPool).initiate({type:"POST",url:d,data:r,dataType:"text",success:function(i,r,l){return commonUtils.showHideLoadingDiv(),null==l&&(l={requestUrl:d}),"crm.attachment.size.check"==i.trim()?(renderingUtils.showCustomAlert(I18n.getMsg("crm.attachment.size.exceed.limit","")),void removeFreezeLayer()):"crm.attachment.name.check"==i.trim()?(renderingUtils.showCustomAlert(I18n.getMsg("crm.attachment.name.check"),""),void removeFreezeLayer()):(validatePreview(e,t,a),s.css("display","none"),s.empty(),void(s.innerHTML=""))},error:function(e){if(e.status===crmConstants.limitExceedsCode)return Search.displayLookupExceedsMsg(e),commonUtils.showHideLoadingDiv(),!1;400===e.status&&"CRITERIA_LIMIT_EXCEEDED"===e.responseText&&renderingUtils.showCustomAlert(I18n.getMsg("crm.criteria.limit.error",Search.MAX_CRT_CNT)),commonUtils.showHideLoadingDiv()}}),i.remove()}function validatePreview(e,t,a){$("<div>",{id:"attachmentList-"+e,type:e});var i=ProcessFlow.getFileNames(e,a);if("attachFromTeamDrive"!==e){var r={};r.fileDetails=JSON.stringify(i),r.attachType=e,r.moduleId=$("#multipleFieldEditEntityId").val(),r.featureName="blueprint",r.action="getFileDetails",networkUtils.setCsrfParam(r);var l={};l.params=r,networkUtils.lyteInitiateRequest(ProcessFlow.PROCESS_URL,"POST",l).then((function(r){var l=JSON.parse(r);if(i.isPreviewAvailable=l.isPreviewAvailable,"attachZDocs"===e||"attachGDocs"===e&&void 0!==l.fileNames){var n=JSON.stringify(l.fileNames);n=n.replace(/\+/g,"%20"),n=decodeURIComponent(n),i.names=JSON.parse(n)}(appendAttachDivContent(i,t,e),"fileUpload"===e)&&$("#multipleFieldsEditPop").data("attachUploaderObj",a);"attachGDocs"===e&&$("#freezeBackGround_gdocs").remove()}))}else appendAttachDivContent(i,t,e)}function appendAttachDivContent(e,t,a){var i=$("<div>",{id:"attachmentList-"+a,type:a}),r=ProcessFlow.getFileNamesHtmlForTransPop(e,a);if(r)if(i.html(r),"true"===t.attr("isAttachmentAdded")){var l=$("#attachmentList-"+a);l.length>0?l.append(r):t.append(i)}else{var n=$(t.html());n.addClass("attachmentsLabel blueprintAttachment"),n.css("margin","7px"),t.removeClass("attachmentsLabel"),t.html(i),t.parent().after().append($("<div>").append(n).html()),t.attr("isAttachmentAdded","true"),BlueprintAttachment.appendClickEventForDropdown();var s=$(".blueprintAttachment .atch-dropdown"),o=s.attr("onclick");o=void 0!==o&&o.length>0&&";"!==o[o.length-1]?o.concat(";BlueprintAttachment.removeContextMenu()"):o.concat("BlueprintAttachment.removeContextMenu()"),s.attr("onclick",o)}}function getAttachmentModule(e){return"bluePrint"===e&&"undefined"!=typeof ProcessFlow?ProcessFlow.ExcecutionObjs.module:"canvas"==Lyte.Router.getRouteInstance().routeName?$L("#module")[0].value:document.viewentityform.module.value}function getAttachmentEntityId(e){return"bluePrint"===e&&"undefined"!=typeof ProcessFlow?ProcessFlow.ExcecutionObjs.entityId:"canvas"==Lyte.Router.getRouteInstance().routeName?$L("#id")[0].value:document.viewentityform.id.value}function getAttachmentCvid(e){return"bluePrint"===e?null:"canvas"==Lyte.Router.getRouteInstance().routeName?$L("#id")[0].value:document.viewentityform.id.value}function showDependentFieldsForEdit(e,t){t&&e&&(pipelineDropdown=$("#fieldValue1"),pipelineDropdown.attr("data-depFields",e),pipelineDropdown.trigger("change"))}function deleteMultipleMailsViaAPI(){var e=$("#id"),t=e.length>0?e.val():getOpenerObj("id").value,a=$("#module").val(),i=Crm.moduleInfo[a].apiname;"Deals"==i&&module;var r="/crm/v2.1/"+i+"/"+t+"/Emails?message_ids=",l=$("#mailsToDelete").val();r+=l.substring(0,l.length);var n={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken};(new crmRequestPool).initiate({type:"DELETE",url:r,headers:n,success:function(e){var t=e.email_related_list;hideAnimatePopup("removepopup"),hideAnimatePopup("deletepopup");for(var a="",i=t.length,r=0;r<i;r++)if("error"==t[r].status){a=t[r].code;break}if(""!=a)return commonUtils.showHideLoadingDiv(),void("INVALID_DATA"==a?renderingUtils.displayPermissionDenied(void 0,void 0,I18n.getMsg("crm.email.message.invalid.data")):renderingUtils.displayPermissionDenied(void 0));var n=$("#draftMails");if(n.hasClass("selectTab")){if(crmui.showMsgBand("success",I18n.getMsg("crm.drafts.deleted.successfully"),"5000"),n.hasClass("selectTab")){var s=$("#maxComposeBtn");s&&!s.hasClass("hide")&&l.substring(0,l.length).includes($("#enc_msgId").val())&&s.addClass("hide");var o=l.split(","),d=o.length;for(r=0;r<d;r++){var c=EmailComposeUtil.getTabIdContainingGivenDraft(o[r]);c&&EmailUtil.closeEmailTab(c,!0)}}}else crmui.showMsgBand("success",I18n.getMsg("crm.emails.deleted.successfully"),"5000");showMailsListViaAPI("","-10","next"),$(".rLESelectAction").css("display","none"),$(".rLETabsElement").css("display","block"),$('lyte-checkbox[lt-prop-name="ernHead"]').removeClass("eRListPartialSelect"),$("#mailsToDelete").val(""),$("#mailsSub").text("")},error:function(e){commonUtils.showHideLoadingDiv();for(var t="",a=null!=e.email_related_list?e.email_related_list:e,i=a.length,r=0;r<i;r++)if("error"==a[r].status){t=a[r].code;break}"INVALID_DATA"==t?renderingUtils.displayPermissionDenied(void 0,void 0,I18n.getMsg("crm.email.message.invalid.data")):renderingUtils.displayPermissionDenied(void 0)}})}validation.showZiaForCNSView=function(e,t){if(!$L(".etTrendsWrapperCNS").length){var a={entityId:t.response.entityId,module:t.response.module};Lyte.Component.render("crm-ziaforcns",{data:a},"#cns")}closeUnneccessaryPopup();var i=document.getElementById("emailDetailIframeContent");null!==i&&i.parentNode.removeChild(i);var r=$("#mainDiv"),l=$(document.createElement("iframe")),n="";Crm.frameOriginZiaForEmails&&(n="?"+Crm.frameOriginZiaForEmails),l.attr({id:"emailDetailIframeContent",style:"opacity:1; padding: 20px 30px; box-sizing: border-box;width:100%; height: calc( 100% - 60px);clear: both; border: medium none",src:"/crm/html/content1.html"+n}),r.append(l);var s=$("#emailDetailIframeContent");s.parent().css("z-index",28),s.load((function(){setTimeout((function(){s.parent().css("z-index",28),document.getElementById("emailDetailIframeContent").contentWindow.document.write(e)}))})),freezeBackground()},validation.showZiaForEmailsView=function(e,t,a){if($L(".etTrendsWrapper").length){var i=$L("crm-ziaforemails")[0].component;(r=getOnclickAttr(t)).notificationId=a,i.setData("onclickAttr",r)}else{var r;(r=getOnclickAttr(t)).notificationId=a,Lyte.Component.render("crm-ziaforemails",{onclickAttr:r},"#ziaForEmails")}var l=$("#lookupdiv");l.html(""),l.css({display:"none"}),removeFreezeLayer(),$("#qCreate").html(""),$("#eventCreatePopup").html(""),$L("#createEditCallDiv").css("display","none"),$("#diNotificationDetails").css({right:"-900px",display:"none"}),$("#diNotificationDetailsContent").empty();var n=document.getElementById("emailDetailIframeContent");null!==n&&n.parentNode.removeChild(n);var s=$("#ziaForEmailsDiv"),o=$(document.createElement("iframe")),d="";Crm.frameOriginZiaForEmails&&(d="?"+Crm.frameOriginZiaForEmails),o.attr({id:"emailDetailIframeContent",style:"opacity:1; padding: 20px 30px; box-sizing: border-box;width:100%; height: calc( 100% - 60px);clear: both; border: medium none",src:"/crm/html/content1.html"+d}),s.append(o);var c=$("#emailDetailIframeContent");c.parent().css("z-index",28),c.load((function(){setTimeout((function(){(c.parent().css("z-index",28),document.getElementById("emailDetailIframeContent").contentWindow.document.write(e),$L(".etTrendsWrapper").length)&&("true"===$L("crm-ziaforemails")[0].component.getData("onclickAttr").isActivityCreated?$L(".ziaForEventButton").attr("lt-prop-title",I18n.getMsg("crm.label.zia.ziaforemail.event.alreadycreated")):$L(".ziaForEventButton").removeAttr("lt-prop-title"))}))})),freezeBackground()},validation.updateEventCreatedInfo=function(){var e=$L("crm-ziaforemails")[0].component.getData("onclickAttr"),t={action:"getAndUpdate",id:e.notificationId},a=new crmRequestPool;t[csrfParamName]=csrfToken,a.initiate({type:"POST",data:t,action:Crm.getCrmBasePath()+"/crminotification.do",success:function(t){"success"===t.status&&($L(".ziaForEventButton").attr("lt-prop-title",I18n.getMsg("crm.label.zia.ziaforemail.event.alreadycreated")),Lyte.objectUtils(e,"add","isActivityCreated","true"))},error:function(e){crmui.showMsgBand("info",I18n.getMsg(e),2e3,"top")}})};