Lyte.Mixin.register("crm-zdesk-rl-utils",{ticketActionDisplay:function(){$L("#selectedTicketCount").text(deskInteg.getSelectedRowCount()),0==deskInteg.getSelectedRowCount()?($L(".ticket_noselect").show(),$L(".ticket_select").hide()):($L(".ticket_noselect").hide(),$L(".ticket_select").show())},getCurrentTicketPage:function(){var t=document.querySelector("crm-zdeskbody-rl").component.data.pageNum,e=parseInt(t);return isNaN(e)?0:e},changeIframeTicket:function(t){var e=t.encryptedId,a=t.departmentId,i=deskInteg.getUrlForTicketDetailView(e,a);this.setData("iframeURL",i),deskInteg.setDetailTicketId(t.id),Crm.trackSpotLightAction("ZDesk - Ticket Detail View")}}),store.registerModel("zdesk_rl",{name:Lyte.attr("string",{primaryKey:!0}),ACTIONS:Lyte.attr("array"),heading:Lyte.attr("array"),body:Lyte.attr("array"),customButton:Lyte.attr("boolean"),filtersAvailable:Lyte.attr("boolean"),fromIndex:Lyte.attr("number"),isCustLookUp:Lyte.attr("boolean"),isCustomModule:Lyte.attr("boolean"),isCustomRel:Lyte.attr("boolean"),isShowColumns:Lyte.attr("boolean"),isStandardLookup:Lyte.attr("boolean"),label:Lyte.attr("string"),listRelationId:Lyte.attr("string"),module:Lyte.attr("string"),sortOrderString:Lyte.attr("string"),toIndex:Lyte.attr("number")}),store.registerAdapter("zdesk_rl",{namespace:"crm",buildURL:function(t,e,a,i,o){return o.replace("zdesk_rl","NewRelatedList.do")}}),store.registerSerializer("zdesk_rl",{normalizeResponse:function(t,e,a){var i=document.getElementsByTagName("crm-zdesk-rl-body")[0].component,o=i.getData("related_list_id"),s=i.getData("module"),n={};return n.zdesk_rl=a[s][o],n},payloadKey:function(t){return t}}),store.registerModel("zdesk_integ_rl",{portalName:Lyte.attr("string",{primaryKey:!0})}),store.registerAdapter("zdesk_integ_rl",{namespace:"crm",buildURL:function(t,e,a,i,o){return o.replace("zdesk_integ_rl","deskIntegration.do")}}),store.registerSerializer("zdesk_integ_rl",{normalizeResponse:function(t,e,a){var i={};return i.zdesk_integ_rl=a,i},payloadKey:function(t){return t}}),Lyte.Component.register("crm-zdesk-rl-body",{_template:'<template tag-name="crm-zdesk-rl-body"> <div id="deskIntegDiv"> <template is="if" value="{{deskError}}"><template case="true"> <lyte-table width="100%" cellspacing="0" cellpadding="0" class="norec pR30 italic fontsmooth"> <lyte-table-structure> <lyte-tbody> <lyte-tr> <lyte-td valign="top" id="supportDiv"> <div class="pR30 italic fontsmooth">{{getI18n(\'deskErrorMessage\')}}</div> </lyte-td> </lyte-tr> </lyte-tbody> </lyte-table-structure> </lyte-table> </template><template case="false"> <template is="if" value="{{showIframeUrl}}"><template case="true"> <crm-zdesk-iframe iframeurl="{{iframeURL}}" show="{{lbind(iframeshow)}}"></crm-zdesk-iframe> </template></template> <lyte-modal id="deskTicketCreationIframe" lt-prop-height="620px" lt-prop-show="{{lbind(ticketcreationshow)}}" lt-prop-show-close-button="false" lt-prop-width="1250px"> <template is="registerYield" yield-name="modal"> <lyte-modal-content class="p0" style="max-height: 620px"> <div class="fR deskIframeCloseCont pA"> <div class="svgIcons ico-close-small2 cP mL6 mR5 mT5 dIB" onclick="{{action(\'hideCreateTicketPopup\')}}"> </div> </div> <div class="cB"></div> <span id="loadMsg"> </span> <iframe onload="{{action(\'setStyle\')}}" class="oA" id="createTicketIframe" frameborder="0" src="{{ticketcreationurl}}" style="width: 1250px; height: 590px;overflow:visible"> </iframe> </lyte-modal-content> </template> </lyte-modal> <div class="{{if(deskRelatedListMenuShow,\'mB10\',\'dN\')}}" id="deskRelatedListMenu"> <div class="{{if(deskTicketsSummaryShow,\'mB20\',\'\')}}"> <div id="deskTicketsSummary" class="{{if(deskTicketsSummaryShow,\'p20 pL0 deskStatsSummary pR\',\'dN\')}}"> <lyte-table lt-prop-yield="true" class="w100per deskRelStatTable" cellpadding="0" cellspacing="0"> <lyte-table-structure> <lyte-tbody> <lyte-tr> <lyte-td class="statTd"> <p class="statDesc">{{getI18n(\'crm.zdesk.stats.overall\')}}</p> <p id="totalTickets" class="statVal">{{totalTickets}}</p> </lyte-td> <lyte-td class="statTd"> <p class="statDesc">{{getI18n(\'crm.zdesk.stats.overdue\')}}</p> <p id="overdueTickets" class="statVal">{{overdueTickets}}</p> </lyte-td> <lyte-td class="statTd"> <p class="statDesc">{{getI18n(\'crm.zdesk.stats.response\')}}</p> <p id="avgResTime" class="statVal dIB" lt-prop-title="{{getI18n(\'crm.zdesk.stats.msg\')}}" lt-prop-tooltip-class="zDeskIntegToolTip"> <span class="dIB">{{avgResTimeSpan}}</span><span class="statSubtleText mL5">{{getI18n(\'crm.workflow.scheduler.hours\')}}</span> </p> </lyte-td> <lyte-td class="statTd"> <p class="statDesc">{{getI18n(\'crm.zdesk.stats.resolution\')}}</p> <p id="avgSolTime" class="statVal dIB" lt-prop-title="{{getI18n(\'crm.zdesk.stats.msg\')}}" lt-prop-tooltip-class="zDeskIntegToolTip"> <span class="dIB">{{avgSolTimeSpan}}</span><span class="statSubtleText mL5">{{getI18n(\'crm.workflow.scheduler.hours\')}}</span> </p> </lyte-td> <lyte-td class="statTd"> <p class="statDesc">{{getI18n(\'crm.zdesk.stats.happiness\')}}</p> <p class="statVal"> <span id="cusHapRate" class="{{if(cusHapRateShow,\'vam\',\'dN\')}}">{{cusHapRateValue}}</span> <span id="happiness_smiley" class="{{Smileytype}}"></span> <span id="no_happinessrating" class="{{if(noHapShow,\'color_9 f14\',\'dN\')}}">{{getI18n(\'crm.zdesk.noratings\')}}</span> </p> </lyte-td> </lyte-tr> </lyte-tbody> </lyte-table-structure> </lyte-table> </div> </div> <div class="pT5 fL"> <div class="{{if(ticketSelectShow,\'dIB ticket_select\',\'dN\')}}" id="selectedTicketInfo"> <div class="dIB"> <span id="selectedTicketCount" class="bold f13">{{selectedRowCount}}</span> <span class="color_7 f13">{{getI18n(\'crm.zdesk.ticketselect\')}}</span> </div> <span class="cP mL10 f12 deskhyperlink linkCol" onclick="{{action(\'clearSelect\',)}}">{{getI18n(\'crm.zdesk.clear\')}}</span> </div> <div class="{{if(deskTicketFilterShow,\'newSelect ticket_noselect\',\'dN\')}}" id="deskTicketFilter"> <lyte-dropdown id="ticketFilterSelect" data-zcqa="desk_ticketfilter" on-option-selected="{{method(\'getDeskTickets\',0,undefined,undefined,undefined,true)}}"> <template is="registerYield" yield-name="yield"> <lyte-drop-box> <lyte-drop-body> <lyte-drop-item data-value="All">{{getI18n(\'crm.zdesk.allticket\')}}</lyte-drop-item> <template is="if" value="{{supportObj.potentialModule}}"><template case="true"> <lyte-drop-item data-value="Potentials">{{getI18n(\'crm.zdesk.potentialticket\',supportObj.potentialSingular)}} </lyte-drop-item> </template></template> <template is="for" items="{{supportObj.ticketTypes}}" item="itemc" index="indexc"> <lyte-drop-item data-value="{{itemc.value}}">{{getI18n(\'crm.zdesk.potentialticket\',itemc.value)}}</lyte-drop-item> </template> <lyte-drop-item data-value="Overdue">{{getI18n(\'crm.zdesk.overdueticket\')}}</lyte-drop-item> <lyte-drop-item data-value="High">{{getI18n(\'crm.zdesk.highticket\')}}</lyte-drop-item> </lyte-drop-body> </lyte-drop-box> </template> </lyte-dropdown> </div> <div id="ticketOperations" class="{{if(ticketSelectShow,\'dIB mL20 ticket_select\',\'dN\')}}"> <template is="if" value="{{portalUser}}"><template case="true"> <lyte-button lt-prop-class="newwhitebtn" class=" dIB" lt-prop-id="tktFldUpdBtn" data-zcqa="desk_updateticket" onclick="{{action(\'showTktFldUpdPop\',ticketHeadings)}}" lt-prop-value="{{getI18n(\'crm.zdesk.updatefield\')}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.zdesk.updatefield\')}} </template> </lyte-button> <lyte-button lt-prop-class="newwhitebtn" class="dIB" lt-prop-id="ticketCloseBtn" data-zcqa="desk_closeticket" onclick="{{action(\'updateFields\',\'status\',\'Closed\')}}" lt-prop-value="{{getI18n(\'crm.button.close\')}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.close\')}} </template> </lyte-button> </template><template case="false"> <div class="dIB ticketDisabledButton" onmouseenter="{{action(\'showToolTip\',getI18n(\'crm.zdesk.user.needportal.brandchange\',getIntegrationName(\'ZOHO_DESK\')),\'false\',\'left\')}}" onmouseleave="{{action(\'hideSubjectTooltip\')}}"> <lyte-button lt-prop-class="newwhitebtn" class="dIB eventNone" lt-prop-id="tktFldUpdBtn" lt-prop-value="{{getI18n(\'crm.zdesk.updatefield\')}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.zdesk.updatefield\')}} </template> </lyte-button> <lyte-button lt-prop-class="newwhitebtn" class="dIB eventNone" lt-prop-id="ticketCloseBtn" lt-prop-value="{{getI18n(\'crm.button.close\')}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.close\')}} </template> </lyte-button> </div> </template></template> <template is="if" value="{{supportObj.potentialModule}}"><template case="true"> <lyte-button lt-prop-class="{{if(linkToThisPotentialShow,\'newwhitebtn\',\'dN\')}}" lt-prop-id="linkToThisPotential" data-zcqa="desk_linkthispotential" onclick="{{action(\'linkToPotential\')}}" lt-prop-value="{{getI18n(\'crm.zdesk.thispotential\',supportObj.potentialSingular)}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.zdesk.thispotential\',supportObj.potentialSingular)}} </template> </lyte-button> </template><template case="false"> <template is="if" value="{{supportObj.showPotential}}"><template case="true"> <lyte-button lt-prop-class="newwhitebtn" class=" dIB" lt-prop-id="linkToPotential" data-zcqa="desk_linkpotential" onclick="{{action(\'populatePotentialPopup\')}}" lt-prop-value="{{getI18n(\'crm.zdesk.linkpotential\',supportObj.potentialLabel)}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.zdesk.linkpotential\',supportObj.potentialLabel)}} </template> </lyte-button> </template></template> </template></template> <template is="if" value="{{supportObj.showPotential}}"><template case="true"> <div class="dIB"> <div class="pR"> <span class="newbutton mL5 newwhitebtn moredot_h2_35 moredotparentBtn" onclick="{{action(\'showPortalEvent\',event,this)}}"></span> <div class="ddM mL5" data-close="true" style="top: 35px; z-index: 10; display: none;"> <ul> <li> <template is="if" value="{{supportObj.portalUser}}"><template case="true"> <span class="dIB deskhyperlink" id="tktDelBtn" data-zcqa="desk_deleteticket" onclick="{{action(\'showAnimatePopup\',\'deleteDeskTicketConfirmation\')}}">{{getI18n(\'crm.button.delete\')}}</span> </template><template case="false"> <div class="dIB ticketDisabledButton" onmouseenter="{{action(\'showToolTip\',getI18n(\'crm.zdesk.user.needportal.brandchange\',getIntegrationName(\'ZOHO_DESK\')),\'false\',\'center\')}}" onmouseleave="{{action(\'wftoolTipHide\')}}"> <span class="dIB eventNone deskhyperlink" id="tktDelBtn">{{getI18n(\'crm.button.delete\')}}</span> </div> </template></template> </li> <li> <span class="dIB deskhyperlink" id="linkToPotential" data-zcqa="desk_unlink" onclick="{{action(\'unlinkTickets\')}}">{{getI18n(\'crm.zdesk.unlink\',supportObj.potentialLabel)}}</span> </li> </ul> </div> </div> </div> </template><template case="false"> <template is="if" value="{{portalUser}}"><template case="true"> <lyte-button lt-prop-id="tktDelBtn" lt-prop-data-zcqa="desk_ticketdelete" onclick="{{action(\'showAnimatePopup\',\'deleteDeskTicketConfirmation\')}}" lt-prop-value="{{getI18n(\'crm.button.delete\')}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.delete\')}} </template> </lyte-button> </template><template case="false"> <div class="dIB ticketDisabledButton" onmouseenter="{{action(\'showToolTip\',getI18n(\'crm.zdesk.user.needportal.brandchange\',getIntegrationName(\'ZOHO_DESK\')),\'false\',\'left\')}}" onmouseleave="{{action(\'hideSubjectTooltip\')}}"> <lyte-button lt-prop-id="tktDelBtn" lt-prop-value="{{getI18n(\'crm.button.delete\')}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.delete\')}} </template> </lyte-button> </div> </template></template> </template></template> </div> </div> <div class="fR pR pT5"> <template is="if" value="{{ticketStats}}"><template case="true"> <span id="ticketStatLink" data-zcqa="desk_togglestats" class="{{if(ticketsStatsLinkShow,\'cP dIB vam ticket_noselect showHideStatLink deskhyperlink linkCol\',\'dNImp\')}}" onclick="{{action(\'toggleStats\')}}"> {{ticketStatsLinkText}} </span> </template></template> <template is="if" value="{{portalUser}}"><template case="true"> <span id="newTicketLink" data-zcqa="desk_createticket" class="{{if(newticketlinkshow,\'cP dIB vam ticket_noselect createlink crm-rl-write-action deskhyperlink linkCol\',\'dNImp\')}}" onclick="{{action(\'showCreateTicketPopup\')}}"> {{getI18n(\'crm.zdesk.newticket\')}}</span> </template></template> <template is="if" value="{{expHandlers(expHandlers(loadCruxColumn,\'&amp;&amp;\',expHandlers(data.length,\'>\',0)),\'||\',cruxcolumShowfromfilter)}}"><template case="true"> <div id="showColumn" class="{{if(showColumnShow,\'newRlEdit dIB vam ticket_noselect\',\'dN\')}}" data-zcqa="desk_colchange" style="visibility: visible;" onclick="{{action(\'cruxcolumnshow\',this)}}"></div> <lyte-popover lt-prop-origin-elem="#showColumn" id="chooseColumnsFilterDD" lt-prop-type="box" lt-prop-freeze="false" lt-prop-content-padding="0px" lt-prop-show="{{showCruxColumn}}" lt-prop-scrollable="true" lt-prop-close-on-escape="false" lt-prop-draggable="false" lt-prop-show-close-button="false"> <template is="registerYield" yield-name="popover"> <lyte-popover-content> <crux-column-list cx-prop-data-bind="lyteFastRender" cx-prop-fields="{{allFields}}" cx-prop-selected-fields="{{selectedFields}}" cx-prop-mandatory="mandatory" on-before-unchecked="{{method(&quot;uncheckMandatory&quot;)}}" on-before-drop-item="{{method(&quot;unSortMandatory&quot;)}}" style="position:relative"></crux-column-list> </lyte-popover-content> <lyte-popover-footer> <lyte-button data-zcqa="columnFilterSaveButton" lt-prop-appearance="primary" onclick="{{action(\'saveColModify\')}}" class="header-btn"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.save\')}} </template> </lyte-button> <lyte-button data-zcqa="columnFilterCancelButton" onclick="{{action(\'cancelChooseColumns\')}}" class="header-btn"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.button.cancel\')}} </template> </lyte-button> </lyte-popover-footer> </template> </lyte-popover> </template></template> </div> <div class="cB"></div> </div> <lyte-modal id="deleteDeskTicketConfirmation" lt-prop-show="false" lt-prop-width="700px" lt-prop-show-close-button="false" lt-prop-close-on-escape="false" lt-prop-wrapper-class="deskIntegmodal"> <template is="registerYield" yield-name="modal"> <lyte-modal-content> <form class="dIB"> <div class="popup-model-content noBoxShadow fontsmooth"> <div class="color_3"> <div class="crm-font-regular f18 content aligncenter">{{getI18n(\'crm.zdesk.delete.ticket\')}}</div> </div> <div class="aligncenter mT25"> <lyte-button class="mR8" lt-prop-appearance="failure" data-zcqa="desk_deleleticketconfirm" lt-prop-value="{{getI18n(\'crm.label.delete\')}}" onclick="{{action(\'deleteTickets\')}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.label.delete\')}} </template> </lyte-button> <lyte-button lt-prop-name="cancel" lt-prop-value="{{getI18n(\'crm.label.no\')}}" onclick="{{action(\'hideAnimatePopup\',\'deleteDeskTicketConfirmation\')}}"> <template is="registerYield" yield-name="text"> {{getI18n(\'crm.label.no\')}} </template> </lyte-button> </div> </div> </form> </lyte-modal-content> </template> </lyte-modal> <lyte-modal id="tktFldPop" lt-prop-show="{{lbind(ticketFieldUpdatePopupShow)}}" lt-prop-width="600px" lt-prop-show-close-button="false" lt-prop-close-on-escape="false" lt-prop-wrapper-class="deskIntegmodal"> <template is="registerYield" yield-name="modal"> <lyte-modal-content> <p class="tktFldPopHead crm-font-bold">{{getI18n(\'crm.label.updateField\')}}</p> <div class="pLR30"> <div class="tabDivCreate"> <div class="labelTabCreate pL5 pR fL">{{getI18n(\'crm.zdesk.update.sel\')}}</div> <div class="labelValCreate fL"> <div class="createSelect newChosenSel"> <lyte-dropdown id="updateFieldName" data-zcqa="desk_fieldselect" on-option-selected="{{method(\'updateNewValueField\')}}" on-hide="{{method(\'clearSelectEntry\')}}" lt-prop-disabled-list="{{fieldtodisable}}"> <template is="registerYield" yield-name="yield"> <lyte-drop-box class="crmBoxDropbox zdeskFieldSearch"> <template is="if" value="{{expHandlers(updateableFields.length,\'>=\',10)}}"><template case="true"> <lyte-drop-header> <lyte-search id="dropdownSearch" style="width:100%" lt-prop-query-selector="{&quot;scope&quot;: &quot;.zdeskFieldSearch&quot;,&quot;search&quot;:&quot;lyte-drop-item&quot;}" on-search="{{method(\'onSearch\')}}"></lyte-search> </lyte-drop-header> </template></template> <lyte-drop-body> <template is="for" items="{{updateableFields}}" item="item" index="index"> <lyte-drop-item data-value="{{item.name}}">{{item.i18NLabel}}</lyte-drop-item> </template> </lyte-drop-body> <div class="crmZdesk_dropInStyle" style="display:{{noResult}};">{{getI18n(\'crm.label.no.options.found\')}}</div> </lyte-drop-box> </template> </lyte-dropdown> </div> </div> <div class="cB"></div> </div> <div class="tabDivCreate"> <div id="deskupdateFieldMsg" class="labelTabCreate pL5 pR fL">{{deskupdateFieldMsgText}}</div> <div class="labelValCreate fL"> <div id="fieldUpdNewValDiv"> <div class="{{if(fieldUpdSelectOptionShow,\'createSelect newChosenSel\',\'dN\')}}" id="fieldUpdSelectOption"> <lyte-dropdown id="fieldUpdSelect" lt-prop-options="{{fieldUpSelectData}}" lt-prop-user-value="name" lt-prop-system-value="value" data-zcqa="desk_picklistfield"> </lyte-dropdown> </div> <div id="fieldUpdTextOption" class="{{if(fieldUpdTextOptionShow,\'\',\'dN\')}}"> <div id="plainText" class="{{if(plainTextShow,\'\',\'dN\')}}" data-zcqa="desk_textfield"> <lyte-input class="contact_zohoDeskInputBorder" lt-prop-id="textinput" lt-prop-type="{{lbind(fieldObjType)}}" lt-prop-class="textField" lt-prop-maxlength="{{lbind(fieldObjMaxLength)}}" lt-prop-value="{{lbind(textInputValue)}}"></lyte-input> </div> <div id="dateText" class="{{if(dateTextShow,\'\',\'dN\')}}"> <lyte-input lt-prop-type="date" lt-prop-id="deskDate" lt-prop-format="{{supportObj.datePattern}}" lt-prop-number-of-rows="6" lt-prop-start-week-day="1" lt-prop-tab-index="0" lt-prop-pattern=".+" lt-prop-update-delay="250" lt-prop-callback-delay="0" lt-prop-placeholder="{{supportObj.datePattern}}" lt-prop-style="width: 100px;" lt-prop-month-header-format="MMM YYYY" lt-prop-value="{{lbind(dateInputValue)}}"> </lyte-input> <template is="if" value="{{defaultTimePatternShow}}"><template case="true"> <lyte-input lt-prop-type="time" lt-prop-time-format="12" lt-prop-wheel="true" lt-prop-hour-interval="1" lt-prop-minute-interval="30" lt-prop-tab-index="0" lt-prop-pattern=".+" lt-prop-update-delay="250" lt-prop-callback-delay="0" lt-prop-placeholder="hh:mm" lt-prop-default-time="12:00 AM" lt-prop-dropdown="true" lt-prop-start-time="12:00 AM" lt-prop-end-time="11:30 PM" lt-prop-id="deskTime" lt-prop-style="width: 100px;" lt-prop-value="{{lbind(timeInputValue)}}"> </lyte-input> </template><template case="false"> <lyte-input lt-prop-type="time" lt-prop-time-format="24" lt-prop-wheel="true" lt-prop-hour-interval="1" lt-prop-minute-interval="30" lt-prop-tab-index="0" lt-prop-pattern=".+" lt-prop-update-delay="250" lt-prop-callback-delay="0" lt-prop-placeholder="hh:mm" lt-prop-default-time="00:00" lt-prop-dropdown="true" lt-prop-start-time="00:00" lt-prop-end-time="23:30" lt-prop-id="deskTimeNewPattern" lt-prop-style="width: 100px;" lt-prop-value="{{lbind(newTimeInputValue)}}"> </lyte-input> </template></template> <div class="cB"></div> </div> <span class="{{if(errorFieldShow,\'errMsg errorMsgDesc\',\'dNImp\')}}" id="errorMsg_TicketField" style="clear: both; color: rgb(221, 0, 0); font-size: 11px; display: block;">{{errorFieldMsg}}</span> </div> </div> </div> <div class="cB"></div> </div> </div> <div class="p20 alignright"> <input type="button" class="newwhitebtn mR20" value="{{getI18n(\'crm.button.cancel\')}}" data-zcqa="desk_updatecancel" onclick="{{action(\'closeTicketUpdatePop\')}}"> <input type="button" data-zcqa="desk_ticketupdate" class="primarybtn" value="{{getI18n(\'crm.button.update\')}}" onclick="{{action(\'updateFields\',undefined,undefined)}}"> </div> </lyte-modal-content> </template> </lyte-modal> <lyte-modal id="ticketsModal" on-before-close="{{method(\'deskTicketClose\')}}" lt-prop-wrapper-class="center-modal tickets-ov center-freeze ticket-modal" lt-prop-width="80%" lt-prop-height="590px !important" lt-prop-transition="{&quot;animation&quot;:&quot;slideFromTop&quot;,&quot;duration&quot;:&quot;0.5&quot;}" lt-prop-show-close-button="false" lt-prop-close-on-escape="false" lt-prop-dimmer="{&quot;opacity&quot;:&quot;0.7&quot;}"> <template is="registerYield" yield-name="modal"> <span class="pA gray-round-bg cP" style="top: 26px; width: 42px; height: 42px;" onclick="{{action(\'closeModal\',this)}}"> <span class="ignite-sprite ignite-icon-close"></span> </span> <lyte-modal-content class="h100per p0" style="overflow-x: scroll !important"> <iframe src="about:blank" id="deskTicketsIframe" class="border_radius20 noborder" style="width:100%;height:100%; min-width:1250px;"></iframe> </lyte-modal-content> </template> </lyte-modal> <div id="ticketsDropDiv"> <table id="ticketsTable" cellpadding="0" cellspacing="0" class="w100per pR"> <thead> <tr id="desk_tickets_thead_row" class="{{if(deskTheadRowShow,\'relList_headrow\',\'dN\')}}"> <th class="relList_headele"> <label class="vh"> <span id="deskTktSelectAll" class="customCheckBox"></span> </label> </th> <td is="for" lyte-for="true" items="{{ticketHeadings}}" item="item" index="index" depth="3"></td> </tr> </thead> <tbody id="desk_tickets_tbody"> <tr is="if" lyte-if="true" value="{{expHandlers(data.length,\'>\',0)}}"></tr> </tbody> </table> <template is="if" value="{{showNavigation}}"><template case="true"> <lyte-navigator on-next="{{method(\'next\',undefined)}}" on-previous="{{method(\'prev\',undefined)}}" lt-prop-middle-text="to" lt-prop-yeild="false" lt-prop-value="{{fromIndex}}" lt-prop-perpage="7" lt-prop-more-records="{{showNextNav}}" lt-prop-records="{{toIndex}}"> </lyte-navigator> </template></template> </div> </template></template> <lyte-popover lt-prop-content-padding="5px" lt-prop-type="box" lt-prop-origin-elem="{{lbind(popoverbind)}}" lt-prop-height="auto" lt-prop-duration="400" lt-prop-freeze="false" lt-prop-show-close-button="false" lt-prop-placement="bottom" lt-prop-width="auto" lt-prop-show="{{lbind(agentpopovershow)}}"> <template is="registerYield" yield-name="popover"> <lyte-popover-content> <div class="pR"> <div class="up_space pA"> <img id="agentImg" class="up_size fL" src="{{imgsrc}}" alt="CrmContact" style="width:60px"> </div> <div class="userbc_info"> <div class="crm-font-bold f15 pT10 pB5 userinfoMax"> <span id="bcAgentName" class="dIB" style="max-width: 350px;">{{bcAgentInfoText}} </span> </div> <a class="emailicon lh24 black dB" href="{{lbind(agentEmailHref)}}">{{agentEmailText}}</a> </div> <div id="actionLayer" class="aligncenter"></div> </div> </lyte-popover-content> </template> </lyte-popover> </div> </template>',_dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,1,1,1,1,0]},{type:"componentDynamic",position:[1,1,1,1,1]},{type:"componentDynamic",position:[1,1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"attr",position:[1,7]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3]},{type:"attr",position:[5]},{type:"attr",position:[5,1]},{type:"attr",position:[5,1,1]},{type:"text",position:[5,1,1,1,1,1,1,1,1,0]},{type:"text",position:[5,1,1,1,1,1,1,1,3,0]},{type:"componentDynamic",position:[5,1,1,1,1,1,1,1]},{type:"text",position:[5,1,1,1,1,1,1,3,1,0]},{type:"text",position:[5,1,1,1,1,1,1,3,3,0]},{type:"componentDynamic",position:[5,1,1,1,1,1,1,3]},{type:"text",position:[5,1,1,1,1,1,1,5,1,0]},{type:"attr",position:[5,1,1,1,1,1,1,5,3]},{type:"text",position:[5,1,1,1,1,1,1,5,3,1,0]},{type:"text",position:[5,1,1,1,1,1,1,5,3,2,0]},{type:"componentDynamic",position:[5,1,1,1,1,1,1,5]},{type:"text",position:[5,1,1,1,1,1,1,7,1,0]},{type:"attr",position:[5,1,1,1,1,1,1,7,3]},{type:"text",position:[5,1,1,1,1,1,1,7,3,1,0]},{type:"text",position:[5,1,1,1,1,1,1,7,3,2,0]},{type:"componentDynamic",position:[5,1,1,1,1,1,1,7]},{type:"text",position:[5,1,1,1,1,1,1,9,1,0]},{type:"attr",position:[5,1,1,1,1,1,1,9,3,1]},{type:"text",position:[5,1,1,1,1,1,1,9,3,1,0]},{type:"attr",position:[5,1,1,1,1,1,1,9,3,3]},{type:"attr",position:[5,1,1,1,1,1,1,9,3,5]},{type:"text",position:[5,1,1,1,1,1,1,9,3,5,0]},{type:"componentDynamic",position:[5,1,1,1,1,1,1,9]},{type:"componentDynamic",position:[5,1,1,1,1,1,1]},{type:"componentDynamic",position:[5,1,1,1,1,1]},{type:"componentDynamic",position:[5,1,1,1,1]},{type:"componentDynamic",position:[5,1,1,1]},{type:"attr",position:[5,3,1]},{type:"text",position:[5,3,1,1,1,0]},{type:"text",position:[5,3,1,1,3,0]},{type:"attr",position:[5,3,1,3]},{type:"text",position:[5,3,1,3,0]},{type:"attr",position:[5,3,3]},{type:"attr",position:[5,3,3,1]},{type:"registerYield",position:[5,3,3,1,1],dynamicNodes:[{type:"text",position:[1,1,1,0]},{type:"componentDynamic",position:[1,1,1]},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,1,5]},{type:"for",position:[1,1,5],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]},{type:"text",position:[1,1,7,0]},{type:"componentDynamic",position:[1,1,7]},{type:"text",position:[1,1,9,0]},{type:"componentDynamic",position:[1,1,9]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[5,3,3,1]},{type:"attr",position:[5,3,5]},{type:"attr",position:[5,3,5,1]},{type:"if",position:[5,3,5,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[3]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"registerYield",position:[1,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"registerYield",position:[1,3,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1,3]}]}},default:{}},{type:"attr",position:[5,3,5,3]},{type:"if",position:[5,3,5,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}},{type:"attr",position:[5,3,5,5]},{type:"if",position:[5,3,5,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"attr",position:[1,1,3,1,1,1]},{type:"if",position:[1,1,3,1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0]}]}},default:{}},{type:"attr",position:[1,1,3,1,3,1]},{type:"text",position:[1,1,3,1,3,1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"registerYield",position:[1,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1,1]}]}},default:{}}]}},default:{}},{type:"attr",position:[5,5,1]},{type:"if",position:[5,5,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]}},default:{}},{type:"attr",position:[5,5,3]},{type:"if",position:[5,5,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]}},default:{}},{type:"attr",position:[5,5,5]},{type:"if",position:[5,5,5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"registerYield",position:[3,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[3,1]},{type:"attr",position:[3,3]},{type:"registerYield",position:[3,3,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[3,3]},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[3]}]}},default:{}},{type:"registerYield",position:[7,1],dynamicNodes:[{type:"text",position:[1,1,1,1,1,0]},{type:"attr",position:[1,1,1,3,1]},{type:"registerYield",position:[1,1,1,3,1,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1,1,1,3,1]},{type:"attr",position:[1,1,1,3,3]},{type:"registerYield",position:[1,1,1,3,3,1],dynamicNodes:[{type:"text",position:[1]}]},{type:"componentDynamic",position:[1,1,1,3,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[7]},{type:"attr",position:[9]},{type:"registerYield",position:[9,1],dynamicNodes:[{type:"text",position:[1,1,0]},{type:"text",position:[1,3,1,1,0]},{type:"attr",position:[1,3,1,3,1,1]},{type:"registerYield",position:[1,3,1,3,1,1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,3,1]},{type:"for",position:[1,3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,3]},{type:"attr",position:[1,5],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'display:'","noResult","';'"]}}}},{type:"text",position:[1,5,0]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,3,1,3,1,1]},{type:"text",position:[1,3,3,1,0]},{type:"attr",position:[1,3,3,3,1,1]},{type:"attr",position:[1,3,3,3,1,1,1]},{type:"componentDynamic",position:[1,3,3,3,1,1,1]},{type:"attr",position:[1,3,3,3,1,3]},{type:"attr",position:[1,3,3,3,1,3,1]},{type:"attr",position:[1,3,3,3,1,3,1,1]},{type:"componentDynamic",position:[1,3,3,3,1,3,1,1]},{type:"attr",position:[1,3,3,3,1,3,3]},{type:"attr",position:[1,3,3,3,1,3,3,1]},{type:"componentDynamic",position:[1,3,3,3,1,3,3,1]},{type:"attr",position:[1,3,3,3,1,3,3,3]},{type:"if",position:[1,3,3,3,1,3,3,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[1,3,3,3,1,3,5]},{type:"text",position:[1,3,3,3,1,3,5,0]},{type:"attr",position:[1,5,1]},{type:"attr",position:[1,5,3]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[9]},{type:"attr",position:[11]},{type:"registerYield",position:[11,1],dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[3]}]},{type:"componentDynamic",position:[11]},{type:"attr",position:[13,1,1,1]},{type:"attr",position:[13,1,1,1,3]},{type:"for",position:[13,1,1,1,3],dynamicNodes:[{type:"text",position:[1,1]}],actualTemplate:'<template is="for" items="{{ticketHeadings}}" item="item" index="index" depth="3"><table><tbody><tr> <th class="relList_headele"> {{item.i18NLabel}} </th> </tr></tbody></table></template>',tagName:"TR"},{type:"attr",position:[13,1,3,1]},{type:"if",position:[13,1,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,1,1]},{type:"attr",position:[1,1,1,1,1,1,1]},{type:"attr",position:[1,1,1,1,3,1,1,1,1,1]},{type:"componentDynamic",position:[1,1,1,1,3,1,1,1,1,1]},{type:"attr",position:[1,3]},{type:"for",position:[1,3],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,1,1,1]},{type:"attr",position:[1,1,1,3]},{type:"if",position:[1,1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"attr",position:[1,1,5]},{type:"text",position:[1,1,5,0]},{type:"text",position:[1,1,9,1,0]},{type:"attr",position:[1,3,3]},{type:"text",position:[1,3,3,1,0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,1]},{type:"attr",position:[1,3]},{type:"text",position:[1,3,1,0]},{type:"text",position:[1,3,1,2]}]},false:{dynamicNodes:[]}},default:{},actualTemplate:'<template is="if" value="{{itema.agent}}"><template case="true" depth="3"><table><tbody><tr> <td class="relList_dataele assigneeTd" data-params="{{itema.agent}}"> <div class="dIB vam mR10"> <img alt="CRM Contact" class="assigneeImage circle_30" src="{{if(itema.agent.zuid,expHandlers(expHandlers(expHandlers(contactServerUrl,\'+\',\'/file?ID=\'),\'+\',itema.agent.zuid),\'+\',\'&amp;fs=thumb\'),null)}}"> </div> <div id="ticket_agent_{{itema.id}}" class="dIB vam cP" onmouseenter="{{action(\'showHideAgentInfoBC\',true,itema)}}" onmouseleave="{{action(\'showHideAgentInfoBC\',false,itema)}}"> <span class="assigneeName">{{itema.agent.firstName}} {{itema.agent.lastName}}</span> </div> </td> </tr></tbody></table></template><template case="false" depth="3"><table><tbody><tr> <td class="relList_dataele assigneeTd"></td> </tr></tbody></table></template></template>'}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,1]}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{},actualTemplate:'<template is="if" value="{{itemb.isDateField}}"><template case="true" depth="3"><table><tbody><tr> <td class="relList_dataele dateDetail"> <span class="defaultcursor" onmouseover="{{action(\'showToolTipOnClick\',getTimeInUserTZ(itema.customFields[itemb.name],itemb.name,true),this)}}" onmouseout="{{action(\'hideToolTipOnClick\')}}"> {{getTimeInUserTZ(itema.customFields[itemb.name],itemb.name,false)}} </span> </td> </tr></tbody></table></template><template case="false" depth="3"><table><tbody><tr> <td class="relList_dataele">{{itema.customFields[itemb.name]}}</td> </tr></tbody></table></template></template>'}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1,0]},{type:"if",position:[1,0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1,0]},{type:"if",position:[1,0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[]}},default:{},actualTemplate:'<template is="if" value="{{itemb.name !=null &amp;&amp; itema[itemb.name] != null}}"><template case="true" depth="3"><table><tbody><tr> <td class="relList_dataele" data-zcqa="ticket_{{itemb.name}}" id="ticket_{{itemb.name}}">{{itema[itemb.name]}}</td> </tr></tbody></table></template><template case="false" depth="3"><table><tbody><tr> <td class="relList_dataele"></td> </tr></tbody></table></template></template>'}]}},default:{},actualTemplate:'<template is="if" value="{{itemb.name==\'status\'}}"><template case="true" depth="3"><table><tbody><tr> <td class="relList_dataele" data-zcqa="ticket_{{itemb.name}}" id="ticket_{{itemb.name}}">{{itema.status}}</td> </tr></tbody></table></template><template case="false" depth="3"><table><tbody><tr><td is="if" lyte-if="true" value="{{expHandlers(expHandlers(itemb.name,\'!=\',null),\'&amp;&amp;\',expHandlers(itema[itemb.name],\'!=\',null))}}"></td></tr></tbody></table></template></template>'}]}},default:{},actualTemplate:'<template is="if" value="{{itemb.name==\'status\' &amp;&amp; (itema.status === \'Escalated\' || itema.status === \'Closed\')}}"><template case="true" depth="3"><table><tbody><tr> <td class="relList_dataele status_{{itema.status}}" data-zcqa="ticket_{{itemb.name}}" id="ticket_{{itemb.name}}">{{itema.status}}</td> </tr></tbody></table></template><template case="false" depth="3"><table><tbody><tr><td is="if" lyte-if="true" value="{{expHandlers(itemb.name,\'==\',\'status\')}}"></td></tr></tbody></table></template></template>'}]}},default:{},actualTemplate:'<template is="if" value="{{itemb.crmPotential}}"><template case="true" depth="3"><table><tbody><tr> <td id="deskPotentialtd" class="relList_dataele"><template is="if" value="{{ticketPotentials[itema.id]}}"><template case="true"> <link-to lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp="[&quot;Potentials&quot;,&quot;{{ticketPotentials[itema.id].potentialId}}&quot;]" lt-prop-target="blank">{{ticketPotentials[itema.id].potential}} </link-to> </template></template> </td> </tr></tbody></table></template><template case="false" depth="3"><table><tbody><tr><td is="if" lyte-if="true" value="{{expHandlers(expHandlers(itemb.name,\'==\',\'status\'),\'&amp;&amp;\',expHandlers(expHandlers(itema.status,\'===\',\'Escalated\'),\'||\',expHandlers(itema.status,\'===\',\'Closed\')))}}"></td></tr></tbody></table></template></template>'}]}},default:{},actualTemplate:'<template is="if" value="{{itemb.crmContact}}"><template case="true" depth="3"><table><tbody><tr> <td class="relList_dataele"><template is="if" value="{{emailContacts[itema.email]}}"><template case="true"> <link-to lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp="[&quot;Contacts&quot;,&quot;{{emailContacts[itema.email].contactId}}&quot;]" lt-prop-target="blank">{{emailContacts[itema.email].contact}} </link-to> </template></template> </td> </tr></tbody></table></template><template case="false" depth="3"><table><tbody><tr><td is="if" lyte-if="true" value="{{itemb.crmPotential}}"></td></tr></tbody></table></template></template>'}]}},default:{},actualTemplate:'<template is="if" value="{{itemb.isDateField}}"><template case="true" depth="3"><table><tbody><tr> <td class="relList_dataele dateDetail"> <span class="defaultcursor" onmouseover="{{action(\'showToolTipOnClick\',getTimeInUserTZ(itema[itemb.name],itemb.name,true),this)}}" onmouseout="{{action(\'hideToolTipOnClick\')}}"> {{getTimeInUserTZ(itema[itemb.name],itemb.name,false)}} </span> </td> </tr></tbody></table></template><template case="false" depth="3"><table><tbody><tr><td is="if" lyte-if="true" value="{{itemb.crmContact}}"></td></tr></tbody></table></template></template>'}]}},default:{},actualTemplate:'<template is="if" value="{{itemb.isCustomField}}"><template case="true" depth="3"><table><tbody><tr> <td is="if" lyte-if="true" value="{{itemb.isDateField}}"></td> </tr></tbody></table></template><template case="false" depth="3"><table><tbody><tr><td is="if" lyte-if="true" value="{{itemb.isDateField}}"></td></tr></tbody></table></template></template>'}]}},default:{},actualTemplate:'<template is="if" value="{{itemb.assigneeDetail}}"><template case="true" depth="3"><table><tbody><tr> <td is="if" lyte-if="true" value="{{itema.agent}}"></td> </tr></tbody></table></template><template case="false" depth="3"><table><tbody><tr><td is="if" lyte-if="true" value="{{itemb.isCustomField}}"></td></tr></tbody></table></template></template>'}]}},default:{},actualTemplate:'<template is="if" value="{{itemb.mainTicketDetail}}"><template case="true" depth="3"><table><tbody><tr> <td class="relList_dataele mainTicketDetail cP" data-caseid="{{itema.encryptedId}}" onclick="{{action(\'showDeskPopUp\',itema)}}"> <div class="dIB mL5"> <div class="mB5"> <span class="ticket_id dIB f14 vam crm-font-bold">#{{itema.ticketNumber}}</span> <template is="if" value="{{isOverdueFlag(itema.status,itema.dueDate)}}"><template case="true"> <span class="ticket_status h_duedate h_overdue mL10" onmouseover="{{action(\'showDueDateTooltip\',itema.status,itema.dueDate,this)}}" onmouseout="{{action(\'hideDueDateToolTip\')}}">{{isOverDue(itema.status,itema.dueDate)}}</span> </template></template> </div> <template is="if" value="{{ticketPotentials[itema.id]}}"><template case="true"> <div class="linkToPotImg mT1 dIB vam {{ticketPotentials[itema.id]}}"> <span id="deskPotentialImg" class="Potentials-small mR5 vam mL0"></span> </div> </template></template> <p class="ticket_subject f13 tOE oH crm-font-regular dIB vam" style="max-width: 300px;" onmouseenter="{{action(\'showSubjectTooltip\',itema.subject,this)}}" onmouseleave="{{action(\'hideTooltip\',this)}}">{{itema.subject}}</p> <div class="dIB vam mL10"> <div class="conversationThreadIcon op03"></div> </div> <div class="dIB pR mR5"> <span class="dIB pA ticketThreadCount aligncenter">{{itema.threadCount}}</span> </div> </div> <div class="dIB fR vam"> <div class="commentIcon mT13 cP op05"></div> <div class="pR mR30 {{if(ifEquals(itema.commentCount,\'0\'),\'vh\',\'\')}}"> <span class="dIB pA whiteBg commentCountCircle aligncenter">{{itema.commentCount}}</span> </div> </div> <div class="cB"></div> </td> </tr></tbody></table></template><template case="false" depth="3"><table><tbody><tr><td is="if" lyte-if="true" value="{{itemb.assigneeDetail}}"></td></tr></tbody></table></template></template>'}],actualTemplate:'<template is="for" items="{{ticketKeys}}" item="itemb" index="indexb" depth="3"><table><tbody><tr> <td is="if" lyte-if="true" value="{{itemb.mainTicketDetail}}"></td> </tr></tbody></table></template>',tagName:"TR"}],actualTemplate:'<template is="for" items="{{data}}" item="itema" index="indexa" depth="2"><table><tbody> <tr class="relList_datarow topband_dv_row" id="ticket_{{itema.id}}" data-dept="{{itema.departmentId}}"> <td class="relList_dataele firstCol"> <div class="flipContainer"> <div id="flipCard_{{itema.id}}" class="{{if(flipCardShow,\'flipCard flipped\',\'flipCard\')}}"> <div class="flipFront flipper"> <div class="ticketSourceIconCont"> <div class="ticketSourceIcon {{itema.channel}}_Icon"></div> </div> </div> <div class="flipBack flipper"> <div class="deskRelCkBoxCont"> <div class="mAuto"> <div class="ckBoxCont"> <label class="label_ckbox"> <lyte-checkbox id="checkbox_{{itema.id}}" on-checked="{{method(\'onCheckedUpdateRowSelection\',itema.id)}}" on-unchecked="{{method(\'onUnCheckedUpdateRowSelection\',itema.id)}}" lt-prop-checked="false"></lyte-checkbox> <span class="span_ckbox"></span> </label> </div> </div> </div> </div> </div> </div> </td> <td is="for" lyte-for="true" items="{{ticketKeys}}" item="itemb" index="indexb" depth="3"></td> </tr> </tbody></table></template>',tagName:"TBODY"}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,1,0]},{type:"attr",position:[1,1,1,2]},{type:"if",position:[1,1,1,2],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}}]},false:{dynamicNodes:[{type:"text",position:[1,1,1,0]}]}},default:{},actualTemplate:'<template is="if" value="{{ticketError}}"><template case="true" depth="2"><table><tbody> <tr> <td colspan="15"> <div class="norec pR30 fontsmooth">{{getI18n(ticketError)}} <template is="if" value="{{portalUser}}"><template case="true"> <span id="noTicket_newTicketLink1" class="{{if(noTicketnewTicketLinkShow,\'cP dIB vam createlink crm-rl-write-action deskhyperlink linkCol\',\'dN\')}}" onclick="{{action(\'showCreateTicketPopup\')}}">{{getI18n(\'crm.zdesk.newticket\')}}</span> </template></template> </div> </td> </tr> </tbody></table></template><template case="false" depth="2"><table><tbody> <tr> <td colspan="15"> <div class="norec pR30 italic fontsmooth">{{fetchingTicketsText}}</div> </td> </tr> </tbody></table></template></template>'}]}},default:{},actualTemplate:'<template is="if" value="{{data.length>0}}"><template case="true" depth="2"><table><tbody> <tr is="for" lyte-for="true" items="{{data}}" item="itema" index="indexa" depth="2"></tr> </tbody></table></template><template case="false" depth="2"><table><tbody><tr is="if" lyte-if="true" value="{{ticketError}}"></tr></tbody></table></template></template>'},{type:"attr",position:[13,3]},{type:"if",position:[13,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}},{type:"attr",position:[1,3]},{type:"registerYield",position:[1,3,1],dynamicNodes:[{type:"attr",position:[1,1,1,1]},{type:"text",position:[1,1,3,1,1,0]},{type:"attr",position:[1,1,3,3]},{type:"text",position:[1,1,3,3,0]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1,3]}],_observedAttributes:["module","entityId","related_list_id","loading","rlData","showNavigation","showPrevNav","showNextNav","fromIndex","toIndex","pageNum","ticketHeadings","ticketKeys","ticketFields","ticketStats","data","deskError","deskErrorMessage","ticketPotentials","contactServerUrl","emailContacts","portalUser","datePattern","defaultTimePatternShow","supportObj","email","allFields","selectedFields","ticketError","entity_id","rendered_from","showIframeUrl","iframeshow","imgsrc","detailTicketId","selectRowId","currentUser","selectedRowCount","module_emailColumns","flipCardShow","deskTicketsSummaryShow","updateableFields","emails","allFields","selectedFields","loadCruxColumn","ticketcreationshow","ticketcreationurl","desk_contactname","desk_accountname","desk_contactemail","desk_contactphone","desk_productName","desk_encryptedContactId","desk_encryptedProductId","desk_encryptedAccountId","url_desk","url_potentials","url_field_properties","deskUrl","crmsupportzgid","crmUrl","fieldProps","showCruxColumn","rowCountVis","agents","deptAgents","linkToThisPotentialShow","ticketFieldUpdatePopupShow","newticketlinkshow","deskTicketFilterShow","ticketsStatsLinkShow","showColumnShow","ticketSelectShow","totalTickets","overdueTickets","avgSolTimeSpan","avgResTimeSpan","ticketStatsLinkText","fieldUpdSelectOptionShow","fieldUpdTextOptionShow","plainTextShow","dateTextShow","leftPanelCount","fieldObjType","fieldObjMaxLength","deskupdateFieldMsgText","deskRelatedListMenuShow","deskTheadRowShow","noTicketnewTicketLinkShow","fieldUpSelectData","textInputValue","dateInputValue","timeInputValue","newTimeInputValue","cusHapRateValue","cusHapRateShow","Smileytype","noHapShow","errorFieldShow","errorFieldMsg","bcAgentInfoText","agentEmailText","agentEmailHref","popoverbind","agentpopovershow","portalName","scrollenable","fetchingTicketsText","noResult","ticketDetailPrevShow","ticketDetailNextShow","cruxcolumShowfromfilter","fieldtodisable","ticketFilterSelectClass"],data:function(){return{module:Lyte.attr("string"),entityId:Lyte.attr("string"),related_list_id:Lyte.attr("string"),loading:Lyte.attr("boolean",{default:!0}),rlData:Lyte.attr("object"),showNavigation:Lyte.attr("boolean",{default:!1}),showPrevNav:Lyte.attr("boolean",{default:!1}),showNextNav:Lyte.attr("boolean",{default:!1}),fromIndex:Lyte.attr("number",{default:1}),toIndex:Lyte.attr("number",{default:7}),pageNum:Lyte.attr("number",{default:0}),ticketHeadings:Lyte.attr("array",[]),ticketKeys:Lyte.attr("array"),ticketFields:Lyte.attr("array"),ticketStats:Lyte.attr("object"),data:Lyte.attr("array"),deskError:Lyte.attr("boolean",{default:!1}),deskErrorMessage:Lyte.attr("string",{default:"No Error"}),ticketPotentials:Lyte.attr("object"),contactServerUrl:Lyte.attr("string",{default:null}),emailContacts:Lyte.attr("object"),portalUser:Lyte.attr("boolean",{default:!1}),datePattern:Lyte.attr("string",{default:"MM/dd/yyyy"}),defaultTimePatternShow:Lyte.attr("boolean",{default:!1}),supportObj:Lyte.attr("object"),email:Lyte.attr("array"),allFields:Lyte.attr("array"),selectedFields:Lyte.attr("array"),ticketError:Lyte.attr("string"),entity_id:Lyte.attr("string"),rendered_from:Lyte.attr("string"),showIframeUrl:Lyte.attr("boolean",{default:!1}),iframeshow:Lyte.attr("boolean",{default:!0}),imgsrc:Lyte.attr("string"),detailTicketId:Lyte.attr("string",{default:""}),selectRowId:Lyte.attr("array",[]),currentUser:Lyte.attr("object",{default:{}}),selectedRowCount:Lyte.attr("number",{default:0}),module_emailColumns:Lyte.attr("array",{default:["EMAIL","ADDN_EMAIL"]}),flipCardShow:Lyte.attr("boolean",{default:!1}),deskTicketsSummaryShow:Lyte.attr("boolean",{default:!1}),updateableFields:Lyte.attr("array"),emails:Lyte.attr("array"),allFields:Lyte.attr("array"),selectedFields:Lyte.attr("array"),loadCruxColumn:Lyte.attr("boolean",!1),ticketcreationshow:Lyte.attr("boolean",!1),ticketcreationurl:Lyte.attr("string"),desk_contactname:Lyte.attr("string",{default:null}),desk_accountname:Lyte.attr("string",{default:null}),desk_contactemail:Lyte.attr("string",{default:null}),desk_contactphone:Lyte.attr("string",{default:null}),desk_productName:Lyte.attr("string",{default:null}),desk_encryptedContactId:Lyte.attr("string",{default:null}),desk_encryptedProductId:Lyte.attr("string",{default:null}),desk_encryptedAccountId:Lyte.attr("string",{default:null}),url_desk:Lyte.attr("string",{default:Crm.getCrmBasePath()+"/deskIntegration.do"}),url_potentials:Lyte.attr("string",{default:Crm.getCrmBasePath()+"/Search.do?searchmodule=Potentials"}),url_field_properties:Lyte.attr("string",{default:null}),deskUrl:Lyte.attr("string",{default:""}),crmsupportzgid:Lyte.attr("string",{default:""}),crmUrl:Lyte.attr("string",{default:""}),fieldProps:Lyte.attr("object",{}),showCruxColumn:Lyte.attr("boolean",{default:!1}),rowCountVis:Lyte.attr("number",{default:7}),agents:Lyte.attr("object"),deptAgents:Lyte.attr("object"),linkToThisPotentialShow:Lyte.attr("boolean",{default:!1}),ticketFieldUpdatePopupShow:Lyte.attr("boolean",{default:!1}),newticketlinkshow:Lyte.attr("boolean",{default:!1}),deskTicketFilterShow:Lyte.attr("boolean",{default:!1}),ticketsStatsLinkShow:Lyte.attr("boolean",{default:!1}),showColumnShow:Lyte.attr("boolean",{default:!0}),ticketSelectShow:Lyte.attr("boolean",{default:!1}),totalTickets:Lyte.attr("string",{default:"0"}),overdueTickets:Lyte.attr("string",{default:"0"}),avgSolTimeSpan:Lyte.attr("string",{default:"00:00"}),avgResTimeSpan:Lyte.attr("string",{default:"00:00"}),ticketStatsLinkText:Lyte.attr("string"),fieldUpdSelectOptionShow:Lyte.attr("boolean",{default:!0}),fieldUpdTextOptionShow:Lyte.attr("boolean",{default:!1}),plainTextShow:Lyte.attr("boolean",{default:!1}),dateTextShow:Lyte.attr("boolean",{default:!0}),leftPanelCount:Lyte.attr("string",{default:"0"}),fieldObjType:Lyte.attr("string",{default:"text"}),fieldObjMaxLength:Lyte.attr("string",{default:"200"}),deskupdateFieldMsgText:Lyte.attr("string"),deskRelatedListMenuShow:Lyte.attr("boolean",{default:!1}),deskTheadRowShow:Lyte.attr("boolean",{default:!1}),noTicketnewTicketLinkShow:Lyte.attr("boolean",{default:!1}),fieldUpSelectData:Lyte.attr("array",[]),textInputValue:Lyte.attr("string",{default:""}),dateInputValue:Lyte.attr("string"),timeInputValue:Lyte.attr("string"),newTimeInputValue:Lyte.attr("string"),cusHapRateValue:Lyte.attr("string",{default:"0%"}),cusHapRateShow:Lyte.attr("boolean",{default:!1}),Smileytype:Lyte.attr("string"),noHapShow:Lyte.attr("boolean",{default:!0}),errorFieldShow:Lyte.attr("boolean",{default:!1}),errorFieldMsg:Lyte.attr("string"),bcAgentInfoText:Lyte.attr("string"),agentEmailText:Lyte.attr("string"),agentEmailHref:Lyte.attr("string"),popoverbind:Lyte.attr("string"),agentpopovershow:Lyte.attr("boolean",{default:!1}),portalName:Lyte.attr("string"),scrollenable:Lyte.attr("boolean",{default:!1}),fetchingTicketsText:Lyte.attr("string",{default:I18n.getMsg("crm.zdesk.fetchingtickets")}),noResult:Lyte.attr("string",{default:"none"}),ticketDetailPrevShow:Lyte.attr("boolean",{default:!1}),ticketDetailNextShow:Lyte.attr("boolean",{default:!1}),cruxcolumShowfromfilter:Lyte.attr("boolean",{default:!1}),fieldtodisable:Lyte.attr("array",[]),ticketFilterSelectClass:Lyte.attr("string",{default:""})}},init:function(){var t=this,e=!0,a={module:t.getData("module"),moduleId:t.getData("entity_id"),entId:t.getData("entity_id"),deskstats:"true",action:"getEntityTickets"};this.setData("module",this.getData("module")),this.setData("entityId",this.getData("entity_id")),this.setData("related_list_id",this.getData("related_list_id")),this.setData("deskTicketFilterShow",!1),this.setData("newticketlinkshow",!1),this.setData("deskRelatedListMenuShow",!1),this.setData("deskTheadRowShow",!1),store.findAll("zdesk_integ_rl",a,!1,!1).then((function(a){a=a.zdesk_integ_rl;var i=$("[id='addNewIcP_Zoho Desk']");if(validationUtils.isNotEmpty(a)){var o=a.SupportObj;if(!o)return void t.setData("fetchingTicketsText",I18n.getMsg("crm.zdesk.contactadmin"));t.setData("fetchingTicketsText",I18n.getMsg("crm.zdesk.fetchingtickets")),o.datePattern?t.setData("ticketStatsLinkText",I18n.getMsg("crm.zdesk.hidestats")):t.setData("ticketStatsLinkText",I18n.getMsg("crm.zdesk.showstats"));var s=o.portalUser,n=o.datePattern,l=document.querySelector("crm-zdesk-rl-label");t.initializeData(),t.setData("portalUser",s),t.setData("datePattern",n),"hh:mm a"===Crm.userDetails.TIME_FORMAT&&t.setData("defaultTimePatternShow",!0),t.updateDetailsForRL(o);if(o.potentialModule&&o.potentialTickets>0&&"Potentials",t.setData("portalName",a.portalName),t.setData("supportObj",o),t.setData("crmsupportzgid",a.crmsupportzgid),t.executeMethod("populateIntegDetails",a),a.hasOwnProperty("emails")&&(t.setData("email",a.emails),"crm.zdesk.notickets"===a.ticketError&&t.displayDeskWindow()&&(t.setData("noTicketnewTicketLinkShow",!0),i.removeClass("dN"),l&&l.component.setData("refreshIconShow",!0))),a.hasOwnProperty("deskError")){t.setData("deskError",a.hasOwnProperty("deskError"));var r=a.deskError;t.setData("deskErrorMessage",r),t.setData("deskTicketFilterShow",!1),t.setData("deskTheadRowShow",!1),t.setData("newticketlinkshow",!1),t.setData("deskRelatedListMenuShow",!1)}else a.hasOwnProperty("ticketError")&&"crm.zdesk.notickets"===a.ticketError?(e=!1,t.setData("ticketError",a.ticketError),t.setData("data",[]),t.setData("deskTicketFilterShow",!1),t.setData("deskTheadRowShow",!1),t.setData("newticketlinkshow",!1),t.setData("deskRelatedListMenuShow",!1)):a.hasOwnProperty("tickets")&&(l&&l.component.setData("refreshIconShow",!0),t.getData("portalUser")?i.removeClass("dN"):i.addClass("dN"));if(t.setDeskTicketData(a),e&&o.potentialModule&&o.potentialTickets>0&&(document.querySelector("#ticketFilterSelect").ltProp("selected","Potentials"),t.setData("linkToThisPotentialShow",!1)),a.hasOwnProperty("ticketStats")&&null!==a.ticketStats)if("Products"===t.getData("module")){var d=a.ticketStats.encryptedProductId;t.setData("desk_encryptedProductId",d),"crm.zdesk.notickets"===a.ticketError&&t.displayDeskWindow()&&(t.setData("noTicketnewTicketLinkShow",!0),i.removeClass("dN"),l&&l.component.setData("refreshIconShow",!0))}else if("Contacts"===t.getData("module")&&!a.hasOwnProperty("emails")&&a.ticketStats.encryptedContactId){var p=a.ticketStats.encryptedContactId;t.setData("desk_encryptedContactId",p),"crm.zdesk.notickets"===a.ticketError&&t.displayDeskWindow()&&(t.setData("noTicketnewTicketLinkShow",!0),i.removeClass("dN"),l&&l.component.setData("refreshIconShow",!0)),t.setData("ticketStats",c),t.summarizeTickets(a)}else{var c=a.ticketStats;t.setData("ticketStats",c),t.summarizeTickets(a)}}else t.setData("ticketError","No records found"),i.addClass("dN")}))},actions:{showDeskPopUp:function(t){this.setData("showIframeUrl",!1),this.executeMethod("loadCurrentUserInfo",t),deskInteg.handleScroll(!0)},showSubjectTooltip:function(t,e){e.scrollWidth>e.offsetWidth&&crmui.toolTip_show(e,"left",t)},hideTooltip:function(){crmui.toolTip_hide()},showDueDateTooltip:function(t,e,a){if("Closed"!==t&&e){var i=new Date(e),o=(new Date).getTime()-i.getTime();if(o>0){var s,n=o/36e5,l="";if((n=Math.floor(n))>24){var r=n/24;n%=24,l=(r=Math.floor(r))+" Days "}s="Late by "+(l=l+n+" Hours"),crmui.showTooltip(s,!1,"left",a)}}},hideDueDateToolTip:function(){crmui.hideTooltip()},showHideAgentInfoBC:function(t,e){if(t){var a=e.agent;this.setData("popoverbind","#ticket_agent_"+e.id),this.setData("agentEmailText",a.emailId),this.setData("agentEmailHref","mailto:"+a.emailId);var i=this.getData("contactServerUrl")+"/file?ID="+a.zuid+"&fs=thumb";this.setData("imgsrc",i),this.setData("bcAgentInfoText",a.firstName+" "+a.lastName),this.setData("agentpopovershow",!0)}else this.setData("agentpopovershow",!1)},cruxcolumnshow:function(){$L("#chooseColumnsFilterDD")[0].ltProp("show",!0),this.setData("showCruxColumn",!0)},clearSelect:function(t){this.setData("flipCardShow",!1);var e=this.getData("selectRowId");this.setData("selectRowId",[]),this.setSelectedRowCount("zero"),this.ticketActionDisplay(t),e.forEach((function(t){var e=document.getElementById("checkbox_"+t);e&&e.ltProp("checked",!1)}))},showTktFldUpdPop:function(t){var e=this.getData("updateableFields"),a=this;if(a.setData("fieldtodisable",[]),e){var i=document.querySelector("#updateFieldName");if(a.getData("fieldProps")){for(var o=[],s=t.length,n=0;n<s;n++){var l=t[n],r=a.getData("fieldProps");r[l.name]&&o.push(r[l.name])}a.setData("updateableFields",o);var d=a.getData("updateableFields");0===d.filter((function(t){return t.name===i})).length&&(i.ltProp("selected",d[0].name),a.setData("fieldUpdSelectOptionShow",!1),a.setData("fieldObjType",d[0].type),a.setData("maxlength",d[0].maxLength),a.setData("dateTextShow",!1),a.setData("plainTextShow",!0),a.setData("fieldUpdTextOptionShow",!0),a.setData("textInputValue",""),a.setData("deskupdateFieldMsgText",I18n.getMsg("crm.zdesk.update.enter",d[0].i18NLabel)))}if(a.setData("ticketFieldUpdatePopupShow",!0),a.getData("selectedRowCount")>1){if("assigneeId"==i.ltProp("selected")){o=a.getData("updateableFields");i.ltProp("selected",o[0].name),a.setData("fieldUpdSelectOptionShow",!1),a.setData("fieldObjType",o[0].type),a.setData("maxlength",o[0].maxLength),a.setData("dateTextShow",!1),a.setData("plainTextShow",!0),a.setData("fieldUpdTextOptionShow",!0),a.setData("deskupdateFieldMsgText",I18n.getMsg("crm.zdesk.update.enter",o[0].i18NLabel))}var p=t.filter((function(t){return"assigneeId"===t.name}));p.length>0&&Lyte.arrayUtils(a.getData("fieldtodisable"),"push",p[0].name)}}else this.loadFieldProperties((function(){for(var e=[],i=t.length,o=0;o<i;o++){var s=t[o],n=a.getData("fieldProps");n[s.name]&&e.push(n[s.name])}if(a.setData("ticketFieldUpdatePopupShow",!0),a.setData("updateableFields",e),a.getData("selectedRowCount")>1){var l=t.filter((function(t){return"assigneeId"===t.name}));l.length>0&&Lyte.arrayUtils(a.getData("fieldtodisable"),"push",l[0].name)}document.querySelector("#updateFieldName").ltProp("selected",e[0].name),a.setData("fieldUpdSelectOptionShow",!1);var r=e[0].type,d=e[0].maxLength;a.setData("fieldObjType",r),a.setData("maxlength",d),a.setData("dateTextShow",!1),a.setData("plainTextShow",!0),a.setData("fieldUpdTextOptionShow",!0),a.setData("deskupdateFieldMsgText",I18n.getMsg("crm.zdesk.update.enter",e[0].i18NLabel))}));Crm.trackSpotLightAction("ZDesk - Update Ticket Popup ")},updateFields:function(t,e){var a=this.getData("module"),i=this.getData("entity_id");Crm.trackSpotLightAction("ZDesk - Ticket Update");var o={isCustomField:!1};if(!t){t=document.querySelector("#updateFieldName").ltProp("selected"),o=this.getData("fieldProps")[t];var s=!0;switch(e=this.getData("textInputValue"),o.type){case"Phone":case"Number":s=validationUtils.isValidInteger(e);break;case"Email":s=validationUtils.isValidEmail(e);break;case"Text":s=""!==e&&e.length<=o.maxLength;break;case"LookUp":case"Picklist":e=document.querySelector("#fieldUpdSelect").ltProp("selected");break;case"DateTime":var n,l=this.getData("dateInputValue");e=l+" "+(n="hh:mm a"===Crm.userDetails.TIME_FORMAT?this.getData("timeInputValue"):this.getData("newTimeInputValue")),s=l&&n}if(!s)return this.setData("errorFieldMsg",I18n.getMsg("crm.field.valid.check",o.i18NLabel)),void this.setData("errorFieldShow",!0)}var r={fieldName:t,fieldValue:e,isCustomField:o.isCustomField,fieldType:o.type};r.ids=this.getData("selectRowId");var d={ticketType:this.getCurrentTicketType(a),module:a,moduleId:i,action:"updateTickets"};d.pageToken=this.getCurrentTicketPage();var p=this.getKeyValueForTicketCriteria();d[p.key]=p.value,d.ticketJson=JSON.stringify(r);var c=this,m=this.getData("data").length,u=r.ids;store.createRecord("dummy"),commonUtils.showHideLoadingDiv(!0),store.create("dummy",void 0,{url:this.getData("url_desk"),method:"POST"},d).then((function(t){commonUtils.showHideLoadingDiv();var e=t.dummy;c.setData("data",e.tickets),e.ticketError&&c.setData("ticketError",e.ticketError),c.setData("ticketPotentials",e.ticketPotentials),c.setData("ticketKeys",e.ticketKeys),c.setData("showNavigation",!1),e.hasOwnProperty("page")&&c.executeMethod("setLyteNavigatorValues",e),c.actions.closeTicketUpdatePop.call(c),c.actions.clearSelect.call(c,m),c.setData("rowCountVis",e.tickets?e.tickets.length:0);for(var a=u.length,i=0;i<a;i++)$("#ticket_"+u[i]).addClass("deskBgAnim");setTimeout((function(){c.executeMethod.removeAnimClass(u)}),2e3)}),(function(){c.actions.closeTicketUpdatePop.call(c)}))},populatePotentialPopup:function(){var t=this.getData("module"),e=this.getData("entity_id"),a=this.getData("url_potentials");"Accounts"===t?a=a+"&accountId="+e:"Contacts"===t&&(a=a+"&productId="+e),a+="&newModel=true",a+="&fromzdesk=true",commonUtils.openCustomLookup(a,void 0,"topBandPopup",renderingUtils.windowWidth-300,void 0,void 0,void 0,!0)},saveColModify:function(){var t=this.getData("module"),e=this.getData("entity_id");Crm.trackSpotLightAction("ZDesk - Ticket Columns Update");var a=document.querySelector("crux-column-list").component.getSelectedFields(),i=[];a.forEach((function(t){i.push(t.name)}));var o={ticketType:this.getCurrentTicketType(t),module:t,moduleId:e,deskstats:!0,action:"updateTicketFields"};o.pageToken=this.getCurrentTicketPage(),o.fields=JSON.stringify(i);var s=this.getKeyValueForTicketCriteria(),n=this;o[s.key]=s.value,store.createRecord("dummy"),commonUtils.showHideLoadingDiv(!0),store.create("dummy",void 0,{url:this.getData("url_desk"),method:"POST"},o).then((function(t){commonUtils.showHideLoadingDiv();var e=t.dummy;n.setData("data",e.tickets),e.ticketError&&n.setData("ticketError",e.ticketError),e.hasOwnProperty("ticketPotentials")&&n.setData("ticketPotentials",e.ticketPotentials),n.setData("ticketKeys",e.ticketKeys),n.setData("ticketHeadings",e.ticketHeadings),e.hasOwnProperty("ticketStats")&&n.setData("ticketStats",e.ticketStats),n.setData("ticketFields",e.ticketFields),n.setData("rowCountVis",e.tickets?e.tickets.length:0),n.setData("showCruxColumn",!1)}))},cancelChooseColumns:function(){this.setData("showCruxColumn",!1)},deleteTickets:function(){var t=this.getData("module"),e=this.getData("entity_id");Crm.trackSpotLightAction("ZDesk - Ticket Delete");var a={ticketType:this.getCurrentTicketType(t),module:t,moduleId:e,action:"deleteTickets"};this.setData("noTicketnewTicketLinkShow",!1),a.pageToken=this.getCurrentTicketPage();var i=this.getKeyValueForTicketCriteria();a[i.key]=i.value;var o=this,s=this.getData("data").length,n={ids:this.getData("selectRowId")};a.ticketJson=JSON.stringify(n),commonUtils.showHideLoadingDiv(!0),store.createRecord("dummy"),store.create("dummy",void 0,{url:this.getData("url_desk"),method:"POST"},a).then((function(t){commonUtils.showHideLoadingDiv();var e=t.dummy;o.actions.hideAnimatePopup("deleteDeskTicketConfirmation"),o.setData("data",e.tickets),e.ticketError&&o.setData("ticketError",e.ticketError),o.setData("showNavigation",!1),e.hasOwnProperty("ticketPotentials")&&o.setData("ticketPotentials",e.ticketPotentials),e.hasOwnProperty("page")&&o.executeMethod("setLyteNavigatorValues",e),o.setData("ticketKeys",e.ticketKeys),e.ticketError&&o.setData("ticketError",e.ticketError),o.setData("rowCountVis",e.tickets?e.tickets.length:0),o.actions.clearSelect.call(o,s)}),(function(){o.actions.hideAnimatePopup("deleteDeskTicketConfirmation")}))},showCreateTicketPopup:function(){var t=this.getData("deskUrl"),e=this.getData("portalName"),a=this.getData("crmUrl"),i=this.getData("module");"undefined"!=typeof CrmPlusLib&&CrmPlusLib.isLoadedInCrmplusFrame&&CrmPlusLib.getFrameOriginForURL&&(a=CrmPlusLib.getFrameOriginForURL()+","+a);var o="//"+t+"/support/"+e+"/ShowHomePage.do?frameorigin="+encodeURIComponent(a);o+="&isDeskAddOnRequest=true#Cases/new?isDeskAddOnRequest=true";var s,n,l="Potentials"===i,r=moduleRecordMapping[i].id,d=Lyte.Router.getRouteInstance().routeName,p=this.getData("desk_contactemail"),c=this.getData("desk_contactname"),m=this.getData("desk_productname"),u=this.getData("desk_accountname"),y=this.getData("desk_encryptedContactId"),h=this.getData("desk_encryptedAccountId"),k=this.getData("desk_encryptedProductId"),f=this.getData("desk_contactphone");if(n="canvas"===d&&store.peekAll(r)[0].hasOwnProperty("Last_Name")?store.peekAll(r)[0].Last_Name:$L("#subvalue_LASTNAME").text(),"canvas"===d&&l?s=store.peekAll(r)[0].Contact_Name.name:"canvas"!==d&&l&&(s=$L("#associatedContName").val()),Crm.trackSpotLightAction("ZDesk - Create Ticket",{Module:i}),!p)if(l){var g=$("#associatedContEmail").val();this.setData("desk_contactemail",g&&validationUtils.isValidEmail(g)?g:p)}else{var v=this.getKeyValueForTicketCriteria();"email"===v.key&&this.setData("desk_contactemail",v.value.split(",")[0])}if(!c&&"Accounts"!==i&&(this.setData("desk_contactname",l?s:n),!this.getData("desk_contactname"))){var D=$L("#entityName").val();this.setData("desk_contactname",D)}"Products"===i&&"canvas"!==d&&this.setData("desk_productname",$("#subvalue_PRODUCTNAME").text()),u||"canvas"!==d?u||this.setData("desk_accountname","Accounts"===crmRelatedList.Module?$("#subvalue_ACCOUNTNAME").text():$("#subvalue_ACCOUNTID").text()):this.setData("desk_accountname","Accounts"===i?store.peekAll(r)[0].Account_Name:""),c=this.getData("desk_contactname"),m=this.getData("desk_productname"),p=this.getData("desk_contactemail"),u=this.getData("desk_accountname"),c&&(o=o+"&"+encodeURIComponent("property(Contact Name)")+"="+encodeURIComponent(c)),m&&(o=o+"&"+encodeURIComponent("property(Product Name)")+"="+encodeURIComponent(m)),y&&(o=o+"&"+encodeURIComponent("property(whoName:Contact Name)")+"="+y),h&&(o=o+"&"+encodeURIComponent("property(actName:Account Name)")+"="+h),k&&(o=o+"&"+encodeURIComponent("property(prodName:Product Name)")+"="+k),p&&(o=o+"&"+encodeURIComponent("property(Email)")+"="+encodeURIComponent(p)),f&&(o=o+"&"+encodeURIComponent("property(Phone)")+"="+encodeURIComponent(f)),u&&(o=o+"&"+encodeURIComponent("property(Account Name)")+"="+encodeURIComponent(u)),this.setData("ticketcreationurl",o),this.setData("ticketcreationshow",!0),deskInteg.handleScroll(!0)},hideCreateTicketPopup:function(){this.setData("ticketcreationurl"," "),this.setData("ticketcreationshow",!1),this.getData("newticketlinkshow")?this.executeMethod("getDeskTickets",this.getCurrentTicketPage(),!0,void 0,void 0,!0):this.executeMethod("getDeskTickets",this.getCurrentTicketPage(),!0,void 0,void 0,void 0),deskInteg.handleScroll(!1)},hideSubjectTooltip:function(){crmui.toolTip_hide()},showToolTip:function(t,e,a){crmui.showTooltip(t,e,a)},closeTicketUpdatePop:function(){this.setData("errorFieldShow",!1),document.querySelector("#tktFldPop").setData("ltPropShow",!1)},toggleStats:function(){var t=this.getData("deskTicketsSummaryShow"),e={viewStats:t,action:"manageStats"};t?($L("#deskTicketsSummary").slideUp(),this.setData("deskTicketsSummaryShow",!1),this.setData("ticketStatsLinkText",I18n.getMsg("crm.zdesk.showstats"))):($L("#deskTicketsSummary").slideDown(),this.setData("deskTicketsSummaryShow",!0),this.setData("ticketStatsLinkText",I18n.getMsg("crm.zdesk.hidestats"))),store.createRecord("dummy"),store.create("dummy",void 0,{url:this.getData("url_desk"),method:"POST"},e)},showAnimatePopup:function(t){var e=document.getElementById(t);e.setData("ltPropShow",!0),e.setData("ltPropOffset",{top:"0px",left:"center"})},hideAnimatePopup:function(t){document.getElementById(t).setData("ltPropShow",!1)},linkToPotential:function(t){if(Crm.trackSpotLightAction("ZDesk - Ticket Link Potential"),!t){if("Potentials"!==this.getData("module"))return;t=this.getData("entityId")}freezeBackground();var e=this.getData("selectRowId"),a={potentialId:t,ticketIds:JSON.stringify(e),action:"linkToPotential"},i=this;store.createRecord("dummy"),commonUtils.showHideLoadingDiv(!0),store.create("dummy",void 0,{url:this.getData("url_desk"),method:"POST"},a).then((function(t){commonUtils.showHideLoadingDiv();var e=t.dummy;if("success"===e.status){var a=e.linkedTickets,o=a.length,s={},n={};n.potentialId=e.potentialId,n.potential=e.potentialName;var l=i.data.ticketPotentials;if(Object.keys(i.data.ticketPotentials).length>0){s=l;for(var r=0;r<o;r++)Lyte.objectUtils(l,"add",a[r],n),$("#ticket_"+a[r]).addClass("deskBgAnim")}else{for(r=0;r<o;r++)s[a[r]]=n,$("#ticket_"+a[r]).addClass("deskBgAnim");i.setData("ticketPotentials",s)}i.executeMethod("getDeskTickets",i.getCurrentTicketPage(),void 0,void 0,void 0,void 0),i.actions.clearSelect.call(i);setTimeout((function(){i.executeMethod.removeAnimClass(a)}),2e3),crmui.showMsgBand("success",I18n.getMsg(e.message),3e3)}else crmui.showMsgBand("error",I18n.getMsg(e.message),3e3);removeFreezeLayer()}))},unlinkTickets:function(){var t={potentialId:0,action:"linkToPotential"},e=this.getData("selectRowId");t.ticketIds=JSON.stringify(e);var a=e,i=e.length,o=this;store.createRecord("dummy"),commonUtils.showHideLoadingDiv(!0),store.create("dummy",void 0,{url:this.getData("url_desk"),method:"POST"},t).then((function(t){commonUtils.showHideLoadingDiv();var e=t.dummy;if("success"===e.status){if("Potentials"==o.getCurrentTicketType(o.getData("module")))o.executeMethod("getDeskTickets",o.getCurrentTicketPage(),void 0,void 0,void 0,void 0);else{for(var s=o.data.ticketPotentials,n=0;n<i;n++)Lyte.objectUtils(s,"delete",a[n]),$("#ticket_"+a[n]).addClass("deskBgAnim");setTimeout((function(){o.executeMethod.removeAnimClass(a)}),2e3)}o.actions.clearSelect.call(o),crmui.showMsgBand("success",I18n.getMsg(e.message),3e3)}else crmui.showMsgBand("error",I18n.getMsg(e.message),3e3)}),(function(){crmui.showMsgBand("error",I18n.getMsg("crm.zdesk.err.unlink"),3e3)}))},showPortalEvent:function(t,e){event&&(event.cancelBubble=!0,event.stopPropagation&&event.stopPropagation()),$L(e).next().show()},showToolTipOnClick:function(t,e){crmui.showTooltip(t,!1,"center",e)},hideToolTipOnClick:function(){crmui.hideTooltip()},setStyle:function(){document.getElementById("loadMsg").style.display="none"}},methods:{onSearch:function(t){this.setData("noResult",0===t.length?"block":"none")},clearSelectEntry:function(){var t=document.getElementById("dropdownSearch");t&&t.setValue("")},removeAnimClass:function(t){for(var e=t.length,a=0;a<e;a++)$("#ticket_"+t[a]).removeClass("deskBgAnim")},onCheckedUpdateRowSelection:function(t){Lyte.arrayUtils(this.getData("selectRowId"),"push",t),this.setSelectedRowCount("increment");var e=$("#flipCard_"+t);e.removeClass("flipCard"),e.addClass("flipCard flipped"),this.ticketActionDisplay()},onUnCheckedUpdateRowSelection:function(t){var e=this.getData("selectRowId").indexOf(t);Lyte.arrayUtils(this.getData("selectRowId"),"splice",e,1),this.setSelectedRowCount("decrement");var a=$("#flipCard_"+t);a.removeClass("flipCard flipped"),a.addClass("flipCard"),this.ticketActionDisplay()},next:function(t){var e=this.getData("pageNum");e+=1,this.executeMethod("getDeskTickets",e,void 0,t,void 0,void 0)},prev:function(t){var e=this.getData("pageNum");e-=1,t?this.executeMethod("getDeskTickets",e,void 0,t,!0,void 0):this.executeMethod("getDeskTickets",e,void 0,t,void 0,void 0)},loadCurrentUserInfo:function(t){var e=this.getData("currentUser"),a=this;if(this.getData("portalUser")&&validationUtils.isEmpty(e)){var i=this.getData("url_desk");commonUtils.showHideLoadingDiv(!0),store.findAll("dummy",{action:"getMyDeskInfo"},void 0,!1,{url:i}).then((function(e){commonUtils.showHideLoadingDiv(),a.setData("currentUser",e),a.changeIframeTicket(t),a.setData("showIframeUrl",!0),a.setData("iframeshow",!0),a.getData("ticketDetailPrevShow")?$("#ticketDetailPrev").show():$("#ticketDetailPrev").hide(),a.getData("ticketDetailNextShow")?$("#ticketDetailNext").show():$("#ticketDetailNext").hide(),window.addEventListener("message",(function(t){t.origin==location.protocol+"//"+a.getData("deskUrl")&&(Crm.trackSpotLightAction("ZDesk - Ticket Comment"),t.source.postMessage(Crm.userDetails.ZUID,t.origin))}),!1)}))}else a.changeIframeTicket(t),a.setData("showIframeUrl",!0),a.setData("iframeshow",!0),a.getData("ticketDetailPrevShow")?$("#ticketDetailPrev").show():$("#ticketDetailPrev").hide(),a.getData("ticketDetailNextShow")?$("#ticketDetailNext").show():$("#ticketDetailNext").hide(),window.addEventListener("message",(function(t){t.origin==location.protocol+"//"+a.getData("deskUrl")&&(Crm.trackSpotLightAction("ZDesk - Ticket Comment"),t.source.postMessage(Crm.userDetails.ZUID,t.origin))}),!1)},updateTicketStats:function(t){if(t){var e=t.customerHappiness;if(this.setData("totalTickets",t.totalTickets),this.setData("overdueTickets",t.overdueTickets),this.setData("avgSolTimeSpan",t.resolutionTime),this.setData("avgResTimeSpan",t.responseTime),this.setData("deskTicketsSummaryShow",!0),e){var a=parseInt(e.okCount)+parseInt(e.goodCount)+parseInt(e.badCount);if(a>0){var i=parseInt(e.goodCount)/a*100;i=this.executeMethod("roundOff",i,0),this.setData("cusHapRateShow",!0),this.setData("cusHapRateValue",i+"%"),i>70?this.setData("Smileytype","happySmiley"):i>35?this.setData("Smileytype","confusedSmiley"):this.setData("Smileytype","sadSmiley"),this.setData("noHapShow",!1)}}}else this.setData("totalTickets","0"),this.setData("overdueTickets","0"),this.setData("avgSolTimeSpan","00:00"),this.setData("avgResTimeSpan","00:00"),this.setData("deskTicketsSummaryShow",!1),this.setData("cusHapRateShow",!1),this.setData("noHapShow",!0)},updateNewValueField:function(){var t=document.querySelector("#updateFieldName").ltProp("selected"),e=this.getData("fieldProps")[t];this.setData("errorFieldShow",!1);var a="crm.zdesk.update.choose";if("assigneeId"===e.name)this.showAgentsForDepartment();else if("Picklist"===e.type||"Boolean"===e.type){this.setData("fieldUpSelectData",[]);var i={};"Boolean"!==e.type||e.allowedValues||(e.allowedValues.push({value:!0}),e.allowedValues.push({value:!1}));for(var o=e.allowedValues.length,s=0;s<o;s++){i={};var n=e.allowedValues[s].value;i={name:n,value:n},Lyte.arrayUtils(this.getData("fieldUpSelectData"),"push",i)}document.querySelector("#fieldUpdSelect").ltProp("selected",this.getData("fieldUpSelectData")[0].value),this.setData("fieldUpdTextOptionShow",!1),this.setData("fieldUpdSelectOptionShow",!0)}else"DateTime"===e.type?(this.setData("fieldUpdSelectOptionShow",!1),this.setData("plainTextShow",!1),this.setData("dateTextShow",!0),this.setData("fieldUpdTextOptionShow",!0)):("Phone"===e.type?this.setData("fieldObjType","Number"):this.setData("fieldObjType",e.type),this.setData("fieldObjMaxLength",e.maxLength),this.setData("fieldUpdSelectOptionShow",!1),this.setData("dateTextShow",!1),this.setData("plainTextShow",!0),this.setData("fieldUpdTextOptionShow",!0),a="crm.zdesk.update.enter");this.setData("deskupdateFieldMsgText",I18n.getMsg(a,e.i18NLabel))},uncheckMandatory:function(t){if(t.mandatory)return!1},unSortMandatory:function(t,e){return!e.mandatory},getDeskTickets:function(t,e,a,i,o){var s=this.getData("module");Crm.trackSpotLightAction("ZDesk - Ticket Fetch");var n={pageToken:t,ticketType:this.getCurrentTicketType(s),module:s,action:"getTickets"},l=this.getKeyValueForTicketCriteria();n[l.key]=l.value;var r=this;store.createRecord("dummy"),commonUtils.showHideLoadingDiv(!0),store.create("dummy",void 0,{url:this.getData("url_desk"),method:"POST"},n).then((function(t){commonUtils.showHideLoadingDiv();var s=t.dummy;if(r.setData("showNavigation",!1),r.setDeskTicketData(s),r.getData("newticketlinkshow")&&r.setData("noTicketnewTicketLinkShow",!1),s.ticketError&&(r.setData("ticketError",s.ticketError),r.setData("data",[])),o&&(r.setData("newticketlinkshow",!0),r.setData("noTicketnewTicketLinkShow",!1),r.setData("showColumnShow",!0),r.setData("cruxcolumShowfromfilter",!0)),a){var n=document.querySelector("crm-zdesk-iframe").component;i?n.executeMethod("reloadTickets",!0):n.executeMethod("reloadTickets",!1)}if(e){var l=document.querySelector("#ticketFilterSelect"),d=null;if(null!==l&&(d=l.ltProp("selected")),r.getData("rowCountVis")>0||null!==d&&"All"!==d)r.setData("deskRelatedListMenuShow",!0);else if(r.setData("deskRelatedListMenuShow",!1),r.setData("deskTheadRowShow",!1),"crm.zdesk.notickets"===s.ticketError&&r.displayDeskWindow()){if(r.setData("ticketError",s.ticketError),r.setData("noTicketnewTicketLinkShow",!0),document.querySelector("crm-zdesk-rl-label"))document.querySelector("crm-zdesk-rl-label").component.setData("refreshIconShow",!0);r.getData("portalUser")&&$("[id='addNewIcP_Zoho Desk']").removeClass("dN")}}}))},populateIntegDetails:function(){var t=RebrandLinkUtil.getProperty("ZSUPPORTURL");"https:"===location.protocol&&(t=(t=t.replace("9090","9443")).replace("8080","8443")),this.setData("deskUrl",t);var e=document.domain.includes("crmplus")?"CrmPlusURL":document.domain.includes("zcrm.zoho.com")?"ZCRMURL":"CRMURL";this.setData("crmUrl",RebrandLinkUtil.getProperty("URLPROTOCOL")+"://"+RebrandLinkUtil.getProperty(e))},setLyteNavigatorValues:function(t){var e=t.page,a=e.from-1;this.setData("fromIndex",a),this.setData("toIndex",e.to),this.setData("pageNum",e.pageNum),this.setData("leftPanelCount","0"),this.setData("rlCount","0");var i=document.querySelector("crm-zdesk-rl-label");0===e.pageNum&&e.hasOwnProperty("next")&&this.setData("showNavigation",!0),e.pageNum>0&&this.setData("showNavigation",!0),e.hasOwnProperty("next")&&"true"===e.next||e.pageNum>0?(this.setData("showNextNav",!1),e.pageNum>0?(this.setData("showPrevNav",!0),t.hasOwnProperty("tickets")&&this.setData("leftPanelCount",7*e.pageNum+t.tickets.length)):(this.setData("showPrevNav",!1),t.hasOwnProperty("tickets")&&this.setData("leftPanelCount",t.tickets.length)),e.hasOwnProperty("next")&&"true"===e.next&&(this.setData("leftPanelCount",this.getData("leftPanelCount")+"+"),this.setData("showNextNav",!0))):0===e.pageNum&&t.tickets&&t.tickets.length>0&&this.setData("leftPanelCount",t.tickets.length),"0"!==this.getData("leftPanelCount")?(i&&i.component.setData("rlCount",this.getData("leftPanelCount")),$("#newleft_"+this.getData("related_list_id")).find("span.numCountn").addClass("numCountVal").text(this.getData("leftPanelCount"))):t.tickets&&t.tickets.length>0?(i&&i.component.setData("rlCount",t.tickets.length),$("#newleft_"+this.getData("related_list_id")).find("span.numCountn").addClass("numCountVal").text(t.tickets.length)):(i&&i.component.setData("rlCount","0"),$("#newleft_"+this.getData("related_list_id")).find("span.numCountn").removeClass("numCountVal").text(" "))},roundOff:function(t,e){return Number(Math.round(t+"e"+e)+"e-"+e)}},summarizeTickets:function(t,e,a,i,o,s){var n=t.ticketStats;if(!n)return this.setData("ticketsStatsLinkShow",!1),this.setData("deskTicketsSummaryShow",!1),void Lyte.objectUtils(this.getData("supportObj"),"add","showStats",!1);this.setData("ticketsStatsLinkShow",!0),this.executeMethod("updateTicketStats",n),e&&(a||"0"===i||o&&s===I18n.getMsg("crm.zdesk.showstats")&&this.setData("deskTicketsSummaryShow",!1)),this.setData("desk_encryptedContactId",n.encryptedContactId),this.setData("desk_encryptedAccountId",n.encryptedAccountId);var l=n.contactId;if(t.tickets&&l)for(var r=t.tickets.length,d=0;d<r;d++){var p=t.tickets[d];if(p.contactId===l){var c=p.contact;if(c){this.setData("desk_contactname",c.lastName);var m=this.getData("desk_contactname");m&&c.firstName&&this.setData("desk_contactname",c.firstName+" "+m),this.setData("desk_contactemail",c.email),this.setData("desk_contactphone",c.phone),this.setData("desk_accountname",c.account?c.account.accountName:void 0);break}}}n.totalTickets<1&&(this.setData("ticketsStatsLinkShow",!1),this.setData("deskTicketsSummaryShow",!1))},getCurrentTicketType:function(t){var e=document.querySelector("#ticketFilterSelect"),a="All";return null!==e&&(a=e.ltProp("selected")),"Potentials"===t&&("Potentials"===a?this.setData("linkToThisPotentialShow",!1):this.setData("linkToThisPotentialShow",!0)),a},setDeskTicketData:function(t){var e=!1;if(this.setData("newticketlinkshow",!1),t.hasOwnProperty("ticketPotentials")&&this.setData("ticketPotentials",t.ticketPotentials),t.ticketError&&this.setData("ticketError",t.ticketError),t.hasOwnProperty("tickets")&&t.tickets.length>0&&(this.setData("deskTicketFilterShow",!0),this.setData("newticketlinkshow",!0),this.setData("deskRelatedListMenuShow",!0),this.setData("rowCountVis",t.tickets?t.tickets.length:0),this.setData("data",t.tickets),e=!0),t.hasOwnProperty("contactServerUrl")&&this.setData("contactServerUrl",t.contactServerUrl),t.hasOwnProperty("ticketHeadings")&&(this.setData("ticketHeadings",t.ticketHeadings),Crm.userDetails.IS_ADMIN&&this.setData("loadCruxColumn",!0)),e&&this.getData("ticketHeadings").length>0&&this.setData("deskTheadRowShow",!0),t.hasOwnProperty("ticketKeys")&&this.setData("ticketKeys",t.ticketKeys),t.hasOwnProperty("ticketFields")){var a={},i=[],o=[],s=t.ticketFields;this.setData("ticketFields",s);for(var n=s.length,l=0;l<n;l++){var r=s[l];(a={}).api_name=r.i18NLabel,void 0===r.id?a.id=Math.floor(1e10*Math.random()).toString():a.id=r.id,a.field_label=r.i18NLabel,a.name=r.name,r.isDisabledinCRM&&(a.mandatory=!0),r.isVisibleinCRM&&o.push(a),i.push(a)}this.setData("allFields",i),this.setData("selectedFields",o)}if(t.hasOwnProperty("emailContacts")){var d=t.emailContacts;this.setData("emailContacts",d)}t.hasOwnProperty("page")&&this.executeMethod("setLyteNavigatorValues",t)},showAgentsForDepartment:function(){var t,e=this.getData("selectRowId"),a=e.length,i=this.getData("data"),o=e[0];t=i.filter((function(t){return t.id===o}))[0].departmentId;var s=this;this.getAgentsDepartments(t,(function(t){var e=s.getData("deptAgents")[t];a=e.length,s.setData("fieldUpSelectData",[]);var i={name:"Unassigned",value:"Unassigned"};Lyte.arrayUtils(s.getData("fieldUpSelectData"),"push",i);for(var o=s.getData("agents"),n=0;n<a;n++){i={};var l=o[e[n]];if(l)i={name:l.firstName?l.firstName+" "+l.lastName:l.lastName,value:l.id+""},Lyte.arrayUtils(s.getData("fieldUpSelectData"),"push",i)}document.querySelector("#fieldUpdSelect").ltProp("selected",s.getData("fieldUpSelectData")[0].value),s.setData("fieldUpdTextOptionShow",!1),s.setData("fieldUpdSelectOptionShow",!0)}))},getAgentsDepartments:function(t,e){if(this.getData("deptAgents")[t])e&&e(t);else{var a={departmentId:t,action:"getAgents"},i=this;commonUtils.showHideLoadingDiv(!0),store.findAll("dummy",a,!1,!1,{url:this.getData("url_desk")}).then((function(a){commonUtils.showHideLoadingDiv();var o=a,s={};s[o.departmentId]=o.departmentAgents,i.setData("deptAgents",s);for(var n=o.departmentAgents.length,l={},r=0;r<n;r++){var d=o.departmentAgents[r];l[d]=o.agents[d]}i.setData("agents",l),e&&e(t)}))}},ticketActionDisplay:function(t){0===this.getData("selectedRowCount")?(this.setData("ticketSelectShow",!1),this.getData("deskTicketsSummaryShow")&&this.setData("ticketsStatsLinkShow",!0),(t&&t>0||this.getData("data")&&this.getData("data").length>0)&&(this.setData("deskTicketFilterShow",!0),this.setData("showColumnShow",!0),this.setData("newticketlinkshow",!0))):(this.setData("deskTicketFilterShow",!1),this.setData("ticketsStatsLinkShow",!1),this.setData("showColumnShow",!1),this.setData("newticketlinkshow",!1),this.setData("ticketSelectShow",!0))},getCurrentTicketPage:function(){var t=this.getData("pageNum"),e=parseInt(t);return isNaN(e)?0:e},changeIframeTicket:function(t){var e=$("#ticket_"+t.id),a=$("#desk_tickets_tbody tr").index(e),i=t.encryptedId,o=t.departmentId,s=this.getUrlForTicketDetailView(i,o),n=this.getData("data").length;this.setData("iframeURL",s),this.setData("detailTicketId",t.id);var l=this.getCurrentTicketPage();0==a&&l<1?(this.setData("ticketDetailPrevShow",!1),$("#ticketDetailPrev").hide()):($("#ticketDetailPrev").show(),this.setData("ticketDetailPrevShow",!0)),a<n-1||this.getData("showNavigation")&&this.getData("showNextNav")?(this.setData("ticketDetailNextShow",!0),$("#ticketDetailNext").show()):(this.setData("ticketDetailNextShow",!1),$("#ticketDetailNext").hide()),Crm.trackSpotLightAction("ZDesk - Ticket Detail View")},getKeyValueForTicketCriteria:function(){var t=this.getData("module"),e=this.getData("entity_id"),a=this.getData("email"),i={},o="",s=null,n=this.getData("module_emailColumns");if("Accounts"===t||"Potentials"===t||"Products"===t)s=e;else if(n)if(a)for(var l=a.length,r=0;r<l;r++){var d=a[r];(d=d?d.trim():d)&&validationUtils.isValidEmail(d)&&(o=o?o+","+d:d)}else"Contacts"!==t||a||(s=e);return o.length>0?(i.key="email",i.value=o):s&&(i.key="moduleId",i.value=s),i},updateDetailsForRL:function(t){t&&t.datePattern&&(this.setData("datePattern",t.datePattern),this.setData("portalUser",t.portalUser)),this.displayDeskWindow()||this.setData("newticketlinkshow",!1),this.setData("module_emailColumns",t&&t.module_emailColumns?t.module_emailColumns:["EMAIL","ADDN_EMAIL"])},displayDeskWindow:function(t){var e=this.getData("portalUser"),a=this.getData("currentUser");return t&&e?!(!a||!a.associatedDepartmentIds)&&a.associatedDepartmentIds.indexOf(t)>-1:e},getUrlForTicketDetailView:function(t,e){var a=this.getData("portalName"),i=this.getData("deskUrl"),o=this.getData("crmUrl");"undefined"!=typeof CrmPlusLib&&CrmPlusLib.isLoadedInCrmplusFrame&&CrmPlusLib.getFrameOriginForURL&&(o=CrmPlusLib.getFrameOriginForURL()+","+o);var s=this.getData("crmsupportzgid"),n="//"+i+"/support/"+a+"/";return n=this.displayDeskWindow(e)?n+"ShowHomePage.do?frameorigin="+encodeURIComponent(o)+"&isDeskAddOnRequest=true#Cases/dv/"+encodeURIComponent(t)+"?isDeskAddOnRequest=true":n+"ShowEntityInfo.do?frameorigin="+encodeURIComponent(o)+"&module=Cases&id="+encodeURIComponent(t)+"&isCrmCall=true&crmsupportzgid="+encodeURIComponent(s)+"&showThreads=true"},initializeData:function(){this.setData("selectRowId",[]),this.setData("selectedRowCount",0),this.setData("detailTicketId",""),this.setData("rowCountVis",7),this.setData("agents",{}),this.setData("deptAgents",{}),this.setData("datePattern",void 0),this.setData("desk_accountname",void 0),this.setData("desk_contactname",void 0),this.setData("desk_contactemail",void 0),this.setData("desk_contactphone",void 0),this.setData("desk_productName",void 0),this.setData("desk_encryptedContactId",void 0),this.setData("desk_encryptedAccountId",void 0),this.setData("desk_encryptedProductId",void 0),this.setData("ticketHeadings",void 0)},setSelectedRowCount:function(t){var e=this.getData("selectedRowCount");"increment"===t?e++:"decrement"===t&&0!==e?e--:(t="zero")&&(e=0),this.setData("selectedRowCount",e)},loadFieldProperties:function(t){var e=this.getData("fieldProps");if(e)t&&t();else{var a=this.getData("url_desk"),i=this;commonUtils.showHideLoadingDiv(!0),store.findAll("dummy",{action:"getFieldProperties"},!1,!1,{url:a}).then((function(a){commonUtils.showHideLoadingDiv(),e={};for(var o=a.field_properties,s=o.length,n=0;n<s;n++){var l=o[n];e[l.name]=l}i.setData("fieldProps",e),t&&t()}))}}}),Lyte.Component.registerHelper("isOverdueFlag",(function(t,e){if("Closed"===t)return!1;if(null!==e){var a=new Date(e);if((new Date).getTime()-a.getTime()>0)return!0}return!1})),Lyte.Component.registerHelper("getTimeInUserTZ",(function(t,e,a){var i;if(!t||t.length<1)return null;var o=new Date(t),s=o.getTime()+6e4*o.getTimezoneOffset(),n=new Date(s-6e4*Utils.getTimezoneOffset());if("dueDate"===e||"createdTime"===e){var l=new Date,r=l.getTime()+6e4*l.getTimezoneOffset(),d=new Date(r-6e4*Utils.getTimezoneOffset());if(d.getFullYear()===n.getFullYear()&&d.getMonth()===n.getMonth())switch(d.getDate()-n.getDate()){case 0:i="Today";break;case 1:i="Yesterday";break;case-1:i="Tomorrow"}}return a?Utils.getDateTimeInUserFormat(n,!0):i||Utils.getDateInUserDatePattern(n,!0)})),Lyte.Component.registerHelper("isOverDue",(function(t,e){if("Closed"!==t&&e){var a=new Date(e),i=(new Date).getTime()-a.getTime();if(i>0){var o=[],s=i/36e5,n="";if((s=Math.floor(s))>24){var l=s/24;s%=24,n=(l=Math.floor(l))+" Days ",o.push(n)}return n=n+s+" Hours",0===o.length&&o.push(n),o}}})),Lyte.Component.register("crm-zdesk-rl",{_template:'<template tag-name="crm-zdesk-rl"> <crm-zdesk-rl-label type="{{type}}" entity_id="{{entity_id}}" module="{{module}}" related_list_id="{{related_list_id}}" display_label="{{display_label}}"></crm-zdesk-rl-label> <crm-zdesk-rl-body rendered_from="non_canvas" entity_id="{{entity_id}}" module="{{module}}" related_list_id="{{related_list_id}}"></crm-zdesk-rl-body> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"componentDynamic",position:[3]}],_observedAttributes:["module","entity_id","related_list_id","display_label"],data:function(){return{module:Lyte.attr("string"),entity_id:Lyte.attr("string"),related_list_id:Lyte.attr("string"),display_label:Lyte.attr("string")}}}),function(t,e){var a,i,o,s={},n=[],l=[],r={},d={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",91:"meta",92:"meta",93:"meta",224:"meta"},p={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",187:"plus",188:"<",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},c={_:"-",plus:"=","{":"[","}":"]","|":"\\",":":";",'"':"'","<":",",">":".","?":"/","~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0"};function m(t){for(var e=1;e<=12;e++)if(t.toLowerCase()==="f"+e)return!0;return!1}function u(t){for(var e,a,i,o=y(t),s=[],n=0;n<o.length;n++)"ctrl"===(a=(a=o[n]).toLowerCase())||"command"===a||"alt"===a||"shift"===a?(o[n]="command"===o[n]?"meta":o[n],-1!=t.indexOf("+")&&(s.push(o[n]),o.splice(n,1),n--)):m(o[n])?o[n]=o[n].toLowerCase():(e=o[n],c[e]&&-1!=t.indexOf("+")&&(s.push("shift"),o[n]=c[o[n]]));return-1!==t.indexOf("+")?(o=o.join("+"),i=!0):(o=o.join(" "),i=!1),{modifier:s,newKey:o,modifierFlag:i}}function y(t){return-1!==t.indexOf("+")?t.split("+"):t.split(" ")}function h(e,a,o,s){if(a)f(),i=setTimeout((function(){var a;(a=!1!==(a=e.call(t,o,s))||a)||o.preventDefault(),r={},n=[],l=[]}),a);else{f();var d=e.call(t,o,s);(d=!1!==d||d)||o.preventDefault(),r={},n=[],l=[]}}function k(t,a){(function(t){var a=t;switch(t.tagName){case"BUTTON":case"LYTE-ACCORDION-ITEM":case"LYTE-NAV-ITEM":return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length);case"LYTE-MENU-ITEM":for(;"LYTE-MENU-BODY"!==a.tagName;)a=a.parentElement;for(var i=a.parent.ltProp("query"),o=e.querySelectorAll(i),s=0;s<o.length;s++)if(o[s].offsetWidth||o[s].offsetHeight||o[s].getClientRects().length)return!0;return!1}})(t="LYTE-BUTTON"===t.tagName?t.querySelector("button"):t)&&(a?(f(),o=setTimeout((function(){t.click(),r={},n=[],l=[]}),a)):(f(),t.click(),r={},n=[],l=[]))}function f(){clearTimeout(i),clearTimeout(o)}function g(t){var i,o;if(!(i=e.activeElement,("INPUT"===(o=i.tagName)&&-1===["checkbox","radio","file","color","range"].indexOf(i.type)||"true"===i.getAttribute("contenteditable")||"SELECT"===o||"TEXTAREA"===o)&&!i.classList.contains("lyte-shortcut"))){var m=function(t){var e=t.which;return d[e]?d[e]:p[e]?t.shiftKey?p[e]:c[p[e]]:String.fromCharCode(e).toLowerCase()}(t);d[t.which]?l.push(d[t.which]):(n.push(m),l.push(m)),function(t){for(var e in s){if(-1!==e.indexOf("r:")){var a=e.substring(2).match(new RegExp("^/(.*?)/([gimy]*)$"));if(new RegExp(a[1],a[2]).test(n.join(""))){r[e]=1;continue}r[e]=0}var i,o=y(e);if(r[e]=i=r[e]?r[e]:0,!c[o[i]]||"shift"!==t){if(c[t]&&c[t]===o[i]){for(var l=s[e],d=!1,p=0;p<l.length;p++)if(l[p].modifierFlag&&-1!==l[p].modifier.indexOf("shift")){r[e]++,d=!0;break}if(d)continue}o[i]===t?r[e]++:r[e]=0}}}(m);var u=function(t){var e=[],a={},i=function(t){var e=[];return t.altKey&&e.push("alt"),t.ctrlKey&&e.push("ctrl"),t.shiftKey&&e.push("shift"),t.metaKey&&e.push("meta"),e}(t);for(var o in r)if(-1!==o.indexOf("r:")&&r[o]>0)(d=s[o])._invokedKey=o,e.push(d);else for(var n=0;n<s[o].length;n++){var d;(d=s[o][n]).modifierFlag&&r[o]===y(o).length&&d.modifier.sort().join(" ")===i.sort().join(" ")?(d._invokedKey=0!==d.modifier.sort().length?d.modifier.sort().join("+")+"+"+o:o,e.push(d),a[o]=!0):d.modifierFlag||r[o]!==y(o).length||l.length!==y(o).length||(d._invokedKey=o,e.push(d),a[o]=!0)}for(var p in a)a[p]&&(r[p]=0);return e}(t);clearTimeout(a),a=setTimeout((function(){r={},n=[],l=[]}),1e3),u.length&&function(t,e){for(var a=0;a<t.length;a++){t[a].type;var i=t[a].value,o=t[a].wait,s=t[a]._invokedKey;"function"==typeof i?h(i,o,e,s):k(i,o)}}(u,t)}}function v(t,e,a){T.push({newKey:t,oldKey:void 0,value:e,options:a})}function D(t){return t=t.replace(/\s+/i," ")}function w(t,e,a){t="r:"+t;var i=a.wait?a.wait:0,o=typeof e;s[t]={type:o,value:e,wait:i}}function b(t){var e=u(D(t)),a=s[e.newKey];if(a)for(var i=0;i<a.length;i++){if(e.modifierFlag&&a[i].modifier.sort().join(" ")===e.modifier.sort().join(" ")){s[e.newKey].splice(i,1);break}if(!e.modifierFlag){s[e.newKey].splice(i,1);break}}}function T(t){!function(){for(var t=0;t<=9;t++)d[t+96]=t.toString();for(t=1;t<=12;t++)d[111+t]="f"+t;navigator.userAgent.match("Firefox")?(p[59]=":",p[173]="_"):(p[186]=":",p[189]="_")}(),t.addEventListener("keydown",g)}Object.defineProperty(T,"push",{writable:!1,value:function(t){var e=t.oldKey;if(e&&T.unregister(e),t.newKey){var a=D(t.newKey);if("regex"!==t.type){var i,o=t.value,n=u(a);i=t.options&&t.options.wait?t.options.wait:0;var l=typeof o;if(s[n.newKey]){for(var r=!0,d=0;d<s.length;d++)if(s[d].modifier.sort().join(" ")===n.modifier.sort().join(" ")){s[n.newKey][d]={type:l,value:o,modifier:n.modifier,modifierFlag:n.modifierFlag,wait:i},r=!1;break}r&&s[n.newKey].push({type:l,value:o,modifier:n.modifier,modifierFlag:n.modifierFlag,wait:i})}else s[n.newKey]=[{type:l,value:o,modifier:n.modifier,modifierFlag:n.modifierFlag,wait:i}]}else w(a,t.value,options)}}}),Object.defineProperty(T,"register",{writable:!1,value:function(t,e,a){a&&"regex"===a.type&&w(t,e,a);var i=typeof t;"string"===i||"object"===i?"object"===i?function(t,e,a){for(var i=0;i<t.length;i++)v(t[i],e,a)}(t,e,a):v(t,e,a):console.error("Invalid Type")}}),Object.defineProperty(T,"unregister",{writable:!1,value:function(t){if("object"==typeof t)for(var e=0;e<t.length;e++){b(t[e])}else b(t)}}),Object.defineProperty(T,"unregisterAll",{writable:!1,value:function(){for(var t in s)delete s[t]}}),T(e),t.shortcut=T}(window,document),Lyte.Component.register("crm-zdesk-iframe",{_template:'<template tag-name="crm-zdesk-iframe"> <lyte-modal lt-prop-height="625px" lt-prop-show="{{show}}" lt-prop-show-close-button="false" id="crmZdeskIframe" lt-prop-width="1265px"> <template is="registerYield" yield-name="modal"> <lyte-modal-content class="p0"> <div id="ticketDetailPrev" class="pF deskNavCircle leftNavCont" onclick="{{action(\'showTicketDetail\',expHandlers(1,\'-\'))}}"> <span class="previous dIB vam"></span> </div> <div class="cB"> <div id="ticketDetailNext" class="pF deskNavCircle rightNavCont" onclick="{{action(\'showTicketDetail\',1)}}"> <span class="next dIB vam"></span> </div> </div> <div class="fR deskIframeCloseCont pA"> <div class="svgIcons ico-close-small2 cP mL6 mR5 mT5 dIB" onclick="{{action(\'closeDeskPopup\')}}"></div> </div> <iframe id="deskIframe" frameborder="0" src="{{iframeurl}}" style="overflow:auto;width: 1250px; height: 620px;"></iframe> </lyte-modal-content> </template> </lyte-modal> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"attr",position:[1,1]},{type:"attr",position:[1,3,1]},{type:"attr",position:[1,5,1]},{type:"attr",position:[1,7]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}],_observedAttributes:["iframeurl","show"],data:function(){return{iframeurl:Lyte.attr("string"),show:Lyte.attr("boolean",{default:!0})}},init:function(){this.setData("show",!0)},actions:{closeDeskPopup:function(){var t=document.querySelector("crm-zdesk-rl-body").component;this.setData("show",!1),window.removeEventListener("message",(function(e){e.origin==location.protocol+"//"+t.getData("deskUrl")&&(Crm.trackSpotLightAction("ZDesk - Ticket Comment"),e.source.postMessage(Crm.userDetails.ZUID,e.origin))}),!1),deskInteg.handleScroll(!1)},showTicketDetail:function(t){Crm.trackSpotLightAction("ZDesk - Ticket Detail Quick Navigation");var e=document.querySelector("crm-zdesk-rl-body").component,a=(document.querySelector("crm-zdesk-iframe").component,e.getData("detailTicketId")),i=null;if(1==t?i=$("#ticket_"+a).next():-1==t&&(i=$("#ticket_"+a).prev()),i){var o=e.getData("data");if(1==i.length){var s=i.attr("id").replace("ticket_",""),n=o.filter((function(t){return t.id===s}));e.changeIframeTicket(n[0])}else 1==t?e.executeMethod("next",!0):e.executeMethod("prev",!0)}}},methods:{reloadTickets:function(t){var e=document.querySelector("crm-zdesk-rl-body").component,a=document.querySelector("crm-zdesk-iframe").component,i=e.getData("data"),o=$("#desk_tickets_tbody tr"),s=(t?o.last():o.eq(0)).attr("id");if(s){var n=s.replace("ticket_",""),l=i.filter((function(t){return t.id===n}));e.changeIframeTicket(l[0])}else a.actions.closeDeskPopup.call()}}});
