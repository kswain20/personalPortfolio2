Lyte.Component.register("crm-activity-rel-wrapper",{_template:'<template tag-name="crm-activity-rel-wrapper"> <template is="if" value="{{showBlankState}}"><template case="true"> <template is="if" value="{{isprintview}}"><template case="true"> <table width="95%" cellspacing="0" cellpadding="0"> <tbody><tr> <td width="15"></td> <td valign="top" class="printSecContent"> <div class="notd p15">{{getI18(\'crm.new.label.no.records\')}}</div> </td> </tr> </tbody></table> </template><template case="false"> <div id="{{parent_relation_name}}_split_no_data_div" cellspacing="0" cellpadding="0" class="norec w100per pR30 italic fontsmooth noDataFountDetailtxt">{{getI18(\'crm.new.label.no.records\')}}</div> </template></template> </template><template case="false"> <template is="if" value="{{canvas}}"><template case="true"> <lyte-event-listener class="actSplitEV" event-name="relatedList" on-fire="{{action(\'handleRefresh\')}}"> <template is="for" items="{{relation_names}}" item="relation_name" index="index"> <crm-activity-rel-list id="{{getPersonalityByRelation(relation_name)}}_split" entity_id="{{entity_id}}" rel_module="{{rel_module}}" module="{{getModuleByRelation(relation_name)}}" list_relation_id="{{related_list_id}}" translabel="{{item.label}}" personality="{{item.personality}}" showpopover="{{item.showpopover}}" pr_class="pLR10" fields_mandatory="{{getFieldsForRelation(relation_name)}}" relation_name="{{relation_name}}" canvas="{{canvas}}" layout_id="{{layout_id}}"></crm-activity-rel-list> </template></lyte-event-listener></template><template case="false"> <template is="for" items="{{subModuleData}}" item="item" index="index"> <crm-activity-rel-list id="{{item.name}}_split" data="{{item.data}}" info="{{item.info}}" entity_id="{{item.entity_id}}" rel_module="{{item.rel_module}}" module="{{item.module}}" list_relation_id="{{item.list_relation_id}}" translabel="{{item.label}}" personality="{{item.personality}}" showpopover="{{item.showpopover}}" subject="{{item.subject}}" isprintview="{{isprintview}}" dateformat="{{dateformat}}" fields="{{item.fields.fields}}" headings="{{item.headings}}" fieldsforrel="{{item.fieldsforrel}}" pr_class="{{getPRClass(isprintview,item.module,index,subModuleData)}}" txt_ln="{{txt_ln}}"></crm-activity-rel-list> </template></template></template></template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,0,3,1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"for",position:[1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"for",position:[1],dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}]}},default:{}}]}},default:{}}],_observedAttributes:["subModuleData","showBlankState","isprintview","dateformat","canvas","parent_relation_name","relation_names","entity_id","rel_module","related_list_id","layout_id","txt_ln"],data:function(){return{subModuleData:Lyte.attr("array"),showBlankState:Lyte.attr("boolean"),isprintview:Lyte.attr("boolean"),dateformat:Lyte.attr("string"),canvas:Lyte.attr("boolean",{default:!1}),parent_relation_name:Lyte.attr("string"),relation_names:Lyte.attr("array"),entity_id:Lyte.attr("string"),rel_module:Lyte.attr("string"),related_list_id:Lyte.attr("string"),layout_id:Lyte.attr("string"),txt_ln:Lyte.attr("number")}},init:function(){if(!this.getData("isprintview")){var e="Activities"===this.getData("parent_relation_name")?["Tasks","Events","Calls","Open_Appointments__s"]:["Tasks_History","Events_History","Calls_History","Appointments_History__s"],t=[],a=this.getData("canvas"),i=null,o=null,r=[],s=0;try{(i=a?this.$node.parentNode.parentNode.parentNode.getElementsByTagName("crm-more-component"):i)&&i.length&&(o=i[0].getData("dropDownArray")),e.forEach((function(e){var a=Lyte.Component.registeredHelpers.getModuleByRelation(e),i="Crm_Implied_View_"+a,n="Crm_Implied_Create_"+a;if(moduleRecordMapping&&moduleRecordMapping[a]&&moduleRecordMapping[a].visible&&Crm.userDetails.permissions[i]){Lyte.Component.registeredHelpers.isRelationVisible(e)&&(t.push(e),Crm.userDetails.permissions[n]&&o&&o[s]&&r.push(o[s]));var l=Lyte.Component.registeredHelpers.getPersonalityByRelation(e).toLocaleLowerCase();crmRelatedList.personalityArr?crmRelatedList.personalityArr.indexOf(l)>-1||(crmRelatedList.personalityArr=crmRelatedList.personalityArr+"||"+l):crmRelatedList.personalityArr=l}s++})),i&&i.length&&i[0].setData("dropDownArray",r)}catch(e){"undefined"!=typeof murphy&&murphy.error(e)}this.setData("relation_names",t)}if(!this.canvas){var n=this.getData("subModuleData");n&&n.forEach((function(e){var t=e.fields&&e.fields.fields?e.fields.fields.removeAll(["Subject","Event_Title","Appointment_Name","Due_Date","Owner","Start_DateTime","End_DateTime","All_day","Call_Start_Time","Appointment_Start_Time","Member"]):void 0;if(t){var a=e.headings,i={};a.forEach((function(e){t.contains(e.api_name)&&(i[e.api_name]=e)}));var o={};o[e.personality]=i,e.fieldsforrel=o}}))}"undefined"==typeof Customization&&(Customization={},Customization.displayFieldMap={Leads:["Full_Name","Last_Name"],Activities:["Subject"],Accounts:["Account_Name"],Contacts:["Full_Name","Last_Name"],Deals:["Deal_Name"],Potentials:["Deal_Name"],Campaigns:["Campaign_Name"],Cases:["Subject"],Solutions:["Solution_Title"],Products:["Product_Name"],Vendors:["Vendor_Name"],PriceBooks:["Price_Book_Name"],Quotes:["Subject"],SalesOrders:["Subject"],PurchaseOrders:["Subject"],Invoices:["Subject"],Visits:["Visited_Page"],Appointments:["Appointment_Name"],Services:["Service_Name"],Tasks:["Subject"],Calls:["Subject"],Events:["Event_Title"]})},setRecordCount:function(){var e=this.getData("relation_names"),t=0,a=!1;e.forEach((function(e){var i="#"+Lyte.Component.registeredHelpers.getPersonalityByRelation(e)+"_split",o=$L(i);if(o&&o.length&&"function"==typeof o[0].getData){var r=o[0].getData("info");r&&(t=t+(r.page-1)*r.per_page+r.count,a=a||r.more_records)}}));var i=this.getData("parent_relation_name"),o="Activities"===i?$L("#activity_split_wrapper"):$L("#activity_history_split_wrapper"),r=$L("#"+i+"_split_no_data_div"),s=$L("#RL_dataCount_"+this.getData("related_list_id"));if(t>0){var n=a?t+"+":t;o.show(),s.css({height:"10px",padding:"2px 5px",backgroundColor:"#E0E0E0",borderRadius:"2px",lineHeight:"12px",display:"inline-block",textAlign:"center",fontSize:"12px",marginLeft:"8px",cursor:"auto"}),s.text(n),r.hide()}else s.hide(),o.hide(),r.show()},setDataInComponent:function(e){("Activities"===this.getData("parent_relation_name")?["Tasks","Events","Calls","Open_Appointments__s"]:"Activities_History"===this.getData("parent_relation_name")?["Tasks_History","Events_History","Calls_History","Appointments_History__s"]:[e]).forEach((function(e){var t=Lyte.Component.registeredHelpers.getModuleByRelation(e);if(moduleRecordMapping[t]&&moduleRecordMapping[t].visible){var a=Lyte.Component.registeredHelpers.getPersonalityByRelation(e),i=$L("#"+a+"_split")[0];i&&i.component.setDataInComp(!1,null,this)}}))},actions:{handleRefresh:function(){this.setDataInComponent(this.getData("parent_relation_name"))}},didConnect:function(){try{this.getData("canvas")&&("Activities"===this.getData("parent_relation_name")?$("#activity_split_wrapper").parent().css("overflow","auto"):"Activities_History"===this.getData("parent_relation_name")&&$("#activity_history_split_wrapper").parent().css("overflow","auto"))}catch(e){murphy.error(e)}}}),Lyte.Component.register("crm-activity-rel-list",{_template:'<template tag-name="crm-activity-rel-list"> <div class="actColumn fL pB10"> <div class="title_grey crm-font-bold"> <span class="svgIconsImg dIB vam aspIco-{{translabel}}"></span> <span class="col222 toCapital f15 mL5 vam dIB">{{translabel}}</span> <span class="f14 col222 vam dIB actSplitCount"> {{getSubActivtyCount(info)}}</span> </div> <template is="if" value="{{expHandlers(isPermissionDenied,\'===\',true)}}"><template case="true"> <div class="p30 aligncenter fontsmooth">{{unescape(getI18n(\'crm.canvas.component.permission.denied\'))}}</div> </template><template case="false"><template is="if" value="{{isLoading}}"><template case="true"> <div class="noDataFountDetailtxt p10 mLR10 crm-font-regular col999">{{getI18n(\'crm.admin.loading\')}}</div> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(data,\'!\'),\'||\',expHandlers(data.length,\'===\',0))}}"><template case="true"> <div class="actColumnValues"> <ul class="actColumnList m0 p0"> <li> <div class="crm-font-regular col999">{{getI18n(\'crm.new.label.no.records\')}}</div> </li> </ul> </div> </template><template case="false"> <div class="actColumnValues"> <ul class="actColumnList m0 p0" onscroll="{{action(\'viewMoreData\',this)}}"> <template is="for" items="{{data}}" item="item" index="index"> <li> <div class="clearAfterB pR"> <template is="if" value="{{expHandlers(item.$approval_state,\'===\',\'approval_process_pending\')}}"><template case="true"> <span class="iconlock_ap fR" title="{{getI18(&quot;crm.approvalProcess.label.waitingForApproval&quot;)}}" alt="{{getI18(&quot;crm.approvalProcess.label.waitingForApproval&quot;)}}"></span> </template><template case="false"><template is="if" value="{{expHandlers(item.$approval_state,\'===\',\'merge_pending\')}}"><template case="true"> <span class="iconlock_ap fR" title="{{getI18(&quot;crm.approvalProcess.label.waitingForFindAndMerge&quot;)}}" alt="{{getI18(&quot;crm.approvalProcess.label.waitingForFindAndMerge&quot;)}}"></span> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(item.$approval_state,\'===\',\'review_process_pending\'),\'||\',expHandlers(item.$approval_state,\'===\',\'review_process_rejected\'))}}"><template case="true"> <span class="iconlock_ap fR" title="{{getI18(&quot;crm.reviewprocess.record.review.pending&quot;)}}" alt="{{getI18(&quot;crm.reviewprocess.record.review.pending&quot;)}}"></span> </template></template></template></template></template></template> <div class="f15 robotoRegular cP aspH17 actSubject"> <template is="if" value="{{expHandlers(isprintview,\'!\')}}"><template case="true"> <link-to lt-prop-class="link dIB" data-zcqa="relatedList_{{getSubject(module,item)}}_Activities" lt-prop-route="crm.tab.module.entity.detail" lt-prop-dp="[&quot;{{module}}&quot;,&quot;{{item.id}}&quot;]" lt-prop-td="{&quot;fromActivityListView&quot;:&quot;true&quot;,&quot;pfrom&quot;:&quot;rel&quot;,&quot;module&quot;:&quot;{{module}}&quot;,&quot;id&quot;:&quot;{{item.id}}&quot;,&quot;pn&quot;:&quot;{{personality}}&quot;,&quot;peId&quot;:&quot;{{entity_id}}&quot;,&quot;bMod&quot;:&quot;{{rel_module}}&quot;,&quot;fromActSubModuleListView&quot;:&quot;true&quot;,&quot;lookback&quot;:&quot;true&quot;}"> <template is="if" value="{{item.$colour_code}}"><template case="true"> <div class="pR"> <span class="dIB eventColor_rL_split" data-zcqa="colorspan_{{getSubject(module,item)}}" style="background: {{item.$colour_code}}"></span> </div> </template></template> {{getSubject(module,item)}} </link-to> <template is="if" value="{{item.$in_project_sync}}"><template case="true"> <i style="margin-bottom: 2px;" class="task_syncIcon vam mL5 pA" lt-prop-title="{{concat(getI18n(&quot;crm.schedules.prefix.in&quot;),getI18n(&quot;crm.integ.sync.message&quot;,&quot;crm.project.integration.title&quot;))}}" lt-prop-tooltip-config="{&quot;position&quot;:&quot;followcursor&quot;, &quot;appearance&quot; : &quot;box&quot;}"></i> </template></template> <template is="if" value="{{expHandlers(expHandlers(item.$approved,\'||\',expHandlers(item.$approved,\'==\',null)),\'||\',expHandlers(expHandlers(item.$approved,\'!\'),\'&amp;&amp;\',expHandlers(item.$approval_state,\'===\',\'approval_process_rejected\')))}}"><template case="true"> <span id="act_split_origin_{{item.id}}" class="ico-dots-circle-filled2 svgIconsImg pA dN {{if(item.$in_project_sync,\'mL30\',\'mL10\')}} " data-zcqa="relatedListMore_{{getSubject(module,item)}}_{{module}}" onclick="{{action(\'showMoreOptions\',item,this)}}"></span> </template></template> </template><template case="false"> <template is="if" value="{{item.$colour_code}}"><template case="true"> <div class="pR"> <span class="dIB eventColor_rL_split" data-zcqa="colorspan_{{getSubject(module,item)}}" style="background: {{item.$colour_code}}"></span> </div> </template></template> {{getSubject(module,item)}} </template></template><template is="if" value="{{item.$in_project_sync}}"><template case="true"> <i style="margin-bottom: 2px;" class="task_syncIcon vam mL5 pA" lt-prop-title="{{concat(getI18n(&quot;crm.schedules.prefix.in&quot;),getI18n(&quot;crm.integ.sync.message&quot;,&quot;crm.project.integration.title&quot;))}}" lt-prop-tooltip-config="{&quot;position&quot;:&quot;followcursor&quot;, &quot;appearance&quot; : &quot;box&quot;}"></i> </template></template> <template is="if" value="{{expHandlers(expHandlers(personality,\'==\',\'TASKSPERSONALITY\'),\'&amp;&amp;\',expHandlers(process_flow,\'!\'))}}"><template case="true"> <span class="pA markAsCompletedIcon dN" data-zcqa="lnk_close_Tasks" deleteaction="javascript:sortRelatedList(\'{{getActivityActionLink(\'closeTask\',null,item.id)}}\',null,\'{{item.id}}\')" lt-prop-tooltip-config="{&quot;position&quot; : &quot;left&quot;}" lt-prop-title="{{getI18n(\'crm.label.mark.completed\')}}" onclick="{{action(\'clickAction\',\'closeTask\',null,item)}}"> <crmutil-icon class="eventNone" deleteaction="javascript:sortRelatedList(\'{{getActivityActionLink(\'closeTask\',null,item.id)}}\',null,\'{{item.id}}\')" icon-name="tick-rounded" icon-class="zcicn-tick-rounded zcicn16 zcicn_57b67a"></crmutil-icon> </span> </template><template case="false"><template is="if" value="{{expHandlers(personality,\'==\',\'CALLSPERSONALITY\')}}"><template case="true"> <span class="pA markAsCompletedIcon dN" data-zcqa="completeCallMoreOption" lt-prop-tooltip-config="{&quot;position&quot; : &quot;left&quot;}" lt-prop-title="{{getI18n(\'crm.label.mark.completed\')}}" onclick="{{action(\'callAction\',\'Completed\',item)}}"> <crmutil-icon class="eventNone" icon-name="tick-rounded" icon-class="zcicn-tick-rounded zcicn16 zcicn_57b67a "></crmutil-icon> </span> </template><template case="false"><template is="if" value="{{expHandlers(personality,\'==\',\'APPOINTMENTSPERSONALITY\')}}"><template case="true"> <template is="if" value="{{hasEditPermissionForApp}}"><template case="true"> <template is="if" value="{{isAppCompleteAction}}"><template case="true"> <span class="pA markAsCompletedIcon dN" id="completeAppMoreOption" lt-prop-tooltip-config="{&quot;position&quot; : &quot;left&quot;}" lt-prop-title="{{getI18n(\'crm.appointments.status.markcompleted1\')}}" onclick="{{action(\'showAppPopup\',\'appointmentCompletePopup\',this,appEndTime)}}" data-params="{&quot;module&quot;:&quot;Appointments&quot;,&quot;id&quot;:&quot;{{item.id}}&quot;,&quot;from&quot;:&quot;relatedlist_new&quot;}" data-zcqa="completeAppMoreOption"> <crmutil-icon class="eventNone" icon-name="tick-rounded" icon-class="zcicn-tick-rounded zcicn16 zcicn_57b67a "></crmutil-icon> </span> </template></template> </template></template> </template></template></template></template></template></template> </div> <div data-zcqa="relatedList_{{getSubject(module,item)}}_Activities_date_time" class="f13 date_time col222 mT2"> <template is="if" value="{{expHandlers(module,\'==\',\'Events\')}}"><template case="true"> {{convertEventDateTime(item.Start_DateTime,item.End_DateTime,item.All_day,false,dateformat)}} </template><template case="false"><template is="if" value="{{expHandlers(module,\'==\',\'Tasks\')}}"><template case="true"> {{convertTimeToUserDateFormatFromISO(item.Due_Date,true,dateformat)}} </template><template case="false"><template is="if" value="{{expHandlers(module,\'==\',\'Calls\')}}"><template case="true"> {{convertTimeToUserDateFormatFromISO(item.Call_Start_Time,false,dateformat)}} </template><template case="false"><template is="if" value="{{expHandlers(module,\'==\',\'Appointments\')}}"><template case="true"> {{convertTimeToUserDateFormatFromISO(item.Appointment_Start_Time,false,dateformat)}} </template></template></template></template></template></template></template></template> </div> <div purpose="showUserBC" data-zcqa="relatedList_{{getSubject(module,item)}}_Activities_owner" data-params="{&quot;userId&quot;:&quot;{{item.Owner.id}}&quot;}" class="wB jobSheetLevel f13 mT3 mB15 col222"> <span class="svgIconsImg dIB vam aspIco-user"></span> <span class="vam dIB mL2 ellipsistext mWid90per">{{item.Owner.name}}</span> </div> <template is="for" items="{{fields}}" item="field" index="index"> <template is="if" value="{{expHandlers(expHandlers(expHandlers(contains(excludeFields,field),\'!\'),\'&amp;&amp;\',validateField(item[field])),\'&amp;&amp;\',expHandlers(fieldsforrel[personality][field].data_type,\'!==\',\'textarea\'))}}"><template case="true"> <div data-zcqa="relatedList_{{getSubject(module,item)}}_Activities_{{field}}" class="f15 crm-font-regular date_time mT6 wsnormal"> <span class="col666 dIB aspBw actSplitLabel">{{fieldsforrel[personality][field].field_label}}</span> <span class="col666 vat ">:</span> <span class="col222 aspBw dIB vat pL2 actSplitValue "> <template is="if" value="{{expHandlers(fieldsforrel[personality][field].data_type,\'===\',\'datetime\')}}"><template case="true"> {{convertTimeToUserDateFormatFromISO(item[field],false,dateformat)}} </template><template case="false"><template is="if" value="{{expHandlers(fieldsforrel[personality][field].data_type,\'===\',\'date\')}}"><template case="true"> {{convertTimeToUserDateFormatFromISO(item[field],true,dateformat)}} </template><template case="false"><template is="if" value="{{expHandlers(fieldsforrel[personality][field].data_type,\'===\',\'multiselectpicklist\')}}"><template case="true"> {{arrayJoin(item[field],"; ")}} </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(fieldsforrel[personality][field].data_type,\'===\',\'lookup\'),\'||\',expHandlers(fieldsforrel[personality][field].data_type,\'===\',\'multi_module_lookup\'))}}"><template case="true"> <template is="if" value="{{expHandlers(fieldsforrel[personality][field].api_name,\'==\',&quot;What_Id&quot;)}}"><template case="true"> <crux-lookup-component cx-prop-value="{{item[field].name}}" cx-prop-route-name="crm.tab.module.entity.detail" cx-prop-dynamic-params="[&quot;{{if(ifEquals(item.$se_module,&quot;Deals&quot;),&quot;Potentials&quot;,getModuleNameByApiNameAsp(item.$se_module))}}&quot;, &quot;{{item[field].id}}&quot;]" onclick="{{action(\'stopPropagation\',event)}}" cx-prop-icon-class="{{concat(getModuleNameForIconForAct(item.$se_module),\'Small\')}} actSplitLookup" onmouseover="{{action(\'showHideRelatedFields\',item[field],fieldsforrel[personality][field].api_name,item.$se_module,event)}}" onmouseout="{{action(\'showHideRelatedFields\',undefined,undefined,undefined,event)}}" cx-prop-zcqa="{{item[field].name}}"></crux-lookup-component> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(fieldsforrel[personality][field].api_name,\'==\',&quot;Who_Id&quot;),\'||\',expHandlers(fieldsforrel[personality][field].api_name,\'==\',&quot;Appointment_For&quot;))}}"><template case="true"> <crux-lookup-component cx-prop-value="{{item[field].name}}" cx-prop-route-name="crm.tab.module.entity.detail" cx-prop-dynamic-params="[&quot;Contacts&quot;, &quot;{{item[field].id}}&quot;]" onclick="{{action(\'stopPropagation\',event)}}" onmouseover="{{action(\'showHideRelatedFields\',item[field],fieldsforrel[personality][field].api_name,\'Contacts\',event)}}" onmouseout="{{action(\'showHideRelatedFields\',undefined,undefined,undefined,event)}}" cx-prop-icon-class="{{concat(getModuleNameForIconForAct(\'Contacts\'),\'Small\')}} actSplitLookup" cx-prop-zcqa="{{item[field].name}}"></crux-lookup-component> </template><template case="false"><template is="if" value="{{expHandlers(fieldsforrel[personality][field].api_name,\'==\',&quot;Service_Name&quot;)}}"><template case="true"> <crux-lookup-component cx-prop-value="{{item[field].name}}" cx-prop-route-name="crm.tab.module.entity.detail" cx-prop-dynamic-params="[&quot;Services&quot;, &quot;{{item[field].id}}&quot;]" onclick="{{action(\'stopPropagation\',event)}}" onmouseover="{{action(\'showHideRelatedFields\',item[field],fieldsforrel[personality][field].api_name,item.$se_module,event)}}" onmouseout="{{action(\'showHideRelatedFields\',undefined,undefined,undefined,event)}}" cx-prop-icon-class="{{concat(getModuleNameForIconForAct(\'Services\'),\'Small\')}} actSplitLookup" cx-prop-zcqa="{{item[field].name}}"></crux-lookup-component> </template></template></template></template></template></template> </template><template case="false"> {{unescape(getFormattedValue(fieldsforrel[personality],field,module,item,true,null,true))}} </template></template></template></template></template></template></template></template> </span> </div> </template></template> </template> <template is="for" items="{{fields}}" item="field" index="index"> <template is="if" value="{{expHandlers(expHandlers(expHandlers(contains(excludeFields,field),\'!\'),\'&amp;&amp;\',validateField(item[field])),\'&amp;&amp;\',expHandlers(fieldsforrel[personality][field].data_type,\'===\',\'textarea\'))}}"><template case="true"> <div data-zcqa="relatedList_{{getSubject(module,item)}}_Activities_{{field}}" class="f15 crm-font-regular date_time mT10 wsnormal lH20"> <span class="col666 aspdB">{{fieldsforrel[personality][field].field_label}}:</span> <template is="if" value="{{expHandlers(expHandlers(isprintview,\'!\'),\'&amp;&amp;\',expHandlers(item[field].length,\'>\',txt_ln))}}"><template case="true"> <span class="wwbw" id="Activities_{{field}}_{{item.id}}_old"> {{formattedText(item[field],txt_ln)}} </span> <span class="link cP f14 dIB" data-zcqa="Activities_{{field}}_{{item.id}}_readMore" onclick="{{action(\'readMore\',this,item)}}" id="Activities_{{field}}_{{item.id}}" value="{{item[field]}}"> {{getI18n("crm.readmore")}} </span> </template><template case="false"> <span class="wwbw" id="Activities_{{field}}_{{item.id}}_old"> {{item[field]}} </span> </template></template> </div> </template></template> </template> </div> </li> </template> </ul> </div> </template></template></template></template></template></template> </div> <lyte-popover lt-prop="{&quot;width&quot;:&quot;auto&quot;,&quot;wrapperClass&quot;:&quot;samplePopover&quot;,&quot;freeze&quot;:false,&quot;type&quot;:&quot;callout&quot;,&quot;originElem&quot;:&quot;{{popoverOrigin}}&quot;}" lt-prop-scrollable="true" on-close="{{method(&quot;closePopup&quot;)}}" lt-prop-duration="{{ud}}" id="moreOptpop" lt-prop-placement="right bottom" lt-prop-show-close-button="false" lt-prop-show="{{lbind(showpopover)}}" lt-prop-content-padding="5px 0"> <template is="registerYield" yield-name="popover"> <lyte-popover-content> <ul class="m0 moreOptValues p0 f14"> <template is="if" value="{{expHandlers(personality,\'==\',\'CALLSPERSONALITY\')}}"><template case="true"> <li data-zcqa="scheduleCallMoreOption" onclick="{{action(\'callAction\',\'Scheduled\')}}"> <div class="link1"> {{getI18n(\'crm.label.reschedule.call\',\'\')}} </div> </li> <li class="bdr_btm" data-zcqa="cancelCallMoreOption" onclick="{{action(\'callAction\',\'Cancelled\')}}"> <div class="link1"> {{getI18n(\'crm.button.cancel\')}} </div> </li> </template><template case="false"><template is="if" value="{{expHandlers(personality,\'==\',\'APPOINTMENTSPERSONALITY\')}}"><template case="true"> <template is="if" value="{{hasEditPermissionForApp}}"><template case="true"> <li id="rescheduleAppMoreOption" onclick="{{action(\'showAppPopup\',\'Reschedule_Information\',this)}}" data-params="{&quot;module&quot;:&quot;Appointments&quot;,&quot;id&quot;:&quot;{{activity_id}}&quot;,&quot;from&quot;:&quot;relatedlist_new&quot;}" data-zcqa="rescheduleAppMoreOption"> <div class="link1"> {{getI18n(\'crm.appointments.status.markreschedule\',getSingularLabel(\'Appointments\'))}} </div> </li> <li id="cancelAppMoreOption" onclick="{{action(\'showAppPopup\',\'Cancellation_Information\',this)}}" data-params="{&quot;module&quot;:&quot;Appointments&quot;,&quot;id&quot;:&quot;{{activity_id}}&quot;,&quot;from&quot;:&quot;relatedlist_new&quot;}" data-zcqa="cancelAppMoreOption"> <div class="link1"> {{getI18n(\'crm.appointments.status.markcancel\',getSingularLabel(\'Appointments\'))}} </div> </li> </template></template> </template></template></template></template><template is="if" value="{{expHandlers(personality,\'!=\',\'CALLSHISTORYPERSONALITY\')}}"><template case="true"> <a class="fillAspLi link1" data-zcqa="relatedListEdit_{{module}}" href="javascript:;" data-params="{&quot;module&quot;:&quot;{{module}}&quot;,&quot;id&quot; : &quot;{{activity_id}}&quot;,&quot;from&quot;:&quot;relatedlist_new&quot;,&quot;goTo&quot;:&quot;{{personality}}&quot;}" data-cid="editbtn"> <li onclick="{{action(\'hidePopOver\')}}"> {{getI18n(\'Edit\')}} </li> </a> </template></template> <li deleteaction="javascript:sortRelatedList(\'{{getActivityActionLink(\'deleteLink\')}}\',null,\'{{activity_id}}\')" data-params="{&quot;module&quot;:&quot;{{module}}&quot;}" onclick="{{action(\'clickAction\',\'delete\',this)}}"> <div class="link1 fillAspLi" id="deletelink" data-zcqa="lnk_delete_{{module}}" deleteaction="javascript:sortRelatedList(\'{{getActivityActionLink(\'deleteLink\')}}\',null,\'{{activity_id}}\')" data-params="{&quot;module&quot;:&quot;{{module}}&quot;}" onclick="{{action(\'clickAction\',\'delete\',this)}}"> {{getI18n(\'Delete\')}} </div> </li> </ul> </lyte-popover-content> </template> </lyte-popover> </template>',_dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"text",position:[1,1,3,0]},{type:"text",position:[1,1,5,1]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1,1,1,1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"if",position:[1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,3,1]},{type:"if",position:[1,1,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'background: '","item.$colour_code"]}}}}]}},default:{}},{type:"text",position:[1,3]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3]},{type:"if",position:[3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"attr",position:[5]},{type:"if",position:[5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1],attr:{style:{name:"style",helperInfo:{name:"concat",args:["'background: '","item.$colour_code"]}}}}]}},default:{}},{type:"text",position:[3]}]}},default:{}},{type:"attr",position:[1,1,3,2]},{type:"if",position:[1,1,3,2],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"attr",position:[1,1,3,4]},{type:"if",position:[1,1,3,4],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1,1]}]}},default:{}}]}},default:{}}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,5]},{type:"attr",position:[1,1,5,1]},{type:"if",position:[1,1,5,1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,7]},{type:"text",position:[1,1,7,3,0]},{type:"attr",position:[1,1,9]},{type:"for",position:[1,1,9],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0]},{type:"attr",position:[1,5,1]},{type:"if",position:[1,5,1],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}}]}},default:{}}]}},default:{}}]},{type:"attr",position:[1,1,11]},{type:"for",position:[1,1,11],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]},{type:"attr",position:[3]},{type:"text",position:[3,1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1]}]}},default:{}}]}},default:{}}]}]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"if",position:[1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,1]},{type:"attr",position:[3]},{type:"text",position:[3,1,1]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,1]},{type:"attr",position:[3]},{type:"text",position:[3,1,1]}]}},default:{}}]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,2]},{type:"if",position:[1,1,2],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"text",position:[1,1,1]}]}},default:{}},{type:"attr",position:[1,1,4]},{type:"attr",position:[1,1,4,1]},{type:"text",position:[1,1,4,1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3]}],_observedAttributes:["data","info","entity_id","rel_module","module","list_relation_id","personality","showpopover","popoverOrigin","activity_id","subject","isprintview","dateformat","process_flow","approved","approval_state","pr_class","canvas","relation_name","isLoading","pr_class","isAppCompleteAction","hasEditPermissionForApp","appEndTime","fields","fieldsforrel","headings","excludeFields","layout_id","rlId","relatedList","fields_mandatory","isPermissionDenied","txt_ln"],data:function(){return{data:Lyte.attr("array"),info:Lyte.attr("object"),entity_id:Lyte.attr("string"),rel_module:Lyte.attr("string"),module:Lyte.attr("string"),list_relation_id:Lyte.attr("string"),personality:Lyte.attr("string"),showpopover:Lyte.attr("boolean",{default:!1}),popoverOrigin:Lyte.attr("string"),activity_id:Lyte.attr("string"),subject:Lyte.attr("string"),isprintview:Lyte.attr("boolean",{default:!1}),dateformat:Lyte.attr("string"),process_flow:Lyte.attr("boolean",{default:!1}),approved:Lyte.attr("boolean",{default:!0}),approval_state:Lyte.attr("string"),pr_class:Lyte.attr("string"),canvas:Lyte.attr("boolean",{default:!1}),relation_name:Lyte.attr("string"),isLoading:Lyte.attr("boolean",{default:!1}),pr_class:Lyte.attr("string"),isAppCompleteAction:Lyte.attr("boolean",{default:!0}),hasEditPermissionForApp:Lyte.attr("boolean",{default:!Crm.userDetails.permissions||Crm.userDetails.permissions.Crm_Implied_Edit_Appointments}),appEndTime:Lyte.attr("string"),fields:Lyte.attr("array"),fieldsforrel:Lyte.attr("object"),headings:Lyte.attr("array"),excludeFields:Lyte.attr("array"),layout_id:Lyte.attr("string"),rlId:Lyte.attr("string"),relatedList:Lyte.attr("object",{hideAttr:!0}),fields_mandatory:Lyte.attr("array"),isPermissionDenied:Lyte.attr("boolean",{default:!1}),txt_ln:Lyte.attr("number")}},init:function(){if(this.getData("canvas")){var e=store.peekAll("related_list",{module:this.getData("rel_module"),layout_id:this.getData("layout_id")}).filterBy({personality_name:Lyte.Component.registeredHelpers.getPersonalityByRelation(this.getData("relation_name"))}).filterBy({href:moduleApiMapping[this.getData("rel_module")]+"/{ENTITYID}/"+this.getData("relation_name")})[0].id;this.setData("rlId",e);this.setData("excludeFields",["Subject","Event_Title","Appointment_Name","Due_Date","Owner","Start_DateTime","End_DateTime","All_day","Call_Start_Time","Appointment_Start_Time","Member","$process_flow","$approved","$approval_state","$in_project_sync","$se_module"]),this.setDataInComp()}},setDataInComp:function(e,t,a){var i=this;app.store.makeRequest("findRecord","related_list",i.getData("rlId"),{module:moduleApiMapping[i.getData("rel_module")],layout_id:i.getData("layout_id"),include_inner_details:"fields.lookup,fields.ui_type,fields.formula,fields.field_label"}).then((function(o){if(void 0!==o){i.setData("isPermissionDenied",!1),i.setData("relatedList",o[0]),Lyte.Component.registeredHelpers.constructFieldsForRel(i,o[0].fields),a&&a.component&&a.component.getData||(a=i.$node.parentNode.parentNode);var r=i.getData("rel_module");if(i.getData("entity_id")&&"undefined"!==i.getData("entity_id")&&"null"!==i.getData("entity_id")&&i.getData("relation_name")&&moduleRecordMapping[r]){var s=i.getData("fields").join(),n="/crm/v3/"+moduleRecordMapping[r].api_name+"/"+i.getData("entity_id")+"/"+i.getData("relation_name"),l=Lyte.Component.registeredHelpers.getSortColumn(i.getData("relation_name")),p=i,c=$L("#fetch_"+a.component.getData("related_list_id"));n=n.replace("v2","v3"),t=t||1,c.removeClass("ref_complete").addClass(" ref_loading pointerEveNone");var d={data:[]},m={data:[]},u={},g=i.getData("info");if(g&&g.next_page_token)var f=store.findAll("dummy",{page_token:g.next_page_token,fields:s,page:t,per_page:10,sort_by:l,sort_order:p.getData("relation_name").indexOf("History")>-1?"desc":"asc",approved:"both"},!1,!1,{url:n});else f=store.findAll("dummy",{fields:s,page:t,per_page:10,sort_by:l,sort_order:p.getData("relation_name").indexOf("History")>-1?"desc":"asc",approved:"both"},!1,!1,{url:n});f.then((function(t){if(t.errors)crmui.showMsgBand("error",I18n.getMsg("error"));else{p.setData("isPermissionDenied",!1);var i=p.getData("data"),o=i&&i.length&&e?i.concat(t.data):t.data;if(p.setData("data",o),p.setData("info",t.meta),p.setData("isLoading",!1),$L(".actColumnList").scroll({preventHorizontal:!0}),a.component.setRecordCount(),c.removeClass("ref_loading pointerEveNone").addClass("ref_complete"),void 0!==o){d.parentid||-1!==p.getData("personality").indexOf("HISTORY")?m.parentid||-1===p.getData("personality").indexOf("HISTORY")||(m.parentid=p.getData("list_relation_id")):d.parentid=p.getData("list_relation_id");var r={};r.module=p.getData("module"),r.zcqa="customize_"+r.module,r.personality=p.getData("personality"),r.label="Events"===p.getData("module")?"Meetings":p.getData("module"),r.parentid=p.getData("rlId"),r.relatedList=p.getData("relatedList"),-1===r.personality.indexOf("HISTORY")?u[p.getData("module")]=r:u[p.getData("module")+"_History"]=r,Lyte.Component.registeredHelpers.constructCustomizePopup(d,m,u)}}}),(function(){p.setData("isPermissionDenied",!0),p.setData("isLoading",!1)}))}else i.setData("isLoading",!1),a.component.setRecordCount();i.setData("translabel",store.peekAll("related_list",{module:i.getData("rel_module"),layout_id:i.getData("layout_id")}).filterBy({personality_name:Lyte.Component.registeredHelpers.getPersonalityByRelation(i.getData("relation_name"))}).filterBy({href:moduleApiMapping[i.getData("rel_module")]+"/{ENTITYID}/"+i.getData("relation_name")})[0].display_label),e||i.setData("isLoading",!0),i.setData("personality",Lyte.Component.registeredHelpers.getPersonalityByRelation(i.getData("relation_name")))}else i.setData("isPermissionDenied",!0)}),(function(){i.setData("isPermissionDenied",!0)}))},actions:{showMoreOptions:function(e,t){var a=e.Event_Title?e.Event_Title:e.Appointment_Name?e.Appointment_Name:e.Subject;t.classList.add("activeMoreIcon"),this.setData("popoverOrigin","#act_split_origin_"+e.id),this.setData("process_flow",e.$process_flow),this.setData("approved",e.$approved),this.setData("approval_state",e.$approval_state),this.setData("activity_id",e.id),this.setData("subject",a),this.setData("showpopover",!0),e.Status&&"Scheduled"===e.Status?store.findAll("servapp_preferences",{},!1,!0,{module:"Appointments"}).then((function(e){e&&e.length&&$L("#APPOINTMENTSPERSONALITY_split")[0].component.setData("isAppCompleteAction","mark_as_complete"!==e[0].appointments.when_duration_exceeds)})):e.Status&&"Overdue"===e.Status&&this.setData("isAppCompleteAction",!0),this.setData("appEndTime",e.Appointment_End_Time)},hidePopOver:function(){this.setData("showpopover",!1)},callAction:function(e,t){this.setData("showpopover",!1),t?Crm.fetchCallDetails(e,t.id,"relatedList",!0):Crm.fetchCallDetails(e,this.getData("activity_id"),"relatedList",!0),closeMultipleReminderBussinesscardView(),sE1&&sE1(event)},showAppPopup:function(e,t,a){this.setData("showpopover",!1),Lyte.resolvePromises({filesResolved:Lyte.injectResources(networkUtils.returnDependencyFiles(["zohocrm_services.js"]).concat(networkUtils.returnDependencyFiles([networkUtils.getI18nJSUrl("businesshours")])))}).then((function(){CSU.setAppStatusValues(e,t,a),$L("#Calendar").hide()}))},clickAction:function(e,t,a){if(a){this.setData("activity_id",a.id);var i=Lyte.Component.registeredHelpers.getActivityActionLink(e,this,a.id)}else i=Lyte.Component.registeredHelpers.getActivityActionLink(e,this);"delete"!==e?sortRelatedList(i,null,this.getData("activity_id"),this):showDeletePopup(this.getData("activity_id"),"crm.button.move.to.trash","","",t,"rl","","",this.getData("subject"),void 0,void 0,"deleteAction"),this.setData("showpopover",!1)},viewMoreData:function(e){if(!this.getData("isprintview")){var t=$L(e),a=t.outerHeight(),i=t.scrollTop(),o=t[0].scrollHeight;if(this.getData("canvas")||(o*=.8),o<=a+i&&i>0){var r=this.getData("info");if(r&&r.more_records){var s=(r.page-1)*r.per_page+r.count+1;if(this.getData("canvas"))this.setDataInComp(!0,r.page+1);else{var n={fromIndex:s,rid:this.getData("list_relation_id"),module:this.getData("rel_module"),isSortRequest:!1,id:this.getData("entity_id")};crmRelatedList.ajaxReq(n,void 0,!0)}}}}},readMore:function(e){commonUtils.showHideLoadingDiv(!0);var t=e.id;$("#"+t+"_old").text($("#"+e.id).attr("value")),$("#"+t).hide(),commonUtils.showHideLoadingDiv(!1)},showHideRelatedFields:function(e,t,a,i){if("mouseout"==i.type)return crmui.hideTooltip(),!0;var o={},r=$L(i.target);"Who_Id"===t?o.module="Contacts":"Service_Name"===t?o.module="Services":store.peekAll("module").forEach((function(e){e.api_name===a&&(o.module=e.module_name)})),o.id=e.id,crmLookupBusinessCard.showingSide="showOnRight",renderingUtils.windowWidth/2<r.offset().left&&(crmLookupBusinessCard.showingSide="showOnLeft"),r.offset().left<400&&r[0].getBoundingClientRect().right>renderingUtils.windowWidth-400&&(crmLookupBusinessCard.showingSide="showOnBottom"),o&&o.module&&o.id&&setTimeout((function(){r.is(":hover")&&crmLookupBusinessCard.getRecordJSon(o.module,o.id,r)}),250)}},methods:{closePopup:function(e,t){for(var a=(e=document.querySelectorAll(".activeMoreIcon")).length,i=0;i<a;i++)e[i].classList.remove("activeMoreIcon");setTimeout((function(){t.setData("ltPropBindToBody",!1)}),1)}}}),Lyte.Component.register("crm-activity-rel-actions",{_template:'<template tag-name="crm-activity-rel-actions"> <template is="if" value="{{expHandlers(data.length,\'==\',1)}}"><template case="true"><template is="for" items="{{data}}" item="item" index="index"> <div class="dummyForLeftPanel createlink" id="addnew-btn" data-zcqa="{{item.zcqa}}" onclick="{{action(\'createAction\',item.datacid,event,this)}}" data-relid="{{parentid}}">{{item.label}}</div> </template></template><template case="false"> <div class="pR dIB" data-zcqa="addNewActRL"> <div class="addnew-btn1 pR activities_rl_btn {{openActPopKey}}" onclick="{{action(\'showAddNewPop\')}}"> <span class="addnew-btn link1 f14" id="addnew-btn">{{getI18n(\'crm.import.add.new\')}}</span> </div> </div> </template></template> <lyte-popover lt-prop-origin-elem="{{originElem}}" lt-prop-height="auto" lt-prop-scrollable="true" lt-prop-duration="400" lt-prop-content-padding="5px 0" lt-prop-animation="fade" id="addNewPopover" lt-prop-show="{{lbind(showPopover)}}" lt-prop-freeze="false" lt-prop-show-close-button="false" lt-prop-allow-multiple="true" lt-prop-close-on-body-click="{{lbind(closeOnBodyClick)}}" on-before-close="{{method(\'closeActPop\')}}"> <template is="registerYield" yield-name="popover"> <lyte-popover-content class="addNewPopContent"> <ul class="addNewValues m0 p0"> <template is="for" items="{{data}}" item="item" index="index"> <li class="alignleft cP robotoRegular f14" data-zcqa="{{item.zcqa}}" data-relid="{{parentid}}" onclick="{{action(\'createAction\',item.datacid,event,this)}}"> <div class="dummyForLeftPanel capt p0 link fillAspLi" data-relid="{{parentid}}">{{item.label}}</div> </li> </template> </ul> </lyte-popover-content> </template> </lyte-popover> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[0]},{type:"for",position:[0],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}]},false:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,1,0]}]}},default:{}},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3]}],_observedAttributes:["showPopover","data","parentid","originElem","closeOnBodyClick","openActPopKey"],data:function(){return{showPopover:Lyte.attr("boolean",{default:!1}),data:Lyte.attr("array"),parentid:Lyte.attr("string"),originElem:Lyte.attr("string"),closeOnBodyClick:Lyte.attr("boolean"),openActPopKey:Lyte.attr("string",{default:""})}},actions:{showAddNewPop:function(){this.setData("showPopover",!0),this.setData("originElem","#addnew-btn"),this.setData("closeOnBodyClick",!0),this.setData("openActPopKey","openActPop")},createAction:function(e,t,a){var i=a.children[0],o="newAppointment"===e?a:void 0===i?$("#addnew-btn"):i;Crm.userDetails.TaskPopup&&"newTask"===e?crmRelatedList.relTaskCreate(i):crmRelatedList[e](t,o),"logCall"===e&&isNewCallView?(this.setData("showPopover",!0),this.setData("closeOnBodyClick",!1)):this.setData("showPopover",!1)}},methods:{closeActPop:function(){this.setData("openActPopKey","")}}}),Lyte.Component.register("crm-activity-rel-customize",{_template:'<template tag-name="crm-activity-rel-customize" id="{{outer_selector}}" class="{{if(canvas,\'\',\'dIB vam\')}}"> <template is="if" value="{{expHandlers(expHandlers(data,\'!=\',undefined),\'&amp;&amp;\',expHandlers(data.length,\'!=\',0))}}"><template case="true"> <div class="pR {{if(canvas,\'clearfix\',\'\')}} {{if(fromModuleBuilder,\'\',\'mL10\')}}"> <div data-zcqa="{{btn_name}}_customize" id="{{btn_name}}_customize"></div> <div class=" pR {{if(canvas,\'fR\',\'\')}} {{openActPopKey}}" onclick="{{action(\'showCustomizePop\')}}"> <span class="newRlEditBtn {{if(fromModuleBuilder,\'\',\'dIB svgIcons\')}} dvRlcolumnEdit visible" id="{{btn_name}}_btn"></span> </div> </div> <lyte-popover lt-prop-origin-elem="{{originElem}}" lt-prop-height="auto" lt-prop-force-scroll="true" lt-prop-scrollable="true" lt-prop-placement="bottom" lt-prop-wrapper-class="aspPopover" lt-prop-duration="400" lt-prop-content-padding="5px 0" lt-prop-animation="fade" id="customizePopover_{{btn_name}}" lt-prop-show="{{lbind(showPopover)}}" lt-prop-freeze="false" lt-prop-show-close-button="false" lt-prop-allow-multiple="true" lt-prop-close-on-body-click="{{lbind(closeOnBodyClick)}}" on-before-close="{{method(\'closeActPop\')}}" lt-prop-auto-align="true"> <template is="registerYield" yield-name="popover"> <lyte-popover-content class="addNewPopContent {{if(canvas,\'addNewPopContentCanvas\',\'\')}}"> <ul class="addNewValues addNewValues_{{btn_name}} m0 p0" id="{{btn_name}}_ul"> <template is="for" items="{{data}}" item="item" index="index"> <li class="alignleft cP robotoRegular f14" data-zcqa="{{item.zcqa}}" data-relid="{{item.personality}}_{{item.parentid}}" data-name="{{item.personality}}" data-module="{{item.module}}" data-listrelationid="{{item.parentid}}" id="{{item.personality}}_{{item.parentid}}" ddid="{{item.parentid}}" onclick="{{action(\'showCustomizeListPopup\',this,event,item.module,item.parentid)}}"> <span class="dummyForLeftPanel capt p0 link fillAspLi">{{item.label}}</span> <input type="hidden" name="frmmodule" id="frmmodule_{{item.parentid}}" value="{{item.module}}"> </li> </template> </ul> </lyte-popover-content> </template> </lyte-popover> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"attr",position:[1,3]},{type:"attr",position:[1,3,1]},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,1,0]},{type:"attr",position:[1,3]}]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[3]}]}},default:{}}],_templateAttributes:{type:"attr",position:[]},_observedAttributes:["showPopover","data","parentid","originElem","btn_name","closeOnBodyClick","openActPopKey","fromModuleBuilder","canvas","outer_selector","relatedModule","rel_module","relatedList","layout_id","entity_id"],data:function(){return{showPopover:Lyte.attr("boolean",{default:!1}),data:Lyte.attr("array"),parentid:Lyte.attr("string"),originElem:Lyte.attr("string"),btn_name:Lyte.attr("string"),closeOnBodyClick:Lyte.attr("boolean"),openActPopKey:Lyte.attr("string",{default:""}),fromModuleBuilder:Lyte.attr("boolean",{default:!1}),canvas:Lyte.attr("boolean",{default:!1}),outer_selector:Lyte.attr("string"),relatedModule:Lyte.attr("string"),rel_module:Lyte.attr("string"),relatedList:Lyte.attr("object",{hideAttr:!0}),layout_id:Lyte.attr("string"),entity_id:Lyte.attr("string")}},actions:{showCustomizePop:function(){this.setData("showPopover",!0),this.setData("originElem","#"+this.getData("btn_name")+"_btn"),this.setData("closeOnBodyClick",!0),this.setData("openActPopKey","openActPop"),$L("#detailViewButtonLayerDiv").addClass("pR zI10")},showCustomizeListPopup:function(e,t,a,i){if(this.getData("fromModuleBuilder"))CMB.openCuspopup(this.getData("originElem"),e,t);else if(this.getData("canvas")){var o=this;this.setData("relatedModule",a);var r=store.peekRecord("module",moduleRecordMapping[a].id).fields;r&&0!==r.length?Lyte.Component.registeredHelpers.openColumnList(o,i):store.findRecord("module",moduleRecordMapping[a].id).then((function(){Lyte.Component.registeredHelpers.openColumnList(o,i)}))}else{if(""===this.getData("openActPopKey"))return this.setData("showPopover",!0),this.setData("originElem","#"+this.getData("btn_name")+"_btn"),this.setData("closeOnBodyClick",!0),this.setData("openActPopKey","openActPop"),void $L("#detailViewButtonLayerDiv").addClass("pR zI10");var s=$(e).data(),n=document.getElementById(this.getData("btn_name")+"_customize");$(n).data({module:s.module,name:s.name,relid:s.relid,listRelationId:s.listrelationid}),showCustomizeListPopup(n,t,a);var l=$(".addNewValues_"+this.getData("btn_name")),p=$("#"+this.getData("btn_name")+"_btn"),c=p.offset().left+p.outerWidth()-l.offset().left+1,d=$("#relatedListCols_"+s.name);d.removeClass("r0"),Crm.userDetails.RTL_ENABLED?(c=l.offset().left+l.outerWidth()+1-p.offset().left,d.css("left",c+"px")):d.css("right",c+"px")}}},methods:{closeActPop:function(){if(this.setData("openActPopKey",""),$(".selectColPop").is(":visible"))return this.setData("openActPopKey","openActPop"),!1;$L("#detailViewButtonLayerDiv").removeClass("pR zI10")}},getColumnListData:function(e){for(var t=e.length,a=[],i=0;i<t;i++)"BEST_TIME"===e[i].column_name||"Visits"===this.data.relatedModule&&"SEID"===e[i].column_name||"Appointments"===this.data.relatedModule&&"RESCHEDULECOUNT"===e[i].column_name||a.push(e[i]);return a},saveColumnList:function(e,t){var a,i=this.data.relatedList,o=1;i.fields.forEach((function(t){a=!1,e.forEach((function(e){t.id===e.id&&(a=!0)})),a||e.push({id:t.id,api_name:t.api_name,_delete:null})})),e.forEach((function(e){e._delete||(e.sequence_number=o++),"_delete"in e||1})),i.$.set("fields",e);var r=this;i.$.save(void 0,{module:moduleApiMapping[this.data.rel_module],layout_id:this.data.layout_id}).then((function(){setTimeout((function(){var e={module:r.data.rel_module,id:r.data.entity_id,fromIndex:1};crmRelatedList.ajaxReq(e,void 0,!1),crmui.hidePopup("appointmentCreate"),"canvas"===Lyte.Router.getRouteInstance().routeName&&"entity"===Lyte.Router.getRouteInstance().parent.routeName&&Lyte.triggerEvent("relatedList",{refresh:!0}),t.hidePopover()}))}),(function(){t.hidePopover(),renderingUtils.displayPermissionDenied()})),this.setData("showPopover",!1)}}),Lyte.Component.registerHelper("openColumnList",(function(e,t){commonUtils.showHideLoadingDiv();var a={};e.getData("data").forEach((function(e){e.parentid===t&&(a=e.relatedList)})),e.setData("relatedList",a),$L("crm-detail-view-common")[0].component.openColumnList(e,!0);var i=0;$L("crux-column-list")[0].component.getSelectedFields().each((function(e){!0===e.mandatory&&(i+=1)})),crmRelatedList.mandFields[a.personality_name]=i})),Lyte.Component.registerHelper("getFieldsForRelation",(function(e){var t=null;switch(e){case"Tasks":case"Tasks_History":t=["$process_flow","$approved","$approval_state","$in_project_sync","$se_module"];break;case"Events":case"Events_History":t=["$approved","$approval_state","$se_module"];break;case"Calls":case"Calls_History":t=["$approved","$approval_state","$se_module"];break;case"Open_Appointments__s":case"Appointments_History__s":t=["$approved","$approval_state","$se_module"]}return t})),Lyte.Component.registerHelper("isRelationVisible",(function(e){var t=store.peekAll("related_list");for(var a in t)if(t[a].api_name===e)return!0;return!1})),Lyte.Component.registerHelper("formattedText",(function(e,t){return e.length<t?e:e.substring(0,t)+"..."})),Lyte.Component.registerHelper("getFormattedValue",(function(e,t,a,i){return"Appointments"===a&&"Duration"===t&&(i.Duration=Lyte.Transform["time-in-hrs"].deserialize(i.Duration)),Lyte.registeredMixins["crm-detailcanvas-utils"].constructCruxComponentForCanvas(e[t].id,a,i,!0,null,!0,!0,e[t])})),Lyte.Component.registerHelper("validateField",(function(e){return!(!e||0===e.length||!1===e)})),Lyte.Component.registerHelper("getPluralLabel",(function(e){if("undefined"!=typeof moduleRecordMapping&&moduleRecordMapping[e])return moduleRecordMapping[e].plural_label;if(parent.Crm.userDetails.MODULE_LIST&&parent.Crm.userDetails.MODULE_LIST[e]){var t=parent.Crm.userDetails.MODULE_LIST[e],a=t.pluralLabel?t.pluralLabel:t.plural_label;if(a)return(0,Lyte.Component.registeredHelpers.getI18)(a)}return e})),Lyte.Component.registerHelper("getActivityActionLink",(function(e,t,a){var i=(t=t||this).getData("list_relation_id");if("Activities"===i){var o=t.getData("personality");i=store.peekAll("related_list").filterBy({personality_name:o})[0].id}switch(e){case"closeTask":return Crm.getCrmBasePath()+"/closeTask.do?action=CloseTask&taskid="+a+"&&module="+t.getData("rel_module")+"&id="+t.getData("entity_id")+"&nextStep=relatedlist&isajax=true#"+t.getData("personality")+"_"+i;case"deleteLink":return Crm.getCrmBasePath()+"/MassDelete.do?module="+t.getData("module")+"&id="+t.getData("activity_id")+"&actModule="+t.getData("rel_module")+"&actId="+t.getData("entity_id")+"&nextStep=relatedlist&isajax=true#"+t.getData("personality")+"_"+i;default:return""}})),Lyte.Component.registerHelper("getSubActivtyCount",(function(e){return e&&e.count?e.more_records?e.page*e.per_page+"+":(e.page-1)*e.per_page+e.count+"":"0"})),Lyte.Component.registerHelper("convertEventDateTime",(function(e,t,a,i,o){var r=Lyte.Component.registeredHelpers.convertTimeToUserDateFormatFromISO(e,i,o,!0);e=Utils.convertDateToUserPattern(r,o?o.toUpperCase():Crm.userDetails.DATE_PATTERN.toUpperCase());var s=Lyte.Component.registeredHelpers.convertTimeToUserDateFormatFromISO(t,i,o,!0);return t=Utils.convertDateToUserPattern(s,o?o.toUpperCase():Crm.userDetails.DATE_PATTERN.toUpperCase()),a?e===t?e+", "+I18n.getMsg("All Day"):e+" - "+t+", "+I18n.getMsg("All Day"):e===t?e+" "+Utils.getTimeInUserFormat(r,!0,!0)+" - "+Utils.getTimeInUserFormat(s,!0,!0):e+" "+Utils.getTimeInUserFormat(r,!0,!0)+" - "+t+" "+Utils.getTimeInUserFormat(s,!0,!0)})),Lyte.Component.registerHelper("convertTimeToUserDateFormatFromISO",(function(e,t,a,i){if(!e)return"";if(a=a?a.toUpperCase():a,t){var o=CrmDateUtils.getDateObjectFromString(e,"YYYY-MM-DD"),r=Crm.userDetails.DATE_PATTERN;return r||parent.Crm.userDetails.DATE_PATTERN&&(r=parent.Crm.userDetails.DATE_PATTERN),r&&(r=r.toUpperCase()),CrmDateUtils.convertDateToUserPattern(o,r)}var s=Utils.ISO8601toDateObject(e);if(i)return s;var n=Utils.convertDateToUserPattern(s,a);return n+=" "+Utils.getTimeInUserFormat(s,!0,!0)})),Lyte.Component.registerHelper("getSubject",(function(e,t){switch(e){case"Tasks":return t.Subject;case"Events":return t.Event_Title;case"Calls":return t.Subject;case"Appointments":return t.Appointment_Name;default:return""}})),Lyte.Component.registerHelper("getPersonalityByRelation",(function(e){switch(e){case"Tasks":case"Calls":case"Events":return e.toUpperCase()+"PERSONALITY";case"Tasks_History":case"Events_History":case"Calls_History":return e.replace("_","").toUpperCase()+"PERSONALITY";case"Open_Appointments__s":return"APPOINTMENTSPERSONALITY";case"Appointments_History__s":return"APPOINTMENTSHISTORYPERSONALITY"}})),Lyte.Component.registerHelper("getModuleByRelation",(function(e){switch(e){case"Tasks":case"Tasks_History":return"Tasks";case"Calls":case"Calls_History":return"Calls";case"Events":case"Events_History":return"Events";case"Open_Appointments__s":case"Appointments_History__s":return"Appointments"}})),Lyte.Component.registerHelper("getSortColumn",(function(e){switch(e){case"Tasks":return"Due_Date";case"Tasks_History":return"Closed_Time";case"Calls":case"Calls_History":return"Call_Start_Time";case"Events":case"Events_History":return"Start_DateTime";case"Open_Appointments__s":case"Appointments_History__s":return"Appointment_Start_Time"}})),Lyte.Component.registerHelper("getPRClass",(function(e,t,a,i){return e?i&&a===i.length-1?"":"pr30":"pLR10"})),Lyte.Component.registerHelper("getI18",(function(e){return"undefined"!=typeof I18n?I18n.getMsg(e):"undefined"!=typeof parent&&"undefined"!==parent.I18n?parent.I18n.getMsg(e):e})),Lyte.Component.registerHelper("getModuleNameForIconForAct",(function(e){return(e="Deals"===e?"Potentials":e)&&e.indexOf("_")>0&&(e=(e=e.split("_"))[0]+e[1]),e&&["Leads","Products","Accounts","Potentials","Contacts","Vendors","JobSheets","PriceBooks","Cases","Solutions","SalesOrders","Invoices","Quotes","PurchaseOrders","WeekEvent"].contains(e)?e.slice(0,e.lastIndexOf("s")):"svgIcons CustomModule"})),Lyte.Component.registerHelper("constructFieldsForRel",(function(e,t){var a=[],i=[],o=e.getData("excludeFields");t.forEach((function(e){if(a.push(e.api_name),!o.contains(e.api_name)){var t=CrmField.getDataType(parseInt(e.ui_type));e.data_type=t,i[e.api_name]=e}}));var r=e.getData("fieldsforrel")?e.getData("fieldsforrel"):{};r[Lyte.Component.registeredHelpers.getPersonalityByRelation(e.getData("relation_name"))]=i,e.setData("fields",e.getData("fields_mandatory").concat(a)),e.setData("fieldsforrel",r)})),Lyte.Component.registerHelper("constructCustomizePopup",(function(e,t,a){var i=$L("crm-activity-rel-customize"),o=0===i.length?i:"openActivities"===i[0].component.data.btn_name?i[0]:i[1],r=0===i.length?i:"closedActivities"===i[0].component.data.btn_name?i[0]:i[1],s=["Tasks","Events","Calls","Appointments"],n=["Tasks_History","Events_History","Calls_History","Appointments_History"];e.parentid&&(e.btn_name="openActivities",o&&0!==o.getData().data&&o.getData().data&&o.getData().data.forEach((function(e){s.contains(e.module)&&!a[e.module]&&(a[e.module]=e)})),a.Tasks&&e.data.push(a.Tasks),a.Events&&e.data.push(a.Events),a.Calls&&e.data.push(a.Calls),a.Appointments&&e.data.push(a.Appointments),o.setData("data",e.data)),t.parentid&&(t.btn_name="closedActivities",r&&0!==r.getData().data&&r.getData().data&&r.getData().data.forEach((function(e){n.contains(e.module+"_History")&&!a[e.module+"_History"]&&(a[e.module+"_History"]=e)})),a.Tasks_History&&t.data.push(a.Tasks_History),a.Events_History&&t.data.push(a.Events_History),a.Calls_History&&t.data.push(a.Calls_History),a.Appointments_History&&t.data.push(a.Appointments_History),r.setData("data",t.data))})),Lyte.Component.registerHelper("isActivitySplitComponent",(function(e){return!crmRelatedList.isNotActivitySubPersonality(e,"Services"===Lyte.Router.getRouteInstance().parent.parent.getDynamicParam()||void 0)})),Lyte.Component.registerHelper("arrayJoin",(function(e,t){return e?e.join(t):void 0})),Lyte.Component.registerHelper("getModuleNameByApiNameAsp",(function(e){return Object.keys(moduleApiMapping).filter((t=>moduleApiMapping[t]===e))})),function(e){if(lyteDomObj){var t,a,i,o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=["January","February","March","April","May","June","July","August","September","October","November","December"],s=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],l=["Su","Mo","Tu","We","Th","Fr","Sa"],p=[31,28,31,30,31,30,31,31,30,31,30,31],c="lyteMoment",d=19,m=80,u={"Etc/GMT+12":-720,"Etc/GMT+11":-660,"Pacific/Midway":-660,"Pacific/Niue":-660,"Pacific/Pago_Pago":-660,"Pacific/Samoa":-660,"US/Samoa":-660,"America/Adak":-540,"America/Atka":-540,"Etc/GMT+10":-600,HST:-600,"Pacific/Honolulu":-600,"Pacific/Johnston":-600,"Pacific/Rarotonga":-600,"Pacific/Tahiti":-600,"SystemV/HST10":-600,"US/Aleutian":-540,"US/Hawaii":-600,"Pacific/Marquesas":-510,AST:-480,"America/Anchorage":-480,"America/Juneau":-480,"America/Metlakatla":-480,"America/Nome":-480,"America/Sitka":-480,"America/Yakutat":-480,"Etc/GMT+9":-540,"Pacific/Gambier":-540,"SystemV/YST9":-540,"SystemV/YST9YDT":-480,"US/Alaska":-480,"America/Ensenada":-420,"America/Los_Angeles":-420,"America/Santa_Isabel":-420,"America/Tijuana":-420,"America/Vancouver":-420,"Canada/Pacific":-420,"Etc/GMT+8":-480,"Mexico/BajaNorte":-420,PST:-480,PST8PDT:-420,"Pacific/Pitcairn":-480,"SystemV/PST8":-480,"SystemV/PST8PDT":-420,"US/Pacific":-420,"America/Boise":-360,"America/Cambridge_Bay":-360,"America/Chihuahua":-360,"America/Creston":-420,"America/Dawson":-420,"America/Dawson_Creek":-420,"America/Denver":-360,"America/Edmonton":-360,"America/Fort_Nelson":-420,"America/Hermosillo":-420,"America/Inuvik":-360,"America/Mazatlan":-360,"America/Ojinaga":-360,"America/Phoenix":-420,"America/Shiprock":-360,"America/Whitehorse":-420,"America/Yellowknife":-360,"Canada/Mountain":-360,"Canada/Yukon":-420,"Etc/GMT+7":-420,MST:-420,MST7MDT:-360,"Mexico/BajaSur":-360,Navajo:-360,PNT:-420,"SystemV/MST7":-420,"SystemV/MST7MDT":-360,"US/Arizona":-420,"US/Mountain":-360,"America/Bahia_Banderas":-300,"America/Belize":-360,"America/Chicago":-300,"America/Costa_Rica":-360,"America/El_Salvador":-360,"America/Guatemala":-360,"America/Indiana/Knox":-300,"America/Indiana/Tell_City":-300,"America/Knox_IN":-300,"America/Managua":-360,"America/Matamoros":-300,"America/Menominee":-300,"America/Merida":-300,"America/Mexico_City":-300,"America/Monterrey":-300,"America/North_Dakota/Beulah":-300,"America/North_Dakota/Center":-300,"America/North_Dakota/New_Salem":-300,"America/Rainy_River":-300,"America/Rankin_Inlet":-300,"America/Regina":-360,"America/Resolute":-300,"America/Swift_Current":-360,"America/Tegucigalpa":-360,"America/Winnipeg":-300,CST:-360,CST6CDT:-300,"Canada/Central":-300,"Canada/Saskatchewan":-360,"Chile/EasterIsland":-360,"Etc/GMT+6":-360,"Mexico/General":-300,"Pacific/Easter":-360,"Pacific/Galapagos":-360,"SystemV/CST6":-360,"SystemV/CST6CDT":-300,"US/Central":-300,"US/Indiana-Starke":-300,"America/Atikokan":-300,"America/Bogota":-300,"America/Cancun":-300,"America/Cayman":-300,"America/Coral_Harbour":-300,"America/Detroit":-240,"America/Eirunepe":-300,"America/Fort_Wayne":-240,"America/Grand_Turk":-240,"America/Guayaquil":-300,"America/Havana":-240,"America/Indiana/Indianapolis":-240,"America/Indiana/Marengo":-240,"America/Indiana/Petersburg":-240,"America/Indiana/Vevay":-240,"America/Indiana/Vincennes":-240,"America/Indiana/Winamac":-240,"America/Indianapolis":-240,"America/Iqaluit":-240,"America/Jamaica":-300,"America/Kentucky/Louisville":-240,"America/Kentucky/Monticello":-240,"America/Lima":-300,"America/Louisville":-240,"America/Montreal":-240,"America/Nassau":-240,"America/New_York":-240,"America/Nipigon":-240,"America/Panama":-300,"America/Pangnirtung":-240,"America/Port-au-Prince":-240,"America/Porto_Acre":-300,"America/Rio_Branco":-300,"America/Thunder_Bay":-240,"America/Toronto":-240,"Brazil/Acre":-300,"Canada/Eastern":-240,Cuba:-240,EST:-300,EST5EDT:-240,"Etc/GMT+5":-300,IET:-240,Jamaica:-300,"SystemV/EST5":-300,"SystemV/EST5EDT":-240,"US/East-Indiana":-240,"US/Eastern":-240,"US/Michigan":-240,"America/Anguilla":-240,"America/Antigua":-240,"America/Aruba":-240,"America/Asuncion":-240,"America/Barbados":-240,"America/Blanc-Sablon":-240,"America/Boa_Vista":-240,"America/Campo_Grande":-240,"America/Caracas":-240,"America/Cuiaba":-240,"America/Curacao":-240,"America/Dominica":-240,"America/Glace_Bay":-180,"America/Goose_Bay":-180,"America/Grenada":-240,"America/Guadeloupe":-240,"America/Guyana":-240,"America/Halifax":-180,"America/Kralendijk":-240,"America/La_Paz":-240,"America/Lower_Princes":-240,"America/Manaus":-240,"America/Marigot":-240,"America/Martinique":-240,"America/Moncton":-180,"America/Montserrat":-240,"America/Port_of_Spain":-240,"America/Porto_Velho":-240,"America/Puerto_Rico":-240,"America/Santiago":-240,"America/Santo_Domingo":-240,"America/St_Barthelemy":-240,"America/St_Kitts":-240,"America/St_Lucia":-240,"America/St_Thomas":-240,"America/St_Vincent":-240,"America/Thule":-180,"America/Tortola":-240,"America/Virgin":-240,"Atlantic/Bermuda":-180,"Brazil/West":-240,"Canada/Atlantic":-180,"Chile/Continental":-240,"Etc/GMT+4":-240,PRT:-240,"SystemV/AST4":-240,"SystemV/AST4ADT":-180,"America/St_Johns":-90,CNT:-90,"Canada/Newfoundland":-90,AGT:-180,"America/Araguaina":-180,"America/Argentina/Buenos_Aires":-180,"America/Argentina/Catamarca":-180,"America/Argentina/ComodRivadavia":-180,"America/Argentina/Cordoba":-180,"America/Argentina/Jujuy":-180,"America/Argentina/La_Rioja":-180,"America/Argentina/Mendoza":-180,"America/Argentina/Rio_Gallegos":-180,"America/Argentina/Salta":-180,"America/Argentina/San_Juan":-180,"America/Argentina/San_Luis":-180,"America/Argentina/Tucuman":-180,"America/Argentina/Ushuaia":-180,"America/Bahia":-180,"America/Belem":-180,"America/Buenos_Aires":-180,"America/Catamarca":-180,"America/Cayenne":-180,"America/Cordoba":-180,"America/Fortaleza":-180,"America/Godthab":-120,"America/Jujuy":-180,"America/Maceio":-180,"America/Mendoza":-180,"America/Miquelon":-120,"America/Montevideo":-180,"America/Nuuk":-120,"America/Paramaribo":-180,"America/Punta_Arenas":-180,"America/Recife":-180,"America/Rosario":-180,"America/Santarem":-180,"America/Sao_Paulo":-180,"Antarctica/Palmer":-180,"Antarctica/Rothera":-180,"Atlantic/Stanley":-180,BET:-180,"Brazil/East":-180,"Etc/GMT+3":-180,"America/Noronha":-120,"Atlantic/South_Georgia":-120,"Brazil/DeNoronha":-120,"Etc/GMT+2":-120,"America/Scoresbysund":0,"Atlantic/Azores":0,"Atlantic/Cape_Verde":-60,"Etc/GMT+1":-60,"Africa/Abidjan":0,"Africa/Accra":0,"Africa/Bamako":0,"Africa/Banjul":0,"Africa/Bissau":0,"Africa/Casablanca":0,"Africa/Conakry":0,"Africa/Dakar":0,"Africa/El_Aaiun":0,"Africa/Freetown":0,"Africa/Lome":0,"Africa/Monrovia":0,"Africa/Nouakchott":0,"Africa/Ouagadougou":0,"Africa/Sao_Tome":0,"Africa/Timbuktu":0,"America/Danmarkshavn":0,"Antarctica/Troll":120,"Atlantic/Canary":60,"Atlantic/Faeroe":60,"Atlantic/Faroe":60,"Atlantic/Madeira":60,"Atlantic/Reykjavik":0,"Atlantic/St_Helena":0,Eire:60,"Etc/GMT":-0,"Etc/GMT+0":-0,"Etc/GMT-0":-0,"Etc/GMT0":-0,"Etc/Greenwich":-0,"Etc/UCT":-0,"Etc/UTC":-0,"Etc/Universal":-0,"Etc/Zulu":-0,"Europe/Belfast":60,"Europe/Dublin":60,"Europe/Guernsey":60,"Europe/Isle_of_Man":60,"Europe/Jersey":60,"Europe/Lisbon":60,"Europe/London":60,GB:60,"GB-Eire":60,GMT:0,GMT0:0,Greenwich:0,Iceland:0,Portugal:60,UCT:0,UTC:0,Universal:0,WET:60,Zulu:0,"Africa/Algiers":60,"Africa/Bangui":60,"Africa/Brazzaville":60,"Africa/Ceuta":120,"Africa/Douala":60,"Africa/Kinshasa":60,"Africa/Lagos":60,"Africa/Libreville":60,"Africa/Luanda":60,"Africa/Malabo":60,"Africa/Ndjamena":60,"Africa/Niamey":60,"Africa/Porto-Novo":60,"Africa/Tunis":60,"Arctic/Longyearbyen":120,"Atlantic/Jan_Mayen":120,CET:120,ECT:120,"Etc/GMT-1":60,"Europe/Amsterdam":120,"Europe/Andorra":120,"Europe/Belgrade":120,"Europe/Berlin":120,"Europe/Bratislava":120,"Europe/Brussels":120,"Europe/Budapest":120,"Europe/Busingen":120,"Europe/Copenhagen":120,"Europe/Gibraltar":120,"Europe/Ljubljana":120,"Europe/Luxembourg":120,"Europe/Madrid":120,"Europe/Malta":120,"Europe/Monaco":120,"Europe/Oslo":120,"Europe/Paris":120,"Europe/Podgorica":120,"Europe/Prague":120,"Europe/Rome":120,"Europe/San_Marino":120,"Europe/Sarajevo":120,"Europe/Skopje":120,"Europe/Stockholm":120,"Europe/Tirane":120,"Europe/Vaduz":120,"Europe/Vatican":120,"Europe/Vienna":120,"Europe/Warsaw":120,"Europe/Zagreb":120,"Europe/Zurich":120,MET:120,Poland:120,ART:120,"Africa/Blantyre":120,"Africa/Bujumbura":120,"Africa/Cairo":120,"Africa/Gaborone":120,"Africa/Harare":120,"Africa/Johannesburg":120,"Africa/Khartoum":120,"Africa/Kigali":120,"Africa/Lubumbashi":120,"Africa/Lusaka":120,"Africa/Maputo":120,"Africa/Maseru":120,"Africa/Mbabane":120,"Africa/Tripoli":120,"Africa/Windhoek":120,"Asia/Amman":180,"Asia/Beirut":180,"Asia/Damascus":180,"Asia/Famagusta":180,"Asia/Gaza":180,"Asia/Hebron":180,"Asia/Jerusalem":180,"Asia/Nicosia":180,"Asia/Tel_Aviv":180,CAT:120,EET:180,Egypt:120,"Etc/GMT-2":120,"Europe/Athens":180,"Europe/Bucharest":180,"Europe/Chisinau":180,"Europe/Helsinki":180,"Europe/Kaliningrad":120,"Europe/Kiev":180,"Europe/Mariehamn":180,"Europe/Nicosia":180,"Europe/Riga":180,"Europe/Sofia":180,"Europe/Tallinn":180,"Europe/Tiraspol":180,"Europe/Uzhgorod":180,"Europe/Vilnius":180,"Europe/Zaporozhye":180,Israel:180,Libya:120,"Africa/Addis_Ababa":180,"Africa/Asmara":180,"Africa/Asmera":180,"Africa/Dar_es_Salaam":180,"Africa/Djibouti":180,"Africa/Juba":180,"Africa/Kampala":180,"Africa/Mogadishu":180,"Africa/Nairobi":180,"Antarctica/Syowa":180,"Asia/Aden":180,"Asia/Baghdad":180,"Asia/Bahrain":180,"Asia/Istanbul":180,"Asia/Kuwait":180,"Asia/Qatar":180,"Asia/Riyadh":180,EAT:180,"Etc/GMT-3":180,"Europe/Istanbul":180,"Europe/Kirov":180,"Europe/Minsk":180,"Europe/Moscow":180,"Europe/Simferopol":180,"Indian/Antananarivo":180,"Indian/Comoro":180,"Indian/Mayotte":180,Turkey:180,"W-SU":180,"Asia/Tehran":270,Iran:270,"Asia/Baku":240,"Asia/Dubai":240,"Asia/Muscat":240,"Asia/Tbilisi":240,"Asia/Yerevan":240,"Etc/GMT-4":240,"Europe/Astrakhan":240,"Europe/Samara":240,"Europe/Saratov":240,"Europe/Ulyanovsk":240,"Europe/Volgograd":240,"Indian/Mahe":240,"Indian/Mauritius":240,"Indian/Reunion":240,NET:240,"Asia/Kabul":270,"Antarctica/Mawson":300,"Asia/Aqtau":300,"Asia/Aqtobe":300,"Asia/Ashgabat":300,"Asia/Ashkhabad":300,"Asia/Atyrau":300,"Asia/Dushanbe":300,"Asia/Karachi":300,"Asia/Oral":300,"Asia/Qyzylorda":300,"Asia/Samarkand":300,"Asia/Tashkent":300,"Asia/Yekaterinburg":300,"Etc/GMT-5":300,"Indian/Kerguelen":300,"Indian/Maldives":300,PLT:300,"Asia/Calcutta":330,"Asia/Colombo":330,"Asia/Kolkata":330,IST:330,"Asia/Kathmandu":345,"Asia/Katmandu":345,"Antarctica/Vostok":360,"Asia/Almaty":360,"Asia/Bishkek":360,"Asia/Dacca":360,"Asia/Dhaka":360,"Asia/Kashgar":360,"Asia/Omsk":360,"Asia/Qostanay":360,"Asia/Thimbu":360,"Asia/Thimphu":360,"Asia/Urumqi":360,BST:360,"Etc/GMT-6":360,"Indian/Chagos":360,"Asia/Rangoon":390,"Asia/Yangon":390,"Indian/Cocos":390,"Antarctica/Davis":420,"Asia/Bangkok":420,"Asia/Barnaul":420,"Asia/Ho_Chi_Minh":420,"Asia/Hovd":420,"Asia/Jakarta":420,"Asia/Krasnoyarsk":420,"Asia/Novokuznetsk":420,"Asia/Novosibirsk":420,"Asia/Phnom_Penh":420,"Asia/Pontianak":420,"Asia/Saigon":420,"Asia/Tomsk":420,"Asia/Vientiane":420,"Etc/GMT-7":420,"Indian/Christmas":420,VST:420,"Asia/Brunei":480,"Asia/Choibalsan":480,"Asia/Chongqing":480,"Asia/Chungking":480,"Asia/Harbin":480,"Asia/Hong_Kong":480,"Asia/Irkutsk":480,"Asia/Kuala_Lumpur":480,"Asia/Kuching":480,"Asia/Macao":480,"Asia/Macau":480,"Asia/Makassar":480,"Asia/Manila":480,"Asia/Shanghai":480,"Asia/Singapore":480,"Asia/Taipei":480,"Asia/Ujung_Pandang":480,"Asia/Ulaanbaatar":480,"Asia/Ulan_Bator":480,"Australia/Perth":480,"Australia/West":480,CTT:480,"Etc/GMT-8":480,Hongkong:480,PRC:480,Singapore:480,"Australia/Eucla":525,"Asia/Chita":540,"Asia/Dili":540,"Asia/Jayapura":540,"Asia/Khandyga":540,"Asia/Pyongyang":540,"Asia/Seoul":540,"Asia/Tokyo":540,"Asia/Yakutsk":540,"Etc/GMT-9":540,JST:540,Japan:540,"Pacific/Palau":540,ROK:540,ACT:570,"Australia/Adelaide":570,"Australia/Broken_Hill":570,"Australia/Darwin":570,"Australia/North":570,"Australia/South":570,"Australia/Yancowinna":570,AET:600,"Antarctica/DumontDUrville":600,"Antarctica/Macquarie":600,"Asia/Ust-Nera":600,"Asia/Vladivostok":600,"Australia/ACT":600,"Australia/Brisbane":600,"Australia/Canberra":600,"Australia/Currie":600,"Australia/Hobart":600,"Australia/Lindeman":600,"Australia/Melbourne":600,"Australia/NSW":600,"Australia/Queensland":600,"Australia/Sydney":600,"Australia/Tasmania":600,"Australia/Victoria":600,"Etc/GMT-10":600,"Pacific/Chuuk":600,"Pacific/Guam":600,"Pacific/Port_Moresby":600,"Pacific/Saipan":600,"Pacific/Truk":600,"Pacific/Yap":600,"Australia/LHI":630,"Australia/Lord_Howe":630,"Antarctica/Casey":660,"Asia/Magadan":660,"Asia/Sakhalin":660,"Asia/Srednekolymsk":660,"Etc/GMT-11":660,"Pacific/Bougainville":660,"Pacific/Efate":660,"Pacific/Guadalcanal":660,"Pacific/Kosrae":660,"Pacific/Norfolk":660,"Pacific/Noumea":660,"Pacific/Pohnpei":660,"Pacific/Ponape":660,SST:660,"Antarctica/McMurdo":720,"Antarctica/South_Pole":720,"Asia/Anadyr":720,"Asia/Kamchatka":720,"Etc/GMT-12":720,Kwajalein:720,NST:720,NZ:720,"Pacific/Auckland":720,"Pacific/Fiji":720,"Pacific/Funafuti":720,"Pacific/Kwajalein":720,"Pacific/Majuro":720,"Pacific/Nauru":720,"Pacific/Tarawa":720,"Pacific/Wake":720,"Pacific/Wallis":720,"NZ-CHAT":765,"Pacific/Chatham":765,"Etc/GMT-13":780,MIT:780,"Pacific/Apia":780,"Pacific/Enderbury":780,"Pacific/Fakaofo":780,"Pacific/Tongatapu":780,"Etc/GMT-14":840,"Pacific/Kiritimati":840,UT:0,EDT:-240,CDT:-300,MDT:-360,PDT:-420},g=new RegExp("("+Object.keys(u).join("|")+")"),f=[{val:"YYYY",type:"year",regex:/\d{4}/,len:4},{val:"GGGG",type:"year",regex:/\d{4}/,len:4,isWEG:!0},{val:"gggg",type:"year",regex:/\d{4}/,len:4,isWEG:!0},{val:"YY",type:"year",regex:/\d{2}/,len:2},{val:"GG",type:"year",regex:/\d{2}/,len:2,isWEG:!0},{val:"gg",type:"year",regex:/\d{2}/,len:2,isWEG:!0},{val:"MMMM",type:"month",regex:/[A-z]{3,}/,long:!0,str:!0,array:r},{val:"MMM",str:!0,type:"month",regex:/[A-z]{3,}/,array:o},{val:"Mo",suff:!0,type:"month",regex:/\d{1,2}(?=st|nd|rd|th)/,max:12},{val:"MM",type:"month",regex:/\d{2}/,len:2,max:12,alt:!0},{val:"M",type:"month",regex:/\d{1,2}/,max:12},{val:"DDDD",type:"date",regex:/\d{3}/,len:3,year:!0},{val:"DDDo",type:"date",suff:!0,regex:/\d{1,3}(?=st|nd|rd|th)/,len:3,year:!0,ignore:/\d{3}(?=st|nd|rd|th)/},{val:"DDD",type:"date",regex:/\d{1,3}/,year:!0,ignore:/\d{3}/},{val:"Do",type:"date",suff:!0,regex:/\d{1,2}(?=st|nd|rd|th)/},{val:"DD",type:"date",regex:/\d{2}/,len:2,alt:!0},{val:"D",type:"date",regex:/\d{1,2}/},{val:"[W]Wo",type:"week",suff:!0,regex:new RegExp("[W]d{1,2}(?=st|nd|th|rd)"),isWEG:!0},{val:"[W]wo",ignore:1,type:"week",suff:!0,regex:new RegExp("[W]d{1,2}(?=st|nd|th|rd)"),isWEG:!0},{val:"[W]WW",type:"week",regex:new RegExp("W(\\d{2})"),len:2,isWEG:!0,match:1},{val:"[W]ww",ignore:1,type:"week",regex:new RegExp("W(\\d{2})"),len:2,isWEG:!0,match:1},{val:"[W]W",type:"week",regex:new RegExp("W(\\d{1,2})"),isWEG:!0,match:1},{val:"[W]w",ignore:1,type:"week",regex:new RegExp("W(\\d{1,2})"),isWEG:!0,match:1},{val:"Wo",type:"week",pref:0,suff:!0,regex:new RegExp("[W]d{1,2}(?=st|nd|th|rd)"),isWEG:!0},{val:"wo",type:"week",pref:0,ignore:1,suff:!0,regex:new RegExp("[W]d{1,2}(?=st|nd|th|rd)"),isWEG:!0},{val:"WW",type:"week",pref:0,regex:new RegExp("(\\d{2})"),len:2,isWEG:!0,match:1},{val:"ww",type:"week",pref:0,ignore:1,regex:new RegExp("(\\d{2})"),len:2,isWEG:!0,match:1},{val:"W",type:"week",pref:0,regex:new RegExp("(\\d{1,2})"),isWEG:!0,match:1},{val:"w",type:"week",pref:0,ignore:1,regex:new RegExp("(\\d{1,2})"),isWEG:!0,match:1},{val:"E",type:"day",regex:/\d{1}/,isWEG:!0},{val:"e",type:"day",regex:/\d{1}/,isWEG:!0,local:!0},{val:"A",type:"meridian",regex:/AM|PM/,str:!0,time:!0},{val:"a",type:"meridian",regex:/am|pm/,str:!0,time:!0,lower:!0},{val:"ZZ",type:"timezone",regex:/(\+|\-)(\d{2})(\d{2})$/,time:!0,len:2},{val:"Z",type:"timezone",regex:/(\+|\-)(\d{2}):(\d{2})$/,time:!0,len:2},{val:"HH",type:"hour",regex:/\d{2}/,railway:!0,time:!0,len:2,max:23},{val:"H",type:"hour",regex:/\d{1,2}/,railway:!0,time:!0,max:23},{val:"hh",type:"hour",regex:/\d{2}/,time:!0,len:2,max:12},{val:"h",type:"hour",regex:/\d{1,2}/,time:!0,max:12},{val:"kk",type:"hour",regex:/\d{2}/,railway:!0,time:!0,len:2,max:24,deduct:-1},{val:"k",type:"hour",regex:/\d{1,2}/,railway:!0,time:!0,max:24,deduct:-1},{val:"mm",type:"minute",regex:/\d{2}/,time:!0,len:2,max:59},{val:"m",type:"minute",regex:/\d{1,2}/,time:!0,max:59},{val:"ss",type:"second",regex:/\d{2}/,time:!0,len:2,max:59},{val:"s",type:"second",regex:/\d{1,2}/,time:!0,max:59},{val:"S",type:"millisecond",regex:/[0-9]{1,}/,time:!0,valForm:/[S]+/},{val:"zz",type:"timezone",regex:g,str:!0,time:!0},{val:"z",type:"timezone",regex:g,str:!0,time:!0},{val:"X",type:"timestamp",regex:/\d{10}/,time:!0},{val:"x",type:"timestamp",regex:/\d{13,}/,time:!0,milli:!0},{val:"dddd",type:"longdate",regex:/[A-z]{3,}/,long:!0,str:!0,array:s},{val:"ddd",type:"longdate",regex:/[A-z]{3}/,str:!0,array:n},{val:"dd",type:"longdate",regex:/[A-z]{2}/,str:!0,array:l},{val:"do",type:"longdate",regex:/\d{1}(?=st|nd|rd|th)/,suff:!0},{val:"d",type:"longdate",regex:/\d{1}/},{val:"Qo",type:"quarter",regex:/\d{1}(?=st|nd|rd|th)/,suff:!0},{val:"Q",type:"quarter",regex:/\d{1}/}];function y(t,a,i){var o=this.parseFormat(this.replaceTxt(t)).reverse();return t=t.replace(/{{|}}/g,""),o.forEach((function(t){var o=t.format.array||[],r=e._lyteUiUtils;"meridian"==t.format.type&&(o=t.format.lower?["am","pm"]:["AM","PM"]),o.forEach((function(e){var o=r?r.i18n(e):e;i&&(o=i(a,e,o,t.format.val)||o),e!=o&&(a=v(a,e,o))}))})),a}function v(e,t,a){return-1!=e.indexOf(a)?v(e.replace(a,t),t,a):e}function h(e,i,o,r){var s,n,l;e&&(this._arg=e),this._format=i,function(e){if(!e)return!0;var t=e.constructor;return t==Array&&!t.length||t==Object&&!Object.keys(e).length}(e)&&(e=new Date),o&&o.constructor==Object&&(r=o.lL,s=o.i18n,n=o.i18n_callback,l=o.ignore_timezone,o=o.uL),l||this.timezone(t,a),s&&i&&e&&e.constructor==String&&(e=y.call(this,i,e,n)),this.uL=null==o?d:o,this.lL=null==r?m:r,T(o)&&T(r)||(this.alt=!!o),this._isValid=G.call(this,e,i)}function T(e){return null!=e}function _(e,t,a){for(var i=0,o=0;o<e;o++)i+=p[o],t&&1==o&&(i+=1);return i+(a||0)}function A(e){return 2==(e+="").length&&(e=k(parseInt(e))),(e=parseInt(e))%4==0&&e%100!=0||e%400==0}function D(e){var t=e.match(/{{/),a=e.match(/}}/);return t&&a?D(e=e.replace(e.slice(t.index,a.index+2),(function(e){for(var t="",a=0;a<e.length-4;a++)t+="*";return t}))):e}function M(e,t){for(var a,i=$L.extend(!0,[],f),o=[],r=0;r<i.length;r++){var s=i[r];if(!e.length)break;if(e.indexOf(s.val)>-1){if(t&&s.alt){a=!0;continue}a&&(s.val=i[r-1].val),a=!1,o.push({format:s,index:e.indexOf(s.val)}),e=e.replace(s.val,Math.pow(10,s.val.length-1)),r--}}return o.sort((function(e,t){return e.index-t.index}))}function x(e,t,a,i){return e=e.replace(t,i||""),a&&(e=e.replace(/st|nd|rd|th/,"")),e}function b(e,t){var a,i;for(i=0;i<e.length;i++)if(new RegExp(e[i]).test(t)){a=e[i];break}return{mon:a,index:i}}function w(e,t,a,i){var s;if(a){var n=b(i?r:o,e);s=n.mon,e=n.index,(!s||e>11)&&(e="Invalid")}else(e=parseInt(e)-1)>11&&(e="Invalid");return{val:e,mon:s}}function L(e){var t,a=parseInt(e[2]);return minute=parseInt(e[3]),t=60*a+minute,"+"==e[1]?-1*t:t}function C(e,t){if(e=parseInt(e),ini=0,ind=0,inc=p[0],e>365+(t?1:0))return{};for(;ini+inc<e;)ini+=inc,ind++,inc=p[ind],t&&1==ind&&(inc+=1);return{day:e-ini,mon:ind}}function S(e){if(null!=e.day||e.week){var t=new Date(e.year,0,1);if(!G.call(this,t))return{};var a=t.getDay(),i=A(e.year||t.getFullYear()),o=1+e.week==1?e.day-a+1:2==e.week?8-a+e.day:8-a+e.day+7*(e.week-2);if(o>365+(i?1:0)&&new Date(e.year+1,0,1).getDay()>4&&(e.year+=1,o-=365+(i?1:0)),o>365+(i?1:0)||0==e.day||e.day>7)return void(e.month=e.year=e.date="Invalid");var r=C(o,i);e.month=r.mon,e.date=r.day}if(e.year){var s=parseInt(e.year);s<100&&(e.year=k(s))}e.month<0&&(e.month="Invalid"),e.date<1&&(e.date="Invalid")}function I(e,t){var a=e.getFullYear(),i=A(a),o=e.getMonth(),r=e.getDate(),s=new Date(a,0),n=s.getDay(),l=s.getDate(),p=e.getDay();if(total=_(o,i),!t){if(0==o&&n>4&&r<=8-n){var c=I(new Date(a-1,11,31));return c.day=(c.day+r)%8||1,c.repYear=!0,c}n>4&&l<=8-n?(r-=8-n,n=0):r--}return{week:Math.ceil((total+n+r)/7),day:p}}function k(e){var t=e+"";if(e=parseInt(e),2==t.length){var a=Number($L.moment().format("YYYY")),i=parseInt(a/100),o=a%100,r=(this.uL,(o-(this.lL||m)+100)%100);e=o>r?e<r?i+1+""+P(e,2):i+""+P(e,2):e<r?i+""+P(e,2):i-1+""+P(e,2)}return e}function E(e,t){for(var a,i,o,r={},s=new Date,n=M(D(t),!0),l=e,c=t=t.replace(/{{|}}/g,""),d=0;d<n.length;d++){var m,g=n[d].format;switch(g.type){case"date":case"year":case"week":case"day":g.regex.test(e)?(m="year"==g.type?e.match(g.regex)[g.match||0]:parseInt(e.match(g.regex)[g.match||0]),r[g.type]=m,e=x(e,g.regex,g.suff),l=x(l,g.regex,g.suff,g.val),"week"==g.type&&(e=x(e,"W")),"day"==g.type&&g.local&&r.day++,g.year&&(r.date=C(r.date).day)):r.year&&r.week?(r[g.type]=1,t=t.replace(g.val,""),c=c.replace(g.val,"")):r[g.type]="Invalid",/date/i.test(g.type)&&0==r[g.type]&&(r[g.type]="Invalid");break;case"month":g.regex.test(e)?(m=w(e.match(g.regex)[0],g.suff,g.str,g.long),r.month=m.val,e=x(e,m.mon||g.regex,g.suff),l=x(l,m.mon||g.regex,g.suff,g.val)):r.month="Invalid",r.month<0&&(r.month="Invalid");break;case"quarter":g.regex.test(e)&&(m=e.match(g.regex)[0],r.quarter=m,e=x(e,m,g.suff),l=x(l,m,g.suff,g.val));break;case"longdate":g.regex.test(e)&&(m=g.str?b(g.array,e.match(g.regex)[0]):parseInt(e.match(g.regex)[0]),r.longdate=T(m.index)?m.index:m,e=x(e,m.mon||m,g.suff),l=x(l,m.mon||m,g.suff,g.val));break;case"hour":case"minute":case"second":case"meridian":g.regex.test(e)&&(g.str?m=e.match(g.regex)[0]:(m=parseInt(e.match(g.regex)[0]),g.railway&&(r.railway=!0)),g.deduct&&m--,r[g.type]=m,g.max&&m>g.max&&(r[g.type]="Invalid"),e=x(e,g.regex),l=x(l,g.regex,g.suff,g.val));break;case"millisecond":g.regex.test(e)&&(m=e.match(g.regex)[0],r.millisecond=parseFloat(m),e=x(e,m).replace(/[S]+/,""),l=x(l,g.regex,g.suff,g.val),c=c.replace(/[S]+/,"S"));break;case"timestamp":g.regex.test(e)&&(m=parseInt(e.match(g.regex)[0]),r.timestamp=m*(g.milli?1:1e3),e=x(e,m),l=x(l,m,g.suff,g.val));break;case"timezone":g.regex.test(e)&&(g.str?(m=e.match(g.regex)[0],m=-u[m]):m=L(e.match(g.regex)),r.timezone=m,e=x(e,g.regex),l=x(l,g.regex,g.suff,g.val))}t=t.replace(g.valForm||g.val,"")}if(a=new Date(s.getFullYear(),T(r.month)?r.month:s.getMonth(),r.date||1,r.hour||0,r.minute||0,r.second||0),T(r.day)||T(r.week)){var f=r.date;T(r.year)||(r.year=a.getFullYear()),T(r.day)||(r.day=1),S.call(this,r),T(f)&&(r.date>f&&r.month++,r.date=f)}if(T(r.longdate)&&r.day&&r.day!=r.longdate?a.setFullYear("Invalid"):T(r.year)&&a.setFullYear(k(r.year)),T(r.month)&&a.setMonth(r.month),T(r.date)&&a.setDate(r.date<=p[a.getMonth()]+(1==a.getMonth()&&A(a.getFullYear())?1:0)?r.date:"Invalid"),T(r.hour)){var y=r.meridian;a.setHours(r.railway?(i=r.hour,(o=y?/pm/i.test(y):r.hour>11)&&i<12?i+=12:12!=i||o||(i=0),i):/pm/i.test(y)?r.hour<12?r.hour+12:r.hour:r.hour%12)}if(T(r.minute)&&a.setMinutes(r.minute),T(r.second)&&a.setSeconds(r.second),T(r.millisecond)&&a.setMilliseconds(r.millisecond),T(r.timestamp)&&(a=new Date(r.timestamp)),T(r.timezone)){var v=a.getTimezoneOffset();if(r.timezone-=v,a.setMinutes(a.getMinutes()+r.timezone),v!=a.getTimezoneOffset()){var h=new Date(this._arg);"Invalid Date"==h.toString()?a.setMinutes(a.getMinutes()-r.timezone):a=h}}else T(this._timezone)&&(r.timezone=this.timezoneOffset(a)-a.getTimezoneOffset(),a.setMinutes(a.getMinutes()+r.timezone));var _="YYYY-MM-DDTHH:mm:ssZ";return c!=_&&e.length==t.length&&c==l&&G.call(this,a)?this._isCorrectFormat=!0:this._format&&c!=_?void 0:G.call(this,new Date(this._arg))}function P(e,t,a,i){var o="";if(i&&e++,a&&(o=function(e){if(e>3&&e<21)return"th";switch(e%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}(e)),t){e=e.toString();for(var r=1;r<t;r++)e.length<=r&&(e="0"+e)}return e+o}function N(e){var t,a=M(D(e)),i={},o=this.toDate(),r=this.split_date(o),s=function(){return new Date(o.getTime()+1e3*(o.getTimezoneOffset()-r.timezone)*60)};e=function(e,t){for(var a=0,i=0;i<t.length;i++)e=e.slice(0,t[i].index+a)+t[i].format.val+c+e.slice(t[i].index+a+t[i].format.val.length),a+=10;return e}(e.replace(/{{|}}/g,""),a);for(var n=0;n<a.length;n++){var l=a[n].format;switch(l.type){case"date":e=e.replace(l.val+c,P(l.year?_(r.month-1,A(r.year),r.date):r.date,l.len,l.suff));break;case"month":e=l.str?e.replace(l.val+c,l.array[r.month-1]):e.replace(l.val+c,P(r.month,l.len,l.suff));break;case"year":e=e.replace(l.val+c,2==l.len?P(r.year%100,2):4==(r.year+"").length?r.year:P(r.year,4)),i.year=i.year||[],i.year.push(l);break;case"day":case"week":i.flag=!0,i[l.type]=i[l.type]||[],i[l.type].push(l);break;case"quarter":e=e.replace(l.val+c,P(Math.ceil(r.month/3),null,l.suff));break;case"longdate":var p=(t=t||s()).getDay();e=l.str?e.replace(l.val+c,l.array[p]):e.replace(l.val+c,P(p,null,l.suff));break;case"hour":var d=r.hour;e=e.replace(l.val+c,P(l.railway?d:d>12?d%12:d||12,l.len,null,l.deduct));break;case"minute":e=e.replace(l.val+c,P(r.minute,l.len));break;case"second":e=e.replace(l.val+c,P(r.second,l.len));break;case"millisecond":e=e.replace(l.val+c,P(o.getMilliseconds(),3)).replace(/\\S+/,"");break;case"timezone":var m="";if(!l.str){var u=r.timezone,g=(d=P(Math.abs(parseInt(u/60)),2),P(Math.abs(u%60),2)),f=u<=0?"+":"-";m="ZZ"==l.val?f+d+g:f+d+":"+g}e=e.replace(l.val+c,m);break;case"timestamp":m="","X"==l.val?m+=parseInt(o.getTime()/1e3):m+=o.getTime(),e=e.replace(l.val+c,m);break;case"meridian":var y=r.meridian;l.lower&&(y=y.toLowerCase()),e=e.replace(l.val+c,y)}}if(i.flag){var v=I(t=t||s());if(i.week)for(var h=0;h<i.week.length;h++){var T=i.week[h],x=I(t,T.ignore);e=e.replace(T.val+c,(0==T.pref?"":"W")+P(x.week,T.len,T.suff))}if(i.day)for(h=0;h<i.day.length;h++)e=e.replace(i.day[h].val+c,v.day-(i.day[h].local?1:0));if(v.repYear&&i.year)for(h=0;h<i.year.length;h++)e=e.replace(2==i.year[h].len?r.year%100:r.year,(2==i.year[h].len?r.year%100:r.year)-1)}return e.replace(/{{|}}/g,"")}function G(e,t){var a=e.constructor;if(a==Date)return this._dateObj=e,this._isMoment=!0,"Invalid Date"!=e.toString();if(a==String){if(t){var i=E.call(this,e,t);return i&&this._isCorrectFormat&&(this._format=t),i}if(this.constructFormat)return G.call(this,e,this.constructFormat.call(this,e));console.warn("Its not supported in lyte-moment-basic.js. Add lyte-moment-additional.js for format construction")}else{if(a==Array)return G.call(this,new Date(Date.parse(Date.apply(Date,a))).getTime());if(a==Number)return e*=/^\d{10}$/.test(e)?1e3:1,G.call(this,new Date(e));if(e._isMoment)return G.call(this,e._dateObj.getTime())}}function q(e,t,a){return e.toLocaleString("en-US",{timeZone:t,timeZoneName:a||"short"})}!function(){try{(new Date).toLocaleString("en-US",{timeZone:"Europe/London"})}catch(e){i=!0}}(),h.prototype={isDef:T,find:b,totdate:_,isLeap:A,dayArr:p,getDObj:function(){var e=this._dateObj,t=this._timezone;if(t){if(!this.is_IE)return new Date(q(e,t));e.setMinutes(e.getMinutes()+e.getTimezoneOffset()-this.timezoneOffset(e))}return e},getWeekReverse:I,weekShort:l,weekMid:n,weekLong:s,longMon:r,shortMon:o,week:"W",crctLength:P,formats:f,replace:x,inbuiltFormats:{},getCorrectYear:k,parseFormat:M,replaceTxt:D,is_IE:i,validate:function(){return!!this._isValid},toDate:function(){return this._dateObj},isSame:function(e){return!!(this.validate()&&e&&e._isMoment&&e._isValid)&&this._dateObj.getTime()==e._dateObj.getTime()},format:function(e){if(this.validate())return e=this.inbuiltFormats[e]||e||"YYYY-MM-DDTHH:mm:ssZ",N.call(this,e)},utc:function(e){return this.timezone("UTC")},local:function(e){return this.timezone(void 0)},timezone:function(e,t){return this._timezone=e,T(t)&&(u[e]="string"==typeof t?-L(t.match(/(\+|\-)(\d{2}):(\d{2})$/)):t,this.is_IE=!0),this},getCurrentTimeZone:function(){return this._timezone},parseDate:function(e,t,a){var i=e.match(/(\d+)\/(\d+)\/(\d+),\s(\d+):(\d+):(\d+)\s(AM|PM)/),o={},r=/GMT(\+|-)(\d+):(\d+):(\d+)$/,s=/GMT(\+|-)(\d+):(\d+)$/,n=/GMT(\+|-)(\d+)$/,l=/\s([A-Z]+)$/;["month","date","year","hour","minute","second"].forEach((function(e,t){o[e]=parseInt(i[t+1])})),o.meridian=i[7];var p=o.hour,c={ACDT:"GMT+10:30",ACST:"GMT+9:30",ACT:"GMT-5",ACWST:"GMT+8:45",ADT:"GMT-3",AEDT:"GMT+11",AEST:"GMT+10",AFT:"GMT+4:30",AKDT:"GMT-8",AKST:"GMT-9",AMST:"GMT-3",AMT:"GMT+4",ART:"GMT-3",AST:"GMT+3",AT:"GMT-4/GMT-3",AWST:"GMT+8",AZOST:"GMT+0",AZOT:"GMT-1",AZT:"GMT+4",BDT:"GMT+8",BIT:"GMT-12",BNT:"GMT+8",BOT:"GMT-4",BRST:"GMT-2",BRT:"GMT-3",BST:"GMT+11",BTT:"GMT+6",CAT:"GMT+2",CCT:"GMT+6:30",CDT:"GMT-4",CEST:"GMT+2",CET:"GMT+1",CHADT:"GMT+13:45",CHAST:"GMT+12:45",CHOST:"GMT+9",CHOT:"GMT+8",CHST:"GMT+10",CHUT:"GMT+10",CIST:"GMT-8",CIT:"GMT+8",CKT:"GMT-10",CLST:"GMT-3",CLT:"GMT-4",COST:"GMT-4",COT:"GMT-5",CST:"GMT+8",CT:"GMT-6/GMT-5",CVT:"GMT-1",CWST:"GMT+8:45",CXT:"GMT+7",DAVT:"GMT+7",DDUT:"GMT+10",EASST:"GMT-5",EAST:"GMT-6",EAT:"GMT+3",ECT:"GMT-5",EDT:"GMT-4",EEST:"GMT+3",EET:"GMT+2",EGST:"GMT+0",EGT:"GMT-1",EIT:"GMT+9",EST:"GMT-5",ET:"GMT-5/GMT-4",FET:"GMT+3",FJT:"GMT+12",FKST:"GMT-3",FKT:"GMT-4",FNT:"GMT-2",GALT:"GMT-6",GAMT:"GMT-9",GET:"GMT+4",GFT:"GMT-3",GILT:"GMT+12",GIT:"GMT-9",GMT:"GMT+0",GST:"GMT-2",GYT:"GMT-4",HADT:"GMT-9",HAST:"GMT-10",HKT:"GMT+8",HMT:"GMT+5",HOVST:"GMT+8",HOVT:"GMT+7",ICT:"GMT+7",IDT:"GMT+3",IOT:"GMT+6",IRDT:"GMT+4:30",IRKT:"GMT+8",IRST:"GMT+3:30",IST:"GMT+2",JST:"GMT+9",KGT:"GMT+6",KOST:"GMT+11",KRAT:"GMT+7",KST:"GMT+9",LHDT:"GMT+11",LHST:"GMT+10:30",LINT:"GMT+14",MAGT:"GMT+11",MART:"GMT-9:30",MAWT:"GMT+5",MDT:"GMT-6",MHT:"GMT+12",MIST:"GMT+11",MIT:"GMT-9:30",MMT:"GMT+6:30",MSK:"GMT+3",MST:"GMT+8",MT:"GMT-7/GMT-6",MUT:"GMT+4",MVT:"GMT+5",MYT:"GMT+8",NCT:"GMT+11",NDT:"GMT-2:30",NFT:"GMT+11",NPT:"GMT+5:45",NRT:"GMT+12",NST:"GMT-3:30",NT:"GMT-3:30",NUT:"GMT-11",NZDT:"GMT+13",NZST:"GMT+12",OMST:"GMT+6",ORAT:"GMT+5",PDT:"GMT-7",PET:"GMT-5",PETT:"GMT+12",PGT:"GMT+10",PHOT:"GMT+13",PhST:"GMT+8",PHT:"GMT+8",PKT:"GMT+5",PMDT:"GMT-2",PMST:"GMT-3",PONT:"GMT+11",PST:"GMT-8",PT:"GMT-8/GMT-7",PWT:"GMT+9",PYST:"GMT-3",PYT:"GMT-4",RET:"GMT+4",ROTT:"GMT-3",SAKT:"GMT+11",SAMT:"GMT+4",SAST:"GMT+2",SBT:"GMT+11",SCT:"GMT+4",SGT:"GMT+8",SLST:"GMT+5:30",SRET:"GMT+11",SRT:"GMT-3",SST:"GMT-11",SYOT:"GMT+3",TAHT:"GMT-10",TFT:"GMT+5",THA:"GMT+7",TJT:"GMT+5",TKT:"GMT+13",TLT:"GMT+9",TMT:"GMT+5",TOT:"GMT+13",TRT:"GMT+3",TVT:"GMT+12",ULAST:"GMT+9",ULAT:"GMT+8",USZ1:"GMT+2",UTC:"GMT+0",UYST:"GMT-2",UYT:"GMT-3",UZT:"GMT+5",VET:"GMT-4",VLAT:"GMT+10",VOLT:"GMT+4",VOST:"GMT+6",VUT:"GMT+11",WAKT:"GMT+12",WAST:"GMT+2",WAT:"GMT+1",WEST:"GMT+1",WET:"GMT+0",WFT:"GMT+12",WGST:"GMT-2",WIB:"GMT+7",WIT:"GMT+9",WST:"GMT+8",YAKT:"GMT+9",YEKT:"GMT+5"};return"PM"==i[7]?12!=p&&(o.hour+=12):12==p&&(o.hour=0),function e(i,p){if(r.test(i)){var d=i.match(r);o.timezone=(60*parseInt(d[2])+parseInt(d[3]))*("-"==d[1]?1:-1)}else if(s.test(i))d=i.match(s),o.timezone=(60*parseInt(d[2])+parseInt(d[3]))*("-"==d[1]?1:-1);else if(n.test(i))d=i.match(n),o.timezone=60*parseInt(d[2])*("-"==d[1]?1:-1);else if(p)o.timezone=0;else if(l.test(i)){var m=i.match(l)[1],u={AMT:{"Amazon Time":"GMT-4","Armenia Time":"GMT+4"},AST:{"Atlantic Standard Time":"GMT-4","Arabia Standard Time":"GMT+3"},BST:{"British Summer Time":"GMT+1","Bangladesh Standard Time":"GMT+6","Bougainville Standard Time":"GMT+11"},CDT:{"Central Daylight Time":"GMT-5","Cuba Daylight Time":"GMT-4"},CST:{"Central Standard Time":"GMT-6","Cuba Standard Time":"GMT-5","China Standard Time":"GMT+8"},GST:{"Gulf Standard Time":"GMT+4","South Georgia Time":"GMT-2"},IST:{"Indian Standard Time":"GMT+5:30","Irish Standard Time":"GMT+1","Israel Standard Time":"GMT+2"},MST:{"Mountain Standard Time":"GMT-7","Malaysia Standard Time":"GMT+8"},WGST:{"West Greenland Time":"GMT-3","West Greenland Summer Time":"GMT-2"}}[m],g=c[m];if(u){var f=q(t,a,"long");for(var y in u)if(-1!=f.indexOf(y)){g=u[y];break}}else g?-1!=["AT","CT","ET","MT","PT"].indexOf(m)&&(g=g.replace(/\/(.+)/,"")):g=q(t,a,"long");e(g,!0)}}(e),o},split_date:function(e){if(this.is_IE){var t=this.getDObj(),a=t.getHours();return{year:t.getFullYear(),month:t.getMonth()+1,date:t.getDate(),hour:a,minute:t.getMinutes(),second:t.getSeconds(),meridian:a>11?"PM":"AM",timezone:this.timezoneOffset(e)}}try{var i=q(e,this._timezone);return this.parseDate(i,e,this._timezone)}catch(e){return this.is_IE=!0,this.split_date()}},timezoneOffset:function(e){if(T(this._timezone)){if(this.is_IE){var t=u[this._timezone];return-(T(t)?t:this._timezone)}return this.split_date(e).timezone}return this.validate()?this.toDate().getTimezoneOffset():(new Date).getTimezoneOffset()},utcOffset:function(e){if(this._isValid)return this.timezoneOffset(this.toDate())}},$L.moment=function(e,t,a,i){return new h(e,t,a,i)},$L.moment.lyteMoment=h,$L.moment.setLimits=function(e,t){d=e,m=t},$L.moment.setTimezone=function(e,i){t=e,T(i)&&(a=i)}}}(window),function(e){if($L.moment){var t=$L.moment.lyteMoment.prototype,a=[{val:"YYYY-MM-DD",regex:/^(\d{4}-\d{2}-\d{2})/},{val:"GGGG-["+t.week+"]WW-E",regex:new RegExp("^(\\d{4}-"+t.week+"\\d{2}-\\d)")},{val:"GGGG-["+t.week+"]WW",regex:new RegExp("^(\\d{4}-"+t.week+"\\d{2})")},{val:"YYYY-DDD",regex:/^(\d{4}-\d{3})/},{val:"YYYY-MM",regex:/^(\d{4}-\d{2})/},{val:"YYYYMMDD",regex:/^(\d{8})/},{val:"GGGG["+t.week+"]WWE",regex:new RegExp("^(\\d{4}"+t.week+"\\d{2}\\d)")},{val:"GGGG["+t.week+"]WW",regex:new RegExp("^(\\d{4}"+t.week+"\\d{2})")},{val:"YYYYDDD",regex:/^(\d{4}\d{3})/}],i=[{val:"HH:mm:ss.SSSS",regex:/^\d{2}:\d{2}:\d{2}\.[0-9]{1,}$/},{val:"HH:mm:ss,SSSS",regex:/^\d{2}:\d{2}:\d{2},[0-9]{1,}$/},{val:"HH:mm:ss",regex:/^\d{2}:\d{2}:\d{2}$/},{val:"HH:mm",regex:/^\d{2}:\d{2}$/},{val:"HHmmss.SSSS",regex:/^\d{6}\.[0-9]{1,}$/},{val:"HHmmss,SSSS",regex:/^\d{6},[0-9]{1,}$/},{val:"HHmmss",regex:/^\d{6}$/},{val:"HHmm",regex:/^\d{4}$/},{val:"HH",regex:/^\d{2}$/}];function o(e,t){for(var a=this.formats.slice(),i={},o=e,r=new RegExp(this.week+"|G|E","i").test(e),s=0;s<a.length;s++){var n=a[s];if(t==n.time&&n.regex.test(o)&&r==!!n.isWEG&&!this.isDef(i[n.type])){if(n.ignore&&!n.ignore.test(o)){var l=this.dayArr[i.month]||30;if(parseInt(o.match(n.regex)[0])<l)continue}if(n.str)(p=this.find(n.array,o.replace(/(Y|G)+/,"")).mon)&&(e=this.replace(e,p,!1,n.val),i[n.type]=n.array?this.find(n.array,p).index:p);else{var p=o.match(n.regex)[0];e=this.replace(e,n.regex,n.suff,n.val),i[n.type]=parseInt(p),"week"==n.type&&(e=replace(e,new RegExp(this.week+"(?=\\["+this.week+")")))}o=o.replace(p,"")}}return e}function r(e,t){for(var a=0;a<e.length;a++)if(e[a].regex.test(t))return e[a]}function s(e,t){var a=this.dayArr,i=this.isLeap(t);return a[e]+(1==e&&i?1:0)}function n(e){return this.toDate().setFullYear(parseInt(this.getCorrectYear(this.crctLength(Number(this.format("YYYY"))%100,2)))),this}t.additional=!0,$L.extend(t,{inbuiltFormats:{localDatetime:"YYYY-MM-DDTHH:mm",localSecondDatetime:"YYYY-MM-DDTHH:mm:ss",localMillisecondDatetime:"YYYY-MM-DDTHH:mm:ss.SSS",defaultDate:"YYYY-MM-DD",defaultTime:"HH:mm",defaultTimeSecond:"HH:mm:ss",defaultTimeMillisecond:"HH:mm:ss.SSS",defaultWeek:"GGGG-[W]WW",defaultMonth:"YYYY-MM"},get:function(e){if(e)return this[e]()},set:function(e,t){if(e){if(t.constructor==Object){for(var a in t)this[a](t[a]);return this}return this[e](t)}},constructFormat:function(e){var t,s=r.call(this,a,e);return s?(t=r.call(this,i,e.replace(s.regex,"")),e=t?s.val+t.val:o.call(this,e.replace(s.regex,s.val),!0)):(e=o.call(this,e),e=o.call(this,e,!0)),e},i18N:function(t,a){if(this.validate()){var i=this.parseFormat(this.replaceTxt(t)).reverse();return t=t.replace(/{{|}}/g,""),i.forEach(function(i){var o=i.format.val,r=this.format(o),s=e._lyteUiUtils?_lyteUiUtils.i18n(r):r,n=i.index;t=t.slice(0,n)+(a?a(r,s,o):s)+t.slice(n+o.length)}.bind(this)),t}}}),new Array({prop:"date",array:[t.weekLong,t.weekShort,t.weekMid]},{prop:"day",array:[t.weekLong,t.weekShort,t.weekMid]},{prop:"month",array:[t.shortMon,t.longMon]},{prop:"year"},{prop:"fullYear"},{prop:"hours"},{prop:"minutes"},{prop:"seconds"},{prop:"milliseconds"},{prop:"UTCMilliseconds"},{prop:"time"}).forEach((function(e){t[e.prop]=function(t){if(this.validate()){var a=this.toDate(),i=e.prop[0].toUpperCase()+e.prop.slice(1);if(this.isDef(t)){if(t.constructor==String)for(var o=0;o<e.array.length;o++){var r=this.find(e.array[o],t);if(r.mon){t=r.index;break}}else t.constructor==Number&&Math.floor(t)!=t&&("year"==e.prop?(e.prop="month",t=Math.round(12*t)):t=Math.round(t));return"day"==e.prop?a.setDate(a.getDate()+(t-a.getDay())):a["set"+i](t),this}return a["get"+i]()}}})),$L.extend(t,{week:function(e){if(this.validate()){var t=this.toDate();return this.isDef(e)?(t.setDate(t.getDate()+7*(e-this.week())),this):this.getWeekReverse(t,1).week}},quarter:function(e){if(this.validate()){var t=this.toDate();return this.isDef(e)?(t.getMonth(),t.setMonth(t.getMonth()+3*(e-this.quarter())),this):Math.ceil(t.getMonth()/3)}},add:function(e,t,a){if(e<0)return this.subtract(Math.abs(e),t,a);if(this.validate()){var i=this.toDate();if(this.isDef(t)){if(this._timezone&&"month"==t){for(var o=$L.moment(i),r=0;r<e;r++){var l=Number(o.format("M"))-1,p=l?s.call(this,l,Number(o.format("YYYY"))):31,c=o.getDObj().getTimezoneOffset();o.add(p,"date");var d=o.getDObj().getTimezoneOffset();d!=c&&this.subtract(d-c,"minutes")}return this}c=i.getTimezoneOffset();var m=this.set(t,this.get(t)+e);return a?n.call(this,m):m}}},subtract:function(e,t,a){if(e<0)return this.add(Math.abs(e),t,a);if(this.validate()){var i=this.toDate();if(this.isDef(t)){if(this._timezone&&"month"==t){for(var o=$L.moment(i),r=0;r<e;r++){var l=Number(o.format("M"))-1,p=l>1?s.call(this,l-1,Number(o.format("YYYY"))):31,c=o.getDObj().getTimezoneOffset();o.subtract(p,"date");var d=o.getDObj().getTimezoneOffset();d!=c&&this.subtract(d-c,"minutes")}return this}var m=this.set(t,this.get(t)-e);return a?n.call(this,m):m}}},startOf:function(e){if(this.validate()){var t,a=this.toDate(),i=this.format(),o=Number(i.slice(0,4)),r=Number(i.slice(5,7)),s=Number(i.slice(8,10)),n=Number(i.slice(11,13)),l=Number(i.slice(14,16)),p=Number(i.slice(17,19)),c=a.getMilliseconds(),d=0,m=this.timezoneOffset(a);switch("week"==e&&(d=24*((a.getDay()||7)-1)*60*60*1e3,t=!0,e="hour"),e){case"year":t=!0;case"month":t&&(d+=24*this.totdate(r-1,this.isLeap(o))*60*60*1e3),t=!0;case"date":case"day":t&&(d+=24*(s-1)*60*60*1e3),t=!0;case"hour":t&&(d+=60*n*60*1e3),t=!0;case"minute":t&&(d+=60*l*1e3),t=!0;case"second":t&&(d+=1e3*p)}if(d){a.setTime(a.getTime()-d-c);var u=this.timezoneOffset(a)-m;u&&a.setTime(a.getTime()+60*u*1e3)}return this}},endOf:function(e){if(this.validate()){this.startOf(e);var t=1;return"week"==e&&(e="day",t=7),this.add(t,{hour:"hours",minute:"minutes",second:"seconds",date:"date",day:"day",month:"month",year:"fullYear"}[e]||e),this.subtract(1,"milliseconds"),this}},fromNow:function(e,t){if(this.validate()){var a=$L.moment(e);if(!a.validate())return;var i=this.get("time"),o=a.get("time"),r=parseInt((o-i)/1e3),s={years:{val:27648e3,conv:31536e3},months:{val:2246400,conv:2592e3},days:{val:79200,conv:86400},hours:{val:2700,conv:3600},minutes:{val:44,conv:60},seconds:{val:0,conv:1}};return timestamp=o-i,ns1=t?"conv":"val",ns2=t?"floor":"round",fn=function(e,t){var a,i;for(a in s)if(e>=s[a][ns1]){val=Math[ns2](e/s[a].conv),i=val;var o=e-val*s[a].conv;o>0&&fn(o,t);break}return t[a]={value:i},{property:a,value:i}},obj={past:r<0,timestamp:timestamp},r=Math.abs(r),$L.extend(obj,fn(r,obj))}}})}}(window),Lyte.Component.register("crm-skype-field",{_template:'<template tag-name="crm-skype-field"> <template is="if" value="{{cxPropView}}"><template case="true"> <template is="if" value="{{crmSkypeValue}}"><template case="true"> <span id="skypeLink" class="cP" onclick="{{action(&quot;skypeCall&quot;,crmSkypeValue)}}">{{crmSkypeValue}}<span class="skype dIB mL5 top2 pR "></span></span> </template><template case="false"> {{cxPropEmptyValue}} </template></template> </template><template case="false"> <div class="lyteField ltIconShow" cx-prop-appearance="box"> <lyte-input id="skypeInput" lt-prop-value="{{lbind(crmSkypeValue)}}" lt-prop-class="cxBorderBottom" class="w100per cxBoxInput lyteInputBox vertical mandatoryField"> </lyte-input> </div> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"text",position:[1]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]}]}},default:{}}],_observedAttributes:["crmSkypeValue","cxPropEmptyValue","cxPropField","cxPropView","cxPropValue"],data:function(){return{crmSkypeValue:Lyte.attr("string"),cxPropEmptyValue:Lyte.attr("string",{default:"-"}),cxPropField:Lyte.attr("object"),cxPropView:Lyte.attr("boolean",{default:!0}),cxPropValue:Lyte.attr("string")}},actions:{skypeCall:function(e){document.getElementById("skypeLink").setAttribute("href","skype:"+e+"?call")}},getValue:function(){return this.getData("crmSkypeValue")},validate:function(){var e=this.getData("crmSkypeValue"),t=this.getData("cxPropField");return e.length<=t.length}}),Lyte.Component.register("crm-email-field",{_template:'<template tag-name="crm-email-field"> <template is="if" value="{{emailOptOut}}"><template case="true"> <lyte-event-listener event-name="tooltipInfo" on-fire="{{action(\'updateTooltip\')}}"> <crux-boolean-component iserror="{{isError}}" cx-prop-error-message="{{cxPropErrorMessage}}" cx-prop-masking-properties="{{cxPropMaskingProperties}}" cx-prop-field="{{cxPropField}}" cx-prop-value="{{cxPropValue}}" cx-prop-empty-value="-"></crux-boolean-component> <template is="if" value="{{record.Email_Opt_Out}}"><template case="true"> <span id="zc_ajax_info_icon_{{cxPropField.id}}" lt-prop-title="{{tooltipData}}" lt-prop-tooltip-class="alignleft" lt-prop-tooltip-config="{&quot;position&quot;:&quot;top&quot;}" class="icon_roundinfo mL5 cP vam"></span> </template></template> </lyte-event-listener></template><template case="false"> <lyte-event-listener event-name="emailFieldTooltipInfo" on-fire="{{action(\'updateEmailFieldTooltip\')}}"> <lyte-event-listener event-name="hideEmailFieldTooltipInfo" on-fire="{{action(\'handleHideEmailFieldTooltipInfo\')}}"> <crux-email-component iserror="{{isError}}" cx-prop-error-message="{{cxPropErrorMessage}}" cx-prop-masking-properties="{{cxPropMaskingProperties}}" cx-prop-field="{{cxPropField}}" class="canvasCruxComponentEdit dIB" cx-prop-empty-value="-" cx-prop-value="{{cxPropValue}}"></crux-email-component> <template is="if" value="{{isEmailFieldTooltipData}}"><template case="true"> <div class="svgIconsImg svgErrorIcon mL3 dIB" lt-prop-title="{{emailFieldTooltipData}}" lt-prop-tooltip-class="alignleft"></div> </template><template case="false"> </template></template> </lyte-event-listener></lyte-event-listener></template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3]},{type:"if",position:[1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"componentDynamic",position:[1,1,1]},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]},false:{dynamicNodes:[]}},default:{}},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}}],_observedAttributes:["cxPropField","cxPropValue","emailOptValue","emailOptOut","moduleName","record","tooltipData","isEmailFieldTooltipData","cxPropMaskingProperties","isError","cxPropErrorMessage"],data:function(){return{cxPropField:Lyte.attr("object"),cxPropValue:Lyte.attr("string"),emailOptValue:Lyte.attr("boolean"),emailOptOut:Lyte.attr("boolean"),moduleName:Lyte.attr("string"),record:Lyte.attr("object"),tooltipData:Lyte.attr("string",{default:""}),isEmailFieldTooltipData:Lyte.attr("boolean",{default:!1}),cxPropMaskingProperties:Lyte.attr("object"),isError:Lyte.attr("boolean"),cxPropErrorMessage:Lyte.attr("string")}},init:function(){if(null!=this.getData("cxPropValue")&&"true"!==this.getData("cxPropValue")&&Lyte.Router.getRouteInstance().currentModel&&Lyte.Router.getRouteInstance().currentModel.emailFieldTooltipData&&Lyte.Router.getRouteInstance().currentModel.emailFieldTooltipData.data[0]&&Lyte.Router.getRouteInstance().currentModel.emailFieldTooltipData.data[0].features_info[0]){var e=Lyte.Router.getRouteInstance().currentModel.emailFieldTooltipData.data[0].features_info[0].details;if(e)for(var t=e.length,a=0;a<t;a++)if(e[a].email===this.getData("cxPropValue")){var i=new Date(e[a].unsubscribed_time).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}),o=I18n.getMsg("crm.unsubscription.reason.tooltip")+"\n"+I18n.getMsg("crm.unsubscribed.mode")+": "+e[a].unsubscribed_mode+"\n"+I18n.getMsg("crm.unsubscribed.time")+": "+i;this.setData("isEmailFieldTooltipData",!0),this.setData("emailFieldTooltipData",o)}}var r=this.getData("cxPropField");if(void 0!==this.getData("moduleName")&&"boolean"===r.data_type){var s=this.getData("record"),n=I18n.getMsg("crm.unsubscribed.mode")+": "+s.Unsubscribed_Mode+"\n"+I18n.getMsg("crm.unsubscribed.time")+": "+s.Unsubscribed_Time;this.setData("tooltipData",n)}},actions:{updateTooltip:function(e){if(e&&e.affectedData){var t=new Date(e.affectedData.Unsubscribed_Time).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}),a=I18n.getMsg("crm.unsubscribed.mode")+": "+e.affectedData.Unsubscribed_Mode+"\n"+I18n.getMsg("crm.unsubscribed.time")+": "+t;this.setData("tooltipData",a)}},updateEmailFieldTooltip:function(e){if(this.$node===$("crm-email-field.fieldupdate_"+e.column_name)[0]){var t=this;if(void 0!==t.getData("cxPropValue")&&"true"!==t.getData("cxPropValue")){var a=store.peekRecord("module",moduleRecordMapping[t.getData("moduleName")].id).api_name;(e=networkUtils.lyteInitiateRequest("/crm/v2.2/"+a+"/"+t.getData("record").id+"/actions/get_feature_specific_info","GET",{params:{features:"unsubscribed_emails"},headers:{"Content-Type":"application/json"}})).then((function(e){if(e&&e.data[0].features_info[0].details){for(var a=e.data[0].features_info[0].details,i=a.length,o=0;o<i;o++)if(a[o].email===t.getData("cxPropValue")){var r=new Date(a[o].unsubscribed_time).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}),s=I18n.getMsg("crm.unsubscription.reason.tooltip")+"\n"+I18n.getMsg("crm.unsubscribed.mode")+": "+a[o].unsubscribed_mode+"\n"+I18n.getMsg("crm.unsubscribed.time")+": "+r;t.setData("isEmailFieldTooltipData",!0),t.setData("emailFieldTooltipData",s);break}}else t.setData("isEmailFieldTooltipData",!1)}))}}},handleHideEmailFieldTooltipInfo:function(){void 0!==this.getData("cxPropValue")&&"true"!==this.getData("cxPropValue")&&this.setData("isEmailFieldTooltipData",!1)}}}),Lyte.Component.register("crm-tag",{_template:'<template tag-name="crm-tag"> <lyte-event-listener event-name="tags" on-fire="{{action(\'tagsListener\')}}"> <div id="tagui" class="tagSection"> <template is="if" value="{{expHandlers(fromRl,\'!\')}}"><template case="true"> <template is="if" value="{{expHandlers(expHandlers(tags.length,\'<=\',0),\'&amp;&amp;\',record.$stop_processing)}}"><template case="true"> <div class="dIB vat tag_Icon fL mR5 zc_cursor_notallowed disabled" style="margin-top:5px;"> <span class="dIB tag_icon let0 t0 op5"></span> </div> </template><template case="false"> <div class="dIB vat tag_Icon fL mR5" style="margin-top:5px;"> <span class="dIB tag_icon let0 t0 op5"></span> </div> </template></template> </template></template> <div class="tagField dIB vat mL0"> <template is="if" value="{{expHandlers(showDropDown,\'!\')}}"><template case="true"> <template is="if" value="{{expHandlers(tags.length,\'<=\',0)}}"><template case="true"> <template is="if" value="{{expHandlers(fromRl,\'!\')}}"><template case="true"> <div id="tagDiv" class="d_addTag dIB vat com_par mL0 pR top5 f13 zcanvas-label" style="display:inline-block;"> <template is="if" value="{{expHandlers(record.$approved,\'!\')}}"><template case="true"> <a class="zcnoprop crm-font-regular f15" lt-prop-title="{{getI18n(\'crm.tags.detailview.create.no.permission.msg\')}}" href="javascript:void(0);" data-zcqa="zohocrm_canvas_addTag" style="color:#5a5a5a">{{getI18n(\'crm.label.add.tags\')}}</a> </template><template case="false"><template is="if" value="{{record.$stop_processing}}"><template case="true"> <a class="zcnoprop crm-font-regular f15 disabled zc_cursor_notallowed" href="javascript:void(0);" data-zcqa="zohocrm_canvas_addTag" style="color:#5a5a5a">{{getI18n(\'crm.label.add.tags\')}}</a> </template><template case="false"><template is="if" value="{{checkButtonStatus(\'tags\',record)}}"><template case="true"> <a class="zcnoprop crm-font-regular f15" href="javascript:void(0);" lt-prop-title="{{getI18n(\'crm.reviewprocess.detailview.create.no.permission.msg\')}}" data-zcqa="zohocrm_canvas_addTag" style="color:#5a5a5a">{{getI18n(\'crm.label.add.tags\')}}</a> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(expHandlers(tagsEditPermission,\'!\'),\'||\',expHandlers(record.$editable,\'!\')),\'||\',expHandlers(record.$approval_state,\'==\',&quot;zia_vision_pending&quot;))}}"><template case="true"> <a class="zcnoprop crm-font-regular f15" href="javascript:void(0);" lt-prop-title="{{getI18n(\'crm.tags.detailview.create.no.permission.msg\')}}" data-zcqa="zohocrm_canvas_addTag" style="color:#5a5a5a">{{getI18n(\'crm.label.add.tags\')}}</a> </template><template case="false"> <a lt-prop-tooltip-config=" { &quot;showdelay&quot;:500,&quot;appearance&quot;:&quot;box&quot;} " lt-prop-title="{{getI18n(\'crm.label.add.tags\')}}" class="zcnoprop crm-font-regular f15 crm-tag-addtext crm-cscript-write-action" href="javascript:void(0);" data-zcqa="zohocrm_canvas_addTag" onclick="{{action(\'showInput\')}}" style="color:#5a5a5a">{{getI18n(\'crm.label.add.tags\')}}</a> </template></template></template></template></template></template></template></template> </div></template><template case="false"> <div>-</div> </template></template>  </template><template case="false"> <div id="tagDiv" class="dIB vam pR "> <ul id="existingTag" class="listview_taglists m0 p0"> <template is="for" items="{{tags}}" item="tag" index="ind"> <li class="tagElementList proxima f13 mB0 dIB cxTagBgSpan cxTagCol{{tag_color(tag.color_code,tag.name)}}"> <template is="if" value="{{expHandlers(fromRl,\'!\')}}"><template case="true"> <a class="zcnoprop" href="{{tag.link}}" target="_blank" style="color: rgb(0, 0, 0);">{{tag.name}}</a> </template><template case="false"> <span class="zcnoprop" style="color: rgb(0, 0, 0);">{{tag.name}}</span> </template></template> </li> </template> <template is="if" value="{{expHandlers(fromRl,\'!\')}}"><template case="true"> <li class="dIB crmaddtag fL"> <template is="if" value="{{expHandlers(expHandlers(record.$approved,\'!\'),\'||\',record.$stop_processing)}}"><template case="true"> <span class="dIB svgIcons addIcon mL0 disabled zc_cursor_notallowed" data-zcqa="zohocrm_canvas_addTagIcon"></span> </template><template case="false"><template is="if" value="{{expHandlers(expHandlers(expHandlers(tagsEditPermission,\'!\'),\'||\',expHandlers(record.$editable,\'!\')),\'||\',expHandlers(record.$approval_state,\'==\',&quot;zia_vision_pending&quot;))}}"><template case="true"> <span class="dIB svgIcons addIcon mL0" lt-prop-title="{{getI18n(\'crm.tags.detailview.create.no.permission.msg\')}}" data-zcqa="zohocrm_canvas_addTagIcon"></span> </template><template case="false"> <span class="dIB svgIcons addIcon mL0 crm-tag-addtext crm-cscript-write-action" data-zcqa="zohocrm_canvas_addTagIcon" lt-prop-title="{{getI18n(\'crm.label.add.tags\')}}" onclick="{{action(\'showInput\')}}"></span> </template></template></template></template> </li> </template></template> </ul> </div> </template></template> </template><template case="false"> <div id="tagDropDown"> <crux-tag cx-prop-tags="{{tags}}" cx-prop-comma-seperation="true" cx-prop-max-tag-limit="{{tagsLimit}}" cx-prop-tag-options="{{lbind(allTags)}}" on-validation="{{method(\'validateTag\')}}" on-error="{{method(\'onError\')}}" cx-prop-prevent-key-list="{{cxPropPrevent}}" on-color-tag-palette-hide="{{method(&quot;hideColor&quot;)}}"> </crux-tag> <div id="tagInputButtonsDiv" class="dIB vab inputButtons"> <input type="button" data-zcqa="zohocrm_canvas_saveTag" value="{{getI18n(\'crm.button.save\')}}" class="f13 pL5 saveButton cP" style="border: 0px; background: transparent; color: rgb(74, 142, 219); opacity: 1;" onclick="{{action(\'saveTagtoRecord\')}}"> <span class="mL5 f13 crm-font-regular cP crm-rl-write-cancel" style="color:#000;" data-zcqa="zohocrm_canvas_cancelTag" onclick="{{action(\'cancelTag\')}}">{{getI18n(\'crm.button.cancel\')}}</span> </div> </div> </template></template> </div> <div class="cB"></div> </div> </lyte-event-listener></template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1,1]},{type:"if",position:[1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[]},false:{dynamicNodes:[]}},default:{}}]}},default:{}},{type:"attr",position:[1,1,3,1]},{type:"if",position:[1,1,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}}]}},default:{}}]}},default:{}}]}},default:{}}]},false:{dynamicNodes:[]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1,1,1]},{type:"for",position:[1,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}}]},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"if",position:[1,1],cases:{true:{dynamicNodes:[]},false:{dynamicNodes:[{type:"attr",position:[0]},{type:"if",position:[0],cases:{true:{dynamicNodes:[{type:"attr",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]}]}},default:{}}]}},default:{}}]}},default:{}}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]},{type:"attr",position:[1,3,1]},{type:"attr",position:[1,3,3]},{type:"text",position:[1,3,3,0]}]}},default:{}},{type:"componentDynamic",position:[1]}],_observedAttributes:["module","record","recordId","allTags","allTagNames","tags","tagNameIdMapping","tagsBeforeEdit","showDropDown","tagsLimit","cxPropPrevent","tagsEditPermission","allowedCount","tempCount","tagCount","fromRl","lyteUnbound"],data:function(){return{module:Lyte.attr("string"),record:Lyte.attr("object"),recordId:Lyte.attr("string"),allTags:Lyte.attr("array",{default:[]}),allTagNames:Lyte.attr("array",{default:[]}),tags:Lyte.attr("array",{default:[]}),tagNameIdMapping:Lyte.attr("object"),tagsBeforeEdit:Lyte.attr("array"),showDropDown:Lyte.attr("boolean",{default:!1}),tagsLimit:Lyte.attr("number",{default:10}),cxPropPrevent:Lyte.attr("array"),tagsEditPermission:Lyte.attr("boolean",{default:!0}),allowedCount:Lyte.attr("number",{default:0}),tempCount:Lyte.attr("number",{default:0}),tagCount:Lyte.attr("number",{default:0}),fromRl:Lyte.attr("boolean",{default:!1}),lyteUnbound:Lyte.attr("boolean",{default:!1})}},tagnamevsid:{},init:function(){this.fireRequest(this),Lyte.Router.getRouteInstance()&&"canvas"===Lyte.Router.getRouteInstance().routeName&&"entity"===Lyte.Router.getRouteInstance().parent.routeName&&!Lyte.Router.getRouteInstance().currentModel.entityDetails.TagsEditPermission&&this.setData("tagsEditPermission",!1)},validatingCanvasRule:function(e,t){var a=moduleRecordMapping[e].api_name;"canvas"===Lyte.Router.getRouteInstance().routeName&&store.peekAll("canvas_rule").filter((function(e){return e.module.api_name===a})).length>0&&store.findRecord(moduleRecordMapping[e].id,t).then((function(e){Lyte.registeredMixins["crm-detailcanvas-utils"].validatingCanvasRule(a,e[0])}))},fireRequest:function(e){e.setExistingTagValue(),e.fetchAllTags()},setExistingTagValue:function(){this.setData("cxPropPrevent",[">","<",","]);for(var e=this.getData("record").Tag,t=e.length,a=0;a<t;a++){var i=e[a];i.link=this.getTagLinkUrl(i)}this.setData("tags",e.slice())},getTagLinkUrl:function(e){var t=this.getData("module"),a={comparator:"equal",field:{api_name:"Tag"},value:[{name:e.name}]};return"undefined"==typeof fromPrintPreview_asp||!1===fromPrintPreview_asp?Lyte.Router.getURL({route:"crm.tab.module.custom-view.list",dynamicParams:[t,moduleRecordMapping[t].cvid],queryParams:{filters:JSON.stringify(a)}}):""},fetchAllTags:function(){var e=this.getData("module"),t=crmConstants.tagNotSupMod,a=store.peekRecord("module",moduleRecordMapping[e].id),i=this;!t.contains(e)&&a.api_supported&&(store.unloadAll("tag"),app.store.makeRequest("findAll","tag",{module:moduleRecordMapping[e].api_name,fromPage:"view"},!1).then((function(e){i.setData("allTags",e),i.populate_tagnamecolor(i,e);var t=i.generateTagNameIdMapping(e);if(i.setData("tagNameIdMapping",t),e.$&&e.$.meta){var a=e.$.meta;i.setData("allowedCount",a.allowed_count),i.setData("tagCount",a.count)}})))},populate_tagnamecolor:function(e,t){for(var a={},i=t.length,o=0;o<i;o++)a[t[o].name]=t[o].color_code;e.tagnamevscolor=a},getSelectedTagNames:function(e){for(var t=[],a=e.length,i=0;i<a;i++){var o=e[i];t.push(o.name)}return t},generateTagNameIdMapping:function(e){for(var t={},a=e.length,i=0;i<a;i++){var o=e[i];t[o.name]=o}return t},processTagStrings:function(e){for(var t=this.getData("tagNameIdMapping"),a=e.length,i=[],o=0;o<a;o++){var r=e[o],s=t[r];s||(s=store.createRecord("tag")).$.set("name",r),i.push(r)}return i},addToExistingTags:function(){for(var e=this.getData("tags"),t=e.length,a=0;a<t;a++)e[a].link||(e[a].link=this.getTagLinkUrl(e[a]));e=e.slice(),this.setData("tags",e);var i=this.getData("record"),o=this.setData("tagCount",o),r=this.getData("tagNameIdMapping");Lyte.triggerEvent("tags",{action:"update",data:e,recordId:i.id,tagCount:o,tempCount:o,tagNameIdMapping:r})},saveTagtoRecord:function(e,t){var a=this.getData("module"),i=t||this.getData("tags"),o=this.getSelectedTagNames(i),r=this.getData("tagsBeforeEdit"),s=this.getSelectedTagNames(r),n=this.getData("tagsLimit"),l=t?"":$L("crux-tag")[0].cxProp("inputValue");if(i.length===n&&""!==l){var p=I18n.getMsg("crm.tags.records.limit.reached",n);return renderingUtils.showAlertMsg(I18n.getMsg(p)),!1}if(0===r.length&&0===i.length&&""!==l)return renderingUtils.showAlertMsg(I18n.getMsg("crm.tag.splChar")),void this.setData("showDropDown",!1);if(""===l)if(s.join(",")!==o.join(",")){var c=!1;if(0===o.length&&(c=!0,o=this.getSelectedTagNames(r)),o){var d,m=this.getData("recordId"),u=/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude3a]|\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/g;if(o.filter((function(e){return e.match(u)})).length>0){renderingUtils.showCustomAlert(I18n.getMsg("crm.tag.name.invalid.emoji"));var g=o.length;for(T=0;T<g;T++)o[T].match(u)&&(o.splice(T,1),g--,T--);if(o.length<=0)return this.setData("tags",r),void this.setData("showDropDown",!1)}if(c){d="/crm/v2/"+moduleRecordMapping[a].api_name+"/"+m+"/actions/remove_tags?fromClient=true&tag_names="+encodeURIComponent(o);var f={"X-ZCSRF-TOKEN":csrfParamName+"="+csrfToken},y=this;app.store.makeRequest("sendXHR",d,"POST",f,this.getData("tags")).then((function(t){var i=JSON.parse(t.response).data;if(i&&i.length>0&&-1!=i[0].message.indexOf("tags updated successfully")){y.validatingCanvasRule(a,m);var r=y.processTagStrings(i[0].details.tags);if(y.setData("tags",r.slice()),y.addToExistingTags(),y.fetchAllTags(),y.setData("showDropDown",!1),e&&e.resolvefn&&e.resolvefn(),CScriptLib&&(!e||e.trigger)){var n=s||[],l=o||[],p=l.diff(n)||[],c=n.diff(l)||[];l=l.map((function(e){return{name:e}})),p=p.map((function(e){return{name:e}})),c=c.map((function(e){return{name:e}})),CScript.dispatchEvent("onTagChanged",void 0,p,c)}}else e&&e.resolvefn&&e.rejectfn(),crmui.showMsgBand("info",I18n.getMsg("crm.tags.add.unsuccessful"),1e3,"")}),(function(){e&&e.resolvefn&&e.rejectfn(),"NO_PERMISSION"===JSON.parse(err.responseText).code?(y.closeTag(),!e&&renderingUtils.displayPermissionDenied(),e&&e.rejectfn&&robjs.rejectfn("NO_PERMISSION")):(!e&&renderingUtils.showCustomAlert(I18n.getMsg("crm.tag.unable.to.process"),I18n.getMsg("crm.label.small.tags"),!1),e&&e.rejectfn&&robjs.rejectfn("INTERNAL_ISSUE"))}))}else{for(var v=t||this.getData("tags"),h=v.length,T=0;T<h;T++)"noFill"===v[T].color_code&&(v[T].color_code=null);this.addtagstoRec(this,{tags:v,over_write:!0,ids:m},m,!0,moduleRecordMapping[a].api_name,"canvas","add",e,o,s)}}else this.setData("showDropDown",!1)}else this.setData("showDropDown",!1);else renderingUtils.showAlertMsg(I18n.getMsg("crm.tag.splChar"))},methods:{onError:function(e,t,a,i,o,r){if(3===t.errorCode){var s=this.getData("tagsLimit");r&&r.toggle(),renderingUtils.showAlertMsg(I18n.getMsg("crm.tags.records.limit.reached",s))}else 1===t.errorCode&&renderingUtils.showAlertMsg(I18n.getMsg("crm.tag.splChar"))},reloadComponent:function(){this.fireRequest(this)},validateTag:function(e){if(!CrmTags.checkCharacter(e))return $L("lyte-dropdown",this.$node)[0].close(),!1;if(!this.data.tagNameIdMapping[e]){var t=this.getData("allowedCount"),a=this.getData("tagCount");return a>=t?(renderingUtils.showAlertMsg(I18n.getMsg("crm.tag.edition.limit.exceeded")),$L("lyte-dropdown",this.$node)[0].close(),!1):(a++,this.setData("tagCount",a),this.getData("tagNameIdMapping")[e]=!1,!0)}},hideColor:function(e,t){var a=this.$node.querySelector("crux-tag"),i=a.component.bodyDrop.querySelector("crux-color-palette lyte-popover");t&&t.target&&!a.component.bodyDrop.contains(t.target)&&!i.component.childComp.contains(t.target)&&(a.toggle("close"),this.setData("showDropDown",!1))}},actions:{tagsListener:function(e){var t=this.getData("record");if("update"===e.action&&e.recordId===t.id){var a=e.data.slice();this.setData("tags",a),this.setData("tagsBeforeEdit",a),e.tagCount&&this.setData("tagCount",e.tagCount),e.tagNameIdMapping&&this.setData("tagNameIdMapping",e.tagNameIdMapping),e.tempCount&&this.setData("tempCount",tempCount)}},showInput:function(){for(var e=$("crm-tag"),t=e.length,a=0;a<t;a++)e[a].component.setData("showDropDown",!1);var i=this.getData("tags").slice(),o=this.getData("tagCount");this.setData("tagsBeforeEdit",i),this.setData("tempCount",o),this.setData("showDropDown",!0),$L("crux-tag",this.$node)[0].focus()},cancelTag:function(){var e=this.getData("record"),t=this.getData("tagsBeforeEdit").slice();this.setData("tags",t),this.setData("showDropDown",!1);var a=this.getData("tempCount");Lyte.triggerEvent("tags",{action:"update",data:t,recordId:e.id,tagCount:a})},saveTagtoRecord:function(){this.saveTagtoRecord()}},closeTag:function(){var e=this.getData("record"),t=this.getData("tagsBeforeEdit").slice();this.setData("tags",t),this.setData("showDropDown",!1);var a=this.getData("tempCount");Lyte.triggerEvent("tags",{action:"update",data:t,recordId:e.id,tagCount:a})}},{mixins:["crm-tag-mixin"]}),Lyte.Component.registerHelper("tag_color",(function(e,t){if(void 0===e&&this.component.tagnamevscolor&&(e=this.component.tagnamevscolor[t]),void 0===e)return 0;if(null===e)return 0;if(!e.includes("#"))return 0;var a={"#F17574":"1","#F48435":"2","#E7A826":"3","#A8C026":"4","#63C57E":"5","#1DB9B4":"6","#57B1FD":"7","#879BFC":"8","#D297EE":"9","#FD87BD":"10","#969696":"11","#658BA8":"12","#B88562":"13",null:"0","#noFill":"0"};return a[e]?a[e]:0})),Lyte.Component.register("crm-tag-modal",{_template:'<template tag-name="crm-tag-modal" id="{{popUp}}_TagComp_{{from}}"> <template is="if" value="{{expHandlers(from,\'==\',&quot;convert&quot;)}}"><template case="true"> <template is="if" value="{{tagAvail()}}"><template case="true"> <lyte-table lt-prop-yield="true" class="convertLeadTagsMassConvert w500"> <template is="registerYield" yield-name="yield"> <lyte-table-structure> <lyte-tbody> <lyte-tr class="convertLeadTagsMassConvertTr"> <lyte-td class="convertLeadTagsMassConvertTd vat w170 f15 col222">{{getI18n(\'crm.tags.single.convert.info\')}}</lyte-td> <lyte-td class="convertLeadTagsMassConvertTd"> <div class="carryOverTag pB15"> <lyte-checkbox id="conTagCheck" lt-prop-label="{{contacts_label}}" on-changed="{{method(\'showHideCarryOverTagCont\',this)}}"></lyte-checkbox> <div class="carryOverTagCont pT5" style="display: none;"> <crux-tag id="conTag" cx-prop-class="cxTags_conTag" cx-prop-box-class="tag_dropdown" cx-prop-tag-options="{{lbind(tagarray)}}" cx-prop-tags="{{lbind(selectedtags)}}" cx-prop-allow-dropdown="true" cx-prop-allow-new-tag-creations="false" on-before-remove-tag="{{method(&quot;remove_tag_convert&quot;,&quot;conTag&quot;)}}"> </crux-tag> </div> </div> <div class="carryOverTag pB15"> <lyte-checkbox id="accTagCheck" lt-prop-label="{{acc_label}}" on-changed="{{method(\'showHideCarryOverTagCont\',this)}}"></lyte-checkbox> <div class="carryOverTagCont pT5" style="display: none"> <crux-tag id="accTag" cx-prop-class="cxTags_accTag" cx-prop-box-class="tag_dropdown" cx-prop-tag-options="{{lbind(tagarray_Acc)}}" cx-prop-tags="{{lbind(selectedtags_Acc)}}" cx-prop-allow-dropdown="true" cx-prop-allow-new-tag-creations="false" on-before-remove-tag="{{method(&quot;remove_tag_convert&quot;,&quot;accTag&quot;)}}"> </crux-tag> </div> </div> <div class="carryOverTag disabled eventNone" id="pot_tag_checkbox"> <lyte-checkbox id="potTagCheck" lt-prop-label="{{deal_label}}" on-changed="{{method(\'showHideCarryOverTagCont\',this)}}"></lyte-checkbox> <div class="carryOverTagCont pT5" style="display: none"> <crux-tag id="potTag" cx-prop-class="cxTags_potTag" cx-prop-box-class="tag_dropdown" cx-prop-tag-options="{{lbind(tagarray_Pot)}}" cx-prop-tags="{{lbind(selectedtags_Pot)}}" cx-prop-allow-dropdown="true" cx-prop-allow-new-tag-creations="false" on-before-remove-tag="{{method(&quot;remove_tag_convert&quot;,&quot;potTag&quot;)}}"> </crux-tag> </div> </div> </lyte-td> </lyte-tr> </lyte-tbody> </lyte-table-structure> </template> </lyte-table> </template></template> </template><template case="false"> <lyte-modal lt-prop-yield="true" lt-prop-wrapper-class="crmBoxModal" id="{{popUp}}_TagPopUp" lt-prop-show-close-button="false" lt-prop-show="true" lt-prop-width="600px" lt-prop-freeze="true" lt-prop-allow-multiple="true" lt-prop-offset="{&quot;top&quot;:&quot;0&quot;}"> <template is="registerYield" yield-name="modal"> <lyte-modal-header>{{tagPopUpName}}</lyte-modal-header> <lyte-modal-content> <template is="if" value="{{expHandlers(popUp,\'==\',&quot;add&quot;)}}"><template case="true"> <crux-tag id="tag_popup_{{from}}_add" cx-prop-class="tags_{{from}}" cx-prop-box-class="tag_dropdown" cx-prop-tag-options="{{lbind(tagarray)}}" cx-prop-tags="{{lbind(selectedtags)}}" cx-prop-allow-dropdown="true" cx-prop-comma-seperation="true" cx-prop-prevent-key-list="[&quot;<&quot;,&quot;>&quot;,&quot;,&quot;]" on-error="{{method(\'onError\')}}" on-before-add-tag="{{method(&quot;validate_tag&quot;,&quot;add&quot;)}}" on-before-remove-tag="{{method(&quot;beforeremove&quot;)}}" on-remove-tag="{{method(&quot;removeTag&quot;)}}" on-add-tag="{{method(&quot;addTagCrux&quot;)}}"> </crux-tag> </template><template case="false"> <crux-tag id="tag_popup_{{from}}_remove" cx-prop-class="tags_{{from}}" cx-prop-box-class="tag_dropdown" cx-prop-tag-options="{{lbind(tagarray)}}" cx-prop-tags="{{lbind(selectedtags)}}" cx-prop-allow-dropdown="true" cx-prop-comma-seperation="true" cx-prop-allow-new-tag-creations="false" on-before-add-tag="{{method(&quot;validate_tag&quot;,&quot;remove&quot;)}}" on-remove-tag="{{method(&quot;removeTag&quot;)}}" on-add-tag="{{method(&quot;addTagCrux&quot;)}}"> </crux-tag> </template></template> <div class="pT10 dIB t_options" style="display: flex;"> <template is="if" value="{{expHandlers(popUp,\'==\',&quot;add&quot;)}}"><template case="true"> <lyte-checkbox id="overwriteCheckbox_{{from}}" lt-prop-type="default" lt-prop-checked="{{lbind(isOverWrite)}}"></lyte-checkbox> <div class="dIB fL">{{getI18n(\'crm.tag.record.overwrite\')}}</div> </template><template case="false"> <div class="dIB fL">{{getI18n(\'crm.remove.tag.info\')}}</div> </template></template> </div> </lyte-modal-content> <lyte-modal-footer> <template is="if" value="{{expHandlers(popUp,\'==\',&quot;add&quot;)}}"><template case="true"> <div class="footer_tagline fL f13 color_6">{{getI18n(\'crm.tags.separate.info\')}}</div> </template></template> <div class="fR"> <lyte-button id="tagModalCancelBtn_{{from}}" lt-prop-appearance="default" lt-prop-class="mR0" onclick="{{action(\'closeModalpop\')}}"> <template is="registerYield" yield-name="text">{{getI18n(\'Cancel\')}}</template> </lyte-button> <template is="if" value="{{expHandlers(popUp,\'==\',&quot;add&quot;)}}"><template case="true"> <lyte-button lt-prop-appearance="primary" lt-prop-class="mR0" id="{{concat(\'tagModal_\',popUp,\'_Btn\')}}" onclick="{{action(\'savetags\',\'add\')}}"> <template is="registerYield" yield-name="text">{{saveBtmMessage}}</template> </lyte-button> </template><template case="false"> <template is="if" value="{{expHandlers(from,\'===\',\'wf\')}}"><template case="true"> <lyte-button lt-prop-appearance="primary" lt-prop-class="mR0" id="{{concat(\'tagModal_\',popUp,\'_Btn\')}}" onclick="{{action(\'savetags\',\'remove\')}}"> <template is="registerYield" yield-name="text">{{saveBtmMessage}}</template> </lyte-button> </template><template case="false"> <lyte-button lt-prop-appearance="failure" lt-prop-class="mR0" id="{{concat(\'tagModal_\',popUp,\'_Btn\')}}" onclick="{{action(\'savetags\',\'remove\')}}"> <template is="registerYield" yield-name="text">{{getI18n(\'crm.button.remove\')}}</template> </lyte-button> </template></template> </template></template> </div> <div class="clearB"></div> </lyte-modal-footer> </template> </lyte-modal> </template></template> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,1,1,1,0]},{type:"componentDynamic",position:[1,1,1,1]},{type:"attr",position:[1,1,1,3,1,1]},{type:"componentDynamic",position:[1,1,1,3,1,1]},{type:"attr",position:[1,1,1,3,1,3,1]},{type:"componentDynamic",position:[1,1,1,3,1,3,1]},{type:"attr",position:[1,1,1,3,3,1]},{type:"componentDynamic",position:[1,1,1,3,3,1]},{type:"attr",position:[1,1,1,3,3,3,1]},{type:"componentDynamic",position:[1,1,1,3,3,3,1]},{type:"attr",position:[1,1,1,3,5,1]},{type:"componentDynamic",position:[1,1,1,3,5,1]},{type:"attr",position:[1,1,1,3,5,3,1]},{type:"componentDynamic",position:[1,1,1,3,5,3,1]},{type:"componentDynamic",position:[1,1,1,3]},{type:"componentDynamic",position:[1,1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]},{type:"componentDynamic",position:[1]}]}},default:{}}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,0]},{type:"componentDynamic",position:[1]},{type:"attr",position:[3,1]},{type:"if",position:[3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3,3,1]},{type:"if",position:[3,3,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"componentDynamic",position:[1]},{type:"text",position:[3,0]}]},false:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"componentDynamic",position:[3]},{type:"attr",position:[5,1]},{type:"if",position:[5,1],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"attr",position:[5,3,1]},{type:"registerYield",position:[5,3,1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[5,3,1]},{type:"attr",position:[5,3,3]},{type:"if",position:[5,3,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[0]}]},{type:"componentDynamic",position:[1]}]}},default:{}}]}},default:{}},{type:"componentDynamic",position:[5]}]},{type:"componentDynamic",position:[1]}]}},default:{}}],_templateAttributes:{type:"attr",position:[]},_observedAttributes:["moduleInfo","module","PopUpName","alltags","renderItems","newTagSysVal","message","undef","maxTagLimit","newTagCount","recordTagLimit","placeHolder","tagarray","tagnamevstagid","selectedtags","selectedtaginfo","tagarray_Acc","tagarray_Pot","selectedtags_Acc","selectedtags_Pot","isOverWrite","isOrchestration","contacts_label","acc_label","deal_label","saveBtmMessage","tagnamevsmodrefid"],data:function(){return{moduleInfo:Lyte.attr("object"),module:Lyte.attr("string"),PopUpName:Lyte.attr("string"),alltags:Lyte.attr("array",{default:[]}),renderItems:Lyte.attr("array",{default:[]}),newTagSysVal:Lyte.attr("string"),message:Lyte.attr("string"),undef:Lyte.attr("number",{default:void 0}),maxTagLimit:Lyte.attr("number"),newTagCount:Lyte.attr("number",{default:0}),recordTagLimit:Lyte.attr("number"),placeHolder:Lyte.attr("string"),tagarray:Lyte.attr("array",{default:[]}),tagnamevstagid:Lyte.attr("object",{default:{}}),selectedtags:Lyte.attr("array",{default:[]}),selectedtaginfo:Lyte.attr("array",{default:[]}),tagarray_Acc:Lyte.attr("array",{default:[]}),tagarray_Pot:Lyte.attr("array",{default:[]}),selectedtags_Acc:Lyte.attr("array",{default:[]}),selectedtags_Pot:Lyte.attr("array",{default:[]}),isOverWrite:Lyte.attr("boolean",{default:!1}),isOrchestration:Lyte.attr("boolean",{default:!1}),contacts_label:Lyte.attr("string"),acc_label:Lyte.attr("string"),deal_label:Lyte.attr("string"),saveBtmMessage:Lyte.attr("string"),tagnamevsmodrefid:Lyte.attr("object",{default:{}})}},idvsname:{},tagnamevscolor:{},tagnames:[],tags_convert:[],tagrefidvsname:{},init:function(){var e=this.getData("module");this.setData("moduleInfo",moduleRecordMapping[e]),"add"===this.getData("popUp")?(this.setData("tagPopUpName",I18n.getMsg("crm.label.add.tags")),this.setData("currentPopup","add_tags")):(this.setData("tagPopUpName",I18n.getMsg("crm.label.remove.tags")),this.setData("currentPopup","remove_tags")),"convert"===this.getData("from")&&(this.setData("contacts_label",moduleRecordMapping.Contacts.singular_label),this.setData("acc_label",moduleRecordMapping.Accounts.singular_label),this.setData("deal_label",moduleRecordMapping.Potentials.singular_label)),this.setData("saveBtmMessage",I18n.getMsg("crm.button.save"))},didConnect:function(){for(var e={},t={},a={},i={},o=[],r=this.getData("alltags"),s=r.length,n=0;n<s;n++){e[r[n].name]=r[n].color_code,t[r[n].name]=r[n].id,a[r[n].modRefId]=r[n].name,i[r[n].name]=r[n].modRefId,o.push(r[n].name);var l={name:r[n].name,color_code:r[n].color_code};Lyte.arrayUtils(this.getData("tagarray"),"push",l)}if(this.tagnamevscolor=e,this.tagrefidvsname=a,this.setData("tagnamevscolor",e),this.setData("tagnamevstagid",t),this.setData("tagrefidvsname",a),this.setData("tagnamevsmodrefid",i),this.tagnames=o,"convert"===this.getData("from")){this.setData("tagarray",[]);var p=this.getData("tagnamevscolor"),c=this.getData("tagnamevstagid"),d=CrmTags.clientJSON.array,m=(s=d.length,this.getData("tagrefidvsname"));for(n=0;n<s;n++){var u={name:y=m[d[n]],id:c[y],color_code:p[y]};Lyte.arrayUtils(this.getData("selectedtags"),"push",u),Lyte.arrayUtils(this.getData("selectedtags_Acc"),"push",u),Lyte.arrayUtils(this.getData("selectedtags_Pot"),"push",u)}}else{var g=this.getData("selectedtaginfo"),f=g.length;for(t=this.getData("tagnamevstagid"),e=this.tagnamevscolor,n=0;n<f;n++){var y,v=t[y=g[n]],h=e[y];this.getData("isOrchestration")&&void 0===h&&void 0===v&&(v=t[y=CrmTags.gettagname(y,"tagname")],h=e[y]);l={name:y,id:v,color_code:h};Lyte.arrayUtils(this.getData("selectedtags"),"push",l)}}},closeModal:function(){var e=$("crux-tag")[0];e.resetSearch(),e.toggle("close");var t=this.getData("popUp")+"_TagPopUp",a=document.getElementById(t);a&&a.ltProp("show",!1)},showMsg:function(e,t,a,i){for(var o,r=!1,s=!1,n=t.data,l=0,p=n.length,c=0;c<p;c++)"permission denied to  update records"===n[c].message&&l++;if(a)o=I18n.getMsg("crm.tags.list.view.added.successfully"),s=!0;else if(e.length==t.success_count)o=I18n.getMsg("crm.tags.list.view.added.successfully"),s=!0;else if(0==t.success_count||i)o=0==t.locked_count?1==e.length?I18n.getMsg("crm.tags.list.view.single.record.limit.reached",this.getData("recordTagLimit")):I18n.getMsg("crm.tags.list.view.all.records.limit.reached",this.getData("recordTagLimit")):1==e.length?I18n.getMsg("crm.tags.list.view.single.record.locked"):t.locked_count==e.length?I18n.getMsg("crm.tags.list.view.all.record.locked"):"<p id='secondMsg' class='f14 pT5 pB5'>"+I18n.getMsg("crm.tags.list.view.some.record.not.updated",[e.length-t.locked_count])+"<br>"+I18n.getMsg("crm.tags.list.view.some.record.locked",[t.locked_count])+"</p>",r=!0;else{var d=t.success_count;o=e.length>1?'<p id="firstMsg" class="f14 pT5 pB5">'+I18n.getMsg("crm.tags.record.limit.reached.server.side.msg1",d)+"</p>":"",l>0&&(o+='<p id="firstMsg" class="f14 pT5 pB5">'+I18n.getMsg("crm.tags.list.view.perm.denied",l)+"</p>");var m=e.length-d-t.locked_count-l;m>0&&(0==t.locked_count?o+='<p id="secondMsg" class="f14 pT5 pB5">'+I18n.getMsg("crm.tags.record.limit.reached.server.side.msg2",[m,this.getData("recordTagLimit")])+"</p>":o+='<p id="secondMsg" class="f14 pT5 pB5">'+I18n.getMsg("crm.tags.record.limit.reached.server.side.msg3",[m,this.getData("recordTagLimit")])+"<br>"+I18n.getMsg("crm.tags.list.view.some.records.locked.remaining",[t.locked_count])+"</p>"),r=!0}s?_cruxUtils.showCustomMessage({params:{ltPropMessage:o}}):r&&setTimeout((function(){renderingUtils.showAlertMsg(o)}),500)},addTags:function(e){var t,a,i="",o=this.getData("selectedtags"),r=o.length,s=this,n=customViewObject.selectedIds,l=Lyte.Router.getRouteInstance();for(t=void 0!==this.getData("moduleInfo")?this.getData("moduleInfo").api_name:this.getData("module"),a=0;a<r;a++)i=""===i?o[0].name:i+","+o[a].name;if("add"===e){var p=document.querySelector("#overwriteCheckbox_list").checked;store.triggerAction("entity","add_tags",{tag_names:i,ids:n.join(","),over_write:p,type:"POST",fromPage:"view",module:t,from:this.getData("from")}).then((function(e){"list"===l.routeName?crmListView.reloadCurrentListView():(customViewObject.selectedIds=[],l.refresh().data={fetchOnlyBody:!0,clearCache:!0}),s.closeModal(),"permission denied to  update records"===e.message||"FAILURE"===e.code?_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.tags.add.tags.per.den.all.record")}}):s.showMsg(n,e,p)}),(function(e){var t=JSON.parse(e.response);t.data&&t.data[0]&&"CANNOT_PROCESS"===t.data[0].code?("list"===l.routeName&&crmListView.reloadCurrentListView(),s.showMsg(n,t,p)):s.ShowTagErrorMsg(e),commonUtils.showHideLoadingDiv(),s.closeModal()}))}else store.triggerAction("entity","remove_tags",{tag_names:i,ids:n.join(","),type:"POST",fromPage:"view",module:t,from:this.getData("from")}).then((function(e){crmListView.reloadCurrentListView(),s.closeModal(),"permission denied to  update records"===e.message||"FAILURE"===e.code?_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.tags.add.tags.per.den.all.record")}}):_cruxUtils.showCustomMessage({params:{ltPropMessage:I18n.getMsg("crm.tags.removed.successfully")}})}),(function(e){var t=JSON.parse(e.response);t.data&&t.data[0]&&"CANNOT_PROCESS"===t.data[0].code?("list"===l.routeName&&crmListView.reloadCurrentListView(),s.showMsg(n,t,p,!0)):s.ShowTagErrorMsg(e),commonUtils.showHideLoadingDiv(),s.closeModal()}))},aftercreate_list:function(e,t,a,i){for(var o=t.length,r={},s={},n=0;n<o;n++){var l=t[n].name;r[l]=t[n].id,s[l]=t[n].modRefId,e.tagnames.indexOf(l)&&Lyte.arrayUtils(e.getData("tagarray"),"push",{name:l}),e.setData("tagnamevstagid",r),e.setData("tagnamevsmodrefid",s),Lyte.arrayUtils(e.tagnames,"push",l),Crm.trackSpotLightAction("Tagging - List View Tags Create",{Module:i,Count:o})}e.addTags(a)},aftercreate_wf:function(e,t,a){if("remove"!==t&&void 0!==t)for(var i=t.length,o=0;o<i;o++){var r=t[o].name;Lyte.objectUtils(e.getData("tagnamevstagid"),"add",r,t[o].id),Lyte.objectUtils(this.tagnamevscolor,"add",t[o].name,t[o].color_code),Lyte.objectUtils(e.idvsname,"add",t[o].modRefId,r),Lyte.arrayUtils(e.tagnames,"push",r)}var s=e.getData("selectedtags"),n=[],l=[],p=s.length;for(o=0;o<p;o++){var c=s[o].name,d=s[o].id;n.push(c),l.push(d)}CrmTags.clientJSON={},CrmTags.clientJSON.selectedIds=n,commonUtils.showHideLoadingDiv(),removeFreezeLayer(),wfTags.executeAddTagSaveOperation(n,wfTags.actionId,a),"add"===a?document.getElementById("add_TagPopUp").setAttribute("lt-prop-show",!1):document.getElementById("remove_TagPopUp").setAttribute("lt-prop-show",!1)},actions:{savetags:function(e){var t=this,a=t.getData("selectedtags"),i=$L("crux-tag")[0],o=a.length;if("wf"===t.getData("from")&&t.data.selectedtaginfo.length>0&&0===t.data.selectedtags.length){var r;"add"===e?r="AddTags":"remove"===e&&(r="RemoveTags");var s=I18n.getMsg("crm.workflow.rule.label.confirm.deletepop.msg.detail1",I18n.getMsg("crm.workflow.actions.listing."+r)),n={val:I18n.getMsg("crm.button.ok"),fn:function(){var e=objectUtils.getValueFromObj(wfTags,["calleeConfig","removeAction"]);"function"==typeof e&&e(),wfActions.deleteSingleAction(r,CrmTags.clientJSON.suffix),wfTags.showHideTaggingOption("cancel","AddTags"==r?"add":"remove"),wfTags.calleeConfig=void 0}},l={val:I18n.getMsg("crm.button.cancel"),fn:function(){$("#customConfirmationPop").hide()}};return removeFreezeLayer(),"add"===e?document.getElementById("add_TagPopUp").setAttribute("lt-prop-show",!1):document.getElementById("remove_TagPopUp").setAttribute("lt-prop-show",!1),void renderingUtils.showCustomConfirmMessageNewModel(s,n,l)}if(!t.notagselected(o)){var p,c=t.getData("from");if(commonUtils.showHideLoadingDiv(!0),null!==a&&o>0&&JSON.stringify(a).includes('"isNewTag":true'))p=void 0!==this.getData("moduleInfo")?this.getData("moduleInfo").api_name:this.getData("module"),t.createtagRec(a,this.tagnames),"list"===c&&t.createtags(p,"list-view",e),"wf"===c&&(t.createtags(p,"wf",e),"add"===e?document.getElementById("add_TagComp_wf").setAttribute("lt-prop-show",!1):document.getElementById("#remove_TagComp_wf").setAttribute("lt-prop-show",!1));else"list"===c?t.addTags(e):t.aftercreate_wf(t,"",e);i.toggle("close"),i.resetSearch()}},closeModalpop:function(){this.closeModal()}},methods:{onError:function(e,t){1===t.errorCode&&renderingUtils.showAlertMsg(I18n.getMsg("crm.tag.splChar"))},beforeremove:function(e){var t=this.tagnames;if(!t.contains(e)){var a=this.getData("newTagCount");a--,this.setData("newTagCount",a)}"wf"!==this.getData("from")||t.contains(e)},remove_tag_convert:function(e,t){var a=this.tagnamevscolor,i={name:t,id:this.getData("tagnamevstagid")[t],color_code:a[t]};if("conTag"===e){for(var o=(s=this.getData("tagarray")).length,r=0;r<o;r++)if(s[r].name===t)return;Lyte.arrayUtils(this.getData("tagarray"),"push",i)}else if("accTag"===e){for(o=(s=this.getData("tagarray_Acc")).length,r=0;r<o;r++)if(s[r].name===t)return;Lyte.arrayUtils(this.getData("tagarray_Acc"),"push",i)}else{var s;for(o=(s=this.getData("tagarray_Pot")).length,r=0;r<o;r++)if(s[r].name===t)return;Lyte.arrayUtils(this.getData("tagarray_Pot"),"push",i)}},showpop:function(){var e=$L("crm-tag-modal")[0].component;e.setData("selectedtags",[]);for(var t=e.getData("selectedtaginfo"),a=e.getData("tagnamevstagid"),i=e.tagnamevscolor,o=t.length,r=0;r<o;r++){var s,n={};s=CrmTags.isOrchestration?CrmTags.gettagname(t[r],"tagname"):t[r],n.name=s,n.id=a[s],n.color_code=i[s],Lyte.arrayUtils(e.getData("selectedtags"),"push",n)}},validate_tag:function(e,t){"add"!==e&&"remove"!==e&&(e=this.getData("popUp"));var a=this.tagnames;if("add"===e)if(a.contains(t))i=this.validatetags(t,this.getData("recordTagLimit"),this.getData("selectedtags").length+1,0,0,"add",this.getData("from"));else var i=this.validatetags(t,this.getData("recordTagLimit"),this.getData("selectedtags").length+1,this.getData("maxTagLimit"),this.getData("tagarray").length+this.getData("newTagCount")+1,"add",this.getData("from"));else i=this.validatetags(t,this.getData("recordTagLimit"),this.getData("selectedtags").length+1,0,0,"remove",this.getData("from"));if(!i)return document.querySelector("crux-tag").toggle("close"),!1;if(!(a=this.tagnames).contains(t)){var o=this.getData("newTagCount")+1;this.setData("newTagCount",o)}},showHideCarryOverTagCont:function(e){var t=$L(e).closest(".carryOverTag").find(".carryOverTagCont");e.checked?t.slideDown():t.slideUp()},removeTag:function(){"wf"===this.getData("from")&&this.data.selectedtaginfo.length>0&&0===this.data.selectedtags.length&&this.setData("saveBtmMessage",I18n.getMsg("crm.workflow.actions.tags.action.remove.btnmsg"))},addTagCrux:function(){"wf"===this.getData("from")&&this.data.selectedtaginfo.length>0&&this.data.selectedtags.length>0&&this.setData("saveBtmMessage",I18n.getMsg("crm.button.save"))}},ShowTagErrorMsg:function(e){(e=JSON.parse(e.response)).details&&e.details.permissions?-1!=e.details.permissions.indexOf("Crm_Implied_Tags_Accounts")&&1==e.details.permissions.length?renderingUtils.showMsgBox(I18n.getMsg("crm.tags.add.remove.permission.error"),"error"):renderingUtils.showMsgBox(I18n.getMsg("crm.tags.add.tags.per.den.all.record"),"error"):renderingUtils.showMsgBox(I18n.getMsg("crm.tags.add.unsuccessful"),"error")}},{mixins:["crm-tag-mixin"]}),Lyte.Component.registerHelper("tagAvail",(function(){if(null!==CrmTags.clientJSON.array&&CrmTags.clientJSON.array.length>0)return!0})),window.addEventListener("resize",(function(){setTimeout((function(){for(var e=$("crux-tag"),t=e.length,a=0;a<t;a++)e[a].resetPosition()}),200)}));
