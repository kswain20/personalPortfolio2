Lyte.Component.register("crm-macro",{_template:'<template tag-name="crm-macro"> <template is="if" value="{{expHandlers(expHandlers(from,\'===\',&quot;listView&quot;),\'||\',expHandlers(from,\'===\',\'\'))}}"><template case="true"> <lyte-button lt-prop-class="macroDropBtn zc-macro mR0" class="pR mL8 macromarginRight" id="macro_{{compId}}" data-zcqa="btn_wf_runMacro" onclick="{{action(\'showMacroDropDown\')}}"> <template is="registerYield" yield-name="text"> <span class="zcref_button spanMacroBtn">{{getI18n("crm.macro.button.label.macro")}}</span> </template> </lyte-button> </template><template case="false"> <lyte-button lt-prop-class="macroDropBtn zc-macro mR0" lt-prop-disabled="{{checkButtonStatus(\'macro\',record)}}" class="pR mL8 macromarginRight" id="macro_{{compId}}" data-zcqa="btn_wf_runMacro" onmouseover="{{action(\'checkDisableBtn\',this)}}" onmouseout="{{action(newhidett)}}" onclick="{{action(\'showMacroDropDown\')}}"> <template is="registerYield" yield-name="text"> <span class="zcref_button spanMacroBtn">{{getI18n("crm.macro.button.label.macro")}}</span> </template> </lyte-button> </template></template> <lyte-popover on-before-show="{{method(\'initialize\')}}" on-before-close="{{method(\'moreMacroClose\')}}" lt-prop-wrapper-class="macropopover" on-show="{{method(&quot;doStuff&quot;)}}" lt-prop-origin-elem="#macro_{{compId}}" lt-prop-class="marcoDropBox" id="divMacro_{{compId}}" lt-prop-duration="0" lt-prop-freeze="false" lt-prop-type="box" lt-prop-show-close-button="false" lt-prop-placement="bottomLeft"> <template is="registerYield" yield-name="popover"> <template is="if" value="{{expHandlers(macros.length,\'>\',9)}}"><template case="true"> <lyte-popover-header> <lyte-search data-zcqa="txt_wf_searchTitle" id="macroSearchBox" onfocus="{{action(\'onFocusSearch\',event,this)}}" onfocusout="{{action(\'onFocusOutSearch\',event,this)}}" class="macroSearchStyle" lt-prop-style="padding-left:8px" lt-prop-placeholder="{{getI18n(\'crm.globalsearch.search.title\')}}" lt-prop-query-selector="{&quot;scope&quot;:&quot;.macrosearchbody&quot;,&quot;search&quot;:&quot;li:not(.prevent)&quot;, &quot;target&quot; : &quot;li:not(.prevent)&quot;}" style="width:100%" on-search="{{method(&quot;onSearch&quot;)}}" lt-prop-appearance="box"> </lyte-search> </lyte-popover-header> </template></template> <lyte-popover-content> <ul class="macrosearchbody {{if(expHandlers(expHandlers(macros.length,\'<\',10),\'&amp;&amp;\',expHandlers(macros.length,\'>\',0)),\'paddingTLNew\',\'\')}}"> <template is="for" items="{{macros}}" item="item" index="index"> <li data-zcqa="macroExec_{{item.name}}" data-value="{{item.id}}" onclick="{{action(hideMacroDropDown,item.id)}}">{{item.name}}</li> </template> <template is="if" value="{{expHandlers(show,\'||\',expHandlers(permission,\'!\'))}}"><template case="true"> <li data-zcqa="noMatchMacroElem" class="prevent">{{getI18n("crm.macro.label.noMacroFoundForTheModule")}}</li> </template></template> </ul> </lyte-popover-content> <template is="if" value="{{expHandlers(permission,\'||\',expHandlers(macros.length,\'>\',0))}}"><template case="true"> <lyte-popover-footer class="{{if(macros.length,\'macroBtop\',\'\')}}"> <ul onclick="{{action(\'closeMacroPopup\')}}"> <template is="if" value="{{permission}}"><template case="true"> <li data-zcqa="createMacroBtn" onclick="{{action(\'createMacroClick\')}}" class="createMacroBtnTxt linkCol mT5">{{getI18n(\'crm.macro.suggest.createnew.popup.header\')}} {{macroName}}</li> </template></template> <template is="if" value="{{expHandlers(expHandlers(macros.length,\'>\',0),\'&amp;&amp;\',manageShow)}}"><template case="true"> <template is="if" value="{{expHandlers(from,\'&amp;&amp;\',ifEquals(from,\'forecast\'))}}"><template case="true"> <li data-zcqa="mngMacroBtn"> <link-to onclick="{{action(\'manageMacro\')}}" lt-prop-route="crm.settings.section.macro.index" lt-prop-qp="{&quot;module&quot;: &quot;Potentials&quot;}" lt-prop-target="_blank" lt-prop-rel="noopener noreferrer">{{getI18n("crm.macro.label.manage.macro")}}</link-to> </li> </template><template case="false"> <li data-zcqa="mngMacroBtn" class="linkCol mB5" data-cid="showMacro" data-params="{&quot;module&quot;:&quot;{{module}}&quot;,&quot;reqFrom&quot;:&quot;&quot;}">{{getI18n("crm.macro.label.manage.macro")}}</li> </template></template> </template></template> </ul> </lyte-popover-footer> </template></template> </template> </lyte-popover> </template>',_dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,0]}]},{type:"componentDynamic",position:[1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"registerYield",position:[1,1],dynamicNodes:[{type:"text",position:[1,0]}]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3]},{type:"registerYield",position:[3,1],dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"componentDynamic",position:[1,1]},{type:"componentDynamic",position:[1]}]}},default:{}},{type:"attr",position:[3,1]},{type:"attr",position:[3,1,1]},{type:"for",position:[3,1,1],dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]},{type:"attr",position:[3,1,3]},{type:"if",position:[3,1,3],cases:{true:{dynamicNodes:[{type:"text",position:[1,0]}]}},default:{}},{type:"componentDynamic",position:[3]},{type:"attr",position:[5]},{type:"if",position:[5],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"attr",position:[1,1]},{type:"attr",position:[1,1,1]},{type:"if",position:[1,1,1],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]},{type:"text",position:[1,2]}]}},default:{}},{type:"attr",position:[1,1,3]},{type:"if",position:[1,1,3],cases:{true:{dynamicNodes:[{type:"attr",position:[1]},{type:"if",position:[1],cases:{true:{dynamicNodes:[{type:"attr",position:[1,1]},{type:"text",position:[1,1,0]},{type:"componentDynamic",position:[1,1]}]},false:{dynamicNodes:[{type:"attr",position:[1]},{type:"text",position:[1,0]}]}},default:{}}]}},default:{}},{type:"componentDynamic",position:[1]}]}},default:{}}]},{type:"componentDynamic",position:[3]}],_observedAttributes:["module","macros","show","flag","manageShow","macroName","permission","from","record","reqforCanvas","compId","moreClickTrack","selectedIds"],data:function(){return{module:Lyte.attr("string"),macros:Lyte.attr("array"),show:Lyte.attr("boolean"),flag:Lyte.attr("boolean",{default:!1}),manageShow:Lyte.attr("boolean",{default:!0}),macroName:Lyte.attr("string",{default:""}),permission:Lyte.attr("boolean",{default:!1}),from:Lyte.attr("string",{default:"listView"}),record:Lyte.attr("object"),reqforCanvas:Lyte.attr("boolean",{default:!1}),compId:Lyte.attr("string"),moreClickTrack:Lyte.attr("boolean",{default:!1}),selectedIds:Lyte.attr("array",{default:[]})}},methods:{initialize:function(){var t=this.getData("from");if(0==this.getData("flag")){var e=this.getData("module"),o=this,a=moduleRecordMapping[e].api_name;return store.findAll("macro",{module:a},"forecast"!==t).then((function(t){o.setData("macros",t),o.setData("flag",!0),document.getElementById("divMacro_"+o.data.compId).ltProp("show",!0)})),!1}},onSearch:function(t){0==t.length?(this.setData("show",!0),this.setData("manageShow",!1)):(this.setData("show",!1),this.setData("manageShow",!0));var e=document.getElementById("macroSearchBox").querySelector("input").value;e?this.setData("macroName",'"'+e+'"'):this.setData("macroName","")},doStuff:function(){var t=document.getElementById("macroSearchBox");t&&(t.querySelector("input").focus(),this.$node.constructor._actions.onFocusSearch.call(this))},moreMacroClose:function(t){if(this.getData("moreClickTrack"))return this.setData("moreClickTrack",!1),!1}},actions:{showMacroDropDown:function(){document.getElementById("divMacro_"+this.data.compId).ltProp("show",!0),"forecast"===this.getData("from")&&this.setData("flag",!1);var t=renderingUtils.windowHeight,e=this.$node.querySelector("lyte-popover").component.childComp.querySelector(".macropopover"),o=document.getElementById("macro_"+this.$node.component.data.compId).getBoundingClientRect(),a=t-o.top-o.height-20;e.getElementsByClassName("lytePopover")[0].style.overflow="auto",setTimeout((function(){e.getElementsByClassName("lytePopover")[0].style.maxHeight=a+"px"}),1e3)},hideMacroDropDown:function(t){var e;document.getElementById("divMacro_"+this.data.compId).ltProp("show",!1);var o=this.getData("from");if("listView"===o)e=customViewObject.selectedIds.join(";"),this.setData("from",""),o="";else if("forecast"===o){e=this.getData("selectedIds").join(";"),this.setData("from",""),o=""}Macro.showMacroExecDialog(t,this.getData("module"),e,o)},onFocusSearch:function(){document.getElementById("macroSearchBox").querySelector(".lyteInputBoxSearch").classList.add("macroFocuseSty")},onFocusOutSearch:function(){document.getElementById("macroSearchBox").querySelector(".lyteInputBoxSearch").classList.remove("macroFocuseSty")},createMacroClick:function(){this.setData("flag",!1),Macro.macrobtn(this.getData("module"))},closeMacroPopup:function(){document.getElementById("divMacro_"+this.data.compId).ltProp("show",!1)},checkDisableBtn:function(t){"forecast"!==this.getData("from")&&CrmDetailViewHandler&&CrmDetailViewHandler.prototype.disableBtnMsg(t)},manageMacro:function(){this.setData("flag",!1)},newhidett:function(){newhidett()}},init:function(){var t=Math.random().toString(36).substring(2,15);if(this.setData("compId",t),1==this.getData("reqforCanvas")){var e=moduleRecordMapping[this.getData("module")].api_name,o=this;store.findAll("macro",{module:e},!0).then((function(t){o.setData("macros",t),o.setData("flag",!0)}))}var a=this.getData("module");this.setData("permission",Crm.userDetails.permissions.Crm_Implied_Create_Activities&&Crm.userDetails.permissions["Crm_Implied_Mass_Email_"+a]&&Crm.userDetails.permissions["Crm_Implied_Mass_Update_"+a])}},{mixins:["crm-canvas-helpers"]}),store.registerModel("macro",{created_by:Lyte.attr("object"),shared:Lyte.attr("boolean"),name:Lyte.attr("string"),description:Lyte.attr("string"),actions:Lyte.attr("object"),id:Lyte.attr("string"),modified_by:Lyte.attr("object")}),store.registerAdapter("macro",{namespace:"crm/v2/settings"}),store.registerSerializer("macro",{});
